<meta name="TemplateVersion" content="V12.01.00">
<meta name="TemplateHome" content="kids">
<meta name="HelpFileName" content="NoContextSet.html">
<meta name="CrossBrowser" content="true">
<script type="text/javascript" src="../js/patweb98.js"></script>
<script type="text/javascript">
function ShowBedReq(linkurl) {
  Left=(document.body.clientWidth-600)/2
  DFrameLink(linkurl,23,110,420,210)
}
function ShowGST(linkurl) {
  Left=(document.body.clientWidth-600)/2
  DFrameLink(linkurl,23,110,420,210)
}
function ShowClm(linkurl) {
  Left=(document.body.clientWidth-600)/2
  DFrameLink(linkurl,23,110,420,210)
}
function ShowAtype(linkurl) {
  Left=(document.body.clientWidth-600)/2
  DFrameLink(linkurl,23,110,420,210)
}
function ShowHF(linkurl) {
  Left=(document.body.clientWidth-600)/2
  DFrameLink(linkurl,20,30,580,310)
}

function checkoverlap(ptmis001,ptmis002) {
  admissno=PatientLinks.admissno.value.replace(/ /g,"+")
  var serverURL = "../cgi-bin/patweb96.pbl?reportno=12&remoteno=2" +
                  "&ptmis001="+ptmis001.replace(/ /g,"+") +
                  "&ptmis002="+ptmis002.replace(/ /g,"+") +
                  "&admissno="+admissno
  var returnValue = RSExecute(serverURL);
  if(returnValue.status==0){
     return true;
  } else {
     return false;
  }
}

function Undischarge() {
 UpdateForm.updatety.value="1";
 if (document.UpdateForm.ddatreas.value==""){
    alert("Reason is required.")
    return;
 }
 if (document.UpdateForm.dscfimex.value=="1"){
    alert("Discharge FIM Details exist for this patient.\n" +
          "These details will be deleted.")
 }
 if (document.getElementById("ptcnwrun").value=="1") {
   var serverURL   = "../cgi-bin/emrweb08.pbl?reportno=44" +
                      "&valdcode=" + 
                      document.UpdateForm.admissno.value.replace(/ /g,"+")
   var returnValue = RSExecute(serverURL);
   if (returnValue.status==0) { 
     if (returnValue.return_value=="1") {
       if (confirm("Warning: \nDischarge Coding exists. Click OK to Undischarge patient" +
                   " or click Cancel to return.")) {
         document.UpdateForm.redirect.value=
         "mrtweb02.pbl?reportno=3&template=001" +
         "&urnumber=" + document.UpdateForm.urnumber.value.replace(/ /g,"+")+
         "&admissno=" + document.UpdateForm.admissno.value.replace(/ /g,"+")   
         UpdateForm.nextpage.value="7";
         UpdateForm.submit();
         return;
       } else {
         return;
       }
     }   
   }
 }
 UpdateForm.submit();
}

function Unadmit() {
 if (trim(document.UpdateForm.astat.value)=="On-Leave"){
    alert("Cannot Unadmit - patient on leave");
    return
 }
 if (document.UpdateForm.trnureas.value==""){
    alert("Cancellation Reason is required.")
    return;
 }
 if (document.UpdateForm.admfimex.value=="1"){
    alert("Admission FIM Details exist for this patient.\n" +
          "These details and all other FIM details will be deleted.")
 }
 UpdateForm.updatety.value="2";
 if (document.UpdateForm.trncancp.checked==true){
    UpdateForm.nextpage.value="8";
    UpdateForm.redirect.value="patweb89.pbl";
    document.UpdateForm.redirect.value="patweb89.pbl?reportno=1&template=010" +
    "&urnumber=" + document.UpdateForm.urnumber.value.replace(/ /g,"+")+
    "&admissno=" + document.UpdateForm.admissno.value.replace(/ /g,"+")
  if (getTop().location.pathname.match(/EmergencyMapFrame/g)) {
   UpdateForm.nextpage.value="2";
  }
 }
 UpdateForm.submit();
}

//<!-- HPS BLR(SAC) Code Starts Here --> 

function CancelMV(urnumber,admissno){

parent.location.href="patweb98.pbl?reportno=01&template=042&urnumber="+urnumber+"&admissno="+admissno
DFrameExit()

}
 //<!-- HPS Code Ends Here --> 

function UpdAdmit() {
 UpdateForm.updatety.value="4";
 if (document.UpdateForm.admnreas.value==""){
    alert("Reason is required.")
    return;
 }
 admissno=PatientLinks.admissno.value.replace(/ /g,"+")
 var serverURL = "../cgi-bin/patweb96.pbl?reportno=12&remoteno=9" +
        "&ptmis001="+UpdateForm.ptmis001.value.replace(/ /g,"+") +
        "&admissno="+admissno
 var returnValue = RSExecute(serverURL);
 if (returnValue.status!=0){
    return false;
 }
 if (UpdateForm.ptcnhdps=="3") {
    var serverURL = "../cgi-bin/patweb96.pbl?reportno=12&remoteno=11" +
                    "&ptmis001="+UpdateForm.ptmis001.value.replace(/ /g,"+") +
                    "&admissno="+PatientLinks.admissno.value.replace(/ /g,"+")
    var returnValue = RSExecute(serverURL);
    if (returnValue.status!=0) {
       return false; }   
 }
if (checkoverlap(document.UpdateForm.ptmis001.value,document.UpdateForm.ptmis002.value)==true){
   UpdateForm.submit();
 }
}
function UpdDisch() {
 UpdateForm.updatety.value="5";
 if (document.UpdateForm.dschreas.value==""){
    alert("Reason is required.")
    return;
 }
 admissno=PatientLinks.admissno.value.replace(/ /g,"+")
 var serverURL = "../cgi-bin/patweb96.pbl?reportno=12&remoteno=10" +
        "&ptdsc001="+UpdateForm.ptdsc001.value.replace(/ /g,"+") +
        "&admissno="+admissno
 var returnValue = RSExecute(serverURL);
 if (returnValue.status!=0){
    return false;
 }
 UpdateForm.submit();
}
function UpdCare() {
  if(validateMandatory(UpdateForm)){
//
    PatientFolder=document.UpdateForm.pmifoldr.value.substr(3,1);
    CareType=document.UpdateForm.trnacare.value.substr(14,3);
    CheckClaim=document.UpdateForm.chkclaim.value.substr(3,5);
    PTCNCOMF="%STANDARD.01.025.110.243.0.1"
    TAC=CheckClaim.search(/M/g);
    VET=CheckClaim.search(/V/g);
    WORK=CheckClaim.search(/W/g);
    if (PatientFolder != "4" && CareType=="3  ") {
       if (TAC == "-1" && VET == "-1" && WORK == "-1") {
// Show alert if not TAC,VET or Work claimn with a care type of family choice
         if(PTCNCOMF=="2") {
           alert("Patient folder conflict - " +
                 "Patient folder details will be updated.");
         }
       }
    }
    UpdateForm.reportno.value="8";
    UpdateForm.updatety.value="8";
    UpdateForm.submit();
  }
}
function AddProgram() {
  var p=document.UpdateForm;
  AddHealthFundProgram(p.urnumber,p.admissno);
}
function CheckPreAdm() {
  if(trim(document.UpdateForm.astat.value) != "Pre-Admission") {
    return;
  }
  DisableForm(UpdateForm);
  document.UpdateForm.churbutt.disabled=false;
  document.UpdateForm.closbutt.disabled=false;
}
function UpdateExternalVisitID() {

  if (isWhitespace(document.getElementById('ibalv001').value)) {
    alert('External Visit ID is Mandatory.')
    return;
  }

  var serverURL   = "../cgi-bin/emrweb08.pbl?reportno=48" +
                    "&valdcode=" + document.UpdateForm.admissno.value
                                           .replace(/ /g,"+") +
                    "&valdalvn=" + document.getElementById('ibalv001').value
                                           .replace(/ /g,"+");
  var returnValue = RSExecute(serverURL);
  if (returnValue.status==0) {
    location.reload();
  }
}
function validateExternalVisitID(externalID) {
  if (isWhitespace(externalID.value)) {
    return;
  }
  var serverURL   = "../cgi-bin/emrweb08.pbl?reportno=49" +
                   "&valdalvn=" + externalID.value.replace(/ /g,"+") +
                   "&valdcode=" +
                   document.UpdateForm.admissno.value.replace(/ /g,"+");
  var returnValue = RSExecute(serverURL);
  if (returnValue.status!=0) {
    externalID.value="";
    externalID.focus();
  }
}
</script>
</head>

%START.OF.PAGE
<body onload="PageLoad(event);CheckPreAdm();">
<span class=DFrameTitleBar>
<img align="right" alt="Exit" class="MenuIcon" 
 src="../images/ExitIcon.gif" onclick="DFrameExit();">
Supervisor Error Corrections
</span>
<div id=PageBodySection>

<form name=UpdateForm action="patweb96.pbl" method= get style="margin:0">

<input type=hidden name=reportno value=01>
<input type=hidden name=template value=42>
<input type=hidden name=nextpage value="0">
<input type=hidden name=updatety value="0" >
<input type=hidden name=remoteno value=" "> 
<input type=hidden name=redirect value="%PATWEB98.01.001.patweb98.01.002">
<input type=hidden name=urnumber value="%PATWEB98.01.003">
<input type=hidden name=admissno value="%PATWEB98.01.081">
<input type=hidden name=caretype value="%PATWEB98.01.113.1">
<input type=hidden name=pmifoldr value="%PATWEB98.01.086.079.3">
<input type=hidden name=chkclaim value="%PATWEB98.01.126.3">
<input type=hidden name=d_ptmis010 value="%PATWEB98.01.111.1">
<input type=hidden name=d_ptmis027 value="%PATWEB98.01.126.1">
<input type=hidden name=d_ptmis013 value="%PATWEB98.01.114.0">
<input type=hidden name=d_ptmis014 value="%PATWEB98.01.115.0">
<input type=hidden name=ptrgm001 value="%PATWEB98.01.838. 1">
<input type=hidden name=ptrgm002 value="%PATWEB98.01.838. 2">
<input type=hidden name=ptrgm003 value="%PATWEB98.01.838. 3">
<input type=hidden name=bdmnindc value="1">
<input type=hidden name=astat value="%PATWEB98.01.104">
<input type=hidden name=admfimex value="%PATWEB98.01.884.003" />
<input type=hidden name=dscfimex value="%PATWEB98.01.884.004" />
<input type=hidden name=ptcnhdps value="%STANDARD.01.025.080.250.1.1" />
<input type=hidden name=ptcnwrun id="ptcnwrun" 
 value="%STANDARD.01.025.123.207.0.1" />

<table align=center cellspacing=0 cellpadding=3 border=0 width=95%>
<tr><td class=DataLabel>Admission Date</td>
    <td class=DataField>
    <input type=text size=12 name=ptmis001 
     value="%PATWEB98.01.102" class="Date" title="Date">
    <a href='javascript:SetCurrentDateTime(UpdateForm.ptmis001,null)'>
    <img src="../images/DateTimeStamp.gif" class=Icon></a>
    <a href='javascript:DateLookupFrame(UpdateForm.ptmis001)'>
    <img src="../images/DateLookup.gif" class=Icon></a>
    </td>
    <td class=DataLabel>%STANDARD.01.017.PC
    <select name=admnreas class=mandatory>
     <option></option>
      %STANDARD.01.007.PC
     </select>

    </td></tr>

<tr><td class=DataLabel>Admission Time</td>
    <td class=DataField>
    <input type=text size=12 name=ptmis002 
     value="%PATWEB98.01.103" title="Time">
    <a href='javascript:SetCurrentDateTime(null,UpdateForm.ptmis002)'>
    <img src="../images/DateTimeStamp.gif" class=Icon></a>
    <a href='javascript:TimeLookupFrame(UpdateForm.ptmis002)'>
    <img src="../images/TimeLookup.gif" class=Icon></a>
    </td><td>
    <input type=button class="button" value="Update" 
     id="pat98sub1" onclick="tempDisable(this);UpdAdmit();"></td>
    </tr>
<tr><td colspan=5><hr width=100%></td></tr>

<tr><td class=DataLabel>Discharge Date</td>
    <td class=DataField>
    <input type=text size=12 name=ptdsc001 class="PastDate"
     value="%PATWEB98.01.201" title="Discharge Date">
    <a href='javascript:SetCurrentDateTime(UpdateForm.ptdsc001,null)'>
    <img src="../images/DateTimeStamp.gif" class=Icon></a>
    <a href='javascript:DateLookupFrame(UpdateForm.ptdsc001)'>
    <img src="../images/DateLookup.gif" class=Icon></a>
    </td>
    <td class=DataLabel>%STANDARD.01.017.PC
    <select name=dschreas class=mandatory>
     <option></option>
      %STANDARD.01.007.PC
     </select>
    </td></tr>

<tr><td class=DataLabel>Discharge Time</td>
    <td class=DataField>
    <input type=text size=12 name=ptdsc002
     value="%PATWEB98.01.202" title="Discharge Time">
    <a href='javascript:SetCurrentDateTime(null,UpdateForm.ptdsc002)'>
    <img src="../images/DateTimeStamp.gif" class=Icon></a>
    <a href='javascript:TimeLookupFrame(UpdateForm.ptdsc002)'>
    <img src="../images/TimeLookup.gif" class=Icon></a>
    </td><td>
    <input type=button class="button" value="Update" 
     id="pat98sub2" onclick="tempDisable(this);UpdDisch();"></td>
    </tr>
<tr><td colspan=5><hr width=100%></td></tr>

<!-- HPS BLR(SAC) Code Starts Here -->
 <TR>
    <td class=DataLabel width="25%">%STANDARD.01.017.CC</TD>
    <tD>
    <select name=trnacare>
     <option></option>
      %PATWEB98.01.113.2
     </select>
<tr><td class=DataLabel>Date/Time of Change </td>
     <td><select name=trandate class=Mandatory title="date of change">
      %PATWEB98.01.818
     </select>
     <input type=text size=8 name=trantime class=Mandatory 
      title="Time of Change">
     <img src="../images/DateTimeStamp.gif" class=Icon
      onclick="SetCurrentDateTime(null,UpdateForm.trantime);">
     <img src="../images/TimeLookup.gif" class=Icon
      onclick="TimeLookupFrame(UpdateForm.trantime);">
     </td><td>
     <input type=button class="button" value="Update" 
      id="pat98sub3" onclick="tempDisable(this);UpdCare();"></td>
     </tr>
<tr><td colspan=5><hr width=100%></td></tr>
<tr><td class=DataLabel>%STANDARD.01.017.PC</TD>
    <td>
    <select name=trnureas class=mandatory>
     <option></option>
      %STANDARD.01.007.PC
     </select>
  </td><td>
  <input type=button Value="Unadmit" class="button" 
   id="pat98sub5" onclick="tempDisable(this);Unadmit();">
</td></tr>
<tr><td>Cancel Pre-admission</td>
     <td><input type=checkbox value="1" name=trncancp >
</td></tr>
<tr><td colspan=5><hr width=100%></td></tr>
<tr><td class=DataLabel>%STANDARD.01.017.PC</TD>
    <td>
    <select name=ddatreas class=mandatory>
     <option></option>
      %STANDARD.01.007.PC
     </select>
  </td><td>
  <input type=button Value="Undischarge" class="button" 
   id="pat98sub4" onclick="tempDisable(this);Undischarge();">
</td></tr>

<tr><td colspan=6><hr width=100%></td></tr>

<tr><td class=DataLabel>External Visit ID</TD>
  <td>
    <input type=text size=30 maxlength=20 name=ibalv001 id=ibalv001
     title="External Visit ID" value="%PATWEB98.01.394" class='Mandatory'
     onblur="validateExternalVisitID(this);">
  </td>
  <td>
  <input type=button Value="Update" class="button"
   onclick="tempDisable(this);UpdateExternalVisitID();">
</td></tr>

<tr><td colspan=6><hr width=100%></td></tr>

<!--HPS Code Ends Here-->

<tr><td colspan=4 align=center>
<!-- HPS BLR(SAC)Code Starts Here -->
  <input type=button Value="Cancel Movement" class=Bigbutton 
   onclick='CancelMV("%PATWEB98.01.003","%PATWEB98.01.081")'>
<!--HPS Code Ends Here-->

  <input type=button Value="Change U/R" class="button" name="churbutt"
   onclick='ChangeURFrame("%PATWEB98.01.001.patweb98.01.041")'>
  <input type=button Value="GST Accom." class="button" 
   onclick='ShowGST("%PATWEB98.01.001.patweb71.03.005")'>
  <input type=button Value="Close" class="button" name="closbutt"
   onclick="DFrameExit();">

  <input type=button value="" class=Bigbutton name=changecb
   style="width:180px" 
   onclick='ShowClm("%PATWEB98.01.001.patweb78.04.001")'>

  <input type=button Value="Change Health Fund After Invoiced" class=Bigbutton 
   style="width:190px" 
   onclick='ShowHF("%PATWEB98.01.001.patweb78.04.003")'>
  <div id=ADDProgramField></div>
    </td></tr>

</table>
</form>
</div>

<form name=PatientLinks method=get>
<input type=hidden name=reportno value=1>
<input type=hidden name=template value=035>
<input type=hidden name=urnumber value="%PATWEB98.01.003">
<input type=hidden name=admissno value="%PATWEB98.01.081">

<span id=AddProgram style="display:none">
<input type=button Value="Add Program" class="button"
    onclick='AddProgram();'>
</span>
<script type="text/javascript">
  UpdateForm.changecb.value="Change " + trim('%STANDARD.01.017.CL') +
                            " After Invoiced"
 ptcnhdps="%STANDARD.01.025.080.250.1.1"
 if(ptcnhdps!="1"){
   ADDProgramField.innerHTML=document.getElementById('AddProgram').innerHTML;
 }
</script>
