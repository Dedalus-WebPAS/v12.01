<meta name="TemplateVersion" content="V12.01.00">
<meta name="TemplateHome" content="hea-nsw">
<meta name="HelpFileName" content="NoContextSet.html">
<meta name="CrossBrowser" content="true">
<script type="text/javascript" src="../js/eReferralReg.js"></script>
%START.OF.PAGE
<script type="text/javascript">
function UpdateWat() {
  if (!isWhitespace(document.UpdateForm.wattx028.value)){
    if (isWhitespace(document.UpdateForm.wattr022.value)){
      alert("Preadmission Time requires a Preadmission Date")
      return;
    }
  }

  if(!validateOpDate() || !validatePreDate()){
     return;
  }
  if(!validateTime()){
    return;
  }
  if(!validateMandatory(UpdateForm)){
     return;
  }
  if(!isWhitespace(document.UpdateForm.erefrlid.value)) {
     var xhr = createHttpObject();
     var url = "comweb10.pbl?reportno=03&remoteno=5"
            +"&erefrlid="+document.UpdateForm.erefrlid.value.replace(/ /g,'+')
            +"&urnumber="+document.UpdateForm.urnumber.value.replace(/ /g,'+')
            +"&admissno="+document.PatientLinks.admissno.value.replace(/ /g,'+')
            +"&casekeys="+document.UpdateForm.casekeys.value.replace(/ /g,'+')
     xhr.open('GET',url,false);
     xhr.send();
  }

    SubmitHidden(UpdateForm);
}

function valDoc(){
  var serverURL = "../cgi-bin/watweb01.pbl?reportno=13&valdtype=1" +
      "&wattr011="+document.UpdateForm.wattr011.value + "&wattr012="+document.UpdateForm.wattr012.value;
  var returnValue = RSExecute(serverURL);
  if(returnValue.return_value == -1){
     return true;
  }
  return false;
}

/*function ChgStat() {
    var ind=document.UpdateForm.wattx004.value.substr(3,1)
    if (ind =="D" || ind =="S") {
      document.getElementById('NRFCLabel1').innerHTML="NRFC To Date";
      document.getElementById('NRFCLabel3').innerHTML="%STANDARD.01.017.WN"
      document.getElementById('NRFCField1').innerHTML=document.getElementById('InNRFCField1').innerHTML
      document.getElementById('NRFCField3').innerHTML=document.getElementById('InNRFCField3').innerHTML
      UpdateForm.watsu003.className="Mandatory selectBig";
    }
    else {
      document.getElementById('NRFCLabel1').innerHTML="";
      document.getElementById('NRFCLabel3').innerHTML="";
      document.getElementById('NRFCField1').innerHTML="";
      document.getElementById('NRFCField3').innerHTML="";
    } 
    if(ind == "S"){
       for(i=0; i<document.UpdateForm.watsu003.length; i++){
           if(trim(UpdateForm.watsu003.options[i].value.substr(4,1)=="S")){
              document.UpdateForm.watsu003.selectedIndex=i; 
           } 
       }
    }
    if(ind == "D"){
       for(i=0; i<document.UpdateForm.watsu003.length; i++){
           if(trim(UpdateForm.watsu003.options[i].value.substr(4,1)=="D")){
              document.UpdateForm.watsu003.selectedIndex=i; 
           } 
       }
    }
}*/

function validatePreDate(){
  date2=UpdateForm.wattr008.value;
  date1=UpdateForm.wattr022.value;
  if(isWhitespace(UpdateForm.wattr008.value) || isWhitespace(UpdateForm.wattr022.value)){
     return true;
  }
  else{
    if(ChkDateTime2(date1,date2)){
      alert(" \"Planned Admission Date\" Can't be Less than \"Preadmission Date\"");
      return false;
    }
    return true;
  }
}

function RemoveQuote(Field){
  Field.value=Field.value.replace(/\"/g,"");
}

function init(){
  UpdateForm.redirect.value+="watweb01.pbl?reportno=2&template=1&casekeys=" +
  PatientLinks.casekeys.value.replace(/ /g,"+");
  if(UpdateForm.BookingStatus.value == "1"){
     UpdateForm.bkrec005.className="Readonly";
     UpdateForm.bkrec005.disabled=true;
  }
}

function Listst() {
  i=document.UpdateForm.ListStat.selectedIndex;
  document.UpdateForm.wattx004.value=document.UpdateForm.ListStat.options[i].value.substring(3,6);
}

</script>
</head>
<body onload="PageLoad(event);OnlineReferral();eRefPreList();
              checkBasicCoverRate(document.UpdateForm.wattx026);
              FilterClaimType(document.UpdateForm.wattx026);">
<div id=PatientHeading></div>
<script type="text/javascript">
PatientURN="%WATWEB01.02.003";
PatientVIS="%WATWEB01.02.081";
PatientNAM="%WATWEB01.02.002";
PatientSTA="%WATWEB01.02.086.078";
PatientALT="%WATWEB01.02.084";
PatientSEX="%WATWEB01.02.019";
PatientDOB="%WATWEB01.02.020";
PatientAGE="%WATWEB01.02.021";
PatientLOC="%WATWEB01.02.083";
DoctorCOD="%WATWEB01.02.082.003";
DoctorNAM="%WATWEB01.02.082.002";
PatientAID="%WATWEB01.02.086.090";
PatientIND="%WATWEB01.02.086.091";
PatientCUR="%WATWEB01.02.086.092";
PatientCLC="%WATWEB01.02.086.093.1";
PatientCLH="%STANDARD.01.017.CL";
PatientHFT="%WATWEB01.02.086.094";
PatientCDM="%WATWEB01.02.086.095";
PatientVDH="%WATWEB01.02.086.099.015";
PatientUNT="%WATWEB01.02.066.0";
PatientPRI="%WATWEB01.02.086.066.1";
InsertPatientHeader();
</script>

<div id=PatientMenu></div>
<div id=PageBodySection style="overflow: auto;">

<form name=UpdateForm action="watweb01.pbl" method=post style="margin:0" onsubmit="Listst();return validateMandatory(this);">
<input type=hidden name=reportno value=2>
<input type=hidden name=template value=001>
<input type=hidden name=casekeys id="casekeys" value="%WATWEB01.02.101">
<input type=hidden name=updttype value="U">
<input type=hidden name=urnumber id="urnumber" value="%WATWEB01.02.003">
<input type=hidden name=nextpage value="7">
<input type=hidden name=redirect value="">
<input type=hidden name=BookingStatus value="%WATWEB01.02.175">
<input type="hidden" name="erefrlid" value="%WATWEB01.02.382">
<input type=hidden name=erefmapwt id="erefmapwt" value="1">

<table border=0 width=100% cellspacing="0" cellpadding="1" align=center>
<tr><td align=center class=HeadingCell>Update Waiting List Entry</td></tr>
</table>

<table border=0 width=95% cellspacing=0 cellpadding=1 align=center>

<tr>
  <td class=DataLabel>Date on List</td>
  <td class=DataField colspan=3>
    <input type=text name=wattr006 size=12 title="Date on List" class=Readonly readonly 
     tabindex=-1 value="%WATWEB01.02.109">
  </td>
  <td class=DataLabel>%STANDARD.01.017.CL</td>
  <td class=DataField>
    <select name=wattx026 tabindex=21 title="%STANDARD.01.017.CL" class="Mandatory selectBig">
      <option></option>
      %WATWEB01.02.526.9.1.10.2.X
    </select>
  </td>
</tr>

<tr>
  <td width=15%>Consultant</td>
  <td class=DataField colspan=3>
    <input type=text name=wattr012 size=8 maxlength=8 readonly class="Readonly" 
     title="Consultant" tabindex=-1 value="%WATWEB01.02.115.003">
    <input type=text name=n_wattr012 size=40 readonly class="Readonly"
     title="Consultant Name" tabindex=-1 value="%WATWEB01.02.115.002">
  </td>
  <td class=DataLabel id=wtcnbrsr></td>
  <td class=DataField>
    <select name=wattr050 tabindex=23 title="" class="Mandatory selectBig">
      <option></option>
      %WATWEB01.02.187.2
    </select>
    <div id="divTransferLabel"></div>
    <div id="divTransferSource"></div>
  </td>
</tr>

<tr>
  <td class=DataLabel>%STANDARD.01.017.WU</td>
  <td class=DataField colspan=3>
    <input type=hidden name=wattr011 value="%WATWEB01.02.114.1">
    <input type=text readonly size=30 class="Readonly selectBig" name=xxxtr011 value="%WATWEB01.02.114.0"
     tabindex=-1>
  </td>
  <td class=DataLabel>%STANDARD.01.017.ap</td>
  <td class=DataField>
    <select name=wattx006 tabindex=24 class="Mandatory selectBig" title="%STANDARD.01.017.ap">
      <option></option>
      %WATWEB01.02.506.5
    </select>
  </td>
</tr>

<tr>
  <td class=DataLabel>CMBS Code</td>
  <td class=DataField colspan=3>
  <input type=text class=Readonly readonly name=wattr001 title="CMBS Code" value="%WATWEB01.02.103" tabindex=-1>
  <td class=DataLabel>Exp. Post Op Ward</td>
  <td class=DataField>
    <select name=wattx005 tabindex=25 class="Mandatory selectBig" title="Exp. Post Op Ward">
      <option></option>
      %WATWEB01.02.505.2
    </select>
  </td>
</tr>

<tr>
  <td class=DataLabel>Diagnosis</td>
  <td class=DataField colspan=3>
    <input type=text name=wattr004 size=60 maxlength=40 tabindex=1 
     title="Diagnosis"
     value="%WATWEB01.02.107" onblur="RemoveQuote(this);">
  </td>
  <td class=DataLabel>%STANDARD.01.017.WS</td>
  <td class=DataField>
    <select name=wattr015 tabindex=26 class=selectBig title="%STANDARD.01.017.WS">
      <option></option>
      %WATWEB01.02.118.5
    </select>
  </td>
</tr>

<tr>
  <td class=DataLabel>Procedure</td>
  <td class=DataLabel colspan=3>
    <input type=text name=wattr003 size=70 maxlength=50 tabindex=7 
     title="Procedure"
     value="%WATWEB01.02.106" onblur="RemoveQuote(this);">
  </td>
  <td class=DataLabel>Provisional Admission Date</td>
  <td class=DataField>
    <input type=text name=wattr025 size=12 onblur="checkDate(this,'Date');" 
     title="Prov Admit Date" tabindex=27 value="%WATWEB01.02.132">
    <img src=../images/DateTimeStamp.gif class=Icon date=UpdateForm.wattr025 time=null>
    <img src=../images/DateLookup.gif class=Icon date=UpdateForm.wattr025>
  </td>
</tr>

<tr>
  <td class=DataLabel>Estimated Op Time</td>
  <td class=DataField colspan=3>
    <input type=text name=wattr002 maxlength=5 title="Estimated Operating time"
     class=Integer min=0 onblur="TextBlurHandler(this)" size=10 tabindex=8 value=%WATWEB01.02.105>
  </td>
  <td class=DataLabel>Planned Adm. Date</td>
  <td class=DataLabel >
    <input type=text name=wattr008 size=12 maxlength=12 tabindex=28 
     title="Planned Adm. Date"
     onblur="checkDate(this,'Date')"
     value="%WATWEB01.02.111">
    <img src=../images/DateLookup.gif class=Icon date=UpdateForm.wattr008>
    Time
    <input type=text name=wattx015 size=8 maxlength=8 tabindex=29 title="Time" value="%WATWEB01.02.515">
    <img src=../images/DateTimeStamp.gif class=Icon
     date=UpdateForm.wattr008 time=UpdateForm.wattx015>
    <img src=../images/TimeLookup.gif class=Icon time=UpdateForm.wattx015>
  </td>
</tr>

<tr>
  <td class=DataLabel>Planned Length of Stay</td>
  <td class=DataLabel colspan=3>
    <input type=text name=wattr013 size=5 maxlength=5 tabindex=10 value="%WATWEB01.02.116"
     class="Mandatory Integer" min=0 title="Planned Length of Stay">(days)
  </td>
  <td class=DataLabel>Proposed Op. Date</td>
  <td class=DataLabel>
    <input type=text name=wattr028 size=12 maxlength=12 tabindex=30 title="Date" 
     onblur="checkDate(this,'Date')" value="%WATWEB01.02.135">
    <img src=../images/DateLookup.gif class=Icon date=UpdateForm.wattr028>
    Time
    <input type=text name=wattx029 size=8 maxlength=8 tabindex=31 title="Time" value="%WATWEB01.02.529">
    <img src=../images/DateTimeStamp.gif class=Icon date=UpdateForm.wattr028 time=UpdateForm.wattx029>
    <img src=../images/TimeLookup.gif class=Icon time=UpdateForm.wattx029>
  </td>
</tr>

<tr>
  <td class=DataLabel width=15%>%STANDARD.01.017.VI</td>
  <td class=DataField colspan=3>
    <select name=wattx040 class="Mandatory selectBig" title="%STANDARD.01.017.VI" tabindex=11>    
      <option></option>
      %WATWEB01.02.540.5
    </select>
  </td>
  <td class=DataLabel>Confirmed Adm. Date</td>
  <td>
    <input type=text name=bokrx006 size=12 title="Confirmed Adm Date"
     value="%WATWEB01.02.706" class="Readonly Icon" readonly tabindex=-1>
     Time
    <input type=text name=bkrec005 size=8 maxlength=8 tabindex=-1 title="Time" 
     value="%WATWEB01.02.707" class="Readonly Icon" readonly>
  </td>
</tr>

<tr>
  <td class=DataLabel width=15%>%STANDARD.01.017.TP</td>
  <td class=DataField colspan=3>
    <select name=wattr014 class="Readonly selectBig" readonly disabled title="%STANDARD.01.017.TP" tabindex=-1>
      <option></option>
      %WATWEB01.02.117.5
    </select>
  </td>
  <td class=DataLabel>Confirmed Op. Date</td>
  <td class=DataField>
    <input type=text size=12 value="%WATWEB01.02.710" class=Readonly readonly tabindex=-1>
  </td>
</tr>

<tr>
  <td class=DataLabel>%STANDARD.01.017.VL</td>
  <td class=DataField colspan=3>
    <select name=wattx004 class="Readonly selectBig" readonly title="%STANDARD.01.017.VL" disabled tabindex=-1>
      <option></option>
      %WATWEB01.02.504.5
    </select>
  </td>
  <td class=DataLabel>%STANDARD.01.017.XE 1</td>
  <td class=DataField>
    <select name=wattx010 tabindex=34 class="selectBig" title="%STANDARD.01.017.XE 1">
      <option></option>
      %WATWEB01.02.510.5
    </select>
  </td>
</tr>

<tr>
  <td>&nbsp;</td>
  <td colspan=3>&nbsp;</div></td>
  <td class=DataLabel>%STANDARD.01.017.XE 2</td>
  <td class=DataField>
    <select name=wattx011 tabindex=35 class="selectBig" title="%STANDARD.01.017.XE 2">
      <option></option>
      %WATWEB01.02.511.5
    </select>
  </td>
</tr>

<tr>
  <td class=DataLabel rowspan=3 valign=top>Comments</td>
  <td class=DataField rowspan=3 colspan=3>
    <textarea wrap=hard name=wattrcom cols=50 rows=3 tabindex=16>%WATWEB01.02.161</textarea>
  </td>
  <td class=DataLabel colspan=1>%STANDARD.01.017.XE 3</td>
  <td class=DataField>
    <select name=wattx027 tabindex=36 class="selectBig" title="%STANDARD.01.017.XE 3">
      <option></option>
      %WATWEB01.02.527.5
    </select>
  </td>
</tr>

<tr>
  <td>%STANDARD.01.017.XG</td>
  <td>
    <select name=wattx012 tabindex=37 title="%STANDARD.01.017.XG" class="selectBig">
      <option value=""></option>
      %WATWEB01.02.308.5
    </select>
  </td>
</tr>

<tr>
  <td>Preadmission Date</td>
  <td class=DataLabel>
    <input type=text name=wattr022 size=12 maxlength=12 tabindex=38
     onblur="checkDate(this,'Date')" value="%WATWEB01.02.127">
    <img src=../images/DateLookup.gif class=Icon date=UpdateForm.wattr022>
    Time
    <input type=text name=wattx028 size=8 maxlength=8 tabindex=39 title="Time" value="%WATWEB01.02.528">
    <img src=../images/DateTimeStamp.gif class=Icon date=UpdateForm.wattr022 time=UpdateForm.wattx028>
    <img src=../images/TimeLookup.gif class=Icon time=UpdateForm.wattx028>
  </td>
</tr>

<tr valign=top>
  <td class=DataLabel rowspan=3 valign=top>Preadmission Notes</td>
  <td class=DataField rowspan=3 colspan=3>
    <textarea wrap=hard name=wtpccomm cols=50 rows=3 tabindex=19>%WATWEB01.02.172</textarea>
  </td>
  <td>%STANDARD.01.017.W2</td>
  <td class=DataField colspan=3>
    <select name="wattr019" tabindex=41 title="%STANDARD.01.017.W2" class="selectBig">
      <option value=""></option>
      %WATWEB01.02.122.5
    </select>
  </td>
</tr>

<tr>
  <td>%STANDARD.01.017.W3</td>
  <td class=DataField>
    <select name="wattr020" tabindex=42 title="%STANDARD.01.017.W3" class="selectBig">
      <option value=""></option>
      %WATWEB01.02.123.5
    </select>
  </td>
</tr>

<tr>
  <td>Linked Referral</td>
  <td>
    <input type=text title="Linked Referral" name="refrlvis" tabindex=43 value="%WATWEB01.02.380">
    <img src=../images/SearchIcon.gif class=Icon
    onclick='VisitSearchFrameAll(UpdateForm.urnumber,UpdateForm.refrlvis);'>
  </td>
</tr>

<tr>
  <td>Date Keyed</td>
  <td class=DataField>
    <input type=text class=Readonly readonly size=12 maxlength=12 tabindex=-1 value="%WATWEB01.02.126">
  </td>
  <td colspan=4>&nbsp;</td>
</tr>

<tr>
  <td>Operator ID</td>
  <td class=DataField> 
   <input type=text size=12 maxlength=12 class=Readonly readonly tabindex=-1 value='%WATWEB01.02.310'>
  </td>
  <td colspan=4>&nbsp;</td>
</tr>

<tr>
  <td colspan=8 align=center><br>
    <input type=button class="button" value="Ok" tabindex=50 
     onclick="UpdateWat(this);">
    <input type=button value="Cancel" class="button" tabindex=51 onclick='PatientLinkTo("watweb01.pbl",2,10,0,0,0);'>
</td>
</tr>

</table>
</form>

<span id=InNRFCField1 style="display:none">
  <input type=text name=watsu002 id=watsu002 size=12 maxlength=12 title="ToDate">
  <img src=../images/DateTimeStamp.gif class=Icon date=UpdateForm.watsu002 time=null>
  <img src=../images/DateLookup.gif class=Icon date=UpdateForm.watsu002>
</span>

<span id=InNRFCField3 style="display:none">
  <select name=watsu003 id=watsu003 title="%STANDARD.01.017.WN" class="selectBig">
    <option></option>
    %WATWEB01.02.605.2
  </select>
</span>

<form name=PatientLinks method=get>
<input type=hidden name=reportno value=1>
<input type=hidden name=template value=004>
<input type=hidden name=urnumber value="%WATWEB01.02.003">
<input type=hidden name=admissno value="%WATWEB01.02.081">
<input type=hidden name=MenuType value="%WATWEB01.02.088">
<input type=hidden name=casekeys value="%WATWEB01.02.101">
</form>

<script type="text/javascript">
function ChkDateTime1(strtDate,endDate) {
  var strtDay  = strtDate.substring(0,2);
  var strtMon  = strtDate.substring(3,6);
  var strtYear = strtDate.substring(7,11);
  var endDay   = endDate.substring(0,2);
  var endMon   = endDate.substring(3,6);
  var endYear  = endDate.substring(7,11);

  strtMon = GetMonthNumber(strtMon);
  endMon  = GetMonthNumber(endMon);

  var strtDateTime = strtYear + strtMon + strtDay 
  var endDateTime  = endYear + endMon + endDay 
  if (endDateTime <= strtDateTime ) return false;
  return true;
}

function validateTime(){
   date1=UpdateForm.wattr008.value;
   date2=UpdateForm.wattr006.value;
   if(ChkDateTime1(date1,date2)) {
     message=" \"Planned Admission Date\" cannot be before";
     message+="\"Date on List\"";
     alert(message);
     return false;
   }
  return true;
}

function validateOpDate(){
   date1=UpdateForm.wattr008.value;
   date2=UpdateForm.wattr028.value;
   if(ChkDateTime2(date1,date2)) {
     message=" \"Proposed Operation Date\" should be equal to or greater than ";
     message+="\"Planned Admission Date\"";
     alert(message);
     return false;
   }
  return true;
}

function ChkDateTime2(strtDate,endDate) {
  var strtDay  = strtDate.substring(0,2);
  var strtMon  = strtDate.substring(3,6);
  var strtYear = strtDate.substring(7,11);

  var endDay   = endDate.substring(0,2);
  var endMon   = endDate.substring(3,6);
  var endYear  = endDate.substring(7,11);

  strtMon = GetMonthNumber(strtMon);
  endMon  = GetMonthNumber(endMon);

  var strtDateTime = strtYear + strtMon + strtDay
  var endDateTime  = endYear + endMon + endDay
  if (endDateTime >= strtDateTime ) {
     return false;
  }
  return true;
}

function DisplayTrnSrc(field) {
  i=field.selectedIndex;
  ind=field.options[i].value.substring(4,5)
  if (ind!="1") {
   document.getElementById('divTransferSource').innerHTML="";
   document.getElementById('divTransferLabel').innerHTML="";
  } else {
   document.getElementById('divTransferSource').innerHTML=document.getElementById('spTransfer').innerHTML;
   document.getElementById('divTransferLabel').innerHTML=document.getElementById('spTransferLabel').innerHTML;
  }
}

var wlCode = "%WATWEB01.02.512.1";

for(i=0; i<document.UpdateForm.wattx012.length; i++){
    if(wlCode==document.UpdateForm.wattx012.options[i].value.substr(0,3)){
      document.UpdateForm.wattx012.selectedIndex=i;
      break;
    }
}
// wArray: keep first(0th) & last elements so that there is no IndexOutOfBOunds error
wArray=["%STANDARD.01.017.S ","%STANDARD.01.017.W1","%STANDARD.01.017.W2",
        "%STANDARD.01.017.W3","%STANDARD.01.017.W4","%STANDARD.01.017.X5",
        "%STANDARD.01.017.X6","%STANDARD.01.017.X7","%STANDARD.01.017.X8",""];
document.getElementById("wtcnbrsr").innerHTML = wArray[%STANDARD.01.044.037.236.001];
document.UpdateForm.wattr050.title = wArray[%STANDARD.01.044.037.236.001]; 
</script>

<span id=spTransferLabel style="display:none">
Transfer Source
</span>

<span id=spTransfer style="display:none">
  <input type="text" size=7 maxlength=5 name=trnsfsrc id=trnsfsrc
   class=Mandatory title="Transfer Source" tabindex=5
   onchange="validateCode(9,trnsfsrc,trandesc);">
  <input type=text size=20 name=trandesc id=trandesc notab
   class=Readonly readonly>
  <img src="../images/SearchIcon.gif" class=Icon
   onclick="TransferSourceFrame(trnsfsrc,trandesc)">&nbsp;Previous ID&nbsp;
  <input type=text size=15 maxlength=9 name=previd01 id=previd01
   class=Mandatory min=1 title="Previous ID" 
   onblur="checkInteger(this,this.title);">
</span>

<span id=spTransferBlank style="display:none">
  <input type=hidden name=trnsfsrc id=trnsfsrc>
</span>
