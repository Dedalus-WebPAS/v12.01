<meta name="TemplateVersion" content="V12.01.01">
<meta name="TemplateHome" content="wahealth">
<meta name="HelpFileName" content="NoContextSet.html">
<meta name="CrossBrowser" content="true">
<script type="text/javascript" src="../js/EmrMandatory.js"></script>
<script type="text/javascript" src="../js/emrweb0201101.js"></script>
<script type="text/javascript" src="../js/CustomMyhrConsent.js"></script>
<script type="text/javascript">
function init() {
  if (document.HiddenFields.DischargeComplete.value != 1) {
    alert("ED Visit has already been discharged.");

    PageLocation = "?reportno=1&template=109" +
                   "&urnumber=" + PatientURN.replace(/ /g,"+") +
                   "&admissno=" + PatientVIS.replace(/ /g,"+")
    location.href = "emrweb02.pbl" + PageLocation;
    return;
  }
  
  // set presenting complaint comments
  var strg1 = trim(document.HiddenFields.Pres01.value);
  var strg2 = trim(document.HiddenFields.Pres02.value);
  var strg3 = trim(document.HiddenFields.Pres03.value);
  var strg4 = trim(document.HiddenFields.Pres04.value);
  var strg5 = trim(document.HiddenFields.Pres05.value);
  var strg6 = trim(document.HiddenFields.Pres06.value);
  document.UpdateForm.prcom001.value = strg1 + '\n' +
                            strg2 + '\n' +
                            strg3 + '\n' +
                            strg4 + '\n' +
                            strg5 + '\n' +
                            strg6;
  document.HiddenFields.prcom001.valu = UpdateForm.prcom001.value;

  // set Departure Status
  CheckDepartureStatus();

  // validate ICD10 code value
  if (document.UpdateForm.emvcd005 != undefined) {
    validateCode(6,UpdateForm.emvcd005,UpdateForm.drgdesc1);
  }
}

/*  var p = document.UpdateForm;

  if (p.ptcnddct.value == "1") {  // Default Comments with Discharge Text
    
    if (isWhitespace(p.emcomdis.value)) {  // Only if no existing Comments
      var text = "";

      if (p.hasfinal.value == "1") {  // Final Discharge Text exists
        text = document.getElementById('txtFinal').innerHTML;
      }
      else if (p.hasdraft.value == "1") {  // Draft Discharge Text exists
        text = document.getElementById('txtDraft').innerHTML;
      }

      p.emcomdis.value = GetHTMLPreTagContents(text);

      // Discharge Comments is more than 300 chars?...
      if (p.emcomdis.value.length > 300) {
        alert(p.emcomdis.title + " text is over the 300 character limit.\n" +
              "Please remove the extra characters to continue.");
        SetCaretPosition(p.emcomdis.id, "-1");  // set cursor at end of text
      }
    }
  }

  if (p.hasfinal.value == "0" && p.hasdraft.value == "0") {
    p.btnDischText.disabled = true;
  }
}*/

function setAuditField() {
  document.UpdateForm.updfield.value = "19";
  document.UpdateForm.reasonfc.value = "  ";
}

function CheckDepartureStatus() {
  var i = document.UpdateForm.emvis026.selectedIndex;
  var ind = trim(document.UpdateForm.emvis026.options[i].value.substr(14,4));
  var ind2 = trim(document.UpdateForm.emvis026.options[i].value.substr(4,1));

  if (ind==19 || ind==4 || ind==17 || ind==20 || ind==21) {
    document.getElementById('Departure').style.display = "";
    document.getElementById('Departure').innerHTML =
        document.getElementById('ShowDeparture').innerHTML;
  } 
  else {
     document.getElementById('Departure').style.display = "none";
     document.getElementById('Departure').innerHTML =
         document.getElementById('ShowDeparture').innerHTML;
     document.UpdateForm.emvis033.value = "";
     document.UpdateForm.name_emvis033n.value = "";
  }

  // Transfer to another hospital...
  if (ind=="19" || ind=="4" || ind=="17" || ind=="20" || ind=="21") {
    document.UpdateForm.emvis033.className = "Mandatory";
  }
  else {
    document.UpdateForm.emvis033.className = "Readonly";
  }

  //
  // 'Did Not Wait' status
  //
  if (document.UpdateForm.emvis026.value.substr(14,2)=="11") {
    if (document.UpdateForm.emvcd005!=undefined) {
      document.UpdateForm.emvcd005.className = "";  // ICD10
    }
  }
}

function ResetMandatory() {
  document.UpdateForm.emvis024.className = "";
  document.UpdateForm.emvis025.className = "";
  document.UpdateForm.emvis026.className = "";
  if (document.UpdateForm.emvcd005!=undefined) {
    document.UpdateForm.emvcd005.className = "";  // ICD10
  }
}

function SubmitForm() {
  var chckMandatory = validateMandatory(document.UpdateForm);
  if (chckMandatory) {
    ShowFdvWarning();  
    document.UpdateForm.submit(); 
  }
}

function CheckMandatory(element)
{
  if(element && isWhitespace(element.value))
  {
    element.focus();

    if(element.select)
      element.select();
    return false;
  }
  return true;
}

function SwitchAllMandatoryFieldsOn(arrayList)
{
  var notFound = -1;
  var obj = null;

  for(var i = 0; i < arrayList.length;i++)
  {
    obj = document.getElementById(arrayList[i]);

    if(obj.className.search(/Mandatory/) == notFound)
      if(obj.id=="emvis024") {
        obj.className = "PastDate Mandatory";
      } else {
        obj.className = " Mandatory";
      }
  }
}

function Discharge() {
  p=UpdateForm;

// Validate transfer hospital / current hospital
    var serverURL = "../cgi-bin/comweb80.pbl?reportno=73" +
                    "&valdcode="+p.hospval.value.replace(/ /g,"+") +
                    "&valdcod2="+p.emvis033.value.replace(/ /g,"+") +
                    "&valdcod3=DISCHARGE"
    var returnValue = RSExecute(serverURL);
    if (returnValue.status!=0){
       return false;
    }

  if ((document.UpdateForm.desttyp.value=="1")&&
      (document.UpdateForm.emvis026.value.substr(3,1)=="Z")){
    alert("Error Message\n"+
        "Admitted from a Corrective Institution and has been discharged "+
        "to home. Select OK to amend. ");
    return;
  }

//  if(document.UpdateForm.emvis096.value=="2"){
//    alert("Drug/Alcohol related must be yes or no");
//  }

  if(!CheckFutureDeparture(p,p.emvis024.value,p.emvis025)) {
    return;
  }

  if (!ValidReadyToDischargeDateTime()) {
    return;
  }

  var arrayMandatoryFields = ["emvis096","emvis024","emvis025","emvis026"];

  // scan through all the fields and switch the mandatory fields on
  // using the arrayMandatoryFields list
  for(var i = 0; i < arrayMandatoryFields.length;i++)
  {
    if( !CheckMandatory( document.getElementById( arrayMandatoryFields[i] ) ) )
    {
      SwitchAllMandatoryFieldsOn(arrayMandatoryFields);
      alert("Please populate all mandatory fields");
      return;
    }
  }
  if(document.getElementById('S01YV')) {
     Meth=document.getElementById('S01YV');
     if(Meth.className.match(/Mandatory/)) {
       if(isWhitespace(Meth.value.substr(4,3))) {
         catYV=trim(document.getElementById('d_catYV').value);
         alert( catYV + " is a required field.\nPlease enter it now." )
         Meth.focus();
         return;
       }
     }
  }
  if (document.UpdateForm.emvis026.value.substr(14,2) != "11") {
    if (document.UpdateForm.emvcd005!=undefined && 
        isWhitespace(document.UpdateForm.emvcd005.value)) {
//      alert("Either Discharge Diagnosis or ICD10 must be populated.");
      alert("ICD10 must be populated.");
        return false;
    }
  }

  if(document.getElementById('S04EB')) {
    if(document.getElementById('S04EB').className == "Mandatory") {
      if(isWhitespace(document.getElementById('S04EB').value.substr(4,7))) {
        alert(document.UpdateForm.d_catEB.value +
               "is a required field.\nPlease enter it now." )
        document.getElementById('S04EB').focus();
        return;
      }
    }
  }

  document.UpdateForm.formactn.value = "D2";
  document.UpdateForm.updttype.value = "DISCH";

  document.UpdateForm.redirect.value="emrweb02.pbl?reportno=01&template=017" +
    "&urnumber=" + document.UpdateForm.urnumber.value.replace(/ /g,"+") + 
    "&admissno=" + document.UpdateForm.admissno.value.replace(/ /g,"+");

  var i = document.UpdateForm.emvis026.selectedIndex;
  var ind = trim(document.UpdateForm.emvis026.options[i].value.substr(14,4));

  if (ind=="18" || ind=="2" || ind=="14" || ind=="15" || ind=="16"
       || ind=="22" || ind=="25" || ind=="26") {
    document.UpdateForm.emvis133.value = 1;
    document.UpdateForm.redirect.value="emrweb02.pbl?reportno=01&template=109" +
           "&urnumber=" + document.UpdateForm.urnumber.value.replace(/ /g,"+") +
           "&admissno=" + document.UpdateForm.admissno.value.replace(/ /g,"+");
  }
  else {
    if (parent.TogglePanel!=null) {
       var s=getTop().document.getElementById("search");
       if (s.style.display!='none'){
         document.UpdateForm.nextpage.value="18"
       } else {
         document.UpdateForm.nextpage.value="19"
       }
    }
    document.UpdateForm.emvis133.value = 0;
  }

  setMyHRConsent();

  SubmitForm();
}

function ValidReadyToDischargeDateTime() {
  // Compares the 'Ready To Discharge' date/time against arrival date/time
  // Returns: true/false for whether RTD date/time is after arrival date/time
  var arrDate = document.UpdateForm.d_arrdte.value;
  var arrTime = document.UpdateForm.d_arrtme.value;
  var rtdDate = document.UpdateForm.emvis071.value;
  var rtdTime = document.UpdateForm.emvis081.value;

  if ((rtdDate.length == 0) && (rtdTime.length == 0)) {
    // blank date & time
    return true;  // no checking required
  }

  if (rtdDate.length == 0) {
    // time only
    return true;  // no checking required
  }

  // convert date string to numeric value for comparison
  arrDate = SetDateYYYYMMDD(arrDate);
  rtdDate = SetDateYYYYMMDD(rtdDate);

  // check date first
  if (rtdDate < arrDate) {
    alert("'" + document.UpdateForm.emvis071.title + "' cannot be before Arrival date!");
    document.UpdateForm.emvis071.focus();
    return false;
  }
  else if (rtdDate == arrDate) {
    if (rtdTime.length > 0) {
      // check time also
      arrTime = trim(arrTime.replace(/:/g,"")) - 0;
      rtdTime = trim(rtdTime.replace(/:/g,"")) - 0;

      if (rtdTime < arrTime) {
        alert("'" + document.UpdateForm.emvis081.title + "' cannot be before Arrival time!");
        document.UpdateForm.emvis081.focus();
        return false;
      }
    }
  }

  return true;
}

function Update() {
  p=UpdateForm;
  if(!CheckFutureDeparture(p,p.emvis024.value,p.emvis025)) {
    return;
  }

  if (!ValidReadyToDischargeDateTime()) {
    return;
  }

  ResetMandatory();

  document.UpdateForm.formactn.value = "C2";  // update with other clinical info
  document.UpdateForm.updttype.value = "DOCTO";

  document.UpdateForm.redirect.value = "emrweb02.pbl?reportno=01&template=017" +
    "&urnumber=" + document.UpdateForm.urnumber.value.replace(/ /g,"+") +
    "&admissno=" + document.UpdateForm.admissno.value.replace(/ /g,"+");


  var i = document.UpdateForm.emvis026.selectedIndex;
  var ind = trim(document.UpdateForm.emvis026.options[i].value.substr(14,4));

  if (ind=="18" || ind=="2" || ind=="14" || ind=="15" || ind=="16"
       || ind=="22" || ind=="25" || ind=="26") {
    document.UpdateForm.emvis133.value = 1;
    document.UpdateForm.redirect.value="emrweb02.pbl?reportno=01&template=109" +
           "&urnumber=" + document.UpdateForm.urnumber.value.replace(/ /g,"+") +
           "&admissno=" + document.UpdateForm.admissno.value.replace(/ /g,"+");
  }
  else {
    if (parent.TogglePanel!=null) {
       var s=getTop().document.getElementById("search");
       if (s.style.display!='none'){ 
         document.UpdateForm.nextpage.value="18"
       } else {
         document.UpdateForm.nextpage.value="19"
       }
    }
    document.UpdateForm.emvis133.value = 0;
  }

  SubmitForm();
}
function ShowFdvWarning() {
  f = document.UpdateForm;
  if (f.pmsvx122 == undefined) {return;}

  i = f.pmsvx122.selectedIndex;
  if (i == -1) {return;}

  ind1 = f.pmsvx122.options[i].value.substr(3,1);
  if (ind1=='X') {
    alert("Have you completed the FDV paperwork?");
  }
}

function DiagnosisLink() {
  document.PatientLinks.target="_self"
  document.PatientLinks.reportno.value="02"
  document.PatientLinks.template.value="001"
  document.PatientLinks.action="emrweb06.pbl"
  document.PatientLinks.submit()
}

function CancelButton() {
  if (top.TogglePanel==null) {
    PatientLinkTo("emrweb02.pbl",1,17,0,0,0);
  } else {
    top.TogglePanel();
  }
}

function InitDepDateTime() {
  document.UpdateForm.emvis024.value = document.UpdateForm.d_depdte.value;
  document.UpdateForm.emvis025.value = document.UpdateForm.d_deptme.value;
}
function checkDept() {
  CheckDepartureStatus();
  deceasedIndicator = document.UpdateForm.emvis026.value.substr(3,1);
  checkDeceasedEMR(deceasedIndicator);
}
function assignICD10DIV() {
  if (!isWhitespace(document.getElementById('5_emvcd005').value)) {
    icd10_DIV.innerHTML = icd10_5_SPAN.innerHTML; 
    return;
  }
  if (!isWhitespace(document.getElementById('1_emvcd005').value)) {
    icd10_DIV.innerHTML = icd10_1_SPAN.innerHTML;
    return;
  }
}
function ValDate(dateField,timeField) {
  if (!checkDate(dateField,dateField.title)) {
    return;
  }

  if (!isWhitespace(timeField.value)) {
    CheckFutureTime(UpdateForm,dateField.value,timeField);

    dateField.onblur = null;  // clear to prevent infinite loop with alerts

    // Restore the default onblur event handling functions
    window.setTimeout(function () {
      dateField.onblur = function() {
        ValDate(dateField,timeField);
      }
    },100);
  }

  DisplayBreach();
}

function ValTime(dateField,timeField) {
  if (!checkTime(timeField,timeField.title)) {
    return;
  }

  CheckFutureTime(UpdateForm,dateField.value,timeField);

  timeField.onblur = null;  // clear to prevent infinite loop with alerts

  // Restore the default onblur event handling functions
  window.setTimeout(function () {
    timeField.onblur = function() {
      ValTime(dateField,timeField);
    }
  },100);

  DisplayBreach();
}

function LookupCleanup() {
 breach=document.getElementById(window.Code.id);
 for (var i=0 ; i<breach.length; i++) {
  if (trim(breach.options[i].innerText) == trim(window.Name.value)) {
       breach.selectedIndex=i 
  } 
 }
}

function displayReferralFields() {
  if (document.UpdateForm.stfrefin.value != "1") {
    emvis174TitleDIV.innerHTML = "";
    emvis175TitleDIV.innerHTML = "";
    emvis176TitleDIV.innerHTML = "";
    emvis174FieldDIV.innerHTML = "";
    emvis175FieldDIV.innerHTML = "";
    emvis176FieldDIV.innerHTML = "";
    return;
  }
  displaycatRF();
}

function displaycatRF() {
    if (document.UpdateForm.emvis174.value.substr(3,1) == "N") {
      emvis175TitleDIV.innerHTML = emvis175TitleSPAN.innerHTML;
      emvis175FieldDIV.innerHTML = emvis175FieldSPAN.innerHTML;
    } else {
      emvis175TitleDIV.innerHTML = "";
      emvis175FieldDIV.innerHTML = "";
    }
}

/*
function CopyDischText() {
  var p = document.UpdateForm;
  var text = "";

  if (p.hasfinal.value == "1") {  // Final Discharge Text exists
    text = document.getElementById('txtFinal').innerHTML;
  }
  else if (p.hasdraft.value == "1") {  // Draft Discharge Text exists
    text = document.getElementById('txtDraft').innerHTML;
  }

  InsertTextAtCursor('emcomdis',GetHTMLPreTagContents(text));
}
*/

function EditAdviceText() {
  document.PatientLinks.reportno.value="06"
  document.PatientLinks.template.value="007"
  document.PatientLinks.action="cliweb06.pbl"

  Width = 900;
  Height = 300;
  Left = (document.body.clientWidth-Width)/2;
  Top = (document.body.clientHeight-Height)/2;

  DFrameSubmit(document.PatientLinks,Top,Left,Width,Height);
}

function CheckLimits(TxtFld) {
  if (!TxtFld || isWhitespace(TxtFld.value))
    return;

  if (!LimitText(TxtFld,100,300)) {  // max 100 rows, 300 chars
    SetCaretPosition(TxtFld.id, "-1");  // set cursor at end of text
  }
}

function initCustom() {
  AttachEventHandler(document.UpdateForm.emvcd005, "change", styleMethAffected); // ICD10 code
  AttachEventHandler(document.UpdateForm.emvcd005, "focus",  styleMethAffected); // ICD10 code
  AttachEventHandler(document.UpdateForm.emvis096, "change", styleMethAffected); // Alcohol / Drug Related
  AttachEventHandler(document.UpdateForm.emvis171, "change", checkDrugAlcohol);  // Meth Related

  styleMethAffected();
}

// Set drug/alcohol related to yes when meth related is 'Likely Yes'
function checkDrugAlcohol() {
  methRelated = document.UpdateForm.emvis171;
  alcoholDrugRelated = document.UpdateForm.emvis096;

  if ( methRelated.value && methRelated.value.match(/^AAA/) ) {
    alcoholDrugRelated.value = '1';
  } 
}

function styleMethAffected() {
  presentingComplaint = document.UpdateForm.emvis060.value;
  alcoholDrugRelated = document.UpdateForm.emvis096.value;
  icdCode = document.UpdateForm.emvcd005.value;

  if ( alcoholDrugRelated == "1" || isMethDiagnosis(icdCode) ||
       (presentingComplaint && isMethComplaint(presentingComplaint.slice(0,3)))
    ) {
    makeMandatory(document.getElementsByName("emvis171"));
  } else {
    makeOptional(document.getElementsByName("emvis171"));
  }
}

//TSK 0894483 - Check Indicator 10 to set Depature Means as mandatory 
function checkDepartureStatusInd(indicator){
  var val = indicator.value.substring(12,13);
  if(val == 'M'){
    document.getElementById('pmsvx112').className="Mandatory";
  } else {
    document.getElementById('pmsvx112').className="";
  }
}
</script>
</head>
%START.OF.PAGE
<body onload="PageLoad(event);InitDepDateTime();assignICD10DIV();
               DisplayBreach(); displayReferralFields(); MandatoryMeth();">
<div id=PatientHeading></div>
<script type="text/javascript">
PatientURN="%EMRWEB02.01.003";
PatientVIS="%EMRWEB02.01.081";
PatientNAM="%EMRWEB02.01.002";
PatientSTA="%EMRWEB02.01.086.078";
PatientALT="%EMRWEB02.01.084";
PatientSEX="%EMRWEB02.01.019";
PatSEXcode="%EMRWEB02.01.599.012";
PatientDOB="%EMRWEB02.01.020";
PatientAGE="%EMRWEB02.01.021";
PatientLOC="%EMRWEB02.01.083";
PatientPRI="%EMRWEB02.01.086.066.1";
PatientUNT="%EMRWEB02.01.066.0";
PatientIND="%EMRWEB02.01.086.091";
GpCOD="%EMRWEB02.01.086.084.001";
GpNAM="%EMRWEB02.01.086.084.081";
GpPRAC="%EMRWEB02.01.086.085.001";
GpPRACCNT="%EMRWEB02.01.086.085.002";
GpPRACNAM="%EMRWEB02.01.086.085.005";
PatientARR="%EMRWEB02.01.101.0 %EMRWEB02.01.102";
PatientSEE="%EMRWEB02.01.130.0 %EMRWEB02.01.131";
PatientTRI="%EMRWEB02.01.103.3";
PatientECLC="%EMRWEB02.01.484.1";
PatientCLH="%STANDARD.01.017.CL";
PatientEHFT="%EMRWEB02.01.485";
InsertEmergencyHeader()
</script>
<div id=PatientMenu></div>
<div id=PageBodySection>
<table width=100% border=0 cellspacing=0 cellpadding=1>
<tr><td class=HeadingCell align=center>
    Emergency Patient Discharge </td></tr>
</table>

<form name=UpdateForm action=emrweb02.pbl method=post style="margin:0">
<input type=hidden name=reportno value="01">
<input type=hidden name=template value="101">
<input type=hidden name=formactn>
<input type=hidden name=updttype>
<input type=hidden name=emvis133>
<input type=hidden name=updfield>
<input type=hidden name=reasonfc>
<input type=hidden name=admissno value="%EMRWEB02.01.081">
<input type=hidden name=updateky value="%EMRWEB02.01.404">
<input type=hidden name=urnumber value="%EMRWEB02.01.003">
<input type=hidden name=nextpage value="2">
<input type=hidden name=redirect value="">
<input type=hidden name=waittime value="%EMRWEB02.01.701">
<input type=hidden name=loadflag >
<input type=hidden name=reloadfg value="%EMRWEB02.01.446">
<input type=hidden name=efrbedty value="%EMRWEB02.01.506">
<input type=hidden name=efrdisch value="%EMRWEB02.01.509">
<input type=hidden name=efradmis value="%EMRWEB02.01.508">
<input type=hidden name=attdtype value="%EMRWEB02.01.213.3">
<input type=hidden name=depttime value="%EMRWEB02.01.125">
<input type=hidden name=deptdate value="%EMRWEB02.01.124.0">
<input type=hidden name=pmpxi067 value="%EMRWEB02.01.667.0">
<input type=hidden name=mapvflag value="0">
<input type=hidden name=ptcnhdps value="%STANDARD.01.025.080.250.1.1">
<input type=hidden name=setemrcm value="1">
<input type=hidden name=currdate value="%STANDARD.01.013">
<input type=hidden name=currtime value="">
<input type=hidden name=d_arrdte value="%EMRWEB02.01.101.0">
<input type=hidden name=d_arrtme value="%EMRWEB02.01.102">
<input type=hidden name=d_duration value="">
<input type=hidden name=d_depdte value="%EMRWEB02.01.124.0">
<input type=hidden name=d_deptme value="%EMRWEB02.01.125">
<input type=hidden name=d_nowdte value="%STANDARD.01.015">
<input type=hidden name=d_nowtme value="%STANDARD.01.016">
<input type=hidden name=hospval  value="%EMRWEB02.01.525.1">
<input type=hidden name=desttyp  value="%EMRWEB02.01.538">
<input type=hidden name=setemrcd value="1">
<input type=hidden name=wahindic value="1">
<input type=hidden name=d_catEB value="%STANDARD.01.035.EB">
<input type=hidden name=dummy value="">
<input type=hidden name=stfrefin id="stfrefin" value="%EMRWEB02.01.919">
<input type=hidden name=ptcnddct value="%STANDARD.01.025.122.010.0.1">
<input type=hidden name=hasdraft value="%EMRWEB02.01.921.014">
<input type=hidden name=hasfinal value="%EMRWEB02.01.921.015">
<input type=hidden name=d_methdiag value="%EMRWEB02.01.923">
<input type=hidden name=d_methdiag value="%EMRWEB02.01.923">
<input type=hidden name=fdv_diag value="%EMRWEB02.01.958">
<input type=hidden name="d_catYV" id="d_catYV" value="%STANDARD.01.017.YV">

<table width=95% align=center border=0 cellspacing=0 cellpadding=1>
<tr valign=top><td>
<table width=95% align=center border=0 cellspacing=0 cellpadding=1>
<tr valign=top>
  <td class=DataLabel width=10%>Presenting Complaint</td>
  <td width=25%>
    <input type=text name=emvis060 max=3 size=3 value="%EMRWEB02.01.220.1" 
      readonly class=Readonly>
    <input type=text name=v060name value="%EMRWEB02.01.220.0" 
      readonly class=Readonly>
  </td>
  <td colspan=2>
    <textarea name=prcom001 cols=40 rows=3 readonly class=Readonly
      title="Presenting Complaint Comments">%EMRWEB02.01.104</textarea>
  </td>
</tr>
</table>

<table width=95% align=center border=0 cellspacing=0 cellpadding=1>
<tr>
  <td class=DataLabel width=10%>Departure Date</td>
  <td width=25%>
    <input type=text size=12 name="emvis024" id="emvis024" tabindex=1
      class="PastDate" title="Departure Date" value=""
      onblur="ValDate(UpdateForm.emvis024,UpdateForm.emvis025);">
    <img notab src=../images/DateLookup.gif class=Icon
     onclick="DateLookupFrame(document.UpdateForm.emvis024);">
    <input type=text name="emvis025" id="emvis025" tabindex=2
      size=6 value="" title="Time"
      onblur="ValTime(UpdateForm.emvis024,UpdateForm.emvis025);">
    <img notab src=../images/DateTimeStamp.gif class=Icon
      onclick="SetCurrentDateTime(document.UpdateForm.emvis024,
               document.UpdateForm.emvis025);">
    <img notab src=../images/TimeLookup.gif class=Icon
      onclick="TimeLookupFrame(document.UpdateForm.emvis025);">
     <span id="DelayText" class="Bold Red"></span>
  </td>
  <td class=DataLabel width=10%>ED Ready to Discharge</td>
  <td width=20%>
    <input type="text"  title="ED Ready to Discharge Date" size="12" tabindex=3
      id="emvis071" name="emvis071" value="%EMRWEB02.01.231.0"/>
    <img notab src=../images/DateLookup.gif class=Icon 
      onclick="DateLookupFrame(document.UpdateForm.emvis071);">
    <input type="text" title="ED Ready to Discharge Time" tabindex=4
      size="6" id="emvis081" name="emvis081" value="%EMRWEB02.01.241"/>
    <img notab src=../images/DateTimeStamp.gif class=Icon
      onclick="SetCurrentDateTime(document.UpdateForm.emvis071,
      document.UpdateForm.emvis081);">
    <img notab src=../images/TimeLookup.gif class=Icon
      onclick="TimeLookupFrame(document.UpdateForm.emvis081);">
  </td>
  <td width=35%>&nbsp;</td>
</tr>
<tr>
  <td class=DataLabel>Departure Status</td>
  <td>
    <select name="emvis026" id="emvis026" tabindex=5 title="Departure Status"
      onchange="checkDept();DisplayBreach();checkDepartureStatusInd(this);">
      <option> </option>
      %EMRWEB02.01.126.2
    </select>
  </td>
  <td class=DataLabel>Referred to on Departure</td>
  <td>
    <select name="emvis051" id="emvis051" tabindex=6 
      title="Referred to on Departure">
      <option> </option>
      %EMRWEB02.01.211.2
    </select>
  </td>
  <td>&nbsp;</td>
</tr>
</table>

<div id=Departure></div>

<table width=95% align=center border=0 cellspacing=0 cellpadding=1>
<tr>
  <td class=DataLabel width=10%>Relative Contacted</td>
  <td width=25%>
    <select name="emrcl035" id="emrcl035" tabindex=8>
      <option></option>
      %EMRWEB02.01.850
    </select>&nbsp;Time&nbsp;
    <input type="text" name="emrcl037" id="emrcl037" tabindex=9
      title="Relative Contact Time" size="6" value="%EMRWEB02.01.837"/>
    <img notab src=../images/DateTimeStamp.gif class=Icon
    onclick="SetCurrentDateTime(null,UpdateForm.emrcl037);">
  </td>
  <td class=DataLabel width=10%>Departure Means</td>
  <td width=20%> 
    <select name="pmsvx112" id="pmsvx112" tabindex=10 title="Departure Means">
      <option></option>
      %EMRWEB02.01.530
    </select>
  </td>
  <td width=35%>&nbsp;</td>
</tr>
<tr>
  <td>&nbsp;</td>
  <td>
    <input type="text" name="emrcl036" id="emrcl036" size="40" maxlength="50" 
      tabindex=11 value="%EMRWEB02.01.836"/>
  </td>
  <td class=DataLabel>%STANDARD.01.017.eb </td>
  <td><select class="SelectBig" name=emvis050 title="%STANDARD.01.017.eb ">
        <option></option>
         %EMRWEB02.01.210.2
      </select>
  </td>
  <td>&nbsp;</td>
</tr>

<tr>
     <td class=DataLabel>
       <div id="emvis174TitleDIV">
         %STANDARD.01.017.RF
       </div>
     </td>
     <td>
       <div id="emvis174FieldDIV">
       <select name="emvis174" tabindex=38 class="SelectMed"
        title="%STANDARD.01.017.RF" onchange="displaycatRF();">
         <option></option>
         %EMRWEB02.01.293.2
         </select>
       </div>
     </td>
     <td class=DataLabel>
       <div id="emvis176TitleDIV">
         Referral Date
       </div>
     </td>
     <td>
       <div id="emvis176FieldDIV">
         <input type=text size=12 name=emvis176 title="Referral Date"
          value="%EMRWEB02.01.295" tabindex=41
          onblur="checkDateSV(this,'Valid to');" >
         <img notab src="../images/DateLookup.gif" class="Icon"
           alt="Show Calendar" date="UpdateForm.emvis176">
       </div>
     </td>
</tr>

<tr>
     <td class=DataLabel>
       <div id="emvis175TitleDIV">
         Referral Period (Months)
       </div>
     </td>
     <td>
       <div id="emvis175FieldDIV">
         <input type=text name=emvis175 title="Referral Period (Months)"
          class=Number size=15 maxlength=2 min=1 max=98
          value="%EMRWEB02.01.294">
       </div>
     </td>
     <td class=DataLabel></td>
     <td></td>
  <td>&nbsp;</td>
 </tr>

</table>

<table width=95% align=center border=0 cellspacing=0 cellpadding=1>
<tr>
  <td class=DataLabel width=10%>ICD10</td>
  <td width=25%>
    <div id=icd10_DIV>
    <input type=text name=emvcd005 title="ICD10" size=10 id="emvcd005"
      maxlength=9 tabindex=12 value="%EMRWEB02.01.515"
      onblur="validateCode(6,UpdateForm.emvcd005,UpdateForm.drgdesc1);
              MethDiag();">
    <input type=text size=30 name=drgdesc1 title="ICD Description" readonly>
    <img src=../images/SearchIcon.gif alt="Disease Search" class=Icon
      onclick="Icd10DisSearchFrame(UpdateForm.emvcd005,
                                   UpdateForm.drgdesc1,
                                   UpdateForm.drgdesc2);">
    <img src=../images/erase.gif class=Icon
      onclick="clrFields(UpdateForm.emvcd005,UpdateForm.drgdesc1);
               MethDiag();">
    </div>
  </td>
  <td width=10%>&nbsp;</td>
  <td width=20%>&nbsp;</td>
  <td width=35%>&nbsp;</td>
</tr>

<tr><td class=DataLabel>Drug / Alcohol Related</td>
    <td>
       <select name=emvis096 title="Drug / Alcohol Related" tabindex=12
         id="emvis096" onchange="MandatoryMeth();">
        <option value=""></option>
        <option value="0">No</option>
        <option value="1">Yes</option>
       </select>
    </td>
    <td>FDV Related?</td>
    <td>
       <select name=pmsvx122 id=pmsvx122 title="FDV Related?"
        class="Select200" tabindex=12 onchange="setAuditField();">
        <option value=""></option>
         %EMRWEB02.01.599.008.9.5
       </select>
    </td>
</tr>

<tr><td class=DataLabel>%STANDARD.01.017.YV</td>
    <td class=DataField>%EMRWEB02.01.528.01.YV.9.1</td>
    <td>&nbsp;</td>
    <td>&nbsp;</td>
    <td>&nbsp;</td>
</tr>

<tr>
  <td class=DataLabel id=MyHRConsentTitle></td>
  <td><select name=pmsvx125 id=pmsvx125 tabindex=53 class=DataField
              title="Consent upload to My Health Record?">
           <option value=" "></option>
           <option value="0">No</option>
           <option value="1">Yes</option>
      </select>&nbsp;(<a href="javascript:patientMyhrConsentForm();">form</a>)
  </td>
  <td>&nbsp;</td>
  <td>&nbsp;</td>
  <td>&nbsp;</td>
</tr>
</table>

<table width=95% align=center border=0 cellspacing=0 cellpadding=1>
<tr>
  <td valign=top width=10%>Comments<br>
    <!--<input type=button class="Bigbutton" value="Copy Disch. Text"
       name=btnDischText id=btnDischText title="Copy Discharge Text"
       onclick="CopyDischText();">-->
  </td>
  <td colspan=4>
    <textarea cols=100 rows=3 name=emcomdis id=emcomdis tabindex=13 wrap=hard
     title="Discharge Comments"
     onblur="CheckLimits(this);">%EMRWEB02.01.434.019</textarea>
  </td>
</tr>

<tr>
  <td valign=top>Advice to Patient<br>
    <input type=button class="button" value="Edit"
       name=btnEditATP id=btnEditATP title="Edit Advice to Patient"
       onclick="EditAdviceText();">
  </td>
  <td colspan=4>
    <textarea name=editadvc cols=100 rows=3 readonly
     wrap=hard>%EMRWEB02.01.922.016.0.1</textarea>
  </td>
</tr>

</table>

<div id=Diagnosis></div>
<div id=Delay></div>

<table width=95% align=center border=0 cellspacing=0 cellpadding=1>
<tr>
  <td colspan=4 align=center><br>
    <input type=button value="Discharge" class="button" tabindex=17
      id=emrweb02Disc name=emrweb02Disc 
      onclick="tempDisable(this,5);Discharge();">
    <input type="button" value="Update" class="button" tabindex=18
      id=emrweb02Updt name=emrweb02Updt onclick="Update();">
    <input type=button value="Cancel" class="button" tabindex=19
      id=emrweb02Canc name=emrweb02Canc onclick='CancelButton();'>
  </td>
</tr>
</table>

  </td>
</tr>
</table>
</form>

<span id=ShowDeparture style="display:none;">
<table width=95% align=center border=0 cellspacing=0 cellpadding=1>
<tr>
  <td class=DataLabel width=10%>Discharge to</td>
  <td>
    <input type=text size=10 maxlength=6 name=emvis033 tabindex=7
      title="Transfer Destination" value="%EMRWEB02.01.133.1"
      onchange="validateCode(9,UpdateForm.emvis033,UpdateForm.name_emvis033n);">
    <input type=text size=30 name=name_emvis033n readonly
      value="%EMRWEB02.01.133.0">
    <img class=Icon src=../images/SearchIcon.gif
      onclick="TransferSourceFrame(UpdateForm.emvis033,
                                   UpdateForm.name_emvis033n);">
    <img class=Icon src=../images/erase.gif
      onclick="clrFields(UpdateForm.emvis033,UpdateForm.name_emvis033n);">
  </td>
</tr>
</table>
</span>

<span id=icd10_5_SPAN style="display:none;">
    <input type=hidden name="5_emvcd005" 
     id="5_emvcd005" value="%EMRWEB02.01.913. 5.1">
    <input type=hidden name=emvcd005 value="%EMRWEB02.01.913. 5.1">
    <input type=text size=30 name=drgdesc1 title="ICD Description" readonly
     class=Readonly value="%EMRWEB02.01.913. 5.2">
</span>

<span id=icd10_1_SPAN style="display:none;">
    <input type=hidden name="1_emvcd005" 
     id="1_emvcd005" value="%EMRWEB02.01.913. 1.1">
    <input type=text name=emvcd005
      title="ICD10" size=10 maxlength=9
      tabindex=12 value="%EMRWEB02.01.913. 1.1"
      onblur="validateCode(6,UpdateForm.emvcd005,UpdateForm.drgdesc1);
              MethDiag();">
    <input type=text size=30 name=drgdesc1 title="ICD Description" readonly
     class=Readonly value="%EMRWEB02.01.913. 1.2">
    <img src=../images/SearchIcon.gif alt="Disease Search" class=Icon
      onclick="Icd10DisSearchFrame(UpdateForm.emvcd005,
                                   UpdateForm.drgdesc1,
                                   UpdateForm.drgdesc2);">
    <img src=../images/erase.gif class=Icon
      onclick="clrFields(UpdateForm.emvcd005,UpdateForm.drgdesc1);
               MethDiag()">
</span>

<span id="ShowDelay" style="display:none;">
<table width=95% align=center border=0 cellspacing=0 cellpadding=1>
<tr><td class="DataLabel" width=10%>%STANDARD.01.035.EB</td>
    <td class="DataField">%EMRWEB02.01.528.04.EB.4
    <img src=../images/SelectLink.gif class="Icon"
     onclick="LookupPage(S04EB,UpdateForm.dummy,'Lookup_EDBreach_000',S04EB);">
    </td>
</tr>
<tr><td class="DataLabel">%STANDARD.01.035.EB</td>
    <td class="DataField">%EMRWEB02.01.528.05.EB.4
    <img src=../images/SelectLink.gif class="Icon"
     onclick="LookupPage(S05EB,UpdateForm.dummy,'Lookup_EDBreach_000',S05EB);">
    </td></tr>
<tr><td class="DataLabel">%STANDARD.01.035.EB</td>
    <td class="DataField">%EMRWEB02.01.528.06.EB.4
    <img src=../images/SelectLink.gif class="Icon"
     onclick="LookupPage(S06EB,UpdateForm.dummy,'Lookup_EDBreach_000',S06EB);">
    </td></tr>
</table>
</span>

<span id="NoDelay" style="display:none;">
  <input type="hidden" name="vscdcatg" value="04EB">
  <input type="hidden" name="vscdcode" value="04EB   ">
  <input type="hidden" name="vscdcatg" value="05EB">
  <input type="hidden" name="vscdcode" value="05EB   ">
  <input type="hidden" name="vscdcatg" value="06EB">
  <input type="hidden" name="vscdcode" value="06EB   " >
</span>

 <span id="emvis175TitleSPAN" style="display:none">
          Referral Period (Months)
 </span>
 <span id="emvis175FieldSPAN" style="display:none">
          <input type=text name=emvis175 title="Referral Period (Months)"
           class=Number size=15 maxlength=2 min=1 max=98
           value="%EMRWEB02.01.294">
 </span>
 <span id="emvis020TitleSPAN" style="display:none">
 Referring HCP
 </span>

<span id=txtDraft style="display:none;white-space:pre-wrap">
<pre>
%EMRWEB02.01.922.014.0.1
</pre>
</span>

<span id=txtFinal style="display:none;white-space:pre-wrap">
<pre>
%EMRWEB02.01.922.015.0.1
</pre>
</span>

<form name=HiddenFields method=get style="margin:0">
<input type=hidden name=DischargeComplete value="%EMRWEB02.01.147">
<input type=hidden name=HospitalAdmission value="%EMRWEB02.01.148">
<input type=hidden name=Pres01 value="%EMRWEB02.01.104">
<input type=hidden name=Pres02 value="%EMRWEB02.01.105">
<input type=hidden name=Pres03 value="%EMRWEB02.01.174">
<input type=hidden name=Pres04 value="%EMRWEB02.01.175">
<input type=hidden name=Pres05 value="%EMRWEB02.01.176">
<input type=hidden name=Pres06 value="%EMRWEB02.01.177">
<input type=hidden name=PrimaryDiagnosis value="%EMRWEB02.01.187">
<input type=hidden name=PrimaryDiagnFtxt value="%EMRWEB02.01.195">
<input type=hidden name=DischDiagTxt value="%EMRWEB02.01.137">
<input type=hidden name=prcom001>
</form>

<form name=PatientLinks method=get style="margin:0">
<input type=hidden name=reportno value=1>
<input type=hidden name=template value=004>
<input type=hidden name=regexstm value=102>
<input type=hidden name=newstand value=1>
<input type=hidden name=urnumber value="%EMRWEB02.01.003">
<input type=hidden name=admissno value="%EMRWEB02.01.081">
<input type=hidden name=emrgflag value="Y">
<input type=hidden name=nextpage value="4">
<input type=hidden name=MenuType value="11">
<input type=hidden name=webuseid value="%STANDARD.01.008">
</form>

<script type="text/javascript">
if (document.UpdateForm.deptdate.value == "") {
  document.UpdateForm.deptdate.value="%EMRWEB02.01.233.0";
  document.UpdateForm.depttime.value="%EMRWEB02.01.243";
}
  DrugAlcohol="%EMRWEB02.01.256";
  if(DrugAlcohol=="No") {
    document.UpdateForm.emvis096.selectedIndex=1;
  } else {
      if(DrugAlcohol=="Yes") {
        document.UpdateForm.emvis096.selectedIndex=2;
    } else {
        document.UpdateForm.emvis096.selectedIndex=0;
    }   
  }

if(document.getElementById('S01YV')) {
  document.getElementById('S01YV').tabIndex="12";
  document.getElementById('S01YV').onchange=MandatoryMeth;
}
function MethDiag() {
 p=document.UpdateForm;
 MethDiagnosis(p.admissno,"2",p.emvcd005,p.d_methdiag);
 MandatoryMeth();
}
function MandatoryMeth() {
  if(!document.getElementById('S01YV')) {
    return;
  }
  if(document.UpdateForm.emvis096.value=="1" || 
    document.UpdateForm.d_methdiag.value=="1") {
    document.getElementById('S01YV').className="Mandatory";
  } else {
   document.getElementById('S01YV').className="";
  }
  if(document.getElementById('S01YV').value.substr(7,1)=="2") {
    document.UpdateForm.emvis096.selectedIndex=2;
    document.getElementById('S01YV').className="Mandatory";
  }
}

// Convert a blank visit-level consent to the implied consent from patient level
function setMyHRConsent() {
  patientConsentMyHR = trim("%EMRWEB02.01.699.046");
  visitConsentMyHR   = trim("%EMRWEB02.01.599.001"); 
  currentConsentMyHR = trim(document.getElementById("pmsvx125").value);

  if (visitConsentMyHR=="" && currentConsentMyHR == "") {
      document.getElementById("pmsvx125").value = 
          patientConsentMyHR; 
  } else if (currentConsentMyHR == "") {
      document.getElementById("pmsvx125").value = 
          visitConsentMyHR; 
  }
}

document.getElementById("MyHRConsentTitle").innerHTML = ScreenLabelMyHRConsent;
document.getElementById("pmsvx125").title = ScreenLabelMyHRConsent;
document.getElementById("pmsvx125").value = trim("%EMRWEB02.01.599.001");

var ptage = PatientAGE.substring(0,PatientAGE.length-4);
var ptsx = trim(PatSEXcode);
var ptfdv = UpdateForm.fdv_diag.value;
var pfdv = UpdateForm.pmsvx122;

if(ptsx == "F" && ptage>15) {
   if(pfdv.value[4] == "B") {
     pfdv.value = '';
     pfdv.className="Mandatory";
   }
   if(pfdv.selectedIndex == 0  && ptfdv == 'Yes') {
    pfdv.value = '';
    pfdv.className="Mandatory";
   }
}
</script>
