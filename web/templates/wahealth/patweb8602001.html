<meta name="TemplateVersion" content="V12.01.00">
<meta name="TemplateHome" content="wahealth">
<meta name="HelpFileName" content="NoContextSet.html">
<meta name="CrossBrowser" content="true">
<script type="text/javascript" src=../js/patweb86.js></script>
<script type="text/javascript" src=../js/TableSort.js></script>
<script type="text/javascript">
PathUncodedDischargeList=GetContentCookie("UncodedDischargeList");
if(PathUncodedDischargeList!=="unknown")
{
  ExpireCookiePath("UncodedDischargeList");
  location.href=PathUncodedDischargeList;
}
// ------------------------------------------------------------
// Columns Available
//  0 - HTML Link    
//  1 - Patient Name
//  2 - UR          
//  3 - Adm No          
//  4 - Adm Date
//  5 - Discharge Date
//  6 - Discharge Unit
//  7 - Discharge Ward
//  8 - LOS
//  9 - MR Location
// 10 - Terminal Digit UR
// 11 - Deceased & Alert Indicators
// 12 - Adm Date (ccyymmdd)
// 13 - Doctors Name
// 14 - Fund (code)
// 15 - Alert Link
// 16 - Alert Icon   
// 17 - Patient Folder image
// 18 - Theatre Complete
// ------------------------------------------------------------
 function InitTable(TableView) { 
    switch (TableView) {
    case 0: {
      t = new Table(1,0,1,"100%","center");
      t.addColumn("Patient","ImageText",1,1,"left","PatientFolder","0",180,"17","","",28)
      t.addColumn("UR No.","String",2,10,"center","","",50)

      if (document.SelectPeriod.mrcnepsc.value=="1") {
       t.addColumn("Adm. No.","String",24,24,"center","","",50)
      } else {
       t.addColumn("Adm. No.","String",3,3,"center","","",50)
      }

      t.addColumn("Discharge Summary","String",27,27,"center","","",70)
      t.addColumn("Care Type","String",25,25,"center","","",70)

      if (document.SelectPeriod.mrcnepsc.value=="1") {
       t.addColumn("Admission Date","String",20,21,"center","","",70)
       t.addColumn("Discharge Date","String",22,23,"center","","",70)
      } else {
       t.addColumn("Admission Date","String",4,12,"center","","",70)
       t.addColumn("Discharge Date","String",5,5,"center","","",70)
      }

      t.addColumn("Disc. Unit","String",6,6,"center","","",40)
      t.addColumn("Disc. Ward","String",7,7,"center","","",40)
      t.addColumn("Length of Stay","String",8,8,"center","","",40)
      t.addColumn("Current Location","String",9,9,"left","","",90)
      t.addColumn("Theatre Complete","String",18,18,"center","","",40)

      if (document.SelectPeriod.showflagV.value=="1") {
        LoadTableData();
      }
      else {
        AddTableRows()
        TableOutput(2,1);
      } 

      HideWaitScreen();
      break;
    }
  }
}


function LoadTableData() {
  // Add Rows to Table (Output from Web Server)
  AddTableRows()
  TableOutput(2,1);    // Order Column,Asc Dsc
  checkDischargeRedirect();
}

function SelectDateFrame() { //This is a customised version for this template!!
  DFrameStart()
  document.getElementById('PopUpFrame').src="../lookups/SelectDateFrame.html"
  if (document.all.PatientMenu == undefined) {
    PopUpScreen.style.top=document.body.scrollTop+70 
    PopUpScreen.style.left=document.body.clientWidth-205
  }
  PopUpScreen.style.width=205
  PopUpScreen.style.height=245
  PopUpScreen.style.display=""
}
function unCodedDischargeElementPath()
{
  var PathValue="patweb86.pbl?";
      PathValue+="reportno="+SelectPeriod.reportno.value;
      PathValue+="&template="+SelectPeriod.template.value;
      PathValue+="&viewtype="+SelectPeriod.viewtype.value;
      PathValue+="&uncodkey="+SelectPeriod.uncodkey.value;
      PathValue+="&dummy1="+SelectPeriod.dummy1.value;
      PathValue+="&dummy2="+SelectPeriod.dummy2.value;
      PathValue+="&dummy3="+SelectPeriod.dummy3.value;
      PathValue+="&dummy4="+SelectPeriod.dummy4.value;
      PathValue+="&ibcnmhos="+SelectPeriod.ibcnmhos.value;
      PathValue+="&mrcnepsc="+SelectPeriod.mrcnepsc.value;
  if(document.getElementById('vyearmth'))
    {   PathValue+="&vyearmth="+SelectPeriod.vyearmth.value; }
  else{ PathValue+="&lastdate="+SelectPeriod.lastdate.value;}
      PathValue+="&unitcode="+SelectPeriod.unitcode.value;
      PathValue+="&claimcod="+SelectPeriod.claimcod.value;
      PathValue+="&admistyp="+SelectPeriod.admistyp.value;
      PathValue+="&mrlocncd="+SelectPeriod.mrlocncd.value;
      PathValue+="&wardcode="+SelectPeriod.wardcode.value;
      PathValue+="&curradmn="+SelectPeriod.curradmn.value;
      PathValue+="&showflag="+"1";
      SetCookie("UncodedDischargeList",PathValue);
}
function checkDischargeRedirect(){
     var uncodDisChrgElement = document.getElementsByClassName('uncodDisChrg');
     if(uncodDisChrgElement.length>0){
      if (document.addEventListener) {
       for (i = 0; i < uncodDisChrgElement.length; ++i) {
         var unCC= uncodDisChrgElement[i].children[0];
         unCC.addEventListener("click",unCodedDischargeElementPath, false);
       }
      }
      else if(document.attachEvent){
        for (i = 0; i < uncodDisChrgElement.length; ++i) {
          var unCC= uncodDisChrgElement[i].children[0];
          unCC.attachEvent("onclick",unCodedDischargeElementPath);
        }
      }
     }
}

function PressGoButton(){
 document.SelectPeriod.showflag.value="1";
 document.SelectPeriod.submit();
}
function SelectNextMonth() 
{
  document.SelectPeriod.vyearmth.selectedIndex++;
}
function SelectLastMonth() 
{
  document.SelectPeriod.vyearmth.selectedIndex--;
}
function SelectNextWeek() 
{
  document.SelectPeriod.lastdate.selectedIndex++;
}
function SelectLastWeek() 
{
  document.SelectPeriod.lastdate.selectedIndex--;
}
function SelectNextDay() 
{
var num = document.SelectPeriod.lastdate.selectedIndex;
  var el = document.SelectPeriod.lastdate;

  if(typeof el[num+1] !='undefined' && el[num+1] != null) {
   document.SelectPeriod.lastdate.selectedIndex++;
  }else {
    var year = el[num].value.substring(0,4);
    var month = el[num].value.substring(4,6);
    var day = "01";
     
    month = month % 12;
    month++;

    if(month == 1) {
      year++;
    }

    if(month.toString().replace(/ /g,'').length == 1) {
       month = "0"+month;
    }
    var tmp = GetMonthName(month);
    document.SelectPeriod.lastdate.options[num+2] = 
      new Option("Week of "+day+" "+tmp+" "+year,
                   year+""+month+""+day);
    document.SelectPeriod.lastdate.selectedIndex = num+2;
  }
}
function SelectLastDay() 
{
  var num = document.SelectPeriod.lastdate.selectedIndex;
  var el = document.SelectPeriod.lastdate;
  if(num != 0) {
   document.SelectPeriod.lastdate.selectedIndex--;
  }else {
    var year = el[num].value.substring(0,4);
    var month = el[num].value.substring(4,6);
    var day = "24";
    
    month--;

    if(month == -1) {
      month = '01';
    }else if ( month == 0) {
      month = '12';
      year--;
    }
  
    if(month.toString().replace(/ /g,'').length == 1) {
       month = "0"+month;
    }
    //new Option(text, value, defaultSelected, selected)
    var tmp = GetMonthName(month);
    document.SelectPeriod.lastdate.options[num] = 
        new Option("Week of "+day+" "+tmp+" "+year,
                    year+""+month+""+day);
    document.SelectPeriod.lastdate.selectedIndex = num;
  }
}
function dayMonthWeekCheck(){
 if(document.getElementById("vyearmth")){
   document.getElementById("vyearmth").removeAttribute("onchange");
 }
 if(document.getElementById("lastdate")){
   document.getElementById("vyearmth").removeAttribute("onchange");
 }
}
</script>
</head>
%START.OF.PAGE
<body onload="PageLoad(event);InitTable(0);sortMrtLocation(mrlocncd);">
<span id=WaitBoxDisplay class=WaitBox style="display:none">
<img class=WaitImage src="../images/wait.gif">
<p>Please Wait ...</p>
</span>

<div id=PageLayer class=DimmedLayer style="display:none"></div>

<script>
ShowWaitScreen();
</script>

<div id=HeadingSection>
 <form name=SelectPeriod action=patweb86.pbl method=get style="margin:0"
   onsubmit="return validateMandatory(this)">
 <input type=hidden name=reportno value=2>
 <input type=hidden name=template value=1>
 <input type=hidden name=viewtype value="%PATWEB86.02.010">
 <input type=hidden name=uncodkey value="">
 <input type=hidden name=dummy1 value="  ">
 <input type=hidden name=dummy2 value="  ">
 <input type=hidden name=dummy3 value="  ">
 <input type=hidden name=dummy4 value="  ">
 <input type=hidden name=ibcnmhos value="%STANDARD.01.025.000.043.1.1">
 <input type=hidden name=mrcnepsc value="%STANDARD.01.025.060.133.1.1">
 <input type=hidden name=showflag value="0">
 <input type=hidden name=showflagV value="%PATWEB86.02.023">
<table cellpadding=1 cellspacing=1 bgcolor=#CCCCCC border=1 width=100%>
<tr><td>
 <table cellpadding=0 cellspacing=0 bgcolor=#CCCCCC border=0 width=100%>
<tr><td colspan=5><input type=button value="<<" class=smallbutton
    onclick='%PATWEB86.02.003'>
    %PATWEB86.02.001
    <input type=button value=">>" class=smallbutton
    onclick='%PATWEB86.02.002'></td>
    <span id=NextPage><span>
    </td>

   <td align=right>
   <a href='javascript:SelectDateFrame();'>
   <img src="../images/DateLookup.gif" border=0
    alt="Select Date" align=absmiddle></a> 
   <a href='javascript:SelectView("0");'>
   <img src=../images/DayIcon.gif border=0
    alt="View Today" align=absmiddle></a>
   <a href='javascript:SelectView("1");'>
   <img src=../images/WeekIcon.gif border=0
    alt="View This Week" align=absmiddle></a>
   <a href='javascript:SelectView("2");'>
   <img src=../images/MonthIcon.gif border=0
    alt="View This Month" align=absmiddle></a>
   </td></tr>
<tr><td class=DataLabel> Unit  <br>
    <select name=unitcode id=unitcode class=SelectMed>
    <option value="   ">All</option>
    %PATWEB86.02.011
    </select></td>
    <td class=DataLabel> %STANDARD.01.017.CL <br>
    <select name=claimcod id=claimcod class=SelectMed>
    <option value="   ">All</option>
    %PATWEB86.02.012
    </select></td>
    <td class=DataLabel> Adm.Type <br>      
    <select name=admistyp id=admistyp class=SelectMed>
    <option value="   ">All</option>
    %PATWEB86.02.013
    </select></td>
    <td class=DataLabel> M/R Location <br>     
    <select name=mrlocncd id=mrlocncd class=SelectMed>
    <option value="   ">All</option>
    %PATWEB86.02.015
    </select></td>      
    <td class=DataLabel>&nbsp;Ward<br>
    <select name=wardcode id=wardcode class=SelectMed>
    <option value="   ">All</option>
    %PATWEB86.02.014
    </select></td>
   <td class=DataLabel>Option<br>
    <select name=curradmn id=curradmn class="Mandatory SelectMed"
     title="Option">
    %PATWEB86.02.016
    </select></td>
    <td></td>
    <td align=right>&nbsp;
    <br><input type=button value="Go" class=SmallButton
          onclick="PressGoButton();"></td></tr>
</table>
</td></tr>
</table>
</form>
</div>

<div id=TableLocation></div>

<script type="text/javascript">
function AddTableRows() {
 if(document.SelectPeriod.mrcnepsc.value=="1") {
    document.title="Uncoded Discharges and Episodes";
 } else {
    document.title="Uncoded Discharges";
 }
 %PATWEB86.02.022.mrtweb02.01.001.mrtweb02.03.001.0.1.1
}
function PatientAlerts(urnumber,admissno) {
  linkurl="patweb98.pbl?reportno=1&template=003" +
          "&urnumber=" + urnumber + "&admissno=" + admissno
  location.href=linkurl
}
</script>
