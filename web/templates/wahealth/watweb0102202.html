<meta name="TemplateVersion" content="V12.01.00">
<meta name="TemplateHome" content="wahealth">
<meta name="HelpFileName" content="NoContextSet.html">
<meta name="CrossBrowser" content="true">
<script type="text/javascript"> 
function DelWindow() {
  CASEKEYS=PatientLinks.casekeys.value.replace(/ /g,"+");
  LinkUrl="watweb01.pbl?reportno=2&template=011&casekeys="+CASEKEYS;
  Left=(document.body.clientWidth-700)/2;
  DFrameLink(LinkUrl,100,Left,700,300);
}

function setReason() {
  AddForm.wathi001.className="Mandatory";
}

function CheckBooking() {
  if (AddForm.bkrec008.value.substr(0,2)=="TH") {
    DOCTCODE=AddForm.bkrec002.value
    LinkUrl="oprweb01.pbl?reportno=2&template=3&doctcode="+DOCTCODE
    DFrameLink(LinkUrl,0,0,740,390)
  }
}

function UpdateBooking() {
  if (validateMandatory(AddForm)) {
    // Compare the scheduled admission date against waiting list date...
    var admdate = SetDateYYYYMMDD(AddForm.bkrec004.value);
    var wtldate = AddForm.watldate.value;

    if (admdate < wtldate) {
      alert("Scheduled Admission Date must be greater than Date on List");
      AddForm.bkrec004.focus();
      return false;
    }
    AddForm.submit();
  }
}

function validateDateBookingRules() {

  if (document.AddForm.bkrec004.defaultValue == 
      document.AddForm.bkrec004.value) { return; }

  var admdate;
  var wtldate;
  var admdateDATEOBJECT;
  var wtldateDATEOBJECT;
  var oneDay = 24*60*60*1000;
  var diffDays = 0;
  var priorIndc3 = '';  // Priority indicator 3 value

  if (isWhitespace(AddForm.bkrec004.value) ||
      isWhitespace(AddForm.watldate.value)) {
    clearDateBookingRules();
    return;
  }

  admdate = SetDateYYYYMMDD(AddForm.bkrec004.value);
  wtldate = AddForm.watldate.value;

  if (admdate < wtldate) {
    clearDateBookingRules();
    return;
  }

  admdateDATEOBJECT = new Date("2000-01-01");
  wtldateDATEOBJECT = new Date("2000-01-01");

  admdateDATEOBJECT.setDate(admdate.substr(6,2));
  admdateDATEOBJECT.setMonth(parseInt(admdate.substr(4,2)-1));
  admdateDATEOBJECT.setFullYear(admdate.substr(0,4));

  wtldateDATEOBJECT.setDate(wtldate.substr(6,2));
  wtldateDATEOBJECT.setMonth(parseInt(wtldate.substr(4,2)-1));
  wtldateDATEOBJECT.setFullYear(wtldate.substr(0,4));

//  diffDays = Math.round(Math.abs((admdateDATEOBJECT.getTime() -
//                                  wtldateDATEOBJECT.getTime())/(oneDay)));

  utc1 = Date.UTC(admdateDATEOBJECT.getFullYear(),
                  admdateDATEOBJECT.getMonth(),
                  admdateDATEOBJECT.getDate());
  utc2 = Date.UTC(wtldateDATEOBJECT.getFullYear(),
                  wtldateDATEOBJECT.getMonth(),
                  wtldateDATEOBJECT.getDate());

  diffDays = Math.floor((utc1 - utc2) / oneDay);

  priorIndc3 = document.AddForm.watprior.value.substr(14,1);

  if (priorIndc3 == '2') {

    if (diffDays <= 30) {

      if (AddForm.bokrx045 != undefined) {
        if (!isWhitespace(AddForm.bokrx045.value)) {
          return;
        }
      }

      if (confirm("Booking date is less than 31 days and does not meet" +
        "\nthe Category " + priorIndc3 + " guidelines." +
        " Select OK to accept this\ndate, Select Cancel to clear the date.")) {
        assignWaitingListBookingSpans();
        return;
      }
      else {
        document.AddForm.bkrec004.value="";
        return;
      }
    }
  }
  else if (priorIndc3 == '3') {

    if (diffDays <= 90) {

      if (AddForm.bokrx045 != undefined) {
        if (!isWhitespace(AddForm.bokrx045.value)) {
          return;
        }
      }

      if (confirm("Booking date is less than 91 days and does not meet" +
        "\nthe Category " + priorIndc3 + " guidelines." +
        " Select OK to accept this\ndate, Select Cancel to clear the date.")) {
        assignWaitingListBookingSpans();
        return;
      }
      else {
        document.AddForm.bkrec004.value="";
        return;
      }
    }
  }

  clearDateBookingRules();
}

function assignWaitingListBookingSpans() {

  PBRTitleDIV.innerHTML=PBRTitleSPAN.innerHTML;
  PBRFieldDIV.innerHTML=PBRFieldSPAN.innerHTML;

  AuthByTitleDIV.innerHTML=AuthByTitleSPAN.innerHTML;
  AuthByFieldDIV.innerHTML=AuthByFieldSPAN.innerHTML;
}

function validateDateBookingRulesOnLoad() {

  var admdate;
  var wtldate;
  var admdateDATEOBJECT;
  var wtldateDATEOBJECT;
  var oneDay = 24*60*60*1000;
  var diffDays = 0;

  if (isWhitespace(AddForm.bkrec004.value) ||
      isWhitespace(AddForm.watldate.value)) {
    clearDateBookingRules();
    return;
  }

  if (AddForm.bokrx045!=undefined) {
    if (!isWhitespace(AddForm.bokrx045.value)) {
      return;
    }
  }

  admdate = SetDateYYYYMMDD(AddForm.bkrec004.value);
  wtldate = AddForm.watldate.value;

  if (admdate < wtldate || admdate == wtldate) {
    clearDateBookingRules();
    return;
  }

  admdateDATEOBJECT = new Date();
  wtldateDATEOBJECT = new Date();

  admdateDATEOBJECT.setFullYear(admdate.substr(0,4));
  admdateDATEOBJECT.setMonth(parseInt(admdate.substr(4,2)-1));
  admdateDATEOBJECT.setDate(admdate.substr(6,2));

  wtldateDATEOBJECT.setFullYear(wtldate.substr(0,4));
  wtldateDATEOBJECT.setMonth(parseInt(wtldate.substr(4,2)-1));
  wtldateDATEOBJECT.setDate(wtldate.substr(6,2));

  diffDays = Math.round(Math.abs((admdateDATEOBJECT.getTime() -
                                  wtldateDATEOBJECT.getTime())/(oneDay)));

  if (diffDays > 30 && diffDays <= 90) {

    if (document.AddForm.watprior.value.substr(14,1) != 3) {
      return;
    }

    assignWaitingListBookingSpans();
    return;

  } else {
    if (diffDays <= 30) {

      if (document.AddForm.watprior.value.substr(14,1) != 2 &&
          document.AddForm.watprior.value.substr(14,1) != 3) {
        return;
      }

      assignWaitingListBookingSpans();
      return;
    }
  }

  clearDateBookingRules();
}

function clearDateBookingRules() {

  PBRTitleDIV.innerHTML="";
  PBRFieldDIV.innerHTML="";

  AuthByTitleDIV.innerHTML="";
  AuthByFieldDIV.innerHTML="<input type=hidden name=bokrx045 value=' '>" +
                           "<input type=hidden name=bokrx046 value=' '>";
}

</script>
</head>
%START.OF.PAGE
<body onload="PageLoad(event);validateDateBookingRulesOnLoad();">
<span class=DFrameTitleBar>
<img align="right" alt="Exit" class="MenuIcon" 
 src="../images/ExitIcon.gif" onclick="DFrameExit();">
Booking Details
</span>

<form name=AddForm action=watweb01.pbl method=post>
<input type=hidden name=reportno value=7>
<input type=hidden name=template value=201>
<input type=hidden name=updttype value=U>
<input type=hidden name=bkrec008 value="%WATWEB01.02.711.1">
<input type=hidden name=exptward value="%WATWEB01.02.719">
<input type=hidden name=casekeys value="%WATWEB01.02.101">
<input type=hidden name=wattr004 value="%WATWEB01.02.107">
<input type=hidden name=bkrec015 value="%WATWEB01.02.537.0">
<input type=hidden name=bkrec035 value="%WATWEB01.02.103">
<input type=hidden name=bkrec036 value="%WATWEB01.02.106">
<input type=hidden name=bkrec037 value="%WATWEB01.02.107">
<input type=hidden name=wattx014 value="%WATWEB01.02.548">
<input type=hidden name=watldate value="%WATWEB01.02.323">
<input type=hidden name=bokrx006 value="">
<input type=hidden name=watprior value="%WATWEB01.02.117.3">

<table border=0 width="95%" cellspacing="0" cellpadding="1" align=center>
<tr><td class=DataLabel>Booking Type</td>
   <td><input type=text size=25 name=bookingt value="%WATWEB01.02.534.0"
        class=readonly readonly>
   </td></tr>

<tr><td class=DataLabel>Scheduled Admission</td>
    <td class=DataLabel>
    <input type=text name=bkrec004 size=12 value="%WATWEB01.02.706"  
     class=Mandatory title="Scheduled Admission Date" onchange=setReason();
     onblur="if(checkDate(this,this.title)){validateDateBookingRules();}">
    <a href='javascript:DateLookupFrame(AddForm.bkrec004)'>
    <img src=../images/DateLookup.gif border=0 hspace=4 align=absmiddle
     onclick=setReason();></a>
    Time
    <input type=text name=bkrec005 size=6 value="%WATWEB01.02.707"
    class=Mandatory title="Scheduled Admission Time" onchange=setReason();>
    <img src=../images/DateTimeStamp.gif  border=0 hspace=4 align=absmiddle  
    onclick="setReason();
             SetCurrentDateTime(AddForm.bkrec004,AddForm.bkrec005);">
    <img src=../images/TimeLookup.gif border=0 hspace=4 align=absmiddle  
    onclick="TimeLookupFrame(AddForm.bkrec005);setReason();"> 
    </td>
    <td class=DataLabel>Reason for Change</td>
    <td class=DataLabel>
    <select name=wathi001 title="Reason for Change">
    <option></option>
    %STANDARD.01.007.WD
    </select>
    </td></tr>

<tr>
  <td class=DataLabel><div id="PBRTitleDIV"></div></td>
  <td class=DataField><div id="PBRFieldDIV"></div></td>
</tr>

<tr>
  <td class=DataLabel><div id="AuthByTitleDIV"></div></td>
  <td class=DataField><div id="AuthByFieldDIV"></td>
</tr>

<tr>
  <td class=DataLabel>
  Procedure Date
  </td>
  <td class=DataField>
    <input type=text name=bkrec039 size=12 value="%WATWEB01.02.710"
     title="Procedure Date" onblur="checkDate(this,this.title);">
    <a href='javascript:DateLookupFrame(AddForm.bkrec039)'>
    <img src=../images/DateLookup.gif border=0 hspace=4 align=absmiddle></a>
  </td>
</tr>

<tr><td class=DataLabel>%STANDARD.01.017.OA</td>
    <td class=DataField>
      <select name=bokrx043 title="%STANDARD.01.017.OA">
        <option></option>
        %WATWEB01.02.359.2
      </select>
    </td>
</tr>

<tr><td class=DataLabel>Estimated Op Time </td>
    <td class=DataLabel>
    <input type=text name=bokrx044 size=8 maxlength=5
     value="%WATWEB01.02.444" class=Integer min=0></td>
</tr>

<tr><td class=DataLabel>%STANDARD.01.017.SI</td>
    <td class=DataField>
    <select name=bokrx042>
    <option></option>
    %WATWEB01.02.442.2
    </select></td></tr>


<tr><td colspan=4 align=center> 
    <input type=button value=Ok class="button" onclick='UpdateBooking()'>
    <input type=button value=Cancel class="button" onclick='DFrameExit()'>
    <input type=button value="Unschedule" class="button" tabindex=14
    onclick="DelWindow()">
    </td></tr>
</table>
</form>

<form name=PatientLinks method=get>
<input type=hidden name=reportno value=1>
<input type=hidden name=template value=004>
<input type=hidden name=urnumber value="%WATWEB01.02.003">
<input type=hidden name=admissno value="%WATWEB01.02.125">
<input type=hidden name=MenuType value="%WATWEB01.02.088">
<input type=hidden name=casekeys value="%WATWEB01.02.101">
</form>

<span id="PBRTitleSPAN" style="display:none">
%STANDARD.01.017.b1
</span>

<span id="PBRFieldSPAN" style="display:none">
<select name=bokrx045 class="Mandatory" title="%STANDARD.01.017.b1">
<option></option>
%WATWEB01.02.445.2
</select>
<input type=hidden name=bokrx047 value="%WATWEB01.02.447">
</span>

<span id="AuthByTitleSPAN" style="display:none">
%STANDARD.01.017.b2
</span>

<span id="AuthByFieldSPAN" style="display:none">
<select name=bokrx046 class="Mandatory" title="%STANDARD.01.017.b2">
<option></option>
%WATWEB01.02.446.2
</select>
</span>

