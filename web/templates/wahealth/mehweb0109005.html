<meta name="TemplateVersion" content="V12.01.00">
<meta name="TemplateHome" content="wahealth">
<meta name="HelpFileName"    content="NoContextSet.html">
<meta name="CrossBrowser" content="true">
<script type="text/javascript" src="../js/mehweb0109005.js"></script>
<script type="text/javascript" src="../js/mehweb0109.js"></script>
<script type="text/javascript">
function cancelPage(){
  if(confirm("Warning: Legal Status Details will not be saved if you "+
          "continue. "+
          "Select OK to continue, select Cancel to return to the Legal "+
          "Status Details page")){
     DFrameExitRefresh();
  }
}
function ValidateLSDateAndTime() {

  // Declare and Initialise Date Objects
  var ReferralDateTime = new Date();
  var LSStartDateTime = new Date();
  var CurrentDateTime = new Date();

  // Whitespace validation for Date and Time fields on screen
  if (isWhitespace(document.AddForm.rfstdate.value)||
      isWhitespace(document.AddForm.rfsttime.value)||
      isWhitespace(document.AddForm.mhdls002.value)||
      isWhitespace(document.AddForm.mhdls003.value)) {
    return true;
  }

  // Set Referral DateTime properties 
  // Day of month
  ReferralDateTime.setDate(AddForm.rfstdate.value.substring(0,2));

  // Month
  var varMonth = 0;
  if (AddForm.rfstdate.value.substr(3,3)=="Jan"){varMonth=0;}
  if (AddForm.rfstdate.value.substr(3,3)=="Feb"){varMonth=1;}
  if (AddForm.rfstdate.value.substr(3,3)=="Mar"){varMonth=2;}
  if (AddForm.rfstdate.value.substr(3,3)=="Apr"){varMonth=3;}
  if (AddForm.rfstdate.value.substr(3,3)=="May"){varMonth=4;}
  if (AddForm.rfstdate.value.substr(3,3)=="Jun"){varMonth=5;}
  if (AddForm.rfstdate.value.substr(3,3)=="Jul"){varMonth=6;}
  if (AddForm.rfstdate.value.substr(3,3)=="Aug"){varMonth=7;}
  if (AddForm.rfstdate.value.substr(3,3)=="Sep"){varMonth=8;}
  if (AddForm.rfstdate.value.substr(3,3)=="Oct"){varMonth=9;}
  if (AddForm.rfstdate.value.substr(3,3)=="Nov"){varMonth=10;}
  if (AddForm.rfstdate.value.substr(3,3)=="Dec"){varMonth=11;}
  ReferralDateTime.setMonth(varMonth);

  // Year
  ReferralDateTime.setFullYear(AddForm.rfstdate.value.substr(7,4));

  // Hours
  ReferralDateTime.setHours(AddForm.rfsttime.value.substr(0,2));

  // Minutes
  ReferralDateTime.setMinutes(AddForm.rfsttime.value.substr(3,2));

  // Seconds
  ReferralDateTime.setSeconds(AddForm.rfsttime.value.substr(6,2));

  // Set LS DateTime properties
  // Day of month
  LSStartDateTime.setDate(AddForm.mhdls002.value.substring(0,2));

  // Month
  var varMonth = 0;
  if (AddForm.mhdls002.value.substr(3,3)=="Jan"){varMonth=0;}
  if (AddForm.mhdls002.value.substr(3,3)=="Feb"){varMonth=1;}
  if (AddForm.mhdls002.value.substr(3,3)=="Mar"){varMonth=2;}
  if (AddForm.mhdls002.value.substr(3,3)=="Apr"){varMonth=3;}
  if (AddForm.mhdls002.value.substr(3,3)=="May"){varMonth=4;}
  if (AddForm.mhdls002.value.substr(3,3)=="Jun"){varMonth=5;}
  if (AddForm.mhdls002.value.substr(3,3)=="Jul"){varMonth=6;}
  if (AddForm.mhdls002.value.substr(3,3)=="Aug"){varMonth=7;}
  if (AddForm.mhdls002.value.substr(3,3)=="Sep"){varMonth=8;}
  if (AddForm.mhdls002.value.substr(3,3)=="Oct"){varMonth=9;}
  if (AddForm.mhdls002.value.substr(3,3)=="Nov"){varMonth=10;}
  if (AddForm.mhdls002.value.substr(3,3)=="Dec"){varMonth=11;}
  LSStartDateTime.setMonth(varMonth);

  // Year
  LSStartDateTime.setFullYear(AddForm.mhdls002.value.substr(7,4));

  // Hours
  LSStartDateTime.setHours(AddForm.mhdls003.value.substr(0,2));

  // Minutes
  LSStartDateTime.setMinutes(AddForm.mhdls003.value.substr(3,2));

  // Seconds
  LSStartDateTime.setSeconds(AddForm.mhdls003.value.substr(6,2));

  // Compare the two dates
  if (ReferralDateTime.valueOf() > LSStartDateTime.valueOf()) {
    alert("LS Start date must be equal or after Referral Start Date");
    return false;
  }

  if (CurrentDateTime.valueOf() < LSStartDateTime.valueOf()) {
    alert("The Legal Status Start Date and Time must be less than the Current Date and Time");
    return false;
  }

  return true;
}
function ValidateAndSubmit() {
  if (ValidateLSDateAndTime()) {
    FormSubmit();
  }
}
function CheckVisit() {
  if(document.AddForm.visittyp.value=="3") {
      document.getElementById("Psychiatrist").innerHTML=
      document.getElementById("DefaultPsyc").innerHTML;
  } else {
      document.getElementById("Psychiatrist").innerHTML=
      document.getElementById("InputPsyc").innerHTML;
      document.AddForm.mhdls008.focus();
  }
  if (GetCookieData("mentalhealthcookie")=="1") {
    document.AddForm.mnhlckie.value="1";
    SetCookie("mentalhealthcookie","");
  }
}

function CheckFutureTime(theForm,checkdate,checktime) {
 SetCurrentDateTimeNoFocus(null,theForm.currtime);// UNIX time
 if (SetDateYYYYMMDD(checkdate)==(theForm.currdate.value)) {
   var newttime=trim(checktime.value.replace(/:/g,"")) - 0
   var currentt=trim(theForm.currtime.value.replace(/:/g,"")) - 0
   if(newttime>currentt){
   alert("Time is in the future");
   checktime.value="";
   checktime.focus();}
 }
}

function GetDocDesc() {
  UpCase(document.AddForm.mhdls028);
  ValidateHCP(18,18,document.AddForm.mhdls028,document.AddForm.doctnam1);
  UpCase(document.AddForm.mhdls029);
  ValidateHCP(18,18,document.AddForm.mhdls029,document.AddForm.doctnam2);
  UpCase(document.AddForm.mhdls030);
  ValidateHCP(18,18,document.AddForm.mhdls030,document.AddForm.doctnam3);
}

</script>
</head>
%START.OF.PAGE
<body onload="PageLoad(event);CheckVisit();GetDocDesc();">
<span class=DFrameTitleBar>
<img align=right alt="Exit" class="MenuIcon" 
 src="../images/ExitIcon.gif" onclick="cancelPage();">
Legal Status Details
</span>
<div id=PageBodySection style="overflow: auto;">
<form name=AddForm action="mehweb01.pbl" method=post style="margin:0">
<input type=hidden name=reportno value="9">
<input type=hidden name=updttype value="I">
<input type=hidden name=urnumber value="%MEHWEB01.09.003">
<input type=hidden name=admissno value="%MEHWEB01.09.081">
<input type=hidden name=uniqnumb value="%MEHWEB01.09.101">
<input type=hidden name=nextpage value="0">
<input type=hidden name=mhdls012 value="">
<input type=hidden name=mhdls013 value="">
<input type=hidden name=mhhlsend value="%MEHWEB01.09.104">
<input type=hidden name=mhhltend value="%MEHWEB01.09.105">
<input type=hidden name=precdate value="%MEHWEB01.09.412">
<input type=hidden name=prectime value="%MEHWEB01.09.413"> 
<input type=hidden name=visittyp value="%MEHWEB01.09.605">
<input type=hidden name=rfstdate value="%MEHWEB01.09.102">
<input type=hidden name=rfsttime value="%MEHWEB01.09.103">
<input type=hidden name=currdate value='%STANDARD.01.013'>
<input type=hidden name=currtime>
<input type=hidden name=mnhlckie value="">
<input type=hidden name=redirect>

<table align=center cellspacing=0 cellpadding=1 border=0 width=95%>
<tr><td width=18% class=DataLabel>Legal Status</td>
    <td><select name=mhdls004 title="Legal Status" class="SelectBig Mandatory"
         tabindex=1 onchange="CheckStatus(AddForm);">
        <option></option>
        %MEHWEB01.09.324  
        </select></td>
    <td width=18% class=DataLabel>Psychiatrist</td>
    <td><div id="Psychiatrist"></div></td>
</tr>

<tr><td class=DataLabel>LS Start Date</td>
    <td class=DataLabel>
    <input type=text name=mhdls002 title="Legal Status Start Date" size=12
     tabindex=2
     class="PastDate Mandatory date" 
     onblur="checkDate(this,'Date');CheckStatus(AddForm);
             checkRefDate(AddForm.mhdls002,AddForm.mhdls003,'1',
             AddForm.mhhlsend,AddForm.mhhltend,
             AddForm.e_mhdls006,AddForm.e_mhdls007);">
    <img src="../images/DateLookup.gif" class=Icon date=date1
     onclick="DateLookupFrame(AddForm.mhdls002);">
     Time
    <input type=text size=8 title="Start Time" name=mhdls003 tabindex=3
     value=" " class="Mandatory Time"
     onblur="checkTime(this);CheckStatus(AddForm);
             checkRefTime(AddForm.mhdls002,AddForm.mhdls003,'1',
             AddForm.mhhlsend,AddForm.mhhltend,
             AddForm.e_mhdls006,AddForm.e_mhdls007);
             CheckFutureTime(AddForm,mhdls002.value,AddForm.mhdls003);">
    <img src="../images/DateTimeStamp.gif" class=Icon
     onclick="SetCurrentDateTime(AddForm.mhdls002,AddForm.mhdls003);">
    <img src="../images/TimeLookup.gif" class=Icon 
     onclick="TimeLookupFrame(AddForm.mhdls003);">
    </td>
    <td class=DataLabel>Supervising Psychiatrist</td>
    <td><input type="text" size=10 maxlength=10 name="mhdls028" tabindex=12
       onblur="UpCase(this);ValidateHCP(18,18,AddForm.mhdls028,
               AddForm.doctnam1);" 
       value="%MEHWEB01.09.329">
       <input type="text" size=20 notab readonly name="doctnam1" tabindex=-1>
       <img src="../images/SearchIcon.gif" class=Icon
        onclick="HCPSearchFrame(AddForm.mhdls028,AddForm.doctnam1,9);">
       <img src="../images/erase.gif" class="Icon"
        onclick="clrFields(AddForm.mhdls028,AddForm.doctnam1);">
    </td>
</tr>

<tr><td class=DataLabel>LS Expiry Date</td>
    <td class=DataLabel>
    <input type=text size=10 title="LS Expiry Date" name=e_mhdls006
     class="readonly Date" readonly tabindex=-1>
    <img src="../images/DateLookup.gif" class=Icon date=date1
     onclick="">
    <class=DataLabel>Time
    <input type=text size=8 title="End Time" name=e_mhdls007 
     class=readonly readonly tabindex=-1>
    <img src="../images/DateTimeStamp.gif" class=Icon
     onclick="">
    <img src="../images/TimeLookup.gif" class=Icon
     onclick="">
    </td>
    <td class=DataLabel>Responsible Practitioner</td>
    <td><input type="text" size=10 maxlength=10 name="mhdls029" tabindex=13
       onblur="UpCase(this);ValidateHCP(18,18,AddForm.mhdls029,
       AddForm.doctnam2);"
       value="%MEHWEB01.09.330">
       <input type="text" size=20 notab readonly name="doctnam2" tabindex=-1>
       <img src="../images/SearchIcon.gif" class=Icon
        onclick="HCPSearchFrame(AddForm.mhdls029,AddForm.doctnam2,9);">
       <img src="../images/erase.gif" class="Icon"
        onclick="clrFields(AddForm.mhdls029,AddForm.doctnam2);">
    </td>
</tr>

<tr><td class=DataLabel>LS End Date</td>
    <td class=DataLabel>
    <input type=text name=mhdls017 title="End Date" class="Date" tabindex=4
     size=9 onblur="if(checkDate(this,'Date')) 
                    {checkLSDate(AddForm.mhdls017,AddForm.mhdls018,0,
                     AddForm.mhdls002,AddForm.e_mhdls006);
                     setEndTime();
                     checkRefDate(AddForm.mhdls017,AddForm.mhdls018,'2',
                     AddForm.mhhlsend,AddForm.mhhltend,
                     AddForm.e_mhdls006,AddForm.e_mhdls007);}">
    <img src="../images/DateLookup.gif" class=Icon date=date1
     onclick="DateLookupFrame(AddForm.mhdls017);">
     Time  
    <input type=text size=8 title="End Time" name=mhdls018
     value=" " class="Time" tabindex=5
     onblur="checkLSTime(AddForm.mhdls017,AddForm.mhdls018,0,AddForm.mhdls002,
             AddForm.e_mhdls006,AddForm.mhdls003,AddForm.e_mhdls007);
     checkRefTime(AddForm.mhdls017,AddForm.mhdls018,'2',AddForm.mhhlsend,
             AddForm.mhhltend,AddForm.e_mhdls006,AddForm.e_mhdls007);">
    <img src="../images/DateTimeStamp.gif" class=Icon
     onclick="SetCurrentDateTime(AddForm.mhdls017,AddForm.mhdls018);">
    <img src="../images/TimeLookup.gif" class=Icon 
     onclick="TimeLookupFrame(AddForm.mhdls018);">
    </td>
    <td class=DataLabel>Locum Doctor</td>
    <td><input type="text" size=10 maxlength=10 name="mhdls030" tabindex=14
       onblur="UpCase(this);ValidateHCP(18,18,AddForm.mhdls030,
               AddForm.doctnam3);"
       value="%MEHWEB01.09.331">
       <input type="text" size=20 notab readonly name="doctnam3" tabindex=-1>
       <img src="../images/SearchIcon.gif" class=Icon
        onclick="HCPSearchFrame(AddForm.mhdls030,AddForm.doctnam3,9);">
       <img src="../images/erase.gif" class="Icon"
        onclick="clrFields(AddForm.mhdls030,AddForm.doctnam3);">
    </td>
</tr>

<tr><td class=DataLabel>Review Date</td>
    <td class=DataLabel>
    <input type=text name=mhdls006 title="Review Date" class="Date"
     size=12 tabindex=6
     onblur="checkLSDate(AddForm.mhdls006,AddForm.mhdls007,1,
             AddForm.mhdls002,AddForm.e_mhdls006);">
    <img src="../images/DateLookup.gif" class=Icon date=date1
     onclick="DateLookupFrame(AddForm.mhdls006);">
     Time
    <input type=text size=8 title="Review Time" name=mhdls007
     value=" " class="Time" tabindex=7
     onblur="checkLSTime(AddForm.mhdls006,AddForm.mhdls007,1,
             AddForm.mhdls002,AddForm.e_mhdls006,
             AddForm.mhdls003,AddForm.e_mhdls007);">
    <img src="../images/DateTimeStamp.gif" class=Icon
     onclick="SetCurrentDateTime(AddForm.mhdls006,AddForm.mhdls007);">
    <img src="../images/TimeLookup.gif" class=Icon
     onclick="TimeLookupFrame(AddForm.mhdls007);">
    </td>
</tr>

<tr><td class=DataLabel>Collected At</td>
    <td><select name=mhdls010 title="Collected At" class="SelectBig Mandatory" 
         tabindex=8>
        <option></option>
        %STANDARD.01.018.PO.   .9.1.01.1.L
        </select></td>
</tr>

<tr><td class=DataLabel>Pt Documentation given?</td>
    <td><select name=mhdls027 title="Pt Documentation given?" tabindex=9 
         class="SelectBig">
        <option></option>
        %MEHWEB01.09.227.2
        </select></td>
</tr>
</table>

<table align=center cellspacing=0 cellpadding=1 border=0 width=95%>
<tr><td class=DataLabel> Document Name</td>
<td colspan=6 align=left>
<textarea wrap=hard name=doconame rows=2 cols=100 tabindex=10 maxlength=200
 style="font-family:Arial; font-size:11px;">
%MEHWEB01.09.416
</textarea></td></tr>

<tr><td class=DataLabel>Comments 1</td>
    <td><input type="text" size="120" maxlength="100" name=mhdls016
         title="Comments" tabindex=15>
    </td>
</tr>
<tr><td class=DataLabel>Comments 2</td>
    <td><input type="text" size="120" maxlength="100" name=mhdls026
         title="Comments" tabindex=16>
    </td>
</tr>
</table>

<table align=center cellspacing=0 cellpadding=1 border=0 width=95%>
<tr><td colspan=4 align=center><br>
    <input type=button value="Add" class="button" name=addbutton tabindex=17
     onclick="ValidateAndSubmit();">
    <input type=button Value="Cancel" class="button" tabindex=18
     onclick="cancelPage();">
    </td>
</tr>
</table>
</form>

<div id="InputPsyc" style="display:none">
       <input type="text" size=10 maxlength=10 name="mhdls008" 
        title="Psychiatrist" tabindex=11
       onblur="UpCase(this);ValidateHCP(18,18,AddForm.mhdls008,
               AddForm.doctnam4);">
       <input type="text" size=20 notab readonly name="doctnam4" tabindex=-1>
       <img src="../images/SearchIcon.gif" class=Icon
        onclick="HCPSearchFrame(AddForm.mhdls008,AddForm.doctnam4,9);">
       <img src="../images/erase.gif" class="Icon"
        onclick="clrFields(AddForm.mhdls008,AddForm.doctnam4);">
</div>

<div id="DefaultPsyc" style="display:none">
       <input type=hidden name=mhdls008 value="%MEHWEB01.09.122.1">
       <input type=text size=40 class=readonly readonly name=d_mhdls008
        value="%MEHWEB01.09.122.0.002" title="Psychiatrist" tabindex=-1>
</div>

<script type="text/javascript">
 document.AddForm.mhdls004.selectedIndex=0;
 FirstLS="%MEHWEB01.09.421"
 if (FirstLS=="0") {
  Defaultlegalstat="%STANDARD.01.025.069.094.0.3"
  for (var i =0 ; i < document.AddForm.mhdls004.length; i++) {
   if (document.AddForm.mhdls004.options[i].value.substr(0,3)==Defaultlegalstat)
   {
        document.AddForm.mhdls004.selectedIndex=i;} 
  }
 }

function setEndTime() {
  checkDate(document.AddForm.mhdls017,'Date');
  if (!isWhitespace(document.AddForm.mhdls017.value)) {
      document.AddForm.mhdls018.className="Mandatory";
   } else {
      document.AddForm.mhdls018.className="";
  }
}

  var txts = document.getElementsByTagName('TEXTAREA') 

  for(var i = 0, l = txts.length; i < l; i++) {
    if(/^[0-9]+$/.test(txts[i].getAttribute("maxlength"))) { 
      var func = function() { 
        var len = parseInt(this.getAttribute("maxlength"), 10); 

        if(this.value.length > len) { 
          alert('Maximum length exceeded: ' + len); 
          this.value = this.value.substr(0, len); 
          return false; 
        } 
      }

      txts[i].onkeyup = func;
      txts[i].onblur = func;
    } 
  } 
</script>
