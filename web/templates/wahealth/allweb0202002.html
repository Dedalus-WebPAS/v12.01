<meta name="TemplateVersion" content="V12.01.00">
<meta name="TemplateHome" content="wahealth">
<meta name="HelpFileName" content="NoContextSet.html">
<meta name="CrossBrowser" content="true">
<script type="text/javascript" src="../js/allweb0202002.js"></script>
</head>
%START.OF.PAGE
<body onload="PageLoad(event);
              CheckBookings();
              setTimeout('DisplayDIVS()',100);
              SetFormFocus();">
<div id=PatientHeading></div>
<script type="text/javascript">
PatientURN="%ALLWEB02.02.003";
PatientVIS="%ALLWEB02.02.081";
PatientNAM="%ALLWEB02.02.002";
PatientSTA="%ALLWEB02.02.086.078";
PatientALT="%ALLWEB02.02.084";
PatientSEX="%ALLWEB02.02.019";
PatientDOB="%ALLWEB02.02.020";
PatientAGE="%ALLWEB02.02.021";
PatientLOC="%ALLWEB02.02.083";
PatientPRI="%ALLWEB02.02.086.066.1";
PatientUNT="%ALLWEB02.02.066.0";
DoctorCOD="%ALLWEB02.02.082.003";
DoctorNAM="%ALLWEB02.02.082.002";
PatientAID="%ALLWEB02.02.086.090";
PatientIND="%ALLWEB02.02.086.091";
PatientCUR="%ALLWEB02.02.086.092";
PatientCLC="%ALLWEB02.02.086.093.1";
PatientCLH="%STANDARD.01.017.CL";
PatientHFT="%ALLWEB02.02.086.094";
PatientCDM="%ALLWEB02.02.086.095";
PatientVDH="%ALLWEB02.02.086.099.015";
InsertPatientHeader()
</script>
<div id=PatientMenu></div>

<form name=HiddenFields style="margin:0">
<input type=hidden name=wbsedall value="%STANDARD.01.028">
<input type=hidden name=refrdept value="%ALLWEB02.02.125.1">
<input type=hidden name=refrstat value="%ALLWEB02.02.103">
<input type=hidden name=deptcode value="%ALLWEB02.02.125.3">
<input type=hidden name=d_extapp value="%ALLWEB02.02.523.002">
<input type=hidden name=d_servce value="%ALLWEB02.02.523.003">
<input type=hidden name=d_refcon value="%ALLWEB02.02.523.005">
<input type=hidden name=ptcolumn id=ptcolumn value="%ALLWEB02.02.272">
<input type=hidden name=deptindc value="%ALLWEB02.02.125.3">
</form>
 
<table width=100% cellspacing=0 cellpadding=1 border=0>
<tr>
<td class=HeadingCell width=15%>
    <select class=PMenuSelectList name=viewlink
     onchange="ViewLink(this);">
    <option>---- Status Update ----</option>
    <option value="0">Inactivate</option>
    <option value="1">Reactivate</option>
    <option value="2">Close</option>
    <option value="3">Cancel</option>
    <option value="4">Reject</option>
    <option value="5">Reinstate</option>
    </select>
    </td>
<td class=HeadingCell width=25%>
<span id=OutpatMenu style="display:none">
    <select class=PMenuSelectList name=viewoutp
     onchange="ViewOutpatientLink(this);">
    <option>--Outpatient Bookings--</option>
    <option value="0">Book Outpatient</option>
    <option value="1">Series Booking</option>
    <option value="2">Multiple HCP Series Booking</option>
    <option value="3">Linked Visits</option>
    </select>
</span>
<span id=CareLogisticMenu style="display:none">
    <select class=PMenuSelectList name=viewoutp id=BookingMenu
     onchange="ViewOutpatientLink(this);">
    <option>-- Care Logistics --</option>
    <option value="4">Book Appointment</option>
    <option value="3">Linked Visits</option>
    </select>
</span>

</td>
    <td class=HeadingCell>
    %ALLWEB02.02.125.0   Referral Details
    </td>
</tr>
</table>

<table width=90% align=center cellspacing=0 cellpadding=1 border=0>
<tr><td class=DataLabel>Priority </td>
    <td class=DataField> %ALLWEB02.02.127.0</td>
    <td class=DataLabel>Entered by</td>
    <td class=DataField> %ALLWEB02.02.163</td></tr>
<tr><td class=DataLabel>Referral Date</td>
    <td class=DataField>  %ALLWEB02.02.119</td>
    <td class=DataLabel>Referral Source</td>
    <td class=DataField> %ALLWEB02.02.134.0</td></tr>
<tr><td class=DataLabel>Referred By</td>
    <td class=DataField>
    <a href='javascript:HCPViewFrame("%ALLWEB02.02.122.1","%ALLWEB02.02.123.0","%ALLWEB02.02.124")'>
 %ALLWEB02.02.122.0</a></td>
    <td class=DataLabel>Reason for Referral</td>
    <td class=DataField>  %ALLWEB02.02.128.0</td></tr>
<tr><td class=DataLabel>Referred by Practice</td>
    <td class=DataField>
    <a href='javascript:HCPViewFrame("%ALLWEB02.02.122.1","%ALLWEB02.02.123.0","%ALLWEB02.02.124")'>
 %ALLWEB02.02.123.1</a></td>
    <td class=DataLabel>Interpreter Required</td>
    <td class=DataField>%ALLWEB02.02.398.058.2</td></tr>

<tr><td class=DataLabel>Referred by Other</td>
    <td class=DataField>%ALLWEB02.02.523.004</td>
    <td class=DataLabel>Referral Entered</td>
    <td class=DataField>  %ALLWEB02.02.161 at %ALLWEB02.02.162.1  </td>
</tr>

<tr><td class=DataLabel style="vertical-align:top">Referrer Contact</td>
    <td class=DataField style="width:350px;word-wrap:break-word">
      <span id='spRefConLne'></span>&nbsp;
    </td>
    <td class=DataLabel style="vertical-align:top">Preferred Date</td>
    <td class=DataField>%ALLWEB02.02.151</td>
</tr>

<tr><td class=DataLabel>Diagnosis Code</td>
    <td class=DataField>  %ALLWEB02.02.131.0</td>
    <td class=DataLabel>External Referral ID Number</td>
    <td class=DataField>%ALLWEB02.02.199.028</td>
</tr>

<tr><td class=DataLabel>Status Code</td>
    <td class=DataField>  %ALLWEB02.02.103  %ALLWEB02.02.199.017</td>
    <td class=DataLabel>External Referral Application</td>
    <td class=DataField><span id='spExtRefApp'></span>&nbsp;</td>
</tr>

<tr><td class=DataLabel>&nbsp;</td>
    <td class=DataField>&nbsp;</td>
    <td class=DataLabel style="vertical-align:top">Service</td>
    <td class=DataField style="width:350px;word-wrap:break-word">
      <span id='spServLne'></span>&nbsp;
    </td>
</tr>

<tr><td class=DataLabel>&nbsp;</td>
    <td class=DataField>&nbsp;</td>
    <td class=DataLabel>&nbsp;</td>
    <td>
      <span id=eRefButtons style="display:none">
        <input type=button class="button" value="Booking Instructions" 
         style="width:120px" onclick="BookingInstr();">
        <input type=button class="button" value="Link to Referral"
         style="width:120px" onclick="LinkToRef();">
      </span>
    </td>
</tr>
</table>

<table width=98% align=center cellspacing=0 cellpadding=1 border=0>
<tr>
  <td style="text-align:center" colspan=4><br>

  <input type=button class="button" value="List Contacts" name=episbutt
   onclick="location.href='%ALLWEB02.02.001.allweb03.01.001';">

  <span id=InsertEpisodeButtons>
   <input type=button class="button" value="Add Contact"
    onclick="AddEnc('%ALLWEB02.02.003',
                    '%ALLWEB02.02.081',
                    '%ALLWEB02.02.125.1',
                    '%ALLWEB02.02.103');">
  </span>

 <input type=button class="button" value="Update" name=btnUpdate
  onclick="getUpdate('%ALLWEB02.02.003',
                     '%ALLWEB02.02.081',
                     '%ALLWEB02.02.125.1')">

  <input type=button class="button" value="Referral List" 
   onclick="location.href='%ALLWEB02.02.001.allweb02.02.001' + 
            '&ptcolumn=' + 
            document.HiddenFields.ptcolumn.value.replace(/ /g,'+');">

  <input type=button class="button" value="Copy Referral" 
   title="Copy referral to this department"
   onclick="getCopy('%ALLWEB02.02.003',
                    '%ALLWEB02.02.081',
                    '%ALLWEB02.02.125.1')">

  <select class=PMenuSelectList name=c_allrf001 id="copselct"
   title="Copy referral to department"
   onmouseover='MenuOver(event,this)'
   onchange="getCopy('%ALLWEB02.02.003','%ALLWEB02.02.081',this.value);">
  <option></option>
   %ALLWEB02.02.208
  </select>

  <span id=InsertHICButtons style="display: none">
    <input type=button class="button" value="Book Outpatient" 
       onclick="BookPatient('%ALLWEB02.02.182.1',
                            '%ALLWEB02.02.103',
                            '%ALLWEB02.02.199.017');">
    <input type=button class="button" value="Linked Visits" 
       onclick="LnkVis('%ALLWEB02.02.003',
                       '%ALLWEB02.02.081',
                       '%ALLWEB02.02.125.1',
                       '%ALLWEB02.02.240')">
  </span>

  <span id=InsertSACSButtons style="display: none">
    <input type=button class="button" value="Internal Referral"
     id="intbuttn"
     title="Add internal referral for users default department" 
     onclick="AddUserReferral();">
    <select class=PMenuSelectList name=d_allrf001 id="intselct"
      title="Add internal referral for department"
     onmouseover='MenuOver(event,this)'
     onchange="AddNewReferral(this);">
    <option></option>
     %ALLWEB02.02.208
    </select>

  <input type=button class="button" value="Linked Referrals" name=linkbutt
   onclick="LnkRef('%ALLWEB02.02.003',
                   '%ALLWEB02.02.081',
                   '%ALLWEB02.02.125.1')">
  </span>

  <input type=button class="button" value="Notes" name=comtbutt
   onclick="PatientLinkTo('cliweb06.pbl',7,1,1,900,500);">

  <input type=button class="button" value="Issues" name=issubutt
   onclick="PatientLinkTo('allweb02.pbl',9,1,1,900,500);">   

  <span id=InsertAssessButton style="display: none">
  <input type=button class="button" value="Assessments" name=assebutt
   onclick="PatientLinkTo('allweb02.pbl',10,1,0,0,0);">   
  </span>

  <span id=InsertReqAppButton style="display: none">
  <input type=button class="button" value="Request Appts" name=reqabutt
   onclick="PatientLinkTo('outweb08.pbl',08,1,0,0,0);">   
  </span>

  <span id=ExtRefBut style="display: none">
  <input type=button class="Bigbutton" value="External Referrals" name=exrfbutt
   onclick="location.href='%ALLWEB02.02.001.allweb02.08.001';">
  </span>

  <span id=ResAdmBut style="display: none">
  <input type=button class="Largebutton" value="Residential Admission" 
  name=readbutt
   onclick="location.href='%ALLWEB02.02.001.allweb03.01.008';">
  </span>

  <br><hr>
  </td>
</tr>
</table>

<span id="Last5Contacts" style="display:none">
<table width=100% border=1 cellspacing=0 cellpadding=1>
<tr><td style="text-align:center" class=HeadingCell colspan=4>
     Last 5 Contacts
    </td></tr>
<tr><td class=HeadingCell>Date & Time</td>
    <td class=HeadingCell>Provider</td>
    <td class=HeadingCell>Service Input</td>
    <td class=HeadingCell width=10%>Notes / Other</td>
<tr><td></td><td></td></tr>

%ALLWEB02.02.225.allweb03.01.003

</table>
</span>

<span id="ClinicDoc" style="display:none">
<form name=AddDocumentLink action=../cgi-bin/cliweb08.pbl method=get
 style="margin:0">
<input type=hidden name=reportno value=1>
<input type=hidden name=template value=011>
<input type=hidden name=urnumber value="%ALLWEB02.02.003">
<input type=hidden name=admissno value="%ALLWEB02.02.101">
<input type=hidden name=referlky value="%ALLWEB02.02.101">
<table width=100% border=1 cellspacing=0 cellpadding=1>
<tr><td colspan=4 class=HeadingCell style="text-align:center">
    Clinical Documentation
    </td></tr>
<tr><td class=HeadingCell>Linked Documents</td>
    <td class=HeadingCell>Description</td>
    <td class=HeadingCell>Date Input</td>
    <td class=HeadingCell>Input By</td></tr>
<tr><td></td><td></td></tr>
 %ALLWEB02.02.202
<tr><td colspan=4 bgcolor=#cccccc style="text-align:right">
    <input type=button class="button NoAutoFocus" value="Add File"
    onclick='DFrameSubmit(AddDocumentLink,100,150,500,250);'>
    </td></tr>
</table>
</form>

<table width=100% border=1 cellspacing=0 cellpadding=0>
<tr><td bgcolor=#cccccc style="text-align:left">
    <input type=button class="button" value="Audit" name=audtbutt
     onclick="PatientLinkTo('allweb02.pbl',2,13,0,0,0);">
    <span id="LetterHistory" style="display:none">
    <input type="button" class="button"
           value="Letter History"
           name="btnLetterHistory"
           onclick="PatientLinkTo('allweb02.pbl',2,15,0,0,0);"/>
    </span>
    </td>
    <td style="text-align:right" bgcolor=#CCCCCC>
<form name=MarkActn action=allweb02.pbl method=post>
<input type="hidden" name="reportno" value="02">
<input type="hidden" name="updatety" value="S">
<input type="hidden" name="nextpage" value="1">  
<input type="hidden" name="urnumber" value="%ALLWEB02.02.003">
<input type="hidden" name="admissno" value="%ALLWEB02.02.101">
<input type="hidden" name="redirect" value="%ALLWEB02.02.001.allweb02.02.002">
Action Code
<select name=actncode class="selectBig NoAutoFocus">
<option></option>
%ALLWEB02.02.207.2
</select>
Comment
<input type=text name=commenty class="NoAutoFocus" size=40 maxlength=50>
<input type=submit name=markactn Value="Save Action" class="button NoAutoFocus">
</form>
</td></tr>
</table>
</span>
     
<span id="RefActAud" style="display:none">
<table width=100% border=1 cellspacing=0 cellpadding=1>
<tr><td colspan=5 class=HeadingCell style="text-align:center">
    Referral Action Audit
    </td></tr>
<tr>
    <td class=HeadingCell>Web User</td>
    <td class=HeadingCell>Date & Time</td>
    <td class=HeadingCell>Action Code</td>
    <td class=HeadingCell>Update Type</td>
    <td class=HeadingCell>Comment</td></tr>
 %ALLWEB02.02.221  
</table>
<table width=100% bgcolor=#CCCCCC><tr>
  <td style="text-align:center">
  <input type=button value="<< Previous" class="button"
   onclick='location.href="%ALLWEB02.02.219.002"'>
  <input type=button value="Next >>" class="button"
   onclick='location.href="%ALLWEB02.02.220.002"'>
</td></tr>
</table>
</span>

<form name=AddReferral method=get action=allweb02.pbl>
<input type=hidden name=reportno value=3>
<input type=hidden name=template value=1>
<input type=hidden name=urnumber value="%ALLWEB02.02.003">
<input type=hidden name=sacsvisn value="%ALLWEB02.02.101">
<input type=hidden name=allrf001 value="">
</form>

<form name=PatientLinks method=get>
<input type=hidden name=reportno value=01>
<input type=hidden name=template value=002>
<input type=hidden name=urnumber value="%ALLWEB02.02.003">
<input type=hidden name=admissno value="%ALLWEB02.02.081">
<!--Added refrlvis here-->
<input type=hidden name=refrlvis value="">
<!--End here-->
<input type=hidden name=bookflag value="">
<input type=hidden name=wbsesite value="%STANDARD.01.023">
<input type=hidden name=bwarning value="%ALLWEB02.02.213">
<input type=hidden name=ibcnumci value="%STANDARD.01.025.000.132.0.1">
<input type=hidden name=d_alref083 value="%ALLWEB02.02.144">
<input type=hidden name=d_aldep017 value="%ALLWEB02.02.509">
<input type=hidden name=wbsedall value="%STANDARD.01.028">
<input type=hidden name=d_alref119 value="%ALLWEB02.02.182.1">
<input type=hidden name=d_aldep020 value="%ALLWEB02.02.512">
</form>


<script type="text/javascript">
function ViewOutpatientLink(OptionLink) {
  switch (OptionLink.value) {
    case "0": { 
      BookPatient('%ALLWEB02.02.182.1',
                  '%ALLWEB02.02.103',
                  '%ALLWEB02.02.199.017',
                  '%ALLWEB02.02.240'); 
      break; }
    case "1": { 
      BookPatientS('%ALLWEB02.02.182.1',
                   '%ALLWEB02.02.103',
                   '%ALLWEB02.02.199.017',
                   '%ALLWEB02.02.240'); 
      break; }
    case "2": { 
      BookPatientMHCPS('%ALLWEB02.02.182.1',
                       '%ALLWEB02.02.103',
                       '%ALLWEB02.02.199.017',
                       '%ALLWEB02.02.240'); 
      break;}
    case "3": { 
      LnkVis('%ALLWEB02.02.003',
             '%ALLWEB02.02.081',
             '%ALLWEB02.02.125.1',
             '%ALLWEB02.02.240');
      break; }
    case "4": {
      OpenCareLogisticsReferral('%ALLWEB02.02.125.1',
                                '%ALLWEB02.02.195',
                                '%ALLWEB02.02.128.1',
                                '%ALLWEB02.02.122.1',
                                '%ALLWEB02.02.138.1'); 
      break; }
  }
  OptionLink.selectedIndex=0;
}
function CheckBookings() {
  if(document.PatientLinks.bwarning.value != "1" ) {
    return;
  }
  if (isWhitespace(document.PatientLinks.admissno.value)) {
   return;
  }
  var serverURL = "../cgi-bin/allweb02.pbl?reportno=6&updatety=1" +
                  "&admissno=" +
                  document.PatientLinks.admissno.value.replace(/ /g,"+")
  var returnValue = RSExecute(serverURL);
  ReturnValue=returnValue.return_value.split("|");
  if (returnValue.status==0) {
    if (ReturnValue[0] == 1) {    // Unbooked referral exists
      var message = "Warning : Unlinked outpatient appointments exist " +
                    "for this Clinic Type/Clinic Id" +
                    "\nClick OK to view appointments and link. " +
                    "Cancel to ignore.";
      if (confirm(message)) { 
        p=document.PatientLinks
        LnkVis('%ALLWEB02.02.003','%ALLWEB02.02.081','%ALLWEB02.02.125.1','%ALLWEB02.02.240');
      }
    }
  }
}

CommentIndicator="%ALLWEB02.02.218";
if ( CommentIndicator =="1" ) {
   document.all.comtbutt.className="RedButton";
}
IssueIndicator="%ALLWEB02.02.229";
if ( IssueIndicator =="1" ) {
   document.all.issubutt.className="RedButton";
}
EpisdIndicator="%ALLWEB02.02.230";
if ( EpisdIndicator =="1" ) {
   document.all.episbutt.className="RedButton";
}
LinkRIndicator="%ALLWEB02.02.232";
if ( LinkRIndicator =="1" ) {
   document.all.linkbutt.className="RedButton";
}
if ( document.PatientLinks.d_aldep020.value =="1" ) {
     InsertEpisodeButtons.style.display="none";  
}

Assessments=document.HiddenFields.deptcode.value.substr(10,1);
if ( ("%ALLWEB02.02.246.3" == "1") ||
     (Assessments == "T" || Assessments == "H") ) {
  InsertAssessButton.style.display="";  
  AssessInd="%ALLWEB02.02.236";
  if ( AssessInd =="1" ) {
    document.all.assebutt.className="RedButton";
  }
}

UsingRequestAppt="%STANDARD.01.025.032.136.0.1";
if ( ("%ALLWEB02.02.246.4" == "1") ||
     (UsingRequestAppt == "1") ){
  InsertReqAppButton.style.display="";  
  RequestAppt="%ALLWEB02.02.239";
  if ( RequestAppt == "1" ) {
    document.all.reqabutt.className="RedButton";
  }
}

UsingExtRef="%ALLWEB02.02.246.1";
if (UsingExtRef == "1") {
  ExtRefBut.style.display="";
}
UsingResAdm="%ALLWEB02.02.246.2";
if (UsingResAdm == "1") {
  ResAdmBut.style.display="";
}
DisplayLast5Contacts="%ALLWEB02.02.246.5";
if (DisplayLast5Contacts == "1") {
  Last5Contacts.style.display="";
}
DisplayClinicDoc="%ALLWEB02.02.246.6";
if (DisplayClinicDoc == "1") {
  ClinicDoc.style.display="";
}
DisplayActAud="%ALLWEB02.02.246.7";
if (DisplayActAud == "1") {
  RefActAud.style.display="";
}
DisplayLetHis="%ALLWEB02.02.246.8";
if (DisplayLetHis == "1") {
  LetterHistory.style.display="";
}

var spRefConLine = document.getElementById('spRefConLne');
var spExtRefApp = document.getElementById('spExtRefApp');
var spServLine = document.getElementById('spServLne');

spRefConLine.innerHTML = document.HiddenFields.d_refcon.value;
spExtRefApp.innerHTML = document.HiddenFields.d_extapp.value.substring(0,50);
spServLine.innerHTML = document.HiddenFields.d_servce.value;

if (trim(document.HiddenFields.d_extapp.value) == "eReferrals") {
  document.getElementById('eRefButtons').style.display = "";
}

function SetFormFocus() {
  if (document.activeElement && (document.activeElement.type == undefined)) {
    if (document.all.btnUpdate) document.all.btnUpdate.focus();
  }
}

function BookingInstr() {
  linkUrl="allweb02.pbl?reportno=11&template=001" +
    "&urnumber=" + document.PatientLinks.urnumber.value.replace(/ /g,"+") +
    "&admissno=" + document.PatientLinks.admissno.value.replace(/ /g,"+");
  Left=(document.body.clientWidth-900)/2
  DFrameLink(linkUrl,100,Left,950,520)
}

function LinkToRef() {
  var URL = trim("%ALLWEB02.02.525");
  var sExtRefID = "%ALLWEB02.02.199.028";
  if (URL.length > 0 ) {
    URL += ("?referralId=" + sExtRefID);
    NewWindow = openNewWindow(URL,"eReferrals");
  }
}

</script>
