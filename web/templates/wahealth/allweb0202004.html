<meta name="TemplateVersion" content="V12.01.00">
<meta name="TemplateHome" content="wahealth">
<meta name="HelpFileName" content="NoContextSet.html">
<meta name="CrossBrowser" content="true">
<script type="text/javascript" src="../js/allweb0202004.js"></script>
<script>
function PageLoadExtended(event)
{
  PageLoad(event);
  checkIfSACClosure();
  checkIfPCRMandatory();
}

function checkIfPCRMandatory() {
  if ((document.UpdateForm.ptcnhdps.value == "3") ||
      (document.UpdateForm.ptcnhdps.value == "1")) {
    document.UpdateForm.alref072.className="Mandatory";
  }
}

function checkIfSACClosure()
{
  var alreuyn4 = document.getElementById("sacs_master");
  var alref006 = document.getElementById("alref006");
  var placeHolder = document.getElementById("reasonForClosurePlaceHolder");

  if (document.UpdateForm.ptcnhdps.value!="3") {  // Not Victoria
    alref006.className ="Mandatory";
    return;
  }
  if (alreuyn4.value.replace(/ /g,"") == "Yes")
  {
    placeHolder.style.display="none";
    if (alref006)
      alref006.className = "";
  }
  else
  {
    placeHolder.style.display="";

    if (alref006)
      alref006.className ="Mandatory";
  }
}
function OpdMessage() {
  if(document.UpdateForm.wbseopdu.value.substr(3,1)=="O") {
    OpDirectMessage.innerHTML=ShowOpDirectMessage.innerHTML;
    if(document.UpdateForm.refstats.value=="Closed    ") {
      document.UpdateForm.opdcommt.disabled=true;
    }
  }
}
function CloseButtonRedirect() {
  OutpatientList=GetContentCookie("OutpatientList");
  if(OutpatientList=="unknown") {
    DFrameClose();
  } else {
    getTop().content.location.href=OutpatientList 
  }
}
function RedirectExit() {
  OutpatientList=GetContentCookie("OutpatientList");
  if(OutpatientList=="unknown") {
    DFrameExit();
  } else {
    getTop().content.location.href=OutpatientList
  }
}
function OKButtonRedirect() {
  document.UpdateForm.nextpage.value="";
  document.UpdateForm.redirect.value="";
  document.UpdateForm.redirec1.value="";
  OutpatientList=GetContentCookie("OutpatientList");
  if(OutpatientList!="unknown") {
    document.UpdateForm.nextpage.value="7";
    if(OutpatientList.length>240) {
      document.UpdateForm.redirect.value=OutpatientList.substr(0,240);
      document.UpdateForm.redirec1.value=OutpatientList.substr(240);
    } else {
      document.UpdateForm.redirect.value=OutpatientList;
    }
  }
  CloseReferral();
}

</script>
</head>
%START.OF.PAGE
<body onload="PageLoadExtended(event);OpdMessage();">
<span class=DFrameTitleBar>
<img align=right alt="Exit" class="MenuIcon" 
 src="../images/ExitIcon.gif" onclick="RedirectExit()">
Close a Referral    
</span>
<form id=UpdateForm name=UpdateForm action="allweb02.pbl" method=post
 onsubmit='return validateMandatory(this);'>

<input type=hidden name=reportno value="2">
<input type=hidden name=updatety value="C">
<input type=hidden name=urnumber value="%ALLWEB02.02.003">
<input type=hidden name=admissno value="%ALLWEB02.02.081">
<input type=hidden name=MenuType value="%ALLWEB02.02.088">
<input type=hidden name=deptcode value="%ALLWEB02.02.125.3">
<input type=hidden name=alref036 value="">
<input type=hidden name=alref083 value="">
<input type=hidden name=dummy value="">
<input type=hidden name=checkappt value="0">
<input type=hidden name=sacs_master value="%ALLWEB02.02.144">
<input type=hidden name=d_alref164 value="%ALLWEB02.02.199.039">
<input type=hidden name=ptcnhdps value="%STANDARD.01.025.080.250.1.1">
<input type=hidden name=d_alref049 value="%ALLWEB02.02.140.10.1">
<input type=hidden name=wbseopdu value="%STANDARD.01.037.3">
<input type=hidden name=refstats value="%ALLWEB02.02.103">
<input type=hidden name=nextpage value="">
<input type=hidden name=redirect value="">
<input type=hidden name=redirec1 value="">
<input type=hidden name=fapbookd value="%ALLWEB02.02.199.034">
<input type=hidden name=fapnotfd value="%ALLWEB02.02.199.036">

<table align=center cellspacing=0 cellpadding=2 border=0 width=95%>
<tr><td class=DataLabel width=20%>Department</td>
  <td><input readonly type=text value="%ALLWEB02.02.125.0" 
       class=Readonly></td>
    <td class=DataLabel>Entered by</td>
    <td><input readonly type=text class=Readonly  
         value="%ALLWEB02.02.163">
        <input type=hidden name="d_wbsehosp" value="%STANDARD.01.032">
    </td>
</tr>
<tr><td class=DataLabel>Date Closed</td>
 <td class=DataLabel><input type=text name=alref007 value="%ALLWEB02.02.107" 
     id=alref007 title="Date Closed" class="PastDate Mandatory">
    <img src=../images/DateLookup.gif class=Icon date=date1
     align=absmiddle onclick="DateLookupFrame(alref007);">
     Time<input type=text size=6 title="Time" value="%ALLWEB02.02.108" 
        class="Mandatory Time" id=alref008 name=alref008>
    <img src="../images/DateTimeStamp.gif" class=Icon 
      onclick="SetCurrentDateTime(alref007,alref008);">
    <img src="../images/TimeLookup.gif" class=Icon time=time1
      onclick="TimeLookupFrame(alref008);">
    </td>
</tr>
</table>
    
<div id="reasonForClosurePlaceHolder">

<table  align=center cellspacing=0 cellpadding=2 border=0 width=95%>
<tr>
    <td class=DataLabel width=20%>Reason for Closure</td>
    <td>
      <select id=alref006 name=alref006  title="Reason for Closure">
        <option></option>
         %ALLWEB02.02.106.2
        </select>
    </td>
</tr>
</table>
</div>

<table  align=center cellspacing=0 cellpadding=2 border=0 width=95%>
<tr><td class=DataLabel>Comment</td>
    <td class=DataLabel>
       <input type=text id="commenty" value="%ALLWEB02.02.233"
       name=commenty size=51 maxlength=50>
    </td>
</tr>

<tr><td class=DataLabel width=20%>Program Completion Reason</td>
    <td><select name=alref072 title="Program Completion Reason" />
        <option></option>
         %ALLWEB02.02.140.33.2
        </select></td>
</tr>

<tr><td class=DataLabel>Date of Next Review</td>
 <td class=DataLabel><input type=text size=12 name=alref037 
     value="%ALLWEB02.02.137" id=alref037
     title="Date of Next Review" >
    <img src=../images/DateLookup.gif class=Icon date=date1
     align=absmiddle onclick="DateLookupFrame(alref037);">
    <img src="../images/DateTimeStamp.gif" class=Icon
      onclick="SetCurrentDateTime(alref037);">
    </td>
</tr>
</table>

<div id=InsertSACS></div>
<span id=OpDirectMessage></span>

<table align=center cellspacing=0 cellpadding=2 border=0 width=95%>
<tr><td colspan=4 align=center><br>
    <input type=button value="Ok" id=okbutton name=okbutton class="button"
     onclick="tempDisable(this); OKButtonRedirect();">
    <input type=button Value="Cancel" class="button"
     title="Cancel - Do not Close the Referral (leave Open/Active)" 
   onclick="CloseButtonRedirect();">
    </td>
</tr>
</table>
</form>
<div id="ShowSACSFields" style="display:none;">
<table align=center cellspacing=0 cellpadding=2 border=0 width=95%>
<tr>
 <td class=DataLabel width=137>Case End Date</td>
 <td class=DataLabel><input type=text name=alref136 value="%ALLWEB02.02.199.007"
     title="Case End Date" class="Mandatory PastDate" id=alref136>
    <img src=../images/DateLookup.gif class=Icon date=date1
     align=absmiddle onclick="DateLookupFrame(alref136);">
     Time &nbsp;<input type=text size=6 title="Time" value="%ALLWEB02.02.199.008"
        class="Mandatory Time" id=alref137 name=alref137>
    <img src="../images/DateTimeStamp.gif" class=Icon
      onclick="SetCurrentDateTime(alref136,alref137);">
    <img src="../images/TimeLookup.gif" class=Icon time=time1
      onclick="TimeLookupFrame(alref137);">
    </td>
</tr>
</table>
</div>

<span id=ShowOpDirectMessage style="display:none">
<table cellspacing=0 cellpadding=1 border=0 width=95% align=center>
<tr><td width=20% valign=top class=DataLabel>OPD Message </td>
         <td colspan=6 align=left>
         <textarea wrap=hard name=opdcommt rows=4
           cols=60>%ALLWEB02.02.243</textarea></td></tr>
<tr><td>&nbsp;</td></tr>
</table>
</span>


<script type="text/javascript">
//
 var InsertSACS = document.getElementById('InsertSACS');

 InsertSACS.innerHTML="";

 var BulkBill = "%ALLWEB02.02.136";
 if ( BulkBill == "Yes") {
   document.UpdateForm.alref036.value=1;
 }

 var SACSRef="%ALLWEB02.02.144";
 if ( SACSRef == "Yes" ) {
   if (document.UpdateForm.ptcnhdps.value == "3") {  // only Victoria
     InsertSACS.innerHTML = document.getElementById('ShowSACSFields').innerHTML;
   }
   document.UpdateForm.alref083.value = 1;
  } else {
   document.UpdateForm.alref083.value = 0;
  }
 
 var comment = document.getElementById("commenty");
 Status="%ALLWEB02.02.103"
 if (Status=="Closed    "){
    if (comment)
    {
     comment.readOnly = true;
     comment.className = "Readonly";
    }
    document.UpdateForm.okbutton.disabled = true;
 } else {
    if (comment)
       comment.value = ""; //blank comment if new close
    document.UpdateForm.alref007.value = "%STANDARD.01.015";
    document.UpdateForm.alref008.value = "%STANDARD.01.016";
 }

 // Do not add 'var' to the 2 variables below as they need to stay global.
 VINAH_Ref = (document.UpdateForm.deptcode.value.substr(10,1));
 CloseMaster = "%ALLWEB02.02.520";

 if ((VINAH_Ref == "T" || VINAH_Ref == "H") && 
      document.UpdateForm.alref083.value!="1") {
   if (isWhitespace(document.UpdateForm.d_alref164.value)) {
    alert("The advanced care plan documented date is a mandatory field " +
          "prior to closing this referral\n"  +
          "Please update via the update referral page");
    document.UpdateForm.okbutton.disabled = true;
    }
    AssessCount = "%ALLWEB02.02.237"
    if (parseInt(AssessCount,10) < 2) {
       alert("Two assessments are a mandatory " +
             "prior to closing this referral\n"  +
             "Please add via the assessment page");
       document.UpdateForm.okbutton.disabled = true;
    }
 }
 if ((VINAH_Ref == "T" || VINAH_Ref == "H" || VINAH_Ref == "S") &&
     document.UpdateForm.alref083.value!="1") {
   mainHealthRecord = "%ALLWEB02.02.808";
   if (mainHealthRecord != 1) {
      alert("The main health condition is mandatory " +
            "prior to closing this referral\n"  +
            "Please add via the update referral page");
      document.UpdateForm.okbutton.disabled = true;
   }
 }
 if (VINAH_Ref == "P" && document.UpdateForm.alref083.value!="1" &&
     isWhitespace(document.UpdateForm.d_alref049.value)) {
     alert("The death place is mandatory " +
           "prior to closing this referral\n"  +
           "Please add via the update referral page");
     document.UpdateForm.okbutton.disabled = true;
 }
 if ((VINAH_Ref == "S"  || VINAH_Ref == "H" || VINAH_Ref == "O"
     || VINAH_Ref == "P" || VINAH_Ref == "R" || VINAH_Ref == "A") &&
      document.UpdateForm.alref083.value!="1" ) {
   referralDestination = "%ALLWEB02.02.813"
   if (referralDestination != 1) {
      alert("Warning no referral out details have been " +
            "captured for this referral");
   }
 }
 if ((VINAH_Ref == "O") &&
      document.UpdateForm.alref083.value!="1" ) {
    if(document.UpdateForm.fapbookd.value==""||
       document.UpdateForm.fapnotfd.value==""){
      alert("The First Appointment Booked and Notified of First \n" +
            "Appointment is mandatory prior to closing this referral. \n" +
            "Please add via the update referral page");
      document.UpdateForm.okbutton.disabled = true;
    }
  }
</script>
