<meta name="TemplateVersion" content="V12.01.00">
<meta name="TemplateHome" content="wahealth">
<meta name="HelpFileName" content="NoContextSet.html">
<meta name="CrossBrowser" content="true">
<script type="text/javascript" src="../js/websec01.js"></script>

%START.OF.PAGE

<script type="text/javascript">
  function LoadHospDetails(){

    var p = document.changesite;
    var l = "%WEBSEC01.05.035.1";
    var d = "%WEBSEC01.05.051.1";

    if(!isWhitespace(p.d_redirect.value)) {
      p.target="";
      p.redirect.value=p.d_redirect.value        // Update redirect 
    }
    ChangeHospital();

    for(var j=0; j<p.wbsec032.options.length; j++){
      var locationOption = p.wbsec032.options[j].value.substr(0,3);
      if(l==locationOption){
        p.wbsec032.selectedIndex = j;
        break;
      }
    }

    for(var i=0; i<p.wbsec021.options.length; i++){
      var departmentOption = p.wbsec021.options[i].value.substr(0,3);
      if(d==departmentOption){
        p.wbsec021.selectedIndex = i;
        break;
      }
    }

  }

  function ChangeHospital(){

    var p = document.changesite;
    var hospcode = p.wbsec031;
    var reportnumber = "68";

    selectOptions2(reportnumber,hospcode,p.wbsec021);
	filterCatCodeList(p.wbsec021,"3"," ","1");
//    SelectOptionsHospCatCode(p.ctcode,hospcode,p.wbsec032);
    if(p.ibcnmhos.value=="1") {
      SelectOptionsHospCatCode(p.ctcode,hospcode,p.wbsec032);
    } else {
      selectOptions3('15',p.ctcode,p.wbsec032);
    }

// custom [[
	DefaultHospFields();
// ]]
  }

  function ClearClinic(){

    document.changesite.wbsec007.value = "";
    document.changesite.name_wbsec007.value = "";

  }

  function ValidateOC(field){

    var p = document.changesite;

    if(p.wbsec007.value!=""){
      UpCase(field);
      validateClinic(p.wbsec006,p.wbsec007,p.name_wbsec007);
    }

  }

  function PostChangeSite() {
  if(validateMandatory(changesite)) {
     ExpireCookiePath("FilterColumn");
     ExpireCookiePath("FilterValue");
     ExpireCookiePath("FilterLocation");
     document.changesite.submit(); 
	}
}
// custom [[
	function DefaultHospFields() {
	
		var hospital   = document.changesite.wbsec031;
		var ward       = document.changesite.wbsec005;
		var edSite     = document.changesite.wbsec010;
		var printGroup = document.changesite.wbsec017;
		var opSite     = document.changesite.wbsec006;
		
		// Update the select options for Emergency Site, Ward and Printer Group
		// the those valid for the selected hospital
		selectOptions2('63',hospital,edSite);
		selectOptions2('3',hospital,ward);
		selectOptions2('64',hospital,printGroup);

		// Get the default Emergency Site, Ward and Printer Group
		var defaults = getDefaultFields(hospital);
		
		// Select the default Emergency Site, Ward and Printer Group options
		selectOption(edSite, defaults.edSite);
		selectOption(ward, defaults.ward);
		selectOption(printGroup, defaults.printGroup);
		// Select the Outpatient site to match the hospital site and disable other sites
		selectOption(opSite, hospital.value, true);
	}
	
	function getDefaultFields(hospital) {
		var defaults = {
			edSite: "",
			ward: "",
			printGroup: ""
		};
	  
		if (!isWhitespace(hospital.value)) {
			var serverURL   = "../cgi-bin/comweb80.pbl?reportno=65" +
								"&valdcode=" + hospital.value.replace(/ /g,"+")
			var returnValue = RSExecute(serverURL);
			if (returnValue.status==0) {
				ReturnValue=returnValue.return_value.split("|");
				defaults.ward = ReturnValue[0];
				defaults.edSite = ReturnValue[1];
				defaults.printGroup = ReturnValue[2];
			}
		}
		return defaults;
	}
	
	function selectOption(element,defaultValue,disableOthers) {
	    if (arguments.length < 3)
			disableOthers= false;
			
		var oldSelection = element.selectedIndex;
		
		// Choose the only available one if no default
		if (isWhitespace(defaultValue)) {
			if (element.length==2) {
				element.selectedIndex=0; 
			}
		} 
		else {
			element.selectedIndex=0; 
			for (var i =0 ; i < element.length; i++) {
				if (trim(element.options[i].value.substr(0,defaultValue.length)) == trim(defaultValue.substr(0))) {
				   element.selectedIndex=i;
					element.options[i].disabled = false;
				} 
				else if (element.options[i].value != "") {
					element.options[i].disabled = true && disableOthers;
				}
			}
		}

		// fire the onchange event if selecting a new option
		if (element.selectedIndex != oldSelection && element.onchange != null) { 
			element.onchange();
		}
	}
// ]]
</script>
</head>

<body onLoad="LoadHospDetails();PageLoad();">
  <br>
  <br>
<form name=changesite method=post target=_top style="margin:0" >
<input type=hidden name=reportno value="5">
<input type=hidden name=template value="1">
<input type=hidden name=updttype value="U">
<input type=hidden name=wbsec011 value=1>
<input type=hidden name=username value="%WEBSEC01.05.001">
<input type=hidden name=wbsec029 value="%WEBSEC01.05.032">
<input type=hidden name=nextpage value="1">
<input type=hidden name=redirect value="websec01.pbl?reportno=1&template=1">
<input type=hidden name=wbsec014 value="%WEBSEC01.05.017.1">
<input type=hidden name=wbsec015 value="%WEBSEC01.05.018">
<input type=hidden name=cgcode value="CG">
<input type=hidden name=ctcode value="CT">
<input type=hidden name=chnghosp value=1>
<input type=hidden name=d_redirect value="%WEBSEC01.05.077">
<input type=hidden name=ibcnmhos value="%STANDARD.01.025.000.043.1.1">

  <table border=2 cellspacing=0 align=center bgcolor=#CCCCCC>

    <tr>
      <td align=center class=HeadingCell>Change Site</td>
    </tr>

    <tr>
      <td>
        <table width=500>

          <tr>
            <td class=DataLabel width=30%>User</td>
            <td>
              <input type=text name=name class="Readonly"
               value="%WEBSEC01.05.002" readonly>
            </td>
          </tr>

<!--          <div id=InsertHospital></div> -->
<!-- custom [[ -->
          <tr>
            <td class=DataLabel width=30%>Hospital ID</td>
            <td>
              <select name=wbsec031 onchange="ChangeHospital()" 
               class="Mandatory" title="Hospital ID" style="width: 200px;">
                <option></option>
                %WEBSEC01.05.034.5
              </select>
            </td>
          </tr>

			<tr>
				<td class=DataLabel>Emergency Site</td>
				<td><select name=wbsec010 style="width: 200px;" title="Emergency Site">
					<option></option>
					%WEBSEC01.05.010.3
					</select></td>
			</tr>
			<tr>
				<td class=DataLabel>Ward </td>
				<td><select name=wbsec005 style="width: 200px;" title="Ward">
					<option></option>
					%WEBSEC01.05.005.2
					</select></td>
			</tr>
<!-- ]] -->

</table>
        <table width=500>
          <tr>
            <td class=DataLabel>Outpatient Site</td>
            <td>
              <select name=wbsec006 
               onchange="ClearClinic();" class="Mandatory"
               title="Outpatient Site" style="width: 200px;">
                <option></option>
                %WEBSEC01.05.076
              </select>
            </td>
          </tr>
          <tr>
            <td class=DataLabel width=30%>Outpatient Clinic</td>
            <td>
              <input type=text name=wbsec007 title="Clinic ID" 
               style="width: 80px;" maxlength=6 value="%WEBSEC01.05.007"
               onblur="ValidateOC(this)"> 
              <input type=text name=name_wbsec007 class="Readonly" title="Clinic Id"
               size=30 maxlength=25 value="" readonly>
              <img class=Icon src=../images/SearchIcon.gif
               onclick="ClinicSessionSearchFrameSite(changesite.wbsec006,
                        changesite.wbsec007,changesite.name_wbsec007);">
              <img src="../images/erase.gif" class=Icon
               onclick="clrDoc(changesite.wbsec007,changesite.name_wbsec007);">
            </td>
          </tr>
          <tr>
            <td>Clinic Location</td>
            <td>
              <select name=wbsec032 style="width: 200px;">
                <option></option>
              </select>
            </td>
          </tr>

          <tr>
            <td class=DataLabel>Department</td>
            <td>
              <select name=wbsec021 style="width: 200px;">
                <option></option>
              </select>
            </td>
          </tr>
<!-- custom [[ -->
			<tr>
				<td class=DataLabel>Printer Group</td>
				<td><select name=wbsec017 style="width: 200px;" title="Printer Group">
					<option></option>
					%WEBSEC01.05.020.2
					</select></td>
			</tr>
<!-- ]] -->
        </table>

        <br>

        <table border=0 cellspacing=0 align=center bgcolor=#CCCCCC>
          <tr>
            <td colspan=2 align=center>
              <input type=button class="button" value="Change" id="Changbutton"
	       onclick="tempDisable(this);PostChangeSite();">
              <input type=button class="button" value="Cancel"
               onclick="parent.content.history.go(-1);">
            </td>
          </tr>
        </table>

      </td>
    </tr>
  </table>
</form>

<div id=Hospital style="display: none">
<table width=500>
<tr>
   <td class=DataLabel width=30%>Hospital ID</td>
   <td>
   <select name=wbsec031 onchange="ChangeHospital();" 
    class="Mandatory" title="Hospital ID" style="width: 200px;">
   <option></option>
    %WEBSEC01.05.034.5
   </select>
   </td></tr>
</table>
</div>

<div id=NoHospital style="display: none">
<input type=hidden name=wbsec031 value="  ">
</div>

  <script type="text/javascript">

    var p = document.changesite;

      // Populate the Outpatient Clinic Description
      // if both the O/P Site & O/P Clinic Code exist
    if(p.wbsec006.value!="" && p.wbsec007.value!=""){
      validateClinic(p.wbsec006,p.wbsec007,p.name_wbsec007);
    }
    var p = document.changesite;
    filterCatCodeList(p.wbsec021,"3"," ","1");
  </script>
