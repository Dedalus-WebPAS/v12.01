<meta name="TemplateVersion" content="V12.01.00">
<meta name="TemplateHome" content="wahealth">
<meta name="HelpFileName"    content="NoContextSet.html">
<meta name="CrossBrowser" content="true">
<script type="text/javascript" src="../js/mehweb0109002.js"></script>

<script type="text/javascript">
function FormSubmit() {
//alert(document.AddForm.mhhls033.value.substr(3,1));
  if (document.AddForm.mhhls033.value.substr(3,1)=="I") {
    if (document.AddForm.oprefind.value=="1") {
      alert("Open Inpatient MH Referrals still exist. Please close.");
      return;
    }
  }

  strtDate = AddForm.mhhls002;
  strtTime = AddForm.mhhls003;
  endDate  = AddForm.mhhls004;
  endTime  = AddForm.mhhls005;
  if(!ChkDateTime(strtDate,strtTime,endDate,endTime)) {
     alert("Start Date/Time must be before End Date/Time");
     AddForm.mhhls002.select();
     return;
  }

  SetCurrentDateTimeNoFocus(document.AddForm.currdate,document.AddForm.currtime);

  if (!isWhitespace(document.AddForm.mhhls002.value)&&
      !isWhitespace(document.AddForm.mhhls003.value)) {
  if (SetDateYYYYMMDD(document.AddForm.mhhls002.value)==
      SetDateYYYYMMDD(document.AddForm.currdate.value)) {
//alert(document.AddForm.mhhls003.value+" "+document.AddForm.currtime.value);
    if (document.AddForm.mhhls003.value > document.AddForm.currtime.value) {
      alert("Start Time cannot be in the future.");
      return;
    }
  }
  }

   patntdob = AddForm.patntdob;
   patntdbt = AddForm.patntdbt;

  if (!ChkDateTime(patntdob,patntdbt,strtDate,strtTime)) {
    alert("Start Date/Time must be after Patient's Date of Birth.");
    AddForm.mhhls002.select();
    return;
  }


  document.AddForm.mhhls006.value="0";
  document.AddForm.mhhls018.value="1";

  prevDate = document.AddForm.prevdate;
  prevTime = document.AddForm.prevtime;

 if(prevDate.value=="99999999") {
  if (!confirm("Warning: Current Referral is still Open.\n Ok to Continue ?")) {
    return;
  }
 }

 if(prevDate.value!="") {
  if(ChkDateTime(strtDate,strtTime,prevDate,prevTime)) {
   if (!confirm("Warning: New Start Date overlaps with Current Referral.\n Ok to Continue ?")) {
    return;
    }
  }
 }

 SubmitForm();
}

function ShowClinician() {
    if (document.AddForm.mhhls033.value.substr(3,1)=="I") {
        document.getElementById("RefClin1").innerHTML=
        document.getElementById("RefClinicInp").innerHTML;
        document.getElementById("RefClin2").innerHTML=
        document.getElementById("RefClinicRoleInp").innerHTML;
        document.getElementById("RefClin3").innerHTML=
        document.getElementById("RespClinic").innerHTML;
//      AdmRdate.innerHTML=RecDate.innerHTML;
//      AdmAdate.innerHTML=ActDate.innerHTML;
        document.getElementById("AdmRdate").innerHTML="";
        document.getElementById("AdmAdate").innerHTML="";

	GetTeam();

    } else {
        document.getElementById("RefClin1").innerHTML=
        document.getElementById("RefClinician").innerHTML;
        document.getElementById("RefClin2").innerHTML=
        document.getElementById("RefClinicRole").innerHTML;
        document.getElementById("RefClin3").innerHTML=
        document.getElementById("OutpatTeam").innerHTML;
        document.getElementById("AdmRdate").innerHTML="";
        document.getElementById("AdmAdate").innerHTML="";
    }
//    for (var i =0 ; i < document.AddForm.mhhls022.length; i++) {
//      if (trim(document.AddForm.pmvxteam.value)==
//          trim(document.AddForm.mhhls022.options[i].value)){
//            document.AddForm.mhhls022.selectedIndex=i;
//      }
//    }
}

function GetTeam()
{
  if (isWhitespace(document.AddForm.mhhls021.value))
  {
    return;
  }

  var serverURL = "../cgi-bin/comweb80.pbl?reportno=56" +
                "&valdcode=" + document.AddForm.mhhls021.value.replace(/ /g,"+")

  var returnValue = RSExecute(serverURL);
//alert(returnValue.return_value);
  if (returnValue.status==0) 
  {
    document.AddForm.mhhls022.options.length=0
    document.AddForm.mhhls022.options[document.AddForm.mhhls022.options.length]=
    new Option("","");
    ReturnValue=returnValue.return_value.split("|");
    for (var j=0; j < ReturnValue.length; j++) {
       if (!isWhitespace(ReturnValue[j])) {
         SelectValue=ReturnValue[j].split(",");
    document.AddForm.mhhls022.options[document.AddForm.mhhls022.options.length]=
          new Option(SelectValue[1],SelectValue[0]); } } }

}

</script>
</head>
%START.OF.PAGE
<body onload="PageLoad(event);ShowClinician();">
<span class=DFrameTitleBar>
<img align="right" alt="Exit" class="MenuIcon"
 src="../images/ExitIcon.gif" onclick="DFrameExit();">
Legal Status Referral Management Details
</span>
<div id=PageBodySection >
<form name=AddForm method=post action=mehweb01.pbl style="margin:0">
<input type=hidden name=urnumber value="%MEHWEB01.09.003">
<input type=hidden name=admissno value="%MEHWEB01.09.081">
<input type=hidden name=uniqnumb value="%MEHWEB01.09.207">
<input type=hidden name=prevdate value="%MEHWEB01.09.320.1">
<input type=hidden name=prevtime value="%MEHWEB01.09.320.2">
<input type=hidden name=visittyp value="%MEHWEB01.09.605">
<input type=hidden name=reportno value=9>
<input type=hidden name=template value="002">
<input type=hidden name=updttype value="A">
<input type=hidden name=redirect value="%MEHWEB01.09.001.mehweb01.09.005">
<input type=hidden name=nextpage value="1">
<input type=hidden name=mhhls006>
<input type=hidden name=mhhls018>
<input type=hidden name=pmvxteam value="%MEHWEB01.09.698.046.1">
<input type=hidden name=oprefind value="%MEHWEB01.09.326">
<input type=hidden name=currdate>
<input type=hidden name=currtime>
<input type=hidden name=admnstat value="%MEHWEB01.09.332">
<input type=hidden name=patntdob value="%MEHWEB01.09.020">
<input type=hidden name=patntdbt value="00:00:00">

<table cellspacing=0 cellpadding=1 border=0 width=100%>

    <tr><td class=DataLabel width=20%>Start Date </td>
        <td><input type=text size=12 name=mhhls002 tabindex=1
             class="Mandatory Date NotFuturEdate" title="Start Date">
          <img notab src=../images/DateLookup.gif class="Icon"
           onclick="DateLookupFrame(AddForm.mhhls002);">
          Time
       <input class=Mandatory type=text name=mhhls003 size=8 tabindex=2
          title="Start Time">
        <img notab src=../images/DateTimeStamp.gif class="Icon"
         onclick="SetCurrentDateTime(AddForm.mhhls002,AddForm.mhhls003);">
       <img notab src=../images/TimeLookup.gif class="Icon"
        onclick="TimeLookupFrame(AddForm.mhhls003);">
          </td>
      </tr>

    <tr><td class=DataLabel>End Date </td>
        <td><input type=text size=12 name=mhhls004 tabindex=3
             class="date" title="End Date"
            onblur="ChkEndDate(AddForm.mhhls002,AddForm.mhhls004,
                    AddForm.mhhls003,AddForm.mhhls005);">
          <img notab src=../images/DateLookup.gif class="Icon"
           onclick="DateLookupFrame(AddForm.mhhls004);">
          Time
       <input type=text name=mhhls005 size=8 tabindex=4 title="End Time"
          onblur="ChkEndTime(AddForm.mhhls002,AddForm.mhhls004,
                  AddForm.mhhls003,AddForm.mhhls005);">
        <img notab src=../images/DateTimeStamp.gif class="Icon"
         onclick="SetCurrentDateTime(AddForm.mhhls004,AddForm.mhhls005);">
       <img notab src=../images/TimeLookup.gif class="Icon"
        onclick="TimeLookupFrame(AddForm.mhhls005);">
          </td>
      </tr>
</table>

<table cellspacing=0 cellpadding=1 border=0 width=100%>
<tr><td class=DataLabel width=20%>Origin of Referral</td>
    <td><select name=mhhls033 title="Origin of Referral" tabindex=11
         class=Mandatory onchange="ShowClinician();">
        <option></option>
        %STANDARD.01.007.tm
        </select></td>
</tr>
</table>

    <div id="RefClin1"></div>
    <div id="RefClin2"></div>

<table cellspacing=0 cellpadding=1 border=0 width=100%>
<tr><td class=DataLabel width=20%>Case Manager/Key Worker</td>
    <td><input type="text" size=10 maxlength=10 name="mhhls024" tabindex=9
       onblur="UpCase(this);ValidateHCP(18,18,AddForm.mhhls024,
               AddForm.doctnam4);">
       <input type="text" size=25 notab readonly name="doctnam4">
       <img src="../images/SearchIcon.gif" class=Icon
        onclick="HCPSearchFrame(AddForm.mhhls024,AddForm.doctnam4,9);">
    <img src="../images/erase.gif" class="Icon" 
     onclick="clrFields(AddForm.mhhls024,AddForm.doctnam4);">
       <td>
    </tr>
</table>

    <div id="RefClin3"></div>

    <div id="AdmRdate"></div>
    <div id="AdmAdate"></div>

<table cellspacing=0 cellpadding=1 border=0 width=100%>
    <tr align=center>
       <td colspan=4 align=center><br>
       <input type=button value="Add" class="button" tabindex=30
        onclick=FormSubmit();>
       <input type=button value=Close class="button" tabindex=31
        onclick="DFrameExitRefresh();">
     </td></tr>
</table>
</form>

<form name=PatientLinks method=get style="margin:0">
<input type=hidden name=reportno value=1>
<input type=hidden name=template value="004">
<input type=hidden name=urnumber value="%MEHWEB01.09.003">
<input type=hidden name=admissno value="%MEHWEB01.09.081">
<input type=hidden name=MenuType value="%MEHWEB01.09.088">
<input type=hidden name=webuseid value="%STANDARD.01.008">
</form>
</div>

<div id="RefClinician" style="display:none">
<table cellspacing=0 cellpadding=1 border=0 width=100%>
<tr><td class=DataLabel width=20%>Referring Clinician</td>
   <td><input type="text" size=10 maxlength=10 name=mhhls034 tabindex=5
    onblur="ValidateHCP(18,0,AddForm.mhhls034,AddForm.genpname);
            selectOptions2('48',AddForm.mhhls034,AddForm.mhhls035);">
    <input type=text size=25 notab readonly name=genpname>
    <img src="../images/SearchIcon.gif" class="Icon"
    onclick="HCPSearchFrame(AddForm.mhhls034,AddForm.genpname,1)">
    <img src="../images/erase.gif" class="Icon" 
     onclick="clrFields(AddForm.mhhls034,AddForm.genpname);"> </td>
</tr>
</table>
</div>

<div id="RefClinicRole" style="display:none">
<table cellspacing=0 cellpadding=1 border=0 width=100%>
<tr><td class=DataLabel width=20%>Referring Clinician (Role)</td>
    <td><select name=mhhls035 tabindex=6
         title="Clinician Referring Under MH Act (Role)" class=SelectBig>
         <option> </option>
         %MEHWEB01.09.752.2
         </select>
    </td>
</tr>
</table>
</div>


<div id="RefClinicInp" style="display:none">
<table cellspacing=0 cellpadding=1 border=0 width=100%>
<tr><td class=DataLabel width=20%>Referring Clinician</td>
   <td><input type="text" size=10 maxlength=10 name=mhhls034 tabindex=5
    onblur="ValidateHCP(18,0,AddForm.mhhls034,AddForm.genpname);
            selectOptions2('48',AddForm.mhhls034,AddForm.mhhls035);">
    <input type=text size=25 notab readonly name=genpname>
    <img src="../images/SearchIcon.gif" class="Icon"
    onclick="HCPSearchFrame(AddForm.mhhls034,AddForm.genpname,1);">
    <img src="../images/erase.gif" class="Icon" 
     onclick="clrFields(AddForm.mhhls034,AddForm.genpname);"> </td>
</tr>
</table>
</div>

<div id="RefClinicRoleInp" style="display:none">
<table cellspacing=0 cellpadding=1 border=0 width=100%>
<tr><td class=DataLabel width=20%>Referring Clinician (Role)</td>
    <td><select name=mhhls035 tabindex=6
         title="Clinician Referring Under MH Act (Role)" class=SelectBig>
         <option> </option>
         %MEHWEB01.09.752.2
         </select>
    </td>
</tr>
</table>
</div>

<div id="RespClinic" style="display:none">
<table cellspacing=0 cellpadding=1 border=0 width=100%>
<tr><td class=DataLabel width=20%>Responsible Clinician</td>
   <td><input type="text" size=10 maxlength=10 name=mhhls021 tabindex=9
    onblur="ValidateHCP(18,0,AddForm.mhhls021,AddForm.genpnam1);GetTeam();">
    <input type=text size=25 notab readonly name=genpnam1>
    <img src="../images/SearchIcon.gif" class="Icon"
    onclick="HCPSearchFrame(AddForm.mhhls021,AddForm.genpnam1,1);">
    <img src="../images/erase.gif" class="Icon" 
     onclick="clrFields(AddForm.mhhls021,AddForm.genpnam1);"> </td>
</tr>
<tr><td class=DataLabel>Team</td>
    <td><select name=mhhls022  tabindex=10
         title="Team" class=SelectBig>
         </select>
    </td>
</tr>
</table>
</div>

<div id="OutpatTeam" style="display:none">
<table cellspacing=0 cellpadding=1 border=0 width=100%>
<tr><td class=DataLabel width=20%>Team</td>
    <td><select name=mhhls022  tabindex=10
         title="Team" class=SelectBig>
         <option> </option>
         %MEHWEB01.09.123.2
         </select>
    </td>
</tr>
</table>
</div>

<div id="RecDate" style="display:none">
<table cellspacing=0 cellpadding=1 border=0 width=100%>
  <tr><td class=DataLabel width=20%>Receival Date</td>
        <td><input type="text" size="12" name="mhhls029" title="Receival Date"
         value="%MEHWEB01.09.132" class="PastDate"
         onblur="checkDate(this,'Receival Date')" tabindex=22>
        <img src=../images/DateLookup.gif class="Icon"
         onclick='DateLookupFrame(AddForm.mhhls029);'>
          Time
        <input type=text name=mhhls030 size=8
          value="%MEHWEB01.09.133" title="Receival Time" tabindex=23>
        <img notab src=../images/DateTimeStamp.gif class="Icon"
         onclick="SetCurrentDateTime(AddForm.mhhls029,AddForm.mhhls030);"
         tabindex=-1>
       <img notab src=../images/TimeLookup.gif class="Icon"
        onclick="TimeLookupFrame(AddForm.mhhls030);" tabindex=-1>
          </td>
</tr>
</table>
</div>

<div id="ActDate" style="display:none">
<table cellspacing=0 cellpadding=1 border=0 width=100%>
  <tr><td class=DataLabel width=20%>Admit MH Act Date</td>
        <td><input type="text" size="12" name="mhhls031" 
         title="Admit MH Act Date"
         value="%MEHWEB01.09.134" class="PastDate"
         onblur="checkDate(this,'Receival Date')" tabindex=24>
        <img src=../images/DateLookup.gif class="Icon"
         onclick='DateLookupFrame(AddForm.mhhls031);'>
          Time
        <input type=text name=mhhls032 size=8
          value="%MEHWEB01.09.135" title="Admit MH Act Time" tabindex=25>
        <img notab src=../images/DateTimeStamp.gif class="Icon"
         onclick="SetCurrentDateTime(AddForm.mhhls031,AddForm.mhhls032);"
         tabindex=-1>
       <img notab src=../images/TimeLookup.gif class="Icon"
        onclick='TimeLookupFrame(AddForm.mhhls032);' tabindex=-1>
          </td>
</tr>
</table>
</div>

<span id="BlankClinician" style="display:none">
   <input type="hidden" name="mhhls035" value=" ">
   <input type="hidden" name="mhhls034" value=" ">
</span>
