<meta name="TemplateVersion" content="V12.01.00">
<meta name="TemplateHome" content="wahealth">
<meta name="HelpFileName"    content="NoContextSet.html">
<meta name="CrossBrowser" content="true">
<script type="text/javascript" src="../js/mehweb0109002.js"></script>
<script type="text/javascript" src="../js/mehweb0109004.js"></script>
<script type="text/javascript">
function FormSubmit() {

 strtDate = UpdateForm.mhhls002;
 strtTime = UpdateForm.mhhls003;
 endDate = UpdateForm.mhhls004;
 endTime = UpdateForm.mhhls005;

 if (!ChkDateTime(strtDate,strtTime,endDate,endTime)) {
   alert("Start Date/Time must be before End Date/Time.");
   UpdateForm.mhhls002.select();
   return;
 }

 SetCurrentDateTimeNoFocus(document.UpdateForm.currdate,document.UpdateForm.currtime);

  if (!isWhitespace(document.UpdateForm.mhhls002.value)&&
      !isWhitespace(document.UpdateForm.mhhls003.value)) {
  if (SetDateYYYYMMDD(document.UpdateForm.mhhls002.value)==
      SetDateYYYYMMDD(document.UpdateForm.currdate.value)) {
  if (document.UpdateForm.mhhls003.value > document.UpdateForm.currtime.value) {
      alert("Start Time cannot be in the future.");
      return;
    }
  }
  }

 if (!isWhitespace(document.UpdateForm.mhhls004.value +
                   document.UpdateForm.mhhls005.value)) {
   var serverURL   = "../cgi-bin/comweb80.pbl?reportno=50" +
                   "&valdcode=" + UpdateForm.urnumber.value.replace(/ /g,"+") +
                                  UpdateForm.uniqnumb.value.replace(/ /g,"+") +
                   "&valddate=" + UpdateForm.mhhls004.value.replace(/ /g,"+") +
                   "&valdtime=" + UpdateForm.mhhls005.value.replace(/ /g,"+");
   var returnValue = RSExecute(serverURL);
   if (returnValue.status != 0) {
     return;
   }
 }

   document.UpdateForm.mhhls006.value="0";
   document.UpdateForm.mhhls018.value="1";

//   if (document.UpdateForm.superlev.value!="1") {
//     document.UpdateForm.mhhls033.value=document.UpdateForm.orignref.value;
//   }

// admiDate = UpdateForm.admiDate;
// admiTime = UpdateForm.admiTime;

//if (document.UpdateForm.mhhls033.value.substr(3,1)=="I") {
//  if (document.UpdateForm.admnstat.value!="3"&&
//      document.UpdateForm.admnstat.value!="5") {
//    if (!ChkDateTime(strtDate,strtTime,admiDate,admiTime)) {
//      alert("Start Date/Time must be before or equal Admission Date/Time");
//      UpdateForm.mhhls002.select();
//      return;
//    }
//  }
//}

 if (document.UpdateForm.superlev.value=="1") {
   patntdob = UpdateForm.patntdob;
   patntdbt = UpdateForm.patntdbt;

  if (!ChkDateTime(patntdob,patntdbt,strtDate,strtTime)) {
    alert("Start Date/Time must be after Patient's Date of Birth.");
    UpdateForm.mhhls002.select();
    return;
  }
  }

  if (validateMandatory(UpdateForm)) {
      document.UpdateForm.submit(); 
  } 
}
function ShowRespClinician() {
    if (document.UpdateForm.mhhls033.value.substr(3,1)=="I") {
        document.getElementById("RefClin1").innerHTML=
        document.getElementById("RefClinicInp").innerHTML;
        document.getElementById("RefClin2").innerHTML=
        document.getElementById("RefClinicRoleInp").innerHTML;
        document.getElementById("RefClin3").innerHTML=
        document.getElementById("RespClinic").innerHTML;
        if (document.UpdateForm.superlev.value=="1") {
//          OrgRef.innerHTML=OriginRef.innerHTML;
          document.getElementById("RefClin1").innerHTML=
          document.getElementById("RefClinicOutpat").innerHTML;
          document.getElementById("RefClin2").innerHTML=
          document.getElementById("RefClinicRole").innerHTML;
          CurrentRole();
        } else {
//          OrgRef.innerHTML=DispOriginRef.innerHTML;
        }
        document.getElementById("AdmRdate").innerHTML="";
        document.getElementById("AdmAdate").innerHTML="";

        GetTeam();
    } else {
        document.getElementById("RefClin1").innerHTML=
        document.getElementById("RefClinicOutpat").innerHTML;
        document.getElementById("RefClin2").innerHTML=
        document.getElementById("RefClinicRole").innerHTML;
        CurrentRole();
        document.getElementById("RefClin3").innerHTML=
        document.getElementById("OutpatTeam").innerHTML;
        if (document.UpdateForm.superlev.value=="1") {
//          OrgRef.innerHTML=OriginRef.innerHTML;
        } else {
          document.getElementById("OrgRef").innerHTML=
          document.getElementById("DispOriginRef").innerHTML;
        }
        document.getElementById("AdmRdate").innerHTML="";
        document.getElementById("AdmAdate").innerHTML="";
    }
  for (var i =0 ; i < document.UpdateForm.mhhls022.length; i++) {
    if (trim(document.UpdateForm.mhhls022.options[i].value)==
        trim(document.UpdateForm.d_mhhls022.value)) {
       document.UpdateForm.mhhls022.selectedIndex=i } };
}

function ShowClinician() {
    if (document.UpdateForm.d_mhhls033.value.substr(3,1)=="I") {
        document.getElementById("RefClin1").innerHTML=
        document.getElementById("RefClinicInp").innerHTML;
        document.getElementById("RefClin2").innerHTML=
        document.getElementById("RefClinicRoleInp").innerHTML;
        document.getElementById("RefClin3").innerHTML=
        document.getElementById("RespClinic").innerHTML;
        if (document.UpdateForm.superlev.value=="1") {
          document.getElementById("OrgRef").innerHTML=
          document.getElementById("OriginRef").innerHTML;
          document.getElementById("RefClin1").innerHTML=
          document.getElementById("RefClinicOutpat").innerHTML;
          document.getElementById("RefClin2").innerHTML=
          document.getElementById("RefClinicRole").innerHTML;
          CurrentRole();
        } else {
          document.getElementById("OrgRef").innerHTML=
          document.getElementById("DispOriginRef").innerHTML;
        }
        document.getElementById("AdmRdate").innerHTML="";
        document.getElementById("AdmAdate").innerHTML="";

        GetTeam();
    } else {
        document.getElementById("RefClin1").innerHTML=
        document.getElementById("RefClinicOutpat").innerHTML;
        document.getElementById("RefClin2").innerHTML=
        document.getElementById("RefClinicRole").innerHTML;
        CurrentRole();
        document.getElementById("RefClin3").innerHTML=
        document.getElementById("OutpatTeam").innerHTML;
        if (document.UpdateForm.superlev.value=="1") {
          document.getElementById("OrgRef").innerHTML=
          document.getElementById("OriginRef").innerHTML;
        } else {
          document.getElementById("OrgRef").innerHTML=
          document.getElementById("DispOriginRef").innerHTML;
        }
        document.getElementById("AdmRdate").innerHTML="";
        document.getElementById("AdmAdate").innerHTML="";
    }
  for (var i =0 ; i < document.UpdateForm.mhhls022.length; i++) {
    if (trim(document.UpdateForm.mhhls022.options[i].value)==
        trim(document.UpdateForm.d_mhhls022.value)) {
       document.UpdateForm.mhhls022.selectedIndex=i } };
}
function CurrentRole() {
    selectOptions2("48",UpdateForm.mhhls034,UpdateForm.mhhls035);
    for (var i =0 ; i < document.UpdateForm.mhhls035.length; i++) {
    if ((document.UpdateForm.mhhls035.options[i].value.substr(0,3))==
         document.UpdateForm.clinrole.value.substr(0,3)) {
      document.UpdateForm.mhhls035.selectedIndex=i } };
 }
function DisplayDelete() {
  if (document.UpdateForm.superlev.value=="1") {
//  if (document.UpdateForm.mhhls033.value.substr(3,1)!="I") {
      if (document.UpdateForm.mhdlsind.value!="1") {
        document.getElementById("DeleteButtonDIV").innerHTML=
        document.getElementById("DeleteButtonSPAN").innerHTML;
      } else {
        document.getElementById("DeleteButtonDIV").innerHTML="";
      }
//  } else {
//    DeleteButtonDIV.innerHTML="";
//  }
  } else {
    document.getElementById("DeleteButtonDIV").innerHTML="";
  }
}
function readOnlyStartDateTime() {
  if (document.UpdateForm.superlev.value=="1") {

    document.UpdateForm.mhhls002.readOnly=false;
    document.UpdateForm.mhhls002.className="Mandatory Date NotFuturEdate";
    document.UpdateForm.DateLookupImg1.onclick=
    function(){DateLookupFrame(document.UpdateForm.mhhls002);}

    document.UpdateForm.mhhls003.readOnly=false;
    document.UpdateForm.mhhls003.className="Mandatory";
    document.UpdateForm.DateTimeStampImg1.onclick=
    function(){SetCurrentDateTime(document.UpdateForm.mhhls002,
                                  document.UpdateForm.mhhls003);}
    document.UpdateForm.TimeLookupImg1.onclick=
    function(){TimeLookupFrame(document.UpdateForm.mhhls003);}
  }
}
function GetTeam()
{
  if (isWhitespace(document.UpdateForm.d_mhhls021.value))
  {
    return;
  }

  var serverURL = "../cgi-bin/comweb80.pbl?reportno=56" +
                "&valdcode=" + document.UpdateForm.d_mhhls021.value.replace(/ /g,"+")

  var returnValue = RSExecute(serverURL);
//alert(returnValue.return_value);
  if (returnValue.status==0)
  {
    document.UpdateForm.mhhls022.options.length=0
    document.UpdateForm.mhhls022.options[document.UpdateForm.mhhls022.options.length]=
    new Option("","");
    ReturnValue=returnValue.return_value.split("|");
    for (var j=0; j < ReturnValue.length; j++) {
       if (!isWhitespace(ReturnValue[j])) {
         SelectValue=ReturnValue[j].split(",");
    document.UpdateForm.mhhls022.options[document.UpdateForm.mhhls022.options.length]=
          new Option(SelectValue[1],SelectValue[0]); } } }

}
</script>
</head>
%START.OF.PAGE
<body onload="PageLoad(event);DisplayDelete();readOnlyStartDateTime();
              ShowClinician();">
<span class=DFrameTitleBar>
<img align="right" alt="Exit" class="MenuIcon"
 src="../images/ExitIcon.gif" onclick="DFrameExit();">
Legal Status Referral Management Details
</span>
<div id=PageBodySection >
<form name=UpdateForm method=post action=mehweb01.pbl style="margin:0">
<input type=hidden name=urnumber value="%MEHWEB01.09.003">
<input type=hidden name=admissno value="%MEHWEB01.09.081">
<input type=hidden name=uniqnumb value="%MEHWEB01.09.101">
<input type=hidden name=defgpcod value="%MEHWEB01.09.323.1">
<input type=hidden name=defgpnam value="%MEHWEB01.09.323.0">
<input type=hidden name=respclin value="%MEHWEB01.09.122.1">
<input type=hidden name=visittyp value="%MEHWEB01.09.605">
<input type=hidden name=clinrole value="%MEHWEB01.09.138.1">
<input type=hidden name=reportno value="9">
<input type=hidden name=template value="004">
<input type=hidden name=updttype value="U">
<input type=hidden name=nextpage value="0">
<input type=hidden name=redirect>
<input type=hidden name=mhhls006>
<input type=hidden name=mhhls018>
<input type=hidden name=d_mhhls022 value="%MEHWEB01.09.123.1">
<input type=hidden name=superlev value="%MEHWEB01.09.417">
<input type=hidden name=orignref value="%MEHWEB01.09.136.3">
<input type=hidden name=admiDate value="%MEHWEB01.09.327">
<input type=hidden name=admiTime value="%MEHWEB01.09.328">
<input type=hidden name=admnstat value="%MEHWEB01.09.332">
<input type=hidden name=mhdlsind value="%MEHWEB01.09.421">
<input type=hidden name=patntdob value="%MEHWEB01.09.020">
<input type=hidden name=patntdbt value="00:00:00">
<input type=hidden name=currdate>
<input type=hidden name=currtime>
<input type=hidden name=d_mhhls033 value="%MEHWEB01.09.136.3">
<input type=hidden name=d_mhhls021 value="%MEHWEB01.09.122.1">

<table cellspacing=0 cellpadding=1 border=0 width=100%>

   <tr><td class=DataLabel width=20%>Start Date</td>
       <td>
          <!--<input type=text name=mhhls002 size=12 class="Readonly Date"
          readonly value="MEHWEB01.09.102" title="Start Date">
          <img notab src=../images/DateLookup.gif class="Icon"
          onclick="">-->
          <input type=text size=12 name=mhhls002 readonly id=mhhls002
           class="Readonly Date" title="Start Date" value="%MEHWEB01.09.102">
          <img notab src="../images/DateLookup.gif" class="Icon" 
           onclick="" id="DateLookupImg1">
          Time     
     <!--<input type=text name=mhhls003 size=8 maxlength=8 class=Readonly
        readonly value="MEHWEB01.09.103" title="Start Time">
        <img notab src=../images/DateTimeStamp.gif class="Icon"
         onclick="">
       <img notab src=../images/TimeLookup.gif class="Icon"
        onclick="">-->
         <input class=Readonly readonly type=text name=mhhls003 size=8 
          title="Start Time" value="%MEHWEB01.09.103" id=mhhls003>
         <img notab src="../images/DateTimeStamp.gif" class="Icon"
          onclick="" id="DateTimeStampImg1">
         <img notab src="../images/TimeLookup.gif" class="Icon"
          onclick="" id="TimeLookupImg1">
    </td>
   </tr>

   <tr><td class=DataLabel>End Date </td>
       <td><input type=text size=12 name=mhhls004 tabindex=3
            class="date" title="End Date" value="%MEHWEB01.09.104"
            onblur="checkDate(this,'Date');
                    ChkEndDate(UpdateForm.mhhls002,UpdateForm.mhhls004,
                    UpdateForm.mhhls003,UpdateForm.mhhls005);">
        <img notab src=../images/DateLookup.gif class="Icon"
          onclick="DateLookupFrame(UpdateForm.mhhls004);">
          Time
       <input type=text name=mhhls005 size=8 tabindex=4 
          value="%MEHWEB01.09.105" title="End Time"
          onblur="checkTime(this,'Time');
                  ChkEndTime(UpdateForm.mhhls002,UpdateForm.mhhls004,
                  UpdateForm.mhhls003,UpdateForm.mhhls005);">
        <img notab src=../images/DateTimeStamp.gif class="Icon"
         onclick="SetCurrentDateTime(UpdateForm.mhhls004,UpdateForm.mhhls005);">
       <img notab src=../images/TimeLookup.gif class="Icon"
         onclick="TimeLookupFrame(UpdateForm.mhhls005);">
    </td>
   </tr>
</table>

    <div id="OrgRef"></div>
    <div id="RefClin1"></div>
    <div id="RefClin2"></div>

<table cellspacing=0 cellpadding=1 border=0 width=100%>
<tr><td class=DataLabel width=20%>Case Manager/Key Worker</td>
    <td><input type="text" size=10 maxlength=10 name="mhhls024" tabindex=7
         value="%MEHWEB01.09.125.1"
       onblur="UpCase(this);ValidateHCP(18,18,UpdateForm.mhhls024,
               UpdateForm.doctnam4);">
       <input type="text" size=25 notab readonly name="doctnam4"
         value="%MEHWEB01.09.125.0">
       <img src="../images/SearchIcon.gif" class=Icon
        onclick="HCPSearchFrame(UpdateForm.mhhls024,UpdateForm.doctnam4,9);">
    <img src="../images/erase.gif" class="Icon"
     onclick="clrFields(UpdateForm.mhhls024,UpdateForm.doctnam4);">
       <td>
    </tr>
</table>

    <div id="RefClin3"></div>

    <div id="AdmRdate"></div>
    <div id="AdmAdate"></div>

<table cellspacing=0 cellpadding=0 border=0 width=40% align=center>
    <tr align=center>
       <td colspan=4 align=right>
       <input type=button value="Update" class="button" tabindex=30
        onclick="FormSubmit();">
       </td>
       <td colspan=4 align=center>
       <div id="DeleteButtonDIV"></div>
       </td>
       <td colspan=4 align=left>
       <input type=button value=Close class="button" tabindex=31
        onclick="DFrameCloseRefresh();">
       </td></tr>
</table>
</form>

<form name=PatientLinks method=get style="margin:0">
<input type=hidden name=reportno value=1>
<input type=hidden name=template value="004">
<input type=hidden name=urnumber value="%MEHWEB01.09.003">
<input type=hidden name=admissno value="%MEHWEB01.09.081">
<input type=hidden name=MenuType value="%MEHWEB01.09.088">
</form>
</div>

<div id="RefClinicOutpat" style="display:none">
<table cellspacing=0 cellpadding=1 border=0 width=100%>
    <tr><td class=DataLabel width=20%>Referring Clinician</td>
        <td><input type="text" size=10 maxlength=10 name=mhhls034 tabindex=5
               value="%MEHWEB01.09.137.1"
       onblur="ValidateHCP(18,0,UpdateForm.mhhls034,UpdateForm.genpname);
               selectOptions2('48',UpdateForm.mhhls034,UpdateForm.mhhls035);">
        <input type=text size=25 notab readonly name=genpname
               value="%MEHWEB01.09.137.0">
        <img src="../images/SearchIcon.gif" class="Icon"
        onclick="HCPSearchFrame(UpdateForm.mhhls034,UpdateForm.genpname,1);">
        <img src="../images/erase.gif" class="Icon"
         onclick="clrFields(UpdateForm.mhhls034,UpdateForm.genpname);"></td>
</tr>
</table>
</div>

<div id="RefClinicRole" style="display:none">
<table cellspacing=0 cellpadding=1 border=0 width=100%>
    <tr><td class=DataLabel width=20%>Referring Clinician (Role)</td>
        <td><select name=mhhls035 tabindex=6
             title="Referring Clinician (Role)" class=SelectBig>
            <option> </option>
               %MEHWEB01.09.138.2
            </select>
        </td>
    </tr>
</table>
</div>

<div id="RefClinicInp" style="display:none">
<table cellspacing=0 cellpadding=1 border=0 width=100%>
<tr><td class=DataLabel width=20%>Referring Clinician</td>
    <td><input type=text size=40 class=readonly readonly
         value="%MEHWEB01.09.137.0" title="Referring Clinician">
    </td>
</tr>
</table>
</div>

<div id="RefClinicRoleInp" style="display:none">
<table cellspacing=0 cellpadding=1 border=0 width=100%>
<tr><td class=DataLabel width=20%>Referring Clinician (Role)</td>
    <td><input size=25 class=readonly readonly value="%MEHWEB01.09.138.0">
    </td>
</tr>
</table>
</div>

<div id="RespClinic" style="display:none">
<table cellspacing=0 cellpadding=1 border=0 width=100%>
<tr><td class=DataLabel width=20%>Responsible Clinician</td>
    <td><input type=text size=40 class=readonly readonly 
         value="%MEHWEB01.09.122.0.002" title="Responsible Clinician">
    <td>
</tr>
<tr><td class=DataLabel>Team</td>
    <td><select name=mhhls022  tabindex=10 
         title="Team" class=SelectBig>
         </select>
    </td>
</tr>
</table>
</div>

<div id="OutpatTeam" style="display:none">
<table cellspacing=0 cellpadding=1 border=0 width=100%>
<tr><td class=DataLabel width=20%>Team</td>
    <td><select name=mhhls022  tabindex=10
         title="Team" class=SelectBig>
         <option> </option>
         %MEHWEB01.09.123.2
         </select>
    </td>
</tr>
</table>
</div>

<div id="RecDate" style="display:none">
<table cellspacing=0 cellpadding=1 border=0 width=100%>
  <tr><td class=DataLabel width=20%>Receival Date</td>
        <td><input type="text" size="12" name="mhhls029" title="Receival Date"
         value="%MEHWEB01.09.132" class="PastDate"
         onblur="checkDate(this,'Receival Date')" tabindex=22>
        <img src=../images/DateLookup.gif class="Icon"
         onclick='DateLookupFrame(UpdateForm.mhhls029);'>
          Time
        <input type=text name=mhhls030 size=8
          value="%MEHWEB01.09.133" title="Receival Time" tabindex=23>
        <img notab src=../images/DateTimeStamp.gif class="Icon"
         onclick="SetCurrentDateTime(UpdateForm.mhhls029,UpdateForm.mhhls030);"
         tabindex=-1>
       <img notab src=../images/TimeLookup.gif class="Icon"
         onclick='TimeLookupFrame(UpdateForm.mhhls030);' tabindex=-1>
          </td>
</tr>
</table>
</div>

<div id="ActDate" style="display:none">
<table cellspacing=0 cellpadding=1 border=0 width=100%>
  <tr><td class=DataLabel width=20%>Admit MH Act Date</td>
        <td><input type="text" size="12" name="mhhls031"
         title="Admit MH Act Date"
         value="%MEHWEB01.09.134" class="PastDate"
         onblur="checkDate(this,'Receival Date')" tabindex=24>
        <img src=../images/DateLookup.gif class="Icon"
         onclick='DateLookupFrame(UpdateForm.mhhls031);'>
          Time
        <input type=text name=mhhls032 size=8
          value="%MEHWEB01.09.135" title="Admit MH Act Time" tabindex=25>
        <img notab src=../images/DateTimeStamp.gif class="Icon"
         onclick="SetCurrentDateTime(UpdateForm.mhhls031,UpdateForm.mhhls032);"
         tabindex=-1>
       <img notab src=../images/TimeLookup.gif class="Icon"
        onclick='TimeLookupFrame(UpdateForm.mhhls032);' tabindex=-1>
          </td>
</tr>
</table>
</div>

<div id="OriginRef" style="display:none">
<table cellspacing=0 cellpadding=1 border=0 width=100%>
<tr><td class=DataLabel width=20%>Origin of Referral</td>
    <td><select name=mhhls033 title="Origin of Referral" tabindex=20
         class=Mandatory onchange="DisplayDelete();ShowRespClinician();">
        <option></option>
        %MEHWEB01.09.136.2
        </select></td>
</tr>
</table>
</div>

<div id="DispOriginRef" style="display:none">
<table cellspacing=0 cellpadding=1 border=0 width=100%>
<tr><input type=hidden name=mhhls033 value="%MEHWEB01.09.136.3">
    <td class=DataLabel width=20%>Origin of Referral</td>
    <td><input size=25 class=readonly readonly value="%MEHWEB01.09.136.0">
    </td>
</tr>
</table>
</div>

<span id="DeleteButtonSPAN" style="display:none">
       <input type=button value="Delete" class="button" 
        onclick="if (!confirm('Delete Referral Record?')) {return;}
                 document.UpdateForm.updttype.value='D';
                 document.UpdateForm.nextpage.value='4';
    document.UpdateForm.redirect.value='mehweb01.pbl?reportno=09&template=001' +
   '&urnumber=' + document.UpdateForm.urnumber.value +
   '&admissno=' + document.UpdateForm.admissno.value;
                 FormSubmit();">
</span>
