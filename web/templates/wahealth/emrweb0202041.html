<meta name="TemplateVersion" content="V12.01.00">
<meta name="TemplateHome" content="wahealth">
<meta name="HelpFileName" content="NoContextSet.html">
<meta name="CrossBrowser" content="true">
<script type="text/javascript" src="../js/EmrMandatory.js"></script>
<script type="text/javascript" src="../js/emrweb0202010.js"></script>
<script type="text/javascript">
function setTriage() {
  f = document.UpdateForm;

  checkrR();
  f.checkTri.value=1;

  if (validateMandatory(f)) {
    SetCookie('ExpAdvConCookie','');
    SetCookie('EACTrgCookie',location.href);
    f.formactn.value="SP"
    tmp = f.emexp001.value;
    f.emexp001.value=tmp.replace(/ /g,"+") 

    if (f.d_etsvis.value == "1") {
      f.template.value = "013";
    }
    f.submit();
  }
}
function setUpdate() {
  f = document.UpdateForm;

  checkrR();
  f.checksen.value=1;

  if (validateMandatory(UpdateForm)) {
    f.formactn.value="AU";
    f.nextpage.value="2";

    if (!isWhitespace(document.getElementById('eacredck').value)) {
      f.redirect.value = document.getElementById('eacredck').value;
    }
    else {
      f.redirect.value = 'emrweb01.pbl?reportno=01&template=049';
    }

    tmp = f.emexp001.value;
    f.emexp001.value=tmp.replace(/ /g,"+") 
    f.submit();
  }
}
function clickAddNotes() {
 if(!validateMandatory(UpdateForm)) { 
   return;
 }
 if(!autoUpdate(UpdateForm)) {
   return;
 }
 AddExpectNotes();
}
function clickEditNotes() {
 if(!validateMandatory(UpdateForm)) { 
   return;
 }
 if(!autoUpdate(UpdateForm)) {
   return;
 }
 ListExpectNotes();
}
function autoUpdate(theForm) {
  theForm.securety.value="1";
  tmp=theForm.emexp001.value;
  theForm.emexp001.value=tmp.replace(/ /g,"+")
  theForm.emexp029.value="";
  theForm.formactn.value="AU";
  theForm.nextpage.value="0";
  var theURL="emrweb02.pbl";
  var postStr=AJAXPostString(theForm)
  xmlHttp = createHttpObject();
  xmlHttp.open("POST", theURL, false);
  xmlHttp.setRequestHeader("Content-Type","application/x-www-form-urlencoded;");
  xmlHttp.send(postStr);
  theForm.securety.value="2";
  if (xmlHttp.status=="200") {
    if (xmlHttp.responseText.indexOf('alert') != -1 ) {
      alert(xmlHttp.responseText.replace(/.*alert../i,"").replace(/.\).*/i,""));
      return false;
    }
    return true;
  }
  else {
    alert("Web Service Not Available. Check your Connection and Try Again.");
    return false;
  }
}
function FN(Name) {
 NameFields=Name.split(" ");
 if (NameFields.length > 1) {
  Surname=NameFields[2].substr(0,25);
  FName=NameFields[1].substr(0,25);
  Title=NameFields[0].substr(0,1) + NameFields[0].substr(1,5).toLowerCase()
  document.UpdateForm.emexp002.value=trim(Surname);
  document.UpdateForm.emexp003.value=trim(FName);
 }
}
function CheckCode(code,selectlist)  {
 var found=0
 strvar=code.value+"   "      
 code.value=strvar.substr(0,3)
 for (var i =0 ; i < selectlist.length; i++) {
   if (selectlist.options[i].value.substr(0,3)==code.value) {
     found=1; selectlist.selectedIndex=i } }
 if (found==0) { alert("Invalid Code Entered");code.focus() }
}
function UpdateCode(code,selectlist) {
  code.value=selectlist.value.substr(0,3)
  UpdateForm.comptext.focus()
}
function setRedirect() {
  if (window.name == "content") {
     document.UpdateForm.redirect.value="emrweb01.pbl?reportno=1&template=2"
   }
  else {
     document.UpdateForm.redirect.value="emrweb01.pbl?reportno=1&template=1"
  }
}
function setFormactn() {
  if (validateMandatory(UpdateForm)) {
    document.UpdateForm.formactn.value="N1"
    document.UpdateForm.updttype.value="REGIS"
    UpdateWin=window.open("","HideUpdateWindow",
    "width=10,height=10,top=1024,directories=no,location=no" +
    ",scrollbars=no,status=no,toolbar=no,menubar=no,resizable=no")
    document.UpdateForm.target="HideUpdateWindow";
    document.UpdateForm.submit()
    }
}
function dispSex(){
for (var i =0 ; i < document.UpdateForm.emexp004.length; i++) {
if  (document.UpdateForm.emexp004.options[i].value==UpdateForm.selsex.value.substr(0,1)) {
       document.UpdateForm.emexp004.selectedIndex=i } };
}
function submitFormRedirect() {
 if (IsDirty(UpdateForm)){
   if(document.UpdateForm.checksen.value==1) {return;;}
   if(document.UpdateForm.checkTri.value==1) {return;;}
   SubmitForm()
 }
}
function SubmitForm() {
   setUpdate()
}
function IsDirty(eForm) {
  for (var i=0; i < eForm.length; i++) {
    var eElem = eForm.elements[i];
    if ("text" == eElem.type || "textarea" == eElem.tagName)
    {
      if (trim(eElem.value) != trim(eElem.defaultValue))  {
        if(eElem.name=="prcom001") {
          if (UpdateForm.prcom001.value == UpdateForm.savdesc1.value) {
              return false; }
        }
        return true;
      }
    }
  }
  return false;
}
function checkUR(UR) {
var URnumber=UR;
if (isWhitespace(URnumber.value)) { return;;}
  justifyRight(URnumber);
  PatientReturnWA();
}

function Validateprecom001() {
  onblurHandler()
  var formatedtext=formateText(UpdateForm.prcom001,'50')
  if ((formatedtext.split(/[\r\n]/).length>6) || 
        (UpdateForm.prcom001.value.length > 300)) {
    alert("Presenting Complaint comments - Max 6 lines."
           +"\nPlease remove extra rows to continue.");
    document.UpdateForm.prcom001.focus();
    return; }
}
function CheckAmbType() {
  if(document.UpdateForm.emexp014.value.substr(3,1)=="A") {
    document.UpdateForm.emexp026.readOnly=false;
    if(document.UpdateForm.emexp014.value.substr(4,1)=="N") {
      document.UpdateForm.emexp026.className="";
    } else {
      document.UpdateForm.emexp026.className="Mandatory";
    }
  } else {
    document.UpdateForm.emexp026.value="";
    document.UpdateForm.emexp026.className="ReadOnly";
    document.UpdateForm.emexp026.readOnly=true;
  }
}
function checkSOR() {
  if (document.getElementById("emexp019").value.substr(5,1)=="1") {
    document.getElementById("TranSrcHeading").innerHTML=document.getElementById("transferhd").innerHTML;
    document.getElementById("TranSrc").innerHTML=document.getElementById("transfersrc").innerHTML;
     validateCode(9,document.UpdateForm.emexp031,
                   document.UpdateForm.trnsfsrc);
  } else {
   document.getElementById("TranSrcHeading").innerHTML="";
    document.getElementById("TranSrc").innerHTML=document.getElementById("transferblank").innerHTML;
  }
}
function checkrR() {
  if (!isWhitespace(document.getElementById("emexp030").value)) {
    document.getElementById("emexp029").value="0";
  } else {
    document.getElementById("emexp029").value="";
  }
}
function getEACRedirectCookie() {

  if (GetCookieData("EACRedirectCookie")!= "unknown") {
    document.getElementById("eacredck").value =
    GetCookieData("EACRedirectCookie");
    ExpireCookiePath("EACRedirectCookie");
  }

}
</script>
</head>
%START.OF.PAGE
<body onLoad="PageLoad(event);checkUR(document.UpdateForm.emexp018);
              CheckAmbType();checkSOR();
              checkrR();getEACRedirectCookie();
              MandatoryETA();"
      onBeforeUnload="submitFormRedirect();">
<span class=DFrameTitleBar>
Update Expected, Advised, Contact Details 
</span>
<form name=UpdateForm action="emrweb02.pbl" method=post style="margin:0"
 onsubmit='return validateMandatory(this);'>
<input type=hidden name=reportno value="02">
<input type=hidden name=template value="012">
<input type=hidden name=formactn>
<input type=hidden name=updttype>
<input type=hidden name=updateky value="">
<input type=hidden name=nextpage value="1">
<input type=hidden name=redirect>
<input type=hidden name=emexp001 value="%EMRWEB02.02.410">
<input type=hidden name=selsex>
<input type=hidden name=dummyadm>
<input type=hidden name=dummsrch value="1">
<input type=hidden name=gname>
<input type=hidden name=sname>
<input type=hidden name=savdesc1>
<input type=hidden name=dummy>
<input type=hidden name=dummy1>
<input type=hidden name=dummy2>
<input type=hidden name=checksen value="0">
<input type=hidden name=checkTri value="0">
<input type=hidden name=patsname value="%EMRWEB02.02.411">
<input type=hidden name=patgname value="%EMRWEB02.02.412">
<input type=hidden name=deceased>
<input type=hidden name=emexp025 value="%EMRWEB02.02.472">
<input type=hidden name=emexpsit value="%EMRWEB02.02.533">
<input type=hidden name=emexp029 id=emexp029 value="">
<input type=hidden name=d_emexp028 id=d_emexp028 value="%EMRWEB02.02.596">
<input type=hidden name=eacredck id=eacredck value="">
<input type=hidden name=d_etsvis value="%EMRWEB02.02.929">
<input type=hidden name=ptcnhdps id=ptcnhdps
 value="%STANDARD.01.025.080.250.1.1">
<input type=hidden name=deftview id=deftview value="%EMRWEB02.02.944">

<table align=center width=98% border=0 cellspacing=0 cellpadding=0>
<tr><td class=DataLabel>Username</td>
    <td><input type=hidden name=securety value="2">
        <input type=text size=12 name=secureid class="Mandatory NoAutoFocus"
          tabindex=1 title="User ID" value="%STANDARD.01.043">
     Password
        <input type=password size =12 name=securepw class=Mandatory tabindex=2
         onfocus="SetCaretPosition('securepw',-1);"
         title="Password" onblur="checkPass();">
    </td>

    <td class=DataLabel>U/R </td>
    <td>
      <input type=text size=10 maxlength=8 name=emexp018 tabindex=4 
       value="%EMRWEB02.02.435"
       onblur="UpCase(this);checkWhite(this);"> 
      <img src="../images/SearchIcon.gif" class=Icon
       onclick="PatientSearchWA();">
    </td>
    <td class=DataLabel>Surname </td>
    <td><input type=text size=25 maxlength=25 name=emexp002
         value="%EMRWEB02.02.411"></td>
    <td class=DataLabel>Given Name </td>
    <td><input type="text" size=25 maxlength=25 name=emexp003
        value="%EMRWEB02.02.412"></td>
</tr>

<tr><td class=DataLabel></td>
    <td class=DataLabel></td>
    <td class=DataLabel></td>
    <td class=DataLabel></td>
    <td class=DataLabel>%STANDARD.01.017.G </td>
    <td><div id="sexfieldDIV">
          <select name=emexp004 class=SelectSml>
            <option> </option>
            <option value="R">Intersex</option>
            <option value="U">Unknown</option>
            <option value="I">Indeterminate</option>
            <option value="M">Male</option>
            <option value="F">Female</option>
          </select>
        </div>
    </td>
    <td class=DataLabel>Date of Birth </td>
    <td><input type="text" size=12 maxlength=11 name=emexp005 
         value="%EMRWEB02.02.414" 
         title="Date of Birth" class="Past Date"
         onblur="checkDate(UpdateForm.emexp005,this.title)">
        <img src="../images/DateTimeStamp.gif" class=Icon
         date="UpdateForm.emexp005">
        <img src="../images/DateLookup.gif" class=Icon
         onclick="DateLookupFrame(UpdateForm.emexp005);">
    </td>
</tr>
</table>
<table align=center width=98% border=0 cellspacing=0 cellpadding=0>
<tr><td colspan=6><hr></td></tr>

<tr>
  <td width=10%>Patient Encounter Type</td>
  <td width=50%>
    <input type=radio name=emexp028 id=emex028e value="1" tabindex=8
     onclick="MandatoryETA();">Expected Patient</input>
    <input type=radio name=emexp028 id=emex028a value="2" tabindex=8
     onclick="MandatoryETA();">Advice Call</input>
    <input type=radio name=emexp028 id=emex028c value="3" tabindex=8
     onclick="MandatoryETA();">Contact List</input>
  </td>
  <td width=8%>&nbsp;</td>
  <td width=15%>&nbsp;</td>
  <td width=17%>&nbsp;</td>
</tr>
<tr><td>&nbsp;</td></tr>

<tr><td class=DataLabel>Date Notified</td>
    <td>
      <table align=center width=100% border=0 cellspacing=0 cellpadding=0>
       <tr>
         <td>
           <input type="text" name=emexp015 size="12" tabindex=12
            class="Mandatory Date" title="Triage Date"
            value="%EMRWEB02.02.424"
            onblur="checkDate(UpdateForm.emexp015,'Triage Date')" >
           <img src="../images/DateLookup.gif" class=Icon
            onclick="DateLookupFrame(UpdateForm.emexp015);">
           Time 
           <input type="text" name=emexp016 size="8" tabindex=13
            class=Mandatory title="Triage Time" value="%EMRWEB02.02.425"
            onblur="checkTime(UpdateForm.emexp016,'Triage Time')">
           <img src="../images/TimeLookup.gif" class=Icon
            onclick="TimeLookupFrame(UpdateForm.emexp016);">
           <img src="../images/DateTimeStamp.gif" class=Icon
            onclick="SetCurrentDateTime(UpdateForm.emexp015,
                                        UpdateForm.emexp016);">
         </td>
         <td class=DataLabel>ETA</td>
         <td nowrap>
           <input type="text" name=emexp022 size="12" tabindex=14
            class="Date" title="Triage Date" value="%EMRWEB02.02.465"
            onblur="checkDate(UpdateForm.emexp022,'ETA Date')" >
           <img src=../images/DateLookup.gif class=Icon
            onclick="DateLookupFrame(UpdateForm.emexp022);">
           Time
           <input type="text" name=emexp023 size="8" tabindex=15
            title="ETA Time" value="%EMRWEB02.02.466"
            onblur="checkTime(UpdateForm.emexp023,'Triage Time')">
           <img src="../images/TimeLookup.gif" class=Icon
            onclick="TimeLookupFrame(UpdateForm.emexp023);">
           <img src="../images/DateTimeStamp.gif" class=Icon
            onclick="SetCurrentDateTime(UpdateForm.emexp022,
                                        UpdateForm.emexp023);">
         </td>
         <td></td>
         <td></td>
       </tr>
      </table>
    </td>
    <td class=DataLabel nowrap>Accepting Source</td>
    <td><select name=emexp020 class=SelectMed tabindex=16>
         <option></option>
          %EMRWEB02.02.463.2
        </select>
    </td>
</tr>

<tr><td class=DataLabel>Presenting Complaint </td>
    <td rowspan=2>
    <textarea type=text valign=top name=prcom001 tabindex=17
     onkeydown="LimitText(this,6,300);"
     wrap=hard cols=51 rows=3></textarea>
    </td>
    <td>%STANDARD.01.017.EA </td>
    <td>
      <select name=emexp014 tabindex=18 class="SelectMed"
       title="%STANDARD.01.017.EA " 
       onchange="document.UpdateForm.emexp026.disabled=0;CheckAmbType();"
       onFocus="CheckAmbType();" >
      <option></option>
      %EMRWEB02.02.423.2
      </select>
    </td>
</tr>

<tr>
    <td></td>
    <td class=DataLabel>Amb Case No</td>
    <td><input type=text size=20 maxlength=15 name=emexp026 tabindex=19
         value="%EMRWEB02.02.469" title="Amb Case No">
    </td>
</tr>

<tr><td>&nbsp;</td></tr>
<tr>
    <td class=DataLabel valign=top><br>Expected Patient Notes<br><br>
      <input type=button value="Add" class=button
        name=btnAdd id=btnAdd tabindex=20
        onclick="tempDisable(this);clickAddNotes();"><br><br>
      <input type=button value="Edit Notes" class=button
        name=btnEdit id=btnEdit tabindex=20
        onclick="tempDisable(this);clickEditNotes();"><br>
    </td>
    <td rowspan=3>
        <textarea name=exptcmnt id=exptcmnt rows=10 cols=100 wrap=hard
         class=Readonly readonly
         title="Notes">%EMRWEB02.02.942.001
        </textarea>
    </td>
    <td>%STANDARD.01.017.em </td>
    <td>
      <select name=emexp019 id=emexp019 tabindex=20 class="SelectMed"
       title="%STANDARD.01.017.em " onchange="checkSOR();">
      <option></option>
      %EMRWEB02.02.462.2
      </select>
    </td>
</tr>

<tr>
    <td></td>
    <td><div id=TranSrcHeading></div></td>
    <td><div id=TranSrc></div></td>
</tr>

<tr>
    <td></td>
    <td>%STANDARD.01.017.rR </td>
    <td>
      <select name=emexp030 id=emexp030 tabindex=23 class="SelectMed"
       title="%STANDARD.01.017.rR " onchange="checkrR();">
      <option></option>
      %EMRWEB02.02.595.2
      </select>
    </td>
</tr>

<tr><td>&nbsp;</td></tr>
<tr>
  <td nowrap>
    Caller Name and Contact Number
  </td>
  <td>
    <input type=text size=80 maxlength=100 name=emexp032 tabindex=24
     title="Caller Name and Contact Number" value="%EMRWEB02.02.593">
  </td>
  <td></td>
  <td></td>
</tr>

<tr><td colspan=6 align=center><br>
    <input type=button value="Update" class=button tabindex=30 id=emr02u
     onclick="tempDisable(this);setUpdate();">
    <input type=button value="Triage" class=button tabindex=32
     onclick="setTriage();">
    <input type=button value="Cancel" class=button tabindex=33
     onclick="if (!isWhitespace(document.getElementById('eacredck').value)) {
                location.href = document.getElementById('eacredck').value;
              } else {
                location.href='emrweb01.pbl?reportno=01&template=049';
              }">
    </td>
</tr>
</table>
</form>

<script type="text/javascript">
function init(){
for (var i =0 ; i < document.UpdateForm.emexp004.length; i++) {
if  (document.UpdateForm.emexp004.options[i].value== "%EMRWEB02.02.413") {
       document.UpdateForm.emexp004.selectedIndex=i } 
 }
var str1= trim("%EMRWEB02.02.417");
    if(!isWhitespace(str1)) { str1+="\n"}
var str2= trim("%EMRWEB02.02.418");
    if(!isWhitespace(str2)) { str2+="\n"}
var str3= trim("%EMRWEB02.02.419");
    if(!isWhitespace(str3)) { str3+="\n"}
var str4= trim("%EMRWEB02.02.420");
    if(!isWhitespace(str4)) { str4+="\n"}
var str5= trim("%EMRWEB02.02.421");
    if(!isWhitespace(str5)) { str5+="\n"}
var str6= trim("%EMRWEB02.02.422");
UpdateForm.prcom001.value=str1+str2+str3+str4+str5+str6
UpdateForm.savdesc1.value=str1+str2+str3+str4+str5+str6

  if (document.getElementById("d_emexp028").value == "1") {
    document.UpdateForm.emexp028[0].checked = true;
  }

  if (document.getElementById("d_emexp028").value == "2") {
    document.UpdateForm.emexp028[1].checked = true;
  }

  if (document.getElementById("d_emexp028").value == "3") {
    document.UpdateForm.emexp028[2].checked = true;
  }

  if (trim(document.getElementById("d_emexp028").value) == "") {
    document.UpdateForm.emexp028[0].checked = true;
  }

}

function checkWhite(UR) {
var URnumber=UR;
if (isWhitespace(URnumber.value)) {
  setPatientFields();

  for (var i =0 ; i < document.UpdateForm.emexp004.length; i++) {
    if  (document.UpdateForm.emexp004.options[i].value== "%EMRWEB02.02.413") {
         document.UpdateForm.emexp004.selectedIndex=i } }

  return;;
}
  justifyRight(URnumber);
  PatientReturnWA();
}
</script>

<span id=sexfieldSPAN1 style="display:none;">
<input type=text size=15 maxlength=20 name=d_emexp004 tabindex=6
 class='readOnly' readOnly>
<input type=hidden name=emexp004>
</span>

<span id=sexfieldSPAN2 style="display:none;">
  <select name=emexp004 class=SelectSml tabindex=6>
    <option value=" "></option>
    <option value="U">Unknown</option>
    <option value="R">Intersex</option>
    <option value="I">Indeterminate</option>
    <option value="M">Male</option>
    <option value="F">Female</option>
  </select>
</span>

<span id=transferhd style="display:none">
    <td class=DataLabel>Transfer Source</td>
</span>

<span id=transferblank style="display:none">
    <input type=hidden name=emexp031 value="" notab>
</span>

<span id=transfersrc style="display:none">
    <td nowrap>
     <input type="text" size=8 maxlength=6 name=emexp031
      id=emexp031 tabindex=22 title="Transfer Source" class=Mandatory
      value="%EMRWEB02.02.594"
      onchange='validateCode(9,UpdateForm.emexp031,UpdateForm.trnsfsrc);'>
     <input type=text  size=20 name=trnsfsrc notab readonly>
     <img class=Icon src="../images/SearchIcon.gif"
      onclick="TransferSourceFrame(UpdateForm.emexp031,
               UpdateForm.trnsfsrc)"></td>
</span>
