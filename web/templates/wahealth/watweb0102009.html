<meta name="TemplateVersion" content="V12.01.00">
<meta name="TemplateHome" content="wahealth">
<meta name="HelpFileName" content="NoContextSet.html">
<meta name="CrossBrowser" content="true">
<script type="text/javascript">
function UpdateUnit(){
for (var i =0 ; i < document.UpdateForm.wattr011.length; i++) {
if(trim(UpdateForm.unit.value.substr(0,3))==trim(UpdateForm.wattr011.options[i].value.substr(0,3))) {
       document.UpdateForm.wattr011.selectedIndex=i } };
}
function valUnit() {
  if (document.UpdateForm.wattr012.value != "") {
    validateCode(31,UpdateForm.wattr012,UpdateForm.name_wattr012)
    UpdateForm.unit.value=UpdateForm.wattr011.value
 selectOptions4("45",UpdateForm.wattr012,UpdateForm.dummy2,UpdateForm.wattr011);
    UpdateUnit();
    if(document.UpdateForm.wattr011.length=="2") {
      UpdateForm.wattr011.selectedIndex=1
      UpdateForm.unit.value=UpdateForm.wattr011.value
    }
    valUnitTeam();
  }
}
function valUnitTeam() {
  selectOptions4("46",UpdateForm.wattr012,UpdateForm.wattr011,UpdateForm.wattx035);
  for (var i =0 ; i < document.UpdateForm.wattx035.length; i++) {
    if(trim(UpdateForm.wattx035.options[i].value)==trim(UpdateForm.oldteam.value)) {
     document.UpdateForm.wattx035.selectedIndex=i }
  }
    if (isWhitespace(document.UpdateForm.oldteam)) {
      if (UpdateForm.wattx035.length==2) {
        UpdateForm.wattx035.selectedIndex=1; } }
      if (UpdateForm.wattx035.length>1) {
        UpdateForm.wattx035.className = "Mandatory"; }
      else { UpdateForm.wattx035.className = ""; }
}

function enableAdm() {
  var Status=UpdateForm.wattr005.value

  if (Status==1) {
    UpdateForm.wattr049.readOnly = true;
    UpdateForm.wattr049.className = "ReadOnly";
    return;
  } else {
    UpdateForm.wattr049.readOnly = false;
  }
}

 function ValidateAdm(){

  var Status=UpdateForm.wattr005.value

  if (Status==1) {
    UpdateForm.wattr049.readOnly = true;
    UpdateForm.wattr049.className = "ReadOnly";
    return;
  } else {
    UpdateForm.wattr049.readOnly = false;
  }

  if (Status==6 || Status==7 || Status==8 ) {
    UpdateForm.wattr049.className="";
    return;
    }
  else {
    if (Status==1) {
      UpdateForm.wattr049.className="";
    } else {
      UpdateForm.wattr049.className="Mandatory"; 
    }
  }
  if(trim(UpdateForm.wattr049.value)==""){
   return;
  }

  var Urno=UpdateForm.casekeys.value.substring(0,8);
  var serverURL   = "../cgi-bin/watweb01.pbl?reportno=10" +
                    "&liststat=" + UpdateForm.wattr005.value +
                    "&admissno=" + UpdateForm.wattr049.value.replace(/ /g,"+") +
                    "&urnumber=" + Urno.replace(/ /g,"+") +
                    "&casekeys=" + UpdateForm.casekeys.value.replace(/ /g,"+")

  var returnValue = RSExecute(serverURL);
  ReturnValue=returnValue.return_value.split("|");
  if (returnValue.status==0) {
  }
  else {
    UpdateForm.wattr049.value=" "
    UpdateForm.wattr049.focus();
    }

}
function ValChange(OldStatus) {
  NewStatus=UpdateForm.wattr005.value;
  if(document.UpdateForm.ptcnhdps!="9"){
   if(OldStatus!=6 && NewStatus == 6) {
     alert("Invalid Status - use remove option");
     for (var i =0 ; i < document.UpdateForm.wattr005.length; i++) {
     if (document.UpdateForm.wattr005.options[i].value==OldStatus) {
         document.UpdateForm.wattr005.selectedIndex=i } };
   }
  }
}
function ViewESIS() {
   CASEKEYS=PatientLinks.casekeys.value.replace(/ /g,"+")
   URNUMBER=PatientLinks.urnumber.value.replace(/ /g,"+")
   ADMISSNO=PatientLinks.admissno.value.replace(/ /g,"+")
   WATTRKEY=PatientLinks.wattrkey.value.replace(/ /g,"+")
   LinkUrl="watweb01.pbl?reportno=15&template=1&casekeys="+CASEKEYS +
           "&urnumber=" + URNUMBER +
           "&urnumber=" + URNUMBER +
           "&wattrkey=" + WATTRKEY
   DFrameLink(LinkUrl,0,0,710,400)
  }
function ChangeUR() {
  Left=(document.body.clientWidth-600)/2
  linkurl="watweb01.pbl?reportno=2&template=16" + 
          "&casekeys=" + UpdateForm.casekeys.value.replace(/ /g,"+") +
          "&urnumber=" + PatientLinks.urnumber.value.replace(/ /g,"+")
  DFrameLink(linkurl,0,Left,600,370)
}
function ChangePPP() {
   if(UpdateForm.oldstat.value!="1"){
     alert("Invalid status to change procedure.");
     return;}
   CASEKEYS=PatientLinks.casekeys.value.replace(/ /g,"+")
   URNUMBER=PatientLinks.urnumber.value.replace(/ /g,"+")
   WATTRKEY=PatientLinks.wattrkey.value.replace(/ /g,"+")
   LinkUrl="watweb01.pbl?reportno=02&template=020&casekeys="+CASEKEYS +
           "&urnumber=" + URNUMBER +
           "&casekeys=" + CASEKEYS
   DFrameLink(LinkUrl,0,0,710,370)
}
function ChangeHospital() {
   if(UpdateForm.oldstat.value!="1"){
     alert("Invalid status to change procedure.");
     return;}
   CASEKEYS=PatientLinks.casekeys.value.replace(/ /g,"+")
   URNUMBER=PatientLinks.urnumber.value.replace(/ /g,"+")
   WATTRKEY=PatientLinks.wattrkey.value.replace(/ /g,"+")
   LinkUrl="watweb01.pbl?reportno=02&template=028&casekeys="+CASEKEYS +
           "&urnumber=" + URNUMBER +
           "&casekeys=" + CASEKEYS
   DFrameLink(LinkUrl,0,0,710,370)
}

function UpdateDetails() {
  if (validateMandatory(UpdateForm)) {
    if(!ChkDateTime(UpdateForm.wattr006,null,UpdateForm.admregdt,null)){
      alert(UpdateForm.wattr006.title+" cannot be after Date Keyed");
      return false;
    }
    document.UpdateForm.submit();
  }
  return;
}
function ShowDateListReason() {
  if(!checkDate(UpdateForm.wattr006,'Date')) {
    return;
  }
  if(UpdateForm.d_wattr006.value!=UpdateForm.wattr006.value) {
     UpdateForm.updfld01.disabled=false;
     UpdateForm.reasfc01.disabled=false;
     UpdateForm.reasfc01.className="Mandatory";
  } else {
    UpdateForm.updfld01.disabled=true;
    UpdateForm.reasfc01.selectedIndex=0;
    UpdateForm.reasfc01.disabled=true;
    UpdateForm.reasfc01.className="";
  }
}
function EnablePriorityReason() {
  if(UpdateForm.d_wattr014.value!=UpdateForm.wattr014.value.substr(0,3)) {
     UpdateForm.updfld02.disabled=false;
     UpdateForm.reasfc02.disabled=false;
  } else { 
    UpdateForm.updfld02.disabled=true;
    UpdateForm.reasfc02.value="";
    UpdateForm.reasfc02.disabled=true;
  } 
}
function EnableStatusReason() {
  if(UpdateForm.d_wattr005.value!=UpdateForm.wattr005.value) {
     UpdateForm.updfld09.disabled=false;
     UpdateForm.reasfc09.disabled=false;
  } else { 
    UpdateForm.updfld09.disabled=true;
    UpdateForm.reasfc09.value="";
    UpdateForm.reasfc09.disabled=true;
  } 
}
function SetAuditReason() {
  if(UpdateForm.reasfc02.disabled==false) {
     UpdateForm.reasfc02.value=UpdateForm.wathi001.value;
  }
  if(UpdateForm.reasfc09.disabled==false) {
     UpdateForm.reasfc09.value=UpdateForm.wathi001.value;
  }
}
function showPreferredHospital(load) {
   if(UpdateForm.wattx048.value=="1") {
     document.getElementById('PreferredHospitalField').innerHTML=
     document.getElementById('ShowPreferredHospitalField').innerHTML;
     if(!isWhitespace(UpdateForm.d_wattx049.value) && load == "0") {
       selectOptions2(81,UpdateForm.wattr012,UpdateForm.wattx049);
       for (var i=0; i < UpdateForm.wattx049.length; i++) {
         if (UpdateForm.wattx049.options[i].value.substr(0,3)==
             UpdateForm.d_wattx049.value){
             UpdateForm.wattx049.selectedIndex=i;
         }
       }
     }
   } else {
     document.getElementById('PreferredHospitalField').innerHTML=
     document.getElementById('BlankPreferredHospitalField').innerHTML;
   }
}

</script>
</head>
%START.OF.PAGE
<body onload="PageLoad(event);valUnit();showPreferredHospital('1');enableAdm();">
<span class=DFrameTitleBar>
<img align="right" alt="Exit" class="MenuIcon" 
 src="../images/ExitIcon.gif" onclick="DFrameExit();">
Waiting List Procedure Supervisor Update
</span>

<div id=PageBodySection style="overflow: auto;">

<form name=UpdateForm action="watweb01.pbl" method=post 
 onsubmit='return validateMandatory(this);'>
<input type=hidden name=reportno value=2>
<input type=hidden name=template value=1>
<input type=hidden name=casekeys value="%WATWEB01.02.101">
<input type=hidden name=updttype value="S">
<input type=hidden name=oldstat value="%WATWEB01.02.175">
<input type=hidden name=ptcnhdps value="%STANDARD.01.025.080.250.1.1">
<input type=hidden name=dummy2>
<input type=hidden name=unit>
<input type=hidden name=tmddoctf value="1">
<input type=hidden name=admregdt value="%WATWEB01.02.126">
<input type=hidden name=d_wattr005 value="%WATWEB01.02.175">
<input type=hidden name=d_wattr006 value="%WATWEB01.02.109">
<input type=hidden name=d_wattr014 value="%WATWEB01.02.117.1">
<input type=hidden name=d_wattx049 value="%WATWEB01.02.550.0">
<input type=hidden name=wahfunct value="1">

<table border=0 width=95% cellspacing=0 align=center>
<tr valign=top><td class=DataLabel>Date on List</td>
    <td class=DataField>
    <input type=text name=wattr006 size=12 
     onblur="ShowDateListReason();" value="%WATWEB01.02.109"
     class= "PastDate Mandatory" title="Date on List">
    <img src=../images/DateTimeStamp.gif class=Icon date=UpdateForm.wattr006
     time=null>
    <img src=../images/DateLookup.gif class=Icon date=UpdateForm.wattr006>
    </td>
    <td class=DataLabel align=right>Reason for Change</td>
    <td width=25% align=right>
       <input type=hidden name=updfld01 value="01" disabled>
       <select name=reasfc01 title="Date on List Reason for Change" disabled>
       <option></option>
       %STANDARD.01.007.FX
       </select>
    </td></tr>

<tr valign=top><td class=DataLabel>Responsible Clinician</td>
    <td class=DataField colspan=3>
    <input type=text name=wattr012 size=8 maxlength=8 
     title="Consultant" class=Mandatory value="%WATWEB01.02.115.003" 
     onblur="ValidateCat();valUnit();showPreferredHospital('0');">
    <input type=text name=name_wattr012 size=40 readonly
    title="Consultant Name" value="%WATWEB01.02.115.002">
    <a href="javascript:WaitConSearchFrameTMD
(UpdateForm.wattr012,UpdateForm.name_wattr012,UpdateForm.wattr011)">
    <img src=../images/SearchIcon.gif class=Icon border=0></a></td>
    </tr>


<tr><td class=DataLabel>Unit</td>
    <td class=DataField colspan=3>
    <select name=wattr011 title="Unit" class=Mandatory 
     onchange="ValidateCat();valUnitTeam();">
    <option></option>
    %WATWEB01.02.114.2
    </select></td>
    </tr>
<tr><td class=DataLabel>Team</td>
  <input type=hidden name=oldteam value="%WATWEB01.02.535.1">
          <td><select name=wattx035 
               title="Team">
              <option> </option>
              </select>
          </td>
</tr>

<tr>
  <td class=DataLabel>Patient Suitable For Another Hospital?</td>
  <td colspan=3>
  <table border=0 width=100% cellspacing=0 cellpadding=1>
  <tr><td>
      <select name=wattx048 class=Mandatory 
       title="Patient Suitable For Another Hospital?"
       onchange="showPreferredHospital('0');">
      <option value=" "></option>
       %WATWEB01.02.549.2
      </select>
  </td>
  <td>
  <div id="PreferredHospitalField"></div>
  </td></tr>
  </table>
  </td>
</tr>


<tr valign=top><td class=DataLabel>Diagnosis</td>
    <td class=DataField colspan=3>
    <input type=text name=wattr004 size=50 maxlength=50 readonly
     class=Readonly value="%WATWEB01.02.107" title="Reason/Diagnosis">
    </td></tr>

<tr><td class=DataLabel>Principal Procedure</td>
    <td class=DataLabel colspan=3>
<input type=hidden size=12 name=wattr001 value="%WATWEB01.02.103  ">
    <input readonly type=text name=wattr003 size=60 
     maxlength=50 class=readonly value="%WATWEB01.02.106">
    </td>
    </tr>

<tr><td class=DataLabel>Procedure Description Comments </td>
    <td class=DataField colspan=3>
    <input readonly type=text name=wattr058 size=60 
     maxlength=80 class=readonly value="%WATWEB01.02.199.003">
    </td>
</tr>

<tr valign=top><td class=DataLabel>Additional Procedures</td>
    <td class=DataField colspan=3>
    <input type=text name=dummy size=50 maxlength=50 readonly
     class=Readonly value="%WATWEB01.02.150.1" title=Procedure>
     </td></tr>
<tr valign=top><td class=DataLabel></td>
    <td class=DataField colspan=3>
    <input type=text name=dummy size=50 maxlength=50 readonly
     class=Readonly value="%WATWEB01.02.151.1" title=Procedure>
     </td></tr>


<tr valign=top><td class=DataLabel>Planned Length Of Stay </td>
    <td class=DataField colspan=3>
    <input type=text name=wattr013 size=5 maxlength=5 
     title="Planned Length Of Stay" value="%WATWEB01.02.116">(days)
    </td>
    </tr>

<tr valign=top><td class=DataLabel>Status</td>
    <td class=DataLabel colspan=3>
    <input type=hidden name=updfld09 value="09" disabled>
    <input type=hidden name=reasfc09 value="" disabled>
    <select name=wattr005 title="Waiting List Status" class=Mandatory
     title="Status" onchange="ValidateAdm();ValidateCat();
                             ValChange(%WATWEB01.02.175);EnableStatusReason();">
    <option value=1>Unscheduled</option>
    <option value=2>Scheduled</option>
    <option value=3>Pre-Admitted</option>
    <option value=4>Admitted</option>
    <option value=5>Discharged</option>
    <option value=6>Removed</option>
    </select>
    <class=DataLabel>&nbsp;&nbsp;&nbsp;Visit Number
    <class=DataField align=left colspan=4>
    <input type=text name=wattr049 size=10 maxlength=8 value="%WATWEB01.02.125" 
     title="Visit Number" onblur="justifyRight(this);ValidateAdm();">
    </td>
    </tr>

<tr><td class=DataLabel>%STANDARD.01.017.TP    </td>
    <td Class=DataField colspan=3>
    <input type=hidden name=updfld02 value="02" disabled>
    <input type=hidden name=reasfc02 value="" disabled>
    <select name=wattr014 tabindex=4 class=Mandatory readonly 
     title="%STANDARD.01.017.TP" 
     onchange="ValidateCat();EnablePriorityReason();">
     <option></option>
     %WATWEB01.02.117.2
     </select></td>
     </tr>

<tr valign=top><td class=DataLabel>Effective Date </td>
    <td class=DataField colspan=3>
    <input type=text name=wathi002 size=12 readonly
     class=ReadOnly title="Effective Date"
     value="%WATWEB01.02.315"  onblur="checkDate(this,this.title)">
    <img src=../images/DateTimeStamp.gif class=Icon date=UpdateForm.wathi002
     time=null>
    <img src=../images/DateLookup.gif class=Icon date=UpdateForm.wathi002>
    </td>
    </tr>

<tr><td class=DataLabel>Reason for Change</td>
    <td class=DataLabel colspan=3>
    <select name=wathi001 title="Reason for Change" disabled class=ReadOnly
     onchange="SetAuditReason();">
    <option></option>
    %WATWEB01.02.314.2
    </select>
    </td>
    </tr>

<tr><td colspan=4 align=center>
    <input type=button class="button" value="Ok" onclick="UpdateDetails();">
    <input type=button value="Cancel" class="button" onclick='DFrameExit()'>
    <input type=button class="button" value="Change U/R"
     onclick='ChangeUR();'>
    <input type=button class="button" value="Change PPP"
     onclick='ChangePPP();'>
    <input type=button class="button" value="Intended Hospital"
     onclick='ChangeHospital();' style="width:100px">
    </td></tr>
</table>
</form>

<span id="ShowPreferredHospitalField" style="display:none">
  Preferred Hospital
  <select name=wattx049 title="Preferred Hospital"
   class="SelectBig Mandatory">
  <option></option>
   %WATWEB01.02.550.2
  </select>
</span>

<span id="BlankPreferredHospitalField" style="display:none">
  <input type=hidden name=wattx049 value=" ">
</span>

<form name=PatientLinks method=get>
<input type=hidden name=reportno value=1>
<input type=hidden name=template value=004>
<input type=hidden name=urnumber value="%WATWEB01.02.003">
<input type=hidden name=admissno value="%WATWEB01.02.081">
<input type=hidden name=MenuType value="%WATWEB01.02.088">
<input type=hidden name=casekeys value="%WATWEB01.02.101">
<input type=hidden name=wattrkey value="%WATWEB01.02.101">
<input type=hidden name=sesskeys value="">
</form>

<script type="text/javascript">
function init(){
var Status=UpdateForm.wattr005.value
  if (Status==1 || Status==6 || Status==7 || Status==8 ) {
    UpdateForm.wattr049.className="";
    }
  else {
UpdateForm.wattr049.className="Mandatory";
  }

}

function ValidateCat() {
Category="%WATWEB01.02.117.1";
if(Category != document.UpdateForm.wattr014.value.substr(0,3)) {
    document.UpdateForm.wathi002.className="PastDate Mandatory";
    document.UpdateForm.wathi001.className="Mandatory";
    document.UpdateForm.wathi002.readOnly= false;
    document.UpdateForm.wathi001.readOnly= false;
    document.UpdateForm.wathi001.disabled= false;
    SetCurrentDateTime(document.UpdateForm.wathi002);
  }
Status="%WATWEB01.02.175";
Unit="%WATWEB01.02.114.1";
if((Status!=UpdateForm.wattr005.value) || 
   (Unit!=UpdateForm.wattr011.value.substr(0,3))) {
    document.UpdateForm.wathi001.className="Mandatory";
    document.UpdateForm.wathi001.readonly= false; 
    document.UpdateForm.wathi001.disabled= false;
   }
}
//
Status="%WATWEB01.02.175";
 for (var i =0 ; i < document.UpdateForm.wattr005.length; i++) {
  if (document.UpdateForm.wattr005.options[i].value==Status.substr(0,1)) {
       document.UpdateForm.wattr005.selectedIndex=i } };
//
</script>
