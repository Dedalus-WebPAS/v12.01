<meta name="TemplateVersion" content="V12.01.00">
<meta name="TemplateHome" content="wahealth">
<meta name="HelpFileName" content="NoContextSet.html">
<meta name="CrossBrowser" content="true">
<link rel="stylesheet" href="../html/postcode.css" type="text/css">
<script type="text/javascript" src="../js/IBA_Category_C_.js"></script>
<script type="text/javascript" src="../js/IBA_Category_LA.js"></script>
<script type="text/javascript" src="../js/AutoPostCode.js"></script>
<script type="text/javascript" src="../js/EmrRegistration.js"></script>
<script type="text/javascript" src="../js/emrweb0201102.js"></script>
<script type="text/javascript">
function validateLocation(SearchField,SearchName) {
  if (isWhitespace(SearchField.value)) {
      SearchName.value="";
      return;;
  }
  SearchField.value=SearchField.value.toUpperCase()
  var serverURL   = "../cgi-bin/emrweb08.pbl?reportno=2" +
                    "&valdcode=" + SearchField.value.replace(/ /g,"+")
  var returnValue = RSExecute(serverURL);
  if (returnValue.status==0) {
    ReturnValue=returnValue.return_value.split("|")
    SearchName.value=trim(ReturnValue[1])
    SearchField.value=trim(ReturnValue[0])
  }
  else {
     document.UpdateForm.emvis006.focus();
     document.UpdateForm.emvis006.value="";
     document.UpdateForm.name_emvis006.value="";
  }
}

function showFundingSource() {
  i=document.UpdateForm.emvis008.selectedIndex;
  ind=document.UpdateForm.emvis008.options[i].value.substring(3,4);
  if (ind=="A") {
    document.getElementById("FundingHeading").innerHTML=
    document.getElementById("offdutyhd").innerHTML;
    document.getElementById("FundingId").innerHTML=
    document.getElementById("offdutyid").innerHTML;
  } else {
    if (ind=="P") {
      document.getElementById("FundingHeading").innerHTML=
      document.getElementById("fundinghd").innerHTML;
      document.getElementById("FundingId").innerHTML=
      document.getElementById("fundingidshown").innerHTML;
      document.UpdateForm.pmsvx141.className="Mandatory";
    } else {
      document.getElementById("FundingHeading").innerHTML="";
      document.getElementById("FundingId").innerHTML="";
    }
  }
}
function defaultDisasterCode() {

  if (document.UpdateForm.urnumber.value=="       0") {
     document.UpdateForm.dispt001.disabled=true;
     return;
  }

  if (!isWhitespace(document.UpdateForm.disacode.value)) {
  for (var i =0 ; i < document.UpdateForm.dispt001.length; i++) {
     if (document.UpdateForm.dispt001.options[i].value==
         document.UpdateForm.disacode.value) {
         document.UpdateForm.dispt001.selectedIndex=i
     }
    }
  }

  displayDisasterID();

  if (!isWhitespace(document.UpdateForm.dispt001.value)) {
    document.UpdateForm.dispt001.className = "Readonly";
    document.UpdateForm.dispt001.onfocus =
    function () {this.defaultIndex=this.selectedIndex};
    document.UpdateForm.dispt001.onchange =
    function () {this.selectedIndex=this.defaultIndex};
  }

}
function displayDisasterID() {
 p=document.UpdateForm;
  if (!isWhitespace(document.UpdateForm.dispt001.value)) {
    document.getElementById("disasteridnumbertitleDIV").innerHTML=
    document.getElementById("disasteridnumbertitleSPAN").innerHTML;
    document.getElementById("disasteridnumberDIV").innerHTML=
    document.getElementById("disasteridnumberSPAN").innerHTML;
  } else {
    document.getElementById("disasteridnumbertitleDIV").innerHTML="";
    document.getElementById("disasteridnumberDIV").innerHTML="";
  }

  if (!isWhitespace(document.getElementById("disasteridnumberDIV").innerHTML)) {
    var serverURL   = "../cgi-bin/patweb80.pbl?reportno=98" +
                    "&valdcode=" + UpdateForm.urnumber.value.replace(/ /g,"+") +
                    UpdateForm.dispt001.value.replace(/ /g,"+");
    var returnValue = RSExecute(serverURL);
    if (returnValue.status==0) {
      ReturnValue=returnValue.return_value.split("|");
      if (!isWhitespace(ReturnValue[0])) {
        p.dispt002.value=ReturnValue;
        p.dispt002.className="Readonly";
        p.dispt002.readOnly=true;
      }
    }
  }
}
function UpdatePage() {
  setRedirectAdm();
  document.UpdateForm.AddButton.disabled=true;
  document.UpdateForm.target="PopUpFrame";
  if (isWhitespace(top.menu.location.search)) {
    document.UpdateForm.nextpage.value=9;
  }

  if(!isWhitespace(document.UpdateForm.emvis001.value)) {
    if (SetDateYYYYMMDD(document.UpdateForm.emvis001.value) <
        SetDateYYYYMMDD(document.UpdateForm.d_pbdate.value)) {
     alert("Arrival Date must be after date of birth");
     document.UpdateForm.AddButton.disabled=false;
     return;
    }
  }

  if(document.UpdateForm.prevhosp.checked==true){
    document.UpdateForm.redirect.value="patweb07.pbl?reportno=15&template=001"
    if(document.UpdateForm.pmext049.value == "1") {
      document.UpdateForm.redirect.value+= "&mvithmva=1"+
      document.UpdateForm.redirect.value+ "&chckcomp="+
      document.UpdateForm.emvis008.value.substr(3,1);
    }
    if(document.UpdateForm.emclcin1.value == "M") {
      document.UpdateForm.redirect.value+= "&mvitrdir=1"+
      document.UpdateForm.redirect.value+ "&chckcomp="+
      document.UpdateForm.emvis008.value.substr(3,1);
    }
    SetCookie("prevhospCookie",'3');
  } else {
    if(document.UpdateForm.pmext049.value == 1 ||
       document.UpdateForm.emclcin1.value == "M") {
      document.UpdateForm.redirect.value = "patweb89.pbl?reportno=01&" +
      "template=342&urnumber=" + document.UpdateForm.urnumber.value    +
      "&mvmedrec=" + document.UpdateForm.mvmedrec.value;
      if (document.UpdateForm.pmext049.value == 1) {
        document.UpdateForm.redirect.value+= "&pmext049=" +
        document.UpdateForm.pmext049.value + "&admissno="+
        document.UpdateForm.redirect.value+ "&chckcomp="+
        document.UpdateForm.emvis008.value.substr(3,1);
      } else {
        document.UpdateForm.redirect.value+= "&admissno=";
      }
    }
  }
    setTimeout('document.UpdateForm.AddButton.disabled=false',1000);
  if (validateMandatory(document.UpdateForm)) { 
    document.UpdateForm.submit();
  }
}
function init() {
  checkReferred();
  filterCatCodeList(UpdateForm.emvis008,"8","E","3");
}
function valClaimCode() {
    if(!isWhitespace(document.UpdateForm.deftclam.value)) {
      return;                      
    }

    if (trim(document.UpdateForm.ptype.value.substr(5,1))=="S") 
    {
      for (var i =0 ; i < document.UpdateForm.emvis008.length; i++) {
      if ("E"==trim(document.UpdateForm.emvis008.options[i].value.substr(3,1))){
        document.UpdateForm.emvis008.selectedIndex=i;
        }
      }
    } 
    else  
    {
      if (trim(document.UpdateForm.ptype.value.substr(5,1))=="O")
      {
      for (var i =0 ; i < document.UpdateForm.emvis008.length; i++) {
      if ("G"==trim(document.UpdateForm.emvis008.options[i].value.substr(3,1))){
        document.UpdateForm.emvis008.selectedIndex=i;
        }
      }

      }
    }
}
// Do VEMD Error 132 check
//   If Referred by is a 5 - Emergency department review from this hospital
//   then Type of visit must be either 2 - return visit-planned
//                                  or 4 - outpatient/outpatient clinic
//   AND vis versa
// Do VEMD E142
//   Display warning if Type of visit is 10 - Dead on Arrival
//
function valEmrVisit() {
  if(document.UpdateForm.offdutyb!=undefined){
    if(document.UpdateForm.offdutyb.checked==true){
      alert("Error: Claim Type invalid for 'Off Duty' personnel.")
      return;
    }
  }
 

  if (!isWhitespace(document.UpdateForm.dispt001.value)) {
    var serverURL   = "../cgi-bin/comweb80.pbl?reportno=44" +
                    "&valdcode=" + UpdateForm.dispt001.value.replace(/ /g,"+") +
                    UpdateForm.emvis001.value.replace(/ /g,"+");
    var returnValue = RSExecute(serverURL);
    if (returnValue.status!=0) {
      return;
    }
  }

  validateSuspension(UpdateForm.urnumber,UpdateForm.emvis001,UpdateForm.datefrom,UpdateForm.dateto);

  if( UpdateForm.datefrom.value != "0" ){
         if(!confirm("Error : Patient has a Suspension record for period \n" +
               "\t" + UpdateForm.datefrom.value  + " - " + UpdateForm.dateto.value + "\n" +
               "\nWould you like to continue with the Registration?")) {
          return;
        }
  }

  i=document.UpdateForm.emvis061.selectedIndex;
  SrcInd=trim(document.UpdateForm.emvis061.options[i].value.substr(14,4));
  p=document.UpdateForm;
  CheckEmrOverlap(p.urnumber,p.emvis001,p.emvis002,UpdatePage);
}
</script>
%START.OF.PAGE
<body onload="PageLoad(event);valClaimCode();defaultDisasterCode();
 CheckAmbType();showFundingSource();">
<div id=PatientHeading></div>
<script type="text/javascript">
PatientURN="%EMRWEB02.02.003";
PatientVIS="%EMRWEB02.02.081";
PatientNAM="%EMRWEB02.02.002";
PatientSTA="%EMRWEB02.02.086.078";
PatientALT="%EMRWEB02.02.084";
PatientSEX="%EMRWEB02.02.019";
PatientDOB="%EMRWEB02.02.020";
PatientAGE="%EMRWEB02.02.021";
PatientLOC="%EMRWEB02.02.083";
PatientPRI="%EMRWEB02.02.086.066.1";
PatientUNT="%EMRWEB02.02.066.0";
PatientIND="%EMRWEB02.02.086.091";
GpCOD="%EMRWEB02.02.086.084.001";
GpNAM="%EMRWEB02.02.086.084.081";
GpPRAC="%EMRWEB02.02.086.085.001";
GpPRACCNT="%EMRWEB02.02.086.085.002";
GpPRACNAM="%EMRWEB02.02.086.085.005";
PatientARR="%EMRWEB02.02.101.0 %EMRWEB02.02.102";
PatientSEE="%EMRWEB02.02.199.008";
PatientTRI="%EMRWEB02.02.103.3";
PatientECLC="%EMRWEB02.02.484.1";
PatientCLH="%STANDARD.01.017.CL";
PatientEHFT="%EMRWEB02.02.485";
InsertEmergencyHeader();
</script>
<div id=PatientMenu></div>
<div id=PageBodySection>
<form name=UpdateForm action="emrweb02.pbl" method=post style="margin:0">
<input type=hidden name=reportno value="02">
<input type=hidden name=formactn value="N3">
<input type=hidden name=updttype value="ARRIV">
<input type=hidden name=updateky value="">
<input type=hidden name=admissno value="">
<input type=hidden name=urnumber value="%EMRWEB02.02.003">
<input type=hidden name=emvis118 value="%EMRWEB02.02.003">
<input type=hidden name=emvis147>
<input type=hidden name=dummyadm><input type=hidden name=fpatname>
<input type=hidden name=chckname><input type=hidden name=redirflg value="1">
<input type=hidden name=mvmedrec>
<input type=hidden name=datefrom>
<input type=hidden name=dateto>
<input type=hidden name=dontchec value=1>
<input type=hidden name=nextpage value="11"><input type=hidden name=redirect>
<input type=hidden name=ptcnueoc value="%EMRWEB02.02.454">
<input type=hidden name=ptcnxcom value="%STANDARD.01.025.116.222.0.1">
<input type="hidden" name="savealia" value="0">
<input type="hidden" name="aliasset" value="0">
<input type="hidden" name="prevaddr" value="0">
<input type="hidden" name="preaddset" value="0">
<input type="hidden" name="claimc">
<input type="hidden" name=deftclam value="%EMRWEB02.02.108.1">
<input type=hidden name=ptcnhdps value="%STANDARD.01.025.080.250.1.1">
<input type="hidden" name="ptcnusgn"  value="%STANDARD.01.025.114.219.0.1">
<input type="hidden" name="disacode" value="%EMRWEB02.02.498">
<input type="hidden" name="ptype" value="%EMRWEB02.02.024.3">
<input type="hidden" name="precinwa" value="1">
<input type="hidden" name="setemrcm" value="1">
<input type="hidden" name="d_pbdate" value="%EMRWEB02.02.020">
<input type="hidden" name="emclcin1">

<table align=center width=100% border=0 cellspacing=0 cellpadding=0>
  <tr>
    <td class=HeadingCell colspan=6 align=center>
      Register Emergency Patient
    </td>
  </tr>

  <tr>
    <td class=DataLabel>
      Arrival Date
    </td>
    <td class=DataLabel><input type="text" name=emvis001 size="12"
     onblur="checkDate(UpdateForm.emvis001,'Arrival Date');" tabindex=1
     title="Arrival Date"
     value="%EMRWEB02.02.101.0" class=Mandatory>
       <img src=../images/DateLookup.gif date=document.UpdateForm.emvis001
        class="Icon">
         Time
       <input type="text" name=emvis002 size="8" value="%EMRWEB02.02.102"
        title="Arrival Time"
        onblur="checkTime(this,'Arrival Time')" class=Mandatory tabindex=2>
       <img notab src=../images/DateTimeStamp.gif class="Icon"
        align=absmiddle 
        onclick="SetCurrentDateTime(UpdateForm.emvis001,UpdateForm.emvis002);">
       <img src=../images/TimeLookup.gif class="Icon"
        onclick="TimeLookupFrame(UpdateForm.emvis002);">
    </td>
    <td class=DataLabel>
      %STANDARD.01.017.CL
    </td>
    <td>
      <table cellspacing=0 cellpadding=0 border=0>
      <tr><td>
      <select class="Mandatory SelectMed" name=emvis008 tabindex=3 
       title="%STANDARD.01.017.CL" onchange=showFundingSource();>
         <option></option>
           %STANDARD.01.007.CL
      </select></td>
      </tr>
      </table>
    </td>
    <td><div id=FundingHeading></div></td>
    <td><div id=FundingId></div></td>
  </tr>
  <tr>
    <td class=DataLabel>
      Has this patient been in a Motor Vehicle Accident?
    </td>
    <td>
      <select class="Mandatory" name=pmext049 tabindex=1
       title="Has this patient been in a Motor Vehicle Accident?">
       %EMRWEB02.02.936.099.050
      </select>
    </td>
  </tr>
    <tr>
      <td class=DataLabel>
        Arrival Transport
      </td>
      <td>
        <select name=emvis013 class="SelectMed Mandatory" tabindex=5
         title="Arrival Transport"
         onchange="document.UpdateForm.emvis034.disabled=0;CheckAmbType();">
         <option></option>
           %EMRWEB02.02.113.2
        </select>
      </td>
     <td class=DataLabel>Amb Case No</td>
     <td><input type=text size=10 maxlength=15 name=emvis034 tabindex=6
         onFocus="CheckAmbType();" value="%EMRWEB02.02.134" title="Amb Case No"
         onblur="ValidateAmbCase();"></td>

    <td class=DataLabel>Attendance Type</td>
    <td><select class="Mandatory SelectMed" name=emvis053 tabindex=7
         title="Attendance Type">
     <option></option>
     %EMRWEB02.02.213.2
     </select></td>
    </tr>

  <tr>
    <td class=DataLabel>
        %STANDARD.01.017.em
    </td>
    <td>
        <select class="Mandatory SelectMed" name=emvis061 tabindex=8
         title="%STANDARD.01.017.em"
         onchange="checkReferred();">
          <option></option>
            %EMRWEB02.02.221.2
        </select>
     </td>
    <td class=DataLabel>
      %STANDARD.01.017.cw
    </td>
    <td>
      <select name=pmsvx135 class="Mandatory SelectMed" tabindex=9
       title="%STANDARD.01.017.cw">
         <option></option>
           %STANDARD.01.007.cw
      </select>
    </td>
    <td class=DataLabel>%STANDARD.01.017.eh</td>
    <td><select name=emvis056 tabindex=10 title="%STANDARD.01.017.eh"
         class="SelectBig">
        <option></option>
        %EMRWEB02.02.216.2
        </select></td>
  </tr>

  <tr>
     <td>
       Disaster Code
     </td>
     <td>
       <select name=dispt001 title="Disaster Code"
        onchange="displayDisasterID();" tabindex=11>
       <option></option>
         %EMRWEB02.02.497
       </select>
     </td>
    <td class=DataLabel><div id=disasteridnumbertitleDIV></div></td>
    <td><div id=disasteridnumberDIV></div></td>
  </tr>

 <tr>
     <td class=DataLabel>
       Location
     </td>
     <td>
       <input type=hidden name=name_emvis006 title="Location"
        value="%EMRWEB02.02.106.0">
     <select class="Mandatory SelectMed" name=emvis006 title="Location"
      tabindex=13 
     onchange="validateLocation(UpdateForm.emvis006,UpdateForm.name_emvis006);">
         %EMRWEB02.02.106.3
       </select>
     </td>

    <td align=left>Hospital Last 7 Days</td>
    <td>
      <table>
        <td align=left>
          <input type="checkbox" name="prevhosp" value="1" tabindex=14>
        </td>
      </table>
    </td>
 </tr>

<tr><td><div id=TranSrcHeading></div></td>
     <td><div id=TranSrc></div></td>
      <td class=DataLabel>
        %STANDARD.01.017.KD
      </td>
      <td>
        <select class="Mandatory SelectMed" name=pmsvx079 tabindex=16
         title="%STANDARD.01.017.KD">
          <option></option>
            %STANDARD.01.007.KD
        </select>
     </td>
</tr>

<tr><td colspan=6 align=center class=DataLabel>
    <input type=button name=AddButton value="Add" id="emr02add"
     onclick="tempDisable(this);valEmrVisit();" class="button" tabindex=20>
    <input type=button value="Cancel" class="button" 
    onclick='PatientLinkTo("patweb98.pbl",1,1,0,0,0);' tabindex=21>
    </td></tr>
</table>
</form>

<div id=SelectHeading></div>
<div id=SelectLocation></div>
<script type="text/javascript">
 if ("%EMRWEB02.02.033" == "Yes") {
  alert("Warning: Patient is Deceased");
  history.go(-1);
 }
 CTypeAdm="%EMRWEB02.02.252";
 if ( CTypeAdm == "Yes") {
   document.UpdateForm.emvis147.value=1; }
 else { 
   document.UpdateForm.emvis147.value=0; }

 var codeList = document.UpdateForm.emvis008.options;
 for (var i = 0; i < codeList.length; i++) {
   if (isWhitespace(codeList[i].value)) continue;
   var codeSingle = codeList[i].value.substr(3, 5); 
   if (codeSingle.match(/M/g) != null) {
     document.UpdateForm.emvis008.options[i].remove(i);
     i--;
   }
 }
 
</script>
<form name=HiddenFields method=get>
<input type=hidden name=cob value="%EMRWEB02.02.022.1">
<input type=hidden name=pl1 value="%EMRWEB02.02.602.1">
<input type=hidden name=pl2 value="%EMRWEB02.02.603.1">
</form>
<form name=PatientLinks method=get>
<input type=hidden name=reportno value=1>
<input type=hidden name=template value=004>
<input type=hidden name=regexstm value=102>
<input type=hidden name=newstand value=1>
<input type=hidden name=urnumber value="%EMRWEB02.02.003">
<input type=hidden name=admissno value="%EMRWEB02.02.081">
<input type=hidden name=MenuType value="%EMRWEB02.02.088">
<input type=hidden name=emrgflag value="Y">
<input type=hidden name=nextpage value="4">
<input type=hidden name=webuseid value="%STANDARD.01.008">
<input type=hidden name=regiflag value="1">
</form>

<span id=transferhd style="display:none">
<td class=DataLabel>Transfer Source</td>
</span>

<span id=transferblank style="display:none">
   <input type=hidden name=emvis032 value="" notab>
</span>

<span id=transfersrc style="display:none">
<td><input type="text" size=8 maxlength=6 name="emvis032" 
     value="%EMRWEB02.02.132.1" title="Transfer Source" class=Mandatory
     onchange='validateCode(9,UpdateForm.emvis032,UpdateForm.trnsfsrc);' 
     tabindex=15>
     <input type=text  size=25 name=trnsfsrc value="%EMRWEB02.02.132.0"
      readonly notab>
     <img src="../images/SearchIcon.gif" notab
     onclick="TransferSourceFrame(UpdateForm.emvis032,UpdateForm.trnsfsrc)"></td>
</span>

<span id=AustStateH style="display:none">
<table colspan=1 width=100% height=100% border=0 cellspacing=2 cellpadding=0>
    <td class=DataLabel>State</td>
</table>
</span>
<span id=AustState style="display:none">
<table colspan=1 width=100% height=100% border=0 cellspacing=2 cellpadding=0>
    <td><input type=text size=25 maxlength=25
       name=ptmas085 title="State" 
       value="%EMRWEB02.02.015"
       onChange="checkAdd01();UpCase(this);">
    </td>
</table>
</span>
<span id=OseasCountryH style="display:none">
<table colspan=1 width=100% height=100% border=0 cellspacing=2 cellpadding=0>
    <td class=DataLabel>Country</td>
</table>
</span>
<span id=OseasCountry style="display:none">
<table colspan=1 width=100% height=100% border=0 cellspacing=2 cellpadding=0>
    <td><select name="ptmas085" class="select120 Mandatory"
                 title="Country Address">
        <option></option>
        %EMRWEB02.02.085.060
        </select></td>
</table>
</span>

<span id=disasteridnumbertitleSPAN style="display:none">
Disaster Identification #
</span>

<span id=disasteridnumberSPAN style="display:none">
<input type="text" name=dispt002 size=20 maxlength=19
   title="Disaster Identification Number" tabindex=12>
</span>

<span id=blanklabel style="display:none">&nbsp;</span>
<span id=fundinghd style="display:none">
&nbsp;Funding Source
</span>

<span id=fundingidshown style="display:none">
  <select name=pmsvx141 title="%STANDARD.01.017.cx"
          tabindex=4>
          <option> </option>
             %EMRWEB02.02.514.4         
  </select>
</span>

<span id=offdutyhd style="display:none">
 Off Duty
</span>

<span id=offdutyid style="display:none">
 <input type="checkbox" name="offdutyb" value="0">
</span>
</div>
