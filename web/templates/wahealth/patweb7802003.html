<meta name="TemplateVersion" content="V12.01.00">
<meta name="TemplateHome" content="wahealth">
<meta name="HelpFileName" content="NoContextSet.html">
<meta name="CrossBrowser" content="true">
<script type="text/javascript" src="../js/patweb7802.js"></script>
<script type="text/javascript" src="../js/patweb9801001.js"></script>
<script type="text/javascript">
function UpdateCrossCons() {
 if (!validateMandatory(UpdateForm))
   return;

 var oldDoct = trim(document.UpdateForm.origdoct.value);
 var oldRefd = trim(document.UpdateForm.origrefd.value);

 p=UpdateForm;
 if(!CheckDateTimeRange(p.orig_ptcrc005,p.orig_ptcrc009,p.ptcrc005,p.ptcrc009)){
   if(!confirm("Date/Time prior to original Date/Time." +
               "\nClick Ok to Continue, Cancel to abort")) {
     return;
   }
 }

 document.UpdateForm.submit();
}
function SpecialitySelected(obj) {
  if (obj.selectedIndex == 0) {
    UpdateForm.ptcrc002.className = "Mandatory";  // Referred HCP
  }
  else {
    UpdateForm.ptcrc002.className = "";           // Referred HCP
  }
  UpdateForm.ptcrc008.className = "";             // Speciality
}
function valDoctorUnit() {
  ValidateHCP(18,0,UpdateForm.ptcrc002,UpdateForm.name_ptcrc002);
  if (UpdateForm.dispspec.value == "1") {
    if (UpdateForm.ptcrc002.value.length > 0) {
      // is a valid HCP; get their Specialities
      selectOptions2("45",UpdateForm.ptcrc002,UpdateForm.ptcrc008);
    }
    else {
      // no linked Specialities; pull complete list down from server
      selectOptions3("15",UpdateForm.CATEG_AC,UpdateForm.ptcrc008);
    }

    if (UpdateForm.ptcrc008.length == 2){
      // only one Speciality pulled down; so select it
      UpdateForm.ptcrc008.selectedIndex = 1;
    }

    if (UpdateForm.ptcrc008.selectedIndex > 0){
      // a Speciality has been selected; make Referred Consultant non-mandatory
      UpdateForm.ptcrc002.className = "";
    }
  }
}
function valDoctorUnit() {
  validateCode(31,UpdateForm.ptcrc002,UpdateForm.name_ptcrc002);
  selectOptions("30",UpdateForm.ptcrc002,UpdateForm.ptcrc011);
  UpdateForm.ptcrc011.selectedIndex=1;
}
function CompareTimestamps(offendingField){

  UF = document.UpdateForm;
  if(offendingField.value==""){
     return;
  }
  ts1 = SetDateYYYYMMDD(UF.ptcrc005.value) + UF.ptcrc009.value;
  if(ts1 < UpdateForm.d_emvidate.value){
     alert("Date/Time cannot be before admission timestamp");
     offendingField.value="";
     offendingField.focus();
     return;
  }
}
function ValDate(dateField,timeField){
   if (!checkDate(dateField,dateField.title)) {
      return;
   }
   if (!isWhitespace(timeField.value)) {
     CheckFutureTime(UpdateForm,dateField.value,timeField);
   }
}
function CheckSPecialtyAndRC(){
  if(UpdateForm.ptcrc008.value==""){
     UpdateForm.ptcrc002.className="Mandatory";
  }
  else{
     UpdateForm.ptcrc002.className="";
  }
  if(UpdateForm.ptcrc002.value==""){
     UpdateForm.ptcrc008.className="Mandatory";
  }
  else{
     UpdateForm.ptcrc008.className="";
  }
}
function CharLimit(limitField, limitNum) {
  if(limitField.value.length > limitNum) {
     limitField.value = limitField.value.substring(0, limitNum);
     alert("The comments field has a maximum length of 100 characters");
  }
}
</script>
</head>
%START.OF.PAGE
<body onload="PageLoad(event);
              SetCurrentDateTime(document.UpdateForm.ptcrc005,document.UpdateForm.ptcrc009);">
<span class=DFrameTitleBar id=DFrameHeading>
<img align="right" alt="Exit" class="MenuIcon" src="../images/ExitIcon.gif"
 onclick="DFrameExitRefresh();">
 Update Consult                    
</span>
<div id=PageHeadingSection>
<form name=UpdateForm action=patweb78.pbl method=post style="margin:0">
<input type=hidden name=reportno value=2>
<input type=hidden name=template value=003>
<input type=hidden name=urnumber value="%PATWEB78.02.003">
<input type=hidden name=admissno value="%PATWEB78.02.081">
<input type=hidden name=updttype value="U">
<input type=hidden name=strtdate value="%PATWEB78.02.211">
<input type=hidden name=stopdate value="%PATWEB78.02.207">
<input type=hidden name=multhosp value="">
<input type=hidden name=dispspec id=dispspec value="%PATWEB78.02.214">
<input type=hidden name=CATEG_AC value="AC">
<input type=hidden name=origdoct value="%PATWEB78.02.202.001">
<input type=hidden name=origrefd value="%PATWEB78.02.203.001">
<input type=hidden name=currdate value="%STANDARD.01.013">
<input type=hidden name=currtime value="%STANDARD.01.016">
<input type=hidden name=ptcrtime value="%PATWEB78.02.219">
<input type=hidden name=ptcractn value="%PATWEB78.02.220">
<input type=hidden name=ptcrunit value="%PATWEB78.02.221">
<input type=hidden name=ptcrcomm value="%PATWEB78.02.222">
<input type=hidden name=name_ptcrc002 value="%PATWEB78.02.223">
<input type=hidden name=d_emvidate value="%PATWEB78.02.224">
<input type=hidden name=ptcrc001 value="%PATWEB78.02.227">
<input type=hidden name=ptcrc002 value="%PATWEB78.02.223">
<input type=hidden name=ptcrc003 value="%PATWEB78.02.210">
<input type=hidden name=ptcrc008 value="%PATWEB78.02.216">
<input type=hidden name=orig_ptcrc005 value="%PATWEB78.02.208">
<input type=hidden name=orig_ptcrc009 value="%PATWEB78.02.219">
 
<table width=99% border=0 cellpadding=1 cellspacing=0 align=center>
  <tr>
    <td class=DataLabel>Date / Time</td>
    <td>
      <input type=text name="ptcrc005" size=12 class="Mandatory PastDate" title="Date" 
       value="%PATWEB78.02.208"
       onblur="ValDate(UpdateForm.ptcrc005,UpdateForm.ptcrc009);
               CompareTimestamps(this)">
      <img src="../images/DateLookup.gif" class=Icon
       onclick="DateLookupFrame(UpdateForm.ptcrc005);">
      <input type=text size=8 title="Time" name="ptcrc009" class="Mandatory"
       value="%PATWEB78.02.219" 
       onblur="checkTime(this,this.title);
               ValDate(UpdateForm.ptcrc005,UpdateForm.ptcrc009);
               CompareTimestamps(this)">
      <img notab src=../images/DateTimeStamp.gif class=Icon
       onclick="SetCurrentDateTime(UpdateForm.ptcrc005,UpdateForm.ptcrc009);">
      <img notab src="../images/TimeLookup.gif" class=Icon
       onclick="TimeLookupFrame(UpdateForm.ptcrc009);">
    </td>
  </tr>

  <tr>
   <td class=DataLabel>Action</td>
    <td>
      <select name="ptcrc010" class=Mandatory title="Action">
        %STANDARD.01.007.Ac 
      </select>
    </td>
  </tr>

  <tr>
    <td class=DataLabel>Referring Consultant</td>
    <td class=DataField>
      <input notab type=text name="d_ptcrc001" readonly class=Readonly value="%PATWEB78.02.202.081">
    </td>
  </tr>

  <tr>
    <td class=DataLabel><span id=SpecialityLbl></span></td>
    <td class=DataField><span id=SpecialityVal></span></td>
  </tr>

  <tr>
    <td class=DataLabel>Referred to Consultant</td>
    <td class=DataField>
      <input notab type=text name="d_ptcrc002" readonly class=Readonly value="%PATWEB78.02.203.081">
    </td>
  </tr>
  <tr>
    <td class=DataLabel>Referred to Consultant Unit</td>
    <td class=DataField>
      <input notab type=text name="d_ptcrc011" readonly class=Readonly
        value="%PATWEB78.02.226">
    </td>
  </tr>

  <tr>
    <td class=DataLabel>Comments</td>
    <td class=DataField>
       <input type=text name=ptcrc012 size=75 maxlength=100 title="Comments"
        value="%PATWEB78.02.222">
    </td>
  </tr>
</table>
<br>

</form>
</div>

<table width=95% border=0 align=center>
  <tr>
    <td align=center>
      <input type=button value="Update" class="button" onclick='UpdateCrossCons()'>
      <input type=button value="Cancel" class="button" onClick='DFrameCloseRefresh()'>
    </td>
  </tr>
</table>

<span id="spSpecLbl" style="display:none">Referred to Speciality</span>
<span id="spSpecVal" style="display:none">
  <select name=d_ptcrc008 title="Speciality" disabled>
    <option></option>
    %PATWEB78.02.215.2
  </select>
</span>

<script type="text/javascript">

  var hDispSpec = document.getElementById('dispspec');
  if(hDispSpec.value == '1') {
    var spLbl = document.getElementById('spSpecLbl');
    var spVal = document.getElementById('spSpecVal');
    var SpecLbl = document.getElementById('SpecialityLbl');
    var SpecVal = document.getElementById('SpecialityVal');

    if(spLbl && spVal && SpecLbl && SpecVal) {
       SpecLbl.innerHTML = spLbl.innerHTML;
       SpecVal.innerHTML = spVal.innerHTML;
       spVal.innerHTML = "";
    }
  }
  if("%PATWEB78.02.220"=="   "){
     for(i=0; i<UpdateForm.ptcrc010.length; i++){
       if(UpdateForm.ptcrc010[i].value.substr(3,1)=="R"){
          UpdateForm.ptcrc010.selectedIndex=i;
       }
     }
  }
  else{
     for(i=0; i<UpdateForm.ptcrc010.length; i++){
       if(UpdateForm.ptcrc010[i].value.substr(0,3)=="%PATWEB78.02.220"){
          UpdateForm.ptcrc010.selectedIndex=i;
       }
     }
  }

</script>

<form name=PatientLinks method=get>
<input type=hidden name=reportno value=2>
<input type=hidden name=template value=002>
<input type=hidden name=urnumber value="%PATWEB78.02.003">
<input type=hidden name=admissno value="%PATWEB78.02.081">
<input type=hidden name=MenuType value="%PATWEB78.02.088">
</form>
