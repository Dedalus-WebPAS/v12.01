<meta name="TemplateVersion" content="V12.01.00">
<meta name="TemplateHome" content="wahealth">
<meta name="HelpFileName" content="NoContextSet.html">
<meta name="CrossBrowser" content="true">
<script type="text/javascript" src="../js/cliweb0101.js"></script>
<script type="text/javascript">
function chkCm() {
  document.UpdateForm.alert015.value = " ";
}
function CheckDOBActDateRange(FromInput,ToInput)
{
  if (SetDateYYYYMMDD(FromInput.value) > SetDateYYYYMMDD(ToInput.value))
  {
    alert(" Date Activated is Prior to Patient Date of Birth.");
    return false ;
  }

  return true;
}
function UpdateAlert() {
  if(!isWhitespace(UpdateForm.alert003.value)) {
    if(!CheckDOBActDateRange(UpdateForm.patdobth,UpdateForm.alert003)) {
      return;
    }
  }
  if(!isWhitespace(UpdateForm.alert010.value)) {
    if(!CheckDateRange(UpdateForm.alert003,UpdateForm.alert010)) {
      return;
    }
  }
  if(!isWhitespace(UpdateForm.alert011.value)) {
    if(!CheckDateRange(UpdateForm.alert003,UpdateForm.alert011)) {
      return;
    }
  }
  if(!isWhitespace(UpdateForm.alert008.value)) {
    if(!CheckDateRange(UpdateForm.alert003,UpdateForm.alert008)) {
      return;
    }
  }

  // Limit comment text depending on alert type
  if (typeof document.UpdateForm.alcommnt != "undefined") {
    if (document.UpdateForm.d_alertind.value.substr(7,1)=="R" ||
        document.UpdateForm.d_alertind.value.substr(7,1)=="C") {

      if (UpdateForm.alcommnt.value.replace(/\r?\n/g,"").length > 500) {
        alert("Maximum Characters 500");
        FocusDelay(UpdateForm.alcommnt);
        return;
      }
    } else {
      if (UpdateForm.alcommnt.value.replace(/\r?\n/g,"").length > 250) {
        alert("Maximum Characters 250");
        FocusDelay(UpdateForm.alcommnt);
        return;
      }
    }
  }

  var dateVal = GetDateInactive();
  if (isWhitespace(dateVal)) {
    if (!checkAlertValidUpdate(UpdateForm)) {
      return;
    }
  }

  setFormactn('U');
}

function GetDateInactive()
{
  var ind = document.UpdateForm.d_alertind.value.substr(7,1);
  var dateVal = '';

  switch (ind)                                                                  
  {                                                                             
    case "B":
      // Micro Alert
      dateVal = UpdateForm.alert010.value;
      if (isWhitespace(dateVal)) {
        dateVal = UpdateForm.alert011.value;
      }
      break;

    case "M":
      // Medical Alert
      dateVal = UpdateForm.alert011.value;
      break;

    case "R":
      // Risk Alert
      dateVal = UpdateForm.alert011.value;
      break;

    case "C":
      // Chronic Alert
      dateVal = UpdateForm.alert011.value;
      break;
  }
  return dateVal;
}

function LinkDocument() {
  linkurl="cliweb08.pbl?reportno=01&template=013" +
          "&urnumber=" + document.UpdateForm.urnumber.value.replace(/ /g,"+") +
          "&admissno=" + document.UpdateForm.admissno.value.replace(/ /g,"+") +
          "&corsp017=" + document.UpdateForm.alert001.value.replace(/ /g,"+") +
          "&corsp018=" + document.UpdateForm.alert002.value.replace(/ /g,"+") +
          "&corsp019=" + document.UpdateForm.alert013.value.replace(/ /g,"+")
  Left=(document.body.clientWidth-600)/2
  DFrameLink(linkurl,0,Left,600,300)
}

function SetComments(){
  var txtComments = document.getElementById("alcommnt");
  var dcom = document.getElementById("d_comment").value; 
  
  var lineLen = txtComments.cols + 0;
  var arr = ArraySplitTextString(dcom,lineLen);

  if (arr == null) return;

  for (i=0; i < arr.length; i++) {
    if (i < (arr.length-1) && trim(arr[i]).length == lineLen) {
      txtComments.value += arr[i] + " ";  // append space to separate words
    }
    else {
      txtComments.value += arr[i];
    }
  }

  // compress spaces
  txtComments.value = txtComments.value.replace(/\s\s+/g,' ');
}

</script>
%START.OF.PAGE
</HEAD>
<body onload="PageLoad(event);SetComments();">
<span class=DFrameTitleBar>
<img align="right" alt="Exit" class="MenuIcon" 
 src="../images/ExitIcon.gif" onclick="DFrameExit();">
Update %CLIWEB01.01.101.8 Alert
</span>

<form name=UpdateForm method=post action=cliweb01.pbl>
<input type=hidden name=reportno value="1">
<input type=hidden name=template value="002">
<input type=hidden name=updttype value="A">
<input type=hidden name=urnumber value="%CLIWEB01.01.003">
<input type=hidden name=admissno value="%CLIWEB01.01.081">
<input type=hidden name=alert001 value="%CLIWEB01.01.107">
<input type=hidden name=alert002 value="%CLIWEB01.01.101.1">
<input type=hidden name=alert013 value="%CLIWEB01.01.132">
<input type=hidden name=d_alertind value="%CLIWEB01.01.101.3">
<input type=hidden name=nextpage value="5">
<input type=hidden name=patdobth value="%CLIWEB01.01.020"
       title="Date of Birth">
<input type=hidden name=d_comment id=d_comment value="%CLIWEB01.01.111">

<table align=center cellspacing=0 cellpadding=1 width=95% border=0>
<tr><td class=DataLabel width=20%>Alert </td>
     <td><input type=text name=codedesc id=codedesc size=60
          class=Readonly readonly value="%CLIWEB01.01.101.9.3">
    </td></tr>
</table>

<div id=ShowExtra></div>

<table align=center cellspacing=0 cellpadding=1 width=95% border=0>

%CLIWEB01.01.115

<tr><td class=DataLabel width=20%>Last Updated By</td>
    <td class=DataField width=30%>%CLIWEB01.01.126</td>
    <td class=DataLabel width=20%>Created By</td>
    <td class=DataField width=30%>%CLIWEB01.01.128</td></tr>

<tr><td class=DataLabel>Last Updated Date</td>
    <td class=DataField>%CLIWEB01.01.127</td>
    <td class=DataLabel>Date Created</td>
    <td class=DataField>%CLIWEB01.01.129</td></tr>

<tr><td colspan=4 align=center><br>
   <input type=button value="Update" class="button" onclick="UpdateAlert();">
   <input type=button value="Delete" class="button" name=delebutt id=delebutt
    onclick="setFormactn('D');">
   <input type=button value="Cancel" class="button" onclick="DFrameClose();">
</td></tr>
</table>
</form>

<span id=addmedical style="display:none">
<table align=center cellspacing=0 cellpadding=1 width=95% border=0>
<tr><td class=DataLabel width=20%>Date Activated</td>
    <td width=30%><input type=text name=alert003 id=alert003
        size=12 maxlength=12 class="Mandatory PastDate"
        value="%CLIWEB01.01.102" title="Date Activated"
        onchange="checkDate(this,'Date Activated');">
    <img src=../images/DateTimeStamp.gif class=Icon
     onclick="SetCurrentDateTime(UpdateForm.alert003,null);">
    <img src=../images/DateLookup.gif class=Icon
     onclick="DateLookupFrame(UpdateForm.alert003);">
    </td>
    <td class=DataLabel width=20%>Date Inactive</td>
    <td width=30%><input type=text name=alert011 id=alert011
        size=12 maxlength=12 value="%CLIWEB01.01.122" title="Date Inactive"
        class="PastDate" onblur="checkDate(this,'Date Inactive');">
    <img src=../images/DateTimeStamp.gif class=Icon
     onclick="SetCurrentDateTime(UpdateForm.alert011,null);">
    <img src=../images/DateLookup.gif class=Icon
     onclick="DateLookupFrame(UpdateForm.alert011);">
    </td>
</tr>

    <input type=hidden name=alert008 id=alert008 value=" ">
    <input type=hidden name=alert010 id=alert010 value=" ">

<tr><td class=DataLabel>Authorising Clinician</td>
    <td colspan=3><input type=text name=alert012 id=alert012 size=10 maxlength=8
        title="Authorising Clinician" class=Mandatory
        value="%CLIWEB01.01.123"
        onchange="ValidateHCP(18,12,alert012,d_alert012);">
       <input type=text size=35 name=d_alert012 id=d_alert012 
        value="%CLIWEB01.01.130" class=Readonly readonly>
    <img src=../images/SearchIcon.gif class=Icon name=hcpsicon id=hcpsicon
     onclick="HCPSearchFrame(alert012,d_alert012,7);">
    <img src="../images/ClearIcon.gif" class=Icon name=hcpeicon id=hcpeicon
     onclick="clrFields(alert012,d_alert012);">
    </td></tr>

    <input type=hidden name=alert006 id=alert006 value="0">
    <input type=hidden name=alert015 id=alert015 value="%CLIWEB01.01.139.0">

<tr><td class=DataLabel>Comment</td>
<tr><td colspan=4 align=center>
<textarea wrap=hard name=alcommnt id=alcommnt rows=4 cols=70 title="Comment"
 onblur="chkCm();" onkeydown="LimitText(this,99,250);"></textarea></td></tr>

<tr><td class=DataLabel>Initiating Hospital</td>
    <td class=DataField>%CLIWEB01.01.124.0</td>
    <td class=DataLabel>Comments By</td>
    <td class=DataField>%CLIWEB01.01.139.1</td></tr>
</table>
</span>

<span id=addmicro style="display:none">
<table align=center cellspacing=0 cellpadding=1 width=95% border=0>
<tr><td class=DataLabel width=20%>Date Activated</td>
    <td width=30%><input type=text name=alert003 id=alert003
        size=12 maxlength=12 class="Mandatory PastDate"
        value="%CLIWEB01.01.102" title="Date Activated"
        onblur="checkDate(this,'Date Activated');">
    <img src=../images/DateTimeStamp.gif border=0 hspace=4
     onclick="SetCurrentDateTime(UpdateForm.alert003,null);">
    <img src=../images/DateLookup.gif border=0 hspace=4
     onclick="DateLookupFrame(UpdateForm.alert003);">
    </td>
    <td class=DataLabel width=20%>Date Inactive</td>
    <td width=30%><input type=text class="PastDate" name=alert010 id=alert010
         size=12 maxlength=12 class="PastDate" value="%CLIWEB01.01.121"
         title="Date Inactive" onblur="checkDate(this,'Date Inactive');">
    <img src=../images/DateTimeStamp.gif class=Icon
     onclick="SetCurrentDateTime(UpdateForm.alert010,null);">
    <img src=../images/DateLookup.gif class=Icon
     onclick="DateLookupFrame(UpdateForm.alert010);">
    </td>
</tr>

    <input type=hidden name=alert008 id=alert008 value=" ">

<tr><td class=DataLabel width=20%>End Date (Date Cleared)</td>
    <td width=30%><input type=text name=alert011 id=alert011
        size=12 maxlength=12 class="PastDate"
        value="%CLIWEB01.01.122" title="End Date"
        onblur="checkDate(this,'End Date');">
    <img src=../images/DateTimeStamp.gif class=Icon
     onclick="SetCurrentDateTime(UpdateForm.alert011,null);">
    <img src=../images/DateLookup.gif class=Icon
     onclick="DateLookupFrame(UpdateForm.alert011);">
    </td>
    <td>&nbsp;</td>
    <td>&nbsp;</td>
</tr>

    <input type=hidden name=alert012 id=alert012 value=" ">
    <input type=hidden name=alert006 id=alert006 value="0">

<tr><td class=DataLabel>Initiating Hospital</td>
    <td class=DataField>%CLIWEB01.01.124.0</td>
    <td>&nbsp;</td>
    <td>&nbsp;</td></tr>
</table>
</span>

<span id=addrisk style="display:none">
<table align=center cellspacing=0 cellpadding=1 width=95% border=0>
<tr><td class=DataLabel width=20%>Date Activated</td>
    <td><input type=text name=alert003 id=alert003
        size=12 maxlength=12 class="Mandatory PastDate"
        value="%CLIWEB01.01.102" title="Date Activated"
        onblur="checkDate(this,'Date Activated');">
    <img src=../images/DateTimeStamp.gif class=Icon
     onclick="SetCurrentDateTime(UpdateForm.alert003,null);">
    <img src=../images/DateLookup.gif class=Icon
     onclick="DateLookupFrame(UpdateForm.alert003);">
    </td>
</tr>
    <input type=hidden name=alert010 id=alert010 value=" ">

<tr><td class=DataLabel width=20%>Next Review Date</td>
    <td width=30%><input type=text name=alert008 id=alert008
        size=12 maxlength=12 class="Mandatory"
        value="%CLIWEB01.01.112"  title="Next Review Date"
        onchange="checkDate(this,'Next Review Date');">
    <img src=../images/DateTimeStamp.gif class=Icon
     onclick="SetCurrentDateTime(UpdateForm.alert008,null);">
    <img src=../images/DateLookup.gif class=Icon
     onclick="DateLookupFrame(UpdateForm.alert008);">
    </td>
    <td class=DataLabel width=20%>End Date (Date Cleared)</td>
    <td width=30%><input type=text name=alert011 id=alert011
        size=12 maxlength=12 class="PastDate"
        value="%CLIWEB01.01.122" title="End Date"
        onblur="checkDate(this,'End Date');">
    <img src=../images/DateTimeStamp.gif class=Icon
     onclick="SetCurrentDateTime(UpdateForm.alert011,null);">
    <img src=../images/DateLookup.gif class=Icon
     onclick="DateLookupFrame(UpdateForm.alert011);">
    </td>
</tr>

<tr><td class=DataLabel>Authorising Clinician</td>
    <td colspan=4><input type=text name=alert012 id=alert012 size=10 maxlength=8
        title="Authorising Clinician" class=Mandatory
        value="%CLIWEB01.01.123"
        onchange="ValidateHCP(18,12,alert012,d_alert012);">
       <input type=text size=35 name=d_alert012 id=d_alert012 
        value="%CLIWEB01.01.130" class=Readonly readonly>
    <img src=../images/SearchIcon.gif class=Icon name=hcpsicon id=hcpsicon
     onclick="HCPSearchFrame(alert012,d_alert012,7);">
    <img src="../images/ClearIcon.gif" class=Icon name=hcpeicon id=hcpeicon
     onclick="clrFields(alert012,d_alert012);">
    </td></tr>

<tr><td class=DataLabel width=20%>Severity Level</td>
    <td><select name=alert006 id=alert006>
         %CLIWEB01.01.125
        </select>
</td></tr>
    <input type=hidden name=alert015 id=alert015 value="%CLIWEB01.01.139.0">

<tr><td class=DataLabel>Comment</td>
<tr><td colspan=4 align=center>
<textarea wrap=hard name=alcommnt id=alcommnt rows=4 cols=70 title="Comment"
 onblur="chkCm();" onkeydown="LimitText(this,99,500);"></textarea></td></tr>

<tr><td class=DataLabel>Initiating Hospital</td>
    <td class=DataField>%CLIWEB01.01.124.0</td>
    <td class=DataLabel>Comments By</td>
    <td class=DataField>%CLIWEB01.01.139.1</td></tr>
</table>
</span>

<span id=addchronic style="display:none">
<table align=center cellspacing=0 cellpadding=1 width=95% border=0>
<tr><td class=DataLabel width=20%>Date Activated</td>
    <td colspan=5><input type=text name=alert003 id=alert003 size=12
        maxlength=12 class="Mandatory PastDate"
        value="%CLIWEB01.01.102" title="Date Activated"
        onblur="checkDate(this,'Date Activated');">
    <img src=../images/DateTimeStamp.gif class=Icon
     onclick="SetCurrentDateTime(UpdateForm.alert003,null);">
    <img src=../images/DateLookup.gif class=Icon
     onclick="DateLookupFrame(UpdateForm.alert003);">
    </td>
</tr>
    <input type=hidden name=alert006 id=alert006 value="0">
    <input type=hidden name=alert010 id=alert010 value=" ">

<tr><td class=DataLabel>Next Review Date</td>
    <td colspan=2><input type=text name=alert008 id=alert008 size=12
        maxlength=12 class="Mandatory"
        value="%CLIWEB01.01.112"  title="Next Review Date"
        onchange="checkDate(this,'Next Review Date');">
    <img src=../images/DateTimeStamp.gif class=Icon
     onclick="SetCurrentDateTime(UpdateForm.alert008,null);">
    <img src=../images/DateLookup.gif class=Icon
     onclick="DateLookupFrame(UpdateForm.alert008);">
    </td>
    <td class=DataLabel>Date Inactive</td>
    <td colspan=2><input type=text name=alert011 id=alert011 size=12 
        maxlength=12 class="PastDate"
        value="%CLIWEB01.01.122" title="Date Inactive"
        onblur="checkDate(this,'End Date');">
    <img src=../images/DateTimeStamp.gif class=Icon
     onclick="SetCurrentDateTime(UpdateForm.alert011,null);">
    <img src=../images/DateLookup.gif class=Icon
     onclick="DateLookupFrame(UpdateForm.alert011);">
    </td>
</tr>

<tr><td class=DataLabel>Authorising Clinician </td>
    <td colspan=5><input type=text name=alert012 id=alert012 size=10 maxlength=8
        title="Authorising Clinician" class=Mandatory
        value="%CLIWEB01.01.123"
        onchange="ValidateHCP(18,12,alert012,d_alert012);">
       <input type=text size=35 name=d_alert012 id=d_alert012
        value="%CLIWEB01.01.130" class=Readonly readonly>
    <img src=../images/SearchIcon.gif class=Icon name=hcpsicon id=hcpsicon
     onclick="HCPSearchFrame(alert012,d_alert012,7);">
    <img src="../images/ClearIcon.gif" class=Icon name=hcpeicon id=hcpeicon
     onclick="clrFields(alert012,d_alert012);">
    </td></tr>

<tr><td class=DataLabel width=20%>Care Pathway Activated </td>
    <td width=10%><select name=alert014 id=alert014 class=Mandatory
         title="Care Pathway Activated">
        <option value=" "></option>
        <option value="0">No</option>
        <option value="1">Yes</option>
       </select></td>
    <td class=DataLabel>Care Pathway Last Updated By</td>
    <td class=DataField>%CLIWEB01.01.136.1</td>
    <td class=DataLabel>Date</td>
    <td class=DataField>%CLIWEB01.01.137</td>
</tr>
    <input type=hidden name=alert015 id=alert015 value="%CLIWEB01.01.139.0">

<tr><td class=DataLabel>Comment</td>
<tr><td colspan=6 align=center>
<textarea wrap=hard name=alcommnt id=alcommnt rows=4 cols=70 title="Comment"
 onblur="chkCm();" onkeydown="LimitText(this,99,500);"></textarea></td></tr>
</table>

<table align=center cellspacing=0 cellpadding=1 width=95% border=0>
<tr><td class=DataLabel width=20%>Initiating Hospital</td>
    <td class=DataField width=30%>%CLIWEB01.01.124.0</td>
    <td class=DataLabel width=20%>Comments By</td>
    <td class=DataField width=30%>%CLIWEB01.01.139.1</td>
</tr>
</table>

</table>
</span>

<span id="dfltdate" style="display:none">
  <input type=hidden name=alert003 id=alert003 value="%CLIWEB01.01.102">
</span>

<script type="text/javascript">
  var ind    = document.UpdateForm.d_alertind.value.substr(7,1);
  var Extra  = document.getElementById('ShowExtra');
 
  switch (ind)
  {
  case "B": 
    Extra.innerHTML = document.getElementById('addmicro').innerHTML;
    break;

  case "M": 
    Extra.innerHTML = document.getElementById('addmedical').innerHTML;
    break;

  case "R": 
    Extra.innerHTML = document.getElementById('addrisk').innerHTML;
    break;

  case "C": 
    Extra.innerHTML = document.getElementById('addchronic').innerHTML;
    break;

  default : 
    Extra.innerHTML = document.getElementById('dfltdate').innerHTML;
    break;
 }
//
InitHosp="%CLIWEB01.01.124.1";
CurrHosp="%STANDARD.01.032";
if (typeof document.UpdateForm.alert012 != "undefined") 
{
  if(!isWhitespace(UpdateForm.alert012.value)) {
    if (InitHosp!==CurrHosp) {
        UpdateForm.alert012.readOnly = true;
        UpdateForm.alert003.readOnly = true;
        UpdateForm.hcpsicon.disabled = true;
        UpdateForm.hcpeicon.disabled = true;
        UpdateForm.alert012.className = "Readonly";
        UpdateForm.alert003.className = "Readonly";
    }
  }
}
//
if("%CLIWEB01.01.114" == "1") {
  document.UpdateForm.docobutt.disabled = true;
}
if("%CLIWEB01.01.131" == "1") {
  document.UpdateForm.delebutt.disabled = true;
}
if (typeof document.UpdateForm.alert014 != "undefined") {
  for (var i=0;i<document.UpdateForm.alert014.length;i++){
    if (document.UpdateForm.alert014.options[i].value=="%CLIWEB01.01.135.0"){
      document.UpdateForm.alert014.selectedIndex=i}};
}
</script>

