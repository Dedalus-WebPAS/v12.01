<meta name="TemplateVersion" content="V12.01.00">
<meta name="TemplateHome" content="wahealth">
<meta name="HelpFileName" content="NoContextSet.html">
<meta name="CrossBrowser" content="true">
<script type="text/javascript" src="../js/OutpatientSelect.js"></script>
<script type="text/javascript" src="../js/OutpatientTypeClinic.js"></script>
<script type="text/javascript" src="../js/outweb0808.js"></script>
<script type="text/javascript">
function OffDuty() {
  if(UpdateForm.offdutyb!=undefined){
    if(UpdateForm.offdutyb.checked==true){
      alert("Error: Claim Type invalid for 'Off Duty' personnel.")
      return true;
    }
  }
  if(document.UpdateForm.d_otart038.checked==true) {
    document.UpdateForm.otart038.value="1";
  } else {
    document.UpdateForm.otart038.value="0";
  } 
  return false;
}
function PostUpdateRequest() {
  if (OffDuty()) {return;}
  if(document.UpdateForm.d_cancelrq.checked==true) {
    document.UpdateForm.cancelrq.value="1";
  } else {
    document.UpdateForm.cancelrq.value="0";
  }
  if(validateMandatory(UpdateForm)) {
    document.UpdateForm.nextpage.value="6";
    if (!isWhitespace(document.UpdateForm.arlpckie.value)) {
      if(document.UpdateForm.arlpckie.value.length>240) {
        document.UpdateForm.redirect.value=
        document.UpdateForm.arlpckie.value.substring(0,240);
        document.UpdateForm.redirec1.value=
        document.UpdateForm.arlpckie.value.substring(240);
        document.UpdateForm.nextpage.value="8";
      } else {
        document.UpdateForm.redirect.value=document.UpdateForm.arlpckie.value;
      }
    }
    tempDisable(document.UpdateForm.updtbutt);
    document.UpdateForm.updttype.value="U";
    if (document.UpdateForm.closeref.value=="Y"){
      document.UpdateForm.nextpage.value="0";
    }
    valReferralClaim();
    document.UpdateForm.otart006.disabled=false;
    document.UpdateForm.otart010.disabled=false;
    document.UpdateForm.submit();
  }
}
function SetList() {
  p=UpdateForm
  p.otart010.options.length=1;
  SetClinicType(p.otart010,p.defctype.value,p.otart009.value);
//
  SetList2();
}
function SetList2() {
  p=UpdateForm
  p.otart011.options.length=1;
  SetTypeClinic(p.otart011,p.deftclid.value,p.otart009.value,p.otart010.value);
}
function SetList3() {
  p=UpdateForm
  SelectSourceOfReferral(p.otart009,p.otart008,p.otart017);
  for (var i =0 ; i < p.otart017.length; i++) {
  if (p.otart017.options[i].value.substr(0,3)==p.d_otart017.value.substr(0,3)) {
       p.otart017.selectedIndex=i } };
}
function MandatoryReason() {
  if(document.UpdateForm.d_cancelrq.checked==true) {
    document.UpdateForm.otart022.disabled=false;
    document.UpdateForm.otart022.className="selectBig Mandatory";
  } else {
    document.UpdateForm.otart022.selectedIndex=0;
    document.UpdateForm.otart022.className="selectBig";
    document.UpdateForm.otart022.disabled=true;
  }
}
function CloseRequest() {
  if (document.UpdateForm.closeref.value=="Y"){
    DFrameExitRefresh();
    return;
  }

  if (isWhitespace(document.UpdateForm.arlpckie.value)) {
    parent.location.href=document.UpdateForm.redirect.value;
  } else {
    parent.location.href=document.UpdateForm.arlpckie.value;
  }
}
function CloseRequestConfirm() {
  if(confirm("Are you sure you want to Close?")) {
     CloseRequest();
  }
}
function showFundingSource() {
   i=document.UpdateForm.otart015.selectedIndex;
   ind=document.UpdateForm.otart015.options[i].value.substring(3,4)
   if (ind=="A") {
     FundingHeading.innerHTML=offdutyhd.innerHTML;
     FundingId.innerHTML=offdutyid.innerHTML;
   } else {
     if (ind=="P") {
       FundingHeading.innerHTML=fundinghd.innerHTML;
       FundingId.innerHTML=fundingidshown.innerHTML;
       document.UpdateForm.otart037.className="Mandatory";
     } else {
       FundingHeading.innerHTML=blanklabel.innerHTML;
       FundingId.innerHTML=blanklabel.innerHTML;
     }
   }
}
function defAppointComm() {
  if (GetCookieData("apptcommcookie")!="unknown") {
    x = GetCookieData("apptcommcookie");
    ExpireCookiePath("apptcommcookie");
    document.UpdateForm.otrcmcom.value=x;
  }
}
function getActionReqListPathCookie() {
  if (GetCookieData("actionreqlistpathcookie")!="unknown") {
    x = GetCookieData("actionreqlistpathcookie");
    ExpireCookiePath("actionreqlistpathcookie");
    document.UpdateForm.arlpckie.value=x;
  }
}
function getClosedReferral() {
  if (isWhitespace(document.getElementById('alrevisn').value)) {return;}

  var serverURL   = "../cgi-bin/emrweb08.pbl?reportno=46" +
                    "&valdcode=" +
                    document.getElementById('alrevisn').value.replace(/ /g,"+")
  var returnValue = RSExecute(serverURL);
  if (returnValue.status==0) {
    if (!isWhitespace(returnValue.return_value)) {
      if(!confirm('Warning this referral was closed on ' +
       returnValue.return_value + '. Click OK to continue, Cancel to abort.')) {
        return false;
      }
    }
  }
  return true;
}
function valReferralClaim() {
  var claimCodeVal = UpdateForm.otart015.value.substr(0,3);
  var serverURL = "../cgi-bin/outweb02.pbl?reportno=9&updatety=19" +
                  "&admissno="+UpdateForm.admissno.value.replace(/ /g,"+") +
                  "&outbb002="+claimCodeVal +
                  "&urnumber="+UpdateForm.urnumber.value.replace(/ /g,"+")
  var returnValue = RSExecute(serverURL);
  if (returnValue.status==0) {
    ReturnValue=returnValue.return_value.split("|");
    if (ReturnValue[0] === '1') {
      var categoryName = ReturnValue[3].trim();
      var ans=confirm("The Outpatient Appointment " + categoryName +
      " does not match the Referral " + categoryName + ".\n\n" +
      "Outpatient Appointment " + categoryName + " = " + ReturnValue[2] +
      "\n" +
      "Referral " + categoryName + " = " + ReturnValue[1] + "\n\n" +
      "Press OK to update the Referral " + categoryName + " code.\n" +
      "Press Cancel to leave the Referral " +categoryName+ " code unchanged.");
      if (ans) {

        var fundingSourceVal = " ";
        if (UpdateForm.otart037 !== undefined) {
          fundingSourceVal = UpdateForm.otart037.value.substr(0,3);
        }
        var serverURL = "../cgi-bin/outweb02.pbl?reportno=9&updatety=20" +
                        "&admissno="+UpdateForm.admissno.value.replace(/ /g,"+") +
                        "&outbb002="+claimCodeVal+"&pmsvx141="+fundingSourceVal +
                        "&urnumber="+UpdateForm.urnumber.value.replace(/ /g,"+");
        var returnValue = RSExecute(serverURL);
      }
    }
  }
}
function getindc30() {
 var ind30 = document.UpdateForm.deptlcod.value.substr(77,1);
 if(ind30 == "D") {
  document.UpdateForm.otart010.disabled=true;
  document.UpdateForm.otart006.disabled=true;
 }
}

</script>
</head>
%START.OF.PAGE
<body onload="PageLoad(event);SetList();showFundingSource();defAppointComm();
              getActionReqListPathCookie();getindc30();">
<span class=DFrameTitleBar>
<img align="right" alt="Exit" class="MenuIcon"
 src="../images/ExitIcon.gif" onclick="CloseRequest();">
<script type="text/javascript">
  document.write('Update Appointment Request - %OUTWEB08.08.002 (%OUTWEB08.08.003)');
</script>
</span>

<form name=UpdateForm method=post action=outweb08.pbl style="margin:0">
<input type=hidden name=reportno value="08">
<input type=hidden name=template value="003">
<input type=hidden name=updttype value="">
<input type=hidden name=urnumber value="%OUTWEB08.08.003">
<input type=hidden name=admissno value="%OUTWEB08.08.081">
<input type=hidden name=otart001 value="%OUTWEB08.08.201">
<input type=hidden name=otart002 value="%OUTWEB08.08.202">
<input type=hidden name=otart003 value="%OUTWEB08.08.203">
<input type=hidden name=otart004 value="%OUTWEB08.08.204">
<input type=hidden name=defctype value="%OUTWEB08.08.210.1">
<input type=hidden name=deftclid value="%OUTWEB08.08.211.1">
<input type=hidden name=cancelrq value="">
<input type=hidden name=requestk value="%OUTWEB08.08.241">
<input type=hidden name=nextpage value="6">
<input type=hidden name=redirect value="%OUTWEB08.08.001.outweb08.08.001">
<input type=hidden name=redirec1 value="">
<input type=hidden name=d_otart017 value="%OUTWEB08.08.217.1">
<input type=hidden name=alreprty value="%OUTWEB08.08.322">
<input type=hidden name=arlpckie value="">
<input type=hidden name=alrevisn id=alrevisn value="%OUTWEB08.08.202">
<input type=hidden name=closeref value="%OUTWEB08.08.534">
<input type=hidden name=deptlcod id=deptlcod value="%OUTWEB08.08.125.3">

<table align=center width=98% border=0 cellspacing=0 cellpadding=1>
<tr><td class=DataLabel>Requesting Department</td>
    <td class=DataField>%OUTWEB08.08.205.0</td>
    <td class=DataLabel>Requested By</td>
    <td class=DataField>%OUTWEB08.08.239</td>
    <td class=DataLabel>Request Date</td>
    <td class=DataField>%OUTWEB08.08.203 at %OUTWEB08.08.204</td>
    </tr>

<tr><td class=DataLabel>Reason for Request</td>
    <td class=DataField>
    <select class="SelectBig Mandatory" name=otart021
     title="Reason for Request">
    <option></option>
     %OUTWEB08.08.221.2
    </select>
    </td>
    <td class=DataLabel>Linked Referral Number</td>
    <td class=DataField>%OUTWEB08.08.202</td>
    <td class=DataLabel>&nbsp;</td>
    <td class=DataField>&nbsp;</td>
    </tr>

<tr><td class=DataLabel>Status</td>
    <td class=DataField>%OUTWEB08.08.220.1</td>
    <td class=DataLabel>&nbsp;</td>
    <td class=DataField>&nbsp;</td>
    <td class=DataLabel>&nbsp;</td>
    <td class=DataField>&nbsp;</td>
    </tr>


<tr><td colspan=6 align=center><hr></td></tr>
</table>

<table align=center width=98% border=0 cellspacing=0 cellpadding=1>
<tr><td class=DataLabel>Department Required</td>
    <td class=DataField>
    <select class="SelectBig Mandatory" name=otart006
     title="Appointment Required For Department">
    <option></option>
     %OUTWEB08.08.329
    </select>
    </td>
    <td class=DataLabel>Preferred Date</td>
    <td class=DataField>
    <input type=text name=otart007 value="%OUTWEB08.08.207"
     title="Preferred Date" class="Date">
    <img src="../images/DateTimeStamp.gif" class=Icon
      onclick="SetCurrentDateTime(UpdateForm.otart007,null);">
    <img src=../images/DateLookup.gif class=Icon date=date1
     align=absmiddle onclick="DateLookupFrame(UpdateForm.otart007);">
    </td>
    </tr>

<tr><td class=DataLabel>Clinic Type</td>
    <td class=DataField>
    <select name=otart010 title="Clinic Type" class="Mandatory"
     onchange="SetList2();">
    <option></option>
    </select>
    </td>
    <td class=DataLabel>Preferred Hospital</td>
    <td class=DataField>
    <select name=otart008 title="Preferred Hospital" class="Mandatory"
     onchange="SetList3();">
    <option></option>
    %OUTWEB08.08.208.2
    </select>
    </td>
    </tr>

<tr><td class=DataLabel>Clinic Id</td>
    <td class=DataField>
    <select name=otart011 title="Clinic ID">
    <option></option>
    </select>
    </td>
    <td class=DataLabel>Preferred Site</td>
    <td class=DataField>
    <select name=otart009 title="Preferred Site" class="Mandatory"
     onchange="SetList();SetList3();">
    %OUTWEB08.08.209.2
    </select>
    </td>
    </tr>

<tr><td class=DataLabel>Visit Type</td>
    <td class=DataField>
    <select name=otart012 title="Visit Type" class="selectBig">
    <option></option>
    %OUTWEB08.08.243
    </select>
    </td>
    <td class=DataLabel>Presenting Complaint</td>
    <td class=DataField>
    <input type=text name=otart014 size=45 maxlength=50
     title="Presenting Complaint" value="%OUTWEB08.08.214">
    </td>
    </tr>

<tr><td class=DataLabel>%STANDARD.01.017.CL</td>
    <td class=DataField>
    <table cellspacing=0 cellpadding=0 width=100%>
    <tr><td>
    <select name=otart015 title="%STANDARD.01.017.CL" 
     class="Mandatory selectBig" onchange="showFundingSource();" >
    <option></option>
    %OUTWEB08.08.215.2
    </select>
    </td>
    <td><div id=FundingHeading style="white-space:nowrap"></div></td>
    <td><div id=FundingId></div></td></tr>
    </table>
    </td>
    <td class=DataLabel>Transport</td>
    <td class=DataField>
    <select name=otart013 title="Transport"
     class="selectBig">
    <option></option>
    %OUTWEB08.08.213.2
    </select>
    </td>
    </tr>

<tr><td class=DataLabel>Source of Referral</td>
    <td class=DataField>
    <select name=otart017 title="Source of Referral"
     class="Mandatory selectBig">
    <option></option>
    %OUTWEB08.08.217.2
    </select>
    </td>
    <td class=DataLabel>Special Arrangements</td>
    <td class=DataField>
    <select name=otart018 title="Special Arrangements"
     class="selectBig">
    <option></option>
    %OUTWEB08.08.218.2
    </select>
    </td>
    </tr>

<tr><td class=DataLabel>Priority</td>
    <td class=DataField>
    <select name=otart016 title="Priority"
     class="selectBig">
    <option></option>
    %OUTWEB08.08.216.2
    </select>
    </td>
    <td class=DataLabel></td>
    <td class=DataField></td>
    </tr>

<tr><td class=DataLabel>Interpreter Required</td>
    <td class=DataField><input type="hidden" name="otart038" value="">
                        <input type="checkbox" name="d_otart038" value="1">
    &nbsp;
    <span class="Red">%OUTWEB08.08.086.002.0</span>
    <td class=DataLabel></td>
    <td class=DataField></td>
    </tr>

<tr><td class=DataLabel>Cancel Request</td>
    <td class=DataField>
    <input type=checkbox name=d_cancelrq value="1" 
     onclick="MandatoryReason();">
    </td>
    <td class=DataLabel>Reason for Removal</td>
    <td class=DataField>
    <select name=otart022 title="Reason for Removal"
     class="selectBig">
    <option></option>
    %OUTWEB08.08.222.2
    </select>
    </td>
    </tr>

<tr><td class=DataLabel>Appointment Comments</td>
    <td class=DataField colspan=3>
    <textarea name=otrcmcom wrap=hard cols=60 rows=3>%OUTWEB08.08.247</textarea>
    </td></tr>

<tr><td colspan=6 align=center><br>
    <input type=button value="Update" class="button" name="updtbutt"
     onclick="PostUpdateRequest();">
    <input type=button value="Appointment" class="button" name="apptbutt"
     onclick="if (!getClosedReferral()) {return;}
             BookPatient(UpdateForm.requestk.value,UpdateForm.alreprty.value);">
    <input type=button value=Cancel class="button" 
     onclick="CloseRequestConfirm();">
    </td></tr>
</table>
</form>

<span id=blanklabel style="display:none">
<input type=hidden name=otart037 value=" ">
</span>

<span id=fundinghd style="display:none">
&nbsp;Funding Source&nbsp;
</span>

<span id=fundingidshown style="display:none">
<select name=otart037 title="%STANDARD.01.017.cx">
<option> </option>
%OUTWEB08.08.242.5
</select>
</span>

<script type="text/javascript">
 p = document.UpdateForm;
 CancReason="%OUTWEB08.08.222.1"
 if(!isWhitespace(CancReason)) {
   document.UpdateForm.d_cancelrq.checked=true;
 }
 MandatoryReason();
//
 Status="%OUTWEB08.08.220.0"
 if(Status == 2 || Status == 3) {
   p.apptbutt.disabled=true;
 }
 if(Status == 2) {
   p.updtbutt.disabled=true;
 }
 if (p.closeref.value=="Y") {
   p.apptbutt.disabled = true;
 }
 //
 CommentSecurity = "%OUTWEB08.08.334";
 if(CommentSecurity=="1"){
  document.UpdateForm.otrcmcom.readOnly=true;
  document.UpdateForm.otrcmcom.className="Readonly";
 }
</script>

<span id=offdutyhd style="display:none">
&nbsp;Off Duty&nbsp;
</span>

<span id=offdutyid style="display:none">
<input type="checkbox" name="offdutyb" value="0">
</span>

<script type="text/javascript">
 filterCatCodeList(document.UpdateForm.otart015,"1","M","1");
 PMIInterpreter="%OUTWEB08.08.086.001.0";
 RequestInterpreter="%OUTWEB08.08.244.0";
 if (PMIInterpreter != "1") {
    UpdateForm.d_otart038.disabled=true;
 } else {
   if (RequestInterpreter == "1") {
      UpdateForm.d_otart038.checked = true;
   }
 }
</script>
