<meta name="TemplateVersion" content="V12.01.00">
<meta name="TemplateHome" content="bhs">
<meta name="HelpFileName"    content="NoContextSet.html">
<meta name="RefreshTime" content="90">
<meta name="CrossBrowser" content="true">
<script type="text/javascript" src="../js/SmallTable.js"></script>
<script type="text/javascript" src="../js/EmergencyMapSetupBHS.js"></script>
</head>
%START.OF.PAGE
<body onload="PageLoad(event);">
<!--
<body onload="PageLoad(event);document.test.doctor.focus()">
<form name=test method=get>
-->
<script type="text/javascript">
 var obj = new Map("paper.gif");
 immediate = 0
 emergency = 0
 urgent = 20
 semi = 50
 non = 110

<!-- Paste below from site file emrergencymap.txt-->

//  Location
//  Description, Code, left, top, right, botton, Start Position Left, Top
 obj.AddLocation("Procedures    ","MP ",806,451,1006,495,806,451);
 obj.AddLocation("Bay 16        ","B16",806,406,1006,450,806,406);
 obj.AddLocation("Bay 15        ","B15",806,361,1006,405,806,361);
 obj.AddLocation("Bay 14        ","B14",806,316,1006,360,806,316);
 obj.AddLocation("Bay 13        ","B13",806,271,1006,315,806,271);
 obj.AddLocation("Bay 12        ","B12",806,226,1006,270,806,226);
 obj.AddLocation("Bay 11        ","B11",806,181,1006,225,806,181);
 obj.AddLocation("Bay 10        ","B10",806,136,1006,180,806,136);
 obj.AddLocation("Bay 09        ","B09",806,91,1006,135,806,91);
 obj.AddLocation("Bay 08        ","B08",806,46,1006,90,806,46);
 obj.AddLocation("Decon         ","00 ",806,1,1006,43,806,1,"HIDE");

 obj.AddLocation("Bay 19        ","B19",605,451,805,495,605,451);
 obj.AddLocation("Bay 21        ","B21",605,406,805,450,605,406);
 obj.AddLocation("CT            ","CT ",605,361,805,405,605,361);
 obj.AddLocation("RAV / Corridor","COR",605,316,805,360,605,316,"HIDE");
 obj.AddLocation("Fast Track 1  ","FT1",605,271,805,315,605,271);
 obj.AddLocation("Fast Track 2  ","FT2",605,226,805,270,605,226);
 obj.AddLocation("Bay 17        ","B17",605,181,805,225,605,181);
 obj.AddLocation("Alt ED        ","AED",605,136,805,180,605,136,"HIDE");
 obj.AddLocation("Bay 07        ","B07",605,1,805,45,605,1);

 obj.AddLocation("Bay 20        ","B20",404,451,604,495,404,451);
 obj.AddLocation("Relatives     ","REL",404,406,604,450,404,406);
 obj.AddLocation("Interview     ","INT",404,361,604,405,404,361);
 obj.AddLocation("Fast Track 5  ","FT5",404,316,604,360,404,316);
 obj.AddLocation("Fast Track 4  ","FT4",404,271,604,315,404,271);
 obj.AddLocation("Fast Track 3  ","FT3",404,226,604,270,404,226);
 obj.AddLocation("Bay 18        ","B18",404,181,604,225,404,181);
 obj.AddLocation("Bay 06        ","B06",404,1,604,45,404,1);

 obj.AddLocation("Bay 01        ","B01",203,181,403,225,203,181);
 obj.AddLocation("Bay 02        ","B02",203,136,403,180,203,136);
 obj.AddLocation("Bay 03        ","B03",203,91,403,135,203,91);
 obj.AddLocation("Bay 04        ","B04",203,46,403,90,203,46);
 obj.AddLocation("Bay 05        ","B05",203,1,403,45,203,1);

 obj.AddLocation("Waiting Room  ","WR ",2,227,402,495,2,227,"WAIT");

 obj.AddLocation("Resus 3       ","3RS",2,181,202,225,2,181);
 obj.AddLocation("Resus 2       ","2RS",2,136,202,180,2,136);
 obj.AddLocation("Resus 1       ","1RS",2,91,202,135,2,91);

 obj.AddLocation("Other         ","OTH",1024,1024,1024,1024,1024,1024);

<!-- Paste above from site file emergencymap.txt -->
// Output Expected Patients
//
%EMRWEB01.01.043
//
//  Patients
//  Name, Location Code, U/R, Triage, Arrival, Time,Sex, Age, Complaint, Doctor
%EMRWEB01.01.006
//
// Output Map View
//
ShowMap(immediate,emergency,urgent,semi,non);
//
// Output Hall of Shame
//
 t = new Table(1,0,1,"100%","center","Incomplete Patients")
//
// Add Columns in Order Required
// Heading,Type,Display Column,Sort Column,Align
//
 t.addColumn("Incomplete Patients","String",1,1,"left","EditIcon.gif","0","80%")
 t.addColumn("Patients","String",2,2,"center","","","20%")
//
// Add Rows to Table (Output from Web Server)
//
%EMRWEB01.01.032
 TableOutput(1,0)

SystemComments.innerHTML=
"<table width=100% border=1 cellspacing=0 cellpadding=3>" +
"<tr><td bgcolor=white align=center>%EMRWEB01.01.053</td></tr>"+
"</table>"

EmergencyCount.innerHTML=
"<table border=0 cellspacing=0 cellpadding=4 width=100%>" +
"<tr><td>Total :</td><td><b>%EMRWEB01.01.007</td>" +
"    <td>Waiting</td><td><b>%EMRWEB01.01.009</td>" +
"    <td>Unseen</td><td><b>%EMRWEB01.01.010</td>" +
"<tr><td>Inc Dr</td><td><b>%EMRWEB01.01.012</td>" +
"    <td>Nurse </td><td><b>%EMRWEB01.01.013</td>" +
"    <td>PSC </td><td><b>%EMRWEB01.01.014</td>" +
"</tr></table>"

<!-- CGA UPDATED 20180319 Internal Wait Room -->
if ("%EMRWEB01.01.045.00 "=="O"){
BlackHole.innerHTML=
"<table border=0 cellspacing=2 cellpadding=2 width=100% bgcolor=0066FF>" +
"<tr valign=middle><td align=center>" +
"<img src='../images/Suspend.gif' class=Icon onclick=OtherLocations00()></td>" +
"<td><font color=white size=2>Internal Wait Room</td>" +
"<td><font color=white size=2>%EMRWEB01.01.044.00 </td>" +
"</tr></table>"
}
else {
BlackHole.innerHTML=
"<table border=0 cellspacing=2 cellpadding=2 width=100% bgcolor=0066FF>" +
"<tr valign=middle><td align=center>" +
"<img src='../images/Suspend.gif' class=Icon onclick=OtherLocations00()></td>" +
"<td><font color=white size=2>Internal Wait Room</td>" +
"<td><font color=white size=2>%EMRWEB01.01.044.00 </td>" +
"</tr></table>"
}

if (trim("%EMRWEB01.01.045.AED ")=="O"){
BlackHole1.innerHTML=
"<table border=0 cellspacing=2 cellpadding=2 width=100%>" +
"<tr valign=middle><td align=center>" +
"<img src='../images/next1.gif' class=Icon onclick=OtherLocationsAED()></td>" +
"<td><font color=white size=2>Alternate ED</td>" +
"<td><font color=white size=2>%EMRWEB01.01.044.AED</td>" +
"</tr></table>"
}
else {
BlackHole1.innerHTML=
"<table border=0 cellspacing=2 cellpadding=2 width=100%>" +
"<tr valign=middle><td align=center>" +
"<img src='../images/TrekIcon.gif' class=Icon onclick=OtherLocationsAED()></td>" +
"<td><font color=white size=2>Alternate ED</td>" +
"<td><font color=white size=2>%EMRWEB01.01.044.AED</td>" +
"</tr></table>"
}

if (trim("%EMRWEB01.01.045.COR")=="O"){
BlackHole2.innerHTML=
"<table border=0 cellspacing=2 cellpadding=2 width=100%>" +
"<tr valign=middle><td align=center>" +
"<img src='../images/next1.gif' class=Icon onclick=OtherLocationsCOR()></td>" +
"<td><font color=white size=2>RAV/Corridor</td>" +
"<td><font color=white size=2>%EMRWEB01.01.044.COR</td>" +
"</tr></table>"
}
else {
BlackHole2.innerHTML=
"<table border=0 cellspacing=2 cellpadding=2 width=100%>" +
"<tr valign=middle><td align=center>" +
"<img src='../images/TrekIcon.gif' class=Icon onclick=OtherLocationsCOR()></td>" +
"<td><font color=white size=2>RAV/Corridor</td>" +
"<td><font color=white size=2>%EMRWEB01.01.044.COR</td>" +
"</tr></table>"
}

EmergencyMenu.innerHTML=parent.MenuList.innerHTML 

NextEmergency.innerHTML=
"<table border=1 cellpadding=4 width=100% height=100% cellspacing=0>" +
"<tr height=28><td bgcolor=#ffff00 align=center><b>NEXT</b></td>" +
"<td class=DataField nowrap bgcolor=#ffff00>%EMRWEB01.01.015</td></tr>" +
"<tr height=28><td class=DataLabel>Location</td>" +
"<td class=DataField>" + '%EMRWEB01.01.017' + "</td></tr>" +
"<tr><td class=DataLabel>Doctor</td>" +
"<td><input type=text size=6 maxlength=6 name=doctor " +
"onblur='updDoc(this);'></td></tr>" +
"</table>"

</script>
<!--
</form>
-->

<script type="text/javascript">
function ShowPatientDetails(PatientNo) {
  if(!isWhitespace(obj.patients[PatientNo][4])) {
    PageLocation="?reportno=1&template=4" +
                 "&urnumber=" + obj.patients[PatientNo][0].replace(/ /g,"+") +
                 "&admissno=" + obj.patients[PatientNo][1].replace(/ /g,"+") 
  } else {
     PageLocation="?reportno=1&template=11" +
                  "&urnumber=" + obj.patients[PatientNo][0].replace(/ /g,"+") +
                  "&admissno=" + obj.patients[PatientNo][1].replace(/ /g,"+") 
  }
  globalLinkType=0;
  globalLinkUrl="../cgi-bin/emrweb02.pbl" + PageLocation
  top.content.location="../cgi-bin/emrweb02.pbl" + PageLocation
}
function OtherLocations() {
 if(top.content.location.search.substring(1,23)=="reportno=2&template=3"){
 if (IsDirtyTriage(top.content.UpdateForm)==true) { return; }} 
 url = "../cgi-bin/emrweb01.pbl?reportno=01&template=012" 
 parent.content.location=url
}
function OtherLocations00() {
 if(top.content.location.search.substring(1,23)=="reportno=2&template=3"){
 if (IsDirtyTriage(top.content.UpdateForm)==true) { return; }} 
 url = "../cgi-bin/emrweb01.pbl?reportno=01&template=012&filtlocn=00" 
 parent.content.location=url
}
function OtherLocationsAED() {
 if(top.content.location.search.substring(1,23)=="reportno=2&template=3"){
 if (IsDirtyTriage(top.content.UpdateForm)==true) { return; }} 
 url = "../cgi-bin/emrweb01.pbl?reportno=01&template=012&filtlocn=AED" 
 parent.content.location=url
}
function OtherLocationsCOR() {
 if(top.content.location.search.substring(1,23)=="reportno=2&template=3"){
 if (IsDirtyTriage(top.content.UpdateForm)==true) { return; }} 
 url = "../cgi-bin/emrweb01.pbl?reportno=01&template=012&filtlocn=COR" 
 parent.content.location=url
}
function SelectPatient(admissno) {
 url = "../cgi-bin/emrweb02.pbl?reportno=01&template=100" +
       "&admissno=" + admissno.replace(/ /g,"+") 
 parent.menu.EmergencyMenu.innerHTML=""
 EmergencyFrameLink(url,1,1,1004,525)
}
function updDoc(doctor) {
if(isWhitespace(doctor.value)){return;}
doctor=doctor.value.toUpperCase()
admissno='%EMRWEB01.01.021';
emcndoct='%EMRWEB01.01.040';
// validate doctor exists in patdo1af
  var serverURL   = "../cgi-bin/patweb80.pbl?reportno=3" +
                    "&valdcode=" + doctor.replace(/ /g,"+")
  var returnValue = RSExecute(serverURL);
  if (returnValue.status!=0) {  return; }   

// validate doctor exists in emrdocaf
  if (emcndoct==1) {
    var serverURL   = "../cgi-bin/emrweb08.pbl?reportno=11" +
                      "&valdcode=" + doctor.replace(/ /g,"+")
    var returnValue = RSExecute(serverURL);
    if (returnValue.status!=0) { return; }   
  }

  var serverURL   = "../cgi-bin/emrweb08.pbl?reportno=3" +
                    "&admissno=" + admissno +
                    "&doctcode=" + doctor +
                    "&updttype=ALDOC" +
                    "&updateky=1"
  var returnValue = RSExecute(serverURL);

  if(top.content.location.search.substring(1,22)=="reportno=1&template=4"){
    admissno=admissno - 0
    if (top.content.PatientLinks.admissno.value == admissno) {
        top.content.location.reload();
    }
  }

  location.reload();
}
function SelectDoctor(doctcode) {
 if(top.content.location.search.substring(1,23)=="reportno=2&template=3"){
 if (IsDirtyTriage(top.content.UpdateForm)==true) { return; }} 
  var url = "../cgi-bin/emrweb01.pbl?" +
            "reportno=1&template=16" +
            "&doctcode=" + doctcode.replace(/ /g,"+")
 parent.content.location=url
}
function IsDirtyTriage(eForm) {
  for (var i=0; i < eForm.length; i++) {
    var eElem = eForm.elements[i];
    if ("text" == eElem.type || "textarea" == eElem.tagName)
    {
      if (eElem.value.replace(/ /g,"") != eElem.defaultValue.replace(/ /g,""))  {
      return true;}
    }
    else if ("checkbox" == eElem.type || "radio" == eElem.type)
    {
      if (eElem.checked != eElem.defaultChecked) return true;
    }
  }
  return false;
}
</script>
<form name=defPatientLink method=get>
<input type=hidden name=serverid value="emrweb02">
<input type=hidden name=reportno value="01">
<input type=hidden name=template value="100">
<input type=hidden name=nextseq value="%EMRWEB01.01.021">
<input type=hidden name=waiting> 
</form>
