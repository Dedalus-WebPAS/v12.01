<meta name="TemplateVersion" content="V12.01.00">
<meta name="TemplateHome" content="crdhb">
<meta name="HelpFileName" content="NoContextSet.html">
<script type="text/javascript" src="../js/preadmission.js"></script>
<script type="text/javascript" src="../js/CaseTeamSelect.js"></script>
<script type="text/javascript">    
function SubmitAdm() {
  p=document.UpdateForm;
  if(!checkSiteOpBooking(p.urnumber,p.ptmis001)) {
    return;
  }
  validateSuspension(p.urnumber,p.ptmis001,p.datefrom,p.dateto);
  if(p.datefrom.value!='0'){
       ans=confirm("Warning : Patient has a Suspension record for period \n" +
             "\t" + p.datefrom.value  + " - " + p.dateto.value);
       if (ans!=true) {
          return; }
  } 
  document.UpdateForm.redirect.value="patweb98.pbl?reportno=01&template=043"
  + "&urnumber=" + document.UpdateForm.urnumber.value
  + "&admissno=";
  SetLinkACC(UpdateForm,"PRE");
  SubmitHidden(UpdateForm);
}
function validateCodeOnChange(num,trnsfsrc,trndesc,ptmis009)
{
  if(validateCode(num,trnsfsrc,trndesc))
  {
   validateTransSrcWithRef(trnsfsrc,ptmis009,trndesc);
  }
}
function ValCaseTeam(CaseTeamFld, CaseTeamDesc) {
  if (validateCode2(7,CaseTeamFld, CaseTeamDesc)) {
    var p = document.UpdateForm;
    getHCPbyCaseTeam(p.pmsvx146,p.ptmis007,p.doctnam2,p.ptmis001);
    if (!ValCaseTeamMember()) {
      CaseTeamFld.value = "";
      CaseTeamDesc.value = "";
      CaseTeamFld.focus();
    }
  }
}
function ValCaseTeamMember() {
  if (!isWhitespace(document.UpdateForm.ptmis001.value)&&
      !isWhitespace(document.UpdateForm.ptmis007.value)&&
      !isWhitespace(document.UpdateForm.pmsvx146.value)) {
    var serverURL = "../cgi-bin/allweb01.pbl?reportno=8&functype=7"+
          "&valddate=" + document.UpdateForm.ptmis001.value.replace(/ /g,"+")+
          "&valdhcpc=" + document.UpdateForm.ptmis007.value.replace(/ /g,"+")+
          "&valdteam=" + document.UpdateForm.pmsvx146.value.replace(/ /g,"+")+
          "&valdmode=1";
    var returnValue = RSExecute(serverURL);
    if (returnValue.status != 0) {
      return false;
    }
  }
  return true;
}
function CheckGPActive() {
  if(isWhitespace(document.UpdateForm.ptvis028.value)) {
    return;
  }
  ValidateHCP(18,0,document.UpdateForm.ptvis028,document.UpdateForm.genpname);
}
// 05 : TAS : Merge task 0863964
function DisplayPreadmNotes() {
  if (!isWhitespace(UpdateForm.bkreproc.value)) {
    document.getElementById('prenotesdet').style.display = "";
  } else {
    document.getElementById('prenotesdet').style.display = "none";
  }
}
</script>
%START.OF.PAGE
<!-- 05 : TAS : Merge task 0863964 - Add DisplayPreadmNotes() -->
<body onload="PageLoad(event);displayDiv(document.UpdateForm.ptmis011,'PT');
                         displayDiv(document.UpdateForm.ptmis012,'AT')
                         DisplayTrnSrc();RJAdmWeight();
                         createSpecialtyArray();getHCPSpecialtySelectList();
                         defaultSpecialty();showACC();validateCode(31,UpdateForm.ptmis007,UpdateForm.doctnam2);
              CheckGPActive();DisplayPreadmNotes();">
<div id=PatientHeading></div>
<script type="text/javascript">
PatientURN="%PATWEB89.01.003";
PatientVIS="%PATWEB89.01.081";
PatientNAM="%PATWEB89.01.002";
PatientSTA="%PATWEB89.01.086.078";
PatientALT="%PATWEB89.01.084";
PatientSEX="%PATWEB89.01.019";
PatientDOB="%PATWEB89.01.020";
PatientAGE="%PATWEB89.01.021";
PatientLOC="%PATWEB89.01.083";
PatientPRI="%PATWEB89.01.086.066.1";
PatientUNT="%PATWEB89.01.066.0";
DoctorCOD="%PATWEB89.01.082.003";
DoctorNAM="%PATWEB89.01.082.002";
PatientAID="%PATWEB89.01.086.090";
PatientIND="%PATWEB89.01.086.091";
PatientCUR="%PATWEB89.01.086.092";
PatientCLC="%PATWEB89.01.086.093.1";
PatientCLH="%STANDARD.01.017.CL";
PatientHFT="%PATWEB89.01.086.094";
PatientCDM="%PATWEB89.01.086.095";
PatientVDH="%PATWEB89.01.086.099.015";
InsertPatientHeader()
</script>
<div id=PatientMenu></div>
<div id=PageBodySection>

<form name=UpdateForm method=post onSubmit='return validateMandatory(this);'>
<input type="hidden" name="urnumber" value="%PATWEB89.01.003" />
<input type="hidden" name="admissno" value="%PATWEB89.01.101" />
<input type="hidden" name="updatety" value="6" />
<input type="hidden" name="reportno" value="2" />
<input type="hidden" name="template" value="032" />
<input type="hidden" name="redirect" />
<input type="hidden" name="allocate" value="1" />
<input type="hidden" name="chckname" value="0" />
<input type="hidden" name="emradmit" value="0" />
<input type="hidden" name="emradmis" value="0" />
<input type="hidden" name="newbmand" value="0" />
<input type="hidden" name="agebmand" value="0" />
<input type="hidden" name="ptcnueoc" value="%PATWEB89.01.925" />
<input type="hidden" name="exstward" value="%PATWEB89.01.158" />
<input type="hidden" name="datefrom" />
<input type="hidden" name="dateto" />
<input type="hidden" name="ptcnbage" value="%STANDARD.01.025.021.046.1.3" />
<input type="hidden" name="pbdate"   value="%PATWEB89.01.020" />
<input type="hidden" name="ptmis030" value="%PATWEB89.01.129" />
<input type="hidden" name="c_ptmis010" id="c_ptmis010" 
       value="%PATWEB89.01.111.1">

<input type=hidden name=ptcndigp id=ptcndigp
       value="%STANDARD.01.025.124.122.0.1">


<!-- 05 : TAS : Merge task 0863964 -->	   
<input type=hidden name=bkreproc value="%PATWEB89.01.717">
<input type=hidden name=ptvis029 value="%PATWEB89.01.232.1">
<input type=hidden name=ptvis030 value="%PATWEB89.01.233.1">
<input type=hidden name=genpprov value="">
<input type=hidden name=dummy1 value="">
<input type=hidden name=admiscat value="A ">
<input type=hidden name=bedstat1>
<input type=hidden name=warddesc>
<input type=hidden name=mh_visit value="%PATWEB89.01.999.008">
<table border=1 colspan=1 width=100% cellspacing=1 cellpadding=1 >
<tr><td class=HeadingCell align=center colspan=2>
    Update Pre-Admission Details </tr>
<tr>
<tr><td>
    <table width=100%  border=0 class=TableBody cellpadding=2 cellspacing=2>
<tr><td width=50%>
    <table width=100% border=0 class=TableBody cellpadding=0 cellspacing=0>
     <tr><td class=DataLabel>Admission Date </td>
         <td><input type=text size=12 name=ptmis001 tabindex=1 id=ptmis001 
              class=Mandatory title="Admission Date" value="%PATWEB89.01.102" 
      onblur="checkDate(this,'AdmissionDate');ShowAdmissionWeight(UpdateForm);
              getHCPSpecialtySelectList();defaultSpecialty();">
         <img notab src=../images/CalendarLookup.gif class=Icon onclick="DateLookupFrame(ptmis001);">     
          Time <input type=text name=ptmis002 size=8 tabindex=2 
               value="%PATWEB89.01.103" class="Mandatory" 
               title="Admission Time" onblur="checkTime(this,'AdmissionTime');">
        <img notab src=../images/DateTimeStamp.gif class=Icon onclick="SetCurrentDateTime(null,ptmis002);">
       <img notab src=../images/TimeLookup.gif class=Icon onclick="TimeLookupFrame(ptmis002);">
          </td></tr>
      <tr><td class=DataLabel>%STANDARD.01.017.P </td>
       <td><select name=ptmis011 tabindex=3 class=Mandatory title="%STANDARD.01.017.P " 
               onchange="displayDiv(ptmis011,'PT');">
              <option> </option>
               %PATWEB89.01.112.2
              </select></tr>

      <tr><td class=DataLabel>Referral Source</td>
          <td><select name=ptmis009 tabindex=4 onchange="DisplayTrnSrc()"
                onblur="validateCodeOnChange(9,trnsfsrc,trandesc,ptmis009);"
               class="Mandatory" title="Referral Source">
                 <option> </option>
                 %PATWEB89.01.110.2
                 </select></td></tr>
          <td><div id=TranSrcHeading></div></td>
          <td><div id=TranSrc></div></td>

<tr><td class=DataLabel>Referring HCP</td>
    <td><input type="text" size=10 maxlength=10 name=ptvis028 tabindex=5
          value="%PATWEB89.01.231.1" title="Referring HCP"
         onchange="if (checkAlphanumDesc(event,this) != false) {
                     ReadDoc(18,0,ptvis028,genpname,ptvis029,genpprac,ptvis030,
                             genpprov);
                   }">			  
        <input type=text size=25 notab readonly name=genpname
               value="%PATWEB89.01.231.0">
        <img src="../images/SearchIcon.gif" class=Icon
        onclick="GPHCPSearchFrame(ptvis028,genpname,genpprov,ptvis029,genpprac,ptvis030,0)">
        <img src="../images/erase.gif" class=Icon
		onclick="clrFields(ptvis028,genpname);"></td></tr>

<tr><td class=DataLabel>Practice</td>
    <td><input type=text name=genpprac size=35 readonly
                 value="%PATWEB89.01.232.0">
          <input type=hidden name=ptvis029 value="%PATWEB89.01.232.1">
          <input type=hidden name=ptvis030 value="%PATWEB89.01.233.1">
          <input type=hidden name=genpprov value="">
          <img src="../images/SearchIcon.gif" class=Icon
 onclick="GPHCGSearchFrame(ptvis028,genpname,genpprov,ptvis029,genpprac,ptvis030)">
 <img src="../images/erase.gif" class=Icon onclick="clrFields(ptvis029,genpprac,ptvis030,genpprov);">
      </td></tr>
     
      <tr><td class=DataLabel>Inform GP</td>
      <td><select name=ptvis022 tabindex=6>
         <option value="0">No</option>
         <option value="1">Yes</option>
        </select></td></tr>

      <tr><td class=DataLabel>Readmission Indicator</td>
          <td><select name=ptmis042 tabindex=6>
                <option> </option>
                 %PATWEB89.01.138.2
              </select></td></tr>     

      <tr><td class=DataLabel>Admission Type</td>
          <td><select name=ptmis012 tabindex=7 class="Mandatory" title="Admission Type"   
               onchange="displayDiv(ptmis012,'AT');">
                <option> </option>
                 %PATWEB89.01.113.2
              </select></td></tr>

      <tr><td class=DataLabel>Admitting Doctor</td>
          <td><input type="text" size=11 maxlength=6 name=ptmis007 id=ptmis007
               tabindex=8 title="Admitting Doctor" class="Mandatory"
               value="%PATWEB89.01.108.003"
               onblur="UpCase(this);
                       if (checkAlphanumDesc(event,this) != false) {
                         validateCode(31,ptmis007,doctnam2);
                         getHCPSpecialtySelectList();defaultSpecialty();
                       }"
            onchange="if (checkAlphanumDesc(event,this) != false) {
                        getCaseTeamByHCP(ptmis007,pmsvx146,n_pmsvx146,ptmis001);
                      }">
              <input type=text readonly size=25 notab name=doctnam2
                value="%PATWEB89.01.108.002" tabindex=-1> 
              <img notab src="../images/SearchIcon.gif" class=Icon
               onclick="HCPSelectOnClick(ptmis007,doctnam2,pmsvx146,n_pmsvx146,
                                         dummy1);"> 
              <img src="../images/erase.gif" class=Icon
               onclick="clrFields(ptmis007,doctnam2,pmsvx146,n_pmsvx146);">
          </td></tr>

      <tr><td class=DataLabel>Case Team</td>
          <td><input type=text name=pmsvx146 size=11 maxlength=10
               title="Case Team" tabindex=9 value="%PATWEB89.01.298.062.1"
               onchange="if (checkAlphanumDesc(event,this) != false) {
                           ValCaseTeam(pmsvx146,n_pmsvx146);
                         }">
              <input type=text name=n_pmsvx146 size=42 readonly
               value="%PATWEB89.01.298.062.0" class=Readonly tabindex=-1
               title="Team Description">
              <img src="../images/SearchIcon.gif" class=Icon
               onclick="CaseTeamOnClick(pmsvx146,n_pmsvx146,ptmis007,doctnam2,
                                        dummy1);">
              <img src="../images/erase.gif" class=Icon
               onclick="clrFields(pmsvx146,n_pmsvx146);">
          </td></tr>
      
<!-- 01 : CTAS : filter specialty - exclude where indicator 21 == 1 
      <tr><td class=DataLabel>STANDARD.01.017.A </td>
          <input type=hidden name=admiscat value="A ">
          <td>
              <select name=ptmis010 tabindex=10 id=ptmis010
               title="STANDARD.01.017.A " class="Mandatory">
              <option></option>
                 PATWEB89.01.111.2
              </select>
          </td></tr>
-->
      <tr><td class=DataLabel>%STANDARD.01.017.A </td>
          <!--<input type=hidden name=admiscat value="A ">-->
          <td>
              <select name=ptmis010 tabindex=10 id=ptmis010
               title="%STANDARD.01.017.A " class="Mandatory">
              <option></option>
                 %PATWEB89.01.111.9.1.21.2.1
              </select>
          </td></tr>
<!-- end of change -->

      <tr><td class=DataLabel>%STANDARD.01.017.CL</td>
          <td align=left>
            <select name=ptmis027 tabindex=11 class="Mandatory"
             title="%STANDARD.01.017.CL" onchange="showACC();">
              <option> </option>
              %PATWEB89.01.126.2
            </select>
          </td></tr>
     <tr><td><div id=ACCHeading></div></td>
         <td><div id=ACCId></div></tr>
<!-- 05 : TAS : Merge task 0863964 -->
     <tr id=prenotesdet valign=top>
        <td class=DataLabel>Waiting List Pre-admission Notes</td>
        <td class=DataField colspan=1>
          <textarea wrap=virtual name=prenotes class=Readonly readonly
            cols=60 rows=3>%PATWEB89.01.999.100</textarea>
        </td></tr>

</table>
</td> 


<td width=50%>
    <table width=100% border=0 class=TableBody cellpadding=0 cellspacing=0>
	<!-- 04 : TAS : 28-01-2019 : Jira WP2-207 Make Reason for Admission -->
	  <tr><td class=DataLabel>Reason for Admission</td>
          <td><input tabindex=12 type=text name="ptmis020" size=80 maxlength=80
                     title="Reason For Admission" class=Mandatory 
					 value="%PATWEB89.01.121">
          </td></tr>
      <tr><td>&nbsp;</td>
          <td><input tabindex=13 type=text name="ptmis021" size=80 maxlength=80 
                     value="%PATWEB89.01.122">
          </td></tr>

     <tr><td class=DataLabel><!--Hospital--></td>
          <td><!--select name="ptmis013" tabindex=15 class="Mandatory" 
               title="Hospital">
            <option> </option>
            PATWEB89.01.114.2
            </select--></td></tr>

      <tr><td class=DataLabel>%STANDARD.01.017.HP</td>
          <td><select name="ptmis060" tabindex=16 class="Mandatory" 
               title="%STANDARD.01.017.HP">
            <option> </option>
            %PATWEB89.01.151.2
          </select>
         </td></tr>

      <tr><td class=DataLabel>Health Agency</td>
          <td><select name="ptmis061" tabindex=17 class="Mandatory" title="Health Agency">
            <option> </option>
            %PATWEB89.01.152.2
          </select>
          </td></tr>

      <tr><td>Admitting Point</td>
       <td><select name=ptvis046 tabindex=18 onchange="defaultWard()">
           <option> </option>
            %PATWEB89.01.290.2
           </select>
       </td></tr>

     <tr><td class=DataLabel>Ward / Bed </td>
         <td><input type=hidden name=bedstat1>
           <input type=hidden name=warddesc>
           <select name=ptmis068 tabindex=19 title="Ward">
            <option> </option>
            %PATWEB89.01.449.2
           </select>
           <input type=text name=ptmis076 maxlength=3 size=3 title="Bed"
             value="%PATWEB89.01.194" onchange="UpCase(this);">
           <img notab src=../images/SearchIcon.gif class=Icon border=0 vspace=1
            onclick="WardBedSearchFrame(ptmis068,warddesc,ptmis076,bedstat1);">
          </td></tr>
     <!-- 03 : TAS : Add Visiting options field -->
	  <tr><td class=DataLabel>%STANDARD.01.017.P8</td>
      <td><select name="pmpmi073" title="%STANDARD.01.017.P8" tabindex=36>
          <option></option>
           %PATWEB89.01.873.2
          </select>
	  </td></tr>
	<tr><td class=DataLabel>Diet</td>
          <td><select name=ptmis028 tabindex=20>
              <option></option>
              %PATWEB89.01.127.2 
              </select>
          </td></tr>

      <tr><td colspan=2 rowspan=6>
          <table width=100% border=0> 
           <tr><td>
           <span id=BabyAge style="display:none">
             <table width=100% height=100% border=0 cellspacing=0 cellpadding=0>
               <tr><td class=DataLabel width=37%>Admission Weight</td>
               <td><input type=text name=ptmis051 size=8 maxlength=6 tabindex=25
                    value="%PATWEB89.01.186" onblur=justifyRight(this); title="Admission Weight" >grams</td>
               </tr>
             </table>
           </span>
           </td></tr>
           <tr><td>
           <span id=NewBorn style="display:none">
             <table width=100% height=100% border=0 cellspacing=0 cellpadding=0>
               <tr><td class=DataLabel width=37%>Gestation Period</td>
               <td><select name=ptmis077 title="Gestation Period" >
                   <option></option>
                   %PATWEB89.01.199.006.2
                   </select>
             </td></tr>
             </table>
           </span>
           </td></tr>
          <tr><td rowspan=2>
          <span id=WaitingList style="display:none">
            <table width=100% height=100% border=0 cellspacing=0 cellpadding=0>
              <tr><td class=DataLabel width=37%>Date of Referral</td>
              <td><input type=text size=12 name=ptmis058 tabindex=26 value=""
                   onblur="checkDate(this,'ReferralDate')">
              <img notab src=../images/CalendarLookup.gif class=Icon
                   onclick="DateLookupFrame(ptmis058);"></td></tr>
              <tr><td class=DataLabel>Date of 1st Spec Consult</td>
              <td><input type=text size=12 name=ptmis059 tabindex=27 value=""
                   onblur="checkDate(this,'SpecConDate')">
              <img notab src=../images/CalendarLookup.gif class=Icon onclick="DateLookupFrame(ptmis059);"></td></tr>
             </table>
           </span>
           </td></tr>
          </table>
          </td></tr>

</table>
</td>
</tr>

      <tr align=center>
       <td align=center colspan=4><br>
       <input type=button value="Ok" class=button tabindex=30
        id="pat89sub"
        onclick="tempDisable(this);checkBedStatus(UpdateForm.ptmis068.value,
                 UpdateForm.ptmis076.value,UpdateForm.ptmis001.value,
                 UpdateForm.ptmis030.value,SubmitAdm)";>
    </table>
</td></tr>
</table>
</form>
</div>	  

<form name=PatientLinks method=get>
<input type=hidden name=reportno value=1>
<input type=hidden name=template value=004>
<input type=hidden name=urnumber value="%PATWEB89.01.003">
<input type=hidden name=admissno value="%PATWEB89.01.101">
<input type=hidden name=MenuType value="%PATWEB89.01.088">
</form>

<form name=linkForm action=patweb89.pbl method=post>
<input type=hidden name=reportno value=1>
<input type=hidden name=template value=1>
<input type=hidden name=urnumber value="%PATWEB89.01.003">
<input type=hidden name=admissno value="%PATWEB89.01.101">
</form>

<form name=Lookup action=patweb94.pbl method=post>
<input type=hidden name=reportno value=9>
<input type=hidden name=template value=1>
<input type=hidden name=valcateg>
<input type=hidden name=valdtype>
<input type=hidden name=valdcode>
</form>

<script type="text/javascript">
function RJAdmWeight() {
  if (document.UpdateForm.ptmis051!=undefined) {
    justifyRight(document.UpdateForm.ptmis051);
  }
}
/* 0894695
for (var i=0;i<document.UpdateForm.ptvis022.length;i++){
if (document.UpdateForm.ptvis022.options[i].value=="%PATWEB89.01.225.0"){
    document.UpdateForm.ptvis022.selectedIndex=i}};
*/

var p = document.UpdateForm;
var informGP = "%PATWEB89.01.225.0";               //ptvis022
valInformGP(p.ptvis022,informGP,p.ptcndigp.value);

//
ShowAdmissionWeight(UpdateForm);
//
</script>
</div>
<script type="text/javascript">
//
if ("%PATWEB89.01.466.1" == "BED" ) { var site="4711" } else { var site="4712" }
  expward="%PATWEB89.01.158"
  for (var i =0 ; i < document.UpdateForm.ptmis068.length; i++) {
    if (document.UpdateForm.ptmis068.options[i].value==expward) {
       document.UpdateForm.ptmis068.selectedIndex=i } };
ibcnmhos="%STANDARD.01.025.000.043.1.1"
if(ibcnmhos=="1"){
  UpdateForm.ptmis068.className="Mandatory"
}
FilterMentalHealth(document.UpdateForm.mh_visit.value)
function RJAdmWeight() {
  if (document.UpdateForm.ptmis051!=undefined) {
    justifyRight(document.UpdateForm.ptmis051);
  }
}
</script>
<span id=transferhd style="display:none">
<td class=DataLabel>Transfer Source</td>
</tr>
</span>
<span id=transfersrc style="display:none">
<td><input type="text" size=7 maxlength=5 name=trnsfsrc id=trnsfsrc
     class=Mandatory title="Transfer Source" tabindex=5
     value="%PATWEB89.01.193.0"
     onblur="validateCodeOnChange(9,trnsfsrc,trandesc,ptmis009);">
    <input type=text size=27 name=trandesc notab
     class=Readonly readonly value="%PATWEB89.01.193.1">
    <img src="../images/SearchIcon.gif" class=Icon
     onclick="TransferSourceFrame(trnsfsrc,trandesc,ptmis009)"></td>
</tr>
</span>
<span id=blanklabel style="display:none">&nbsp;</span>
<span id=transferblank style="display:none">
   <input type=hidden name=trnsfsrc>
</span>
<span id=acchd style="display:none">
ACC Purchase Order Number
</span>

<span id=accorderid style="display:none">
  <input type=text name=accpordn id=accpordn title="ACC Purchase Order Number"
         value="%PATWEB89.01.392" maxlength=20 size=25>
</span>

