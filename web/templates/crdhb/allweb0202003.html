<meta name="TemplateVersion" content="V12.01.00">
<meta name="TemplateHome" content="crdhb">
<meta name="HelpFileName" content="NoContextSet.html">
<script language="javascript" src="../js/allweb02.js"></script>
<script language="javascript" src="../js/allweb0202.js"></script>
<script type="text/javascript" src="../js/OutpatientSelect.js"></script>
<script type="text/javascript" src="../js/OutpatientTypeClinic.js"></script>
<!-- 01 : CTAS : add link to custom TAS javascript file for GetPatientGP function -->
<!-- 04 : DXC : GetPatientGP no longer called, replaced by SetRefSource  -->
<script type="text/javascript" src="../js/ctascustom.js"></script>
<!-- end of change -->
<script type="text/javascript">
%START.OF.PAGE
function SetPrinter(Nolabel,SelectList) {
  if (SelectList.className=="Mandatory SelectBig") {
      SelectList.className="SelectBig"
  } else {
      SelectList.className="Mandatory SelectBig" }
  if (Nolabel!=undefined) {
     if (Nolabel.className=="Mandatory") {
         Nolabel.className=""
     } else {
         Nolabel.className="Mandatory" }
  }
}
//------------------------------------------------------------
// Set Link ACC Redirect and Return program after link ACC
//------------------------------------------------------------
function SetLinkACC(CurForm,ReturnCd) {

  //Sets the redirect to the referral display
  CurForm.redirect.value="allweb02.pbl?reportno=02&template=002"
          + "&urnumber=" + CurForm.urnumber.value.replace(/ /g,"+")
          + "&admissno=" + CurForm.admissno.value.replace(/ /g,"+");
  if ((CurForm.ptcnueoc.value==1)&&(CurForm.alref035.value.substr(5,1)=='A')) {
       CurForm.redirect.value="eocweb01.pbl?reportno=01&template=006"
             + "&urnumber=" + CurForm.urnumber.value.replace(/ /g,"+")
             + "&returncd=" + ReturnCd
             + "&admissno=" + CurForm.admissno.value.replace(/ /g,"+")
  }
// 11 : TAS : Merge Task 0887539  
  //Checks if a claim is to be lodged, and if so, sets the redirect to the
  //claim lodgement template
  if (CurForm.alref035.value.substr(3,1)=='W') {
       CurForm.redirect.value="patweb89.pbl?reportno=01&template=005"
             + "&urnumber=" + CurForm.urnumber.value.replace(/ /g,"+")
             + '&returncd=' + ReturnCd
			 + "&systflag=9"				
             + "&admissno=" + CurForm.admissno.value.replace(/ /g,"+")
  }

  //Checks if referral will be rejected, and sets the flag
  if (CurForm.refrejct.value == "1") {
      CurForm.redirect.value += "&refrejct=1";
  }
} //end SetLinkACC
function SetSite() {
  p=UpdateForm
  var SetSite
  if(isWhitespace(p.alref119.value)) {
    SetSite=p.wbsesite.value;
  } else {
    SetSite=p.alref119.value;
  }
  for (var i =0 ; i < document.UpdateForm.alref119.length; i++) {
    if (document.UpdateForm.alref119.options[i].value==SetSite.substr(0,6)) {
        document.UpdateForm.alref119.selectedIndex=i }
  };
  SetList();
  selectCatCodInd(p.catAO,p.alref141,p.d_alref141,p.alref027,'1','1');
}
function SetList() {
  p=UpdateForm
  p.alref106.options.length=1;
  DeptClinicType(p.deptcode,p.alref119,p.alref106,p.defctype)
  SetList2();
}
function SetList2() {
  p=UpdateForm
  p.alref120.options.length=1;
  SetTypeClinic(p.alref120,p.deftclid.value,p.alref119.value,p.alref106.value);
}
/* 11 : TAS : Merge Task 0887539
function UpdateReferral() {
  if (!isWhitespace(document.UpdateForm.alref019.value)&&
      !isWhitespace(document.UpdateForm.alref038.value)&&
      !isWhitespace(document.UpdateForm.alref087.value)) {
    var serverURL = "../cgi-bin/allweb01.pbl?reportno=8"+
            "&functype=7"+
            "&valddate=" + document.UpdateForm.alref019.value.replace(/ /g,"+")+
            "&valdhcpc=" + document.UpdateForm.alref038.value.replace(/ /g,"+")+
            "&valdteam=" + document.UpdateForm.alref087.value.replace(/ /g,"+");
    var returnValue = RSExecute(serverURL);
    if (returnValue.status != 0) {
      return; }
  }
  if(!isWhitespace(UpdateForm.alref022.value) &&
     UpdateForm.rusualgp.checked==true) {
     UpdateForm.pmpmi059.value=UpdateForm.alref022.value;
     UpdateForm.pmpmi060.value=UpdateForm.alref023.value;
     UpdateForm.pmpmi061.value=UpdateForm.alref024.value;
  }
  
// 01 : CTAS : set faster treatment field value from checkbox
	updateFasterTreatmentValue();
// end of change  
 
  UpdateForm.target = "PopUpFrame1";
  if( validateMandatory( UpdateForm ) )
  {
    SetLinkACC(UpdateForm,"AH1");
    UpdateForm.submit();
  }
}
*/
function UpdateReferral() {

  //Checks if the referral is already rejected. If not, calls function to
  //check if it will generate a rejection
  if ("%ALLWEB02.02.199.027" != "5") {
    checkReject(UpdateForm.d_depcod.value,UpdateForm.alref141,UpdateForm);
  }

  if (!ValCaseTeamMember()) {
    return;
  }
  if(!isWhitespace(UpdateForm.alref022.value) &&
     UpdateForm.rusualgp.checked==true) {
     UpdateForm.pmpmi059.value=UpdateForm.alref022.value;
     UpdateForm.pmpmi060.value=UpdateForm.alref023.value;
     UpdateForm.pmpmi061.value=UpdateForm.alref024.value;
  }
  
// 01 : CTAS : set faster treatment field value from checkbox
	updateFasterTreatmentValue();
// end of change 
// 12 : CTAS : store eReferral flag value in database.
        updateEReferralValue(); 
  
  UpdateForm.target = "PopUpFrame1";
  if( validateMandatory( UpdateForm ) )
  {
    SetLinkACC(UpdateForm,"AH1");
    UpdateForm.submit();
  }
}
// End of Change
//this function is a onchange emulator when a search frame is used
function caseTeamOnChange(alref087,n_alref087,alref038,n_alref038,d_alref019) {
  var oldValue = alref087.value;
  TeamSearchFrame(alref087,n_alref087,function() {
    if(alref087.value != oldValue) {
       setTimeout(function() {
          getHCPbyCaseTeam(alref087,alref038,n_alref038,d_alref019);
       },100);
    }
  });
}


function hcpOnChange(alref038,n_alref038,alref087,n_alref087,d_alref019) {
  var oldValue = alref038.value;
  HCPSearchFrame(alref038,n_alref038,1,function() {
     if(alref038.value != oldValue) {
       setTimeout(function() {
         getCaseTeamByHCP(alref038,alref087,n_alref087,d_alref019);
       },100);
     }
  });
}
function CheckHCP() {
  if(!isWhitespace(document.all.d_alref085.value) ||
     !isWhitespace(document.all.d_alref086.value)) {
     document.UpdateForm.addithcp.checked=true;
     CheckAddHCP();
  }
}
function CheckAddHCP() {
  if(document.UpdateForm.addithcp.checked==true) {
     AdditionalHCP1H.style.display="";
     AdditionalHCP1F.style.display="";
     AdditionalHCP2H.style.display="";
     AdditionalHCP2F.style.display="";
     AdditionalHCP3H.style.display="";
     AdditionalHCP3F.style.display="";
     AdditionalHCP4H.style.display="";
     AdditionalHCP4F.style.display="";
     AdditionalHCP1H.innerHTML=ShowAdditionalHCP1H.innerHTML;
     AdditionalHCP1F.innerHTML=ShowAdditionalHCP1F.innerHTML;
     AdditionalHCP2H.innerHTML=ShowAdditionalHCP2H.innerHTML;
     AdditionalHCP2F.innerHTML=ShowAdditionalHCP2F.innerHTML;
     AdditionalHCP3H.innerHTML=ShowAdditionalHCP3H.innerHTML;
     AdditionalHCP3F.innerHTML=ShowAdditionalHCP3F.innerHTML;
     AdditionalHCP4H.innerHTML=ShowAdditionalHCP4H.innerHTML;
     AdditionalHCP4F.innerHTML=ShowAdditionalHCP4F.innerHTML;
  } else {
     AdditionalHCP1H.style.display="none";
     AdditionalHCP1F.style.display="none";
     AdditionalHCP2H.style.display="none";
     AdditionalHCP2F.style.display="none";
     AdditionalHCP3H.style.display="none";
     AdditionalHCP3F.style.display="none";
     AdditionalHCP4H.style.display="none";
     AdditionalHCP4F.style.display="none";
     AdditionalHCP1H.innerHTML=Blank.innerHTML;
     AdditionalHCP1F.innerHTML=BlankAdditionalHCP1F.innerHTML;
     AdditionalHCP2H.innerHTML=Blank.innerHTML;
     AdditionalHCP2F.innerHTML=BlankAdditionalHCP2F.innerHTML;
     AdditionalHCP3H.innerHTML=Blank.innerHTML;
     AdditionalHCP3F.innerHTML=BlankAdditionalHCP3F.innerHTML;
     AdditionalHCP4H.innerHTML=Blank.innerHTML;
     AdditionalHCP4F.innerHTML=BlankAdditionalHCP4F.innerHTML;
  }
}
function chkRegisteredGP() {
  if (isWhitespace(UpdateForm.pmpxrhc1.value)) {
      return; }
  if (trim(UpdateForm.alref022.value) == trim(UpdateForm.pmpxrhc1.value)) {
      PrintRefrLtr1H.style.display="none";
      PrintRefrLtr2H.style.display="none";
      PrintRefrLtr2F.style.display="none";
      PrintRefrLtr1H.innerHTML=Blank.innerHTML;
      PrintRefrLtr2H.innerHTML=Blank.innerHTML;
      PrintRefrLtr2F.innerHTML=Blank.innerHTML;
  } else {
      PrintRefrLtr1H.style.display="";
      PrintRefrLtr2H.style.display="";
      PrintRefrLtr2F.style.display="";
      PrintRefrLtr1H.innerHTML=ShowPrintRefrLtr1H.innerHTML;
      PrintRefrLtr2H.innerHTML=ShowPrintRefrLtr2H.innerHTML;
      PrintRefrLtr2F.innerHTML=ShowPrintRefrLtr2F.innerHTML;
  }
}
function ChkSusNotedDate() {
  if (isWhitespace(document.UpdateForm.alref061.value)) {
    document.UpdateForm.alref165.className="PastDate"
  } else {
    document.UpdateForm.alref165.className="Mandatory PastDate";
  }
}
function ChkSusNotedField() {
  if (isWhitespace(document.UpdateForm.alref165.value)) {
    document.UpdateForm.alref061.className=""
  } else {
    document.UpdateForm.alref061.className="Mandatory";
  }
}

// 01 : CTAS : add Book() function
// homebuilt stringify function for older browsers
function bookStringify(arr) {
	var result = '';
	if (arr) {
		result = '{';
		var i = 0;
		for (var key in arr) {
			if (i > 0) {
				result += ',"' + key + '":"' + arr[key].replace("\"","'") + '"';
			} else {
				result += '"' + key + '":"' + arr[key].replace("\"","'") + '"';
			}
			i++;
		}
		result += '}';
	}
	return result;
}

// book function
function Book() {
	// store data values to be passed to booking in associative array
	var fldvalues = {};
	fldvalues["pmsvx052"] = document.UpdateForm.alref088.value.replace(/ /g,"+");
	fldvalues["outbb002"] = document.UpdateForm.alref035.value.replace(/ /g,"+");
	
	// diagnoses
	fldvalues["outbb045"] = document.UpdateForm.alref031.value.replace(/ /g,"+");
	fldvalues["outbb046"] = document.UpdateForm.d_alref031.value.replace(/ /g,"+");
	fldvalues["outbb055"] = document.UpdateForm.alref032.value.replace(/ /g,"+");
	fldvalues["outbb056"] = document.UpdateForm.d_alref032.value.replace(/ /g,"+");
	fldvalues["outbb057"] = document.UpdateForm.alref033.value.replace(/ /g,"+");
	fldvalues["outbb058"] = document.UpdateForm.d_alref033.value.replace(/ /g,"+");
	
	// procedures
	fldvalues["otprc002"] = document.UpdateForm.alref171.value.replace(/ /g,"+");
	fldvalues["otprc003"] = document.UpdateForm.d_alref171.value.replace(/ /g,"+");
	fldvalues["otprc004"] = document.UpdateForm.alref172.value.replace(/ /g,"+");
	fldvalues["otprc005"] = document.UpdateForm.d_alref172.value.replace(/ /g,"+");
	fldvalues["otprc006"] = document.UpdateForm.alref173.value.replace(/ /g,"+");
	fldvalues["otprc007"] = document.UpdateForm.d_alref173.value.replace(/ /g,"+");	
	
	// referral reasons
	var ref1 = document.UpdateForm.alref028;
	var ref2 = document.UpdateForm.alref029;
	var ref3 = document.UpdateForm.alref030;
	fldvalues["otprc012"] = ref1.value.replace(/ /g,"+");
	fldvalues["d_otprc012"] = ref1.options[ref1.selectedIndex].text.replace(/ /g,"+");
	fldvalues["otprc013"] = ref2.value.replace(/ /g,"+");
	fldvalues["d_otprc013"] = ref2.options[ref2.selectedIndex].text.replace(/ /g,"+");
	fldvalues["otprc014"] = ref3.value.replace(/ /g,"+");
	fldvalues["d_otprc014"] = ref3.options[ref3.selectedIndex].text.replace(/ /g,"+");		
	
	fldvalues["outbb001"] = document.UpdateForm.alref034.value.replace(/ /g,"+");
	fldvalues["outbb013"] = document.UpdateForm.alref127.value.replace(/ /g,"+");
	fldvalues["contcode"] = document.UpdateForm.alref142.value.replace(/ /g,"+");
	fldvalues["outbb029"] = document.UpdateForm.alref022.value.replace(/ /g,"+");
	fldvalues["name_outbb029"] = document.UpdateForm.n_alref022.value.replace(/ /g,"+");
	fldvalues["refrldte"] = document.UpdateForm.alref019.value.replace(/ /g,"+");
	
	// stash data as JSON in session cookie
	var d = new Date();
	var id = d.getTime().toString();
	SetCookie(id, encodeURI(bookStringify(fldvalues)), 10);
	
	// redirect to outpatient booking screen
	location.href = "outweb02.pbl?reportno=05&template=002"
		+ "&urnumber=" + document.UpdateForm.urnumber.value.replace(/ /g,"+")
		+ "&admissno=" + document.UpdateForm.admissno.value.replace(/ /g,"+")
		+ "&cid=" + id;
}

var enableBooking = true;	// false if form is dirty
function EnableBookButton() {
	// Priority codes (cat PR)
	WaitingTriage = "R077";
	NotSeen = "R088";
	
	// book button is disabled if priority is waiting for triage or not seen,
	//		or if form is dirty
	var bookbtn = document.getElementById("bookbtn");
	currPriority = document.UpdateForm.alref027.value.replace(/ /g,"").substr(0,4);
	bookbtn.disabled = (currPriority == WaitingTriage || currPriority == NotSeen 
						|| !enableBooking);
}

// add event to listen for change and set flag
function DisableBooking() {
	if (enableBooking) {
		enableBooking = false;
		EnableBookButton();
	}
}

function AddOnChangeEvent() {
	var elems = document.getElementsByTagName("INPUT");
	var selects = document.getElementsByTagName("SELECT");
	
	// for most browsers
	if (document.addEventListener) {
		for (i=0; i<elems.length; i++) {
			if (elems[i].type == "text" || elems[i].type == "checkbox" 
				|| elems[i].type == "radio") {
					elems[i].addEventListener("change", DisableBooking);
			}
		}
		for (i=0; i<selects.length; i++) {
			selects[i].addEventListener("change", DisableBooking);
		}	
	}
	
	// for older browsers and compatibility view
	else if (document.attachEvent) {
		for (i=0; i<elems.length; i++) {
			if (elems[i].type == "text" || elems[i].type == "checkbox" 
				|| elems[i].type == "radio") {
					elems[i].attachEvent("onchange", DisableBooking);
			}
		}
		for (i=0; i<selects.length; i++) {
			selects[i].attachEvent("onchange", DisableBooking);
		}	
	}
}
// end of change

// 01 : CTAS : add CheckRefReason() to ensure orderly reason entry
function CheckRefReason(currReason) {
	var isvalid = true;
	var reason1 = document.UpdateForm.alref028.value.replace(/ /g,"");
	var reason2 = document.UpdateForm.alref029.value.replace(/ /g,"");
	var reason3 = document.UpdateForm.alref030.value.replace(/ /g,"");

	if ((reason1 == "") && (reason2 != "") && (reason3 == "")) {
		document.UpdateForm.alref028.value = document.UpdateForm.alref029.value;
		document.UpdateForm.alref029.value = "";
		document.UpdateForm.alref029.focus();
	}
	else if ((reason1 == "") && (reason2 != "") && (reason3 != "")) {
		document.UpdateForm.alref028.value = document.UpdateForm.alref029.value;
		document.UpdateForm.alref029.value = document.UpdateForm.alref030.value;
		document.UpdateForm.alref030.value = "";
		document.UpdateForm.alref030.focus();
	}	
	else if ((reason1 != "") && (reason2 == "") && (reason3 != "")) {
		document.UpdateForm.alref029.value = document.UpdateForm.alref030.value;
		document.UpdateForm.alref030.value = "";		
		document.UpdateForm.alref030.focus();
	}			
	else if ((reason1 == "") && ((reason2 == "") || (reason3 != ""))) {
		document.UpdateForm.alref028.value = document.UpdateForm.alref030.value;
		document.UpdateForm.alref030.value = "";
		document.UpdateForm.alref029.focus();
	}	
}
// end of change 
// 01 : CTAS : DR # 17,27,28,29
// 05 : CTAS PAS-581 update priority codes
// 13 : CTAS : Change mandatory referral field conditions
function ChkPriorityRef() {
        var optPri = document.UpdateForm.alref027.value.replace(/ /g,"");
        var userHosp = GetCookieData("IBAUserHosp");

        //if priority is Deselected, Waiting for Triage or Transfer Other Services
        if (!optPri || optPri.substr(0,3) == "WAI" || optPri.substr(0,3) == "TOS"){
                document.UpdateForm.alref027.className = ""; // Priority
                document.UpdateForm.alref084.className = ""; // Prioritising HCP
                document.UpdateForm.alref127.className = ""; // Date of Priority
                document.UpdateForm.alref141.className = ""; // Priority Outcome
                document.UpdateForm.alref038.className = ""; // Responsible HCP
        }else if(optPri.substr(0,3) == "NOT"){
                //if priority is Not Seen

                if(userHosp == "WRH" || userHosp == "PNH" || userHosp == "HOR"){
                        document.UpdateForm.alref027.className = "Mandatory"; // Priority
                }

                document.UpdateForm.alref084.className = ""; // Prioritising HCP
                document.UpdateForm.alref127.className = "Mandatory"; // Date of Priority
                document.UpdateForm.alref141.className = "Mandatory"; // Priority Outcome
                document.UpdateForm.alref038.className = ""; // Responsible HCP
        }else{
                //for any other priority
                if(userHosp == "WRH" || userHosp == "PNH" || userHosp == "HOR"){
                        document.UpdateForm.alref027.className = "Mandatory"; // Priority
                }

                document.UpdateForm.alref084.className = "Mandatory"; // Prioritising HCP
                document.UpdateForm.alref127.className = "Mandatory"; // Date of Priority
                document.UpdateForm.alref141.className = "Mandatory"; // Priority Outcome
                document.UpdateForm.alref038.className = "Mandatory"; // Responsible HCP 
        }
}
// end of change
// 01 : CTAS : To listen to contents of Referring HCP if UNK
// Ref Originator must be mandatory
/*function chkRefHCP() {
	setInterval(function() { 
		var code = document.getElementById('alref022').value.replace(/ /g,"");     
		// code for unknown is UNK
		if (!code) {
			document.UpdateForm.alref153.className="";
		} else {
			if (code.substr(0,3)=="UNK") {
				document.UpdateForm.alref153.className="Mandatory";
			} else {
				document.UpdateForm.alref153.className="";
			}
		}
	}, 100);
}*/

function chkRefHCP() {
  var refHCP = document.getElementById("alref022");
  if (!refHCP) return; // Ensure element exists

  // code for unknown is UNK
  var code = refHCP.value.replace(/ /g,"");
  if (code.substr(0,3)=="UNK") {
    document.getElementById("alref153").className="Mandatory";
  } else {
    document.getElementById("alref153").className="";
  }
}
// end of change

// 01 : CTAS : if suspicion of cancer high or confirmed 
//	make faster cancer treatment checkbox editable

// update value written to database
function updateFasterTreatmentValue() {
	if (document.UpdateForm.d_alref082.checked) {
		document.UpdateForm.alref082.value = "1";
	} else {
		document.UpdateForm.alref082.value = "0";
	}
}

// update faster treatment check box with value from database
function setFasterCancerTreatment() {
	if (document.UpdateForm.alref082.value) {
		var val = document.UpdateForm.alref082.value.replace(/ /g,"");
		if (val === "1" || val === "Yes")
			document.UpdateForm.d_alref082.checked = true;
		else
			document.UpdateForm.d_alref082.checked = false;
	}
}

// enable faster treatment option if cancer suspicion high or confirmed
function enableFasterCancerTreatment() {
	var suspicion = document.UpdateForm.alref061.value.substr(0,3);
	if (suspicion === "R01" || suspicion === "R02") {
		document.UpdateForm.d_alref082.disabled = false;
	} else {
		document.UpdateForm.d_alref082.checked = false;
		document.UpdateForm.d_alref082.disabled = true;
	}
}
//  10 : TAS : WP2-1176 Add  AppRegInd to run on load
function setDefaults() {
	SetSite();
	DisplayTrnSrc();
	CheckHCP();
    chkRegisteredGP();
	defaultDHB();
	ChkSusNotedDate();
	ChkSusNotedField();
	DisplayTrnSrcOut(UpdateForm);
	ChkPriorityRef();
	chkRefHCP();
	EnableBookButton();
	setFasterCancerTreatment();
	enableFasterCancerTreatment();
        setEReferralValue();
	showACC(UpdateForm);
	AppRegInd();
}
// end of change

// 07 : DXC : Task 0850707
// * function to blank and hide transfer source if it is set and GP icon is clicked
// * call to SetRefSource  
function setRefDets(){

	SetRefSource(document.UpdateForm.alref034);
	document.getElementById("aldad001").value=" ";
	document.getElementById("trandesc").value=" ";
    TranSrc.innerHTML=transferblank.innerHTML;
    TranSrcHeading.innerHTML="";
	
}
//end of change

// 07 : DXC : Task 0850707
// * function to remove referring HCP details and HCP practice details if referral source != GP
/*
function remHCPDets(){

	if (document.getElementById("alref034").options.value.substr(9,1) != "G"){
		document.getElementById("alref022").value="";
		document.getElementById("n_alref022").value="";
		document.getElementById("alref023").value="";
		document.getElementById("n_alref023").value="";
		document.getElementById("alref024").value="";
	}
}
*/

function remHCPDets(){
    var HCP = document.getElementById("alref034").value.substr(0,3);
    if (HCP != "R08") {
      document.getElementById("alref022").value="";
      document.getElementById("n_alref022").value="";
      document.getElementById("alref023").value="";
      document.getElementById("n_alref023").value="";
      document.getElementById("alref024").value="";
    }
}

// 10 : TAS : WP2-1176 Add button to open appointment request template allweb0202002.html
//	* Linked to button to open appointment reeuest window
function addApptreq() {
		linkurl="outweb08.pbl?reportno=08&template=902"
		+ "&urnumber=" + document.UpdateForm.urnumber.value.replace(/ /g,"+")
	    + "&admissno=" + document.UpdateForm.admissno.value.replace(/ /g,"+")
		+ "&deptcode=" + document.UpdateForm.deptcode.value.replace(/ /g,"+");
	Left=(document.body.clientWidth-900)/2;
	DFrameLink(linkurl,0,Left,900,550);
}	
// 10 : TAS : WP2-1176 
//	* Make appointment request button go red if there is an appointment request against the referral
function AppRegInd() {
	LinkRIndicator=document.UpdateForm.reqindc.value;
	if (LinkRIndicator=="1") {
	document.all.linkbutt.className="RedButton";
        }
}
// 11 : TAS : Merge Task 0887539
function ValCaseTeam(CaseTeamFld, CaseTeamDesc) {
  if (validateCode2(7,CaseTeamFld, CaseTeamDesc)) {
    var p = document.UpdateForm;
    getHCPbyCaseTeam(p.alref087,p.alref038,p.n_alref038,p.alref019);
    if (!ValCaseTeamMember()) {
      CaseTeamFld.value = "";
      CaseTeamDesc.value = "";
      CaseTeamFld.focus();
    }
  }
 }
function ValCaseTeamMember() {
  if (!isWhitespace(document.UpdateForm.alref019.value)&&
      !isWhitespace(document.UpdateForm.alref038.value)&&
      !isWhitespace(document.UpdateForm.alref087.value)) {
    var serverURL = "../cgi-bin/allweb01.pbl?reportno=8"+
        "&functype=7"+
        "&valddate=" + document.UpdateForm.alref019.value.replace(/ /g,"+")+
        "&valdhcpc=" + document.UpdateForm.alref038.value.replace(/ /g,"+")+
        "&valdteam=" + document.UpdateForm.alref087.value.replace(/ /g,"+");
    var returnValue = RSExecute(serverURL);
    if (returnValue.status != 0) {
      return false;
    }
  }
  return true;
}
//end of change
<!-- 12 : CTAS : update ALREUYN2 value in database -->
function updateEReferralValue(){
        if (document.UpdateForm.d_alref081.checked) {
                document.UpdateForm.alref081.value = "1";
        } else {
                document.UpdateForm.alref081.value = "0";
        }
}
function setEReferralValue() {
        if (document.UpdateForm.alref081.value) {
                var val = document.UpdateForm.alref081.value.replace(/ /g,"");
                if (val === "1" || val === "Yes")
                        document.UpdateForm.d_alref081.checked = true;
                else
                        document.UpdateForm.d_alref081.checked = false;
        }
}
</script>
</head>
<!-- 01: CTAS : DR # 17,27,28,29
<body onload="PageLoad(event);SetSite();DisplayTrnSrc();CheckHCP();
              chkRegisteredGP();defaultDHB();ChkSusNotedDate();
              ChkSusNotedField();DisplayTrnSrcOut(UpdateForm);
              showACC(UpdateForm);FilterReferralSource(UpdateForm);">
-->
<body onload="PageLoad(event);setDefaults();AddOnChangeEvent();
	      FilterReferralSource(UpdateForm);
              showServiceSubtype(document.UpdateForm);">
<!-- end of change -->
<span class=DFrameTitleBar>
 <img border=0 align=right src="../images/ExitIcon.gif" onclick="DFrameExit();">
      %ALLWEB02.02.125.0 Referral</span>
<div id=PageBodySection style="overflow: auto;">
<form name=UpdateForm action="allweb02.pbl" method=post
      onsubmit='return validateMandatory(this);'> 
 <input type=hidden name=reportno value="2">
 <input type=hidden name=updatety value="U">
 <input type=hidden name=urnumber value="%ALLWEB02.02.003">
 <input type=hidden name=admissno value="%ALLWEB02.02.081">
 <input type=hidden name=deptcode value="%ALLWEB02.02.125.1">
 <input type=hidden name=redirect value="allweb02.pbl?reportno=2&template=3">
 <input type=hidden name=dummy>
 <input type=hidden name=nextpage value="5">
 <input type=hidden name=ptcnueoc value="%ALLWEB02.02.503">
 <input type=hidden name=alref083 value="">
 <input type=hidden name=wbsesite value="%STANDARD.01.023">
 <input type=hidden name=hcpprovno value="%ALLWEB02.02.122.2">
 <input type=hidden name=defctype value="%ALLWEB02.02.167.1">
 <input type=hidden name=deftclid value="%ALLWEB02.02.188.1">
 <input type=hidden name=override value="2">
 <input type=hidden name=pmpmi059 value="%ALLWEB02.02.684.001">
 <input type=hidden name=pmpmi060 value="%ALLWEB02.02.685.001">
 <input type=hidden name=pmpmi061 value="%ALLWEB02.02.661">
 <input type=hidden name=catAO value="AO">
 <input type=hidden name=d_alref141 value="%ALLWEB02.02.199.012.1">
 <input type=hidden name=d_alref019 value="%ALLWEB02.02.119">
 <input type=hidden name=pmpxrhc1 value="%ALLWEB02.02.659">
 <input type=hidden name=alcncdhb id=alcncdhb 
        value="%STANDARD.01.025.121.103.0.1">
 <input type=hidden name=ptcnhdps id=ptcnhdps
        value="%STANDARD.01.025.080.250.1.1">
 <input type=hidden name=nhdmdhb id=nhdmdhb value="%ALLWEB02.02.264">
 <input type=hidden name=d_ostcatg id=d_ostcatg value="%ALLWEB02.02.529">
 <input type=hidden name=d_depcod value="%ALLWEB02.02.125.3">
 <input type=hidden name=rejected value="%ALLWEB02.02.199.027">
 <!-- 10 : TAS : Appointment request indicator -->
 <input type=hidden name=reqindc value="%ALLWEB02.02.239";>
  <!-- 01 : CTAS : alref082 = faster cancer treatment -->
 <input type=hidden name=alref082 value="%ALLWEB02.02.143">
  <!-- end of change -->
  <!-- 12 : CTAS : alref081 = eReferral flag -->
 <input type=hidden name=alref081 value="%ALLWEB02.02.142">
<!-- 01 : CTAS : Changed label -->

 <input type=hidden name=refrejct value="0">

 <table align=center cellspacing=0 cellpadding=0 border=0 width=95%>
 <tr><td class=DataLabel width=10%>Date Referral Received</td>
     <td class=DataField width=40%>
         <input type=text name=alref019 size=12 notab readonly tabindex=-1
                onblur="checkDate(this,'Date');" value="%ALLWEB02.02.119"
                class= "Readonly PastDate" title="Date Referral Received"></td>
<!-- end of change -->
     <td class=DataLabel width=10%>Department Code</td>
     <td class=DataField width=40%>
         <input name=allrf001 type=text value="%ALLWEB02.02.125.0" readonly
                tabindex=-1 class=Readonly notab></td></tr>
<!-- 01 : CTAS : Changed label -->
 <tr><td class=DataLabel>Date of Referral</td>
     <td><input type=text name=alref039 size=12 class="Mandatory PastDate"
                value="%ALLWEB02.02.139" onblur="checkDate(this,'Date');"
                title="Date of Referral" tabindex=1>
<!-- end of change -->
           <img src="../images/DateTimeStamp.gif" class=Icon alt="Current"
                date=UpdateForm.alref039 time=null>
           <img src="../images/DateLookup.gif" class=Icon alt="Show Calendar"
                date=UpdateForm.alref039></td>
     <td class=DataLabel>Link to Visit</td>
     <td><input type=text size=10 maxlength=8 name=alref005 tabindex=16
                value="%ALLWEB02.02.105"
                onblur="justifyRight(this);
                        ValidateVisit(alref005,urnumber,dummy);">
           <img src="../images/SearchIcon.gif" class=Icon
                onclick="VisitSearchFrame(urnumber,alref005);"></td></tr>
<!-- 07 : DXC : Added call to remHCPDets() -->
 <tr><td class=DataLabel>Referral Source</td>
     <td><select title="Referral Source" name=alref034 id=alref034 tabindex=2
                 class="Mandatory SelectBig" onchange="DisplayTrnSrc();remHCPDets();">
           <option></option>
             %ALLWEB02.02.134.2
         </select></td>
     <td class=DataLabel>Prev Related Ref ID</td>
     <td><input type=text size=40 maxlength=36 name=alref146 tabindex=17
          value="%ALLWEB02.02.199.018" title="Prev Related Ref ID">
     </td></tr>
    
 <tr><td><div id=TranSrcHeading></div></td>
     <td><div id=TranSrc></div></td>
     <td class=DataLabel>Prev Related Ref Date</td>
     <td><input type=text name=alref161 value="%ALLWEB02.02.199.036"
      title="Prev Related Ref Date" class="Date" tabindex=18>
     <img src=../images/DateLookup.gif class=Icon
      align=absmiddle onclick="DateLookupFrame(alref161);">
      Time&nbsp;<input type=text size=6 title="Time"
      value="%ALLWEB02.02.199.037" tabindex=19
      class="Time" name=alref162>
     <img src="../images/DateTimeStamp.gif" class=Icon
       onclick="SetCurrentDateTime(alref161,alref162);">
     <img src="../images/TimeLookup.gif" class=Icon
       onclick="TimeLookupFrame(alref162);">
     </td></tr>

 <tr><td class=DataLabel>Inform GP</td>
     <td><select name=pmsvx010 tabindex=4>
           <option value="0">No</option>
           <option value="1">Yes</option>
         </select></td>
     <td class=DataLabel>Referral Originator</td>
     <td><input type=text size=32 maxlength=30 name=alref153 id=alref153 tabindex=20
                value="%ALLWEB02.02.199.028" title="Referral Originator"></td></tr>

 <tr><td class=DataLabel width=10%>Referring HCP</td>
    <td><input type=text name=alref022 id=alref022 size=10 maxlength=10 tabindex=4
               value="%ALLWEB02.02.122.1" class=Mandatory title="Referring HCP"
               onchange="UpCase(this);
                         if (checkAlphanumDesc(event,this) != false) {
                           ReadDoc(18,0,alref022,n_alref022,alref023,
                                   n_alref023,alref024,hcpprovno);
                           chkRegisteredGP();chkRefHCP();
                         }">
        <input type=text name=n_alref022 id=n_alref022 size=30 readonly title="HCP Name"
               class=Readonly value="%ALLWEB02.02.122.0">
          <img src="../images/SearchIcon.gif" class=Icon
                onclick="GPHCPSearchFrame(alref022,n_alref022,hcpprovno,alref023,
                                          n_alref023,alref024,0);
                         chkRegisteredGP();">
          <img src="../images/ClearIcon.gif" class=Icon
               onclick="clrFields(alref022,n_alref022,hcpprovno);
                        chkRegisteredGP();">
<!-- 01 : CTAS : icon to populate referring HCP with patient's GP -->
<!-- 04 : DXC : Fixed icon to populate GP and practice correctly -->
<!-- 07 : DXC : changed to call setRefDets function -->			
			<img src="../images/gp.jpg" class=Icon 
			 onclick="setRefDets(); 
					  getPMILocalGP(document.UpdateForm.urnumber,
									document.UpdateForm.alref022,
									document.UpdateForm.n_alref022,
									document.UpdateForm.alref023,
									document.UpdateForm.alref024,
									document.UpdateForm.n_alref023);
									chkRegisteredGP();">				
<!-- end of change -->	
	  </td>
      <td class=DataLabel>Retain as Usual GP?</td>
      <td><input type=checkbox value="0" name=rusualgp tabindex=21
                 title="Retain as Usual GP" onclick="UpdateGP();"></td></tr>

 <tr><td class=DataLabel>HCP Practice</td>
     <td><input type=text size=10 class=readonly value="%ALLWEB02.02.123.0"
                title="HCP Practice" readonly notab name=alref023 id=alref023>
         <input type=text size=30 class=readonly value="%ALLWEB02.02.123.1"
                title="Practice Name" readonly notab name=n_alref023 id=n_alref023>
         <input type=hidden name=alref024 id=alref024
                title="Practice Count" value="%ALLWEB02.02.124">
           <img src="../images/SearchIcon.gif" class=Icon
                onClick="GPHCGSearchFrame(alref022,n_alref022,hcpprovno,alref023,
                                          n_alref023,alref024);">
           <img src="../images/erase.gif" class=Icon
                onClick="clrFields(alref023,n_alref023,alref024,hcpprovno);"></td>
<!-- 01 : CTAS : Move Primary tick-box
     <td class=DataLabel>
         <script type="text/javascript">MRDescription()</script> </td>
     <td><input type=text name=d_alref083 size=3 readonly class=Readonly
                value="ALLWEB02.02.144" tabindex=-1></td></tr>
end of change -->
				
	 <td class=DataLabel>Reason for Referral</td>
     <td><input type=text size=42 maxlength=60 name=alref088
                value="%ALLWEB02.02.149" tabindex=22 class="Mandatory" 
				title="Reason for Referral"></td>
</tr>
 <tr><td class=DataLabel>%STANDARD.01.017.RI</td>
     <td><select name=alref124 title="%STANDARD.01.017.RI" tabindex=6
                 class=Mandatory>
           <option></option>
             %ALLWEB02.02.186.2
         </select>

		<!-- 01 : CTAS : Add Help Icon -->	
	    <img src=../images/HelpIcon.gif class=Icon onclick="getInfoHelp('1');">	   
	    <!-- end of change -->	 
	</td>
        <!-- 12 : CTAS : Add field IDs and eReferral checkbox. -->
                <td class=DataLabel id=lblComments>Comments</td>
                <td><input type=text size=42 maxlength=60 name=alref089 value="%ALLWEB02.02.150"
                 tabindex=23>
                <input type=checkbox style="display:none"
                id=chkEReferral value="%ALLWEB02.02.142" name=d_alref081>
                <label style="display:none" id=lblEReferral for="chkEReferral">Is eReferral?</label></td>
</tr>
<!-- 01 : CTAS : Add Referrer Priority -->
<tr>
	<td class=DataLabel>%ALLWEB02.02.140.36.8</td>
	<td class=DataField>
		<select class="SelectBig" tabindex=7
		 name=alref075 title="%ALLWEB02.02.140.36.8" >
				<option></option>
				%ALLWEB02.02.140.36.2
		</select>
	</td>
	<td colspan=2></td>
</tr>
<!-- end of change -->
 <tr><td class=DataLabel>%STANDARD.01.017.lu</td>
     <td><select name=alref060 title="%STANDARD.01.017.lu" tabindex=8>
           <option></option>
             %ALLWEB02.02.199.044.2
         </select></td>
     <td class=DataLabel>%STANDARD.01.017.lt</td>
     <td><select name=alref059 title="%STANDARD.01.017.lt" tabindex=24>
           <option></option>
             %ALLWEB02.02.199.045.2
         </select></td></tr>
<!-- 01 : CTAS : Changed label
				 made mandatory
				 added call to CheckRefReason(this)-->
 <tr><td class=DataLabel>Referral Reason 1</td>
	  <td><select title="Referral Reason 1" name=alref028 
			tabindex=9 class="SelectBig Mandatory" onchange="CheckRefReason(this);">
           <option></option>
             %ALLWEB02.02.128.2
         </select></td>
     <td class=DataLabel>Diagnosis 1</td>
     <td><input type=text name=alref031 title="Diagnosis 1" size=12 tabindex=25
                value="%ALLWEB02.02.131.1" maxlength=9
                onblur="validateAHDiag(deptcode,alref031,d_alref031);">
         <input type=text name=d_alref031 title="Diagnosis 1" size=25
                class=Readonly readonly notab value="%ALLWEB02.02.131.0">
           <img src="../images/SearchIcon.gif" class=Icon
                onClick="AHDiagSearchFrame(deptcode,alref031,d_alref031);">
           <img src="../images/ClearIcon.gif" class=Icon
                onClick="clrFields(alref031,d_alref031);"></td></tr>

 <tr><td class=DataLabel>Referral Reason 2</td>
     <td><select title="Referral Reason 2" name=alref029 
		tabindex=10 class="SelectBig"onchange="CheckRefReason(this);">
           <option></option>
             %ALLWEB02.02.129.2
         </select></td>
     <td class=DataLabel>Diagnosis 2</td>
     <td><input type=text name=alref032 title="Diagnosis 2" size=12 tabindex=26
                value="%ALLWEB02.02.132.1" maxlength=9
                onblur="validateAHDiag(deptcode,alref032,d_alref032);">
         <input type=text name=d_alref032 title="Diagnosis 2" size=25
                class=Readonly readonly notab value="%ALLWEB02.02.132.0">
           <img src="../images/SearchIcon.gif" class=Icon
                onClick="AHDiagSearchFrame(deptcode,alref032,d_alref032);">
           <img src="../images/ClearIcon.gif" class=Icon
                onClick="clrFields(alref032,d_alref032);"></td></tr>

 <tr><td class=DataLabel>Referral Reason 3</td>
     <td><select title="Referral Reason 3" name=alref030 
			tabindex=11 class="SelectBig" onchange="CheckRefReason(this);">
           <option></option>
             %ALLWEB02.02.130.2
         </select></td>
     <td class=DataLabel>Diagnosis 3</td>
     <td><input type=text name=alref033 title="Diagnosis 3" size=12 tabindex=27
                value="%ALLWEB02.02.133.1" maxlength=9
                onblur="validateAHDiag(deptcode,alref033,d_alref033);">
         <input type=text name=d_alref033 title="Diagnosis 1" size=25
                class=Readonly readonly notab value="%ALLWEB02.02.133.0">
           <img src="../images/SearchIcon.gif" class=Icon
                onClick="AHDiagSearchFrame(deptcode,alref033,d_alref033);">
           <img src="../images/ClearIcon.gif" class=Icon
                onClick="clrFields(alref033,d_alref033);"></td></tr>
<!-- end of change -->
 <tr><td class=DataLabel>%STANDARD.01.017.CL</td>
     <td><select title="%STANDARD.01.017.CL" name=alref035 tabindex=12
                 class="Mandatory SelectBig" onchange=showACC(UpdateForm);>
           <option></option>
             %ALLWEB02.02.135.2
         </select></td>
<!-- CTAS customisation - remove diag 4
    <td class=DataLabel>Diagnosis 4</td>
    <td><input type=text name=alref169 title="Diagnosis 4" size=12 tabindex=29
                value="ALLWEB02.02.199.048.1" maxlength=9
                onblur="validateAHDiag(deptcode,alref169,d_alref169);">
         <input type=text name=d_alref169 title="Diagnosis 4" size=25
                class=Readonly readonly notab value="ALLWEB02.02.199.048.0">
           <img src="../images/SearchIcon.gif" class=Icon
                onClick="AHDiagSearchFrame(deptcode,alref169,d_alref169);">
           <img src="../images/ClearIcon.gif" class=Icon
                onClick="clrFields(alref169,d_alref169);"></td></tr>
--CTAS end of change -->
     <tr><td><div id=ACCHeading></div></td>
         <td><div id=ACCId></div></tr>


<!-- CTAS customisation - remove diag  5 -->
<!-- TAS : 09 : Reapply Health Purchaser made mandatory --> 
 <tr><td class=DataLabel>ALLWEB02.02.199.011.8  </td>
     <td><select title="ALLWEB02.02.199.011.8  " name=alref140 tabindex=13	
                 class="Mandatory SelectBig">
           <option></option>
             ALLWEB02.02.199.011.2
         </select></td>
<!-- CTAS customisation - restore Health purchaser field
    <td class=DataLabel>Diagnosis 5</td>
    <td><input type=text name=alref170 title="Diagnosis 5" size=12 tabindex=30
                value="%ALLWEB02.02.199.049.1" maxlength=9
                onblur="validateAHDiag(deptcode,alref170,d_alref170);">
         <input type=text name=d_alref170 title="Diagnosis 5" size=25
                class=Readonly readonly notab value="%ALLWEB02.02.199.049.0">
           <img src="../images/SearchIcon.gif" class=Icon
                onClick="AHDiagSearchFrame(deptcode,alref170,d_alref170);">
           <img src="../images/ClearIcon.gif" class=Icon
                onClick="clrFields(alref170,d_alref170);"></td>
    </tr>
---CTAS   end of change -->
 <tr><td class=DataLabel>Score</td>
     <td><input type=text name=alref143 title="Score" size=5 maxlength=5
                value="%ALLWEB02.02.199.014" tabindex=14></td>
    <td class=DataLabel>Procedure 1</td>
    <td><input type=text name=alref171 title="Procedure 1" size=12 tabindex=31
          value="%ALLWEB02.02.199.050.1" maxlength=9
          onblur="validateAHProc(deptcode,alref171,d_alref171);">
         <input type=text name=d_alref171 title="Procedure 1" size=25
          class=Readonly readonly notab value="%ALLWEB02.02.199.050.0">
         <img src="../images/SearchIcon.gif" class=Icon
          onClick="AHProcSearchFrame(deptcode,alref171,d_alref171);">
         <img src="../images/ClearIcon.gif" class=Icon
          onClick="clrFields(alref171,d_alref171);"></td>
    </tr>

 <tr><td class=DataLabel>%ALLWEB02.02.199.013.8</td>
     <td><select title="%ALLWEB02.02.199.013.8" name=alref142 tabindex=15
                 class="SelectBig">
           <option></option>
             %ALLWEB02.02.526
         </select></td>
    <td class=DataLabel>Procedure 2</td>
    <td><input type=text name=alref172 title="Procedure 2" size=12 tabindex=32
          value="%ALLWEB02.02.199.051.1" maxlength=9
          onblur="validateAHProc(deptcode,alref172,d_alref172);">
         <input type=text name=d_alref172 title="Procedure 2" size=25
          class=Readonly readonly notab value="%ALLWEB02.02.199.051.0">
         <img src="../images/SearchIcon.gif" class=Icon
          onClick="AHProcSearchFrame(deptcode,alref172,d_alref172);">
         <img src="../images/ClearIcon.gif" class=Icon
          onClick="clrFields(alref172,d_alref172);"></td>
    </tr>

 <tr><td class=DataLabel></td>
     <td></td>
     <td class=DataLabel>Procedure 3</td>
     <td><input type=text name=alref173 title="Procedure 3" size=12 tabindex=33
          value="%ALLWEB02.02.199.052.1" maxlength=9
          onblur="validateAHProc(deptcode,alref173,d_alref173);">
         <input type=text name=d_alref173 title="Procedure 3" size=25
          class=Readonly readonly notab value="%ALLWEB02.02.199.052.0">
         <img src="../images/SearchIcon.gif" class=Icon
          onClick="AHProcSearchFrame(deptcode,alref173,d_alref173);">
         <img src="../images/ClearIcon.gif" class=Icon
          onClick="clrFields(alref173,d_alref173);"></td>
     <tr>
<!-- CTAS remove procedure 4,5  ----
 <tr><td class=DataLabel></td>
     <td></td>
     <td class=DataLabel>Procedure 4</td>
     <td><input type=text name=alref174 title="Procedure 4" size=12 tabindex=34
          value="ALLWEB02.02.199.053.1" maxlength=9
          onblur="validateAHProc(deptcode,alref174,d_alref174);">
         <input type=text name=d_alref174 title="Procedure 4" size=25
          class=Readonly readonly notab value="ALLWEB02.02.199.053.0">
         <img src="../images/SearchIcon.gif" class=Icon
          onClick="AHProcSearchFrame(deptcode,alref174,d_alref174);">
         <img src="../images/ClearIcon.gif" class=Icon
          onClick="clrFields(alref174,d_alref174);"></td>
     <tr>

 <tr><td class=DataLabel></td>
     <td></td>
     <td class=DataLabel>Procedure 5</td>
     <td><input type=text name=alref175 title="Procedure 5" size=12 tabindex=35
          value="ALLWEB02.02.199.054.1" maxlength=9
          onblur="validateAHProc(deptcode,alref175,d_alref175);">
         <input type=text name=d_alref175 title="Procedure 5" size=25
          class=Readonly readonly notab value="%ALLWEB02.02.199.054.0">
         <img src="../images/SearchIcon.gif" class=Icon
          onClick="AHProcSearchFrame(deptcode,alref175,d_alref175);">
         <img src="../images/ClearIcon.gif" class=Icon
          onClick="clrFields(alref175,d_alref175);"></td>
     <tr>
-- CTAS END of Change -->
 <tr><td colspan=4><hr></td></tr>

 <tr><td class=DataLabel>Preferred Hospital</td>
     <td><select name=alref107 id=alref107 title="Preferred Hospital"
                 class=Mandatory tabindex=40 onchange="ShowOutofArea();">
           <option></option>
             %ALLWEB02.02.170.2
         </select></td>
     <td class=DataLabel>Priority</td>
	 <!-- 01 : CTAS DR # 17,27,28,29
     <td><select title="Priority" name=alref027 class="SelectBig" tabindex=80
                 onchange="selectCatCodInd(catAO,alref141,d_alref141,alref027,
                                           '1','1');">-->
	<td><select title="Priority" name=alref027 class="SelectBig" tabindex=50
             onchange="selectCatCodInd(catAO,alref141,d_alref141,alref027,
                                       '1','1');
                       ChkPriorityRef();
                       showServiceSubtype(document.UpdateForm);">
	<!-- end of change -->
           <option></option>
             %ALLWEB02.02.127.2
         </select></td></tr>

 <tr><td class=DataLabel>Preferred Site</td>
     <td><select name=alref119 title="Preferred Site"
                 tabindex=41 class="SelectBig" onchange="SetList();">
           <option></option>
             %ALLWEB02.02.182.2
         </select></td>
     <td>Date of Priority</td>
     <td><input type=text name=alref127 size=12 tabindex=51
                onblur="checkDate(this,'Date');" value="%ALLWEB02.02.194"
                title="Date of Priority" class="PastDate">
           <img src="../images/DateTimeStamp.gif" class=Icon alt="Current"
                date=UpdateForm.alref127 time=null>
           <img src="../images/DateLookup.gif" class=Icon alt="Show Calendar"
                date=UpdateForm.alref127></td></tr>
<!-- 01 : CTAS : made mandatory -->
 <tr><td class=DataLabel>Clinic Type </td>
	 <td><select name=alref106 maxlength=45 tabindex=42
                 class="SelectBig Mandatory"  title="Clinic Type" onchange="SetList2();">
           <option></option>
         </select></td>
<!-- end of change -->
     <td>Must Be Seen By Date</td>
     <td><input type=text name=alref126 size=12 tabindex=52
                onblur="checkDate(this,'Date');" value="%ALLWEB02.02.189"
                title="Must Be Seen By Date">
           <img src="../images/DateTimeStamp.gif" class=Icon alt="Current"
                date=UpdateForm.alref126 time=null>
           <img src="../images/DateLookup.gif" class=Icon alt="Show Calendar"
                date=UpdateForm.alref126></td></tr>
				
<!-- 01 : CTAS : add Date of Next Review field  -->
<!-- 02 : DXC : made clinic ID mandatory -->
<tr>
	<td class=DataLabel>Clinic ID</td>
	<td><select name=alref120 title="Clinic ID" 
			class="SelectBig Mandatory" tabindex=43>
           <option></option>
         </select></td>
	<td>Next Review Date</td>
	<td><input type=text name=alref037 size=12 tabindex=53
                 onblur="checkDate(this,'Date');" value="%ALLWEB02.02.137"
                 title="Next Review Date">
            <img src="../images/DateTimeStamp.gif" class=Icon alt="Current"
                 date=UpdateForm.alref037 time=null>
             <img src="../images/DateLookup.gif" class=Icon alt="Show Calendar"
                 date=UpdateForm.alref037></td>
</tr>
<!-- end of change -->				

 <tr>
	<td class=DataLabel width=10%>Slot Type</td>
    <td><select name=alref117 class=SelectBig title="Slot Type" tabindex=44>
           <option></option>
             %ALLWEB02.02.180.2
         </select></td>
     <td class=DataLabel>Prioritising HCP</td>
     <td><input type=text name=alref084 size=10 maxlength=10
                value="%ALLWEB02.02.145.1" tabindex=54 title="Prioritising HCP"
                onblur="UpCase(this);
                        if (checkAlphanumDesc(event,this) != false) {
                          ValidateHCP(18,14,alref084,n_alref084);
                        }">
         <input type=text name=n_alref084 size=30 readonly notab
                title="Prioritising HCP" class=Readonly value="%ALLWEB02.02.145.0">
           <img src="../images/SearchIcon.gif" class=Icon
                onclick="HCPSearchFrame(alref084,n_alref084,1);">
           <img src="../images/ClearIcon.gif" class=Icon
                onclick="clrFields(alref084,n_alref084);"></td></tr>

 <tr>
	 <td colspan=2></td>
     <td class=DataLabel>%ALLWEB02.02.199.012.8</td>
     <td><select title="%ALLWEB02.02.199.012.8" name=alref141 tabindex=55
                 class="SelectBig" onchange="DisplayTrnSrcOut(UpdateForm);">
            <option></option>
         </select></td></tr>

 <tr><td class=DataLabel width=10%></td>
     <td></td>
     <td><div id=TranSrcHeadingOut></div></td>
     <td><div id=TranSrcOut></div></td>
     <tr>
<!-- 01 : CTAS : Made non-mandatory -->
 <tr><td class=DataLabel>Responsible HCP</td>
     <td><input type=text name=alref038 size=10 maxlength=10
                value="%ALLWEB02.02.138.1" tabindex=45
                title="Responsible HCP"
                onblur="UpCase(this);
                        if (checkAlphanumDesc(event,this) != false) {
                          ValidateHCP(18,14,alref038,n_alref038);
                        }"
                onchange="if (checkAlphanumDesc(event,this) != false) {
                            getCaseTeamByHCP(alref038,alref087,n_alref087,
                                             d_alref019);
                          }">
         <input type=text name=n_alref038 size=30 readonly title="HCP Name"
                value="%ALLWEB02.02.138.0" class=Readonly>
           <img src="../images/SearchIcon.gif" id="img_alref038" class=Icon
                onclick="hcpOnChange(alref038,n_alref038,alref087,n_alref087,
                                     d_alref019);">
           <img src="../images/ClearIcon.gif" class=Icon
                onclick="clrFields(alref038,n_alref038);"></td>
<!-- end of change -->
<!-- 01 : CTAS : add call to enableFasterCancerTreatment(); -->				
      <td class=DataLabel>%STANDARD.01.017.lv</td>
      <td><select name=alref061 title="%STANDARD.01.017.lv" tabindex=56
                  class="" onchange="ChkSusNotedDate();enableFasterCancerTreatment();">
            <option></option>
              %ALLWEB02.02.199.046.2
          </select></td></tr>
<!-- end of change -->

<tr id=ShowServiceSubtypeDet>
  <td>&nbsp;</td>
  <td>&nbsp;</td>
  <td class=DataLabel>Service Subtype</td>
  <td><select name=alref193 id=alref193 title="Service Subtype" tabindex="85">
        <option></option>
         %ALLWEB02.02.199.074
      </select>
  </td>
</tr>

 <tr><td class=DataLabel>Case Team</td>
     <td><input type=text name=alref087 size=11 maxlength=10 title="Case Team"
                value="%ALLWEB02.02.148.1" tabindex=46
                onblur=" validateCode2(7,alref087,n_alref087);"
                onchange="getHCPbyCaseTeam(alref087,alref038,n_alref038,
                                           d_alref019);">
        <input type=text name=n_alref087 size=29 readonly
               value="%ALLWEB02.02.148.0"
               class=Readonly title="Team Description">
          <img src="../images/SearchIcon.gif" id="img_alref087" class=Icon
               onclick="caseTeamOnChange(alref087,n_alref087,alref038,n_alref038,
                                         d_alref019);">
          <img src="../images/ClearIcon.gif" class=Icon
               onClick="clrFields(alref087,n_alref087);"></td>
      <td class=DataLabel>Suspicion Noted Date</td>
      <td><input type=text name=alref165 size=12 tabindex=57
                 class="PastDate" value="%ALLWEB02.02.199.040"
                 title="Suspicion Noted Date"
                 onblur="checkDate(this,'Date');ChkSusNotedField();">
            <img src="../images/DateTimeStamp.gif" class=Icon alt="Current"
                 date=UpdateForm.alref165 time=null>
            <img src="../images/DateLookup.gif" class=Icon alt="Show Calendar"
                 date=UpdateForm.alref165></td></tr>
				 
	<!-- 01 : CTAS : add faster cancer treatment checkbox -->
	<tr><td colspan=2></td>
		<td class=DataLabel colspan=2>Faster Cancer Treatment (2 Weeks)&nbsp;
 		<input type=checkbox value="%ALLWEB02.02.143" name=d_alref082
                title="Faster Cancer Treatment (2 Weeks)" tabindex=51>
	</td></tr>
	<!-- end of change -->				 

 <tr><td class=DataLabel>Additional HCP</td>
     <td><input type=checkbox name=addithcp value="1" tabindex=47
                onclick="CheckAddHCP();"></td>
	 <!-- 01 : CTAS : Move Primary tick-box here 
	 <td class=DataLabel><div id=InsertActiveH></div></td>
     <td><div id=InsertActiveF></div></td>
	 -->
	 <td class=DataLabel>
         <script type="text/javascript">MRDescription()</script> </td>
     <td><input type=text name=d_alref083 size=3 readonly class=Readonly
                value="%ALLWEB02.02.144" tabindex=-1></td>
	 <!-- end of change -->
</tr>

	<!-- 01 : CTAS : Move activate referral here -->
	<tr>
		<td class=DataLabel colspan=2></td>
		<td class=DataLabel><div id=InsertActiveH></div></td>
		<td><div id=InsertActiveF></div></td>
	</tr>
	<!-- end of change -->

    <tr><td class=DataLabel><div id=AdditionalHCP1H></div></td>
        <td><div id=AdditionalHCP1F></div></td>
        <td class=DataLabel><div id=AdditionalHCP2H></div></td>
        <td><div id=AdditionalHCP2F></div></td></tr>

  <tr><td class=DataLabel><div id=AdditionalHCP3H></div></td>
      <td><div id=AdditionalHCP3F></div></td>
      <td class=DataLabel><div id=AdditionalHCP4H></div></td>
      <td><div id=AdditionalHCP4F></div></td></tr>

  <tr>
      <td class=DataLabel id=DHBtitl><div id=DHBtitleDIV></div></td>
      <td class=DataField id=DHBcode><div id=DHBcodeDIV></div></td>
  </tr>
  <tr>
      <td class=DataLabel><div id=outofareatitleDIV></div></td>
      <td><div id=outofareacodeDIV></div></td>
  </tr>

 <tr><td class=DataLabel colspan=2>Print Update Referral Letter to Patient &nbsp;&nbsp;
         <input type=checkbox name=prtupdpt tabindex=60
                title="Upd Referral to pat" value="1"></td>
       <td class=DataLabel>Printer </td>
       <td><select name=prtpsl03 class="SelectBig" tabindex=61>
             %STANDARD.01.001.ALLUPDPT.01
            </select></td></tr>

 <tr><td class=DataLabel colspan=2>Print Update Referral Letter to Referrer
         <input type=checkbox name=prtupdrf tabindex=62
                title="Upd Referral to pat" value="1"></td>
     <td class=DataLabel>Printer </td>
     <td><select name=prtpsl04 class="SelectBig" tabindex=63>
           %STANDARD.01.001.ALLUPDRF.01
         </select></td></tr>

  <tr><td class=DataLabel colspan=2><div id=PrintRefrLtr1H></div></td>
      <td class=DataLabel><div id=PrintRefrLtr2H></div></td>
      <td><div id=PrintRefrLtr2F></div></td></tr>

 <tr><td class=DataLabel colspan=2>Referral Labels
         <input type=checkbox value="1" name=prtreflb tabindex=66
                onclick="SetPrinter(UpdateForm.prtpno07,UpdateForm.prtpsl07);">
         Copies
         <select name=prtpno07 tabindex=67>
           %STANDARD.01.027.2.1
         </select></td>
     <td class=DataLabel>Printer</td>
     <td><select class="SelectBig" name=prtpsl07 title="Printer" tabindex=68>
           <option></option>
             %STANDARD.01.001.LABELALL.01
         </select></td></tr>

 <tr><td colspan=4 align=center><br>
<!-- 06 : TAS : add delay to update button per 0849246 -->
         <input type=button name=formactn id=formactn 
           value="OK" class="button" tabindex=70
           onclick="tempDisable(this);UpdateReferral();">
<!-- 01 : CTAS : add Book button -->
         <input type=button name=bookbtn value="Book" class="button" tabindex=71
                id=bookbtn onclick="Book();">
<!-- 10 : TAS : add Appointment request button -->
		 <input type=button value="Appt Request" class="button" tabindex=72
				name=linkbutt onClick="addApptreq();">
<!-- end of change -->
         <input type=button Value="Close" class="button" tabindex=73
                onClick="DFrameClose();"></td></tr>
 </table>
</form>
</div>

<span id=transferhd style="display:none">Transfer Source</span>

<span id=transfersrc style="display:none">
  <input type="text" size=7 maxlength=5 name=aldad001 id=aldad001 class=Mandatory
         title="Transfer Source" tabindex=3 value="%ALLWEB02.02.510.0"
         onchange="validateTransferSource(9,aldad001,trandesc,alref034);">
  <input type=text size=27 name=trandesc id=trandesc notab value="%ALLWEB02.02.510.1"
         class=Readonly readonly>
    <img src="../images/SearchIcon.gif" class=Icon
   onClick="TransferSourceFrameCategory(aldad001,trandesc,alref034,d_ostcatg);">
</span>

<span id=transferblank style="display:none">
  <input type=hidden name=aldad001 id=aldad001>
</span>

<span id="Blank" style="display:none;"></span>

<span id="BlankAdditionalHCP1F" style="display:none;">
  <input type=hidden name=alref085 value="">
</span>

<span id="BlankAdditionalHCP2F" style="display:none;">
  <input type=hidden name=alref086 value="">
</span>

<span id="BlankAdditionalHCP3F" style="display:none;">
  <input type=hidden name=alref166 value="">
</span>

<span id="BlankAdditionalHCP4F" style="display:none;">
  <input type=hidden name=alref167 value="">
</span>

<span id="ShowAdditionalHCP1H" style="display:none;">Additional HCP 1</span>

<span id="ShowAdditionalHCP1F" style="display:none;">
  <input type=text name=alref085 size=10 maxlength=10
         title="Additional HCP 1" tabindex=39 value="%ALLWEB02.02.146.1"
         onblur="ValidateHCP(18,0,alref085,d_alref085);">
  <input type=text name=d_alref085 size=30 class=Readonly readonly
         title="Additional HCP 1" value="%ALLWEB02.02.146.0">
    <img src="../images/SearchIcon.gif" class=Icon
         onclick="HCPSearchFrame(alref085,d_alref085,0);">
    <img src="../images/ClearIcon.gif" class=Icon
         onClick="clrFields(alref085,d_alref085);">
</span>

<span id="ShowAdditionalHCP2H" style="display:none;">Additional HCP 2</span>

<span id="ShowAdditionalHCP2F" style="display:none;">
  <input type=text name=alref086 size=10 maxlength=10
         title="Additional HCP 2" tabindex=40 value="%ALLWEB02.02.147.1"
         onblur="ValidateHCP(18,0,alref086,d_alref086);">
  <input type=text name=d_alref086 size=30 class=Readonly readonly
         title="Additional HCP 2" value="%ALLWEB02.02.147.0">
    <img src="../images/SearchIcon.gif" class=Icon
         onclick="HCPSearchFrame(alref086,d_alref086,0);">
    <img src="../images/ClearIcon.gif" class=Icon
         onClick="clrFields(alref086,d_alref086);">
</span>

<span id="ShowAdditionalHCP3H" style="display:none;">Additional HCP 3</span>

<span id="ShowAdditionalHCP3F" style="display:none;">
  <input type=text name=alref166 size=10 maxlength=10
         title="Additional HCP 3" tabindex=41 value="%ALLWEB02.02.199.042.1"
         onblur="ValidateHCP(18,0,alref166,d_alref166);">
  <input type=text name=d_alref166 size=30 class=Readonly readonly
         title="Additional HCP 3" value="%ALLWEB02.02.199.042.0">
    <img src=../images/SearchIcon.gif class=Icon
         onclick="HCPSearchFrame(alref166,d_alref166,0);">
    <img src="../images/ClearIcon.gif" class=Icon
         onClick="clrFields(alref166,d_alref166);">
</span>

<span id="ShowAdditionalHCP4H" style="display:none;">Additional HCP 4</span>

<span id="ShowAdditionalHCP4F" style="display:none;">
  <input type=text name=alref167 size=10 maxlength=10
         title="Additional HCP 4" tabindex=42 value="%ALLWEB02.02.199.043.1"
         onblur="ValidateHCP(18,0,alref167,d_alref167);">
  <input type=text name=d_alref167 size=30 class=Readonly readonly
         title="Additional HCP 4" value="%ALLWEB02.02.199.043.0">
    <img src=../images/SearchIcon.gif class=Icon
         onclick="HCPSearchFrame(alref167,d_alref167,0);">
    <img src="../images/ClearIcon.gif" class=Icon
         onClick="clrFields(alref167,d_alref167);">
</span>

<span id="ShowInsertActiveH" style="display:none;">Activate Referral</span>

<span id="ShowInsertActiveF" style="display:none;">
  <input type=checkbox name=activref value="1" title="Activate Referral"
         tabindex=87>
</span>

<span id="ShowPrintRefrLtr1H" style="display:none;">
  Print Update Referral Letter to GP &nbsp;&nbsp;
  <select name=prtrefgp tabindex=64>
    <option></option>
      %ALLWEB02.02.255.2
  </select>
</span>

<span id="ShowPrintRefrLtr2H" style="display:none;">Printer</span>

<span id="ShowPrintRefrLtr2F" style="display:none;">
  <select class="SelectBig" name=prtpsl08 title="Printer" tabindex=65>
    <option></option>
      %STANDARD.01.001.ALLNEWGP.01
  </select>
</span>

<span id=DHBtitleSPAN style="display:none">
Patient's DHB
</span>

<span id=DHBcodeSPAN style="display:none">
%ALLWEB02.02.070.024
</span>

<span id=outofareatitleSPAN style="display:none">
%STANDARD.01.017.ly
</span>

<span id=outofareacodeBLANK style="display:none">
  <input type=hidden name=alref064 value="">
</span>
<!-- 01 : CTAS : made mandatory -->
<span id=outofareacodeSPAN style="display:none">
  <select name=alref064 title="%STANDARD.01.017.ly" 
	tabindex=48 class="Mandatory SelectBig">
    <option></option>
    %ALLWEB02.02.140.25.5
  </select>
</span>
<!-- end of change -->
<span id=transferhdout style="display:none">Transfer Destination</span>

<span id=transfersrcout style="display:none">
  <input type="text" size=7 maxlength=5 name=aldad002 class=Mandatory
         title="Transfer Destination" tabindex=85 value="%ALLWEB02.02.511.0"
         onchange="validateCodeTransfer(9,aldad002,trnodesc,alref141);">
  <input type=text size=27 name=trnodesc notab value="%ALLWEB02.02.511.1"
         class=Readonly readonly>
  <img src="../images/SearchIcon.gif"
         onClick="TransferSourceFrameOutcome(aldad002,trnodesc,alref141);">
  <img src="../images/ClearIcon.gif" class=Icon
         onClick="clrFields(aldad002,trnodesc);">
</span>

<span id=transferblankout style="display:none">
  <input type=hidden name=aldad002>
</span>

<span id=blanklabel style="display:none">
</span>
<span id=acchd style="display:none">
ACC Purchase Order Number
</span>

<span id=accorderid style="display:none">
  <input type=text name=accpordn id=accpordn title="ACC Purchase Order Number" 
   tabindex=10 value="%ALLWEB02.02.274" maxlength=20 size=25>
</span>
<script type="text/javascript">
 var UF = document.UpdateForm;
 if("%ALLWEB02.02.103"=="Waiting   ") {
     InsertActiveF.style.display="";
     InsertActiveH.style.display="";
     InsertActiveF.innerHTML=ShowInsertActiveF.innerHTML;
     InsertActiveH.innerHTML=ShowInsertActiveH.innerHTML;
 } else {
     InsertActiveF.style.display="none";
     InsertActiveH.style.display="none";
     InsertActiveF.innerHTML=Blank.innerHTML;
     InsertActiveH.innerHTML=Blank.innerHTML;
 }
 BulkBill="%ALLWEB02.02.136";
 if(BulkBill=="Yes") {
    UF.alref036.checked=1; }
 SACSRef="%ALLWEB02.02.144";
 if(SACSRef=="Yes") {
   UF.alref083.value=1;
 } else{
   UF.alref083.value=0;
 }
 for(var i=0;i<UF.pmsvx010.length;i++) {
     if(UF.pmsvx010.options[i].value=="%ALLWEB02.02.325.0") {
        UF.pmsvx010.selectedIndex=i;
     }
 }
 for(var i=0;i<UF.alref142.length;i++) {
     if(UF.alref142.options[i].value=="%ALLWEB02.02.527") {
        UF.alref142.selectedIndex=i;
     }
 }
 for (var i =0 ; i < document.UpdateForm.alref059.length; i++) {
   if (document.UpdateForm.alref059.options[i].value=="%ALLWEB02.02.199.045.1"){
       document.UpdateForm.alref059.selectedIndex=i } };
 for (var i =0 ; i < document.UpdateForm.alref060.length; i++) {
   if (document.UpdateForm.alref060.options[i].value=="%ALLWEB02.02.199.044.1"){
       document.UpdateForm.alref060.selectedIndex=i } };
 for (var i =0 ; i < document.UpdateForm.alref061.length; i++) {
   if (document.UpdateForm.alref061.options[i].value=="%ALLWEB02.02.199.046.1"){
       document.UpdateForm.alref061.selectedIndex=i } };

<!-- 12 : CTAS : Display eReferral fields for WhDHB -->
var userHosp = GetCookieData("IBAUserHosp");
if (userHosp == "WHN" || userHosp == "MHW"){
                document.getElementById("lblComments").innerHTML = "eReferral ID";
                document.getElementById("lblEReferral").style.display = '';
                document.getElementById("chkEReferral").style.display = '';
} else{
                document.getElementById("chkEReferral").disabled = true;
}
</script>
