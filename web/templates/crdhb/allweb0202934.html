<meta name="TemplateVersion" content="V12.01.00">
<meta name="TemplateHome" content="crdhb">
<meta name="HelpFileName" content="NoContextSet.html">
<script language="javascript" src="../js/allweb02.js"></script>
<script language="javascript" src="../js/allweb0202.js"></script>
<script type="text/javascript" src="../js/OutpatientSelect.js"></script>
<script type="text/javascript" src="../js/OutpatientTypeClinic.js"></script>

<script type="text/javascript">
function upVals() {
	//today's date
	document.UpdateForm.alref094.value = document.UpdateForm.p_current.value;  
	//logged in user
	document.UpdateForm.alref086.value = document.UpdateForm.lnkdHCP.value;  
	clrVals();
}

function setDt() {
	document.UpdateForm.alref090.value = document.UpdateForm.p_current.value;
}

function UpdReferral(theForm){
	MandatoryOk=validateMandatory(document.UpdateForm)
  if (MandatoryOk) {
	//alert(document.UpdateForm.alref082.value);
	//alert(document.UpdateForm.alref094.value);
	//alert(document.UpdateForm.alref086.value);
   var ur = parent.document.PatientLinks.urnumber.value;
   var vis = parent.document.AddDocumentLink.admissno.value;
   var dept = parent.document.HiddenFields.refrdept.value;
    document.UpdateForm.redirect.value = "allweb02.pbl?reportno=2&template=2" + "&urnumber=+" + ur.replace(/ /g,"") +
    "&admissno=+" + vis.replace(/ /g,"") + "&deptcode=" + dept.replace(/ /g,"+");

  theForm.submit();
 }
}

function setRPPDate() {
	var done = document.UpdateForm.alref090.value;
	if (done != "") {
		var d = new Date(done);
		d.setDate(d.getDate()+92);
		var dy = (d.getDate() > 9) ? d.getDate().toString() : "0" + d.getDate().toString();
		var mth = ((d.getMonth()+1) > 9) ? (d.getMonth()+1).toString() : "0" + (d.getMonth()+1).toString();
		document.UpdateForm.alref096.value = (dy + mth + d.getFullYear().toString());
		var nDate = document.UpdateForm.alref096
		checkDate(nDate,'Date');	
	}
}

function SetSite() {
	var p=document.UpdateForm;
	var ssite;
	if (isWhitespace(p.alref119.value)) {
		ssite = p.wbsesite.value;
	} else {
		ssite = p.alref119.value;
	}
	for (var i =0 ; i < document.UpdateForm.alref119.length; i++) {
		if (document.UpdateForm.alref119.options[i].value==ssite.substr(0,6)) {
		   document.UpdateForm.alref119.selectedIndex=i 
		} 
	}
	SetList();
	selectCatCodInd(p.catAO,p.alref141,p.d_alref141,p.alref027,'1','1');
}

function SetList() {
  p=UpdateForm
  p.alref106.options.length=1;
  SetClinicType(p.alref106,p.defctype.value,p.alref119.value); 
//           
  SetList2();
} 
function SetList2() {
  p=UpdateForm
  p.alref120.options.length=1;
  SetTypeClinic(p.alref120,p.deftclid.value,p.alref119.value,p.alref106.value);
} 
function getTTime() {
	var now = document.UpdateForm.alref097.value
	if (now == "") {
		document.UpdateForm.alref097.value = document.UpdateForm.Ttime.value;
	}
}
function newRef() {
	var newRef = document.UpdateForm.newRef.value;
	if (newRef == "Yes") {
		document.UpdateForm.alref081.checked = true;
	} else {
		document.UpdateForm.alref081.checked = false;
	}
	clrVals();
}
function clrVals() {
	//document.UpdateForm.d_alref082.value = "";
	document.PatientLinks.onldDt.value = document.UpdateForm.alref090.value;
	document.PatientLinks.onlDt.value = document.UpdateForm.alref096.value;
}
function CheckPriority(el) {
   var elCode = el.value.substr(0,3);
   if ((elCode=="2  ")||(elCode=="3  ")||(elCode=="4  ")) {
      UpdateForm.alref127.className="";
      UpdateForm.alref084.className="";
   } else {
      UpdateForm.alref127.className="BackDate";
      UpdateForm.alref084.className="";
      UpdateForm.alref127.value = UpdateForm.alref039.value;
   
   }
   hideoutcomes();
}

function hideoutcomes(flag) {

document.UpdateForm.alref141.outerHTML = '<select name=alref141 class="select150" title="Outcome">' +
document.UpdateForm.outcomefld.innerHTML + 
'</select>';

var itemscount = UpdateForm.alref141.options.length - 1;
var countt=0;

var prioritylevel = 
	UpdateForm.alref027.options[UpdateForm.alref027.options.selectedIndex].value.substr(0,1);

	if (prioritylevel > 0) {
		for (i=itemscount; i>0; i--) {
			//alert(UpdateForm.otrfl019.options[i].value.substr(9,1) );
			if (UpdateForm.alref141.options[i].value.substr(9,1) != prioritylevel) {
				document.UpdateForm.alref141.options[i] = null;
			}
			else
			{
				countt=countt+1
			}
		}
		
		//UpdateForm.otrfl019.selectedIndex=1;		
	}
if(flag!="0")	//ie not on page load,when it is page load leve
				// the selected value as it is
{	

	if (countt==2)
	{
	UpdateForm.alref141.selectedIndex=2;
	}
	else
	{
	UpdateForm.alref141.selectedIndex=0;
	}
}
}

// 01 : CTAS : added function EnableDoneDate

// enable Date Recovery Plan Done if Has Recovery Plan been done? = Yes
function EnableDoneDate() {
	if (document.UpdateForm.alref068.value.substr(0,3) == "R00") {
		document.UpdateForm.alref090.disabled = false;		
		document.UpdateForm.alref090.className = "Mandatory PastDate";
		document.getElementById("stopwatch").style.display = "";
		document.getElementById("calendar").style.display = "";
	} else {
		document.UpdateForm.alref090.disabled = true;
		document.UpdateForm.alref090.className = "ReadOnly";
		document.getElementById("stopwatch").style.display = "none";
		document.getElementById("calendar").style.display = "none";		
	}
}
// end of change
</script>
</head>
%START.OF.PAGE
<body onload="PageLoad();EnableDoneDate();SetSite();getTTime();newRef
	upVals();hideoutcomes('0');FilterReferralSource(UpdateForm);">

<form name=UpdateForm onsubmit='return validateMandatory(this)' 
            action="allweb02.pbl" method=post>
<input type=hidden name=reportno value="2">
<input type=hidden name=updatety value="U">
<input type=hidden name=nextpage value="4">
<input type=hidden name=urnumber value="%ALLWEB02.02.003">
<input type=hidden name=admissno value="%ALLWEB02.02.081">
<input type=hidden name=deptcode value="%ALLWEB02.02.125.1">
<input type=hidden name=redirect value="">
<input type=hidden name=dummy>
<input type=hidden name=lnkdHCP value="%STANDARD.01.010">
<input type=hidden name=alref083 value="">
<input type=hidden name=ptcnueoc value="%ALLWEB02.02.503">
<input type=hidden name=wbsesite value="%STANDARD.01.023">
<input type=hidden name=hcpprovno value="%ALLWEB02.02.122.2">
<input type=hidden name=defctype value="%ALLWEB02.02.167.1">
<input type=hidden name=deftclid value="%ALLWEB02.02.188.1">
<input type=hidden name=override value="2">
<input type=hidden name=mehrflag value="1">
<input type=hidden name=pmpmi059 value="%ALLWEB02.02.684.001">
<input type=hidden name=pmpmi060 value="%ALLWEB02.02.685.001">
<input type=hidden name=pmpmi061 value="%ALLWEB02.02.661">
<input type=hidden name=catAO value="AO">
<input type=hidden name=Ttime value="%STANDARD.01.016">
<input type=hidden name=d_alref141 value="%ALLWEB02.02.199.012.1">
<input type=hidden name=prim value="%ALLWEB02.02.144">
<input type=hidden name=primNum value="%ALLWEB02.02.508">
<input type=hidden name=p_current value="%STANDARD.01.015">
<input type=hidden name=p_priority value="%ALLWEB02.02.127.1">
<input type=hidden name=p_outcome value="%ALLWEB02.02.199.012.1">
<input type=hidden name=alref092 value="%ALLWEB02.02.153">
<input type=hidden name=newRef value="%ALLWEB02.02.142">
<input type=hidden name=nowDate value="%STANDARD.01.015">
<input type=hidden name=DateOnly value="%STANDARD.01.014">
<input type=hidden size=8 name=alref137 value="%ALLWEB02.02.199.008">
<input type=hidden name=webuser value="%STANDARD.01.009">
<input type=hidden name=d_ostcatg id=d_ostcatg value="%ALLWEB02.02.529">
<input type=hidden name=d_depcod value="%ALLWEB02.02.125.3">

<span id="rpDates" >
<tr>
<span class=DFrameTitleBar>
	Update Recovery Plan Details
</span>
</tr>

<table cellspacing=0 cellpadding=2 border=0 width=95% align=center>
	<tr><td>&nbsp;</td><td></td><td></td><td></td></tr>
	
	<tr><td class=DataLabel>Has the Recovery Plan been done?</td>
		<td><select name=alref068 id=alref068 onchange="EnableDoneDate();"
			title="Has the Recovery Plan been done?">
			%ALLWEB02.02.140.29.2
			</select></td>
		<td></td><td></td></tr>	
	
	<tr><td class=DataLabel>Date Recovery Plan Done</td>
		<td><input type=text name=alref090 size=12 class="Mandatory PastDate"
			  value="" onblur="checkDate(this,'Date');setRPPDate();"
				title="Date Recovery Plan Done" tabindex=2>
			<img id="stopwatch" src=../images/DateTimeStamp.gif class=Icon alt="Current"
				onclick="setDt();setRPPDate();">
			<img id="calendar" src=../images/DateLookup.gif class=Icon alt="Show Calendar"
				date=UpdateForm.alref090>
        </td>
		<td class=DataLabel>Date Updated</td>
		<td><input type=text readonly class=Readonly name=alref094></td>
	</tr>
	
	<tr><td class=DataLabel>Recovery Plan Due</td>
		<td><input readonly class=Readonly name=alref096 size=12 class="Date"  
			value="%ALLWEB02.02.157" title="Date Recovery Plan Due" tabindex=3></td>
		<td class=DataLabel>Updated By (HCP code)</td>
		<td><input type=text readonly class=Readonly name=alref086></td>		
	</tr>
	
	<tr><td>&nbsp;</td><td></td><td></td><td></td></tr>
	<tr><td align=center colspan=4><input type=button name=formactn 
		value="Update" class=button tabindex=4 onclick="UpdReferral(UpdateForm);">
	</tr>	
</table>


<span id="insert" style="display:none">
    	<input type=text name=alref019 size=12 notab readonly
     onblur="checkDate(this,'Date')" value="%ALLWEB02.02.119"
     class="Readonly PastDate" title="Date of Referral">
    </td>
    <td class=DataLabel>Department Code</td>
    <td><input name=allrf001 type=text value="%ALLWEB02.02.125.0" readonly
         class=Readonly notab></td>
<td class=DataLabel>Date Letter Received</td>
	<td><input type=text size=10 name=alref039 notab 
              title="Date Letter Received" class="PastDate"
              value="%ALLWEB02.02.139" onBlur="checkDate(this,'Date')" >
         <img notab src=../images/CalendarLookup.gif border=0 hspace=4
          align=absmiddle onclick="DateLookupFrame(alref039);">     
          Time 
            <input type=text name=alref097 size=7 notab 
             value="%ALLWEB02.02.158" class="" title="Referral Time" 
             onBlur="checkTime(this,'Time');">
        <img notab src=../images/DateTimeStamp.gif border=0 hspace=4  class=icon
         align=absmiddle onClick="SetCurrentDateTime(alref039,alref097);">
       <img notab src=../images/TimeLookup.gif border=0 hspace=4 align=absmiddle
       onclick="TimeLookupFrame(alref097);" class=icon>
          </td>
    <td class=DataLabel>Link to Visit</td>
    <td><input type=text size=7 maxlength=8 name=alref005 notab
         value="%ALLWEB02.02.105"
         onblur="justifyRight(this);
                ValidateVisit(UpdateForm.alref005,UpdateForm.urnumber,dummy);" >
        <img src="../images/SearchIcon.gif" class=Icon
         onclick="VisitSearchFrame(UpdateForm.urnumber,UpdateForm.alref005);">
<td class=DataLabel>Referral Source</td>
    <td><select title="Referral Source" name=alref034 notab
         class="SelectBig" onchange="DisplayTrnSrc();HCPMand();">
        <option></option>
         %ALLWEB02.02.134.2
        </select>&nbsp;&nbsp;&nbsp;
  <img src=../images/HelpIcon.gif class=Icon onclick="AdmAlert();"></td></td>
    <td><div id=TranSrcHeading></div>
        <td><div id=TranSrc></div></td>
<td class=DataLabel width=10%>Referring HCP</td>
   <td width=40%><input type=text name=alref022 size=10 maxlength=10 tabindex=4
       value="%ALLWEB02.02.122.1" class=Mandatory title="Referring HCP"
       onchange="UpCase(this);
                 if (checkAlphanumDesc(event,this) != false) {
                   ReadDoc(18,0,alref022,n_alref022,alref023,n_alref023,
                           alref024,hcpprovno);
                 }">
       <input type=text name=n_alref022 size=30 readonly title="HCP Name"
        class=Readonly value="%ALLWEB02.02.122.0">
       <img src="../images/SearchIcon.gif" class=Icon
      onclick="GPHCPSearchFrame(alref022,n_alref022,hcpprovno,alref023,n_alref023,alref024,0);">
       <img src="../images/ClearIcon.gif" class=Icon
        onclick='clrFields(UpdateForm.alref022,UpdateForm.n_alref022,UpdateForm.hcpprovno);'>
    </td>
    <td class=DataLabel>Retain as Usual GP?</td>
    <td><input type=checkbox value="0" name=rusualgp notab
        title="Retain as Usual GP" onclick="UpdateGP();"></td>
<td class=DataLabel>HCP Practice</td>
    <td><input type=text size=10 class=readonly value="%ALLWEB02.02.123.0"
         title="HCP Practice" readonly notab name=alref023 notab>
        <input type=text size=30 class=readonly value="%ALLWEB02.02.123.1"
         title="Practice Name" readonly notab name=n_alref023>
        <input type=hidden name=alref024
         title="Practice Count" value="%ALLWEB02.02.124">
        <img src="../images/SearchIcon.gif" class=Icon
         onClick="GPHCGSearchFrame(alref022,n_alref022,hcpprovno,alref023,n_alref023,alref024)">
        <img src="../images/erase.gif" class=Icon 
		 onClick="clrFields(alref023,n_alref023,alref024,hcpprovno);"></td>
     <td class=DataLabel>Other HCP</td>
    <td><input type=text size=42 maxlength=60 name=alref089 value="%ALLWEB02.02.150" notab></td>
<td class=DataLabel>Inform GP</td> 
      <td><select name=pmsvx010>
         <option value="0">No</option>
         <option value="1">Yes</option>
        </select></td>
        <td>FSA Referral?</td>
   			<td><input type=checkbox name=alref081 value=1 notab></td>
<td class=DataLabel>%STANDARD.01.017.RI</td>
    <td><select name=alref124 title="%STANDARD.01.017.RI" notab
         class=>
        <option></option>
         %ALLWEB02.02.186.2
        </select>
    </td>
<td><script type="text/javascript">MRDescription()</script> Referral?</b></td>
   <td><input type=text name=d_alref083 class=Readonly
         value="%ALLWEB02.02.144" notab>
    </td>
<td class=DataLabel>Referral Reason 1</td>
    <td><select title="Problem 1" name=alref028 notab
         class="SelectBigE">
        <option></option>
         %ALLWEB02.02.128.2
        </select></td>
    <td class=DataLabel>Score</td>
    <td><input type=text name=alref143 title="Score" size=5 maxlength=5
         value="%ALLWEB02.02.199.014" notab></td>
<td class=DataLabel>Referral Reason 2</td>
    <td><select title="Problem 2" name=alref029 notab
         class="SelectBigE">
        <option></option>
         %ALLWEB02.02.129.2
        </select></td>
<td class=DataLabel>%ALLWEB02.02.199.011.8</td>
    <td><select title="%ALLWEB02.02.199.011.8" name=alref140 notab
         class="SelectBig">
        <option></option>
         %ALLWEB02.02.199.011.2
        </select></td>
<td class=DataLabel>Referral Reason 3</td>
    <td><select title="Problem 3" name=alref030 notab
         class="SelectBigE">
        <option></option>
         %ALLWEB02.02.130.2
        </select></td>
<td class=DataLabel>%STANDARD.01.017.CL</td>
    <td><select title="%STANDARD.01.017.CL" name=alref035 notab
         class="SelectBig">
        <option></option>
         %ALLWEB02.02.135.2
        </select></td>
<td class=DataLabel>Comments</td>
    <td><input type=text size=44 maxlength=60 name=alref088
         value="%ALLWEB02.02.149" notab></td>
    <td class=DataLabel>%ALLWEB02.02.199.013.8</td>
    <td><select title="%ALLWEB02.02.199.013.8" name=alref142 notab
         class="SelectBig">
        <option></option>
         %ALLWEB02.02.199.013.2
        </select></td>
<td colspan=4><hr></td>
<td class=DataLabel>Preferred Site</td>
    <td class=DataField><select name=alref119 title="Preferred Site"
      notab class="SelectBig" onchange="SetList();">
      <option></option>
      %ALLWEB02.02.182.2
    </select>
    </td>
    <td class=DataLabel>Priority</td>
    <td><select title="Priority" name=alref027 class="SelectBig" notab
       onchange="selectCatCodInd(catAO,alref141,d_alref141,alref027,'1','1');CheckPriority(this);" 
       onblur="hideoutcomes('1');">
        <option></option>
        %ALLWEB02.02.127.2
        </select></td>
<td class=DataLabel>Clinic Type </td>
    <td><select class=SelectBig name=alref106 maxlength=45 notab
         class="SelectBig" title="Clinic Type" onchange="SetList2();">
        <option></option>
        </select></td>
        <td class=DataLabel>%ALLWEB02.02.199.012.8</td>
    <td><select title="%ALLWEB02.02.199.012.8" name=alref141 notab
         class="SelectBig">
        <option></option>
        </select></td>
<td class=DataLabel>Clinic ID</td>
    <td><input name=temp3 type=text onFocus="select()" title="Clinic ID"
      onchange="UpCase(this); getDesc(this,document.UpdateForm.alref120);" 
      size=6 maxlength=9 value="%ALLWEB02.02.188.1" notab class="">
    <select class="SelectBig" name=alref120  title="Clinic ID Description"  
    	onchange="getCode(this,document.UpdateForm.temp3);" notab>
    <option></option>
  </select></td>
  <td>Date of Priority</td>
    <td><input type=text name=alref127 size=12 notab
         onblur="checkDate(this,'Date')" value="%ALLWEB02.02.194"
         title="Date of Priority" class="PastDate">
        <img src=../images/DateTimeStamp.gif class=Icon alt="Current"
         date=UpdateForm.alref127 time=null>
        <img src=../images/DateLookup.gif class=Icon alt="Show Calendar"
         date=UpdateForm.alref127></td>
<td class=DataLabel width=10%>Slot Type</td>
    <td><select name=alref117 class=SelectBig title="Slot Type" notab>
        <option></option>
         %ALLWEB02.02.180.2
        </select>
    </td>
    <td>Must Be Seen By</td>
    <td><input type=text name=alref126 size=12 notab
         onblur="checkDate(this,'Date')" value="%ALLWEB02.02.189"
         title="Must Be Seen By Date">
        <img src=../images/DateTimeStamp.gif class=Icon alt="Current"
         date=UpdateForm.alref126 time=null>
        <img src=../images/DateLookup.gif class=Icon alt="Show Calendar"
         date=UpdateForm.alref126></td>
         
<div id=InsertActive style="display:none;">
    <table align=center cellspacing=0 cellpadding=0 border=0 width=100%>
    <td class=DataLabel width=25%><b>Activate Referral</b></td>
    <td><input type=checkbox name=activref notab
         title="Activate Referral" value="1">
      </td>
    </table>
    </div></td>
             
</span>
<div id=hiddenspan name=hiddenspan style="display:none">
<select name=outcomefld class="select150"  title="Outcome">
   <option></option>
   %ALLWEB02.02.199.012.2 
</select>
</div>
</form>
<form name=PatientLinks method=get>
<input type=hidden name=reportno value=01>
<input type=hidden name=template value=002>
<input type=hidden name=urnumber value="%ALLWEB02.02.003">
<input type=hidden name=admissno value="%ALLWEB02.02.081">
<input type=hidden name=deptcode value="%ALLWEB02.02.125.1">
<!--Added refrlvis here-->
<input type=hidden name=refrlvis value="">
<!--End here-->
<input type=hidden name=bookflag value="">
<input type=hidden name=wbsesite value="%STANDARD.01.023">
<input type=hidden name=ibcnumci value="%STANDARD.01.025.000.132.0.1">
<input type=hidden name=d_alref083 value="%ALLWEB02.02.144">
<input type=hidden name=d_aldep017 value="%ALLWEB02.02.509">
<input type=hidden name=wbsedall value="%STANDARD.01.028">
<input type=hidden name=onldDt value="">
<input type=hidden name=onlDt value="">
</form>
<span id=transferhd style="display:none">
<td class=DataLabel>Transfer Source</td>
</tr>
</span>
<span id=transfersrc style="display:none">
<td><input type="text" size=7 maxlength=5 name=aldad001 class=""
	style="display:none"
      title="Transfer Source" notab value="%ALLWEB02.02.510.0"
      onchange="UpCase(this);validateCode(9,aldad001,trandesc);">
     <input type=text size=27 name=trandesc notab value="%ALLWEB02.02.510.1"
	 style="display:none" class=Readonly readonly>
     <img src="../images/SearchIcon.gif" style="display:none"
      onClick="TransferSourceFrame(aldad001,trandesc,alref034)"></td>
</tr>
</span>
