<meta name="TemplateVersion" content="V12.01.00">
<meta name="TemplateHome" content="crdhb">
<meta name="HelpFileName"    content="NoContextSet.html">
<!-- 01 : CTAS : link to ctascustom.js -->
<script type="text/javascript" src="../js/ctascustom.js"></script>
<!-- end of change -->
<script type="text/javascript">
function DefCons() {
 if(AddForm.pmbrq004.value.substr(5,1)!="D" &&
    !isWhitespace(AddForm.pmbrq004.value)) {
    AddForm.pmbrq005.value=trim(AddForm.defconcd.value);
    AddForm.n_pmbrq005.value=trim(AddForm.defconnm.value);
 } else {   
    //AddForm.pmbrq005.value="";
    //AddForm.n_pmbrq005.value="";
  }
}

// 01 : CTAS : set default values from ED if ED cookie exists
// homebuilt parser that works in all browsers ...
function ctasParse(str) {
	var arr = {};
	var inKey = true;
	var inValue = false;
	var keyValue = "";
	var valValue = "";
	var inToken = false;
	
	for (var i=0; i< str.length; i++) {
		var c = str.substr(i, 1);
		switch(c) {
			case '{':
				break;
			case '}':
				break;
			case '"':
				inToken = !inToken;
				break;
			case ':':
				inKey = false;
				inValue = true;
				break;
			case ',':
				if (!inToken) {
					arr[keyValue] = valValue;
					inKey = true;
					inValue = false;
					keyValue = "";
					valValue = "";
				} else {
					if (inKey) { keyValue += c; }
					if (inValue) { valValue += c; }
				}
				break;
			default:
				if (inKey) { keyValue += c; }
				if (inValue) { valValue += c; }
				break;
		}
	}
	arr[keyValue] = valValue;
	return arr;
}

// set default values on form...
function setDefaults() {
	var cid = getParameterByName("cid");
	if (cid != "") {
		var def = ctasParse(decodeURI(getCookie(cid)));
		var formelems = document.AddForm.elements;
		for (var key in def) {
			if (formelems.namedItem(key)) {
				if (formelems.namedItem(key).nodeName == 'SELECT') {
					var list = formelems.namedItem(key);
					vallen = def[key].length;
					for (i=0; i<list.length; i++) {
						if (list.options[i].value.substr(0, vallen) == def[key]) {
							list.selectedIndex = i;
						}
					}
				} else {
					formelems.namedItem(key).value = def[key];
				}
			}
		}
	}
}
// end of change
</script>
</head>
%START.OF.PAGE
<!-- 01 : CTAS : call setDefaults() - disabled 25/11/15
<body onload="PageLoad(event);DefCons();">
<body onload="PageLoad(event);DefCons();setDefaults();">
-->
<body onload="PageLoad(event);DefCons();">
<!-- end of change -->
<span class=DFrameTitleBar>
<img align="right" alt="Exit" class="MenuIcon" 
 src="../images/ExitIcon.gif" onclick="DFrameExitRefresh();">
<script type="text/javascript">document.write('Ward/Bed Request');</script>
</span>
<form name=AddForm method=post action=patweb10.pbl>
<input type=hidden name=reportno value="8">
<input type=hidden name=template value="002">
<input type=hidden name=updttype value="A">
<input type=hidden name=urnumber value="%PATWEB10.08.003">
<input type=hidden name=admissno value="%PATWEB10.08.081">
<input type=hidden name=pmbrq001 value="%PATWEB10.08.081">
<input type=hidden name=pmbrq007 value="1">
<input type=hidden name=defconcd value="%PATWEB10.08.126.1">
<input type=hidden name=defconnm value="%PATWEB10.08.126.0">
<input type=hidden name=ibcnmhos value="%STANDARD.01.025.000.043.1.1">

<table align=center width=100% border=0>
<tr><td class=DataLabel width=20%>Request Date</td>
    <td><input type=text size=12 name=pmbrq002 class="Mandatory Date" 
         title="Admission Date" value="%STANDARD.01.015">
        <img notab src=../images/DateLookup.gif border=0 hspace=4
         align=absmiddle onclick="DateLookupFrame(pmbrq002);">
         Time
        <input class=Mandatory type=text name=pmbrq003 size=8
         value="%STANDARD.01.016" title="Request Time">
        <img notab src=../images/DateTimeStamp.gif border=0 hspace=4
         align=absmiddle onClick="SetCurrentDateTime(pmbrq002,pmbrq003);">
        <img notab src=../images/TimeLookup.gif border=0 hspace=4
         align=absmiddle onclick="TimeLookupFrame(pmbrq003);">
    </td></tr>

<tr><td class=DataLabel>Requesting Department</td>
    <td><select name=pmbrq004 class=Mandatory title="Requesting Department"
         onchange="DefCons();">
        <option></option>
        %PATWEB10.08.104.9.1.02.2.R
        </select>
    </td></tr>

<tr><td class=DataLabel>Requesting Ward</td>
    <td><select name=pmbrq012 title="Requesting Ward">
        <option></option>
        %PATWEB10.08.127
        </select>
    </td></tr>

<tr><td class=DataLabel>Admitting Dr/Unit</td>
   <td><input type=text name=pmbrq005 size=10 maxlength=8
        title="Admitting Dr/Unit" value="%PATWEB10.08.325.0" class=Mandatory  
        onchange="UpCase(this); ValidateHCP(18,14,pmbrq005,n_pmbrq005);">
       <input type=text name=n_pmbrq005 size=35 readonly title="HCP Name"
        class=Readonly tabindex=-1 value="%PATWEB10.08.325.1">
       <img src="../images/SearchIcon.gif" class=Icon
        onclick="HCPSearchFrame(AddForm.pmbrq005,AddForm.n_pmbrq005,1);">
        <img src="../images/ClearIcon.gif" class=Icon
        onClick="clrFields(pmbrq005,n_pmbrq005);">
       </td></tr>

<!-- 01 : CTAS : Rename and shuffle fields
<tr><td class=DataLabel>Type of Bed Required</td>
    <td><select name=pmbrq006 class=Mandatory title="Type of Bed Required">
        <option></option>
        PATWEB10.08.106.9.1. 5.1.B
        </select>
    </td></tr>

<tr><td class=DataLabel>Speciality Bed Required</td>
    <td><select name=pmbrq013 title="Speciality Bed Required">
        <option></option>
        PATWEB10.08.128.2
        </select>
    </td></tr>
-->
<tr><td class=DataLabel>Admitting Specialty</td>
    <td><select name=pmbrq013 title="Admitting Specialty"
		class="Mandatory">
        <option></option>
        %PATWEB10.08.128.2
        </select>
    </td></tr>
<tr><td class=DataLabel>Type of Bed</td>
    <td><select name=pmbrq006 class=Mandatory title="Type of Bed">
        <option></option>
        %PATWEB10.08.106.9.1. 5.1.B
        </select>
    </td></tr>
<!-- end of change -->
</table>

<div id="Hospital"></div>

<table align=center width=100% border=0>
<tr><td class=DataLabel width=20%>Diagnosis</td>
    <td><input type=text size=12 maxlength=10 name=pmbrq008
         value="%PATWEB10.08.131.1"
     onchange="validateCode(6,AddForm.pmbrq008,AddForm.n_pmbrq008);">
    <input type=text name=n_pmbrq008 readonly class=Readonly size=50
     tabindex=-1 value="%PATWEB10.08.131.0">
    <img src=../images/SearchIcon.gif class=Icon
     onclick="Icd10DisSearchFrame(AddForm.pmbrq008,AddForm.n_pmbrq008);">
    <img src="../images/ClearIcon.gif" class=Icon
     onClick="clrFields(pmbrq008,n_pmbrq008);">
    </td></tr>

<tr><td class=DataLabel valign=top>Notes</td>
    <td>
    <textarea name=bedrqcom wrap=hard rows=5 cols=70></textarea>
    </td></tr>

</table>

<table align=center width=100% border=0>
<tr><td align=center><br>
   <input type=button value="Add" class="button" 
    id="pat10sub" onclick="tempDisable(this);SubmitForm();">
   <input type=button value=Close class="button" onclick=DFrameCloseRefresh()>
</td></tr>
</table>
</form>

<span id="ShowHospital" style="display: none">
<table align=center width=100% border=0>
<tr><td class=DataLabel width=20%>Preferred Hospital</td>
    <td><select name=pmbrq014 class=Mandatory title="Preferred Hospital">
        <option></option>
        %PATWEB10.08.129.1
        </select>
    </td></tr>
</table>
</span> 

<script type="text/javascript">
if(document.AddForm.ibcnmhos.value=="1") {
  document.getElementById('Hospital').innerHTML=ShowHospital.innerHTML
  document.getElementById('Hospital').style.display="";
  PatientSex="%PATWEB89.01.086.082";
  for(var i =0 ; i < document.AddForm.pmbrq014.length; i++) {
  if (document.AddForm.pmbrq014.options[i].value=="%STANDARD.01.032") {
       document.AddForm.pmbrq014.selectedIndex=i } };
}
</script>
