<meta name="TemplateVersion" content="V12.01.00">
<meta name="TemplateHome" content="crdhb">
<meta name="HelpFileName"    content="NoContextSet.html">
<script type="text/javascript">
function SummaryPage() {
  CaseList=GetContentCookie("CasePath");
//alert(CaseList.substr(CaseList.search("sesskeys"),30));
  if (CaseList=="unknown") {
    location.href="oprweb01.pbl?reportno=03&template=003" +
                  "&sesskeys=" + PatientLinks.sesskeys.value
  }
  else {
    if (CaseList.search("sesskeys") != -1 &&
        PatientLinks.sesskeys.value ==
        CaseList.substr(CaseList.search("sesskeys"),30)) {
      location.href=CaseList
    } else {
      location.href="oprweb01.pbl?reportno=03&template=003" +
                    "&sesskeys=" + PatientLinks.sesskeys.value;
    }
	}
}

/* 01 : CTAS : add button functions:  CheckIn, PtIntoTheatre, Theatre,
		Labels, Forms, LabelsForms, PACU, DSUPostOp, UnplannedReturn,  
		StaffDetails, PatientCaseSummary,
		ChangeTheatre, TransferBooking, CancelBooking, EnableButtons,
		CheckTheatreMsg */
function CheckIn() {
    linkurl="oprweb01.pbl?reportno=4&template=003&casekeys="+
    PatientLinks.casekeys.value;
    Left=(document.body.clientWidth-650)/2
    DFrameLink(linkurl,100,Left,650,300)	
}

function CheckTheatreMsg() {
	if (document.PatientLinks.opard041.value == "        ") {
		ans = confirm("Is this patient in the correct theatre?\n"
			+"Click OK to continue or Cancel to change theatre.");
		if (ans) { PtIntoTheatre(); }
		else { ChangeTheatre(); }
	} else {
		PtIntoTheatre();
	}
}

function PtIntoTheatre() {
    linkurl="oprweb01.pbl?reportno=4&template=004&casekeys="+
    PatientLinks.casekeys.value;
    Left=(document.body.clientWidth-650)/2
    DFrameLink(linkurl,100,Left,650,300)
}

function Theatre() {
/*    linkurl="oprweb06.pbl?reportno=1&template=991&casekeys="+
    PatientLinks.casekeys.value;
    Left=(document.body.clientWidth-650)/2
    DFrameLink(linkurl,-5,Left,650,550)	*/
	
	/* linkurl="oprweb06.pbl?reportno=1&template=001&casekeys="+
    PatientLinks.casekeys.value;
    Left=(document.body.clientWidth-750)/2
    DFrameLink(linkurl,-5,Left,750,650) */
	
	//PatientLinkTo("oprweb06.pbl",1,1,0,0,0);
	// CTAS : 05 : Increase window size 
	
	linkurl="oprweb06.pbl?reportno=1&template=001&casekeys="+
    PatientLinks.casekeys.value;
    Left=(document.body.clientWidth-950)/2;
    DFrameLink(linkurl,-5,Left,950,625);	
}

/* 03 Increase size of window */
function LabelsForms(templateno) {
	var ur = document.PatientLinks.urnumber.value;
	var ad = document.PatientLinks.admissno.value;
	var mt = document.PatientLinks.MenuType.value;
  linkUrl="patweb98.pbl?reportno=01&template=" +
		  templateno +
          "&urnumber=" + ur.replace(/ /g,"+") +
          "&admissno=" + ad.replace(/ /g,"+") +
          "&MenuType=" + mt.replace(/ /g,"+"); 
  Left=(document.body.clientWidth-390)/2
  DFrameLink(linkUrl,130,Left,390,222)
}

function Labels() {
	LabelsForms("008");
}

function Forms() {
	LabelsForms("011");
}

function PACU() {
	// 01 : CTAS : Validate button click
	if(checkTheatreFields()) {
	// end of change
    linkurl="oprweb06.pbl?reportno=10&template=901&casekeys="+
    PatientLinks.casekeys.value;
    Left=(document.body.clientWidth-950)/2;
    DFrameLink(linkurl,0,Left,950,300);
	// 01 : CTAS : Validate button click
	}
	// end of change
}

function DSUPostOp() {
	// 01 : CTAS : Validate button click
	if(checkTheatreFields()) {
	// end of change
    linkurl="oprweb06.pbl?reportno=10&template=902&casekeys="+
    PatientLinks.casekeys.value;
    Left=(document.body.clientWidth-950)/2;
    DFrameLink(linkurl,0,Left,950,300);
	// 01 : CTAS : Validate button click
	}
	// end of change
}

function UnplannedReturn() {
	// 01 : CTAS : Validate button click
	if(checkTheatreFields()) {
	// end of change
    linkurl="oprweb06.pbl?reportno=10&template=903&casekeys="+
    PatientLinks.casekeys.value;
    Left=(document.body.clientWidth-450)/2;
    DFrameLink(linkurl,0,Left,450,300);
	// 01 : CTAS : Validate button click
	}
	// end of change
}

function StaffDetails() {
	//PatientLinkTo("oprweb06.pbl",1,4,0,0,0);
	PatientLinkTo("oprweb06.pbl",1,901,0,0,0);
}

function ChangeTheatre() {
linkurl="oprweb01.pbl?reportno=4&template=014&casekeys="
         +PatientLinks.casekeys.value; 
  // 01 : CTAS : Adjust screen size
  // Left=(document.body.clientWidth-350)/2
  // DFrameLink(linkurl,100,Left,350,180)
  Left=(document.body.clientWidth-500)/2
  DFrameLink(linkurl,100,Left,500,500)
  // end of change
}

function PatientCaseSummary() {
	PatientLinkTo("oprweb01.pbl",4,912,0,0,0);
}

function TransferBooking() {
    linkurl="oprweb01.pbl?reportno=11&template=002&casekeys="+
    PatientLinks.casekeys.value;
	// 01 : CTAS : Adjust screen size
	// Left=(document.body.clientWidth-550)/2
    // DFrameLink(linkurl,100,Left,550,200)
	Left=(document.body.clientWidth-750)/2;
    DFrameLink(linkurl,100,Left,750,300);
	// end of change
}

function CancelBooking() {
    linkurl="oprweb01.pbl?reportno=8&template=001&casekeys="+
    PatientLinks.casekeys.value;
	// 01 : CTAS : Adjust screen size
    // Left=(document.body.clientWidth-550)/2
    // DFrameLink(linkurl,100,Left,550,180)
	Left=(document.body.clientWidth-600)/2
    DFrameLink(linkurl,100,Left,600,400)
	// end of change
}

function EnableButtons() {
	// enable Pt Into Theatre if pt arrived and not in recovery
	if (trim(document.PatientLinks.arrivaltime.value) != "" && 
		trim(document.PatientLinks.recoveryin.value) == "") {
		document.all.btnPtIntoTheatre.disabled = false;
	}
	// enable theatre details and cancel booking if 
	//	pt started anaesthetic and not in recovery
	if (trim(document.PatientLinks.anaestart.value) != "" && 
		trim(document.PatientLinks.recoveryin.value) == "") {
		document.all.btnTheatre.disabled = false;
		document.all.btnCancelBooking.disabled = false;	
		document.all.btnStaffDetails.disabled = false;
	}
	// disable change theatre, cancel booking and 
	//	transfer booking if surgery started
	if (trim(document.PatientLinks.surgstart.value) != "") {
		document.all.btnChangeTheatre.disabled = true;
		document.all.btnCancelBooking.disabled = true;
		document.all.btnTransferBooking.disabled = true;
	}
	// enable recovery if surgery started and anaesthetic ended
	/* 01 : CTAS : Enable fields
	if (trim(document.PatientLinks.surgstart.value) != "" && 
		trim(document.PatientLinks.ptlefttheatre.value) != "") {
		document.all.btnPACU.disabled = false;
		document.all.btnDSUPostOp.disabled = false;
		document.all.btnUnplannedReturn.disabled = false;
	}
	*/
		document.all.btnPACU.disabled = false;
		document.all.btnDSUPostOp.disabled = false;
		document.all.btnUnplannedReturn.disabled = false;
	// end of change
		
	// disable check in, pt into theatre, and theatre details
	//	if pt in recovery
	if (trim(document.PatientLinks.recoveryin.value) != "") {
		document.all.btnCheckIn.disabled = true;
		document.all.btnPtIntoTheatre.disabled = true;
		document.all.btnTheatre.disabled = true;
	}
}
// end of change
// 01 : CTAS : New validation for PACU, DSU, Unplanned Return buttons
// 06 : CTAS : Allow validation bypass if case is abandoned.
function checkTheatreFields() {

	var surgstart = document.PatientLinks.surgstart.value;
	var surgend = document.PatientLinks.surgend.value;
	var ptlefttheatre = document.PatientLinks.ptlefttheatre.value;
	var opsrg010 = document.PatientLinks.opsrg010.value;
	var origproc = document.PatientLinks.origproc.value;
	var caseabdn = document.PatientLinks.opsrg074.value;

	if((!trim(surgstart) || !trim(surgend) || !trim(ptlefttheatre) || 
		!trim(opsrg010) || !trim(origproc)) && (caseabdn != "Yes")) {
		alert("Please populate/review the values in Theatre.\n"  +
				"1. Surgery Start - " + checkField(surgstart) + "\n" +
				"2. Surgery End - " + checkField(surgend) + "\n" +
				"3. Patient Left Theatre - " + checkField(ptlefttheatre) + "\n" +
				"4. Patient Transferred To - " + checkField(opsrg010) + "\n" +
				"5. Original Procedure done - " + checkField(origproc) +
		"");
		
		return false;
	}
	return true;
}

function checkField(field) {
	if(!trim(field)) {
		return "Required";
	} else {
		return field;
	}
}
// end of change
// 04 : TAS : Merge Task 0863964
function DisplayPreadmNotes() {
  if (document.PatientLinks.bkreproc && !isWhitespace(document.PatientLinks.bkreproc.value)) {
    document.getElementById('prenotesdet').style.display = "";
  } else {
    document.getElementById('prenotesdet').style.display = "none";
  }
}
</script>
</head>
%START.OF.PAGE
<!-- 04 :TAS Merge Task 0863964 -add DisplayPreadmNotes() -->
<body onload="PageLoad(event);EnableButtons();DisplayPreadmNotes();">
<div id=PatientHeading></div>
<script type="text/javascript">
PatientURN="%OPRWEB01.04.003";
PatientVIS="%OPRWEB01.04.081";
PatientNAM="%OPRWEB01.04.002";
PatientSTA="%OPRWEB01.04.086.078";
PatientALT="%OPRWEB01.04.084";
PatientSEX="%OPRWEB01.04.019";
PatientDOB="%OPRWEB01.04.020";
PatientAGE="%OPRWEB01.04.021";
PatientLOC="%OPRWEB01.04.083";
PatientPRI="%OPRWEB01.04.086.066.1";
PatientUNT="%OPRWEB01.04.066.0";
DoctorCOD="%OPRWEB01.04.082.003";
DoctorNAM="%OPRWEB01.04.082.002";
PatientAID="%OPRWEB01.04.086.090";
PatientIND="%OPRWEB01.04.086.091";
PatientCUR="%OPRWEB01.04.086.092";
PatientCLC="%OPRWEB01.04.086.093.1";
PatientCLH="%STANDARD.01.017.CL";
PatientHFT="%OPRWEB01.04.086.094";
PatientCDM="%OPRWEB01.04.086.095";
PatientVDH="%OPRWEB01.04.086.099.015";
InsertPatientHeader()
</script>
<div id=PatientMenu></div>

<div id=PageBodySection>
<table border=1 width=100% cellspacing=0>
<tr><td>
<table border="0" cellpadding="2" cellspacing="0" width="100%" >
<tr><td class=HeadingCell align=left>
    <img src=../images/ListIcon.gif class=Icon onclick='SummaryPage();'></td>
<!-- 01 : CTAS : rename screen as Peri-operative Details
    <td colspan=4 align=center class=HeadingCell>
    Theatre Case Summary</td>
-->
    <td colspan=4 align=center class=HeadingCell>
    Peri-Operative Details</td>
<!-- end of change -->
<td class=HeadingCell align=right><font color=red>
      %OPRWEB01.04.601</font></td></tr>
<tr><td width=15% class=DataLabel>Surgeon   </td>
    <td class=DataField>
    <a href='javascript:DoctorViewFrame("%OPRWEB01.04.304.003")'>
    %OPRWEB01.04.304.002 </a></td>
    <td class=DataLabel>Operating Surgeon</td>
    <td class=DataField>
    <a href='javascript:DoctorViewFrame("%OPRWEB01.04.604.003")'>
    %OPRWEB01.04.604.002 </a></td></tr>
<tr><td width=15% class=DataLabel>Anaesthetist   </td>
    <td class=DataField>
    <a href='javascript:DoctorViewFrame("%OPRWEB01.04.316.003")'>
    %OPRWEB01.04.316.002 </a></td>
    <td class=DataLabel>Admitting Point</td>
    <td class=DataField>%OPRWEB01.04.503.0 </td></tr>
<tr><td class=DataLabel>Unit</td>
    <td class=DataField>%OPRWEB01.04.313.0 </td>
    <td class=DataLAbel>Session Type</td>
    <td class=DataField>%OPRWEB01.04.369.0</td>
<tr><td class=DataLabel>Theatre</td>
    <td class=DataField>%OPRWEB01.04.314.0</td>
    <td class=DataLabel>Actual Theatre</td>
    <td class=DataField>%OPRWEB01.04.130</td>
<tr><td class=DataLabel>Date </td>
    <td class=DataField>%OPRWEB01.04.306 %OPRWEB01.04.302</td>
    <td class=DataLAbel>Time </td>
    <td class=DataField>%OPRWEB01.04.303 to %OPRWEB01.04.308 </td>
<tr><td class=DataLabel>Pre-Assessment</td>
    <td class=DataField>%OPRWEB01.04.208      %OPRWEB01.04.209</td>
    <td class=DataLAbel>Scheduled Admission</td>
    <td class=DataField>%OPRWEB01.04.206 Time %OPRWEB01.04.207</td>
<tr><td class=DataLabel>Exp.Post Op Ward</td>
    <td class=DataField>%OPRWEB01.04.186.0</td>
    <td class=DataLabel>Planned Length of Stay</td>
    <td class=DataField>%OPRWEB01.04.230 </td>
<tr><td class=DataLabel>%STANDARD.01.017.P </td>
    <td class=DataField>%OPRWEB01.04.187.0 </td>
    <td class=DataLabel>Admission Source  </td>
    <td class=DataField>%OPRWEB01.04.531.0 </td>
<tr><td class=DataLabel>%STANDARD.01.017.CL</td>
    <td class=DataField>%OPRWEB01.04.188.0 </td>
    <td class=DataLabel>Transfer Source</td>
    <td class=DataField>%OPRWEB01.04.610.093.1</td>
    </tr>
<tr><td class=DataLabel>&nbsp;</td>
    <td class=DataField>&nbsp;</td>
    <td class=DataLabel>Duration</td>
    <td class=DataField>%OPRWEB01.04.112 min</td>
<tr><td class=DataLabel>Anaesthetic Type</td>
    <td class=DataField>%OPRWEB01.04.113.0 </td>
<!-- 01 : CTAS : remove fields 
    <td class=DataLabel>Blood Type</td>
    <td class=DataField>OPRWEB01.04.532.0</td>
-->
<!-- end of change -->

<tr><td class=DataLabel>Procedure</td>
    <td class=DataField>%OPRWEB01.04.166.0</td>
<!-- 01 : CTAS : remove Infection Status and Blood Type fields 
    <td class=DataLabel>Infection Status</td>
    <td class=DataField>OPRWEB01.04.140.0</td>
-->
	<td></td><td></td></tr>
<!-- end of change -->
<tr><td class=DataLabel></td>
    <td class=DataField>%OPRWEB01.04.122.0</td>
    <td class=DataLabel>Equipment Required 1</td>
    <td class=DataField>%OPRWEB01.04.145.0</td>
<tr><td class=DataLabel></td>
    <td class=DataField>%OPRWEB01.04.123.0</td>
    <td class=DataLabel>Equipment Required 2</td>
    <td class=DataField>%OPRWEB01.04.146.0</td>
<tr><td class=DataLabel>Full Description</td>
<!--
    <td class=DataField>%OPRWEB01.04.516</td>
  -->
    <td class=DataField>%OPRWEB01.04.151</td>
<!-- 01 : CTAS : remove fields
    <td class=DataLabel>Equipment Required 3</td>
    <td class=DataField>OPRWEB01.04.149.0</td>
-->
    <td class=DataLabel>Equipment Loaned</td>
    <td class=DataField>%OPRWEB01.04.147.0</td></tr>
<!-- end of change -->
<tr><td class=DataLabel></td>
<!--
    <td class=DataField>%OPRWEB01.04.517</td>
  -->
    <td class=DataField>%OPRWEB01.04.152</td>
<!-- 01 : CTAS : remove fields
    <td class=DataLabel>Equipment Loaned</td>
    <td class=DataField>OPRWEB01.04.147.0</td>
-->
	<td></td><td></td></tr>
<!-- end of change -->
<tr><td class=DataLabel></td>
    <td class=DataField>%OPRWEB01.04.518</td>
<tr><td class=DataLabel>Prosthesis Required</td>
    <td class=DataField>%OPRWEB01.04.128</td>
    <td class=DataLabel>Cancellation Reason</td>
    <td class=DataField>%OPRWEB01.04.603.0</td></tr>
<!-- 01 : CTAS :
<tr><td class=DataLabel>Comments</td>
    <td colspan=4 class=DataField>OPRWEB01.04.143.011</td>
	</tr>
-->
<tr><td class=DataLabel>Comments</td>
    <td class=DataField width=35%>%OPRWEB01.04.143.011</td>
	<td colspan=2></td>
</tr>
<!-- end of change -->
<!-- 04 :TAS Merge Task 0863964 Add new field-->
<tr id=prenotesdet><td class=DataLabel>Waiting List Pre-admission Notes</td>
    <td colspan=4 class=DataField>%OPRWEB01.04.631</td
<!-- End of change -->
<!-- 01 : CTAS : add BMI score
<tr><td class=DataLabel></td>
    <td class=DataField></td>
-->
<tr><td class=DataLabel>Patient BMI</td>
    <td class=DataField>%OPRWEB01.04.086.099.038</td>
<!-- end of change -->
    <td class=DataLabel>Theatre Booking Date Created</td>
    <td class=DataField>%OPRWEB01.04.158</td></tr>
<tr><td class=DataLabel></td>
    <td class=DataField></td>
    <td class=DataLabel>Theatre Booking Time Created</td>
    <td class=DataField>%OPRWEB01.04.159</td></tr>
<tr><td class=DataLabel></td>
    <td class=DataField></td>
    <td class=DataLabel>Theatre Booking Created By</td>
    <td class=DataField>%OPRWEB01.04.160</td></tr>
<tr><td class=DataLabel></td>
    <td class=DataField></td>
    <td class=DataLabel>Theatre Booking Date Last Modified</td>
    <td class=DataField>%OPRWEB01.04.161</td></tr>
<tr><td class=DataLabel></td>
    <td class=DataField></td>
    <td class=DataLabel>Theatre Booking Time Last Modified</td>
    <td class=DataField>%OPRWEB01.04.162</td></tr>
<tr><td class=DataLabel></td>
    <td class=DataField></td>
    <td class=DataLabel>Theatre Booking Last Modified By</td>
    <td class=DataField>%OPRWEB01.04.163</td></tr>
</table>
</td></tr>
</table>

<!-- 01 : CTAS : remove existing button set 
<table border="0" cellpadding="0" cellspacing="0" width="100%" >
<tr><td>&nbsp;</td><td>&nbsp;</td></tr>
<tr><td width=25%>
    <td><input type=button value="Theatre Times" class="button"
         onclick=PatientLinkTo("oprweb01.pbl",4,12,0,0,0)>
    <td><input type=button value="Staff Details" class="button"
         onclick=PatientLinkTo("oprweb06.pbl",1,4,0,0,0)>
    </td></tr>
</table>
-->
<!-- end of change -->

<!-- 01 : CTAS : add new button set -->
<table border="0" cellpadding="1" cellspacing="0" width="100%" align="center">
<tr>
	<td colspan=3 align=center>
		<input class=button type=button value="Check In" 
			onclick="CheckIn();" name="btnCheckIn">
		<input class=bigbutton type=button disabled name="btnPtIntoTheatre"
			value="Patient Into Theatre" onclick="CheckTheatreMsg();">
		<input class=button type=button disabled value="Theatre" 
			onclick="Theatre();" name="btnTheatre">
    </td>
    <td colspan=2 align=center>
    	<input class=button type=button name="Labels" value="Labels" 
			onclick="Labels();">
    	<input class=button type=button name="Labels" value="Forms" 
			onclick="Forms();">
    </td>
    <td colspan=3 align=center>
	    <input class=button type=button disabled value="PACU" 
			onclick="PACU();" name="btnPACU">
		<input class=button type=button disabled value="DSU Post-Op" 
			onclick="DSUPostOp();" name="btnDSUPostOp">
		<input class=bigbutton type=button disabled value="Unplanned Return" 
			onclick="UnplannedReturn();" name="btnUnplannedReturn">
    </td>
</tr>
<tr>
	<td colspan=4 align=center>
		<input class=bigbutton type=button disabled value="Staff Details" 
			onclick="StaffDetails();" name="btnStaffDetails">
		<input class=bigbutton type=button value="Patient Case Summary" 
			onclick="PatientCaseSummary();" name="btnPatientCaseSummary">
    </td>
    <td colspan=4 align=center>
	    <input type=button value="Change Theatre" 
			class=bigbutton onclick="ChangeTheatre();" name="btnChangeTheatre">
	    <input type=button value="Transfer Booking" 
			class=bigbutton onclick="TransferBooking();" name="btnTransferBooking">
	    <input type=button value="Cancel Booking" 
	    class=bigbutton onclick="CancelBooking();" name="btnCancelBooking">	
	    <input type=button value="Update Acute Booking" 
	    class=bigbutton onclick="UpdateABooking();" name="btnUpdateABooking"
	    style="display:none;">	
</td>
</tr>
</table>
<!-- end of change -->

<form name=PatientLinks method=get>
<input type=hidden name=reportno value=1>
<input type=hidden name=template value=004>
<input type=hidden name=urnumber value="%OPRWEB01.04.003">
<input type=hidden name=admissno value="%OPRWEB01.04.081">
<input type=hidden name=casekeys value="%OPRWEB01.04.101">
<input type=hidden name=MenuType value="%OPRWEB01.04.088">
<input type=hidden name=bkrec021 value="%OPRWEB01.04.066.1">
<input type=hidden name=sesskeys value="%OPRWEB01.04.301">
<input type=hidden name=bkreproc value="%OPRWEB01.04.217"

<!-- 01 : CTAS : add additional data values to PatientLinks form -->
<input type=hidden name=arrivaltime value="%OPRWEB01.04.402">
<input type=hidden name=anaestart value="%OPRWEB01.04.442">
<input type=hidden name=surgstart value="%OPRWEB01.04.705">
<input type=hidden name=surgend value="%OPRWEB01.04.706">
<!-- 01 : CTAS : replace prep start with pt out of theatre (783) -->
<!--<input type=hidden name=anaeend value="OPRWEB01.04.703">-->
<input type=hidden name=ptlefttheatre value="%OPRWEB01.04.783">
<!-- end of change -->
<input type=hidden name=recoveryin value="%OPRWEB01.04.471">
<input type=hidden name=opard041 value="%OPRWEB01.04.441">
<!-- end of change -->
<!-- 01 : CTAS : add additional fields -->
<!-- Patient Transferred To -->
<input type=hidden name=opsrg010 value="%OPRWEB01.04.710.0">
<!-- Original Procedure Done -->
<input type=hidden name=origproc value="%OPRWEB01.04.776">
<!-- end of change -->
<!-- 06 : CTAS : Add case abandoned variable -->
<input type=hidden name=opsrg074 value="%OPRWEB01.04.774">
</form>
