<meta name="TemplateVersion" content="V12.01.00">
<meta name="TemplateHome" content="crdhb">
<meta name="HelpFileName" content="NoContextSet.html">
<script language="javascript" src="../js/allweb03.js"></script>
<script type="text/javascript">
function AddEncounter(theForm,Redirect){
// 06 : TAS : Merge code from Task 0894672
SuppressUpdPage="";
  if(parent.document.getElementById("bulkelst")) {
    if(parent.document.getElementById("bulkelst").value=="1") {
      SuppressUpdPage=document.AddForm.deptlcod.value.substr(11,1); // Ind 9 = X
    }
  }
  if(Redirect=="Y") {
    if(SuppressUpdPage == "X") {
      SetCookie("allweb0305005","1","10");
      document.AddForm.redirect.value=parent.location.href;
      document.AddForm.nextpage.value="6";
    } else {
      document.AddForm.redirect.value="allweb03.pbl?reportno=1&template=3";
      document.AddForm.nextpage.value="1";
    }
  } else {
     ExpireCookiePath("allweb0305005");
// 06 : End of Change	 
     document.AddForm.redirect.value=parent.location.href;
     document.AddForm.nextpage.value="6";
  }
  DFrameClear();
  if (validateMandatory(theForm)) {
//
    if(theForm.checkbx2.checked==true) {
      if(!CheckFutureBookings(theForm.admissno,theForm.alenc005)) {
        return;
      }
    }
//
    if(theForm.checkappt.value==0 &&
      theForm.checkbx2.checked==true) {
      CheckLinkedBookings(theForm.admissno,theForm.urnumber,theForm.checkappt)
      if(theForm.checkappt.value==0) {
        return;
      }
    }
	// 01 : CTAS : automatically set Contact Time upon submit
	// 04 : TAS : Reverse change
	// SetCurrentDateTime(null,document.AddForm.alenc006);
	// end of change
    theForm.target="PopUpFrame1"
    theForm.submit();
  }
}
function PostParent() {
   document.AddForm.checkappt.value=1;
   AddEncounter(AddForm);
}

function populateFieldsFromRefCL()
{
  var patcodesCL = document.getElementById("deftclmc");
  var patcodesCLCollection = document.getElementById("alenc115");
  patcodesCLCollection.selectedIndex=0;
  for(var i = 0; i < patcodesCLCollection.length; i++)
  {
    var code = patcodesCLCollection[i].value.substr(0,3);

    if(code == patcodesCL.value)
    {
       patcodesCLCollection.selectedIndex = i;
       return;
    }
  }
}

function populateFieldsFromRefPR()
{
  var patcodesHP = document.getElementById("deftpurc");
  var patcodesHPCollection = document.getElementById("alenc120");
  patcodesHPCollection.selectedIndex = 0;
  for(var i = 0; i < patcodesHPCollection.length; i++)
  {
    var code = patcodesHPCollection[i].value.substr(0,3);

    if(code == patcodesHP.value)
    {
       patcodesHPCollection.selectedIndex = i;
       return;
    }
  }
}

function populateFieldsFromRefgb()
{
  var patcodes_gb = document.getElementById("deftcont");
  var patcodes_gbCollection = document.getElementById("alenc121");
  patcodes_gbCollection.selectedIndex = 0;
  for(var i = 0; i < patcodes_gbCollection.length; i++)
  {
    var code = patcodes_gbCollection[i].value.substr(0,3);

    if(code == patcodes_gb.value)
    {
       patcodes_gbCollection.selectedIndex = i;
       return;
    }
  }
}

//------------------------------------------------------------------------
// Function : Referral Number Search Frame
//------------------------------------------------------------------------
function RefSearchFrame(ReturnRefe,ReturnName,ReturnName1) {
  DFrameStart();
  window.ReturnFunction="";
  window.ReturnRefe=ReturnRefe ;
  window.ReturnName=ReturnName ;
  window.ReturnName1=ReturnName1 ;
//
  if (RefSearchFrame.arguments.length > 2) {
    window.ReturnFunction=RefSearchFrame.arguments[3] }
//
  document.getElementById('PopUpFrame').src="../lookups/RefSearchFrame.html"
  SearchFrameShow();
}
//-------------------------------------------------------------------------
function ToggleCombo(){
  if(AddForm.checkbx2.checked==false){
    AddForm.checkbx1.disabled=false;
    AddForm.checkbx2.value=0;
    AddForm.alref006.className="";
    AddForm.alref006.disabled=true;
    CloseReason.style.display='none';
    AddForm.alref072.className="";
    AddForm.alref072.disabled=true;
  } else{
    AddForm.checkbx1.disabled=true; // disable Waiting List
    AddForm.checkbx1.checked=false;
    AddForm.alref006.className="SelectBig Mandatory";//make the class mandatory 
    AddForm.alref006.disabled=false;
    AddForm.checkbx2.value=1;
    CloseReason.style.display='';
    AddForm.alref072.className="SelectBig Mandatory";//make the class mandatory 
    AddForm.alref072.disabled=false;
  }
}
function ShowHideWaitingList(){
 if(document.AddForm.status.value=="0") {
   Wait.style.display='';
 } else {
   Wait.style.display='none';}
// 06 : Merge Task 0894672
LastContact(document.AddForm.status.value); //T0868976
 
}
//T0868976-Start
function LastContact(status){
 if (status==2){
   document.getElementById('checkbx2').disabled=true
   document.getElementById('checkbx2').checked=false;
 }
 else {
   document.getElementById('checkbx2').disabled=false;
 }
 ToggleCombo();
}
//T0868976-End
// 06: End of Change
function Val() {
  t=AddForm
  CheckReferral(9,t.admissno,t.deptcode,t.patname,t.alenc008,t.deftclmc,t.deftclin,t.status,t.dummy1,t.deftcont,t.deftpurc)
  ShowHideWaitingList();
  populateFieldsFromRefCL(); 
  populateFieldsFromRefgb();
  populateFieldsFromRefPR();
}
function LoadSearch() {
  VisitSearchFrameAll(AddForm.urnumber,AddForm.admissno);
}
function CheckAddHCP() {
  if(document.AddForm.addithcp.checked==true) {
     AdditionalHCP.style.display="";
     AdditionalHCP.innerHTML=ShowAdditionalHCP.innerHTML;
  } else {
     AdditionalHCP.innerHTML="";
     AdditionalHCP.style.display="none";
  }
}
function CheckURNumber(){
  if(document.AddForm.urnumber.value==""){
     alert("Please input a valid Patient NHI before searching for ACC Number");
     return false;
  }
  else{
     lookUpWC(document.AddForm); 
  }
}
// 06 :Merge task 0894672
function DefContactDate() {
 if(SetDateYYYYMMDD(document.AddForm.alenc005.value) >
    SetDateYYYYMMDD(document.AddForm.currdate.value)) {
    document.AddForm.alenc005.value=document.AddForm.currdate.value;
  }
}
</script>
</head>

%START.OF.PAGE
<!-- 06 : Merge Task 0894672 - Add Val and DefContactDate -->
<body onload="PageLoad(event);
              ListOptionsCatLD(AddForm.deptlcod,AddForm.alenc007);Val();
              DefContactDate();">
<span class=DFrameTitleBar>
<img align="right" alt="Exit" class="MenuIcon"
 src="../images/ExitIcon.gif" onclick="DFrameExitRefresh();">
 %ALLWEB03.05.018 Contact
</span>
<div id=PageBodySection>
<form name=AddForm action="allweb03.pbl" method=post>
<input type=hidden name=reportno value=1>
<input type=hidden name=updatety value="A">
<input type=hidden name=alenc004 id=alenc004 value="%ALLWEB03.05.032.0">
<input type=hidden name=deptcode id=deptcode value="%ALLWEB03.05.017">
<input type=hidden name=flag value="%ALLWEB03.05.022">
<input type=hidden name=deftclmc id=deftclmc>
<input type=hidden name=deftcont id=deftcont>
<input type=hidden name=deftclin id=deftclin>
<input type=hidden name=deftpurc id=deftpurc>
<input type=hidden name=status value="">
<input type=hidden name=dummyret value="">
<input type=hidden name=dummysit value="">
<input type=hidden name=dummydat value="">
<input type=hidden name=dummy1 id=dummy1>
<input type=hidden name=mbs value="M">
<input type=hidden name=checkappt value="0">
<input type=hidden name=redirect  value="">
<input type=hidden name=nextpage  value="">
<input type=hidden name=admnsrce id=admnsrce value="">
<input type=hidden name=desttype id=desttype value="">
<input type=hidden name=deptlcod value="%ALLWEB03.05.601.3">
<!-- 06 : Merge Task 0894672 -->
<input type=hidden name=autocprf id=autocprf value="2">
<input type=hidden name=currdate value="%STANDARD.01.015">
<!-- 06 : End of change -->

<table align=center cellspacing=0 cellpadding=1 border=0 width=95%>
<tr><td class=DataLabel width=15%> Department </td>
    <td width=38%>
      <input type=text name=department size=40 class=Readonly readonly  
       title="Department" value="%ALLWEB03.05.018" tabindex=1>
    </td>
</tr>

<tr><td class=DataLabel width=15%>Health Care Provider</td>
    <td colspan=3><input type=text name=SProvider size=40 
       class=Readonly readonly title="Health Care Provider" 
       tabindex=2 value="%ALLWEB03.05.019"> <td></tr>

<!-- 03 : TAS : Restore contact time date field no longer readonly -->
<tr><td class=DataLabel width=15%>Contact Date</td>
    <td width=38%>
<!-- 05 : TAS : Change contact time variable (previous val: %STANDARD.01.015) -->
      <input type=text name=alenc005 value='%ALLWEB03.05.016' title="Date"
	   tabindex=3
       class='PastDate Mandatory' Size=9 onblur="checkDate(this,'Date')">
      <img src=../images/DateLookup.gif border=0 hspace=4
       align=absmiddle onclick="DateLookupFrame(alenc005);">
   <!-- 01 : CTAS : Remove Contact Time -->
    Time
   <input type=text size=8 value="" class=Mandatory title="Time"
     tabindex=4 name=alenc006>
    <img src=../images/DateTimeStamp.gif  border=0 align=absmiddle
    onclick='SetCurrentDateTime(null,AddForm.alenc006)'>
    <img src=../images/TimeLookup.gif border=0 align=absmiddle
    onclick='TimeLookupFrame(AddForm.alenc006)'>
   </td></tr>
   <!--end of change -->
	
<tr><td class=DataLabel>Patient NHI</td>
    <td colspan=3><input type=text name=urnumber size=10 maxlength=8 
         class=Mandatory id=urnumber
         title="Patient NHI" onchange="UpCase(this); justifyRight(this); 
                 validateCode(8,AddForm.urnumber,AddForm.patname,LoadSearch);">
        <input type=text name=patname id=patname size=30 readonly class=Readonly>
        <input type=hidden name=dummy>
        <img src="../images/SearchIcon.gif" class=Icon
         onclick="PatientSearchFrame(AddForm.patname,
                        AddForm.urnumber,AddForm.dummy,LoadSearch);">
        <img src="../images/ClearIcon.gif" class=Icon
        onclick="clrFields(urnumber,patname,admissno);LastContact('0');">
        <img src="../images/ViewIcon1.gif" class=Icon
         alt="Waiting/Active Referrals by Department and HCP"
        onclick="WaitActiveRefList(deptcode,alenc004,urnumber,admissno,Val);">
    </td></tr>

<tr><td class=DataLabel width=15%>Referral Number</td>
    <td class=DataField colspan=3>
	<!-- 06 Merge Task 0870341 -->
    <input type=text size=10 class=Mandatory title="Referral Number" 
    name=admissno id=admissno maxLength=8 tabindex=6
 	onblur="justifyRight(this);Val();">
<!-- T0868976 - replaced with Val();
    onblur="justifyRight(this);
   CheckReferral(9,admissno,deptcode,patname,alenc008,deftclmc,deftclin,status,dummy1,deftcont,deftpurc);
    ShowHideWaitingList();populateFieldsFromRefCL(); populateFieldsFromRefgb();
    populateFieldsFromRefPR();"> -->
<!-- 06: End of Change -->
    <img src=../images/SearchIcon.gif class=Icon tabindex=-1
     onclick="LoadSearch();">
    <img src="../images/ClearIcon.gif" class=Icon
     onclick="clrFields(admissno);LastContact('0');">
     </td></tr>

<tr>
<td class=DataLabel width=15%>Activity</td>
    <td width=40%><select class="Mandatory SelectBig" name=alenc010 
                   tabindex=7 title="Activity">
    <option></option>
     %ALLWEB03.05.020.0
    </select></td>
    <td class=DataLable width=15%>Linked Visit</td>
    <td class=DataField colspan=3>
      <input type=text size=10 name=alenc008 value="" maxlength=8
		tabindex=14
         onblur="justifyRight(this);
                 ValidateVisit(AddForm.alenc008,AddForm.urnumber,dummy1);"> 
    <img src=../images/SearchIcon.gif class=Icon tabindex=-1
     onclick=VisitSearchFrame(urnumber,alenc008) >
    <img src="../images/ClearIcon.gif" class=Icon tabindex=-1
     onclick="clrFields(alenc008);">
     </td></tr>

<!-- service setting, direct minutes -->
<tr>
	<td class=DataLabel>%ALLWEB03.05.207.8</td>
    <td><select class="Mandatory SelectBig" tabindex=7
         name=alenc007  title="%ALLWEB03.05.207.8">
    <option></option>
    %ALLWEB03.05.207.4
    </select></td>
    <td class=DataLabel>Direct Minutes</td>
    <td class=DataField>
    <input type=text size=12 maxsize=5 name=alenc011 title="Direct Minutes" 
     min=0 tabindex=15
    onblur=checkInteger(this,this.title)></td>
</tr>

<!-- type of contact, indirect minutes -->
<tr>
	<td class=DataLabel>%STANDARD.01.017.za</td>
    <input type=hidden name=alenc009 value="">
    <td><select class="SelectBig" name=alenc047
         tabindex=8 title="%STANDARD.01.017.za">
        <option></option>
        %ALLWEB03.05.247. 1.4
        </select></td>
    <td class=DataLabel>Indirect Minutes</td>
    <td class=DataField>
    <input type=text size=12 maxsize=5 name=alenc013 title="Indirect Minutes"
     tabindex=16 min=0 onblur=checkInteger(this,this.title)></td></tr>

<!-- claim type, mileage -->
<tr>
	<td class=DataLabel>%ALLWEB03.05.135.8</td>
    <td><select class="Mandatory SelectBig" tabindex=9
         name=alenc115 id=alenc115 title="%ALLWEB03.05.135.8">
    <option></option>
    %ALLWEB03.05.135.4
	</td>
    <td class=DataLabel>Mileage</td>
    <td class=DataField>
    <input type=text size=12 maxsize=5 name=alenc098 title="Mileage"
		tabindex=17
     min=0 onblur=checkInteger(this,this.title)></td></tr>

<!-- health purchaser, travel time -->
<tr>
	<td class=DataLabel>%ALLWEB03.05.199.011.8</td>
    <td><select class="SelectBig" tabindex=10
         name=alenc120 id=alenc120 title="%ALLWEB03.05.199.011.8">
    <option></option>
    %ALLWEB03.05.199.011.4
    </select></td>
	<td class=DataLabel>Travel Time</td>
    <td class=DataField>
    <input type=text size=12 maxsize=5 name=alenc097 title="Travel" min=0
		tabindex=18
    onblur=checkInteger(this,this.title)></td>
</tr>

<!-- contract -->
<tr>
    <td class=DataLabel>%ALLWEB03.05.199.013.8</td>
    <td><select class="SelectBig" tabindex=11
         name=alenc121 id=alenc121 title="%ALLWEB03.05.199.013.8">
    <option></option>
    %ALLWEB03.05.529
    </select></td>
	<td colspan=2></td>
    </tr>
</table>

<div id="Wait" style="display:none;">
<table align=center cellspacing=0 cellpadding=1 border=0 width=95%>
<tr><td class=DataLabel width=15%>Stay as Waiting Referral</td>
    <td class=DataField>
    <input type=checkbox name=checkbx1 value="1"></td>
    <td></td>
    <td></td>
    </tr>
</table>
</div>

<table align=center cellspacing=0 cellpadding=1 border=0 width=95%>
<tr><td class=DataLabel width=15%>Outcome</td>
    <td class=DataField width=38%>
      <select name=outbb035 id=outbb035 title="Outcome" class="SelectBig"
       onchange="OutcomeChange(this);" tabindex=12>
        <option></option>
        %STANDARD.01.007.OZ
      </select>
    </td>
    <td width=15%><div id=divTransDestLbl></div></td>
    <td><div id=divTransDestFld></div></td>
</tr>
</table>

<table align=center cellspacing=0 cellpadding=1 border=0 width=95%>
<!-- <tr><td class=DataLabel width=15%>Last Contact ?</td>
    <td class=DataField>
    <Input type=checkbox name=checkbx2 value=0 tabindex=13 onclick=ToggleCombo() >
    </td></tr> -->
<tr><td class=DataLabel width=15%>Last Contact ?</td>
    <td class=DataField width=38%>
    <input type=checkbox width=15% name=checkbx2 value=0 
	tabindex=13 onclick="ToggleCombo()">
    </td>
<!--    <td class=DataLabel width=15%>ACC Number</td>
    <td><input type=text name=alenc128 value="" tabindex=19>
    <img src=../images/SearchIcon.gif class=Icon onclick="CheckURNumber();">
</td> -->
	<td></td>
    <td></td>
</tr>
</table>
<!-- 06 Merge Task 0870341 -->
<table align=center cellspacing=0 cellpadding=1 border=0 width=95%>
<tr><td class=DataLabel width=15%>Additional HCP</td>
    <td><input type=checkbox name=addithcp value="1"
         onclick="CheckAddHCP();"></td>
    </tr>
</table>
<!-- End of Change -->
<div id=AdditionalHCP></div>

<span id=CloseReason style="display: none">
<table align=center cellspacing=0 cellpadding=1 border=0 width=95%>
<tr><td class=DataLabel width=15%>Reason for Closure </td>
    <td class=DataField>
    <select  name=alref006 title="Reason For Closure" class="" disabled>
    <option></option>
     %ALLWEB03.05.015.2
    </select>
    </td></tr>
<tr><td class=DataLabel width=15%>Referral To</td>
    <td class=DataField colspan=3>
    <select name=alref072 title="Referral To" class="">
    <option></option>
    %STANDARD.01.007.lG
    </select></td></tr>
<tr><td class=DataLabel width=15%>Date of Next Review</td>
    <td class=DataField colspan=3>
      <input type=text name=alref037 title="Date of Next Review"
       Size=12 onblur="checkDate(this,'Date of Next Review')">
    <a href='javascript:SetCurrentDateTime(AddForm.alref037)'>
    <img src=../images/DateTimeStamp.gif  border=0 hspace=4 align=absmiddle></a>
      <img src=../images/DateLookup.gif border=0 hspace=4
       align=absmiddle onclick="DateLookupFrame(alref037);">
</td></tr>
</table>
</span>

<!-- 03 : TAS : Reverse functions of add and add and finish -->
<!-- 06 : Merge Task 0870341 - Superseeds TAS 03

<table align=center cellspacing=0 cellpadding=1 border=0 width=95%>
<tr><td align=center><br>
    <input type=button name=formactn value="Add" class="button" 
     id=all03sub1 tabindex=20
     onclick="tempDisable(this);AddEncounter(AddForm,'N');">
    <input type=button name=formactn value="Add and Finish" class="button" 
     id=all03sub tabindex=21
     onclick="tempDisable(this);AddEncounter(AddForm,'Y');">
    <input type=button Value="Cancel" class="button" tabindex=22
     onclick="DFrameCloseRefresh();">
    </td>
</tr>
</table> -->
<table align=center cellspacing=0 cellpadding=1 border=0 width=95%>
<tr><td align=center><br>
    <input type=button name=formactn value="Add" class="button" 
     id=all03sub1
     onclick="tempDisable(this);AddEncounter(AddForm,'Y');">
    <input type=button name=formactn value="Add and Finish" class="button" 
     id=all03sub
     onclick="tempDisable(this);AddEncounter(AddForm,'N');">
																		   
							
															
    <input type=button Value="Cancel" class="button" 
     onclick="DFrameCloseRefresh();">
    </td>
</tr>
</table>
</form>
</div>

<span id="ShowAdditionalHCP" style="display:none;">
<table align=center cellspacing=0 cellpadding=1 border=0 width=95%>
<tr><td class=DataLabel width=15%>Additional HCP 1</td>
    <td><input type=text name=alenc025 size=10 maxlength=10
         title="Additional HCP 1"
         onblur="ValidateHCP(18,0,alenc025,d_alenc025);">
        <input type=text name=d_alenc025 size=20 class=Readonly readonly
         title="Additional HCP 1">
        <img src=../images/SearchIcon.gif class=Icon
         onclick=HCPSearchFrame(alenc025,d_alenc025,0) >
        <img src="../images/ClearIcon.gif" class=Icon
         onclick="clrFields(alenc025,d_alenc025);">
    </td>
    <td class=DataLabel width=15%>Additional HCP 2</td>
    <td><input type=text name=alenc026 size=10 maxlength=10
         title="Additional HCP 2"
         onblur="ValidateHCP(18,0,alenc026,d_alenc026);">
        <input type=text name=d_alenc026 size=20 class=Readonly readonly
         title="Additional HCP 2">
        <img src=../images/SearchIcon.gif class=Icon
         onclick=HCPSearchFrame(alenc026,d_alenc026,0) >
        <img src="../images/ClearIcon.gif" class=Icon
         onclick="clrFields(alenc026,d_alenc026);">
    </td></tr>

<tr><td class=DataLabel width=15%>Additional HCP 3</td>
    <td><input type=text name=alenc027 size=10 maxlength=10
         title="Additional HCP 3"
         onblur="ValidateHCP(18,0,alenc027,d_alenc027);">
        <input type=text name=d_alenc027 size=20 class=Readonly readonly
         title="Additional HCP 3">
        <img src=../images/SearchIcon.gif class=Icon
         onclick=HCPSearchFrame(alenc027,d_alenc027,0) >
        <img src="../images/ClearIcon.gif" class=Icon
         onclick="clrFields(alenc027,d_alenc027);">
    </td>
    <td class=DataLabel width=15%>Additional HCP 4</td>
    <td><input type=text name=alenc028 size=10 maxlength=10
         title="Additional HCP 4"
         onblur="ValidateHCP(18,0,alenc028,d_alenc028);">
        <input type=text name=d_alenc028 size=20 class=Readonly readonly
         title="Additional HCP 4">
        <img src=../images/SearchIcon.gif class=Icon
         onclick=HCPSearchFrame(alenc028,d_alenc028,0) >
        <img src="../images/ClearIcon.gif" class=Icon
         onclick="clrFields(alenc028,d_alenc028);">
    </td></tr>
</table>
</span>

<span id=spTransDest style="display:none">
   <input type="text" size=7 maxlength=5 name=trnsfsrc id=trnsfsrc
    class=Mandatory title="Transfer Destination"
    onblur="validateTransSrc(trnsfsrc,dummy1,trandesc,desttype);">
   <input type=text size=27 name=trandesc id=trandesc notab
    class=Readonly readonly>
   <img src="../images/SearchIcon.gif" class=Icon
    onclick="TransferSourceFrameOutcome2(trnsfsrc,trandesc,admnsrce);">
</span>

<span id=transferblank style="display:none">
   <input type=hidden name=trnsfsrc id=trnsfsrc>
</span>
