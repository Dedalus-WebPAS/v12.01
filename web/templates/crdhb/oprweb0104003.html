<meta name="TemplateVersion" content="V12.01.00">
<meta name="TemplateHome" content="crdhb">
<meta name="HelpFileName"    content="NoContextSet.html">
<script type="text/javascript" src="../js/oprweb01.js"></script>
<!-- 01 : CTAS : Add link to custom-js -->
<script type="text/javascript" src="../js/ctascustom.js"></script>
<!-- end of change -->
<script type="text/javascript" >
%START.OF.PAGE
// 01 : CTAS : For RFD check
var REASON_IND = 21;          // Cat of Indicator 21
var REASON_IND_ENABLE = "1";  // Cat of indicator
// end of change

function validateNurse() {
  var hcpnurse = chkHcpOTNurse();
  if (hcpnurse==true){
     validateCode('18',document.arrivalForm.opard003,
                       document.arrivalForm.name_opard003);
  }
  else {
     validateCode('17',document.arrivalForm.opard003,
                       document.arrivalForm.name_opard003,
                       document.arrivalForm.gnm,
                       SetNurseName);
  }
}
function SetNurseName() {
arrivalForm.name_opard003.value=arrivalForm.gnm.value.replace(/\s*$/g,"")+
                              " " +
                            arrivalForm.name_opard003.value.replace(/\s*$/g,"")
}

function ChkDelay() {
// 01 : CTAS : add check for null Time Called For to ChkDelay()
//if(arrivalForm.opard002.value === "")
// return;
if ((arrivalForm.opard002.value === "")
	||(arrivalForm.opard039.value === ""))
 return;
// end of change

var TimeCald=trim(arrivalForm.opard039.value.replace(/:/g,""))
var ArrvTime=trim(arrivalForm.opard002.value.replace(/:/g,""))
TimeCald=TimeCald.substr(0,4)
ArrvTime=ArrvTime.substr(0,4)
TimeCald=TimeCald - 0;
ArrvTime=ArrvTime - 0;
if(TimeCald>ArrvTime) {
  if (confirm("Time Called for cannot be after the Arrival Time." +
     "\n Do you want to override")) {

     ArrvTime = ArrvTime + 2400;

  } else {
    arrivalForm.opard002.value="";
    return;
  }
}
var MaxDelay=(parseInt(TimeCald) + parseInt(arrivalForm.mindelay.value))
var Minutes=parseInt(MaxDelay) % 100
var Hour=parseInt(MaxDelay) / 100
if (Minutes>=60) {
   Minutes=Minutes - 60
   Hour=parseInt(Hour) + 1
   MaxDelay = (Hour*100) + Minutes
}
// 01 : CTAS : remove references to unused fields
/*
//alert(MaxDelay+" "+ArrvTime);
if (MaxDelay < ArrvTime) {
   arrivalForm.opard004.className="Mandatory"
   }
else {
   arrivalForm.opard004.className=""
   }
*/
// end of change 
}

function ChkArrv() {
  if(arrivalForm.opard039.value === "")
     return;

  if(!isWhitespace(arrivalForm.opard002.value)) {
    var TimeCald=trim(arrivalForm.opard039.value.replace(/:/g,""))
    var ArrvTime=trim(arrivalForm.opard002.value.replace(/:/g,""))
    TimeCald=TimeCald - 0;
    ArrvTime=ArrvTime - 0;
    if(TimeCald>ArrvTime) {
      if (confirm("Time Called for cannot be after the Arrival Time." +
         "\n Do you want to override")) {
        return;
       }
       arrivalForm.opard002.value="";
       arrivalForm.opard039.value="";
       return;
      }
   }
}

// 01 : CTAS : add getPreOpChecklist() to set form variable for submission
function getPreOpChecklist() {
	if (document.arrivalForm.checkl05[0].checked)
		document.arrivalForm.opard005.value = "1";
	else
		document.arrivalForm.opard005.value = "0";
}
// end of change

function formSubmit(){
// 01 : CTAS : call getPreOpChecklist() in formSubmit instead of setCGI()
//   setCGI(arrivalForm);
	getPreOpChecklist();
// end of change
   anTime=arrivalForm.anaesTime.value.replace(/:/g,"");
   arTime=arrivalForm.opard002.value.replace(/:/g,"")

   if(!ChkDateTime(arrivalForm.admsdate,arrivalForm.admstime,arrivalForm.opsedate,arrivalForm.opard002)) {
     ans = confirm("Arrival time must be equal to or greater than the admission time\n" + 
                   "Do you want to override?");
     if(!ans){
        return;
     }
   }

   if(!isWhitespace(anTime)){
    if(arTime > anTime){
      if(!confirm("Arrival time should be less than Anaesthetic time " +
                  arrivalForm.anaesTime.value + "\n Do you want to override?")) {
         return;
      }
     }
   }
   if(validateMandatory(arrivalForm))
       arrivalForm.submit();
}

// 01 : CTAS : add setPreOpChecklist() to set radio button
function setPreOpChecklist() {
	document.arrivalForm.checkl05[0].checked 
		= (document.arrivalForm.opard005.value == "Yes");
	document.arrivalForm.checkl05[1].checked 
		= (document.arrivalForm.opard005.value != "Yes");		
}
// end of change
// 01 : CTAS : add function to enable reason delay fields
function enableReasonDelayFields() {
	var enableReasonDelay = getIndicatorValue(document.arrivalForm.opard019, REASON_IND);
	if (enableReasonDelay == REASON_IND_ENABLE) {
		document.arrivalForm.opard023.disabled=false;
		document.arrivalForm.opard014.disabled=false;
	} else {
		document.arrivalForm.opard023.disabled=true;
		document.arrivalForm.opard014.disabled=true;
	}
}
// end of change

//C-0825792 - Check Use pmshcpaf/oprnuraf for OT Nurse
function chkHcpOTNurse(){
  if (document.getElementById('opcnurse')) {
      if (document.getElementById('opcnurse').value == "1") {
        return true;
      }
      else {
        return false;
      }
  }
  else {
      return false;
  }
}

//C-0825792 - Search Nurse from pmshcpaf/oprnuraf for OT Nurse
function SearchOTNurse(NurseId,ReturnNurseName) {
  var hcpnurse = chkHcpOTNurse();
  if (hcpnurse==true){
     HCPSearchFrame(NurseId,ReturnNurseName,20);
  }
  else {
     NurseSearchFrame(NurseId,ReturnNurseName);
  }
}
</script>
<script>
function TimeCheck(){

  var fieldElement;
  var theatreDate = "%OPRWEB01.04.301".slice(3,8);
  var fieldName = "timecheck%STANDARD.01.044.113.064.002".replace(" ", "0");

  try{
    if(!this.event.srcElement.value){
      return;
    }
    if(this.event.srcElement.id!=fieldName){
      return;
    }
    if(!Get("discdate").value){
      return;
    }
    fieldElement = Get(fieldName);
    var dateArray = Get("discdate").value.split(" ");
    var monthNumber = new Date(Date.parse(dateArray[1] +" 1, 2012")).getMonth()+1;
    var monthString = monthNumber<10? "0" + monthNumber : "" + monthNumber
    var dDate = dateArray[2] + monthString + dateArray[0];
    if(theatreDate + fieldElement.value > dDate+Get("disctime").value){
       alert(fieldElement.title + " cannot be after the discharge date.");
       fieldElement.value = "";
       fieldElement.focus();
    }
  }catch(e){}
}
function Get(el){return document.getElementById(el);}
</script>
</head>

<!-- 01 : CTAS : remove setRadio() call in body.onload and call setPreOpChecklist()
<body onload="PageLoad(event);setRadio(arrivalForm)">
-->
<body onload="PageLoad(event);setPreOpChecklist();enableReasonDelayFields();">
<!-- end of change -->
<span class=DFrameTitleBar>
<img align="right" alt="Exit" class="MenuIcon" 
 src="../images/ExitIcon.gif" onclick="DFrameExit();">
 <!-- 01 : CTAS : rename screen as Patient Check In Details
Theatre Case Arrival Details
-->
Patient Check In Details
<!-- end of change -->
</span>

<table border="0" cellpadding="2" cellspacing="0" width="100%" >
<form name=arrivalForm method=get action=oprweb01.pbl 
onSubmit="setCGI(arrivalForm);return validateMandatory(this);">
<input type=hidden name=reportno value=5>
<input type=hidden name=template value=003>
<input type=hidden name=updttype value="U">
<input type=hidden name=urnumber value="%OPRWEB01.04.003">
<input type=hidden name=admissno value="%OPRWEB01.04.081">
<input type=hidden name=anaesTime value="%OPRWEB01.04.442">
<input type=hidden name=mindelay value="%OPRWEB01.04.602">
<input type=hidden name=casekeys value="%OPRWEB01.04.101">
<input type=hidden name=gnm id=gnm>
 
<!-- dont change order of hidden parameters opard005-12. it will adversely 
  affect java script functions setCGI() and setRadio() -->
<input type=hidden name=opard005 value="%OPRWEB01.04.405">
<input type=hidden name=opard006 value="%OPRWEB01.04.406">
<input type=hidden name=opard007 value="%OPRWEB01.04.407">
<input type=hidden name=opard008 value="%OPRWEB01.04.408">
<input type=hidden name=opard009 value="%OPRWEB01.04.409">
<input type=hidden name=opard010 value="%OPRWEB01.04.410">
<input type=hidden name=opard011 value="%OPRWEB01.04.411">
<input type=hidden name=opard012 value="%OPRWEB01.04.412">
<input type=hidden name=opsedate value="%OPRWEB01.04.302">
<input type=hidden name=admsdate value="%OPRWEB01.04.610.002">
<input type=hidden name=admstime value="%OPRWEB01.04.610.003">
<input type=hidden name=currdate value="%STANDARD.01.013">
<input type=hidden name=currtime value="">
<input type=hidden name=opcnurse id=opcnurse
       value="%STANDARD.01.025.113.051.0.1">
<input type=hidden name="discdate" id="discdate" value="%OPRWEB01.04.629">
<input type=hidden name="disctime" id="disctime" value="%OPRWEB01.04.630">

<!-- 02 : TAS : WP2-3830 - Theatre check in screen requires date field -->
<tr>
	<td class=DataLabel>Date of Surgery</td>
	<td class=DataField>
	<input type=text name=opard030 size=8 value="%OPRWEB01.04.430"
		class='PastDate' title="Date of Surgery">
	<img notab src=../images/DateLookup.gif border=0 hspace=4 
	align=absmiddle onclick="DateLookupFrame(opard030);">
    </td>
</tr>
<!-- End of Change -->
<tr>
	<td class=DataLabel><label for=timecheck01>Time Called For</label></td>
<!-- 01 : CTAS : Time Called For not mandatory
	<td class=DataField>
		<input type=text name=opard039 size=8 id=timecheck01 value="%OPRWEB01.04.439" 
		 title="Time Called For" class=Mandatory onblur="checkTime(this);ChkDelay();ChkArrv();
		 CheckFutureTime(arrivalForm,document.arrivalForm.opsedate.value,opard039);TimeCheck()">

-->
	<td class=DataField>
    <input type=text name=opard039 size=8 id=timecheck01 value="%OPRWEB01.04.439" 
     title="Time Called For" onblur="checkTime(this);ChkDelay();ChkArrv();
     CheckFutureTime(arrivalForm,document.arrivalForm.opsedate.value,opard039);TimeCheck()">
<!-- end of change -->
    <img src="../images/DateTimeStamp.gif" onClick="SetCurrentDateTime(null,opard039);">
    <img src=../images/TimeLookup.gif border=0 hspace=4 align=absmiddle
     onclick="TimeLookupFrame(opard039);">
    </td>
<!-- 01 : CTAS : rename Time of Arrival as Time Checked In
  <td class=DataLabel>Time of Arrival</td>
  <td class=DataField>
    <input type=text name=opard002 size=8 id=timecheck02 value="OPRWEB01.04.402" 
     title="Time of Arrival" class=Mandatory onblur="checkTime(this);ChkDelay();
     CheckFutureTime(arrivalForm,document.arrivalForm.opsedate.value,opard002);TimeCheck()">
    <img src="../images/DateTimeStamp.gif" onClick="SetCurrentDateTime(null,opard002);">
    <img src=../images/TimeLookup.gif border=0 hspace=4 align=absmiddle onclick="TimeLookupFrame(opard002);">
  </td>
-->
</tr>
<tr>
	<td class=DataLabel><label for=timecheck02>Time Checked In</label></td>
    <td class=DataField>
	<input type=text name=opard002 size=8 id=timecheck02 value="%OPRWEB01.04.402" 
	  title="Time Checked In" class=Mandatory onblur="checkTime(this);ChkDelay();
	  CheckFutureTime(arrivalForm,document.arrivalForm.opsedate.value,opard002);TimeCheck()">
      <img src="../images/DateTimeStamp.gif" onClick="SetCurrentDateTime(null,opard002);">
      <img src=../images/TimeLookup.gif border=0 hspace=4 align=absmiddle onclick="TimeLookupFrame(opard002);">
    </td>
</tr>
<!-- end of change -->
	
<!-- 01 : CTAS : move Admitting Nurse and add Admitting Point -->
<tr>
    <td class=DataLabel><label for=opard003>Admitting Nurse</label></td>
    <td class=DataField>
    <input type=text name=opard003 id=opard003 title="Admitting Nurse" size=6 
      class="DataField Mandatory"  maxlength=6 value="%OPRWEB01.04.403.1" 
     onblur=validateNurse()>
    <input type=text name=name_opard003 title="Nurse" class=ReadOnly readonly
     class=DataField size=22 maxlength=30 value="%OPRWEB01.04.403.0"
	 id=name_opard003>
    <img src="../images/SearchIcon.gif" align=absmiddle
     onClick="NurseSearchFrame(opard003,name_opard003);">
    </td>
</tr>
<tr>
	<td class=DataLabel><label for=opard020>Admitting Point</label></td>
	<td class=DataField>
   <select name=opard020 id=opard020 title="Admitting Point" 
      class="selectBig Mandatory">
    <option></option>
    %OPRWEB01.04.420.2
    </select>
    </td>	
</tr>
<!-- end of change -->

<!-- 01 : CTAS : add Patient Ready for Theatre -->
<tr><td class=DataLabel><label for=opard019>
	Patient Ready For Theatre</label></td>
    <td class=DataField>
		<!-- 01 : CTAS : Add call to enableReasonDelayFields()
       <select name=opard019 id=opard019 title="Patient Ready For Theatre" 
          class="selectBig">
		 -->
		<select name=opard019 id=opard019 title="Patient Ready For Theatre" 
        class="selectBig" onchange="enableReasonDelayFields();">
		<!-- end of change -->
    <option></option>
    %OPRWEB01.04.419.2
    </select></td>
</tr>
<!-- end of change -->

<!-- 01 : CTAS : add Reason for Delay 1 and 2 -->
<tr>
<td class=DataLabel><label for=opard023>Reason For Delay 1</label></td>
<td class=DataField>
   <select name=opard023 title="Reason For Delay 1" 
	id=opard023 class=selectBig>
    <option></option>
    %OPRWEB01.04.423.2
    </select>
    </td>
</tr>
<tr>
   <td class=DataLabel><label for=opard014>Reason For Delay 2</label></td>
<td class=DataField>
   <select name=opard014 id=opard014 title="Reason For Delay 2"
   class=selectBig>
    <option></option>
    %OPRWEB01.04.414.2
    </select>
    </td>
</tr>
<!-- end of change -->

<tr><td class=DataLabel>Pre-op Check List Complete</td>
    <td class=DataField>
    <input type=radio name=checkl05 id=checkl05Y value="Yes">
		<label for=checkl05Y>Yes</label>
    <input type=radio name=checkl05 id=checkl05N value="No">
		<label for=checkl05N>No</label></td>

<!-- 01 : CTAS : remove unused radio buttons	
    <td class=DataLabel>Consent Form Signed</td>
    <td class=DataField>
    <input type=radio name=checkl06 value="Consent Form Signed">Yes
    <input type=radio name=checkl06 value="Consent Form NOT Signed">No</td>
</tr>

<tr><td class=DataLabel>Medical Record</td>
    <td class=DataField>
    <input type=radio name=checkl07 value="Medical Record">Yes
    <input type=radio name=checkl07 value="NO Medical Record">No</td>

    <td class=DataLabel>X-Rays</td>
    <td class=DataField>
    <input type=radio name=checkl08 value="X-Rays">Yes
    <input type=radio name=checkl08 value="NO X-Rays">No</td>
</tr>
<intput type=hidden name=I value="%OPRWEB01.04.007">
<tr><td class=DataLabel>Bladder Empty</td>
    <td class=DataField>
    <input type=radio name=checkl09 value="Bladder Empty">Yes
    <input type=radio name=checkl09 value="Bladder NOT Empty">No</td>

    <td class=DataLabel>Make-up/Jewellery Removed</td>
    <td class=DataField>
    <input type=radio name=checkl10 value="Make-up Removed">Yes
    <input type=radio name=checkl10 value="Make-up NOT Removed">No</td>
</tr>

<tr><td class=DataLabel>Pre-medication Given</td>
    <td class=DataField>
    <input type=radio name=checkl11 value="Pre-medication Given">Yes
    <input type=radio name=checkl11 value="Pre-medication NOT Given">No</td>

    <td class=DataLabel>Checked Allergies</td>
    <td class=DataField>
    <input type=radio name=checkl12 value="Allergies Checked">Yes
    <input type=radio name=checkl12 value="Allergies NOT Checked">No</td>
</tr>
-->
</tr>
<!-- end of change -->

<!-- 01 : CTAS : remove Late Reason and Prosthesis
<tr><td class=DataLabel>Late Reason</td>
    <td class=DataField>
    <select name=opard004 title="Late Reason" class=selectBig>
    <option></option>
    OPRWEB01.04.404.2
    </select></td>
-->
<!-- end of change -->
<!-- 01 : CTAS : move Admitting Nurse and add Admitting Point
    <td class=DataLabel>Admitting Nurse</td>
    <td class=DataField>
    <input type=text name=opard003 title="Nurse Code" size=6 
      class=DataField  maxlength=6 value="OPRWEB01.04.403.1" 
     onblur=validateNurse()>
    <input type=text name=name_opard003 title="Nurse" class=ReadOnly readonly
     class=DataField size=22 maxlength=30 value="OPRWEB01.04.403.0">
    <img src="../images/SearchIcon.gif" align=absmiddle
     onClick="NurseSearchFrame(opard003,name_opard003);">
     </td>
-->
<!-- end of change -->
<!-- 01 : CTAS : remove Late Reason and Prosthesis
</tr>
    
<tr><td class=DataLabel>Prosthesis</td>
    <td class=DataField >
    <input type=text name=opard013 value='OPRWEB01.04.413' maxlength=40>
    </td></tr>
-->
<!-- end of change -->

<tr><td colspan=4 align=center>
    <input class="button" type=button id="opr01sub" value="OK" onclick="tempDisable(this);formSubmit();">
    <input class="button" type=button value="Cancel" onclick=DFrameClose()>
    </td></tr>
</form>
</table>

<form name=PatientLinks method=get>
<input type=hidden name=reportno value=1>
<input type=hidden name=template value=004>
<input type=hidden name=urnumber value="%OPRWEB01.04.003">
<input type=hidden name=admissno value="%OPRWEB01.04.081">
<input type=hidden name=casekeys value="%OPRWEB01.04.101">
<input type=hidden name=MenuType value="%OPRWEB01.04.088">
</form>
