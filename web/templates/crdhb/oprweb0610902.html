<meta name="TemplateVersion" content="V12.01.00">
<meta name="TemplateHome" content="crdhb">
<meta name="HelpFileName"    content="NoContextSet.html">
<script type="text/javascript" src="../js/oprweb06.js"> </script>
<script type="text/javascript">

function chkTime(field){
  if(isWhitespace(field.value))
   return;
  // 02 : CTAS : Add case abandoned variable, bypass surgery end time check
  //             if case is abandoned.
  var caseAbdn = document.UpdateForm.opsrg074.value;    
  endTime=UpdateForm.suentime.value.replace(/:/g,"");
  if(isWhitespace(endTime) && caseAbdn != "Yes"){
     alert("Surgery End Time must be entered first");
     field.value=""
     return;
  }
  OperDate=document.UpdateForm.casekeys.value.substring(3,11);
  if(document.UpdateForm.currdate.value > OperDate) {
    return;
  }
  if(field.value.replace(/:/g,"")<=endTime){
// 01 : CTAS : ChkTime(): remove option to precede patient out of theatre time
	  alert(""+field.title+" must be after Patient Out of Theatre Time " +
			  UpdateForm.suentime.value)
	  field.value="";
	  field.focus(); 
  }
}

function formSubmit() {
    var caseAbdn = document.UpdateForm.opsrg074.value;
    if (validateMandatory(UpdateForm)) {
        casekey = UpdateForm.casekeys.value.substr(0, 23);

        if (checkTimeOrder()) {
            saveOvrNight();
            if (!checkSurgeryEndTime()) {
                if (caseAbdn === "Yes") {
                    document.UpdateForm.opsrg074.value = "1";
                }
                document.UpdateForm.submit();
            }
        }
    }
}

function checkTimeOrder(){
	// time order:  Time into DSU < Discharged from peri-op
	var timeIntoDSU = UpdateForm.opard074;
	var timeDischarged = UpdateForm.opard104;
//	02 : TAS var overNightIndicator = document.getElementById("d_opsrg072");
	var overNightIndicator = document.getElementById("d_opsrg071");
 
	var timeIntoDSUVal = timeIntoDSU.value.replace(/ /g,"");
	var timeDischargedVal = timeDischarged.value.replace(/ /g,"");

	// accept if no times set
	if ((timeIntoDSUVal == "") && (timeDischargedVal == "")) {
		return true;
	}
	
	// check that no times have been missed in sequence
	if ((timeDischargedVal != "") && (timeIntoDSUVal == "")) {
		alert("Please enter " + timeIntoDSU.title);
		timeIntoDSU.focus();
		timeIntoDSU.select();
		return false;
	}
	
	// display warning if overnight indicator checked as can't validate time sequence
	if (overNightIndicator.checked) 	{
		alert("Warning: over night indicator is switch on, check your times carefully");
		return true;
	} else {
		// check times have been entered in order if no overnight indicator
		if ((timeDischargedVal != "") 
				&& (validateGreatestTime(timeIntoDSU,timeDischarged))) {
				return false;
		}
	}
	return true;
}
// 01 : CTAS : add DSU Over midnight indicator (oprsrgaf.opsguy03, opsrg072) 
// 02 : TAS : Change indicator tag back to opsrg071
function convertOvrnightToInteger()
{
/* var overNightField = document.getElementById("d_opsrg072");
 var opsrg072 =  document.getElementById("opsrg072"); */
	var overNightField = document.getElementById("d_opsrg071");
	var opsrg071 =  document.getElementById("opsrg071");
 
 if(opsrg071.value == "Yes")
   overNightField.checked = true;
 else
   overNightField.checked = false;
}
// 02 : TAS : Change indicator tag back to opsrg071
function saveOvrNight()
{
 /*
 var overNightField = document.getElementById("d_opsrg072");
 var opsrg072 =  document.getElementById("opsrg072"); 
 if(overNightField.checked)
  opsrg072.value  = 1;
 else
  opsrg072.value  = 0; */

  var overNightField = document.getElementById("d_opsrg071");
  var opsrg071 =  document.getElementById("opsrg071");
  if(overNightField.checked)
  opsrg071.value  = 1;
 else
  opsrg071.value  = 0;
  }
// 01 : CTAS : update checkSurgeryEndTime() to remove unused fields
// 02 : TAS : Change indicator tag back to opsrg071
function checkSurgeryEndTime()
{
	// check that Time into DSU and Discharged from Peri-Op > Surgery End Time
	// return true to abort submission
	var surgeryEndTime = document.getElementById('opsrg006');
	var timeIntoDSU = document.getElementById('opard074');
	var dischargedTime = document.getElementById('opard104');
// 02 : TAS	var overNightIndicator = document.getElementById("d_opsrg072");
	var overNightIndicator = document.getElementById("d_opsrg071");

	var tempSurgeryTime = surgeryEndTime.value.replace(/\:/g,"");
	var tempTimeIntoDSU = timeIntoDSU.value.replace(/\:/g,"");
	var tempDischargedTime = dischargedTime.value.replace(/\:/g,"");

	tempSurgeryTime.replace(/ /g,"");
	tempTimeIntoDSU.replace(/ /g,"");
	tempDischargedTime.replace(/ /g,"");

	tempSurgeryTime = parseInt(tempSurgeryTime,10);
	
	if (!overNightIndicator.checked) {
		if (tempTimeIntoDSU != "") {
			tempTimeIntoDSU = parseInt(tempTimeIntoDSU,10);
			if(tempSurgeryTime >= tempTimeIntoDSU)
			{
			  alert(timeIntoDSU.title+" has to be after Surgery End Time.");
			  timeIntoDSU.focus();
			  timeIntoDSU.select();
			  return true;
			}
		}

		if (tempDischargedTime != "") {
			tempDischargedTime = parseInt(tempDischargedTime,10);
			if(tempSurgeryTime >= tempDischargedTime)
			{
			  alert(dischargedTime.title+" has to be after Surgery End Time.");
			  dischargedTime.focus();
			  dischargedTime.select();
			  return true;
			}	
		}
	}

	return false;
} 
</script>
</head>
%START.OF.PAGE
<body onload="PageLoad(event);convertOvrnightToInteger();">
<div id=PatientHeading></div>
<script type="text/javascript">
PatientURN="%OPRWEB06.10.003";
PatientVIS="%OPRWEB06.10.081";
PatientNAM="%OPRWEB06.10.002";
PatientSTA="%OPRWEB06.10.086.078";
PatientALT="%OPRWEB06.10.084";
PatientSEX="%OPRWEB06.10.019";
PatientDOB="%OPRWEB06.10.020";
PatientAGE="%OPRWEB06.10.021";
PatientLOC="%OPRWEB06.10.083";
PatientPRI="%OPRWEB06.10.086.066.1";
PatientUNT="%OPRWEB06.10.066.0";
DoctorCOD="%OPRWEB06.10.082.003";
DoctorNAM="%OPRWEB06.10.082.002";
PatientAID="%OPRWEB06.10.086.090";
PatientIND="%OPRWEB06.10.086.091";
PatientCUR="%OPRWEB06.10.086.092";
PatientCLC="%OPRWEB06.10.086.093.1";
PatientCLH="%STANDARD.01.017.CL";
PatientHFT="%OPRWEB06.10.086.094";
PatientCDM="%OPRWEB06.10.086.095";
PatientVDH="%OPRWEB06.10.086.099.015";

EventExist="%OPRWEB06.10.743";
usingRecoveryAnaestheticParameter ='%STANDARD.01.025.113.015.0.1';
</script>
<!-- 01 : CTAS : add title bar and rename screen to Theatre Case PACU Details -->
<span class=DFrameTitleBar>
<img align="right" alt="Exit" class="MenuIcon" 
 src="../images/ExitIcon.gif" onclick="DFrameExit();">
Theatre Case DSU Post-Op Details
</span>
<!-- end of change -->
<div id=PageBodySection>
<table border=0 cellpadding=2 cellspacing=0 width="95%" align=center >
<form name=UpdateForm method=post action=oprweb06.pbl>
<input type=hidden name=reportno value=10>
<input type=hidden name=template value=902>
<input type=hidden name=updatety value="U">
<input type=hidden name=casekeys value="%OPRWEB06.10.101">
<input type=hidden name=uniqueky value='%OPRWEB06.10.110'>
<input type=hidden name=suentime value="%OPRWEB06.10.306">
<input type=hidden name=suprlevl value="%OPRWEB06.10.512">
<input type=hidden name=currdate value="%STANDARD.01.013">
<input type=hidden name=opsrg004 id=opsrg004 value="%OPRWEB06.10.304">
<input type=hidden name=opsrg071 id=opsrg071 value="%OPRWEB06.10.371">																	
<input type=hidden name=opsrg006 id=opsrg006 value="%OPRWEB06.10.306" />
<!-- 01 : CTAS : add DSU Over midnight indicator (oprsrgaf.opsguy03, opsrg072) -->
<input type=hidden name=opsrg072 id=opsrg072 value="%OPRWEB06.10.372" />
<!-- end of change -->
<input type=hidden name=opsrg074 value ="%OPRWEB06.10.374">

<!-- 01 : CTAS : move and rename Time in Recovery-Back to Time into DSU -->
<tr>
	<td class=DataLabel>Time into DSU</td>
    <td class=DataField>
    <input type=text name=opard074 size=8 title="Time into DSU"
     value='%OPRWEB06.10.274' id=opard074 tabindex=1
     onBlur="checkTime(this,this.title);chkTime(this);">
    <img src="../images/DateTimeStamp.gif" class=Icon
     onClick="SetCurrentDateTime(null,opard074);" tabindex=-1>
    <img src=../images/TimeLookup.gif border=0 class=Icon
     onclick="TimeLookupFrame(opard074);" tabindex=-1>
    </td>
<!-- end of change -->

<!-- 01 : CTAS : add Reason for holding in DSU -->
    <td class=DataLabel>Reason For Holding in DSU</td>
    <td class=DataField>
       <select name=opard095 class=DataField tabindex=5 
			title="Reason For Holding in DSU">
      <option></option>
   %OPRWEB06.10.295.2
      </select>
    </td>
</tr>
<!-- end of change -->


<!-- 01 : CTAS : move Time in Recovery - Back nurses and rename to DSU Nurse -->
<tr>
	<td class=DataLabel>DSU Nurse 1</td>
    <td><input type=text name=opard075 size=6 value="%OPRWEB06.10.275.1"
	 title="DSU Nurse 1" id=opard075 tabindex=2
     onblur="validateCode(17,opard075,name_opard075);">
    <input type=text readonly name=name_opard075 class=Readonly size=30
     value="%OPRWEB06.10.275.0" tabindex=-1>
    <img src="../images/SearchIcon.gif" class=Icon tabindex=-1
     onclick="NurseSearchFrame(opard075,name_opard075);">
    </td>
    <td class=DataLabel>DSU Nurse 2</td>
    <td><input type=text name=opard076 size=6 value="%OPRWEB06.10.276.1"
	 title="DSU Nurse 2" id=opard076 tabindex=6
     onblur="validateCode(17,opard076,name_opard076);">
    <input type=text readonly name=name_opard076 class=Readonly size=30
     value="%OPRWEB06.10.276.0" tabindex=-1>
    <img src="../images/SearchIcon.gif" class=Icon tabindex=-1
     onclick="NurseSearchFrame(opard076,name_opard076);">
    </td>
	</tr>
<!-- end of change -->

<!-- 01 : CTAS : add Discharged from Peri-Op (opard104) -->
<tr><td class=DataLabel>Discharged From Peri-Op</td>
    <td class=DataField>
    <input type=text name=opard104 size=8 title="Discharged From Peri-Op"
    id=opard104 value='%OPRWEB06.10.299.004' 
     onBlur="checkTime(this);" tabindex=3>
    <img src="../images/DateTimeStamp.gif" class=Icon
    onclick="SetCurrentDateTime(null,opard104);" tabindex=-1
    alt="Time patient leaves the Peri-Op department">
    <img src=../images/TimeLookup.gif border=0 class=Icon
    onclick="TimeLookupFrame(opard104);" tabindex=-1
    alt="Patient leaves the Peri-Op department">	
    </td>
<!-- end of change -->
<!-- 01 : CTAS : add Discharged To (opard094) -->
	<td class=DataLabel>Discharged To</td>
	<td class=DataField>
       <select name=opard094 id=opard094 class=DataField 
	   title="Discharged To" tabindex=7>
      <option></option>
      %OPRWEB06.10.294.2
      </select>    
    </td>
</tr>
<!-- end of change -->

<!-- 01 : CTAS : add DSU Over midnight indicator (oprsrgaf.opsguy03, opsrg072) -->
<!-- 02 : TAS : Change Over midnight indicator back to opsrg071
<tr>
	<td class=DataLabel>Over Midnight Indicator</td>
	<td class="DataField">
    <input type="checkbox"
           name="d_opsrg072"
           id="d_opsrg072"
		   title="Over Midnight Indicator"
		   tabindex=4
          onchange="saveOvrNight();"/></td> -->
<tr>
	<td class=DataLabel>Over Midnight Indicator</td>
	<td class="DataField">
    <input type="checkbox"
           name="d_opsrg071"
           id="d_opsrg071"
		   title="Over Midnight Indicator"
		   tabindex=4
          onchange="saveOvrNight();"/></td>		  
 
<!-- end of change -->

<!-- 01 : CTAS : add Reason for Overnight (cat code ou, opard086) -->
    <td class=DataLabel width=18%>Reason for Overnight Stay</td>
    <td class=DataField>
    <select name=opard086 id=opard086 class=DataField
		title="Reason for Overnight Stay" tabindex=8>
    <option></option>
     %OPRWEB06.10.286.2
    </select>
    </td>
</tr>
<!-- end of change -->

<!-- 01 : CTAS : custom: close popup when Cancel clicked -->
<table border=0 cellpadding=2 cellspacing=0 width="95%" align=center >
<tr><td colspan=4 align=center>
    <input class="button" id="opr06sub" type=button value="OK" 
		tabindex=9 onclick="tempDisable(this);formSubmit();">
	<input class="button" type=button value="Cancel" 
		tabindex=10 onclick="DFrameClose();">	
    </td></tr>
</table>
<!-- end of change -->
</form>
</body>
