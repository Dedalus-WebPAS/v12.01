<meta name="TemplateVersion" content="V12.01.00">
<meta name="TemplateHome" content="crdhb">
<meta name="HelpFileName" content="NoContextSet.html">
<!-- 03 : Add customjs reference for required function -->
<script type="text/javascript" src="../js/ctascustom.js"></script>
<script type="text/javascript">
function LinkDocument() {
  linkurl="cliweb08.pbl?reportno=01&template=013" +
          "&urnumber=" + document.UpdateForm.urnumber.value.replace(/ /g,"+") +
          "&admissno=" + document.UpdateForm.admissno.value.replace(/ /g,"+") +
          "&corsp017=" + document.UpdateForm.alert001.value.replace(/ /g,"+") +
          "&corsp018=" + document.UpdateForm.alert002.value.replace(/ /g,"+") +
          "&corsp019=" + document.UpdateForm.alert013.value.replace(/ /g,"+") ;
  Left=(document.body.clientWidth-600)/2;
  DFrameLink(linkurl,0,Left,600,300);
}
function CheckDateRules(){

  var start = new Date(document.UpdateForm.alert003.value);
  var middle = new Date(document.UpdateForm.alert008.value);
  var end = new Date(document.UpdateForm.alert011.value);
  var errorString = ""

  if((start>middle)&&(start!=NaN)&&(middle!=NaN)){
      errorString+="Next Review Date cannot be before Date Activated\n";
  }
  if((start>end)&&(start!="")&&(end!="")){
      errorString+="End Date cannot be before Date Activated\n";
  }
  if((middle>end)&&(middle!="")&&(end!="")){
      errorString+="End Date cannot be before Next Review Date\n";
  }

  if(errorString!=""){
     alert("Please fix the following before proceeding:\n"+errorString);
     return false;
  }
  setFormactn('U');
}
function makeEverythingReadOnly() {
  document.getElementById('catedesc').className="Readonly";
  document.getElementById('catedesc').readOnly=true;
  document.getElementById('codedesc').className="Readonly";
  document.getElementById('codedesc').readOnly=true;
  document.getElementById('alert003').className="Readonly";
  document.getElementById('alert003').readOnly=true;
  dateActivatedDIV.innerHTML="";
  document.getElementById('alert008').className="Readonly";
  document.getElementById('alert008').readOnly=true;
  nextreviewdateDIV.innerHTML="";
  document.getElementById('alert011').className="Readonly";
  document.getElementById('alert011').readOnly=true;
  enddateDIV.innerHTML="";
  infectionstatusDIV.innerHTML=infectionstatusSPAN.innerHTML;
  document.getElementById('alert007').className="Readonly";
  document.getElementById('alert007').readOnly=true;
  //severitylevelDIV.innerHTML=severitylevelSPAN.innerHTML;
  document.getElementById('alcommnt').className="Readonly";
  document.getElementById('alcommnt').readOnly=true;
  document.getElementById('updtbttn').disabled=true;
  //document.getElementById('docobutt').disabled=true;
  document.getElementById('deltbttn').disabled=true;
  document.getElementById('alert012').className="Readonly";
  document.getElementById('alert012').readOnly=true;
  //document.getElementById('hcpsicon').disabled=true;
  //document.getElementById('hcpeicon').disabled=true;
}
function checkComments() {
	if (document.getElementById('alcdindc').value.substr(11,1)==1) {
		document.getElementById('alcommnt').className="Readonly";
		document.getElementById('alcommnt').readOnly=true;
	}
}
function checkAlertSecLevels() {
  // User's Alert Security Levels for each category
  var alwsindc = document.getElementById('alwsindc').value;

  // Category Security Level Ind2
  var alcdindc = document.getElementById('alcdindc').value.substr(4, 1);

  // User Alert Security Level
  var alusrlvl = document.getElementById('alusrlvl').value;

  // Extract the numeric part of the alert
  var alertValue = document.getElementById('alert001').value;
  var alertNumber = parseInt(alertValue.substr(1, 1));

  var index = alertNumber - 1;

  if (!(alwsindc.trim())) {
    if (alusrlvl < alcdindc) {
      makeEverythingReadOnly();
    }
  } else {
    if (alwsindc.substr(index, 1) < alcdindc) {
      makeEverythingReadOnly();
    }
  }
}

// set initiating hospital
function setInitHospital() {
  LoginHosp=document.UpdateForm.alert014.value;
  if(LoginHosp == "WEL" ) {
    HospitalNameStr="Wellington Hospital";
  } else if(LoginHosp == "PNH") {
    HospitalNameStr="Palmerston North Hospital";
  } else if(LoginHosp == "KEN") {
    HospitalNameStr="Kenepuru Hospital";
  } else if(LoginHosp == "WHN") {
    HospitalNameStr="Whanganui Hospital";
  } else if(LoginHosp == "WRH") {
    HospitalNameStr="Wairarapa Hospital";
  } else if(LoginHosp == "HWK") {
    HospitalNameStr="Hawkes Bay Hospital";
  } else if(LoginHosp == "HUT") {
    HospitalNameStr="Hutt Hospital";
  } else if(LoginHosp == "HOR") {
    HospitalNameStr="Horowhenua Hospital";
  } else if(LoginHosp == "MHW") {
    HospitalNameStr="MH Hospital Whanganui";
  }
  
  document.UpdateForm.d_alert014.value = HospitalNameStr; 
  document.UpdateForm.alert014.readOnly = true;
  document.UpdateForm.d_alert014.readOnly = true;
}

// set DHB responsible for review
function setInitDHB() {
	var dhb = document.UpdateForm.initdhb.value.replace(/ /g,"");
	var dhblist = document.UpdateForm.alert007;
	for (i=0; i<dhblist.options.length; i++) {
		if (dhblist.options[i].value == dhb) {
			dhblist.selectedIndex = i;
		}
	}
}

// show review date only if alert indicator 11 = Y
function showReviewDate() {
	if (document.UpdateForm.alrtcode.value.substr(13,1) == 'Y') {
		document.getElementById("nextreview").style.display = "";
	} else {
		document.getElementById("nextreview").style.display = "none";
	}
}

// get HCP name to match code and update HCP name field
function getHCPName() {
	var hcpcode = document.UpdateForm.alert012.value;
	var hcpname = document.UpdateForm.genpname;
	if (!isWhitespace(hcpcode)) {
		var serverURL  = "../cgi-bin/patweb80.pbl?reportno=18" +
				   "&returnfm=2&valdtype=0" +
				   "&valdcode=" + hcpcode.replace(/ /g, "+");

		var returnValue = RSExecute(serverURL);
		if (returnValue.status==0) {
			ReturnValue=returnValue.return_value.split("|");
			hcpname.value=trim(ReturnValue[0]);	
		}
	} else {
		hcpname.value = "";
	}
}

// initialise values of custom fields
function setCustomInits() {
	showReviewDate();
	setInitHospital();
	setInitDHB();
	getHCPName();
}

// end of custom section

function filterCatwn() {
 filterInd1 = document.getElementById('alert001').value.substr(1,1);  // Ind 1
 p=document.UpdateForm;
 if(document.getElementById('alert005').readOnly==true) {
   return;
 }
 filterCatCodeList(p.alert005,"1",filterInd1,"2");
}
</script>

%START.OF.PAGE
</HEAD>
<body onload="PageLoad(event);setCustomInits();checkAlertSecLevels();checkComments();
	filterCatwn();">

<span class=DFrameTitleBar>
  <img align="right" alt="Exit" class="MenuIcon" 
   src="../images/ExitIcon.gif" onclick="DFrameExit();">
  Update Alert
</span>

<table align=center cellspacing=2 cellpadding=1 width=90% border=0>

<form name=UpdateForm method=post action=cliweb01.pbl>
  <input type=hidden name=reportno value="1">
  <input type=hidden name=template value="002">
  <input type=hidden name=updttype value="A">
  <input type=hidden name=urnumber value="%CLIWEB01.01.003">
  <input type=hidden name=admissno value="%CLIWEB01.01.081">
  <input type=hidden name=alert001 id=alert001 value="%CLIWEB01.01.107">
  <input type=hidden name=alert002 value="%CLIWEB01.01.101.1">
  <input type=hidden name=alert013 value="%CLIWEB01.01.132">
  <input type=hidden name=nextpage value="5">
  <input type=hidden name=alcdindc id=alcdindc value="%CLIWEB01.01.101.3">
  <input type=hidden name=alwsindc id=alwsindc value="%CLIWEB01.01.134">
  <input type=hidden name=alusrlvl id=alusrlvl value="%CLIWEB01.01.147">
  <input type=hidden name=initdhb value="%CLIWEB01.01.106">
  <input type=hidden name=alrtcode value="%CLIWEB01.01.101.3">

  <tr>
    <td class=DataLabel>Alert Category</td>
    <td>
      <input type=text name=catedesc id=catedesc size=30 readonly 
       value="%CLIWEB01.01.108">
    </td>
  </tr>

  <tr>
    <td class=DataLabel>Alert</td>
    <td>
      <input type=text name=codedesc size=30 readonly 
       id=codedesc value="%CLIWEB01.01.101.0">
    </td>
  </tr>

<!-- CTAS removed pending decision about name/label 
<tr><td class=DataLabel>Alert Requested By</td>
    <td colspan=3><input type=text name=alert012 id=alert012 size=10 maxlength=8
        title="Alert Requested By"
        value="CLIWEB01.01.123"
        onchange="ValidateHCP(18,12,alert012,d_alert012);">
       <input type=text size=35 name=d_alert012 id=d_alert012
        value="CLIWEB01.01.130" class=Readonly readonly>
    <img src=../images/SearchIcon.gif class=Icon name=hcpsicon id=hcpsicon
     onclick="HCPSearchFrame(alert012,d_alert012,7);">
    <img src="../images/ClearIcon.gif" class=Icon name=hcpeicon id=hcpeicon
     onclick="clrFields(alert012,d_alert012);">
    </td></tr>
-->
  <tr>
    <td class=DataLabel>Date Activated</td>
    <td>
      <table cellspacing=0 cellpadding=0 border=0>
      <tr><td>
      <input type=text name=alert003 id=alert003 size=12 maxlength=12 
       class="Mandatory PastDate"
       value="%CLIWEB01.01.102" title="Date Activated">
      </td>
      <td>
      <div id=dateActivatedDIV>
      <img src=../images/DateTimeStamp.gif border=0 hspace=4
       align=absmiddle onclick="SetCurrentDateTime(UpdateForm.alert003,null);">
      <img src=../images/DateLookup.gif border=0 hspace=4
       align=absmiddle onclick="DateLookupFrame(UpdateForm.alert003);">
      </div>
      </td></tr>
      </table>
    </td>
  </tr>

  <tr id="nextreview" style="display:none">
    <td class=DataLabel>Next Review Date</td>
    <td>
      <table cellspacing=0 cellpadding=0 border=0>
      <tr><td>
      <input type=text name=alert008 id=alert008 size=12 maxlength=12 class="Date"
       value="%CLIWEB01.01.112" title="Next Review Date">
      </td>
      <td>
      <div id=nextreviewdateDIV>
      <img src=../images/DateTimeStamp.gif border=0 hspace=4
       align=absmiddle onclick="SetCurrentDateTime(UpdateForm.alert008,null);">
      <img src=../images/DateLookup.gif border=0 hspace=4
       align=absmiddle onclick="DateLookupFrame(UpdateForm.alert008);">
      </div>
      </td></tr>
      </table>
    </td>
  </tr>

  <tr>
    <td class=DataLabel>End Date</td>
    <td>
      <table cellspacing=0 cellpadding=0 border=0>
      <tr><td>
      <input type=text name=alert011 id=alert011 size=12 maxlength=12
       value="%CLIWEB01.01.122" title="End Date" class="PastDate">
      </td>
      <td>
      <div id=enddateDIV>
      <img src=../images/DateTimeStamp.gif border=0 hspace=4
       align=absmiddle onclick="SetCurrentDateTime(UpdateForm.alert011,null);">
      <img src=../images/DateLookup.gif border=0 hspace=4
       align=absmiddle onclick="DateLookupFrame(UpdateForm.alert011);">
      </div>
      </td></tr>
      </table>
    </td>
  </tr>

  <tr>
    <td class=DataLabel>%STANDARD.01.017.wn</td>
    <td>
      <div id=infectionstatusDIV>
      <select name=alert005 id=alert005>
        <option></option>
        %CLIWEB01.01.104.2
      </select>
      </div>
    </td>
  </tr>

  <tr>
    <td class=DataLabel>Responsible HCP</td>
    <td>
      <input type=text name=alert012 id=alert012 size=10 
	  value="%CLIWEB01.01.123" maxlength=10 onblur="getHCPName();">
	  <input type=text size=25 notab readonly name=genpname value="">
        <img src="../images/SearchIcon.gif"
        onClick="HCPSearchFrame(alert012,genpname)">
        <img src="../images/erase.gif" align=absmiddle 
			onClick="clrFields(alert012,genpname);">
    </td>
  </tr>

  <tr valign=top>
    <td class=DataLabel>Initiating hospital</td>
    <td>
		<input type=text name=alert014 id=alert014 size=3 
			value="%CLIWEB01.01.124.1" maxlength=3>
		<input type=text name=d_alert014 id=d_alert014 size=20 maxlength=20>
    </td>
  </tr>

  <tr valign=top>
    <td class=DataLabel>DHB responsible for reviewing alert</td>
    <td>
      <select name=alert007 id=alert007>	
		<option value=""></option>
		<option value="CCDHB">Capital &amp; Coast DHB</option>
		<option value="HBDHB">Hawke's Bay DHB</option>
		<option value="HVDHB">Hutt Valley DHB</option>		
		<option value="MCDHB">MidCentral DHB</option>
		<option value="YDHB">Wairarapa DHB</option>
		<option value="WDHB">Whanganui DHB</option>
      </select>
    </td>
  </tr>

  %CLIWEB01.01.115

 <!-- 03 : TAS : Limit Characters to 250 for comments field 
  <tr>
	 <td colspan=2 class=DataLabel>Reaction/comment/drug name</td>
  </tr>

<tr><td colspan=2 align=center>
<textarea wrap=hard name=alcommnt id=alcommnt rows=4 cols=70>CLIWEB01.01.111</textarea></td>
  </tr>
-->
<tr>
      <td colspan=2><label for=alcommnt>Reaction/comment/drug name
      <br/><br/>&nbsp;&nbsp;
	  <span id="charsUsed"></span></label></td>
</tr>
  <tr>
    <td></td>
    <td>
    <textarea type="text" name=alcommnt id=alcommnt wrap=hard cols=70 rows=4 
	maxlength=250 tabindex=22 title="Reaction/comment/drug name" 
	onkeyup="NumCharsUsed(this, 250, document.getElementById('charsUsed'));">%CLIWEB01.01.111</textarea>
    </td>
        <td></td><td></td>
</tr>
<!-- End of Change -->  
  <tr>
  <td colspan=2>
  <table width="100%">
  <tr><td class=DataLabel>Last updated by</td><td>%CLIWEB01.01.126</td>
	<td class=DataLabel>Created by</td><td>%CLIWEB01.01.110</td></tr>
  <tr><td class=DataLabel>Last updated date</td><td>%CLIWEB01.01.127</td>
	<td class=DataLabel>Date created</td><td>%CLIWEB01.01.129</td></tr>
  </table>
  </td>
  </tr>

  <tr>
    <td colspan=2 align=center>
      <br>
      <input type=button value="Update" class="button" id=updtbttn
       onClick="CheckDateRules();">
      <input type=button value="Delete" class="button" 
       onClick="setFormactn('D');" id=deltbttn>
      <input type=button value="Cancel" class="button" 
       onClick="DFrameClose();">
    </td>
  </tr>

</form>
</table>

<script type="text/javascript">
if("%CLIWEB01.01.114"=="1"){
   document.UpdateForm.docobutt.disabled=true;
}
</script>

<span id=infectionstatusSPAN style="display: none">
<input type=text name=alert005 id=alert005 size=20 maxlength=20
 value="%CLIWEB01.01.104.0" class=Readonly readOnly>
</span>

<span id=severitylevelSPAN style="display: none">
<input type=text name=alert006 id=alert006 size=20 maxlength=20
 value="%CLIWEB01.01.105" class=Readonly readOnly>
</span>
