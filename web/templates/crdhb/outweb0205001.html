<meta name="TemplateVersion" content="V12.01.00">
<meta name="TemplateHome" content="crdhb">
<meta name="HelpFileName" content="NoContextSet.html">
<script type="text/javascript" src="../js/outweb02.js"></script>
<script type="text/javascript" src="../js/OutExtraTemplates.js"></script>
<script type="text/javascript">
function showACC(theForm) {
  checkInd=theForm.outbb002.value.substr(3,5)
  if (checkInd.search(/W/g) >= 0) {
      ACCHeading.innerHTML=acchd.innerHTML;
      ACCId.innerHTML=accorderid.innerHTML;
    } else {
      ACCHeading.innerHTML=blanklabel.innerHTML;
      ACCId.innerHTML=blanklabel.innerHTML;
    }
}

function SubmitFinal() {
  p=document.AddForm
  p.valddate.value=p.clindate.value.substr(4,12);
  validateSuspension(p.urnumber,p.valddate,p.datefrom,p.dateto);
  if(p.datefrom.value!='0'){
       ans=confirm("Warning : Patient has a Suspension record for period \n" +
             "\t" + p.datefrom.value  + " - " + p.dateto.value);
       if (ans!=true) {
          return; }
  } 
  if(!CheckReferralDate(p.refrldte.value,p.clindate.value.substr(4,12))) {
    return;
  }

  setRedirect()
  if (validateMandatory(AddForm)) {
    SubmitHidden(AddForm);
  }
}

function CheckReferralDate(ref,clin)
{
  if (isWhitespace(ref)) {
    return true;
  }

  if (SetDateYYYYMMDD(ref) > SetDateYYYYMMDD(clin))
  {
    alert("Appointment Date must not be before Referral Date");
    return false;
  }

  return true;
}

//-----------------------------------------------------------------
// Function To check Referral Letters
//-----------------------------------------------------------------
function checkRefLetter(urnumber,admissno,chkaqflg) {
  if (isWhitespace(urnumber)) return;

  var apprqfnd = 0;
  if (chkaqflg == 1) {
    var serverURL = "../cgi-bin/outweb02.pbl?reportno=9&updatety=17" +
                    "&urnumber="+urnumber.replace(/ /g,"+") +
                    "&admissno="+admissno.replace(/ /g,"+")
    var returnValue = RSExecute(serverURL);
    ReturnValue=returnValue.return_value.split("|");
    if (returnValue.status==0) {
      apprqfnd = ReturnValue[0]     // Appointment request exist flag
    }
  }

  ReturnFunction="" ;
  for (var i=1; i < checkRefLetter.arguments.length; i++) {
   if (typeof(checkRefLetter.arguments[i]) == 'function') {
     ReturnFunction=checkRefLetter.arguments[i] } }
  var serverURL = "../cgi-bin/outweb02.pbl?reportno=9&updatety=15" +
                  "&urnumber="+urnumber.replace(/ /g,"+")
  var returnValue = RSExecute(serverURL);
  ReturnValue=returnValue.return_value.split("|");
  if (returnValue.status==0) {
    if (ReturnValue[0] == 1) {    // Unbooked referral exists
      // Construct warning message
      if (isWhitespace(ReturnValue[1]))
        { ReturnValue[1] = "Unknown Date"; }
      if (isWhitespace(ReturnValue[2]))
        { ReturnValue[2] = "Unknown"; }
      if (isWhitespace(ReturnValue[3]))
        { ReturnValue[3] = "Unknown"; }
      if (isWhitespace(ReturnValue[5]))
        { ReturnValue[5] = "Unknown"; }
      if (apprqfnd == 0) {
         if (ReturnValue[6] == "1") {
             alert("Warning : Referral Exists for " + ReturnValue[1] +
                   "; Clinic Type " + ReturnValue[2] + "; Clinic Id " +
                   ReturnValue[3] + "; Case Team " + ReturnValue[5] +
                   "\n\nAppointments are not allowed to be booked for " +
                   "this primary referral. Click Ok to continue without " +
                   "linking to referral.");
         } else {
             var message = "Warning : Referral Exists for " + ReturnValue[1] +
                           "; Clinic Type " + ReturnValue[2] + "; Clinic Id " +
                           ReturnValue[3] + "; Case Team " + ReturnValue[5] +
                           "\n\nClick OK to select the referral or CANCEL to " +
                           "continue without linking to a referral.";
             ans=confirm(message);
             if (ans) {
                 LinkToReferral(urnumber,ReturnValue[4]);
             }
         }
      }
      else {
        if (ReturnValue[6] == "1") {
           var message = "Warning : Referral Exists for " + ReturnValue[1] +
                        "; Clinic Type " + ReturnValue[2] + "; Clinic Id " +
                        ReturnValue[3] + "; Case Team " + ReturnValue[5] +
                        "\n\nThe patient also has outstanding Appointment " +
                        "Requests." +
                        "\n\nAppointments are not allowed to be booked for " +
                        "this primary referral. Click Ok to continue without " +
                        "linking to referral.";
            ans=confirm(message);
            if (!ans) {
               LinkApptToReferral(urnumber);
            }
        } else {
           var message = "Warning : Referral Exists for " + ReturnValue[1] +
                         "; Clinic Type " + ReturnValue[2] + "; Clinic Id " +
                         ReturnValue[3] + "; Case Team " + ReturnValue[5] +
                         "\n\nThe patient also has outstanding Appointment " +
                         "Requests." +
                         "\n\nClick OK to view Referral and Appointment " +
                         "Requests or CANCEL to continue without linking " +
                         "to a referral.";
           ans=confirm(message);
           if (ans) {
              LinkApptToReferral(urnumber);
           }
        }
      }
    }
    if (ReturnValue[0] == 2) {    // Multiple Unbooked referral exists
      if (apprqfnd == 0) {
        var message = "Warning : Multiple Referrals Exist for " +
                      "this patient." +
                      "\nDo you want to link this visit to a referral?" +
                      "\n\nClick OK to link to a referral or " +
                      "CANCEL to continue.";
      }
      else {
        var message = "Warning : Multiple Referrals / Appointment Requests " +
                      "Exist for this patient." +
                      "\n\nDo you want to link this visit to a referral?" +
                      "\n\nClick OK to link to a referral / Appointment " +
                      "Requests or CANCEL to continue.";

      }
      ans=confirm(message);
      if (ans) {
        LinkApptToReferral(urnumber);
      }
    }
    if (typeof(ReturnFunction) == 'function') { ReturnFunction() }
  }
}
// 04 Merge task 0874425
function LinkToReferral(urnumber,refnumber){
  linkUrl="outweb02.pbl?reportno=5&template=001" +
          "&urnumber=" + urnumber.replace(/ /g,"+") +
          "&casekeys=" + PatientLinks.casekeys.value.replace(/ /g,"+") +
          "&admissno=" + refnumber.replace(/ /g,"+") +
          "&refrlvis=" + refnumber.replace(/ /g,"+") +
          "&bookflag=2" +
          "&waitflag=" + AddForm.waitflag.value.replace(/ /g,"+") +
          "&waitlkey=" + AddForm.waitlkey.value.replace(/ /g,"+") +
          "&skipwarn=1";     //skip other warning since it has been shown
  location.href=linkUrl;
}
function LinkToAppointmentRequest(urnumber,requestkey){
  linkUrl="outweb02.pbl?reportno=5&template=001" +
          "&urnumber=" + urnumber.replace(/ /g,"+") +
          "&casekeys=" + PatientLinks.casekeys.value.replace(/ /g,"+") +
          "&admissno=" + requestkey.substr(8,8).replace(/ /g,"+") +
          "&refrlvis=" + requestkey.substr(8,8).replace(/ /g,"+") +
          "&requestk=" + requestkey.replace(/ /g,"+") +
          "&bookflag=3" +
          "&waitflag=" + AddForm.waitflag.value.replace(/ /g,"+") +
          "&waitlkey=" + AddForm.waitlkey.value.replace(/ /g,"+") +
          "&skipwarn=1";     //skip other warning since it has been shown
  location.href=linkUrl;
}
// End of change 
function LinkApptToReferral(urnumber){
  SetCookie('linkReferralCOOKIE','');
  var apptDate = SetDateYYYYMMDD(AddForm.clindate.value.substr(4,11));
  linkUrl="allweb02.pbl?reportno=2&template=25&filtstat=7" +
          "&clindate=" + apptDate +
          "&urnumber=" + urnumber.replace(/ /g,"+")
  Left=(document.body.clientWidth-800)/2
  DFrameLink(linkUrl,50,Left,800,500);
}
function setRedirect() {
  strTemplate="" ;
  scrName="";
  checkInd=document.AddForm.outbb002.value.substr(3,5)
  if(checkInd.search(/W/g) >= 0) {
    strTemplate="005"; 
    scrName="WC";}
  if(checkInd.search(/M/g) >= 0) {
    strTemplate="042";
    scrName="TAC";}
  if(checkInd.search(/V/g) >= 0) {
    strTemplate="043"; 
    scrName="VA";}

  checkInd=document.AddForm.outbb002.value.substr(8,1)
  if(checkInd.search(/C/g) >= 0) {
    strTemplate="021"; 
    scrName="CT";}

  if (strTemplate=="") {
    if ((document.AddForm.ptcnueoc.value==1) &&
        (document.AddForm.outbb002.value.substr(5,1)=='A')) {
      scrName="ACC";
      document.AddForm.redirect.value="eocweb01.pbl?reportno=1&template=006"
        + "&urnumber=" + PatientLinks.urnumber.value.replace(/ /g,"+")
        + "&returncd=OUT";
    }
    else {
      document.AddForm.redirect.value="outweb02.pbl?reportno=3&template=1" +
                                      "&shwprint=1" 
    }
  }
  else {
    document.AddForm.redirect.value="patweb89.pbl?reportno=01" +
               "&template=" + strTemplate +
               "&systflag=2" +
               "&urnumber=" + PatientLinks.urnumber.value.replace(/ /g,"+")  
  }
  chkExtraTempl(document.AddForm,"B",document.AddForm.newslotk.value,
                PatientLinks.urnumber.value.replace(/ /g,"+"),scrName)
}

function ClinicSearch() {
  cancelSlot(AddForm.newslotk.value,ClinicSearchLink)
}
function ClinicSearchLink() {
  ClinicSearchFrame(AddForm.newslotk,AddForm.clindesc,AddForm.clindate,
                    AddForm.defclnty,AddForm.defclnid,AddForm.defvisty,
                    AddForm.deftovrd,AddForm.refrlvis);
}
function AppointSearch() {
  cancelSlot(AddForm.newslotk.value,AppointSearchLink)
}
function AppointSearchLink() {
  AppointmentSearchFrame(AddForm.newslotk,AddForm.clindesc,AddForm.clindate,
                         AddForm.defclnty,AddForm.defclnid,AddForm.defvisty,
                         AddForm.deftovrd,AddForm.refrlvis);
}

function fnCancel() {
 if (isWhitespace(AddForm.newslotk.value)) {
   history.back(); }
 else {
   cancelSlot(AddForm.newslotk.value,SessionLink)
  }
}
function SessionLink() {
   SESSKEYS=AddForm.newslotk.value.substr(0,28).replace(/ /g,"+")
   location.href="outweb02.pbl?reportno=2&template=4&sesskeys="+SESSKEYS
}
function valClaimCode() {
  validateCode(41,AddForm.urnumber,AddForm.claimc);
  for (var i =0 ; i < document.AddForm.outbb002.length; i++) {
//    alert(AddForm.outbb002.options[i].value.substr(0,3));
    if (document.AddForm.claimc.value==
        trim(document.AddForm.outbb002.options[i].value.substr(0,3))){
          document.AddForm.outbb002.selectedIndex=i;
    }
  }
}

// 01 : CTAS : Show alert if patient type is not Resident, i.e. if patient is chargeable - add alertIfNonResident function
function alertIfNonResident(ptype) {
	if (ptype.substr(5,1) != 'R')
		alert("Please note - Type of Residency is 'Chargeable'.");
}
// end of change
</script>
</head>
%START.OF.PAGE
<div id=HeadingSection>
<!-- 01 : CTAS : Show alert if patient type is not Resident, 
i.e. if patient is chargeable - add call to alertIfNonResident function from body.onload
<body onload='PageLoad(event);valClaimCode();SetAppointDefaults();showACC(AddForm);'>
-->
<body onload="PageLoad(event);
	alertIfNonResident('%OUTWEB02.05.024.3');
	valClaimCode();
	SetAppointDefaults(%OUTWEB02.05.214);
	showACC(AddForm); FilterMentalHealth(AddForm);">
<!-- end of change -->
<div id=PatientHeading></div>
<script type="text/javascript">
PatientURN="%OUTWEB02.05.003";
PatientVIS="%OUTWEB02.05.081";
PatientNAM="%OUTWEB02.05.002";
PatientSTA="%OUTWEB02.05.086.078";
PatientALT="%OUTWEB02.05.084";
PatientSEX="%OUTWEB02.05.019";
PatientDOB="%OUTWEB02.05.020";
PatientAGE="%OUTWEB02.05.021";
PatientLOC="%OUTWEB02.05.083";
DoctorCOD="%OUTWEB02.05.082.003";
PatientPRI="%OUTWEB02.05.086.066.1";
PatientUNT="%OUTWEB02.05.066.0";
DoctorNAM="%OUTWEB02.05.082.002";
PatientAID="%OUTWEB02.05.086.090";
PatientIND="%OUTWEB02.05.086.091";
PatientCUR="%OUTWEB02.05.086.092";
PatientCLC="%OUTWEB02.05.086.093.1";
PatientCLH="%STANDARD.01.017.CL";
PatientHFT="%OUTWEB02.05.086.094";
PatientCDM="%OUTWEB02.05.086.095";
PatientVDH="%OUTWEB02.05.086.099.015";
InsertPatientHeader()
</script>
<div id=PatientMenu></div>
<table cellspacing=0 cellpadding=1 border=0 width=100%>
<tr><td class=HeadingCell align=center width=100% >
    Make New Appointment</td></tr>
</table>

<form name=AddForm action=outweb02.pbl method=post>
<input type=hidden name=reportno value="06">
<input type=hidden name=template value="004">
<input type=hidden name=nextpage value="6">
<input type=hidden name=redirect value="">
<input type=hidden name=urnumber value="%OUTWEB02.05.003">
<input type=hidden name=admissno value="%OUTWEB02.05.081">
<input type=hidden name=updatety value="5">
<input type=hidden name=bookflag value="%OUTWEB02.05.214">
<input type=hidden name=ctcnckar value="%STANDARD.01.025.032.146.1.1">
<input type=hidden name=refrlvis value="%OUTWEB02.05.353.001">
<input type=hidden name=systfalg value="2">
<input type=hidden name=ptcnueoc value="%OUTWEB02.05.216">
<input type=hidden name=clinctyp value="%OUTWEB02.05.205.1">
<input type=hidden name=dateclin value="%OUTWEB02.05.104">
<input type="hidden" name="claimc">
<input type=hidden name=valddate>
<input type=hidden name=datefrom>
<input type=hidden name=dateto>

<!-- Referral Default Fields -->
<input type=hidden name=slotbtyp value="%OUTWEB02.05.270">
<input type=hidden name=slotrefn value="%OUTWEB02.05.268.0">
<input type=hidden name=slotreqk value="%OUTWEB02.05.271">
<input type=hidden name=defclnty value="">
<input type=hidden name=defclnid value="">
<input type=hidden name=defvisty value="">
<input type=hidden name=defclaim value="">
<input type=hidden name=deffunds value="">
<input type=hidden name=deftovrd value="">
<input type=hidden name=requestk value="%OUTWEB02.05.362.041">
<input type=hidden name=slotrtrn>
<input type=hidden name=waitlkey value="%OUTWEB02.05.219">
<input type=hidden name=waitflag value="%OUTWEB02.05.220">
<input type=hidden name=clincgrp value="%OUTWEB02.05.127.017">
<!-- Referral Default Fields -->

<table cellspacing=0 cellpadding=0 border=0 width=90% align=center>
<tr><td class=DataLabel width=20%>Clinic</td>
    <td class=DataField colspan=3>
    <input type=hidden name=newslotk value="%OUTWEB02.05.166" >
    <input type=text size=30 name=clindesc Title="Clinic" 
     value="%OUTWEB02.05.192" readonly class=Mandatory>
     <img src="../images/SearchIcon.gif" class=Icon onClick="AppointSearch();">
     <img src="../images/LookupIcon.gif" class=Icon onClick="ClinicSearch();">
    </td></tr>
<tr><td class=DataLabel>Date</td>
   <td class=DataField colspan=3>
   <input type=text size=35 name=clindate readonly  class=Mandatory title="date"
     value="%OUTWEB02.05.113 %OUTWEB02.05.104 %OUTWEB02.05.116">
    </td></tr>

<tr><td class=DataLabel>Visit Type</td>
    <td class=DataField colspan=3>
    <select name=outbb047 title="Visit Type" class="Mandatory SelectBig">
    <option></option>
    %OUTWEB02.05.199
    </select>
    </td></tr>

<tr valign=top>
    <td class=DataLabel>Presenting Complaint</td>                              
    <td class=DataField colspan=3>
    <input type=text name=pmsvx052 size=50 maxlength=50 
    value="">
</td></tr>     

<!-- Mode of Delivery -->
<!-- 06 : Make Mode of Delivery mandatory -->
<tr><td class=DataLabel>%STANDARD.01.017.sd</td>
    <td class=DataField colspan=3>
    <select class=Mandatory name=outbb070 title="%STANDARD.01.017.sd">
    <option></option>
    %OUTWEB02.05.127.006.9.4
    </select>
    </td></tr>

<tr valign=top>
    <td class=DataLabel>Diagnosis</td>

    <td class=DataField colspan=3>
    <input type=text size=12 name=outbb045 value=""
     onblur="validateCode(6,AddForm.outbb045,AddForm.outbb046);">
    <input type=text name=outbb046 size=70 maxlength=50
     readonly class=Readonly value="">
    <img src=../images/SearchIcon.gif class=Icon
     onclick="Icd10DisSearchFrame(AddForm.outbb045,AddForm.outbb046);">
    <img src=../images/LookupIcon.gif class=Icon
     onclick="CtypediagSearchFrame(AddForm.outbb045,AddForm.outbb046);">
    </td></tr>

<tr>
<td>&nbsp;</td>
    <td class=DataField colspan=3>
    <input type=text size=12 name=outbb055 value=""
     onblur="validateCode(6,AddForm.outbb055,AddForm.outbb056);">
    <input type=text name=outbb056 size=70 maxlength=50 
     readonly class=Readonly value="">
    <img src=../images/SearchIcon.gif class=Icon
     onclick="Icd10DisSearchFrame(AddForm.outbb055,AddForm.outbb056);">
    <img src=../images/LookupIcon.gif class=Icon
     onclick="CtypediagSearchFrame(AddForm.outbb055,AddForm.outbb056);">
    </td></tr>
<tr>
<td>&nbsp;</td>
<td class=DataField colspan=3>
     <input type=text size=12 name=outbb057 value=""
     onblur="validateCode(6,AddForm.outbb057,AddForm.outbb058);">
     <input type=text size=70 maxlength=50 name=outbb058 
      readonly class=Readonly value="">
    <img src=../images/SearchIcon.gif class=Icon
     onclick="Icd10DisSearchFrame(AddForm.outbb057,AddForm.outbb058);">
    <img src=../images/LookupIcon.gif class=Icon
     onclick="CtypediagSearchFrame(AddForm.outbb057,AddForm.outbb058);">
    </td></tr>
<tr>
<td>&nbsp;</td>
<td class=DataField colspan=3>
    <input type=text size=12 name=outbb059 value=""
    onblur="validateCode(6,AddForm.outbb059,AddForm.outbb060);">
    <input type=text size=70 maxlength=50 name=outbb060 
     readonly class=Readonly value="">
    <img src=../images/SearchIcon.gif class=Icon
     onclick="Icd10DisSearchFrame(AddForm.outbb059,AddForm.outbb060);">
    <img src=../images/LookupIcon.gif class=Icon
     onclick="CtypediagSearchFrame(AddForm.outbb059,AddForm.outbb060);">
    </td></tr>
<tr>
<td>&nbsp;</td>
<td class=DataField colspan=3>
    <input type=text size=12 name=outbb061 value=""
    onblur="validateCode(6,AddForm.outbb061,AddForm.outbb062);">
    <input type=text size=70 maxlength=50 name=outbb062
     readonly class=Readonly value="">
    <img src=../images/SearchIcon.gif class=Icon
     onclick="Icd10DisSearchFrame(AddForm.outbb061,AddForm.outbb062);">
    <img src=../images/LookupIcon.gif class=Icon
     onclick="CtypediagSearchFrame(AddForm.outbb061,AddForm.outbb062);">
    </td></tr>

<tr><td>Procedure</td>
    <td class=DataField colspan=3>
    <input type=text size=12 name=otprc002 value=""
     onblur="validateCode(7,AddForm.otprc002,AddForm.otprc003);">
   <input type=text size=70 maxlength=50 name=otprc003 readonly
                               class=Readonly value="" >
    <img src=../images/SearchIcon.gif class=Icon
     onclick="Icd10ProSearchFrame(AddForm.otprc002,AddForm.otprc003);">
    <img src=../images/LookupIcon.gif class=Icon
     onclick="CtypeprocSearchFrame(AddForm.otprc002,AddForm.otprc003);">
    </td></tr>

<tr><td>&nbsp;</td>
    <td class=DataField colspan=3>
    <input type=text size=12 name=otprc004 value=""
     onblur="validateCode(7,AddForm.otprc004,AddForm.otprc005);">
   <input type=text size=70 maxlength=50 name=otprc005 readonly
                               class=Readonly value="" >
    <img src=../images/SearchIcon.gif class=Icon
     onclick="Icd10ProSearchFrame(AddForm.otprc004,AddForm.otprc005);">
    <img src=../images/LookupIcon.gif class=Icon
     onclick="CtypeprocSearchFrame(AddForm.otprc004,AddForm.otprc005);">
    </td></tr>

<tr><td>&nbsp;</td>
    <td class=DataField colspan=3>
    <input type=text size=12 name=otprc006 value=""
     onblur="validateCode(7,AddForm.otprc006,AddForm.otprc007);">
   <input type=text size=70 maxlength=50 name=otprc007 readonly
                               class=Readonly value="" >
    <img src=../images/SearchIcon.gif class=Icon
     onclick="Icd10ProSearchFrame(AddForm.otprc006,AddForm.otprc007);">
    <img src=../images/LookupIcon.gif class=Icon
     onclick="CtypeprocSearchFrame(AddForm.otprc006,AddForm.otprc007);">
    </td></tr>

<tr><td>&nbsp;</td>
    <td class=DataField colspan=3>
    <input type=text size=12 name=otprc008 value=""
     onblur="validateCode(7,AddForm.otprc008,AddForm.otprc009);">
   <input type=text size=70 maxlength=50 name=otprc009 readonly
                               class=Readonly value="" >
    <img src=../images/SearchIcon.gif class=Icon
     onclick="Icd10ProSearchFrame(AddForm.otprc008,AddForm.otprc009);">
    <img src=../images/LookupIcon.gif class=Icon
     onclick="CtypeprocSearchFrame(AddForm.otprc008,AddForm.otprc009);">
    </td></tr>

<tr><td>&nbsp;</td>
    <td class=DataField colspan=3>
    <input type=text size=12 name=otprc010 value=""
     onblur="validateCode(7,AddForm.otprc010,AddForm.otprc011);">
   <input type=text size=70 maxlength=50 name=otprc011 readonly
                               class=Readonly value="" >
    <img src=../images/SearchIcon.gif class=Icon
     onclick="Icd10ProSearchFrame(AddForm.otprc010,AddForm.otprc011);">
    <img src=../images/LookupIcon.gif class=Icon
     onclick="CtypeprocSearchFrame(AddForm.otprc010,AddForm.otprc011);">
    </td></tr>

<tr><td>Problem</td>
    <td class=DataField colspan=3>
    <input type=text size=12 name=otprc012 value=""
     onblur="valCtypeProblem(clinctyp,this,d_otprc012);">
   <input type=text size=70 maxlength=50 name=d_otprc012 readonly
                               class=Readonly value="" >
    <img src=../images/LookupIcon.gif class=Icon
     onclick="CtypeprobSearchFrame(AddForm.otprc012,AddForm.d_otprc012);">
    </td></tr>

<tr><td>&nbsp;</td>
    <td class=DataField colspan=3>
    <input type=text size=12 name=otprc013 value=""
     onblur="valCtypeProblem(clinctyp,this,d_otprc013);">
   <input type=text size=70 maxlength=50 name=d_otprc013 readonly
                               class=Readonly value="" >
    <img src=../images/LookupIcon.gif class=Icon
     onclick="CtypeprobSearchFrame(AddForm.otprc013,AddForm.d_otprc013);">
    </td></tr>

<tr><td>&nbsp;</td>
    <td class=DataField colspan=3>
    <input type=text size=12 name=otprc014 value=""
     onblur="valCtypeProblem(clinctyp,this,d_otprc014);">
   <input type=text size=70 maxlength=50 name=d_otprc014 readonly
                               class=Readonly value="" >
    <img src=../images/LookupIcon.gif class=Icon
     onclick="CtypeprobSearchFrame(AddForm.otprc014,AddForm.d_otprc014);">
    </td></tr>


<!-- 01 : CTAS : Transport field removed - remove field
	Move Claim Type here
<td class=DataLabel>Transport</td>
    <td class=DataField><select name=outbb023 class=SelectBig>
        <option></option>
        OUTWEB02.05.142.2
        </select></td>
-->
	<td class=DataLabel>%STANDARD.01.017.CL</td>
    <td class=DataField><select name=outbb002 class="Mandatory SelectBig"
        title="%STANDARD.01.017.CL" onchange=showACC(AddForm);>
        <option></option>
        %OUTWEB02.05.197.2
        </select></td>
<!-- end of change -->
    <td class=DataLabel>Priority</td>
    <td class=DataField><select name=outbb013 class=SelectBig>
	<option></option>
	%OUTWEB02.05.132.2
	</select>
    </td></tr>
<tr>
	<!-- 01 : CTAS : Move Claim Type up, move HP here
	<td class=DataLabel>STANDARD.01.017.CL</td>
    <td class=DataField><select name=outbb002 class="Mandatory SelectBig"
        title="STANDARD.01.017.CL" onchange=showACC(AddForm);>
        <option></option>
        %OUTWEB02.05.197.2
        </select></td>
	-->
	<td>%STANDARD.01.017.HP</td>
	<td>
		<select name=outbb073 class="Mandatory">
		<option value=""></option>
		%OUTWEB02.05.127.013.2
		</select>
	</td>
	<!-- end of change -->
    <td class=DataLabel>Unit</td>
    <td class=DataField><select name=outbb022 class="SelectBig"
                         title="Unit">
	<option></option>
	 %OUTWEB02.05.141.2
	</select></td></tr>

     <tr><td><div id=ACCHeading></div></td>
         <td><div id=ACCId></div></tr>

<tr><td class=DataLabel>Source of Referral</td>
    <td class=DataField><select name=outbb001 class="Mandatory SelectBig"
        title="Source of Referral">
        <option></option>
        %OUTWEB02.05.120.2
        </select></td>
    <td class=DataLabel>Reports Required</td>
    <td class=DataField><select name=outbb017 class=SelectBig>
        <option></option>
        %OUTWEB02.05.136.2</td></tr>

<tr><td class=DataLabel>Special Arrangements</td>
    <td class=DataField>
    <select name=outbb054 class=SelectBig>
    <option></option>
    %OUTWEB02.05.178.2
    </select></td>
    <td class=DataLabel>Referring GP</td>
    <td class=DataField> 
    <input type=hidden name=outbb029>
    <input type=hidden name=dummy1 value="6">
    <input type=text name=genpname readonly Class=Readonly> 
    <img src="../images/SearchIcon.gif" class=Icon
     onclick="HCPSearchFrameExpanded(outbb029,genpname,dummy1.value,
     document.AddForm.outbb030,document.AddForm.d_outbb030,document.AddForm.outbb037)">
    <img src="../images/erase.gif" onClick="clrFields(outbb029,genpname);" class=Icon>
    </td></tr>

<tr><td class=DataLabel>Preferred Contact Method</td>
    <td class=DataField>
      <select name=outbb040>
       <option value="   "></option>
        %OUTWEB02.05.159.2
       </select></td>
<td class=DataLabel>Practice</td>
    <td class=DataField>
      <input type=hidden name=returnprov1>
      <input type=hidden name=outbb030>
      <input type=hidden name=outbb037>
      <input type=text name="d_outbb030" title="Practice" readonly class="Readonly">
      <img src="../images/SearchIcon.gif" class=Icon
       onclick="GPHCGSearchFrame(outbb029,genpname,returnprov1,outbb030,d_outbb030,outbb037)">
      <img src="../images/erase.gif" class=Icon
       onClick="clrFields(d_outbb030,returnprov1,outbb030,outbb037);">
</td></tr>
<tr>
  <td class=DataLabel>
    Referral Date
  </td>
  <td class=DataField>
    <input type=text name=refrldte class=ReadOnly readonly size=12>
  </td>
    <td class=DataLabel>Inform GP</td>
      <td><select name=pmsvx010>
         <option value="0">No</option>
         <option value="1" selected>Yes</option>
        </select></td></tr>

<tr>
  <td colspan=2></td>
  <td>
    %STANDARD.01.017.gb
  </td>
  <td>
    <select name="contcode">
      <option></option>
      %OUTWEB02.05.286
    </select>
  </td>
</tr>
<!-- 01 : CTAS : Move HP below Claim Type 
<tr>
  <td>STANDARD.01.017.HP</td>
  <td>
    <select name=outbb073 class="Mandatory">
      <option value=""></option>
      OUTWEB02.05.127.013.2
    </select>
  </td>
  <td>&nbsp;</td>
</tr>
end of change -->

<tr valign=top><td class=DataLabel>Comments</td>
    <td class=DataField colspan=3>
    <textarea name=outptcom wrap=hard cols=70 rows=3></textarea>
    </td></tr>

<tr><td colspan=4 align=center>
    <input type=button class="button" value="Ok" id="out02sub"
    onclick="tempDisable(this);checkSlot(AddForm.newslotk.value,
            AddForm.urnumber.value,SubmitFinal);">
    <input type=button class="button" Value="Cancel" onClick='fnCancel()'>
    </td></tr>
</table>
</form>

<span id=blanklabel style="display:none">
</span>
<span id=acchd style="display:none">
ACC Purchase Order Number
</span>

<span id=accorderid style="display:none">
  <input type=text name=accpordn id=accpordn title="ACC Purchase Order Number"
   maxlength=20 size=25>
</span>
<!-- 04 Merge task 08474425 -->
<span id="ApptReqComm" style="display:none">
<textarea name="apprcomm" id="apprcomm" wrap=hard cols=60 rows=3
tabindex=60>%OUTWEB02.05.299.002</textarea>
</span>											
<!-- End of Change -->
<form name=PatientLinks method=get>
<input type=hidden name=reportno value=1>
<input type=hidden name=template value=004>
<input type=hidden name=urnumber value="%OUTWEB02.05.003">
<input type=hidden name=admissno value="%OUTWEB02.05.081">
<input type=hidden name=MenuType value="%OUTWEB02.05.088">
<input type=hidden name=casekeys value="%OUTWEB02.05.166">
</form>

<script type="text/javascript">
function SetAppointDefaults(refletter) {
  if (refletter == 1) {  // New Appointment from Refferal Letters
    document.AddForm.defclnty.value="%OUTWEB02.05.327.1";
    document.AddForm.defclnid.value="%OUTWEB02.05.304.1";
    document.AddForm.outbb013.value="%OUTWEB02.05.307.3";
    document.AddForm.outbb029.value="%OUTWEB02.05.302.001";
    document.AddForm.genpname.value="%OUTWEB02.05.302.081";
    document.AddForm.pmsvx052.value="%OUTWEB02.05.306";
    document.AddForm.outbb030.value="%OUTWEB02.05.353.023.0";
    document.AddForm.d_outbb030.value="%OUTWEB02.05.353.023.1";
    document.AddForm.outbb037.value="%OUTWEB02.05.353.024";

    if (document.AddForm.refrldte != undefined) {
      document.AddForm.refrldte.value="%OUTWEB02.05.353.019"
    }
    document.AddForm.outbb001.value="%OUTWEB02.05.328.3";
//
    document.AddForm.claimc.value="%OUTWEB02.05.354.1";
    for (var i =0 ; i < document.AddForm.outbb002.length; i++) {
      if (document.AddForm.claimc.value==
          document.AddForm.outbb002.options[i].value.substr(0,3)){
            document.AddForm.outbb002.selectedIndex=i;
      }
    }
    Hp="%OUTWEB02.05.353.099. 11.1";
    for (var i=0; i < document.AddForm.outbb073.length; i++) {
     if (document.AddForm.outbb073.options[i].value.substr(0,3)==Hp){
        document.AddForm.outbb073.selectedIndex=i;
     }
    }
  } else if (refletter == 2) {
    document.AddForm.defclnty.value="%OUTWEB02.05.353.067.1";
    document.AddForm.defclnid.value="%OUTWEB02.05.353.088.1";
    document.AddForm.defvisty.value="%OUTWEB02.05.353.095";
//
    if(document.AddForm.waitflag.value=="1" ||
       document.AddForm.waitflag.value=="2") {
      document.AddForm.defclnty.value="%STANDARD.01.025.111.012.0.6";
      document.AddForm.defclnid.value=" ";
    }
//
    document.AddForm.defclaim.value="%OUTWEB02.05.353.035.1";
    document.AddForm.outbb045.value="%OUTWEB02.05.353.031.1";
    document.AddForm.outbb046.value="%OUTWEB02.05.353.031.0";
    document.AddForm.outbb055.value="%OUTWEB02.05.353.032.1";
    document.AddForm.outbb056.value="%OUTWEB02.05.353.032.0";
    document.AddForm.outbb057.value="%OUTWEB02.05.353.033.1";
    document.AddForm.outbb058.value="%OUTWEB02.05.353.033.0";
    document.AddForm.outbb059.value="%OUTWEB02.05.353.099.048.1";
    document.AddForm.outbb060.value="%OUTWEB02.05.353.099.048.0";
    document.AddForm.outbb061.value="%OUTWEB02.05.353.099.049.1";
    document.AddForm.outbb062.value="%OUTWEB02.05.353.099.049.0";
    document.AddForm.otprc002.value="%OUTWEB02.05.353.099.050.1";
    document.AddForm.otprc003.value="%OUTWEB02.05.353.099.050.0";
    document.AddForm.otprc004.value="%OUTWEB02.05.353.099.051.1";
    document.AddForm.otprc005.value="%OUTWEB02.05.353.099.051.0";
    document.AddForm.otprc006.value="%OUTWEB02.05.353.099.052.1";
    document.AddForm.otprc007.value="%OUTWEB02.05.353.099.052.0";
    document.AddForm.otprc008.value="%OUTWEB02.05.353.099.053.1";
    document.AddForm.otprc009.value="%OUTWEB02.05.353.099.053.0";
    document.AddForm.otprc010.value="%OUTWEB02.05.353.099.054.1";
    document.AddForm.otprc011.value="%OUTWEB02.05.353.099.054.0";
    document.AddForm.otprc012.value="%OUTWEB02.05.353.028.1";
    document.AddForm.d_otprc012.value="%OUTWEB02.05.353.028.0";
    document.AddForm.otprc013.value="%OUTWEB02.05.353.029.1";
    document.AddForm.d_otprc013.value="%OUTWEB02.05.353.029.0";
    document.AddForm.otprc014.value="%OUTWEB02.05.353.030.1";
    document.AddForm.d_otprc014.value="%OUTWEB02.05.353.030.0";
    for (var i=0; i < document.AddForm.outbb002.length; i++) {
     if (document.AddForm.outbb002.options[i].value.substr(0,3)==
         document.AddForm.defclaim.value.substr(0,3)){
         document.AddForm.outbb002.selectedIndex=i;
     }
    }
    if (document.AddForm.refrldte != undefined) {
      document.AddForm.refrldte.value="%OUTWEB02.05.353.019";
    }
    var cCode = "%OUTWEB02.05.353.099.013.1";
    for(var i=0; i<AddForm.contcode.length; i++){
      if(AddForm.contcode.options[i].value.substring(0,3)==cCode){
         AddForm.contcode.selectedIndex=i;
      }
    }
    var priority="%OUTWEB02.05.353.027.3";
    for (var i=0; i < document.AddForm.outbb013.length; i++) {
     if (document.AddForm.outbb013.options[i].value.substr(0,3)==
         priority.substr(0,3)){
         document.AddForm.outbb013.selectedIndex=i;
     }
    }
    var sourceofref="%OUTWEB02.05.353.034.3";
    for (var i=0; i < document.AddForm.outbb001.length; i++) {
     if (document.AddForm.outbb001.options[i].value.substr(0,3)==
         sourceofref.substr(0,3)){
         document.AddForm.outbb001.selectedIndex=i;
     }
    }
    document.AddForm.outbb029.value="%OUTWEB02.05.353.022.1";
    document.AddForm.genpname.value="%OUTWEB02.05.353.022.0";
    document.AddForm.pmsvx052.value="%OUTWEB02.05.353.049";
	document.AddForm.outbb030.value="%OUTWEB02.05.353.023.0";
    document.AddForm.d_outbb030.value="%OUTWEB02.05.353.023.1";
    document.AddForm.outbb037.value="%OUTWEB02.05.353.024";

    Hp="%OUTWEB02.05.353.099. 11.1";
    for (var i=0; i < document.AddForm.outbb073.length; i++) {
     if (document.AddForm.outbb073.options[i].value.substr(0,3)==Hp){
        document.AddForm.outbb073.selectedIndex=i;
     }
    }

} else if (refletter == 3 || document.AddForm.slotbtyp.value=="2") {              // Appointment Request
    if(document.AddForm.slotbtyp.value=="2") {
      document.AddForm.refrlvis.value=document.AddForm.slotrefn.value;
      document.AddForm.requestk.value=document.AddForm.slotreqk.value;
      document.AddForm.bookflag.value="3";
    }
    document.AddForm.slotbtyp.value="2";
    document.AddForm.defclnty.value="%OUTWEB02.05.362.010.1"; // Clinic Type
    document.AddForm.defclnid.value="%OUTWEB02.05.362.011.1"; // Clinic Id
    document.AddForm.defvisty.value="%OUTWEB02.05.362.012.1"; // Slot Type
    document.AddForm.outbb013.value="%OUTWEB02.05.362.016.3"; // Priority
    document.AddForm.defclaim.value="%OUTWEB02.05.362.015.1"; // Claim Code
    for (var i=0; i < document.AddForm.outbb002.length; i++) {
     if (document.AddForm.outbb002.options[i].value.substr(0,3)==
         document.AddForm.defclaim.value.substr(0,3)){
         document.AddForm.outbb002.selectedIndex=i;
     }
    }
    document.AddForm.pmsvx052.value="%OUTWEB02.05.362.014";   // Presenting C
    document.AddForm.outbb023.value="%OUTWEB02.05.362.013.3"; // Transport
    document.AddForm.outbb054.value="%OUTWEB02.05.362.018.3"; // Special Arr
    var sourceofref="%OUTWEB02.05.362.017.3";                 // Source of Ref
    for (var i=0; i < document.AddForm.outbb001.length; i++) {
     if (document.AddForm.outbb001.options[i].value.substr(0,3)==
         sourceofref.substr(0,3)){
         document.AddForm.outbb001.selectedIndex=i;
     }
    }
	var priority="%OUTWEB02.05.362.016.3";                   // Priority
    for (var i=0; i < document.AddForm.outbb013.length; i++) {
      if (document.AddForm.outbb013.options[i].value.substr(0,3)==
        priority.substr(0,3)){
        document.AddForm.outbb013.selectedIndex=i;
      }
    }
	var transport="%OUTWEB02.05.362.013.3";                 //Transport
    for (var i=0; i < document.AddForm.outbb023.length; i++) {
      if (document.AddForm.outbb023.options[i].value.substr(0,3)==
        transport.substr(0,3)){
        document.AddForm.outbb023.selectedIndex=i;
      }
    }
    var specArr="%OUTWEB02.05.362.018.3";                 //Special Arr
    for (var i=0; i < document.AddForm.outbb054.length; i++) {
      if (document.AddForm.outbb054.options[i].value.substr(0,3)==
        specArr.substr(0,3)){
        document.AddForm.outbb054.selectedIndex=i;
      }
    }
    Hp="%OUTWEB02.05.353.099. 11.1";
    for (var i=0; i < document.AddForm.outbb073.length; i++) {
     if (document.AddForm.outbb073.options[i].value.substr(0,3)==Hp){
        document.AddForm.outbb073.selectedIndex=i;
     }
    }
    document.AddForm.outbb022.value="%OUTWEB02.05.362.006.3"; // Unit
    document.AddForm.outbb029.value="%OUTWEB02.05.353.022.1";
    document.AddForm.genpname.value="%OUTWEB02.05.353.022.0";
    document.AddForm.outbb030.value="%OUTWEB02.05.353.023.0   ";
    document.AddForm.d_outbb030.value="%OUTWEB02.05.353.023.1   ";
    document.AddForm.outbb037.value="%OUTWEB02.05.353.024   ";
    document.AddForm.outptcom.value=document.getElementById("apprcomm").value; 
    if (document.AddForm.refrldte != undefined) {
      document.AddForm.refrldte.value="%OUTWEB02.05.353.019";
    }

  } else {
  if(document.AddForm.slotbtyp.value=="1") {  // OP booking from add slot
    document.AddForm.defclnty.value="%OUTWEB02.05.353.067.1";
    document.AddForm.defclnid.value="%OUTWEB02.05.353.088.1";
    document.AddForm.defvisty.value="%OUTWEB02.05.353.095";
    document.AddForm.defclaim.value="%OUTWEB02.05.353.035.1";
    document.AddForm.outbb045.value="%OUTWEB02.05.353.031.1";
    document.AddForm.outbb046.value="%OUTWEB02.05.353.031.0";
    document.AddForm.outbb055.value="%OUTWEB02.05.353.032.1";
    document.AddForm.outbb056.value="%OUTWEB02.05.353.032.0";
    document.AddForm.outbb057.value="%OUTWEB02.05.353.033.1";
    document.AddForm.outbb058.value="%OUTWEB02.05.353.033.0";
    document.AddForm.outbb059.value="%OUTWEB02.05.353.099.048.1";
    document.AddForm.outbb060.value="%OUTWEB02.05.353.099.048.0";
    document.AddForm.outbb061.value="%OUTWEB02.05.353.099.049.1";
    document.AddForm.outbb062.value="%OUTWEB02.05.353.099.049.0";
    document.AddForm.otprc002.value="%OUTWEB02.05.353.099.050.1";
    document.AddForm.otprc003.value="%OUTWEB02.05.353.099.050.0";
    document.AddForm.otprc004.value="%OUTWEB02.05.353.099.051.1";
    document.AddForm.otprc005.value="%OUTWEB02.05.353.099.051.0";
    document.AddForm.otprc006.value="%OUTWEB02.05.353.099.052.1";
    document.AddForm.otprc007.value="%OUTWEB02.05.353.099.052.0";
    document.AddForm.otprc008.value="%OUTWEB02.05.353.099.053.1";
    document.AddForm.otprc009.value="%OUTWEB02.05.353.099.053.0";
    document.AddForm.otprc010.value="%OUTWEB02.05.353.099.054.1";
    document.AddForm.otprc011.value="%OUTWEB02.05.353.099.054.0";
    document.AddForm.otprc012.value="%OUTWEB02.05.353.028.1";
    document.AddForm.d_otprc012.value="%OUTWEB02.05.353.028.0";
    document.AddForm.otprc013.value="%OUTWEB02.05.353.029.1";
    document.AddForm.d_otprc013.value="%OUTWEB02.05.353.029.0";
    document.AddForm.otprc014.value="%OUTWEB02.05.353.030.1";
    document.AddForm.d_otprc014.value="%OUTWEB02.05.353.030.0";
    for (var i=0; i < document.AddForm.outbb002.length; i++) {
     if (document.AddForm.outbb002.options[i].value.substr(0,3)==
         document.AddForm.defclaim.value.substr(0,3)){
         document.AddForm.outbb002.selectedIndex=i;
     }
    }
    if (document.AddForm.refrldte != undefined) {
      document.AddForm.refrldte.value="%OUTWEB02.05.353.019";
    }
    var cCode = "%OUTWEB02.05.353.099.013.1";
    for(var i=0; i<AddForm.contcode.length; i++){
      if(AddForm.contcode.options[i].value.substring(0,3)==cCode){
         AddForm.contcode.selectedIndex=i;
      }
    }
    var priority="%OUTWEB02.05.353.027.3";
    for (var i=0; i < document.AddForm.outbb013.length; i++) {
     if (document.AddForm.outbb013.options[i].value.substr(0,3)==
         priority.substr(0,3)){
         document.AddForm.outbb013.selectedIndex=i;
     }
    }
    var sourceofref="%OUTWEB02.05.353.034.3";
    for (var i=0; i < document.AddForm.outbb001.length; i++) {
     if (document.AddForm.outbb001.options[i].value.substr(0,3)==
         sourceofref.substr(0,3)){
         document.AddForm.outbb001.selectedIndex=i;
     }
    }
    document.AddForm.outbb029.value="%OUTWEB02.05.353.022.1";
    document.AddForm.genpname.value="%OUTWEB02.05.353.022.0";
//    document.AddForm.outbb030.value="%OUTWEB02.05.353.023.0";
//    document.AddForm.d_outbb030.value="%OUTWEB02.05.353.023.1";
//    document.AddForm.outbb037.value="%OUTWEB02.05.353.024";
    document.AddForm.pmsvx052.value="%OUTWEB02.05.353.049";
    document.AddForm.bookflag.value="2";
    document.AddForm.refrlvis.value=document.AddForm.slotrefn.value;
  }
  if(isWhitespace(document.AddForm.slotrefn.value)) {
     checkRefLetter(document.AddForm.urnumber.value,
                    document.AddForm.admissno.value,
                    document.AddForm.ctcnckar.value);
  }
  }
}

var dA = document.AddForm
var hpCode = "%OUTWEB02.05.289";
for(var i=0; i<dA.outbb073.length; i++){
    if(hpCode == dA.outbb073.options[i].value.substr(0,3)){
       dA.outbb073.selectedIndex=i;
       break;
   }
}
</script>
