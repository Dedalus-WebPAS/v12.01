<meta name="TemplateVersion" content="V12.01.00">
<meta name="TemplateHome" content="crdhb">
<meta name="HelpFileName" content="NoContextSet.html">
<script type="text/javascript" src="../js/allweb0202002.js"></script>
<script type="text/javascript">
function getCloseReferralCookie() {

  var closereferralurl = "";

  if (GetCookieData("CloseReferralCookie") != "unknown") {
    closereferralurl=GetCookieData("CloseReferralCookie");
    ExpireCookiePath("CloseReferralCookie");
    DFrameLink(closereferralurl,50,50,750,500)
  }
}
function displayStatusOptions() {
  var viewlink = document.getElementById('viewlink');
  if(document.HiddenFields.rfstcode.value!="1") { // Active Referal
    return;
  }
  if(document.HiddenFields.bookedop.value=="1") { // Booked or Atteded OP
    return;
  }
  if(document.HiddenFields.groupcnt.value=="1") { // Group Contacts
    return;
  }
  viewlink.options[viewlink.options.length] = new Option("Waiting","6");
}

// 01 : CTAS : add GetPrimaryRefData()
// is current referral a mental health referral?
function isMHReferral(dept) {
	return (dept.replace(/ /g,"").toUpperCase() == "MH");
}

// get primary referral details for mental health recovery plan

function GetPrimaryRefData() {
	// ignore if referral is not mental health
	
	var dept = document.HiddenFields.refrdept.value;

	if (isMHReferral(dept) ) {
		// ignore if referral is primary - standard workflow applies
		var isPrimary = document.HiddenFields.isprim.value.replace(/ /g,"");
		if (isPrimary.toUpperCase() == "NO") {
			// open primary referral recovery plan (allweb0202933) in iframe
			var dept = document.HiddenFields.refrdept.value.replace(/ /g,"");
			var urno = document.PatientLinks.urnumber.value.replace(/ /g,"");
			var primaryRefID = document.PatientLinks.primref.value.replace(/ /g,"");
			var primaryRefIFrame = document.getElementById('PrimFrame');
			primaryRefIFrame.style.display = '';
			var iframeContent = '<div id=PrimRefDiv style="border-style:none;'
				+ 'left:10px;top:10px;width:100%;height:100%;">'
				+ '<iframe scrolling=no name=PrimRefFrame '
				+ 'src="../cgi-bin/allweb02.pbl?reportno=2&template=933'
				+ '&urnumber=+' + urno
				+ '&admissno=+' + primaryRefID
				+ '&deptcode=' + dept.replace(/ /g,"+") + '" '
				+ 'style="border:0;height:40px;width:100%;" '
				+ 'marginwidth=1 marginheight=1 align=top border=0 '
				+ 'frameborder=0></iframe></div>'
			primaryRefIFrame.innerHTML = iframeContent;
		}
	}
	
}

// open referral plan update template (allweb0202934) - called from allweb0202933
function ShowPlanUpdate() {
	var dept = document.HiddenFields.refrdept.value.replace(/ /g,"");
	var urno = document.PatientLinks.urnumber.value.replace(/ /g,"");
	var primaryRefID = document.PatientLinks.primref.value.replace(/ /g,"");	
	var linkURL = "allweb02.pbl?reportno=2&template=934"
		+ "&urnumber=+" + urno
		+ "&admissno=+" + primaryRefID
		+ "&deptcode=" + dept.replace(/ /g,"+");
	var Left = (document.body.clientWidth-800)/2;
	DFrameLink(linkURL, 60, Left, 800, 230);
}
// end of change

// 01 : CTAS : From allweb0202002.js, overwritten for window size customisations
function getCopyNZ(ur,ad,dp,primary) {
  linkUrl="allweb02.pbl?reportno=3&template=3" +
          "&urnumber=" + ur.replace(/ /g,"+") +
          "&admissno=" + ad.replace(/ /g,"+") +
          "&deptcode=" + dp.replace(/ /g,"+") +
          "&copyflag=1";
  if(primary=="Yes") {
    linkUrl+="&sacsvisn=" + ad.replace(/ /g,"+")
  }
  Left=(document.body.clientWidth-980)/2
// CTAS-mw Increase window size on copy referral screen
  DFrameLink(linkUrl,0,Left,1300,900)
}
// for update screen
function getUpdate(ur,ad,dp) {
  linkUrl="allweb02.pbl?reportno=2&template=3" +
          "&urnumber=" + ur.replace(/ /g,"+") +
          "&admissno=" + ad.replace(/ /g,"+") +
          "&deptcode=" + dp.replace(/ /g,"+");
  Left=(document.body.clientWidth-980)/2
// CTAS-mw increase window size on update referral screen
  DFrameLink(linkUrl,10,Left,1300,900)
}
// end of change

// 01 : CTAS : Based on Standard.js
// This is a workaround since the standard function creates an issue with
// the embedded iframe. Overloaded only for Referral Details view
function UniCareDFrameLink(SelectOption)
{
  document.PatientLinks.action         = SelectOption[0];
  document.PatientLinks.reportno.value = SelectOption[1];
  document.PatientLinks.template.value = SelectOption[2];

  var patientForm = document.getElementById('PatientLinks');
  var superlev;
  for (var i=0; i<document.PatientLinks.elements.length;i++) {
     if(document.PatientLinks.elements[i].name == 'superlev') {
       superlev = document.PatientLinks.elements[i];
     }
  }

  if(typeof superlev != 'undefined'){
    if(typeof SelectOption[6] != "undefined") {
      superlev.value = SelectOption[6];
    }else {
      superlev.value = "0";
    }
  }else if (typeof SelectOption[6] != 'undefined') {
     var the_field = document.createElement('INPUT');
     the_field.setAttribute('value', '1');
     the_field.setAttribute('name', 'superlev');
     the_field.setAttribute('type','hidden');
     the_field.id = "superlev";
     the_field.value = 1;
     patientForm.appendChild(the_field);
  }
//
  // added st
  var addedLink = ""
  // added en++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++
  if(SelectOption[7]!=undefined && SelectOption[7].length >= 9) {
    var cgi_name=SelectOption[7].substr(0,8);
    var cgi_value=SelectOption[7].substr(9);
    var the_field, the_form = document.getElementById('PatientLinks');
    the_field=document.createElement('INPUT');
    the_field.setAttribute('name',cgi_name);
    the_field.setAttribute('type','hidden');
    the_field.setAttribute('value',cgi_value);
    //PatientLinks.insertBefore(the_field);
    patientForm.appendChild(the_field);
	// added st
	addedLink="&"+SelectOption[7];
	// added en
  }
//
  // commented - st
  // DFrameStart();
  // document.PatientLinks.target = "PopUpFrame";
  // document.PatientLinks.submit();
  // commented - en
//
  var MaxWidth  = document.body.clientWidth;
  var MaxHeight = document.body.clientHeight -
                  PatientMenu.offsetTop - PatientMenu.offsetHeight;

  var top = PatientMenu.offsetTop + PatientMenu.offsetHeight;

  var w = (SelectOption[4] > MaxWidth ) ? MaxWidth  : SelectOption[4];
  var h = (SelectOption[5] > MaxHeight) ? MaxHeight : SelectOption[5];
  var l = (MaxWidth - w) / 2;

  PopUpScreen.style.top     = top + 'px';
  PopUpScreen.style.left    = l + 'px';
  PopUpScreen.style.width   = w   + 'px';
  PopUpScreen.style.height  = h   + 'px';
  PopUpScreen.style.display = "";
  
  // added st
  var linkUrl= SelectOption[0]+"?reportno="+ SelectOption[1]+"&template=" + SelectOption[2] +
           "&urnumber=" + PatientLinks.urnumber.value.replace(/ /g,"+") +
           "&admissno=" + PatientLinks.admissno.value.replace(/ /g,"+") +
           "&deptcode=" + HiddenFields.refrdept.value.replace(/ /g,"+") + addedLink;
		   
  DFrameLink(linkUrl,top,l,w,h);
  // added en
  
}
// end of change

</script>
</head>
%START.OF.PAGE
<body onload="PageLoad(event);setTimeout('DisplayDIVSNZ()',100);SetFormFocus();
getCloseReferralCookie();displayStatusOptions();checkReject();">
<div id=PatientHeading></div>
<script type="text/javascript">
PatientURN="%ALLWEB02.02.003";
PatientVIS="%ALLWEB02.02.081";
PatientNAM="%ALLWEB02.02.002";
PatientSTA="%ALLWEB02.02.086.078";
PatientALT="%ALLWEB02.02.084";
PatientSEX="%ALLWEB02.02.019";
PatientDOB="%ALLWEB02.02.020";
PatientAGE="%ALLWEB02.02.021";
PatientLOC="%ALLWEB02.02.083";
PatientPRI="%ALLWEB02.02.086.066.1";
PatientUNT="%ALLWEB02.02.066.0";
DoctorCOD="%ALLWEB02.02.082.003";
DoctorNAM="%ALLWEB02.02.082.002";
PatientAID="%ALLWEB02.02.086.090";
PatientIND="%ALLWEB02.02.086.091";
PatientCUR="%ALLWEB02.02.086.092";
PatientCLC="%ALLWEB02.02.086.093.1";
PatientCLH="%STANDARD.01.017.CL";
PatientHFT="%ALLWEB02.02.086.094";
PatientCDM="%ALLWEB02.02.086.095";
PatientVDH="%ALLWEB02.02.086.099.015";
InsertPatientHeader()
</script>
<div id=PatientMenu></div>

<form name=HiddenFields style="margin:0">
<input type=hidden name=wbsedall value="%STANDARD.01.028">
<input type=hidden name=refrdept value="%ALLWEB02.02.125.1">
<input type=hidden name=deptindc value="%ALLWEB02.02.125.3">
<input type=hidden name=refrstat value="%ALLWEB02.02.103">
<input type=hidden name=rfstcode value="%ALLWEB02.02.199.027">
<input type=hidden name=activenc value="%ALLWEB02.02.251">
<input type=hidden name=groupcnt value="%ALLWEB02.02.253">
<input type=hidden name=bookedop value="%ALLWEB02.02.254">
<input type=hidden name=refrejct value="%ALLWEB02.02.936">

<!-- 01 : CTAS : add hidden fields -->
<input type=hidden name=isprim value="%ALLWEB02.02.144">
<input type=hidden name=stt value="%ALLWEB02.02.103 " >
<!-- end of change -->
</form>

<table width=100% cellspacing=0 cellpadding=1 border=0>
<tr>
  <td class=HeadingCell width=10%>
    <select class=PMenuSelectList name=viewlink id=viewlink onchange="ViewLink(this);">
    <option>---- Status Update ----</option>
    <option value="0">Inactivate</option>
    <option value="1">Reactivate</option>
    <option value="2">Close</option>
    <option value="3">Cancel</option>
    <option value="4">Reject</option>
    <option value="5">Reinstate</option>
    </select>
  </td>
  <td class=HeadingCell width=10%>
<span id=OutpatMenu style="display:none">
    <select class=PMenuSelectList name=viewoutp id=BookingMenu
	onchange="ViewOutpatientLink(this);">
    <option>--Outpatient Bookings--</option>
    <option value="0">Book Outpatient</option>
    <option value="1">Series Booking</option>
    <option value="2">Multiple HCP Series Booking</option>
    <option value="3">Linked Visits</option>
    </select>
</span>
<!-- 07 : Merge Task 0865482 -->
<span id=OutpatMenuPrimary style="display:none">
    <select class=PMenuSelectList name=viewoutp id=BookingMenu
     onchange="ViewOutpatientLink(this);">
    <option>--Outpatient Bookings--</option>
    <option value="3">Linked Visits</option>
    </select>
</span>
<!-- End of Change -->	   
<!-- 06 : Merge task 0867136 : Add carelogistics menu-->
<span id=CareLogisticMenu style="display:none">
    <select class=PMenuSelectList name=viewoutp id=BookingMenu
     onchange="ViewOutpatientLink(this);">
    <option>-- Care Logistics --</option>
    <option value="4">Book Appointment</option>
    <option value="0">Book Outpatient</option>
    <option value="1">Series Booking</option>
    <option value="2">Multiple HCP Series Booking</option>
    <option value="3">Linked Visits</option>
    </select>
</span>
</td>
<!-- 06 : End of change -->
<td class=HeadingCell width=10%>
<span id=MHMenu style="display:none">
    <select class=PMenuSelectList name=viewmh
     onchange="ViewMHLink(this);">
    <option>--MH Details--</option>
    <option value="0">Legal Status Referrals</option>
    <option value="1">Outcome Measures</option>
<!-- 01 : CTAS : add option 4 - v10.07 -->
    <option value="4">All Outcome Measures Details</option>
<!-- end of change -->
	<option value="2">Outcome Supervisor</option>
    <option value="3">Supplementary Consumer Record</option>
    </select>
</span>
</td>
<td class=HeadingCell width=10%>
<span id=WLMenu style="display:none">
    <select class=PMenuSelectList name=viewwl
     onchange="ViewWLLink(this);">
    <option>--Waiting List--</option>
    <option value="0">Add Procedure</option>
    <option value="1">View Linked Waiting List</option>
    </select>
</span>
</td>

  <td class=HeadingCell align=center>
    %ALLWEB02.02.125.0   Referral Details
  </td>
</tr>
</table>

<table width=98% align=center cellspacing=0 cellpadding=1 border=0>
<tr>
  <td class=DataLabel>%ALLWEB02.02.186.8</td>
  <td class=DataField width=20%>%ALLWEB02.02.186.0</td>
  <td class=DataLabel>Status Code</td>
  <td class=DataField width=20%>%ALLWEB02.02.103  %ALLWEB02.02.199.017</td>
<!-- 01 : CTAS : swap date of referral and date referral received labels
    <td class=DataLabel>Referral Date</td>
-->
    <td class=DataLabel>Referral Received Date</td>
<!-- end of change -->
  <td class=DataField width=20%>%ALLWEB02.02.119</td>
</tr>

<tr>
  <td class=DataLabel>%ALLWEB02.02.135.8</td>
  <td class=DataField>%ALLWEB02.02.135.0</td>
  <td class=DataLabel>Case Team</td>
  <td class=DataField>%ALLWEB02.02.148.0</td>
  <td class=DataLabel>Responsible HCP</td>
  <td class=DataField>%ALLWEB02.02.138.0</td>
</tr>

<tr>
  <td class=DataLabel>Reason for Referral</td>
  <td class=DataField colspan=3>%ALLWEB02.02.149</td>
  <td class=DataLabel>%ALLWEB02.02.199.011.8</td>
  <td class=DataField>%ALLWEB02.02.199.011.0</td>
</tr>

<tr>
  <td class=DataLabel>Created By</td>
  <td class=DataField>%ALLWEB02.02.163 %ALLWEB02.02.161 %ALLWEB02.02.162.1</td>
  <td class=DataLabel>Last Updated By</td>
  <td class=DataField>%ALLWEB02.02.166 %ALLWEB02.02.164 %ALLWEB02.02.165</td>
  <td class=DataLabel>%ALLWEB02.02.199.013.8</td>
  <td class=DataField>%ALLWEB02.02.199.013.0</td>
</tr>

<tr>
  <td align=center colspan=6>
    <br>
    <input type=button class="button" value="List Contacts" name=episbutt
     onclick="location.href='%ALLWEB02.02.001.allweb03.01.001';">
    <span id=InsertEpisodeButtons>
      <input type=button class="button" value="Add Contact"
       onclick="AddEnc('%ALLWEB02.02.003','%ALLWEB02.02.081','%ALLWEB02.02.125.1','%ALLWEB02.02.103');">
    </span>
    <input type=button class="button" value="Update" name=btnUpdate
     onclick="getUpdate('%ALLWEB02.02.003','%ALLWEB02.02.081','%ALLWEB02.02.125.1');">
    <input type=button class="button" value="Referral List"
     onclick="location.href='%ALLWEB02.02.001.allweb02.02.001';">
    <span id=InsertCopyButtons>
      <select class=PMenuSelectList name=c_allrf001 id="copselct"
       title="Copy referral to department" onmouseover="MenuOver(event, this);"
       onchange="getCopyNZ('%ALLWEB02.02.003','%ALLWEB02.02.081',this.value,'%ALLWEB02.02.144');">
        <option>--- Copy Referral ---</option>
        %ALLWEB02.02.208
      </select>
    </span>
    <span id=InsertSACSButtons style="display: none">
	<!-- 01 : CTAS : Hide Internal referral
      <select class=PMenuSelectList name=d_allrf001 id=d_allrf001
       onmouseover='MenuOver(event, this)' onchange="AddNewReferral(this);">
        <option>--- Internal Referral ---</option>
        ALLWEB02.02.208
      </select>
      <input type=button class="button" value="Linked Referrals" name=linkbutt
       onclick="LnkRef('ALLWEB02.02.003','ALLWEB02.02.081','ALLWEB02.02.125.1')";>
	 -->
	    <select class=PMenuSelectList name=d_allrf001 id=d_allrf001
       onmouseover='MenuOver(this)' onchange="AddNewReferral(this);" style="display: none">
        <option>--- Internal Referral ---</option>
        %ALLWEB02.02.208
      </select>
      <input type=button class="button" value="Linked Referrals" name=linkbutt
       onclick="LnkRef('%ALLWEB02.02.003','%ALLWEB02.02.081','%ALLWEB02.02.125.1')";>
      <!--CTAS 05 : Unhide Linked Referral button Test style="display: none"> -->
	 <!-- end of change -->
    </span>
	
    <input type=button class="button" value="Notes" name=comtbutt
     onclick="PatientLinkTo('cliweb06.pbl',7,1,1,900,300);">
    <span id=ExtRefBut style="display: none">
      <input type=button class="button" value="External Referral" name=exrfbutt
       onclick="location.href='%ALLWEB02.02.001.allweb02.08.001';">
    </span>
    <span id=ResAdmBut style="display: none">
	<!-- 01 : CTAS : Rename button
     <input type=button class="button" value="Residential Admis." name=readbutt
       onclick="location.href='ALLWEB02.02.001.allweb03.01.008';"">
	-->
	 <input type=button class="button" value="Admission" name=readbutt id=readbutt
       onclick="location.href='%ALLWEB02.02.001.allweb03.01.008';">
	<!-- end of change -->
    </span>
    <span id=InsertReqAppButton style="display: none">
      <input type=button class="button" value="Request Appts" name=reqabutt
       onclick="PatientLinkTo('outweb08.pbl',08,1,0,0,0);">
    </span>
    <span id=AssessBut style="display: none">
      <input type=button class="button" value="Assessments" name=assebutt
       onclick="location.href='%ALLWEB02.02.001.allweb06.05.001';">
    </span>
    <br>
    <hr>
  </td>
</tr>
</table>

<!-- 01 : CTAS : add PrimFrame div for mental health recovery plan details -->
<div id="PrimFrame" style="display:none;"></div>
<!-- end of change -->

<span id="Last5Contacts" style="display:none">
<table width=100% border=1 cellspacing=0 cellpadding=1>
<tr>
  <td align=center class=HeadingCell colspan=5>
    Last 5 Contacts
  </td>
</tr>
<tr>
  <td class=HeadingCell>Date & Time</td>
  <td class=HeadingCell>Provider</td>
  <td class=HeadingCell>Service Input</td>
  <td class=HeadingCell>%STANDARD.01.017.CL</td>
  <td class=HeadingCell width=10%>Notes / Other</td>
</tr>
<tr><td>&nbsp;</td><td>&nbsp;</td><td>&nbsp;</td>
    <td>&nbsp;</td><td>&nbsp;</td></tr>

%ALLWEB02.02.225.allweb03.01.003

</table>
</span>

<span id="ClinicDoc" style="display:none">

<form name=AddDocumentLink action=../cgi-bin/cliweb08.pbl method=get>
<input type=hidden name=reportno value=1>
<input type=hidden name=template value=011>
<input type=hidden name=urnumber value="%ALLWEB02.02.003">
<input type=hidden name=admissno value="%ALLWEB02.02.101">
<input type=hidden name=referlky value="%ALLWEB02.02.101">

<table width=100% border=1 cellspacing=0 cellpadding=1>
<tr>
  <td colspan=4 bgcolor=#cccccc align=right>
    <input type=button class="button NoAutoFocus" value="Add File"
     onClick='DFrameSubmit(AddDocumentLink,100,150,500,250);'>
  </td>
</tr>

<tr>
  <td colspan=4 class=HeadingCell align=center>
    Clinical Documentation
  </td>
</tr>
<tr>
  <td class=HeadingCell>Linked Documents</td>
  <td class=HeadingCell>Description</td>
  <td class=HeadingCell>Date Input</td>
  <td class=HeadingCell>Input By</td>
</tr>
<tr><td>&nbsp;</td><td>&nbsp;</td>
    <td>&nbsp;</td><td>&nbsp;</td></tr>
 %ALLWEB02.02.202
</table>
</form>
</span>

<form name=MarkActn action=allweb02.pbl method=post style="margin:0">
<input type="hidden" name="reportno" value="02">
<input type="hidden" name="updatety" value="S">
<input type="hidden" name="nextpage" value="1">
<input type="hidden" name="urnumber" value="%ALLWEB02.02.003">
<input type="hidden" name="admissno" value="%ALLWEB02.02.101">
<input type="hidden" name="redirect" value="%ALLWEB02.02.001.allweb02.02.002">

<table width=100% border=1 cellspacing=0 cellpadding=0>
<tr>
  <td bgcolor=#cccccc align=left>
    <input type=button class="button" value="Audit" name=audtbutt
     onclick="PatientLinkTo('allweb02.pbl',2,13,0,0,0);">
    <span id="LetterHistory" style="display:none">
      <input type="button" value="Letter History" name="btnLetterHistory" 
       class="button" onclick="PatientLinkTo('allweb02.pbl',2,15,0,0,0);">
    </span>
  </td>
  <td align=right bgcolor=#CCCCCC>
    Action Code
    <select name=actncode class="selectBig NoAutoFocus">
      <option></option>
      %ALLWEB02.02.207.2
    </select>
    Comment
    <input type=text name=commenty class="NoAutoFocus" size=40 maxlength=50>
    <input type=submit name=markactn Value="Save Action" class="button NoAutoFocus">
  </td>
</tr>
</table>
</form>
      
<span id="RefActAud" style="display:none">
<table width=100% border=1 cellspacing=0 cellpadding=1>
<tr>
  <td colspan=5 class=HeadingCell align=center>
    Referral Action Audit
  </td>
</tr>

<tr>
  <td class=HeadingCell>Web User</td>
  <td class=HeadingCell>Date & Time</td>
  <td class=HeadingCell>Action Code</td>
  <td class=HeadingCell>Update Type</td>
  <td class=HeadingCell>Comment</td>
</tr>
%ALLWEB02.02.221.allweb02.15.001
</table>

<table width=100% bgcolor=#CCCCCC>
<tr>
  <td align=center>
    <input type=button value="<< Previous" class="button"
     onClick='location.href="%ALLWEB02.02.219.002"'>
    <input type=button value="Next >>" class="button"
     onClick='location.href="%ALLWEB02.02.220.002"'>
  </td>
</tr>
</table>
</span>

<form name=AddReferral method=get action=allweb02.pbl>
<input type=hidden name=reportno value=3>
<input type=hidden name=template value=1>
<input type=hidden name=urnumber value="%ALLWEB02.02.003">
<input type=hidden name=sacsvisn value="%ALLWEB02.02.101">
<input type=hidden name=allrf001 value="">
<input type=hidden name=saveprim value="1">
</form>

<form name=PatientLinks id=PatientLinks method=get>
<input type=hidden name=reportno value=01>
<input type=hidden name=template value=002>
<input type=hidden name=urnumber value="%ALLWEB02.02.003">
<input type=hidden name=admissno value="%ALLWEB02.02.081">
<input type=hidden name=refrlvis value="">
<input type=hidden name=bookflag value="">
<input type=hidden name=wbsesite value="%STANDARD.01.023">
<input type=hidden name=ibcnumci value="%STANDARD.01.025.000.132.0.1">
<input type=hidden name=d_alref083 value="%ALLWEB02.02.144">
<input type=hidden name=d_aldep017 value="%ALLWEB02.02.509">
<input type=hidden name=wbsedall value="%STANDARD.01.028">
<input type=hidden name=d_aldep020 value="%ALLWEB02.02.512">
<input type=hidden name=usrsvrsl value="%STANDARD.01.042.ALLWEB02">
<!-- 01 : CTAS : add hidden field -->
<input type=hidden name=primref value="%ALLWEB02.02.508">
<!-- end of change -->
</form>

<script type="text/javascript">
document.getElementById('readbutt').value = window.ResidentialAdmDescription;

// 06 : Merge task 0867136 - update formatting and add carelogistics
function ViewOutpatientLink(OptionLink) {
   switch (OptionLink.value) {
    case "0": {
      CheckRefStat();
      break; }
    case "1": {
      BookPatientS('%ALLWEB02.02.182.1',
                   '%ALLWEB02.02.103',
                   '%ALLWEB02.02.199.017');
      break; }
    case "2": {
      BookPatientMHCPS('%ALLWEB02.02.182.1',
                       '%ALLWEB02.02.103',
                       '%ALLWEB02.02.199.017');
      break; }
    case "3": {
      LnkVis('%ALLWEB02.02.003',
             '%ALLWEB02.02.081',
             '%ALLWEB02.02.125.1');
      break; }
    case "4": {
      OpenCareLogisticsReferral('%ALLWEB02.02.125.1',
                                '%ALLWEB02.02.195',
                                '%ALLWEB02.02.128.1',
                                '%ALLWEB02.02.122.1',
                                '%ALLWEB02.02.138.1');
      break; }
  }
  OptionLink.selectedIndex=0;
}
function CheckRefStat() {
  if(!isWhitespace("%ALLWEB02.02.101") &&
     !isWhitespace("%ALLWEB02.02.199.027")) {
     if("%ALLWEB02.02.199.027"!="0" &&
        "%ALLWEB02.02.199.027"!="1") {
       alert ("This Referral was closed on %ALLWEB02.02.107");
       return;
     }
  }
  BookPatient('%ALLWEB02.02.182.1','%ALLWEB02.02.103',
                        '%ALLWEB02.02.199.017','%ALLWEB02.02.240');
}

// 01 : CTAS : add MH Details option 3 - v10.07
function AllMeasuresDetails() {
  PatientLinkTo("allweb06.pbl",4,25,0,0,0);
}
// end of change 

function ViewMHLink(OptionLink) {
switch (OptionLink.value) {
case "0": { MHReferrals(); break; }
case "1": { HONOSDetails(); break; }
case "2": { HONOSSupervisor(); break; }
case "3": { SuppConsumerRecord(); break; }
// 01 : CTAS : add option 4 - v10.07
case "4": { AllMeasuresDetails(); break; }
// end of change
}
OptionLink.selectedIndex=0;
}
 CommentIndicator="%ALLWEB02.02.218";
 if ( CommentIndicator =="1" ) {
    document.all.comtbutt.className="RedButton";
 }
EpisdIndicator="%ALLWEB02.02.230";
if ( EpisdIndicator =="1" ) {
   document.all.episbutt.className="RedButton";
}
ExrefIndicator="%ALLWEB02.02.231";
if ( ExrefIndicator =="1" ) {
   document.all.exrfbutt.className="RedButton";
}
LinkRIndicator="%ALLWEB02.02.232";
if ( LinkRIndicator =="1" ) {
   document.all.linkbutt.className="RedButton";
}
ResAdIndicator="%ALLWEB02.02.247";
if ( ResAdIndicator =="1" ) {
   document.all.readbutt.className="RedButton";
}
if ( document.PatientLinks.d_aldep020.value =="1" ) {
     InsertEpisodeButtons.style.display="none";
}
if ( HiddenFields.deptindc.value.substr(6,1)=="M" &&
     HiddenFields.refrstat.value.substr(0,6)=="Closed" ) {
     InsertCopyButtons.style.display="none";
}
// 07 : Merge Task 0865482
UsingRequestAppt="%STANDARD.01.025.032.136.0.1";
if ( ("%ALLWEB02.02.246.4" == "1") ||
     (UsingRequestAppt == "1") ){
if((document.PatientLinks.d_alref083.value=="Yes") &&
      (document.PatientLinks.d_aldep020.value=="1" )) {
   } else {
  InsertReqAppButton.style.display="";
  RequestAppt="%ALLWEB02.02.239";
  if ( RequestAppt == "1" ) {
    document.all.reqabutt.className="RedButton";
  }
  }
}
//End of change
UsingExtRef="%ALLWEB02.02.246.1";
if (UsingExtRef == "1") {
  ExtRefBut.style.display="";
}
UsingResAdm="%ALLWEB02.02.246.2";
if (UsingResAdm == "1") {
  // 01 : CTAS : Hide for primary MH 
  // (assumption that admission btn will only be available for primary)
  primary=document.PatientLinks.d_alref083.value;
  if(primary!="Yes") {
  // end of change
  ResAdmBut.style.display="";
  // 01 : CTAS : Hide for primary MH
  }
  // end of change
}
UsingAssess="%ALLWEB02.02.246.3";
if (UsingAssess == "1") {
  AssessBut.style.display="";
  AssessInd="%ALLWEB02.02.275";
  if ( AssessInd =="1" ) {
    document.all.assebutt.className="RedButton";
  }

}
DisplayLast5Contacts="%ALLWEB02.02.246.5";
if (DisplayLast5Contacts == "1") {
  Last5Contacts.style.display="";
}
DisplayClinicDoc="%ALLWEB02.02.246.6";
if (DisplayClinicDoc == "1") {
  ClinicDoc.style.display="";
}
DisplayActAud="%ALLWEB02.02.246.7";
if (DisplayActAud == "1") {
  RefActAud.style.display="";
}
DisplayLetHis="%ALLWEB02.02.246.8";
if (DisplayLetHis == "1") {
  LetterHistory.style.display="";
}

DoNotCopyRef="%ALLWEB02.02.246.9.07";

function SetFormFocus() {
  if (document.activeElement && (document.activeElement.type == undefined)) {
    if (document.all.btnUpdate) document.all.btnUpdate.focus();
  }
}

//Checks if the referral is to be rejected, and opens the reject template
function checkReject() {
  if (HiddenFields.refrejct.value == 1) {
    getReject('%ALLWEB02.02.003','%ALLWEV02.02.081','%ALLWEB02.02.125.1');
  }
}

</script>
