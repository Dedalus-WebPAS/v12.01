<meta name="TemplateVersion" content="V12.01.00">
<meta name="TemplateHome" content="crdhb">
<meta name="HelpFileName"    content="NoContextSet.html">
<script type="text/javascript" src="../js/mehweb0109002.js"></script>
<script type="text/javascript" src="../js/mehweb0109004.js"></script>
<script type="text/javascript">
function FormSubmit() {
  strtDate = UpdateForm.mhhls002;
  strtTime = UpdateForm.mhhls003;
  endDate  = UpdateForm.mhhls004;
  endTime  = UpdateForm.mhhls005;
  if(!ChkDateTime(strtDate,strtTime,endDate,endTime)) {
     alert("Start Date/Time must be before End Date/Time");
     UpdateForm.mhhls002.select();
     return;
  }
  if(!isWhitespace(document.UpdateForm.mhhls005.value) &&
     isWhitespace(document.UpdateForm.mhhls004.value)) {
     alert("End Time is not blank, End Date must be entered");
     return;
  }

//                   ------- "Active" flag ------
  if(document.UpdateForm.refstat1.checked == true) {
     document.UpdateForm.mhhls006.value="0";
  } else {
     document.UpdateForm.mhhls006.value="1";
  }

//                   ------- "Current" flag ------
  if (isWhitespace(document.UpdateForm.mhhls004.value)) { 
      document.UpdateForm.mhhls018.value="1";
  } else {
      document.UpdateForm.mhhls018.value="0";
  }

//                   ------- "Prisoner" flag ------
  if(document.UpdateForm.refpris1.checked == true) {
     document.UpdateForm.mhhls019.value="1";
  } else {
     document.UpdateForm.mhhls019.value="0";
  }

//                   ------- "not fit to Drive" flag ------
  if(document.UpdateForm.refnodrv.checked == true) {
     document.UpdateForm.mhhls026.value="1";
  } else {
     document.UpdateForm.mhhls026.value="0";
  }

  if (validateMandatory(UpdateForm)) {
      document.UpdateForm.submit(); 
  } 
}

</script>
</head>
%START.OF.PAGE
<body onload="PageLoad(event);InitRef();">
<span class=DFrameTitleBar>
<img align="right" alt="Exit" class="MenuIcon"
 src="../images/ExitIcon.gif" onclick="DFrameExit();">
Input Referral Details
</span>
<div id=PageBodySection >
<table cellspacing=0 cellpadding=1 border=0 width=100%>
<form name=UpdateForm method=post action=mehweb01.pbl>
<input type=hidden name=urnumber value="%MEHWEB01.09.003">
<input type=hidden name=admissno value="%MEHWEB01.09.081">
<input type=hidden name=uniqnumb value="%MEHWEB01.09.101">
<input type=hidden name=defgpcod value="%MEHWEB01.09.323.1">
<input type=hidden name=defgpnam value="%MEHWEB01.09.323.0">
<input type=hidden name=reportno value="9">
<input type=hidden name=template value="004">
<input type=hidden name=updttype value="U">
<input type=hidden name=nextpage value="0">
<input type=hidden name=redirect>
<input type=hidden name=mhhls006>
<input type=hidden name=mhhls018>
<input type=hidden name=mhhls019>
<input type=hidden name=mhhls026>
<input type=hidden name=refcurr1>
<input type=hidden name=prisoner value="%MEHWEB01.09.119.0">
<input type=hidden name=nodriver value="%MEHWEB01.09.127.0">
<input type=hidden name=currdate>
<input type=hidden name=currtime>
<input type=hidden name=d_mhhls002 value="%MEHWEB01.09.102">
<input type=hidden name=mhhls036 value="%MEHWEB01.09.141.1">
<input type="hidden" name="mhcnrdhb" id="mhcnrdhb"
 value="%STANDARD.01.025.069.192.0.1" />

<table cellspacing=0 cellpadding=1 border=0 width=100%>

   <tr><td class=DataLabel width=20%>Start Date</td>
       <td><input type=text name=mhhls002 size=12 class=Readonly
          readonly value="%MEHWEB01.09.102" title="Start Date">
          &nbsp; &nbsp; &nbsp; &nbsp; Time     
     <input type=text name=mhhls003 size=10 maxlength=10 class=Readonly
        readonly value="%MEHWEB01.09.103" title="Start Time">
    </td>
   </tr>

   <tr><td class=DataLabel>End Date </td>
       <td><input type=text size=12 name=mhhls004 tabindex=3
            class="NotFuturEdate" title="End Date" onblur="setEndTime();validateTime(mhhls004,mhhls005);";
            value="%MEHWEB01.09.104">
        <img notab src=../images/DateLookup.gif border=0 hspace=4
          align=absmiddle onclick="DateLookupFrame(mhhls004);">
          Time
       <input type=text name=mhhls005 size=8 tabindex=4 
          value="%MEHWEB01.09.105" title="End Time"
          onblur="validateTime(mhhls004,mhhls005);">
        <img notab src=../images/DateTimeStamp.gif border=0 hspace=4
         align=absmiddle onClick="SetCurrentDateTime(mhhls004,mhhls005);">
       <img notab src=../images/TimeLookup.gif border=0 hspace=4 align=absmiddle
         onclick="TimeLookupFrame(mhhls005);">
    </td>
   </tr>

  <tr><td class=DataLabel>Referral Source</td>
    <td><select name=mhhls007 onchange="DispRef()"; tabindex=5
         title="Referral Source" tabindex=5 value="%MEHWEB01.09.107.1">
         <option> </option>
         %MEHWEB01.09.107.2
         </select></td>
   </tr>

  <tr><td colspan=2><div id=ExtOrg></div></td></tr>

  <tr><td colspan=2><div id=ResDHB></div></td></tr>

<!--           0=All Active HCPs 1=Active Attending ==> 9=M/H HCPs   -->
<tr><td class=DataLabel>Responsible Clinician</td>
    <td><input type="text" size=10 maxlength=10 name="mhhls021" tabindex=7
         value="%MEHWEB01.09.122.1"
         onblur="UpCase(this);ValidateHCP(18,18,mhhls021,doctnam2);"
         onchange="getCaseTeamByHCP(mhhls021,mhhls022,n_mhhls022,d_mhhls002);">
       <input type="text" size=25 notab readonly name="doctnam2"
         value="%MEHWEB01.09.122.0">
       <img src="../images/SearchIcon.gif" class=Icon
         onclick="hcpOnChange(mhhls021,doctnam2,mhhls022,n_mhhls022,d_mhhls002);" >
       <img src="../images/ClearIcon.gif" class=Icon
            onClick="clrFields(mhhls021,doctnam2);">
       <td></tr>

<tr><td class=DataLabel>Case Team</td>
    <td><input type=text name=mhhls022 size=11 maxlength=10 title="Case Team"
         value="%MEHWEB01.09.123.1"
         onblur="validateCode2(7,mhhls022,n_mhhls022)" tabindex=8
         onchange="getHCPbyCaseTeam(mhhls022,mhhls021,doctnam2,d_mhhls002);">
       <input type=text name=n_mhhls022 size=29 readonly
         value="%MEHWEB01.09.123.0"
         class=Readonly tabindex=-1 title="Team Description">
       <img src="../images/SearchIcon.gif" class=Icon
         onclick="caseTeamOnChange(mhhls022,n_mhhls022,mhhls021,doctnam2,d_mhhls002)">
       <img src="../images/ClearIcon.gif" class=Icon
         onClick="clrFields(mhhls022,n_mhhls022);">
       </td>
</tr>

<tr><td class=DataLabel>Duly Authorised Officer</td>
    <td><input type="text" size=10 maxlength=10 name="mhhls023" tabindex=9
         value="%MEHWEB01.09.124.1"
         onblur="UpCase(this);ValidateHCP(18,18,mhhls023,doctnam3);">
       <input type="text" size=25 notab readonly name="doctnam3"
         value="%MEHWEB01.09.124.0">
       <img src="../images/SearchIcon.gif" class=Icon
         onclick="HCPSearchFrame(UpdateForm.mhhls023,UpdateForm.doctnam3,0);">
       <td></tr>

<tr><td class=DataLabel>Key Worker</td>
    <td><input type="text" size=10 maxlength=10 name="mhhls024" tabindex=10
         value="%MEHWEB01.09.125.1"
         onblur="UpCase(this);ValidateHCP(18,18,mhhls024,doctnam4);">
       <input type="text" size=25 notab readonly name="doctnam4"
         value="%MEHWEB01.09.125.0">
       <img src="../images/SearchIcon.gif" class=Icon
         onclick="HCPSearchFrame(UpdateForm.mhhls024,UpdateForm.doctnam4,0);">
       <td></tr>
</tr>

<tr><td class=DataLabel>Lawyer</td>
    <td><select name=mhhls015 title="Lawyer" tabindex=12
         value="%MEHWEB01.09.115.1">
         <option> </option>
         %MEHWEB01.09.115.2
         </select></td>
</tr>

<tr><td class=DataLabel>Lawer Text</td>
    <td><input type=text name=mhhls025 size=50 maxlength=50 tabindex=13
         value="%MEHWEB01.09.126"></td>
    </tr>

<tr><td class=DataLabel>Unfit to Drive</td>
    <td align=left>
        <input type="checkbox" name=refnodrv value="0" tabindex=14
         onclick="DispUdate()";></td>
    </tr>
<tr><td colspan=2><div id=UtdDate></div></td></tr>

<tr><td class=DataLabel>Prisoner</td>
    <td align=left>
        <input type="checkbox" name=refpris1 value="0" tabindex=16
         onclick="DispSdate()";></td>
    </tr>
<tr><td colspan=2><div id=SenDate></div></td></tr>

<tr><td class=DataLabel>Comments</td>
    <td><input type=text name=mhhls028 size=100 maxlength=100 tabindex=18
         value="%MEHWEB01.09.129"></td>
    </tr>

<tr><td align=left>Active</td>
    <td align=left>
       <input type="checkbox" name=refstat1 value="0" tabindex=19
        onclick="checkActive()";></td>
   </tr>

<!--                        --- removed CAR 195158 --
    <tr><td align=left>Current</td>
        <td align=left>
        <input type="checkbox" name=refcurr1 value="0" tabindex=18>
        </td>
    </tr>
  -->

    <tr align=center>
       <td colspan=4 align=center><br>
       <input tabindex=31 type=button value="Update" class="button"
        onClick=FormSubmit();>
       <input type=button value=Close class="button"
        onclick="DFrameCloseRefresh()">
     </td></tr>
</form>
</table>

<form name=PatientLinks method=get>
<input type=hidden name=reportno value=1>
<input type=hidden name=template value="004">
<input type=hidden name=urnumber value="%MEHWEB01.09.003">
<input type=hidden name=admissno value="%MEHWEB01.09.081">
<input type=hidden name=MenuType value="%MEHWEB01.09.088">
</form>
</div>

<script type="text/javascript">
 if ("%MEHWEB01.09.106.0"==0) {
     document.UpdateForm.refstat1.checked="1";
 }

 if ("%MEHWEB01.09.118.0" == "1") {
     document.UpdateForm.refcurr1.checked=true;
 }
 EndDate=trim("%MEHWEB01.09.104");
 EndTime=trim("%MEHWEB01.09.105");
 if (EndDate=="" && EndTime=="")  {
    document.UpdateForm.refcurr1.checked=false;
 } else {
    document.UpdateForm.refcurr1.checked=true;
 }

 if ("%MEHWEB01.09.127.0" == "1") {
     document.UpdateForm.refnodrv.checked=true;
 }

 if ("%MEHWEB01.09.119.0" == "1") {
     document.UpdateForm.refpris1.checked=true;
 }

//           ------- functions ---------
function setEndTime() {
//  actvdets="%MEHWEB01.09.130";
  actvdets="%MEHWEB01.09.131";
  checkDate(document.UpdateForm.mhhls004,'Date');
  if (!isWhitespace(document.UpdateForm.mhhls004.value)) {
      if (actvdets == "Y") {
          alert("Active Legal Status Details exist. \n"+
                "End Dates are required on the Details");
          document.UpdateForm.mhhls004.value="";
          return;
      }
      document.UpdateForm.mhhls005.className="Mandatory";
      document.UpdateForm.refcurr1.checked=false;
  } else {
      document.UpdateForm.mhhls005.className="";
      document.UpdateForm.refcurr1.checked=true;
  }
}

function checkActive() {
  if (document.UpdateForm.refstat1.checked == false) {
     if (isWhitespace(document.UpdateForm.mhhls004.value)) {
        alert("End Date/Time must be entered before "+
              "\n this Referral can be inactivated");
        document.UpdateForm.refstat1.checked=true;
        return;
     }
/*else {      ------ it's comparing "31 Jul 2010 > 01 Aug 2010" -----
        if (document.UpdateForm.mhhls004.value > "%STANDARD.01.015") {
        alert("This LS Referral cannot be inactivated "+
              "\n before the End Date")
        document.UpdateForm.refstat1.checked=true;
        return;
        }           
     }*/
  }
}

</script>

<span id=OrgnACode style="display:none">
<table cellspacing=0 cellpadding=1 border=0 width=100%>
<tr><td class=DataLabel width=20%>Organisation Code</td>
    <td><select name=mhhls016 title="Organisation Code" tabindex=6
         class=Mandatory onchange="GetRef();" value="%MEHWEB01.09.116.1">
         <option> </option>
         %MEHWEB01.09.116.A
         </select></td>
</tr></table>
</span>

<span id=OrgnPCode style="display:none">
<table cellspacing=0 cellpadding=1 border=0 width=100%>
<tr><td class=DataLabel width=20%>Organisation Code</td>
    <td><select name=mhhls016 title="Organisation Code" tabindex=6
         class=Mandatory onchange="GetRef();" value="%MEHWEB01.09.116.1">
         <option> </option>
         %MEHWEB01.09.116.P
         </select></td>
</tr></table>
</span>

<span id=HCPCode style="display:none">
<table cellspacing=0 cellpadding=1 border=0 width=100%>
<tr><td class=DataLabel width=20%>Referring GP</td>
    <td><input type="text" size=10 maxlength=10 name="mhhls017" tabindex=6
         value="%MEHWEB01.09.117.1"
         onblur="UpCase(this);ValidateHCP(18,0,mhhls017,doctnam1);GetRef();">
        <input type="text" size=25 notab readonly name="doctnam1"
         value="%MEHWEB01.09.117.0">
        <img src="../images/SearchIcon.gif" class=Icon
        onclick="HCPSearchFrame(UpdateForm.mhhls017,UpdateForm.doctnam1,3);">
        <img src=../images/erase.gif class=Icon alt=clear
         onclick='clrDoc(mhhls017,doctnam1);'>
     <td>
</tr></table>
</span>

<span id=Sentence style="display:none">
<table cellspacing=0 cellpadding=1 border=0 width=100%>
<tr><td class=DataLabel width=20%>Sentence Date </td>
    <td><input type=text size=12 name=mhhls020 tabindex=17
            class="Date" title="Sentence Date" value="%MEHWEB01.09.120"
            onchange="checkDate(this,'Date');">
         <img notab src=../images/DateLookup.gif border=0 hspace=4
         align=absmiddle onclick="DateLookupFrame(mhhls020);">
    </td>
</tr></table>
</span>

<span id=CantDriv style="display:none">
<table cellspacing=0 cellpadding=1 border=0 width=100%>
   <tr><td class=DataLabel width=20%>Date Client Notified</td>
       <td><input type=text size=12 name=mhhls027 tabindex=15 class="Date"
            title="Date Client Notified" value="%MEHWEB01.09.128"
            onchange="checkDate(this,'Date');">
         <img notab src=../images/DateLookup.gif border=0 hspace=4
         align=absmiddle onclick="DateLookupFrame(mhhls027);">
       </td>
</tr></table>
</span>

<span id=OrgnBCode style="display:none">
<table cellspacing=0 cellpadding=1 border=0 width=100%>
<tr><td class=DataLabel width=20%>Organisation Code</td>
<td><input type="text" size=7 maxlength=5 name=mhhls016 class=Mandatory
      title="Transfer Source" tabindex=5 value="%MEHWEB01.09.121.0"
      onchange="validateCode(9,mhhls016,trandesc);">
     <input type=text size=27 name=trandesc notab
      class=Readonly readonly value="%MEHWEB01.09.121.1">
     <img src="../images/SearchIcon.gif" 
      onClick="TransferSourceFrame(mhhls016,trandesc,mhhls007)"></td>
</tr></table>
</span>


<span id=DHBCode style="display:none">
<table cellspacing=0 cellpadding=1 border=0 width=100%>
<tr><td class=DataLabel width=20%>Responsible DHB</td>
    <!-- 01 : TAS : Make Responsible DHB editable and mandatory
	<td><input type="text" name=d_mhhls036 class=Readonly readonly
         title="Responsible DHB" notab value="MEHWEB01.09.141.0"></td> -->
	<td><select name=mhhls036 class=Mandatory
         title="Responsible DHB" tabindex=7">
         <option> </option>
         %MEHWEB01.09.141.9.1.04.1.L
         </select></td>
    <!--<td><select name=d_mhhls036 class=Readonly readonly
         title="Responsible DHB" tabindex=7">
         <option> </option>
         MEHWEB01.09.141.9.1.04.1.L
         </select></td>-->
</tr></table>
</span>

