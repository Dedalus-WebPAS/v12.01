<meta name="TemplateVersion" content="V12.01.00">
<meta name="TemplateHome" content="crdhb">
<meta name="HelpFileName"    content="NoContextSet.html">
<script type="text/javascript">
function init() {
   if(document.chgpassw.ibcnmhos.value != "1")
        document.chgpassw.wbsec031.className="SelectBig";
   if(document.chgpassw.mandward.value=="1") {
      document.chgpassw.wbsec005.className="SelectBig Mandatory";
   }
}
function ChangeForm() {
    if(validateMandatory(chgpassw))
          chgpassw.submit();
}
function DefaultHospFields() {
  getDefaultFields(document.chgpassw.wbsec031,document.chgpassw.deftward,document.chgpassw.deftsite,document.chgpassw.deftprin);

// 01 : CTAS : update hospital-dependent option lists
  // update ward list
  selectOptions2('3',document.chgpassw.wbsec031,document.chgpassw.wbsec005);
  // update referral dept list
  selectOptions2('68',document.chgpassw.wbsec031,document.chgpassw.wbsec021);
//  // update OPD site - nope: 65 is ED site code
//  selectOptions2('65',document.chgpassw.wbsec031,document.chgpassw.wbsec006);
  // update ED site list
  selectOptions2('63',document.chgpassw.wbsec031,document.chgpassw.wbsec010);
  // update printer dept list
  selectOptions2('64',document.chgpassw.wbsec031,document.chgpassw.wbsec017);
  selectWard();
  selectSite();
  selectPrin();
// end of change
}
function selectWard(){
  for (var i =0 ; i < document.chgpassw.wbsec005.length; i++) {
    if (document.chgpassw.wbsec005.options[i].value.substr(0,6)==
                 document.chgpassw.deftward.value.substr(0,6)) {
       document.chgpassw.wbsec005.selectedIndex=i } };
    if (isWhitespace(document.chgpassw.deftward)) {
      if (chgpassw.wbsec005.length==2) {
        chgpassw.wbsec005.selectedIndex=1; } }
}
function selectSite(){
  for (var i =0 ; i < document.chgpassw.wbsec010.length; i++) {
    if (document.chgpassw.wbsec010.options[i].value.substr(0,3)==
                 document.chgpassw.deftsite.value.substr(0,3)) {
       document.chgpassw.wbsec010.selectedIndex=i } };
    if (isWhitespace(document.chgpassw.deftsite)) {
      if (chgpassw.wbsec010.length==2) {
        chgpassw.wbsec010.selectedIndex=1; } }
ActiveFlag();			 
}
function selectPrin(){
  for (var i =0 ; i < document.chgpassw.wbsec017.length; i++) {
    if (document.chgpassw.wbsec017.options[i].value.substr(0,6)==
                 document.chgpassw.deftprin.value.substr(0,6)) {
       document.chgpassw.wbsec017.selectedIndex=i } };
    if (isWhitespace(document.chgpassw.deftprin)) {
      if (chgpassw.wbsec017.length==2) {
        chgpassw.wbsec017.selectedIndex=1; } }
}
function getDefaultFields(hospital,ward,site,dept) {
  if (isWhitespace(hospital.value)) {
    return;
  }
  var serverURL   = "../cgi-bin/comweb80.pbl?reportno=65" +
                    "&valdcode=" + hospital.value.replace(/ /g,"+")
  var returnValue = RSExecute(serverURL);
  if (returnValue.status==0) {
    ReturnValue=returnValue.return_value.split("|");
    document.chgpassw.deftward.value = ReturnValue[0];
    document.chgpassw.deftsite.value = ReturnValue[1];
    document.chgpassw.deftprin.value = ReturnValue[2];
    return true;
  }
  else {
    document.chgpassw.deftward.value = "";
    document.chgpassw.deftsite.value = "";
    document.chgpassw.deftdept.value = "";
    document.chgpassw.deftward.select();
    document.chgpassw.deftward.focus();
  }
}
function ActiveFlag() {
  if(document.chgpassw.wbsec010.value.substr(3,1)=="1"){
     alert("Site Code Inactive");
   }
}					   
</script>
</head>
%START.OF.PAGE
<body onLoad="PageLoad(event);">
<p>&nbsp;
<p>&nbsp;		 
<!-- 01 : CTAS : Add heading 
<p>&nbsp;-->
<h4 align=center class=HeadingCell>Currently Selected Hospital : %WEBSEC01.05.034.7 (%WEBSEC01.05.034.1)</h4>
<!-- end of change -->
<table border=2 cellspacing=0 align=center bgcolor=#CCCCCC>
<!-- 01 : CTAS : Adjust column span
<tr><td align=center class=HeadingCell><b>Change Hospital
-->
<tr><td align=center class=HeadingCell colspan=2><b>Change Hospital
<!-- end of change -->
</td></tr>
<!-- 01 : CTAS : Remove table tag
<tr><td>
<table>
end of change -->
<form name=chgpassw method=post target=_top>
<input type=hidden name=reportno value="5">
<input type=hidden name=template value="6">
<input type=hidden name=updttype value="U">
<input type=hidden name=wbsec011 value=1>
<input type=hidden name=username value="%WEBSEC01.05.001">
<input type=hidden name=wbsec029 value="%WEBSEC01.05.032">
<input type=hidden name=nextpage value="1">
<input type=hidden name=redirect value="websec01.pbl?reportno=1&template=1">
<input type=hidden name=ibcnmhos value="%STANDARD.01.025.000.043.1.1">
<input type=hidden name=wbsec014 value="%WEBSEC01.05.017.1">
<input type=hidden name=wbsec015 value="%WEBSEC01.05.018">
<input type=hidden name=mandward value="%WEBSEC01.05.065">
<input type=hidden name=chnghosp value="1">
<input type=hidden name=deftward value="">
<input type=hidden name=deftsite value="">
<input type=hidden name=deftprin value="">

<tr><td class=DataLabel>User</td>
    <td><input type=text name=name maxlength=10 class="Readonly" readonly
     value="%WEBSEC01.05.002"</td></tr>
<tr><td class=DataLabel>Hospital</td>
    <td><select name=wbsec031 class="SelectBig Mandatory" title="Hospital ID" 
                      onchange="DefaultHospFields();">
        <option></option>
        %WEBSEC01.05.034.5
        </select></td></tr>
<!-- 01 : CTAS : Follow CCDHB Format -->
<tr><td align=center class=HeadingCell colspan=2><b>Change Department</td></tr>
<!-- end of change -->
<tr><td class=DataLabel>Ward </td>
    <td>
<!-- 01 : CTAS : Set to mandatory
	<select name=wbsec005 class="SelectBig" title="Ward">
	-->
	<select name=wbsec005 class="SelectBig Mandatory" title="Ward">
        <option></option>
        %WEBSEC01.05.005.2
        </select></td></tr>
<!-- end of change -->
<!-- 01 : CTAS : add Referral Dept field -->
<tr><td class=DataLabel>Referral Dept</td>
    <td><select name=wbsec021 class="SelectBig" title="Referral Dept">
        <option></option>
        %WEBSEC01.05.051.9.1.03.1.A
    </select></td></tr>		
<!-- end of change -->
<!-- 01 : CTAS : Move Emergency site here -->
<tr><td class=DataLabel>Emergency Site</td>
    <td><select name=wbsec010 class="SelectBig" title="Emergency Site"
	    onchange="ActiveFlag();">
        <option></option>
        %WEBSEC01.05.010.3
        </select></td></tr>
<!-- end of change -->
<!-- 01 : CTAS : Add Outpatient site here -->
<!-- <tr><td class=DataLabel>Outpatient Site</td>
    <td><select name=wbsec010 class="SelectBig" title="Outpatient Site">
        <option></option>
        %WEBSEC01.05.010.3
        </select></td></tr> -->
	<tr><td class=DataLabel>Outpatient Site</td>
		<td>
		<select name=wbsec006 class="Mandatory" 
			title="Outpatient Site">
		<option></option>
		%WEBSEC01.05.076
		</select>
		</td>
	</tr>		
<!-- end of change -->
<!-- 01 : CTAS : Follow CCDHB Format -->
<tr><td align=center class=HeadingCell colspan=2><b>Change Printer Group</td></tr>
<!-- end of change -->
<!-- 01 : CTAS : Move Emergency site below Printer
<tr><td class=DataLabel>Emergency Site</td>
    <td><select name=wbsec010 class="SelectBig" title="Emergency Site">
        <option></option>
        %WEBSEC01.05.010.3
        </select></td></tr>
end of change -->
<!-- 01 : CTAS : rename Printer Department to Printer Dept for consistency
<tr><td class=DataLabel>Printer Department</td>
    <td><select name=wbsec017 class="SelectBig" title="Printer Department">
        <option></option>
        %WEBSEC01.05.020.2
        </select></td></tr>
-->
<tr><td class=DataLabel>Printer Dept</td>
    <td><select name=wbsec017 class="SelectBig" title="Printer Dept">
        <option></option>
        %WEBSEC01.05.020.2
        </select></td></tr>
<!-- end of change -->
<tr><td colspan=2 align=center>
    <input type=button class="button" value="Change" onClick="ChangeForm();">
</td></tr>
</form>
<!-- 01 : CTAS : Remove table tag
</table>
</td></tr>
end of change -->
</table>
