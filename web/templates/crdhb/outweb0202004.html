<meta name="TemplateVersion" content="V12.01.00">
<meta name="TemplateHome"    content="crdhb">
<meta name="HelpFileName"    content="NoContextSet.html"> 
<meta name="CrossBrowser"    content="true">
<script type="text/javascript" src="../js/outweb0202.js"></script>
<!-- <script type="text/javascript" src="../js/outweb02.js"></script> -->
<script type="text/javascript" src="../custom-js/outweb02.js"></script>
<script type="text/javascript" src="../js/outweb0202004.js"></script>

<style type="text/css">
td { vertical-align: text-top; }

img.ListIcon {
  border:0px;
  cursor:hand;
  margin-top:0px; 
  margin-bottom:2px; 
  margin-left:0px; 
  margin-right:3px; 
  vertical-align: text-top;
}
</style>

<script type="text/javascript">
function SummaryPage() {
  location.href="outweb02.pbl?reportno=1&template=5" +
                "&frstdate=" + UpdateStatus.sesskeys.value.substr(12,8) +
                "&lastdate=" + UpdateStatus.sesskeys.value.substr(12,8);
}
function UpdateSlot(A,B,C) {
   UpdateStatus.casekeys.value = A;
   LinkURL='patweb90.pbl?reportno=1&template=200';
   DFrameLink(LinkURL,25,50,700,420);
}
function UpdateConf(CheckBox){
  var UpdateConf = 0;
  if(CheckBox.checked){
     UpdateConf = 1;
  }
  var serverURL = "../cgi-bin/outweb02.pbl?reportno=9&updatety=8&casekeys=" 
      + CheckBox.value.replace(/ /g,"+") + "&confappt=" + UpdateConf;
  var returnValue = RSExecute(serverURL);
}
//----------------------------------------------------------------------------
// Create New Table Object
// Border, Cellspacing, Cellpadding, Width, Align, Heading Height, Row Height
//----------------------------------------------------------------------------
// Add Columns in Order Required
// Heading,Type,Display Column,Sort Column, Align, Icon, Link Column
// Columns Available
//  0 - HTML Link
//  1 - date/time
//  2 - slot
//  3 - visit type code
//  4 - visit type desc
//  5 - formatted name
//  6 - ur
//  7 - outpatient visit number
//  8 - sex
//  9 - age
//  10- space
//  11- space
//  12- space
//  13- space
//  14- time actually seen
//  15- check in time
//  16- time of departure
//  17- slot status
//  18- space
//  19- space
//  20- follow up appointment made
//  21- DNA or spaces
//  22- visit extension user defined free format 1
//  23- diagnosis comments
//  24- alerts string
//  25- home phone
//  26- business phone
//  27- mobile phone
//  28- casekeys
//  29- language
//  30- special arrangements
//  31- status
//  32- patient folder extension
//  33- outcome code
//  34- coloured visit number
//  35- coloured visit type
//  36- diagnosis comments
//  37- claim code
//  38- claim comment flag
//  39- highlight colours
//  40- referral expiry
//  41- claim status
//  42- cmbs item
//  43- batch number
//  44- print checkbox disabled
//  45- print checkbox ticked
//  46- print checkbox unticked
//  47 - Referral Number
//  48 - Referral Number
//  49 - Referral Dept
//  50 - Using med claim
//  51 - A/H Departmetn
//  52 - Collect Enc
//  53 - Linked Enc
//  54 - source of ref
//  55 - update array javascript
//----------------------------------------------------------------------------
function InitTable(TableView) {
  switch (TableView) {
    // Booking Details
    case "0":
      t = new Table(1,0,2,"100%","center",40);
      t.addColumn("Time","Time",1,1,"left","AppointmentIcon.gif","Slot",55);
      t.addColumn("Type","String",3,3,"left","","",45);
      t.addColumn("U/R","String",6,6,"left","","",55);
      t.addColumn("Patient","StringPatient",5,5,"left","PatientFolder","Patient",100);
      if (document.UpdateStatus.othecpmi.value=="1") {
        t.addColumn("Confirm Demographics","ButtonLinkWide",65,66,"left","","ConfirmPMI",80,"","","",91)
      }
// 06 : TAS : Add Mode of Delivery column
      t.addColumn("Mode of Delivery","String",72,72,"left","","ModeOfDelivery",55);
      t.addColumn("Check- In","ButtonLink",15,-1,"left","","CheckIn",50);
      t.addColumn("Time Seen","ButtonLink",14,-1,"left","","TimeSeen",50);
      t.addColumn("Departure","ButtonLink",16,-1,"left","","Departure",50);
      t.addColumn("Follow Up","ButtonLink",33,-1,"left","","FollowUp",50);
      t.addColumn("Appt Made","String",20,-1,"left","","ApptMade",50);
// 05 : TAS : add Telehealth link
      t.addColumn("Telehealth","TeleLink",10,-1,"left","LinkIcon.gif","Telehealth",50)
      t.addColumn("Non Attend","ButtonLink",21,-1,"left","","NonAttend",50);
      if (document.getElementById('addcnind').value=='1' ||
          document.getElementById('addcnind').value=='2') {
        t.addColumn("Add Contact","String",86,-1,"left","","",50);
      }
      t.addColumn("Alerts","Image",22,-1,"left","alert","",50);
      t.addColumn("Confirmed","String",57,-1,"left","","confirmed",50);

      if(document.UpdateStatus.ptcndcdm.value=="1") {
        t.addColumn("CDM","String",58,58,"left","","",70);
      }

      AddTableRows();
      TableOutput(0,1);    // Order Column,Asc Dsc
      break; 

    // Diagnosis Details
    case "1":
      t = new Table(1,0,2,"100%","center",40);
      t.addColumn("Time","Time",1,1,"left","AppointmentIcon.gif","Slot",45);
      t.addColumn("Type","String",3,3,"left","","",35);
      t.addColumn("U/R","String",6,6,"left","","",55);
      t.addColumn("Patient ","StringPatient",5,5,"left","PatientFolder","Patient","20%");
      t.addColumn("Diagnosis/Complaint","String",22,22,"","","","22%");
      t.addColumn("Comments","String",36,36,"","","","22%");
      t.addColumn("ACC Number","String",92,92,"","","","10%");
      t.addColumn("Date of Accident","String",93,93,"","","","10%");

      if (document.UpdateStatus.ptcndcdm.value=="1") {
        t.addColumn("CDM","String",58,58,"left","","",70);
      }

      AddTableRows();
      TableOutputDynamicRow(0,1,63);    // Order Column,Asc Dsc
      break; 

    // Contact Details
    case "2":
      t = new Table(1,0,2,"100%","center",40,60);
      t.addColumn("Time","Time",1,1,"left","AppointmentIcon.gif","Slot",65);
      t.addColumn("Type","String",3,3,"left","","",45);
      t.addColumn("U/R","String",6,6,"left","","",55);
      t.addColumn("Patient ","StringPatient",5,5,"left","PatientFolder","Patient",180);
      t.addColumn("Private","String",25,25,"","","",75);
      t.addColumn("Business","String",26,26,"","","",75);
      t.addColumn("Mobile","String",27,27,"","","",75);
      t.addColumn("Address","String",59,59,"","","",75);
      t.addColumn("Postal Address","String",60,60,"","","",75);
      t.addColumn("GP/Practice","String",61,61,"","","",75);
      AddTableRows();
      TableOutput(0,1);    // Order Column,Asc Dsc
      break; 

    case "5":
      t = new Table(1,0,2,"100%","center",40,60);
      t.addColumn("Time","Time",1,1,"left","AppointmentIcon.gif","Slot",65);
      t.addColumn("Type","String",3,3,"left","","",45);
      t.addColumn("U/R","String",6,6,"left","","",55);
      t.addColumn("Patient ","StringPatient",5,5,"left","PatientFolder","Patient",180);
      t.addColumn("Procedure","String",84,84,"","","",90);
      t.addColumn("Problem","String",85,85,"","","",90);

      if(document.UpdateStatus.ptcndcdm.value=="1") {
        t.addColumn("CDM","String",58,58,"left","","",70);
      }

      AddTableRows();
      TableOutputDynamicRow(0,1,63);    // Order Column,Asc Dsc
      break; 
  }
}
function initA(){
  if(document.UpdateStatus.othecenc.value=="1") {
     SelectPeriod.viewlink.options[SelectPeriod.viewlink.options.length]=
     new Option("Bulk Contact","14");
  }

  if (document.getElementById('addcnind').value=='1' || 
      document.getElementById('addcnind').value=='2') {
    document.getElementById('cnctbttn').style.display='';
  }
}
 function AddEncounter() {
   Depcod=UpdateStatus.addcndep.value;
   Depdoc=UpdateStatus.addcndoc.value;
   if(isWhitespace(UpdateStatus.addcndep.value)) {
      alert("Department is empty");
      return;
   }
   Left = (document.body.clientWidth-950)/2
   Location = "allweb03.pbl?reportno=05&template=006&deptcode=" + Depcod +
              "&doctcode=" + Depdoc +
              "&addcndat=" +
              UpdateStatus.sesskeys.value.substr(12,8);
   DFrameLink(Location,50,Left,950,520);
 }
 

function setReadOnly() {
	if (isReadOnly()) {
		// disable checkboxes
		var checkboxlist = [];
		if (document.querySelectorAll) {
			checkboxlist = document.querySelectorAll("input[onclick^=\"UpdateConf\"]");
			for (var i=0; i<checkboxlist.length; i++) {
				checkboxlist[i].setAttribute("disabled", "disabled");
			}
		} 
		else {
			var inputlist = document.getElementsByTagName("input");
			for (var i=0; i<inputlist.length; i++) {
				if (inputlist[i].getAttribute("type") == "checkbox") {
					inputlist[i].setAttribute("disabled", "disabled");
				}
			}
		}
		
		// remove edit options from viewlink select at top of table
		// assuming list is as hard-coded in viewlink select below
		var editoptions = [3, 4, 5, 6, 7, 9, 10, 11, 17, 12, 13, 14, 21];
		var optiontext = ["Update Slots","Reschedule","Update All Non Attended","Update Comments",
			"Suspend Clinic","Clinic Usage","Bulk Attendance","Bulk Departure","Bulk Discharge",
			"Bulk Follow Up","Confirmed Appointments","Bulk Contact","Procedure/Problem Details"];
		var linkselect = document.getElementsByName("viewlink");
		for (var i=0; i<linkselect.length; i++) {
			for (var j=0; j<editoptions.length; j++) {
				for (var k=0; k<linkselect[i].options.length; k++) {
					if (linkselect[i].options[k].value == editoptions[j]
						&& linkselect[i].options[k].text == optiontext[j]) {
						linkselect[i].options.remove(k);
					}
				}
			}
		}
	}
}
 
function AddEnc(argvalue) {

  var ur = argvalue.substr(0,8);
  var ad = argvalue.substr(8,8);
  var dp = argvalue.substr(16,3);
  var status = argvalue.substr(19,1);
  var obadate = argvalue.substr(20,8);
  var obatime = argvalue.substr(28,5);
  var otmadefd = UpdateStatus.addcndoc.value;

  obatime = obatime + ":00";

  if(trim(status)=="4") {
    alert("Encounter Cannot be added to a Cancelled Referral");
    return;
  }
  linkUrl="allweb03.pbl?reportno=01&template=002" +
          "&urnumber=" + ur.replace(/ /g,"+") +
          "&admissno=" + ad.replace(/ /g,"+") +
          "&deptcode=" + dp.replace(/ /g,"+") +
          "&defedate=" + obadate.replace(/ /g,"+") +
          "&defetime=" + obatime.replace(/ /g,"+") +
          "&defedoct=" + otmadefd.replace(/ /g,"+");

  SetCookie("OutpatientContactCookie",'1');

  Left=(document.body.clientWidth-900)/2
  DFrameLink(linkUrl,50,Left,900,520)
}
</script>
</head>
%START.OF.PAGE
<!-- 03 : CTAS : 27-04 -2018 275115 Screen refresh rate set to 90 from 10 --> 
<body onload='PageLoad(event);
              LoadTable("%OUTWEB02.02.044");
              SetPageRefreshOut(90);
              initA();
              getScrollPosition();
              setReadOnly();
              showTodayButton();'
      onUnload="saveScrollPosition();">
<div id=HeadingSection>
<form name=UpdateStatus action=outweb02.pbl method=post style="margin:0">
<input type=hidden name=reportno value=4>
<input type=hidden name=template value=1>
<input type=hidden name=redirect value="">
<input type=hidden name=updatety value="">
<input type=hidden name=casekeys value="">
<input type=hidden name=sesskeys value="%OUTWEB02.02.004">
<input type=hidden name=sessupdt value="">
<input type=hidden name=bookstat value="">
<input type=hidden name=urnumber value="">
<input type=hidden name=admissno value="">
<input type=hidden name=patfname value="">
<input type=hidden name=dummyadm value="">
<input type=hidden name=othecenc value="%OUTWEB02.02.051">
<input type=hidden name=othedurn value="%OUTWEB02.02.053">
<input type=hidden name=xocadoct value="%OUTWEB02.02.199.003.1">
<input type=hidden name=xocahcp1 value="%OUTWEB02.02.140.056">
<input type=hidden name=xocahcp2 value="%OUTWEB02.02.140.057">
<input type=hidden name=xocahcp3 value="%OUTWEB02.02.140.058">
<input type=hidden name=xocahcp4 value="%OUTWEB02.02.140.059">
<input type=hidden name=ptcndcdm value="%STANDARD.01.025.116.214.0.1">
<input type=hidden name=addcnind id=addcnind value="%OUTWEB02.02.066">
<input type=hidden name=addcndep id=addcndep value="%OUTWEB02.02.067">
<input type=hidden name=addcndoc id=addcndoc value="%OUTWEB02.02.068">
<!-- Mark -->
<input type=hidden name=mark id=mark value="%OUTWEB02.032.327.006.9.3"> 
<!-- 04 : Merge task 0859728 -->
<input type=hidden name=othecpmi value="%OUTWEB02.02.058">
</form>

<form name=SelectPeriod action=outweb02.pbl method=get style="margin:0">
<input type=hidden name=reportno value=2>
<input type=hidden name=template value=4>
<input type=hidden name=contview value="%OUTWEB02.02.057">
<input type=hidden name=tablview value="%OUTWEB02.02.044">
<input type=hidden name=occGroup id=occGroup value="%STANDARD.01.012.1">
<input type=hidden name=sesskeyt value="%OUTWEB02.02.071">
<input type=hidden name=loctoday value="%OUTWEB02.02.072">
<input type=hidden name=otcndtdy id=otcndtdy
       value="%STANDARD.01.025.032.148.1.1">

<table cellspacing=0 cellpadding=1 bgcolor=#CCCCCC border=0 width=100%>
  <tr>
    <td class=HeadingCell width=10%>
      <img src="../images/ListIcon.gif" class=Icon title="Clinic Timetable"
        onclick='GoOutpatientListSTV();'>
      <img src="../images/RefreshIcon.gif" class=Icon title="Refresh"
        onclick='location.reload();'>
    </td>
    <td class=HeadingCell align=center>Clinic for %OUTWEB02.02.014</td>
    <td class=HeadingCell width=10%></td>
  </tr>
</table>

<table cellspacing=0 cellpadding=1 bgcolor=#CCCCCC border=0 width=100%>
<tr><td width=10% class=DataLabel>Views</td>
    <td width=35% class=DataField>
    <select name=viewlink onchange="ViewLink(this.value);">
    <option value=0>Bookings Details</option>
    <option value=1>Diagnosis Details</option>
    <option value=2>Contact Details</option>
    <option value=3>Update Slots</option>
    <option value=4>Reschedule</option>
    <option value=5>Update All Non Attended</option>
    <option value=6>Update Comments</option>
    <option value=7>Suspend Clinic</option>
    <option value=8>Print Group Labels & Forms</option>
    <option value=9>Clinic Usage</option>
    <option value=10>Bulk Attendance</option>
    <option value=11>Bulk Departure</option>
    <option value=17>Bulk Discharge</option>
    <option value=12>Bulk Follow Up</option>
    <option value=13>Confirmed Appointments</option>
    <option value=21>Procedure/Problem Details</option>
    </select></td>
    <td class=DataLabel>Date & Start Time</td>
    <td align=right>
    <span id=TodayButSpan style="display:none">
      <input type=button name=btnToday id=btnToday value="Today" class=button
       title="Switch to today's clinic"
       onclick='setTodayDate();'>
    </span>
    <input type=button value="<<" class=SmallButton
     onclick='location.href="%OUTWEB02.02.002"'>
    <select name=sesskeys onchange='document.SelectPeriod.submit();'>
    %OUTWEB02.02.003
    </select>
    <input type=button value=">>" class=SmallButton
     onclick='location.href="%OUTWEB02.02.001"'>
    </td></tr>

<tr><td class=DataLabel>Clinic Type</td>
    <td class=DataField>%OUTWEB02.02.027.0</td>
    <td class=DataLabel>Location</td>
    <td class=DataField>%OUTWEB02.02.029.0</td></tr>

<tr><td class=DataLabel>Session Status</td>
    <td class=DataField>%OUTWEB02.02.020.0</td>
    <td class=DataLabel>&nbsp;</td>
    <td class=DataField>&nbsp;</td></tr>

<tr valign=top>
    <td class=DataLabel>Comments</td>
    <td class=DataField>
    %OUTWEB02.02.026
    <td class=DataLabel>Instructions
    </td> <td> 
    <b> %OUTWEB02.02.028</b> <br></td> 
</tr> 
	

<td class=DataLabel></td>
    <td class=DataField></td>
    <td class=DataLabel></td>
    <td class=DataField align=right>
       <input type=button value="Add Contact" name=cnctbttn id=cnctbttn
        class="button" style="display:none" 
        onclick="tempDisable(this);AddEncounter();">
    </td></tr>

<tr><td></td><td>
    <b>%OUTWEB02.02.021<br>
    %OUTWEB02.02.022 </b> 
    </td></tr>
</table>
</form>
</div>

<div id=TableLocation></div>
<script type="text/javascript">
function AddTableRows(){
%OUTWEB02.02.009.outweb02.03.001
}
</script>
