<meta name="TemplateVersion" content="V12.01.00">
<meta name="TemplateHome" content="hea">
<meta name="HelpFileName" content="NoContextSet.html">
<meta name="CrossBrowser" content="true">
<script type="text/javascript" src="../js/eAdmissionReg.js"></script>
<script type="text/javascript" src="../js/eReferralReg.js"></script>
<script type="text/javascript"> 
function AdmissionLinkSearchFrame(urnumb,session,RETadmis,RETdate,RETtime,
                                  RETacare,RETaclaim){
 DFrameStart();
  window.urnumber=urnumb;
  window.sesskeys=session;
  document.getElementById('PopUpFrame').src="../lookups/AdmissionLinkSearchFrame.html";
  SearchFrameShow();
}
  function CheckBooking() {
    if (AddForm.bkrec008.value.substr(14,3)=="THE") {
     DOCTCODE=AddForm.bkrec002.value;
     LinkUrl="oprweb01.pbl?reportno=2&template=3&doctcode="+DOCTCODE+
             "&admisnid="+AddForm.admisnid.value.replace(/ /g,"+")+
             "&erefrlid="+AddForm.erefrlid.value.replace(/ /g,"+");
     DFrameLink(LinkUrl,0,0,740,390);
    }
  }
function valClaimCode() {
  if (AddForm.bkrec023.value=="") {
  validateCode(41,LinkForm.urnumber,AddForm.claimc);
  for (var i =0 ; i < document.AddForm.bkrec023.length; i++) {
    if (document.AddForm.claimc.value==
        trim(document.AddForm.bkrec023.options[i].value.substr(0,3))){
          document.AddForm.bkrec023.selectedIndex=i;
    }
  } }
}
function submitForm(){
  MandatoryOk=true;
  if  (!validateMandatory(AddForm)) {
      return;
  }
  if(AddForm.bkrec008.value.substr(14,3)=="THE") {
    alert("Invalid booking type - Theatre");
    return;
  }
    p=document.AddForm
    validateSuspension(p.urnumber,p.bkrec004,p.datefrom,p.dateto);
    if(p.datefrom.value!='0'){
         ans=confirm("Warning : Patient has a Suspension record for period \n" +
               "\t" + p.datefrom.value  + " - " + p.dateto.value);
         if (ans!=true) {
            return;
            }
         }
    if (document.AddForm.admisnid != undefined ) {
       if (!isWhitespace(AddForm.admisnid.value)) {
          eAdmCookie=GetContentCookie("eAdmission");
          if(eAdmCookie!="unknown") {
            ExpireCookiePath("eAdmission"); 
            document.AddForm.nextpage.value="6";
            document.AddForm.redirect.value=eAdmCookie;
          }
       }
    } 
    document.AddForm.submit();
}

function clrCookieReturn() {
  eAdmCookie=GetContentCookie("eAdmission");
  eRefCookie=GetContentCookie("eReferral");
  if (eAdmCookie!="unknown") {
      ExpireCookiePath("eAdmission");
      getTop().content.location.href=eAdmCookie; }
  else if(eRefCookie!="unknown") {
      ExpireCookiePath("eReferral");
      getTop().content.location.href=eRefCookie; }
  else
  { DFrameExit(); }
}
function valDoctorUnit() {
  validateCode(31,AddForm.bkrec002,AddForm.n_bkrec002);
  selectOptions("30",AddForm.bkrec002,AddForm.bkrec021);
  AddForm.bkrec021.selectedIndex=1;
}
</script>
</head>
%START.OF.PAGE
<body onload="PageLoad(event);valClaimCode();OnlinePreadmission();
 setTimeout('CheckBooking();',500);OnlineReferral();eRefPreList();">
<!-- not implemented yet   ------       ChkInp();">-->
<span class=DFrameTitleBar>
<img align="right" alt="Exit" class="MenuIcon" 
 src="../images/ExitIcon.gif" onclick="clrCookieReturn();">
Booking Details
</span>

<!--<div id=PageBodySection style="overflow: auto;">-->
<form name=LinkForm action=oprweb01.pbl method=get target=content>
<input type=hidden name=reportno value=9>
<input type=hidden name=template value=2>
<input type=hidden name=urnumber value="%WATWEB01.02.003">
<input type=hidden name=sesskeys value="">
<input type=hidden name=wattrkey value="%WATWEB01.02.101">
<input type=hidden name="admisnid" id=admisnid value="%WATWEB01.02.360" />
<input type=hidden name=nextpage value="1">
<input type=hidden name=redirect value="%WATWEB01.02.001.patweb98.01.001">
<input type="hidden" name="erefrlid" value="%WATWEB01.02.382">
</form>

<form name=AddForm action=oprweb01.pbl method=post style="margin:0"
 onsubmit="return validateMandatory(this);">
<input type=hidden name=reportno value=7>
<input type=hidden name=template value=4>
<input type=hidden name=setbookf value=1>
<input type=hidden name=updttype value=A>
<input type=hidden name=datefrom>
<input type=hidden name=dateto>
<input type=hidden name=bookflag value="%WATWEB01.02.332">
<input type=hidden name=urnumber value="%WATWEB01.02.003">
<input type=hidden name=claimc>
<input type=hidden name=admisnum >
<input type=hidden name=ibcnmhos value="%STANDARD.01.025.000.043.1.1">
<input type=hidden name=currflag value="%WATWEB01.02.332">
<input type=hidden name=curradmn value="%WATWEB01.02.334">
<input type=hidden name=admissno value="%WATWEB01.02.081">
<input type=hidden name=admstats value="%WATWEB01.02.333.004">
<input type=hidden name=admndate value="%WATWEB01.02.333.002">
<input type=hidden name=admntime value="%WATWEB01.02.333.003">
<input type=hidden name=ptvis043 value="%WATWEB01.02.333.029">
<input type=hidden name=ptmis027 value="%WATWEB01.02.333.026.1">
<input type=hidden name=ptmis068 value="%WATWEB01.02.333.005.1">
<input type=hidden name=admpoint value="%WATWEB01.02.333.503.1">
<input type=hidden name=ptmas024 value="%WATWEB01.02.333.012.1">
<input type=hidden name=ptcnhdps value="%STANDARD.01.025.080.250.1.1">
<input type=hidden name=ptcnmpbk value="%STANDARD.01.025.112.100.0.1">
<input type=hidden name="admisnid" value="%WATWEB01.02.360" />
<input type="hidden" name="nextpage" value="" />
<input type="hidden" name="redirect" value="" />
<input type="hidden" name="eautoadd" value="eAutoAdd" />
<input type="hidden" name="erefrlid" value="%WATWEB01.02.382">
<input type=hidden name=firstbok value="1">
<input type=hidden name=erefmapbk id="erefmapbk" value="1">

<table border=0 width="95%" cellspacing="0" cellpadding="1" align=center>
<tr><td class=DataLabel>Booking Type</td>
   <td class=DataField colspan=3>
   <select name=bkrec008 onchange="CheckBooking();"
    class=Mandatory title="Booking Type">
   <option></option>
    %WATWEB01.02.301.BK
   </select></td></tr>

<tr><td class=DataLabel>Diagnosis</td>
   <td class=DataField colspan=3>
   <input type=text size=12 name=bkrec035 id=bkrec035 value="%WATWEB01.02.103">
   <input type=text name=bkrec036 id=bkrec036 
         size=70 maxlength=50 value="%WATWEB01.02.106">
   <a href="javascript:Icd10ProSearchFrame(AddForm.bkrec035,AddForm.bkrec036);">
   <img src=../images/SearchIcon.gif class=Icon>
   </a></td></tr>

<tr><td class=DataLabel>Pre-Assessment</td>
    <td class=DataLabel colspan=3>
    <input type=text name=bkrec006 id=bkrec006 size=12 
     title="Pre-Assessment Date">
    <img src=../images/DateLookup.gif class=Icon date=AddForm.bkrec006>
    Time
    <input type=text name=bkrec007 id=bkrec007 size=6 
     title="Pre-Assessment Time">
    <img src=../images/DateTimeStamp.gif class=Icon date=AddForm.bkrec006
     time=AddForm.bkrec007>  
    <img src=../images/TimeLookup.gif class=Icon time=AddForm.bkrec007>  
    </td></tr>

<tr><td class=DataLabel>Scheduled Admission</td>
    <td class=DataLabel>
    <input type=text name=bkrec004 id=bkrec004 size=12 
           value="%WATWEB01.02.111" class=Mandatory  
           title="Scheduled Admission Date">
    <img src=../images/DateLookup.gif class=Icon date=AddForm.bkrec004>
    Time
    <input type=text name=bkrec005 id=bkrec005 size=6  
    class=Mandatory title="Scheduled Admission Time">
    <img src=../images/DateTimeStamp.gif class=Icon date=AddForm.bkrec004
     time=AddForm.bkrec005>  
    <img src=../images/TimeLookup.gif class=Icon time=AddForm.bkrec005>  
    </td>

<tr><td class=DataLabel>Admitting Ward</td>
    <td class=DataLabel>
    <select name=bkrec015 title="Admitting Ward"
     onchange="selectOptions2('31',AddForm.bkrec015,AddForm.bkrec018);" >
    <option></option>
    %WATWEB01.02.302
    </select>
    Bed
    <select name=bkrec018 title="Admitting Bed">
    <option></option>
    </select>
    </td>
    <td class=DataLabel>&nbsp;</td>
    <td class=DataLabel>&nbsp;</td>
    </tr>

<tr><td class=DataLabel>Exp.Post Op Ward</td>
    <td class=DataLabel>
    <select name=bokrx002 title="Exp.Post Op Ward"
     onchange="selectOptions2('31',AddForm.bokrx002,AddForm.bokrx038);" >
    <option></option>
    %WATWEB01.02.505.2
    </select>
    Bed
    <select name=bokrx038 title="Expected Post-Op Bed">
    <option></option>
    </select>
    </td>
    <td class=DataLabel>Intended Length of Stay </td>
    <td class=DataLabel>
    <input type=text name=bkrec033 size=4 maxlength=5
     value="%WATWEB01.02.116">(days)</td></tr>

<tr><td class=DataLabel>Consultant</td>
    <td class=DataField colspan=3>
    <input type=text name=bkrec002 id=bkrec002 size=8 maxlength=8 
     value="%WATWEB01.02.115.003"
     onblur="UpCase(this);valDoctorUnit();">
    <input type=text name=n_bkrec002 id=n_bkrec002 size=40 readonly notab
     value="%WATWEB01.02.115.002">
    <a href="javascript:DoctorSearchFrame(AddForm.bkrec002,AddForm.n_bkrec002)">
    <img src=../images/SearchIcon.gif class=Icon></a></td></tr>

<tr><td class=DataLabel>Referring GP</td>
    <td class=DataField colspan=3>
    <input type=text name=bkrec024 id=bkrec024 size=8 maxlength=8
     onblur="UpCase(this);ValidateHCP(18,0,bkrec024,n_bkrec024);">
    <input type=text name=n_bkrec024 id=n_bkrec024 size=40 readonly notab>
    <a href="javascript:HCPSearchFrame(AddForm.bkrec024,AddForm.n_bkrec024,0)">
    <img src=../images/SearchIcon.gif class=Icon></a></td></tr>

<tr><td class=DataLabel>%STANDARD.01.017.P </td>
    <td class=DataField>
    <select name=bkrec019>
    <option></option>
     %WATWEB01.02.301.P 
    </select></td>
<td class=DataLabel>Speciality</td>
    <td class=DataField>
    <select name=bkrec021>
    <option></option>
     %WATWEB01.02.114.2
    </select></td></tr>

<tr><td class=DataLabel>%STANDARD.01.017.CL</td>
    <td class=DataField colspan=3>
    <select name=bkrec023 title="%STANDARD.01.017.CL">
    <option></option>
    %WATWEB01.02.133.9.1.10.2.X
    </select></td></tr>

<tr><td class=DataLabel>%STANDARD.01.017.VI</td>
    <td class=DataField colspan=3 >
    <select name=bokrx011>
    <option></option>
    %STANDARD.01.018.VI.   .2
    </select></td></tr>

<tr><td class=DataLabel>Admitting Point</td>
    <td class=DataField>
    <select name=bokrx003>
    <option></option>
    %WATWEB01.02.403.2
    </select></td></tr>

<tr valign=top><td class=DataLabel colspan=4>Comments<br>
    <textarea name=adcommnt wrap=hard rows=3 cols=70></textarea>
    </td></tr>
<tr><td>

<tr><td colspan=4 align=center> 
    <input type=button value=Ok class="button" onclick='submitForm();'>
    <input type="button" value="Cancel" class="button"
           onclick="clrCookieReturn();" />
    </td></tr>
</table>
</form>

<form name=PatientLinks method=get>
<input type=hidden name=reportno value=1>
<input type=hidden name=template value=004>
<input type=hidden name=urnumber value="%WATWEB01.02.003">
<input type=hidden name=admissno value="%WATWEB01.02.081">
<input type=hidden name=MenuType value="%WATWEB01.02.088">
<input type=hidden name=casekeys value="%WATWEB01.02.101">
</form>

<script type="text/javascript" >
  if(document.AddForm.bookflag.value!="0"){
     alert("Warning: Patient has a preadmission");
  }
  ExpireCookiePath("CasePath");
if(document.AddForm.ibcnmhos.value=="1"){
   AddForm.bkrec015.className="Mandatory";
   AddForm.bokrx002.className="Mandatory"}
function ChkInp() {
 if (AddForm.currflag.value=="2") {
   if(confirm("Use the current Admission or Create a new booking\n" +
              "   Ok to use the Current, Cancel to Create New")) {
  AdmissionLinkSearchFrame(AddForm.urnumber,AddForm.sesskeys,AddForm.admissno,
                           AddForm.admndate,AddForm.admntime);
   return;
   }
  }
  if (AddForm.currflag.value!="1") {
     return; }
  if (AddForm.admissno.value=="") {
     preadmitRequired();
     return; }
  if(document.AddForm.admstats.value=="Pre-Admission       "){
    if(!confirm("Use the current Pre-Admission or Create a new booking\n" +
              "   Ok to use the Current, Cancel to Create New")) {
        preadmitRequired();
        return;}
  }else {if(!confirm("Use the current Admission or Create a new booking\n" +
           "   Ok to use the Current, Cancel to Create New")){
         preadmitRequired();
         return;}
   }
    if(document.AddForm.ptcnhdps.value=="3"){
      if(document.AddForm.caretype.value.substr(14,1)!="4"&&
         document.AddForm.caretype.value.substr(14,1)!="5"&&
         document.AddForm.caretype.value.substr(14,1)!="8"){
         alert("Unable to use the current admission, invalid care type.")
         preadmitRequired();
         return; }
  }
   defaultAdmission();
}
function defaultAdmission(){
   AddForm.admisnum.value=AddForm.curradmn.value
   AddForm.bkrec004.value=AddForm.admndate.value
   AddForm.bkrec005.value=AddForm.admntime.value
//Intended Length of Stay
   AddForm.bkrec033.value=AddForm.ptvis043.value
//Financial Class
   for (var i =0 ; i < document.AddForm.bkrec023.length; i++) {
     if (document.AddForm.bkrec023.options[i].value.substr(0,3)==document.AddForm.ptmis027.value.substr(0,3)) {
         document.AddForm.bkrec023.selectedIndex=i } };
//Admitting Point
   for (var i =0 ; i < document.AddForm.bokrx003.length; i++) {
     if (document.AddForm.bokrx003.options[i].value.substr(0,3)==document.AddForm.admpoint.value.substr(0,3)) {
         document.AddForm.bokrx003.selectedIndex=i } };
//Expected Ward
   for (var i =0 ; i < document.AddForm.bokrx002.length; i++) {
     if (document.AddForm.bokrx002.options[i].value.substr(0,3)==document.AddForm.ptmis068.value.substr(0,3)) {
         document.AddForm.bokrx002.selectedIndex=i } };
//Patient Type
   for (var i =0 ; i < document.AddForm.bkrec019.length; i++) {
     if (document.AddForm.bkrec019.options[i].value.substr(0,3)==document.AddForm.ptmas024.value.substr(0,3)) {
         document.AddForm.bkrec019.selectedIndex=i } };
}
function preadmitRequired(){
if(document.AddForm.ptcnmpbk.value!="1"){
  return;}
if(document.AddForm.admisnum.value==""){
  alert("Patient must be preadmitted before booking");
  linkurl="patweb98.pbl?reportno=01&template=001" +
           "&urnumber=" + PatientLinks.urnumber.value.replace(/ /g,"+") +
           "&admissno=" + PatientLinks.admissno.value.replace(/ /g,"+");
  parent.location.href=linkurl;
 }
}
</script>
