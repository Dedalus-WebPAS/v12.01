<meta name="TemplateVersion" content="V12.01.00">
<meta name="TemplateHome" content="hea">
<meta name="HelpFileName" content="NoContextSet.html">
<meta name="CrossBrowser" content="true">
<script language="javascript" src="../js/allweb02.js"></script>
<script type="text/javascript" src="../js/eReferralReg.js"></script>
<script type="text/javascript">
function UpdateReferral() {
  if(!validateMandatory(UpdateForm)) {
    return;
  }
  if(!isWhitespace(UpdateForm.alref094.value)) {
    if(SetDateYYYYMMDD(UpdateForm.alref094.value) <
       SetDateYYYYMMDD(UpdateForm.d_alref019.value)) {
       alert("Referral Accepted Date can't be before the Referral Date");
       UpdateForm.alref094.select();
       UpdateForm.alref094.focus();
       return;
    }
  }

  if(!isWhitespace(document.UpdateForm.erefrlid.value)) {
     var xhr = createHttpObject();
     var url = "comweb10.pbl?reportno=03&remoteno=5"
             +"&erefrlid="+document.UpdateForm.erefrlid.value.replace(/ /g,'+')
             +"&urnumber="+document.UpdateForm.urnumber.value.replace(/ /g,'+')
             +"&admissno="+document.UpdateForm.admissno.value.replace(/ /g,'+')
     xhr.open('GET',url,false);
     xhr.send();
  }

  document.UpdateForm.submit();
}
function SetList() {
  p=UpdateForm
  var SetSite
  if(isWhitespace(p.alref119.value)) {
    SetSite=p.wbsesite.value;
  } else {
    SetSite=p.alref119.value;
  }
 for (var i =0 ; i < document.UpdateForm.alref119.length; i++) {
  if (document.UpdateForm.alref119.options[i].value==SetSite.substr(0,6)) {
       document.UpdateForm.alref119.selectedIndex=i } };
}
</script>
</head>
%START.OF.PAGE
<body onload="PageLoad(event);SetList();
              OnlineReferral();eRefPreList();FilterReferralSource(UpdateForm);
              LinkToVisitMan('U');
              checkBasicCoverRate(document.UpdateForm.alref035);
              FilterClaimType(document.UpdateForm.alref035);">
<span class=DFrameTitleBar>
<img border=0 align=right src="../images/ExitIcon.gif" onclick="DFrameExit();">
 %ALLWEB02.02.125.0  Referral  </span>
<div id=PageBodySection style="overflow: auto;">
<form name=UpdateForm onsubmit='return validateMandatory(this)' 
            action="allweb02.pbl" method=post>
<input type=hidden name=reportno value="2">
<input type=hidden name=updatety value="U">
<input type=hidden name=urnumber id="urnumber" value="%ALLWEB02.02.003">
<input type=hidden name=admissno id="admissno" value="%ALLWEB02.02.081">
<input type=hidden name=deptcode value="%ALLWEB02.02.125.1">
<input type=hidden name=redirect value="allweb02.pbl?reportno=2&template=3">
<input type=hidden name=dummy id=dummy>
<input type=hidden name=alref083 value="">
<input type=hidden name=wbsesite value="%STANDARD.01.023">
<input type=hidden name=disacode value="%ALLWEB02.02.514">
<input type=hidden name=disadesc value="%ALLWEB02.02.515">
<input type="hidden" name="ptcnudpd" value="%STANDARD.01.025.118.153.0.1">
<input type=hidden name=ptcnhdps id=ptcnhdps
       value="%STANDARD.01.025.080.250.1.1">
<input type="hidden" name="erefrlid" value="%ALLWEB02.02.278">
<input type="hidden" name="erefmaprf" id="erefmaprf" value="1">
<input type=hidden name=d_depcod value="%ALLWEB02.02.125.3">
<input type=hidden name=alcnlkvm id=alcnlkvm
       value="%STANDARD.01.025.121.128.0.1">
<input type=hidden name=d_exprflag id=d_exprflag value="%ALLWEB02.02.287">

<table align=center cellspacing=0 cellpadding=1 border=0 width=95%>
<tr><td class=DataLabel width=15%>Department Code</td>
    <td><input type=text value="%ALLWEB02.02.125.0" tabindex=-1
          readonly class=Readonly></td>
    <td class=DataLabel>Entered by</td>
    <td><input type=text name=alref000 tabindex=-1
         value="%ALLWEB02.02.163" readonly class=Readonly></td>
    </tr>

<tr><td class=DataLabel>Referral Date</td>
    <td><input type=text name=d_alref019 value="%ALLWEB02.02.119" tabindex=-1
         title="Referral Date" readonly class=Readonly size=12></td>
    <td class=DataLabel>Link to Visit</td>
    <td><input type=text size=10 maxlength=8 class="DataField NoAutoFocus"
         Title="Link to Visit" name=alref005 value="%ALLWEB02.02.105"
         tabindex=22 id=alref005
          onblur="justifyRight(this);
                ValidateVisit(UpdateForm.alref005,UpdateForm.urnumber,
                UpdateForm.dummy);">
        <img src="../images/SearchIcon.gif" class=Icon
         onclick="VisitSearchFrame(UpdateForm.urnumber,UpdateForm.alref005);" >
    </td></tr>

<tr><td class=DataLabel>Referral Accepted Date</td>
    <td><input type=text name=alref094 size=12 onblur="checkDate(this,'Date')"
       value="%ALLWEB02.02.155" class="PastDate" tabindex=1
       title="Referral Accepted Date">
      <img src=../images/DateTimeStamp.gif class=Icon date=UpdateForm.alref094
       time=null>
      <img src=../images/DateLookup.gif class=Icon date=UpdateForm.alref094> 
    </td>
    <td class=DataLabel>Event Program</td>
    <td><select class="SelectBig" name=alref145 title="Event Program"
         tabindex=23>
        <option></option>
         %ALLWEB02.02.199.016.2
        </select></td>
    </tr>

<tr><td class=DataLabel>Referred By</td>
    <td><input type=text name=alref022 size=10 maxlength=10 tabindex=2
       value="%ALLWEB02.02.122.1" class=Mandatory title="Referring HCP"
       id=alref022
       onchange="ReadDoc(18,0,UpdateForm.alref022,UpdateForm.n_alref022,
                 UpdateForm.alref023,UpdateForm.n_alref023,
                 UpdateForm.alref024,UpdateForm.dummy);">
       <input type=text name=n_alref022 size=35 readonly title="HCP Name"
        tabindex=-1 id=n_alref022
        class=Readonly value="%ALLWEB02.02.122.0" >
       <img src="../images/SearchIcon.gif" class=Icon
        onclick="GPHCPSearchFrame(UpdateForm.alref022,UpdateForm.n_alref022,
                 UpdateForm.dummy,UpdateForm.alref023,
                 UpdateForm.n_alref023,UpdateForm.alref024,0);">
       <img src="../images/ClearIcon.gif" class=Icon
        onclick='clrFields(UpdateForm.alref022,UpdateForm.n_alref022,
                 UpdateForm.dummy);'>
        </td>
    <td class=DataLabel>Responsible HCP</td>
    <td><input type=text name=alref038 size=10 maxlength=10 tabindex=24
         value="%ALLWEB02.02.138.1" title="Responsible HCP"
         onblur="if (checkAlphanumDesc(event,this) != false) {
                   ValidateHCP(18,13,UpdateForm.alref038,
                   UpdateForm.n_alref038);
                 }">
        <input type=text name=n_alref038 size=30 readonly title="HCP Name"
         tabindex=-1
         value="%ALLWEB02.02.138.0" class=Readonly>
        <img src="../images/SearchIcon.gif" class=Icon
         onclick="HCPSearchFrame(UpdateForm.alref038,UpdateForm.n_alref038,4);">
        </td>
    </tr>

<tr><td class=DataLabel>Referred By Practice</td>
    <td><input type=hidden name=alref023 value="%ALLWEB02.02.123.0"
         title="HCP Practice" id=alref023>
        <input type=text size=35 class=readonly value="%ALLWEB02.02.123.1"
         tabindex=-1
         title="Practice Name" readonly name=n_alref023 id=n_alref023>
        <input type=hidden name=alref024 id=alref024
         title="Practice Count" value="%ALLWEB02.02.124">
        <img src="../images/SearchIcon.gif" class=Icon
         onclick="GPHCGSearchFrame(UpdateForm.alref022,UpdateForm.n_alref022,
                  UpdateForm.dummy,UpdateForm.alref023,
                  UpdateForm.n_alref023,UpdateForm.alref024);">
        <img src="../images/erase.gif" class=Icon
         onclick="clrFields(UpdateForm.alref023,UpdateForm.n_alref023,
                  UpdateForm.alref024,UpdateForm.dummy);">
    </td>
    <td class=DataLabel>Diagnosis 1</td>
    <td><select name=alref031 class=selectBig maxlength=45 tabindex=25
         title="Diagnosis 1">
        <option></option>
         %ALLWEB02.02.131.2
        </select></td>
    </tr>

<td class=DataLabel>Type of Referral</td>
    <td><select name=alref124 title="Type of Referral" tabindex=4
         class="SelectBig Mandatory">
        <option></option>
         %ALLWEB02.02.186.2
        </select>
        &nbsp;Expiry Date: <span id="expirydate">%ALLWEB02.02.187</span>
    </td>
    <td class=DataLabel>Diagnosis 2</td>
    <td><select name=alref032 class=selectBig maxlength=45 tabindex=26
         title="Diagnosis 2">
        <option></option>
         %ALLWEB02.02.132.2
        </select></td></tr>

<tr><td class=DataLabel>Priority</td>
    <td><select class="Mandatory selectBig" name=alref027 Title="Priority"
         tabindex=5>
        <option></option>
        %ALLWEB02.02.127.2
        </select></td>
    <td class=DataLabel>Diagnosis 3</td>
    <td><select name=alref033 class=selectBig maxlength=45 tabindex=27
         title="Diagnosis 1">
        <option></option>
         %ALLWEB02.02.133.2
        </select></td></tr>

<tr><td class=DataLabel>Referral Source</td>
    <td><select Title="Referral Source" name=alref034 tabindex=6
         class="Mandatory selectBig">
        <option></option>
         %ALLWEB02.02.134.2
        </select></td>
    <td class=DataLabel>Preferred Site</td>
    <td class=DataField><select name=alref119 title="Preferred Site"
      tabindex=28>
      <option></option>
      %ALLWEB02.02.182.2
    </select>
    </td></tr>


<tr><td class=DataLabel>%STANDARD.01.017.CL</td>
    <td><select title="%STANDARD.01.017.CL" name=alref035 tabindex=7
         class="Mandatory SelectBig" id=alref035>
        <option></option>
         %ALLWEB02.02.135.9.1.10.2.X
        </select></td>
    <td class=DataLabel>Clinic Type</td>
    <td><select name=alref106 class=selectBig maxlength=45 tabindex=29>
         %ALLWEB02.02.167.2
       </select></td></tr>

<tr><td class=DataLabel>Reason for Referral</td>
   <td><select class="Mandatory selectBig" name=alref028 tabindex=8
        Title="Reason for Referral" maxlength=45>
       <option></option>
        %ALLWEB02.02.128.2
       </select></td>
    <td class=DataLabel>Preferred Date</td>
    <td class=DataField>
    <input type=text name=alref096 size=12 tabindex=30
     onblur="checkDate(this,'Date')" value="%ALLWEB02.02.157"
     class="Date" title="Preferred Date">
    <img src="../images/DateTimeStamp.gif" class=Icon date=UpdateForm.alref096
     time=null>
    <img src="../images/DateLookup.gif" class=Icon date=UpdateForm.alref096>
    </td>
    </tr>

<tr><td class=DataLabel>Status</td>
    <td><input type=text value="%ALLWEB02.02.103" tabindex=-1
         readonly class=Readonly></td>
    <td class=DataLabel>Next Review Date</td>
    <td><input type=text name=alref037 size=12 tabindex=30
         class="FutureDate" title="Next Review Date" value="%ALLWEB02.02.137">
        <img src="../images/DateTimeStamp.gif" class=Icon
         date=UpdateForm.alref037 time=null>
        <img src="../images/DateLookup.gif" class=Icon
         date=UpdateForm.alref037>
    </td></tr>

</table>

<div id=InsertActive style="display:none;">
<table align=center cellspacing=0 cellpadding=1 border=0 width=95%>
<tr><td class=DataLabel width=15%>Activate Referral</td>
      <td><input type=checkbox name=activref tabindex=9
       title="Activate Referral" value="1">
      </td></tr>
</table>
</div>

<table align=center cellspacing=0 cellpadding=1 border=0 width=95%>
<tr><td class=DataLabel width=15%>Comments 1</td>
    <td><input type=text size=65 maxlength=60 name=alref088 tabindex=10 
         title="Comments 1" value="%ALLWEB02.02.149">
    </td></tr>

<tr><td class=DataLabel width=15%>Comments 2</td>
    <td><input type=text size=65 maxlength=60 name=alref089  tabindex=11
         value="%ALLWEB02.02.150">
    </td></tr>

<tr><td class=DataLabel>Case Team</td>
   <td><input type=text name=alref087 size=11 maxlength=11 title="Case Team"
        value="%ALLWEB02.02.148.1" tabindex=31
        onblur="if (checkAlphanumDesc(event,this) != false) {
                  validateCode2(7,UpdateForm.alref087,UpdateForm.n_alref087);
                }">
       <input type=text name=n_alref087 size=30 readonly 
        class=Readonly tabindex=-1 title="Team Description"
        value="%ALLWEB02.02.148.0">
       <img src="../images/SearchIcon.gif" class=Icon
        onclick="TeamSearchFrame(UpdateForm.alref087,UpdateForm.n_alref087);">
        <img src="../images/ClearIcon.gif" class=Icon
        onclick="clrFields(UpdateForm.alref087,UpdateForm.n_alref087);">
       </td></tr>

<tr><td class=DataLabel colspan=2>Print Update Referral Letter to Patient &nbsp;
&nbsp;  
      <input type=checkbox name=prtupdpt tabindex=32
       title="Upd Referral to pat" value="1">
      </td>
      <td class=DataLabel>Printer </td>
      <td><select name=prtpsl03 class="SelectBig" tabindex=-1>
      %STANDARD.01.001.ALLUPDPT.01
      </select></td></tr>
<tr><td class=DataLabel colspan=2>Print Update Referral Letter to Referrer
      <input type=checkbox name=prtupdrf tabindex=33
       title="Upd Referral to pat" value="1">
      </td>
      <td class=DataLabel>Printer </td>
      <td><select name=prtpsl04 class="SelectBig" tabindex=-1>
      %STANDARD.01.001.ALLUPDRF.01
      </select></td></tr>
<tr><td class=DataLabel colspan=2>Referral Labels
    <input type=checkbox value="1" name=prtreflb width=30% tabindex=34
        onclick="SetPrinter(UpdateForm.prtpno07,UpdateForm.prtpsl07);">
    Copies
    <select name=prtpno07 width=20% tabindex=-1>
        %STANDARD.01.027.2.1
    </select></td>
    <td class=DataLabel>Printer</td>
    <td><select class="SelectBig" name=prtpsl07 title="Printer" width=15%
         tabindex=-1>
        <option></option>
        %STANDARD.01.001.LABELALL.01
        </select></td></tr>
</table>

<table align=center cellspacing=0 cellpadding=1 border=0 width=95%>
<tr><td colspan=4 align=center><br>
    <input type=button value="OK" class="button" tabindex=90
     id="all02sub" onclick="tempDisable(this);UpdateReferral();">
    <input type=button Value="Close" class="button" tabindex=91
     onclick="DFrameClose();">
    </td></tr>
</table>
</form>

<script type="text/javascript">
//
  if ("%ALLWEB02.02.103" == "Waiting   ") {
  InsertActive.style.display='';
}
  else {
  InsertActive.style.display='none'; }
//
 SACSRef="%ALLWEB02.02.144";
 if ( SACSRef == "Yes") {
   document.UpdateForm.alref083.value=1;
 } else {
   document.UpdateForm.alref083.value=0;
 }
 if(document.getElementById("d_exprflag").value=="0") {
    document.getElementById("expirydate").className="Red";
    alert("Referral expired on %ALLWEB02.02.187");
 }
 if(document.getElementById("d_exprflag").value=="2") {
    document.getElementById("expirydate").className="Red";
    alert("Referral will expire on %ALLWEB02.02.187");
 }
</script>
