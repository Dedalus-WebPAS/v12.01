<meta name="TemplateVersion" content="V12.01.00">
<meta name="TemplateHome" content="private">
<meta name="HelpFileName" content="NoContextSet.html">
<meta name="CrossBrowser" content="true">
<script type="text/javascript" src=../js/preadmission.js></script>
<script type="text/javascript">

function validateDateRange(fromElement,toElement)
{
   if(fromElement && toElement)
   {
     if(fromElement.value != "Start" && toElement.value != "Finish")
     {
       if(SetDateYYYYMMDD(fromElement.value) > SetDateYYYYMMDD(toElement.value))
       {
         alert("Invalid Date Range");
         fromElement.value = "";
         fromElement.focus();
         return false;
       }
     }
   }
   return true;
}

function AddPrevious() {
  if(document.UpdateForm.enterday != undefined ) {
    if(document.UpdateForm.enterday.checked==true)  {
      if(isWhitespace(document.UpdateForm.progdays.value)) {
        alert("\'Day Program Days\' cannot be blank");
        return;
      }
    }
  }

  if (!isWhitespace(document.UpdateForm.pmphs003.value)&&
      !isWhitespace(document.UpdateForm.pmphs004.value)) {

     if (!validateDateRange(document.UpdateForm.pmphs003,
                            document.UpdateForm.pmphs004)) {
       return;
     }

  }


  if (!isWhitespace(document.UpdateForm.pmphs003.value)&&
      !isWhitespace(document.UpdateForm.pmphs004.value)&&
      !isWhitespace(document.UpdateForm.pmphs005.value)) {

      if (document.UpdateForm.pmphs005.value > 
          days_between(document.UpdateForm.pmphs003.value,
                       document.UpdateForm.pmphs004.value)) {
  
        alert("No of leave days cannot be greater than date range.");
        return;
  
      }

  }

  SetCookie("prevhospCookie",document.UpdateForm.prvhosck.value);
  SubmitHiddenNew(UpdateForm);
}
function Continue() {
  p=document.UpdateForm
  setRedirect();
  if (document.UpdateForm.ptcnxcom != undefined) {
    if (document.UpdateForm.ptcnxcom.value == "1") {
      setRedirectXCom();
    }
  }

  p.redirect.value=p.redirect.value+p.admissno.value;
  checkComp=document.UpdateForm.ptmis027.value.substr(3,1);
  if(checkComp=="A"||checkComp=="O"||checkComp=="M"||checkComp=="F"||
     checkComp=="H"||checkComp=="S"||checkComp=="V"||checkComp=="W"||
     checkComp=="E"||checkComp=="G"){
  } else {
    if(document.UpdateForm.mhadmflg.value=="1"){
      document.UpdateForm.redirect.value="patweb89.pbl?reportno=07&template=001"
      + "&urnumber=" + document.UpdateForm.urnumber.value
      + "&admissno=" + document.UpdateForm.admissno.value
    }
  }

  if (document.UpdateForm.visittyp.value!="3") {
    setRedirectEMR(); 
//    if (document.UpdateForm.prvhosck.value=="1") {
//      document.UpdateForm.redirect.value="emrweb02.pbl?reportno=01&template=012"
//      + "&urnumber=" + document.UpdateForm.urnumber.value
//      + "&admissno=" + document.UpdateForm.admissno.value    
//    } else {
//      if (document.UpdateForm.prvhosck.value=="3") {
//        SetCookie("prevhospdoneCookie",'1');
//        document.UpdateForm.redirect.value="emrweb02.pbl?reportno=01&template=004"
//        + "&urnumber=" + document.UpdateForm.urnumber.value
//        + "&admissno=" + document.UpdateForm.admissno.value
//        + "&regiflag=1"
//      } else {
//        document.UpdateForm.redirect.value="emrweb02.pbl?reportno=01&template=017"
//        + "&urnumber=" + document.UpdateForm.urnumber.value
//        + "&admissno=" + document.UpdateForm.admissno.value
//      }
//    }
  }
//
  if(document.UpdateForm.enterday != undefined ) {
    if(document.UpdateForm.enterday.checked==true)  {
      if(isWhitespace(document.UpdateForm.progdays.value)) {
        alert("\'Day Program Days\' cannot be blank");
        return;
      } 
      if(validateMandatory(UpdateForm)) {
        document.UpdateForm.nextpage.value="1";
        document.UpdateForm.redirect.value=p.redirect.value;
        document.UpdateForm.submit();
      }
      return;
    }
  }
//
  location.href=p.redirect.value;
}
function UpdatePrevious(linkurl) {
  Left=(document.body.clientWidth-500)/2
  DFrameLink(linkurl,0,Left,500,260)
}
function DeletePrevious(admissno,adate,ddate,hosp) {
  if(confirm("Are you sure you want to delete?")) {
    document.UpdateForm.updttype.value="D";
    document.UpdateForm.pmphs001.value=admissno;
    document.UpdateForm.pmphs003.value=adate;
    document.UpdateForm.pmphs004.value=ddate;
    document.UpdateForm.pmphs002.value=hosp;
    document.UpdateForm.nextpage.value="5";
    SubmitHiddenNew(UpdateForm);
  }
}

function DefaultDate(ctyp,cdate) {
  if(ctyp.value.substr(3,1)=="2") {
    document.UpdateForm.pmccd004.value=("31 Dec " + cdate.value.substr(0,4));
  }
}
function showCalculatedValues() {
  if (document.UpdateForm.visittyp.value!="3") {
    document.getElementById("calculatedValuesSPAN").innerHTML="";
  } 
}
function getPrvHosCk() {
  document.UpdateForm.prvhosck.value=GetCookieData("prevhospCookie");
  ExpireCookiePath("prevhospCookie");
}
function EnterDayProgramDays() {
  if(document.UpdateForm.enterday.checked == true) {
    document.UpdateForm.pmphs002.value="";
    document.UpdateForm.pmphs002.className="Readonly";
    document.UpdateForm.pmphs002.readOnly=true;
    document.UpdateForm.trandesc.value="";
    document.UpdateForm.pmphs003.value="";
    document.UpdateForm.pmphs003.className="readonly";
    document.UpdateForm.pmphs003.readOnly=true;
    document.UpdateForm.pmphs004.value="";
    document.UpdateForm.pmphs004.className="readonly";
    document.UpdateForm.pmphs004.readOnly=true;
    document.UpdateForm.pmphs005.value="";
    document.UpdateForm.pmphs005.className="readonly";
    document.UpdateForm.pmphs005.readOnly=true;
    document.UpdateForm.pmphs006[0].disabled=true;
    document.UpdateForm.pmphs006[0].checked=true;
    document.UpdateForm.pmphs006[1].disabled=true;
    document.UpdateForm.pmphs007[0].disabled=true;
    document.UpdateForm.pmphs007[1].disabled=true;
    document.UpdateForm.pmphs007[1].checked=true;
    document.UpdateForm.progdays.className="Mandatory Integer DefaultBlank";
    document.UpdateForm.progdays.readOnly=false;
    document.UpdateForm.progdays.value=
    trim(document.UpdateForm.d_adyhosp.value);
  } else {
    document.UpdateForm.pmphs002.className="Mandatory";
    document.UpdateForm.pmphs002.readOnly=false;
    document.UpdateForm.pmphs003.className="Mandatory PastDate";
    document.UpdateForm.pmphs003.readOnly=false;
    document.UpdateForm.pmphs004.className="Mandatory PastDate";
    document.UpdateForm.pmphs004.readOnly=false;
    document.UpdateForm.pmphs005.className="Mandatory Integer";
    document.UpdateForm.pmphs005.readOnly=false;
    document.UpdateForm.pmphs006[0].disabled=false;
    document.UpdateForm.pmphs006[0].checked=true;
    document.UpdateForm.pmphs006[1].disabled=false;
    document.UpdateForm.pmphs007[0].disabled=false;
    document.UpdateForm.pmphs007[0].checked=true;
    document.UpdateForm.pmphs007[1].disabled=false;
    document.UpdateForm.progdays.value="";
    document.UpdateForm.progdays.className="Readonly";
    document.UpdateForm.progdays.readOnly=true;
  }
}
function chkTransferSourceFrame() {
  if(document.UpdateForm.pmphs002.readOnly==true) {
    return;
  }
  TransferSourceFrame(UpdateForm.pmphs002,UpdateForm.trandesc);
}
</script>
</head>
%START.OF.PAGE
<body onLoad="PageLoad(event);self.focus();showCalculatedValues();getPrvHosCk();">
<div id=PatientHeading></div>
<script type="text/javascript">
PatientURN="%PATWEB07.15.003";
PatientVIS="%PATWEB07.15.081";
PatientNAM="%PATWEB07.15.002";
PatientSTA="%PATWEB07.15.086.078";
PatientALT="%PATWEB07.15.084";
PatientSEX="%PATWEB07.15.019";
PatientDOB="%PATWEB07.15.020";
PatientAGE="%PATWEB07.15.021";
PatientLOC="%PATWEB07.15.083";
PatientPRI="%PATWEB07.15.086.066.1";
PatientUNT="%PATWEB07.15.066.0";
DoctorCOD="%PATWEB07.15.082.003";
DoctorNAM="%PATWEB07.15.082.002";
PatientAID="%PATWEB07.15.086.090";
PatientIND="%PATWEB07.15.086.091";
PatientCUR="%PATWEB07.15.086.092";
PatientCLC="%PATWEB07.15.086.093.1";
PatientCLH="%STANDARD.01.017.CL";
PatientHFT="%PATWEB07.15.086.094";
PatientCDM="%PATWEB07.15.086.095";
PatientVDH="%PATWEB07.15.086.099.015";
InsertPatientHeader()
</script>
<div id=PatientMenu></div>
<div id="PageBodySection">
<form name=UpdateForm action="patweb07.pbl" method=post style="margin:0">
<input type=hidden name=reportno value="15">
<input type=hidden name=template value=1>
<input type=hidden name=updttype value="A">
<input type=hidden name=nextpage value="5">
<input type=hidden name=pmphs001 value="%PATWEB07.15.081">
<input type=hidden name=admissno value="%PATWEB07.15.081">
<input type=hidden name=urnumber value="%PATWEB07.15.003">
<input type=hidden name=ptmis027 value="%PATWEB07.15.226.3">
<input type=hidden name=emvis008 value="%PATWEB07.15.304.3">
<input type=hidden name=mvmedrec value="%PATWEB07.15.305">
<input type=hidden name=redirect value="0">
<input type=hidden name=mhadmflg value="%PATWEB07.15.302">
<input type=hidden name=admitbox value="1">
<input type=hidden name=visittyp value="%PATWEB07.15.303">
<input type=hidden name=prvhosck value="">
<input type=hidden name=regiflag value="0">
<input type=hidden name=d_adyhosp value="%PATWEB07.15.230">
<input type=hidden name=cfinan id="cfinan" value="0">
<input type=hidden name=ptcnxcom value="%STANDARD.01.025.116.222.0.1">

<table width=100% border=0 cellpadding=0 cellspacing=0 bgcolor=#cccccc>
<tr><td width=100% colspan=9 class=HeadingCell align=center>
        Previous Hospitalisation</td></tr>

<tr><td class=DataLabel> Previous Hospital </td>
<td><input type="text" size="7" maxlength="5" name="pmphs002" class="Mandatory"
      title="Transfer Source" tabindex=1
      onchange="validateCode(9,UpdateForm.pmphs002,UpdateForm.trandesc);">
     <input type="text" size="27" name="trandesc" notab
      class="Readonly" readonly />
     <img src="../images/SearchIcon.gif" class=Icon
      onclick="chkTransferSourceFrame(UpdateForm.pmphs002,UpdateForm.trandesc)">
     </td>

    <td class=DataLabel> Previous Admission Date </td>
         <td><input type="text" size="12" name="pmphs003" tabindex=2
             class="Mandatory PastDate" title="Previous Admission Date">
         <img notab src="../images/DateLookup.gif" class=Icon
          onclick="DateLookupFrame(UpdateForm.pmphs003);"></td>

    <td class=DataLabel> Previous Discharge Date </td>
         <td><input type="text" size="12" name="pmphs004" tabindex=3
             class="Mandatory PastDate" title="Previous Discharge Date">
         <img notab src="../images/DateLookup.gif" class=Icon
          onclick="DateLookupFrame(UpdateForm.pmphs004);"></td>

    <td class=DataLabel> No of Leave Days </td>
         <td><input type="text" size="6" name="pmphs005" tabindex=4
             class="Mandatory Integer" maxlength=5
             title="No of Leave Days">
    </td>
    <td class=DataLabel>
         <table width=100%>
         <tr><td>Include in Billing Calculations</td>
         <td class=DataLabel>Yes</td>
         <td><input name="pmphs006" type=radio value=1></td>
         <td class=DataLabel>No </td>
         <td><input name="pmphs006" type=radio value=0 checked></td></tr>

         <tr><td>Include in 3B Calculations</td>
         <td class=DataLabel>Yes</td>
         <td><input name="pmphs007" type=radio value=1 checked></td>
         <td class=DataLabel>No </td>
         <td><input name="pmphs007" type=radio value=0></td>
         </tr>

         </table>
    </td>
    </tr>

<tr><td colspan=9 align=center>
    <input type=button class="button" value="Add" tabindex=5 id=btnAdd
           onclick='tempDisable(this);AddPrevious();'>
<!--
    <input type=button class="button" value="Cancel"
     title="Cancel - Return to update demographics"
     onclick='PatientLinkTo("patweb98.pbl","1","49",0,0,0);'>
-->
    <input type=button class="button" value="Continue" tabindex=6
           onClick='Continue();'>
</td></tr>
<tr id="calculatedValuesSPAN"><td>&nbsp;</td>
    <td>&nbsp;</td>
    <td>Calculated Original Admission Date</td>
    <td>%PATWEB07.15.299.016</td>      
    <td>Calculated Total Days</td>
    <td>%PATWEB07.15.230</td>
    <td>Enter Day Program Days</td>
    <td><input type=checkbox name="enterday" value="1" autocomplete="off"
         onclick="EnterDayProgramDays();"></td>
    <td><input type=text name="progdays" id="progdays" class="Readonly"
         title="Day Program Days" autocomplete="off"
         readonly size=3 maxlength=3 min=0 max=999></td>
    </tr>
</table>

<table width=100% border=0 cellpadding=0 cellspacing=0>
<tr><td class=HeadingCell> Previous Hospital </td>
    <td class=HeadingCell> Previous Admission Date </td>
    <td class=HeadingCell> Previous Discharge Date </td>
    <td class=HeadingCell> Leave Days </td>
    <td class=HeadingCell width=10%> &nbsp; </td></tr>
    %PATWEB07.15.110.patweb07.15.002
</table>

</form>

<form name=PatientLinks method=get>
<input type=hidden name=reportno value=1>
<input type=hidden name=template value=004>
<input type=hidden name=regexstm value=102>
<input type=hidden name=newstand value=1>
<input type=hidden name=urnumber value="%PATWEB07.15.003">
<input type=hidden name=admissno value="%PATWEB07.15.081">
<input type=hidden name=MenuType value="%PATWEB07.15.088">
</form>
</div>

