<meta name="TemplateVersion" content="V12.01.00">
<meta name="TemplateHome" content="private">
<meta name="HelpFileName" content="NoContextSet.html">
<meta name="CrossBrowser" content="true">
<script type="text/javascript" src="../js/oprweb05.js"> </script>
<script type="text/javascript" src="../js/TheatreScreensHoverInfo.js"></script>
<script type="text/javascript">
function buildRedirect() {
  document.UpdateForm.redirect.value="oprweb01.pbl?reportno=03&template=003&sesskeys="+
  document.UpdateForm.sesskeys.value.substring(0,3)+
  document.UpdateForm.sesskeys.value.substring(3,11)+
  document.UpdateForm.opses002.value.substring(0,5)+
  document.UpdateForm.sesskeys.value.substring(16,22)+
  "&dispteam=1";
}

function AssignAddForm() {
  parent.AddForm.reportno.value=document.UpdateForm.reportno.value;
  parent.AddForm.template.value=document.UpdateForm.template.value;
  parent.AddForm.updttype.value="U";
  parent.AddForm.opses003.value=document.UpdateForm.opses003.value;
  parent.AddForm.respnvar.value="";
  parent.AddForm.startime.value="";
  UpdateForm.opses007.value=UpdateForm.opses007.value.replace(/ /g,"");
  parent.AddForm.endtime.value=document.UpdateForm.endtime.value;
  parent.AddForm.sesstime.value=document.UpdateForm.sesstime.value;
  parent.AddForm.duration.value="";
  parent.AddForm.overrid1.value=document.UpdateForm.overrid1.value;
  parent.AddForm.overrid2.value=document.UpdateForm.overrid2.value;
  parent.AddForm.overrid3.value=document.UpdateForm.overrid3.value;
  parent.AddForm.overrid4.value=document.UpdateForm.overrid4.value;
  parent.AddForm.overrid5.value=document.UpdateForm.overrid5.value;
  parent.AddForm.overrid6.value=document.UpdateForm.overrid6.value;
  parent.AddForm.opses001.value=document.UpdateForm.opses001.value;
  parent.AddForm.opses002.value=document.UpdateForm.opses002.value;
  parent.AddForm.opses007.value=document.UpdateForm.opses007.value;
  parent.AddForm.opses008.value=document.UpdateForm.opses008.value;
  parent.AddForm.opses009.value=document.UpdateForm.opses009.value;
  parent.AddForm.opses010.value=document.UpdateForm.opses010.value;
  parent.AddForm.opses013.value=document.UpdateForm.opses013.value;
  parent.AddForm.opses011.value=document.UpdateForm.opses011.value;
  parent.AddForm.opses012.value=document.UpdateForm.opses012.value;
  parent.AddForm.opses015.value=document.UpdateForm.opses015.value;
  parent.AddForm.opses014.value=document.UpdateForm.opses014.value;
  parent.AddForm.opses064.value=document.UpdateForm.opses064.value;
  parent.AddForm.opses069.value=document.UpdateForm.opses069.value;
  parent.AddForm.opses070.value=document.UpdateForm.opses070.value;
  parent.AddForm.opses071.value=document.UpdateForm.opses071.value;
  parent.AddForm.opses067.value=document.UpdateForm.opses067.value;
  parent.AddForm.opses068.value=document.UpdateForm.opses068.value;
  parent.AddForm.opses074.value=document.UpdateForm.opses074.value;
}
</script>
</head>
%START.OF.PAGE
<body onload="PageLoad(event); setAlign(); setTimeFormat();">
<span class=DFrameTitleBar>
<img align="right" alt="Exit" class="MenuIcon" 
 src="../images/ExitIcon.gif" onclick="DFrameExit();">
<script type="text/javascript">document.write(self.document.title);</script>
</span>
<script type="text/javascript">
  function setAlign() {
    UpdateForm.opses008.value=UpdateForm.opses008.value.replace(/ /g,"");
    UpdateForm.opses009.value=UpdateForm.opses009.value.replace(/ /g,"");
    UpdateForm.opses010.value=UpdateForm.opses010.value.replace(/ /g,"");
  }
  function setTimeFormat() {
   UpdateForm.opses002.value = UpdateForm.opses002.value + ":00";
   UpdateForm.opses007.value = UpdateForm.opses007.value + ":00";
  }
// Check Patient Booking
function ChkPat() {
 if (UpdateForm.opses002.value.substr(0,5)!=UpdateForm.sesstime.value) {
   if (!(UpdateForm.booktime.value==0)) {
     if(!confirm("Patients Booked in this Session. Update Start Times")) {
        UpdateForm.opses002.value=UpdateForm.sesstime.value + ":00";
        UpdateForm.opses007.focus();
      }
    }
  }
}
function ChkDura(newdur,olddur,booked) {
Old=parseInt(olddur.value.replace(/ /g,""),10)
New=parseInt(newdur.value.replace(/ /g,""),10)
Booked=parseInt(booked.value.replace(/ /g,""),10)
  if(New < Old) {
     if(!confirm("The new duration will be less than the current duration")) {
        UpdateForm.opses007.value=UpdateForm.endtime.value + ":00";
        CheckOvernight(UpdateForm.opses002,UpdateForm.opses007,UpdateForm.opses008);
        UpdateForm.opses007.focus();
        return;
     }
     if(New < Booked) {
       if(!confirm("This session will be Overbooked. Ok to continue")) {
          UpdateForm.opses007.value=UpdateForm.endtime.value + ":00";
          CheckOvernight(UpdateForm.opses002,UpdateForm.opses007,UpdateForm.opses008);
          UpdateForm.opses007.focus();
       }
     }
  }
}
//
// Calculate new session end time - New End Time = Start Time + Duration
//
function CalcEndTime(startime,duration) {
 if (startime.value=="") { return; }
 if (duration.value=="") { return; }
 stime = new Date();
 dtime = new Date();
 stime.setHours(startime.value.substr(0,2));
 stime.setMinutes(startime.value.substr(3,2));
 stime.setSeconds(startime.value.substr(6,2));
//
 DuratSec= Math.floor(duration.value * 60)
 DuratMilSec = Math.floor(DuratSec * 1000)
//
 StartSecs = stime.getTime(); 
 NewEnd = Math.floor(StartSecs + DuratMilSec);
 dtime.setTime(NewEnd);
 timeend = ZeroPad(dtime.getHours(),2) + ":";
 timeend = timeend + ZeroPad(dtime.getMinutes(),2) + ":";
 timeend = timeend + ZeroPad(dtime.getSeconds(),2);
 UpdateForm.opses007.value = timeend; 
}
</script>

<div id=PageBodySection>
<form name=UpdateForm method=post action=oprweb05.pbl style="margin:0">
  <input type=hidden name=reportno value="2">
  <input type=hidden name=template value="003">
  <input type=hidden name=updttype value="">
  <input type=hidden name=opses003 value="%OPRWEB05.02.001">
  <input type=hidden name=sesstime value="%OPRWEB05.02.103">
  <input type=hidden name=endtime  value="%OPRWEB05.02.108">
  <input type=hidden name=booktime value="%OPRWEB05.02.118">
  <input type=hidden name=savedura value="%OPRWEB05.02.109">
  <input type=hidden name=opcnscom value="%OPRWEB05.02.022">
  <input type=hidden name=comindic value="%OPRWEB05.02.023.1">
  <input type=hidden name=overrid1 value="">
  <input type=hidden name=overrid2 value="">
  <input type=hidden name=overrid3 value="">
  <input type=hidden name=overrid4 value="">
  <input type=hidden name=overrid5 value="">
  <input type=hidden name=overrid6 value="">
  <input type=hidden name=opses008 value="%OPRWEB05.02.109">
  <input type=hidden name=opses009 value="%OPRWEB05.02.110">
  <input type=hidden name=opses010 value="%OPRWEB05.02.111">
  <input type=hidden name=opses012 value="%OPRWEB05.02.113.1">
  <input type=hidden name=opses014 value="%OPRWEB05.02.115.003">
  <input type=hidden name=opses069 value="%OPRWEB05.02.168">
  <input type=hidden name=redirect>
  <input type=hidden name=nextpage value="6">
  <input type=hidden name=sesskeys value="%OPRWEB05.02.101">
  <input type=hidden name=opses074 value="%OPRWEB05.02.179.1">

<table cellspacing=0 cellpadding=0 width=100% >
<tr><td align=center class=Heading>
    <b>Update Session details for %OPRWEB05.02.002 (%OPRWEB05.02.001)</b></td>
</tr>
</table>

<table align=center cellspacing=0 cellpadding=1 width=95% border=0>
<tr><td class=DataLabel>Session Date</td>
    <td><input type=text name=opses001 class=Readonly title="Session Date"
         size=12 maxlength=12 readonly value="%OPRWEB05.02.102" tabindex=-1> 
    </td></tr>

<tr><td class=DataLabel>Start Time</td>
   <td><input type=text name=opses002 class=Mandatory title="Start Time"
        id=opses002 size=8 maxlength=8 value="%OPRWEB05.02.103" tabindex=-1
     onblur="checkTime(this);ChkPat();CalcEndTime(opses002,opses008);">
        <img src=../images/TimeLookup.gif class=Icon
       onclick="TimeLookupFrame(opses002);">
    </td></tr>

<tr><td class=DataLabel>End Time</td>
    <td><input type=text name=opses007 class=Mandatory title="End Time"
         size=8 maxlength=8 value="%OPRWEB05.02.108" id=opses007
         onblur="checkTime(this);CheckOvernight(opses002,opses007,opses008);ChkDura(opses008,savedura,booktime);">
        <img src=../images/TimeLookup.gif class=Icon
       onclick="TimeLookupFrame(opses007);">
    </td></tr>

<tr><td class=DataLabel>Operating Room</td>
    <td><select name=opses013 title="Operating Room">
          <option></option>
          %OPRWEB05.02.114.2            
          </select>
    </td></tr>

<tr><td class=DataLabel>Time Period</td>
    <td><select name=opses011 class=Mandatory title="Time Period">
          <option></option>
          %OPRWEB05.02.112.2            
          </select>
    </td></tr>
<!-- HPS Code Ends Here -->
<tr><td class=DataLabel>Usual Anaesthetist</td>
    <td><input type=text name=opses015 title="Usual Anaesthetist"
         size=6 maxlength=6 value="%OPRWEB05.02.116.003" id=opses015
         onblur="validateCode(3,opses015,name_opses015);"> 
    <input type=text name=name_opses015 title="Usual Anaesthetist"
     size=22 maxlength=30 value="%OPRWEB05.02.116.002" id=name_opses015
     class=Readonly readonly tabindex=-1>   
    <img src="../images/SearchIcon.gif" class=Icon
    onclick="DoctorSearchFrame(opses015,name_opses015);">
    <img src="../images/erase.gif" class=Icon
    onclick="clrDoc(opses015,name_opses015);">
</td></tr>
 
<tr><td class=DataLabel>Extra Doctor</td>
    <td><input type=text name=opses064 title="Extra Doctor" size=6 maxlength=6
         value="%OPRWEB05.02.165.003" id=opses064
         onblur="validateCode(3,opses064,name_opses064);">
    <input type=text name=name_opses064 title="Extra Doctor"
     size=22 maxlength=30 value="%OPRWEB05.02.165.002" id=name_opses064
     class=Readonly readonly tabindex=-1>
    <img src="../images/SearchIcon.gif" class=Icon
    onclick="DoctorSearchFrame(opses064,name_opses064);">
    <img src="../images/erase.gif" class=Icon 
    onclick="clrDoc(opses064,name_opses064);">
</td></tr>
<tr><td class=DataLabel>Session Type</td>
    <td><select name=opses070 class=Mandatory title="Session Type">
          <option></option>
          %OPRWEB05.02.169.2            
          </select>
          <img src="../images/HelpIcon.gif" id=SessionTypeIcon class="Icon"
             onmouseover="showPopUpTheatreSess(UpdateSessionMaint,195,90);">
    </td>
</tr>
<tr><td class=DataLabel>Day/General Surgery Indicator</td>
    <td><select name=opses071 class=Mandatory 
         title="Day/General Surgery Indicator">
          <option></option>
          %OPRWEB05.02.175.2            
          </select>
    </td>
</tr>
<tr><td class=DataLabel>Special Instructions 1</td>
    <td><input type=text name=opses067 title="Special Instructions 1" 
         class=DataField size=60 value="%OPRWEB05.02.166">
    </td>
</tr>

<tr><td class=DataLabel>Special Instructions 2</td>
    <td><input type=text name=opses068 title="Special Instructions 2" 
         class=DataField size=60 value="%OPRWEB05.02.167">
    </td>
</tr>
<!-- HPS Code Ends Here -->

<tr><td colspan=2 align=center>
      <input type=button value="Update" class="button" id=Updtbttn
  onclick="tempDisable(this);validateTheatreAvailability();">
      <input type=button value="Cancel" class="button" onclick="DFrameClose();">
    </td>
</tr>

</form>
</div>
</table>

<span id=blanklabel style="display:none">&nbsp;</span>

<form name=SelectCode method=get action=oprweb05.pbl>
<input type=hidden name=reportno value="2">
<input type=hidden name=template value="008">
<input type=hidden name=opses001 value="%OPRWEB05.02.102">
<input type=hidden name=opses002 value="%OPRWEB05.02.103">
<input type=hidden name=opses003 value="%OPRWEB05.02.001">
</form>
<script>

function validateTheatreAvailability() {

  if (checkTheatreAvailability(document.UpdateForm.opses013,
                               document.UpdateForm.opses001.value,
                               document.UpdateForm.opses002.value,
                               document.UpdateForm.opses007.value)) {
     AssignAddForm();
     buildRedirect();
     setFormactn('U');
  }

}

</script>
