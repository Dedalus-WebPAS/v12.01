<meta name="TemplateVersion" content="V12.01.00">
<meta name="TemplateHome" content="bop">
<meta name="HelpFileName" content="NoContextSet.html">
<meta name="CrossBrowser" content="true">
<script type="text/javascript" src="../js/watweb0102.js"></script>
<script type="text/javascript">
var specialtyArray = new Array();
var selectedSpecialty = -1;

 /*
function checkPriority() {
  if (trim(AddForm.wattr014.value.substr(6,1))=="T") {
    AddForm.wattr025.className="Mandatory"
  }
  else if (trim(AddForm.wattr014.value.substr(6,1))=="P") {
    AddForm.wattr025.className="Mandatory"
  }
  else {
    AddForm.wattr025.className="";
  }
}
*/

function SubForm(AddForm) {
  datechk=validateOpDate();
  if (!datechk) { 
    return;
  }

  result=validateTime();
  document.AddForm.wattr017.value = document.AddForm.specialt.value;
  if (result) {
    var serverURL = "../cgi-bin/watweb01.pbl?reportno=12&valdtype=1" +
      "&urnumber="+document.AddForm.urnumber.value.replace(/ /g,"+") +
      "&proccode="+document.AddForm.wattr001.value.replace(/ /g,"+");
    var returnValue = RSExecute(serverURL);
    if (returnValue.return_value == -1) {
     if (!confirm("Waiting list entry already exists.\nOK will create a duplicate.")) {
       return false;
      } 
    }

    document.AddForm.nextpage.value="9";
    document.AddForm.redirect.value="watweb01.pbl?reportno=4&template=4"

    linkACC();
    SubmitHidden(document.AddForm);
    return true;
  }
}

function linkACC() {
  if (AddForm.wattx026.value.substr(3,1)=='W') {
    document.AddForm.nextpage.value="9";
    AddForm.redirect.value="patweb89.pbl?reportno=01&template=005&systflag=4" +
                "&urnumber="+document.AddForm.urnumber.value.replace(/ /g,"+")
  }
}

function UpdateUnit(){
  for (var i =0 ; i < document.AddForm.wattr011.length; i++) {
    if (trim(AddForm.unit.value)==trim(AddForm.wattr011.options[i].value.substr(0,3))) {
      document.AddForm.wattr011.selectedIndex=i;
    }
  };
}

function valUnit() {
  if (isWhitespace(document.AddForm.wattr012.value)) {
    AddForm.wattr011.options.length=0;
    return;
  }

  AddForm.unit.value=AddForm.wattr011.value.substr(0,3);
  selectOptions("30",AddForm.wattr012,AddForm.wattr011);
  validateCode(31,AddForm.wattr012,AddForm.name_wattr012,AddForm.specialty);

  //clears he contents of the dropdown box
  document.getElementById("specialt").innerHML = "";

  buildDrSpecList(AddForm.name_wattr012.value,AddForm.wattr012.value,
                  AddForm.wattr006.value);

  for (var i =0 ; i < document.AddForm.specialt.length; i++) {
    if (trim(AddForm.specialty.value)==trim(AddForm.specialt.options[i].value.substr(0,3))) {
      document.AddForm.specialt.selectedIndex=i;
    }
  };

  if (isWhitespace(document.AddForm.unit.value)) {
    AddForm.wattr011.selectedIndex=1;
  } 
  else {
    UpdateUnit();
  }
  AddForm.unit.value="";
}

function valProc() {
  validateCode(27,AddForm.wattr001,AddForm.dummy1,AddForm.wpgrp,AddForm.wattr013,AddForm.wattr002);
  AddForm.wattr003.value=AddForm.dummy1.value;
}

function valDoc() {
  var serverURL = "../cgi-bin/watweb01.pbl?reportno=13&valdtype=1" +
          "&wattr011="+document.AddForm.wattr011.value +
          "&wattr012="+document.AddForm.wattr012.value;
  var returnValue = RSExecute(serverURL);
  if (returnValue.return_value == -1) {
    return true;
  }
  return false;
}

function DefStat() {
  ChgStat();
}

function ChgStat() {
  var ind=document.AddForm.wattx004.value.substr(3,1)
  if (ind == "C"|| ind =="D" || ind =="S") {
    document.getElementById('NRFCLabel1').innerHTML="NRFC To Date";
    document.getElementById('NRFCLabel2').innerHTML="Auto Update RFC";
    document.getElementById('NRFCLabel3').innerHTML="NRFC Reason";
    document.getElementById('NRFCField1').innerHTML=
      document.getElementById('InNRFCField1').innerHTML;
    document.getElementById('NRFCField2').innerHTML=
      document.getElementById('InNRFCField2').innerHTML;
    document.getElementById('NRFCField3').innerHTML=
      document.getElementById('InNRFCField3').innerHTML;
    AddForm.watsu003.className="Mandatory";
  }
  else {
    document.getElementById('NRFCLabel1').innerHTML="";
    document.getElementById('NRFCLabel2').innerHTML="";
    document.getElementById('NRFCLabel3').innerHTML="";
    document.getElementById('NRFCField1').innerHTML="";
    document.getElementById('NRFCField2').innerHTML="";
    document.getElementById('NRFCField3').innerHTML="";
  } 
  if (ind == "S"){
    AddForm.watsu003.selectedIndex=1;
  }
  if (ind == "C"){
    AddForm.watsu003.selectedIndex=2;
  }
  if (ind == "D"){
    AddForm.watsu003.selectedIndex=3;
  }
}

function RemoveQuote(Field) {
  Field.value=Field.value.replace(/\"/g,"");
}
</script>
</head>
%START.OF.PAGE
<body onload="PageLoad(event); createSpecialtyArray();">
<div id=PatientHeading></div>
<script type="text/javascript">
PatientURN="%WATWEB01.02.003";
PatientVIS="%WATWEB01.02.081";
PatientNAM="%WATWEB01.02.002";
PatientSTA="%WATWEB01.02.086.078";
PatientALT="%WATWEB01.02.084";
PatientSEX="%WATWEB01.02.019";
PatientDOB="%WATWEB01.02.020";
PatientAGE="%WATWEB01.02.021";
PatientLOC="%WATWEB01.02.083";
DoctorCOD="%WATWEB01.02.082.003";
DoctorNAM="%WATWEB01.02.082.002";
PatientAID="%WATWEB01.02.086.090";
PatientIND="%WATWEB01.02.086.091";
PatientCUR="%WATWEB01.02.086.092";
PatientCLC="%WATWEB01.02.086.093.1";
PatientCLH="%STANDARD.01.017.CL";
PatientHFT="%WATWEB01.02.086.094";
PatientCDM="%WATWEB01.02.086.095";
PatientVDH="%WATWEB01.02.086.099.015";
PatientUNT="%WATWEB01.02.066.0";
PatientPRI="%WATWEB01.02.086.066.1";
InsertPatientHeader();
</script>

<div id=PatientMenu></div>
<div id=PageBodySection style="overflow: auto;">

<form name=AddForm action="watweb01.pbl" method=post>
<input type=hidden name=reportno value=2>
<input type=hidden name=template value=001>
<input type=hidden name=updttype value="A">
<input type=hidden name=urnumber value="%WATWEB01.02.003">
<input type=hidden name=dummy value="">
<input type=hidden name=dummy1 value="">
<input type=hidden name=unit value="">
<input type=hidden name=wpgrp value="">
<input type=hidden name=redirect value="">
<input type=hidden name=nextpage value="1">
<input type=hidden name=specialty value="">
<input type=hidden name=wattr017 value="">
<input type=hidden name=wattr038 value="%STANDARD.01.032">
<input type=hidden name=c_specialt id=c_specialt value="%WATWEB01.02.333.011.1">

<table border=0 width=100% cellspacing="0" cellpadding="1" align=center>
<tr><td align=center class=HeadingCell>Add Waiting List Entry </td></tr>
</table>

<table border=0 width=95%  cellspacing=0 cellpadding=1 align=center>
<tr><td class=DataLabel>Referral Date</td>
    <td class=DataField>
    <input type=text name=wattr006 size=12 tabindex=5
     onblur="checkDate(this,'Date')" value="%STANDARD.01.015"
     class= "PastDate Mandatory" title="Date on List">
    <img src=../images/DateTimeStamp.gif class=Icon date=AddForm.wattr006
     time=null>
    <img src=../images/DateLookup.gif class=Icon date=AddForm.wattr006>
    </td></tr>

<tr><td class=DataLabel>Procedure Code        </td>
    <td class=DataField>
    <input type=text name=wattr001 class=Mandatory  tabindex=10
    title="Procedure Code" onblur="valProc();">
    <img src=../images/SearchIcon.gif class=Icon
     onclick="WaitProNoUnitSearchFrameK(AddForm.wattr001,
                                 AddForm.wattr003,
                                 AddForm.wattr013,
                                 AddForm.dummy)"></td>
    <td class=DataLabel>Proposed Adm. Date</td>
    <td class=DataLabel >
    <input type=text name=wattr008 size=12 maxlength=12 tabindex=18
       onblur="checkDate(this,'Date')">
    <img src=../images/DateLookup.gif class=Icon date=AddForm.wattr008>
<tr><td class=DataLabel>Procedure</td>
    <td class=DataLabel >
    <input type=text name=wattr003 size=70 maxlength=50 tabindex=15
     onblur="RemoveQuote(this);"></td>
   <td class=DataLabel>Preadmission Date </td>
    <td class=DataLabel>
    <input type=text name=wattr022 size=12 maxlength=12 tabindex=100
    onblur="checkDate(this,'Date')">
    <img src=../images/DateLookup.gif class=Icon date=AddForm.wattr022>
    Time
    <input type=text name=wattx028 size=8 maxlength=8 tabindex=105 title="Time">
    <img src=../images/DateTimeStamp.gif class=Icon
     date=AddForm.wattr022 time=AddForm.wattx028>
    <img src=../images/TimeLookup.gif class=Icon  time=AddForm.wattx028>
    </td></tr>

<tr valign=top><td class=DataLabel></td>
    <td class=DataField >
    <input type=text name=wattr004 size=70 maxlength=40 tabindex=20
     onblur="RemoveQuote(this);"></td>
    <td class=DataLabel>Pre-Anaesthetic Date</td>
    <td class=DataLabel>
    <input type=text name=wattr042 size=12 
     value="%WATWEB01.02.152"  onblur="checkDate(this,'Date');"
     title="Date of Change" tabindex=110>
    <img src=../images/DateLookup.gif class=Icon date=AddForm.wattr042>
                        Time
    <input type=text name=wattx031 size=8   maxlength=12 tabindex=111
      title="Preadmission Time" value="%WATWEB01.02.531" >
    <img src=../images/DateTimeStamp.gif  class=Icon
     date=AddForm.wattr042 time=AddForm.wattx031>
    <img src=../images/TimeLookup.gif class=Icon
     time=AddForm.wattx031>
    </td></tr>

<tr><td class=DataLabel>Duration of Procedure  </td>
    <td class=DataField>
    <input type=text name=wattr002 size=10 tabindex=22 maxlength=5   
       title="Estimated Operating time" class=Integer min=0></td>
    <td class=DataLabel>Pre-Anaesthetic Status</td>
    <td class=DataLabel>
    <select name=wattx030 class=selectBig title="Pre-Anaesthetic Status"
     tabindex=112>
    <option></option>
    %WATWEB01.02.530.2
    </select>
    </td></tr>

<tr><td class=DataLabel>%STANDARD.01.017.TP</td>
    <td class=DataField>
   <select name=wattr014 class=Mandatory tabindex=25 title="%STANDARD.01.017.TP"
           onchange="/*checkPriority();*/">
    <option></option>
    %WATWEB01.02.117.2
    </select></td>
    <td class=DataLabel>Patient Confirmed </td>
    <td class=DataLabel >
    <input type=text name=wattr023 size=12 maxlength=12 tabindex=115
       onblur="checkDate(this,'Date')"> 
    <img src=../images/DateLookup.gif class=Icon date=AddForm.wattr023>
<tr><td class=DataLabel>Score</td>
    <td class=DataLabel>
    <input type=text name=wattr047 size=5 maxlength=5 tabindex=30
     class="Integer" min=0 title="Rank"></td>
    <td class=DataLabel>Proposed Op. Date</td>
    <td class=DataLabel >
    <input type=text name=wattr028 size=12 maxlength=12 tabindex=125
      title="Date" onblur="checkDate(this,'Date')"> 
    <img src=../images/DateLookup.gif class=Icon date=AddForm.wattr028>
    Time
    <input type=text name=wattx029 size=8 maxlength=8 tabindex=130 title="Time">
    <img src=../images/DateTimeStamp.gif class=Icon
     date=AddForm.wattr028 time=AddForm.wattx029>
    <img src=../images/TimeLookup.gif class=Icon  time=AddForm.wattx029>
    </td>

<tr><td class=DataLabel>%STANDARD.01.017.P   </td>
    <td class=DataField>
    <select name=wattr024  tabindex=35 class="selectBig"
     title="%STANDARD.01.017.P ">
    <option></option>
     %WATWEB01.02.131.2
    </select></td>

<tr><td class=DataLabel>Admitting Point  </td>
    <td class=DataField>
    <select name=wattx006  tabindex=40 class="selectBig"
     title="Admitting Point">
    <option></option> 
     %WATWEB01.02.506.2
    </select></td>  
    <valign=top><td class=DataLabel>Comments</td>

<tr><td class=DataLabel>Exp. Post Op Ward  </td>
    <td class=DataField>
    <select name=wattx005 tabindex=45 class="selectBig"
     title="Exp. Post Op Ward" >
    <option></option>
     %WATWEB01.02.505.2
    </select></td>
    <td class=DataField rowspan=3 colspan=2> 
    <textarea wrap=hard name=wattrcom cols=50 rows=3 tabindex=135>
    </textarea></td></tr>

<tr><td class=DataLabel>Planned LOS</td>
    <td class=DataLabel>
    <input type=text name=wattr013 size=5 maxlength=5 tabindex=50
 class="Integer" min=0 title="Planned Length of Stay">(days)</td></tr>   

<tr><td>Consultant</td>
    <td class=DataField>
    <input type=text name=wattr012 size=6 maxlength=8 title="Consultant" 
     class=Mandatory tabindex=55 onblur="UpCase(this);valUnit();">
    <input type=text name=name_wattr012 tabindex=2 size=20 maxlength=30
     title="Consultant Name">
    <img src=../images/SearchIcon.gif class=Icon
    onclick="WaitConSearchFrame(AddForm.wattr012,
                               AddForm.name_wattr012,
                               AddForm.wattr011);"></td>

<tr><td class=DataLabel>Unit</td>
    <td class=DataField>
    <select name=wattr011 title="Unit" tabindex=60 class="Mandatory selectBig">
    <option></option>
    %WATWEB01.02.114.2
    </select></td>
    <valign=top><td class=DataLabel>Preadmission Notes</td>

<tr><td class=DataLabel>%STANDARD.01.017.A </td>
    <td class=DataField>
    <select name=specialt id=specialt tabindex=65 class="Mandatory selectBig"
     title="%STANDARD.01.017.A ">
    <option></option>
     %WATWEB01.02.120.2
    </select></td>
    <td class=DataField rowspan=3 colspan=2>
    <textarea wrap=hard name=wtpccomm cols=50 rows=3 tabindex=140>
    </textarea></td></tr>

    <td class=DataLabel>Referral Source</td>
    <td class=DataField>
    <select name=wattr050 tabindex=70 title="Referral Source" 
     class="Mandatory selectBig">
    <option></option>
    %WATWEB01.02.187.2
    </select></td></tr>

<tr><td class=DataLabel>%STANDARD.01.017.CL  </td>
    <td class=DataField> 
    <select name=wattx026 tabindex=75 class=selectBig>
    <option></option>
    %WATWEB01.02.526.2  
    </select></td></tr>

<tr><td class=DataLabel>Certainty Date</td>
    <td class=DataField>
    <input type=text name=wattr025 size=12 class="Mandatory" 
     onblur="checkDate(this,'Date');"
     title="Decision to Admit Date" tabindex=80>
    <img src=../images/DateTimeStamp.gif class=Icon date=AddForm.wattr025
     time=null>
    <img src=../images/DateLookup.gif class=Icon date=AddForm.wattr025>
    </td>

    <td class=DataLabel>Principal Purchaser</td>
    <td class=DataField>
    <select name=wattr053 tabindex=141 title="Principal Purchaser" 
            class=Mandatory>
    <option></option>
    %WATWEB01.02.190.2
    </select></td></tr>

<tr><td class=DataLabel>FSA Referral</td>
    <td class=DataField>
    <input type=text name=wattr051 size=12
     value=""  onblur="checkDate(this,'Date');"
     title="FSA Referral" tabindex=81>
    <img src=../images/DateTimeStamp.gif class=Icon date=AddForm.wattr051
     time=null>
    <img src=../images/DateLookup.gif class=Icon date=AddForm.wattr051>
    </td>
    <td class=DataLabel>FSA Date</td>
    <td class=DataField>
    <input type=text name=wattr052 size=12
     value=""  onblur="checkDate(this,'Date');"
     title="FSA Date" tabindex=142>
    <img src=../images/DateTimeStamp.gif class=Icon date=AddForm.wattr052
     time=null>
    <img src=../images/DateLookup.gif class=Icon date=AddForm.wattr052>
    </td></tr>

<tr><td class=DataLabel>Date Keyed</td>
    <td class=DataField><input type=text size=12 maxlength=12 readonly
     class=ReadOnly value="%STANDARD.01.015"></td></tr>

<tr><td><div id=NRFCLabel1></div></td>
    <td><div id=NRFCField1></div></td>
    <td><div id=NRFCLabel2></div></td>
    <td><div id=NRFCField2></div></td></tr>

<tr><td><div id=NRFCLabel3></div></td>
    <td><div id=NRFCField3></div></td></tr>

<tr><td class=DateLabel>Operator ID</td>
    <td class=DataField><input type=text size=12 maxlength=12 readonly
     class=ReadOnly value='%WATWEB01.02.310' ></td></tr>

<tr><td colspan=8>&nbsp;</td></tr>

<tr><td colspan=8 align=center>
    <input type=button id=subBtn class="button" value="Add" tabindex=145 
     onclick="tempDisable(this); return SubForm(this);">
    <input type=button value="Cancel" class="button" 
     tabindex=150 onclick='PatientLinkTo("watweb01.pbl",2,10,0,0,0);'>
    </td></tr>

</table>
</form>

<span id=InNRFCField1 style="display: none">
  <input type=text name=watsu002 size=12 maxlength=12 title="ToDate">
  <img src=../images/DateTimeStamp.gif class=Icon 
  date=AddForm.watsu002 time=null>
  <img src=../images/DateLookup.gif class=Icon date=AddForm.watsu002>
</span>

<span id=InNRFCField2 style="display: none">
  <input type=checkbox name=watsu005 value="1">
</span>

<span id=InNRFCField3 style="display: none">
  <select name=watsu003>
    <option></option>
    %WATWEB01.02.605.2
  </select>
</span>

<form name=PatientLinks method=get>
<input type=hidden name=reportno value=1>
<input type=hidden name=template value=004>
<input type=hidden name=urnumber value="%WATWEB01.02.003">
<input type=hidden name=admissno value="%WATWEB01.02.081">
<input type=hidden name=MenuType value="%WATWEB01.02.088">
</form>

<script type="text/javascript">
function ChkDateTime1(strtDate,endDate) {
  var strtDay  = strtDate.substring(0,2);
  var strtMon  = strtDate.substring(3,6);
  var strtYear = strtDate.substring(7,11);

  var endDay   = endDate.substring(0,2);
  var endMon   = endDate.substring(3,6);
  var endYear  = endDate.substring(7,11);

  strtMon = GetMonthNumber(strtMon);
  endMon  = GetMonthNumber(endMon);

  var strtDateTime = strtYear + strtMon + strtDay 
  var endDateTime  = endYear + endMon + endDay 
  if (endDateTime <= strtDateTime ) return false;
  return true;
}

function validateTime(){
   date1=AddForm.wattr022.value;
   date2=AddForm.wattr006.value;
   if(ChkDateTime1(date1,date2)) {
     message=" \"Preadmission Date\" cannot be before";
     message+="\"Date on List\"";
     alert(message);
     return false;
   }
  return true;
}

function validateOpDate(){
   date1=AddForm.wattr022.value;
   date2=AddForm.wattr028.value;
   if(ChkDateTime2(date1,date2)) {
     message=" \"Proposed Operation Date\" should be equal to or greater than ";
     message+="\"Preadmission Date\"";
     alert(message);
     return false;
   }
  return true;
}

function ChkDateTime2(strtDate,endDate) {
  var strtDay  = strtDate.substring(0,2);
  var strtMon  = strtDate.substring(3,6);
  var strtYear = strtDate.substring(7,11);

  var endDay   = endDate.substring(0,2);
  var endMon   = endDate.substring(3,6);
  var endYear  = endDate.substring(7,11);

  strtMon = GetMonthNumber(strtMon);
  endMon  = GetMonthNumber(endMon);

  var strtDateTime = strtYear + strtMon + strtDay
  var endDateTime  = endYear + endMon + endDay
  if (endDateTime >= strtDateTime ) {
     return false;
  }
  return true;
}
</script>
