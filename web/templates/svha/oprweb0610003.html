<meta name="TemplateVersion" content="V12.01.00">
<meta name="TemplateHome" content="svha">
<meta name="HelpFileName" content="NoContextSet.html">
<meta name="CrossBrowser" content="true">
<script type="text/javascript" src="../js/oprweb06.js"> </script>
<script type="text/javascript">
function init() {
  if (isWhitespace(UpdateForm.opcom003.value)) {
      UpdateForm.opcom003.value= PatientNotes.Prothesis.value + "\n" +
                                 PatientNotes.AnaeNote.value + "\n" +
                                 PatientNotes.WaitNote.value 
  }
}
function chkTime(field){
  if(isWhitespace(field.value))
   return;
  endTime=UpdateForm.suentime.value.replace(/:/g,"");
  if(isWhitespace(endTime)){
     alert("Time Out of OR must be entered first");
     field.value=""
     return;
  }
  OperDate=document.UpdateForm.casekeys.value.substring(3,11);
  if(document.UpdateForm.currdate.value > OperDate) {
    return;
  }
  if(field.value.replace(/:/g,"")<=endTime){
//
  if(!confirm(""+field.title+" must be after Time Out of OR " +
          UpdateForm.suentime.value +
  "\n Do you want to override")) {
  field.value="";
  }
//
  }
}
function setETTime(extime) {
if(!checkTime(extime,extime.title)) {
  return;
}
chkTime(extime)
document.UpdateForm.opard080.value=extime.value;
document.UpdateForm.opard085.value=extime.value;
 ChgRTD();
}
function valTime(){
  RecFront=UpdateFront.opard071.value.replace(/:/g,"");
  RecBack=UpdateFront.opard074.value.replace(/:/g,"");
  DepartTime=UpdateFront.opard085.value.replace(/:/g,"");
}
function ChkFront() {
  if (isWhitespace(UpdateForm.opard071.value) &&
      !isWhitespace(UpdateForm.opard074.value)) {
    alert("Time into Recovery Room - First Stage need to be entered")
    UpdateForm.opard074.value="";
    UpdateForm.opard071.focus();
  }
  else if (!isWhitespace(UpdateForm.opard074.value)) {
    // Ensure the 'Time into Second Stage Recovery Room' cannot be prior to 
    // 'Time into Recovery Room - First Stage'
    if (UpdateForm.opard074.value < UpdateForm.opard071.value) {
      alert(UpdateForm.opard074.title + " cannot be prior to " + 
            UpdateForm.opard071.title);
      UpdateForm.opard074.select();
    }
  }
  if(!isWhitespace(UpdateForm.opard043.value)) {
    if (UpdateForm.opard043.value < UpdateForm.opard071.value) {
      alert(UpdateForm.opard043.title + " cannot be prior to " +
            UpdateForm.opard071.title);
      UpdateForm.opard043.value="";
      return;
    }
  }
}
function ChkThirdStage() {
  if (isWhitespace(UpdateForm.opard074.value) ||
      isWhitespace(UpdateForm.opard077.value))
    return;

  // Ensure the 'Time into Third Stage Recovery Room' cannot be prior to
  // 'Time into Second Stage Recovery Room'
  if (UpdateForm.opard077.value < UpdateForm.opard074.value) {
      alert(UpdateForm.opard077.title + " cannot be prior to " + 
            UpdateForm.opard074.title);
    UpdateForm.opard077.select();
  }
}
function ChgRTD() {
  // Ensure the 'Ready to Depart Time' cannot be prior to
  // 'Time into Third Stage Recovery Room'
  if (!isWhitespace(UpdateForm.opard085.value) && 
      !isWhitespace(UpdateForm.opard077.value)) {
    if (UpdateForm.opard085.value < UpdateForm.opard077.value) {
      alert(UpdateForm.opard085.title + " cannot be prior to " + 
            UpdateForm.opard077.title);
      UpdateForm.opard085.select();
    }
  }

  if (!isWhitespace(UpdateForm.opard080.value)) {
    UpdateForm.opard080.className= "Mandatory";
    UpdateForm.opard085.className= "Mandatory";
  }
  else {
    UpdateForm.opard080.className=" ";
    UpdateForm.opard085.className=" ";
  }
}
function ChkExit() {
  if (isWhitespace(UpdateForm.opard080.value) ||
      isWhitespace(UpdateForm.opard085.value))
    return;

  if (UpdateForm.opard080.value < UpdateForm.opard085.value) {
    alert(UpdateForm.opard080.title + " cannot be prior to " + 
          UpdateForm.opard085.title);
    UpdateForm.opard080.select();
  }
}
function chkMan() {
var ToDepTime=trim(UpdateForm.opard085.value.replace(/:/g,""))
var ThExitTime=trim(UpdateForm.opard080.value.replace(/:/g,""))
ToDepTime=ToDepTime.substr(0,4)
ThExitTime=ThExitTime.substr(0,4)
ToDepTime=ToDepTime - 0;
ThExitTime=ThExitTime - 0;
var MaxDelay=(parseInt(ToDepTime) +
              parseInt(document.UpdateForm.d_opcnsetr.value))
var Minutes=parseInt(MaxDelay) % 100
var Hour=parseInt(MaxDelay) / 100
if (Minutes>=60) {
   Minutes=Minutes - 60
   Hour=parseInt(Hour) + 1
   MaxDelay = (Hour*100) + Minutes
}
if (MaxDelay < ThExitTime) {
   UpdateForm.opard084.className="Mandatory" }
else {
   UpdateForm.opard084.className=""
   }
}
function formSubmit() {
  if(validateMandatory(UpdateForm)) {
     document.UpdateForm.opsrg004.value=document.UpdateForm.opard043.value;
     document.UpdateForm.submit();
  }
}
function CalcTheatreMins() {
  var divThtrMins = document.getElementById('divThtrMins');
  var startTime, endTime = "";

  // Get 'Procedure Start Time'
  if (!isWhitespace(UpdateForm.anaestrt.value)) {
    startTime = UpdateForm.anaestrt.value;
  } else if (!isWhitespace(UpdateForm.surgstrt.value)) {
    startTime = UpdateForm.surgstrt.value;
  }
  else {  // no 'Procedure Start Time'
    divThtrMins.innerHTML = "";  // show blank theatre minutes
    return;
  }

  // Get 'Procedure End Time'
  if (!isWhitespace(UpdateForm.patdiedt.value)) {  // Patient Died Time
    endTime = UpdateForm.patdiedt.value;
  } else if (!isWhitespace(UpdateForm.opard071.value)) {  // Time into RR First
    endTime = UpdateForm.opard071.value;
  } else if (!isWhitespace(UpdateForm.opard077.value)) {  // Time into RR Third
    endTime = UpdateForm.opard077.value;
  } else if (!isWhitespace(UpdateForm.opard083.value)) {  // Time into ICU
    endTime = UpdateForm.opard083.value;
  } else if (!isWhitespace(UpdateForm.opard043.value)) {  // Anaes. Finish Time
    endTime = UpdateForm.opard043.value;
  } else if (!isWhitespace(UpdateForm.surgendt.value)) {  // Surgery End Time
    endTime = UpdateForm.surgendt.value;
  }
  else {  // no 'Procedure End Time'
    divThtrMins.innerHTML = "";  // show blank theatre minutes
    return;
  }

  //
  // Calculate theatre minutes ...
  //
  var theatreDate = UpdateForm.casekeys.value.substr(3,8);

  // Set 'From' date/time fields
  UpdateForm.surgfrdt.value = SetDateDDMMMYYYY(theatreDate);
  UpdateForm.surgfrtm.value = startTime;

  // Set 'To' date/time fields
  UpdateForm.surgtodt.value = SetDateDDMMMYYYY(theatreDate);
  if (UpdateForm.ovrnight.value == "Yes") {  // overnight indicator set
    // add 1 day to our date
     AddSubtractDate(UpdateForm.surgtodt,"1","A");
  }
  UpdateForm.surgtotm.value = endTime;

  // Calculate the duration
  CalculateDuration(UpdateForm.surgfrdt,UpdateForm.surgfrtm,UpdateForm.surgtodt,UpdateForm.surgtotm,UpdateForm.duration);

  // Display theatre minutes
  divThtrMins.innerHTML = UpdateForm.duration.value + " minutes";
}
function MandClinInd()  {
  if(!isWhitespace(document.getElementById("opard085").value)) {
    document.getElementById("opard087").className="SelectMed Mandatory";
  } else {
    document.getElementById("opard087").className="SelectMed";
  }
}
</script>
</head>
%START.OF.PAGE
<body onload="PageLoad(event);setTimeout('CalcTheatreMins();',100);
 MandClinInd();">
<span class=DFrameTitleBar>
<img align="right" alt="Exit" class="MenuIcon"
 src="../images/ExitIcon.gif" onclick="DFrameExit();">
Theatre Case Recovery Details
</span>

<script type="text/javascript">
NoDressingTime="1"
</script>

<form name=UpdateForm id=UpdateForm method=post action=oprweb06.pbl>
<input type=hidden name=reportno id=reportno value=10>
<input type=hidden name=template id=template value=001>
<input type=hidden name=updatety id=updatety value="U">
<input type=hidden name=casekeys id=casekeys value="%OPRWEB06.10.101">
<input type=hidden name=uniqueky id=uniqueky value='%OPRWEB06.10.110'>
<input type=hidden name=nextpage id=nextpage value="0">
<input type=hidden name=suentime id=suentime value="%OPRWEB06.10.382">
<input type=hidden name=suprlevl id=suprlevl value="%OPRWEB06.10.512">
<input type=hidden name=currdate id=currdate value="%STANDARD.01.013">
<input type=hidden name=redirect id=redirect>
<input type=hidden name=opsrg004 id=opsrg004 value="%OPRWEB06.10.304">
<input type=hidden name=anaestrt id=anaestrt value="%OPRWEB06.10.242">
<input type=hidden name=surgstrt id=surgstrt value="%OPRWEB06.10.305">
<input type=hidden name=surgendt id=surgendt value="%OPRWEB06.10.306">
<input type=hidden name=patdiedt id=patdiedt value="%OPRWEB06.10.282">
<input type=hidden name=surgfrdt id=surgfrdt value="">
<input type=hidden name=surgtodt id=surgtodt value="">
<input type=hidden name=surgfrtm id=surgfrtm value="">
<input type=hidden name=surgtotm id=surgtotm value="">
<input type=hidden name=duration id=duration value="">
<input type=hidden name=ovrnight id=ovrnight value="%OPRWEB06.10.371">
<input type=hidden name=nodressg id=nodressg value="%OPRWEB06.10.516">
<input type=hidden name=recovdur id=recovdur value="1">
<input type=hidden name=exittime value='%OPRWEB06.10.299.017'>
<input type=hidden name="d_opcnsetr" id="d_opcnsetr"
       value="%STANDARD.01.025.113.057.0.2">

<table border=0 cellpadding=2 cellspacing=0 width="95%" align=center >
<tr><td class=DataLabel width=25%>Time into Recovery Room - First Stage </td>
    <td class=DataField width=17%>
    <input type=text name=opard071 id=opard071 size=8 
     title="Time into Recovery Room - First Stage"
     value='%OPRWEB06.10.271'
     onblur="checkTime(this,this.title);chkTime(this);ChkFront();">
    <img src="../images/DateTimeStamp.gif" class=Icon
     onclick="SetCurrentDateTime(null,opard071);">
    <img src="../images/TimeLookup.gif" border=0 class=Icon
     onclick="TimeLookupFrame(opard071);">
    </td><td class=DataLabel width=20%>Nurse Attending Patient</td>
    <td><input type=text name=opard072 id=opard072 size=6 
         value="%OPRWEB06.10.272.1"
     onblur="validateCode(17,opard072,name_opard072);">
    <input type=text readonly name=name_opard072 id=name_opard072 
     class=Readonly size=30
     value="%OPRWEB06.10.272.0" notab>
    <img src="../images/SearchIcon.gif" class=Icon notab
     onclick="NurseSearchFrame(opard072,name_opard072);">
    </td></tr>

<tr><td class=DataLabel>Bay Code</td>
    <td class=DataField>
    <select name=opard016 id=opard016 title="Bay Code" class="Mandatory">
    <option></option>
     %OPRWEB06.10.216.5
    </select>
    </td>
    <td class=DataLabel>Nurse Attending Patient</td>
    <td><input type=text name=opard073 id=opard073 size=6 
         value="%OPRWEB06.10.273.1"
     onblur="validateCode(17,opard073,name_opard073);">
    <input type=text readonly name=name_opard073 id=name_opard073 
     class=Readonly size=30
     value="%OPRWEB06.10.273.0">
    <img src="../images/SearchIcon.gif" class=Icon
     onclick="NurseSearchFrame(opard073,name_opard073);">
    </td></tr>

<tr><td class=DataLabel>Anaesthetic Finish Time / Handover to Recovery Complete
    </td>
    <td class=DataField>
    <input type=text name=opard043 id=opard043 size=8
     title="Anaesthetic Finish Time / Handover to Recovery Complete"
     value='%OPRWEB06.10.243'
     onblur="checkTime(this,this.title);chkTime(this);ChkFront();">
    <img src="../images/DateTimeStamp.gif" class=Icon
     onclick="SetCurrentDateTime(null,opard043);">
    <img src="../images/TimeLookup.gif" border=0 class=Icon
     onclick="TimeLookupFrame(opard043);"></td>
    <td colspan=2>&nbsp;</td></tr>

<tr><td class=DataLabel>Time into Second Stage Recovery Room </td>
    <td class=DataField>
    <input type=text name=opard074 id=opard074 size=8
     title="Time into Second Stage Recovery Room" value='%OPRWEB06.10.274' 
     onblur="checkTime(this,this.title);chkTime(this);ChkFront();ChkThirdStage();">
    <img src="../images/DateTimeStamp.gif" class=Icon
     onclick="SetCurrentDateTime(null,opard074);">
    <img src="../images/TimeLookup.gif" border=0 class=Icon
     onclick="TimeLookupFrame(opard074);">
    </td><td class=DataLabel>Nurse Attending Patient</td>
    <td><input type=text name=opard075 id=opard075 size=6
         value="%OPRWEB06.10.275.1"
     onblur="validateCode(17,opard075,name_opard075);">
    <input type=text readonly name=name_opard075 id=name_opard075 
     class=Readonly size=30
     value="%OPRWEB06.10.275.0">
    <img src="../images/SearchIcon.gif" class=Icon
     onclick="NurseSearchFrame(opard075,name_opard075);">
    </td></tr>

<tr><td class=DataLabel> &nbsp; </td>
    <td class=DataField> &nbsp; </td>
    <td class=DataLabel>Nurse Attending Patient</td>
    <td><input type=text name=opard076 id=opard076 size=6 
         value="%OPRWEB06.10.276.1"
     onblur="validateCode(17,opard076,name_opard076);">
    <input type=text readonly name=name_opard076 id=name_opard076 
     class=Readonly size=30
     value="%OPRWEB06.10.276.0">
    <img src="../images/SearchIcon.gif" class=Icon
     onclick="NurseSearchFrame(opard076,name_opard076);">
    </td></tr>

<tr><td class=DataLabel>Time into Third Stage Recovery Room </td>
    <td class=DataField>
    <input type=text name=opard077 id=opard077 size=8
     title="Time into Third Stage Recovery Room" value='%OPRWEB06.10.277' 
     onblur="checkTime(this,this.title);chkTime(this);ChkThirdStage();ChgRTD();">
    <img src="../images/DateTimeStamp.gif" class=Icon
     onclick="SetCurrentDateTime(null,opard077);">
    <img src="../images/TimeLookup.gif" class=Icon
     onclick="TimeLookupFrame(opard077);">
    </td><td class=DataLabel>Nurse Attending Patient</td>
    <td><input type=text name=opard078 id=opard078 size=6 
         value="%OPRWEB06.10.278.1"
     onblur="validateCode(17,opard078,name_opard078);">
    <input type=text readonly name=name_opard078 id=name_opard078 
     class=Readonly size=30
     value="%OPRWEB06.10.278.0">
    <img src="../images/SearchIcon.gif" class=Icon
     onclick="NurseSearchFrame(opard078,name_opard078);">
    </td></tr>

<tr><td class=DataLabel> &nbsp; </td>
    <td class=DataField> &nbsp; </td>
    <td class=DataLabel>Nurse Attending Patient</td>
    <td><input type=text name=opard079 id=opard079 size=6 
         value="%OPRWEB06.10.279.1"
     onblur="validateCode(17,opard079,name_opard079);">
    <input type=text readonly name=name_opard079 id=name_opard079 
     class=Readonly size=30
     value="%OPRWEB06.10.279.0">
    <img src="../images/SearchIcon.gif" class=Icon
     onclick="NurseSearchFrame(opard079,name_opard079);">
    </td></tr>

<tr><td class=DataLabel>Time Patient Died </td>
    <td class=DataField>
    <input type=text name=opard082 id=opard082 size=8 title="Time Patient Died"
     value='%OPRWEB06.10.282' 
     onblur="checkTime(this,this.title);chkTime(this);">
    <img src="../images/DateTimeStamp.gif" class=Icon
     onclick="SetCurrentDateTime(null,opard082);">
    <img src="../images/TimeLookup.gif" class=Icon
     onclick="TimeLookupFrame(opard082);">
    </td><td class=DataLabel>Time Patient Went to ICU</td>
    <td class=DataField>
    <input type=text name=opard083 id=opard083 size=8 
     title="Time Patient Went to ICU"
     value='%OPRWEB06.10.283'
      onblur="setETTime(this);">
    <img src="../images/DateTimeStamp.gif" class=Icon
     onclick="SetCurrentDateTime(null,opard083);">
    <img src="../images/TimeLookup.gif" border=0 class=Icon
     onclick="TimeLookupFrame(opard083);">
    </td></tr>


<tr><td class=DataLabel>Clinical Indicator 1</td>
    <td class=DataField>
    <select name=opard087 id=opard087 title="Clinical Indicator 1"
     class="SelectMed">
    <option></option>
     %OPRWEB06.10.287.2
    </select>
    </td>
    <td class=DataLabel>Clinical Indicator 2</td>
    <td class=DataField>
    <select name=opard088 id=opard088 title="Clinical Indicator 2"
     class="SelectMed">
    <option></option>
     %OPRWEB06.10.288.2
    </select>
    </td><tr>

<tr><td class=DataLabel>Clinical Indicator 3</td>
    <td class=DataField>
    <select name=opard089 id=opard089 title="Clinical Indicator 3"
     class="SelectMed">
    <option></option>
     %OPRWEB06.10.289.2
    </select>
    </td>
    <td class=DataLabel></td>
    <td class=DataField></td><tr>


<tr><td class=DataLabel>Ready to Depart Time</td>
    <td class=DataField>
    <input type=text name=opard085 id=opard085 size=8
     title="Ready to Depart Time" value='%OPRWEB06.10.285' 
     onblur="checkTime(this,this.title);chkTime(this);ChgRTD();ChkExit();
             MandClinInd();">
    <img src="../images/DateTimeStamp.gif" class=Icon
     onclick="SetCurrentDateTime(null,opard085);">
    <img src="../images/TimeLookup.gif" border=0 class=Icon
     onclick="TimeLookupFrame(opard085);">
    </td><td class=DataLabel>Delay Code</td>
    <td class=DataField>
    <select name=opard084 id=opard084 class=DataField title="Delay Code">
    <option></option>
     %OPRWEB06.10.284.2
    </select>
    </td></tr>

<tr><td class=DataLabel>Exit Theatre Complex Time</td>
    <td class=DataField>
    <input type=text name=opard080 id=opard080 size=8 
     title="Exit Theatre Complex Time"
     value='%OPRWEB06.10.280' 
  onblur="checkTime(this,this.title);chkTime(this);ChgRTD();chkMan();ChkExit();">
    <img src="../images/DateTimeStamp.gif" class=Icon
     onclick="SetCurrentDateTime(null,opard080);">
    <img src="../images/TimeLookup.gif" class=Icon
     onclick="TimeLookupFrame(opard080);"> </td>
    <td class=DataLabel>Prosthesis</td>
    <td class=DataField >
      <input type=text name=opard013 id=opard013 value="%OPRWEB06.10.213" 
       maxlength=40 size=40></td></tr>

<tr><td class=DataLabel>Prosthetic Charge</td>
    <td class=DataField>
    <select name=opard024 id=opard024 title="Prosthetic Charge">
    <option value=0>No</option>
    <option value=1>Yes</option>
    </select></td>
    <td class=DataLabel>%STANDARD.01.017.oa</td>
    <td class=DataField>
    <select name=opard014 id=opard014 class=DataField 
     title="%STANDARD.01.017.oa">
    <option></option>
     %OPRWEB06.10.214.2
    </select>
    </td></tr>

<tr><td>Theatre Minutes</td>
    <td class=DataField><div id=divThtrMins></div></td>
    <td class=DataLabel>%STANDARD.01.017.ob</td>
    <td class=DataField>
    <select name=opard015 id=opard015 class=DataField 
     title="%STANDARD.01.017.ob">
    <option></option>
     %OPRWEB06.10.215.2
    </select>
    </td></tr>
</table>

<table border=0 cellpadding=2 cellspacing=0 width="95%" align=center >
<tr valign=top>
    <td class=DataLabel width=25%>Preadmission and<br> Operation Notes
    <td colspan=3>
    <textarea cols=60 rows=3 name=opcom003 id=opcom003
     wrap=hard>%OPRWEB06.10.143.003</textarea>
    <img src="../images/LookupIcon.gif" class=Icon
     onclick='LookupPage(null,UpdateForm.opcom003,"Lookup_00300000_000");'>
    </td></tr>
<tr><td colspan=4 align=center>
    <input class="button" id="opr06sub" type=button value="Update" 
     onclick="tempDisable(this);formSubmit();">
    <input class="button" type=button value="Cancel" onclick="DFrameClose();">
    </td></tr>
</table>
</form>

<form name=PatientNotes id=PatientNotes method=get>
<textarea wrap=hard cols=60 rows=3 style='display:none;'
name=Prothesis>%OPRWEB06.10.128
</textarea>
<textarea wrap=hard cols=60 rows=3 style='display:none;'
name=AnaeNote>%OPRWEB06.10.143.002</textarea>
<textarea wrap=hard cols=60 rows=3 style='display:none;'
name=WaitNote>%OPRWEB06.10.459</textarea>
</form>

<form name=PatientLinks id=PatientLinks method=get>
<input type=hidden name=reportno id=reportno value=10>
<input type=hidden name=template id=template value=001>
<input type=hidden name=urnumber id=urnumber value='%OPRWEB06.10.003'>
<input type=hidden name=admissno id=admissno value='%OPRWEB06.10.081'>
<input type=hidden name=MenuType id=MenuType value='%OPRWEB06.10.088'>
<input type=hidden name=casekeys id=casekeys value='%OPRWEB06.10.101'>
<input type=hidden name=sesskeys id=sesskeys 
 value='%OPRWEB06.10.102.oprweb01.03.003'>
<input type=hidden name=teamnumb id=teamnumb value="1">
</form>

<script type="text/javascript">
ProstheticCharge="%OPRWEB06.10.224"
if(ProstheticCharge=="Yes"){
UpdateForm.opard024.selectedIndex=1 ;
}

if(isWhitespace(document.UpdateForm.opard080.value)) {
  document.UpdateForm.opard080.value = document.UpdateForm.exittime.value;
}

</script>
