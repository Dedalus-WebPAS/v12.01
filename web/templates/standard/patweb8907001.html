<meta name="TemplateVersion" content="V12.01.00">
<meta name="TemplateHome" content="standard">
<meta name="HelpFileName" content="NoContextSet.html">
<meta name="CrossBrowser" content="true">
<script type="text/javascript">
function SubmitAdm() {
  MandatoryOk=validateMandatory(document.UpdateForm)
  if (MandatoryOk) {
    SubmitHidden(document.UpdateForm);
    }
}
function DisableIconTime(field) {
  if (field.readOnly == true) {
    alert(field.title+" is for display only")
  } else {
//    TimeLookupFrame(field);
  }
}
function DisableIcon(field) {
  if (field.readOnly == true) {
    alert(field.title+" is for display only")
  } else {
    DateLookupFrame(field);
  }
}
//
function CheckStatus() {
// if legal satus indicator one is not "I" then status review date is mandatory.
  if ( document.UpdateForm.mehvs034.value.substr(3,1) == "I") {
    document.UpdateForm.mehvs003.readOnly=true;
    document.UpdateForm.mehvs003.className="Readonly";
    document.UpdateForm.mehvs003.value="";
    document.UpdateForm.mehvs003.className="FutureDate";
    document.UpdateForm.mehvs014.readOnly=true;
    document.UpdateForm.mehvs014.className="Readonly";
    document.UpdateForm.mehvs014.value="";
    document.UpdateForm.mehvs014.className="PastDate";
  } else { 
    document.UpdateForm.mehvs003.className="FutureDate Mandatory";
    document.UpdateForm.mehvs003.readOnly=false;
    document.UpdateForm.mehvs014.className="PastDate Mandatory";
    document.UpdateForm.mehvs014.readOnly=false;
  }

  if (document.UpdateForm.mehvs034.value.substr(6,1)=="1") 
  {
    if (document.UpdateForm.mehvs034.value.substr(7,1)=="H") 
    {
      if (!isWhitespace(document.UpdateForm.mehvs035.value)&&
          !isWhitespace(document.UpdateForm.mehvs034.value.substr(26,6))&&
          !isWhitespace(document.UpdateForm.mehvs037.value))
      {
        var newExpiryDate = new Date();

        newExpiryDate.setDate(parseInt(document.UpdateForm.mehvs035.value.substring(0,2)));

        var varMonth = 0;
        if (document.UpdateForm.mehvs035.value.substr(3,3)=="Jan"){varMonth=0;}
        if (document.UpdateForm.mehvs035.value.substr(3,3)=="Feb"){varMonth=1;}
        if (document.UpdateForm.mehvs035.value.substr(3,3)=="Mar"){varMonth=2;}
        if (document.UpdateForm.mehvs035.value.substr(3,3)=="Apr"){varMonth=3;}
        if (document.UpdateForm.mehvs035.value.substr(3,3)=="May"){varMonth=4;}
        if (document.UpdateForm.mehvs035.value.substr(3,3)=="Jun"){varMonth=5;}
        if (document.UpdateForm.mehvs035.value.substr(3,3)=="Jul"){varMonth=6;}
        if (document.UpdateForm.mehvs035.value.substr(3,3)=="Aug"){varMonth=7;}
        if (document.UpdateForm.mehvs035.value.substr(3,3)=="Sep"){varMonth=8;}
        if (document.UpdateForm.mehvs035.value.substr(3,3)=="Oct"){varMonth=9;}
        if (document.UpdateForm.mehvs035.value.substr(3,3)=="Nov"){varMonth=10;}
        if (document.UpdateForm.mehvs035.value.substr(3,3)=="Dec"){varMonth=11;}
        newExpiryDate.setMonth(parseInt(varMonth));

        newExpiryDate.setFullYear(parseInt(document.UpdateForm.mehvs035.value.substr(7,4)));

        newExpiryDate.setHours(parseInt(document.UpdateForm.mehvs037.value.substr(0,2))-1);

        newExpiryDate.setMinutes(parseInt(document.UpdateForm.mehvs037.value.substr(3,2))-1);

        var newHours = newExpiryDate.getHours() + 
                      parseInt(document.UpdateForm.mehvs034.value.substr(26,6));

        newExpiryDate.setHours(parseInt(newHours));

        varMonth = "   ";
        if (newExpiryDate.getMonth()==0) {varMonth="Jan";} 
        if (newExpiryDate.getMonth()==1) {varMonth="Feb";}
        if (newExpiryDate.getMonth()==2) {varMonth="Mar";}
        if (newExpiryDate.getMonth()==3) {varMonth="Apr";}
        if (newExpiryDate.getMonth()==4) {varMonth="May";}
        if (newExpiryDate.getMonth()==5) {varMonth="Jun";}
        if (newExpiryDate.getMonth()==6) {varMonth="Jul";}
        if (newExpiryDate.getMonth()==7) {varMonth="Aug";}
        if (newExpiryDate.getMonth()==8) {varMonth="Sep";}
        if (newExpiryDate.getMonth()==9) {varMonth="Oct";}
        if (newExpiryDate.getMonth()==10) {varMonth="Nov";}
        if (newExpiryDate.getMonth()==11) {varMonth="Dec";}

        document.UpdateForm.mehvs003.value=newExpiryDate.getDate() +" "+
                                           varMonth +" "+
                                           newExpiryDate.getFullYear();
      }
    }
    else
    {
      if (!isWhitespace(document.UpdateForm.mehvs035.value)&&
          !isWhitespace(document.UpdateForm.mehvs034.value.substr(26,6)))
      {
        var serverURL   = "../cgi-bin/patweb80.pbl?reportno=96" + 
           "&valdcode=" + document.UpdateForm.mehvs035.value.replace(/ /g,"+") +
           document.UpdateForm.mehvs034.value.substr(26,6).replace(/ /g,"+");


        var returnValue = RSExecute(serverURL);
        if (returnValue.status==0) 
        {
          ReturnValue=returnValue.return_value.split("|")
          document.UpdateForm.mehvs003.value=trim(ReturnValue[0])
        }
      }
    }
  }
  else
  {
    if (document.UpdateForm.mehvs034.value.substr(6,1)=="2") 
    {
      if (document.UpdateForm.mehvs034.value.substr(7,1)=="H")
      {
        if (!isWhitespace(document.UpdateForm.precdate.value)&&
            !isWhitespace(document.UpdateForm.mehvs034.value.substr(26,6))&&
            !isWhitespace(document.UpdateForm.mehvs037.value))
        {
          var newExpiryDate = new Date();

          newExpiryDate.setDate(parseInt(document.UpdateForm.precdate.value.substring(0,2)));

          var varMonth = 0;
          if (document.UpdateForm.precdate.value.substr(3,3)=="Jan")
             {varMonth=0;}
          if (document.UpdateForm.precdate.value.substr(3,3)=="Feb")
             {varMonth=1;}
          if (document.UpdateForm.precdate.value.substr(3,3)=="Mar")
             {varMonth=2;}
          if (document.UpdateForm.precdate.value.substr(3,3)=="Apr")
             {varMonth=3;}
          if (document.UpdateForm.precdate.value.substr(3,3)=="May")
             {varMonth=4;}
          if (document.UpdateForm.precdate.value.substr(3,3)=="Jun")
             {varMonth=5;}
          if (document.UpdateForm.precdate.value.substr(3,3)=="Jul")
             {varMonth=6;}
          if (document.UpdateForm.precdate.value.substr(3,3)=="Aug")
             {varMonth=7;}
          if (document.UpdateForm.precdate.value.substr(3,3)=="Sep")
             {varMonth=8;}
          if (document.UpdateForm.precdate.value.substr(3,3)=="Oct")
             {varMonth=9;}
          if (document.UpdateForm.precdate.value.substr(3,3)=="Nov")
             {varMonth=10;}
          if (document.UpdateForm.precdate.value.substr(3,3)=="Dec")
             {varMonth=11;}
          newExpiryDate.setMonth(parseInt(varMonth));

          newExpiryDate.setFullYear(parseInt(document.UpdateForm.precdate.value.substr(7,4)));

          newExpiryDate.setHours(parseInt(document.UpdateForm.mehvs037.value.substr(0,2))-1);

          newExpiryDate.setMinutes(parseInt(document.UpdateForm.mehvs037.value.substr(3,2))-1);

          var newHours = newExpiryDate.getHours() +
                      parseInt(document.UpdateForm.mehvs034.value.substr(26,6));

//alert(newHours);

          newExpiryDate.setHours(parseInt(newHours));

          varMonth = "   ";
          if (newExpiryDate.getMonth()==0) {varMonth="Jan";}
          if (newExpiryDate.getMonth()==1) {varMonth="Feb";}
          if (newExpiryDate.getMonth()==2) {varMonth="Mar";}
          if (newExpiryDate.getMonth()==3) {varMonth="Apr";}
          if (newExpiryDate.getMonth()==4) {varMonth="May";}
          if (newExpiryDate.getMonth()==5) {varMonth="Jun";}
          if (newExpiryDate.getMonth()==6) {varMonth="Jul";}
          if (newExpiryDate.getMonth()==7) {varMonth="Aug";}
          if (newExpiryDate.getMonth()==8) {varMonth="Sep";}
          if (newExpiryDate.getMonth()==9) {varMonth="Oct";}
          if (newExpiryDate.getMonth()==10) {varMonth="Nov";}
          if (newExpiryDate.getMonth()==11) {varMonth="Dec";}

          document.UpdateForm.mehvs003.value=newExpiryDate.getDate() +" "+
                                             varMonth +" "+
                                             newExpiryDate.getFullYear();
        }
      }
      else
      {

        if (!isWhitespace(document.UpdateForm.precdate.value)&&
            !isWhitespace(document.UpdateForm.mehvs034.value.substr(26,6)))
        {
//        alert("2");
          var serverURL   = "../cgi-bin/patweb80.pbl?reportno=96" +
           "&valdcode=" + document.UpdateForm.precdate.value.replace(/ /g,"+") +
           document.UpdateForm.mehvs034.value.substr(26,6).replace(/ /g,"+");

//alert(serverURL);

          var returnValue = RSExecute(serverURL);
          if (returnValue.status==0)
          {
            ReturnValue=returnValue.return_value.split("|");
//alert(ReturnValue);
            document.UpdateForm.mehvs003.value=trim(ReturnValue[0]);
          }
        }
      }
    }
  }
//*************************
//var t = new Date();
//alert(t.getDate()+" "+t.getMonth()+" "+t.getFullYear()+" "+t.getHours()+":"+t.getMinutes()+":"+t.getSeconds());
//t.setHours(27);
//alert(t.getDate()+" "+t.getMonth()+" "+t.getFullYear()+" "+t.getHours()+":"+t.getMinutes()+":"+t.getSeconds());
//*************************
}
//
function CheckBenefitDate() {
  if (document.UpdateForm.mehvs018.value == "1") {
    document.UpdateForm.mehvs019.readOnly=false;
    document.UpdateForm.mehvs019.className="";
  } else {
    document.UpdateForm.mehvs019.readOnly=true;
    document.UpdateForm.mehvs019.className="Readonly";
    document.UpdateForm.mehvs019.value="";
  }
}
//
function CheckBenefit() {
// if Benefit Type is not blank then benefit paid to is mandatory.
  if (document.UpdateForm.mehvs016.value == "") {
    document.UpdateForm.mehvs017.readOnly=true;
    document.UpdateForm.mehvs017.className="Readonly";
    document.UpdateForm.mehvs017.value="";
    document.UpdateForm.mehvs018.readOnly=true;
    document.UpdateForm.mehvs018.selectedIndex="0";
//alert(document.UpdateForm.mehvs018.value);
    document.UpdateForm.mehvs018.disabled=true;
    document.UpdateForm.mehvs019.readOnly=true;
    document.UpdateForm.mehvs019.className="Readonly";
    document.UpdateForm.mehvs019.value="";
  } else {
    document.UpdateForm.mehvs017.readOnly=false;
    document.UpdateForm.mehvs017.className="";
    document.UpdateForm.mehvs018.readOnly=false;
    document.UpdateForm.mehvs018.disabled=false;
//    document.UpdateForm.mehvs019.readOnly=false;
//    document.UpdateForm.mehvs019.className="";
  }
}
</script>
</head>
%START.OF.PAGE
<body onload="PageLoad(event);CheckBenefit();CheckStatus();CheckBenefitDate();">
<div id=PatientHeading></div>
<script type="text/javascript">
PatientURN="%PATWEB89.07.003";
PatientVIS="%PATWEB89.07.081";
PatientNAM="%PATWEB89.07.002";
PatientSTA="%PATWEB89.07.086.078";
PatientALT="%PATWEB89.07.084";
PatientSEX="%PATWEB89.07.019";
PatientDOB="%PATWEB89.07.020";
PatientAGE="%PATWEB89.07.021";
PatientLOC="%PATWEB89.07.083";
PatientPRI="%PATWEB89.07.086.066.1";
PatientUNT="%PATWEB89.07.066.0";
DoctorCOD="%PATWEB89.07.082.003";
DoctorNAM="%PATWEB89.07.082.002";
PatientAID="%PATWEB89.07.086.090";
PatientIND="%PATWEB89.07.086.091";
PatientCUR="%PATWEB89.07.086.092";
PatientCLC="%PATWEB89.07.086.093.1";
PatientCLH="%STANDARD.01.017.CL";
PatientHFT="%PATWEB89.07.086.094";
PatientCDM="%PATWEB89.07.086.095";
PatientVDH="%PATWEB89.07.086.099.015";
InsertPatientHeader()
</script>
<div id=PatientMenu></div>
<div id=PageBodySection>
<form name=UpdateForm id=UpdateForm action="patweb89.pbl" method=post>
<input type=hidden name=urnumber id=urnumber value="%PATWEB89.07.003">
<input type=hidden name=admissno id=admissno value="%PATWEB89.07.101">
<input type=hidden name=updatety id=updatety value="1">
<input type=hidden name=reportno id=reportno value="7">
<input type=hidden name=nextpage id=nextpage value="1">
<input type=hidden name=redirect id=redirect>
<input type=hidden name=precdate id=precdate value="%PATWEB89.07.490">

<table border=1 colspan=1 width=100% cellspacing=1 cellpadding=1 >
<tr><td class=HeadingCell align=center colspan=4>
    Mental Health Details </tr>
<tr><td>
    <table width=100% border=0 class=TableBody cellpadding=0 cellspacing=0>
    <tr><td class=DataLabel>Therapist </td>
        <td><input type=text name=mehvs004 id=mehvs004 tabindex="1" maxlength=30 size=30 
             title="Therapist" value="%PATWEB89.07.305"></td>
        <td class=DataLabel>Type of Benefit</td>
        <td class=DataField>
        <select name="mehvs016" id="mehvs016" title="Type of Benefit" tabindex="12"
         onchange="CheckBenefit()"> 
          <option value=""></option>
          %PATWEB89.07.317.2 
        </select></td>
    </tr>
    <tr><td class=DataLabel>Admitting Address </td>
        <td class=DataField>
        <input name="mehvs005" id="mehvs005" tabindex="2" maxlength=35 size=35
             title="Admitting Address Line1" value="%PATWEB89.07.306">
        <td class=DataLabel>Benefit Paid To</td>
        <td class=DatField>
        <input type="text" name="mehvs017" id="mehvs017" maxlength=30 size=30 tabindex="13"
         title="Benefit Paid To" value="%PATWEB89.07.318"></td>
    </tr>

    <tr><td class=DataLabel></td>
        <td class=DataField>
        <input name="mehvs006" id="mehvs006" tabindex="3" maxlength=35 size=35
             title="Admitting Address Line2" value="%PATWEB89.07.307">
        <td class=DataLabel>Maximised Benefit?</td>
        <td class=DataField>
        <select name="mehvs018" id="mehvs018" title="Maximised Benefit" tabindex="14"
                onchange="CheckBenefitDate()">
          <option value="0"></option>
          <option value="1">Yes</option>
          <option value="2">No</option>
          <option value="3">Unknown</option>
        </select></td>
    </tr>

    <tr><td class=DataLabel></td>
        <td class=DataField>
        <input type="text" name="mehvs007" id="mehvs007" maxlength=35 size=35 tabindex="4"
             title="Admitting Address Line3" value="%PATWEB89.07.308"> 
        <td class=DataLabel>Maximised Benefit Date</td>
        <td class=DataField>
        <input type="text" size="12" name="mehvs019" id="mehvs019" tabindex="15"
          value="%PATWEB89.07.320" title="Max Benefit Date" 
          onblur="checkDate(this,'Benefit Date')">
        <img src="../images/DateLookup.gif" class=Icon
         onclick="DisableIcon(mehvs019);"></td>
    </tr>

    <tr><td class=DataLabel></td>
        <td class=DataField>
        <input type="text" name="mehvs008" id="mehvs008" maxlength=35 size=35 tabindex="5"
             title="Admitting Address Line4" value="%PATWEB89.07.309"> 
        <td class=DataLabel>Supported by Benefit</td>
        <td class=DataField>
        <select name="mehvs020" id="mehvs020" title="Supp. By Benefit" tabindex="16">
          <option value="0"></option>
          <option value="1">Yes</option>
          <option value="2">No</option>
        </select></td>
    </tr>

    <tr><td class=DataLabel>Accommodation Type</td>
        <td class=DataField>
        <select name="mehvs011" id="mehvs011" title="Accommodation Type" tabindex="6"> 
          <option value=""></option>
          %PATWEB89.07.312.2
        </select>
        <td class=DataLabel>Referral Date</td>
        <td class=DataField>
        <input type="text" size="12" name="mehvs012" id="mehvs012" tabindex="17"
          value="%PATWEB89.07.313" class="PastDate"
          title="Referral Date" onblur="checkDate(this,'Referral Date')">
        <img src="../images/DateLookup.gif" class=Icon
         onclick="DateLookupFrame(mehvs012);"></td>
    </tr>

    <tr><td class=DataLabel>Legal Status</td>
        <td class=DataField>
        <select  name="mehvs034" id="mehvs034" title="Legal Status" tabindex="7"
         class=Mandatory onchange="CheckStatus()">
         <option></option>
         "%PATWEB89.07.335.2" 
        </select></td>
        <td class=DataLabel>First Contact Date</td>
        <td class=DataField>
        <input type="text" size="12" name="mehvs013" id="mehvs013" title="First Contact Date" 
          value="%PATWEB89.07.314" tabindex="18" class="PastDate"
          onblur="checkDate(this,'First Contact Date')">
        <img src="../images/DateLookup.gif" class=Icon
         onclick="DateLookupFrame(mehvs013);"></td>
    </tr>

    <tr><td class=DataLabel>Date Status Applies</td>
        <td class=DataLabel>
        <input type="text" size="12" name="mehvs035" id="mehvs035" title="Date Status Applies" 
         value="%PATWEB89.07.336" tabindex="8" class="Mandatory PastDate"
         onblur="checkDate(this,'Date Status Applies');CheckStatus();">
        <img src="../images/DateLookup.gif" class=Icon
         onclick='DateLookupFrame(mehvs035);' onfocus='DisableIcon(mehvs035);'>  
          Time
        <input class=Mandatory type=text name=mehvs037 id=mehvs037 size=8 tabindex=9
          value="%PATWEB89.07.338" title="Legal Status time">
        <img notab src="../images/DateTimeStamp.gif" class=Icon
         onclick="SetCurrentDateTime(mehvs035,mehvs037);"
         onfocus="DisableIconTime(mehvs037)" tabindex=-1>
       <img notab src="../images/TimeLookup.gif" class=Icon
        onclick='TimeLookupFrame(mehvs037);' onfocus='DisableIconTime(mehvs037);' tabindex=-1>
          </td>
        <td class=DataLabel>Reception Order Date</td>
        <td class=DataField>
        <input type="text" size="12" name="mehvs014" id="mehvs014" title="Reception Date" 
          value="%PATWEB89.07.315" tabindex="19"
          onblur="checkDate(this,'Reception Date')">
        <img src="../images/DateLookup.gif" class=Icon
         onclick="DisableIcon(mehvs014);"></td>
    </tr>

    <tr><td class=DataLabel>Status Review Date</td>
        <td class=DataField>
        <input type="text" size="12" name="mehvs003" id="mehvs003" tabindex="9"
          title="Status Review Date" value="%PATWEB89.07.304" class="FutureDate"
          onblur="checkDate(this,'Status Rev Date')">
        <img src="../images/DateLookup.gif" class=Icon
         onclick="DisableIcon(mehvs003);"></td>
        <td class=DataLabel>Type of Admission </td>
        <td class=DataField>
        <select name="mehvs026" id="mehvs026" title="Type of Admission" tabindex="20">
         <option></option>
         %PATWEB89.07.327.2
         </select>

    </tr>

    <tr><td class=DataLabel>Visit Restricted?</td>
        <td class=DataField>
        <select name="mehvs015" id="mehvs015" title="Visit Restricted" tabindex="10">
          <option value="1">Yes</option>
          <option value="2">No</option>
        </select></td>
       </tr>


<tr align=center>
  <td align=center colspan=4><br>
   <input type=button value="OK" class="button" tabindex=20 
    id="pat89sub" onclick="tempDisable(this);SubmitAdm()">
</table>
</td></tr>
</table>
</form>
<form name=PatientLinks id=PatientLinks method=get>
<input type=hidden name=reportno id=reportno value=1>
<input type=hidden name=template id=template value=004>
<input type=hidden name=urnumber id=urnumber value="%PATWEB89.07.003">
<input type=hidden name=admissno id=admissno value="%PATWEB89.07.101">
<input type=hidden name=MenuType id=MenuType value="%PATWEB89.07.088">
</form>
</div>

<script type="text/javascript">
 Benefit="%PATWEB89.07.319.1";
  if ( Benefit == "Yes") {
   document.UpdateForm.mehvs018.selectedIndex="1";
  } else if ( Benefit == "No") {
   document.UpdateForm.mehvs018.selectedIndex="2";
  } else if ( Benefit == "Unknown") {
   document.UpdateForm.mehvs018.selectedIndex="3";
  } else {
   document.UpdateForm.mehvs018.selectedIndex="0";
  }
//
 Supported="%PATWEB89.07.321.1";
  if ( Supported == "Yes") {
   document.UpdateForm.mehvs020.selectedIndex="1";
  } else if ( Supported == "No") {
   document.UpdateForm.mehvs020.selectedIndex="2";
  } else {
   document.UpdateForm.mehvs020.selectedIndex="0";
  }
//
 Restricted="%PATWEB89.07.316.1";
  if ( Restricted == "Yes") {
   document.UpdateForm.mehvs015.selectedIndex="0";
  } else {
   document.UpdateForm.mehvs015.selectedIndex="1";
  }

//Check if using MH diagnosis Screen in Admissions (1=Yes)
if ("%PATWEB89.07.422" == "1") {
  document.UpdateForm.redirect.value="%PATWEB89.07.001.mehweb01.01.001";
} else {
  document.UpdateForm.redirect.value="%PATWEB89.07.001.patweb98.01.001";
}
//Check if currently admitted
  var status=trim("%PATWEB89.07.104");
  if(status!="On-Leave" && status!="Current"){
  document.UpdateForm.redirect.value="%PATWEB89.07.001.patweb98.01.001";
} 
//Check if using legal status can be modified
legflag="%PATWEB89.07.339"
if (legflag == "0") {
//    document.UpdateForm.mehvs034.disabled=true;
//    document.UpdateForm.mehvs034.className="";
//    document.UpdateForm.mehvs035.readOnly=true;
//    document.UpdateForm.mehvs035.className="Readonly";
//    document.UpdateForm.mehvs035.disabled=true;
//    document.UpdateForm.mehvs037.readOnly=true;
//    document.UpdateForm.mehvs037.className="Readonly";
//    document.UpdateForm.mehvs037.disabled=true;
}
</script>
