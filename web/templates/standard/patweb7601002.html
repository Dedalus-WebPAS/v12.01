<meta name="TemplateVersion" content="V12.01.00">
<meta name="TemplateHome" content="standard">
<meta name="CrossBrowser" content="true">
<meta name="HelpFileName"    content="NoContextSet.html">
<script type="text/javascript">
function SubmitJournal(){
  if (document.UpdateForm.jouritem.value==""){
     alert("Journal Type is Mandatory");
     return;}

  if (document.UpdateForm.jourpatt.value==""){
     alert("Journal Amount is Mandatory");
     return;}

  if (document.UpdateForm.jourpatt.value>999999999999.99){
     alert("Invalid Journal Amount ");
     return;}
  if (document.UpdateForm.jourpatt.value<-99999999999.99){
     alert("Invalid Journal Amount ");
     return;}

  if(document.UpdateForm.jouritem.value.substr(14,1)!="R") {

   if((document.UpdateForm.jouritem.value.substr(14,1)=="A") ||
      (document.UpdateForm.jouritem.value.substr(7,1)=="R") ||
      (document.UpdateForm.jouritem.value.substr(7,1)=="F"))
   {
      jrnl=(-1*document.UpdateForm.jourpatt.value);
   } else {
      jrnl=document.UpdateForm.jourpatt.value;
   }

   if(document.UpdateForm.jouritem.value.substr(7,1)=="R") {

     if((document.UpdateForm.paymflag.value)==0)  {
       alert("No Refund - Invoice has No Payment.");
       return;
     }

     if(document.UpdateForm.outstand.value>0) {
       alert("No Refund - Invoice still has Outstanding Amount.");
       return;
     } else {
       if(document.UpdateForm.outstand.value==0) {
         alert("No Refund - Invoice Balanced.");
         return;
       }
     }

     total=parseFloat(document.UpdateForm.maxrfund.value) +
           parseFloat(jrnl);
     if (total < 0 ){
       alert("Refund amount can not be greater than Payment amount " + 
            document.UpdateForm.maxrfund.value );
       return;
     }
     total=parseFloat(document.UpdateForm.outstand.value) -
          parseFloat(jrnl);
     outst=(-1*document.UpdateForm.outstand.value);
       if (total>0) {
       alert("Refund amount can not be greater than the Credit Amount $" + outst);
       return;
       }
   }

   if(document.UpdateForm.jouritem.value.substr(7,1)=="F") {
     if((document.UpdateForm.maxdepst.value)==0)  {
       alert("No Deposit OFF - Invoice has No Deposit.");
       return;
     } else {
       if(document.UpdateForm.outstand.value>0) {
         alert("No Deposit OFF - Invoice still has Outstanding Amount");
         return;
        } else {
           if(document.UpdateForm.outstand.value==0) {
           alert("No Deposit OFF - Invoice Balanced.");
           return;
        }
       total=parseFloat(document.UpdateForm.maxdepst.value) +
             parseFloat(jrnl);
       if (total < 0 ){
         alert("Deposit OFF can not be greater than the Total Deposit" + 
              document.UpdateForm.maxdepst.value );
         return;
        }
       }
     total=parseFloat(document.UpdateForm.outstand.value) -
          parseFloat(jrnl);
     outst=(-1*document.UpdateForm.outstand.value);
       if (total>0) {
       alert("Deposit OFF can not be greater than the Credit Amount $" + outst);
       return;
       }
     }
   }

   total=parseFloat(document.UpdateForm.outstand.value) -
          parseFloat(jrnl);

   if (total < 0 ){
     if(document.UpdateForm.jouritem.value.substr(7,1)=="D") {
       if(document.UpdateForm.outstand.value<=0) {
      alert("No Discount - Invoice has No Outstanding Amount");
        return;
       } else {
      alert("Discount Amount must be less than or equal to the Outstanding Invoice Amount");
         return;
       }
     } else {
       if (!confirm("Warning: Account will be in credit!\n Ok to Continue ?")) {
        return;
       }
     }
   }
  }

  document.getElementById('addbuttn').disabled=true;
  document.UpdateForm.submit();
  setTimeout("document.getElementById('addbuttn').disabled=false",2000);
}
function ShowGST(){
   if(document.UpdateForm.jouritem.value.substr(14,1)=="G") {
      GST.style.display="";
      GST.innerHTML=DisplayGST.innerHTML;
   } else {
      GST.innerHTML="";
      GST.style.display="none";
   }
//
}
function CalcBal() {
  var serverURL = "../cgi-bin/comweb80.pbl?reportno=80" +
                  "&invoicen="+UpdateForm.invoicen.value.replace(/ /g,"+") +
                  "&jouritem="+UpdateForm.jouritem.value.replace(/ /g,"+") +
                  "&jourpatt="+UpdateForm.jourpatt.value.replace(/ /g,"+");
  var returnValue = RSExecute(serverURL);

  if (returnValue.status!=0) {
    return true;
  }
  ReturnValues=returnValue.return_value.split("|")
  document.getElementById("totalbal").innerText=ReturnValues[0];
}

</script>
</head>
%START.OF.PAGE
<body onload="PageLoad(event);">
<span class=DFrameTitleBar>
<img align="right" alt="Exit" class="MenuIcon"
 src="../images/ExitIcon.gif" onclick="DFrameExitRefresh();">
Input Journal Adjustment
</span>

<form name=UpdateForm action=patweb75.pbl method=post style="margin:0"
 onsubmit='return validateMandatory(this);'>
<table cellspacing=0 cellpadding=2 border=0 width=95% align=center>
  <input type=hidden name=invoicen value="%PATWEB76.01.302">
  <input type=hidden name=reportno value="2">
  <input type=hidden name=template value="1">
  <input type=hidden name=outstand value="%PATWEB76.01.377">
  <input type=hidden name=maxrfund value="%PATWEB76.01.385.0">
  <input type=hidden name=maxdepst value="%PATWEB76.01.385.1">
  <input type=hidden name=paymflag value="%PATWEB76.01.385.2">

<tr><td class=DataLabel width=40%>Claim Type</td>
    <td class=DataField>%PATWEB76.01.399.0</td></tr>

<tr><td class=DataLabel width=40%>Invoice Number  </td>
    <td class=DataField>%PATWEB76.01.302</td></tr>

<tr><td class=DataLabel>Invoice Date  </td>
    <td class=DataField>%PATWEB76.01.303</td></tr>

<tr><td class=DataLabel>Current Invoice Total</td>
    <td class=DataField>$%PATWEB76.01.387</td></tr>

<tr><td class=DataLabel>Current Payment Total</td>
    <td class=DataField>$%PATWEB76.01.388</td></tr>

<tr><td class=DataLabel>Current Journal Total</td>
    <td class=DataField>$%PATWEB76.01.389</td></tr>

<tr><td class=DataLabel>Current Balance Outstanding</td>
    <td class=DataField>$%PATWEB76.01.377</td></tr>

<tr><td>&nbsp;</td></tr>

<tr><td class=DataLabel>Type of Journal</b></td> 
    <td><select name=jouritem class="Mandatory SelectBig" title="Journal Code"
                onchange="ShowGST();CalcBal();">
        <option></option>
        %PATWEB76.01.384
        </select>
    </td></tr>
<tr valign=top><td class=DataLabel>Alternative Description</td>
    <td> <input type=text name=jourdesc size=25 maxlength=25
         value="%PATWEB76.01.306.0" onblur="removeTabs(this)";>
    </td></tr>
</table>

<div id=GST></div>

<table cellspacing=0 cellpadding=2 border=0 width=95% align=center>
<tr valign=top><td class=DataLabel width=40%>Amount</td>
    <td> <input type=text name=jourpatt size=12
          class="Number Mandatory" name="Amount" onblur="CalcBal();">
    </td></tr>

<tr><td>&nbsp;</td></tr>

<tr valign=top><td class=DataLabel width=40%>Calculated Balance Outstanding</td>
    <td class="DataField RedText" id="totalbal">
    </td></tr>

<tr><td>&nbsp;</td></tr>

<tr><td colspan=2 align=center>
    <input type=button value=Add class="button" id="addbuttn"
     onclick=SubmitJournal();>
    <input type=button value=Cancel class="button" onclick="DFrameExit();">
</td></tr>
</table>
</form>

<span id="DisplayGST" style="display:none;">
<table align=center cellspacing=0 cellpadding=1 border=0 width=95%>
<tr><td class=DataLabel width=40%>GST Code</td>
    <td class=DataField><select class="SelectBig Mandatory" name=gstcodes
     title="GST Code">
    <option></option>
    %PATWEB76.01.311
    </select></td></tr>
</table>
</span>

<script type="text/javascript">

  document.getElementById("totalbal").innerText="$%PATWEB76.01.377"

</script>


