<meta name="TemplateVersion" content="V12.01.00">
<meta name="TemplateHome" content="standard">
<meta name="HelpFileName" content="NoContextSet.html">
<meta name="CrossBrowser" content="true">
<script type="text/javascript" src="../js/OutpatientSelect.js"></script>
<script type="text/javascript" src="../js/OutpatientClinicId.js"></script>
<script language="javascript" src="../js/allweb02.js"></script>
<script type="text/javascript" src="../js/AutoPostCode.js"></script>

<script type="text/javascript">
function SetList()
{
  p=InternalReferral
  var SetSite

  if(p.alcndevp.value=="1") {
    document.getElementById("EventProgramLabel").innerHTML=
    document.getElementById("ShowEventProgramLabel").innerHTML
    document.getElementById("EventProgramField").innerHTML=
    document.getElementById("ShowEventProgramField").innerHTML
  }

  if(isWhitespace(p.alref119.value))
    SetSite=p.wbsesite.value;
  else
    SetSite=p.alref119.value;

 for (var i =0 ; i < document.InternalReferral.alref119.length; i++)
  if (document.InternalReferral.alref119.options[i].value==SetSite.substr(0,6))
    document.InternalReferral.alref119.selectedIndex=i


  p.alref106.options.length=1;
 // SetClinicType(p.alref106,p.defctype.value,p.alref119.value);
  SetClinicType(p.alref106,null,p.alref119.value);

  if(p.alref120.type=="select-one") {
    p.alref120.options.length=1;
    SetClinicId(p.alref120,p.deftclid.value,p.alref119.value);
  } else {
    UpCase(p.alref120);validateClinic(p.alref119,p.alref120,p.name_alref120)
  }


}
function clrFreeHCP() {
  p=InternalReferral
if (!isWhitespace(p.alref108.value)) {
  clrFields(p.alref108,p.alref109,p.alref110,p.alref111);
  clrFields(p.alref112,p.alref113,p.alref114,p.alref115);
  DisplayHCP(p.alref108)
  }
}
function DisplayHCP(hcp) {
  if (!isWhitespace(hcp.value)) {
    HCPHDprov.innerHTML=hcphprov.innerHTML;
    HCPprov.innerHTML=hcpprov.innerHTML;
    HCPHDadd1.innerHTML=hcphadd1.innerHTML;
    HCPadd1.innerHTML=hcpadd1.innerHTML;

    HCPHaddr.innerHTML=hcpaddr.innerHTML;
    InternalReferral.alref116.focus();
    InternalReferral.alref108.className="Mandatory";
    InternalReferral.alref022.className="";
  } else {
    HCPHDprov.innerHTML="";
    HCPprov.innerHTML="";
    HCPHDadd1.innerHTML="";
    HCPadd1.innerHTML="";

    HCPHaddr.innerHTML="";
    InternalReferral.alref108.value="";
    InternalReferral.alref108.className="";
    InternalReferral.alref022.className="Mandatory";
  }
}

function AddCombinedReferral() {
  if(!validateMandatory(MasterReferral)) {
    return;
  }
  if(!validateMandatory(InternalReferral)) {
    return;
  }

  calculateReferralExpiryDate();

  if(!isWhitespace(InternalReferral.alref022.value) &&
                   InternalReferral.rusualgp.checked==true) {
    InternalReferral.pmpmi059.value=InternalReferral.alref022.value;
    InternalReferral.pmpmi060.value=InternalReferral.alref023.value;
    InternalReferral.pmpmi061.value=InternalReferral.alref024.value;
  }


    if(!isWhitespace(InternalReferral.alref039.value) &&
       !isWhitespace(InternalReferral.alref090.value)) {
       if(SetDateYYYYMMDD(InternalReferral.alref039.value) >
          SetDateYYYYMMDD(InternalReferral.alref090.value)) {
          alert(InternalReferral.alref039.title + " must be before " +
          InternalReferral.alref090.title);
          return;
       }
    }

    if(!isWhitespace(MasterReferral.alref039.value) &&
       !isWhitespace(MasterReferral.alref094.value)) {
       if(SetDateYYYYMMDD(MasterReferral.alref094.value) >
          SetDateYYYYMMDD(MasterReferral.alref039.value)) {
          alert(MasterReferral.alref039.title + " must be after " +
          MasterReferral.alref094.title);
          return;
       }
    }

    if(!isWhitespace(MasterReferral.alref039.value) &&
       !isWhitespace(MasterReferral.alref132.value)) {
       if(SetDateYYYYMMDD(MasterReferral.alref039.value) >
          SetDateYYYYMMDD(MasterReferral.alref132.value)) {
          alert(MasterReferral.alref132.title + " must be after " +
          MasterReferral.alref039.title);
          return;
       }
    }

  if (isWhitespace(document.MasterReferral.alref094.value)) {
    alert("Warning: Referral In Clinical Referral Date field is empty.");
  }

  if(isWhitespace(InternalReferral.sacsvisn.value)) {
    if(!AddMasterReferral()) {
      return;
    }
  }
  if (SetDateYYYYMMDD(MasterReferral.alref019.value) > 
      SetDateYYYYMMDD(InternalReferral.alref019.value)) {
    alert("Program referral date can't be after the episode referral date.");
    return;
  }

  if(isWhitespace(InternalReferral.sacsvisn.value)) {
    alert("Error adding progam referral.");
    return;
  }
  window.PageUpdateForm=InternalReferral
  InternalReferral.target="PopUpFrame1";
  InternalReferral.submit(); 
}

//========================================================================
// AJAX post funtion to add master referral and return it's visit number
//========================================================================
function AddMasterReferral() {
  var theURL="allweb02.pbl";
  var postStr=AJAXPostString(document.MasterReferral)
  xmlHttp = createHttpObject();
  xmlHttp.open("POST", theURL, false);
  xmlHttp.setRequestHeader("Content-Type","application/x-www-form-urlencoded;");
  xmlHttp.send(postStr);
  if (xmlHttp.status=="200") {
    if (xmlHttp.responseText.match(/PROCESSING_OK/i)) {
       responseArray=xmlHttp.responseText.split("|");
       InternalReferral.sacsvisn.value=responseArray[0].substr(14,8);
       for (var i=1; i < responseArray.length; i++) {
          if(!isWhitespace(responseArray[i])) {
             alert(responseArray[i]);
          }
       }
    return true;
    }
    else {
      alert(xmlHttp.responseText.replace(/.*alert../i,"").replace(/.\).*/i,""));
      return false;
    }
  }
  else {
    alert("Web Service Not Available. Check your Connection and Try Again.");
   return false;
  }
}
function init() {
  p=InternalReferral
  var SetSite

  if(p.alcndevp.value=="1") {
    document.getElementById("EventProgramLabel").innerHTML=
    document.getElementById("ShowEventProgramLabel").innerHTML
    document.getElementById("EventProgramField").innerHTML=
    document.getElementById("ShowEventProgramField").innerHTML
  }

  if(isWhitespace(p.alref119.value)) {
      SetSite=p.wbsesite.value;
  } else {
      SetSite=p.alref119.value;
  }

  for (var i =0 ; i < p.alref119.length; i++)
   if (p.alref119.options[i].value==SetSite.substr(0,6))
     p.alref119.selectedIndex=i

  p.alref106.options.length=1;
  SetClinicType(p.alref106,p.defctype.value,p.alref119.value);

  if(p.alref120.type=="select-one") {
    p.alref120.options.length=1;
    SetClinicId(p.alref120,p.deftclid.value,p.alref119.value);
  } else {
    UpCase(p.alref120);validateClinic(p.alref119,p.alref120,p.name_alref120)
  }

}

function DefRefDate() {
  if(!checkDate(MasterReferral.alref019,'Referral Date')) {
    return;
  }
  MasterReferral.alref094.value=MasterReferral.alref019.value;
  InternalReferral.alref019.value=MasterReferral.alref019.value;
  checkTriageDate();
}
function checkTriageDate() {
  InternalReferral.alref187.value=MasterReferral.alref187.value;

  if(!document.getElementById("alref187")) {  // Triage Date
    return;
  }
  triageD=document.getElementById("alref187");
  if(isWhitespace(triageD.value)) {
    return;
  }
  if(!checkDate(triageD,triageD.title)) {
    return;
  }
  if(!document.getElementById("alref019")) {   // Referral Date
    return;
  }
  referralD=document.getElementById("alref019");
  if (SetDateYYYYMMDD(referralD.value) > SetDateYYYYMMDD(triageD.value)) {
    alert("Triage date must be after the referral date");
    triageD.value="";
    triageD.focus();
  }
}
function DefRefRecDate() {
  if(!checkDate(MasterReferral.alref039,'Referral In Received Date')) {
    return;
  }
  InternalReferral.alref039.value=MasterReferral.alref039.value;
}
function DefRefPriority() {
  InternalReferral.alref027.value=MasterReferral.alref027.value;
}
function SetInternalDept() {
  InternalReferral.deptcode.value=InternalReferral.allrf001.value;
  selectOptions2(59,InternalReferral.deptcode,InternalReferral.alref028);
  validateCode2(60,InternalReferral.deptcode,InternalReferral.d_alref028)
  if(!isWhitespace(InternalReferral.d_alref028.value)) {
    for (var i =0 ; i < InternalReferral.alref028.length; i++) {
    if (trim(InternalReferral.alref028.options[i].value)==
        trim(InternalReferral.d_alref028.value)) {
        InternalReferral.alref028.selectedIndex=i } };
  }

  selectOptions2(79,InternalReferral.deptcode,InternalReferral.alref031);
  
  for (var i =0 ; i < document.InternalReferral.deptlcod.length; i++) 
  {
    if (document.InternalReferral.deptlcod.options[i].value.substr(0,3)==
        document.InternalReferral.deptcode.value.substr(0,3)) 
    {
        document.InternalReferral.deptlcod.selectedIndex=i; 
    } 
  }

  displayFreeFormat();
  displayReason();
  displayDiagnosis();
  displayVisitType();
  displayTypeOfReferral();
  displayClinicId();
  displaySourceOfReferral();
  filterNDISEpsRef(InternalReferral);    // Filter NDIS claim codes
  mandReasonForRefEPS();
}
function openHealthConditionAddV() {
  if(isWhitespace(document.InternalReferral.deptcode.value)) {
     alert("Please select an Episode Program Stream.");
    return;
  }
  var alref090 = document.getElementById("alref090");
  var linkUrl = "allweb02.pbl?reportno=03&template=004&chkvinah=1&deptcode="+
                 document.InternalReferral.deptcode.value +
                 "&valddate="+ alref090.value;

  displayDiagnosisPopupFrame(linkUrl);
}
function openOtherFactorsAffectingHealthAdd() {
  if(isWhitespace(document.InternalReferral.deptcode.value)) {
     alert("Please select an Episode Program Stream.");
    return;
  }
  var linkUrl = "allweb02.pbl?reportno=03&template=006&deptcode="+
                 document.InternalReferral.deptcode.value;

  displayDiagnosisPopupFrame(linkUrl);
}
function openReferralDestinationAdd() {
  if(isWhitespace(document.InternalReferral.deptcode.value)) {
     alert("Please select an Episode Program Stream.");
    return;
  }
  var linkUrl = "allweb02.pbl?reportno=03&template=008&deptcode="+
                 document.InternalReferral.deptcode.value;

  displayDiagnosisPopupFrame(linkUrl);

}
function calculateReferralExpiryDate() {
  if(isWhitespace(document.InternalReferral.alref019.value)) {return;}
  if(isWhitespace(document.InternalReferral.alref124.value)) {return;}
  if(parseInt(document.InternalReferral.alref124.value.substr(25,6))=="0") {
    document.InternalReferral.alref125.value="";
    return;
  }
  old_date = document.InternalReferral.alref019.value;

  AddSubtractDate(document.InternalReferral.alref019,
                  document.InternalReferral.alref124.value.substr(22,6),
                  "A");

  document.InternalReferral.alref125.value=
  document.InternalReferral.alref019.value;
  document.InternalReferral.alref019.value=old_date;
}
function displayCarePlan() {
  if (document.MasterReferral.deptlcod.value.substr(28,1)  == "1") {
    careplantitlespan.style.display="";
    careplanfieldspan.style.display="";
  }
}

function displayFreeFormat() {
  if (document.InternalReferral.deptlcod.value.substr(29,1)  == "1") {
    freeformattitlespan.style.display="";
    freeformatfieldspan.style.display="";
  } else {
    freeformattitlespan.style.display="none";
    freeformatfieldspan.style.display="none";
  }
}
function displayReason() {
  if (document.InternalReferral.deptlcod.value.substr(30,1) == "2" ||
      document.InternalReferral.deptlcod.value.substr(30,1) == "3") {
    reasontitlespan.style.display="";
    reasonfieldspan.style.display="";
    document.InternalReferral.alref028.className="SelectBig";
    return;
  }

  if (document.InternalReferral.deptlcod.value.substr(30,1)  == "1") {
    reasontitlespan.style.display="";
    reasonfieldspan.style.display="";
    document.InternalReferral.alref028.className="SelectBig Mandatory";
    return;
  }

  reasontitlespan.style.display="none";
  reasonfieldspan.style.display="none";
  document.InternalReferral.alref028.className="SelectBig";
  return;

}
function displayDiagnosis() {
  if (document.InternalReferral.deptlcod.value.substr(31,1)  == "2") {
    diagnosistitlespan.style.display="";
    diagnosisfieldspan.style.display="";
    document.InternalReferral.alref031.className="SelectBig";
    return;
  }

  if (document.InternalReferral.deptlcod.value.substr(31,1)  == "1") {
    diagnosistitlespan.style.display="";
    diagnosisfieldspan.style.display="";
    document.InternalReferral.alref031.className="SelectBig Mandatory";
    return;
  }

  diagnosistitlespan.style.display="none";
  diagnosisfieldspan.style.display="none";
  document.InternalReferral.alref031.className="SelectBig";
  return;

}
function displayVisitType() {
  if (document.InternalReferral.deptlcod.value.substr(32,1)  == "2") {
    visittypetitlespan.style.display="";
    visittypefieldspan.style.display="";
    return;
  }
  if (document.InternalReferral.deptlcod.value.substr(32,1)  == "1") {
    visittypetitlespan.style.display="";
    visittypefieldspan.style.display="";
    document.InternalReferral.alref117.className="SelectBig Mandatory";
    return;
  }
  visittypetitlespan.style.display="none";
  visittypefieldspan.style.display="none";
  document.InternalReferral.alref117.className="SelectBig";
  return;

}
function displayTypeOfReferral() {
  if (document.InternalReferral.deptlcod.value.substr(33,1)  == "2") {
    typeofreferraltitlespan.style.display="";
    typeofreferralfieldspan.style.display="";
    typeofreferraltitlespan1.style.display="";
    typeofreferralfieldspan1.style.display="";
    return;
  }
  if (document.InternalReferral.deptlcod.value.substr(33,1)  == "1") {
    typeofreferraltitlespan.style.display="";
    typeofreferralfieldspan.style.display="";
    typeofreferraltitlespan1.style.display="";
    typeofreferralfieldspan1.style.display="";
    document.InternalReferral.alref124.className="SelectBig Mandatory";
    return;
  }
  typeofreferraltitlespan.style.display="none";
  typeofreferralfieldspan.style.display="none";
  typeofreferraltitlespan1.style.display="none";
  typeofreferralfieldspan1.style.display="none";
  document.InternalReferral.alref124.className="SelectBig";
  return;

}
function displayClinicId() {
  if (document.InternalReferral.deptlcod.value.substr(34,1)  == "2") {
    clinicidtitlespan.style.display="";
    clinicidfieldspan.style.display="";
    return;
  }
  if (document.InternalReferral.deptlcod.value.substr(34,1)  == "1") {
    clinicidtitlespan.style.display="";
    clinicidfieldspan.style.display="";
    document.InternalReferral.alref120.className="Mandatory";
    return;
  }
  clinicidtitlespan.style.display="none";
  clinicidfieldspan.style.display="none";
  document.InternalReferral.alref120.className="";
  return;

}
function displaySourceOfReferral() {
  if (document.InternalReferral.deptlcod.value.substr(35,1)  == "2") {
    sourceofreferraltitlespan.style.display="";
    sourceofreferralfieldspan.style.display="";
    return;
  }
  if (document.InternalReferral.deptlcod.value.substr(35,1)  == "1") {
    sourceofreferraltitlespan.style.display="";
    sourceofreferralfieldspan.style.display="";
    document.InternalReferral.alref034.className="SelectBig Mandatory";
    return;
  }
  sourceofreferraltitlespan.style.display="none";
  sourceofreferralfieldspan.style.display="none";
  document.InternalReferral.alref034.className="SelectBig";
  return;

}

function displayHealthCondition() {
  if(document.MasterReferral.deptlcod.value.substr(39,1)=="1" ||
     document.MasterReferral.deptlcod.value.substr(39,1)=="2") {
    mainhealthspan.style.display="";
  }
}


</script>
</head>
%START.OF.PAGE
<body onload="PageLoad(event);displayCarePlan();
              displayFreeFormat();displayReason();
              displayDiagnosis();displayVisitType();displayTypeOfReferral();
              displayClinicId();displaySourceOfReferral();InitPostCodes();
              CommonProgramRefComb();
              showPriorityOption(InternalReferral);ValidatePriority();
              displayHealthCondition();
              setReferralFields();">
<span class=DFrameTitleBar>
<img border=0 align=right src="../images/ExitIcon.gif" onclick="DFrameExit();">
%ALLWEB02.03.125.0  Referral
</span>
<div id=PageBodySection style="overflow: auto;">
<form name=MasterReferral action="allweb02.pbl" method=post>
<input type=hidden name=reportno value="2">
<input type=hidden name=updatety value="A">
<input type=hidden name=nextpage value="6">
<input type=hidden name=urnumber value="%ALLWEB02.03.003">
<input type=hidden name=deptcode value="%ALLWEB02.03.125.1">
<input type=hidden name=deptlcod id=deptlcod value="%ALLWEB02.03.125.3">
<input type=hidden name=dummy>
<input type=hidden name=alref083 value="1">
<input type=hidden name=alref028 value=" ">
<input type=hidden name=override value="2">
<input type=hidden name=referlin value="1" />
<input type="hidden" name="d_aldeutrs" id="d_aldeutrs"
       value="%ALLWEB02.03.762.3">
<input type="hidden" name="d_alrestat" id="d_alrestat"
       value="%ALLWEB02.03.199.027">
<input type="hidden" name="d_aldeuprt" id="d_aldeuprt"
       value="%ALLWEB02.03.762.4">
<input type=hidden name=ptcnhdps id=ptcnhdps 
       value="%STANDARD.01.025.080.250.1.1">

<table align=center cellspacing=0 cellpadding=0 border=0 width=100%>
<tr><td class=DataLabel width=20%>Referral In Program</td>
    <td width=35%><input name=allrf001 type=text value="%ALLWEB02.03.125.0" 
          readonly class=Readonly></td>
    <td class=DataLabel width=15%>Entered by</td>
    <td width=35%><input type=text value="%ALLWEB02.03.168" readonly 
	  class=Readonly></td></tr>

<tr><td class=DataLabel><div id="tsHeading"></div></td>
      <td><div id="tsField"></div></td>
      <td class=DataLabel><div id="tdHeading"></div></td>
      <td><div id="tdField"></div></td>
      </tr>

<tr><td class=DataLabel><div id="prHeading"></div></td>
    <td><div id="prField"></div></td>
    <td class=DataLabel>%STANDARD.01.017.zU</td>
    <td><select title="%STANDARD.01.017.zU" name=rfdtr001
         class="Mandatory SelectBig" 
         onchange="SetCurrentDateTimeNoFocus(document.MasterReferral.rfdat001,null);">
        <option></option>
         %STANDARD.01.018.zU.   .9.1.01.2.O
        </select></td>
</tr>

<tr><td class=DataLabel>Referral In Receipt<br />Acknowledgement Date</td>
    <td class=DataField>
    <input type=text name=alref132 size=12 
     onblur="checkDate(this,'Date')" value=""
     class="PastDate" title="Date of Referral Receipt Acknowledgement">
    <img src=../images/DateTimeStamp.gif class=Icon date=MasterReferral.alref132
     time=null>
    <img src=../images/DateLookup.gif class=Icon date=MasterReferral.alref132>
        <input type=hidden name=rfdat001 value="">
        <input type=hidden name=rfdpl001 value="">
    </td>
    <td class=DataLabel>Referral Date</td>
    <td class=DataField>
    <input type=text name=alref019 size=12 id=alref019
     onblur="DefRefDate();" 
     class= "PastDate Mandatory" title="Referral Date">
    <img src=../images/DateTimeStamp.gif class=Icon date=MasterReferral.alref019
     time=null>
    <img src=../images/DateLookup.gif class=Icon date=MasterReferral.alref019>
    </td>
</tr>

<tr><td class=DataLabel>
<span id="careplantitlespan" style="display:none">
Care Plan Documented
</span>
</td>
    <td class=DataField>
<span id="careplanfieldspan" style="display:none">
    <input type=text name=alref096 size=12
     onblur="checkDate(this,'Date')" value=""
     class="PastDate" title="Care Plan Documented Date">
    <img src=../images/DateTimeStamp.gif class=Icon date=MasterReferral.alref096
     time=null>
    <img src=../images/DateLookup.gif class=Icon date=MasterReferral.alref096>
</span>
    </td>
</tr>

<tr><td class=DataLabel>Referral In Clinical Referral Date</td>
    <td class=DataField>
    <input type=text name=alref094 size=12
     onblur="checkDate(this,'Date')" value="" 
     class="PastDate" title="Referral In Clinical Referral Date">
    <img src=../images/DateTimeStamp.gif class=Icon date=MasterReferral.alref094
     time=null>
    <img src=../images/DateLookup.gif class=Icon date=MasterReferral.alref094>
    </td>
    <td class=DataLabel>Referral In Received Date</td>
    <td class=DataField>
    <input type=text name=alref039 size=12 
     onblur="DefRefRecDate();" value="%ALLWEB02.03.139"
     class="Mandatory PastDate" title="Referral In Received Date">
    <img src=../images/DateTimeStamp.gif class=Icon date=MasterReferral.alref039
     time=null>
    <img src=../images/DateLookup.gif class=Icon date=MasterReferral.alref039>
    </td></tr>

<tr>
    <td class=DataLabel></td>
    <td></td>
    <td class=DataLabel>Living Arrangement</td>
    <td><select title="Living Arrangement" name=alref077 tabindex=36
         class="SelectBig">
        <option></option>
         %ALLWEB02.03.140.38.4
        </select></td>
  </tr>
  <tr>
    <td class=DataLabel></td>
    <td></td>
    <td class=DataLabel>Accommodation</td>
    <td><select title="Accommodation" name=alref078 tabindex=36
         class="SelectBig">
        <option></option>
         %ALLWEB02.03.140.39.4
        </select></td>
  </tr>

<tr><td colspan=4 align=center><hr>
    </td></tr>

</table>
</form>

<form name=InternalReferral action="allweb02.pbl" method=post>
<input type=hidden name=reportno value="2">
<input type=hidden name=updatety value="A">
<input type=hidden name=nextpage value="5">
<input type=hidden name=redirect value="%ALLWEB02.03.001.allweb02.02.001">
<input type=hidden name=urnumber value="%ALLWEB02.03.003">
<input type=hidden id=deptcode name=deptcode value="">
<input type=hidden name=dummy>
<input type=hidden name=sacsvisn value=" ">
<input type=hidden name=override value="2">
<input type=hidden name=alcndevp value="%STANDARD.01.025.106.225.0.1">
<input type=hidden name=wbsesite value="%STANDARD.01.023">
<input type=hidden name=defctype value="">
<input type=hidden name=d_alref028 value="">
<input type=hidden name=deftclid value="">
<input type=hidden name=pmpmi059 value="%ALLWEB02.03.484.001">
<input type=hidden name=pmpmi060 value="%ALLWEB02.03.485.001">
<input type=hidden name=pmpmi061 value="%ALLWEB02.03.461">
<input type=hidden name=CATEG_CL value="CL">

<table align=center cellspacing=0 cellpadding=0 border=0 width=100%>
<tr><td class=DataLabel></td>
    <td>
    <span id="deptlcodfieldspan" style="display:none">
      <select name=deptlcod tabindex=-1 class="Select">
        <option></option>
         %STANDARD.01.007.CG
      </select>
    </span>
    </td>
</tr>

<tr><td class=DataLabel width=20%>Episode Program Stream</td>
    <td width=35%><select title="Epsiode Program Stream" 
         name=allrf001 
         class="SelectBig Mandatory" onchange="SetInternalDept();">
        <option></option>
         %ALLWEB02.03.218
        </select>
        </td>
    <td class=DataLabel width=15%>Entered By</td>
    <td width=35%><input type=text value="%ALLWEB02.03.168" readonly
          class=Readonly tabindex=-1>
    </td></tr>

<tr><td class=DataLabel><div id="tsHeadingEps"></div></td>
    <td><div id="tsFieldEps"></div></td>
    <td class=DataLabel><div id="tdHeadingEps"></div></td>
    <td><div id="tdFieldEps"></div></td>
    </tr>

<tr><td class=DataLabel><div id="prHeadingEps"></div></td>
    <td><div id="prFieldEps"></div></td>
    <td class=DataLabel>Referral Date</td>
    <td class=DataField>
    <input type=text name=alref019 size=12 id="alref019eps"
     onblur="if (checkDate(this,'Date')) {calculateReferralExpiryDate();}"
     class= "PastDate Mandatory" title="Referral Date">
    <img src=../images/DateTimeStamp.gif class=Icon
     date=InternalReferral.alref019
     time=null>
    <img src=../images/DateLookup.gif class=Icon
     date=InternalReferral.alref019>
    </td>
</tr>

<tr><td class=DataLabel>
    <span id="sourceofreferraltitlespan" style="display:none">
    Source of Referral
    </span>
    </td>
    <td>
    <span id="sourceofreferralfieldspan" style="display:none">
    <select title="Source of Referral" name=alref034
         class="SelectBig">
        <option></option>
         %ALLWEB02.03.134.4
        </select>
    </span>
    </td>
    <td class=DataLabel>Referred By</td>
<!-- ### CGA 300419 Mandatory and Value removed: %ALLWEB02.03.484.001 ### -->
    <td><input type=text id=alref022 name=alref022 size=10 maxlength=10
       value="" title="Referring HCP"  
       onchange="ReadDoc(18,0,alref022,n_alref022,alref023,n_alref023,alref024,hcpprovno);">
       <input type=text name=n_alref022 size=15 readonly title="HCP Name"
        id=n_alref022 class=Readonly tabindex=-1 value="">
       <img src="../images/SearchIcon.gif" class=Icon
        onclick="GPHCPSearchFrame(alref022,n_alref022,hcpprovno,alref023,n_alref023,alref024,0);">
       <img src="../images/ClearIcon.gif" class=Icon
        onclick='clrFields(InternalReferral.alref022,InternalReferral.n_alref022,InternalReferral.hcpprovno);'>
        </td>
</tr>

<tr>
    <td class=DataLabel>
    <span id="typeofreferraltitlespan" style="display:none">
    Type of Referral
    </span>
    </td>
    <td>
    <span id="typeofreferralfieldspan" style="display:none">
    <select name=alref124 title="Type of Referral" 
         class="SelectBig" onblur="calculateReferralExpiryDate();">
        <option></option>
         %ALLWEB02.03.186.2
        </select>
    </span>
    </td>
    <td class=DataLabel>Provider Number</td>
<!-- ### CGA 300419 Value removed: %ALLWEB02.03.206 ### -->
    <td><input type=text size=21 maxlength=8
         value="" title="Provider Number" id=hcpprovno name=hcpprovno
       onchange="ReadDoc2(18,0,alref022,n_alref022,alref023,n_alref023,alref024,hcpprovno);">
         &nbsp;Retain as Usual GP?
        <input type=checkbox value="0" name=rusualgp 
         title="Retain as Usual GP" onclick="UpdateGP2();">
    </td>
    </tr>

<tr><td class=DataLabel>
    <span id="typeofreferraltitlespan1" style="display:none">
    Referral Expiry Date
    </span>
    </td>
    <td>
    <span id="typeofreferralfieldspan1" style="display:none">
    <input type=text name=alref125 size=12 class=Readonly readonly
         title="Referral Expiry Date">
    </span>
    </td>
    <td class=DataLabel>Referred By Practice</td>
<!-- ### CGA 300419 Value removed: %ALLWEB02.03.485.001 ### -->
    <td><input type=text size=10 class=readonly value=""
         title="Referred By Practice" readonly id=alref023 name=alref023>
<!-- ### CGA 300419 Value removed: %ALLWEB02.03.485.005 ### -->
        <input type=text size=15 class=readonly value=""
         title="Practice Name" readonly name=n_alref023 tabindex=-1
	  id=n_alref023>
        <input type=hidden id=alref024 name=alref024
         title="Practice Count" value="%ALLWEB02.03.461">
        <img src="../images/SearchIcon.gif" class=Icon
         onclick="GPHCGSearchFrame(alref022,n_alref022,hcpprovno,alref023,n_alref023,alref024)">
       <img src="../images/erase.gif" class=Icon onclick="clrFields(alref023,n_alref023,alref024,hcpprovno);"></td>
</tr>

<tr><td class=DataLabel>Responsible HCP</td>
    <td><input type=text id=alref038 name=alref038 size=10 maxlength=10
         title="Responsible HCP" 
         value="%ALLWEB02.03.138.1" class=Mandatory
          onblur="ValidateHCP(18,0,alref038,n_alref038);">
        <input type=text name=n_alref038 size=25 readonly title="HCP Name"
         id=n_alref038 value="%ALLWEB02.03.138.0" class=Readonly tabindex=-1>
        <img src="../images/SearchIcon.gif" class=Icon
         onclick="HCPSearchFrame(InternalReferral.alref038,InternalReferral.n_alref038,0);">
         <img src="../images/ClearIcon.gif" class=Icon
         onclick="clrFields(alref038,n_alref038);">
        </td>

    <td class=DataLabel>
    <span id="freeformattitlespan" style="display:none">
    Referring HCP (Free Format)
    </span>
    </td>
    <td>
    <span id="freeformatfieldspan" style="display:none">
    <input type=text name=alref108 size=30 title="Referring HCP"
               onchange="DisplayHCP(alref108)">
         <img src="../images/ClearIcon.gif" class=Icon
          onclick='clrFreeHCP();'>
    </span>
    </td>
</tr>

<tr><td></td><td></td>
    <td class=DataLabel><div id=HCPHDprov></div></td>
    <td><div id=HCPprov></div></td>

    <td class=DataLabel></td>
    <td class=DataField></td>
    </tr>
<!--  VINAH 2007 - 2008 Section 2.2.1 CAR 207550 -->
<tr><td></td><td></td>
  <td class=DataLabel><div id=HCPHDadd1></div></td>
  <td><div id=HCPadd1></div></td>
  <td></td>
  <td></td>
</tr>

</table>

<table align=center cellspacing=0 cellpadding=1 border=0 width=100%>
<tr><td width=55%></td><td><div id=HCPHaddr></div></td></tr>
</table>

<table align=center cellspacing=0 cellpadding=1 border=0 width=100%>

<tr><td class=DataLabel width=20%>Referral In Received Date</td>
    <td class=DataField width=35%>
    <input type=text name=alref039 size=12 
     onblur="checkDate(this,'Date')" value="%ALLWEB02.03.139"
     class="Mandatory PastDate" title="Referral In Received Date">
    <img src=../images/DateTimeStamp.gif class=Icon
     date=InternalReferral.alref039
     time=null>
    <img src=../images/DateLookup.gif class=Icon date=InternalReferral.alref039>
    </td>
    <td class=DataLabel width=15%>Preferred Site</td>
    <td class=DataField><select name=alref119 title="Preferred Site"
     onchange="SetList();">
     <option></option>
      %ALLWEB02.03.182.2
     </select>
     </td>
</tr>

<tr><td class=DataLabel>
    <span id="reasontitlespan" style="display:none">
    Reason for Referral
    </span>
    </td>
    <td>
    <span id="reasonfieldspan" style="display:none">
    <select title="Reason for Referral" name=alref028 id="alref028"
         class="SelectBig" maxlength=49>
        <option></option>
        </select>
    </span>
    </td>
    <td class=DataLabel>
    <span id="clinicidtitlespan" style="display:none">
    Clinic ID
    </span>
    </td>
    <td class=DataField>
    <span id="clinicidfieldspan" style="display:none">
    <select name=alref120 title="Clinic ID">
                          <option></option>
                        </select>
    </span>
    </td>
</tr>

<tr><td class=DataLabel>
    <span id="diagnosistitlespan" style="display:none">
    Diagnosis
    </span>
    </td>
    <td>
    <span id="diagnosisfieldspan" style="display:none">
    <select maxlength=45 name=alref031 class=SelectBig 
         title="Diagnosis" >
        <option></option>
        %ALLWEB02.03.131.2
    </select>
    </span>
    </td>
</tr>

<tr><td class=DataLabel>Clinic Type </td>
    <td><select class="SelectBig Mandatory" name=alref106 maxlength=45
         title="Clinic Type">
        <option></option>
        </select>
    </td>
</tr>

<tr><td class=DataLabel>
    <span id="visittypetitlespan" style="display:none">
    %STANDARD.01.017.CV
    </span>
    </td>
    <td>
    <span id="visittypefieldspan" style="display:none">
    <select name=alref117 class="SelecBig"
         title="%STANDARD.01.017.CV">
        <option></option>
         %ALLWEB02.03.180.2
        </select>
    </span>
</tr>

<tr><td class=DataLabel>Presenting Complaint</td>
    <td><input type=text size=50 maxlength=50
         value="%ALLWEB02.03.181" 
         name=alref118 title="Presenting Complaint"></td>
    <td></td>
    <td><input type="button" class="Largebutton"
         id="btnReferralDestination" name="btnReferralDestination"
         value="Referral Out" 
         onclick="openReferralDestinationAdd();"/>
    </td>
</tr>

<tr>
    <td class=DataLabel>%STANDARD.01.017.CL</td>
    <td><select title="%STANDARD.01.017.CL" name=alref035
         class="SelectBig Mandatory">
        <option></option>
         %ALLWEB02.03.135.9.1.10.2.X
        </select></td>
    <td><div id="EventProgramLabel"></div></td>
    <td><div id="EventProgramField"></div></td>
    <tr>

<tr><td class=DataLabel>Comments 1</td>
    <td colspan=2>
      <input type=text size=50 maxlength=62 name=alref088>
    </td>
    <td>
      <span id="mainhealthspan" style="display:none">
        <input type="button" class="Largebutton" id="btnMainHealth"
         value="Episode Health Conditions" 
         onclick="openHealthConditionAddV();"/>
      </span>
    </td>
</tr>

<tr><td class=DataLabel>Comments 2</td>
    <td><input type=text size=50 maxlength=62 name=alref089>
    </td>
    <td>Episode Health Condition 1</td>
    <td>
    <input type="text" id="mhcon001" name="mhcon001" size="10"
     title="Episode Health Condition Code 1"
     value="" 
     onblur="validateAHDiagV(deptcode,mhcon001,d_mhcon001,alref090);" />
    <input type="text" id="d_mhcon001" name="d_mhcon001" class="ReadOnly"
     value="" readonly="true" size="20" tabindex=-1/>
    <img src="../images/SearchIcon.gif" class="Icon" id="imgSearch"
     onclick="AHDiagSearchFrameV(deptcode,mhcon001,d_mhcon001,alref090);" />
    <img src="../images/ClearIcon.gif" class=Icon
     onclick="clrFields(mhcon001,d_mhcon001);">
    </td>
    </tr>

<tr><td class=DataLabel>Case Team</td>
    <td><input type=text name=alref087 size=11 maxlength=10 title="Case Team"
         id=alref087 onblur="validateCode2(7,alref087,n_alref087)">
        <input type=text id=n_alref087 name=n_alref087 size=25 readonly
         class=Readonly title="Team Description" tabindex=-1>
        <img src="../images/SearchIcon.gif" class=Icon
         onclick="TeamSearchFrame(alref087,n_alref087)">
         <img src="../images/ClearIcon.gif" class=Icon
         onclick="clrFields(alref087,n_alref087);">
        </td>
    <td>Episode Health Condition 2</td>
    <td>
    <input type="text" id="mhcon002" name="mhcon002" size="10"
     title="Episode Health Condition Code 2" value="" 
     onblur="validateAHDiagV(deptcode,mhcon002,d_mhcon002,alref090);" />
    <input type="text" id="d_mhcon002" name="d_mhcon002" class="ReadOnly"
     value=""  readonly="true" size="20" tabindex=-1/>
    <img src="../images/SearchIcon.gif" class="Icon" id="imgSearch"
     onclick="AHDiagSearchFrameV(deptcode,mhcon002,d_mhcon002,alref090);" />
    <img src="../images/ClearIcon.gif" class=Icon
     onclick="clrFields(mhcon002,d_mhcon002);">
    </td>
    <tr>

<tr><td class=DataLabel>Date Referral Accepted</td>
    <td class=DataField> <input type=text name=alref090 size=12 id=alref090
     onblur="checkDate(this,'Date')" value=""
     class="PastDate" title="Date Referral Accepted"> 
    <img src=../images/DateTimeStamp.gif class=Icon
     date=InternalReferral.alref090
     time=null>
    <img src=../images/DateLookup.gif class=Icon date=InternalReferral.alref090>
    </td>
    <td class=DataLabel></td>
    <td></td>
    </tr>

<tr><td class=DataLabel>Activate Referral</td>
    <td><input type=checkbox name=alref003 value="1" title="Activate Referral">
    </td>
    <td class=DataLabel></td>
    <td class=DataField></td>
    </tr>

<tr><td class=DataLabel>Print Referral Letter to Patient</td>
    <td><input type=checkbox name=prtnewpt 
      title="New Referral to pat" value="1">
      </td>
      <td class=DataLabel>Printer </td>
      <td><select name=prtpsl01 class=SelectBig>
      %STANDARD.01.001.ALLNEWPT.01
      </select></td></tr>

<tr><td class=DataLabel>Print Referral Letter to Referrer</td>
     <td><input type=checkbox name=prtnewrf 
       title="New Referral to pat" value="1">
      </td>
      <td class=DataLabel>Printer </td>
      <td><select name=prtpsl02 class=SelectBig>
      %STANDARD.01.001.ALLNEWRF.01
      </select></td></tr>

<tr><td class=DataLabel>Referral Labels</td>
    <td><input type=checkbox value="1" name=prtreflb width=30% 
     onclick="SetPrinter(InternalReferral.prtpno07,InternalReferral.prtpsl07);">
    Copies
    <select name=prtpno07 width=20%>
        %STANDARD.01.027.2.1
    </select></td>
    <td class=DataLabel>Printer</td>
    <td><select class="SelectBig" name=prtpsl07 title="Printer" width=15%>
        <option></option>
        %STANDARD.01.001.LABELALL.01
        </select></td></tr>

<tr><td colspan=4 align=center><br>
    <input type=button name=formactn value="Add" class="button" id="all02sub"
    onclick="tempDisable(this);AddCombinedReferral();">
    <input type=button Value="Cancel" class="button"
     onclick="DFrameCloseRefresh();"> 
    </td></tr>

</table>
</form>
</div>

<span id="ShowCarerRelHD" style="display:none">
%STANDARD.01.017.lE
</span>

<span id="ShowCarerRel" style="display:none">
  <select title="%STANDARD.01.017.lE" name=alref070 
   class="SelectBig Mandatory">
   <option></option>
   %ALLWEB02.03.140.31.2
   </select>
</span>

<span id="ShowCarerRelBlank" style="display:none">
  <input type="hidden" name="alref070" value=" ">
</span>

<span id="ShowCarerResHD" style="display:none">
%STANDARD.01.017.lI
</span>

<span id="ShowCarerRes" style="display:none">
  <select title="%STANDARD.01.017.lI" name=alref074
   class="SelectBig Mandatory">
  <option></option>
  %ALLWEB02.03.140.35.2
  </select>
</span>

<span id="ShowCarerResBlank" style="display:none">
   <input type="hidden" name="alref074" value=" ">
</span>

<span id="ShowEventProgramLabel" style="display:none">
  Event Program
</span>

<span id="ShowEventProgramField" style="display:none">
  <select class="Mandatory SelectBig" name=alref145 title="Event Program"
   onchange="filterNDISEpsRefCL(InternalReferral);">
  <option></option>
  %ALLWEB02.03.199.016.4
  </select>
</span>

<span id=hcpprov style="display:none">
  <input type=text size=36 maxlength=35
   name=alref116 title="Provider number" class=Mandatory>
</span>

<span id=hcphprov style="display:none">
Provider Number
</span>

<span id=hcpadd1 style="display:none">
  <input type=text size=36 maxlength=35 class=Mandatory
   name=alref109 title="Address 1">
</span>

<span id=hcphadd1 style="display:none">
Referring HCP Address 1
</span>

<span id=hcpaddr style="display:none">
<table border=0 width=100% cellspacing=0 cellpadding=0>

  <tr><td class=DataLabel width=33%>Referring HCP Address 2</td>
      <td><input type=text size=36 maxlength=35
           name=alref110 title="Address 2"><br>
      </td>
  </tr>

  <tr><td class=DataLabel>Referring HCP Suburb</td>
      <td><input type=text size=36 maxlength=35
           name=alref111 onchange="valSurgeryPostCode(InternalReferral);"
           title="Suburb" class=Mandatory><br>
      </td>
  </tr>

  <tr><td class=DataLabel>Referring HCP State</td>
      <td><input type=text size=36 maxlength=35
           name=alref112 title="State" class=Mandatory><br>      
      </td>
  </tr>

  <tr><td class=DataLabel>Referring HCP Postcode</td>
      <td><input type=text size=9 maxlength=8
                     name=alref113 title="Postcode" class=Mandatory>
                     <br>
      </td>
  </tr>

  <tr><td class=DataLabel>Referring HCP Business No</td>
      <td><input type=text size=13 maxlength=12 
                     name=alref114 title="Business Number" class=Mandatory><br>
      </td>
  </tr>

  <tr><td class=DataLabel>Referring HCP Fax No</td>
      <td><input type=text size=13 maxlength=12 
       name=alref115 title="Fax Number"><br>
      </td>
  </tr>
</table>
</span>

<span id=blanklabel style="display:none"></span>

<span id="showtsHeading" style="display:none">
Triage Status
</span>

<span id="showtsField" style="display:none">
<select title="Triage Status" name=alref186 class="Mandatory SelectBig"
 id="alref186" onchange="showPriorityTriage();setEpisodeTriage();">
<option></option>
%ALLWEB02.03.199.066.2
</select>
</span>

<span id="showtdHeading" style="display:none">
Triage Date
</span>

<span id="showtdField" style="display:none">
<input type=text name=alref187 id=alref187 size=12 title="Triage Date"
 value="%ALLWEB02.03.199.067" class="PastDate"
 onblur="checkTriageDate(this);">
<img src=../images/DateTimeStamp.gif class=Icon
 date=MasterReferral.alref187 time=null>
<img src=../images/DateLookup.gif class=Icon date=MasterReferral.alref187>
</span>

<span id="showprHeading" style="display:none">
Priority
</span>

<span id="showprField" style="display:none">
<select class="Mandatory selectBig" name=alref027 id=alref027
 title="Priority" onchange="DefRefPriority();ValidatePriority();">
<option></option>
 %ALLWEB02.03.127.2
</select>
</span>

<span id="showtdHeadingEps" style="display:none">
Triage Date
</span>

<span id="showtdFieldEps" style="display:none">
<input type=text name=alref187 id=alref187eps size=12 title="Triage Date"
 value="%ALLWEB02.03.199.067" class="PastDate"
 onblur="checkTriageDateEpisode(this);">
<img src=../images/DateTimeStamp.gif class=Icon
 date=InternalReferral.alref187 time=null>
<img src=../images/DateLookup.gif class=Icon date=InternalReferral.alref187>
</span>

<span id="showtsHeadingEps" style="display:none">
Triage Status
</span>

<span id="showtsFieldEps" style="display:none">
<select title="Triage Status" name=alref186 class="Mandatory SelectBig"
 id="alref186Eps" onchange="showPriorityTriageEps()">
<option></option>
%ALLWEB02.03.199.066.2
</select>
</span>

<span id="showtdHeadingEps" style="display:none">
Triage Date
</span>

<span id="showtdFieldEps" style="display:none">
<input type=text name=alref187 id=alref187eps size=12 title="Triage Date"
 value="%ALLWEB02.03.199.067" class="PastDate"
 onblur="checkTriageDateEpisode(this);">
<img src=../images/DateTimeStamp.gif class=Icon
 date=InternalReferral.alref187 time=null>
<img src=../images/DateLookup.gif class=Icon date=InternalReferral.alref187>
</span>

<span id="showprHeadingEps" style="display:none">
Priority
</span>

<span id="showprFieldEps" style="display:none">
<select title="Priority" name=alref027 class="Mandatory SelectBig"
 id="alref027Eps">
<option></option>
%ALLWEB02.03.127.2
</select>
</span>


<script type="text/javascript">

//BHS Customisation - TSK 0901084
function setReferralFields(){

  //Referred By
  if(RMReferredByDefault){
    document.InternalReferral.alref022.value="%ALLWEB02.03.484.001";
    document.InternalReferral.n_alref022.value="%ALLWEB02.03.484.081";
  }

  if(RMReferredByMandatory){
    document.InternalReferral.alref022.className="Mandatory";
  }

  //Provider Number
  if(RMProviderNumberDefault){
    document.InternalReferral.hcpprovno.value="%ALLWEB02.03.206";
  }

  //Referred By Practice Code
  if(RMReferredByPracticeDefault){
    document.InternalReferral.alref023.value="%ALLWEB02.03.485.001";
    document.InternalReferral.n_alref023.value="%ALLWEB02.03.485.005";
  }
}
</script>
