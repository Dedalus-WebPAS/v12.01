<meta name="TemplateVersion" content="V12.01.00">
<meta name="TemplateHome" content="standard">
<meta name="CrossBrowser" content="true">
<meta name="HelpFileName" content="NoContextSet.html">

<script type="text/javascript">
function LinkDocument() {
  linkurl="cliweb08.pbl?reportno=01&template=013" +
          "&urnumber=" + document.UpdateForm.urnumber.value.replace(/ /g,"+") +
          "&admissno=" + document.UpdateForm.admissno.value.replace(/ /g,"+") +
          "&corsp017=" + document.UpdateForm.alert001.value.replace(/ /g,"+") +
          "&corsp018=" + document.UpdateForm.alert002.value.replace(/ /g,"+") +
          "&corsp019=" + document.UpdateForm.alert013.value.replace(/ /g,"+") ;
  Left=(document.body.clientWidth-600)/2;
  DFrameLink(linkurl,0,Left,600,300);
}


function CheckDateRules(){

  if(checkAlphanumSpec3NoClear(document.UpdateForm.alcommnt)==false){
     return;
  }
  var start = new Date(document.UpdateForm.alert003.value);
  var middle = new Date(document.UpdateForm.alert008.value);
  var end = new Date(document.UpdateForm.alert011.value);
  var errorString = ""

  if((start>middle)&&(start!=NaN)&&(middle!=NaN)){
      errorString+="Next Review Date cannot be before Date Activated\n";
  }
  if((start>end)&&(start!="")&&(end!="")){
      errorString+="End Date cannot be before Date Activated\n";
  }
  if((middle>end)&&(middle!="")&&(end!="")){
      errorString+="End Date cannot be before Next Review Date\n";
  }

  if(errorString!=""){
     alert("Please fix the following before proceeding:\n"+errorString);
     return false;
  }
  setFormactn('U');
}
function makeEverythingReadOnly() {
  document.getElementById('catedesc').className="Readonly";
  document.getElementById('catedesc').readOnly=true;
  document.getElementById('codedesc').className="Readonly";
  document.getElementById('codedesc').readOnly=true;
  document.getElementById('alert003').className="Readonly";
  document.getElementById('alert003').readOnly=true;
  dateActivatedDIV.innerHTML="";
  document.getElementById('alert008').className="Readonly";
  document.getElementById('alert008').readOnly=true;
  nextreviewdateDIV.innerHTML="";
  document.getElementById('alert011').className="Readonly";
  document.getElementById('alert011').readOnly=true;
  enddateDIV.innerHTML="";
  infectionstatusDIV.innerHTML=infectionstatusSPAN.innerHTML;
  document.getElementById('alert007').className="Readonly";
  document.getElementById('alert007').readOnly=true;
  severitylevelDIV.innerHTML=severitylevelSPAN.innerHTML;
  document.getElementById('alcommnt').className="Readonly";
  document.getElementById('alcommnt').readOnly=true;
  document.getElementById('updtbttn').disabled=true;
  document.getElementById('docobutt').disabled=true;
  document.getElementById('deltbttn').disabled=true;
  document.getElementById('alert012').className="Readonly";
  document.getElementById('alert012').readOnly=true;
  document.getElementById('hcpsicon').disabled=true;
  document.getElementById('hcpeicon').disabled=true;
}
function checkComments() {
  if (document.getElementById('alcdindc').value.substr(11,1)==1) {
     document.getElementById('alcommnt').className="Readonly";
     document.getElementById('alcommnt').readOnly=true;
  }
}
function checkAlertSecLevels() {
  // User's Alert Security Levels for each category
  var alwsindc = document.getElementById('alwsindc').value;

  // Category Security Level Ind2
  var alcdindc = document.getElementById('alcdindc').value.substr(4, 1);

  // User Alert Security Level
  var alusrlvl = document.getElementById('alusrlvl').value;

  // Extract the numeric part of the alert
  var alertValue = document.getElementById('alert001').value;
  var alertNumber = parseInt(alertValue.substr(1, 1));

  var index = alertNumber - 1;

  if (!(trim(alwsindc))) {
    if (alusrlvl < alcdindc) {
      makeEverythingReadOnly();
    }
  } else {
    if (alwsindc.substr(index, 1) < alcdindc) {
      makeEverythingReadOnly();
    }
  }
}
function filterCatwn() {
 filterInd1 = document.getElementById('alert001').value.substr(1,1);  // Ind 1
 p=document.UpdateForm;
 if(p.alert005.readOnly==true) {
   return;
 }
 filterCatCodeList(p.alert005,"1",filterInd1,"2");
}

//TSK 0891498
function checkInfectionStatusInd(indicator){
  var val = indicator.value.substring(28,29);
  if(val == 'S'){
    document.getElementById('alert005').className="Mandatory";
  } else {
    document.getElementById('alert005').className="";
  }
}

function SetComments(){
  var txtComments = document.getElementById("alcommnt");
  var dcom = document.getElementById("d_comment").value;

  var lineLen = txtComments.cols + 0;
  var arr = ArraySplitTextString(dcom,lineLen);

  if (arr == null) return;

  for (i=0; i < arr.length; i++) {
    if (i < (arr.length-1) && trim(arr[i]).length == lineLen) {
      txtComments.value += arr[i] + " ";  // append space to separate words
    }
    else {
      txtComments.value += arr[i];
    }
  }

  // compress spaces
  txtComments.value = txtComments.value.replace(/\s\s+/g,' ');
}

</script>

%START.OF.PAGE
</HEAD>
<body onload="PageLoad(event);checkAlertSecLevels();checkComments();
              filterCatwn();SetComments();
              checkInfectionStatusInd(document.getElementById('alcdindc'));">

<span class=DFrameTitleBar>
  <img align="right" alt="Exit" class="MenuIcon" 
   src="../images/ExitIcon.gif" onclick="DFrameExit();">
  Update Alert
</span>

<form name=UpdateForm method=post action=cliweb01.pbl style="margin:0">
  <input type=hidden name=reportno value="1">
  <input type=hidden name=template value="002">
  <input type=hidden name=updttype value="A">
  <input type=hidden name=urnumber value="%CLIWEB01.01.003">
  <input type=hidden name=admissno value="%CLIWEB01.01.081">
  <input type=hidden name=alert001 id=alert001 value="%CLIWEB01.01.107">
  <input type=hidden name=alert002 id=alert002 value="%CLIWEB01.01.101.1">
  <input type=hidden name=alert013 id=alert013 value="%CLIWEB01.01.132">
  <input type=hidden name=nextpage value="5">
  <input type=hidden name=alcdindc id=alcdindc value="%CLIWEB01.01.101.3">
  <input type=hidden name=alwsindc id=alwsindc value="%CLIWEB01.01.134">
  <input type=hidden name=alusrlvl id=alusrlvl value="%CLIWEB01.01.147">
  <input type=hidden name=d_comment id=d_comment value="%CLIWEB01.01.111">

<table align=center cellspacing=2 cellpadding=1 width=90% border=0>
  <tr>
    <td class=DataLabel>Alert Category</td>
    <td>
      <input type=text name=catedesc id=catedesc size=30 readonly 
       value="%CLIWEB01.01.108">
    </td>
  </tr>

  <tr>
    <td class=DataLabel>Alert</td>
    <td>
      <input type=text name=codedesc size=30 readonly 
       id=codedesc value="%CLIWEB01.01.101.0">
    </td>
  </tr>

<tr><td class=DataLabel>Alert Requested By</td>
    <td colspan=3><input type=text name=alert012 id=alert012 size=10 maxlength=8
        title="Alert Requested By"
        value="%CLIWEB01.01.123"
        onchange="ValidateHCP(18,12,alert012,d_alert012);">
       <input type=text size=35 name=d_alert012 id=d_alert012
        value="%CLIWEB01.01.130" class=Readonly readonly>
    <img src=../images/SearchIcon.gif class=Icon name=hcpsicon id=hcpsicon
     onclick="HCPSearchFrame(alert012,d_alert012,7);">
    <img src="../images/ClearIcon.gif" class=Icon name=hcpeicon id=hcpeicon
     onclick="clrFields(alert012,d_alert012);">
    </td></tr>

  <tr>
    <td class=DataLabel>Date Activated</td>
    <td>
      <table cellspacing=0 cellpadding=0 border=0>
      <tr><td>
      <input type=text name=alert003 id=alert003 size=12 maxlength=12 
       class="Mandatory PastDate"
       value="%CLIWEB01.01.102" title="Date Activated">
      </td>
      <td>
      <div id=dateActivatedDIV>
      <img src=../images/DateTimeStamp.gif class=Icon border=0 hspace=4
       align=absmiddle onclick="SetCurrentDateTime(UpdateForm.alert003,null);">
      <img src=../images/DateLookup.gif class=Icon border=0 hspace=4
       align=absmiddle onclick="DateLookupFrame(UpdateForm.alert003);">
      </div>
      </td></tr>
      </table>
    </td>
  </tr>

  <tr>
    <td class=DataLabel>Next Review Date</td>
    <td>
      <table cellspacing=0 cellpadding=0 border=0>
      <tr><td>
      <input type=text name=alert008 id=alert008
       size=12 maxlength=12 class="Date"
       value="%CLIWEB01.01.112" title="Next Review Date">
      </td>
      <td>
      <div id=nextreviewdateDIV>
      <img src=../images/DateTimeStamp.gif class=Icon border=0 hspace=4
       align=absmiddle onclick="SetCurrentDateTime(UpdateForm.alert008,null);">
      <img src=../images/DateLookup.gif class=Icon border=0 hspace=4
       align=absmiddle onclick="DateLookupFrame(UpdateForm.alert008);">
      </div>
      </td></tr>
      </table>
    </td>
  </tr>

  <tr>
    <td class=DataLabel>End Date</td>
    <td>
      <table cellspacing=0 cellpadding=0 border=0>
      <tr><td>
      <input type=text name=alert011 id=alert011 size=12 maxlength=12
       value="%CLIWEB01.01.122" title="End Date" class="PastDate">
      </td>
      <td>
      <div id=enddateDIV>
      <img src=../images/DateTimeStamp.gif class=Icon border=0 hspace=4
       align=absmiddle onclick="SetCurrentDateTime(UpdateForm.alert011,null);">
      <img src=../images/DateLookup.gif class=Icon border=0 hspace=4
       align=absmiddle onclick="DateLookupFrame(UpdateForm.alert011);">
      </div>
      </td></tr>
      </table>
    </td>
  </tr>

  <tr>
    <td class=DataLabel>%STANDARD.01.017.wn</td>
    <td>
      <div id=infectionstatusDIV>
      <select name=alert005 id=alert005 title="%STANDARD.01.017.wn">
        <option></option>
        %CLIWEB01.01.104.2
      </select>
      </div>
    </td>
  </tr>

  <tr>
    <td class=DataLabel>Site</td>
    <td>
      <input type=text name=alert007 id=alert007 size=20 maxlength=20
       value="%CLIWEB01.01.106">
    </td>
  </tr>

  <tr valign=top>
    <td class=DataLabel>Severity Level</td>
    <td>
      <div id=severitylevelDIV>
      <select name=alert006 id=alert006>
        <option value="0">0</option>
        <option value="1">1</option>
        <option value="2">2</option>
        <option value="3">3</option>
        <option value="4">4</option>
        <option value="5">5</option>
        <option value="6">6</option>
        <option value="7">7</option>
        <option value="8">8</option>
        <option value="9">9</option>
      </select>
      </div>
    </td>
  </tr>

  %CLIWEB01.01.115
 
  <tr>
    <td colspan=2 class=DataLabel>Reaction Comment/lab. No</td>
  </tr>

<tr><td colspan=2 align=center>
<textarea wrap=hard name=alcommnt id=alcommnt rows=4 cols=70 title=Comment></textarea></td>
  </tr>

  <tr>
    <td colspan=2 align=center>
      <br>
      <input type=button value="Update" class="button" id=updtbttn 
       onclick="CheckDateRules();">
      <input type=button value="Link Document" class="button" name=docobutt
       onclick="LinkDocument();" id=docobutt>
      <input type=button value="Delete" class="button" 
       onclick="setFormactn('D');" id=deltbttn>
      <input type=button value="Cancel" class="button" 
       onclick="DFrameClose();">
    </td>
  </tr>

</table>
</form>

<script type="text/javascript">
for(var i =0 ; i < document.UpdateForm.alert006.length; i++){
    if(document.UpdateForm.alert006.options[i].value=="%CLIWEB01.01.105"){
       document.UpdateForm.alert006.selectedIndex=i;
    }
}
if("%CLIWEB01.01.114"=="1"){
   document.UpdateForm.docobutt.disabled=true;
}
</script>

<span id=infectionstatusSPAN style="display: none">
<input type=text name=alert005 id=alert005 size=20 maxlength=20
 value="%CLIWEB01.01.104.0" class=Readonly readOnly>
</span>

<span id=severitylevelSPAN style="display: none">
<input type=text name=alert006 id=alert006 size=20 maxlength=20
 value="%CLIWEB01.01.105" class=Readonly readOnly>
</span>
