<meta name="TemplateVersion" content="V12.01.00">
<meta name="TemplateHome" content="standard">
<meta name="HelpFileName" content="NoContextSet.html">
<meta name="CrossBrowser" content="true">
<script type="text/javascript" src="../js/allweb0202007.js"></script>
</head>
%START.OF.PAGE
<body onload="PageLoad(event); checkPriority(); ">

<span class=DFrameTitleBar>
<img class=MenuIcon border=0 align=right src="../images/ExitIcon.gif" 
     onclick="DFrameExit();">
<script language=javascript>
    document.write("Cancel a Referral");
</script>
<script type="text/javascript">
  function ValidateData() {
    if(UpdateForm.alref011.value.indexOf(" ") == 0) {
      alert("Can't have space at the first place");
    }
    if(validateMandatory(UpdateForm)) {
      if(UpdateForm.dept.value == "") {
        alert("Department can't be empty");
      }
      else {
        if(UpdateForm.admissno.value == "        ") {
           alert("Visit/Referral Number is blank");
        }
        else {
          if(CheckFutureBookings(UpdateForm.admissno,UpdateForm.alref011,
                                 UpdateForm.alref012)){
            UpdateForm.updatety.value="N"
            UpdateForm.submit();
          }
        }
      }
    }
  }
</script>
</span>
<form name=UpdateForm action="allweb02.pbl" method=post>
<input type=hidden name=reportno value="2">
<input type=hidden name=template value="007">
<input type=hidden name=urnumber value="%ALLWEB02.02.003">
<input type=hidden name=admissno value="%ALLWEB02.02.081">
<input type=hidden name=updatety value="">
<input type=hidden name=alref036 value="">
<input type=hidden name=alref080 value="">
<input type=hidden name=alref081 value="">
<input type=hidden name=alref082 value="">
<input type=hidden name=alref083 value="">
<input type=hidden name=deptcode value="%ALLWEB02.02.125.1">
<input type=hidden name=deptindc value="%ALLWEB02.02.125.3">
<input type=hidden name=alref134 value="">
<input type=hidden name=alref138 value="">
<input type=hidden name=alref147 value="">
<input type=hidden name=alref148 value="">
<input type=hidden name=alref149 value="">

<input type=hidden name=d_alref027_code value="%ALLWEB02.02.127.3">
<input type=hidden name=d_alref027_desc value="%ALLWEB02.02.127.0">

<table align=center cellspacing=0 cellpadding=1 border=0 width=95%>
<tr><td class=DataLabel>Department</td>
    <td><input readonly type=text name=dept value="%ALLWEB02.02.125.0" 
               class=Readonly>
    </td>
    <td class=DataLabel>Entered by</td>
    <td><input readonly type=text value="%ALLWEB02.02.163" 
               class=Readonly>
        <input type=hidden name="d_wbsehosp" value="%STANDARD.01.032">
    </td>
</tr>

<tr><td class=DataLabel>Date Cancelled</td>
    <td class=DataLabel>
    <input type=text id=alref011 name=alref011 value="%ALLWEB02.02.111" 
               title="Date Cancelled" class="PastDate Mandatory">
      <img src="../images/DateLookup.gif" class=Icon 
               align=absmiddle onclick="DateLookupFrame(UpdateForm.alref011);">
      Time
      <input type=text size=8 value="%ALLWEB02.02.112" title="Time Cancelled"
               class="Mandatory Time" id=alref012 name=alref012>
      <img src=../images/DateTimeStamp.gif class=Icon 
               onclick="SetCurrentDateTime(UpdateForm.alref011,UpdateForm.alref012);">
      <img src=../images/TimeLookup.gif class=Icon 
               onclick="TimeLookupFrame(UpdateForm.alref012);">
  </td>
</tr>

<tr><td class=DataLabel>Reason for Cancellation</td>
    <td><select class=Mandatory name=alref010 title="Reason for Cancellation">
        <option></option>
        %ALLWEB02.02.110.2
        </select>
    </td>
</tr>

<tr><td class=DataLabel>Comment</td>
    <td class-DataLabel>
      <input type=text name=commenty size=51 maxlength=50
       id=commenty value="%ALLWEB02.02.270">
    </td>
</tr>

<tr><td colspan=4 align=center><br>
    <input type=button id=okbutton name=okbutton value="OK" class="button"
     onclick="tempDisable(this); ValidateData();">
    <input type=button Value="Cancel" class="button" 
             onclick="DFrameClose();">
    </td>
</tr>
</table>
</form>
<script type="text/javascript">
//
 BulkBill="%ALLWEB02.02.136";
 if ( BulkBill == "Yes") {
   document.UpdateForm.alref036.value=1;
 }

 ALREUserDefYN1="%ALLWEB02.02.141";
 if ( ALREUserDefYN1 == "Yes") {
   document.UpdateForm.alref080.value=1;
 } else {
   document.UpdateForm.alref080.value=0;
 }
 ALREUserDefYN2="%ALLWEB02.02.142";
 if ( ALREUserDefYN2 == "Yes") {
   document.UpdateForm.alref081.value=1;
 } else {
   document.UpdateForm.alref081.value=0;
 }
 ALREUserDefYN3="%ALLWEB02.02.143";
 if ( ALREUserDefYN3 == "Yes") {
   document.UpdateForm.alref082.value=1;
 } else {
   document.UpdateForm.alref082.value=0;
 }

 SACSRef="%ALLWEB02.02.144";
 if ( SACSRef == "Yes") {
   document.UpdateForm.alref083.value=1;
 } else {
   document.UpdateForm.alref083.value=0;
 }

 ALREUserDefYN5="%ALLWEB02.02.199.005";
 if ( ALREUserDefYN5 == "Yes") {
   document.UpdateForm.alref134.value=1;
 } else {
   document.UpdateForm.alref134.value=0;
 }
 ALREUserDefYN6="%ALLWEB02.02.199.009";
 if ( ALREUserDefYN6 == "Yes") {
   document.UpdateForm.alref138.value=1;
 } else {
   document.UpdateForm.alref138.value=0;
 }
 ALREUserDefYN7="%ALLWEB02.02.199.019";
 if ( ALREUserDefYN7 == "Yes") {
   document.UpdateForm.alref147.value=1;
 } else {
   document.UpdateForm.alref147.value=0;
 }
 ALREUserDefYN8="%ALLWEB02.02.199.020";
 if ( ALREUserDefYN8 == "Yes") {
   document.UpdateForm.alref148.value=1;
 } else {
   document.UpdateForm.alref148.value=0;
 }
 ALREUserDefYN9="%ALLWEB02.02.199.021";
 if ( ALREUserDefYN9 == "Yes") {
   document.UpdateForm.alref149.value=1;
 } else {
   document.UpdateForm.alref149.value=0;
 }

 Status="%ALLWEB02.02.103"
 if (Status=="Cancelled "){
    document.UpdateForm.okbutton.disabled=true;
 } else {
    document.UpdateForm.alref011.value="%STANDARD.01.015"
    document.UpdateForm.alref012.value="%STANDARD.01.016"
 }

 if (!isWhitespace(document.getElementById('commenty').value)) {
   document.getElementById('commenty').readOnly=true;
   document.getElementById('commenty').className='readOnly';
 }

function checkPriority() {
var p = document.UpdateForm;

var indc3 = p.deptindc.value.substr(5,1);
var indc4 = p.deptindc.value.substr(6,1);
var bIsMH = (indc3 == "A" && indc4 == "M") ? true : false;

var rejGenRef = ( p.d_alref027_code.value.substr(13,1) == "G") ? true : false;
var rejMenHlt = ( p.d_alref027_code.value.substr(13,1) == "M") ? true : false;
var rejGenMen = ( p.d_alref027_code.value.substr(13,1) == "A") ? true : false;

if (rejMenHlt && bIsMH) {  // Mental Health Referral
  // Remove Mental Health codes
 alert("Referral Priority Code = " +  trim(p.d_alref027_desc.value) +
            "\nPlease change priority before cancelling the referral");
 document.UpdateForm.okbutton.disabled = true;
    }
else if (rejGenRef && !bIsMH) {  // General Referral
  // Remove General codes
 alert("Referral Priority Code = " +  trim(p.d_alref027_desc.value) +
            "\nPlease change priority before cancelling the referral");
 document.UpdateForm.okbutton.disabled = true;
  }
else if (rejGenMen) {  // General or Mental
  // Remove Mental Health OR General codes
 alert("Referral Priority Code = " +  trim(p.d_alref027_desc.value) +
            "\nPlease change priority before cancelling the referral");
 document.UpdateForm.okbutton.disabled = true;
  }
}

</script>

