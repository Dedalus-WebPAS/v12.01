<meta name="TemplateVersion" content="V12.01.00">
<meta name="TemplateHome" content="standard">
<meta name="HelpFileName" content="NoContextSet.html">
<meta name="CrossBrowser" content="true">
%START.OF.PAGE
<script type="text/javascript">
function updateParent(code,name,date,vist,clintcd,clint,clinind,clindict,hic,
                      carer,letdays,nmds,caret,servd,hrisk,isOverBooked,tier,
                      mandref,msttier,defproc) { 
   var clindate = code.substr(12,8);
    var FollowEdit=document.getElementById("otcnfoll").value;
    if(parent.parent.document.getElementById("d_followdt") && FollowEdit !=0) {
      var bookin_date=parent.parent.document.getElementById("d_followdt").value;
      if(SetDateYYYYMMDD(bookin_date) > clindate) {
        if(FollowEdit==1) {
          if(!confirm("Warning: Follow up date selected is prior to the " +
                "date of the original booking. \nPress CANCEL to " +
                "select another date.")) {
            return;
          }
        }
        if(FollowEdit==2) {
          alert("Error Message: Follow up date selected is prior to the " +
                "date of the original booking. \nPlease select another " +
                "date.");
          return;
        }
      }
    }

    var vis  = ""+vist;
    pp = parent.parent;
    parent.parent.ReturnCode.value=code
    parent.parent.ReturnName.value=name
    parent.parent.ReturnDate.value=date
    parent.parent.document.getElementById('PopUpScreen').style.display="none"
    site="%STANDARD.01.023";
    if(parent.parent.UpdateContractCodes != undefined) {
      parent.parent.UpdateContractCodes(clintcd,site);
    }
    
    //go to the server for a new set of clinic list that
    //are overbooked
    var clinicVisitList = null;

    if(typeof parent.parent.UpdateForm != 'undefined') {
      clinicVisitList = parent.parent.UpdateForm.outbb047;
    }else if( parent.parent.AddForm ){
      clinicVisitList = parent.parent.AddForm.outbb047;
    }

    if(clinicVisitList != null) {
      var serverURL = "../cgi-bin/comweb80.pbl?reportno=61&valdcode=CV" +
                      "&valdsite=" + site.replace(/ /g,"+") +
                      "&valdctyp=" + clintcd.replace(/ /g,"+")
      var data = RSExecute(serverURL);
      if(typeof data  != 'undefined'){
       if(data != null) {
        patcodes = eval("("+data.return_value+")");
        //if we get this far lets recreate the clinic visit list

        clinicVisitList.innerHTML = "";
        var option = parent.parent.document.createElement('option');
        option.value = "                 ";
        option.innerHTML = "             ";
        clinicVisitList.appendChild(option);

        if(isOverBooked == "Z") {
          for(var i = 0; i < patcodes.length; i++) {
            if(typeof patcodes[i] != "undefined" && patcodes[i] != null) {
              if( patcodes[i].indicators.substring(2,1) == isOverBooked ) {
                if( trim(patcodes[i].indicators.substring(6,1)) != "U" ) {
                  var option = parent.parent.document.createElement('option');
                  option.value = patcodes[i].acode+patcodes[i].indicators;
                  option.innerHTML = patcodes[i].tdesc;
                  clinicVisitList.appendChild(option);
                }
              }
            }
          }
        }else {
          for(var i = 0; i < patcodes.length; i++) {
            if(typeof patcodes[i] != "undefined" && patcodes[i] != null) {
              if( trim(patcodes[i].indicators.substring(6,1)) != "U" ) {
                var option = parent.parent.document.createElement('option');
                option.value = patcodes[i].acode+patcodes[i].indicators;
                option.innerHTML = patcodes[i].tdesc;
                clinicVisitList.appendChild(option);
              }
            }
          }
        }
      }
     }
   }
var sendLetter = null;
if(typeof parent.parent.AddForm != 'undefined') {
  sendLetter = parent.parent.AddForm.outbb047;
}else if( parent.parent.UpdateForm ) {
  sendLetter = parent.parent.UpdateForm.outbb047;
}

if(sendLetter != null && typeof sendLetter.onchange != 'undefined') {
 if(sendLetter.onchange.toString().indexOf('onchangeHandler') == "-1") {
   setTimeout(function(){ sendLetter.onchange();},200);
 }
}

//visit type

if (typeof(parent.parent.AddForm)=='object' && 
    parent.parent.AddForm.outbb047.type=='select-one') {
   for (var i =0 ; i < parent.parent.AddForm.outbb047.length; i++) {
     if (trim(parent.parent.AddForm.outbb047.options[i].value.substr(0,3))==trim(vis)) {
       parent.parent.AddForm.outbb047.selectedIndex=i }
     }
}

//visit type

if (typeof(parent.parent.UpdateForm)=='object' 
    && typeof(parent.parent.UpdateForm.outbb047)=='object') {
     for (var i =0 ; i < parent.parent.UpdateForm.outbb047.length; i++) {
     if (trim(parent.parent.UpdateForm.outbb047.options[i].value.substr(0,3))==trim(vis)) {
       parent.parent.UpdateForm.outbb047.selectedIndex=i }
     }
    }

//clinic type
// Added for diagnosis search
if (typeof(parent.parent.AddForm)=='object' && 
   typeof(parent.parent.AddForm.defclnty)=='object') {
       parent.parent.AddForm.defclnty.value=clintcd;
    }
if (typeof(parent.parent.AddForm)=='object' && 
   typeof(parent.parent.AddForm.outbb016)=='object') {
       parent.parent.AddForm.outbb016.value=clintcd;
    }
if (typeof(parent.parent.UpdateForm)=='object' &&
   typeof(parent.parent.UpdateForm.defclnty)=='object' &&
   typeof(parent.parent.UpdateForm.follflag)=='object') {
     parent.parent.UpdateForm.defclnty.value=clintcd;
   }
if (typeof(parent.parent.UpdateForm)=='object' &&
   typeof(parent.parent.UpdateForm.outbb016)=='object' &&
   typeof(parent.parent.UpdateForm.follflag)=='object') {
     parent.parent.UpdateForm.outbb016.value=clintcd;
    }

//Clinic Indicator
if (typeof(parent.parent.AddForm)=='object' && 
   typeof(parent.parent.AddForm.clinindc)=='object') {
       parent.parent.AddForm.clinindc.value=clindict;
    }

//Clinic using medclaims
if (typeof(parent.parent.AddForm)=='object' && 
   typeof(parent.parent.AddForm.otmaumci)=='object') {
       parent.parent.AddForm.otmaumci.value=hic;
    }

//Collect Carer Details
if (typeof(parent.parent.AddForm)=='object' && 
   typeof(parent.parent.AddForm.otheccar)=='object') {
       parent.parent.AddForm.otheccar.value=carer;
    }

//New Slot key
if (typeof(parent.parent.AddForm)=='object' && 
   typeof(parent.parent.AddForm.nslotkey)=='object') {
       parent.parent.AddForm.nslotkey.value=code;
    }

//Generate letter days AddForm
if (typeof(parent.parent.AddForm)=='object' && 
   typeof(parent.parent.AddForm.othendps)=='object') {
       parent.parent.AddForm.othendps.value=letdays;
    }

// NMDS Code AddForm
if (typeof(parent.parent.AddForm)=='object' && 
   typeof(parent.parent.AddForm.outbb068)=='object') {
     for (var i =0 ; i < parent.parent.AddForm.outbb068.length; i++) {
     if (trim(parent.parent.AddForm.outbb068.options[i].value.substr(0,3))==
         trim(nmds)) {
         parent.parent.AddForm.outbb068.selectedIndex=i }
     }
    }

if (typeof(parent.parent.UpdateForm)=='object' &&
   typeof(parent.parent.UpdateForm.clapindc)=='object' &&
   typeof(parent.parent.UpdateForm.outbb068)=='object') {
     for (var i =0 ; i < parent.parent.UpdateForm.outbb068.length; i++) {
     if (trim(parent.parent.UpdateForm.outbb068.options[i].value.substr(0,3))==
         trim(nmds)) {
         parent.parent.UpdateForm.outbb068.selectedIndex=i }
     }
    }

// Mandatory referral
if (typeof(parent.parent.AddForm)=='object' &&
   typeof(parent.parent.AddForm.othemref)=='object') {
   parent.parent.AddForm.othemref.value=mandref;
}

// Tier 2 Code AddForm
if (typeof(parent.parent.AddForm)=='object' &&
   typeof(parent.parent.AddForm.outbb072)=='object') {
     for (var i =0 ; i < parent.parent.AddForm.outbb072.length; i++) {
     if (trim(parent.parent.AddForm.outbb072.options[i].value.substr(0,3))==
         trim(tier)) {
         parent.parent.AddForm.outbb072.selectedIndex=i }
     }
    }
// Tier 2 Code AddForm
if (typeof(parent.parent.AddForm)=='object' &&
   typeof(parent.parent.AddForm.outbb072)=='object') {
   if(parent.parent.AddForm.outbb072.type=="hidden") {
     parent.parent.AddForm.outbb072.value=trim(tier);
   }
}
// Tier 2 Code UpdateForm
if (typeof(parent.parent.UpdateForm)=='object' &&
   typeof(parent.parent.UpdateForm.outbb072)=='object') {
   if(parent.parent.UpdateForm.outbb072.type=="hidden") {
     parent.parent.UpdateForm.outbb072.value=trim(tier);
   }
}
if (typeof(parent.parent.UpdateForm)=='object' &&
   typeof(parent.parent.UpdateForm.clapindc)=='object' &&
   typeof(parent.parent.UpdateForm.outbb072)=='object') {
     for (var i =0 ; i < parent.parent.UpdateForm.outbb072.length; i++) {
     if (trim(parent.parent.UpdateForm.outbb072.options[i].value.substr(0,3))==
         trim(tier)) {
         parent.parent.UpdateForm.outbb072.selectedIndex=i }
     }
    }
// Tier 2 Code AddForm from MasterClinic- New Appointment
    if (typeof(parent.parent.AddForm)=='object' &&
        typeof(parent.parent.AddForm.d_otmatcod)=='object' &&
        typeof(parent.parent.AddForm.outbb072)=='object') {
        if(parent.parent.AddForm.outbb072.type=="hidden" &&
           parent.parent.AddForm.outbb072.value=="") {
            parent.parent.AddForm.outbb072.value=trim(msttier);
       }
    }
    // Tier 2 Code Addform from SlotTemplate - New Appointment
    if (typeof(parent.parent.AddForm)=='object' &&
       typeof(parent.parent.AddForm.outbb072)=='object') {
       if(parent.parent.AddForm.outbb072.type=="hidden" &&
          tier.value!=undefined) {
         parent.parent.AddForm.outbb072.value=trim(tier);
       }
    }
// Tier 2 Code UpdateForm from MasterClinic- Follow-up Appointment
    if (typeof(parent.parent.UpdateForm)=='object' &&
        typeof(parent.parent.UpdateForm.d_otmatcod)=='object' &&
        typeof(parent.parent.UpdateForm.outbb072)=='object') {
        if(parent.parent.UpdateForm.outbb072.type=="hidden" &&
           parent.parent.UpdateForm.outbb072.value=="") {
            parent.parent.UpdateForm.outbb072.value=trim(msttier);
       }
    }
    // Tier 2 Code Addform from SlotTemplate - Follow-up Appointment
    if (typeof(parent.parent.UpdateForm)=='object' &&
       typeof(parent.parent.UpdateForm.outbb072)=='object') {
       if(parent.parent.UpdateForm.outbb072.type=="hidden" &&
          tier.value!=undefined) {
         parent.parent.UpdateForm.outbb072.value=trim(tier);
       }
    }


// Care Type AddForm
if (typeof(parent.parent.AddForm)=='object' && 
   typeof(parent.parent.AddForm.outbb069)=='object') {
     for (var i =0 ; i < parent.parent.AddForm.outbb069.length; i++) {
     if (trim(parent.parent.AddForm.outbb069.options[i].value.substr(0,3))==
         trim(caret)) {
         parent.parent.AddForm.outbb069.selectedIndex=i }
     }
    }

if (typeof(parent.parent.UpdateForm)=='object' &&
   typeof(parent.parent.UpdateForm.clapindc)=='object' &&
   typeof(parent.parent.UpdateForm.outbb069)=='object') {
     for (var i =0 ; i < parent.parent.UpdateForm.outbb069.length; i++) {
     if (trim(parent.parent.UpdateForm.outbb069.options[i].value.substr(0,3))==
         trim(caret)) {
         parent.parent.UpdateForm.outbb069.selectedIndex=i }
     }
    }

// Service Delivery AddForm
if (parent.parent.document.getElementById('d_notbb070')==null) {
  if (typeof(parent.parent.AddForm)=='object' &&
     typeof(parent.parent.AddForm.outbb070)=='object') {
       for (var i =0 ; i < parent.parent.AddForm.outbb070.length; i++) {
       if (trim(parent.parent.AddForm.outbb070.options[i].value.substr(0,3))==
           trim(servd)) {
           parent.parent.AddForm.outbb070.selectedIndex=i }
       }
  }
}

if (typeof(parent.parent.UpdateForm)=='object' &&
   typeof(parent.parent.UpdateForm.clapindc)=='object' &&
   typeof(parent.parent.UpdateForm.outbb070)=='object') {
     for (var i =0 ; i < parent.parent.UpdateForm.outbb070.length; i++) {
     if (trim(parent.parent.UpdateForm.outbb070.options[i].value.substr(0,3))==
         trim(servd)) {
         parent.parent.UpdateForm.outbb070.selectedIndex=i }
     }
    }

// Clinical High Risk AddForm
if (typeof(parent.parent.AddForm)=='object' && 
   typeof(parent.parent.AddForm.d_outbb071)=='object') {
       if(hrisk=="1") {
         parent.parent.AddForm.d_outbb071.checked=true;
         parent.parent.AddForm.d_outbb071.disabled=true;
       } else {
         parent.parent.AddForm.d_outbb071.checked=false;
         parent.parent.AddForm.d_outbb071.disabled=false;
       }
    }
// Clinical High Risk UpdateForm
if (typeof(parent.parent.UpdateForm)=='object' &&
   typeof(parent.parent.UpdateForm.outbb071)=='object') {
       if(hrisk=="1") {
         parent.parent.UpdateForm.outbb071.checked=true;
         parent.parent.UpdateForm.outbb071.disabled=true;
       } else {
         parent.parent.UpdateForm.outbb071.disabled=false;
       }
    }

//Generate letter days UpdateForm
if (typeof(parent.parent.UpdateForm)=='object' && 
   typeof(parent.parent.UpdateForm.othendps)=='object') {
       parent.parent.UpdateForm.othendps.value=letdays;
    }
//Generate letter days UpdateForm

if (typeof(parent.parent.Reschedule)=='object' && 
   typeof(parent.parent.Reschedule.othendps)=='object') {
       parent.parent.Reschedule.othendps.value=letdays;
    }

//Dummy hidden field for visit type AddForm
if (typeof(parent.parent.AddForm)=='object' && 
   typeof(parent.parent.AddForm.d_outbb047)=='object') {
       parent.parent.AddForm.d_outbb047.value=trim(vis);
    }
//Dummy hidden field for visit type UpdateForm
if (typeof(parent.parent.UpdateForm)=='object' && 
   typeof(parent.parent.UpdateForm.d_outbb047)=='object') {
       parent.parent.UpdateForm.d_outbb047.value=trim(vis);
       if(typeof(parent.parent.SendLetterDNA03)== 'function'){
         parent.parent.SendLetterDNA03();
       }
    }

//Dummy hidden field for default procedure  AddForm
if (document.HiddenFields.ptcnhdps.value == "1" &&
   typeof(parent.parent.AddForm)=='object' && 
   typeof(parent.parent.AddForm.otprc002)=='object') {
       if(isWhitespace(parent.parent.AddForm.otprc002.value)) {
         parent.parent.AddForm.otprc002.value=trim(defproc);
         valCtypeProcedure(parent.parent.AddForm.defclnty,
                           parent.parent.AddForm.otprc002,
                           parent.parent.AddForm.otprc003);
       }
    }
//Dummy hidden field for default procedure UpdateForm
if (document.HiddenFields.ptcnhdps.value == "1" &&
   typeof(parent.parent.UpdateForm)=='object' && 
   typeof(parent.parent.UpdateForm.otprc002)=='object') {
       if(isWhitespace(parent.parent.UpdateForm.otprc002.value)) {
         parent.parent.UpdateForm.otprc002.value=trim(defproc);
         valCtypeProcedure(parent.parent.UpdateForm.defclnty,
                           parent.parent.UpdateForm.otprc002,
                           parent.parent.UpdateForm.otprc003);
       }
    }

if (typeof(parent.parent.ReturnFunction) == 'function'){
   parent.parent.ReturnFunction() }

if (parent.parent.FilterMentalHealth != undefined) {
  parent.parent.FilterMentalHealth(code);
}

}
function RescheduleHR(highr) {
// Clinical High Risk UpdateForm
if (typeof(parent.parent.UpdateForm)=='object' &&
   typeof(parent.parent.UpdateForm.d_outbb071)=='object') {
       if(highr=="1") {
         parent.parent.UpdateForm.d_outbb071.checked=true;
         parent.parent.UpdateForm.d_outbb071.disabled=true;
       } else {
         parent.parent.UpdateForm.d_outbb071.disabled=false;
       }
    }
}
</script>
</head>
<body onload="PageLoad(event);">
<table cellspacing=0 cellpadding=2 width=100% border=1>
<tr><td class=HeadingCell>Date </td>
    <td align=center class=HeadingCell>Time</td>
    <td class=HeadingCell>Visit Type</td>
    <td class=HeadingCell>Clinic Type</td>
    <td class=HeadingCell>Clinic</td>
    <td class=HeadingCell>Location</td></tr>
%OUTWEB01.02.008
</table>
<table cellspacing=0 cellpadding=0 width=100% bgcolor=#CCCCCC>
<tr><td align=center>
<input type=button class="button" value="Previous"
onclick='location.href="%OUTWEB01.02.002"'>
<input type=button class="button" value="Next"
onclick='location.href="%OUTWEB01.02.001"'>
</table>

<form name=HiddenFields style="margin:0">
<input type=hidden name=d_otmatcod value="">
<input type=hidden name=otcnfoll id=otcnfoll
 value="%STANDARD.01.025.032.147.0.1">
<input type=hidden name=ptcnhdps id=ptcnhdps
 value="%STANDARD.01.025.080.250.1.1">
</form>
