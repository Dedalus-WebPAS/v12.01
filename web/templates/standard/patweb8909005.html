<meta name="TemplateVersion" content="V12.01.00">
<meta name="TemplateHome" content="standard">
<meta name="HelpFileName" content="NoContextSet.html">
<meta name="CrossBrowser" content="true">
<script type="text/javascript">
function setFullDesc() {
  document.AddForm.nzspr010.value=document.AddForm.mbsdesc1.value;
}
function RefreshSubmit() {
  p=document.AddForm
  if(p.nzspr002.value.substr(9,1)==" "&& document.AddForm.nzspr006.value!=""){
    alert("No Contract can be assigned.")
    return;
  }

  if (document.getElementById("d_nzspr013").checked==true) {
     document.getElementById("nzspr013").value="1";
  } else {
     document.getElementById("nzspr013").value="0";
     //document.UpdateForm.nzspr014.disabled=false;
     //document.UpdateForm.nzspr015.disabled=false;
  }

  if (document.getElementById("d_nzspr016").checked==true) {
     document.getElementById("nzspr016").value="1";
  } else {
     document.getElementById("nzspr016").value="0";
  }

  if(document.AddForm.d_nzspr012.checked==true){
     document.AddForm.nzspr012.value="2"}
  else {
     document.AddForm.nzspr012.value="1"}
  document.AddForm.redirect.value+="&uniqueky="+
           document.AddForm.uniqueky.value.replace(/ /g,"+");
  if(document.AddForm.nzspr007.value!=""|
    (p.nzspr002.value.substr(9,1)!="F" && p.nzspr002.value.substr(9,1)!="P")){
    if (validateMandatory(AddForm)) {
      SubmitHiddenNew(AddForm);
      return;
    } else {return;}
  }
  validateContract(p.nzspr002,p.nzspr004,p.nzspr003,p.nzspr006,p.nzhosp,p.dummy,p.nzadat,p.retcount,p.retcontr,p.retcdesc);
    if(p.retcount.value==0){
       alert("No Contract Procedure Code can be assigned.");
       return;
    }
    if(p.retcount.value==1){
      ans=confirm("Assigned Contract Procedure Code is : " + p.retcontr.value +
              "\n" + p.retcdesc.value + "\nClick OK to accept or cancel " +
              "to change contract details.")
      if(ans==true){
         document.AddForm.nzspr007.value=p.retcontr.value;
         RefreshSubmit();
      } else {
         document.AddForm.nzspr007.value="";
         return;}
    }
    if(p.retcount.value>1){
      ans=confirm("More than one Contract Procedure Code can be assigned." +
              "\nClick OK to Review or cancel " +
              "to change contract details.")
      if(ans==true){
        ContractProcedureCodeSearchFrame(p.nzspr002,p.nzspr004,p.nzspr003,
        p.nzspr006,p.nzhosp,p.dummy,p.nzadat,AddForm.nzspr007,AddForm.dummy);
        return;
      } else {
        return;}
    }
}
function claimDetails(){
  if (document.AddForm.nzspr008[2].checked=="1") {
    ClaimCodeHeading.innerHTML=claimcodehd.innerHTML;
    ClaimCode.innerHTML=claimcode.innerHTML;
    ContractHeading.innerHTML=contracthd.innerHTML;
    Contract.innerHTML=contract.innerHTML;
    document.AddForm.nzspr020.className = "Integer";
    document.AddForm.nzspr020.readOnly=false;
    document.AddForm.nzspr020.value = trim(document.AddForm.nzspr020.value);
  } else {
    ClaimCodeHeading.innerHTML="";
    ClaimCode.innerHTML=claimcodeblank.innerHTML;
    ContractHeading.innerHTML="";
    Contract.innerHTML=contractblank.innerHTML;
  }
  if (document.AddForm.nzspr008[1].checked=="1") {
    document.AddForm.nzspr020.value="0";
    document.AddForm.nzspr020.className = "Readonly";
    document.AddForm.nzspr020.readOnly=true;
  }
}
function checkCntrMandatory(){
 if((trim(document.AddForm.nzspr002.value.substr(9,1))=="P")||
   (trim(document.AddForm.nzspr002.value.substr(9,1))=="F")){
     document.AddForm.nzspr006.className="Mandatory";
     document.AddForm.nzspr007.className="Mandatory";
   }else{
     document.AddForm.nzspr006.className="";
     document.AddForm.nzspr007.className="";
  }
}
function InsuranceUpd() {
  f = document.AddForm;
  ind27 = f.nzspr002.value.substr(44,1);
//alert('ind27=' + ind27);
  if (ind27=="I") {
    f.nzspr014.className="Mandatory";
  }
  else {
    f.nzspr014.className="";
  }
}
//---------------------------------------------------------------
// Function : Calculates time duration b/w a start & end time.
//---------------------------------------------------------------
var LookupTime;
function CalcDura(startime,endtime,duration) {
   if (startime.value=="") { return; }
   if (endtime.value=="") { return; }
   stime = new Date();
   etime = new Date();
   stime.setHours(startime.value.substr(0,2));
   stime.setMinutes(startime.value.substr(3,2));
   stime.setSeconds(startime.value.substr(6,2));
   etime.setHours(endtime.value.substr(0,2));
   etime.setMinutes(endtime.value.substr(3,2));
   etime.setSeconds(endtime.value.substr(6,2));
   difference = etime.getTime() - stime.getTime();
   difference = Math.floor(difference / (1000 * 60));
   if(difference<0){
     var one_day=60*24
     difference = difference + one_day
   }
   duration.value = difference;
}

function LoadCookieData() {
  // load cookie values into relevant fields
  var addProcCookie = GetCookieData('AddProcedure');

  if (addProcCookie == '1') {
    // set the field values from cookies...
    var cookieData = GetCookieData('AddProcedure-fields');

    if (cookieData.length > 0) {
      var fields = cookieData.split("|");
      var fieldName,fieldVal = "";

      for (i=0; i < fields.length; i++) {
        fieldName = fields[i].split("=")[0];
        fieldVal = fields[i].split("=")[1];
        if (fieldName != "") {
          document.getElementById(fieldName).value = fieldVal;
        }
      }
    }

    if (document.getElementById("nzspr013").value=="1") {
      document.getElementById("d_nzspr013").checked=true;
    }
    if (document.getElementById("nzspr016").value=="1") {
      document.getElementById("d_nzspr016").checked=true;
    }

    ExpireCookiePath('AddProcedure');
    ExpireCookiePath('AddProcedure-fields');
  }
}
</script>
</head>
%START.OF.PAGE
<body onload="PageLoad(event);claimDetails();LoadCookieData();">
<span class=DFrameTitleBar>
<img align="right" alt="Exit" class="MenuIcon" 
 src="../images/ExitIcon.gif" onclick="DFrameExit();">
Add Procedure
</span>
<form name=AddForm action="patweb89.pbl" method=get style=margin:0>
<input type=hidden name=reportno value=9>
<input type=hidden name=template value=5>
<input type=hidden name=urnumber value="%PATWEB89.09.003">
<input type=hidden name=admissno value="%PATWEB89.09.081">
<input type=hidden name=nzspr001 value="%PATWEB89.09.081">
<input type=hidden name=nextpage value="4">
<input type=hidden name=redirect value="%PATWEB89.09.001.patweb89.09.004">
<input type=hidden name=retcount value="">
<input type=hidden name=retcontr value="">
<input type=hidden name=retcdesc value="">
<input type=hidden name=nzhosp value="%PATWEB89.09.498.013.1">
<input type=hidden name=nzadat value="%PATWEB89.09.102" id=nzadat>
<input type=hidden name=updttype value="A">
<input type=hidden name=uniqueky value="%PATWEB89.09.303">
<input type=hidden name=nzspr007
       class=mandatory title="Contract Procedure Code">
<input type=hidden name=nzspr025 value="%PATWEB89.09.303">
<input type=hidden name=nzspr013 id=nzspr013 value="">
<input type=hidden name=nzspr016 id=nzspr016 value="">

<table border=0 width=95% cellspacing=0 align=center>
<tr><td width=25% class=DataLabel>Procedure</td>
    <td class=DataLabel>
        <input type=text name=nzspr004 size=10 maxlength=9 tabindex=95
        onblur='validateCode(4,nzspr004,mbsdesc1,nzadat);setFullDesc();' 
        class=Mandatory title="Procedure Code" id=nzspr004>
        <input type=text notab readonly name=mbsdesc1 size=35 
         value="%PATWEB89.09.204.1" class=Readonly id=mbsdesc1>
        <img notab src="../images/SearchIcon.gif" class=Icon
        onclick="MbsSearchFrame(nzspr004,mbsdesc1,nzadat)"> </td>

<tr><td class=DataLabel>Full Description</td>
    <td><input type=text name=nzspr010 title="Procedure Description"
         size=120 maxlength=80>
    </td></tr>

<tr><td></td>
    <td>
    <input type=radio name=nzspr008 value="1" disabled>Primary Procedure
    <input type=radio name=nzspr008 value="2" onclick='claimDetails();'>Include with Primary
    <input type=radio name=nzspr008 value="0" onclick='claimDetails();'>Bill as Separate
    </td></tr>

    <tr><td class=DataLabel>Procedure Not Performed</td>
            <input type=hidden value="0" name="nzspr012">
        <td><input type="checkbox" name=d_nzspr012 value="1"></td></tr>
    <tr><td>
        <div id=ClaimCodeHeading></div></td>
              <td><div id=ClaimCode></div></td></tr>
    <tr><td>
        <div id=ContractHeading></div></td>
              <td colspan=2><div id=Contract></div></td></tr>

<tr><td class=DataLabel>Surgeon</td>
   <td><input type=text name=nzspr003 size=10 maxlength=8 title="Surgeon"
        class=Mandatory value="%PATWEB89.09.312.003" id=nzspr003
        onchange="ValidateHCP(18,0,nzspr003,n_nzspr003);">
    <input type=text name=n_nzspr003  id=n_nzspr003
         value="%PATWEB89.09.312.002" size=45>
    <img src="../images/SearchIcon.gif" class=Icon
     onclick="HCPSearchFrame(nzspr003,n_nzspr003,1)">
    <img src="../images/erase.gif"  class=Icon
     onclick="clrFields(nzspr003,n_nzspr003);">
    </td></tr>
<tr><td class=DataLabel>Anaesthetist</td>
   <td><input type=text name=nzspr009 size=10 maxlength=8 title="Anaesthetist"
        id=nzspr009 onchange="ValidateHCP(18,0,nzspr009,n_nzspr009);">
    <input type=text name=n_nzspr009 id=n_nzspr009 readonly class=Readonly size=45>
    <img src="../images/SearchIcon.gif" class=Icon
     onclick="HCPSearchFrame(nzspr009,n_nzspr009,1)">
    <img src="../images/erase.gif"  class=Icon
     onclick="clrFields(nzspr009,n_nzspr009);">
    </td></tr>
</table>

<table border=0 width=95% cellspacing=0 align=center>
<tr><td width=25% class=DataLabel>Anaesthetic Start</td>
  <td class=DataField><input type=text readonly value="%PATWEB89.09.542"
  size=8 title="Anaesthetic Start" class=Readonly name=xxsem003></td>
  <td class=DataLabel>Session</td>
  <td class=DataField><input type=text readonly value="%PATWEB89.09.309"
  size=25 title="Session" class=Readonly></td>
</tr>

<tr><td class=DataLabel>Recovery In</td>
  <td class=DataField><input type=text readonly value="%PATWEB89.09.577"
  size=8 title="Recovery In" class=Readonly name=xxsem008></td>
  <td class=DataLabel>Unique ID</td>
  <td class=DataField><input type=text readonly value="%PATWEB89.09.303"
  size=10 title="Unique ID" class=Readonly></td>
</tr>
</table>

<table border=0 width=95% cellspacing=0 align=center>
<tr><td width=25% class=DataLabel>Operation Time</td>
  <td class=DataField><input type=text readonly 
  size=8 title="Recovery In" class=Readonly name=xxsem004></td></tr>

<tr><td class=DataLabel>Duration</td>
    <td class=DataField>
      <input type=text size=8 maxlength=5 title="Duration" name=nzspr020
       class="Integer" min=0 value="%PATWEB89.09.220">
    </td></tr>

<tr><td class=DataLabel>Approval Number</td> <td class=DataLabel>
<input type=text name=nzspr015 id=nzspr015 size=20 maxlength=20
 value="%PATWEB89.09.215"></td></tr>

<tr><td class=DataLabel>Claim Number</td> <td class=DataLabel>
<input type=text name=nzspr017 id=nzspr017 size=20 maxlength=20
 value="%PATWEB89.09.217"></td></tr>
 
<tr><td class=DataLabel>Approval Expiry Date </td>
<td><input type=text size=12 name=nzspr024 id=nzspr024
  title="Approval Date"
  onblur="checkDate(this,'ApprovalDate');"
  value="%PATWEB89.09.230" >
 <img notab src=../images/CalendarLookup.gif class=Icon
  onclick="DateLookupFrame(nzspr024);">
<img notab src=../images/DateTimeStamp.gif class=Icon
 onclick="SetCurrentDateTime(nzspr024,null);">
  </td></tr>

<tr><td class=DataLabel>Patient Insurance</td>
<td><input type=CheckBox name="d_nzspr013" id="d_nzspr013" /> </td>
</tr>

<tr><td width=25% class=DataLabel>Insurer</td>
  <td class=DataField>
  <select name=nzspr014 id=nzspr014 title="Insurer" >
  <option value=""></option>
  %PATWEB89.09.214.2
  </select></td> 
</tr>
  
<tr><td class=DataLabel>Prior Approval Sighted</td>
<td><input class="CheckBox" id="d_nzspr016" type="CheckBox"
name="d_nzspr016">
</td> 
</tr>
  
<tr><td width=25% class=DataLabel>Comments</td>
<td><input type=text name=nzspr019 id=nzspr019 size=50 maxlength=30
 value="%PATWEB89.09.219"></td>
</tr>

<tr><td>&nbsp;</td></tr>
<tr><td class=DataLabel>Extended Procedure Description</td>
    <td colspan=3>
       <textarea wrap=hard cols=70 rows=6 id=extprcmt name=extprcmt
              title="Extended Procedure Description"
              onkeydown="LimitText(this,999,69930);"
              tabindex=22>%PATWEB89.09.799.139.024</textarea>
    </td>
</tr>

<tr><td>&nbsp;</td></tr>
<tr><td colspan=2 align=center>
    <input type=button class="button" value="Add" name=AddButton
     id="pat89sub" onclick='tempDisable(this);RefreshSubmit();'>
    <input type=button value="Cancel" class="button" onclick='DFrameClose()'>
</td></tr>
</table>
</form>
<script type="text/javascript">
function init() {
  CalcDura(AddForm.xxsem003,AddForm.xxsem008,AddForm.xxsem004);
  document.AddForm.nzspr008[2].checked=1;

 anaesthetist="%PATWEB89.09.310"
 if(document.AddForm.nzspr009.value==""){
    document.AddForm.nzspr009.value=anaesthetist;
  ValidateHCP(18,0,document.AddForm.nzspr009,document.AddForm.n_nzspr009);
 }

}
</script>
<form name=PatientLinks method=get>
<input type=hidden name=reportno value=9>
<input type=hidden name=template value=005>
<input type=hidden name=urnumber value="%PATWEB89.09.003">
<input type=hidden name=admissno value="%PATWEB89.09.081">
<input type=hidden name=MenuType value="%PATWEB89.09.088">
<input type=hidden name=uniqueky value="%PATWEB89.09.303">
</form>
<span id=claimcodehd style="display:none">
%STANDARD.01.017.CL
</span>
<span id=claimcode style="display:none">
    <td class=DataField>
    <select name=nzspr002 title="%STANDARD.01.017.CL"
     class=Mandatory onchange='checkCntrMandatory();InsuranceUpd();'>
    <option></option>
    %PATWEB89.09.202.2
    </select></td>
</span>
<span id=contracthd style="display:none">
Contract
</span>
<span id=contract style="display:none">
         <input type=text size=6 maxlength=6 name=nzspr006
         title="Contract" class=Mandatory id=nzspr006
         onchange="validateCode(16,document.AddForm.nzspr006,funddesc);">
        <input type=text size=35 name="funddesc" maxlength="30"
         readonly class=Readonly notab id=funddesc>
        <input type="hidden" name="dummy" id=dummy>
        <img src=../images/SearchIcon.gif class=Icon 
         onclick="HFundSearchFrameNoFocus(nzspr006,funddesc,
                                               dummy,dummy);">
        <img src="../images/erase.gif"  class=Icon
         onclick="clrFields(nzspr006,funddesc,dummy,dummy);">
</span>

<span id=claimcodeblank style="display:none">
   <input type=hidden name=nzspr002 value="%PATWEB89.09.202.1">
</span>
<span id=contractblank style="display:none">
   <input type=hidden name=nzspr006 value="%PATWEB89.09.206.0">
</span>

