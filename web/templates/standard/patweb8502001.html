<meta name="TemplateVersion" content="V12.01.00">
<meta name="TemplateHome" content="standard">
<meta name="HelpFileName" content="NoContextSet.html">
<meta name="CrossBrowser" content="true">

<style type="text/css">
#box1{
   position: absolute;
   top: 100px;
   left: 100px;
   border-style: outset;
   background-color: #fff8ff;
   padding: 3px;
   visibility: hidden;
   font-size:70%
}
</style>

<script type="text/javascript" src="../js/TableSort.js"></script>
<script type="text/javascript" src="../js/patweb85.js"></script>
<script type="text/javascript" src="../js/MrtLocations.js"></script>
<script type="text/javascript" src="../js/MrtMultiLocations.js"></script>
<script type="text/javascript">

//                    ------------------ Hover Comments -----------
var box1;
var mousex = 0;
var mousey = 0;
var maxx = 0;
var maxy = 0;

function init() {
  box1 = document.getElementById('box1');
  document.onmousemove = getMouseXY;
  maxx = getClientWidth();
  maxy = getClientHeight();
}

function getMouseXY(e) {                      // works on IE6,FF,Moz,Opera7
  if (!e) e = window.event;     // works on IE only 
                                // (others rely on browser passing us the event)
  if (e) {
    if (e.pageX || e.pageY) { 
                          // this doesn't work on IE6!! (works on FF,Moz,Opera7)
      mousex = e.pageX;
      mousey = e.pageY;
    }
    else if (e.clientX || e.clientY ) {      // works on IE6,FF,Moz,Opera7
      mousex = e.clientX + document.body.scrollLeft;
      mousey = e.clientY + document.body.scrollTop;
    }
  }
}

function HoverData(fl01,fl02,fl03,fl04,fl05,fl06,fl07,fl08,fl09,fl10,fl11) {
  box1.innerHTML = "<b>" +
                   fl01.replace(/\+/g," ") + "</b><br>" + 
                   fl02.replace(/\+/g," ") + "<br>" + 
                   fl03.replace(/\+/g," ") + "<br>" + 
                   fl04.replace(/\+/g," ") + "<br>" +
                   fl05.replace(/\+/g," ") + "<br>" +
                   fl06.replace(/\+/g," ") + "<br>" +
                   fl07.replace(/\+/g," ") + "<br>" +
                   fl08.replace(/\+/g," ") + "<br>" +
                   fl09.replace(/\+/g," ") + "<br>" +
                   fl10.replace(/\+/g," ") + "<br>" +
                   fl11.replace(/\+/g," ") + "<br>";

  var x = mousex;
  var y = mousey;
  // rendered dimensions or estimates;
  var rx = ( box1.sclrollLeft ) ?  box1.scrollLeft : 200;
  var ry = ( box1.scrollHeight ) ? box1.scrollHeight : 300;

  x = (maxx - x - 70 < rx) ? x - 70 - rx : x + 70;
  y = (maxy - y - 70 < ry) ? y - ry - 10 : y;  // leave room for navigation bar

  box1.style.top  =  y + 'px';
  box1.style.left =  x + 'px';

  box1.style.visibility = "visible";
}

function hide_HoverData(){
  box1.style.visibility = "hidden";
}
//                     ---------------- end of Hover comments ---------

function UpdateFilled(CheckBox){
  CheckPageRefresh(); 
  if(document.SelectPeriod.mrcnureq.value=="1") {
    if(CheckBox.checked==true) {
       ModifyMove(CheckBox);
       return;
     } else {
       PopUpScreen.style.display="none";  
     }
  }
  UpdateSeque=1
  UpdateValue=0
  if (CheckBox.checked) {
     eval("can"+CheckBox.name.substr(3,4)).checked=false 
     eval("prc"+CheckBox.name.substr(3,4)).checked=false 
     UpdateValue=1
  } else {
     eval("can"+CheckBox.name.substr(3,4)).checked=false
     eval("prc"+CheckBox.name.substr(3,4)).checked=false
     UpdateValue=0
  }

  var serverURL   = "../cgi-bin/patweb85.pbl?reportno=3" +
                    "&mrtrecky=" + CheckBox.value.replace(/ /g,"+") +
                    "&checkbox=" + UpdateValue +
                    "&sequence=" + UpdateSeque
  var returnValue = RSExecute(serverURL);
  if (returnValue.status!=0) {
    ReturnCode.select();  }
}
function ModifyMove(CBox) {
  CheckPageRefresh(); 
  x=CBox.value.substring(0,20);
  y=CBox.value.substring(20,28);
  linkUrl="patweb85.pbl?reportno=02&template=005" +
          "&mrtrecky=" + x.replace(/ /g,"+") +
          "&urnumber=" + y.replace(/ /g,"+") +
          "&superlev=" + document.SelectPeriod.superlev.value
  Left=(document.body.clientWidth-700)/2
  DFrameLink(linkUrl,100,Left,700,400)
}

function UpdateCancel(CheckBox) {
  CheckPageRefresh(); 
  UpdateSeque = 2;
  UpdateValue = 0;
  if (CheckBox.checked) {
     eval("fil"+CheckBox.name.substr(3,4)).checked = false;
     eval("prc"+CheckBox.name.substr(3,4)).checked = false;
     UpdateValue = 1;
  }
  var serverURL   = "../cgi-bin/patweb85.pbl?reportno=3" +
                    "&mrtrecky=" + CheckBox.value.replace(/ /g,"+") +
                    "&checkbox=" + UpdateValue +
                    "&sequence=" + UpdateSeque
  var returnValue = RSExecute(serverURL);
  if (returnValue.status!=0) {
    ReturnCode.select();  }
}
function UpdateProgrs(CheckBox) {
  CheckPageRefresh(); 
  UpdateSeque = 3;
  UpdateValue = 0;
  if (CheckBox.checked) {
     eval("can"+CheckBox.name.substr(3,4)).checked = false;
     eval("fil"+CheckBox.name.substr(3,4)).checked = false;
     UpdateValue = 1; }
  var serverURL   = "../cgi-bin/patweb85.pbl?reportno=3" +
                    "&mrtrecky=" + CheckBox.value.replace(/ /g,"+") +
                    "&checkbox=" + UpdateValue +
                    "&sequence=" + UpdateSeque ;
  var returnValue = RSExecute(serverURL);
  if (returnValue.status !=0 ) {
      ReturnCode.select(); }
}
function UpdateHeader(mrtkey,urno) {
  CheckPageRefresh(); 
  document.SelectPeriod.template.value = 2;
  document.SelectPeriod.mrtrecky.value = mrtkey;
  document.SelectPeriod.urnumber.value = urno;
  Left=(document.body.clientWidth-450)/2;
  DFrameSubmit(SelectPeriod,100,Left,450,350);
}
// ------------------------------------------------------------
// Columns Available
//  0 - HTML Link    
//  1 - Request No  
//  2 - UR          
//  3 - Date/Time           
//  4 - Movement Reason Description
//  5 - Current Location
//  6 - Destination    
//  7 - Volume Number 
//  8 - Filled Status
//  9 - Filled     
// 10 - Cancel           
// 11 - Cancel           
// 12 - Movement Reason Code      
// 13 - Patient Name     
// 14 - Request Reason   
// 15 - Patient Folder
// 16 - Patient Link
// 17 - Urgency Description
// 18 - Date mrtmas created
// 19 - Triag Category
// 20 -
// 21 -
// 22 - Data for Hover Info. - function HoverData()
// 23 - Originating Hosp
// 24 - Document Type - Cat.TY
// 25 - Record Status - Cat.RS
// 26 - Comments
// ------------------------------------------------------------
function InitTable(TableView) {
switch (TableView) {
  case 0: {
    t = new Table(1,0,1,"100%","center");
    t.addColumn("Request No.","String",1,1,"left","MaintenanceIcon.gif","0",70,"","","22")
    t.addColumn("UR No.","String",2,8,"center","","",50)
    t.addColumn("Patient Name","ImageText",13,13,"left","PatientFolder","16",180,15)
    t.addColumn("Date/Time","DateTime",3,3,"","","",58)
    t.addColumn("Reason","String",12,12,"left","","",50)
    t.addColumn("Destination","String",6,6,"","","",150)
    t.addColumn("Current Location","String",5,5,"left","","",100,"","","",21)
    t.addColumn("Document Type","String",24,24,"","","",50)
//
    if(parseInt(SelectPeriod.mrcntday.value,10)>0) {
      t.addColumn("Outstanding Requests","String",20,20,"left","","",200,"","","",21)
    }
//
    t.addColumn("Vol.","String",7,7,"center","","",25)
    t.addColumn("Status","String",25,25,"center","","",60)
    t.addColumn("Process","String",9,9,"center","","",47)
    t.addColumn("Filled","String",10,10,"center","","",35)
    t.addColumn("Cancel","String",11,11,"center","","",40)
    AddTableRows()
    TableOutput(1,1);    // Order Column,Asc Dsc
    break;
   }
 }
}
function SetHos() {
  SetFiltLocn(SelectPeriod);
}
function MoveButton() {    // Display move button
   if (document.SelectPeriod.viewtype.value=="0") {
     var InsertMoveAll = document.getElementById('InsertMoveAll'); 
     if (document.SelectPeriod.lastdate.value < SetDateYYYYMMDD(document.SelectPeriod.today.value)) {
       InsertMoveAll.style.display="";
     } else { 
       InsertMoveAll.style.display="none";
     }
   }
}
function BulkTransfer() {
 if (confirm('Confirm transfer of ALL outstanding requests to today?' +
           '\n OK to continue, Cancel to abort')) {
   document.SelectPeriod.updatety.value="T";
   SubmitHidden(SelectPeriod);
 }
}
function CheckHosp() {
  if (document.SelectPeriod.ibcnmhos.value=="1") {
     if (isWhitespace(document.SelectPeriod.filthosp.value)) {
         alert("A valid Hospital must be selected");
         document.SelectPeriod.filtlocn.selectedIndex=0;
         return;
     }
  }
  document.SelectPeriod.dflthosp.value = document.SelectPeriod.filthosp.value;
  document.SelectPeriod.dfltlocn.value = document.SelectPeriod.filtlocn.value;
  reSubmit()
}
function reSubmit() {
  document.SelectPeriod.updatety.value="";
  document.SelectPeriod.submit();
}
var NewReqHandle;
function CheckPageRefresh() {
  SleepTime = 15000    // 15 seconds
  window.clearInterval(NewReqHandle);
  NewReqHandle = window.setInterval("CheckNewRequest();",SleepTime); 
}
function CheckNewRequest() {
  if (PopUpScreen.style.display!="none") {
    return;
  }
  var serverURL  = "../cgi-bin/patweb85.pbl?reportno=7" +
        "&valddate=" + document.SelectPeriod.valddate.value.replace(/ /g,"+") +
        "&valdtime=" + document.SelectPeriod.valdtime.value.replace(/ /g,"+") +
        "&filtlocn=" + document.SelectPeriod.filtlocn.value.replace(/ /g,"+") +
        "&bulkflag=0";
  if (document.SelectPeriod.ibcnmhos.value=="1") {
      serverURL += "&filthosp=" + 
                   document.SelectPeriod.filthosp.value.replace(/ /g,"+"); 
      serverURL += "&filthhos=" + 
                   document.SelectPeriod.filthhos.value.replace(/ /g,"+"); 
  }

  var returnValue = RSExecute(serverURL);
  if (returnValue.status==0 ) {
    ReturnValue=returnValue.return_value.split("|");
    document.SelectPeriod.valddate.value=ReturnValue[1];
    document.SelectPeriod.valdtime.value=ReturnValue[2];
    if(ReturnValue[0]=="1") {
      StdPageRefresh();
    }
  } 
}
</script>
</head>
%START.OF.PAGE
<body onload="PageLoad(event);SetHos();InitTable(0);MoveButton();
              CheckPageRefresh();">
<div id="HeadingSection">
<form name="SelectPeriod" action="patweb85.pbl" method="get" style="margin:0">
 <input type="hidden" name="reportno" value="2">
 <input type="hidden" name="template" value="1">
 <input type="hidden" name="viewtype" value="%PATWEB85.02.210">
 <input type="hidden" name="mrtrecky">
 <input type="hidden" name="urnumber">
 <input type="hidden" name="updatety" value="">
 <input type="hidden" name="mrcnureq" value="%STANDARD.01.025.097.164.0.1">
 <input type="hidden" name="today"    value="%STANDARD.01.015">
 <input type="hidden" name="valddate" value="%STANDARD.01.013">
 <input type="hidden" name="valdtime" value="%STANDARD.01.016">
 <input type="hidden" name="ibcnmhos" value="%STANDARD.01.025.000.043.1.1">
 <input type="hidden" name="showflag" value="1">
 <input type="hidden" name="dflthosp" value="%PATWEB85.02.134.0">
 <input type="hidden" name="dflthhos" value="%PATWEB85.02.134.2">
 <input type="hidden" name="dfltlocn" value="%PATWEB85.02.141">
 <input type="hidden" name="superlev" value="%PATWEB85.02.135">
 <input type="hidden" name="mrcntday" value="%STANDARD.01.025.097.170.0.2">

<table cellpadding="1" cellspacing="1" bgcolor="#CCCCCC" border="1"
 width="100%">
<tr><td>
 <table cellpadding="1" cellspacing="1" bgcolor="#CCCCCC" border="0"
 width="100%">
 <tr><td id="Hospital"></td>
   <td id="HospitalReq"></td>
   <td>Destination<br>
     <select name="filtlocn" id=filtlocn onchange="CheckHosp();">
     <option value="   ">All</option>
     </select></td>
   <td>Filled<br>
   <select name="filledrc" id=filledrc onchange='this.form.submit()'>
    %PATWEB85.02.220
   </select></td>

   <td class="DataLabel"><br><input type="button" value="<<" 
       class="smallbutton" onclick='%PATWEB85.02.202'>
    %PATWEB85.02.207
    <input type="button" value=">>" class="smallbutton"
    onclick='%PATWEB85.02.201'>
    </td>
   <td>
   <br>
   <a href="javascript:SelectDateFrame();">
   <img src="../images/CalendarLookup.gif" border="0"
    alt="Select Date" align="absmiddle"></a>
   <a href='javascript:SelectView("0");'>
   <img src="../images/DayIcon.gif" border="0"
    alt="View Today" align="absmiddle"></a>
   <a href='javascript:SelectView("1");'>
   <img src="../images/WeekIcon.gif" border="0"
    alt="View This Week" align="absmiddle"></a>
   <a href='javascript:SelectView("2");'>
   <img src="../images/MonthIcon.gif" border="0"
    alt="View This Month" align=absmiddle></a>
   </td>

   <td><br><input type="submit" class="button" value="Move">
           <span id="InsertMoveAll" style="display: none">
           <input type="button" class="button" value="Bulk Transfer"
            onclick="BulkTransfer();">
           </span>
   </td>
   </tr>
   <tr><td>Document Type<br>
       <select name=docutype id=docutype onchange='this.form.submit()'>
       <option value="    ">All</option>
       %PATWEB85.02.123.2
       </select>
       </td>
       <td>&nbsp;</td>
       <td>&nbsp;</td>
       <td>&nbsp;</td>
       <td>&nbsp;</td>
       <td>&nbsp;</td>
       <td>&nbsp;</td>
   </tr>
   </table>
</td></tr>
</table>
</form>
</div>
<div id="TableLocation"></div>

  <span id="ShowHomeHosp" style="display:none">
    Hospital<br>
    <select name="filthhos" id=filthhos title="Hospital" class="Mandatory"
     onchange="reSubmit();">
    <option value="   ">All</option>
    %PATWEB85.02.139
    </select>
  </span>   

  <span id="ShowNoHomeHosp" style="display:none">
     <input type=hidden name=filthhos id=filthhos value="    ">
  </span>
           
  <span id="ShowRequHosp" style="display:none">
    Requesting Hospital<br>
    <select name="filthosp" id=filthosp title="Hospital" class="Mandatory"
     onchange="ResetLocn(SelectPeriod);reSubmit();">
    <option value="   ">All</option>
    %PATWEB85.02.140
    </select>
  </span>

  <span id="ShowNoRequHosp" style="display:none">
     <input type=hidden name=filthosp id=filthosp value="    ">
  </span>

<script type="text/javascript">
function AddTableRows() {
%PATWEB85.02.211.patweb85.02.002
}

  var ibcnmhos=%STANDARD.01.025.000.043.1.1;
  if (ibcnmhos == "1") {
    document.getElementById('Hospital').innerHTML=
      document.getElementById('ShowHomeHosp').innerHTML;
    document.getElementById('HospitalReq').innerHTML=
      document.getElementById('ShowRequHosp').innerHTML;
  } else {
    document.getElementById('Hospital').innerHTML=
      document.getElementById('ShowNoHomeHosp').innerHTML;
    document.getElementById('HospitalReq').innerHTML=
      document.getElementById('ShowNoRequHosp').innerHTML;
  }
</script>
<div id="box1"></div>
