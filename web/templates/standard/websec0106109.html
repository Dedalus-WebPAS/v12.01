Content-Type: text/html
Cache-Control: no-cache

%START.OF.PAGE
<!DOCTYPE html>
<html>
<head>
<title>Portal User Profile Update</title>
<meta name="ServerID"       content="%STANDARD.01.004">
<meta name="ServerName"     content="%STANDARD.01.005">
<meta name="ServerVersion"  content="%STANDARD.01.006">
<meta name="ServerOption"   content="%STANDARD.01.002">
<meta name="ServerTemplate" content="%STANDARD.01.003">
<meta name="TemplateFile"   content="websec0106109.html">
<meta name="TemplateVersion" content="V12.01.00">
<meta name="TemplateHome"    content="standard">
<meta name="HelpFileName"    content="NoContextSet.html">
<meta name="CrossBrowser"    content="true">
<script type="text/javascript" src="../js/Standard.js"></script>
<script type="text/javascript" src="../js/Custom.js"></script>
<script type="text/javascript" src="../js/json2.js"></script>
<link rel="stylesheet" href="../html/standard.css" type="text/css">
<link rel="stylesheet" href="../html/custom.css" type="text/css">
<style type=text/css>
.FreeTextEditor {
  width:800px;
  height:600px;
  background-color:white;
  border:3px outset silver;
}
.FreeTextEditorHeading {
 font-weight:bold;
 background-color: #99CCFF;
 padding-top:3px;
 padding-bottom:3px;
 text-align:center;
}
.FreeTextEditorFooter {
 text-align:center;
 padding:10px;
}
.Label {
  font-weight:bold;
}
</style>
<script type=text/javascript>
function SetMandatory() {
  var el=document.getElementById('password1');
  el.className='Mandatory';
  el=document.getElementById('password2');
  el.className='Mandatory';
}
function Save() {
  if (!validateMandatory(document.PageEdit))
    return false;

  var url="PortalConfiguration.php";
  var el;
  var qry="reportno=9";

  var profile=parent.UserProfiles[parent.UserProfileSelected];

  el=document.getElementById('UserProfileID');
  qry=qry+"&UserProfileID="+encodeURIComponent(el.value);

  if (profile.userCounter != undefined) {  // is a multi-profile portal
    el=document.getElementById('UserCounter');
    qry=qry+"&UserCounter="+encodeURIComponent(el.value);
  }

  el=document.getElementById('Surname');
  qry=qry+"&Surname="+encodeURIComponent(el.value);

  el=document.getElementById('FirstName');
  qry=qry+"&FirstName="+encodeURIComponent(el.value);

  el=document.getElementById('DateOfBirth');
  qry=qry+"&DateOfBirth="+encodeURIComponent(SetDateYYYYMMDD(el.value));

  el=document.getElementById('UserEmail');
  qry=qry+"&UserEmail="+encodeURIComponent(el.value);

  el=document.getElementById('password1');
  qry=qry+"&Password1="+encodeURIComponent(el.value);

  el=document.getElementById('password2');
  qry=qry+"&Password2="+encodeURIComponent(el.value);

  // Only update 'Status' if not multi-profile portal OR is the primary profile
  if (profile.userCounter == undefined || profile.userCounter == "0") {
    el=document.getElementById('Activated');
    el=el.options[el.selectedIndex];
    qry=qry+"&Activated="+encodeURIComponent(el.value);
  }
  else {
    qry=qry+"&Activated="+profile.activated;
  }

  var xmlHttp = createHttpObject();
  xmlHttp.open("POST",url,false);
  xmlHttp.setRequestHeader("Content-type","application/x-www-form-urlencoded");
  xmlHttp.send(qry);
  if (xmlHttp.status == 200) {
    if (xmlHttp.responseText=="COMPLETE") {
      alert("Update Complete");
      parent.location.reload();
      return;
    } else {
      alert(xmlHttp.responseText);
    }
  } else {
    alert("ERROR : A problem occurred saving the records Try Again.");
    return;
  }
}
function init() {
  var el;
  var profile=parent.UserProfiles[parent.UserProfileSelected];

  el=document.getElementById('UserProfileID');
  el.value = profile.userProfileId;

  if (profile.userCounter == undefined) {  // single-profile
    document.getElementById('tr_counter').style.display = "none";
  }
  else { // multi-profile
    el=document.getElementById('UserCounter');
    el.value = profile.userCounter;

    if (profile.userCounter != "0") {  // not the primary profile
      var rows = document.querySelectorAll("[id^='tr_hide']");
      for (var i=0; i < rows.length; i++) {
        rows[i].style.display = "none";  // hide row
      }

      el=document.getElementById('UserEmail');
      el.setAttribute("readonly", "readonly");  // don't allow Email change
    }
  }

  el=document.getElementById('Surname');
  el.value = profile.surname;

  el=document.getElementById('FirstName');
  el.value = profile.firstName;

  el=document.getElementById('UserEmail');
  el.value = profile.userEmail;

  if (profile.userCounter == undefined || profile.userCounter == "0") {
    el=document.getElementById('Activated');
    for (var i=0;i<el.options.length;i++) {
      if (el.options[i].value==profile.activated) el.selectedIndex=i;
    }
  }

  el=document.getElementById('DateOfBirth');
  el.value = profile.dateOfBirth;
  if (!isWhitespace(el.value)) {
    if (el.value.length != 8) {
      alert("Invalid " + el.title);
      window.setTimeout(function() { el.select(); }, 100);
    }
    else {
      el.value = SetDateDDMMMYYYY(el.value);
      el.focus();
      window.setTimeout(function() { el.blur(); }, 100);
    }
  }
}
</script>
</head>
<body onload="PageLoad(event);">
<span class=DFrameTitleBar>
<img align="right" alt="Exit" class="MenuIcon"
 src="../images/ExitIcon.gif" onclick="DFrameExit();">
Portal User Profile Update
</span>
<form name=PageEdit action=PortalConfiguration.php method=POST style="margin:0">
<input type=hidden name=reportno value=5>
<table width=100% >
<tr valign=top><td>
<table width=100% cellpadding=4 border=1 style='border:1px #ccc solid'>

<tr><td class=Label width=30%>Profile ID</td>
    <td><input type=text id=UserProfileID name=UserProfileID readonly size=50
         class=Readonly title="Profile ID"></td></tr>

<tr id="tr_counter"><td class=Label width=30%>Profile Counter</td>
    <td><input type=text id=UserCounter name=UserCounter readonly size=50
         class=Readonly title="Profile Counter"></td></tr>

<tr><td class=Label>Surname</td>
    <td><input type=text id=Surname name=Surname size=50
         onchange="SetMandatory()" title="Surname"></td></tr>

<tr><td class=Label>First Given Name</td>
    <td><input type=text id=FirstName name=FirstName size=50
         onchange="SetMandatory()" title="First Given Name"></td></tr>

<tr><td class=Label>Date of Birth</td>
    <td><input type=text id=DateOfBirth name=DateOfBirth class=Date
         size=50 maxlength=8 title="Date of Birth"
         onchange="SetMandatory()"></td></tr>

<tr><td class=Label>Email Address</td>
    <td><input onchange="SetMandatory()"
         type=text id=UserEmail name=UserEmail class=Mandatory size=50
         title="Email Address"></td></tr>

<tr><td class=Label>New Password</td>
    <td><input type=password id=password1 name=password1 size=50
         title="New Password" onchange="SetMandatory()"></td></tr>

<tr><td class=Label>Re-enter New Password</td>
    <td><input type=password id=password2 name=password2 size=50
         title="Re-enter New Password" onchange="SetMandatory()"></td></tr>

<tr id="tr_hide_stat"><td class=Label>Status</td>
    <td><select name=Activated id=Activated title="Status">
        <option value=0>Not Activated</option>
        <option value=1>Activated</option>
        <option value=2>Password Reset in Progress</option>
        <option value=3>Disable</option>
     </td></tr>
</table>
</td></tr>

<tr><td style="text-align:center;">
  <input type=button class=button value=Save onclick="Save();">
  <input type=button class=button value=Cancel onclick="DFrameExit();">
</td></tr>
<table>
</form>
