<meta name="TemplateVersion" content="V12.01.00">
<meta name="TemplateHome" content="standard">
<meta name="HelpFileName" content="NoContextSet.html">
<meta name="CrossBrowser" content="true">
<script type="text/javascript">
var mergeWarnMsg = "Patient has a current or future visit.<br>" +
                   "Please check visits before completing merge.";
function checkUrVisits(IDnum,URnumber) {
 document.getElementById("mergeWarn"+IDnum).style.display="none";
 if (URnumber!="") {
  var serverURL = "../cgi-bin/comweb81.pbl?reportno=58" +
                  "&urnumber=" + URnumber.replace(/ /g,"+"); 
  var returnValue = RSExecute(serverURL);
  if (returnValue.status==0) {
    ReturnValues=returnValue.return_value.split("|")
    for (var i=0; i<ReturnValues.length; i++) {
      if (ReturnValues[i] == "1") {
        document.getElementById("mergeWarn"+IDnum).style.display="block";
        document.getElementById("mergeWarn"+IDnum).innerHTML=mergeWarnMsg;
        break;
      }
    }
  }
  return;
 }
}
function MergePatients() {
  if (validateMandatory(UpdateForm)) {
    ans=true;
    if (UpdateForm.urnumbe1.value==UpdateForm.urnumbe2.value) {
      alert("Both U/R Number are the same.");
      return ;
    }

    if (UpdateForm.fna1.value!=UpdateForm.fna2.value) {
      ans=confirm("Warning Both Names are NOT the same.\n\n Ok to Proceed ?");
      if (!ans) { return } 
    }

    if (UpdateForm.dob1.value!=UpdateForm.dob2.value) {
      ans=confirm("Warning Both Date of Birth are NOT the same. " +
                  "\n\n Ok to Proceed?");
      if (!ans) { return } 
    }

    if (UpdateForm.sex1.value!=UpdateForm.sex2.value) {
      ans=confirm("Warning Both Sexes are NOT the same. \n\n Ok to Proceed ?");
      if (!ans) { return } 
    }

    AlertString="U/R Number " + UpdateForm.urnumbe1.value +
                " will be replaced with " + UpdateForm.urnumbe2.value +
                "\n\n                   Ok to Proceed ?"

    if (confirm(AlertString)) {
      AddForm.savealia.value="0";
      AddForm.savedetl.value="0";
      AddForm.saveretn.value="0";

      if (UpdateForm.savealia.checked) {
        AddForm.savealia.value="1";
      }

      if (UpdateForm.savedetl.checked) {
        AddForm.savedetl.value="1";
      }

      if (UpdateForm.saveretn.checked) {
        AddForm.saveretn.value="1";
      }

      AddForm.oldurnum.value=UpdateForm.urnumbe1.value;
      AddForm.newurnum.value=UpdateForm.urnumbe2.value;
//
      document.AddForm.redirect.value="mrtweb02.pbl?reportno=5&template=001"
      + "&oldurnum=" + document.UpdateForm.urnumbe1.value.replace(/ /g,"+")
      + "&newurnum=" + document.UpdateForm.urnumbe2.value.replace(/ /g,"+")
      + "&wahealth=" + document.UpdateForm.wahealth.value.replace(/ /g,"+")
//
      ShowWaitScreen();
      setTimeout('HideWaitScreen();',20000);         // 20 seconds
      AddForm.submit();
    }
  }
}

function validateRecordID1() {
  p=document.UpdateForm;
  FormatURScanMrtLf(p.urnumbe1);
  UpCase(p.urnumbe1);

  if (p.urnumbe1.value!="") {
    LenUR=p.urnumbe1.value.length;
    if (LenUR < 9) { 
      Count = 8 - LenUR;
      Blanks="";
      for (i=0; i < Count;i++) { Blanks+=" "; }
      p.urnumbe1.value=Blanks + p.urnumbe1.value;
    }

    validateCode(13,p.urnumbe1,p.fna1,UpdateUR1,p.sex1,p.dob1,p.pce1,p.dum1,
      p.admissn1,p.da1,p.typ1,p.age1,p.medi1,p.adda1,p.addb1,p.sub1,p.addc1,
      p.post1,p.dummy,p.dummy,p.dummy,p.dummy,p.dummy,p.dummy,p.dummy,p.rper1,
      p.rdat1);
  }
}

function validateRecordID2() {
  p=document.UpdateForm;
  FormatURScanMrtLf(p.urnumbe2);
  UpCase(p.urnumbe2);

  if (p.urnumbe2.value!="") {
    LenUR=p.urnumbe2.value.length
    if (LenUR < 9) { 
      Count = 8 - LenUR;
      Blanks="";
      for (i=0; i < Count;i++) { Blanks+=" "; }
      p.urnumbe2.value=Blanks + p.urnumbe2.value 
    }

    validateCode(13,p.urnumbe2,p.fna2,UpdateUR2,p.sex2,p.dob2,p.pce2,p.dum2,
      p.admissn2,p.da2,p.typ2,p.age2,p.medi2,p.adda2,p.addb2,p.sub2,p.addc2,
      p.post2,p.dummy,p.dummy,p.dummy,p.dummy,p.dummy,p.dummy,p.dummy,p.rper2,
      p.rdat2);
  }
}

function UpdateUR1() {
  GetIHINum(1);
  if (document.UpdateForm.dum1.value != document.UpdateForm.urnumbe1.value) {
     alert("UR Number Merged with " + document.UpdateForm.dum1.value);
     document.UpdateForm.urnumbe1.value = document.UpdateForm.dum1.value;
  }
}

function UpdateUR2() {
  GetIHINum(2);
  if (document.UpdateForm.dum2.value != document.UpdateForm.urnumbe2.value) {
     alert("UR Number Merged with " + document.UpdateForm.dum2.value);
     document.UpdateForm.urnumbe2.value = document.UpdateForm.dum2.value;
  }
}

function GetIHINum(fieldNo) {
  if(document.UpdateForm.ptcnunet.value!="1" &&
     document.UpdateForm.ptcnunet.value!="3") return;

  if (fieldNo == undefined) return;

  var p = document.UpdateForm;
  var elURNum = (fieldNo == 1)? p.urnumbe1 : p.urnumbe2;
  var urNum = elURNum.value;
  var serverURL = "../cgi-bin/comweb06.pbl?reportno=5&valdtype=5" +
                      "&valdcode=" + urNum.replace(/ /g,"+");

  var returnValue = RSExecute(serverURL);
  if (returnValue.status==0) {
    ReturnValue = returnValue.return_value.split("|");

    var elIHINum = (fieldNo == 1) ? document.getElementById('spIHINumVal1') :
                   document.getElementById('spIHINumVal2');
    if (elIHINum != undefined) {
      elIHINum.innerHTML = ReturnValue;
    }
  }
}

function ClearFields() {
  var sp1 = document.getElementById('spIHINumVal1');
  var sp2 = document.getElementById('spIHINumVal2');

  if (sp1 && sp2) {
    sp1.innerHTML = "";
    sp2.innerHTML = "";
  } 
 document.getElementById("mergeWarn"+1).style.display="none";
 document.getElementById("mergeWarn"+2).style.display="none";
}

function LoadRetention() {
  if (isWhitespace(document.getElementById('recrt001').value)) {
    if ((!isWhitespace(document.UpdateForm.rdat1.value))||
       (!isWhitespace(document.UpdateForm.rdat2.value))) {
       var divRetentDet = document.getElementById('RetentionDet');
       divRetentDet.style.display = "";
    }
  }
}

</script>
</head>
%START.OF.PAGE
<body onload="PageLoad(event);DisplayRetention();">
<form name=UpdateForm method=post action=patweb83.pbl style="margin:0"
 autocomplete="off">
  <input type=hidden name=reportno value="2">
  <input type=hidden name=template value="002">
  <input type=hidden name=admissn1 value="">
  <input type=hidden name=admissn2 value="">
  <input type=hidden name=da1 value="">
  <input type=hidden name=da2 value="">
  <input type=hidden name=pce1 value="">
  <input type=hidden name=pce2 value="">
  <input type=hidden name=dum1 value="">
  <input type=hidden name=dum2 value="">
  <input type=hidden name=dummy value="">
  <input type=hidden name=typ1 value="1">
  <input type=hidden name=typ2 value="1">
  <input type=hidden name=wahealth value="%PATWEB98.02.020">
  <input type=hidden name=recrt001 id=recrt001 value="%STANDARD.01.017.rt">
  <input type=hidden name=ptcnunet value="%STANDARD.01.025.120.158.0.1" >

<table width=100% align=center border=0 cellspacing=0>
<tr><td align=center class=HeadingCell>
    Patient Merge</td></tr>
</table>
<table width=95% align=center border=0 cellspacing=0>
<tr><td class=HeadingCell width=20%></td>
    <td class=HeadingCell width=40%>U/R (No longer required)</td>
    <td class=HeadingCell width=40%>U/R (to keep)</td></tr>
<tr><td class=DataLabel>U/R or Record ID</td>
    <td class=DataField>
    <input type=text  title="U/R No" name=urnumbe1 id=urnumbe1
     class=Mandatory size=20 
     onblur='validateRecordID1();LoadRetention();checkUrVisits(1,UpdateForm.urnumbe1.value);'></td>
    <td class=DataField>
    <input type=text  title="U/R No" name=urnumbe2 id=urnumbe2
     class=Mandatory size=20 
     onblur='validateRecordID2();LoadRetention();checkUrVisits(2,UpdateForm.urnumbe2.value);'></td></tr>
<tr><td class=DataLabel></td>
    <td class=DataField><span id="mergeWarn1" style="display:none; color:red; font-size:14px; font-weight:700;"></span></td>
    <td class=DataField><span id="mergeWarn2" style="display:none; color:red; font-size:14px; font-weight:700;"></span></td>
</tr>

<tr><td class=DataLabel>Name</td>
    <td class=DataField>
    <input type=text name=fna1 id=fna1 size=50 readonly></td>
    <td class=DataField>
    <input type=text name=fna2 id=fna2 size=50 readonly></td></tr>

<tr><td class=DataLabel>Date of Birth</td>
    <td class=DataLabel>
    <input type=text name=dob1 id=dob1 size=20 readonly>
    Age <input type=text name=age1 id=age1 size=10 readonly></td>
    <td class=DataLabel>
    <input type=text name=dob2 id=dob2 size=20 readonly>
    Age <input type=text name=age2 id=age2 size=10 readonly></td></tr>

<tr><td class=DataLabel>Sex</td>
    <td class=DataField>
    <input type=text name=sex1 id=sex1 size=10 readonly></td>
    <td class=DataField>
    <input type=text name=sex2 id=sex2 size=10 readonly></td></tr>

<tr><td class=DataLabel>Medicare Number</td>
    <td class=DataField>
    <input type=text name=medi1 id=medi1 size=10 readonly></td>
    <td class=DataField>
    <input type=text name=medi2 id=medi2 size=10 readonly></td></tr>

<tr><td class=DataLabel>Address 1</td>
    <td class=DataField>
    <input type=text name=adda1 id=adda1 size=35 readonly></td>
    <td class=DataField>
    <input type=text name=adda2 id=adda2 size=35 readonly></td></tr>

<tr><td class=DataLabel>Address 2</td>
    <td class=DataField>
    <input type=text name=addb1 id=addb1 size=35 readonly></td>
    <td class=DataField>
    <input type=text name=addb2 id=addb2 size=35 readonly></td></tr>

<tr><td class=DataLabel>Address 3</td>
    <td class=DataField>
    <input type=text name=sub1 id=sub1 size=35 readonly></td>
    <td class=DataField>
    <input type=text name=sub2 id=sub2 size=35 readonly></td></tr>

<tr><td class=DataLabel>Address 4</td>
    <td class=DataField>
    <input type=text name=addc1 id=addc1 size=35 readonly></td>
    <td class=DataField>
    <input type=text name=addc2 id=addc2 size=35 readonly></td></tr>

<tr><td class=DataLabel>Postcode</td>
    <td class=DataField>
    <input type=text name=post1 id=post1 size=8 readonly></td>
    <td class=DataField>
    <input type=text name=post2 id=post2 size=8 readonly></td></tr>

<tr><td class=DataLabel>Create Alias</td>
    <td><input type=checkbox name=savealia id=savealia value="1"></td>
     <td>&nbsp;</td></tr>

<tr><td class=DataLabel>Keep Details</td>
     <td><input type=checkbox name=savedetl id=savedetl value="1"></td>
     <td>&nbsp;</td></tr>

<tr id="trIHI" style="display:none">
  <td class=DataLabel>IHI Number</td>
  <td><span id="spIHINumVal1"></span></td>
  <td><span id="spIHINumVal2"></span></td>
</tr>
</table>

<div id="RetentionDet" style="display:none"></div>

<table width=100% align=center border=0 cellspacing=0>
<tr><td colspan=3 align=center>
    <input type=button id="pat83sub" value=Ok class="button"
     onclick='MergePatients();'>
    <input type=reset value=Clear class="button" onclick='ClearFields();'>
    </td></tr>

</table>
</form>

<script type="text/javascript">
var UsingNEHTAid = "%STANDARD.01.025.120.158.1.1";

if (UsingNEHTAid == "1" || UsingNEHTAid == "3") {
  var rowIHI = document.getElementById('trIHI');
  if (rowIHI) {
    rowIHI.style.display = "";
  }
}
function DisplayRetention() {
  var divRetentDet = document.getElementById('RetentionDet');
  divRetentDet.innerHTML = document.getElementById('spRetentDet').innerHTML;
  if (!isWhitespace(document.getElementById('recrt001').value)) {
    divRetentDet.style.display = "";
  } else {
    divRetentDet.style.display = "none";
  }
}
</script>

<span id="spRetentDet" style="display:none">
<table width=95% align=center border=0 cellspacing=0>
<tr><td class=DataLabel width=20%>Keep these Record Retention Details</td>
    <td width=40%><input type=checkbox name=saveretn id=saveretn value="1"></td>
    <td width=40%>&nbsp;</td></tr>
<tr><td class=DataLabel align=right>%STANDARD.01.017.rt</td>
    <td><input type=text name=rper1 id=rper1 size=25 readonly></td>
    <td><input type=text name=rper2 id=rper2 size=25 readonly></td></tr>
<tr><td class=DataLabel align=right>Retention Date</td>
    <td><input type=text name=rdat1 id=rdat1 size=20 readonly></td>
    <td><input type=text name=rdat2 id=rdat2 size=20 readonly></td></tr>
</table>
</span>

<form action=patweb83.pbl name=AddForm method=post style="margin:0">
<input type=hidden name=reportno value=2>
<input type=hidden name=template value=001>
<input type=hidden name=nextpage value="1">
<input type=hidden name=redirect value="">
<input type=hidden name=oldurnum>
<input type=hidden name=newurnum>
<input type=hidden name=savealia>
<input type=hidden name=savedetl>
<input type=hidden name=saveretn>
</form>

<span id=WaitBoxDisplay class=WaitBox style="display:none">
<img class=WaitImage src="../images/wait.gif">
<p>Please Wait ...</p>
</span>

<div id=PageLayer class=DimmedLayer style="display:none"></div>
