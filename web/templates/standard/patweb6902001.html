<meta name="TemplateVersion" content="V12.01.00">
<meta name="TemplateHome" content="standard">
<meta name="HelpFileName" content="NoContextSet.html">
<script type="text/javascript" src=../js/patweb69.js></script>
<script type="text/javascript">
function SetPageHeight() {
  var DocumentHeight = getClientHeight();  // document height
  var HeadingDivision = document.getElementById('HeadingDivision');
  var BodyDivision    = document.getElementById('BodyDivision');
  var FooterDivision  = document.getElementById('FooterDivision');
  var DFrameHeading  = document.getElementById('DFrameTitleBar');

  if (window.navigator.userAgent.indexOf("MSIE") >= 1) {
    DocumentHeight += DFrameHeading.clientHeight;
  }
  else {
    DocumentHeight = document.body.clientHeight;
  }

  // Set the height of our Footer container
  FooterDivision.style.height = TableFooter.clientHeight + "px";

  // Set the height of our Body container
  BodyDivision.style.height = DocumentHeight - 
                              (DFrameHeading.clientHeight + 
                               HeadingDivision.clientHeight + 
                               FooterDivision.clientHeight) + "px";

  // Position our Body container below our table header row
  BodyDivision.style.top = DFrameHeading.clientHeight + 
                           TableHeading.clientHeight + "px";

  // Position our Footer container below our Body container
  FooterDivision.style.top = DocumentHeight - TableFooter.clientHeight + "px";

}

function FieldSelect(Chkbox, Index) {
  if (Chkbox == undefined || Index == undefined)
    return;

  var updfld = document.getElementById('updfld' + Index);
  if (updfld == undefined)
    return;

  if (Chkbox.checked)
    updfld.disabled = false;
  else
    updfld.disabled = true;
}

function ToggleSelectAll(Chkbox) {
  var bChecked = Chkbox.checked;
  var tableRef = document.getElementById('TableData');
  var aInpts = tableRef.getElementsByTagName("INPUT");
  var oUpdfld;

  for (var i=0; i < aInpts.length; i++) {
    if (aInpts[i].type == "checkbox" && aInpts[i].id.substr(0,6) == "chkfld") {
      if (!aInpts[i].disabled) {
        aInpts[i].checked = bChecked;

        oUpdfld = document.getElementById('updfld' + aInpts[i].id.substr(6,2));
        if (oUpdfld) {
          oUpdfld.disabled = (bChecked)? false: true;
        }
      }
    }
  }
}

function LoadDataDiff() {
  var sUR = document.UpdateForm.urnumber.value;
  var sUPI = document.UpdateForm.upinumbr.value;
  var sPersonID = document.UpdateForm.upinspid.value;
  var datArrUPI, datArrUR;

  if (!LHDConnect()) {
    alert("Connection to NSLHD failed !");
    return;
  }

  // Get UR patient data (array)
  datArrUR = GetURData(sUR);

  // Get UPI patient data (array);
  datArrUPI = GetUPIData(sUPI,sPersonID);

  if (datArrUR == undefined || datArrUPI == undefined)
    return;

  if (PatientDatArrDiff(datArrUR, datArrUPI)) {
    if (datArrUR.length != datArrUPI.length)
      return false;

    var tableRef = document.getElementById('TableData');
    var tableBody = tableRef.getElementsByTagName('tbody')[0];

    // Add 'Select All' checkbox as first row
    var newRow   = tableBody.insertRow(0);

    var newCell  = newRow.insertCell(0);
    newCell.className = "DataLabel";
    newCell.style.padding = "2px 5px";
    newCell.style.width = "200px";
    newCell.appendChild(document.createTextNode(""));

    var newCell  = newRow.insertCell(1);
    newCell.className = "DataLabel";
    newCell.style.padding = "2px 5px";
    newCell.style.width = "220px";
    newCell.appendChild(document.createTextNode(""));

    var newCell  = newRow.insertCell(2);
    newCell.className = "DataLabel";
    newCell.style.padding = "2px 5px";
    newCell.style.width = "220px";
    newCell.appendChild(document.createTextNode(""));

    var newCell  = newRow.insertCell(3);
    newCell.className = "DataLabel";
    newCell.style.padding = "2px 5px";
    var newChkbox = document.createElement("INPUT");
    var sFldName = "chkbxall";
    newChkbox.id = sFldName;
    newChkbox.name = sFldName;
    newChkbox.type = "checkbox";
    newChkbox.title = "Select All";
    newChkbox.onclick = function() { ToggleSelectAll(this); };
    newCell.appendChild(newChkbox);
    newCell.appendChild(document.createTextNode("Select All"));
    newChkbox.checked = true;

    for (i=0; i < datArrUR.length; i++) {
      var bDisabled = true;
      var arrVals = datArrUPI[i].split("~");
      var sNewVal = (arrVals.length > 1)? arrVals[1]: arrVals[0];

      var sVal1 = trim(datArrUR[i].split("~")[0]);
      var sVal2 = trim(datArrUPI[i].split("~")[0]);


      if (sVal1 !== sVal2) {
        var sFieldText;
        var newRow = tableBody.insertRow(tableBody.rows.length);
        bDisabled = false;  // enable update field

        //
        // Field Title
        //
        var newCell  = newRow.insertCell(0);
        newCell.className = "DataField";
        newCell.style.padding = "2px 5px";
        newCell.style.width = "200px";

        // add text to cell (with preceeding space)
        //var newText  = document.createTextNode("\u00A0" + PatDatFields[i]);
        var newText  = document.createTextNode(PatDatFields[i]);
        newCell.appendChild(newText);


        //
        // Current Value
        //
        var newCell  = newRow.insertCell(1);
        newCell.className = "DataLabel";
        newCell.style.padding = "2px 5px";
        newCell.style.width = "220px";

        arrVals = datArrUR[i].split("~");   // tilda-delimted text/value
        sFieldText = arrVals[0];

        if (arrVals.length > 1 && arrVals[1] == "-1") {
          sFieldText = "(Invalid code - " + sFieldText + ")";
        }
        else {
          if (i == ARR_INDEX_DOB || 
              i == ARR_INDEX_MEDICARE_VALID_DATE) {
            sFieldText = SetDateDDMMMYYYY(sFieldText);
          }
          else if (i == ARR_INDEX_SEX) {
            sFieldText = GetGender(sFieldText);
          }
          else if (i == ARR_INDEX_INTERPRET_REQ) {
            switch (sFieldText) {
              case 'N':
                sFieldText = "No";
                break;
              case 'Y':
                sFieldText = "Yes";
                break;
              default:
                sFieldText = "Unknown";
                break;
            }
          }
        }

        // add text to cell (with preceeding space)
        //var newText  = document.createTextNode("\u00A0" + sFieldText);
        var newText  = document.createTextNode(sFieldText);
        newCell.appendChild(newText);


        //
        // New Value
        //
        var newCell  = newRow.insertCell(2);
        newCell.className = "DataLabel";
        newCell.style.padding = "2px 5px";
        newCell.style.width = "220px";

        arrVals = datArrUPI[i].split("~");   // tilda-delimted text/value
        sFieldText = arrVals[0];
        sNewVal = arrVals.length > 1 ? arrVals[1] : arrVals[0];

        if (arrVals.length > 1 && sNewVal == "-1") {
          sFieldText = "(Invalid code - " + sFieldText + ")";
          bDisabled = true;  // invalid code; disable field update
        }
        else {
          if (i == ARR_INDEX_DOB || 
              i == ARR_INDEX_MEDICARE_VALID_DATE) {
            sFieldText = SetDateDDMMMYYYY(sFieldText);
          }
          else if (i == ARR_INDEX_SEX) {
            sFieldText = GetGender(sFieldText);
          }
          else if (i == ARR_INDEX_INTERPRET_REQ) {
            switch (sFieldText) {
              case 'N':
                sFieldText = "No";
                sNewVal = "0"; 
                break;
              case 'Y':
                sFieldText = "Yes";
                sNewVal = "1"; 
                break;
              default:
                sFieldText = "Unknown";
                sNewVal = "U"; 
                break;
            }
          }
        }

        var newText  = document.createTextNode(sFieldText);
        newCell.appendChild(newText);


        //
        // Overwrite?
        //
        var newCell  = newRow.insertCell(3);
        newCell.className = "DataLabel";
        newCell.style.padding = "2px 5px";
        var newChkbox = document.createElement("INPUT");
        var sFldName = "chkfld" + ZeroPad(i, 2);
        newChkbox.id = sFldName;
        newChkbox.name = sFldName;
        newChkbox.type = "checkbox";
        newChkbox.value = "1";
        var index = ZeroPad(i, 2) + "";
        newChkbox.onclick = (function(a,b) {
                              return function() { FieldSelect(a,b);}
                             })(newChkbox,index);
        newCell.appendChild(newChkbox);


        if (bDisabled) {
          newChkbox.checked = false;
          newChkbox.disabled = true;  // disable checkbox for update
        } 
        else {
          newChkbox.checked = true;   // default checkbox tick
        }
      }


      // add hidden (update) field with value
      var updInp = document.createElement("INPUT");
      var sFldName = "updfld" + ZeroPad(i, 2);

      updInp.id = sFldName;
      updInp.name = sFldName;
      updInp.type = "hidden";
      updInp.value = sNewVal;
      updInp.disabled = bDisabled;
      document.UpdateForm.appendChild(updInp);
    }
  }
}

function SubmitUpdate() {
  ClrUPIDataUpdateFlag();  // clear flag for data update
  SubmitHidden(UpdateForm);
}

function Cancel() {
  ClrUPIDataUpdateFlag();
  DFrameExit();
}
</script>
</head>

%START.OF.PAGE

<body onload="PageLoad(event);SetPageHeight();">
<form name=UpdateForm action="patweb69.pbl" method=post style="margin:0">
<input type=hidden name=reportno value="2">
<input type=hidden name=template value="001">
<input type=hidden name=updttype value="U">
<input type=hidden name=urnumber value="%PATWEB69.02.015">
<input type=hidden name=upinumbr value="%PATWEB69.02.016">
<input type=hidden name=upinspid value="%PATWEB69.02.018">

<span class=DFrameTitleBar>
<img align="right" alt="Exit" class="MenuIcon" 
 src="../images/ExitIcon.gif" onclick="Cancel();">
Fields to be Updated for U/R %PATWEB69.02.015
</span>


<div id=HeadingDivision style="position:absolute;width:100%;">
<table id=TableHeading width=100% border=0 cellpadding=1 cellspacing=0>
<tr>
  <td class=HeadingCell style="width:200px">Field Title</td>
  <td class=HeadingCell style="width:220px">Current Value</td>       
  <td class=HeadingCell style="width:220px">New Value</td>       
  <td class=HeadingCell>Overwrite?</td>       
</tr>
</table>
</div>

<div id=BodyDivision style="position:absolute;width:100%;">
<table id=TableData width=100% border=0 cellpadding=1 cellspacing=0>
<tbody></tbody>
</table>
</div>

<div id=FooterDivision style="position:absolute;width:100%;top:310px">
<table id=TableFooter width=100% border=0 cellpadding=1 cellspacing=1>
<tr><td align=center><hr width=95%></td></tr>
<tr>
  <td align=center class=DataField>Click OK to continue with the Update</td>
</tr>
<tr><td>&nbsp;</td></tr>
<tr>
  <td align=center>
    <input type=button class="button" value="OK" id="btnOK" 
     onclick='tempDisable(this);SubmitUpdate();'>
    <input type=button value="Cancel" class="button" onclick='Cancel()'>
  </td>
</tr>
<tr><td>&nbsp;</td></tr>
<tr><td>&nbsp;</td></tr>
</table>
</div>

</form>

<script type="text/javascript">
  // Get the data fields...
  LoadDataDiff();
</script>
