<meta name="TemplateVersion" content="V12.01.00">
<meta name="TemplateHome"    content="standard">
<meta name="HelpFileName"    content="NoContextSet.html">
<meta name="CrossBrowser" content="true">
<script type="text/javascript">
function init() {
  var p = document.AddForm;
  p.securepw.focus();

  if (p.hasfinal.value == "1") {       // Final Discharge Text exists
    p.btnFinal.checked = true;
    p.btnDraft.disabled = true;
    p.vsctm001.disabled = true;

    p.secureid.value = p.finalusr.value;
    p.secureid.readOnly = true;
    p.secureid.className = "readOnly";

    p.securepw.readOnly = true;
    p.securepw.className = "readOnly";

    p.btnCpyManNote.disabled = true;
    p.btnCpyCliNote.disabled = true;
    p.btnCpyDschNote.disabled = true;
    p.btnOK.disabled = true;

    document.getElementById('divText').innerHTML = 
      document.getElementById('txtFinal').innerHTML;
    p.visnotes.readOnly = true;
    p.visnotes.className = "readOnly";
  }
  else if (p.hasdraft.value == "1") {  // Draft Discharge Text exists
    p.btnDraft.checked = true;

    if (p.vsctm001.selectedIndex != 0)
      return;

    document.getElementById('divText').innerHTML = 
      document.getElementById('txtDraft').innerHTML;
  }
  else {
    p.btnDraft.checked = true;
  }
}

function checkID() {
  a=document.AddForm.secureid.value;
  b=document.AddForm.securepw.value;

  if (isWhitespace(a) || isWhitespace(b)) {
    alert("Please enter User ID and Password!");
    if (isWhitespace(a)) {
      document.AddForm.secureid.focus();
      return;
    }
    if (isWhitespace(b)) {
      document.AddForm.securepw.focus();
      return;
    }
  }
}

function GetTemplate() {
  linkurl = "../cgi-bin/cliweb06.pbl?reportno=06&template=006" +
            "&admissno=" + PatientLinks.admissno.value.replace(/ /g,"+") +
            "&urnumber=" + PatientLinks.urnumber.value.replace(/ /g,"+") +
            "&vsctm001=" + AddForm.vsctm001.value
  location.href=linkurl;
}

function FinalClick() {
  var p = document.AddForm;

  var ans = confirm("Once marked as Final, the Discharge Text cannot be " + 
    "edited again!\n\n" +
    "Are you sure you want to mark the Discharge Text as Final?");

  if (!ans) {
    p.btnDraft.checked = true;
  }
  else {
    p.visnotes.readOnly = true;
    p.visnotes.className = "readOnly";
  }
}

function DraftClick() {
  var p = document.AddForm;

  p.visnotes.readOnly = false;
  p.visnotes.className = "";
}

function CopyClinNotes() {
  var text = document.getElementById('txtCliNotes').innerHTML;
  InsertTextAtCursor('visnotes',GetHTMLPreTagContentsB(text));
}

function CopyManmNotes() {
  var text = document.getElementById('txtManNotes').innerHTML;
  InsertTextAtCursor('visnotes',GetHTMLPreTagContentsB(text));
}

function CopyDschNotes() {
  var text = document.getElementById('txtDischNotes').innerHTML;
  InsertTextAtCursor('visnotes',GetHTMLPreTagContentsB(text));
}

function OKSubmit() {
  var p = document.AddForm;

  if (p.btnDraft.checked) { 
    p.notetype.value = "014";  // Draft Note Type

    if (p.hasdraft.value == "1") {  // Draft exists
      p.updatety.value = "U";  // Update Text
      p.notenumb.value = "1";  // Note Number
    }
  }
  else { 
    p.notetype.value = "015";  // Final Note Type
  }

  SubmitForm();
}

</script>
</head>
%START.OF.PAGE
<body onload="PageLoad(event);">
<span class=DFrameTitleBar>
<img align="right" alt="Exit" class="MenuIcon"
 src="../images/ExitIcon.gif" onclick="DFrameExitRefresh();">
Emergency Discharge Text
</span>

<form name=AddForm action="cliweb06.pbl" method=post style="margin:0">
<input type=hidden name=reportno value="06">
<input type=hidden name=template value="006">
<input type=hidden name=nextpage value="0">
<input type=hidden name=updatety value="A">
<input type=hidden name=subfinal value="1">
<input type=hidden name=notetype value="">
<input type=hidden name=notenumb value="">
<input type=hidden name=admissno value="%CLIWEB06.06.081">
<input type=hidden name=urnumber value="%CLIWEB06.06.003">
<input type=hidden name=noteuser value="%CLIWEB06.06.105">
<input type=hidden name=hasdraft value="%CLIWEB06.06.124.014">
<input type=hidden name=hasfinal value="%CLIWEB06.06.124.015">
<input type=hidden name=finalusr value="%CLIWEB06.06.105">

<table width=98% align=center border=0 cellspacing=0 cellpadding=1>
<tr><td class=DataLabel style="width:50px">Template</td>
    <td class=DataLabel>
      <select name=vsctm001 class=SelectBig onchange="GetTemplate();">
        <option></option>
        %CLIWEB06.06.201.2
      </select>
    </td>
    <td class=DataLabel>Draft
      <input type=radio name=btn_stat id=btnDraft onclick="DraftClick();">
    </td>
</tr>
<tr><td class=DataLabel>User Id </td>
    <td style="width:250px"><input type=hidden name=securety value="2">
        <input type=text size=12 name=secureid class="Mandatory NoAutoFocus"
         title="User ID" value="%STANDARD.01.043">Password
        <input type=password size =12 name=securepw class=Mandatory
         title="Password" onfocus="SetCaretPosition('securepw',-1);"
         onblur="checkPass();">
    </td>
    <td class=DataLabel>Final
      <input type=radio name=btn_stat id=btnFinal onclick="FinalClick();">
    </td>
</tr>
</table>

<table width=98% align=center border=0 cellspacing=0 cellpadding=1>
<tr><td class=DataLabel valign=top style="width:50px">Text</td>
    <td>
      <div id=divText>
        <textarea name=visnotes id=visnotes rows=10 cols=100 
         title="Emergency Discharge Text"
         onblur="ValidateTextAreaLimits(this,99900,999,99);"
         wrap=hard>%CLIWEB06.06.202</textarea>
      </div>
    </td>
</tr>
<tr><td colspan=2 align=center>
      <input type=button class="Bigbutton" value="Copy Clinical Notes"
       name=btnCpyCliNote id=btnCpyCliNote title="Copy Clinical Notes"
       onclick="CopyClinNotes();">
      <input type=button class="Bigbutton" value="Copy Man. Notes"
       name=btnCpyManNote id=btnCpyManNote title="Copy Management Notes"
       onclick="CopyManmNotes();">
      <input type=button class="Bigbutton" value="Copy Disch Notes"
       name=btnCpyDschNote id=btnCpyDschNote title="Copy Discharge Notes"
       onclick="CopyDschNotes();">
      <input type=button class="button" value="OK" title="OK"
       name=btnOK id=btnOK onclick="tempDisable(this);OKSubmit();">
      <input type=button class="button" value="Cancel" title="Cancel"
       onclick="DFrameExitRefresh();">
    </td>
</tr>
</table>
</form>

<span id=txtDraft style="display:none">
<textarea name=visnotes id=visnotes rows=10 cols=100 wrap=hard
onblur="ValidateTextAreaLimits(this,99900,999,99);">
%CLIWEB06.06.125.014.0.1
</textarea>
</span>

<span id=txtFinal style="display:none">
<textarea name=visnotes id=visnotes rows=10 cols=100 wrap=hard
onblur="ValidateTextAreaLimits(this,99900,999,99);">
%CLIWEB06.06.125.015.0.1
</textarea>
</span>

<span id=txtCliNotes style="display:none;white-space:pre-wrap">
<pre>
%CLIWEB06.06.125.001.0.2
</pre>
</span>

<span id=txtManNotes style="display:none;white-space:pre-wrap">
<pre>
%CLIWEB06.06.125.002.0.2
</pre>
</span>

<span id=txtDischNotes style="display:none;white-space:pre-wrap">
<pre>
%CLIWEB06.06.126.019
</pre>
</span>

<form name=PatientLinks method=get style="margin:0">
<input type=hidden name=reportno value=6>
<input type=hidden name=template value=006>
<input type=hidden name=regexstm value=102>
<input type=hidden name=newstand value=1>
<input type=hidden name=admissno value="%CLIWEB06.06.081">
<input type=hidden name=urnumber value="%CLIWEB06.06.003">
<input type=hidden name=MenuType value="11">

<script type="text/javascript">
function ValidateTextAreaLimits(TextArea,MaxChars,MaxLines,MaxCharsPerLine) {
  var formattedText = formateText(TextArea,MaxCharsPerLine);

//alert(formattedText.split(/\r?\n/).length);

  if ((formattedText.split(/\r?\n/).length > MaxLines) ||
      (TextArea.value.length > MaxChars)) {
    alert(TextArea.title + " - Max " + MaxLines + " lines." +
          "\nPlease remove extra lines to continue.");
    TextArea.focus();
    return false;
  }

  // Set textarea value with new formatted text
  TextArea.value = formattedText;
}
function GetHTMLPreTagContentsB(HTML) {
  if (isWhitespace(HTML))
    return "";

  // Return the contents between <pre> and </pre> tags (including newlines)
  notetext = trim(HTML.replace(/<pre>/i,"-").replace(/<\/pre>/i,""));
  notetext = notetext.replace(/-/i,"");     // include first blank line
  notetext = notetext.replaceAll("&lt;","<");    // Convert to <
  notetext = notetext.replaceAll("&gt;",">");    // Convert to >
  notetext = notetext.replaceAll("&amp;","&");   // Convert to &
  return notetext;
}
</script>
