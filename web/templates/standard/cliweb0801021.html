<meta name="TemplateVersion" content="V12.01.00">
<meta name="TemplateHome" content="standard">
<meta name="HelpFileName" content="NoContextSet.html">
<meta name="CrossBrowser" content="true">
<script type="text/javascript" src="../js/AutoSuggestionPopup/AutoSuggestionPopup.class.js"></script>
<link   rel="stylesheet"      href="../js/AutoSuggestionPopup/AutoSuggestionPopup.css" type="text/css">
<script type=text/javascript>
function SubmitForm() {
  secureid=document.UpdateForm.secureid.value
  if (isWhitespace(secureid)) {
    alert('A Carer Must be Selected.');
    return;
  }
  RemoveLastUser();
  AddFavList();
  document.UpdateForm.submit();
}
function RemoveLastUser() {
  oldsecureid=GetCookieData("allweb0201033-secureid");
  el=document.UpdateForm.webpt002
  webpd002=el.options[el.selectedIndex].value
  if (!isWhitespace(oldsecureid)) {
    serviceURL='patweb02.pbl'
    postStr='reportno=2&updttype=D&securety=1&secureid='+oldsecureid.replace(/ /g,"+")+
            '&webpt002='+webpd002.replace(/ /g,"+") +
            '&webpt003='+document.UpdateForm.webpt003.value.replace(/ /g,"+");
    AJAXPost(serviceURL,postStr);
  }
}
function AddFavList() {
  secureid=document.UpdateForm.secureid.value
  el=document.UpdateForm.webpt002
  webpd002=el.options[el.selectedIndex].value
  webpd003='Home Visit List - ' + el.options[el.selectedIndex].text;
  serviceURL='patweb02.pbl'
  postStr='reportno=1&updttype=A&securety=1' +
          '&nextpage=1&redirect=AJAXPOST' +
          '&webpd002='+webpd002 +
          '&webpd003='+webpd003 +
          '&webpd004=&secureid='+secureid;
  AJAXPost(serviceURL,postStr);
}
function AJAXPost(serviceURL,postStr) {
  var xmlHttp = createHttpObject();
  xmlHttp.open("POST", serviceURL, false);
  xmlHttp.setRequestHeader("Content-Type", "application/x-www-form-urlencoded");
  xmlHttp.send(postStr);
  if (xmlHttp.status == "200") {
     return; /* Ignore error this just makes sure the list exists */
  } else {
      alert("Web Service Not Available. Check your Connection and Try Again.");
  }
}
function SetDefaults() {
  var d=new Date();
  listcode=GetCookieData("allweb0201033-listcode");
  document.UpdateForm.secureid.value=GetCookieData("allweb0201033-secureid");
  document.UpdateForm.username.value=GetCookieData("allweb0201033-username");
  var val=GetCookieData("allweb0201033-webpt009");
  if (!isWhitespace(val) && val!='unknown') {
    document.UpdateForm.webpt009.value=val;
  }
  document.UpdateForm.webpt010.value=GetCookieData("allweb0201033-webpt010");
  el=document.UpdateForm.webpt008;
  var webpt008=GetCookieData("allweb0201033-webpt008");
  for (var i=0;i<el.options.length;i++) {
    if (webpt008==el.options[i].value) el.selectedIndex=i;
  }
  el=document.UpdateForm.visittim;
  var defttime=GetCookieData("allweb0201033-defttime");
  visittim=document.UpdateForm.webpt010.value;
  visittim=visittim.replace(/.*Visit Time : /,"")
  visittim=visittim.replace(/ .*/,"")
  for (var i=0;i<el.options.length;i++) {
    if (visittim=="unknown"||visittim=="") {
      if (defttime==el.options[i].value) el.selectedIndex=i;
    } else {
      if (visittim==el.options[i].value) el.selectedIndex=i;
    } 
  }

  el=document.UpdateForm.treattim;
  treattim=document.UpdateForm.webpt010.value
  treattim=treattim.replace(/.*Treatment Time : /,"")
  treattim=treattim.replace(/ min/,"")
  for (var i=0;i<el.options.length;i++) {
    if (treattim==el.options[i].value) el.selectedIndex=i;
  }
  el=document.getElementById("webpt002");
  el.selectedIndex=d.getDay();
  for (var i=0;i<el.options.length;i++) {
    if (listcode==el.options[i].value) { el.selectedIndex=i; }
  }
  setCommentField()
}
function SetAddress() {
 t = new Record();    // Create New Record Object
 ur=document.UpdateForm.webpt003.value.replace(/ /g,"+");
 theURL="geocod01.php?reportno=03&urnumber="+ur
 var xmlHttp = createHttpObject();
 xmlHttp.open("GET", theURL, false);
 xmlHttp.send();
 if (xmlHttp.responseText!=""&&xmlHttp.status == 200) {
    h = document.getElementsByTagName("head")[0];
    s = document.createElement("script");
    s.type="text/javascript";
    h.appendChild(s);
    s.text=xmlHttp.responseText;
    AddRows();
 } else {
   alert('Error contacting web service. Try Again.');
   return;
 }
 secureid=document.UpdateForm.secureid.value
 if (!isWhitespace(secureid)) {
   RemoveLastUser();
   AddFavList();
   SavePatientFav();
 }

 if (isWhitespace(t.rows[0][8]))  {
  theURL="patweb07.pbl?reportno=06&template=002&urnumber="+ur
 } else {
  theURL="patweb07.pbl?reportno=06&template=003&urnumber="+ur+
         "&pmcex001="+ur+
         "&pmcex002="+t.rows[0][9].replace(/ /g,"+")+
         "&pmcex003="+t.rows[0][10].replace(/ /g,"+");
 }
 location.href=theURL;
}
function Record() {
   this.rows = new Array();
   this.addRow = _addRecordRow;
}
function _addRecordRow() {
  this.rows[this.rows.length] = new Array();
  var row = this.rows[this.rows.length-1];
  for(var i = 0; i < arguments.length; i++) 
     row[row.length] = arguments[i].replace(/\s*$/,"");
}
function setCommentField() {
  el=document.UpdateForm.visittim;
  visittim=el.options[el.selectedIndex].value;
  el=document.UpdateForm.treattim;
  treattim=el.options[el.selectedIndex].value;
  if (visittim=="") {
    document.UpdateForm.webpt010.value="";
  } else {
    document.UpdateForm.webpt010.value='Exp Visit Time : '+visittim;
  } 
  if (treattim!="") {
    document.UpdateForm.webpt010.value+=' Treatment Time : '+treattim+" min";
  }
}
function SavePatientFav() {
  serviceURL=document.UpdateForm.action;
  postStr=AJAXPostString(document.UpdateForm);
  AJAXPost(serviceURL,postStr);
}
</script>
%START.OF.PAGE
<body onload="PageLoad(event);SetDefaults()">
<span class=DFrameTitleBar>
<img align="right" alt="Exit" class="MenuIcon" 
 src="../images/ExitIcon.gif" onclick="DFrameExit();">
Assign Patient to Carer 
</span>
<div style='width:100%;text-align:center;font-weight:bold;margin:10px;'>
 %CLIWEB08.01.002 (%CLIWEB08.01.019 , %CLIWEB08.01.021,  %CLIWEB08.01.003)
</div>
<form name=UpdateForm method=post action="patweb02.pbl">
  <input type=hidden name=reportno value="2">
  <input type=hidden name=template value="1">
  <input type=hidden name=updttype value="A">
  <input type=hidden name=nextpage value="0">
  <input type=hidden name=webpt003 value="%CLIWEB08.01.003">
  <input type=hidden name=webpt004 value="%CLIWEB08.01.081">
<table align=center width=95% border=0 cellspacing=1 cellpadding=2>
<tr><td class=DataLabel>List </td>
    <td class=DataField>
    <select name=webpt002 id=webpt002 title='List Name' class='Mandatory SelectMed'>
    <option value="HV0">Sunday</option>
    <option value="HV1">Monday</option>
    <option value="HV2">Tuesday</option>
    <option value="HV3">Wednesday</option>
    <option value="HV4">Thursday</option>
    <option value="HV5">Friday</option>
    <option value="HV6">Saturday</option>
    </select>
    </td></tr>
<tr><td width=30% class=DataLabel>Carer</td>
    <td class=DataField>
    <input type=text name=username size=30 class=Mandatory title=Carer
     class="Mandatory" searchType="7" returnId="secureid" value="" 
     onfocus="this.value='';" onkeyup="AutoSuggest();">
    <input type=hidden name=secureid id=secureid>
    <input type=hidden name=securety value=1>
    </td></tr>
<tr><td class=DataLabel>Status</td>
    <td> <select name=webpt008 title="Status">
         <option></option>
         %STANDARD.01.007.wv
          </select>
     </td></tr>
<tr><td class=DataLabel>Comment</td>
    <td><input type=text name=webpt009 title="Comment" size=60 maxlength=60>
     </td></tr>
<tr><td class=DataLabel>Expected Visit Time</td>
    <td><select name=visittim onchange='setCommentField();'>
        <option value="">Select Time</option>
        <option value="07:00">07:00</option>
        <option value="07:30">07:30</option>
        <option value="08:00">08:00</option>
        <option value="08:30">08:30</option>
        <option value="09:00">09:00</option>
        <option value="09:30">09:30</option>
        <option value="10:00">10:00</option>
        <option value="10:30">10:30</option>
        <option value="11:00">11:00</option>
        <option value="11:30">11:30</option>
        <option value="12:00">12:00</option>
        <option value="12:30">12:30</option>
        <option value="13:00">13:00</option>
        <option value="13:30">13:30</option>
        <option value="14:00">14:00</option>
        <option value="14:30">14:30</option>
        <option value="15:00">15:00</option>
        <option value="15:30">15:30</option>
        <option value="16:00">16:00</option>
        <option value="16:30">16:30</option>
        <option value="17:00">17:00</option>
        <option value="17:30">17:30</option>
        <option value="18:00">18:00</option>
        <option value="18:30">18:30</option>
        </select>
        <input type=hidden name=webpt010>
     </td></tr>
<tr><td class=DataLabel>Expected Treatment Time</td>
    <td><select name=treattim onchange='setCommentField();'>
        <option value="">Select Time</option>
        <option value="20">20 minutes</option>
        <option value="30">30 minutes</option>
        <option value="45">45 minutes</option>
        <option value="60">60 minutes</option>
        <option value="90">90 minutes</option>
        <option value="120">120 minutes</option>
        </select>
     </td></tr>
<tr><td colspan=2 align=center><br><br>
    <input type=button value="Update" class="button" onclick='SubmitForm();'>
    <input type=button value="Close" class="button" onclick="DFrameExitRefresh()">
    <input type=button value="Set Address" class="button" onclick="SetAddress();">
</td></tr>
</table>
</form>
<div id='-suggestion-panel-wrapper' style='display:none;'>
 <div id='-suggestion-panel-wrapper2' style='width:100%'>
  <ul id='-suggestion-table' style='width:100%'></ul>
 </div>
</div>
