<meta name="TemplateVersion" content="V12.01.00">
<meta name="TemplateHome" content="standard">
<meta name="CrossBrowser" content="true">
<meta name="HelpFileName" content="NoContextSet.html">
<script type="text/javascript">
function init(){
 document.AddForm.nzspr008[2].checked=1;
 if(document.AddForm.theatref.value=="1"){
   alert("Patient has multiple theatre bookings.\n" +
         " Please enter details through theatre. ");
   document.getElementById('pat89sub').disabled=true;
 }
 document.AddForm.nzspr008[2].checked=1;

 if (document.getElementById("nzspr013").value=="1") {
   document.getElementById("d_nzspr013").checked=true;
 }
}
function CheckIns() {
  f = document.AddForm;
  if(document.AddForm.nzspr014.value.substr(3,1)=="O") {
    savicomm = "";
    if (document.getElementById("icomment") !=undefined) {
      savicomm = document.getElementById("icomment").value; 
    }
    InsurerField.innerHTML=InsurerText.innerHTML;
    f.icomment.value=trim(savicomm);
  } else {
    InsurerField.innerHTML="";
  }
}
function setFullDesc() {
  document.AddForm.nzspr010.value=document.AddForm.mbsdesc1.value;
}
function RefreshSubmit() {
  p=document.AddForm
  if(p.nzspr002.value.substr(9,1)==" "&& document.AddForm.nzspr006.value!=""){
    alert("No Contract can be assigned.")
    return;
  }
  if (document.getElementById("d_nzspr013").checked==true) {
     document.getElementById("nzspr013").value="1";
  } else {
     document.getElementById("nzspr013").value="0";
  }
  if(document.AddForm.nzspr007.value!=""|
    (p.nzspr002.value.substr(9,1)!="F" && p.nzspr002.value.substr(9,1)!="P")){
    if (validateMandatory(AddForm)) {
      AddForm.submit();  
      return;
    } else {return;}
  }
  validateContract(p.nzspr002,p.nzspr004,p.nzspr003,p.nzspr006,p.nzhosp,p.dummy,p.nzadat,p.retcount,p.retcontr,p.retcdesc);
    if(p.retcount.value==0){
       alert("No Contract Procedure Code can be assigned.");
       return;
    }
    if(p.retcount.value==1){
      ans=confirm("Assigned Contract Procedure Code is : " + p.retcontr.value + 
              "\n" + p.retcdesc.value + "\nClick OK to accept or cancel " +
              "to change contract details.")
      if(ans==true){
         document.AddForm.nzspr007.value=p.retcontr.value;
         RefreshSubmit();
      } else {
         document.AddForm.nzspr007.value="";
         return;} 
    }
    if(p.retcount.value>1){
      ans=confirm("More than one Contract Procedure Code can be assigned." +
              "\nClick OK to Review or cancel " +
              "to change contract details.")
      if(ans==true){
        ContractProcedureCodeSearchFrame(p.nzspr002,p.nzspr004,p.nzspr003,
        p.nzspr006,p.nzhosp,p.dummy,p.nzadat,AddForm.nzspr007,AddForm.dummy);
        return;
      } else {
        return;}
    }
}
function claimDetails(){
 if(document.AddForm.nzspr008[2].checked=="1"){
     ClaimCodeHeading.innerHTML=claimcodehd.innerHTML;
     ClaimCode.innerHTML=claimcode.innerHTML;
     ContractHeading.innerHTML=contracthd.innerHTML;
     Contract.innerHTML=contract.innerHTML;
   }else{
     ClaimCodeHeading.innerHTML="";
     ClaimCode.innerHTML=claimcodeblank.innerHTML;
     ContractHeading.innerHTML="";
     Contract.innerHTML=contractblank.innerHTML;
  }
}
function ToggleMandatoryFields(){
  da = document.AddForm;
  var contractTypeIndicator9 = da.nzspr002.value.substr(11,1);
  da.nzspr015.className="";
  da.nzspr017.className="";

  if(contractTypeIndicator9=="A"){
     da.nzspr015.className="Mandatory";
  }
  else if(contractTypeIndicator9=="B"){
     da.nzspr017.className="Mandatory";
  }
  else if(contractTypeIndicator9=="C"){
     da.nzspr015.className="Mandatory";
     da.nzspr017.className="Mandatory";
  }
  checkCntrMandatory();
}
function checkCntrMandatory(){
 if((trim(document.AddForm.nzspr002.value.substr(9,1))=="F")||
   (trim(document.AddForm.nzspr002.value.substr(9,1))=="P")){
     document.AddForm.nzspr006.className="Mandatory";
     document.AddForm.nzspr007.className="Mandatory";
   }else{
     document.AddForm.nzspr006.className="";
     document.AddForm.nzspr007.className="";
  }
}
function InsuranceUpd() {
  f = document.AddForm;
  ind7 = f.nzspr002.value.substr(9,1);
  ind10 = f.nzspr002.value.substr(12,1);
  ind27 = f.nzspr002.value.substr(44,1);
//alert('ind7=' + ind7 + ' ind10=' + ind10 + ' ind27=' + ind27);
  if (ind10=="A") {
    if (document.getElementById("d_nzspr013").checked==true) {
      f.nzspr014.className="Mandatory";
      f.nzspr014.disabled=false;
      f.nzspr015.className="Mandatory";
      f.nzspr015.disabled=false;
      f.nzspr017.disabled=false;
      f.nzspr024.disabled=false;
      f.d_nzspr016.disabled=false;
    }
    else {
      if (ind27=="I") {
        f.nzspr014.className="Mandatory";
        f.nzspr014.disabled=false;
      }
      else {
        f.nzspr014.className="";
      }
      f.nzspr015.className="";
      f.nzspr015.disabled=true;
      f.nzspr017.disabled=true;
      f.nzspr024.disabled=true;
      f.d_nzspr016.disabled=true;
      f.d_nzspr016.checked=false;
    }
  }
  else {
    if (ind27=="I") {
      f.nzspr014.className="Mandatory";
      f.nzspr014.disabled=false;
    }
    else {
      f.nzspr014.className="";
    }
    f.nzspr015.disabled=false;
    f.d_nzspr016.disabled=false;
    f.nzspr017.disabled=false;
    f.nzspr024.disabled=false;
  }
  CheckIns()
}
</script>
</head>
%START.OF.PAGE
<body onload="PageLoad(event);claimDetails();ToggleMandatoryFields();InsuranceUpd();">
<span class=DFrameTitleBar>
<img align="right" alt="Exit" class="MenuIcon" 
 src="../images/ExitIcon.gif" onclick="DFrameExit();">
Add Procedure
</span>
<form name=AddForm action="patweb89.pbl" method=get style="margin:0">
<input type=hidden name=reportno value=9>
<input type=hidden name=template value=2>
<input type=hidden name=urnumber value="%PATWEB89.09.003">
<input type=hidden name=nzspr001 value="%PATWEB89.09.081">
<input type=hidden name=admissno value="%PATWEB89.09.081">
<input type=hidden name=updttype value="A">
<input type=hidden name=nzhosp value="%PATWEB89.09.498.013.1">
<input type=hidden name=nzadat id=nzadat value="%PATWEB89.09.102">
<input type=hidden name=redirect value="%PATWEB89.09.001.patweb89.09.001">
<input type=hidden name=nextpage value="2">
<input type=hidden name=retcount value="">
<input type=hidden name=retcontr value="">
<input type=hidden name=retcdesc value="">
<input type=hidden name=nzspr013 id=nzspr013 value="">
<input type=hidden name=theadura value="1">
<input type=hidden name=uniqueky value="%PATWEB89.09.307">
<input type=hidden name=theatref value="%PATWEB89.09.306">
<input type=hidden name=nzspr007 
       class=mandatory title="Contract Procedure Code">

<table border=0 width=95% cellspacing=0 align=center>
<tr><td width=25% class=DataLabel>Procedure</td>
    <td class=DataLabel>
        <input type=text name=nzspr004 size=10 maxlength=9 
        onblur='validateCode(4,AddForm.nzspr004,mbsdesc1,nzadat);setFullDesc();' 
        class=Mandatory
        title="Procedure">
        <input type=text notab readonly name=mbsdesc1 id =mbsdesc1
         size=35 value="">
        <img notab src="../images/SearchIcon.gif" class=Icon
        onclick="MbsSearchFrame(AddForm.nzspr004,mbsdesc1,nzadat)"> </td>

<tr><td class=DataLabel>Full Description</td>
    <td><input type=text name=nzspr010 title="Procedure Description"
         size=120 maxlength=80>
    </td></tr>

<tr><td></td>
    <td>
    <input type=radio name=nzspr008 value="1" disabled>Primary Procedure
    <input type=radio name=nzspr008 value="2" onclick='claimDetails();'>Include with Primary
    <input type=radio name=nzspr008 value="0" onclick='claimDetails();'>Bill as Separate
    </td></tr>
    <tr><td>
        <div id=ClaimCodeHeading></div></td>
              <td><div id=ClaimCode></div></td></tr>
    <tr><td>
        <div id=ContractHeading></div></td>
              <td colspan=2><div id=Contract></div></td></tr>

<tr><td class=DataLabel>Surgeon</td>
   <td><input type=text name=nzspr003 id=nzspr003
        size=10 maxlength=8 title="Surgeon"
        class=Mandatory value="%PATWEB89.09.108.003"
        onchange="ValidateHCP(18,0,nzspr003,n_nzspr003);">
    <input type=text name=n_nzspr003 id=n_nzspr003 
     value="%PATWEB89.09.108.002" >
    <img src="../images/SearchIcon.gif" class=Icon
     onclick="HCPSearchFrame(nzspr003,n_nzspr003,1)">
    <img src="../images/erase.gif" class=Icon
     onclick="clrFields(nzspr003,n_nzspr003);">
    </td></tr>

    <tr><td class=DataLabel>Approval Number</td>
    <td class=DataLabel>
        <input type=text name=nzspr015 size=20 maxlength=20></tr>

    <tr><td class=DataLabel>Claim Number</td> <td class=DataLabel>
        <input type=text name=nzspr017 size=20 maxlength=20></td></tr>
    <tr><td class=DataLabel>Approval Expiry Date </td>
        <td><input type=text size=12 name=nzspr024 id=nzspr024
              title="Approval Expiry Date"
              onBlur="checkDate(this,'ApprovalDate')">
         <img notab src=../images/CalendarLookup.gif class=Icon
          onclick="DateLookupFrame(nzspr024);">
        <img notab src=../images/DateTimeStamp.gif class=Icon
         onclick="SetCurrentDateTime(nzspr024,null);">
      </td></tr>

    <tr><td class=DataLabel>Patient Insurance</td>
        <td><input type=CheckBox value="%PATWEB89.09.213" 
             id="d_nzspr013" name="d_nzspr013" onclick="InsuranceUpd();"/>
        </td>
     </tr>
</table>

<table border=0 width=95% cellspacing=0 align=center>
    <tr><td width=25% class=DataLabel>Insurer</td>
      <td class=DataField>
      <table><tr><td>
      <select name=nzspr014 title="Insurer" onchange="CheckIns();">
      <option></option>
      %PATWEB89.09.214.2
      </select></td>
      <td><div id="InsurerField"></div></td></tr></table>
      </td>
      <td class=DataLabel>Session</td>
      <td class=DataField><input type=text readonly value="%PATWEB89.09.308"
       size=20 title="Session" class=readonly tabindex=-1></td>
    </tr>

    <tr><td class=DataLabel>Prior Approval Sighted</td>
        <td><input type="hidden" class="CheckBox" value="%PATWEB89.09.216"
                   name="nzspr016" id="nzspr016" /></td>
        <td class=DataLabel>Unique ID</td>
        <td class=DataField><input type=text readonly value="%PATWEB89.09.307"
        size=10 title="Unique ID" class=readonly tabindex=-1></td>
    </tr>
</table>

<table border=0 width=95% cellspacing=0 align=center>
<tr><td width=25% class=DataLabel>Comments</td>
    <td><input type=text name=nzspr019 size=50 maxlength=30></td>
</tr>

<tr><td>&nbsp;</td></tr>
<tr><td colspan=2 align=center>
    <input type=button class="button" value="Add" 
     id="pat89sub" onclick='tempDisable(this);RefreshSubmit();'>
    <input type=button value="Cancel" class="button" onclick='DFrameClose()'>
</td></tr>
</table>
</form>
<span id=claimcodehd style="display:none">
%STANDARD.01.017.CL
</span>
<span id=claimcode style="display:none">
    <select name=nzspr002 title="%STANDARD.01.017.CL"
     class=Mandatory onchange="ToggleMandatoryFields();InsuranceUpd();">
    <option></option>
    %PATWEB89.09.202.2
    </select>
</span>
<span id=contracthd style="display:none">
Contract
</span>
<span id=contract style="display:none">
         <input type=text size=6 maxlength=6 name=nzspr006
         title="Contract" class=Mandatory
         onchange="validateCode(16,document.AddForm.nzspr006,funddesc);">
        <input type=text size=35 name="funddesc" maxlength="30"
         readonly notab>
        <input type="hidden" name="dummy">
        <img src=../images/SearchIcon.gif class=Icon
         onclick="HFundSearchFrameNoFocus(AddForm.nzspr006,AddForm.funddesc,
                                               AddForm.dummy,AddForm.dummy);">
        <img src="../images/erase.gif" class=Icon
         onclick="clrFields(AddForm.nzspr006,AddForm.funddesc,AddForm.dummy,AddForm.dummy);">
</span>
<span id=claimcodeblank style="display:none">
   <input type=hidden name=nzspr002 value="%PATWEB89.09.202.1">
</span>
<span id=contractblank style="display:none">
   <input type=hidden name=nzspr006 value="%PATWEB89.09.206.0">
</span>
<span id="InsurerText" style="display:none">
        <input type="text" size=50 maxlength=50 name=i0comment id=icomment 
        class=Mandatory title="Insurer Free text">
</span>
