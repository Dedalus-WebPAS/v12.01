<meta name="TemplateVersion" content="V12.01.00">
<meta name="TemplateHome" content="standard">
<meta name="HelpFileName" content="NoContextSet.html">
<meta name="CrossBrowser" content="true">
<script type="text/javascript" src="../js/EmrMandatory.js"></script>
<script type="text/javascript" src="../js/emrweb0202010.js"></script>
<script type="text/javascript">
function setTriage() {
  document.UpdateForm.checkTri.value=1;
  if (validateMandatory(UpdateForm)) {
    document.UpdateForm.formactn.value="SP";
    tmp=document.UpdateForm.emexp001.value;
    document.UpdateForm.emexp001.value=tmp.replace(/ /g,"+");
    document.UpdateForm.submit();
    }
}
function setRegistration() {
  document.UpdateForm.checkTri.value=1;
  if (validateMandatory(UpdateForm)) {
    document.UpdateForm.formactn.value="SP"
    tmp=document.UpdateForm.emexp001.value;
    document.UpdateForm.emexp001.value=tmp.replace(/ /g,"+");
    document.UpdateForm.template.value="021";
    document.UpdateForm.submit();
    }
}
function setDelete() {
 ans=confirm("Are you sure you want to Delete this record ?")
 if (ans) { 
  if (validateMandatory(UpdateForm)) {
    document.UpdateForm.checksen.value=1;
    document.UpdateForm.formactn.value="AD";
    document.UpdateForm.nextpage.value="17";
    document.UpdateForm.redirect.value="emrweb01.pbl?reportno=1&template=009";
    tmp=document.UpdateForm.emexp001.value;
    document.UpdateForm.emexp001.value=tmp.replace(/ /g,"+");
    document.UpdateForm.submit();
    }
  }
  else { return;}
}
function setUpdate() {
  document.UpdateForm.checksen.value=1;
  if (validateMandatory(UpdateForm)) {
    document.UpdateForm.formactn.value="AU";
    document.UpdateForm.nextpage.value="2";
    document.UpdateForm.redirect.value="emrweb01.pbl?reportno=1&template=009";
    tmp=document.UpdateForm.emexp001.value;
    document.UpdateForm.emexp001.value=tmp.replace(/ /g,"+");
    document.UpdateForm.submit();
  }
}
function FN(Name) {
NameFields=Name.split(" ");
 if (NameFields.length > 1) {
  Surname=NameFields[2].substr(0,25);
  FName=NameFields[1].substr(0,25);
  Title=NameFields[0].substr(0,1) + NameFields[0].substr(1,5).toLowerCase();
document.UpdateForm.emexp002.value=trim(Surname);
document.UpdateForm.emexp003.value=trim(FName);
 }
}
function CheckCode(code,selectlist)  {
  var found=0;
  strvar=code.value+"   ";        // format as three characters space filled
  code.value=strvar.substr(0,3);
  for(var i=0; i<selectlist.length; i++) {
    if(selectlist.options[i].value.substr(0,3)==code.value) {
      found=1; 
      selectlist.selectedIndex=i; 
    } 
  }
  if(found==0){ 
    alert("Invalid Code Entered");
    code.focus(); 
  }
}
function UpdateCode(code,selectlist) {
  code.value=selectlist.value.substr(0,3);
  UpdateForm.comptext.focus();
}
function setRedirect() {
  if (window.name == "content") {
     document.UpdateForm.redirect.value="emrweb01.pbl?reportno=1&template=2";
   }
  else {
     document.UpdateForm.redirect.value="emrweb01.pbl?reportno=1&template=1";
  }
}
function setFormactn() {
  if (validateMandatory(UpdateForm)) {
    document.UpdateForm.formactn.value="N1";
    document.UpdateForm.updttype.value="REGIS";
    UpdateWin=window.open("","HideUpdateWindow",
    "width=10,height=10,top=1024,directories=no,location=no" +
    ",scrollbars=no,status=no,toolbar=no,menubar=no,resizable=no");
    document.UpdateForm.target="HideUpdateWindow";
    document.UpdateForm.submit();
    }
}
function dispSex(){
  for(var i=0; i<document.UpdateForm.emexp004.length; i++) {
    if(document.UpdateForm.emexp004.options[i].value.substr(0,1)==UpdateForm.selsex.value.substr(0,1)) {
       document.UpdateForm.emexp004.selectedIndex=i;
    }
  }
}
function submitFormRedirect() {
  if(IsDirty(UpdateForm)){
    if(document.UpdateForm.checksen.value==1) {return;}
    if(document.UpdateForm.checkTri.value==1) {return;}
    SubmitForm();
  }
}
function SubmitForm() {
  setUpdate();
}
function IsDirty(eForm) {
  for(var i=0; i<eForm.length; i++) {
      var eElem = eForm.elements[i];
      if("text" == eElem.type || "textarea" == eElem.tagName){
         if(trim(eElem.value) != trim(eElem.defaultValue)){
            if(eElem.name=="prcom001"){
               if(UpdateForm.prcom001.value == UpdateForm.savdesc1.value){
                  return false; 
               }
            }
            return true;
         }
      }
  }
  return false;
}
function checkWhite(UR) {

  if(isWhitespace(UR.value)) { 
     ToggleDetails(UpdateForm.emexp018,detailsArray);
     return;
  }
  if(UpdateForm.emexp018.value != UpdateForm.emexp018.defaultValue) {
     justifyRight(UR);
     PatientReturn();
  }
  ToggleDetails(UpdateForm.emexp018,detailsArray);
}
function Validateprecom001() {
  var formatedtext=formateText(UpdateForm.prcom001,'50');
  if (formatedtext.split(/[\r\n]/).length > 6) {
      alert("Presenting Complaint Comments - Max 6 lines."
           +"\nPlease remove extra line(s) to continue.");
    FocusDelay(document.UpdateForm.prcom001);
    return; 
  }
  else if (formatedtext.replace(/\r?\n/gm,"").length > 300) {
    alert("Presenting Complaint Comments - Max 300 characters." +
          "\nPlease remove the extra character(s) to continue.");
    FocusDelay(document.UpdateForm.prcom001);
    return;
  }

  UpdateForm.prcom001.value=UpdateForm.prcom001.value.replace("\\","");
}
function CheckTextLimit(TextArea) {
  if (!LimitText(TextArea,6,300)) {
    TextArea.onblur = null;  // clear to prevent infinite loop with alerts
    window.setTimeout(function () {
      TextArea.onblur = function() {
        TextareaBlurHandler(TextArea);
        Validateprecom001();
      }
    },100);
  }
}
function ValidatePasteData(TextArea) {
  var evt = window.event;
  var clipboard = evt.clipboardData;
  var clipData = clipboard.getData('text/plain');
  var title = TextArea.title;

  var maxRows=6;
  if ((clipData.split(/\r?\n/).length > maxRows)) {
    alert("Maximum " + maxRows + " lines reached for " + title + "." +
          "\nPlease remove the extra line(s) to continue.");
    FocusDelay(TextArea);
    return;
  }

  var maxChars=300;
  if (clipData.replace(/\r?\n/gm,"").length > maxChars) {
    alert("Maximum " + maxChars + " characters reached for " + title + "." +
          "\nPlease remove the extra character(s) to continue.");
    FocusDelay(TextArea);
    return;
  }
}
</script>
</head>
%START.OF.PAGE
<body onLoad="PageLoad(event);" onBeforeUnload="submitFormRedirect();">
<span class=DFrameTitleBar>
Update Expected Emergency Patient
</span>
<div id=PageBodySection style="overflow: auto;">
<form name=UpdateForm action="emrweb02.pbl" method=post style="margin:0"
 onsubmit='return validateMandatory(this);'>
<input type=hidden name=reportno value="02">
<input type=hidden name=template value="012">
<input type=hidden name=formactn>
<input type=hidden name=updttype>
<input type=hidden name=updateky value="">
<input type=hidden name=nextpage value="1">
<input type=hidden name=redirect>
<input type=hidden name=emexp001 value="%EMRWEB02.02.410">
<input type=hidden name=selsex>
<input type=hidden name=dummyadm>
<input type=hidden name=dummsrch value="1">
<input type=hidden name=gname>
<input type=hidden name=sname>
<input type=hidden name=savdesc1>
<input type=hidden name=dummy>
<input type=hidden name=dummy1>
<input type=hidden name=dummy2>
<input type=hidden name=checksen value="0">
<input type=hidden name=checkTri value="0">
<input type=hidden name=patsname value="%EMRWEB02.02.411">
<input type=hidden name=patgname value="%EMRWEB02.02.412">
<input type=hidden name=deceased>
<input type=hidden name=emexpsit value="%EMRWEB02.02.533">
<input type=hidden name=ptcnhdps value="%STANDARD.01.025.080.250.1.1">

<table align=center width=95% border=0 cellspacing=0 cellpadding=2>
<tr><td class=DataLabel>U/R </td>
    <td>
    <input type=text size=10 maxlength=8 name=emexp018 tabindex=4 value="%EMRWEB02.02.435" 
     onchange="UpCase(this);checkWhite(this);"> 
    <img class=Icon src=../images/SearchIcon.gif onclick="PatientSearch();">
    </td>
    <td class=DataLabel>Surname </td>
    <td><input type=text size=25 maxlength=25 name=emexp002 tabindex=5
         value="%EMRWEB02.02.411"></td>
    <td class=DataLabel>Given Name </td>
    <td><input type="text" size=25 maxlength=25 name=emexp003 tabindex=6
        value="%EMRWEB02.02.412"></td>
    <td class=DataLabel>Amb Case No</td>
    <td><input type=text size=10 maxlength=15 name=emexp026 tabindex=7
         value="%EMRWEB02.02.469" title="Amb Case No">
    </td>
    </tr>

<tr><td class=DataLabel>User Id</td>
    <td><input type="text" size=10 max=8 name=nuserid tabindex=8
        value="%EMRWEB02.02.427.1" class=Readonly readonly></td>
    <td class=DataLabel>%STANDARD.01.017.G </td>
    <td><select name=emexp004 class=SelectSml tabindex=9>
        <option> </option>
        %EMRWEB02.02.086.099.061.9.1.19.3.H
        </select></td>
    <td class=DataLabel>Date of Birth </td>
    <td><input type="text" size=12 max=11 name=emexp005 
         value="%EMRWEB02.02.414" tabindex=10
         title="Date of Birth" class="Past Date">
        <img class=Icon src=../images/DateTimeStamp.gif 
         date=document.UpdateForm.emexp005>
        <img class=Icon src=../images/DateLookup.gif 
         date=document.UpdateForm.emexp005>
        </td>
    <td class=DataLabel>Accepting Source</td>
    <td><select name=emexp020 class=SelectMed tabindex=11>
        <option></option>
        %EMRWEB02.02.463.2
        </select></td>
    </tr>
</table>
<table align=center width=95% border=0 cellspacing=0 cellpadding=2>
<tr><td colspan=6><hr></td></tr>
<tr><td class=DataLabel>Time Notified</td>
    <td>
    <input type="text" name=emexp015 size="12"  tabindex=12
    class="Mandatory Date" title="Triage Date" value="%EMRWEB02.02.424"
    onblur="checkDate(UpdateForm.emexp015,'Triage Date')" >
    <img src=../images/DateLookup.gif class=Icon date=UpdateForm.emexp015>
    Time <input type="text" name=emexp016 size="8"  tabindex=13
    class=Mandatory title="Triage Time" value="%EMRWEB02.02.425"
    onblur="checkTime(UpdateForm.emexp016,'Triage Time')">
    <img src=../images/TimeLookup.gif class=Icon time=UpdateForm.emexp016>
    <img src="../images/DateTimeStamp.gif" class=Icon
    date=UpdateForm.emexp015 time=UpdateForm.emexp016>
    </td>
    <td class=DataLabel>ETA</td>
    <td>
    <input type="text" name=emexp022 size="12"  tabindex=14
    class="Date" title="Triage Date" value="%EMRWEB02.02.465"
    onblur="checkDate(UpdateForm.emexp022,'ETA Date')" >
    <img src=../images/DateLookup.gif class=Icon date=UpdateForm.emexp022>
    Time <input type="text" name=emexp023 size="8"  tabindex=15
    title="ETA Time" value="%EMRWEB02.02.466"
    onblur="checkTime(UpdateForm.emexp023,'Triage Time')">
    <img src=../images/TimeLookup.gif class=Icon time=UpdateForm.emexp023>
    <img src="../images/DateTimeStamp.gif" class=Icon
    date=UpdateForm.emexp022 time=UpdateForm.emexp023>
    </td>
    <td class=DataLabel>Expected Location</td>
    <td>
    <select class=SelectMed name=emexp025 tabindex=16 title="Expected Location">
    <option></option>
     %EMRWEB02.02.468
    </select>
    </td>
    </tr>

<tr valign=top><td class=DataLabel width=15%>Presenting Complaint </td>
    <td>
    <input type=hidden name=emrviscat value="el">
    <input type=text size=10 tabindex=17 name=test
          value="%EMRWEB02.02.416.1"
          onKeyUp="LookupPresComp(event,this,UpdateForm.emexp007,
                   UpdateForm.emrviscat);">
    <select name=emexp007 class=SelectBig>
    <option value="%EMRWEB02.02.416.1">%EMRWEB02.02.416.0</option>
    </select>
    </td>
    <td colspan=5>
    <textarea type=text valign=top name=prcom001 id=prcom001 tabindex=18
     title="Presenting Complaint Comments" wrap=hard cols=50 rows=6
     style="overflow-y:hidden" class=AsciiOnly
     onkeydown="ValidateKeyInput(this);"
     onblur="TextareaBlurHandler(this);ValidateTextLimits(this);">
    </textarea>
    </td></tr>

<tr><td colspan=6 align=center><br>
    <input type=button value="Update" class="button" tabindex=20 id="emr02u"
     onclick="tempDisable(this);setUpdate();">
    <input type=button value="Register" class="button" tabindex=31
     onclick="setRegistration();">
    <input type=button value="Triage" class="button" tabindex=21
     onclick="setTriage();">
    <input type=button value="Cancel" class="button" tabindex=22
     onclick="location.href='emrweb01.pbl?reportno=01&template=009'">
    <input type=button value="Delete" class="button" tabindex=23
     onclick="setDelete();">
    </td></tr>
</table>
</form>
</div>
<script type="text/javascript">

detailsArray = [document.UpdateForm.emexp002,document.UpdateForm.emexp003,
                document.UpdateForm.emexp004,document.UpdateForm.emexp005];

function init(){
  for (var i=0; i<document.UpdateForm.emexp004.length; i++) {
    if(document.UpdateForm.emexp004.options[i].value.substr(0,1)=="%EMRWEB02.02.413") {
       document.UpdateForm.emexp004.selectedIndex=i; 
    } 
  }

  var str1= trim("%EMRWEB02.02.417");
  if(!isWhitespace(str1)) { str1+="\n";}
  var str2= trim("%EMRWEB02.02.418");
  if(!isWhitespace(str2)) { str2+="\n";}
  var str3= trim("%EMRWEB02.02.419");
  if(!isWhitespace(str3)) { str3+="\n";}
  var str4= trim("%EMRWEB02.02.420");
  if(!isWhitespace(str4)) { str4+="\n";}
  var str5= trim("%EMRWEB02.02.421");
  if(!isWhitespace(str5)) { str5+="\n";}
  var str6= trim("%EMRWEB02.02.422");

  UpdateForm.prcom001.value=str1+str2+str3+str4+str5+str6;
  UpdateForm.savdesc1.value=str1+str2+str3+str4+str5+str6;

  if (!isWhitespace(document.UpdateForm.emexp018.value)) {
     ToggleDetails(UpdateForm.emexp018,detailsArray);
  }
}
</script>
