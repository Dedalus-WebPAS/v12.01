<meta name="TemplateVersion" content="V12.01.00">
<meta name="TemplateHome" content="standard">
<meta name="HelpFileName" content="NoContextSet.html">
<meta name="CrossBrowser" content="true">
<script type="text/javascript" src="../js/TableSort.js"> </script>
<script type="text/javascript" src="../js/TableSort1.js"></script>
<script type="text/javascript">
function ReferralLink(ReferralKey,ReferralDep,ReferralDate,PrimaryRef,DntAllowCnts) {
  var apptDate = document.PatientLinks.clindate.value;
  if(apptDate != "        ") {
    if(apptDate < ReferralDate) {
      alert("Referral Date must be on or before Appointment Date (" +
      SetDateDDMMMYYYY(apptDate) + ")");
      return;
    }
  }
/*  this code needs to be done only for NZ */
  if (document.PatientLinks.ptcnhdps.value=="1") {
   if (PrimaryRef == "1" && DntAllowCnts == "1") {
      alert("Appointments are not allowed to be booked for the Primary Referral for this department.");
      return;
   }
  }
  
  parent.LinkToReferral(PatientLinks.urnumber.value,ReferralKey);

  if (document.PatientLinks.lnrfckie.value == "1") {
    DFrameExit();
  }
}
function FilterReferral() {
  document.PatientLinks.filtstat.value=document.getElementById("d_filtstat").value;
  PatientLinkDFrame('allweb02.pbl',2,25,0,0,0);
}
function RequestLink(RequestKey,RefDate) {
  var apptDate = document.PatientLinks.clindate.value;
  if(apptDate != "        ")
  {
    if(apptDate < RefDate)
    {
      alert("Referral Date must be on or before Appointment Date (" +
      SetDateDDMMMYYYY(apptDate) + ")");
      return;
    }
  }
  parent.LinkToAppointmentRequest(PatientLinks.urnumber.value,RequestKey);
  if (document.PatientLinks.lnrfckie.value == "1") {
    DFrameExit();
  }

}
//----------------------------------------------------------------------------
// Create New Table Object
// Border, Cellspacing, Cellpadding, Width, Align, Heading Height, Row Height
//----------------------------------------------------------------------------
// Add Columns in Order Required
// Heading,Type,Display Column,Sort Column, Align, Icon, Link Column
// Columns Available
// 0. Referral Link
// 1. Department Description
// 2. Referral Date
// 3. Status Description
// 4. Referred By
// 5. Problem Description
// 6. Referral/Visit Number
// 7. Last Encounter Date
// 8. Priority
// 9. Compensation
// |
// 21.Linked Referral
// 22.Compensation Desc
// 23.Case Team Code
// 24.Case Team Desc
// 25.Responsible HCP code
// 26.Responsible HCP Name
//---------------------------------------------------------------------------
function InitTable(TableView) {
  document.title = "Allied Health Referrals";
  switch (TableView) {
  case 0: {
    t = new Table(1,0,2,"100%","center",35);
    t.addColumn("Date","Date",2,2,"left","EditIcon.gif","0",90)
    t.addColumn("Department","String",1,1,"left","","",110)
    t.addColumn("Problem","String",33,33,"left","","",90)
    t.addColumn("Referred By","String",4,4,"left","","",90)
    t.addColumn("Responsible HCP","String",26,26,"left","","",110)
    t.addColumn("Type/Link","String",21,21,"left","","",90)
    t.addColumn("Status","String",3,3,"left","","",50)
    AddTableRows()
    t.sortTable(1,1);    // By Department
    TableOutput(0,2);    // By Date Order Column,Asc Dsc
    break; }
  case 1: {
    t = new Table(1,0,2,"100%","center",35);
    t.addColumn("Date","Date",2,2,"right","EditIcon.gif","0",100,"","","",32)
    t.addColumn("Department","String",1,1,"left","","",100)
    t.addColumn("Problem","String",33,33,"left","","",90)
    t.addColumn("Referred By","String",4,4,"left","","",90)
    t.addColumn("Responsible HCP","String",26,26,"left","","",110)
    t.addColumn("Type/Link","ImageText",21,31,"left","UpdateLink","27",90,28)
    t.addColumn("Status","String",3,3,"left","","",50)
    AddTableRows();
    TableOutput(7,0);    // By Date Order Column,Asc Dsc
    break; }
  }
}
function InitTable1(ctcnckar) {
  if (ctcnckar!=1) {return;}

  documentTitle2 = "Appointment Requests";
  t1 = new Table1(1,0,2,"100%","center",35,35);
  t1.addColumn("Date","Date",1,1,"left","AppointmentIcon.gif","8",90)
  t1.addColumn("Requesting Department","String",2,2,"left","","",90)
  t1.addColumn("Department Required","String",3,3,"left","","",90)
  t1.addColumn("Request Reason","String",4,4,"left","","",90)
  t1.addColumn("Preferred Hospital","String",5,5,"left","","",90)
  t1.addColumn("Clinic Type","String",6,6,"left","","",90)
  t1.addColumn("Status","String",7,7,"left","","",50)
  AddTableRows1();
  t1.sortTable(1,1);    // By Requesting Department
  TableOutput1(0,2);    // By Date Order Column,Dsc
}
function getlinkReferralCOOKIE() {
  if (GetCookieData("linkReferralCOOKIE") != "unknown") {
    ExpireCookiePath("CloseReferralCookie");
    document.PatientLinks.lnrfckie.value="1";
  }
}

function TableEnding()
{
  TableString[TableString.length] = "</table></div>";

  // these are defined in the html
  var TableLocation = document.getElementById('TableLocation');
  var HeadingSection = document.getElementById('HeadingSection');

  // unload the array into continuous html render
  if (TableString.join) // if join method is available;
  {
    TableLocation.innerHTML = TableString.join("");
  }
  else
  {
    var TableStringX="";
    for (i=0;i < TableString.length; i++)
    {
       TableStringX+=TableString[i];
    }
    TableLocation.innerHTML = TableStringX;
  }

  // these are defined in the code we just rendered
  var HeadingDivision = document.getElementById('HeadingDivision');
  var BodyDivision    = document.getElementById('BodyDivision');

  // calculate the available table height based on the view frame height
  var th = getClientHeight();  // view frame height

  if (HeadingSection) {
    secHeight = HeadingSection.clientHeight || HeadingSection.offsetHeight;
    th -= secHeight;
  } else {
     TableLocation.style.top = '0px';
  }

  if (window.navigator.userAgent.indexOf("MSIE")>=1) {
    th -= HeadingDivision.clientHeight;
    BodyDivision.style.height = th + 'px';
  } else {
    th = document.body.clientHeight;
    th -= HeadingDivision.clientHeight;
    if (HeadingSection) th -= HeadingSection.clientHeight;
    BodyDivision.style.height = th +'px';
  }

  SetHeight();
}
function TableEnding1()
{
  TableString1[TableString1.length] = "</table></div>";

  // these are defined in the html
  var TableLocation1 = document.getElementById('TableLocation1');
  var HeadingSection = document.getElementById('HeadingSection');

  // unload the array into continuous html render
  if (TableString1.join) // if join method is available;
  {
    TableLocation1.innerHTML = TableString1.join("");
  }
  else
  {
    var TableStringX1="";
    for (i=0;i < TableString1.length; i++)
    {
       TableStringX1+=TableString1[i];
    }
    TableLocation1.innerHTML = TableStringX1;
  }

  // these are defined in the code we just rendered
  var HeadingDivision1 = document.getElementById('HeadingDivision1');
  var BodyDivision1    = document.getElementById('BodyDivision1');
  if (!scrollTableBody1) {
     HeadingDivision1.style.overflow="auto";
     BodyDivision1.style.overflow="visible";
     BodyDivision1.style.height="";
     return;
  }

  // calculate the available table height based on the view frame height
  var th = getClientHeight();  // view frame height
  var secHeight = 0;

  if (window.navigator.userAgent.indexOf("MSIE") >= 1) {
    // Since getClientHeight() in IE8 returns space available excluding
    // the DFrame title bar (<span>) we need to take that into account.
    if (document.getElementById('DFrameTitleBar') != undefined) {
      th -= document.getElementById('DFrameTitleBar').clientHeight;
    }
  }

//  if (HeadingSection) {
//    secHeight = HeadingSection.clientHeight || HeadingSection.offsetHeight;
//    th -= secHeight;
//  }
//  else {
     TableLocation1.style.top = '0px';
//  }

  if (window.navigator.userAgent.indexOf("MSIE")>=1) {
    th -= HeadingDivision1.clientHeight;
    BodyDivision1.style.height = th + 'px';
  } else {
    th = document.body.clientHeight;
    th -= HeadingDivision1.clientHeight;
    if (HeadingSection) th -= HeadingSection.clientHeight;
    BodyDivision1.style.height = th +'px';
  }

  if (BodyDivision1.scrollHeight > BodyDivision1.clientHeight) {
    // List overflows (i.e. vertical scrollbar visible)
    HeadingDivision1.style.overflowY = 'scroll';  // force vertical scrollbar
                                                 // on list heading section
  }
  else {
    // List does NOT overflow (i.e. no vertical scrollbar in BodyDivision)
    if (window.navigator.userAgent.indexOf("MSIE 7.0") >= 1) {
      // Since IE 8 will always show the vertical scrollbar for the BodyDivision
      // (even when scrolling is not needed) we need to also show the
      // vertical scrollbar for HeadingDivision so columns line up.
      HeadingDivision1.style.overflowY = 'scroll';
    }
    else {
      HeadingDivision1.style.overflowY = 'hidden';
    }
  }
  SetHeight();
}

function SetHeight() {
 if(document.PatientLinks.ctcnckar.value != "1" ) {
   return;
 }
 if(document.getElementById('BodyDivision')) {
   document.getElementById('BodyDivision').style.height = "150px";
 }
 if(document.getElementById('BodyDivision1')) {
   HD1=document.getElementById('HeadingDivision1');
   HD1.style.scrollbarHighlightColor="#cccccc";
   HD1.style.scrollbarArrowColor="#cccccc";
   document.getElementById('BodyDivision1').style.height = "150px";
   document.getElementById('BodyDivision1').style.overflow = "scroll";
 }
}
</script>
</head>
%START.OF.PAGE
<body onload="PageLoad(event);
              InitTable(0);
              InitTable1(%STANDARD.01.025.032.146.1.1);
              getlinkReferralCOOKIE();SetHeight();">
<div id=HeadingSection>
<div id=PatientHeading></div>
<span class=DFrameTitleBar>
<img align="right" alt="Exit" class="MenuIcon"
 src="../images/ExitIcon.gif" onclick="DFrameExitRefresh();">
<script type="text/javascript">document.write('Link Appointment to Referral');
</script>
</span>
<table cellspacing=0 cellpadding=0 border=1 width=100% class=HeadingCell>
<tr><td align=left class=HeadingCell>Status
    <select name="d_filtstat" id="d_filtstat" onchange="FilterReferral();"
    id=d_filtstat>
    <option value="0">Waiting</option>
    <option value="1">Active</option>
    <option value="2">Closed</option>
    <option value="7">Waiting & Active</option>
    </select>
    </td></tr>
</table>
</div>

<div id="TableLocation"></div>
<div id="TableLocation1"></div>

<script type="text/javascript">
function AddTableRows() {
%ALLWEB02.02.286
}
function AddTableRows1() {
%ALLWEB02.02.928.outweb08.08.003
}
</script>

<form name=PatientLinks method=get>
<input type=hidden name=reportno value="2">
<input type=hidden name=template value="025">
<input type=hidden name=urnumber value="%ALLWEB02.02.003">
<input type=hidden name=admissno value="%ALLWEB02.02.081">
<input type=hidden name=filtstat value="">
<input type=hidden name=lnrfckie value="">
<input type=hidden name=clindate value="%ALLWEB02.02.530">
<input type=hidden name=ctcnckar value="%STANDARD.01.025.032.146.1.1">
<input type=hidden name=lnktoref id=lnktoref value="1">
<input type=hidden name=ptcnhdps value="%STANDARD.01.025.080.250.1.1">
</form>

<script language="Javascript">
 stat="%ALLWEB02.02.222";
 fs = document.getElementById("d_filtstat");
 for (var i =0 ; i < fs.length; i++) {
  if (fs.options[i].value==stat.substr(0,3)) {
       fs.selectedIndex=i } };
</script>
