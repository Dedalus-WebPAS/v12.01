<meta name="TemplateVersion" content="V12.01.00">
<meta name="TemplateHome" content="standard">
<meta name="HelpFileName"    content="NoContextSet.html">
<meta name="CrossBrowser" content="true">
<script type="text/javascript" src="../js/allweb0202010.js"></script>
<script type="text/javascript">
function SetPrinter(Nolabel,SelectList) {
  if (SelectList.className=="Mandatory SelectBig") {
      SelectList.className="SelectBig"
  } else {
      SelectList.className="Mandatory SelectBig"
  }
  if (Nolabel!=undefined) {
    if (Nolabel.className=="Mandatory") {
        Nolabel.className=""
    } else {
        Nolabel.className="Mandatory"
    }
  }
}
function chkRegisteredGP() {
  if (isWhitespace(UpdateForm.pmpxrhc1.value)) {
      return; }
  if (trim(UpdateForm.alref022.value) == trim(UpdateForm.pmpxrhc1.value)) {
      PrintRefrLtr1H.style.display="none";
      PrintRefrLtr2H.style.display="none";
      PrintRefrLtr2F.style.display="none";
      PrintRefrLtr1H.innerHTML=Blank.innerHTML;
      PrintRefrLtr2H.innerHTML=Blank.innerHTML;
      PrintRefrLtr2F.innerHTML=Blank.innerHTML;
  } else {
      PrintRefrLtr1H.style.display="";
      PrintRefrLtr2H.style.display="";
      PrintRefrLtr2F.style.display="";
      PrintRefrLtr1H.innerHTML=ShowPrintRefrLtr1H.innerHTML;
      PrintRefrLtr2H.innerHTML=ShowPrintRefrLtr2H.innerHTML;
      PrintRefrLtr2F.innerHTML=ShowPrintRefrLtr2F.innerHTML;
  }
}
function FilterRejectionReason() {
 if(document.UpdateForm.deptindc.value.substr(5,1) == "A" &&
    document.UpdateForm.deptindc.value.substr(6,1) == "M") {
   filterCatCodeList(UpdateForm.alref128,"1","G","1");  // MH Visit
 } else {
   filterCatCodeList(UpdateForm.alref128,"1","M","1");  // Non MH Visit
 }
}
</script>
</head>
%START.OF.PAGE
<body onload="PageLoad(event);chkRegisteredGP();FilterRejectionReason(); 
      checkPriority(); ">
<span class=DFrameTitleBar>
<img border=0 align=right src="../images/ExitIcon.gif" 
     onclick="DFrameExit();">
<script language=javascript>
    document.write("Reject a Referral");
</script>
<script type="text/javascript">
  function ValidateData() {
    if(UpdateForm.alref129.value.indexOf(" ") == 0) {
      alert("Can't have space at the first place");
    }
    if(validateMandatory(UpdateForm)) {
      if(UpdateForm.dept.value == "") {
        alert("Department can't be empty");
      }
      else {
        if(UpdateForm.admissno.value == "        ") {
           alert("Visit/Referral Number is blank");
        }
        else {
          if(CheckFutureBookings(UpdateForm.admissno,UpdateForm.alref129,
                                 UpdateForm.alref130)){
            UpdateForm.updatety.value="J"
            UpdateForm.submit();
          }
        }
      }
    }
  }
</script>
</span>
<form name=UpdateForm action="allweb02.pbl" method=post>
<input type=hidden name=reportno value="2">
<input type=hidden name=template value="010">
<input type=hidden name=urnumber value="%ALLWEB02.02.003">
<input type=hidden name=admissno value="%ALLWEB02.02.081">
<input type=hidden name=updatety value="">
<input type=hidden name=alref036 value="">
<input type=hidden name=alref080 value="">
<input type=hidden name=alref081 value="">
<input type=hidden name=alref082 value="">
<input type=hidden name=alref083 value="">
<input type=hidden name=alref134 value="">
<input type=hidden name=alref138 value="">
<input type=hidden name=alref147 value="">
<input type=hidden name=alref148 value="">
<input type=hidden name=alref149 value="">
<input type=hidden name=deptcode value="%ALLWEB02.02.125.1">
<input type=hidden name=deptindc value="%ALLWEB02.02.125.3">
<input type=hidden name=pmpxrhc1 value="%ALLWEB02.02.659">
<input type=hidden name=alref022 value="%ALLWEB02.02.122.1">

<input type=hidden name=d_alref027_code value="%ALLWEB02.02.127.3">
<input type=hidden name=d_alref027_desc value="%ALLWEB02.02.127.0">

<table align=center cellspacing=0 cellpadding=1 border=0 width=95%>
<tr><td class=DataLabel>Department</td>
    <td><input readonly type=text name=dept value="%ALLWEB02.02.125.0" 
               class=Readonly>
    </td>
    <td class=DataLabel>Entered by</td>
    <td><input readonly type=text value="%ALLWEB02.02.163" 
               class=Readonly>
        <input type=hidden name="d_wbsehosp" value="%STANDARD.01.032">
    </td>
</tr>

<tr><td class=DataLabel>Date Rejected</td>
    <td class=DataLabel>
    <input type=text name=alref129 value="%ALLWEB02.02.198" 
               title="Date Rejected" class="PastDate Mandatory">
      <img src="../images/DateLookup.gif" class=Icon
       onclick="DateLookupFrame(UpdateForm.alref129);">
      Time
      <input type=text size=8 value="%ALLWEB02.02.199.001" title="Time Rejected"
               class="Mandatory Time" name=alref130>
      <img src=../images/DateTimeStamp.gif class=Icon 
       onclick="SetCurrentDateTime(UpdateForm.alref129,UpdateForm.alref130);">
      <img src=../images/TimeLookup.gif class=Icon 
               onclick="TimeLookupFrame(UpdateForm.alref130);">
  </td>
</tr>

<tr><td class=DataLabel>Reason for Rejection</td>
    <td><select class=Mandatory name=alref128 title="Reason for Rejection">
        <option></option>
        %ALLWEB02.02.197.2
        </select>
    </td>
</tr>

<tr><td class=DataLabel>Comment</td>
    <td class-DataLabel>
      <input type=text name=commenty size=51 maxlength=50
       id=commenty value="%ALLWEB02.02.269">
    </td>
</tr>

  <tr><td class=DataLabel colspan=2>
          Print Reject Referral Letter to Patient &nbsp;&nbsp;
          <input type=checkbox name=prtrejpt title="Rej Referral to pat"
                 value="1" tabindex=5></td>
      <td class=DataLabel>Printer </td>
      <td><select name=prtpsl05 tabindex=6 class="SelectBig">
            %STANDARD.01.001.ALLREJPT.01
          </select></td></tr>

  <tr><td class=DataLabel colspan=2>Print Reject Referral Letter to Referrer
         <input type=checkbox name=prtrejrf title="Rej Referral to ref"
                value="1" tabindex=7></td>
      <td class=DataLabel>Printer </td>
      <td><select name=prtpsl06 tabindex=8 class="SelectBig">
            %STANDARD.01.001.ALLREJRF.01
          </select></td></tr>

  <tr><td class=DataLabel colspan=2><div id=PrintRefrLtr1H></div></td>
      <td class=DataLabel><div id=PrintRefrLtr2H></div></td>
      <td><div id=PrintRefrLtr2F></div></td></tr>

  <tr><td class=DataLabel colspan=2>Referral Labels
          <input type=checkbox value="1" name=prtreflb tabindex=11
                 onclick="SetPrinter(UpdateForm.prtpno07,UpdateForm.prtpsl07);">
          Copies
          <select name=prtpno07 tabindex=12>
            %STANDARD.01.027.2.1
          </select></td>
      <td class=DataLabel>Printer</td>
      <td><select class="SelectBig" name=prtpsl07 title="Printer" tabindex=13>
           <option></option>
             %STANDARD.01.001.LABELALL.01
          </select></td></tr>

<tr><td colspan=4 align=center><br>
    <input type=button name=okbutton value="OK" class="button" id="all02o"
     onclick="tempDisable(this);ValidateData();">
    <input type=button Value="Cancel" class="button" 
     onclick="DFrameClose();">
    </td>
</tr>
</table>
</form>

<span id="Blank" style="display:none;"></span>

<span id="ShowPrintRefrLtr1H" style="display:none;">
  Print Reject Referral Letter to GP &nbsp;&nbsp;
  <select name=prtrefgp tabindex=9>
    <option></option>
      %ALLWEB02.02.255.3
  </select>
</span>

<span id="ShowPrintRefrLtr2H" style="display:none;">Printer</span>

<span id="ShowPrintRefrLtr2F" style="display:none;">
  <select class="SelectBig" name=prtpsl08 title="Printer" tabindex=10>
    <option></option>
      %STANDARD.01.001.ALLNEWGP.01
  </select>
</span>

<script type="text/javascript">
//
 BulkBill="%ALLWEB02.02.136";
 if ( BulkBill == "Yes") {
   document.UpdateForm.alref036.value=1;
 }
 ALREUserDefYN1="%ALLWEB02.02.141";
 if ( ALREUserDefYN1 == "Yes") {
   document.UpdateForm.alref080.value=1;
 } else {
   document.UpdateForm.alref080.value=0;
 }
 ALREUserDefYN2="%ALLWEB02.02.142";
 if ( ALREUserDefYN2 == "Yes") {
   document.UpdateForm.alref081.value=1;
 } else {
   document.UpdateForm.alref081.value=0;
 }
 ALREUserDefYN3="%ALLWEB02.02.143";
 if ( ALREUserDefYN3 == "Yes") {
   document.UpdateForm.alref082.value=1;
 } else {
   document.UpdateForm.alref082.value=0;
 }
 SACSRef="%ALLWEB02.02.144";
 if ( SACSRef == "Yes") {
   document.UpdateForm.alref083.value=1;
 } else {
   document.UpdateForm.alref083.value=0;
 }
 ALREUserDefYN5="%ALLWEB02.02.199.005";
 if ( ALREUserDefYN5 == "Yes") {
   document.UpdateForm.alref134.value=1;
 } else {
   document.UpdateForm.alref134.value=0;
 }
 ALREUserDefYN6="%ALLWEB02.02.199.009";
 if ( ALREUserDefYN6 == "Yes") {
   document.UpdateForm.alref138.value=1;
 } else {
   document.UpdateForm.alref138.value=0;
 }
 ALREUserDefYN7="%ALLWEB02.02.199.019";
 if ( ALREUserDefYN7 == "Yes") {
   document.UpdateForm.alref147.value=1;
 } else {
   document.UpdateForm.alref147.value=0;
 }
 ALREUserDefYN8="%ALLWEB02.02.199.020";
 if ( ALREUserDefYN8 == "Yes") {
   document.UpdateForm.alref148.value=1;
 } else {
   document.UpdateForm.alref148.value=0;
 }
 ALREUserDefYN9="%ALLWEB02.02.199.021";
 if ( ALREUserDefYN9 == "Yes") {
   document.UpdateForm.alref149.value=1;
 } else {
   document.UpdateForm.alref149.value=0;
 }
 Status="%ALLWEB02.02.103"
 if (Status=="Rejected  "){
    document.UpdateForm.okbutton.disabled=true;
 } else {
    document.UpdateForm.alref129.value="%STANDARD.01.015"
    document.UpdateForm.alref130.value="%STANDARD.01.016"
 }

 if (!isWhitespace(document.getElementById('commenty').value)) {
   document.getElementById('commenty').readOnly=true;
   document.getElementById('commenty').className='readOnly';
 }
function checkPriority() {
var p = document.UpdateForm;

var indc3 = p.deptindc.value.substr(5,1);
var indc4 = p.deptindc.value.substr(6,1);

var bIsMH = (indc3 == "A" && indc4 == "M") ? true : false;

var rejGenRef = ( p.d_alref027_code.value.substr(13,1) == "G") ? true : false;
var rejMenHlt = ( p.d_alref027_code.value.substr(13,1) == "M") ? true : false;
var rejGenMen = ( p.d_alref027_code.value.substr(13,1) == "A") ? true : false;


if (rejMenHlt && bIsMH) {  // Mental Health Referral
  // Remove Mental Health codes
 alert("Referral Priority Code = " +  trim(p.d_alref027_desc.value) +
            "\nPlease change priority before rejecting the referral");
 document.UpdateForm.okbutton.disabled = true;
    }
else if (rejGenRef && !bIsMH) {  // General Referral
  // Remove General codes
 alert("Referral Priority Code = " +  trim(p.d_alref027_desc.value) +
            "\nPlease change priority before rejecting the referral");
 document.UpdateForm.okbutton.disabled = true;
  }
else if (rejGenMen) {  // General or Mental
  // Remove Mental Health OR General codes
 alert("Referral Priority Code = " +  trim(p.d_alref027_desc.value) +
            "\nPlease change priority before rejecting the referral");
 document.UpdateForm.okbutton.disabled = true;
  }
}

</script>
