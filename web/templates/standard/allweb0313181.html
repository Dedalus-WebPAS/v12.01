<meta name="TemplateVersion" content="V12.01.00">
<meta name="TemplateHome" content="standard">
<meta name="HelpFileName" content="NoContextSet.html">
<meta name="CrossBrowser" content="true">
<script type="text/javascript" src=../js/allweb03.js></script>
<script type="text/javascript">
function PackComments(){
AddForm.alenc107.value=AddForm.comments.value.substring(0,80);
AddForm.alenc108.value=AddForm.comments.value.substring(80,160);
}
function GetBookings() {
  if(document.AddForm.alcndoos.value=="1") {
   document.getElementById("ServiceDepartmentLabel").innerHTML=
   document.getElementById("ShowServiceDepartmentLabel").innerHTML
   document.getElementById("ServiceDepartmentField").innerHTML=
   document.getElementById("ShowServiceDepartmentField").innerHTML
   document.getElementById("OccasionOfServiceLabel").innerHTML=
   document.getElementById("ShowOccasionOfServiceLabel").innerHTML
   document.getElementById("OccasionOfServiceField").innerHTML=
   document.getElementById("ShowOccasionOfServiceField").innerHTML
   SelectServiceDept();
  } 
  if(document.AddForm.alcndevp.value=="1"){
     document.getElementById("EventProgramLabel").innerHTML=
     document.getElementById("ShowEventProgramLabel").innerHTML;
     document.getElementById("EventProgramField").innerHTML=
     document.getElementById("ShowEventProgramField").innerHTML;
  }
  if(!isWhitespace(AddForm.bulkenck.value)) {
    p=parent
    if(p.UpdateStatus==undefined) {
      p=parent.parent
    }
    Appointments.innerHTML+="<input type=hidden name=bulkekey" +
                            " value='" + AddForm.bulkenck.value + "'>"
    document.AddForm.alenc011.value=p.UpdateStatus.othedurn.value;
//
    if(p.SelectPeriod!=undefined) {
      f=document.AddForm;
      f.alenc005.value = f.d_obadate.value;
      f.alenc017.value = f.d_obadate.value;
      if(!isWhitespace(f.d_otbbcitm.value)) {
        f.alenc006.value = f.d_otbbcitm.value + ":00";
      }
      if(!isWhitespace(f.d_otbbastm.value)) {
        f.alenc006.value = f.d_otbbastm.value + ":00";
      }
      if(f.d_obastat.value=="5") {   // DNA
        f.alenc006.value = f.d_obatime.value + ":00";
        DefaultClientPresentStatusDNA();
      }
      if(!isWhitespace(f.d_otbbdptm.value)) {
        f.alenc018.value = f.d_otbbdptm.value + ":00";
      } else {
        DefaultContactEndTime();
      }
      CalcDirectUnitEndTime(f);
    } else {
      document.AddForm.alenc005.value=p.UpdateStatus.dateclin.value;
      document.AddForm.alenc017.value=p.UpdateStatus.dateclin.value;
    }
 
    if(!isWhitespace(p.UpdateStatus.xocadoct.value)) {
      document.AddForm.alenc004.value=p.UpdateStatus.xocadoct.value;
    }
//
    document.AddForm.AddButton.disabled=false;
    return;
  }
  Flag=0
  Appointments.innerHTML="";
  for (var e = 0; e < parent.UpdateForm.elements.length; e++) {
    var el=parent.UpdateForm.elements[e] ;
    if(el.name.match(/referral/) && el.checked==true) {
    Appointments.innerHTML+="<input type=hidden name=bulkekey" +
                            " value='" + el.value + "'>"
    }
  }
  document.AddForm.alenc011.value=parent.UpdateForm.othedurn.value;
//
  Edate=parent.SelectPeriod.sesskeys.options[parent.SelectPeriod.sesskeys.selectedIndex].text;
  document.AddForm.alenc005.value=Edate.substr(4,11);
  document.AddForm.alenc017.value=Edate.substr(4,11);
  if(!isWhitespace(parent.SelectPeriod.xocadoct.value)) {
    document.AddForm.alenc004.value=parent.SelectPeriod.xocadoct.value;
  }
//
  document.AddForm.AddButton.disabled=false;
}
function AddEncounter() {
    if(!validateContactTime()) { return; }
    if(!checkFutureContactTime()) { return; }

    if(!CheckDateTimeRange(AddForm.alenc005,
                           AddForm.alenc006,
                           AddForm.alenc017,
                           AddForm.alenc018)) {
      alert('Contact Start Date/Time cannot be after Contact End Date/Time');
      return;
    }

    if(!isWhitespace(AddForm.alreudt1.value)) {
      if(SetDateYYYYMMDD(AddForm.alenc005.value) <
       SetDateYYYYMMDD(AddForm.alreudt1.value)) {
        alert("Contact Date cannot be before Episode Start Date.");
        return;
      }
    } else {
      if(!isWhitespace(AddForm.alredact.value)) {
        if(SetDateYYYYMMDD(AddForm.alenc005.value) <
           SetDateYYYYMMDD(AddForm.alredact.value)) {
          alert("Contact Date cannot be before Episode Start Date.");
          return;
        }
      }
    }

    // Validate Client Present Status
    if (AddForm.alenc083.value.substr(14,2) == '13') {
      if (AddForm.alenc084.value.substr(14,1) != '3') {
        var sPresentStatus = getSelectionText(AddForm.alenc083, '13');
        var sDeliverMode = getSelectionText(AddForm.alenc084, '3');
        alert("Warning: If Client Present Status is " + sPresentStatus +
          ", Delivery Mode must be " + sDeliverMode + ".");
        AddForm.alenc084.focus();
        return;
      }
    }

    // Validate data entry of a Contract ,Delivery mode and Present Status

    if(!checkDeliveryModeClientPresentStatus(AddForm)) {
      FocusDelay(AddForm.alenc084);
      return;
    }

    if(!checkContactPurposeEnc(AddForm)) {  // Check Contact Purpose Valid
      return;
    }

    if(!CheckClientPresentStatusDNA(AddForm)) {  // Check Valid for DNA
      return;
    }

// Check Client Present Status validation for Patient DNA & Indirect-No Patient.
    if(!CheckPresentStatus(AddForm)) {
      return;
    }

// Check Delivery Mode is Delivery Mode is Face to Face, Telephone
// Telehealth,Written, Electronic Mail, SMS Text Messages
    if(!CheckDeliveryMode(AddForm)) {
      return;
    }

    if(!isWhitespace(AddForm.bulkenck.value)) {
       //See if the patient was an inpatient at the time of the contact
       CheckContactCurrentIP(AddForm.urnumber,AddForm.alenc005,
       AddForm.alenc006,AddForm.d_currip);

       //check Contact has a Delivery Setting of 11-Inpatient Setting
       if(!checkDeliverySettingIP(AddForm.d_currip,AddForm.alenc086)) {
          FocusDelay(AddForm.alenc086);
          return;
       }
    }

    //Display alert it NDIS Flag set and claim type NDIS
    if ((AddForm.alenc115.value.charAt(28)=="D") &&
        (AddForm.ndisvald.value=="0")){

       NDISRedirect();
    }

  getCheckInTimeCookie();
  getTimeSeenCookie();
  getDepartureTimeCookie();
  SubmitHidden(AddForm);
}

function SelectServiceDept()
{
  // Calls remote script to get 'Occasion of Service' list for
  // the selected department.
  selectOptions2("82",AddForm.alenc127,AddForm.alenc010);
}
</script>
</head>

%START.OF.PAGE
<body onload="PageLoad(event);GetBookings();SelectServiceDept();
              CommonContact(AddForm);">
<span class=DFrameTitleBar>
<img border=0 align=right src=../images/ExitIcon.gif 
 onclick="DFrameExitRefresh();">
Add Contact for %ALLWEB03.13.017 %ALLWEB03.13.216 %ALLWEB03.13.217
</span>

<form name=AddForm action="allweb03.pbl" method=post style="margin:0">
<input type=hidden name=reportno value=13>
<input type=hidden name=deptcode value="%ALLWEB03.13.012">
<input type=hidden name=updatety value="A">
<input type=hidden name=flag value="%ALLWEB03.13.023">
<input type=hidden name=alenc107 value="">
<input type=hidden name=alenc108 value="">
<input type=hidden name=bulkenck value="%ALLWEB03.13.030">
<input type=hidden name=alcndoos value="%STANDARD.01.025.106.226.0.1">
<input type=hidden name=urnockie value="">
<input type=hidden name=admnckie value="">
<input type=hidden name=rwnockie value="">
<input type=hidden name=clnockie value="">
<input type=hidden name=caseckie value="">
<input type=hidden name=alcndevp value="%STANDARD.01.025.106.225.0.1">
<input type=hidden name=alreudt1 value="%ALLWEB03.13.551">
<input type=hidden name=alredact value="%ALLWEB03.13.504">
<input type=hidden name=d_otbbcitm value="%ALLWEB03.13.038">
<input type=hidden name=currdate value="">
<input type=hidden name=currtime value="">
<input type=hidden name=deptlcod value="%ALLWEB03.13.036.3">
<input type=hidden name=CATEG_CL value="CL">
<input type=hidden name=CATEG_zH value="zH">
<input type=hidden name=d_obadate value="%ALLWEB03.13.228">
<input type=hidden name=d_otbbastm value="%ALLWEB03.13.229">
<input type=hidden name=d_otbbdptm value="%ALLWEB03.13.230">
<input type=hidden name=d_currtime value="%STANDARD.01.016">
<input type=hidden name=d_obatime value="%ALLWEB03.13.231">
<input type=hidden name=d_duration value="%ALLWEB03.13.232">
<input type=hidden name=d_obastat value="%ALLWEB03.13.233">
<input type=hidden name=ndisvald value="%ALLWEB03.13.236">
<input type=hidden name=urnumber value="%ALLWEB03.13.015">
<input type=hidden name=d_currip id=d_currip value="">
<input type=hidden id=CATEG_zL  name=CATEG_zL
                                 value="%STANDARD.01.018.zL.9  .9.3">
<table align=center cellspacing=0 cellpadding=1 border=0 width=95%>
<tr><td>
<div id=Appointments></div>
</td></tr>

<tr><td class=DataLabel>Department</td>
<td><input type=text readonly size=40 name=dept class="ReadOnly" 
     value="%ALLWEB03.13.017">
        </td></tr>

<tr><td class=DataLabel>Service Provider</td>
    <td class=DataLabel>
    <input type=text name=alenc004 size=10 maxlength=10 class=Mandatory
     onblur="ValidateHCP(18,13,AddForm.alenc004,AddForm.SProvider);" 
     title="Health Care Provider">
    <input type=text name=SProvider size=25 class=Readonly readonly
      title="Health Care Provider">

    <img src=../images/SearchIcon.gif class=Icon
     onclick="HCPSearchFrame(AddForm.alenc004,AddForm.SProvider,4);" >
    <img src="../images/ClearIcon.gif" class=Icon
     onclick="clrFields(AddForm.alenc004,AddForm.SProvider);">
    </td></tr>

<tr><td class=DataLabel>Contact Start Date</td>
    <td class=DataLabel>
      <input type=text readonly name=alenc005 value="" 
        id=alenc005 title="Contact Start Date" class="ReadOnly" Size=12
        onblur="CalcDirectUnitStartDate(AddForm);">
     Start Time
      <input type=text size=8 title="Contact Start Time" value="" 
        class="Mandatory" Name=alenc006 
        onblur="CalcDirectUnitStartTime(AddForm);">
      <img notab src=../images/DateTimeStamp.gif class="Icon"
        onclick="SetCurrentDateTime(null,AddForm.alenc006);">
      <img src="../images/TimeLookup.gif" class=Icon 
        onclick="TimeLookupFrame(AddForm.alenc006);">
    </td></tr>

<tr><td class=DataLabel>Contact End Date</td>
    <td class=DataLabel>
    <input type=text readonly name=alenc017 value="%STANDARD.01.015"
      id=alenc017 title="Contact End Date" class="ReadOnly" Size=12>
     End Time &nbsp;
    <input type=text size=8 title="Contact End Time" value="" 
      class="Mandatory" Name=alenc018
      onblur="CalcDirectUnitEndTime(AddForm);">
    <img notab src=../images/DateTimeStamp.gif class="Icon"
         onclick="SetCurrentDateTime(null,AddForm.alenc018);">
    <img src="../images/TimeLookup.gif" class=Icon
     onclick="TimeLookupFrame(AddForm.alenc018);">
   </td>
</tr>

<tr><td class=DataLabel width=20%>Direct Units</td>
    <td class=DataField width=45%>
    <input type=text size=12 name=alenc011 id=alenc011 maxlength=6 
      class=Mandatory title="Direct Units"
      onblur="CalcContactEndDateTime(AddForm);"></td>
    <td class=DataLabel width=15%>Indirect Units</td>
    <td class=DataField><input type=text size=12 name=alenc013 maxlength=6 
      onblur="checkInteger(this,this.title);"></td></tr>

<tr><td class=DataLabel width=20%>Client Present Status</td>
    <td class=DataField width=45%>
      <select class="Mandatory SelectBig" name=alenc083
       title="Client Present Status">
      <option></option>
      %ALLWEB03.13.147.37.5
      </select></td>
    <td class=DataLabel width=15%>%STANDARD.01.017.CL</td>
    <td class=DataField><select class="Mandatory SelectBig"
        name=alenc115  title="%STANDARD.01.017.CL">
    <option></option>
    %ALLWEB03.13.176.2
    </select>
    </td></tr>

<tr><td class=DataLabel>Delivery Mode</td>
    <td class=DataField><select class="Mandatory SelectBig" name=alenc084
       title="Delivery Mode">
      <option></option>
      %ALLWEB03.13.147.38.5
      </select></td>

    <td class=DataLabel>Delivery Setting</td>
    <td class=DataField><select class="Mandatory SelectBig" name=alenc086
       title="Delivery Setting">
      <option></option>
      %ALLWEB03.13.147.40.5
      </select>
    </td></tr>

<tr><td class=DataLabel>Contact Purpose</td>
    <td class=DataField><select class="Mandatory SelectBig" name=alenc080
       title="Contact Purpose" style="width: 300px;">
      <option></option>
      %ALLWEB03.13.147.34.9.5
      </select></td>
    <td class=DataLabel>Session Type</td>
    <td class=DataField><select class="Mandatory SelectBig" name=alenc081
       title="Session Type">
      <option></option>
      %ALLWEB03.13.147.35.5
      </select>
    </td></tr>

<tr><td class=DataLabel><div id="ServiceDepartmentLabel"></div></td>
    <td class=DataField><div id="ServiceDepartmentField"></div></td>
    <td class=DataLabel><div id="OccasionOfServiceLabel"></div></td>
    <td class=DataField><div id="OccasionOfServiceField"></div></td></tr>

<tr><td class=DataLabel>Travel Time</td>
    <td class=DataField>
      <input type=text size=12 maxlength=8 name=alenc106 title="Travel time" 
       min=0 onblur="checkInteger(this,this.title)"></td>
    <td>&nbsp;</td>
    <td>&nbsp;</td></tr>

<tr><td class=DataLabel><div id="EventProgramLabel"></div></td>
    <td class=DataField><div id="EventProgramField"></div></td>
    <td class=DataLabel>&nbsp;</td>
    <td class=DataField>&nbsp;</td>
    </tr>
</table>

<table align=center cellspacing=0 cellpadding=1 border=0 width=95%>
<tr valign=top><td class=DataLabel width=20%>Comments</td>
    <td class=DataField colspan=3>
    <textarea rows=3 cols=60 onblur=PackComments() name=comments
     onkeydown="LimitText(this,3,160);"></textarea>
    </td></tr>
</table>

<div id="HCPcheckbox" style="display:none;">
<table align=center cellspacing=0 cellpadding=1 border=0 width=95%>
<tr><td class=DataLabel width=20%>Additional HCP</td>
    <td><input type=checkbox name=addithcp value="1"
         onclick="CheckAddHCP();"></td></tr>
</table>
</div>

<div id=AdditionalHCP></div>

<table align=center cellspacing=0 cellpadding=1 border=0 width=95%>
<tr><td colspan=4 align=center><br>
    <input type=button value="Add" class="button" id="all03a"
     disabled name=AddButton onclick="tempDisable(this);AddEncounter();">
    <input type=button Value="Cancel" class="button" 
     onclick="DFrameCloseRefresh();">
    </td></tr>
</table>
</form>

<span id="ShowServiceDepartmentLabel" style="display:none">
  Service Department
</span>

<span id="ShowServiceDepartmentField" style="display:none">
<select class="Mandatory SelectBig" name=alenc127 title="Service Department"
  onchange="SelectServiceDept();">
  <option></option>
  %ALLWEB03.13.191.9.6.08.2. 
  </select>
</span>

<span id="ShowOccasionOfServiceLabel" style="display:none">
  Occasion of Service
</span>

<span id="ShowOccasionOfServiceField" style="display:none">
  <select class="Mandatory SelectBig" name=alenc010 title="Occasion of Service">
  </select>
</span>

<span id="ShowEventProgramLabel" style="display:none">
  Event Program
</span>

<span id="ShowEventProgramField" style="display:none">
  <select class="Mandatory SelectBig" name=alenc079 title="Event Program"
   id=alenc079 onchange="filterContactPurpose(AddForm);
                         filterNDISContactCL(AddForm);">
  <option></option>
  %ALLWEB03.13.147.33.22
  </select>
</span>

<span id="ShowAdditionalHCP" style="display:none;">
<table align=center cellspacing=0 cellpadding=1 border=0 width=95%>
<tr><td class=DataLabel width=15%>Additional HCP 1</td>
    <td><input type=text name=alenc025 size=10 maxlength=10
         title="Additional HCP 1"
         onblur="ValidateHCP(18,0,AddForm.alenc025,AddForm.d_alenc025);">
        <input type=text name=d_alenc025 size=20 class=Readonly readonly
         title="Additional HCP 1">
        <img src=../images/SearchIcon.gif class=Icon
         onclick="HCPSearchFrame(AddForm.alenc025,AddForm.d_alenc025,0);" >
        <img src="../images/ClearIcon.gif" class=Icon
         onclick="clrFields(AddForm.alenc025,AddForm.d_alenc025);">
    </td>
    <td class=DataLabel width=15%>Additional HCP 2</td>
    <td><input type=text name=alenc026 size=10 maxlength=10
         title="Additional HCP 2"
         onblur="ValidateHCP(18,0,AddForm.alenc026,AddForm.d_alenc026);">
        <input type=text name=d_alenc026 size=20 class=Readonly readonly
         title="Additional HCP 2">
        <img src=../images/SearchIcon.gif class=Icon
         onclick="HCPSearchFrame(AddForm.alenc026,AddForm.d_alenc026,0);" >
        <img src="../images/ClearIcon.gif" class=Icon
         onclick="clrFields(AddForm.alenc026,AddForm.d_alenc026);">
    </td></tr>

<tr><td class=DataLabel width=15%>Additional HCP 3</td>
    <td><input type=text name=alenc027 size=10 maxlength=10
         title="Additional HCP 3"
         onblur="ValidateHCP(18,0,AddForm.alenc027,AddForm.d_alenc027);">
        <input type=text name=d_alenc027 size=20 class=Readonly readonly
         title="Additional HCP 3">
        <img src=../images/SearchIcon.gif class=Icon
         onclick="HCPSearchFrame(AddForm.alenc027,AddForm.d_alenc027,0);" >
        <img src="../images/ClearIcon.gif" class=Icon
         onclick="clrFields(AddForm.alenc027,AddForm.d_alenc027);">
    </td>
    <td class=DataLabel width=15%>Additional HCP 4</td>
    <td><input type=text name=alenc028 size=10 maxlength=10
         title="Additional HCP 4"
         onblur="ValidateHCP(18,0,AddForm.alenc028,AddForm.d_alenc028);">
        <input type=text name=d_alenc028 size=20 class=Readonly readonly
         title="Additional HCP 4">
        <img src=../images/SearchIcon.gif class=Icon
         onclick="HCPSearchFrame(AddForm.alenc028,AddForm.d_alenc028,0);" >
        <img src="../images/ClearIcon.gif" class=Icon
         onclick="clrFields(AddForm.alenc028,AddForm.d_alenc028);">
    </td></tr>
</table>
</span>
<script type="text/javascript">
if(%ALLWEB03.13.400.12==1){
  document.getElementById("HCPcheckbox").style.display="block";
}
</script>
