<meta name="TemplateVersion" content="V12.01.00">
<meta name="TemplateHome" content="standard">
<meta name="HelpFileName" content="NoContextSet.html">
<meta name="CrossBrowser" content="true">
<script type="text/javascript" src="../js/allweb0203.js"></script>
<script type="text/javascript" src="../js/TableSort.js"></script>
<script type="text/javascript">
function LoadCookieData() {
  // load cookie values into relevant fields
  var addMultiCookie = GetCookieData('AddMultRef');

  if (addMultiCookie == '1') {
    // set the field values from cookies...
    var cookieData = GetCookieData('AddMultRef-fields');

    if (cookieData.length > 0) {
      var fields = cookieData.split("|");
      var fieldName,fieldVal = "";
      var el = null;

      for (y=0; y < fields.length; y++) {
	fieldName = fields[y].split("=")[0];
	fieldVal = fields[y].split("=")[1];
        el = (fieldName != "")?document.getElementById(fieldName):null;

        if (el) {
          el.value = fieldVal;
        }
      }
    }

    ExpireCookiePath('AddMultRef');
    ExpireCookiePath('AddMultRef-fields');
  }
}

function SaveCookieData() {
  // create the cookies for 'repeat' fields...
  var fieldCookieData = '';

  for (var i = 0; i < document.AddMultRef.elements.length; i++) {
    var el = document.AddMultRef.elements[i] ;
    if (el.type != "hidden" && !el.disabled &&
       el.type != "textarea" && el.type != "button") {
      if (!isWhitespace(el.value)) {
         fieldCookieData += el.name + "=" + el.value + "|"
      }
    }
  }
  SetCookie('AddMultRef','1');
  SetCookie('AddMultRef-fields',fieldCookieData);
}

function ReferralLink(ReferralKey,ReferralDep) {
  var uno=PatientLinks.urnumber.value.replace(/ /g,"+");
  var rno=ReferralKey.replace(/ /g,"+");
  var dep=ReferralDep.replace(/ /g,"+");
  Location="../cgi-bin/allweb02.pbl?reportno=02&template=002&urnumber="+uno+"&admissno="+rno+"&deptcode="+dep;
  location.href=Location
}
function LinkedReferral(ReferralKey) {
  var uno=PatientLinks.urnumber.value.replace(/ /g,"+");
  var rno=ReferralKey.replace(/ /g,"+");
  Location="../cgi-bin/allweb02.pbl?reportno=07&template=001&urnumber="+uno+"&admissno="+rno;
  location.href=Location
}
function AddNewReferral() {
   var urnumber = document.getElementById("urnumber");
   var department = document.getElementById("allrf001");
   var dummy = document.getElementById("dummy");

   if (!validateMandatory(document.AddMultRef))
     return false;

   //validate SAC Department referral
   if( (validateSACDept(90,urnumber,department,dummy)) === true)
   {
     SaveCookieData();
     Left=(document.body.clientWidth-900)/2
     DFrameSubmit(document.AddMultRef,50,Left,900,600);
   }
}

function AddUserReferral() {
   if (!validateMandatory(document.AddMultRef))
     return false;

   if(isWhitespace(document.PatientLinks.wbsedall.value)) {
     alert("User does not have a default department.");
     return;
   }

   document.AddMultRef.allrf001.value=document.PatientLinks.wbsedall.value;
   var urnumber = document.getElementById("urnumber");
   var department = document.getElementById("allrf001");
   var dummy = document.getElementById("dummy");

   //validate SAC Department referral
   if( (validateSACDept(90,urnumber,department,dummy)) === true)
   {
     SaveCookieData();
     Left=(document.body.clientWidth-900)/2
     DFrameSubmit(document.AddMultRef,50,Left,900,550);
   }
}

function DisplayTrnSrc() {
  i=document.AddMultRef.allrf034.selectedIndex;
  ind=document.AddMultRef.allrf034.options[i].value.substring(4,5)
  if (ind!="1") {
    TranSrc.innerHTML=transferblank.innerHTML;
    TranSrcHeading.innerHTML="&nbsp;";
    document.AddMultRef.aldad001.value="";
  } else {
    TranSrcHeading.innerHTML=transferhd.innerHTML;
    TranSrc.innerHTML=transfersrc.innerHTML;
  }
}

//----------------------------------------------------------------------------
// Create New Table Object
// Border, Cellspacing, Cellpadding, Width, Align, Heading Height, Row Height
//----------------------------------------------------------------------------
// Add Columns in Order Required
// Heading,Type,Display Column,Sort Column, Align, Icon, Link Column
// Columns Available
// 0. Referral Link
// 1. Department Description
// 2. Referral Date
// 3. Status Description
// 4. Referred By
// 5. Problem Description
// 6. Referral/Visit Number
// 7. Last Encounter Date
// 8. Priority
// 9. Compensation
//---------------------------------------------------------------------------
function InitTable(TableView) {
switch (TableView) {
case 0: {
 t = new Table(1,0,2,"100%","center",35,35);
 t.addColumn("Date","Date",2,2,"left","EditIcon.gif","0",90)
 t.addColumn("System","String",29,29,"left","","",50)
 t.addColumn("Department","String",1,1,"left","","",90)
 t.addColumn("Problem","String",5,5,"left","","",80)
 t.addColumn("Referred By","String",4,4,"left","","",80)
 t.addColumn("Responsible HCP","String",26,26,"left","","",50)
// t.addColumn("Case Team","String",23,23,"left","","",40)
 t.addColumn("Case Team","String",24,24,"left","","",80)
 t.addColumn(PatientLinks.claimcode.value,"String",22,22,"left","","",30)
// t.addColumn("Type/Link","String",21,21,"left","","",60)
 t.addColumn("Type/Link","ImageText",21,21,"left","UpdateLink","27",80,28)
 t.addColumn("Status","String",3,3,"left","","",50)
 AddTableRows()
 t.sortTable(1,1);    // By Department
 TableOutput(0,2);    // By Date Order Column,Asc Dsc
 break; }
case 1: {
 t = new Table(1,0,2,"100%","center",35,35);
 t.addColumn("Date","Date",2,2,"left","EditIcon.gif","0",100,"","","",32)
 t.addColumn("System","String",29,29,"left","","",50)
 t.addColumn("Department","String",1,1,"left","","",80)
 t.addColumn("Problem","String",5,5,"left","","",80)
 t.addColumn("Referred By","String",4,4,"left","","",80)
 t.addColumn("Responsible HCP","String",26,26,"left","","",50)
// t.addColumn("Case Team","String",23,23,"left","","",40)
 t.addColumn("Case Team","String",24,24,"left","","",80)
 t.addColumn(PatientLinks.claimcode.value,"String",22,22,"left","","",30)
 t.addColumn("Type/Link","ImageText",21,31,"left","UpdateLink","27",80,28)
 t.addColumn("Status","String",3,3,"left","","",50)
 AddTableRows()
 TableOutput(8,0);    // By Date Order Column,Asc Dsc
 break; }
 }
}
</script>
%START.OF.PAGE
<body onload=PageLoad(event);LoadCookieData();DisplayTrnSrc();InitTable(0);>
<div id="HeadingSection">
<div id="PatientHeading"></div>
<div id="PatientMenu"></div> 
<script type="text/javascript">
PatientURN="%ALLWEB02.03.003";
PatientVIS="%ALLWEB02.03.081";
PatientNAM="%ALLWEB02.03.002";
PatientSTA="%ALLWEB02.03.086.078";
PatientALT="%ALLWEB02.03.084";
PatientSEX="%ALLWEB02.03.019";
PatientDOB="%ALLWEB02.03.020";
PatientAGE="%ALLWEB02.03.021";
PatientLOC="%ALLWEB02.03.083";
PatientPRI="%ALLWEB02.03.086.066.1";
PatientUNT="%ALLWEB02.03.066.0";
DoctorCOD="%ALLWEB02.03.082.003";
DoctorNAM="%ALLWEB02.03.082.002";
PatientAID="%ALLWEB02.03.086.090";
PatientIND="%ALLWEB02.03.086.091";
PatientCUR="%ALLWEB02.03.086.092";
PatientCLC="%ALLWEB02.03.086.093.1";
PatientCLH="%STANDARD.01.017.CL";
PatientHFT="%ALLWEB02.03.086.094";
PatientCDM="%ALLWEB02.03.086.095";
PatientVDH="%ALLWEB02.03.086.099.015";
InsertPatientHeader()
</script>

<form name=AddMultRef method=get action=allweb02.pbl style="margin:0">
    <input type=hidden name=reportno value=3>
    <input type=hidden name=template value=1>
    <input type=hidden id=urnumber name=urnumber value="%ALLWEB02.03.003">
    <input type=hidden name=ptcndcdm value="%STANDARD.01.025.116.214.0.1">
    <input type=hidden id=hcpprovno name=hcpprovno value="">
    <input type=hidden name=ptcnhdps id=ptcnhdps 
           value="%STANDARD.01.025.080.250.1.1">
<table cellspacing=0 cellpadding=0 border=0 width=100%>
<tr>
  <td>
    <table cellspacing=0 cellpadding=0 border=0 width=100%>

    <tr>
      <td colspan=2 class=HeadingCell align=center>
	Add Multiple Referrals
      </td>
    </tr>

    <tr>
      <td width=10>&nbsp;</td>
      <td>
        <table width=80% align=left border=0 cellspacing=2 cellpadding=1>
        <tr>
          <td class=DataLabel width="13%">Date of Referral</td>
	  <td class=DataField>
	  <input type=text id=allrf019 name=allrf019 size=12 tabindex=1
	   onblur="checkDate(this,'Date')"
	   class= "Mandatory PastDate" title="Date of Referral">
	  <img src=../images/DateTimeStamp.gif class=Icon 
            date=AddMultRef.allrf019 time=null>
	  <img src=../images/DateLookup.gif class=Icon 
            date=AddMultRef.allrf019>
	  </td>
        </tr>
        <tr>
          <td class=DataLabel>Date Letter Received</td>
          <td><input type=text name=allrf039 size=12 class="Mandatory PastDate"
	    id=allrf039 value="%STANDARD.01.015" onblur="checkDate(this,'Date')"
	    title="Date Letter Received" tabindex=2>
	    <img src=../images/DateTimeStamp.gif class=Icon alt="Current"
	      date=AddMultRef.allrf039 time=null>
	    <img src=../images/DateLookup.gif class=Icon alt="Show Calendar"
	      date=AddMultRef.allrf039>
          </td>
        </tr>
        <tr>
          <td class=DataLabel>%STANDARD.01.017.S </td>
	  <td><select title="%STANDARD.01.017.S " name=allrf034 tabindex=3
	       id=allrf034 class="Mandatory SelectBig" 
		onchange="DisplayTrnSrc();">
	      <option></option>
	       %ALLWEB02.03.134.2
	      </select>
          </td>
	</tr>
        <tr>
          <td><div id=TranSrcHeading></div></td>
          <td><div id=TranSrc></div></td>
        </tr>
        <tr>
          <td class=DataLabel>Inform GP</td>
	  <td><select name=pmsvx010 tabindex=5>
	     <option value="0">No</option>
	     <option value="1" selected>Yes</option>
	    </select>
          </td>
        </tr>
        <tr>
          <td class=DataLabel>Referral Originator</td>
          <td><input type=text size=32 maxlength=30 name=allrf153 tabindex=6
               title="Referral Originator">
          </td>
        </tr>
        <tr>
          <td class=DataLabel>Referring HCP</td>
          <td>
            <input type=text name=allrf022 size=10 maxlength=10 tabindex=7
              id=allrf022 value="" class=Mandatory title="Referring HCP"
              onchange="UpCase(this);ReadDoc(18,0,allrf022,n_allrf022,allrf023,n_allrf023,allrf024,hcpprovno);">
            <input type=text name=n_allrf022 size=30 readonly title="HCP Name"
              id=n_allrf022 class=Readonly value="" notab>
            <img src="../images/SearchIcon.gif" class=Icon
              onclick="GPHCPSearchFrame(allrf022,n_allrf022,hcpprovno,allrf023,n_allrf023,allrf024,0);">
            <img src="../images/erase.gif" class=Icon
              onclick='clrFields(AddMultRef.allrf022,AddMultRef.n_allrf022,AddMultRef.hcpprovno);'>
          </td>
        </tr>
        <tr>
          <td class=DataLabel>HCP Practice</td>
          <td>
            <input type=text size=10 class=readonly value=""
             title="HCP Practice" id=allrf023 readonly notab name=allrf023>
            <input type=text size=30 class=readonly value=""
             title="Practice Name" readonly id=n_allrf023 notab name=n_allrf023>
            <img src="../images/SearchIcon.gif" class=Icon
             onclick="GPHCGSearchFrame(allrf022,n_allrf022,hcpprovno,allrf023,n_allrf023,allrf024)">
            <img src="../images/erase.gif" class=Icon onclick="clrFields(allrf023,n_allrf023,allrf024,hcpprovno);">
            <input type=hidden id=allrf024 name=allrf024
             title="Practice Count" value="%ALLWEB02.03.461">
          </td>
        </tr>
        <tr>
          <td class=DataLabel>%STANDARD.01.017.CL</td>
          <td>
            <select title="%STANDARD.01.017.CL" name=allrf035 tabindex=8
             class="Mandatory SelectBig">
             <option></option>
             %ALLWEB02.03.135.2
            </select>
          </td>
        </tr>
        <tr>
          <td class=DataLabel>%ALLWEB02.03.199.011.8</td>
          <td>
             <select title="%ALLWEB02.03.199.011.8" name=allrf140 tabindex=9
              class="SelectBig">
             <option></option>
             %ALLWEB02.03.199.011.2
            </select>
          </td>
        <tr>
        </table>
      </td>
    </tr>
    
    <tr>
      <td colspan=2>
        <table cellspacing=0 cellpadding=0 border=0 width=100%>
        <tr>
	  <td width=33%>&nbsp;</td>
	  <td width=33% align=center>
	    <input type=button class="button" value="Referral List"
	      onclick="location.href='%ALLWEB02.03.001.allweb02.02.001';">
	  </td>
	  <td width=33% align=right>Add Referral
	    <input type=button class=SlimButton value="Add" tabindex=10
	      title="Add referral for users department" 
              onclick="AddUserReferral();">
	    <select class=PMenuSelectList id=allrf001 name=allrf001 tabindex=11
	      onmouseover="MenuOver(event,this)" 
	      onchange="AddNewReferral();">
	      <option></option>
	      %ALLWEB02.03.708
	    </select>
	  </td>    
        <tr>
        </table>
      </td>
      
    </tr>
    </table>
  </td>
</tr>

<tr><td>&nbsp;</td></tr>
</table>
</form>
</div>

<div id=TableLocation></div>

<span class=DataLabel id=transferhd style="display:none">
Transfer Source
</span>

<span id=transfersrc style="display:none">
<input type="text" size=7 maxlength=5 name=aldad001 class=Mandatory
      title="Transfer Source" tabindex=4 id=aldad001
      onchange="validateCode(9,aldad001,trandesc);">
     <input type=text size=27 id=trandesc name=trandesc notab
      class=Readonly readonly>
     <img src="../images/SearchIcon.gif"
      onclick="TransferSourceFrame(aldad001,trandesc,allrf034)">
</span>

<span id=transferblank style="display:none">
   <input type=hidden name=aldad001>
</span>

<script language="Javascript">
function AddTableRows() {
  %ALLWEB02.03.701
}

document.AddMultRef.allrf035.title = trim(document.AddMultRef.allrf035.title);
</script>

<form name=PatientLinks method=get>
<input type=hidden name=reportno value="1">
<input type=hidden name=template value="004">
<input type=hidden name=urnumber value="%ALLWEB02.03.003">
<input type=hidden name=admissno value="%ALLWEB02.03.081">
<input type=hidden name=MenuType value="%ALLWEB02.03.088">
<input type=hidden name=wbsedall value="%STANDARD.01.028">
<input type=hidden name=filtstat value="">
<input type=hidden id=dummy name=dummy    value="" />
<input type=hidden name=filtdept value="">
<input type=hidden name=claimcode value="%STANDARD.01.017.CL">
</form>
