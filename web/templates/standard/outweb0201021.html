Content-Type: text/html
Cache-Control: no-cache

<!DOCTYPE html>
%START.OF.PAGE
<head>
<title>Clinic Timetable</title>
<meta http-equiv="X-UA-Compatible" content="IE=Edge">
<meta name="ServerID" content="%STANDARD.01.004">
<meta name="ServerName" content="%STANDARD.01.005">
<meta name="ServerVersion" content="%STANDARD.01.006">
<meta name="ServerOption" content="%STANDARD.01.002">
<meta name="ServerTemplate" content="%STANDARD.01.003">

<meta name="TemplateFile" id="TemplateFile" content="outweb0201021.html">
<link rel="stylesheet" href="../html/standard.css" type="text/css">
<link rel="stylesheet" href="../html/custom.css" type="text/css">
<script type="text/javascript" src="../js/Standard.js"></script>
<script type="text/javascript" src="../js/Custom.js"></script>

<meta name="TemplateVersion" content="V12.01.00">
<meta name="TemplateHome"    content="standard">
<meta name="HelpFileName"    content="NoContextSet.html"> 
<meta name="CrossBrowser" content="true">
<script type="text/javascript" src="../js/AutoSuggestionPopup/AutoSuggestionPopup.class.js"></script>
<link    rel="stylesheet"     href="../js/AutoSuggestionPopup/AutoSuggestionPopup.css" type="text/css">
<script type="text/javascript" src="../js/OutpatientSelect.js"></script>
<script type="text/javascript" src="../js/OutpatientTypeClinic.js"></script>
<script type="text/javascript" src="https://maps.googleapis.com/maps/api/js?v=3&key=%STANDARD.01.044.124.161.050"></script>
<script type="text/javascript" src="../js/GoogleLibrary.js"></script>
<style  type="text/css">
.InformationIcon {
  background: url("../images/AlertSprite.png") -0px -140px no-repeat;
  width:20px;
  height:20px;
}
</style>
<script type="text/javascript">
function InitTable() {
  selectOptions2("3",document.SelectPeriod.hospcode,document.SelectPeriod.wardcode);
  wardcode=GetCookieData("outweb0201021-wardcode");
  el=document.SelectPeriod.wardcode;
  for (var i=0;i<el.options.length;i++) {
    if (wardcode==el.options[i].value) { el.selectedIndex=i; }
  }

  filtctyp=GetCookieData("outweb0201021-filtctyp");
  SetClinicType(SelectPeriod.filtctyp,filtctyp,SelectPeriod.usersite.value);

  filtclid=GetCookieData("outweb0201021-filtclid");
  SetTypeClinic(SelectPeriod.filtclid,filtclid,SelectPeriod.usersite.value,SelectPeriod.filtctyp.value);
  el=document.getElementById("MapLocation");
  el.innerHTML="<span style='font-size:12px;background-color:#111;color:eee;"+
               "border:1px solid grey;position:absolute;"+
               "text-align:center;height:50px;width:300px;"+
               "margin-left:200px;margin-top:100px;padding:50px;'>"+
               "<img src='../images/loading.gif'><br><br>Geo Coding in Progress<br>Please Wait</span>";
  setTimeout(function(){ DisplayTable(); }, 100);
}
function SelectWard() {
 el=document.SelectPeriod;
 wardcode=el.wardcode.options[el.wardcode.selectedIndex].value;
 SetCookie("outweb0201021-wardcode",wardcode);
 SelectPeriodSubmit();
}
function SelectCarer() {
 el=document.SelectPeriod;
 carerflt=el.carerflt.options[el.carerflt.selectedIndex].value;
 SetCookie("outweb0201021-carerflt",carerflt);
 FilterList(el.carerflt,11);
}
function SelectType() {
 el=document.SelectPeriod;
 filtctyp=el.filtctyp.options[el.filtctyp.selectedIndex].value;
 SetCookie("outweb0201021-filtctyp",filtctyp);
 SelectPeriodSubmit();
}
function SelectClin() {
 el=document.SelectPeriod;
 filtclid=el.filtclid.options[el.filtclid.selectedIndex].value;
 SetCookie("outweb0201021-filtclid",filtclid);
 SelectPeriodSubmit();
}
function DisplayTable() {
 t = new Table();    // Create New Table Object
 el=document.SelectPeriod;
 lastdate=el.lastdate.options[el.lastdate.selectedIndex].text;
 switch (lastdate.substr(0,3)) {
   case 'Sun':listcode="HV0";break;
   case 'Mon':listcode="HV1";break;
   case 'Tue':listcode="HV2";break;
   case 'Wed':listcode="HV3";break;
   case 'Thu':listcode="HV4";break;
   case 'Fri':listcode="HV5";break;
   case 'Sat':listcode="HV6";break;
 }
 el.listcode.value=listcode;
 filtctyp=el.filtctyp.options[el.filtctyp.selectedIndex].value;
 filtclid=el.filtclid.options[el.filtclid.selectedIndex].value;
 lastdate=el.lastdate.options[el.lastdate.selectedIndex].value;
 wardcode=el.wardcode.options[el.wardcode.selectedIndex].value;
 sesskeys=el.sesskeys.value
 theURL="geocod01.php?reportno=7"+
        "&filtctyp="+filtctyp.replace(/ /g,"+")+
        "&filtclid="+filtclid.replace(/ /g,"+")+
        "&lastdate="+lastdate.replace(/ /g,"+")+
        "&listcode="+listcode.replace(/ /g,"+")+
        "&wardcode="+wardcode.replace(/ /g,"+");
 var xmlHttp = createHttpObject();
 xmlHttp.open("GET", theURL, false);
 xmlHttp.send();
 if (xmlHttp.responseText!=""&&xmlHttp.status == 200) {
   h = document.getElementsByTagName("head")[0];
   s = document.createElement("script");
   s.type="text/javascript";
   h.appendChild(s);
   s.text=xmlHttp.responseText;
   AddRows();
   ShowFilter2("carerfrm",11,12);
   ShowFilter("carerflt",11);
   carerflt=GetCookieData("outweb0201021-carerflt");
   el=document.SelectPeriod.carerflt;
   for (var i=0;i<el.options.length;i++) {
     if (carerflt==el.options[i].value) { el.selectedIndex=i; }
   }
   SetFilter(el,11);
   ShowList();
   DisplayMap();
 }
}
function SelectPeriodSubmit() {
 SelectPeriod.submit();
}
function SubmitSearch() {
  if(isWhitespace(SelectPeriod.filtctyp.value) &&
     isWhitespace(SelectPeriod.filtclid.value)) {
     alert("Clinic Type and Clinic are mandatory.");
     return;
  }
  SelectPeriod.submit();
}
function ShowList() {
 var OS = "<dl>";
 LinkFlag=false;
 SortOrderBy=16;
 t.rows.sort(StringSort);
 SortOrderBy=11;
 t.rows.sort(StringSort);
 markerBreakColumnNo=12;
 markerMethod=1;
 for(var i = 0; i < t.rows.length; i++) {
   if (ListFilter(t.rows[i])) {
     sAlpha=getMarkerColor(i);
     OS += "<dt>" +
           "<span style='padding:6px;display:inline-block;vertical-align:top'><img "+
           "src='https://maps.gstatic.com/mapfiles/marker"+sAlpha+".png'></span>"+
           "<input style='margin-top:10px;' type=checkbox value='"+i+"' id=row"+i+" name=row"+i+">" +
           "<span onclick='LinkPatient(\""+i+"\");'" +
           " style='width:80%;padding:5px;display:inline-block;vertical-align:top'>"+t.rows[i][2] +
           "<br>"+t.rows[i][3]
     if (t.rows[i][6]=="1") {
        OS += "<span class=InformationIcon title='Partial Address Match\n"+t.rows[i][7]+"'></span>"
     }
     if (!isWhitespace(t.rows[i][8])) {
        OS += " ("+t.rows[i][8]+")"
     }
     OS += "<br> "+t.rows[i][9];
     OS += "<br>Carer : "+t.rows[i][11];
     if (!isWhitespace(t.rows[i][10])) OS += "<br>Problem  : "+t.rows[i][10];
     if (!isWhitespace(t.rows[i][14])) OS += "<br>Status   : "+t.rows[i][14];
     if (!isWhitespace(t.rows[i][15])) OS += "<br>Comment  : "+t.rows[i][15];
     if (!isWhitespace(t.rows[i][16])) OS += "<br>" + t.rows[i][16];
     OS += "</span><dt>"
   }
 }
 if (t.rows.length==0) {
    OS+="<dt style='text-align:center;color:darkred;'>"+
        "No Patients Matching."+
        "</dt>";
 }
 OS += "</dl>";
 document.getElementById("TableLocation").innerHTML=OS;
}
function LinkPatient(rowNo) {
  el=document.SelectPeriod;
  lastdate=el.lastdate.options[el.lastdate.selectedIndex].text;
  switch (lastdate.substr(0,3)) {
    case 'Sun':listcode="HV0";break;
    case 'Mon':listcode="HV1";break;
    case 'Tue':listcode="HV2";break;
    case 'Wed':listcode="HV3";break;
    case 'Thu':listcode="HV4";break;
    case 'Fri':listcode="HV5";break;
    case 'Sat':listcode="HV6";break;
  }
  el.listcode.value=listcode;
  var urnumber=t.rows[rowNo][0].replace(/ /g,"+");
  var admissno=t.rows[rowNo][1].replace(/ /g,"+");
  var username=t.rows[rowNo][11];
  var secureid=t.rows[rowNo][12];
  var webpt008=t.rows[rowNo][13];
  var webpt009=t.rows[rowNo][15];
  var webpt010=t.rows[rowNo][16];
  var defttime=t.rows[rowNo][9].replace(/ *$/,'')
  defttime=defttime.substr(defttime.length-5,5);
  SetCookie("allweb0201033-secureid",secureid);
  SetCookie("allweb0201033-username",username);
  SetCookie("allweb0201033-listcode",listcode);
  SetCookie("allweb0201033-webpt008",webpt008);
  SetCookie("allweb0201033-webpt009",webpt009);
  SetCookie("allweb0201033-webpt010",webpt010);
  SetCookie("allweb0201033-defttime",defttime);
  theURL="cliweb08.pbl?reportno=1&template=21&urnumber="+urnumber+"&admissno="+admissno;
  Left=(document.body.clientWidth-750)/2;
  DFrameLink(theURL,0,Left,750,450);
}
function StringSort(a,b) {
  if (a[SortOrderBy] < b[SortOrderBy] ) { x = -1 }
  if (a[SortOrderBy] == b[SortOrderBy] ) { x = 0  }
  if (a[SortOrderBy] > b[SortOrderBy] ) { x = 1  }
  return x ;
}
function SelectCopy() {
 el=document.SelectPeriod;
 var listcode=el.listcode.value;
 var filtctyp=el.filtctyp.options[el.filtctyp.selectedIndex].value;
 var filtclid=el.filtclid.options[el.filtclid.selectedIndex].value;
 var lastdate=el.lastdate.options[el.lastdate.selectedIndex].value;
 var wardcode=el.wardcode.options[el.wardcode.selectedIndex].value;
 var listcopy=el.listcopy.options[el.listcopy.selectedIndex].value;
 if (isWhitespace(listcopy)) {
   alert("Copy From Day is Required");
   return;
 }
 if (confirm('Warning: This will overwrite any existing carer allocation for this day.\n'+
              'Click Ok to Continue')) {
   theURL="geocod01.php?reportno=9"+
        "&filtctyp="+filtctyp.replace(/ /g,"+")+
        "&filtclid="+filtclid.replace(/ /g,"+")+
        "&lastdate="+lastdate.replace(/ /g,"+")+
        "&listcode="+listcode.replace(/ /g,"+")+
        "&listcopy="+listcopy.replace(/ /g,"+")+
        "&wardcode="+wardcode.replace(/ /g,"+");
    var xmlHttp = createHttpObject();
    xmlHttp.open("GET", theURL, false);
    xmlHttp.send();
    if (xmlHttp.responseText==""&&xmlHttp.status == 200) {
       document.SelectPeriod.submit();
    } else {
      alert(xmlHttp.responseText);
    }
  }
}
function AllocatePatients() {
  var carertoo=document.SelectPeriod.carertoo.value;
  if (isWhitespace(carertoo)) {
    alert("Move To Carer is Required");
    return;
  }
  AddFavList();
  var el=document.getElementsByTagName("INPUT");
  for (var i=1;i<el.length;i++) {
    if (el[i].name.match(/row/)) {
      if (el[i].checked) {
        SetUserPatient(el[i].value);
      }
    }
  }
  location.reload();
}
function SetUserPatient(rowNo) {
  var el=document.SelectPeriod;
  lastdate=el.lastdate.options[el.lastdate.selectedIndex].text;
  switch (lastdate.substr(0,3)) {
    case 'Sun':listcode="HV0";break;
    case 'Mon':listcode="HV1";break;
    case 'Tue':listcode="HV2";break;
    case 'Wed':listcode="HV3";break;
    case 'Thu':listcode="HV4";break;
    case 'Fri':listcode="HV5";break;
    case 'Sat':listcode="HV6";break;
  }
  var urnumber=t.rows[rowNo][0].replace(/ /g,"+");
  var admissno=t.rows[rowNo][1].replace(/ /g,"+");
  var secureid=t.rows[rowNo][12];
  var webpt008=t.rows[rowNo][13];
  var webpt009=t.rows[rowNo][15];
  var webpt010=t.rows[rowNo][16];

  serviceURL='patweb02.pbl'
  postStr='reportno=2&updttype=D&securety=1' +
          '&nextpage=1&redirect=AJAXPOST' +
          '&secureid='+secureid.replace(/ /g,"+") +
          '&webpt002='+listcode.replace(/ /g,"+") +
          '&webpt003='+urnumber.replace(/ /g,"+");
  AJAXPost(serviceURL,postStr);

  secureid=el.carertoo.value;
  postStr='reportno=2&updttype=A&securety=1' +
          '&nextpage=1&redirect=AJAXPOST' +
          '&secureid='+secureid.replace(/ /g,"+") +
          '&webpt002='+listcode.replace(/ /g,"+") +
          '&webpt003='+urnumber.replace(/ /g,"+") +
          '&webpt004='+admissno.replace(/ /g,"+") +
          '&webpt008='+webpt008.replace(/ /g,"+") +
          '&webpt009='+webpt008.replace(/ /g,"+") +
          '&webpt010='+webpt008.replace(/ /g,"+");
  AJAXPost(serviceURL,postStr);

}
function AddFavList() {
  var el=document.SelectPeriod;
  secureid=el.carertoo.value;
  lastdate=el.lastdate.options[el.lastdate.selectedIndex].text;
  switch (lastdate.substr(0,3)) {
    case 'Sun':listcode="HV0";break;
    case 'Mon':listcode="HV1";break;
    case 'Tue':listcode="HV2";break;
    case 'Wed':listcode="HV3";break;
    case 'Thu':listcode="HV4";break;
    case 'Fri':listcode="HV5";break;
    case 'Sat':listcode="HV6";break;
  }
  webpd002=listcode;
  webpd003='Home Visit List - ' + lastdate.substr(0,3);
  serviceURL='patweb02.pbl'
  postStr='reportno=1&updttype=A&securety=1' +
          '&nextpage=1&redirect=AJAXPOST' +
          '&webpd002='+webpd002.replace(/ /g,"+") +
          '&webpd003='+webpd003.replace(/ /g,"+") +
          '&secureid='+secureid;
  AJAXPost(serviceURL,postStr);
}
function AJAXPost(serviceURL,postStr) {
  var xmlHttp = createHttpObject();
  xmlHttp.open("POST", serviceURL, false);
  xmlHttp.setRequestHeader("Content-Type", "application/x-www-form-urlencoded");
  xmlHttp.send(postStr);
  if (xmlHttp.status == "200") {
     return; /* Ignore error this just makes sure the list exists */
  } else {
      alert("Web Service Not Available. Check your Connection and Try Again.");
  }
}
function MovePatients() {
  el=document.SelectPeriod.carerfrm
  var carerfrm=el.options[el.selectedIndex].value;
  var carertoo=document.SelectPeriod.carertoo.value;
  var listcode=document.SelectPeriod.listcode.value;
  el=document.SelectPeriod.carerfrm
  if (isWhitespace(carerfrm)) {
    alert("Move From Carer is Required");
    return;
  }
  if (isWhitespace(carertoo)) {
    alert("Move To Carer is Required");
    return;
  }
  theURL="geocod01.php?reportno=8"+
         "&carerfrm="+carerfrm.replace(/ /g,"+")+
         "&carertoo="+carertoo.replace(/ /g,"+")+
         "&listcode="+listcode.replace(/ /g,"+");
  var xmlHttp = createHttpObject();
  xmlHttp.open("GET", theURL, false);
  xmlHttp.send();
  if (xmlHttp.responseText==""&&xmlHttp.status == 200) {
     document.SelectPeriod.submit();
  } else {
    alert(xmlHttp.responseText);
  }
}
</script>
</head>
<body onload='PageLoad(event);InitTable()'>
<table cellspacing=0 cellpadding=2 bgcolor=#CCCCCC border=0 width=100%>
<form name=SelectPeriod action=outweb02.pbl method=get>
<input type=hidden name=reportno value=01>
<input type=hidden name=template value=021>
<input type=hidden name=viewtype value="%OUTWEB02.01.011">
<input type=hidden name=usersite value="%STANDARD.01.023">
<input type=hidden name=defctype value="%OUTWEB02.01.025">
<input type=hidden name=deftclid value="%OUTWEB02.01.036">
<input type=hidden name=wbseclid value="%STANDARD.01.026">
<input type=hidden name=sesskeys value="">
<input type=hidden name=actionty value="">
<input type=hidden name=hospcode value="">
<input type=hidden name=listcode value="">
<tr><td style='width:8%;' class=DataLabel>Clinic Type</td>
    <td class=DataItem>
    <select name=filtctyp onchange="SelectType();">
    <option value=""></option>
    </select>
    </td>
    <td style='width:8%;' class=DataLabel>Clinic ID</td>
    <td class=DataItem>
    <select name=filtclid onchange="SelectClin();">
    <option value=""></option>
    </select></td>
    <td style='width:8%;' class=DataLabel>Ward</td>
    <td style='width:20%;' class=DataLabel>
      <select name=wardcode id=wardcode onchange="SelectWard()">
      <option></option>
      </select></td>
    <td></td>
    <td></td>
    </tr>
<tr>
    <td style='width:10%' class=DataLabel>Date</td>
    <td style='width:20%' class=DataLabel>
     %OUTWEB02.01.007
    </td>
    <td style='width:8%' class=DataLabel>Carer </td>
    <td style='width:20%' class=DataLabel>
      <select id=carerflt name=carerflt onchange='SelectCarer();'>
      <option value=''>All Carers</option>
      </select>
    </td>
    <td></td>
    <td></td>
    <td></td>
    <td></td>
</tr>
<tr><td style='width:8%;' class=DataLabel>Copy from Day</td>
    <td style='width:20%;' class=DataLabel>
      <select name=listcopy id=listcopy onchange="SelectCopy()">
       <option value="">Select Day</option>
       <option value="HV0">Sunday</option>
       <option value="HV1">Monday</option>
       <option value="HV2">Tuesday</option>
       <option value="HV3">Wednesday</option>
       <option value="HV4">Thursday</option>
       <option value="HV5">Friday</option>
       <option value="HV6">Saturday</option>
      </select></td>
    <td style='width:8%;' >Move From </td>
    <td><select id=carerfrm name=carerfrm>
        <option value=''>Select From Carer</option>
        </select>
    </td>
    <td style='width:8%;' >To Carer</td>
    <td nowrap colspan=4>
    <input type=text name=username size=30 class=Mandatory title=Carer
     class="Mandatory" searchType="7" returnId="carertoo" value="" 
     onfocus="this.value='';" onkeyup="AutoSuggest();">
    <input type=hidden name=carertoo id=carertoo>
    <input class=button type=button name=Move value=Move onclick='MovePatients();'>
    <input class=button type=button name=Allocate value=Allocate onclick='AllocatePatients();'>
    </td>
</tr>
</form>
</table>
<table width=100% border=1 cellpadding=0 cellspacing=0 style='border:1px solid #ccc;'>
<tr valign=top><td width=30%><div id="TableLocation"></div></td>
    <td><div id=MapLocation style='width:100%;height:600px;'></div></td>
</table>
<div id='-suggestion-panel-wrapper' style='display:none;'>
 <div id='-suggestion-panel-wrapper2' style='width:100%'>
  <ul id='-suggestion-table' style='width:100%'></ul>
 </div>
</div>

<div name="PopUpScreen" id="PopUpScreen" style="display: none;">
<iframe scrolling="no" width="100%" height="100%" name="PopUpFrame" id="PopUpFrame"></iframe>
<div name="PopUpScreen" id="PopUpScreen" style="display: none;">
<iframe scrolling="no" width="100%" height="100%" name="PopUpFrame" id="PopUpFrame"></iframe>
<iframe scrolling="no" style="display: none;" name="PopUpFrame1" id="PopUpFrame1"></iframe>
</div>
</body>
</html>

