<meta name="TemplateVersion" content="V12.01.00">
<meta name="TemplateHome" content="standard">
<meta name="HelpFileName" content="NoContextSet.html">
<meta name="CrossBrowser" content="true">
<script type="text/javascript" src=../js/TableSort.js></script>
<script type="text/javascript">
function SelectSubmit() {
document.SelectPeriod.submit();
}
//----------------------------------------------------------------------------
// Columns Available
//  0 - HTML Link   
//  1 - Date
//  2 - U/R
//  3 - Visit Number
//  4 - Patient Name
//  5 - Surgeon
//  6 - Patient folder
//  7 - Patient folder link
//  8 - Expected start time
//  9 - HTML Link 
// 10 - Item Code - Item description
// 11 - Confirm CMBS Checkbox
// 12 - Theatre Complete Checkbox
// 13 - End Time
// 14 - Reason Incomplete
// 15 - Sugeon Name
// 16 - Anaesthetist Name
// 17 - HTML Link - Reason Theatre Incomplete Update
//---------------------------------------------------------------------------
function InitTable(TableView) {
  f = document.SelectPeriod;
  switch (TableView) {
    case 0:
      t = new Table(1,0,2,"100%","center",35,35);
      t.addColumn("Patient","ImageText",4,4,"left","PatientFolder","9",90,"6")
      t.addColumn("Visit Number","String",3,3,"left","ClinicalNote.gif","0",40)
      if (f.surgmenu.value == "2") {
        t.addColumn("Operating Surgeon","String",15,15,"left","","",80)
        t.addColumn("Anaesthetist","String",16,16,"left","","",80)
      }
      else {
        if (f.surgmenu.value == "1") {
          t.addColumn("Surgeon","String",15,15,"left","","",80)
          t.addColumn("Anaesthetist","String",16,16,"left","","",80)
        }
        else {
          t.addColumn("Consultant","String",5,5,"left","","",80)
        }
      }   
      t.addColumn("Date of Operation","Date",1,1,"left","","",45)
      t.addColumn("Start Time","String",8,8,"left","","",30)
      if (f.surgmenu.value == "2") {
        t.addColumn("MBS Item","String",10,10,"left","","",90)
        t.addColumn("Confirm MBS","String",11,11,"left","","",25)
        t.addColumn("Theatre Complete","String",12,12,"left","","",35)
        t.addColumn("Reason Theatre Incomplete","String",14,14,"left","MaintenanceIcon.gif","17",50)
      }
      else {
        t.addColumn("CMBS Item","String",10,10,"left","","",90)
        t.addColumn("Confirm CMBS","String",11,11,"left","","",25)
        t.addColumn("Theatre Complete","String",12,12,"left","","",35)
        t.addColumn("Reason Theatre Incomplete","String",14,14,"left","","",50)
      }
      AddTableRows()
      TableOutput(1,1);
      HideWaitScreen();
      break; 
  }
}
function PatientLink(urno,visit) {
  linkurl="patweb98.pbl?reportno=1&template=1&urnumber=" + urno +
          "&admissno=" + visit;
  location.href=linkurl;
}
function VisitLink(urno,visit) {
  linkurl="oprweb02.pbl?reportno=4&template=2&urnumber=" + urno +
          "&admissno=" + visit;
  DFrameLink(linkurl,60,200,450,280);
}
function ReasonTheatreInComplete(urno,visit,thetUniq) {
  linkurl="oprweb02.pbl?reportno=4&template=3&" +
          "urnumber=" + urno +
          "&admissno=" + visit +
          "&thetuniq=" + thetUniq;
  Left=(document.body.clientWidth-600)/2
  DFrameLink(linkurl,0,Left,600,200)
}
function CMBSConfirm(mtikey) {
  var mtichecked=0;
  if (mtikey.checked==true) {
    mtichecked="1";
  }
  var serverURL = "../cgi-bin/oprweb02.pbl?reportno=4&updatety=C" +
                  "&pmmtikey=" + mtikey.value.replace(/ /g,"+") +
                  "&mticheck=" + mtichecked
  var returnValue = RSExecute(serverURL);
  if (returnValue.status!=0) {
    ReturnCode.select();
  }
}
function CMBSConfirmUniq(viskey,opdauniq) {
  var mtichecked=0;
  if (viskey.checked==true) {
    mtichecked="1";
  }
  var serverURL = "../cgi-bin/oprweb02.pbl?reportno=4&updatety=U" +
                  "&visitkey=" + viskey.value.replace(/ /g,"+") +
                  "&mticheck=" + mtichecked +
                  "&thetuniq=" + opdauniq;
  var returnValue = RSExecute(serverURL);
  if (returnValue.status!=0) {
    ReturnCode.select();
  }
}
function TheatreConfirm(viskey,opdauniq) {
  var vischecked=0;
  if (viskey.checked==true) {
    vischecked="1";
  }
  var serverURL = "../cgi-bin/oprweb02.pbl?reportno=4&updatety=T" +
                  "&visitkey=" + viskey.value.replace(/ /g,"+") +
                  "&vischeck=" + vischecked +
                  "&thetuniq=" + opdauniq;
  var returnValue = RSExecute(serverURL);
  if (returnValue.status==0) {
    location.reload(1);
  }
}
function DisplayFieldsView() {
  f = document.SelectPeriod;
  if (f.surgmenu.value == 2) {
    spnCmbsStatusLbl.innerHTML = mbsStatusLbl.innerHTML;
    spnConsultSurgeonLbl.innerHTML = surgeonLbl.innerHTML;
    document.getElementById('LocationFilterLbl').style.display = "";
    document.getElementById('LocationFilterField').style.display = "";
  } 
  else {
    spnCmbsStatusLbl.innerHTML = cmbsStatusLbl.innerHTML;
    spnConsultSurgeonLbl.innerHTML = consultantLbl.innerHTML;
    document.getElementById('LocationFilterLbl').style.display = "none";
    document.getElementById('LocationFilterField').style.display = "none";
  }
}
function RefreshScreen() {
  f = document.SelectPeriod;
  f.submit();
}
</script>
</head>
%START.OF.PAGE
<body onload="PageLoad(event);InitTable(0);DisplayFieldsView();">
<span id=WaitBoxDisplay class=WaitBox style="display:none">
<img class=WaitImage src="../images/wait.gif">
<p>Please Wait ...</p>
</span>
<div id=PageLayer class=DimmedLayer style="display:none"></div> 
<script type="text/javascript">
ShowWaitScreen();
</script>

<div id=HeadingSection>
<form name=SelectPeriod action=oprweb02.pbl method=get style="margin:0">
<input type=hidden name=reportno value=4>
<input type=hidden name=template value=1>
<input type=hidden name=viewtype value="%OPRWEB02.04.002">
<input type=hidden name=redirect value="oprweb02.pbl?reportno=4&template=1">
<input type=hidden name=nextpage value="">
<input type=hidden name=surgmenu value="%OPRWEB02.04.017">

<table cellpadding=3 cellspacing=0 bgcolor=#CCCCCC border=0 width=100%>
 <tr><td><span id=spnCmbsStatusLbl></span></td>
 <td>
  <select class=PMenuSelectList name=cmbsstat onchange='SelectPeriod.submit()'>
    <option value=" ">All </option>
    <option value="1">CMBS Confirmed</option>
    <option value="2">CMBS Unconfirmed </option>
    </select></td>
 <td id=LocationFilterLbl>Location</td>
 <td id=LocationFilterField> 
  <select class=PMenuSelectList name=surgtype onchange='SelectPeriod.submit()'>
    <option value=" ">All </option>
     %OPRWEB02.04.018.2
  </select>
 </td> 
 <td>Theatre Status</td>
 <td>
   <select class=PMenuSelectList name=theatres onchange='SelectPeriod.submit()'>
    <option value=" ">All </option>
    <option value="1">Theatre Complete </option>
    <option value="2">Theatre InComplete </option>
    </select> 
</td>
<td align=right>
   <td><input type=button value="<<" class=SmallButton
   onClick='location.href="%OPRWEB02.04.003"'>
   %OPRWEB02.04.005
   <input type=button value=">>" class=SmallButton
   onClick='location.href="%OPRWEB02.04.004"'>
  <a href='javascript:SelectDateFrame();'>
  <img src="../images/DateLookup.gif" 
   alt="Select Date" class=Icon></a>
  <a href='javascript:SelectView("0");'>
  <img src=../images/DayIcon.gif 
   alt="View Today" class=Icon></a>
  <a href='javascript:SelectView("1");'>
  <img src=../images/WeekIcon.gif 
   alt="View This Week" class=Icon></a>
  <a href='javascript:SelectView("2");'>
  <img src=../images/MonthIcon.gif 
   alt="View This Month" class=Icon></a>
</td></tr>
<tr><td class=DataLabel><span id=spnConsultSurgeonLbl></span></td>
    <td class=DataField >
    <input type=text name=doctcode size=8 maxlength=8
     value="%OPRWEB02.04.012.003"
     onblur="UpCase(this);
     validateCode(3,SelectPeriod.doctcode,SelectPeriod.n_doctcode);
                 document.SelectPeriod.submit();">
    <input type=text name=n_doctcode size=40 radonly notab
     value="%OPRWEB02.04.012.002">
    <a href="javascript:DoctorSearchFrame(SelectPeriod.doctcode,
       SelectPeriod.n_doctcode,SelectSubmit)">
    <img src=../images/SearchIcon.gif class=Icon></a></td></tr>
</table>
</form>
</div>
<div id=TableLocation></div>

<form name=LinkForm method=get action=oprweb01.pbl>
<input type=hidden name=reportno value=4>
<input type=hidden name=template value=3>
<input type=hidden name=casekeys >
</form>

<span id=consultantLbl style="display:none">
<td class=DataLabel>Consultant</td>
</span>
<span id=surgeonLbl style="display:none">
<td class=DataLabel>Surgeon</td>
</span>
<span id=mbsStatusLbl style="display:none">
<td class=DataLabel>MBS Status</td>
</span>
<span id=cmbsStatusLbl style="display:none">
<td class=DataLabel>CMBS Status</td>
</span>

<script type="text/javascript">
function AddTableRows() {
%OPRWEB02.04.001.oprweb03.01.001
}

CMBSStatus="%OPRWEB02.04.011"
for (var i =0 ; i < document.SelectPeriod.cmbsstat.length; i++) {
  if (document.SelectPeriod.cmbsstat.options[i].value==CMBSStatus) {
       document.SelectPeriod.cmbsstat.selectedIndex=i;
  }
};

TheatreStatus="%OPRWEB02.04.010"
for (var i =0 ; i < document.SelectPeriod.theatres.length; i++) {
  if (document.SelectPeriod.theatres.options[i].value==TheatreStatus) {
       document.SelectPeriod.theatres.selectedIndex=i;
  }
};
</script>
