%START.OF.PAGE
<meta name="TemplateVersion" content="V12.01.00">
<meta name="TemplateHome" content="standard">
<meta name="HelpFileName" content="NoContextSet.html">
<meta name="CrossBrowser" content="true">
<meta http-equiv="X-UA-Compatible" content="IE=edge" /> 
<script type="text/javascript" src="../js/OutpatientSelect.js"></script>
<script type="text/javascript" src="../js/OutpatientClinicId.js"></script>
<script type="text/javascript" src="https://maps.googleapis.com/maps/api/js?v=3&key=%STANDARD.01.044.124.161.050"></script>
<script type="text/javascript" src="../js/GoogleLibrary.js"> </script>
<style type=text/css>
.InformationIcon {
  background: url("../images/AlertSprite.png") -0px -140px no-repeat;
  width:20px;
  height:20px;
}
</style>
<script type="text/javascript">
function InitTable() {
  HospitalFilter();
  SetLists();
  el=document.getElementById("MapLocation");
  el.innerHTML="<span style='font-size:12px;background-color:#111;color:eee;"+
               "border:1px solid grey;position:absolute;"+
               "text-align:center;height:50px;width:300px;"+
               "margin-left:200px;margin-top:100px;padding:50px;'>"+
               "<img src='../images/loading.gif'><br><br>Geo Coding in Progress<br>Please Wait</span>";
  setTimeout(function(){ DisplayTable(); }, 100);
}
function DisplayTable() {
 t = new Table();    // Create New Table Object
 el=document.SelectPeriod;
 deptcode=el.deptcode.options[el.deptcode.selectedIndex].value;
 filtclid=el.filtclid.options[el.filtclid.selectedIndex].value;
 filtctyp=el.filtctyp.options[el.filtctyp.selectedIndex].value;
 doctcode=el.doctcode.value;
 filtteam=el.filtteam.value;
 theURL="geocod01.php?reportno=4"+
        "&doctcode="+doctcode.replace(/ /g,"+")+
        "&deptcode="+deptcode.replace(/ /g,"+")+
        "&filtclid="+filtclid.replace(/ /g,"+")+
        "&filtctyp="+filtctyp.replace(/ /g,"+")+
        "&filtteam="+filtteam.replace(/ /g,"+")
 if(document.SelectPeriod.alcndhos.value=="1") {
   filthosp=el.filthosp.options[el.filthosp.selectedIndex].value;
   filtpsit=el.filtpsit.options[el.filtpsit.selectedIndex].value;
   theURL+="&filthosp="+filthosp.replace(/ /g,"+")+
           "&filtpsit="+filtpsit.replace(/ /g,"+")
 }
 var xmlHttp = createHttpObject();
 xmlHttp.open("GET", theURL, false);
 xmlHttp.send();
 if (xmlHttp.responseText!=""&&xmlHttp.status == 200) {
    h = document.getElementsByTagName("head")[0];
    s = document.createElement("script");
    s.type="text/javascript";
    h.appendChild(s);
    s.text=xmlHttp.responseText;
    AddRows();
 }
 ShowList();
 DisplayMap();
}
function ShowList() {
 var OS = "<dl>";
 LinkFlag=false;
 for(var i = 0; i < t.rows.length; i++) {
   sAlpha=getMarkerColor(i);
   OS += "<dt onclick='LinkPatient(\""+i+"\");'>" +
         "<span style='padding:5px;display:inline-block;vertical-align:top'><img "+
         "src='https://maps.gstatic.com/mapfiles/marker"+sAlpha+".png'></span>"+
         "<span style='width:80%;padding:5px;display:inline-block;vertical-align:top'>"+t.rows[i][2] +
         "<br>"+t.rows[i][3]
   if (t.rows[i][6]=="1") {
      OS += "<span class=InformationIcon title='Partial Address Match\n"+t.rows[i][7]+"'></span>"
   }
   if (!isWhitespace(t.rows[i][8])) {
     OS += " ("+t.rows[i][8]+")"
   }
   OS += "<br>Problem : "+t.rows[i][9] + "</span>"+
         "<dt>"
 }
 if (t.rows.length==0) {
    OS+="<dt style='text-align:center;color:darkred;'>"+
        "No Patients Matching."+
        "</dt>";
 }
 OS += "</dl>";
 document.getElementById("TableLocation").innerHTML=OS;
}
function SelectPeriodSubmit() {
 SelectPeriod.submit();
}
//
function UpdateReferral(urn,adn,dpc) {
   PatientLinks.urnumber.value=urn
   PatientLinks.admissno.value=adn
   PatientLinks.deptcode.value=dpc
   PatientLinks.submit()
}
//
function AddNewReferral() {
   AddReferral.doctcode.value=SelectPeriod.doctcode.value
   Left=(document.body.clientWidth-900)/2
   DFrameSubmit(AddReferral,0,Left,900,550);
}
function AddUserReferral() {
   if(isWhitespace(document.PatientLinks.wbsedall.value)) {
     alert("User does not have a default department.");
     return;
   }
   document.AddReferral.allrf001.value=document.PatientLinks.wbsedall.value;
   Left=(document.body.clientWidth-900)/2
   DFrameSubmit(AddReferral,0,Left,900,550);
}
function SetLists() {
 SetClinicType(SelectPeriod.filtctyp,SelectPeriod.defctype.value,SelectPeriod.usersite.value);
 if(isWhitespace(SelectPeriod.deftclid.value)) {
    SelectPeriod.deftclid.value=SelectPeriod.wbseclid.value;
 }
 SetClinicId(SelectPeriod.filtclid,SelectPeriod.deftclid.value,SelectPeriod.usersite.value);
}
function HospitalFilter() {
  if(document.SelectPeriod.alcndhos.value=="1") {
    document.getElementById("HospitalFilter").style.display="";
  }
}
</script>
</head>
<body onload="PageLoad(event);InitTable();">
<div id="HeadingSection"> 
<div id="PHeadingSection">
<form name=PatientLinks action=allweb02.pbl method=get style="margin:0">
<input type=hidden name=reportno value=2>
<input type=hidden name=template value=32>
<input type=hidden name=urnumber>
<input type=hidden name=admissno>
<input type=hidden name=deptcode>
<input type=hidden name=wbsedall value="%STANDARD.01.028">
</form>

<form name=SelectPeriod action=allweb02.pbl method=get style="margin:0">
<input type=hidden name=reportno value=1>
<input type=hidden name=template value=32>
<input type=hidden name=usersite value="%STANDARD.01.023">
<input type=hidden name=wbseclid value="%STANDARD.01.026">
<input type=hidden name=defctype value="%ALLWEB02.01.028">
<input type=hidden name=deftclid value="%ALLWEB02.01.027">
<input type=hidden name=alcndhos value="%STANDARD.01.025.106.224.0.1">
<input type=hidden name=hospcode value="%STANDARD.01.032">

<table width=100% cellspacing=0 border=0 bgcolor=#cccccc>
<tr><td>Department</td>
    <td>
    <select class=PMenuSelectList id=deptcode name=deptcode 
     onchange="SelectPeriodSubmit()">
    <option></option>
     %ALLWEB02.01.012.2
    </select></td>

    <td class=DataLabel>HCP</td>
    <td><input type=text id=doctcode name=doctcode value="%ALLWEB02.01.020.0"
     class=DataField size=10 maxlength=8
     onchange="ValidateHCP(18,13,doctcode,psevt000,SelectPeriodSubmit);">
    <input type=text name=psevt000 title="Attending HCP" readonly
     id=psevt000 size=24 value="%ALLWEB02.01.020.1">
    <img src="../images/SearchIcon.gif" class=Icon
     onclick="HCPSearchFrame(doctcode,psevt000,4,SelectPeriodSubmit);">
    <img src="../images/ClearIcon.gif" class=Icon
     onclick="clrFields(doctcode,psevt000,SelectPeriodSubmit);"></td>
    </tr>
<tr><td class=DataLabel>Clinic ID</td>
   <td><select name=filtclid onchange="SelectPeriodSubmit();"
    class=SelectBig>
   <option value="zzzzzz">Select Clinic ID</option>
   </select></td>

   <td class=DataLabel>Clinic Type</td>
   <td><select name=filtctyp class=SelectBig onchange="SelectPeriodSubmit();"
    id=filtctyp>
   <option value="  ">Select Clinic Type</option>
   </select></td>

   <td class=DataLabel>Case Team
   <input type=text name=filtteam size=10 maxlength=10 title="Case Team"
        id=filtteam value="%ALLWEB02.01.025.1"
        onblur="validateCode2(7,filtteam,n_filtteam,SelectPeriodSubmit)">
       <input type=text id=n_filtteam name=n_filtteam size=25 readonly 
        value="%ALLWEB02.01.025.0"
        class=Readonly tabindex=-1 title="Team Description">
       <img src="../images/SearchIcon.gif" class=Icon
        onclick="TeamSearchFrame(filtteam,n_filtteam,SelectPeriodSubmit)">
        <img src="../images/ClearIcon.gif" class=Icon
        onclick="clrFields(filtteam,n_filtteam,SelectPeriodSubmit);">
       </td></tr>

<tr id=HospitalFilter style='display:none;'>
    <td>Hospital</td>
    <td><select id=filthosp name=filthosp onchange="SelectPeriodSubmit()" >
        <option></option>
        %ALLWEB02.01.039
        </select></td>
    <td>Preferred Site</td>
    <td><select id=filtpsit name=filtpsit onchange="SelectPeriodSubmit()" >
        <option></option>
        %ALLWEB02.01.040
        </select></td>
        </tr>
</table>
</form>
</div>
<form name=AddReferral method=get action=allweb02.pbl style="margin:0">
<input type=hidden name=reportno value=3>
<input type=hidden name=template value=2>
<input type=hidden name=doctcode value="">
<table width=100% cellspacing=0 border=1 bgcolor=#cccccc>
<tr><td align=right class=HeadingCell colspan=2 >Add Referral
    <input type=button class=SlimButton value="Add"
     title="Add referral for users department" onclick="AddUserReferral();">
    <select class=PMenuSelectList id=allrf001 name=allrf001 
     onmouseover='MenuOver(event,this)'
     onchange="AddNewReferral();">
    <option></option>
     %ALLWEB02.01.012.2
    </select></td></tr>
</table>
</form>
</div>

<table width=100% border=1 cellpadding=0 cellspacing=0 style='border:1px solid #ccc;'>
<tr valign=top><td width=30%><div id="TableLocation"></div></td>
    <td><div id=MapLocation style='width:100%;height:600px;'></div></td>
</table>

