<meta name="TemplateVersion" content="V12.01.00">
<meta name="TemplateHome" content="standard">
<meta name="HelpFileName" content="NoContextSet.html">
<meta name="CrossBrowser" content="true">

<script type="text/javascript" >
function limitText(limitField, limitCount, limitNum) {
	if (limitField.value.length > limitNum) {
		limitField.value = limitField.value.substring(0, limitNum);
	} else {
		limitCount.value = limitNum - limitField.value.length;
	}
}
function SubmitTheatreRequest() {

 if(!validateMandatory(AddForm)) return;

 document.AddForm.submit();

}
function ChkInp() {

  p=AddForm;

  var serverURL   = "../cgi-bin/comweb80.pbl?reportno=95" +
                    "&valdcode=" + p.urnumber.value.replace(/ /g,"+");
  var returnValue = RSExecute(serverURL);
  if (returnValue.status==0) {
    if (returnValue.return_value) {
      if (!confirm("Warning: Patient is Deceased.\n Click OK to continue with booking")) {
        location.href=document.AddForm.redirect.value;
      }
    }
  }

  if (AddForm.currflag.value=="1" ||AddForm.currflag.value=="2") {
    if(confirm("Use the current Admission or Create a new booking\n" +
               "   Ok to use the Current, Cancel to Create New")) {
      AdmissionLinkSearchFrame();
      return;
    }
  }
}
function AdmissionLinkSearchFrame(){
  DFrameStart();
  document.getElementById('PopUpFrame').src =
  "../lookups/AdmissionLinkReqSearchFrame.html";
  SearchFrameShow();
}
function valDoctorUnit() {
  ValidateHCP(18,0,AddForm.bkreq012,AddForm.doctnam1);
  selectOptions("30",AddForm.bkreq012,AddForm.bkreq013);
  AddForm.bkreq013.selectedIndex=1;
}
function checkBookingIndicator() {
  if (document.AddForm.bkreq007.value.substr(3,1)=="B") {
    DateLookupDIV.innerHTML="";
    TimeIconsDIV.innerHTML="";
    document.AddForm.bkreq014.value="";
    document.AddForm.bkreq015.value="";
    document.AddForm.bkreq014.className="Readonly";
    document.AddForm.bkreq015.className="Readonly";
    document.AddForm.bkreq014.readOnly=true;
    document.AddForm.bkreq015.readOnly=true;
  } else {
    DateLookupDIV.innerHTML=DateLookupSPAN.innerHTML;
    TimeIconsDIV.innerHTML=TimeIconsSPAN.innerHTML;
    document.AddForm.bkreq014.className="Mandatory PastDate";
    document.AddForm.bkreq015.className="Mandatory";
    document.AddForm.bkreq014.readOnly=false;
    document.AddForm.bkreq015.readOnly=false;
  }
}
function DateEdits() {
  if (!checkDate(document.AddForm.bkreq014,
                 document.AddForm.bkreq014.title)) {
    return;
  } 

  validateCode(4,
               AddForm.bkreq023,
               AddForm.mbsdesc1,
               AddForm.bkreq014)

  validateCode(4,
               AddForm.bkreq024,
               AddForm.mbsdesc2,
               AddForm.bkreq014)

  validateCode(4,
               AddForm.bkreq025,
               AddForm.mbsdesc3,
               AddForm.bkreq014)
}
function MandatoryTheatreField() {
  f = document.AddForm;
  if (VariableNameExists('OTMandatoryonRequest')) {
    if (OTMandatoryonRequest == true) {
      AddClassName(f.bkreq021,"Mandatory");
    }
    else {
      RemoveClassName(f.bkreq021,"Mandatory");
    }
  }
  else {
    AddClassName(f.bkreq021,"Mandatory");
  }
}

</script>

</head>
%START.OF.PAGE
<body onload="PageLoad(event);ChkInp();MandatoryTheatreField();">
<div id=PageHeadingSection>
<div id=PatientHeading></div>
<script type="text/javascript">
PatientURN="%OPRWEB01.22.003";
PatientVIS="%OPRWEB01.22.081";
PatientNAM="%OPRWEB01.22.002";
PatientSTA="%OPRWEB01.22.086.078";
PatientALT="%OPRWEB01.22.084";
PatientSEX="%OPRWEB01.22.019";
PatientDOB="%OPRWEB01.22.020";
PatientAGE="%OPRWEB01.22.021";
PatientLOC="%OPRWEB01.22.083";
PatientPRI="%OPRWEB01.22.086.066.1";
PatientUNT="%OPRWEB01.22.066.0";
DoctorCOD="%OPRWEB01.22.082.003";
DoctorNAM="%OPRWEB01.22.082.002";
PatientAID="%OPRWEB01.22.086.090";
PatientIND="%OPRWEB01.22.086.091";
PatientCUR="%OPRWEB01.22.086.092";
PatientCLC="%OPRWEB01.22.086.093.1";
PatientCLH="%STANDARD.01.017.CL";
PatientHFT="%OPRWEB01.22.086.094";
PatientCDM="%OPRWEB01.22.086.095";
PatientVDH="%OPRWEB01.22.086.099.015";
InsertPatientHeader()
</script>

<div id=PatientMenu></div>
</div>
<div id=PageBodySection>

<form name=AddForm  method=post action=oprweb01.pbl>
<input type=hidden name=reportno value=22>
<input type=hidden name=template value=1>
<input type=hidden name=urnumber value="%OPRWEB01.22.003">
<input type=hidden name=admissno value="%OPRWEB01.22.081">
<input type=hidden name=updttype value="A">
<input type=hidden name=nextpage value="1">
<input type=hidden name=redirect value="%OPRWEB01.22.001.patweb98.01.001">
<input type=hidden name=currflag value="%OPRWEB01.22.202">
<input type=hidden name=admndate value="%OPRWEB01.22.302">
<input type=hidden name=admntime value="%OPRWEB01.22.303">
<input type=hidden name=ptcnhdps value="%OPRWEB01.22.201">
<input type=hidden name=bkreq002 value="">
<input type=hidden name=bkreq003 value="%OPRWEB01.22.221">
<input type=hidden name=bkreq050 value="">
<input type=hidden name=bkreq049 value="">
<input type=hidden name=bkreq055 value="">
<input type=hidden name=bkreq048 value="">
<table border="0" cellpadding="0" cellspacing="0" width="100%">

<tr><td align=center class=HeadingCell>New Theatre Request</td></tr>
</table>

<table border="0" cellpadding="0" cellspacing="0" width="90%" align=center>

<tr><td class=DataLabel>Priority</td>
    <td class=DataField>
    <select name=bkreq007 title="Priority"  class="Mandatory SelectBig"
     onchange="checkBookingIndicator();">
    <option></option>
    %STANDARD.01.007.rp
    </select></td>
</tr>

<tr>
    <td class=DataLabel>Clock Start</td>
    <td class=DataLabel>
    <table border="0" cellpadding="0" cellspacing="0" width="40%" align=left>
    <tr><td>
    <input type=text name=bkreq014 size=12 maxlength=11 id=bkreq014
     class="Mandatory PastDate"
     onblur="DateEdits()"
     title="Clock Start Date" value="%STANDARD.01.015">
    </td>
    <td>
    <div id="DateLookupDIV">
    <img src=../images/DateLookup.gif class=Icon
     onclick='javascript:DateLookupFrame(bkreq014)'
     tabindex=-1>
    </div>
    </td>
    <td>
    Time
    <input type=text name=bkreq015 size=7 class="Mandatory" id=bkreq015
     title="Clock Start Time" value="%STANDARD.01.016">
    </td>
    <td>
    <div id="TimeIconsDIV">
    <img src=../images/DateTimeStamp.gif  class=Icon
     onclick='javascript:SetCurrentDateTime(bkreq014,bkreq015)'
     tabindex=-1>
    <img src=../images/TimeLookup.gif class=Icon
     onclick='javascript:TimeLookupFrame(bkreq015)'
     tabindex=-1>
    </div>
    </td></tr>
    </table>
    </td>
</tr>

<tr>
    <td class="DataLabel">Requesting Doctor</td>
    <td><input type="text" size="10" maxlength="10" 
         name="bkreq012"
         onblur="valDoctorUnit();" />
        <input type="text" size="25" notab readonly name="doctnam1" />
         <img src="../images/SearchIcon.gif" class="Icon"
         onclick="HCPSearchFrame(AddForm.bkreq012,AddForm.doctnam1,0);" />
    <td>
</tr>

<tr>
  <td class=DataLabel>Unit</td>
    <td class=DataField>
    <select name=bkreq013>
    <option></option>
     %STANDARD.01.007.WU
    </select>
    </td>
</tr>

<tr>
   <td class=DataLabel>Contact</td>
   <td>
<!--   <textarea wrap=hard cols=50 rows=2 name=bkreq016
    onKeyDown="limitText(this,document.AddForm.countdown,100);" 
    onKeyUp="limitText(this,document.AddForm.countdown,100);">
   </textarea>
   <input type=hidden name="countdown" value="100">-->
   <input type=text name=bkreq016 size=100 maxlength=100
    title="Contact">
   </td>
</tr>

<tr>
    <td class=DataLabel>Patient Location</td>
    <td class=DataLabel>
    <input type=text name=bkreq017 size=100 maxlength=50 
     title="Patient Location">
    </td>
</tr>

<tr><td colspan=4 align=center><hr width=100%></td></tr>

<tr><td class=DataLabel>Admitting Point</td>
    <td class=DataField>
    <select name=bkreq018 title="Admitting Point" class="SelectBig">
    <option></option>
    %STANDARD.01.007.ap
    </select></td>


    <td class=DataLabel>Duration</td>
    <td class=DataLabel>
    <input type=text name=bkreq030 size=5 maxlength=3
     title="Duration"> &nbsp; (minutes)
    </td>
</tr>

<tr><td class=DataLabel>Exp. Post Op Ward</td>
    <td class=DataField>
    <select name=bkreq019 title="Exp. Post Op Ward" class="SelectBig">
    <option></option>
    %OPRWEB01.22.119.2
    </select></td>

<tr>
    <td class="DataLabel">Surgeon</td>
    <td><input type="text" size="10" maxlength="10"
         name="bkreq020"
         onblur="ValidateHCP(18,0,bkreq020,doctnam2);" />
        <input type="text" size="25" notab readonly name="doctnam2" />
         <img src="../images/SearchIcon.gif" class="Icon"
         onclick="HCPSearchFrame(AddForm.bkreq020,AddForm.doctnam2,0);" />
    </td>

    <td class=DataLabel>Infection Status</td>
    <td class=DataField>
    <select name=bkreq031 title="Infection Status" class="SelectBig">
    <option></option>
    %STANDARD.01.007.OK
    </select></td>
</tr>

<tr>
    <td class=DataLabel>Theatre</td>
    <td class=DataField>
    <select name=bkreq021 id=bkreq021 title="Theatre" class="SelectBig">
    <option></option>
    %OPRWEB01.22.162
    </select></td>

    <td class=DataLabel>Equipment Required 1</td>
    <td class=DataField>
    <select name=bkreq032 title="Equipment Required 1" class="SelectBig">
    <option></option>
    %STANDARD.01.007.XE
    </select></td>
</tr>

<tr>
    <td class="DataLabel">Consent Obtained</td>
    <td>
    <select name="bkreq058" class="SelectBig">
    <option></option>
    <option value="N">No</option>
    <option value="Y">Yes</option>
    </select>
    </td>

    <td class=DataLabel>Equipment Required 2</td>
    <td class=DataField>
    <select name=bkreq033 title="Equipment Required 2" class="SelectBig">
    <option></option>
    %STANDARD.01.007.XE
    </select></td>
</tr>


<tr>
    <td class=DataLabel>Consent Date</td>
    <td class=DataLabel>
    <input type=text name=bkreq059 size=12 maxlength=11
     onblur="checkDate(this,'Date')"
     title="Consent Date">
    <img src=../images/DateLookup.gif class=Icon
     onclick='javascript:DateLookupFrame(bkreq059)'
     tabindex=-1>
    </td>

    <td class=DataLabel>Equipment Required 3</td>
    <td class=DataField>
    <select name=bkreq034 title="Equipment Required 3" class="SelectBig">
    <option></option>
    %STANDARD.01.007.XE
    </select></td>
</tr>

<tr>
    <td class=DataLabel>Anaesthetic Type</td>
    <td class=DataField>
    <select name=bkreq022 title="Anaesthetic Type" class="SelectBig">
    <option></option>
    %STANDARD.01.007.OA
    </select></td>
</tr>


<tr>
<td class=DataLabel>MBS Codes</td>
    <td><input type=text name=bkreq023 size=9 id=bkreq023
           onblur='validateCode(4,
                                AddForm.bkreq023,
                                AddForm.mbsdesc1,
                                AddForm.bkreq014)'
           title="Expected MBS Item 1" >
        <input type=text readonly name=mbsdesc1 size=50 id=mbsdesc1
           title="Expected MBS Item 1 Name" tabindex=-1>
         <img src="../images/SearchIcon.gif" class=Icon
           onclick="MbsSearchFrame(AddForm.bkreq023,
                                   AddForm.mbsdesc1,
                                   AddForm.bkreq014)"></td>
</tr>

<tr>
<td class=DataLabel></td>
    <td><input type=text name=bkreq024 size=9
           onblur='validateCode(4,
                                AddForm.bkreq024,
                                AddForm.mbsdesc2,
                                AddForm.bkreq014)'
           title="Expected MBS Item 2" >
        <input type=text readonly name=mbsdesc2 size=50
           title="Expected MBS Item 2 Name" tabindex=-1>
         <img src="../images/SearchIcon.gif" class=Icon
           onclick="MbsSearchFrame(AddForm.bkreq024,
                                   AddForm.mbsdesc2,
                                   AddForm.bkreq014)"></td>
</tr>

<tr>
<td class=DataLabel></td>
    <td><input type=text name=bkreq025 size=9
           onblur='validateCode(4,
                                AddForm.bkreq025,
                                AddForm.mbsdesc3,
                                AddForm.bkreq014)'
           title="Expected MBS Item 3" >
        <input type=text readonly name=mbsdesc3 size=50
           title="Expected MBS Item 3 Name" tabindex=-1>
         <img src="../images/SearchIcon.gif" class=Icon
           onclick="MbsSearchFrame(AddForm.bkreq025,
                                   AddForm.mbsdesc3,
                                   AddForm.bkreq014)"></td>
</tr>

<tr>
    <td class=DataLabel>Full Description</td>
    <td class=DataLabel>
    <input type=text name=bkreq026 size=80 maxlength=80
     title="MBS Full Description 1">
    </td>
</tr>

<tr>
    <td class=DataLabel></td>
    <td class=DataLabel>
    <input type=text name=bkreq027 size=80 maxlength=80
     title="MBS Full Description 2">
    </td>
</tr>

<tr>
    <td class=DataLabel></td>
    <td class=DataLabel>
    <input type=text name=bkreq028 size=80 maxlength=80
     title="MBS Full Description 3">
    </td>
</tr>

<tr>
    <td class=DataLabel>Prosthesis Required</td>
    <td class=DataLabel>
    <input type=text name=bkreq029 size=80 maxlength=40
     title="Prosthesis Required">
    </td>
</tr>

<tr>
   <td class=DataLabel>Comments</td>
   <td colspan=3>
   <textarea wrap=hard cols=60 rows=3 name=opcom012></textarea>
   </td>
</tr>

<tr><td colspan=4 align="center">
    <input type=button class="button" value="Ok"
     onclick="tempDisable(this);SubmitTheatreRequest();">
    <input type=button class="button" value="Cancel" 
     onclick=window.history.go(-1)>
    </td>
</tr>

</table>

</form>
</div>
<form name=PatientLinks method=get>
<input type=hidden name=reportno value=22>
<input type=hidden name=template value=001>
<input type=hidden name=urnumber value="%OPRWEB01.22.003">
<input type=hidden name=admissno value="%OPRWEB01.22.081">
<input type=hidden name=MenuType value="%OPRWEB01.22.088">
</form>

<span id=blanklabel style="display:none">&nbsp;</span>

<script type="text/javascript" >
  document.AddForm.bkreq021.selectedIndex=0;
  document.AddForm.bkreq019.selectedIndex=0;
</script>

<span id="DateLookupSPAN" style="display:none">
  <img src=../images/DateLookup.gif class=Icon
   onclick='javascript:DateLookupFrame(bkreq014)'
   tabindex=-1>
</span>
<span id="TimeIconsSPAN" style="display:none">
  <img src=../images/DateTimeStamp.gif  class=Icon
   onclick='javascript:SetCurrentDateTime(bkreq014,bkreq015)'
   tabindex=-1>
  <img src=../images/TimeLookup.gif class=Icon
   onclick='javascript:TimeLookupFrame(bkreq015)'
   tabindex=-1>
</span>
