<meta name="TemplateVersion" content="V12.01.00">
<meta name="TemplateHome" content="standard">
<meta name="HelpFileName" content="">
<meta name="CrossBrowser" content="true">
<script language="javascript" src="../js/allweb03.js"></script>
<script language="javascript" src="../js/allweb02.js"></script>
<script language="javascript" src="../js/allweb0202.js"></script>
<script type="text/javascript" src="../js/OutpatientSelect.js"></script>
<script type="text/javascript" src="../js/OutpatientTypeClinic.js"></script>
<script type="text/javascript">
function getDeptCodeFromQueryString()
{
 var dept = document.getElementById("deptcode");
 dept.value = getQueryString("deptcode");
}

function addMainHealthcondition()
{
  var mhcc = document.getElementById("alrhl004");
  var mhcd = document.getElementById("d_alrhl004");
  mhcc.value = mhcc.value.replace(/ /g,"");

  if(mhcc.value == "")
     return false;;

  var table = document.getElementById("mainHealthTable");

  var tr = document.createElement("tr");
  var tdRemove = document.createElement("td");
  var tdCode = document.createElement("td");
  var tdDescription = document.createElement("td");

  var tdRemoveImage = document.createElement("img");
  var form = parent.document.getElementsByTagName("form");
  var obj = parent.document.createElement("input");

  if(allowMultipleSameDiagnosisCode("document","mhctr"+mhcc.value,mhcd.value,false))
  { 
    tdRemoveImage.setAttribute("id","mhci"+mhcc.value);
    tdRemoveImage.src="../images/DeleteIcon.gif";

    tdRemove.appendChild(tdRemoveImage);

    tdCode.setAttribute("width","100"); 
    tdCode.setAttribute("id","mhcc"+mhcc.value);
    tdCode.innerHTML = mhcc.value;
    tdDescription.innerHTML = mhcd.value;
    tr.setAttribute("id","mhctr"+mhcc.value);
    tr.appendChild(tdRemove);
    tr.appendChild(tdCode);
    tr.appendChild(tdDescription);
    table.getElementsByTagName("TBODY")[0].appendChild(tr);

    obj.type="hidden";
    obj.name = "mhctr"+mhcc.value;
    obj.value = mhcc.value;

    if(form.length>1) {
      if(form[1].name=="InternalReferral") {
        form[1].appendChild(obj);
      } else {
        form[0].appendChild(obj);
      }
    } else {
      form[0].appendChild(obj);
    }

    //blind event handler
    tdRemoveImage.onclick = function()
    {
       var temp = document.getElementById(tr.id);
       table.getElementsByTagName("TBODY")[0].removeChild(temp);
       if(form.length>1) {
         if(form[1].name=="InternalReferral") {
           form[1].removeChild(obj);
         } else {
           form[0].removeChild(obj);
         }
       } else {
         form[0].removeChild(obj);
       }
    }
  }
}

function allowMultipleSameDiagnosisCode(temp,id,description,boolean)
{
  var obj = null;

  if(boolean !== true)
  {
      obj = document.getElementById(id);      

      if(obj)
      {
        alert("Warning diagnosis already exist: "+
               id.replace(/mhctr/,"").replace(/ /g,"")+
               " "+description);

        return false;
      }
    }
  return true;
}

function sendDiagnosisToParentFrame()
{
  renameMainHealthCGI();
  setBtnHealthConditionColor();
  DFrameExit();
}

function loadDiagnosis()
{
  var form = parent.document.getElementsByTagName("form");
  var hiddenElement = form[0].getElementsByTagName("input");
  if(form.length>1) {
    if(form[1].name=="InternalReferral") {
      hiddenElement = form[1].getElementsByTagName("input");
    }
  }

  var table = document.getElementById("mainHealthTable");

  table.onclick = function(e)
  { 
    if(!e)
    {
      e = event; 
      e.target = e.srcElement;
    }
    if(e.target.nodeName.toLowerCase() == 'img')
    { 
       removeObject(table,e.target);     
    }
  }

  for(var i = 0; i < hiddenElement.length; i++)
  {
     if(hiddenElement[i].type == "hidden"
        && hiddenElement[i].name.match("mhct"))
     {
         var tr = document.createElement("tr");
         var tdRemove = document.createElement("td");
         var tdCode = document.createElement("td");
         var tdDescription = document.createElement("td");
         var tdRemoveImage = document.createElement("img");
         var desc= new Object();

         var deptcode = document.getElementById("deptcode");         
 
         if(allowMultipleSameDiagnosisCode("document",hiddenElement[i].id,
                                           "N/A ",false))
         {
           tdRemoveImage.setAttribute("id",hiddenElement[i].id);
           tdRemoveImage.src="../images/DeleteIcon.gif";
           tdRemove.appendChild(tdRemoveImage);
           
           tdCode.setAttribute("width","100");
           tdCode.setAttribute("id",hiddenElement[i].id);
           tdCode.innerHTML = hiddenElement[i].value;

           validateAHDiag(deptcode,hiddenElement[i],desc);
            
           tdDescription.innerHTML = desc.value;
           tr.setAttribute("id",hiddenElement[i].id);

           tr.appendChild(tdRemove);
           tr.appendChild(tdCode);
           tr.appendChild(tdDescription);
           table.getElementsByTagName("TBODY")[0].appendChild(tr);
         }
     }
  }
}

function removeObject(table,obj)
{
  var temp;
  var obj2;
  
  temp = obj.id.replace(/mhci/,"mhctr");
  obj2 = document.getElementById(temp);
  
  var form =  parent.document.getElementsByTagName("form"); 
  var hiddenInputs = form[0].getElementsByTagName("input");
  if(form.length>1) {
    if(form[1].name=="InternalReferral") {
      hiddenInputs = form[1].getElementsByTagName("input");
    }
  }
  
  for(var i = 0; i < hiddenInputs.length; i++)
  {
    if(hiddenInputs[i].type == "hidden" && hiddenInputs[i].name == temp)
    {
       if(form.length>1) {
         if(form[1].name=="InternalReferral") {
           form[1].removeChild(hiddenInputs[i]);
         } else {
           form[0].removeChild(hiddenInputs[i]);
         }
       } else {
           form[0].removeChild(hiddenInputs[i]);
       }
       table.getElementsByTagName("TBODY")[0].removeChild(obj2);
    
    }
  }
}

function setBtnHealthConditionColor()
{
  var form = parent.document.getElementsByTagName("form");
  var element = form[0].getElementsByTagName("input");
  if(form.length>1) {
    if(form[1].name=="InternalReferral") {
      element = form[1].getElementsByTagName("input");
    }
  }

  var button = parent.document.getElementById("btnMainHealth");

  for(var i = 0; i < element.length; i++)
  {
    if(element[i].type == "hidden" && element[i].name.match("mhctr"))
    {  
      button.style.color = "red";
      return;;
    }
  }
  
  button.style.color = "black";
}

function renameMainHealthCGI()
{
  var form = parent.document.getElementsByTagName("form");
  var element = form[0].getElementsByTagName("input");
  if(form.length>1) {
    if(form[1].name=="InternalReferral") {
      element = form[1].getElementsByTagName("input");
    }
  }
  var j = 100;

  for(var i = 0; i < element.length; i++)
  {
    if(element[i].type == "hidden" && element[i].name.match("mhctr"))
    {
       element[i].name = "mhctr"+j;
       element[i].id = "mhctr"+j;
       j++;
    }
  }
}
function VLDiag() {
  if(document.getElementById("chkvinah").value=="1") {
    validateAHDiagV(UpdateForm.deptcode,UpdateForm.alrhl004,
                    UpdateForm.d_alrhl004,UpdateForm.valddate);
  } else {
    validateAHDiagV(UpdateForm.deptcode,UpdateForm.alrhl004,
                    UpdateForm.d_alrhl004);
  }
}
function SRDiag() {
  if(document.getElementById("chkvinah").value=="1") {
    AHDiagSearchFrameV(UpdateForm.deptcode,UpdateForm.alrhl004,
                       UpdateForm.d_alrhl004,UpdateForm.valddate);
  } else {
    AHDiagSearchFrame(UpdateForm.deptcode,UpdateForm.alrhl004,
                      UpdateForm.d_alrhl004);
  }
}
</script>
</head>
%START.OF.PAGE
<body onload="PageLoad(event);getDeptCodeFromQueryString();loadDiagnosis();">
<span class=DFrameTitleBar>
<img class=Icon border=0 align=right src=../images/ExitIcon.gif 
 onclick="sendDiagnosisToParentFrame();">
Episode Health Conditions
</span>
<div id=PageBodySection>
<form id=UpdateForm name=UpdateForm action="allweb02.pbl" method=post
 onsubmit='return validateMandatory(this)'>
<input type=hidden name=reportno value=3>
<input type=hidden name=template value=004>
<input type=hidden name=updatety value="A">
<input type=hidden name=nextpage value=0>
<input type=hidden name=redirect value="">
<input type=hidden id="deptcode" name=deptcode value="" />
<input type=hidden id="chkvinah" name=chkvinah value="%ALLWEB02.03.788" />
<input type=hidden id="valddate" name=valddate value="%ALLWEB02.03.789" />
<table align=center cellspacing=0 cellpadding=1 border=1 width=100%>
<tr>
  <td class="HeadingCell">Code</td>
  <td class="HeadingCell">Description</td>
</tr>
<tr>
  <td class="DataLabel">
    <input type="text" id="alrhl004" name="alrhl004" class="Mandatory" size="10"
    onblur="VLDiag();" />
  </td>
  <td class="DataLabel">
    <input type="text" id="d_alrhl004" name="d_alrhl004" class="ReadOnly" 
      readonly="true" size="50"/>
    <img src="../images/SearchIcon.gif" class="Icon" id="imgSearch"
         onclick="SRDiag();" />
     <img src="../images/ClearIcon.gif" class=Icon
        onclick="clrFields(alrhl004,d_alrhl004);">
    <input type="button" class="button" value="Add" id="addbutton"
           onclick="tempDisable(this);addMainHealthcondition();" />
    <input type="button" class="button" value="Ok" id="okbutton"
           onclick="tempDisable(this);sendDiagnosisToParentFrame();" />
  </td>
</tr>
</table>
<br />
<div style="height:300px;overflow:auto;">
<table id="mainHealthTable" border="1" width="99%">
<tr><td class="HeadingCell" width="50">Remove</td>
<td class="HeadingCell">Code</td>
<td class="HeadingCell">Description</td>
</tr>
</table>
</div>
</form>
</div>
