<meta name="TemplateVersion" content="V12.01.00">
<meta name="TemplateHome" content="standard">
<meta name="HelpFileName" content="NoContextSet.html">
<meta name="CrossBrowser" content="true">
<script type="text/javascript">
function setForm() {
  ExpireCookiePath("CasePath");

  if ( (parent.PatientLinks != undefined) && 
       (parent.PatientLinks.superlev != undefined) )
  {
     document.Patient.superlev.value = parent.PatientLinks.superlev.value;
  }

  if (document.Patient.ptcnualt.value == "1") {
    document.Patient.urnumber.maxLength=20;
    document.Patient.urnumber.size=20;
  }
}

function AddPatient() {
  if (validateMandatory(document.Patient)) {
    // convert visit date string to date value for the server
    document.Patient.visitdat.value = SetDateYYYYMMDD(document.Patient.dat.value);
    document.Patient.submit();
  }
}

function UpdateUR() {
  document.Patient.urnumber.value=document.Patient.dum.value
}

function CheckUR() {
  document.Patient.admissno.value="";

  if (document.Patient.ptcnualt.value == "1") {
    document.Patient.alternid.value=document.Patient.urnumber.value;
    document.Patient.alternid.maxLength=20;
    justifyRight(document.Patient.alternid);
    document.Patient.urnumber.maxLength=8;
    checkAlternateID(document.Patient.alternid.value,
                     document.Patient.aisearch,document.Patient.urnumber);

    if (isWhitespace(document.Patient.urnumber.value)) {
      document.Patient.urnumber.value=document.Patient.alternid.value;
    }
  }
  document.Patient.urnumber.maxLength=8;
  validateUR();
  if (document.Patient.ptcnualt.value=="1") {
    document.Patient.urnumber.maxLength=20;
  }
}

function validateUR() {
  p=document.Patient;
  justifyRight(p.urnumber);
  UpCase(p.urnumber);

  if (isWhitespace(p.admissno.value)) {
    validateCode(8,p.urnumber,p.fnam,UpdateUR,p.sex,p.dob,p.pce,p.dum,
p.d,p.d,p.d,p.d,p.d,p.d,p.d,p.d,p.d,p.d,p.m);
//p.admissno,p.dat,p.typ,p.d,p.d,p.d,p.d,p.d,p.d,p.d,p.m);

    if (p.m.value=="1") {
      alert("Warning : This U/R Number is merged with " + p.urnumber.value);
    }
  } 
  else {
    validateVisit();
  }
}

function validateVisit() {
  p=document.Patient;
  justifyRight(p.admissno);
  validateCode(12,p.admissno,p.fnam,p.sex,p.dob,p.pce,p.urnumber,p.dum,p.dat,p.typ);
}

//-----------------------------------------------------------------
// Function To Check Alternate ID
//-----------------------------------------------------------------
function checkAlternateID(altid,numofids,urnumber) {
  if (isWhitespace(altid)) return;;

  ReturnFunction="";

  for (var i=1; i < checkAlternateID.arguments.length; i++) {
    if (typeof(checkAlternateID.arguments[i]) == 'function') {
      ReturnFunction=checkAlternateID.arguments[i]; 
    }
  }
  var serverURL = "../cgi-bin/patweb90.pbl?reportno=2&remoteno=1" +
                  "&alternid="+altid.replace(/ /g,"+");
  var returnValue = RSExecute(serverURL);

  if (returnValue.status == 0) {
    ReturnValue=returnValue.return_value.split("|");
    numofids.value=trim(ReturnValue[0]);
    urnumber.value=trim(ReturnValue[1]);
    if (typeof(ReturnFunction) == 'function') {
       ReturnFunction();
    }
  }
}
</script>
</head>
%START.OF.PAGE
<body onLoad="PageLoad(event);setForm();clrFields();
 setTimeout('document.Patient.urnumber.focus();',250);">

<span class=DFrameTitleBar>
<img align="right" alt="Exit" class="MenuIcon" 
 src="../images/ExitIcon.gif" onclick="DFrameExit();">
Add Patient
</span>

<form name=Patient action=prsweb01.pbl method=post style="margin:0">
<input type=hidden name=reportno value="8">
<input type=hidden name=template value="002">
<input type=hidden name=updttype value="A">
<input type=hidden name=sex>
<input type=hidden name=dob>
<input type=hidden name=pce>
<input type=hidden name=dum>
<input type=hidden name=d>
<input type=hidden name=m value="">
<input type=hidden name=ptcnualt value="%STANDARD.01.025.110.240.1.1">
<input type=hidden name=alternid value="">
<input type=hidden name=aisearch value="0">
<input type=hidden name=superlev value="">
<input type=hidden name=visitdat value="">

<table align=center cellspacing=0 cellpadding=2 border=0 width=95%>
  <tr>
    <td class=DataLabel>U/R Number</td>
    <td>
      <input type=text name=urnumber value="" size=10 maxlength=8 
        onblur=CheckUR(); title="Patient U/R" class="Mandatory" tabindex=1>
      <input notab type=text name=fnam value="" size=30 readonly>
    </td>
  </tr>

  <tr>
    <td class=DataLabel>Visit Number </td> 
    <td>
      <input type=text name=admissno value="" size=10 maxlength=8 notab 
        title="Patient Visit No" class="Mandatory" tabindex=2
        onblur="validateVisit();" >
      <input notab type=text name=dat value="" size=12 readonly>
      <input notab type=text name=typ value="" size=15 readonly>
    </td>
  </tr>
  <tr>
    <td colspan=2 align=center><br>
      <input type=button class="button" value="Ok" tabindex=3
        name=OKButton onclick="tempDisable(this);AddPatient();">
      <input type=button class="button" value="Cancel" tabindex=4 
        onClick="DFrameExit();">
    </td>
  </tr>
</table>
</form>
