<meta name="TemplateVersion" content="V12.01.00">
<meta name="TemplateHome" content="standard">
<meta name="HelpFileName" content="NoContextSet.html">
<meta name="CrossBrowser" content="true">
<script type="text/javascript"> 
function validateCodeFreeFormat2(OptionNumber,ReturnCode,ReturnName) {

  var sexvarstr = "";
  var sexvarind = "";

  ReturnFunction="" ;
//  ReturnName.value="";
  for (var i=3; i < validateCodeFreeFormat2.arguments.length; i++) {
    if (typeof(validateCodeFreeFormat2.arguments[i]) == 'function') {
      ReturnFunction=validateCodeFreeFormat2.arguments[i] }
    else {
      validateCodeFreeFormat2.arguments[i].value=""; }  }
  if (isWhitespace(ReturnCode.value)) return;;
  var serverURL   = "../cgi-bin/patweb80.pbl?reportno=" + OptionNumber +
                    "&valdcode=" + ReturnCode.value.replace(/ /g,"+") +
                    "&returnfm=1";
  var returnValue = RSExecute(serverURL);
  if (returnValue.status==0) {
    ReturnValue=returnValue.return_value.split("|")

    document.AddForm.bkreq008.value=trim(ReturnValue[1]);
    document.AddForm.bkreq009.value=trim(ReturnValue[2]);
    document.AddForm.bkreq010.value=trim(ReturnValue[5]);

//    for (var i=0; i < document.AddForm.bkreq011.length; i++) {
//      if (document.AddForm.bkreq011.options[i].value==ReturnValue[4]){
//        document.AddForm.bkreq011.selectedIndex=i;
//      }
//    }

    sexDIV.innerHTML=sexSPAN2.innerHTML;

    document.AddForm.bkreq011.value=trim(ReturnValue[4]);

    if (trim(ReturnValue[4])=="R") {
      document.AddForm.d_bkreq011.value="Intersex";
    }
    if (trim(ReturnValue[4])=="U") {
      document.AddForm.d_bkreq011.value="Unknown";
    }
    if (trim(ReturnValue[4])=="I") {
      document.AddForm.d_bkreq011.value="Indeterminate";
    }
    if (trim(ReturnValue[4])=="M") {
      document.AddForm.d_bkreq011.value="Male";
    }
    if (trim(ReturnValue[4])=="F") {
      document.AddForm.d_bkreq011.value="Female";
    }

    document.AddForm.bkreq008.className="readOnly";
    document.AddForm.bkreq008.readOnly=true;
    document.AddForm.bkreq009.className="readOnly";
    document.AddForm.bkreq009.readOnly=true;
    document.AddForm.bkreq010.className="readOnly";
    document.AddForm.bkreq010.readOnly=true;
    document.AddForm.d_bkreq011.className="readOnly";
    document.AddForm.d_bkreq011.readOnly=true;

    j=0
    for (var i=3; i < validateCodeFreeFormat2.arguments.length; i++) {
       if (typeof(validateCodeFreeFormat2.arguments[i]) != 'function') {
         j++
         validateCodeFreeFormat2.arguments[i].value=ReturnValue[j] } }
    if (typeof(ReturnFunction) == 'function') {
       ReturnFunction() }
    return true;
    }
  else {
    ReturnCode.value="";
    ReturnCode.select();
    ReturnCode.focus();
    return false;
     }
}
function checkUR() {
  p=AddForm;
  if (isWhitespace(p.urnumber.value)) {
    document.AddForm.bkreq008.value="";
    document.AddForm.bkreq009.value="";
    document.AddForm.bkreq010.value="";
    sexDIV.innerHTML=sexSPAN1.innerHTML;

    document.AddForm.bkreq008.className="";
    document.AddForm.bkreq008.readOnly=false;
    document.AddForm.bkreq009.className="";
    document.AddForm.bkreq009.readOnly=false;
    document.AddForm.bkreq010.className="";
    document.AddForm.bkreq010.readOnly=false;

    document.AddForm.patname.value="";

    return;
  }
  justifyRight(p.urnumber);

  var serverURL   = "../cgi-bin/comweb80.pbl?reportno=95" +
                    "&valdcode=" + p.urnumber.value.replace(/ /g,"+");
  var returnValue = RSExecute(serverURL); 
  if (returnValue.status==0) {
    if (returnValue.return_value) {
      if (!confirm("Warning: Patient is Deceased.\n Click OK to continue with booking")) {
        document.AddForm.bkreq008.value="";
        document.AddForm.bkreq009.value="";
        document.AddForm.bkreq010.value="";
        sexDIV.innerHTML=sexSPAN1.innerHTML;

        document.AddForm.bkreq008.className="";
        document.AddForm.bkreq008.readOnly=false;
        document.AddForm.bkreq009.className="";
        document.AddForm.bkreq009.readOnly=false;
        document.AddForm.bkreq010.className="";
        document.AddForm.bkreq010.readOnly=false;

        p.urnumber.value="";
        p.patname.value="";
        p.urnumber.focus();
        return;
      }
    }
  }

  if(!validateCode(13,p.urnumber,p.patname,p.dummy,p.dummy,p.dummy,p.dummy)) {
    p.urnumber.focus();
    return;
  }
  validateCodeFreeFormat2(13,p.urnumber,p.patname);
}
function SubmitTheatreRequest() {

 if(!validateMandatory(AddForm)) return;

 if (document.AddForm.d_bkreq003 != undefined) {
   document.AddForm.bkreq003.value=document.AddForm.d_bkreq003.value;
 } 

 document.AddForm.submit();

}
function valDoctorUnit() {
  ValidateHCP(18,0,AddForm.bkreq012,AddForm.doctnam1);
  selectOptions("30",AddForm.bkreq012,AddForm.bkreq013);
  AddForm.bkreq013.selectedIndex=1;
}
function displayBookingType() {
  if (isWhitespace(document.AddForm.bkreq003.value)) {
    BookTypeTitleDIV.innerHTML=BookTypeTitleSPAN.innerHTML;    
    BookTypeFieldDIV.innerHTML=BookTypeFieldSPAN.innerHTML;
  }
}
function getCookies() {
  if (GetCookieData("TheatreSesReqCookie") != "unknown") {
    document.AddForm.redirect.value=GetCookieData("TheatreSesReqCookie"); 
  } 
  ExpireCookiePath("TheatreSesReqCookie");
}
function checkBookingIndicator() {
  if (document.AddForm.bkreq007.value.substr(3,1)=="B") {
    DateLookupDIV.innerHTML="";
    TimeIconsDIV.innerHTML="";
    document.AddForm.bkreq014.value="";
    document.AddForm.bkreq015.value="";
    document.AddForm.bkreq014.className="Readonly";
    document.AddForm.bkreq015.className="Readonly";
    document.AddForm.bkreq014.readOnly=true;
    document.AddForm.bkreq015.readOnly=true;
  } else {
    DateLookupDIV.innerHTML=DateLookupSPAN.innerHTML;
    TimeIconsDIV.innerHTML=TimeIconsSPAN.innerHTML;
    document.AddForm.bkreq014.className="Mandatory PastDate";
    document.AddForm.bkreq015.className="Mandatory";
    document.AddForm.bkreq014.readOnly=false;
    document.AddForm.bkreq015.readOnly=false;
  }
}
function MandatoryTheatreField() {
  f = document.AddForm;
  if (VariableNameExists('OTMandatoryonRequest')) {
    if (OTMandatoryonRequest == true) {
      AddClassName(f.bkreq021,"Mandatory");
    }
    else {
      RemoveClassName(f.bkreq021,"Mandatory");
    }
  }
  else {
    AddClassName(f.bkreq021,"Mandatory");
  }
}

</script>
</head>
%START.OF.PAGE
<body onload="PageLoad(event);
              displayBookingType();
              getCookies();
              MandatoryTheatreField();">
<span class=DFrameTitleBar>
<img align="right" alt="Exit" class="MenuIcon" 
 src="../images/ExitIcon.gif" onclick="DFrameExit();">
New Theatre Request
</span>

<div id=PageBodySection style="overflow: auto;">

<form name=AddForm action=oprweb01.pbl method=post">
<input type=hidden name=reportno value=22>
<input type=hidden name=template value=2>
<input type=hidden name=updttype value="A">
<input type=hidden name=nextpage value="1">
<input type=hidden name=redirect value="%OPRWEB01.22.001.watweb01.02.023">
<input type=hidden name=bkreq003 value="%OPRWEB01.22.221">
<input type=hidden name=currdate value="%STANDARD.01.015">
<table border=0 width="95%" cellspacing="0" cellpadding="0" align=center>

<input type=hidden name=dummy id=dummy>

<tr><td class=DataLabel>U/R Number</td>
    <td><input type=text name=urnumber size=10 maxlength=8 id=urnumber
         title='U/R Number' onblur='checkUR();'>
        <input type=text name=patname class=readonly readonly size=35
         title='Patient Name' tabindex=-1 id=patname>
        <img src="../images/SearchIcon.gif" class="Icon" alt="Search"
         onclick='PatientSearchFrame(patname,urnumber,dummy,checkUR);'>
    </td>
    <td class=DataLabel>Priority</td>
    <td class=DataField>
    <select name=bkreq007 title="Priority"  class="Mandatory SelectBig"
     onchange="checkBookingIndicator();">
    <option></option>
    %STANDARD.01.007.rp
    </select></td>
</tr>

<tr>
  <td></td>
  <td></td>
  <td class=DataLabel><div id="BookTypeTitleDIV"></div></td>
  <td class=DataField><div id="BookTypeFieldDIV"></div></td>
</tr>

<tr>
    <td class=DataLabel>Surname</td>
    <td class=DataLabel>
    <input type=text name=bkreq008 size=50 maxlength=40
     title="Surname">
    </td>
    <td class=DataLabel>Clock Start</td>
    <td class=DataLabel>
    <table border="0" cellpadding="0" cellspacing="0" width="70%" align=left>
    <tr><td>
    <input type=text name=bkreq014 size=12 maxlength=11  id=bkreq014
     class="Mandatory PastDate"
     onblur="checkDate(this,'Date')"
     title="Clock Start Date" value="%STANDARD.01.015">
    </td>
    <td>
    <div id="DateLookupDIV">
    <img src=../images/DateLookup.gif class=Icon
     onclick='javascript:DateLookupFrame(bkreq014)'
     tabindex=-1>
    </div>
    </td>
    <td>
    Time
    <input type=text name=bkreq015 size=7 class="Mandatory" id=bkreq015
     title="Clock Start Time" value="%STANDARD.01.016">
    </td>
    <td>
    <div id="TimeIconsDIV">
    <img src=../images/DateTimeStamp.gif  class=Icon
     onclick='javascript:SetCurrentDateTime(bkreq014,bkreq015)'
     tabindex=-1>
    <img src=../images/TimeLookup.gif class=Icon
     onclick='javascript:TimeLookupFrame(bkreq015)'
     tabindex=-1>
    </div>
    </td></tr>
    </table>
    </td>
</tr>

<tr>
    <td class=DataLabel>First Given Name</td>
    <td class=DataLabel>
    <input type=text name=bkreq009 size=50 maxlength=40
     title="First Given Name">
    </td>
    <td class="DataLabel">Requesting Doctor</td>
    <td><input type="text" size="10" maxlength="10"
         name="bkreq012"
         onblur="valDoctorUnit();" />
        <input type="text" size="25" notab readonly name="doctnam1" />
         <img src="../images/SearchIcon.gif" class="Icon"
         onclick="HCPSearchFrame(AddForm.bkreq012,AddForm.doctnam1,0);" />
    <td>
</tr>

<tr>
  <td></td>
  <td></td>
  <td class=DataLabel>Unit</td>
    <td class=DataField>
    <select name=bkreq013>
    <option></option>
     %STANDARD.01.007.WU
    </select>
    </td>
</tr>

<tr>
   <td class=DataLabel>Sex</td>
   <td><div id=sexDIV>
       <select name="bkreq011" title="Patient's Sex">
          <option></option>
          <option value="R">Intersex</option>
          <option value="U">Unknown</option>
          <option value="I">Indeterminate</option>
          <option value="M">Male</option>
          <option value="F">Female</option>
        </select>
       </div>
   </td>
   <td class=DataLabel>Contact</td>
   <td>
<!--   <textarea wrap=hard cols=50 rows=2 name=bkreq016
    onKeyDown="limitText(this,document.AddForm.countdown,100);"
    onKeyUp="limitText(this,document.AddForm.countdown,100);">
   </textarea>
   <input type=hidden name="countdown" value="100">-->
   <input type=text name=bkreq016 size=50 maxlength=100
    title="Contact">
   </td>
</tr>

<tr>
  <td class=DataLabel>Date of Birth</td>
  <td><input type=text size=12 name=bkreq010 title="Date of Birth"
       class="PastDate"
       onblur="checkDate(this,'Date of Birth');" ></td>
  </td>
    <td class=DataLabel>Patient Location</td>
    <td class=DataLabel>
    <input type=text name=bkreq017 size=50 maxlength=50
     title="Patient Location">
    </td>
</tr>

<tr><td colspan=4 align=center><hr width=100%></td></tr>

<tr><td class=DataLabel>Admitting Point</td>
    <td class=DataField>
    <select name=bkreq018 title="Admitting Point" class="SelectBig">
    <option></option>
    %STANDARD.01.007.ap
    </select></td>
    <td class=DataLabel>Duration</td>
    <td class=DataLabel>
    <input type=text name=bkreq030 size=5 maxlength=3
     title="Duration"> &nbsp; (minutes)
    </td>
</tr>

<tr>
    <td class=DataLabel>Exp. Post Op Ward</td>
    <td class=DataField>
    <select name=bkreq019 title="Exp. Post Op Ward" class="SelectBig">
    <option></option>
    %OPRWEB01.22.119.2
    </select></td>
    <td class=DataLabel>Infection Status</td>
    <td class=DataField>
    <select name=bkreq031 title="Infection Status" class="SelectBig">
    <option></option>
    %STANDARD.01.007.OK
    </select></td>
</tr>

<tr>
    <td class="DataLabel">Surgeon</td>
    <td><input type="text" size="10" maxlength="10"
         name="bkreq020"
         onblur="ValidateHCP(18,0,bkreq020,doctnam2);" />
        <input type="text" size="25" notab readonly name="doctnam2" />
         <img src="../images/SearchIcon.gif" class="Icon"
         onclick="HCPSearchFrame(AddForm.bkreq020,AddForm.doctnam2,0);" />
    </td>
    <td class=DataLabel>Equipment Required 1</td>
    <td class=DataField>
    <select name=bkreq032 title="Equipment Required 1" class="SelectBig">
    <option></option>
    %STANDARD.01.007.XE
    </select></td>

</tr>

<tr>
    <td class=DataLabel>Theatre</td>
    <td class=DataField>
    <select name=bkreq021 id= bkreq021 title="Theatre" class="SelectBig">
    <option></option>
    %OPRWEB01.22.162
    </select></td>
    <td class=DataLabel>Equipment Required 2</td>
    <td class=DataField>
    <select name=bkreq033 title="Equipment Required 2" class="SelectBig">
    <option></option>
    %STANDARD.01.007.XE
    </select></td>

</tr>

<tr>
    <td class="DataLabel">Consent Obtained</td>
    <td>
    <select name="bkreq058" class="SelectBig">
    <option></option>
    <option value="N">No</option>
    <option value="Y">Yes</option>
    </select>
    </td>
    <td class=DataLabel>Equipment Required 3</td>
    <td class=DataField>
    <select name=bkreq034 title="Equipment Required 3" class="SelectBig">
    <option></option>
    %STANDARD.01.007.XE
    </select></td>

</tr>


<tr>
    <td class=DataLabel>Consent Date</td>
    <td class=DataLabel>
    <input type=text name=bkreq059 size=12 maxlength=11 id=bkreq059
     onblur="checkDate(this,'Date')"
     title="Consent Date">
    <img src=../images/DateLookup.gif class=Icon
     onclick='javascript:DateLookupFrame(bkreq059)'
     tabindex=-1>
    </td>
</tr>

<tr>
    <td class=DataLabel>Anaesthetic Type</td>
    <td class=DataField>
    <select name=bkreq022 title="Anaesthetic Type" class="SelectBig">
    <option></option>
    %STANDARD.01.007.OA
    </select></td>

</tr>


<tr>
<td class=DataLabel>MBS Codes</td>
    <td><input type=text name=bkreq023 size=9 id=bkreq023
           onblur='validateCode(4,bkreq023,mbsdesc1,currdate)'
           title="Expected MBS Item 1" >
        <input type=text readonly name=mbsdesc1 size=30 id=mbsdesc1
           title="Expected MBS Item 1 Name" tabindex=-1>
     <img src="../images/SearchIcon.gif" class=Icon
     onclick="MbsSearchFrame(bkreq023,mbsdesc1,currdate)"></td>
</tr>

<tr>
<td class=DataLabel></td>
    <td><input type=text name=bkreq024 size=9 id=bkreq024
           onblur='validateCode(4,bkreq024,mbsdesc2,currdate)'
           title="Expected MBS Item 2" >
        <input type=text readonly name=mbsdesc2 size=30 id=mbsdesc2
           title="Expected MBS Item 2 Name" tabindex=-1>
     <img src="../images/SearchIcon.gif" class=Icon
     onclick="MbsSearchFrame(bkreq024,mbsdesc2,currdate)"></td>
</tr>

<tr>
<td class=DataLabel></td>
    <td><input type=text name=bkreq025 size=9 id=bkreq025
           onblur='validateCode(4,bkreq025,mbsdesc3,currdate)'
           title="Expected MBS Item 3" >
        <input type=text readonly name=mbsdesc3 size=30 id=mbsdesc3
           title="Expected MBS Item 3 Name" tabindex=-1>
     <img src="../images/SearchIcon.gif" class=Icon
     onclick="MbsSearchFrame(bkreq025,mbsdesc3,currdate)"></td>
</tr>

<tr>
    <td class=DataLabel>Full Description</td>
    <td class=DataLabel>
    <input type=text name=bkreq026 size=80 maxlength=80
     title="MBS Full Description 1">
    </td>
</tr>

<tr>
    <td class=DataLabel></td>
    <td class=DataLabel>
    <input type=text name=bkreq027 size=80 maxlength=80
     title="MBS Full Description 2">
    </td>
</tr>

<tr>
    <td class=DataLabel></td>
    <td class=DataLabel>
    <input type=text name=bkreq028 size=80 maxlength=80
     title="MBS Full Description 3">
    </td>
</tr>

<tr>
    <td class=DataLabel>Prosthesis Required</td>
    <td class=DataLabel>
    <input type=text name=bkreq029 size=80 maxlength=40
     title="Prosthesis Required">
    </td>
</tr>

<tr>
   <td class=DataLabel>Comments</td>
   <td colspan=3>
   <textarea wrap=hard cols=60 rows=3 name=opcom012></textarea>
   </td>
</tr>


<tr><td colspan=4 align=center> 
    <input type=button value=Add class="button" 
     onclick='SubmitTheatreRequest()'>
    <input type=button value=Cancel class="button" 
     onclick='history.go(-1);'>
    </td></tr>
</table>
</form>

<script type="text/javascript" >
  document.AddForm.bkreq021.selectedIndex=0;
  document.AddForm.bkreq019.selectedIndex=0;
</script>

<span id=sexSPAN1 style="display: none">
       <select name="bkreq011" title="Patient's Sex">
          <option></option>
          <option value="R">Intersex</option>
          <option value="U">Unknown</option>
          <option value="I">Indeterminate</option>
          <option value="M">Male</option>
          <option value="F">Female</option>
        </select>
</span>

<span id=sexSPAN2 style="display: none">
    <input type=hidden name=bkreq011 value="">
    <input type=text name=d_bkreq011 size=20 maxlength=20
     title="Sex">
</span>


<span id="BookTypeTitleSPAN" style="display: none">Booking Type</span>

<span id="BookTypeFieldSPAN" style="display: none"`>
<select name=d_bkreq003 title="Booking Type" class="Mandatory SelectBig"
 onblur="document.AddForm.bkreq003.value=this.value">
    <option></option>
    %OPRWEB01.22.191.9.1.99.1.UNS
    </select>
</span>

<span id="DateLookupSPAN" style="display:none">
  <img src=../images/DateLookup.gif class=Icon
   onclick='javascript:DateLookupFrame(bkreq014)'
   tabindex=-1>
</span>

<span id="TimeIconsSPAN" style="display:none">
  <img src=../images/DateTimeStamp.gif  class=Icon
   onclick='javascript:SetCurrentDateTime(bkreq014,bkreq015)'
   tabindex=-1>
  <img src=../images/TimeLookup.gif class=Icon
   onclick='javascript:TimeLookupFrame(bkreq015)'
   tabindex=-1>
</span>
