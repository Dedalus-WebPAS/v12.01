<meta name="TemplateVersion" content="V12.01.00">
<meta name="TemplateHome" content="standard">
<meta name="HelpFileName" content="">
<meta name="CrossBrowser" content="true">
<script language="javascript" src="../js/allweb03.js"></script>
<script type="text/javascript">
function AddEncounter(theForm){
  DFrameClear();
  if (validateMandatory(theForm)) {

    if(theForm.checkbx2.checked==true) {
      if(!CheckFutureBookings(theForm.admissno,theForm.alenc005)) {
        return;
      }
    }

    if(theForm.checkappt.value==0 &&
      theForm.checkbx2.checked==true) {
      CheckLinkedBookings(theForm.admissno,theForm.urnumber,theForm.checkappt)
      if(theForm.checkappt.value==0) {
        return;
      }
    }
    theForm.target="PopUpFrame1"
    theForm.submit();
  }
}
function PostParent() {
   document.AddForm.checkappt.value=1;
   AddEncounter(AddForm);
}
//------------------------------------------------------------------------
// Function : Referral Number Search Frame
//------------------------------------------------------------------------
function RefSearchFrame(ReturnRefe,ReturnName,ReturnName1) {
  DFrameStart();
  window.ReturnFunction="";
  window.ReturnRefe=ReturnRefe ;
  window.ReturnName=ReturnName ;
  window.ReturnName1=ReturnName1 ;
//
  if (RefSearchFrame.arguments.length > 2) {
    window.ReturnFunction=RefSearchFrame.arguments[3] }
//
  document.getElementById('PopUpFrame').src="../lookups/RefSearchFrame.html"
  SearchFrameShow();
}
//-------------------------------------------------------------------------
 
function ToggleCombo(){

if(AddForm.checkbx2.checked==false){
   AddForm.checkbx1.disabled=false;
   AddForm.checkbx2.value=0;
   AddForm.alref006.className="DataField";
  }
else{
   AddForm.checkbx1.disabled=true; // disable Waiting List
   AddForm.checkbx1.checked=false;
   AddForm.alref006.className="Mandatory";//make the class mandatory 
   AddForm.checkbx2.value=1;
  }

}

function ShowHideBill(){

PatientType=AddForm.alenc009.value.substr(4,1);
CompensationCode=AddForm.alenc115.value.substr(13,1);
flag=AddForm.flag.value;
if(flag==1&&(PatientType==1 || PatientType==2)&&(CompensationCode=="C" || CompensationCode=="E")){
   Units.style.display=""
   Units.innerHTML=BillableUnits.innerHTML; }
 else{
   Units.style.display="none"
   Units.innerHTML="";}
if(CompensationCode=="E")
  AddForm.itemn001.className="Mandatory";
else
  AddForm.itemn001.className=""; 

}

function PackComments(){
AddForm.alenc107.value=AddForm.comments.value.substring(0,80); 
AddForm.alenc108.value=AddForm.comments.value.substring(80,160);
}
//
function ShowHideWaitingList(){
if(document.AddForm.status.value=="0") {
  Wait.style.display='';}
else {
  Wait.style.display='none';}
}
//
function ShowVACS() {
   i=document.AddForm.alenc010.selectedIndex;
   VacsFlag=document.AddForm.alenc010.options[i].value.substring(6,7)
   if(VacsFlag==0) {
      Vacs.innerHTML="";
      Vacs.style.display="none";
      Activity.style.display="";
      Activity.innerHTML=DisplayActivity.innerHTML;
      Items.innerHTML="";
      Items.style.display="none";
      Units.innerHTML="";
      Units.style.display="none";
   } 
   else {
      Vacs.style.display="";
      Vacs.innerHTML=DisplayVacs.innerHTML;
      Activity.innerHTML="";
      Activity.style.display="none";
      Items.innerHTML=DisplayItems.innerHTML;
      Items.style.display="";
      ShowHideBill();
    
      DClaim=AddForm.deftclmc.value
      for (var i=0; i < document.AddForm.alenc115.length; i++) {
        if (document.AddForm.alenc115.options[i].value.substr(0,3) == 
            DClaim.substr(0,3)) {
          document.AddForm.alenc115.selectedIndex=i;
        }
      }

     DClin=AddForm.deftclin.value
     for (var i=0; i < document.AddForm.alenc003.length; i++) {
       if (document.AddForm.alenc003.options[i].value.substr(0,6) == 
           DClin.substr(0,6)) {
         document.AddForm.alenc003.selectedIndex=i;
       }
     }
   }
}
function LinkedVisit() {
  p=AddForm
  CheckReferral(9,
                p.admissno,
                p.deptcode,
                p.namedesc,
                p.alenc008,
                p.deftclmc,
                p.deftclin,p.status);
}
function DefContactDate() {
 if(SetDateYYYYMMDD(document.AddForm.alenc005.value) >
    SetDateYYYYMMDD(document.AddForm.currdate.value)) {
    document.AddForm.alenc005.value=document.AddForm.currdate.value;
  }
}

function checkPriority() {
  var p = document.AddForm;

  var indc3 = p.deptcode.value.substr(5,1);
  var indc4 = p.deptcode.value.substr(6,1);

  var bIsMH = (indc3 == "A" && indc4 == "M") ? true : false;

  var rejGenRef = ( p.d_alref027_code.value.substr(13,1) == "G") ? true : false;
  var rejMenHlt = ( p.d_alref027_code.value.substr(13,1) == "M") ? true : false;
  var rejGenMen = ( p.d_alref027_code.value.substr(13,1) == "A") ? true : false;

  if (rejMenHlt && bIsMH) {  // Mental Health Referral
    // Remove Mental Health codes
    alert("Referral Priority Code = " +  trim(p.d_alref027_desc.value) +
            "\nPlease change priority before closing the referral");
     document.AddForm.checkbx2.checked = false;
  }
  else if (rejGenRef && !bIsMH) {  // General Referral
   // Remove General codes
   alert("Referral Priority Code = " +  trim(p.d_alref027_desc.value) +
            "\nPlease change priority before closing the referral");
   document.AddForm.checkbx2.checked = false;
  }
  else if (rejGenMen) {  // General or Mental
    // Remove Mental Health OR General codes
   alert("Referral Priority Code = " +  trim(p.d_alref027_desc.value) +
            "\nPlease change priority before closing the referral");
   document.AddForm.checkbx2.checked = false;
  }
}
</script>
</head>

%START.OF.PAGE
<body onload="PageLoad(event);ShowVACS();DefContactDate();">

<span class=DFrameTitleBar>
<img border=0 align=right src="../images/ExitIcon.gif" class=MenuIcon 
 onclick="DFrameExitRefresh()">
<script language=javascript>document.write(self.document.title);</script>
</span>
<div id=PageBodySection>
<form name=AddForm action="allweb03.pbl" method=post style="margin:0">
<input type=hidden name=reportno value=1>
<input type=hidden name=updatety value="A">
<input type=hidden name=urnumber value="">
<input type=hidden name=alenc004 value="%ALLWEB03.05.032.0">
<input type=hidden name=deptcode value="%ALLWEB03.05.017">
<input type=hidden name=alenc107 value="">
<input type=hidden name=alenc108 value="">
<input type=hidden name=flag value="%ALLWEB03.05.022">
<input type=hidden name=deftclmc >
<input type=hidden name=deftclin >
<input type=hidden name=status value="">
<input type=hidden name=dummyret value="">
<input type=hidden name=dummysit value="">
<input type=hidden name=dummydat value="">
<input type=hidden name=dummy1>
<input type=hidden name=mbs value="M">
<input type=hidden name=checkappt value="0">
<input type=hidden name=currdate value="%STANDARD.01.015">

<input type=hidden name=deptcode value="%ALLWEB03.05.125.3">
<input type=hidden name=d_alref027_code value="%ALLWEB03.05.127.3">
<input type=hidden name=d_alref027_desc value="%ALLWEB03.05.127.0">

<table align=center cellspacing=0 cellpadding=1 border=0 width=95%>
<tr><td class=DataLabel width=15%> Department </td>
      <td> <input type=text name=department size=40 class=Readonly readonly  
      title="Department" value="%ALLWEB03.05.018"></td> </tr>     

<tr><td class=DataLabel width=15%>Health Care Provider</td>
    <td colspan=3><input type=text name=SProvider size=40 
       class=Readonly readonly title="Health Care Provider" 
       value="%ALLWEB03.05.019"> <td></tr>

<tr><td class=DataLabel width=15%>Date</td>
    <td><input type=text class=Readonly  readonly name=alenc005 
       value="%ALLWEB03.05.016" title="Date" Size=13 
      onblur="checkDate(this,'Date')"> </td></tr>

<tr><td class=DataLabel width=15%>Contact Time  </td>
    <td class=DataField>
    <input type=text size=8 value="" class=Mandatory title="Time"
     name=alenc006>
    <img src="../images/DateTimeStamp.gif" class=Icon
     onclick='SetCurrentDateTime(null,AddForm.alenc006)'>
    <img src="../images/TimeLookup.gif" class=Icon
     onclick='TimeLookupFrame(AddForm.alenc006)'>
   </td></tr>

<tr> <td class=DataLabel width=15%>Referral Number</td>
    <td class=DataField>
    <input type=text size=10 class=Mandatory title="Referral Number" 
     name=admissno maxLength=8
     onblur="justifyRight(this);
             CheckReferral(9,
                           AddForm.admissno,
                           AddForm.deptcode,
                           AddForm.namedesc,
                           AddForm.alenc008,
                           AddForm.deftclmc,
                           AddForm.deftclin,
                           AddForm.status);
             ShowHideWaitingList();">
    <input type=text size=25 class=Readonly title="Name" name=namedesc
     readonly>
    <img src="../images/SearchIcon.gif" class=Icon 
     onclick="RefSearchFrame(AddForm.admissno,
                             AddForm.namedesc,
                             AddForm.alenc008,
                             AddForm.LinkedVisit);">
    </td></tr>

<tr><td class=DataLabel width=15%>Occasion of Service</td>
    <td width=40%><select class="Mandatory" name=alenc010 
                   title="Occasion of Service" onchange="ShowVACS();">
    <option></option>
     %ALLWEB03.05.020.0
    </select></td>

    <td class=DataLable width=10%>Linked Visit</td>
    <td class=DataField colspan=3>
      <input type=text size=10 name=alenc008 value="" maxlength=8
         onblur="justifyRight(this);
                 ValidateVisit(AddForm.alenc008,
                               AddForm.urnumber,
                               AddForm.dummy1);"> 
      <img src="../images/SearchIcon.gif" class=Icon
       onclick="VisitSearchFrame(AddForm.urnumber,AddForm.alenc008);">
     </td></tr>

</table>

<div id=Vacs></div>
<div id=Activity></div>
<div id="Units"></div>
<div id=Items></div>

<div id="Wait" style="display:none;">
<table align=center cellspacing=0 cellpadding=1 border=0 width=95%>
<tr><td class=DataLabel width=15%>Stay as Waiting Referral</td>
    <td class=DataField>
    <input type=checkbox name=checkbx1 value="1"></td>
    <td></td>
    <td></td>
    </tr>
</table>
</div>

<table align=center cellspacing=0 cellpadding=1 border=0 width=95%>
<tr><td class=DataLabel width=15%>Last Contact ?</td>
    <td class=DataField>
    <Input type=checkbox name=checkbx2 value=0 
     onclick="checkPriority(); ToggleCombo();" >
    </td></tr>

<tr><td class=DataLabel width=15%>Reason for Closure </td>
    <td class=DataField>
    <select  name=alref006 title="Reason For Closure" class="">
    <option></option>
     %ALLWEB03.05.015.2
    </select>
    </td></tr>

<tr valign=top><td class=DataLabel> Comments </td>
    <td class=DataField colspan=3>
    <textarea rows=3 cols=60 name=comments onblur="PackComments()"></textarea>
    </td></tr>
</table>

<div id="HCPcheckbox">
<table align=center cellspacing=0 cellpadding=1 border=0 width=95%>
<tr><td class=DataLabel width=15%>Additional HCP</td>
    <td><input type=checkbox name=addithcp value="1"
         onclick="CheckAddHCP();"></td></tr>
</table>
</div>

<div id=AdditionalHCP></div>

<table align=center cellspacing=0 cellpadding=1 border=0 width=95%>
<tr><td colspan=4 align=center><br>
<input type=button name=formactn value="Add" class=button id=all03sub
     onclick="tempDisable(this);AddEncounter(AddForm);">
    <input type=button Value="Cancel" class="button" 
     onclick="DFrameCloseRefresh();">
    </td></tr>
</table>

</form>
</div>

<span id="DisplayVacs" style="display:none;">
<table align=center cellspacing=0 cellpadding=1 border=0 width=95%>
<tr><td class=DataLabel width=15%>Clinic Type</td>
    <td class=DataField><select  name=alenc003 class="SelectBig Mandatory"
     title="Clinic Type">
    <option></option>
     %ALLWEB03.05.011
    </select></td></tr>

<tr><td class=DataLabel width=15%>Patient Type</td>
    <td><select class="Mandatory SelectBig" name=alenc009 title="Patient Type"
         onchange="ShowHideBill();">
        <option></option>
        %ALLWEB03.05.012.2
        </select></td></tr>

<tr><td class=DataLabel width=15%>%STANDARD.01.017.CL</td>
    <td><select class="Mandatory SelectBig" name=alenc115
         title="%STANDARD.01.017.CL"
         onchange="ShowHideBill();">
    <option></option>
    %ALLWEB03.05.013.9.1.10.2.X
    </select></td></tr>

<tr><td class=DataLabel width=15%>Direct Units</td>
  <td class=DataField width=40%>
      <input type=text size=12 name=alenc011 title="Direct Units" min=0 
       class=Mandatory maxLength=6
       onblur="checkInteger(this,this.title)"></td>
  <td class=DataLabel width=10%>Indirect Units</td>
      <td class=DataField>
      <input type=text size=12 name=alenc013 title="Indirect Units" min=0
      maxLength=6 onblur="checkInteger(this,this.title)"></td></tr>
</table>
</span>

<span id="DisplayActivity" style="display:none;">
  <table align=center cellspacing=0 cellpadding=1 border=0 width=95%>
  <tr><td class=DataLabel width=15%>Related Activity</td>
      <td> 
      <input type=hidden name=alenc009 value=""></td>
      <td class=DataField width=40%>
      <select class="SelectBig" name=alenc047  
       title="Related Activity">
    <option></option>
    %ALLWEB03.05.247. 1.2
    </select></td>

      <td class=DataLabel width=10%>Indirect Units</td>
      <td class=DataField>
      <input type=text size=12 maxlength=5 name=alenc013
       title="Indirect Units" min=0
       onblur="checkInteger(this,this.title)"></td></tr>

</table>
</span>

<span id="BillableUnits" style="display:none;">
<table align=center cellspacing=0 cellpadding=1 border=0 width=95%>
<tr><td class=DataLabel width=15%>Direct Billable Units</td>
    <td class=DataField width=40%>
    <input type=text size=12 name=alenc012 title="Direct Billable Units" min=0
     onblur="checkInteger(this,this.title)"></td>
    <td class=DataLabel width=10%>Indirect Billable Units</td>
    <td class=DataLable>
    <input type=text size=12 name=alenc014 title="Indirect Billable Units"
     min=0
     onblur="checkInteger(this,this.title)">
    </td></tr>

<tr><td class=DataLabel width=15%>Bulk Billing Code</td>
    <td class=DataField>
    <select name=alenc015 class="SelectBig" title="Bulk Billing Code">
    <option></option>
    %ALLWEB03.01.215.2
    </select></td></tr>
</table>
</span>

<span id="DisplayItems" style="display:none;">
<table align=center cellspacing=0 cellpadding=1 border=0 width=95%>
<tr><td class=DataLabel width=15%>Item Code 1</td>
    <td class=DataField width=40%>
    <input type=text size=10 name=itemn001 title="Item Code 1"
     onblur="validatePMBS(AddForm.itemn001,AddForm.dummy);">
    <input type=text size=20 name=dummy value="" readonly class=Readonly>
    <img src="../images/SearchIcon.gif" class=Icon
     onclick='PriMbsSearchFrame(AddForm.dummyret,
                                AddForm.itemn001,
                                AddForm.dummysit,
                                AddForm.dummyret,
                                AddForm.dummy,
                                AddForm.mbs)'>
    <img src="../images/ClearIcon.gif" class=Icon
     onclick="clrFields(AddForm.itemn001,AddForm.dummy);">
    </td>
    <td class=DataLabel width=10%>Item Code 2</td>
    <td class=DataField>
    <input type=text size=10 name=itemn002 title="Item Code 2"
     onblur="validatePMBS(AddForm.itemn002,AddForm.dummy2);">
    <input type=text size=20 name=dummy2 value="" readonly class=Readonly>
    <img src="../images/SearchIcon.gif" class=Icon
    onclick="PriMbsSearchFrame(AddForm.dummyret,
                               AddForm.itemn002,
                               AddForm.dummysit,
                               AddForm.dummyret,
                               AddForm.dummy2,
                               AddForm.mbs)">
    <img src="../images/ClearIcon.gif" class=Icon
     onclick="clrFields(AddForm.itemn002,AddForm.dummy2);">
    </td></tr>

<tr><td class=DataLabel width=15%>Item Code 3</td>
    <td class=DataField width=40%>
    <input type=text size=10 name=itemn003 title="Item Code 3"
     onblur="validatePMBS(AddForm.itemn003,AddForm.dummy3);">
    <input type=text size=20 name=dummy3 value="" readonly class=Readonly>
    <img src="../images/SearchIcon.gif" class=Icon
    onclick="PriMbsSearchFrame(AddForm.dummyret,
                               AddForm.itemn003,
                               AddForm.dummysit,
                               AddForm.dummyret,
                               AddForm.dummy3,
                               AddForm.mbs)">
    <img src="../images/ClearIcon.gif" class=Icon
     onclick="clrFields(AddForm.itemn003,AddForm.dummy3);">
     </td>
    <td class=DataLabel width=10%>Item Code 4</td>
    <td class=DataField>
    <input type=text size=10 name=itemn004 title="Item Code 4"
     onblur="validatePMBS(AddForm.itemn004,AddForm.dummy4);">
    <input type=text size=20 name=dummy4 value="" readonly class=Readonly>
    <img src="../images/SearchIcon.gif" class=Icon
     onclick="PriMbsSearchFrame(AddForm.dummyret,
                                AddForm.itemn004,
                                AddForm.dummysit,
                                AddForm.dummyret,
                                AddForm.dummy4,
                                AddForm.mbs)">
    <img src="../images/ClearIcon.gif" class=Icon
     onclick="clrFields(AddForm.itemn004,AddForm.dummy4);">
     </td></tr>

<tr><td class=DataLabel width=15%>Item Code 5</td>
    <td class=DataField width=40%>
    <input type=text size=10 name=itemn005 title="Item Code 5"
     onblur="validatePMBS(AddForm.itemn005,AddForm.dummy5);">
    <input type=text size=20 name=dummy5 value="" readonly class=Readonly>
    <img src="../images/SearchIcon.gif" class=Icon
     onclick="PriMbsSearchFrame(AddForm.dummyret,
                                AddForm.itemn005,
                                AddForm.dummysit,
                                AddForm.dummyret,
                                AddForm.dummy5,
                                AddForm.mbs)">
    <img src="../images/ClearIcon.gif" class=Icon
     onclick="clrFields(AddForm.itemn005,AddForm.dummy5);">
     </td>
    <td class=DataLabel width=10%>Item Code 6</td>
    <td class=DataField>
    <input type=text size=10 name=itemn006 title="Item Code 6"
     onblur="validatePMBS(AddForm.itemn006,AddForm.dummy6);">
    <input type=text size=20 name=dummy6 value="" readonly class=Readonly>
    <img src="../images/SearchIcon.gif" class=Icon
     onclick="PriMbsSearchFrame(AddForm.dummyret,
                                AddForm.itemn006,
                                AddForm.dummysit,
                                AddForm.dummyret,
                                AddForm.dummy6,
                                AddForm.mbs)">
    <img src="../images/ClearIcon.gif" class=Icon
     onclick="clrFields(AddForm.itemn006,AddForm.dummy6);">
     </td></tr>
</table>
</span>

<span id="ShowAdditionalHCP" style="display:none;">
<table align=center cellspacing=0 cellpadding=1 border=0 width=95%>
<tr><td class=DataLabel width=15%>Additional HCP 1</td>
    <td><input type=text name=alenc025 size=10 maxlength=10
         title="Additional HCP 1"
         onblur="ValidateHCP(18,0,AddForm.alenc025,AddForm.d_alenc025);">
        <input type=text name=d_alenc025 size=20 class=Readonly readonly
         title="Additional HCP 1">
        <img src="../images/SearchIcon.gif" class=Icon
         onclick="HCPSearchFrame(AddForm.alenc025,AddForm.d_alenc025,0)">
        <img src="../images/ClearIcon.gif" class=Icon
         onclick="clrFields(AddForm.alenc025,AddForm.d_alenc025);">
    </td>
    <td class=DataLabel width=15%>Additional HCP 2</td>
    <td><input type=text name=alenc026 size=10 maxlength=10
         title="Additional HCP 2"
         onblur="ValidateHCP(18,0,AddForm.alenc026,AddForm.d_alenc026);">
        <input type=text name=d_alenc026 size=20 class=Readonly readonly
         title="Additional HCP 2">
        <img src="../images/SearchIcon.gif" class=Icon
         onclick="HCPSearchFrame(AddForm.alenc026,AddForm.d_alenc026,0)">
        <img src="../images/ClearIcon.gif" class=Icon
         onclick="clrFields(AddForm.alenc026,AddForm.d_alenc026);">
    </td></tr>

<tr><td class=DataLabel width=15%>Additional HCP 3</td>
    <td><input type=text name=alenc027 size=10 maxlength=10
         title="Additional HCP 3"
         onblur="ValidateHCP(18,0,AddForm.alenc027,AddForm.d_alenc027);">
        <input type=text name=d_alenc027 size=20 class=Readonly readonly
         title="Additional HCP 3">
        <img src="../images/SearchIcon.gif" class=Icon
         onclick="HCPSearchFrame(AddForm.alenc027,AddForm.d_alenc027,0)">
        <img src="../images/ClearIcon.gif" class=Icon
         onclick="clrFields(AddForm.alenc027,AddForm.d_alenc027);">
    </td>
    <td class=DataLabel width=15%>Additional HCP 4</td>
    <td><input type=text name=alenc028 size=10 maxlength=10
         title="Additional HCP 4"
         onblur="ValidateHCP(18,0,AddForm.alenc028,AddForm.d_alenc028);">
        <input type=text name=d_alenc028 size=20 class=Readonly readonly
         title="Additional HCP 4">
        <img src="../images/SearchIcon.gif" class=Icon
         onclick="HCPSearchFrame(AddForm.alenc028,AddForm.d_alenc028,0)">
        <img src="../images/ClearIcon.gif" class=Icon
         onclick="clrFields(AddForm.alenc028,AddForm.d_alenc028);">
    </td></tr>
</table>
</span>

<script type="text/javascript">
if(%ALLWEB03.05.400.12!=1){
  document.getElementById("HCPcheckbox").style.display="none";
}
</script>

