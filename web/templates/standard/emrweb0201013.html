<meta name="TemplateVersion" content="V12.01.00">
<meta name="TemplateHome"    content="standard">
<meta name="HelpFileName"    content="NoContextSet.html">
<meta name="CrossBrowser"    content="true">
<script type="text/javascript" src="../js/emrweb0201004.js"></script>
<script type="text/javascript">
function ReturnToMap(){
  if(parent.TogglePanel==null){
    top.location.reload();
  }
  else{
     parent.TogglePanel();
  }
}
function UpdDoctor() {
  if (UpdateForm.emcndoct.value==1) {
    UpdEmrDoc(UpdateForm.emvis007);
  }
  else {
    UpdDoc(UpdateForm.emvis007);
  }
}
function SearchDoctor() {
  if (UpdateForm.emcndoct.value==1) {
    DoctorEmrSearchFrame(UpdateForm.emvis007,UpdateForm.dummy3);
  }
  else {
    DoctorSearchFrame(UpdateForm.emvis007,UpdateForm.dummy3);
  }
}

function PageLoadExtended()
{
   PageLoad();
   setFocus("btnUpdate");
   SetDischarged();
}

function setFocus(id)
{
  var  object = document.getElementById(id);

  if(object)
     object.focus();

}
function RemoveSlash(obj){
  obj.value=obj.value.replace("\\","");
}
function RemoveDoubleQuotes(obj){
  obj.value=obj.value.replace("\"","'");
}
function validateattendingdoctor(RetFuncTrue) {
    var serverURL   = "../cgi-bin/emrweb08.pbl?reportno=58" +
                      "&admissno=" +
                      document.UpdateForm.admissno.value.replace(/ /g,"+") +
                      "&doctcode=" +
                      document.UpdateForm.emvis007.value.replace(/ /g,"+");

  if (IEBrowser) {
    var returnValue = RSExecute(serverURL);

    if (returnValue.status==0)
    {
      if (returnValue.return_value == "1") {
        alert("Doctor has been updated previously. Page will reload, " +
              "details not updated.");
        location.reload();

        if(top.TogglePanel) {
          parent.menu.location.reload();
        } else {
          if (top.menu.EmergencyFrame) {
            if (top.menu.EmergencyFrame.location=="about:blank") {
              parent.menu.location.reload();
            } else {
              parent.menu.EmergencyFrame.location.reload();
            }
          }
        }
        return false;
      }
    }

    if (typeof(RetFuncTrue) == 'function') { RetFuncTrue() }
  }
  else {
    var returnValue = RSExecuteFetch(serverURL);

    returnValue.then(
      function (returnValue) {
        returnValue = ParseFetchData(returnValue);  // parse fetch() result

        if (returnValue.status==0)
        {
          if (returnValue.return_value == "1") {
            alert("Doctor has been updated previously. Page will reload, " +
                  "details not updated.");
            location.reload();

            if(top.TogglePanel) {
              parent.menu.location.reload();
            } else {
              if (top.menu.EmergencyFrame) {
                if (top.menu.EmergencyFrame.location=="about:blank") {
                  parent.menu.location.reload();
                } else {
                  parent.menu.EmergencyFrame.location.reload();
                }
              }
            }
            return false;
          }
        }

        if (typeof(RetFuncTrue) == 'function') { RetFuncTrue() }
      }
    );
  }
}
function init(){
  PageDirty = false;
  var strg1= trim(HiddenFields.Pres01.value)
      if(!isWhitespace(strg1)) { strg1+="\n"}
  var strg2= trim(HiddenFields.Pres02.value)
      if(!isWhitespace(strg2)) { strg2+="\n"}
  var strg3= trim(HiddenFields.Pres03.value)
      if(!isWhitespace(strg3)) { strg3+="\n"}
  var strg4= trim(HiddenFields.Pres04.value)
      if(!isWhitespace(strg4)) { strg4+="\n"}
  var strg5= trim(HiddenFields.Pres05.value)
      if(!isWhitespace(strg5)) { strg5+="\n"}
  var strg6= trim(HiddenFields.Pres06.value)
  UpdateForm.prcom001.value=strg1+strg2+strg3+strg4+strg5+strg6
  UpdateForm.savdesc1.value=strg1+strg2+strg3+strg4+strg5+strg6
  if (HiddenFields.CheckUr.value == "1") { checkurno(); }
  savePrcom001=GetCookieData("emrweb0201013.prcom001");
  SetCookie("emrweb0201013.prcom001","");
  ExpireCookiePath("emrweb0201013.prcom001");
  if (savePrcom001!="unknown") {
    if (!isWhitespace(savePrcom001)) {
      if (confirm("Comments Saved\n\n"+savePrcom001+"\n\nClick Ok to Restore.")){
        UpdateForm.prcom001.value=savePrcom001;
        prcom001TopFrame();
      }
    }
  }
}
function onUpdate(){
  document.PatientLinks.checksub.value=1;
  var docchk=chkdoct();
  var nurchk=chknurse();
  var prcomupd = document.getElementById("prcomupd");

  if (docchk){
    if(nurchk){
       url = "emrweb02.pbl?reportno=1&template=13&urnumber=" +
             document.UpdateForm.urnumber.value.replace(/ /g,"+") +
            "&admissno=" + document.UpdateForm.admissno.value.replace(/ /g,"+");
       document.UpdateForm.redirect.value=url;

       var locachk=chkLoc();

      if (locachk)
      {
          if(prcomupd)
          {
             if(prcomupd.value==1)
               setFormactn('PRCOM');
             else
               setFormactn('UPDAT');
           }
           else {
             setFormactn('UPDAT');
           }
      }
    }
  }
}
function valOGroup() {
 site = document.UpdateForm.emvis132.value.substr(0,3);
 hosp = document.UpdateForm.emvis132.value.substr(3,3);
  if (ValidOG()) {  // validate Occupational Group
    if (!isWhitespace(hosp)) {
      if (!ChangeHospSite(hosp,site)) {
        alert("Failed to change user Hospital and Site");
        return;
      }
    }
    else {
      if (!ChangeSite(site)) {
        alert("Failed to change user Site");
        return;
      }
    }

    if (ChangeLogin()) {
      // reload top frame
      getTop().menu.location.href = getTop().menu.location.href;
    }
  }
}
function RemoteEmrLocation(valdcode,valdrtyp,ReturnSelect) {
  ReturnFunction="" ;
  for (var i=1; i < RemoteEmrLocation.arguments.length; i++) {
  if (typeof(RemoteEmrLocation.arguments[i]) == 'function') {
     ReturnFunction=RemoteEmrLocation.arguments[i] } }
  var serverURL = "../cgi-bin/emrweb08.pbl?reportno=30" +
                  "&valdcode=" + valdcode.value.replace(/ /g,"+") +
                  "&valdrtyp=" + valdrtyp.value.replace(/ /g,"+")

  if (IEBrowser) {
    var returnValue = RSExecute(serverURL);

    ReturnValue=returnValue.return_value.split("|");
    if (returnValue.status==0) {
      ReturnSelect.options.length=0;
      ReturnValue=returnValue.return_value.split("|");
      for (var j=0; j < ReturnValue.length; j++) {
         if (!isWhitespace(ReturnValue[j])) {
           SelectValue=ReturnValue[j].split(",");
           ReturnSelect.options[ReturnSelect.options.length]=
            new Option(SelectValue[1],SelectValue[0]);
         }
       }
    }
  }
  else {
    var returnValue = RSExecuteFetch(serverURL);

    returnValue.then(
      function (returnValue) {
        returnValue = ParseFetchData(returnValue);  // parse fetch() result

        ReturnValue=returnValue.return_value.split("|");
        if (returnValue.status==0) {
          ReturnSelect.options.length=0;
          ReturnValue=returnValue.return_value.split("|");
          for (var j=0; j < ReturnValue.length; j++) {
             if (!isWhitespace(ReturnValue[j])) {
               SelectValue=ReturnValue[j].split(",");
               ReturnSelect.options[ReturnSelect.options.length]=
                new Option(SelectValue[1],SelectValue[0]);
             }
           }
        }
      }
    );
  }
}
function DisplayPresentComplaintAddInfo() {
  f = document.UpdateForm;
  if (f.emcprcmp.value == "1") {
    document.getElementById('PresentComplaintAddInfo').style.display = "";
  }
  else {
    document.getElementById('PresentComplaintAddInfo').style.display = "none";
  }
}
</script>
</head>
%START.OF.PAGE
<body onload="PageLoadExtended();DisplayPresentComplaintAddInfo();"
      onunload="valOGroup();submitFormRedirect();">
<div id=PatientHeading></div>
<script type="text/javascript">
PatientURN="%EMRWEB02.01.003";
PatientVIS="%EMRWEB02.01.081";
PatientNAM="%EMRWEB02.01.002";
PatientSTA="%EMRWEB02.01.086.078";
PatientALT="%EMRWEB02.01.084";
PatientSEX="%EMRWEB02.01.019";
PatientDOB="%EMRWEB02.01.020";
PatientAGE="%EMRWEB02.01.021";
PatientLOC="%EMRWEB02.01.083";
PatientPRI="%EMRWEB02.01.086.066.1";
PatientUNT="%EMRWEB02.01.066.0";
PatientIND="%EMRWEB02.01.086.091";
GpCOD="%EMRWEB02.01.086.084.001";
GpNAM="%EMRWEB02.01.086.084.081";
GpPRAC="%EMRWEB02.01.086.085.001";
GpPRACCNT="%EMRWEB02.01.086.085.002";
GpPRACNAM="%EMRWEB02.01.086.085.005";
PatientARR="%EMRWEB02.01.101.0 %EMRWEB02.01.102";
PatientSEE="%EMRWEB02.01.199.008";
PatientTRI="%EMRWEB02.01.103.3";
PatientECLC="%EMRWEB02.01.484.1";
PatientCLH="%STANDARD.01.017.CL";
PatientEHFT="%EMRWEB02.01.485";
InsertEmergencyHeader()
</script>
<div id=PatientMenu></div>
<div id=PageBodySection style="height:98%;overflow: auto;">

<form name=UpdateForm action="emrweb02.pbl" method=post style="margin:0"
 onsubmit='return validateMandatory(this);'>
<input type=hidden name=reportno value="01">
<input type=hidden name=resavail value="0">
<input type=hidden name=template value="001">
<input type=hidden name=admissno value="%EMRWEB02.01.081">
<input type=hidden name=urnumber value="%EMRWEB02.01.003">
<input type=hidden name=formactn value="C1">
<input type=hidden name=redirect value="emrweb02.pbl?reportno=1&template=4">
<input type=hidden name=updateky value="%EMRWEB02.01.404">
<input type=hidden name=updttype value="UPDAT">
<input type=hidden name=nextpage value=17>
<input type=hidden name=pmpxi067 value="%EMRWEB02.01.667.0">
<input type=hidden name=username>
<input type=hidden name=password>
<input type=hidden name=dummy1>
<input type=hidden name=dummy2>
<input type=hidden name=emvis004>
<input type=hidden name=emvis005>
<input type=hidden name=emvis135>
<input type=hidden name=emvis136>
<input type=hidden name=emvis137>
<input type=hidden name=emvis138>
<input type=hidden name=emvis147>
<input type=hidden name=emvis118 value="%EMRWEB02.01.003">
<input type=hidden name=savdesc1>
<input type=hidden name=savmanag>
<input type=hidden name=searchgn value="%EMRWEB02.01.009">
<input type=hidden name=searchsn value="%EMRWEB02.01.010">
<input type=hidden name=searchps value="%EMRWEB02.01.019">
<input type=hidden name=searchpd value="%EMRWEB02.01.020">
<input type=hidden name=discstat value="%EMRWEB02.01.147">
<input type=hidden name=emcndoct value="%EMRWEB02.01.455">
<input type=hidden name=webuseid value="%STANDARD.01.008">
<input type="hidden" name="current_precom" id="current_precom"
 value="%EMRWEB02.01.220.1" />
<input type=hidden name=d_ptvis022 id=d_ptvis022 value="%EMRWEB02.01.510">
<input type=hidden name=nurupind value="1">
<input type=hidden name=emcnurse id=emcnurse 
       value="%STANDARD.01.025.122.008.0.1">
<input type=hidden name=valdrtyp value="E">
<input type=hidden name=wbsecocg value="%STANDARD.01.012.3">
<input type=hidden name=emcprcmp id=emcprcmp
 value="%STANDARD.01.025.122.051.1.1">

<table width=100% align=center border=0 cellspacing=0 cellpadding=1>
<tr><td class=HeadingCell align=center>
    ETS Patient Maintenance Screen</td>
    </tr>
</table>
<table width=99% align=center border=0 cellspacing=0 cellpadding=1>
<tr valign=top>
  <td class=DataLabel width=15%>Presenting Complaint </td>
  <td>
    <input type=hidden name=emrviscat value="el">
    <input type="text" size=10 tabindex=7 name=test
           value="%EMRWEB02.01.220.0"
           class="NoAutoFocus"
           onblur="emvis060TopFrame();savePresentingComplaint();"
           onKeyUp='UpCase(this);getPresentCom(this,UpdateForm.emvis060,
                    UpdateForm.emrviscat);
                    SetDirty();'/>
    <select name=emvis060 class=SelectBig onblur="emvis060TopFrame();"
      onchange="SetDirty();">
      <option value="%EMRWEB02.01.220.1">%EMRWEB02.01.220.0</option>
    </select>
  </td>
  <td colspan=4>
    <textarea type=text name=prcom001 id=prcom001 wrap=hard
     cols=50 rows=6 style="overflow-y:hidden" class=AsciiOnly
     title="Presenting Complaint Comments"
     onkeydown="ValidateKeyInput(this);"
     onblur="TextareaBlurHandler(this);prcom001TopFrame();">
    </textarea> 
  </td>
  <td class=DataLabel>Site ID</td>
  <td>
    <input type=hidden name=name_emvis132 title="Site ID">
    <select class="Mandatory" name="emvis132"
     title="Site ID"
     onchange="RemoteEmrLocation(this,UpdateForm.valdrtyp,
               UpdateForm.emvis006);">
     %EMRWEB02.01.931.2
    </select>
  </td>
</tr>
<tr valign=top id=PresentComplaintAddInfo>
  <td class=DataLabel width=15%></td>
  <td></td>
  <td colspan=4>
    <textarea type=text name=vicmt023 id=vicmt023 wrap=hard
     cols=50 rows=6 class=AsciiOnly
     title="Presenting Complaint - Additional Information"
     onkeydown="CheckPresentCompAddInfoTextLimit(this);"
     onblur="TextareaBlurHandler(this);">%EMRWEB02.01.955.023.0
    </textarea>
  </td>
  <td></td>
</tr>

<tr><td class=DataLabel>Location</td>
     <td><input type=hidden name=name_emvis006 title="Location"
         value="%EMRWEB02.01.106.0">
    <select class="Mandatory" name=emvis006 title="Location">
    </select>
    <input type=text size=30 name=emvis149 title="Location Note" 
     value="%EMRWEB02.01.136">
    <td rowspan=4 class=DataLabel valign=top>Management Notes<br>
    <textarea name=vicmt002 rows=4 wrap=hard  
     onblur="SaveMgtNteBLANK(this);"
     onkeydown="LimitText(this,99,16930);"
     cols=60>%EMRWEB02.01.434.002</textarea>
    </td></tr>

<tr><td class=DataLabel>Doctor</td>
<td><input type=text size=6 maxlength=6 name=emvis007 title="Doctor Code"
         value="%EMRWEB02.01.107.001"
         onblur="UpdDoctor();">
        <input type=text size=18 name=dummy3 title="Doctor Name"
         readonly class=Readonly value="%EMRWEB02.01.107.003">
        <img class=Icon src="../images/erase.gif"
         id="DocDelBut" onclick="DelDoc();">
        <img class=Icon src="../images/SearchIcon.gif"
          onclick="SearchDoctor();">
        <input type=button class="Bigbutton" value="Doctor Handover"
         onclick='DoctorData();'></td></tr>
<tr><td class=DataLabel> Treating Nurse </td>
    <td>
    <input type=hidden name=gnm id=gnm>
    <input type=text size=6 name=emvis130 id=emvis130 title="Nurse Code"
         onblur='UpdNur(UpdateForm.emvis130);' value="%EMRWEB02.01.164.1">
        <input type=text size=18 name=dummy5 title="Nurse Name" readonly
         class=Readonly id=dummy5 value="%EMRWEB02.01.164.0">
        <img class=Icon src="../images/erase.gif"
         id="NurDelBut" onclick="DelNurse();">
        <img class=Icon src="../images/SearchIcon.gif"
         onclick="SearchEDNurse(UpdateForm.emvis130,UpdateForm.dummy5);">
        <input type=button class="Bigbutton"
         value="Nurse Handover" onclick='NurseData();'></td></tr>

<tr><td>Triage Nurse</td>
    <td><input type=text size=29 name=name_triage title="Triage Nurse" readonly 
         Class=Readonly value="%EMRWEB02.01.161.0">
    </td></tr>

<tr><td></td></tr>
<tr><td></td></tr>
<tr><td colspan=6 align=center>
    <input type=button class="button" 
           id="btnUpdate"
           name="btnUpdate"
           value="Update" 
     onclick="tempDisable(this);
              RemoveDoubleQuotes(document.UpdateForm.vicmt002);
              validateattendingdoctor(onUpdate);"/>
    <input type=button class="button" value="Clinical" 
     onclick="PatientLink('emrweb02.pbl',1,100);"> 
    <input type=button class="button" value="Registration" 
     onclick="checkurno();">
    <input type=button class="button" value="Injury Data" name=injbuttn
     onclick="SmallFrameEmr('71');"> 
    <input type=button class="button" value="Outstanding" 
     onclick="SmallFrameEmr('51');"> 
    <input type=button class="button" value="Discharge" 
     onclick="checkUR(document.UpdateForm.discstat.value);"> 
    <input type=button class="button" value="Labels & Forms" 
     onclick="SmallFrameEmr('5');"> 
    <input type=button class=RedButton value="Exit" 
     onclick="ReturnToMap();;">
    <input type=button class="button" value="Jump Queue" 
     onclick="updateNext();">
    <input type=button class="button" name=mhprabut
     value="MH Practitioner" onclick="changeMHDocDateTime();">
    </td></tr>
</table>
</form>
</div>
<form name=PatientLinks method=get style="margin:0">
<input type=hidden name=reportno value=1>
<input type=hidden name=template value=004>
<input type=hidden name=regexstm value=102>
<input type=hidden name=newstand value=1>
<input type=hidden name=webuseid value="%STANDARD.01.008">
<input type=hidden name=urnumber value="%EMRWEB02.01.003">
<input type=hidden name=admissno value="%EMRWEB02.01.081">
<input type=hidden name=MenuType value="11">
<input type=hidden name=checksub value="0">
<input type=hidden name=emvis147>
<input type=hidden name=newdoctr value="">
</form>
<form name=HiddenFields style="margin:0">
<input type=hidden name=InjuryIndicator value="%EMRWEB02.01.447">
<input type=hidden name=CheckUr value="%EMRWEB02.01.448">
<input type=hidden name=DoctorCode value="%EMRWEB02.01.107.001">
<input type=hidden name=NurseCode value="%EMRWEB02.01.164.1">
<input type=hidden name=Location value="%EMRWEB02.01.083">
<input type=hidden name=DischargeComplete value="%EMRWEB02.01.147">
<input type=hidden name=Pres01 value="%EMRWEB02.01.104">
<input type=hidden name=Pres02 value="%EMRWEB02.01.105">
<input type=hidden name=Pres03 value="%EMRWEB02.01.174">
<input type=hidden name=Pres04 value="%EMRWEB02.01.175">
<input type=hidden name=Pres05 value="%EMRWEB02.01.176">
<input type=hidden name=Pres06 value="%EMRWEB02.01.177">
<input type=hidden name=linkadmn value="%EMRWEB02.01.081">
</form>

<form name="ChangeSiteForm" action="websec01.pbl" method=post style="margin:0">
<input type=hidden name=reportno value="5">
<input type=hidden name=updttype value="U">
<input type=hidden name=username value="%STANDARD.01.008">
<input type=hidden name=wbsec011 value="1">
<input type=hidden name=wbsec010>
</form>

<form name="ChangeHospForm" action="websec01.pbl" method=post style="margin:0">
<input type=hidden name=reportno value="5">
<input type=hidden name=updttype value="U">
<input type=hidden name=chnghosp value="1">
<input type=hidden name=username value="%STANDARD.01.008">
<input type=hidden name=wbsec011 value="1">
<input type=hidden name=wbsec010>
<input type=hidden name=wbsec031>
</form>

<form name="ChangeLoginForm" action="websec01.pbl" method=post style="margin:0">
<input type=hidden name=reportno value="1">
<input type=hidden name=updttype value=" ">
</form>

<script type="text/javascript">
 CTypeAdm="%EMRWEB02.01.252";
 if ( CTypeAdm == "Yes") {
   document.UpdateForm.emvis147.value=1; 
   document.PatientLinks.emvis147.value=1; }
 else { 
   document.UpdateForm.emvis147.value=0; 
   document.PatientLinks.emvis147.value=0; }
 ShowReg="%EMRWEB02.01.461";
 if(ShowReg=="1") {
   checkurno();
 }
 InjData="%EMRWEB02.01.188";
 if ( InjData =="1" ) {
    document.UpdateForm.injbuttn.className="RedButton";
 }
 if(!isWhitespace("%EMRWEB02.01.271.1")) {
   document.UpdateForm.mhprabut.className="RedButton";
 }
 if(document.HiddenFields.DischargeComplete.value=="4") {
   alert("Warning: This visit is Cancelled");
 }
 emvisite="%EMRWEB02.01.185.1";
 for (var i =0 ; i < document.UpdateForm.emvis132.length; i++) {
   if (document.UpdateForm.emvis132.options[i].value==emvisite) {
    document.UpdateForm.emvis132.selectedIndex=i;
   }
 }
 RemoteEmrLocation(document.UpdateForm.emvis132,
                   document.UpdateForm.valdrtyp,
                   document.UpdateForm.emvis006);
 emvilocn="%EMRWEB02.01.106.1";
 for (var i =0 ; i < document.UpdateForm.emvis006.length; i++) {
   if (document.UpdateForm.emvis006.options[i].value==emvilocn) {
    document.UpdateForm.emvis006.selectedIndex=i;
   }
 }

function ValidOG() {
  // Check indicator 1 of user's OG (Occupational Group)
  // Valid if "E", otherwise invalid
  var p = document.UpdateForm;

  if (p.wbsecocg.value.substr(3,1) != "E") {
    alert("Invalid " + trim("%STANDARD.01.017.w0") + " !");
    return false;
  }

  return true;
}

function ChangeSite(SiteCode) {
  if (!SiteCode || isWhitespace(SiteCode))
    return false;

  var theURL = "websec01.pbl";
  var p = document.ChangeSiteForm;

  p.wbsec010.value = SiteCode;
  var postStr = AJAXPostString(p);

  xmlHttp = createHttpObject();
  xmlHttp.open("POST", theURL, false);
  xmlHttp.setRequestHeader("Content-Type","application/x-www-form-urlencoded;");
  xmlHttp.send(postStr);

  if (xmlHttp.status=="200") {
    return true;
  }
  else {
    return false;
  }
}

function ChangeHospSite(HospCode, SiteCode) {
  if (!HospCode || !SiteCode ||
      isWhitespace(HospCode) || isWhitespace(SiteCode))
    return false;

  var theURL = "websec01.pbl";
  var p = document.ChangeHospForm;

  p.wbsec031.value = HospCode;
  p.wbsec010.value = SiteCode;
  var postStr = AJAXPostString(p);

  xmlHttp = createHttpObject();
  xmlHttp.open("POST", theURL, false);
  xmlHttp.setRequestHeader("Content-Type","application/x-www-form-urlencoded;");
  xmlHttp.send(postStr);

  if (xmlHttp.status=="200") {
    return true;
  }
  else {
    return false;
  }
}

function ChangeLogin() {
  var theURL = "websec01.pbl";
  var p = document.ChangeLoginForm;

  var postStr = AJAXPostString(p);

  xmlHttp = createHttpObject();
  xmlHttp.open("POST", theURL, false);
  xmlHttp.setRequestHeader("Content-Type","application/x-www-form-urlencoded;");
  xmlHttp.send(postStr);

  if (xmlHttp.status=="200") {
    return true;
  }
  else {
    return false;
  }
}

</script>
