<meta name="TemplateVersion" content="V12.01.00">
<meta name="TemplateHome" content="standard">
<meta name="HelpFileName" content="NoContextSet.html">
<meta name="CrossBrowser" content="true">
<script type="text/javascript" src="../js/emrweb0201101.js"></script>
<script type="text/javascript">
function setADCookie() {
  SetCookie("dischargedatecookie",document.UpdateForm.emvis024.value);
  SetCookie("dischargetimecookie",document.UpdateForm.emvis025.value);
  SetCookie("diagtextcookie",document.UpdateForm.emvis037.value);
  SetCookie("diagicd10cookie",document.UpdateForm.pmsvx075.value);
}
function UpdateDischarge() {
  if (document.UpdateForm.emvis026.value.substr(14,2)!="11") {
    if (isWhitespace(document.UpdateForm.emvis037.value)&&
        isWhitespace(document.UpdateForm.pmsvx075.value)) {
      alert("Either Discharge Diagnosis or ICD10 must be populated.");
      return;
    }
  }
//
  i=document.UpdateForm.emvis026.selectedIndex
  ind=trim(document.UpdateForm.emvis026.options[i].value.substr(14,4))
  ind2=trim(document.UpdateForm.d_emvis026.value.substr(14,4));
  if(ind=="18" || ind=="2" || ind=="13" || ind=="14" || ind=="15" || ind=="16"
     || ind=="22" || ind=="25" || ind=="26") {
    document.UpdateForm.emvis133.value=1
    if(ind2!="2") {     // Redirect to update discharge for IP admission
    document.UpdateForm.redirect.value="emrweb02.pbl?reportno=01&template=109" +
           "&urnumber=" + document.UpdateForm.urnumber.value.replace(/ /g,"+") +
           "&admissno=" + document.UpdateForm.admissno.value.replace(/ /g,"+")
    }
    
  } else {
    if(!isWhitespace(document.UpdateForm.d_emvipadm.value)) {
    alert("Warning - Linked Pre-Admission/Admission " +
          document.UpdateForm.d_emvipadm.value +
          " exists. Please Cancel or Unlink the Pre-Admission/Admission " +
          "before continuing.");
      return;
    }
    document.UpdateForm.emvis133.value=0
  }
//
  document.UpdateForm.formactn.value="C1"
  document.UpdateForm.updttype.value="DOCTO"
  document.UpdateForm.emvis007.value = document.UpdateForm.emvis107.value;
  var validateresult = validateMandatory(document.UpdateForm);
  if (validateresult==true) {
     document.UpdateForm.submit()
  }
}

function init() {
  var emvistat = document.HiddenFields.DischargeComplete.value;
  if (emvistat != 2 && emvistat != 3) {
    alert('Patient is not Discharged');
    CancelButton();
    return;
  }

  i=document.UpdateForm.emvis026.selectedIndex
  ind=trim(document.UpdateForm.emvis026.options[i].value.substr(14,4));
    if (ind==19 || ind==4 || ind==17 || ind==20 || ind==21) {
     document.all.Departure.style.display="";
     document.all.Departure.innerHTML=document.all.ShowDeparture.innerHTML;
    } else {
     document.all.Departure.style.display="none";
     document.all.Departure.innerHTML=document.all.ShowDeparture.innerHTML;
     document.UpdateForm.emvis033.className="Readonly"
    }

}
function CheckDepartureA(){
  i=document.UpdateForm.emvis026.selectedIndex
  ind=trim(document.UpdateForm.emvis026.options[i].value.substr(14,4))

// Show Divs
  i=document.UpdateForm.emvis026.selectedIndex
  ind=trim(document.UpdateForm.emvis026.options[i].value.substr(14,4));
  ind2=trim(document.UpdateForm.emvis026.options[i].value.substr(4,1));
    if (ind==19 || ind==4 || ind==17 || ind==20 || ind==21) {
     document.getElementById('Departure').style.display="";
     document.getElementById('Departure').innerHTML=document.getElementById('ShowDeparture').innerHTML;
    } else {
     document.getElementById('Departure').style.display="none";
     document.getElementById('Departure').innerHTML=document.getElementById('ShowDeparture').innerHTML;
     document.UpdateForm.emvis033.value="";
     document.UpdateForm.name_emvis033n.value=""
    }

// Transfer to another hospital
  if (ind=="19" || ind=="4" || ind=="17" || ind=="20" || ind=="21") {
    document.UpdateForm.emvis033.className="Mandatory"
  } else {  
    document.UpdateForm.emvis033.className="Readonly"
  }
//
// Did not wait
//
  if (document.UpdateForm.emvis026.value.substr(14,2)=="11") {
    document.UpdateForm.emvis107.className="";
  } else {
    document.UpdateForm.emvis107.className="Mandatory";
  }
  ShowAdmitButton();
}
function ShowAdmitButton() {
  i=document.UpdateForm.emvis026.selectedIndex
  ind=trim(document.UpdateForm.emvis026.options[i].value.substr(14,4))
  ind2=trim(document.UpdateForm.d_emvis026.value.substr(14,4));
  var AdmitButton=document.getElementById("admitinp");
  if((ind=="18" || ind=="2" || ind=="13" || ind=="14" || ind=="15" || ind=="16"
     || ind=="22" || ind=="25" || ind=="26") && ind2=="2") {
   AdmitButton.style.display=""; 
   if(isWhitespace(document.UpdateForm.d_emvipadm.value)) {
     AdmitButton.disabled=false;       
     AdmitButton.className="RedButton";
   } else {
     AdmitButton.disabled=true;       
     AdmitButton.className="button";
   }
  } else {
    if(!isWhitespace(document.UpdateForm.d_emvipadm.value)) {
       alert("Warning - Linked Pre-Admission/Admission " +
             document.UpdateForm.d_emvipadm.value +
             " exists. Please Cancel or Unlink the Pre-Admission/Admission " +
             "before continuing.");
    }	
    AdmitButton.style.display="none"; 
  }
}
function CancelButton() {
  ind2=trim(document.UpdateForm.d_emvis026.value.substr(14,4))
  if(ind2=="18" || ind2=="2" || ind2=="13" || ind2=="14" || ind2=="15" ||
     ind2=="16" || ind2=="22" || ind2=="25" || ind2=="26") {
    if(isWhitespace(document.UpdateForm.d_emvipadm.value)) {
      alert("Warning - Departure status on file " +
            " requires a linked Pre-Admission/Admission.\n " +
            "Please update the departure status in order to cancel");
       return;
    }
  } else {
    if(!isWhitespace(document.UpdateForm.d_emvipadm.value)) {
      alert("Warning - Linked Pre-Admission/Admission " +
            document.UpdateForm.d_emvipadm.value +
            " exists. Please Cancel or Unlink the Pre-Admission/Admission.");
    }
  }
  PatientLinkTo("emrweb02.pbl",1,17,0,0,0);
}
</script>
</head>
%START.OF.PAGE
<body onload="PageLoad(event);CheckDepartureA();">
<div id=PatientHeading></div>
<script type="text/javascript">
PatientURN="%EMRWEB02.01.003";
PatientVIS="%EMRWEB02.01.081";
PatientNAM="%EMRWEB02.01.002";
PatientSTA="%EMRWEB02.01.086.078";
PatientALT="%EMRWEB02.01.084";
PatientSEX="%EMRWEB02.01.019";
PatientDOB="%EMRWEB02.01.020";
PatientAGE="%EMRWEB02.01.021";
PatientLOC="%EMRWEB02.01.083";
PatientPRI="%EMRWEB02.01.086.066.1";
PatientUNT="%EMRWEB02.01.066.0";
PatientIND="%EMRWEB02.01.086.091";
GpCOD="%EMRWEB02.01.086.084.001";
GpNAM="%EMRWEB02.01.086.084.081";
GpPRAC="%EMRWEB02.01.086.085.001";
GpPRACCNT="%EMRWEB02.01.086.085.002";
GpPRACNAM="%EMRWEB02.01.086.085.005";
PatientARR="%EMRWEB02.01.101.0 %EMRWEB02.01.102";
PatientSEE="%EMRWEB02.01.199.008";
PatientTRI="%EMRWEB02.01.103.3";
PatientECLC="%EMRWEB02.01.484.1";
PatientCLH="%STANDARD.01.017.CL";
PatientEHFT="%EMRWEB02.01.485";
InsertEmergencyHeader()
</script>
<div id=PatientMenu></div>
<div id=PageBodySection>
<table width=100% border=0 cellspacing=0 cellpadding=1>
<tr><td class=HeadingCell align=center>
    Emergency Patient Discharge </td></tr>
</table>
<form name=UpdateForm action=emrweb02.pbl method=post style="margin:0">
 <input type=hidden name=reportno value="01">
 <input type=hidden name=template value="001">
 <input type=hidden name=formactn>
 <input type=hidden name=updttype>
 <input type=hidden name=emvis133>
 <input type=hidden name=admissno value="%EMRWEB02.01.081">
 <input type=hidden name=updateky value="%EMRWEB02.01.404">
 <input type=hidden name=urnumber value="%EMRWEB02.01.003">
 <input type=hidden name=emvis118 value="%EMRWEB02.01.003">
 <input type=hidden name=nextpage value="2">
 <input type=hidden name=redirect value="%EMRWEB02.01.001.emrweb02.01.017">
 <input type=hidden name=chkdot value="%EMRWEB02.01.107.001">
 <input type=hidden name=chknur value="%EMRWEB02.01.164.1">
 <input type=hidden name=dummy1
  value="%EMRWEB02.01.104%EMRWEB02.01.105%EMRWEB02.01.174">
 <input type=hidden name=dummy2
  value="%EMRWEB02.01.175%EMRWEB02.01.176%EMRWEB02.01.177">
 <input type=hidden name=waittime value="%EMRWEB02.01.701">
 <input type=hidden name=loadflag >
 <input type=hidden name=reloadfg value="%EMRWEB02.01.446">
 <input type=hidden name=ongoingc value="%EMRWEB02.01.260.1">
 <input type=hidden name=ctypeadm value="%EMRWEB02.01.252">
 <input type=hidden name=calcwait value="1">
 <input type=hidden name=ptdocsee value="%EMRWEB02.01.130.0 %EMRWEB02.01.131">
 <input type=hidden name=ptnursee value="%EMRWEB02.01.128.0 %EMRWEB02.01.129">
 <input type=hidden name=pmpxi067 value="%EMRWEB02.01.667.0">
 <input type=hidden name=ptcnhdps value="%STANDARD.01.025.080.250.1.1">
 <input type=hidden name="d_emvis024" value="%EMRWEB02.01.124.0">
 <input type=hidden name="d_emvis025" value="%EMRWEB02.01.125">
 <input type=hidden name="d_emvis026" value="%EMRWEB02.01.126.3">
 <input type=hidden name=updfld01 value="">
 <input type=hidden name=reasfc01 value="">
 <input type=hidden name=updfld02 value="">
 <input type=hidden name=reasfc02 value="">
 <input type=hidden name=setemrcm value="1">
 <input type=hidden name=d_emvipadm value="%EMRWEB02.01.148">
 <input type=hidden name=emvis007 value="">
 <input type=hidden name=currdate value="%STANDARD.01.013">
 <input type=hidden name=currtime>

<table width=95% align=center border=0 cellspacing=0 cellpadding=1>
<tr valign=top>
  <td>
    <table width=100% border=0 cellspacing=0 cellpadding=2>
      <tr>
        <td class=DataLabel width=10%>
          Discharge Date 
        </td>
        <td width=30%>

<input type=text size=12 name=emvis024 tabindex=1
         class="Mandatory PastDate" title="Discharge Date"
         value="%EMRWEB02.01.124.0"
         onblur="ValDate(UpdateForm.emvis024,UpdateForm.emvis025);">
         <img notab src=../images/DateLookup.gif class=Icon
         onclick="DateLookupFrame(UpdateForm.emvis024);">
        <input class=Mandatory type=text name=emvis025
         value="%EMRWEB02.01.125"
         size=8 title="Time" tabindex=1
         onblur="ValTime(UpdateForm.emvis024,UpdateForm.emvis025);">
        <img notab src=../images/DateTimeStamp.gif class=Icon
         onclick="SetCurrentDateTime(UpdateForm.emvis024,UpdateForm.emvis025);">
        <img notab src=../images/TimeLookup.gif class=Icon
         onclick="TimeLookupFrame(UpdateForm.emvis025);">
        </td>
        <td class=DataLabel width=10%>
          ED Treating Doctor
        </td>
        <td>
          <input type="text" size=8 maxlength=6 name="emvis106"
           title="ED Treating Doctor" tabindex=5 value="%EMRWEB02.01.516"
           onblur="UpCase(this);
           validateCode(31,UpdateForm.emvis106,UpdateForm.doctnam2);">
          <input type=text readonly size=25 notab name=doctnam2
           title="ED Treating Doctor Description">
         <img notab src="../images/SearchIcon.gif" class=Icon
          onclick="DoctorSearchFrame(UpdateForm.emvis106,UpdateForm.doctnam2);">
          <img src=../images/erase.gif class=Icon
           onclick="clrFields(UpdateForm.emvis106,UpdateForm.doctnam2);">
     </td>
      </tr>

<tr><td class=DataLabel>%STANDARD.01.017.ED</td>
    <td><select name=emvis026 onchange="CheckDepartureA();" tabindex=1
        class=Mandatory title="%STANDARD.01.017.ED">
        <option></option>
        %EMRWEB02.01.126.2
        </select></td>
    <td class=DataLabel>
      ED Discharge Doctor
    </td>
    <td>
      <input type="text" size=8 maxlength=6 name="emvis107" class=Mandatory
       title="ED Discharge Doctor" tabindex=6 value="%EMRWEB02.01.517"
       onblur="UpCase(this); 
       validateCode(31,UpdateForm.emvis107,UpdateForm.doctnam3);">
      <input type=text readonly size=25 notab name=doctnam3
       title="ED Discharge Doctor Description">
      <img notab src="../images/SearchIcon.gif" class=Icon
       onclick="DoctorSearchFrame(emvis107,doctnam3);">
      <img src=../images/erase.gif class=Icon
       onclick="clrFields(UpdateForm.emvis107,UpdateForm.doctnam3);">
   </td>
</tr>
</table>

<div id=Departure></div>

<table width=100% border=0 cellspacing=0 cellpadding=2>
  <tr>
    <td class=DataLabel width=10%>
      Discharge Diagnosis
    </td>
    <td width=30%>
      <input type=text size=40 maxlength=50 name=emvis037
       title="Discharge Diagnosis" tabindex=2 value="%EMRWEB02.01.137">
    </td>
    <td class=DataLabel width=10%>
      ED Consultant
    </td>
    <td>
      <input type="text" size=8 maxlength=6 name="emvis108"
       title="ED Consultant" tabindex=7 value="%EMRWEB02.01.518"
       onblur="UpCase(this);
       validateCode(31,UpdateForm.emvis108,UpdateForm.doctnam4);">
      <input type=text readonly size=25 notab name=doctnam4
       title="ED Consultant Description">
      <img notab src="../images/SearchIcon.gif" class=Icon
       onclick="DoctorSearchFrame(UpdateForm.emvis108,UpdateForm.doctnam4);">
      <img src=../images/erase.gif class=Icon
       onclick="clrFields(UpdateForm.emvis108,UpdateForm.doctnam4);">
    </td>
  </tr>
  <tr>
    <td class=DataLabel>
      ICD10
    </td>
    <td>
     <input type=text name=pmsvx075 title="ICD10" size=10 maxlength=9 
     tabindex=3 value="%EMRWEB02.01.515"
     onblur='validateCode(6,UpdateForm.pmsvx075,UpdateForm.drgdesc1);'>
     <input type=text size=30 name=drgdesc1 title="ICD Description" readonly>
     <img src=../images/SearchIcon.gif alt="Disease Search" class=Icon
     onclick="Icd10DisSearchFrame(UpdateForm.pmsvx075,UpdateForm.drgdesc1,UpdateForm.drgdesc2);">
     <img src=../images/erase.gif class=Icon
     onclick="clrFields(UpdateForm.pmsvx075,UpdateForm.drgdesc1);">
    </td>
</tr>
</table>

<table width=95% border=0 cellspacing=0 cellpadding=2>
<tr valign=top><td class=DataLabel width=10%>Comments</td>
   <td>
          <textarea cols=100 rows=3 name=emcommnt tabindex=4
               onkeydown="LimitText(this,100,300)" 
               wrap=hard>%EMRWEB02.01.434.002</textarea></td>
</tr>
</table>

<table width=100% border=0 cellspacing=0 cellpadding=2>
<tr><td colspan=4 align=center><br>
    <input type=button value="Update" class="button" id="emr02u"
     onclick="tempDisable(this);UpdateDischarge();">
    <input type=button value="Cancel" class="button"
     onclick='CancelButton();'>
    <span id=InsertAdmitButton>
    <input type=button value="Admit to Inpatient" class="button" 
     id="admitinp"
     onclick='setADCookie();PatientLinkTo("patweb89.pbl",1,44,0,0,0);'>
    </span>
</td></tr>
</table>
</table>
</form>

<span id=ShowDeparture style="display:none;">
<table width=100% border=0 cellspacing=0 cellpadding=2>
<tr><td class=DataLabel width=10%>Discharge to</td>
    <td ><input type=text size=10 maxlength=6 name=emvis033 tabindex=2
         title="Discharge to" value="%EMRWEB02.01.133.1"
         onchange="validateCode(9,UpdateForm.emvis033,
                   UpdateForm.name_emvis033n);"
         class=Mandatory>
        <input type=text size=30 name=name_emvis033n readonly
         value="%EMRWEB02.01.133.0">
        <img src=../images/SearchIcon.gif class=Icon
         onclick="TransferSourceFrame(UpdateForm.emvis033,
                  UpdateForm.name_emvis033n);">
        </td>
</tr>
</table>
</span>

<form name=HiddenFields method=get style="margin:0">
<input type=hidden name=DischargeComplete value="%EMRWEB02.01.147">
<input type=hidden name=HospitalAdmission value="%EMRWEB02.01.148">
<input type=hidden name=ctypmand value="%EMRWEB02.01.460.   77">
</form>
<form name=PatientLinks method=get style="margin:0">
<input type=hidden name=reportno value=1>
<input type=hidden name=template value=004>
<input type=hidden name=regexstm value=102>
<input type=hidden name=newstand value=1>
<input type=hidden name=urnumber value="%EMRWEB02.01.003">
<input type=hidden name=admissno value="%EMRWEB02.01.081">
<input type=hidden name=emrgflag value="Y">
<input type=hidden name=nextpage value="4">
<input type=hidden name=MenuType value="11">
<input type=hidden name=webuseid value="%STANDARD.01.008">
</form>
<script type="text/javascript">
  validateCode(31,UpdateForm.emvis106,UpdateForm.doctnam2);
  validateCode(31,UpdateForm.emvis107,UpdateForm.doctnam3);
  validateCode(31,UpdateForm.emvis108,UpdateForm.doctnam4);
  validateCode(6,UpdateForm.pmsvx075,UpdateForm.drgdesc1)
  if (document.UpdateForm.emvis026.value.substr(14,2)=="11") {
    document.UpdateForm.emvis107.className="";
  }
  else
  {
    document.UpdateForm.emvis107.className="Mandatory";
  }
</script>
