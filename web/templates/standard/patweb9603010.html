<meta name="TemplateVersion" content="V12.01.00">
<meta name="TemplateHome" content="standard">
<meta name="HelpFileName" content="NoContextSet.html">
<meta name="CrossBrowser" content="true">
<style type=text/css> 
.TransferOption {
position: relative; 
}
</style>
<script type="text/javascript">
function setTranAdm(){
UpdateDoctor.ctadmvar.value="0"
if (admitdate==UpdateDoctor.trandate.value){
  if(UpdateDoctor.ptcnchsd.value==1){
       ans=confirm("Do you want to change the Transfer Admission Record?")
       if (ans){
         UpdateDoctor.ctadmvar.value="1"
         UpdateDoctor.trantime.value=admittime
      }
   }
 }
}
function valDoctorUnit() {
  unitvalu=UpdateDoctor.chngunit.value.substr(0,3)
  validateCode(3,UpdateDoctor.thedoctr,UpdateDoctor.doctnam2);
  selectOptions("30",UpdateDoctor.thedoctr,UpdateDoctor.chngunit);
  for (var i =0 ; i < UpdateDoctor.chngunit.length; i++) {
    if (UpdateDoctor.chngunit.options[i].value.substr(0,3)==unitvalu) {
       UpdateDoctor.chngunit.selectedIndex=i } };

  if (isWhitespace(unitvalu)) {
    if (UpdateDoctor.chngunit.length==2) {
      UpdateDoctor.chngunit.selectedIndex=1;
    }
  }
}
//
function SubmitDoctor() {
if(admitdate==UpdateDoctor.trandate.value){
   if(admittime>UpdateDoctor.trantime.value){
    alert("Change time cannot be before admission time ("+admittime+")");
    return;
   }
 }
  if(admitstat.substr(0,10)=="Discharged"){
    if(disdate==UpdateDoctor.trandate.value){
     if(distime<UpdateDoctor.trantime.value){
      alert("Change time cannot be after discharge time ("+distime+")");
      return;
   }
  }
 }

  if (validateMandatory(UpdateDoctor)) {
    spec=UpdateDoctor.chngunit.value.substr(0,3)
    care=UpdateDoctor.trnacare.value.substr(0,3)
    doct=UpdateDoctor.thedoctr.value

    if (UpdateDoctor.trnacare.value != care) {
      UpdateDoctor.trnacare.value=care;
    } else { UpdateDoctor.trnacare.value="";}

    if (UpdateDoctor.trnadoct.value != doct) {
      UpdateDoctor.trnadoct.value=doct;
    } 
    else 
    { 
      UpdateDoctor.trnadoct.value="";
    }

    if (ValidateUnit(UpdateDoctor)) {
      document.UpdateDoctor.submit();
    }
  }
}

function ValidateUnit(TheForm) {
  if (TheForm == undefined)
    return true;

  var p = TheForm;

  // Get indicator 9 of Unit code
  var oldIndc9 = p.unitcode.value.substr(11,1);  // OLD Unit
  var newIndc9 = p.chngunit.value.substr(11,1);  // NEW Unit selection

  if ( (isWhitespace(oldIndc9) && isWhitespace(newIndc9)) ||
       (oldIndc9 == "A" && newIndc9 == "A") || 
       (oldIndc9 == "N" && newIndc9 == "N") )
    return true;

  if ((!isWhitespace(oldIndc9) && (oldIndc9 != "A") && (oldIndc9 != "N")) || 
      (!isWhitespace(newIndc9) && (newIndc9 != "A") && (newIndc9 != "N")))
    return true;
  
  if (oldIndc9 != newIndc9) {
    var ans = confirm("Warning - Unit change may require new admission." +
      "\n\nA new admission must be created for a change from Acute to " +
      "Non-Acute care, i.e. General Surgery to Mental Health or General to " +
      "Rehabilitation." +
      "\n\nIf unsure, please check with HIS department." + 
      "\n\nSelect 'OK' to continue with the change or 'Cancel' to return.");

    if (ans) {
      return true;
    }
  }

  return false;
}

function ValTime(dateField,timeField) {
  if (!checkTime(timeField,timeField.title)) {
     return;
  }

  SetCurrentDateTimeNoFocus(null,UpdateDoctor.currtime);
  var curDate = UpdateDoctor.currdate.value;
  var curTime = trim(UpdateDoctor.currtime.value.replace(/:/g,"")) - 0;

  var newTime = trim(timeField.value.replace(/:/g,"")) - 0;

  if (dateField.value == curDate) {
    if (newTime > curTime) {
      alert("Time is in the future");
      FocusDelay(timeField);
    }
  }
}
</script>
</head>
%START.OF.PAGE
<body onload="PageLoad(event);valDoctorUnit();">
<div id=PatientHeading></div>
<script type="text/javascript">
PatientURN="%PATWEB96.03.003";
PatientVIS="%PATWEB96.03.081";
PatientNAM="%PATWEB96.03.002";
PatientSTA="%PATWEB96.03.086.078";
PatientALT="%PATWEB96.03.084";
PatientSEX="%PATWEB96.03.019";
PatientDOB="%PATWEB96.03.020";
PatientAGE="%PATWEB96.03.021";
PatientLOC="%PATWEB96.03.083";
PatientPRI="%PATWEB96.03.086.066.1";
PatientUNT="%PATWEB96.03.066.0";
DoctorCOD="%PATWEB96.03.082.003";
DoctorNAM="%PATWEB96.03.082.002";
PatientAID="%PATWEB96.03.086.090";
PatientIND="%PATWEB96.03.086.091";
PatientCUR="%PATWEB96.03.086.092";
PatientCLC="%PATWEB96.03.086.093.1";
PatientCLH="%STANDARD.01.017.CL";
PatientHFT="%PATWEB96.03.086.094";
PatientCDM="%PATWEB96.03.086.095";
PatientVDH="%PATWEB96.03.086.099.015";
InsertPatientHeader()
</script>
<div id=PatientMenu></div>
<div id=PageBodySection>

<form name=UpdateDoctor id=UpdateDoctor style="margin:0" %PATWEB96.03.201.001
<input type=hidden name=reportno id=reportno value="9">
<input type=hidden name=urnumber id=urnumber value="%PATWEB96.03.003">
<input type=hidden name=admissno id=admissno value="%PATWEB96.03.081">
<input type=hidden name=redirect id=redirect
 value="%PATWEB96.03.001.patweb96.03.004">
<input type=hidden name=nextpage id=nextpage value="2">
<input type=hidden name=trntowrd id=trntowrd value="%PATWEB96.03.105.1">
<input type=hidden name=trntobed id=trntobed value="%PATWEB96.03.106">
<input type=hidden name=trnleave id=trnleave value="0">
<input type=hidden name=trnadoct id=trnadoct value="%PATWEB96.03.108.003">
<input type=hidden name=trnacare id=trnacare value="%PATWEB96.03.113.1">
<input type=hidden name=specialt id=specialt value="%PATWEB96.03.111.1">
<input type=hidden name=ctadmvar id=ctadmvar value="0">
<input type=hidden name=ptcnchsd id=ptcnchsd value="%PATWEB96.03.226">
<input type=hidden name=currdate id=currdate value="%STANDARD.01.013">
<input type=hidden name=currtime id=currtime value="">
<input type=hidden name=unitcode id=unitcode value="%PATWEB96.03.124.3">

  <table border=1 width=100% cellspacing=0 cellpadding=1 >
  <tr><td class=HeadingCell align=center colspan=2 width=100%>
        Bed Transfer & Leave Maintenance </td></tr>
  </table>
  <table border=0 width=100% cellspacing=1>
  <tr valign=top>
  <tr><td class=HeadingCell align=center colspan=2>Current Status</td>
      <td align=center class=HeadingCell colspan=2>Change Attending 
          Doctor/Unit</td></tr>

  <tr><td class=DataLabel>Ward / Bed </td>      
       <td><input type=text size=25 readonly value="%PATWEB96.03.105.0">
       <input type=text size=15 readonly value="%PATWEB96.03.106"></td>

       <td class=DataLabel>Attending Doctor </td>
       <td><input type=text size=7 name=thedoctr id=thedoctr
        value="%PATWEB96.03.108.003"
        class=Mandatory title="Attending Doctor" 
        onblur="UpCase(this);valDoctorUnit();">
       <input type=text readonly size=35 name=doctnam2 id=doctnam2
       value="%PATWEB96.03.108.002">
       <img src=../images/SearchIcon.gif class=Icon
       onclick="DoctorSearchFrame(UpdateDoctor.thedoctr,
                                  UpdateDoctor.doctnam2,
                                  valDoctorUnit)">
       <img src="../images/erase.gif" class=Icon
       onclick="clrDoc(UpdateDoctor.thedoctr,UpdateDoctor.doctnam2);">
       </td></tr>

  <tr><td class=DataLabel>Transfer In Date & Time </td>
       <td><input type=text size=11 readonly value="%PATWEB96.03.204" >
       <input type=text size=5 readonly value="%PATWEB96.03.205"></td>

     <td class=DataLabel>Date/Time of Change </td>
     <td><select name=trandate id=trandate class=Mandatory 
          title="date of change" onchange="setTranAdm()">
      %PATWEB96.03.213
      </select>
      <input type=text size=8 name=trantime id=trantime class=Mandatory
       title="Time of Change" value="%STANDARD.01.016"
       onblur="ValTime(UpdateDoctor.trandate,UpdateDoctor.trantime)">
      <img src=../images/DateTimeStamp.gif class=Icon
       onclick="SetCurrentDateTime(null,UpdateDoctor.trantime);">
      <img src=../images/TimeLookup.gif class=Icon
       onclick="TimeLookupFrame(UpdateDoctor.trantime);"></td></tr>

     <tr><td class=DataLabel>Attending Doctor</td>
       <td><input type=text size=35 readonly value="%PATWEB96.03.108.002">
           </td>

     <td class=DataLabel>%STANDARD.01.017.AC </td>
     <td><select name="chngunit" id="chngunit" class="Mandatory"
          title="%STANDARD.01.017.AC">
     <option></option>
     %PATWEB96.03.124.4
     </select>
     </td></tr>

   <tr><td class=DataLabel>%STANDARD.01.017.A </td>
        <td><input type=text readonly size=30 
             value="%PATWEB96.03.111.0"> </td>

   <tr><td class=DataLabel>%STANDARD.01.017.CC</td>
       <td><input type=text readonly size=30 
           value="%PATWEB96.03.113.0"></td>

       <td align=center colspan=2>
       <input type=button name=formactn id=formactn value=Update class="button"
        onclick="tempDisable(this);SubmitDoctor(this.form);">
       <input type=button value=Cancel class="button"
        onclick="PatientLinkTo('patweb96.pbl',3,4,0);"></td></tr>

  <tr><td class=DataLabel>%STANDARD.01.017.AC</td>
      <td><input type=text readonly size=30 
           value="%PATWEB96.03.124.0"></td></tr>

  <tr><td class=DataLabel>%STANDARD.01.017.CL</td>
      <td><input type=text value="%PATWEB96.03.126.0"></td></tr>

  <tr><td class=DataLabel>Health Fund</td>
         <td class=DataLabel colspan=2>
         <input type=text size=35 name="funddesc" id="funddesc" maxlength="30"
         value="%PATWEB96.03.114.1"> </td></tr>

  <tr><td>Table</td>
      <td><input type="text" size=20 maxlength=30 name="tabldesc" id="tabldesc"
           value="%PATWEB96.03.115.1"></td></tr>
</table>
</form>
</div>

<script type="text/javascript">
  admitdate="%PATWEB96.03.217" 
  admittime="%PATWEB96.03.103" 
  disdate="%PATWEB96.03.218" 
  distime="%PATWEB96.03.302" 
  admitstat="%PATWEB96.03.104" 
  if(admitstat.substr(0,10)=="Discharged"){
     UpdateDoctor.redirect.value="%PATWEB96.03.001.patweb96.03.013"
  }
</script>
<form name=PatientLinks id=PatientLinks method=get>
<input type=hidden name=reportno value=1>
<input type=hidden name=template value=004>
<input type=hidden name=urnumber value="%PATWEB96.03.003">
<input type=hidden name=admissno value="%PATWEB96.03.081">
<input type=hidden name=MenuType value="%PATWEB96.03.088">
<input type=hidden name=alert001 value="">
</form>
