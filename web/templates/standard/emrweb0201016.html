<meta name="TemplateVersion" content="V12.01.00">
<meta name="TemplateHome" content="standard">
<meta name="HelpFileName" content="NoContextSet.html">
<meta name="CrossBrowser" content="true">
<link rel="stylesheet" href="../html/postcode.css" type="text/css">
<script type="text/javascript" src="../js/IBA_Category_C_.js"></script>
<script type="text/javascript" src="../js/IBA_Category_LA.js"></script>
<script type="text/javascript" src="../js/AutoPostCode.js"></script>
<script type="text/javascript" src="../js/EmrRegistration.js"></script>
<script type="text/javascript" src="../js/emrweb0201102.js"></script>
<script type="text/javascript">
function redirectZeroAdm() {
  if (document.UpdateForm.admissno.value=="       0") {
    alert("Emergency Visit not found.");
    location.href="patweb98.pbl?reportno=1&template=052" +
            "&urnumber="+document.UpdateForm.urnumber.value +
            "&admissno="+document.UpdateForm.admissno.value
  }
}
function showFundingSource() {
  i=document.UpdateForm.emvis008.selectedIndex;
  ind=document.UpdateForm.emvis008.options[i].value.substring(3,4)
  if (ind=="A") {
    document.getElementById("FundingHeading").innerHTML=
    document.getElementById("offdutyhd").innerHTML;
    document.getElementById("FundingId").innerHTML=
    document.getElementById("offdutyid").innerHTML;
  } else {
    if (ind=="P") {
      document.getElementById("FundingHeading").innerHTML=fundinghd.innerHTML;
      document.getElementById("FundingId").innerHTML=
      document.getElementById("fundingidshown").innerHTML;
      document.UpdateForm.pmsvx141.className="Mandatory";
    } else {
      document.getElementById("FundingHeading").innerHTML="";
      document.getElementById("FundingId").innerHTML=
      document.getElementById("fundingidblank").innerHTML;;
    }
  }
}
function defaultDisasterCode() {
  if (!isWhitespace(document.UpdateForm.disacode.value)) { 
    document.getElementById("disastercodeDIV").innerHTML=
    document.getElementById("disastercodeSPAN2").innerHTML; 
  } else { 
    document.getElementById("disastercodeDIV").innerHTML=
    document.getElementById("disastercodeSPAN1").innerHTML; 
  } 
  if (document.UpdateForm.urnumber.value=="       0") { 
     document.UpdateForm.dispt001.disabled=true; 
     return; 
  } 
  displayDisasterID(); 

}
function displayDisasterID() {
 p=document.UpdateForm
  if (!isWhitespace(document.UpdateForm.dispt001.value)) {
    document.getElementById("disasteridnumbertitleDIV").innerHTML=
    document.getElementById("disasteridnumbertitleSPAN").innerHTML;
    document.getElementById("disasteridnumberDIV").innerHTML=
    document.getElementById("disasteridnumberSPAN").innerHTML;
  } else {
    document.getElementById("disasteridnumbertitleDIV").innerHTML="";
    document.getElementById("disasteridnumberDIV").innerHTML="";
  }

  if (!isWhitespace(document.getElementById("disasteridnumberDIV").innerHTML)) {
    var serverURL   = "../cgi-bin/patweb80.pbl?reportno=98" +
                    "&valdcode=" + UpdateForm.urnumber.value.replace(/ /g,"+") +
                    UpdateForm.dispt001.value.replace(/ /g,"+");
    var returnValue = RSExecute(serverURL);
    if (returnValue.status==0) {
      ReturnValue=returnValue.return_value.split("|");
      if (!isWhitespace(ReturnValue[0])) {
        p.dispt002.value=ReturnValue;
        p.dispt002.className="Readonly";
        p.dispt002.readOnly=true;
      }
    }
  }
}
//------------------------------------------------------------
// Check if time is in the future
//------------------------------------------------------------
function CheckFutureTime(theForm,checkdate,checktime) {
 SetCurrentDateTimeNoFocus(null,theForm.currtime);// UNIX time
 if (SetDateYYYYMMDD(checkdate)>(theForm.currdate.value)) {
     alert("Arrival Date must be less than or equal to current date");
     UpdateForm.emvis001.focus();
     return false;
 }
 if (SetDateYYYYMMDD(checkdate)==(theForm.currdate.value)) {
   var newttime=trim(checktime.value.replace(/:/g,"")) - 0
   var currentt=trim(theForm.currtime.value.replace(/:/g,"")) - 0
   if(newttime>currentt){
     alert("Arrival Time must be less than or equal to current time");
     UpdateForm.emvis002.focus();
     return false;
   }
 }
 return true;
}

function UpdatePage() {
  p=UpdateForm;
  if(!CheckFutureTime(p,p.emvis001.value,p.emvis002)) {
    return;
  }
  if(!isWhitespace(document.UpdateForm.emvis001.value)) {
    if (SetDateYYYYMMDD(document.UpdateForm.emvis001.value) <
        SetDateYYYYMMDD(document.UpdateForm.d_pbdate.value)) {
     alert("Arrival Date must be after date of birth");
     return;
    }
  }
  setRedirectAdm();
  document.UpdateForm.UpdateButton.disabled=true;
  document.UpdateForm.formactn.value="C1"
  document.UpdateForm.updttype.value="UPDAT"
  document.UpdateForm.target="PopUpFrame";

// this checks to see if it is being used outside the MAPVIEW
  if (isWhitespace(top.menu.location.search)) {
    document.UpdateForm.nextpage.value=9;
  }

    setTimeout('document.UpdateForm.UpdateButton.disabled=false',1000);
  if (validateMandatory(document.UpdateForm)) { 
    document.UpdateForm.submit();
  }
}
function init() {
  checkReferred();
}
function valClaimCode() {
    if(!isWhitespace(document.UpdateForm.deftclam.value)) {
      return;                      
    }

    if (trim(document.UpdateForm.ptype.value.substr(5,1))=="S") 
    {
      for (var i =0 ; i < document.UpdateForm.emvis008.length; i++) {
      if ("E"==trim(document.UpdateForm.emvis008.options[i].value.substr(3,1))){
        document.UpdateForm.emvis008.selectedIndex=i;
        }
      }
    } 
    else  
    {
      if (trim(document.UpdateForm.ptype.value.substr(5,1))=="O")
      {
      for (var i =0 ; i < document.UpdateForm.emvis008.length; i++) {
      if ("G"==trim(document.UpdateForm.emvis008.options[i].value.substr(3,1))){
        document.UpdateForm.emvis008.selectedIndex=i;
        }
      }

      }
    }
}
// Do VEMD Error 132 check
//   If Referred by is a 5 - Emergency department review from this hospital
//   then Type of visit must be either 2 - return visit-planned
//                                  or 4 - outpatient/outpatient clinic
//   AND vis versa
// Do VEMD E142
//   Display warning if Type of visit is 10 - Dead on Arrival
//
function valEmrVisit() {
  if(document.UpdateForm.offdutyb!=undefined){
    if(document.UpdateForm.offdutyb.checked==true){
      alert("Error: Claim Type invalid for 'Off Duty' personnel.")
      return;
    }
  }

  var check=false;
  for(var i = 0; i < UpdateForm.emvis003.length; i++) {
    if (UpdateForm.emvis003[i].checked==true) {
      check=true;
    }
  }

  if (check==false) {
    alert("Triage Category has not been selected !");
    document.UpdateForm.AddButton.disabled=false;
    return
  }

  if (!isWhitespace(document.UpdateForm.dispt001.value)) {
    var serverURL   = "../cgi-bin/comweb80.pbl?reportno=44" +
                    "&valdcode=" + UpdateForm.dispt001.value.replace(/ /g,"+") +
                    UpdateForm.emvis001.value.replace(/ /g,"+");
    var returnValue = RSExecute(serverURL);
    if (returnValue.status!=0) {
      return;
    }
  }

  validateSuspension(UpdateForm.urnumber,UpdateForm.emvis001,UpdateForm.datefrom,UpdateForm.dateto);

  if( UpdateForm.datefrom.value != "0" ){
         if(!confirm("Error : Patient has a Suspension record for period \n" +
               "\t" + UpdateForm.datefrom.value  + " - " + UpdateForm.dateto.value + "\n" +
               "\nWould you like to continue with the Registration?")) {
          return;
        }
  }

  i=document.UpdateForm.emvis061.selectedIndex;
  SrcInd=trim(document.UpdateForm.emvis061.options[i].value.substr(14,4));
  UpdatePage();
}
</script>
%START.OF.PAGE
<body onload="PageLoad(event);redirectZeroAdm();valClaimCode();
      defaultDisasterCode();showFundingSource();">
<div id=PatientHeading></div>
<script type="text/javascript">
PatientURN="%EMRWEB02.01.003";
PatientVIS="%EMRWEB02.01.081";
PatientNAM="%EMRWEB02.01.002";
PatientSTA="%EMRWEB02.01.086.078";
PatientALT="%EMRWEB02.01.084";
PatientSEX="%EMRWEB02.01.019";
PatientDOB="%EMRWEB02.01.020";
PatientAGE="%EMRWEB02.01.021";
PatientLOC="%EMRWEB02.01.083";
PatientPRI="%EMRWEB02.01.086.066.1";
PatientUNT="%EMRWEB02.01.066.0";
PatientIND="%EMRWEB02.01.086.091";
GpCOD="%EMRWEB02.01.086.084.001";
GpNAM="%EMRWEB02.01.086.084.081";
GpPRAC="%EMRWEB02.01.086.085.001";
GpPRACCNT="%EMRWEB02.01.086.085.002";
GpPRACNAM="%EMRWEB02.01.086.085.005";
PatientARR="%EMRWEB02.01.101.0 %EMRWEB02.01.102";
PatientSEE="%EMRWEB02.01.199.008";
PatientTRI="%EMRWEB02.01.103.3";
PatientECLC="%EMRWEB02.01.484.1";
PatientCLH="%STANDARD.01.017.CL";
PatientEHFT="%EMRWEB02.01.485";
InsertEmergencyHeader()
</script>
<div id=PatientMenu></div>
<div id=PageBodySection>
<form name=UpdateForm action="emrweb02.pbl" method=post style="margin:0">
  <input type=hidden name=reportno value="01">
  <input type=hidden name=updatety value="4">
  <input type=hidden name=formactn value="C1">
  <input type=hidden name=updttype value="TRIAG">
  <input type=hidden name=updateky value="%EMRWEB02.01.404">
  <input type=hidden name=admissno value="%EMRWEB02.01.146">
  <input type=hidden name=urnumber value="%EMRWEB02.01.003">
  <input type=hidden name=emvis118 value="%EMRWEB02.01.003">
  <input type=hidden name=emvis147>
  <input type=hidden name=dummyadm><input type=hidden name=fpatname>
  <input type=hidden name=chckname><input type=hidden name=redirflg value="1">
  <input type=hidden name=mvmedrec>
  <input type=hidden name=datefrom>
  <input type=hidden name=dateto>
  <input type=hidden name=dontchec value=1>
  <input type=hidden name=nextpage value="11"><input type=hidden name=redirect>
  <input type=hidden name=ptcnueoc value="%EMRWEB02.01.454">
  <input type=hidden name=ptcnxcom value="%STANDARD.01.025.116.222.0.1">
  <input type="hidden" name="savealia" value="0">
  <input type="hidden" name="aliasset" value="0">
  <input type="hidden" name="prevaddr" value="0">
  <input type="hidden" name="preaddset" value="0">
  <input type="hidden" name="claimc">
  <input type="hidden" name=deftclam value="%EMRWEB02.01.108.1">
  <input type=hidden name=ptcnhdps value="%STANDARD.01.025.080.250.1.1">
  <input type="hidden" name="ptcnusgn"  value="%STANDARD.01.025.114.219.0.1">
  <input type="hidden" name="disacode" value="%EMRWEB02.01.498">
  <input type="hidden" name="disadesc" value="%EMRWEB02.01.499">
  <input type="hidden" name="ptype" value="%EMRWEB02.01.024.3">
  <input type="hidden" name="precinwa" value="1">
  <input type="hidden" name="setemrcm" value="1">
  <input type=hidden name=currdate value="%STANDARD.01.013">
  <input type=hidden name=currtime value="%STANDARD.01.016">
  <input type="hidden" name="d_pbdate" value="%EMRWEB02.01.020">

<table align=center width=100% border=0 cellspacing=0 cellpadding=0>
  <tr>
    <td class=HeadingCell colspan=6 align=center>
      Emergency Visit Details   
    </td>
  </tr>

  <tr>
    <td class=DataLabel>
      %STANDARD.01.017.CL
    </td>
    <td>
      <table cellspacing=0 cellpadding=0 border=0>
      <tr><td>
      <select class="Mandatory SelectMed" name=emvis008 tabindex=1 
       title="%STANDARD.01.017.CL" onchange=showFundingSource();>
         <option></option>
           %EMRWEB02.01.108.2
      </select></td>
      <td><div id=FundingHeading></div></td>
      <td><div id=FundingId></div>
      </td>
      </tr>
      </table>
    </td>
    <td class=DataLabel>
      Arrival Date 
    </td>
    <td class=DataLabel><input type="text" name=emvis001 size="12"
     title="Arrival Date"
     onblur="checkDate(emvis001,'Arrival Date');" tabindex=10
     value="%EMRWEB02.01.101.0" class="PastDate Mandatory">
       <img class=Icon src=../images/DateLookup.gif date=document.UpdateForm.emvis001>
         Time
       <input type="text" name=emvis002 size="8" value="%EMRWEB02.01.102"
        title="Arrival Time"
        onblur="checkTime(this,'Arrival Time')" class=Mandatory tabindex=11>
       <img class="Icon" notab src=../images/DateTimeStamp.gif
        onclick="SetCurrentDateTime(UpdateForm.emvis001,UpdateForm.emvis002);">
       <img class="Icon" src=../images/TimeLookup.gif
        onclick="TimeLookupFrame(UpdateForm.emvis002);">
    </td>
  </tr>

    <tr>
      <td class=DataLabel>
        Arrival Transport
      </td>
      <td>
        <select name=emvis013 class="SelectMed Mandatory" tabindex=2
         title="Arrival Transport">
         <option></option>
           %EMRWEB02.01.113.2
        </select>
      </td>
      <td class=DataLabel>
        Triage Category
      </td>
      <td>
      <table border=0 cellspacing=0>
      <tr>
      <td class=Triage1><i>1</i>
         <input style="border:0" type=radio name=emvis003 value=1></td>
      <td class=Triage2><i>2</i>
        <input style="border:0" type=radio name=emvis003 value=2></td>
      <td class=Triage3><i>3</i>
        <input style="border:0" type=radio name=emvis003 value=3></td>
      <td class=Triage4><i>4</i>
        <input style="border:0" type=radio name=emvis003 value=4></td>
      <td class=Triage5><i>5</i>
        <input style="border:0" type=radio name=emvis003 value=5></td>
      </tr>
      </table>
    </tr>
  <tr>
    <td class=DataLabel>
      %STANDARD.01.017.cw
    </td>
    <td>
      <select name=pmsvx135 class="Mandatory SelectMed" tabindex=3
       title="%STANDARD.01.017.cw">
         <option></option>
           %EMRWEB02.01.513.2
      </select>
    </td>
    <td class=DataLabel>
      Presenting Complaint
    </td>
    <td>
      <input type=text size=40 maxlength=50 name=emvis004 tabindex=12
       value="%EMRWEB02.01.104" title="Presenting Complaint" class=Mandatory>
    </td>
  </tr>

  <tr><td class=DataLabel>
        %STANDARD.01.017.em
      </td>
      <td>
        <select class="Mandatory SelectMed" name=emvis061 tabindex=4
         title="%STANDARD.01.017.em"
         onchange="checkReferred();">
          <option></option>
            %EMRWEB02.01.221.2
        </select>
     </td>
     <td class=DataLabel>
       Location
     </td>
     <td>
       <input type=hidden name=name_emvis006 title="Location"
        value="%EMRWEB02.01.106.0">
       <select class="Mandatory SelectMed" name=emvis006 title="Location"
        tabindex=13>
        %EMRWEB02.01.562
       </select>
     </td>
  </tr>

<tr> <td><div id=TranSrcHeading></div></td>
     <td><div id=TranSrc></div></td>
     <td>
       Disaster Code
     </td>
     <td>
       <div id=disastercodeDIV></div>
     </td>
</tr>

<tr>
    <td></td>
    <td></td>
    <td class=DataLabel><div id=disasteridnumbertitleDIV></div></td>
    <td><div id=disasteridnumberDIV></div></td>
</tr>

<tr valign=top><td class=DataLabel>Comments</td>
   <td colspan=3>
          <textarea cols=100 rows=3 name=emcommnt 
               onkeydown="LimitText(this,100,300)" tabindex=5 
               onkeydown="LimitText(this,100,300);"
               onkeyup="LimitText(this,100,300);"
               oncontextmenu="var that = this; setTimeout(function(){LimitText(that,100,300);},100);"

               wrap=hard>%EMRWEB02.01.434.002</textarea></td>
</tr>

<tr><td colspan=6 align=center class=DataLabel>
    <input type=button name=UpdateButton value="Update" id="emr02upd"
     onclick="tempDisable(this);valEmrVisit();" class="button">
    <input type=button value="Cancel" class="button"
     onclick='PatientLinkTo("emrweb02.pbl",1,17,0,0,0);'>
    </td></tr>
</table>
</form>
</div>
<div id=SelectHeading></div>
<div id=SelectLocation></div>
<script type="text/javascript">

 CTypeAdm="%EMRWEB02.01.252";
 if ( CTypeAdm == "Yes") {
   document.UpdateForm.emvis147.value=1; }
 else { 
   document.UpdateForm.emvis147.value=0; }

  var RadioIndex=%EMRWEB02.01.103.1 - 1        
  if(RadioIndex!=-1) 
  {
    document.UpdateForm.emvis003[RadioIndex].checked=1 
  }

</script>
<form name=HiddenFields method=get>
<input type=hidden name=cob value="%EMRWEB02.01.022.1">
<input type=hidden name=pl1 value="%EMRWEB02.01.602.1">
<input type=hidden name=pl2 value="%EMRWEB02.01.603.1">
</form>
<form name=PatientLinks method=get>
<input type=hidden name=reportno value=1>
<input type=hidden name=template value=004>
<input type=hidden name=regexstm value=102>
<input type=hidden name=newstand value=1>
<input type=hidden name=urnumber value="%EMRWEB02.01.003">
<input type=hidden name=admissno value="%EMRWEB02.01.081">
<input type=hidden name=MenuType value="%EMRWEB02.01.088">
<input type=hidden name=emrgflag value="Y">
<input type=hidden name=nextpage value="4">
<input type=hidden name=webuseid value="%STANDARD.01.008">
</form>

<span id=transferhd style="display:none">
<td class=DataLabel>Transfer Source</td>
</span>

<span id=transferblank style="display:none">
   <input type=hidden name=emvis032 value="" notab>
</span>

<span id=transfersrc style="display:none">
<td><input type="text" size=8 maxlength=6 name="emvis032" 
     value="%EMRWEB02.01.132.1" title="Transfer Source" class=Mandatory
     onchange='validateCode(9,UpdateForm.emvis032,UpdateForm.trnsfsrc);'>
     <input type=text  size=25 name=trnsfsrc value="%EMRWEB02.01.132.0"
      readonly notab>
    <img class="Icon" src="../images/SearchIcon.gif" notab
    onclick="TransferSourceFrame(UpdateForm.emvis032,UpdateForm.trnsfsrc)"></td>
</span>

<span id=AustStateH style="display:none">
<table colspan=1 width=100% height=100% border=0 cellspacing=2 cellpadding=0>
    <td class=DataLabel>State</td>
</table>
</span>
<span id=AustState style="display:none">
<table colspan=1 width=100% height=100% border=0 cellspacing=2 cellpadding=0>
    <td><input type=text size=25 maxlength=25
       name=ptmas085 title="State" 
       value="%EMRWEB02.01.015"
       onchange="checkAdd01();UpCase(this);">
    </td>
</table>
</span>
<span id=OseasCountryH style="display:none">
<table colspan=1 width=100% height=100% border=0 cellspacing=2 cellpadding=0>
    <td class=DataLabel>Country</td>
</table>
</span>
<span id=OseasCountry style="display:none">
<table colspan=1 width=100% height=100% border=0 cellspacing=2 cellpadding=0>
    <td><select name="ptmas085" class="select120 Mandatory"
                 title="Country Address">
        <option></option>
        %EMRWEB02.01.085.060
        </select></td>
</table>
</span>

<span id=disasteridnumbertitleSPAN style="display:none">
Disaster Identification #
</span>

<span id=disasteridnumberSPAN style="display:none">
<input type="text" name=dispt002 size=20 maxlength=19
   title="Disaster Identification Number">
</span>

<span id=blanklabel style="display:none">&nbsp;</span>
<span id=fundinghd style="display:none">
&nbsp;Funding Source
</span>

<span id=fundingidshown style="display:none">
  <select name=pmsvx141 title="%STANDARD.01.017.cx"
          tabindex=100>
          <option> </option>
             %EMRWEB02.01.514.5         
  </select>
</span>

<span id=fundingidblank style="display:none">
  <input type="hidden" name="pmsvx141" value=" ">
</span>

<span id=offdutyhd style="display:none">
 Off Duty
</span>

<span id=offdutyid style="display:none">
 <input type="checkbox" name="offdutyb" value="0">
</span>

<span id=disastercodeSPAN1 style="display:none">
  <select name=dispt001 title="Disaster Code"
   onchange="displayDisasterID();" tabindex=14>
   <option></option>
    %EMRWEB02.01.497
  </select>
</span>

<span id=disastercodeSPAN2 style="display:none">
<input type="text" name=n_dispt001 size=30 class=Readonly readonly
  title="Disaster Code" value="%EMRWEB02.01.499">
<input type=hidden name=dispt001 value="%EMRWEB02.01.498">
</span>
