<meta name="TemplateVersion" content="V12.01.00">
<meta name="TemplateHome" content="standard">
<meta name="HelpFileName" content="NoContextSet.html">
<meta name="CrossBrowser" content="true">
<script type="text/javascript" src=../js/TableSort.js></script>
<script type="text/javascript">
var RefreshTime=5;
var PrivacyTimeOut=0;
function HideSettings() {
  var el= document.getElementById('PageSettings');
  el.style.display='';
  el.style.position='relative';
}
function PrivacyOn() {
  if(document.SearchAdmissions.privacyo.value=='0'){
    document.SearchAdmissions.privacyo.value='1';
  } else {
    document.SearchAdmissions.privacyo.value='0';
  }
  document.SearchAdmissions.submit();
}
</script>
<style type=text/css>
.SettingGearIcon {
 display:inline-block;
 width:20px;
 height:20px;
 background: url("../images/ButtonSprite.png")  -140px -20px no-repeat;
}
.SaveForm {
  display:none;
  background-color:white;
  border:2px solid #ccc;
}
</style>
<script type="text/javascript">
function InitTable(TableView) {
//--------------------------------------------------
// Columns : 0 - Link
//           1 - UR
//           2 - Admission No
//           3 - Patient Name
//           4 - Patient folder
//           5 - Admission Date
//           6 - Sex
//           7 - Ward/Bed
//           8 - Leave type
//           9 - Attending Doctor
//           10- Risk
//           11- O/L Time
//           12- Status button
//           13- Destination  
//           14- Return time  
//           15- Carer
//           16- Leave Count
//           17- Leave time  
//           18- Leave time  
//           19- Cumulative Leave time  
//           20- Link to patient level list
//--------------------------------------------------
switch (TableView) {
case 0: {
 t = new Table(1,0,2,"100%","center",25);
 t.addColumn("Patient","ImageText",4,4,"left nowrap ","PatientFolder","0",140,3)
 t.addColumn("Ward/Bed","String",7,7,"left","","",60)
 t.addColumn("Risk","String",10,10,"center","","",50)
 t.addColumn("Doctor","String",9,9,"left","","",60)
 t.addColumn("Type of Leave","String",8,8,"left","","",40)
 t.addColumn("O/L Time","String",11,11,"left","","",40)
 t.addColumn("Status","String",12,12,"center","","",50)
 t.addColumn("Destination","String",13,13,"left","","",40)
 t.addColumn("Exp. Return","String",14,14,"left","","",40)
 t.addColumn("Carer","String",15,15,"left","","",40)
 t.addColumn("No.Leave Today/Overall","String",16,16,"left","","",40)
 t.addColumn("Leave Min Current/Overall","String",18,18,"left","","",40)
 t.addColumn("Cumulative Leave Mins","String",19,19,"left","","",40)
 AddTableRows()
 TableOutput(1,1);    // Order Column,Asc Dsc
 break; }
 }
}
</script>
</head>
<body onload="PageLoad(event);InitTable(0);setRefresh();">
%START.OF.PAGE
<script type="text/javascript"
 src="Javascript.php?reportno=1&pagekey=patweb9201135">
</script>
<div id=HeadingSection>
<form name=SearchAdmissions action=patweb92.pbl method=get style="margin:0">
<input type=hidden id=locationContext name=locationContext value="patweb9201135" >
<table width=100% cellspacing=0 border=0>
<tr>
<td  align=left class=MapHeadingCell style='font-size:10pt;'>
<span id=gear1 class=SettingGearIcon onclick='ShowSettings();'></span>
<input type=button value=Refresh class="NoAutoFocus Button"
 onclick='location.reload();'>
<input id=btnPrivacy type=button value='Privacy On' class=button  onclick='PrivacyOn();'>
</td>
<td align=right><input id=btnHistory type=button value='History' class=button  onclick='HistoryView();'>
</td></tr>
<input type=hidden name=reportno value=1>
<input type=hidden name=template value=135>
<input type=hidden name=srchtype value=17>
<input type=hidden name=privacyo value="%PATWEB92.01.106">
<input type=hidden name=showflag value="%PATWEB92.01.102">
<input type=hidden name=leavereg value="%PATWEB92.01.109">
<table width=100% cellspacing=0 border=0>
<tr><td class=HeadingCell>Ward </td>
    <td class=HeadingCell><select name=leavward class=SelectMed
                onchange="submit();">
         <option value="  ">ALL</option>
         %PATWEB92.01.101
        </select></td>
    <td class=HeadingCell align=center>
    %STANDARD.01.017.vd
    <select name=leavrisk onchange="submit();">
        <option value="   ">All</option>
        %PATWEB92.01.104.2
        </select></td>
    <td class=HeadingCell align=center>
    Status
    <select name=leavstat onchange="submit();">
        <option value=" ">All</option>
        <option value="L">On Leave</option>
        <option value="R">Returned</option>
        <option value="A">Absconded</option>
        <option value="W">Ward</option>
        </select></td>
    <td class=HeadingCell align=center>
    %STANDARD.01.017.CC
    <select name=leavcare onchange="submit();">
        <option value="   ">All 
       <script type="text/javascript">document.write(document.SearchAdmissions.leavereg.value);</script>
        </option>
        %PATWEB92.01.103.9.1.24.2.    
        </select></td>
   <td class=HeadingCell>Patients: <input type=text name=totcount size=5></td>
   <td class=HeadingCell>On Leave: <input type=text name=onlcount size=5></td>
    </tr>

</table>
</form>
</div>

<div id=TableLocation></div>
<div id=PageSettings class=SaveForm>
<table width=100% cellpadding=2 cellspacing=0>
<tr><td colspan=2 align=center class=HeadingCell>Settings</td></tr>
<tr><td class=DataLabel>Set Privacy On Time Out</td>
<td><select id=mapPrivacyTimeOut name=mapPrivacyTimeOut >
<option value='0'>Off</option>
<option value='1'>On</option>
</select>
</td></tr>
<tr><td class=DataLabel>Refresh Time</td>
<td><select id=mapRefreshTime name=mapRefreshTime >
<option value='0'>Off</option>
<option value='5'>5 minutes</option>
<option value='10'>10 minutes</option>
<option value='15'>15 minutes</option>
<option value='20'>20 minutes</option>
</select>
</td></tr>
<tr valign=top><td colspan=2 align=center>
    <input class=button type=button onclick="SaveSettings();" value=Ok>
    <input class=button type=button onclick="HideSettings();" value=Cancel></td></tr>
</table>
</div>
<script type="text/javascript">
function AddTableRows() {
%PATWEB92.01.029.patweb98.01.048
}
function init(){
  document.SearchAdmissions.onlcount.value="%PATWEB92.01.107"
  document.SearchAdmissions.totcount.value="%PATWEB92.01.108"
LeaveStatus = "%PATWEB92.01.105";
  for (var i =0 ; i < document.SearchAdmissions.leavstat.length; i++) {
   if(document.SearchAdmissions.leavstat.options[i].value==LeaveStatus.substr(0,1)){
       document.SearchAdmissions.leavstat.selectedIndex=i } };

  if(document.SearchAdmissions.privacyo.value=='1'){
    document.getElementById('btnPrivacy').value="Privacy Off";
  } else {
    document.getElementById('btnPrivacy').value="Privacy On";
  }
}
function HistoryView() {
  p=document.SearchAdmissions
  location.href="patweb92.pbl?reportno=01&template=136&viewtype=0"+
                "&leavward="+p.leavward.value+"&leavrisk="+p.leavrisk.value+
                "&leavereg="+p.leavereg.value+
                "&leavstat="+p.leavstat.value+"&leavcare="+p.leavcare.value
}
function PatientLeaveReg(ur,adm){
 location.href="patweb96.pbl?reportno=03&template=023&urnumber="+ur+
               "&admissno="+adm;
}
function UpdateWorkingDiag(ur,adm){
 linkurl="patweb93.pbl?reportno=05&template=003&urnumber="+ur+
                 "&admissno="+adm;
 Left=(document.body.clientWidth-750)/2
 DFrameLink(linkurl,0,Left,900,600);
}
function UpdateLeaveReg(ur,adm,astat){
 p=document.SearchAdmissions
 if(astat=='4'){
   location.href="patweb96.pbl?reportno=03&template=024&urnumber="+ur+
               "&admissno="+adm+"&lvrredir=1&leavward="+p.leavward.value+
               "&leavrisk="+p.leavrisk.value+"&leavstat="+p.leavstat.value+
               "&leavcare="+p.leavcare.value+"&leavereg="+p.leavereg.value;
 } else {
   location.href="patweb96.pbl?reportno=03&template=022&urnumber="+ur+
               "&admissno="+adm+"&lvrredir=1&leavward="+p.leavward.value+
               "&leavrisk="+p.leavrisk.value+"&leavstat="+p.leavstat.value+
               "&leavcare="+p.leavcare.value+"&leavereg="+p.leavereg.value;
 }
}
function ShowSettings() {
  setSelectValue("mapRefreshTime",RefreshTime);
  setSelectValue("mapPrivacyTimeOut",PrivacyTimeOut);
  var el= document.getElementById('PageSettings');
  el.style.position='absolute';
  el.style.top='32px';
  el.style.left='0px';
  el.style.width='400px';
  el.style.height='580px';
  el.style.display='inline-block';
  el.style.zIndex=90000;
}
//------------------------------------------------------------
// Set Select Item based on Value
//------------------------------------------------------------
function setSelectValue(id,val) {
  var el=document.getElementById(id);
  for (i=0;i<el.options.length;i++) {
    if (el.options[i].value==val) {
      el.selectedIndex=i
    }
  }
}
function SaveSettings() {
 var scriptString="";
 var el;
 var inputValue;
 el=document.getElementById("locationContext");
 var pk=el.value;

 el=document.getElementById("mapRefreshTime");
 scriptString+="RefreshTime="+el.options[el.selectedIndex].value+";";
 el=document.getElementById("mapPrivacyTimeOut");
 scriptString+="PrivacyTimeOut="+el.options[el.selectedIndex].value+";";

 UpdateJavascript(pk,"mapLayout",scriptString);
 scriptString="";
}
//------------------------------------------------------------
// Set Select Item based on Value
//------------------------------------------------------------
function setSelectValue(id,val) {
  var el=document.getElementById(id);
  for (i=0;i<el.options.length;i++) {
    if (el.options[i].value==val) {
      el.selectedIndex=i
    }
  }
}
function UpdateJavascript(pageKey,fieldName,fieldString) {
  var theURL="Javascript.php?reportno=2"+
             "&pagekey="+pageKey+
             "&classkey="+fieldName+
             "&classval="+fieldString
  var xmlHttp = createHttpObject();
  xmlHttp.open("GET", theURL, false);
  xmlHttp.send();
  if (xmlHttp.status == 200) {
    if (xmlHttp.responseText!="UPDATED") {
      alert(xmlHttp.responseText);
      return;
    }
  } else {
    alert("ERROR : Can't Save Parameters");
    return;
  }
  location.reload();
}
function setRefresh() {
 if (RefreshTime==0) {return;}
 RefreshFnId = setTimeout(function() {
     if (PrivacyTimeOut>0) {
      document.SearchAdmissions.privacyo.value='1';}
      document.SearchAdmissions.submit();
   },(60000*RefreshTime));
}
</script>
