<meta name="TemplateVersion" content="V12.01.00">
<meta name="TemplateHome" content="standard">
<meta name="HelpFileName"    content="NoContextSet.html">
<meta name="CrossBrowser" content="true">
<script type="text/javascript" src="../js/priweb02.js"></script>
<script type="text/javascript" src="../js/priweb0206001.js"></script>
<script type="text/javascript">

function PostItem() {
  pform=document.AddForm;
  for (var i=0; i < document.AddForm.length; i++) {
     if (pform.elements[i].name.match(/descp/)) {
       if ((!isWhitespace(pform.elements[i-2].value)) &&
           (isWhitespace(pform.elements[i].value))) {
       alert("Invalid Item!"); 
       pform.elements[i-1].focus(); // Set focus back to Item Code input field
       return;   }
      }
  }
  document.AddForm.nextpage.value = "5";
  document.AddForm.redirect.value = "priweb02.pbl?reportno=01&template=013"
     + "&urnumber=" + AddForm.urnumber.value.replace(/ /g,"+") 
     + "&uniqnumb=" + AddForm.uniqnumb.value.replace(/ /g,"+")
     + "&prhre001=" + AddForm.prhre001.value.replace(/ /g,"+")
     + "&prhre002=" + AddForm.prhre002.value.replace(/ /g,"+");

  document.AddForm.redirec2.value = "&prhre003=" 
     + AddForm.prhre003.value.replace(/ /g,"+")
     + "&prhtr005=" + AddForm.prhtr005.value.replace(/ /g,"+")
     + "&prhtr006=" + AddForm.prhtr006.value.replace(/ /g,"+")
     + "&prhtr011=" + AddForm.prhtr011.value.replace(/ /g,"+");

  if (!isWhitespace(document.AddForm.ocdcooki.value)) {
    SetCookie("OtherClaimantDetailsCOOKIE",document.AddForm.ocdcooki.value);
//    alert(GetCookieData('OtherClaimantDetailsCOOKIE'));
  }

  if (((document.getElementById("ptcnuimc").value == "1") &&
      (document.getElementById('typeeimc').value == "1")) ||
      ((document.getElementById("ptcndvaw").value == "1") &&
      (document.getElementById('typedvaw').value == "1"))) { //check if IMC
    var admNo=document.getElementById('prhtr030').value.replace(/ /g,"+");
    if (admNo!=="") {
      if (IEBrowser) {
        for (var d = 101; d < ItemNo; d++) {
          var itemVal='mdate' + d;
          var itemDateStr=AddForm[itemVal].value.replace(/ /g,"+");
          var itemDate=SetDateYYYYMMDD(itemDateStr);
          var serverURL = "../cgi-bin/patweb80.pbl?reportno=4&valdtype=2&valdadno=" + admNo +
                        "&returndt=" + itemDate;
          var returnValue=RSExecute(serverURL);
          if (returnValue.status=="-1") {
            return;
          }
        }
        SubmitHidden(AddForm);
      } else {
        // Normal loops do not work with async fetch rsexecute, because they are synchronous
        // and finish before .then() can run. Use recursion instead, it acts like a loop
        // but forces all asynchronous operations to finish before going to the next value.
        (function validateItems(itemIndex) {
          if (itemIndex == ItemNo) {
            SubmitHidden(AddForm);
            return;
          }
          var admNo=document.getElementById('prhtr030').value.replace(/ /g,"+");
          var itemVal='mdate' + itemIndex;
          var itemDateStr=AddForm[itemVal].value.replace(/ /g,"+");
          var itemDate=SetDateYYYYMMDD(itemDateStr);
          var serverURL = "../cgi-bin/patweb80.pbl?reportno=4&valdtype=2&valdadno=" + admNo +
                          "&returndt=" + itemDate;
          var fetchPromise = RSExecuteFetch(serverURL)
          fetchPromise.then(function (returnValueObj) {
            var returnValue = ParseFetchData(returnValueObj)
            if (returnValue.status == "-1") {
              return;
            } else {
              validateItems(itemIndex + 1);
            }
          });
        })(101);
      }
    } else {
      SubmitHidden(AddForm);
    }
  } else {
    SubmitHidden(AddForm);
  }
}

function LoadItem() {

  document.AddForm.updttype.value="L"
  document.AddForm.nextpage.value="1"
  document.AddForm.countitm.value=document.AddForm.counter.value

//  alert(document.AddForm.countitm.value);
  AddForm.submit();

  }

function CancelItem() {
//      document.AddForm.updttype.value="E";
//      document.AddForm.nextpage.value=0;
//      SubmitHidden(AddForm);
        DFrameExit();
}
function getOCDCookie() {
  if (GetCookieData("OtherClaimantDetailsCOOKIE") != "unknown") {
    document.AddForm.ocdcooki.value=
    GetCookieData("OtherClaimantDetailsCOOKIE");
    ExpireCookiePath("OtherClaimantDetailsCOOKIE");
//alert(document.AddForm.ocdcooki.value);
  } 
}
function VisitSearchFrameGI(Urnumber,ReturnCode,FltCode)
{
  var fltpar = "";
  if (isWhitespace(Urnumber.value))
  {
     alert("Patient Not Identified");
     return;
  }
  switch (FltCode.value) {
    case "2": {
      fltpar = "&filtvtyp=3";
      break;
    }
    case "3": {
      fltpar = "&filtvtyp=2";
      break;
    } 
  } 
  var PopUpFrameDoc = DFrameStart();
  window.ReturnCode=ReturnCode ;
  PopUpFrameDoc.location.href = "patweb98.pbl?reportno=1&template=251"+
                                "&srchview=1" + fltpar + "&filtvsta=4" +
                                "&urnumber=" + Urnumber.value.replace(/ /g,"+")
  SearchFrameShow();
}
function VisitSearchFrameItem(elAdmno) {
  VisitSearchFrameGI(AddForm.urnumber,elAdmno,AddForm.outorinp);
}
function clearVN(vnEl) {
  vnEl.className = "";
}
</script>
</head>
%START.OF.PAGE
<body onload="PageLoad(event);AddMBS();getOCDCookie();">
<div id=PageHeadingSection>
<span class=DFrameTitleBar>
<img align="right" alt="Exit" class="MenuIcon" 
src="../images/ExitIcon.gif" onclick="DFrameExit();">
Input Items
</span>

</div>
<div id=PageBodySection>
    <form  name=AddForm method=post action=priweb02.pbl style="margin:0">
    <input type=hidden name=reportno value="6">
    <input type=hidden name=template value="001">
    <input type=hidden name=updttype value="A">
    <input type=hidden name=nextpage value="0">
    <input type=hidden name=urnumber value="%PRIWEB02.06.003">
    <input type=hidden name=uniqnumb value="%PRIWEB02.06.101">
    <input type=hidden name=prhre001 value="%PRIWEB02.06.102">
    <input type=hidden name=prhre002 value="%PRIWEB02.06.103">
    <input type=hidden name=prhre003 value="%PRIWEB02.06.104">
    <input type=hidden name=prhtr005 value="%PRIWEB02.06.205">
    <input type=hidden name=prhtr006 value="%PRIWEB02.06.206">
    <input type=hidden name=prhtr011 value="%PRIWEB02.06.211">
    <input type=hidden name=claimcod value="%PRIWEB02.06.105.1">
    <input type=hidden name=countitm value="%PRIWEB02.06.108">
    <input type=hidden name=currdate value="%STANDARD.01.015">
    <input type=hidden name=currtime value="%STANDARD.01.016">
    <input type=hidden name=refdocm  value="%STANDARD.01.025.033.200.1.1">
    <input type=hidden name=redirect value="priweb02.pbl?reportno=6&template=002">
    <input type=hidden name=redirec2 value="">
    <input type=hidden name=defsubit id=defsubit value="%PRIWEB02.06.222">
    <input type="hidden" name="ptcnuimc" id="ptcnuimc"
     value="%STANDARD.01.025.124.111.0.1">
    <input type="hidden" name="ptcnuesf" id="ptcnuesf"
     value="%STANDARD.01.025.124.222.0.1">
    <input type=hidden name=dummy value="">
    <input type=hidden name=prhdclam id=prhdclam value="%PRIWEB02.06.343">
    <input type=hidden name=typestfc id=typestfc value="%PRIWEB02.06.345">
    <input type=hidden name=ocdcooki value="">
    <input type=hidden name="ptcnuebb" id="ptcnuebb" 
           value="%STANDARD.01.025.127.122.0.1">
    <input type=hidden name=typebbil id=typebbil value="%PRIWEB02.06.347">
    <input type=hidden name=typeeimc id=typeeimc value="%PRIWEB02.06.349">
    <input type=hidden name=prhtr030 id=prhtr030 value="%PRIWEB02.06.234">
    <input type=hidden name=outorinp id=outorinp value="%PRIWEB02.06.356">
    <input type=hidden name=giclcode id=giclcode value="%PRIWEB02.06.357">
    <input type=hidden name="ptcndvaw" id="ptcndvaw"
           value="%STANDARD.01.025.129.249.0.1">
    <input type=hidden name=typedvaw id=typedvaw value="%PRIWEB02.06.360">

<table width=100% border=0 cellpadding=2 cellspacing=1>
    <tr bgcolor=#CCCCCC>
      <td>If Pathology Test code required, proceed the code with a '%PRIWEB02.06.124'</td>
      <td align=right><b>Common</b></td>
      <td><select name=prthd001 
           title="Common Template" onchange="LoadItem();">
           <option> </option>
           %PRIWEB02.06.106.2
           </select>
          Date
          <input type=text size=11  maxlength=12
           name=prthd002 title='Common Item Date' class='PastDate'
           value="%STANDARD.01.015" onblur='checkDate(this,"Common Item Date")'>
          <img src=../images/DateLookup.gif class=Icon alt='Show Calendar'
           date=AddForm.prthd002>
          Time
          <input type=text size=10 maxlength=10 name=prthd003 
           title='Common Item Time' value="%STANDARD.01.016">
          <img notab src=../images/DateTimeStamp.gif class="Icon"
           onclick="SetCurrentDateTime(null,AddForm.prthd003);">
          <img notab src=../images/TimeLookup.gif class="Icon"
           onclick="TimeLookupFrame(AddForm.prthd003);">
      </td>
    </tr>
</table>

<table width=100% border=0 cellpadding=2 cellspacing=1>
    <tr><td class=HeadingCell>
        <img src="../images/ProcedureSearchIcon.gif" class=Icon
         onclick='javascript:ItemNext();'>Item</td>
        <td class=HeadingCell width="25%">Counter
        <input type=text name=counter size=3 maxlength=3 Readonly></td>
    </tr>
</table>


<table width=100% border=0 cellpadding=0 cellspacing=0>
<tr><td>
<div id='additemtableDIV'>
<table width=100% border=1 align=center cellpadding=0 cellspacing=0>
<tr bgcolor=#CCFFFF>
    <td width=11%><b> Date </b></td>
    <td width=11%><b> Time </b></td>
    <td width=15%><b> Item Code</b></td>
    <td width=26%><b> Description </b></td>
    <td width=5%><b> Quantity </b></td>
    <td width=5%><b> Duration </b></td>
    <td width=8%><b> A/C Override </b></td>
    <td width=8%><b> Amount </b></td></tr> 
</table>
</div>
</td></tr>
</table>

<div id=RecordCoding></div>

<table align=center width=95% border=0>
    <tr><td colspan=2 align=center><br>
    <input type=button value="Ok" class="button" 
       onclick="PostItem();">
    <input type=button value="Cancel" class="button" 
     onclick="CancelItem();">
    </td></tr>
</table>

</form>
</div>

<span id='additemtableSPAN' style="display:none">
<table width=100% border=1 align=center cellpadding=0 cellspacing=0>
<tr bgcolor=#CCFFFF>
    <td width=11%><b> Date </b></td>
    <td width=11%><b> Time </b></td>
    <td width=15%><b> Item Code</b></td>
    <td width=26%><b> Description </b></td>
    <td width=5%><b> Quantity </b></td>
    <td width=8%><b> Amount </b></td></tr>
</table>
</span>

<span id='additemtableSPAN2' style="display:none">
<table width=100% border=1 align=center cellpadding=0 cellspacing=0>
<tr bgcolor=#CCFFFF>
    <td width=11%><b> Date </b></td>
    <td width=11%><b> Time </b></td>
    <td width=11%><b> Visit Number </b></td>
    <td width=15%><b> Item Code</b></td>
    <td width=26%><b> Description </b></td>
    <td width=5%><b> Quantity </b></td>
    <td width=8%><b> Amount </b></td></tr>
</table>
</span>

<span id='ifccvSPAN' style="display:none">
<option></option>
%STANDARD.01.007.ic  
</span>

<span id='sldmcSPAN' style="display:none">
<option></option>
%STANDARD.01.007.Sd   
</span>

<span id='rovrcSPAN' style="display:none">
<option></option>
%STANDARD.01.007.Ro   
</span>

<script type="text/javascript">
//T0863035-Start
//if ((document.getElementById('ptcnuimc').value != '1' &&
//     document.getElementById('ptcnuesf').value != '1')&& 
//    (document.getElementById('ptcnuebb').value != '1' &&
//     document.getElementById('typebbil').value != '1')) {
//  additemtableDIV.innerHTML=additemtableSPAN.innerHTML;
//}
  if ((document.getElementById("ptcnuimc")!= null &&
      document.getElementById("ptcnuimc").value == "1" &&
      document.getElementById('typeeimc') != null &&
      document.getElementById('typeeimc').value == "1") ||
      (document.getElementById('ptcnuesf') != null &&
      document.getElementById("ptcnuesf").value == "1" &&
      document.getElementById('typestfc') != null &&
      document.getElementById("typestfc").value == "1") ||
      (document.getElementById('ptcnuebb') != null &&
      document.getElementById('ptcnuebb').value == "1" &&
      document.getElementById('typebbil') != null &&
      document.getElementById('typebbil').value == "1") ||
      (document.getElementById('ptcndvaw') != null &&
      document.getElementById('ptcndvaw').value == "1" &&
      document.getElementById('typedvaw') != null &&
      document.getElementById('typedvaw').value == "1")) {
   }
   else if (document.getElementById("giclcode").value == "B") {
      additemtableDIV.innerHTML=additemtableSPAN2.innerHTML;
   } else {
      additemtableDIV.innerHTML=additemtableSPAN.innerHTML;
   }
//T0863035-End

PageBodySection.style.height=document.body.clientHeight -
                            PageHeadingSection.clientHeight + 35;
PageBodySection.style.width = document.body.clientWidth - 6;
</script>
