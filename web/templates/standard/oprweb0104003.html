<meta name="TemplateVersion" content="V12.01.00">
<meta name="TemplateHome" content="standard">
<meta name="HelpFileName" content="NoContextSet.html">
<meta name="CrossBrowser" content="true">
<script type="text/javascript" src="../js/oprweb01.js"></script>
<script type="text/javascript" >
%START.OF.PAGE
function validateNurse() {
  var hcpnurse = chkHcpOTNurse();
  if (hcpnurse==true){
     validateCode('18',document.arrivalForm.opard003,
                       document.arrivalForm.name_opard003);
  }
  else {
     validateCode('17',document.arrivalForm.opard003,
                       document.arrivalForm.name_opard003,
                       document.arrivalForm.gnm,
                       SetNurseName);
  }
}
function SetNurseName() {
arrivalForm.name_opard003.value=arrivalForm.gnm.value.replace(/\s*$/g,"")+
                              " " +
                            arrivalForm.name_opard003.value.replace(/\s*$/g,"")
}
function ChkDelay(theField) {
if(theField.value === "")
 return;

if(isWhitespace(arrivalForm.opard002.value)) {
  return;
}

var TimeCald=trim(arrivalForm.opard039.value.replace(/:/g,""))
var ArrvTime=trim(arrivalForm.opard002.value.replace(/:/g,""))
TimeCald=TimeCald.substr(0,4)
ArrvTime=ArrvTime.substr(0,4)
TimeCald=TimeCald - 0;
ArrvTime=ArrvTime - 0;
if(TimeCald>ArrvTime) {
  if (confirm("Time Called for cannot be after the Arrival Time." +
     "\n Do you want to override")) {

      ArrvTime = ArrvTime + 2400;

  } else {
    theField.value ="";
    return;
  }
}
var MaxDelay=(parseInt(TimeCald) + parseInt(arrivalForm.mindelay.value))
var Minutes=parseInt(MaxDelay) % 100
var Hour=parseInt(MaxDelay) / 100
if (Minutes>=60) {
   Minutes=Minutes - 60
   Hour=parseInt(Hour) + 1
   MaxDelay = (Hour*100) + Minutes
}
//alert(MaxDelay+" "+ArrvTime);
if (MaxDelay < ArrvTime) {
   arrivalForm.opard004.className="Mandatory"
   }
else {
   arrivalForm.opard004.className=""
   }
}
function ChkArrv() {
  if(arrivalForm.opard039.value === "")
     return;

  if(!isWhitespace(arrivalForm.opard002.value)) {
    var TimeCald=trim(arrivalForm.opard039.value.replace(/:/g,""))
    var ArrvTime=trim(arrivalForm.opard002.value.replace(/:/g,""))
    TimeCald=TimeCald - 0;
    ArrvTime=ArrvTime - 0;
    if(TimeCald>ArrvTime) {
      if (confirm("Time Called for cannot be after the Arrival Time." +
         "\n Do you want to override")) {
        return;
       }
       arrivalForm.opard002.value="";
       arrivalForm.opard039.value="";
       return;
      }
   }
}
function formSubmit(){
   setCGI(arrivalForm);
   anTime=arrivalForm.anaesTime.value.replace(/:/g,"");
   arTime=arrivalForm.opard002.value.replace(/:/g,"")

   if(!ChkDateTime(arrivalForm.admsdate,arrivalForm.admstime,arrivalForm.opsedate,arrivalForm.opard002)) {
     ans = confirm("Arrival time must be equal to or greater than the admission time\n" + 
                   "Do you want to override?");
     if(!ans){
        return;
     }
   }

   if(!isWhitespace(anTime)){
    if(arTime > anTime){
      if(!confirm("Arrival time should be less than Anaesthetic time " +
                  arrivalForm.anaesTime.value + "\n Do you want to override?")) {
         return;
      }
     }
   }
   if(validateMandatory(arrivalForm))
       arrivalForm.submit();
}
//C-0825792 - Check Use pmshcpaf/oprnuraf for OT Nurse
function chkHcpOTNurse(){
  if (document.getElementById('opcnurse')) {
      if (document.getElementById('opcnurse').value == "1") {
        return true;
      }
      else {
        return false;
      }
  }
  else {
      return false;
  }
}

//C-0825792 - Search Nurse from pmshcpaf/oprnuraf for OT Nurse
function SearchOTNurse(NurseId,ReturnNurseName) {
  var hcpnurse = chkHcpOTNurse();
  if (hcpnurse==true){
     HCPSearchFrame(NurseId,ReturnNurseName,20);
  }
  else {
     NurseSearchFrame(NurseId,ReturnNurseName);
  }
}
</script>
<script>
function TimeCheck(){

  var fieldElement;
  var theatreDate = "%OPRWEB01.04.301".slice(3,8);
  var fieldName = "timecheck%STANDARD.01.044.113.064.002".replace(" ", "0");

  try{
    if(!this.event.srcElement.value){
      return;
    }
    if(this.event.srcElement.id!=fieldName){
      return;
    }
    if(!Get("discdate").value){
      return;
    }
    fieldElement = Get(fieldName);
    var dateArray = Get("discdate").value.split(" ");
    var monthNumber = new Date(Date.parse(dateArray[1] +" 1, 2012")).getMonth()+1;
    var monthString = monthNumber<10? "0" + monthNumber : "" + monthNumber
    var dDate = dateArray[2] + monthString + dateArray[0];
    if(theatreDate + fieldElement.value > dDate+Get("disctime").value){
       alert(fieldElement.title + " cannot be after the discharge date.");
       fieldElement.value = "";
       fieldElement.focus();
    }
  }catch(e){}
}
function Get(el){return document.getElementById(el);}
</script>
</head>
<body onload="PageLoad(event);setRadio(arrivalForm);">
<span class=DFrameTitleBar>
<img align="right" alt="Exit" class="MenuIcon" 
 src="../images/ExitIcon.gif" onclick="DFrameExit();">
Theatre Case Arrival Details
</span>

<form name=arrivalForm method=get action=oprweb01.pbl style="margin:0" 
onSubmit="setCGI(arrivalForm);return validateMandatory(this);">
<input type=hidden name=reportno value=5>
<input type=hidden name=template value=003>
<input type=hidden name=updttype value="U">
<input type=hidden name=urnumber value="%OPRWEB01.04.003">
<input type=hidden name=admissno value="%OPRWEB01.04.081">
<input type=hidden name=anaesTime value="%OPRWEB01.04.442">
<input type=hidden name=mindelay value="%OPRWEB01.04.602">
<input type=hidden name=casekeys value="%OPRWEB01.04.101">
<input type=hidden name=gnm id=gnm>
 
<!-- dont change order of hidden parameters opard005-12. it will adversely 
  affect java script functions setCGI() and setRadio() -->
<input type=hidden name=opard005 value="%OPRWEB01.04.405">
<input type=hidden name=opard006 value="%OPRWEB01.04.406">
<input type=hidden name=opard007 value="%OPRWEB01.04.407">
<input type=hidden name=opard008 value="%OPRWEB01.04.408">
<input type=hidden name=opard009 value="%OPRWEB01.04.409">
<input type=hidden name=opard010 value="%OPRWEB01.04.410">
<input type=hidden name=opard011 value="%OPRWEB01.04.411">
<input type=hidden name=opard012 value="%OPRWEB01.04.412">
<input type=hidden name=opsedate value="%OPRWEB01.04.302">
<input type=hidden name=admsdate value="%OPRWEB01.04.610.002">
<input type=hidden name=admstime value="%OPRWEB01.04.610.003">
<input type=hidden name=currdate value="%STANDARD.01.013">
<input type=hidden name=currtime value="">
<input type=hidden name=opcnurse id=opcnurse
       value="%STANDARD.01.025.113.051.0.1">
<input type=hidden name="discdate" id="discdate" value="%OPRWEB01.04.629">
<input type=hidden name="disctime" id="disctime" value="%OPRWEB01.04.630">

<table border="0" cellpadding="2" cellspacing="0" width="100%" >
<tr><td class=DataLabel>Time Called For</td>
    <td class=DataField><input type=text name=opard039 size=8 id=timecheck01 
        value="%OPRWEB01.04.439" title="Time Called For" class=Mandatory 
        onblur="checkTime(this);ChkDelay(this);
            CheckFutureTime(arrivalForm,arrivalForm.opsedate.value,
                            arrivalForm.opard039);TimeCheck()">
        <img src="../images/DateTimeStamp.gif" class=Icon
         onclick="SetCurrentDateTime(null,arrivalForm.opard039);">
        <img src="../images/TimeLookup.gif" class=Icon
         onclick="TimeLookupFrame(arrivalForm.opard039);"></td>
    <td class=DataLabel>Time of Arrival</td>
    <td class=DataField><input type=text name=opard002 size=8 id=timecheck02 
        value="%OPRWEB01.04.402" title="Time of Arrival" class=Mandatory 
        onblur="checkTime(this);ChkDelay(this);
              CheckFutureTime(arrivalForm,arrivalForm.opsedate.value,
                              arrivalForm.opard002);TimeCheck()">
       <img src="../images/DateTimeStamp.gif" class=Icon
        onclick="SetCurrentDateTime(null,arrivalForm.opard002);">
       <img src="../images/TimeLookup.gif" class=Icon 
        onclick="TimeLookupFrame(arrivalForm.opard002);"></td></tr>

<tr><td class=DataLabel>Pre-op Check List Complete</td>
    <td class=DataField>
    <input type=radio name=checkl05 value="Yes">Yes
    <input type=radio name=checkl05 value="No">No</td>

    <td class=DataLabel>Consent Form Signed</td>
    <td class=DataField>
    <input type=radio name=checkl06 value="Consent Form Signed">Yes
    <input type=radio name=checkl06 value="Consent Form NOT Signed">No</td>
</tr>

<tr><td class=DataLabel>Medical Record</td>
    <td class=DataField>
    <input type=radio name=checkl07 value="Medical Record">Yes
    <input type=radio name=checkl07 value="NO Medical Record">No</td>

    <td class=DataLabel>X-Rays</td>
    <td class=DataField>
    <input type=radio name=checkl08 value="X-Rays">Yes
    <input type=radio name=checkl08 value="NO X-Rays">No</td>
</tr>

<tr><td class=DataLabel>Bladder Empty</td>
    <td class=DataField>
    <input type=radio name=checkl09 value="Bladder Empty">Yes
    <input type=radio name=checkl09 value="Bladder NOT Empty">No</td>

    <td class=DataLabel>Make-up/Jewellery Removed</td>
    <td class=DataField>
    <input type=radio name=checkl10 value="Make-up Removed">Yes
    <input type=radio name=checkl10 value="Make-up NOT Removed">No</td>
</tr>

<tr><td class=DataLabel>Pre-medication Given</td>
    <td class=DataField>
    <input type=radio name=checkl11 value="Pre-medication Given">Yes
    <input type=radio name=checkl11 value="Pre-medication NOT Given">No</td>

    <td class=DataLabel>Checked Allergies</td>
    <td class=DataField>
    <input type=radio name=checkl12 value="Allergies Checked">Yes
    <input type=radio name=checkl12 value="Allergies NOT Checked">No</td>
</tr>

<tr><td class=DataLabel>Time Variation Reason</td>
    <td class=DataField>
    <select name=opard004 title="Late Reason" class=selectBig>
    <option></option>
    %OPRWEB01.04.404.2
    </select></td>
    <td class=DataLabel>Admitting Nurse</td>
    <td class=DataField nowrap>
    <input type=text name=opard003 id=opard003 title="Nurse Code" size=6 
      maxlength=6 value="%OPRWEB01.04.403.1" 
      onblur="validateNurse();">
    <input type=text name=name_opard003 title="Nurse" class=ReadOnly readonly
     size=22 maxlength=30 value="%OPRWEB01.04.403.0"
     id=name_opard003 >
    <img src="../images/SearchIcon.gif" class=Icon
     onclick="SearchOTNurse(arrivalForm.opard003,arrivalForm.name_opard003);"></td></tr>
    
<tr><td class=DataLabel>Prosthesis</td>
    <td class=DataField >
    <input type=text name=opard013 value='%OPRWEB01.04.413' maxlength=40>
    </td></tr>

<tr><td colspan=4 align=center>
    <input class="button" type=button id="opr01sub" value="Ok" 
     onclick="tempDisable(this);formSubmit();">
    <input class="button" type=button value="Cancel" onclick="DFrameClose();">
    </td></tr>
</table>
</form>

<form name=PatientLinks method=get>
<input type=hidden name=reportno value=1>
<input type=hidden name=template value=004>
<input type=hidden name=urnumber value="%OPRWEB01.04.003">
<input type=hidden name=admissno value="%OPRWEB01.04.081">
<input type=hidden name=casekeys value="%OPRWEB01.04.101">
<input type=hidden name=MenuType value="%OPRWEB01.04.088">
</form>
