<meta name="TemplateVersion" content="V12.01.00">
<meta name="TemplateHome" content="standard">
<meta name="HelpFileName" content="NoContextSet.html">
<meta name="CrossBrowser" content="true">
<script type="text/javascript">
bPeriodDatesLoaded = false;

function DefaultWard() {
  var p = document;
  if(parent.parent.window.ReturnWard != undefined &&
     !isWhitespace(parent.parent.window.ReturnWard.value)) {
    DefWard=parent.parent.window.ReturnWard.value;
    for (var i =0 ; i < p.SelectPeriod.wardcode.length; i++) {
      if (p.SelectPeriod.wardcode.options[i].value==DefWard.substr(0,3)) {
          p.SelectPeriod.wardcode.selectedIndex=i 
      }
    }
  }
}
function GetPeriodDates(ReturnSelect,DateStr,SelectPos) {
  if (DateStr == undefined)
    return;

  // Retrieve current period date values
  var serverURL = "../cgi-bin/patweb95.pbl?reportno=8" + "&calcdate=" + DateStr;
  var returnValue = RSExecute(serverURL);
  if (returnValue.status==0) {
    var retStr = returnValue.return_value;

    if (retStr.substr(retStr.length-1, 1) == "|") {
      retStr = retStr.substr(0, retStr.length-1);  // chop off trailing "|"
    }

    ReturnValue = retStr.split("|");

    // Reload selection list; create NEW options
    ReturnSelect.options.length = 0;
    for (var j=0; j < ReturnValue.length; j++) {
       if (!isWhitespace(ReturnValue[j])) {
         SelectValue=ReturnValue[j].split(",");
         ReturnSelect.options[ReturnSelect.options.length]=
          new Option(SelectValue[1],SelectValue[0]);
       }
    } 

    // Select our date
    for (i=0; i < ReturnValue.length; i++) {
      if (ReturnSelect.options[i].value == DateStr) {
        ReturnSelect.selectedIndex=i;
      }
    }

    if (SelectPos != undefined) {
      ReturnSelect.selectedIndex += SelectPos;
    }

    bPeriodDatesLoaded = true;
  }
}
function LoadPeriodDates(isChecked) {
  if (!isChecked && !bPeriodDatesLoaded)
    return;

  var p = document;
  var admisDate = "";

  if (parent.parent.ReturnDate != undefined) {
    admisDate = parent.parent.ReturnDate.value;
  }
  else {
    if (parent.parent) {
      if ((parent.parent.pat96btf != undefined) &&
	  (parent.parent.pat96btf.trandate != undefined)) {
	admisDate = parent.parent.pat96btf.trandate.value;
      }
      else if ((parent.parent.UpdateForm != undefined) &&
	       (parent.parent.UpdateForm.ptmis001 != undefined)) {
	admisDate = parent.parent.UpdateForm.ptmis001.value;
      }
    }
  }

  if (admisDate.length > 0) {
    if (admisDate.length > 8) {
      // Date string is in format of 'DD mmm YYYY' and we need to convert it
      // to 'YYYYMMDD'.
      admisDate = SetDateYYYYMMDD(admisDate);
    }
    if (!bPeriodDatesLoaded) {
      GetPeriodDates(p.SelectPeriod.lastdate,admisDate);
    }
  }
}
function ToggleDateSearch(isChecked) {
  ShowHideDateSearch(isChecked);
}
function ShowHideDateSearch(ShowDateFields) {
  var p = document;

  if (ShowDateFields) {
    p.getElementById('emptonly').disabled = true;
    p.getElementById('bedsonly').disabled = true;
    p.getElementById('filtbtyp').disabled = true;
    p.getElementById('filtrsex').disabled = true;

    //RemoveListOptions('wardcode','');  // remove the 'All' ward option
    p.SelectPeriod.wardcode.options[0].disabled = true;  // disable 'All' ward
    if (p.SelectPeriod.wardcode.selectedIndex == 0) {
      p.SelectPeriod.wardcode.selectedIndex = 1;
    }
    EnableChildElements('spWardDateSrch');

    p.getElementById('aDateLookup').href = "javascript:CalendarIconClick();";
//  parent.SearchResults.location.href = 'about:blank'; // clear results frame


    p.SelectPeriod.setAttribute("action","patweb93.pbl");
    p.SelectPeriod.reportno.value = "13";
    p.SelectPeriod.template.value = "011";
    p.SelectPeriod.wdbdsrch.value = "1";
    p.SelectPeriod.setAttribute("target","SearchResults");
    parent.document.getElementById('SearchResults').src = 'blank.html'; // clear results frame
  }
  else {
    p.getElementById('emptonly').disabled = false;
    p.getElementById('bedsonly').disabled = false;
    p.getElementById('filtbtyp').disabled = false;
    p.getElementById('filtrsex').disabled = false;

    /*
    var oList = p.getElementById('wardcode');
    oList.options[oList.length] = new Option("All","");  // re-add 'All' option
    */
    p.SelectPeriod.wardcode.options[0].disabled = false;  // enable 'All' ward
    DisableChildElements('spWardDateSrch');

    parent.document.getElementById('SearchSet').rows = "100,*";
    parent.document.getElementById('SearchResults').src = 'blank.html';
//  parent.SearchSet.rows = "100,*";
//  parent.SearchResults.location.href = 'about:blank'; // clear results frame

    p.SelectPeriod.setAttribute("action","patweb95.pbl");
    p.SelectPeriod.reportno.value = "1";
    p.SelectPeriod.template.value = "002";
    p.SelectPeriod.wdbdsrch.value = "0";
    p.SelectPeriod.setAttribute("target","SearchResults");
  }
}
function SubmitSearch() {
  var p = document;

  if (p.SelectPeriod.datesrch.checked) {
    p.BedViewForm.wardcode.value = p.SelectPeriod.wardcode.value;
    p.BedViewForm.lastdate.value = p.SelectPeriod.lastdate.value;
    p.BedViewForm.submit();
  }
  else {
    p.SelectPeriod.setAttribute("action","patweb95.pbl");
    p.SelectPeriod.reportno.value = "1";
    p.SelectPeriod.template.value = "002";
    p.SelectPeriod.setAttribute("target","SearchResults");
    p.SelectPeriod.submit();
  }
}
function PrevDate() {
  var p = document;
  var oWard = p.SelectPeriod.wardcode;
  var oDateSelect = p.SelectPeriod.lastdate;

  if (oDateSelect.selectedIndex == 0) {
    GetPeriodDates(p.SelectPeriod.lastdate,oDateSelect.options[oDateSelect.selectedIndex].value,-1);
  }
  else {
    oDateSelect.selectedIndex -= 1;
  }

  SubmitSearch();
}
function NextDate() {
  var p = document;
  var oWard = p.SelectPeriod.wardcode;
  var oDateSelect = p.SelectPeriod.lastdate;

  if (oDateSelect.selectedIndex == (oDateSelect.options.length - 1)) {
    GetPeriodDates(p.SelectPeriod.lastdate,oDateSelect.options[oDateSelect.selectedIndex].value,1);
  }
  else {
    oDateSelect.selectedIndex += 1;
  }

  SubmitSearch();
}
function CalendarIconClick() {
//parent.SearchSet.rows = "250,*";
  parent.document.getElementById('SearchSet').rows = "250,*";
  SelectDateFrame();
}
function CalendarDateSelected(DateSelected) {
//parent.SearchSet.rows = "100,*";
  parent.document.getElementById('SearchSet').rows = "100,*";
  GetPeriodDates(document.SelectPeriod.lastdate,DateSelected);
}
function CalendarClose() {
//parent.SearchSet.rows = "100,*";
  parent.document.getElementById('SearchSet').rows = "100,*";
}

function SetNoRecord() {
 // Get height of the dframe 
 var h = getClientHeight(parent.document.body);
 // Exclude headings height
 body=h-144;
 // Divide Dframe height by avg18px(row) to display no of rows in the dframe.
 var NoofRecords = Math.floor(body/18);
 document.SelectPeriod.norecord.value=NoofRecords;
}
</script>
%START.OF.PAGE
<body onload="PageLoad(event);self.focus();DefaultWard();SetNoRecord();">
<!--        Sub-Frame Header Section       -->
<span class=DFrameTitleBar id=DFrameTitleBar>
<img border=0 align=right src=../images/ExitIcon.gif onclick=SearchFrameExit()>
<script language=javascript>document.write(self.document.title);</script>
</span>

<!--        Search Options                 -->
<div style="background-color:#cccccc;height:100%;">
<form name=SelectPeriod action="patweb95.pbl" method=post style="margin:0">
<input type=hidden name=reportno value=1>
<input type=hidden name=template value=001>
<input type=hidden name=norecord value=24> 
<input type=hidden name=wdbdsrch value="1"> 
<input type=hidden name=viewtype value="0"> 

<table width="95%" align=center cellpadding=2 cellspacing=0 border=0>
<tr><td class=DataLabel>Select Ward </td>
    <td><select name=wardcode id=wardcode> 
          <option value="">All Wards</option>
          %PATWEB95.01.005
        </select></td>
    <td class=DataLabel>Bed Type</td>
    <td><select name=filtbtyp id=filtbtyp> 
          <option value="">All</option>
          %PATWEB95.01.008.2
        </select></td>
    <td class=DataLabel id=wardDateTimeSearch>Ward Date/Time Search
      <input type=checkbox name=datesrch id=datesrch value="1"
       onclick="ToggleDateSearch(this.checked);LoadPeriodDates(this.checked);">
    </td>
    <td align=right>
      <input type=button value="Search" class="button" onclick="SubmitSearch();
       SetNoRecord();">
    </td>
</tr>

<tr><td class=DataLabel>Empty Beds Only</td>
    <td><input type=checkbox name=emptonly id=emptonly value="1" checked></td>
    <td class=DataLabel >Intended Sex of Patient</td>
    <td><select name=filtrsex id=filtrsex> 
          <option value="">All</option>
          <option value="F">Female</option>
          <option value="M">Male</option>
        </select></td>
    <td>
      <span id=spWardDateSrch>
        <input type=button value="<<" class=SmallButton
         onclick='PrevDate();'>
        %PATWEB95.01.013
        <input type=button value=">>" class=SmallButton
         onclick='NextDate();'>
        <a id=aDateLookup href='javascript:CalendarIconClick();'>
         <img src="../images/DateLookup.gif" class=Icon align=absmiddle
          alt="Select Date">
        </a>
      </span>
    </td>
</tr>
<tr><td class=DataLabel>Bed Wards Only</td>
    <td><input type=checkbox name=bedsonly id=bedsonly value="1"></td>
</tr>
</table>
</form>
</div>

<form name=BedViewForm action="patweb93.pbl" method=post target=SearchResults
 style="margin:0">
<input type=hidden name=reportno value=13>
<input type=hidden name=template value=011>
<input type=hidden name=wdbdsrch value="1"> 
<input type=hidden name=viewtype value="0">
<input type=hidden name=wardcode value=""> 
<input type=hidden name=lastdate value=""> 
</form>

<script type="text/javascript">
var p = document;
var FiltSex="%PATWEB95.01.007";
for (var i =0 ; i < document.SelectPeriod.filtrsex.length; i++) {
  if (p.all.filtrsex.options[i].value==FiltSex.substr(0,1)) {
       p.all.filtrsex.selectedIndex=i;
  }
};

var WrdDateSrch = "%PATWEB95.01.014";
if (WrdDateSrch == "1") {
  p.SelectPeriod.datesrch.checked = true;
  bPeriodDatesLoaded = true;
  ShowHideDateSearch(true);   // show Ward Date/Time Search fields
}
else {
  ShowHideDateSearch(false);  // hide Ward Date/Time Search fields
}

if(!EnableWardSearchFunctionality){
   document.getElementById("spWardDateSrch").style.visibility="hidden";
   document.getElementById("wardDateTimeSearch").style.visibility="hidden";
}
</script>

