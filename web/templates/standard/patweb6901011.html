<meta name="TemplateVersion" content="V12.01.00">
<meta name="TemplateHome" content="standard">
<meta name="HelpFileName" content="NoContextSet.html">
<script type="text/javascript" src="../js/patweb69.js"></script>
<script type="text/javascript">
function updateParent(name,urnumber,visit) {
  if (typeof parent.parent.Allweb02Return === "function") {
    if (!parent.parent.Allweb02Return(urnumber))
    {
      // user chose to cancel
      return;
    }
  }
  parent.parent.ReturnUR.value = urnumber
  parent.parent.ReturnName.value = name
  parent.parent.ReturnVisit.value = visit
  SearchFrameExit();
  if (parent.parent.ReturnFunction != "" ) {
    parent.parent.ReturnFunction()  }
}

function init()
{
  if(top.location.pathname.match(/EmergencyMap/g)) {
     return;
  }
  // called by Pageload(). Set reasonable BodyDivision height.
  var HeadingDivision = document.getElementById('HeadingDivision');
  var BodyDivision    = document.getElementById('BodyDivision');
  var footerHeight    = 25;
  var maxHeight       = 520;  // max list height

  var vh = getClientHeight();
  if (!(HeadingDivision && BodyDivision)) exit;

  vh = vh - HeadingDivision.clientHeight - footerHeight;
  vh = (vh > maxHeight) ? maxHeight : vh;
  BodyDivision.style.height = vh + 'px';
}

function ShowRegisterBtn(Visible) {
  var spRegBtn = document.getElementById('spRegBtn');
  var spNewReg = document.getElementById('spNewReg');

  if (Visible) {
    spRegBtn.innerHTML = spNewReg.innerHTML;
  }
  else {
    spRegBtn.innerHTML = "";
  }
}

function ParentSelect(UR,Name) {
  var visit = "       0";
  updateParent(Name,UR,visit);
}

function PatientSelect(UR, UPI, PersonID) {
  if (!isWhitespace(UR) && URExists(UR)) {  // UR exists
    var sPatName = "";
    var datArr = GetURData(UR);
    if (datArr != undefined) {
      var sTitle = trim(datArr[0]);
      var sSurname = trim(datArr[1]);
      var sFirstName = trim(datArr[2]);
      var sSecondName = trim(datArr[3]);

      sPatName = sTitle + " " + sFirstName + " " + sSecondName + " " + sSurname;
    }
    ParentSelect(UR,sPatName);  // select patient
  }
  else if (AltIdExists(UPI)) {  // check if UPI exists as Alternate I
    var arrPat = AlternateIdDataStr.split("|");  // returned from AltIdExists()
    var sAssocUR = arrPat[0];  // associated UR
    var sSurname = trim(arrPat[1]);
    var sFirstName = trim(arrPat[2]);
    var sTitle = trim(arrPat[3]);
    sPatName = sTitle + " " + sFirstName + " " + sSurname;

    if (confirm("The UPI exists for U/R " + trim(sAssocUR) + " " +
          trim(sSurname) + ", " + trim(sFirstName) + ".\n\n" +
          "A new U/R cannot be created for this UPI.\n\n" +
          "Select OK to use the existing U/R " + trim(sAssocUR) +
          " or Cancel to return to the patient search."))
    {
      ParentSelect(sAssocUR,sPatName); // select patient
    }
  }
  else {
    // UR or UPI does NOT exist in our system;
    // Register a new patient with default UPI data and create a new
    // Alternate ID (using the UPI) if parent screen allows New Registration.
    if (parent.parent.Registration != undefined) {
      RegisterNewUPI(UPI,PersonID);
    }
    else {  // parent screen does not allow for New Registration
      alert("Patient selected does not exist locally. No U/R Number.");
    }
  }

  return; 
}

function RegisterNewUPI(UPI, PersonID) {
  var pReg = parent.parent.Registration;

  pReg.upinumbr.value = UPI;  // create UPI as Alternate ID
  pReg.upinspid.value = PersonID;  // NSLHD Person ID
  pReg.submit();
}

function NewReg() {
  admDateTimeCookie();

  var pReg = parent.parent.Registration;
  var pSearch = parent.SearchOptions.search;

  pReg.srchsnam.value = pSearch.srchsnam.value;
  pReg.srchgnam.value = pSearch.srchgnam.value;
  pReg.srchmnam.value = pSearch.srchmnam.value;
  pReg.srchpsex.value = pSearch.srchpsex.value;
  pReg.srchpdob.value = pSearch.srchpdob.value;
  pReg.srchmedi.value = pSearch.srchmedi.value;

  pReg.submit();
}

function admDateTimeCookie() {
  if (parent.parent.AddForm != undefined &&
      parent.parent.AddForm.adttmcky != undefined) {
    SetCookie("admdatecookie", parent.parent.AddForm.bkrec004.value);
    SetCookie("admtimecookie", parent.parent.AddForm.bkrec005.value);
  }
}

</script>
</head>
%START.OF.PAGE
<body onload="PageLoad(event);">
%PATWEB69.01.011.010.1.patweb98.01.001

<table width=100% border=1>
<tr><td>
    <table width=100% bgcolor=#CCCCCC cellspacing=0 cellpadding=0 border=0>
    <tr>
      <td width=45%>&nbsp;
<!--
      <input type=button value="<< Previous" class="button"
       onclick='location.href="PATWEB90.01.002.011"'>
//-->
      </td>
      <td width=30%><span id=spRegBtn></span></td>
      <td>&nbsp;
        <span id=spNextBtn>
          <input type=button class="button" value="Next >>"
           onclick="parent.SearchOptions.SubmitNext('%PATWEB69.01.009');">
        </span>
      </td>
    </tr>
    </table>
</tr></td>
</table>

<form name=Registration method=get action=patweb89.pbl>
<input type=hidden name=reportno value=05>
<input type=hidden name=template value=001>
<input type=hidden name=srchsnam value="">
<input type=hidden name=srchgnam value="">
<input type=hidden name=srchpdob value="">
<input type=hidden name=srchpsex value="">
<input type=hidden name=upinumbr value="">
</form>

<form name=linkForm action=patweb98.pbl method=get>
<input type=hidden name=reportno value=1>
<input type=hidden name=template value=1>
<input type=hidden name=urnumber value="">
<input type=hidden name=admissno value="">
<input type=hidden name=upinumbr value="">
</form>

<span id=spNewReg style="display:none">
  <input type=button value="New Registration" class="Bigbutton"
   onclick="NewReg();">
</span>

<script type="text/javascript">
  if (parent.parent.Registration != undefined) {
    var p = parent.SearchOptions.search;
    if (!isWhitespace(p.srchsnam.value) ||
        !isWhitespace(p.srchgnam.value) ||
        !isWhitespace(p.srchpdob.value) ) {
      ShowRegisterBtn(true);
    }
  }

  if (isWhitespace("%PATWEB69.01.009")) {
    document.getElementById('spNextBtn').style.display = "none";
  }
</script>

