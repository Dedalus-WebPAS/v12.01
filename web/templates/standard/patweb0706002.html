<meta name="TemplateVersion" content="V12.01.00">
<meta name="TemplateHome"    content="standard">
<meta name="HelpFileName"    content="NoContextSet.html">
<meta name="CrossBrowser"    content="true">
<link rel="stylesheet" href="../html/postcode.css" type="text/css">
<script type="text/javascript" src="../js/AutoPostCode.js"></script>
<script type="text/javascript" src="../js/IBA_Category_C_.js"></script>
<script type="text/javascript" src="../js/patweb0706.js"></script>
<script type="text/javascript" src="../js/AddressSearch.js"></script>
<script type="text/javascript">

var savstate;
var savsuburb;
var savpcode;

function defaultValues(){
  p=document.AddForm
  p.pmcex007.value=trim(p.padd1.value);
  p.pmcex008.value=trim(p.padd2.value);
  p.pmcex009.value=trim(p.padd3.value);
  p.pmcex011.value=trim(p.ppost.value);
  p.pmcex012.value=trim(p.ptelep.value);
  checkOverseas();
  if (trim(p.pmcex011.value)!="8888") {
    p.pmcex010.value=trim(p.padd4.value);
  }
}
function setAddrLine4(theForm) {
  if (theForm.oseasflg.checked==1) {  // IS an overseas address
    AddressLine4H.innerHTML=OseasCountryH.innerHTML
    AddressLine4.innerHTML=OseasCountry.innerHTML

    if (trim(theForm.pmcex011.value)!="8888") {
      savpcode = theForm.pmcex011.value;
      savsuburb = theForm.pmcex009.value;
      savstate = theForm.pmcex010.value;
      theForm.pmcex009.value="";
      theForm.pmcex010.value="";
      theForm.pmcex011.value="8888";
      SetPostVars();
      LookupSuburb("8888")
    }
  } 
  else {  // NOT an overseas address
    AddressLine4H.innerHTML=AustStateH.innerHTML
    AddressLine4.innerHTML=AustState.innerHTML

    if (trim(theForm.pmcex011.value)=="8888") {
      theForm.pmcex009.value=savsuburb;
      theForm.pmcex010.value=savstate;
      theForm.pmcex011.value=savpcode;
      SetPostVars();
      if (!isWhitespace(theForm.pmcex009.value)) {
        LookupPostCode(theForm.pmcex009.value);
      }
    }
  }
  state = theForm.pmcex010;
}
function checkOverseas() {
  if (trim(AddForm.pmcex011.value)=="8888") {
    AddForm.oseasflg.checked=true;
  } else {
    AddForm.oseasflg.checked=false;
  }

  setAddrLine4(AddForm);

  CheckReadOnly();
}
function checkPostPRFA() {
  if (parent.document.getElementById('admissno') != undefined) {
    document.getElementById('admissno').value =
      parent.document.getElementById('admissno').value;
  }
  setPostPRFA(AddForm);
}
function setPostPRFA(theForm) {
  p=document.getElementById('admissno');
  if(!isWhitespace(p.value)) {
    if (theForm.pmcex002.value.substr(3,1)=="2") {
       PostPRFACheck.innerHTML=PostPRFA.innerHTML;
       document.getElementById('admitnum').innerHTML=p.value;
    } else {
       PostPRFACheck.innerHTML="";
       document.getElementById('admitnum').innerHTML="";
    }
  } else {
     PostPRFACheck.innerHTML="";
     document.getElementById('admitnum').innerHTML="";
  }
}
function SetPostVars() {
  suburb   = AddForm.pmcex009;
  state    = AddForm.pmcex010;
  postcode = AddForm.pmcex011;
}
function SubmitAddContact() {

  SetSendSMS();
  p=document.AddForm
  p.pmcex017.value="0";
  if(p.d_pmcex017.checked==true){
    p.pmcex017.value="1";
  }
  p.pmcex018.value="0";
  if(p.d_pmcex018.checked==true){
    p.pmcex018.value="1";
  }
  if (p.postprfa!=undefined){
    p.postprfa.value="0";
    if(p.postprfa.checked==true){
      checkxcom();
    }
  }
  if (((!isWhitespace(suburb.value)) &&
       (isWhitespace(postcode.value))) ||
      ((!isWhitespace(postcode.value)) &&
       (isWhitespace(suburb.value)))) { 
    alert("Invalid Suburb/Post Code Combination");
    return;
  }

  if (document.getElementById('ptcnuadv').value != "1" &&
      !CheckValPostCode()) { 
    return; 
  }

  ValidateContactTypeAdd(p.pmcex001,p.pmcex002,p.pmcex018,PostAddContact)
}
function PostAddContact() {
  f = document.AddForm;
  f.pmcex032.value = "";
  f.pmcex033.value = "";

  if (VariableNameExists('ShowContactLanguage') &&
      ShowContactLanguage == true) {
    i = f.pmcex002.selectedIndex;
    ind6 = f.pmcex002.options[i].value.substr(8,1);
    ind7 = f.pmcex002.options[i].value.substr(9,1);
    if (ind6 == 'L') {
      i = f.d_pmcex032.selectedIndex;
      if (i != -1) {
        f.pmcex032.value = f.d_pmcex032.options[i].value;
      }
      j = f.d_pmcex033.selectedIndex;
      if (j != -1) {
        f.pmcex033.value = f.d_pmcex033.options[j].value;
      }
    }
    else {
      if (ind6 == 'P') {
        patage = f.patage.value;
        ptage = trim(patage.substr(0,3));
        if (ptage < 18) {
          i = f.d_pmcex032.selectedIndex;
          if (i != -1) {
            f.pmcex032.value = f.d_pmcex032.options[i].value;
          }
          j = f.d_pmcex033.selectedIndex;
          if (j != -1) {
            f.pmcex033.value = f.d_pmcex033.options[j].value;
          }
        }
      }
    }
  }

  SubmitHidden(f);
}

function valPostCode(){
  if(isWhitespace(AddForm.pmcex009.value)){
   return;
  }
  UpCase(AddForm.pmcex009);

  if(trim(AddForm.pmcex011.value)!="8888"){
    LookupPostCode(AddForm.pmcex009.value);
  }
}
function checkxcom() {
checkInd=document.getElementById('admclaim').value.substr(3,5);
  if (checkInd.search(/(W|M|V|D)/g) >= 0) {
    if (document.getElementById('ptcnxcom').value!="1") {
      if (confirm("This is a compensable admission; do you want to change \n"+
                  "the Person Responsible for Account to Postal Address?")){
        p.postprfa.value="1";
      } else {
        p.postprfa.value="0";
      }
    }
  } else {
    p.postprfa.value="1";
  }
}
function displayStoreForward() {
  if (document.AddForm.ptcnuesf.value != "1") {
    MedNumTitleDIV.innerHTML="";
    MedNumFieldDIV.innerHTML="";
    DOBTitleDIV.innerHTML="";
    DOBFieldDIV.innerHTML="";
  }
}

//
// Functions called from AddressSearch.js
//
function InitAddressSearch() {
  // line 1 - 'pmcex007'
  // line 2 - 'pmcex008'
  // suburb - 'pmcex009'
  // state - 'pmcex010'
  // postcode - 'pmcex011'

  InitAddressSearchFields('trAddrSrch','pmcex007','pmcex008','pmcex009','pmcex010','pmcex011');
}
function ShowAddressSearch() {
  OpenAddressSearch('1',PopulateAddress,ClearSearchAddress);
}
function PopulateAddress(StreetLine, Suburb, State, Postcode) {
  LookupSuburb(Postcode);  // validate Postcode with our Lookup values
  if (SelectPC.length == 0) return;  // no match found

  LookupPostCode(Suburb);  // validate Suburb
  if (SelectPC.length == 0) return;  // no match found

  ToggleFieldReadOnly('pmcex007', true);
  ToggleFieldReadOnly('pmcex008', false);
  ToggleFieldReadOnly('pmcex009', true);
  ToggleFieldReadOnly('pmcex010', true);
  ToggleFieldReadOnly('pmcex011', true);

  SetFieldValue('pmcex007',StreetLine);
  SetFieldValue('pmcex008','');
  SetFieldValue('pmcex009',Suburb);
  SetFieldValue('pmcex010',State);
  SetFieldValue('pmcex011',Postcode);
}
function ClearSearchAddress() {
  ToggleFieldReadOnly('pmcex007', false);
  ToggleFieldReadOnly('pmcex008', false);
  ToggleFieldReadOnly('pmcex009', false);
  ToggleFieldReadOnly('pmcex010', false);
  ToggleFieldReadOnly('pmcex011', false);

  SetFieldValue('pmcex007','');
  SetFieldValue('pmcex008','');
  SetFieldValue('pmcex009','');
  SetFieldValue('pmcex010','');
  SetFieldValue('pmcex011','');
}
function ToggleSearchAddressFields(ReadOnly) {
  ToggleFieldReadOnly('pmcex007', ReadOnly);
  ToggleFieldReadOnly('pmcex008', ReadOnly);
  ToggleFieldReadOnly('pmcex009', ReadOnly);
  ToggleFieldReadOnly('pmcex010', ReadOnly);
  ToggleFieldReadOnly('pmcex011', ReadOnly);
}
function ToggleSearchAddress(Show) {
  ToggleSearchAddressRow('trAddrSrch', Show);
  ToggleSearchAddressFields(Show);
}
function ToggleOverseas() {
  if (document.getElementById('ptcnuadv').value == "1") {
    if (document.getElementById('oseasflg').checked) {  // Overseas address
      ToggleSearchAddress(false);  // hide 'Search Address' row
    }
    else {
      ToggleSearchAddress(true);  // show 'Search Address' row
      SetFieldValue('pmcex009','');
      SetFieldValue('pmcex010','');
      SetFieldValue('pmcex011','');
    }
  }

  setAddrLine4(AddForm);

  CheckReadOnly();
}
function CheckReadOnly() {
  if (document.getElementById('ptcnuadv').value != "1") return;

  if (document.getElementById('pmcex007').readOnly) {
    // preserve 'readonly' state of address fields
    ToggleSearchAddressFields(true);
  }
}
function ToggleSearchRow() {
  if (document.getElementById('ptcnuadv').value != "1") return;

  if (trim(document.getElementById('pmcex011').value) != "8888") {
    ToggleSearchAddressRow('trAddrSrch',true);  // show 'Search Address' row
  }
  else {
    ToggleSearchAddressRow('trAddrSrch',false);  // hide 'Search Address' row
  }
}
function ShowMainLanguageSpokenAtHome() {
  f = document.AddForm;
  f.d_pmcex033.selectedIndex = -1;

  document.getElementById('MainLangSpoken1').style.display = "none";
  document.getElementById('MainLangSpoken2').style.display = "none";
  RemoveClassName(f.d_pmcex032,"Mandatory");

  if (!VariableNameExists('ShowContactLanguage')) {return;}
  if (ShowContactLanguage == false) {return;}

  i = f.pmcex002.selectedIndex;
  ind6 = f.pmcex002.options[i].value.substr(8,1); 
  ind7 = f.pmcex002.options[i].value.substr(9,1);
  if (ind6 == 'L') {
    document.getElementById('MainLangSpoken1').style.display = "";
    document.getElementById('MainLangSpoken2').style.display = "";
    if (ind7 == 'M') {
      AddClassName(f.d_pmcex032,"Mandatory");
    }
  }
  else {
    if (ind6 == 'P') {
      patage = f.patage.value;
      ptage = trim(patage.substr(0,3));
      if (ptage < 18) {
        document.getElementById('MainLangSpoken1').style.display = "";
        document.getElementById('MainLangSpoken2').style.display = "";
        if (ind7 == 'M') {
          AddClassName(f.d_pmcex032,"Mandatory");
        }
      }
    }
  }
}
</script>
</head>

%START.OF.PAGE
<body onload="PageLoad(event);InitPostCodes();SetPostVars();
              setAddrLine4(AddForm);InactiveDate(AddForm);ShowSendSMS();
              displayStoreForward();InitAddressSearch();
              ShowMainLanguageSpokenAtHome();">
<span class=DFrameTitleBar>
<img align="right" alt="Exit" class="MenuIcon"
 src="../images/ExitIcon.gif" onclick="DFrameExitRefresh();">
Add Contact
</span>

<div id=PageBodySection>
<form name=AddForm method=post action=patweb07.pbl>
<input type=hidden name=reportno value="6">
<input type=hidden name=template value="002">
<input type=hidden name=urnumber value="%PATWEB07.06.003">
<input type=hidden name=admissno id=admissno value="%PATWEB07.06.081">
<input type=hidden name=admclaim id=admclaim value="%PATWEB07.06.326.3">
<input type=hidden name=updttype value="A">
<input type=hidden name=pmcex001 value="%PATWEB07.06.003">
<input type=hidden name=padd1 value="%PATWEB07.06.012">
<input type=hidden name=padd2 value="%PATWEB07.06.013">
<input type=hidden name=padd3 value="%PATWEB07.06.014">
<input type=hidden name=padd4 value="%PATWEB07.06.015">
<input type=hidden name=ppost value="%PATWEB07.06.016">
<input type=hidden name=ptelep value="%PATWEB07.06.017">
<input type=hidden name=ptcnxcom id=ptcnxcom 
value="%STANDARD.01.025.116.222.0.1">
<input type="hidden" name=ptcnsmsn id=ptcnsmsn
value="%STANDARD.01.025.120.243.0.1">
<input type=hidden name=pmcex022 id=pmcex022 value="">
<input type=hidden name=ptcnuesf id=ptcnuesf
value="%STANDARD.01.025.124.222.0.1">
<input type=hidden name=ptcnuadv id=ptcnuadv
value="%STANDARD.01.025.123.247.0.1">

<input type=hidden name=cat_tc value="tc">
<input type=hidden name=dummy value="">
<input type=hidden name=d_relation value="">
<input type=hidden name=pmpxlan1 id=pmpxlan1 value="%PATWEB07.06.143.1">
<input type=hidden name=pmpxlan2 id=pmpxlan2 value="%PATWEB07.06.144.1">
<input type=hidden name=patage id=patage value="%PATWEB07.06.021">
<input type=hidden name=pmcex032 id=pmcex032 value="">
<input type=hidden name=pmcex033 id=pmcex033 value="">

<table align=center width=95% border=0 cellpadding=1>
<tr><td class=DataLabel>Contact Type</td>
    <td><select name=pmcex002 id=pmcex002 class=Mandatory tabindex=1
         title="Contact Type" 
         onchange="ContactMandatory(AddForm);
                   checkPostPRFA();
                   CheckReadOnly();
                   setMandTitle(AddForm);
                   ShowMainLanguageSpokenAtHome();">
        <option></option>
        %PATWEB07.06.102.2
        </select></td>
    <td class=DataLabel>Relationship</td>
    <td><select name=pmcex015 id=pmcex015 title="Relationship" tabindex=20>
        <option value=""></option>
         %STANDARD.01.030
        </select></td>
    </tr>

<tr><td class=DataLabel>Title</td>
    <td><select title="Title" name=pmcex004 id=pmcex004 tabindex=2>
        <option></option>
        %STANDARD.01.029
        </select></td>
    <td class=DataLabel nowrap>Home Phone</td>
    <td><input type=text name=pmcex012 id=pmcex012 title="Home Phone" size=22
         maxlength=20 tabindex=21></td>
    </tr>

<tr><td class=DataLabel>Surname</td>
    <td><input type=text name=pmcex005 id=pmcex005 title="Surname"
         size=42 maxlength=35 tabindex=3
         onchange="UpCase(this);">
    </td>
    <td class=DataLabel>Work Phone</td>
    <td><input type=text name=pmcex013 id=pmcex013 title="Work Phone" size=22
         maxlength=20 tabindex=22></td>
    </tr>

<tr><td class=DataLabel>Given Name</td>
    <td><input type=text name=pmcex006 id=pmcex006 title="Given Name"
         size=42 maxlength=35 tabindex=4
         onchange="UpCase(this);">
    </td>
    <td class=DataLabel nowrap>Mobile Phone</td>
    <td><input type=text name=pmcex014 id=pmcex014 title="Mobile Phone" size=22
         maxlength=20 tabindex=23 class=MobilePhone></td>
    </tr>


<tr><td class=DataLabel nowrap>Second Given Name</td>
    <td><input type=text size=42 maxlength=35 tabindex=4
        name=pmcex019 id=pmcex019 title="Second Given Name"
        onchange="UpCase(this);"></td>
    <td class=DataLabel>Email</td>
    <td><input type=text name=pmcex016 id=pmcex016 title="Email" size=30
         maxlength=80 tabindex=24></td>
    </tr>

<tr id=trAddrSrch style="display:none">
    <td class=DataLabel nowrap>Search Address</td>
    <td><input type=text readonly size=42 tabindex="-1"
         style="cursor:pointer;text-align:center;"
         value="Click here to search for an address"
         title="Click here to search for an address"
         onclick="ShowAddressSearch();">
    </td>
</tr>

<tr><td class=DataLabel nowrap>Address</td>
    <td><input type=text size=42 maxlength=35 tabindex=5
        name=pmcex007 id=pmcex007 title="Address Line 1"
        onchange="UpCase(this);"></td>
    <td class=DataLabel>Send Letter
    <input type=hidden name=pmcex017 id=pmcex017></td>
    <td><input type=checkbox name=d_pmcex017 id=d_pmcex017 value="1" tabindex=25></td>
    </tr>

<tr><td class=DataLabel>&nbsp;</td>
    <td><input type=text size=42 maxlength=35 tabindex=6
        name=pmcex008 id=pmcex008 title="Address Line 2"
        onchange="UpCase(this);"></td>
    <td class=DataLabel><div id="SendSMSH"></div></td>
    <td><div id="SendSMS"></div></td>
    </tr>

<tr><td class=DataLabel>Suburb</td>
    <td><input type=text size=42 maxlength=35 title="Suburb"
       name=pmcex009 id=pmcex009 tabindex=7
       onchange="valPostCode();">
    </td>
    <td class=DataLabel>Inactive
    <input type=hidden name=pmcex018 id=pmcex018></td>
    <td><input type=checkbox name=d_pmcex018 id=d_pmcex018 value="1" tabindex=27
         onclick="InactiveDate(AddForm);"></td>
    </tr>

<tr><td><div id=AddressLine4H></div></td>
    <td><div id=AddressLine4></div></td>
    <td class=DataLabel nowrap>Date Inactive</td>
    <td><input type=text name=pmcex021 id=pmcex021 size=12 tabindex=28
     onblur="checkDate(this,'Date')" value=""
     class="PastDate" title="Date Inactive">
    <img src=../images/DateTimeStamp.gif class=Icon
     date=AddForm.pmcex021 time=null>
    <img src=../images/DateLookup.gif class=Icon
     date=AddForm.pmcex021>
    </td>
</tr>

<tr><td class=DataLabel>Post Code</td>
    <td><input type=text size=4 maxlength=4 tabindex=9
         name=pmcex011 id=pmcex011 title="Post Code"
         onchange="checkOverseas();LookupSuburb(this.value);ToggleSearchRow();">
        Overseas Address
        <input type=checkbox name=oseasflg id=oseasflg tabindex=-1
         onclick='ToggleOverseas();'>
    </td>
    <td colspan=2><div id=PostPRFACheck></div></td>
</tr>

<tr><td class=DataLabel><div id="MedNumTitleDIV">Medicare Number</div></td>
    <td><div id="MedNumFieldDIV">
        <input type=text size=10 maxlength=10 tabindex=9
         name=pmcex023 id=pmcex023 onchange="checkMedicare(pmcex023);" 
        title="Medicare Number" />
    <input type=text size=3 maxlength=2 tabindex=9
     name=pmcex024 id=pmcex024 title="Medicare Reference Number"
     onblur="checkIRN(pmcex024);">
    </div>
    </td>
</tr>

<tr><td class=DataLabel><div id="DOBTitleDIV">Date of Birth</div></td>
    <td><div id="DOBFieldDIV">
        <input type=text size=12 name=pmcex025 id=pmcex025 tabindex=9
         title="Date of Birth" class="PastDate"
         onblur="checkDate(this,'Date of Birth');" >
        <img src=../images/DateLookup.gif class=Icon
         date=AddForm.pmcex025> 
        </div>
    </td>
</tr>
<tr id=MainLangSpoken1><td class=DataLabel>Main Language Spoken at Home 1</td>
    <td><select name=d_pmcex032 id=d_pmcex032 tabindex=10
         title="Main Language Spoken at Home 1">
         <option></option>
          %PATWEB07.06.143.9.4
        </select>
    </td>
    <td></td>
    <td></td>
</tr>
<tr id=MainLangSpoken2><td class=DataLabel>Main Language Spoken at Home 2</td>
    <td><select name=d_pmcex033 id=d_pmcex033 tabindex=11
         title="Main Language Spoken at Home 2">
         <option></option>
          %PATWEB07.06.144.9.2
        </select>
    </td>
    <td></td>
    <td></td>
</tr>

<tr><td class=DataLabel>Comment</td></tr>
<tr><td colspan=5>
    <textarea rows=5 cols=50 name=pmcex027 id=pmcex027 title="Comment"
     style="overflow-y:hidden" tabindex=12
         onkeydown="ValidateKeyInput(this);" 
         onblur="TextareaBlurHandler(this);ValidateTextLimits(this);"
         wrap="hard"></textarea>
    </td>
</tr>

<tr><td colspan=4 align=center><br>
   <input type=button value="Add" class="button" tabindex=30 id="pat07add"
    onclick="tempDisable(this);SubmitAddContact();">&nbsp;
   <input type=button value="Copy Patients Address" class="Largebutton" 
    tabindex=31 onclick="defaultValues();">&nbsp;
   <input type=button value="Cancel" class="button" tabindex=31
    onclick="DFrameCloseRefresh();">
   </td></tr>
</tbody>
</table>
</form>
</div>

<span id=AustStateH style="display:none">
  State
</span>
<span id=AustState style="display:none">
  <input type=text size=42 maxlength=35 tabindex=8
   name=pmcex010 id=pmcex010 title="State" onchange="UpCase(this);">
</span>

<span id=OseasCountryH style="display:none">
  Country
</span>
<span id=OseasCountry style="display:none">
  <select name=pmcex010 id=pmcex010 tabindex=8 class="Mandatory"
   title="Country Address">
    <option></option>
    %PATWEB07.06.085.060
  </select>
</span>

<span id=PostPRFA style="display:none">
<table width=100% height=100% border=0 cellspacing=0 cellpadding=0>
    <tr><td class=DataLabel>Use as PRFA for this admission
    <p id="admitnum" style="display:inline;font-weight:bold;"></p>
    <input type=checkbox name=postprfa id=postprfa tabindex=-1>
    </td></tr>
</table>
</span>

<span id="ShowSendSMSH" style="display:none">
Send SMS
</span>

<span id="ShowSendSMS" style="display:none">
<input type=checkbox name="d_pmcex022" id="d_pmcex022" value=1
 tabindex=26 onclick="setMandatoryMobPho()">
</span>

<script type="text/javascript">
function CheckTextLimit(TextArea) {
  if (!LimitText(TextArea,250,250)) {
    TextArea.onblur = null;  // clear to prevent infinite loop with alerts

    window.setTimeout(function () {
      TextArea.onblur = function() {  // restore onblur handler
        ValidateEscapeChars(TextArea);
        ValidateTextAreaLimits(TextArea,250,250,40);
      }
    },100);
  }
}
</script>
