<meta name="TemplateVersion" content="V12.01.00">
<meta name="TemplateHome" content="standard">
<meta name="HelpFileName" content="NoContextSet.html">
<meta name="CrossBrowser" content="true">
<script type="text/javascript" src="../js/allweb02.js"></script>
<script type="text/javascript">
//------------------------------------------------------------
// Function : supFormactn  Post Update Delete Supervisory Formaction
//------------------------------------------------------------
function supFormactn(type) {
  if (document.UpdateForm.alref159!=undefined && type!="D") {
    if(!isWhitespace(UpdateForm.alref159.value) &&
       !isWhitespace(UpdateForm.alref090.value)) {
       if(SetDateYYYYMMDD(UpdateForm.alref090.value) >
          SetDateYYYYMMDD(UpdateForm.alref159.value)) {
          alert(UpdateForm.alref159.title + " must be after " +
          UpdateForm.alref090.title);
          return;
       }
    } 
  }

  //If Supervisor wants to update the referral date
  if(!isWhitespace(UpdateForm.alref019.value) && 
     !isWhitespace(UpdateForm.d_prefdate.value)) {
     var confMsg = true;
     var enteredDate = SetDateYYYYMMDD(UpdateForm.alref019.value);
     //Linked Referral - When Ref date entered is before the Master Ref date        
     if((enteredDate < UpdateForm.d_prefdate.value) &&
         (UpdateForm.d_alref083.value != "Yes" &&
          UpdateForm.alref083.checked == false)) { 
          confMsg = confirm( "Linked " + UpdateForm.alref019.title + 
          " is before the " + MasterReferralDescription + 
          " referral date.\nClick OK to continue. To quit, Click Cancel.");
     }
     //Master Referral - When Ref date entered is after the Linked Ref date       
     if((enteredDate > UpdateForm.d_prefdate.value) &&
         (UpdateForm.d_alref083.value = "Yes" &&
          UpdateForm.alref083.checked == true)) {
          confMsg = confirm("Master " + UpdateForm.alref019.title + 
          " is after the Linked referral date." +
          "\nClick OK to continue. To quit, Click Cancel." );
     }
     //if confirmation is false then halt the process
     if(!confMsg){ 
       return;   
     }
  } 

  document.UpdateForm.updatety.value=type;
  if (type=="R") {
    if (validateMandatory(UpdateForm)) {
       document.UpdateForm.submit(); 
    } 
    else {
       return;
    } 
  }
  else {
    if (type=="D") {
      ans=confirm("Are you sure you want to Delete ?")
      if (ans) { 
         linkurl="patweb98.pbl?reportno=01&template=001" +
              "&urnumber=" + UpdateForm.urnumber.value.replace(/ /g,"+"); 
         document.UpdateForm.redirect.value=linkurl;
         document.UpdateForm.nextpage.value="4";
         document.UpdateForm.submit();
      } 
    }
    else {
       document.UpdateForm.submit(); 
    } 
  }
}
function MandatoryAccepted() {
  if(isWhitespace(UpdateForm.alref159.value)) {
    UpdateForm.alref090.className="PastDate";
  } else {
    UpdateForm.alref090.className="Mandatory PastDate";
  }
}
function ShowFirstAppointmentBooked() {
  VINAH_Ref = (document.UpdateForm.deptIndi.value.substr(10,1));
  if ((VINAH_Ref == "S"  || VINAH_Ref == "O" || VINAH_Ref == "E" ||
       VINAH_Ref == "L") &&
       document.UpdateForm.alref083.checked==false ) {
    FirstApptBooked.innerHTML=ShowFirstApptBooked.innerHTML;
    MandatoryAccepted();
  } else {
    FirstApptBooked.innerHTML="";
  }
}
function ShowDelete() {
  if (document.UpdateForm.nodelete.value=="1") {
    ShowDeleteButton.style.display="none";
  }

}
function displayTypeOfReferral() {
  if (document.UpdateForm.deptIndi.value.substr(33,1)  == "2") {
    typeofreferraltitlespan.style.display="";
    typeofreferralfieldspan.style.display="";
    return;
  }
  if (document.UpdateForm.deptIndi.value.substr(33,1)  == "1") {
    typeofreferraltitlespan.style.display="";
    typeofreferralfieldspan.style.display="";
    document.UpdateForm.alref124.className="SelectBig Mandatory";
    return;
  }
}
function ExpiryDateWarning() {
  i=document.UpdateForm.alref124.selectedIndex;
  reftype=document.UpdateForm.alref124.options[i].value.substr(0,3);
  if(document.UpdateForm.d_alref124.value!=reftype){
    alert("Warning: The referral expiry date might need to be updated");
 }
}
function FilterCodes() {
  var p = document.UpdateForm;

  var indc3 = p.deptcode.value.substr(5,1);
  var indc4 = p.deptcode.value.substr(6,1);

  var bIsMH = (indc3 == "A" && indc4 == "M") ? true : false;

  if (bIsMH) {  // Mental Health Referral
    // Remove General codes
    filterCatCodeList(p.alref006,"2","G","1");  // Reason For Closure
    filterCatCodeList(p.alref072,"2","G","1");  // Referral To
  }
  else if (indc3 == "A") {  // General Referral
    // Remove Mental Health codes
    filterCatCodeList(p.alref006,"2","M","1");  // Reason For Closure
    filterCatCodeList(p.alref072,"2","M","1");  // Referral To
  }
}
</script>
</head>
%START.OF.PAGE
<body onload="PageLoad(event);ShowFirstAppointmentBooked();ShowDelete();
              displayTypeOfReferral();FilterCodes();">
<span class=DFrameTitleBar>
<img border=0 align=right src="../images/ExitIcon.gif" class=MenuIcon
 onclick="DFrameExit();">
 %ALLWEB02.02.125.0  Supervisor Referral Update </span>
<div id=PageBodySection> 
<form name=UpdateForm onsubmit='return validateMandatory(this)'
 action="allweb02.pbl" method=post style="margin:0">
<input type=hidden name=reportno value="2">
<input type=hidden name=updatety value="">
<input type=hidden name=urnumber value="%ALLWEB02.02.003">
<input type=hidden name=admissno value="%ALLWEB02.02.081">
<input type=hidden name=deptcode value="%ALLWEB02.02.125.3">
<input type=hidden name=redirect value="allweb02.pbl?reportno=2&template=3">
<input type=hidden name=alref036 value="">
<input type=hidden name=nextpage value="">
<input type=hidden name=override value="2">
<input type=hidden name=dummy>
<input type=hidden name=dummy>
<input type=hidden name=deptIndi value="%ALLWEB02.02.125.3">
<input type=hidden name=nodelete value="%ALLWEB02.02.261">
<input type=hidden name=d_alref124 value="%ALLWEB02.02.186.1">
<input type=hidden name=d_prefdate value="%ALLWEB02.02.282">
<input type=hidden name=d_alref083 value="%ALLWEB02.02.144">

<table align=center cellspacing=0 cellpadding=1 border=0 width=95%>
<tr><td class=DataLabel width=20%>Department Code</td>
    <td><input type=text value="%ALLWEB02.02.125.0"
          readonly class=Readonly></td>
    <td class=DataLabel>Entered by</td>
    <td><input type=text name=alref000 
         value="%ALLWEB02.02.163" readonly class=Readonly></td>
    </tr>

<tr><td class=DataLabel>Referral Date</td>
    <td class=DataField>
    <input type=text name=alref019 size=12 tabindex=1 value="%ALLWEB02.02.119"
     onblur="checkDate(this,'Date')"
     class= "Mandatory PastDate" title="Referral Date">
    <img src="../images/DateTimeStamp.gif" class=Icon date=UpdateForm.alref019
     time=null>
    <img src="../images/DateLookup.gif" class=Icon date=UpdateForm.alref019>
    </td>
    <td class=DataLabel>Referral Expiry Date</td>
    <td class=DataField>
    <input type=text name=alref125 size=12 tabindex=2 value="%ALLWEB02.02.187"
     onblur="checkDate(this,'Date')"
     title="Referral Expiry Date">
    <img src="../images/DateTimeStamp.gif" class=Icon date=UpdateForm.alref125
     time=null>
    <img src="../images/DateLookup.gif" class=Icon date=UpdateForm.alref125>
    </td>
    </tr>

<tr><td class=DataLabel>
    <script type="text/javascript">MRDescription()</script></td>
    <td><input type=checkbox name=alref083 
         onclick="ShowFirstAppointmentBooked();" value="1" tabindex=3>
    </td>
    <td class=DataLabel>
    <span id="typeofreferraltitlespan" style="display:none">
    Type of Referral
    </span>
    </td>
    <td>
    <span id="typeofreferralfieldspan" style="display:none">
    <select name=alref124 title="Type of Referral" tabindex=4
     onchange="ExpiryDateWarning();">
        <option></option>
         %ALLWEB02.02.186.2
        </select>
    </span>
    </td>
    </tr>
</table>

<div id=FirstApptBooked></div>
<div id=InsertClosure></div>

<table align=center cellspacing=0 cellpadding=1 border=0 width=95%>
<tr><td colspan=4 align=center><br>
   <input type=button value="Update" class=button tabindex=10 id=btnUpdate
    onclick="tempDisable(this);supFormactn('R');">

   <span id=ShowDeleteButton>
   <input type=button value="Delete" class=button tabindex=11 id=btnDelete
    onclick="tempDisable(this);supFormactn('D');">
   </span>

   <input type=button value="Cancel" class=button tabindex=12
    onclick="DFrameCloseRefresh();">
</td></tr>
</table>
</form>
</div>

<div id="ShowClosure" style="display:none;">
<table align=center cellspacing=0 cellpadding=2 border=0 width=95%>
    <tr>
      <td>Date Closed</td>
      <td colspan=3>
        <input type=text name=alref007 size=12 tabindex=6
         value="%ALLWEB02.02.107"
         class= "Mandatory PastDate" title="Date Closed"
         onblur="checkDate(this,'Date')">
        <img src="../images/DateLookup.gif" class=Icon date=UpdateForm.alref007>
        Time &nbsp;&nbsp;
        <input type=text name=alref008 class=Mandatory size=8 value="%ALLWEB02.02.108" title="Time">
        <a href='javascript:SetCurrentDateTime(null,UpdateForm.alref008)'>
        <img src="../images/DateTimeStamp.gif" class=Icon></a>
        <a href='javascript:TimeLookupFrame(UpdateForm.alref008)'>
        <img src="../images/TimeLookup.gif" class=Icon></a>
        </td>
    </tr>
    <tr>
      <td>%STANDARD.01.017.LL</td>
      <td><select name=alref006 class=Mandatory title="%STANDARD.01.017.LL">
           %ALLWEB02.02.106.2</select></td>
      <td>&nbsp;</td>
      <td>&nbsp;</td>
    </tr>
<tr><td class=DataLabel width=20%>%STANDARD.01.017.lG</td>
    <td><select name=alref072 class="Mandatory" tabindex=9 title="%STANDARD.01.017.lG">
        <option></option>
         %ALLWEB02.02.140.33.2
        </select></td>
    </tr>
</table>
</div>

<div id="ShowFirstApptBooked" style="display:none;">
<table align=center cellspacing=0 cellpadding=2 border=0 width=95%>
<tr><td class=DataLabel width=20%>First Appointment Booked</td>
    <td><input type=text name=alref159 size=12 tabindex=5
     onblur="checkDate(this,'Date');MandatoryAccepted();"
     value="%ALLWEB02.02.199.034"
     class="Date" title="First Appointment Booked Date">
    <img src="../images/DateTimeStamp.gif" class=Icon
     date=UpdateForm.alref159 time=null>
    <img src="../images/DateLookup.gif" class=Icon date=UpdateForm.alref159>
    </td></tr>

<tr><td class=DataLabel width=20%>Date Referral Accepted</td>
<td class=DataField> <input type=text name=alref090 size=12 tabindex=6
     onblur="checkDate(this,'Date')" value="%ALLWEB02.02.151"
     class="PastDate" title="Date Referral Accepted">
    <img src="../images/DateTimeStamp.gif" class=Icon
     date=UpdateForm.alref090 time=null>
    <img src="../images/DateLookup.gif" class=Icon date=UpdateForm.alref090>
    </td>
    </tr>
</table>
</div>


<script type="text/javascript">
//
 BulkBill="%ALLWEB02.02.136";
 if ( BulkBill == "Yes") {
   document.UpdateForm.alref036.value=1;
 }
 SACSRef="%ALLWEB02.02.144";
 if ( SACSRef == "Yes") {
   document.UpdateForm.alref083.checked=1;
 }
 Status="%ALLWEB02.02.103"
 if (Status=="Closed    "){
   InsertClosure.innerHTML=ShowClosure.innerHTML;

   RfC = "%ALLWEB02.02.106.1";
   for(i=0;i<document.UpdateForm.alref006.length; i++){
     if(document.UpdateForm.alref006[i]==RfC){
       document.UpdateForm.alref006.selectedIndex=i;
       break;
     }
   }
 } else {
   InsertClosure.innerHTML="";
 }
</script>
