<meta name="TemplateVersion" content="V12.01.00">
<meta name="TemplateHome" content="standard">
<meta name="HelpFileName" content="">
<meta name="CrossBrowser" content="true">
<script language="javascript" src="../js/allweb03.js"></script>
<script type="text/javascript">
function getDeptCodeFromQueryString()
{
 var dept = document.getElementById("deptcode");
 dept.value = getQueryString("deptcode");
}
function addOtherFactors()
{
  var mhcc = document.getElementById("alref032");
  var mhcd = document.getElementById("d_alref032");
  mhcc.value = mhcc.value.replace(/ /g,"");

  if(mhcc.value == "")
     return false;;

  var table = document.getElementById("otherFactorsTable");

  var tr = document.createElement("tr");
  var tdRemove = document.createElement("td");
  var tdCode = document.createElement("td");
  var tdDescription = document.createElement("td");

  var tdRemoveImage = document.createElement("img");
  var form = parent.document.getElementsByTagName("form");
  var obj = parent.document.createElement("input");

  if(allowMultipleSameDiagnosisCode("document","ofatr"+mhcc.value,mhcd.value,false))
  {
    tdRemoveImage.setAttribute("id","ofai_"+mhcc.value);
    tdRemoveImage.src="../images/DeleteIcon.gif";

    tdRemove.appendChild(tdRemoveImage);

    tdCode.setAttribute("width","100");
    tdCode.setAttribute("id","ofac"+mhcc.value);
    tdCode.innerHTML = mhcc.value;
    tdDescription.innerHTML = mhcd.value;
    tr.setAttribute("id","ofatr"+mhcc.value);
    tr.appendChild(tdRemove);
    tr.appendChild(tdCode);
    tr.appendChild(tdDescription);
    table.getElementsByTagName("TBODY")[0].appendChild(tr);

    obj.type="hidden";
    obj.name = "ofatr"+mhcc.value;
    obj.value = mhcc.value;

    if(form.length>1) {
      if(form[1].name=="InternalReferral") {
        form[1].appendChild(obj);
      } else {
        form[0].appendChild(obj);
      }
    } else {
      form[0].appendChild(obj);
    }

    //blind event handler
    tdRemoveImage.onclick = function()
    {
       var temp = document.getElementById(tr.id);
       table.getElementsByTagName("TBODY")[0].removeChild(temp);
       if(form.length>1) {
         if(form[1].name=="InternalReferral") {
           form[1].removeChild(obj);
         } else {
           form[0].removeChild(obj);
         }
       } else {
         form[0].removeChild(obj);
       }
    }
  }
}
function allowMultipleSameDiagnosisCode(temp,id,description,boolean)
{
  var obj = null;

  if(boolean !== true)
  {
      obj = document.getElementById(id);

      if(obj)
      {
        alert("Warning diagnosis already exist: "+
               id.replace(/ofatr/,"").replace(/ /g,"")+
               " "+description);

        return false;
      }
    }
  return true;
}

function sendOtherFactorsToParentFrame()
{
  renameOtherFactorCGI();
  setBtnOtherFactorsColor();
  DFrameExit();
}

function loadDiagnosis()
{
  var form = parent.document.getElementsByTagName("form");
  var hiddenElement = form[0].getElementsByTagName("input");
  if(form.length>1) {
    if(form[1].name=="InternalReferral") {
      hiddenElement = form[1].getElementsByTagName("input");
    }
  }

  var table = document.getElementById("otherFactorsTable");

  table.onclick = function(e)
  {
    if(!e)
    {
      e = event;
      e.target = e.srcElement;
    }
    if(e.target.nodeName.toLowerCase() == 'img')
    {
       removeObject(table,e.target);
    }
  }

  for(var i = 0; i < hiddenElement.length; i++)
  {
     if(hiddenElement[i].type == "hidden"
        && hiddenElement[i].name.match("ofat"))
     {
         var tr = document.createElement("tr");
         var tdRemove = document.createElement("td");
         var tdCode = document.createElement("td");
         var tdDescription = document.createElement("td");
         var tdRemoveImage = document.createElement("img");
         var desc= new Object();

         var deptcode = document.getElementById("deptcode");

         if(allowMultipleSameDiagnosisCode("document",hiddenElement[i].id,
                                           "N/A ",false))
         {
           tdRemoveImage.setAttribute("id",hiddenElement[i].id);
           tdRemoveImage.src="../images/DeleteIcon.gif";
           tdRemove.appendChild(tdRemoveImage);

           tdCode.setAttribute("width","100");
           tdCode.setAttribute("id",hiddenElement[i].id);
           tdCode.innerHTML = hiddenElement[i].value;

           validateAHProb2(deptcode,hiddenElement[i],desc);

           tdDescription.innerHTML = desc.value;
           tr.setAttribute("id",hiddenElement[i].id);

           tr.appendChild(tdRemove);
           tr.appendChild(tdCode);
           tr.appendChild(tdDescription);

           table.getElementsByTagName("TBODY")[0].appendChild(tr);
         }
     }
  }
}


function removeObject(table,obj)
{
  var temp;
  var obj2;

  temp = obj.id.replace(/ofai/,"ofatr");
  obj2 = document.getElementById(temp);

  var form =  parent.document.getElementsByTagName("form");
  var hiddenInputs = form[0].getElementsByTagName("input");
  if(form.length>1) {
    if(form[1].name=="InternalReferral") {
      hiddenInputs = form[1].getElementsByTagName("input");
    }
  }

  for(var i = 0; i < hiddenInputs.length; i++)
  {
    if(hiddenInputs[i].type == "hidden" && hiddenInputs[i].name == temp)
    {
       if(form.length>1) {
         if(form[1].name=="InternalReferral") {
           form[1].removeChild(hiddenInputs[i]);
         } else {
           form[0].removeChild(hiddenInputs[i]);
         }
       } else {
           form[0].removeChild(hiddenInputs[i]);
       }
       table.getElementsByTagName("TBODY")[0].removeChild(obj2);
    }
  }
}

function setBtnOtherFactorsColor()
{
  var form = parent.document.getElementsByTagName("form");
  var element = form[0].getElementsByTagName("input");
  if(form.length>1) {
    if(form[1].name=="InternalReferral") {
      element = form[1].getElementsByTagName("input");
    }
  }

  var button = parent.document.getElementById("btnOtherFactors");

  for(var i = 0; i < element.length; i++)
  {
    if(element[i].type == "hidden" && element[i].name.match("ofatr"))
    {
      button.style.color = "red";
      return;;
    }
  }

  button.style.color = "black";
}

function renameOtherFactorCGI()
{
  var form = parent.document.getElementsByTagName("form");
  var element = form[0].getElementsByTagName("input");
  if(form.length>1) {
    if(form[1].name=="InternalReferral") {
      element = form[1].getElementsByTagName("input");
    }
  }
  var j = 100;

  for(var i = 0; i < element.length; i++)
  {
    if(element[i].type == "hidden" && element[i].name.match("ofatr"))
    {
       element[i].name = "ofatr"+j;
       element[i].id = "ofatr"+j;
       j++;
    }
  }
}
</script>
</head>

%START.OF.PAGE
<body onload="PageLoad(event);getDeptCodeFromQueryString();loadDiagnosis();">
<span class=DFrameTitleBar>
<img class=Icon border=0 align=right src=../images/ExitIcon.gif 
 onclick="sendOtherFactorsToParentFrame();">
Other Factors Affecting Health
</span>
<div id=PageBodySection>
<form id=UpdateForm name=UpdateForm action="allweb03.pbl" method=post
 onsubmit='return validateMandatory(this)'>
<input type=hidden name=reportno value=1>
<input type=hidden name=template value=001>
<input type=hidden name=nextpage value=0>
<input type=hidden name=redirect value="">
<input type=hidden name=DEFDIRCT value='%ALLWEB03.01.001.allweb03.01.001'>
<input type=hidden name=urnumber value='%ALLWEB03.01.003'>
<input type=hidden name=admissno value='%ALLWEB03.01.081'>
<input type=hidden name=alenc001 value='%ALLWEB03.01.081'>
<input type=hidden name=updatety value="A">
<input type=hidden name=dummyret value="">
<input type=hidden name=dummysit value="">
<input type=hidden name=dummydat value="">
<input type=hidden name=dummy1>
<input type=hidden name=mbs value="M">
<input type=hidden name=alenc107 value=" ">
<input type=hidden name=alenc108 value=" ">
<input type=hidden name=billablef value='%ALLWEB03.01.302'>
<input type=hidden name=alreuyn4 value="%ALLWEB03.01.144">
<input type=hidden name=alredrec value="%ALLWEB03.01.139">
<input type=hidden name=lnktosac value="%ALLWEB03.01.312">
<input type="hidden" name="deptcode" id="deptcode" value="" />
<table align=center cellspacing=0 cellpadding=1 border=1 width=100%>
<tr>
  <td class="HeadingCell">Code</td>
  <td class="HeadingCell">Description</td>
</tr>
<tr>
  <td class="DataLabel">
    <input type="text" id=alref032 name="alref032" class="Mandatory" size="10"
           onblur="validateAHProb2(deptcode,alref032,d_alref032);"/>
  </td>
  <td class="DataLabel">
    <input type="text" name="d_alref032" class="ReadOnly" readonly="true" 
    id=d_alref032 size="50"/>
    <img src="../images/SearchIcon.gif" class="Icon" 
         onclick="AHProbSearchFrame2(deptcode,alref032,d_alref032);" />
    <img src="../images/erase.gif" class="Icon" 
         onclick="clrFields(alref032,d_alref032);"/>
    <input type="button" class="button" value="Add" 
           onclick="addOtherFactors();" />
    <input type="button" class="button" value="Ok" 
           onclick="sendOtherFactorsToParentFrame();" />
  </td>
</tr>
</table>
<br />
<div style="height:300px;overflow:auto;">
<table id="otherFactorsTable" border="1" width="99%">
<tr><td class="HeadingCell" width="50">Remove</td>
<td class="HeadingCell">Code</td>
<td class="HeadingCell">Description</td>
</tr>
</table>
</div>
</form>
</div>
