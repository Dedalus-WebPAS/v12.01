<meta name="TemplateVersion" content="V12.01.00">
<meta name="TemplateHome" content="standard">
<meta name="HelpFileName" content="">
<meta name="CrossBrowser" content="true">
<script language="javascript" src="../js/allweb03.js"></script>
<script type="text/javascript">

function AddEncounter(theForm){

  SetRedirect();
  theForm.target="PopUpFrame1";

  if(validateMandatory(theForm)) {
//
    if(document.UpdateForm.checkbx2.checked==true) {
      if(!CheckFutureBookings(UpdateForm.admissno,UpdateForm.alenc005)) {
        return;
      }
    }
//
     if(document.UpdateForm.checkappt.value==0 &&
        document.UpdateForm.checkbx2.checked==true) {
        CheckLinkedBookings(UpdateForm.admissno,UpdateForm.urnumber,UpdateForm.checkappt);
        if(document.UpdateForm.checkappt.value==0) {
           return;
        }
     }
     theForm.submit(); 
  }
}
function ToggleCombo(){

  if(UpdateForm.checkbx2.checked==false){
     UpdateForm.checkbx1.disabled=false;
     UpdateForm.alref006.className=" ";
  }
  else{
     UpdateForm.checkbx1.disabled=true; // disable Waiting List
     UpdateForm.checkbx1.checked=false;
     UpdateForm.alref006.className="Mandatory SelectBig";
  }
}

function ShowHideBill(){
  SetRedirect();
  CompensationCode=UpdateForm.alenc115.value.substr(13,1);
  PatientType=UpdateForm.alenc009.value.substr(4,1);
  isBillable=UpdateForm.billablef.value;

  if(isBillable==1&&(PatientType==1 || PatientType==2) &&
    (CompensationCode=="C" || CompensationCode=="E")){
     Units.style.display=""
     Units.innerHTML=BillableUnits.innerHTML; 
  }
  else{
     Units.style.display="none"
     Units.innerHTML="";
  }

  if(CompensationCode=="E") {
     UpdateForm.itemn001.className="Mandatory"; 
  }
  else {
     UpdateForm.itemn001.className="";
  }
}

function SetRedirect() {

  UpdateForm.nextpage.value="6";
  UpdateForm.redirect.value=UpdateForm.DEFDIRCT.value;
  PatientType=UpdateForm.alenc009.value.substr(4,1);
  isBillable=UpdateForm.billablef.value;

  if(isBillable==1&&(PatientType==1 || PatientType==2)) {
     checkInd=document.UpdateForm.alenc115.value.substr(3,5);
     if(checkInd.search(/W/g) >= 0) {
       UpdateForm.nextpage.value="5";
       UpdateForm.redirect.value="allweb03.pbl?reportno=1&template=5";
     } 
     else if(checkInd.search(/V/g) >= 0) {
       UpdateForm.nextpage.value="5";
       UpdateForm.redirect.value="allweb03.pbl?reportno=1&template=6";
     } 
     else if(checkInd.search(/M/g) >= 0) {
       UpdateForm.nextpage.value="5";
       UpdateForm.redirect.value="allweb03.pbl?reportno=1&template=4";
     }
  }
}

function PackComments(){
  UpdateForm.alenc107.value=UpdateForm.comments.value.substring(0,80);
  UpdateForm.alenc108.value=UpdateForm.comments.value.substring(80,160);
}

function ShowHideWaitingList(status){
  if(status==0)
     Wait.style.display='';
  else
     Wait.style.display='none';
}
//
function ShowVACS() {

  i=document.UpdateForm.alenc010.selectedIndex;
  VacsFlag=document.UpdateForm.alenc010.options[i].value.substring(6,7);
  LinkedHeading.innerHTML=DisplayLinkedHeading.innerHTML;
  Linked.innerHTML=DisplayLinked.innerHTML;

  if(!isWhitespace(document.UpdateForm.alenc008.value)) {
     LinkedHeading.innerHTML=DisplayLinkedHeading.innerHTML;
     Linked.innerHTML=ReadOnlyLinked.innerHTML;
  }
  if(VacsFlag==0) {
     Vacs.innerHTML="";
     Vacs.style.display="none";
     Activity.style.display="";
     Activity.innerHTML=DisplayActivity.innerHTML;
     Items.innerHTML="";
     Items.style.display="none";
     Units.innerHTML="";
     Units.style.display="none";
  } 
  else {
     Vacs.style.display="";
     Vacs.innerHTML=DisplayVacs.innerHTML;
     FilterClaimType(document.UpdateForm.alenc115);
     Activity.innerHTML="";
     Activity.style.display="none";
     Items.innerHTML=DisplayItems.innerHTML;
     Items.style.display="";
     ShowHideBill();      
  }
}

function checkPriority() {
  var p = document.UpdateForm;

  var indc3 = p.deptcode.value.substr(5,1);
  var indc4 = p.deptcode.value.substr(6,1);

  var bIsMH = (indc3 == "A" && indc4 == "M") ? true : false;

  var rejGenRef = ( p.d_alref027_code.value.substr(13,1) == "G") ? true : false;
  var rejMenHlt = ( p.d_alref027_code.value.substr(13,1) == "M") ? true : false;
  var rejGenMen = ( p.d_alref027_code.value.substr(13,1) == "A") ? true : false;

  if (rejMenHlt && bIsMH) {  // Mental Health Referral
    // Remove Mental Health codes
    alert("Referral Priority Code = " +  trim(p.d_alref027_desc.value) +
            "\nPlease change priority before closing the referral");
     document.UpdateForm.checkbx2.checked = false;
  }
  else if (rejGenRef && !bIsMH) {  // General Referral
   // Remove General codes
   alert("Referral Priority Code = " +  trim(p.d_alref027_desc.value) +
            "\nPlease change priority before closing the referral");
   document.UpdateForm.checkbx2.checked = false;
  }
  else if (rejGenMen) {  // General or Mental
    // Remove Mental Health OR General codes
   alert("Referral Priority Code = " +  trim(p.d_alref027_desc.value) +
            "\nPlease change priority before closing the referral");
   document.UpdateForm.checkbx2.checked = false;
  }
}
//
</script>
</head>

%START.OF.PAGE
<body onload="PageLoad(event);ShowVACS();
      ShowHideWaitingList(%ALLWEB03.01.303);
      setUserDoc(UpdateForm.deptcode,UpdateForm.d_websecdoc,
      UpdateForm.alenc004,UpdateForm.SProvider,UpdateForm.d_websechcp);">
<span class=DFrameTitleBar>
<img border=0 align=right src=../images/ExitIcon.gif onclick=DFrameExit()>
Add Contact for %ALLWEB03.01.125.0
</span>

<div id=PageBodySection>
<form name=UpdateForm action="allweb03.pbl" method=post
 onsubmit='return validateMandatory(this)'>
<input type=hidden name=reportno value=1>
<input type=hidden name=template value=001>
<input type=hidden name=nextpage value=0>
<input type=hidden name=redirect value="">
<input type=hidden name=DEFDIRCT value='%ALLWEB03.01.001.allweb03.01.001'>
<input type=hidden name=urnumber value='%ALLWEB03.01.003'>
<input type=hidden name=admissno value='%ALLWEB03.01.081'>
<input type=hidden name=alenc001 value='%ALLWEB03.01.081'>
<input type=hidden name=updatety value="A">
<input type=hidden id=dummyret name=dummyret value="">
<input type=hidden id=dummysit name=dummysit value="">
<input type=hidden id=dummydat name=dummydat value="">
<input type=hidden name=dummy1>
<input type=hidden id=mbs name=mbs value="M">
<input type=hidden name=alenc107 value=" ">
<input type=hidden name=alenc108 value=" ">
<input type=hidden name=billablef value='%ALLWEB03.01.302'>
<input type=hidden name=checkappt value="0">

<input type=hidden name=deptcode value="%ALLWEB03.01.125.3">
<input type=hidden name=d_alref027_code value="%ALLWEB03.01.127.3">
<input type=hidden name=d_alref027_desc value="%ALLWEB03.01.127.0">
<input type=hidden name=d_websecdoc id=d_websecdoc value="%STANDARD.01.010">
<input type=hidden name=d_websechcp id=d_websechcp value="%STANDARD.01.046">

<table align=center cellspacing=0 cellpadding=1 border=0 width=95%>
<tr><td class=DataLabel width=15%>Contact Date</td>
    <td class=DataField width=40%>
  <input type=text name=alenc005 value='%STANDARD.01.015' title="Date"
  class='PastDate Mandatory' Size=9 onblur="checkDate(this,'Date')">

    <img src=../images/DateLookup.gif class="Icon"
     onclick="DateLookupFrame(UpdateForm.alenc005);">

    Time
    <input type=text size=8 class=Mandatory title="Time"
     name=alenc006 value='%STANDARD.01.016'>
    <a href='javascript:SetCurrentDateTime(null,UpdateForm.alenc006)'>
    <img src=../images/DateTimeStamp.gif class="Icon"></a>
    <a href='javascript:TimeLookupFrame(UpdateForm.alenc006)'>
    <img src=../images/TimeLookup.gif class="Icon"></a>
   </td>
    <td class=DataLabel width=10%>Entered by</td>
    <td><input type=text name=userid value="%ALLWEB03.01.168"
           class=ReadOnly readonly></td></tr>

<tr><td class=DataLabel width=15%>Health Care Provider</td>
    <td colspan=3>
    <input type=text name=alenc004 size=10 maxlength=10 class=Mandatory
     onblur="ValidateHCP(18,13,UpdateForm.alenc004,UpdateForm.SProvider);" 
     title="Health Care Provider" id=alenc004
     value="%ALLWEB03.01.138.1">
    <input type=text name=SProvider size=24 class=Readonly readonly
      title="Health Care Provider" value="%ALLWEB03.01.138.0"
      id=SProvider>

    <img src=../images/SearchIcon.gif class=Icon
     onclick=HCPSearchFrame(alenc004,SProvider,4) >
    <img src="../images/ClearIcon.gif" class=Icon
     onclick="clrFields(UpdateForm.alenc004,UpdateForm.SProvider);">
    <td></tr>

<tr><td class=DataLabel width=15%>Occasion of Service</td>
    <td><select class="Mandatory SelectBig" name=alenc010 
         title="Occasion of Service" onchange="ShowVACS();">
    <option></option>
     %ALLWEB03.01.210.2.0
    </select></td>

    <td><div id=LinkedHeading></div></td>
    <td><div id=Linked></div></td>

</table>

<div id=Vacs></div>
<div id=Activity></div>
<div id="Units"></div>
<div id=Items></div>

<div id="Wait" style="display:none;">
<table align=center cellspacing=0 cellpadding=1 border=0 width=95%>
<tr><td class=DataLabel width=15%>Stay as Waiting Referral</td>
    <td class=DataField>
    <input type=checkbox name=checkbx1 value="1"></td>
    <td></td>
    <td></td>
    </tr>
</table>
</div>

<table align=center cellspacing=0 cellpadding=1 border=0 width=95%>
<tr><td class=DataLabel width=15%>Last Contact</td>
    <td class=DataField colspan=3>
    <input type=checkbox name=checkbx2 value="1" 
     onclick="checkPriority(); ToggleCombo();">
    </td></tr>

<tr><td class=DataLabel width=15%>Reason for Closure </td>
    <td class=DataField colspan=3>
    <select  name=alref006 title="Reason For Closure" class="">
    <option></option>
    %STANDARD.01.007.LL
    </select></td></tr>

<tr><td class=DataLabel>Event Program</td>
    <td class=DataField><select class="SelectBig" name=alenc079
       title="Event Program">
      <option></option>
      %ALLWEB03.01.199.016.2
      </select></td></tr>

<tr valign=top><td class=DataLabel width=15%>Comments</td>
    <td class=DataField colspan=3>
    <textarea rows=3 cols=60 onblur="PackComments();" name=comments
     onkeydown="LimitText(this,3,160);"></textarea>
    </td></tr>
</table>

<div id="HCPcheckbox">
<table align=center cellspacing=0 cellpadding=1 border=0 width=95%>
<tr><td class=DataLabel width=15%>Additional HCP</td>
    <td><input type=checkbox name=addithcp value="1"
         onclick="CheckUpdHCP();"></td></tr>
</table>
</div>

<div id=AdditionalHCP></div>
<table align=center cellspacing=0 cellpadding=1 border=0 width=95%>

<tr><td colspan=4 align=center><br>
    <input type=button name=formactn value="Add" class="button" id=all03sub
     onclick="tempDisable(this);AddEncounter(UpdateForm);">
    <input type=button Value="Cancel" class="button"
     onclick="DFrameClose();">
    </td></tr>
</table>
</form>
</div>

<!-- start of spans -->
<span id="DisplayVacs" style="display:none;">
<table align=center cellspacing=0 cellpadding=1 border=0 width=95%>
<tr><td class=DataLabel width=15%>Clinic Type</td>
    <td class=DataField><select class="SelectBig Mandatory" name=alenc003
     title="Clinic Type">
    <option></option>
    %ALLWEB03.01.308
    </select></td></tr>

<tr><td class=DataLabel width=15%>Patient Type</td>
    <td><select class="Mandatory SelectBig" name=alenc009 title=" Patient Type"
        onchange="ShowHideBill();">
        <option></option>
        %ALLWEB03.01.209.2
        </select></td></tr>

<tr><td class=DataLabel width=15%>%STANDARD.01.017.CL</td>
    <td><select class="Mandatory SelectBig"
         name=alenc115  title="%STANDARD.01.017.CL"
         onchange="ShowHideBill();">
    <option></option>
    %ALLWEB03.01.135.2
    </select></td></tr>
</table>

<table align=center cellspacing=0 cellpadding=1 border=0 width=95%>
<tr><td class=DataLabel width=15%>Direct Units</td>
    <td class=DataField width=40%>
    <input type=text size=12 maxsize=5 name=alenc011 title="Direct Units" min=0
    class=Mandatory onblur="checkInteger(this,this.title);" maxlength="6">
    </td>
    <td class=DataLabel width=10%>Indirect Units</td>
    <td class=DataField>
    <input type=text size=12 maxsize=5 name=alenc013 title="Indirect Units" 
     min=0
     onblur="checkInteger(this,this.title);"></td></tr>
</table>
</span>

<span id="DisplayActivity" style="display:none;">
<table align=center cellspacing=0 cellpadding=1 border=0 width=95%>
  <tr>
    <td class=DataLabel width=15%>Related Activity</td>
    <td class=DataField width=40%>
      <input type=hidden name=alenc009 value="">
      <select class="SelectBig" name=alenc047 title="Related Activity">
      <option></option> 
      %ALLWEB03.01.247. 1.2
      </select>
    </td>
    <td class=DataLabel width=10%>Indirect Units</td>
    <td class=DataField>
      <input type=text size=12 maxsize=5 name=alenc013 title="Indirect Units"
       min=0 onblur="checkInteger(this,this.title);">
    </td>
  </tr>
</table>
</span>

<span id="DisplayItems" style="display:none;">
<table align=center cellspacing=0 cellpadding=1 border=0 width=95%>
<tr><td class=DataLabel width=15%>Item Code 1</td>
    <td class=DataField width=40% >
    <input type=text size=10 name=itemn001 title="Item Code 1"
     onblur="validatePMBS(UpdateForm.itemn001,UpdateForm.dummy);">
    <input type=text size=20 name=dummy value="" readonly class=Readonly>
    <img src=../images/SearchIcon.gif class=Icon
     onclick='PriMbsSearchFrame(UpdateForm.dummyret,UpdateForm.itemn001,
              UpdateForm.dummysit,UpdateForm.dummyret,
              UpdateForm.dummy,UpdateForm.mbs);'>
    <img src="../images/ClearIcon.gif" class=Icon
     onclick="clrFields(UpdateForm.itemn001,UpdateForm.dummy);">
     </td>
    <td class=DataLabel width=10%>Item Code 2</td>
    <td class=DataField>
    <input type=text size=10 name=itemn002 title="Item Code 2"
     onblur="validatePMBS(UpdateForm.itemn002,UpdateForm.dummy2);">
    <input type=text size=20 name=dummy2 value="" readonly class=Readonly>
    <img src=../images/SearchIcon.gif class=Icon
     onclick='PriMbsSearchFrame(UpdateForm.dummyret,UpdateForm.itemn002,
              UpdateForm.dummysit,UpdateForm.dummyret,
              UpdateForm.dummy2,UpdateForm.mbs);'>
    <img src="../images/ClearIcon.gif" class=Icon
     onclick="clrFields(UpdateForm.itemn002,UpdateForm.dummy2);">
    </td></tr>

<tr><td class=DataLabel width=15%>Item Code 3</td>
    <td class=DataField>
    <input type=text size=10 name=itemn003 title="Item Code 3"
     onblur="validatePMBS(UpdateForm.itemn003,UpdateForm.dummy3);">
    <input type=text size=20 name=dummy3 value="" readonly class=Readonly>
    <img src=../images/SearchIcon.gif class=Icon
    onclick='PriMbsSearchFrame(UpdateForm.dummyret,UpdateForm.itemn003,
             UpdateForm.dummysit,UpdateForm.dummyret,
             UpdateForm.dummy3,UpdateForm.mbs);'>
    <img src="../images/ClearIcon.gif" class=Icon
     onclick="clrFields(UpdateForm.itemn003,UpdateForm.dummy3);">
    </td>
    <td class=DataLabel width=10%>Item Code 4</td>
    <td class=DataField>
    <input type=text size=10 name=itemn004 title="Item Code 4"
     onblur="validatePMBS(UpdateForm.itemn004,UpdateForm.dummy4);">
    <input type=text size=20 name=dummy4 value="" readonly class=Readonly>
    <img src=../images/SearchIcon.gif class=Icon
    onclick='PriMbsSearchFrame(UpdateForm.dummyret,UpdateForm.itemn004,
             UpdateForm.dummysit,UpdateForm.dummyret,
             UpdateForm.dummy4,UpdateForm.mbs);'>
    <img src="../images/ClearIcon.gif" class=Icon
     onclick="clrFields(UpdateForm.itemn004,UpdateForm.dummy4);">
    </td></tr>

<tr><td class=DataLabel width=15%>Item Code 5</td>
    <td class=DataField>
    <input type=text size=10 name=itemn005 title="Item Code 5"
     onblur="validatePMBS(UpdateForm.itemn005,UpdateForm.dummy5);">
    <input type=text size=20 name=dummy5 value="" readonly class=Readonly>
    <img src=../images/SearchIcon.gif class=Icon
    onclick='PriMbsSearchFrame(UpdateForm.dummyret,UpdateForm.itemn005,
             UpdateForm.dummysit,UpdateForm.dummyret,
             UpdateForm.dummy5,UpdateForm.mbs);'>
    <img src="../images/ClearIcon.gif" class=Icon
     onclick="clrFields(UpdateForm.itemn005,UpdateForm.dummy5);">
    </td>
    <td class=DataLabel width=10%>Item Code 6</td>
    <td class=DataField>
    <input type=text size=10 name=itemn006 title="Item Code 4"
     onblur="validatePMBS(UpdateForm.itemn006,UpdateForm.dummy6);">
    <input type=text size=20 name=dummy6 value="" readonly class=Readonly>
    <img src=../images/SearchIcon.gif class=Icon
    onclick='PriMbsSearchFrame(UpdateForm.dummyret,UpdateForm.itemn006,
             UpdateForm.dummysit,UpdateForm.dummyret,
             UpdateForm.dummy6,UpdateForm.mbs);'>
    <img src="../images/ClearIcon.gif" class=Icon
     onclick="clrFields(UpdateForm.itemn006,UpdateForm.dummy6);">
    </td></tr>
</table>
</span>

<span id="BillableUnits" style="display:none;">
<table align=center cellspacing=0 cellpadding=1 border=0 width=95%>
<tr><td class=DataLabel width=15%>Direct Billable Units</td>
    <td class=DataField width=40%>
    <input type=text size=12 name=alenc012 title="Direct Billable Units" min=0
     onblur="checkInteger(this,this.title);"></td>
    <td class=DataLabel width=10%>Indirect Billable Units</td>
    <td class=DataLable>
    <input type=text size=12 title="Indirect Billable Units" min=0
    onblur="checkInteger(this,this.title);" name=alenc014>
    </td></tr>
    
<tr><td class=DataLabel width=15%>Bulk Billing Code</td>
    <td DataField>
    <select name=alenc015 class="SelectBig" title="Bulk Billing Code">
    <option></option>
    %ALLWEB03.01.215.2
    </select></td></tr>
</table>
</span>

<span id="DisplayLinkedHeading" style="display:none;">
 Linked Visit
</span>
<span id="ReadOnlyLinked" style="display:none;">
    <input type=text size=10 name=alenc008 class="Readonly JustifyRight"
     maxlength=8 value="%ALLWEB03.01.305" readonly>
</span>
<span id="DisplayLinked" style="display:none;">
    <input type=text size=10 maxlength=8 name=alenc008 value="%ALLWEB03.01.305"
     class="JustifyRight" onblur="justifyRight(this);
     ValidateVisit(UpdateForm.alenc008,UpdateForm.urnumber,
                   UpdateForm.dummy1);">
    <img src=../images/SearchIcon.gif class=Icon
    onclick="VisitSearchFrame(UpdateForm.urnumber,UpdateForm.alenc008);">
</span>

<span id="ShowAdditionalHCP" style="display:none;">
<table align=center cellspacing=0 cellpadding=1 border=0 width=95%>
<tr><td class=DataLabel width=15%>Additional HCP 1</td>
    <td><input type=text name=alenc025 size=10 maxlength=10
         title="Additional HCP 1"
         onblur="ValidateHCP(18,0,UpdateForm.alenc025,UpdateForm.d_alenc025);">
        <input type=text name=d_alenc025 size=20 class=Readonly readonly
         title="Additional HCP 1">
        <img src=../images/SearchIcon.gif class=Icon
         onclick="HCPSearchFrame(UpdateForm.alenc025,UpdateForm.d_alenc025,0);">
        <img src="../images/ClearIcon.gif" class=Icon
         onclick="clrFields(UpdateForm.alenc025,UpdateForm.d_alenc025);">
    </td>
    <td class=DataLabel width=15%>Additional HCP 2</td>
    <td><input type=text name=alenc026 size=10 maxlength=10
         title="Additional HCP 2"
         onblur="ValidateHCP(18,0,UpdateForm.alenc026,UpdateForm.d_alenc026);">
        <input type=text name=d_alenc026 size=20 class=Readonly readonly
         title="Additional HCP 2">
        <img src=../images/SearchIcon.gif class=Icon
         onclick="HCPSearchFrame(UpdateForm.alenc026,UpdateForm.d_alenc026,0);">
        <img src="../images/ClearIcon.gif" class=Icon
         onclick="clrFields(UpdateForm.alenc026,UpdateForm.d_alenc026);">
    </td></tr>

<tr><td class=DataLabel width=15%>Additional HCP 3</td>
    <td><input type=text name=alenc027 size=10 maxlength=10
         title="Additional HCP 3"
         onblur="ValidateHCP(18,0,UpdateForm.alenc027,UpdateForm.d_alenc027);">
        <input type=text name=d_alenc027 size=20 class=Readonly readonly
         title="Additional HCP 3">
        <img src=../images/SearchIcon.gif class=Icon
         onclick="HCPSearchFrame(UpdateForm.alenc027,UpdateForm.d_alenc027,0);">
        <img src="../images/ClearIcon.gif" class=Icon
         onclick="clrFields(UpdateForm.alenc027,UpdateForm.d_alenc027);">
    </td>
    <td class=DataLabel width=15%>Additional HCP 4</td>
    <td><input type=text name=alenc028 size=10 maxlength=10
         title="Additional HCP 4"
         onblur="ValidateHCP(18,0,UpdateForm.alenc028,UpdateForm.d_alenc028);">
        <input type=text name=d_alenc028 size=20 class=Readonly readonly
         title="Additional HCP 4">
        <img src=../images/SearchIcon.gif class=Icon
         onclick="HCPSearchFrame(UpdateForm.alenc028,UpdateForm.d_alenc028,0);">
        <img src="../images/ClearIcon.gif" class=Icon
         onclick="clrFields(UpdateForm.alenc028,UpdateForm.d_alenc028);">
    </td></tr>
</table>
</span>
<script type=text/javascript>

if(%ALLWEB03.01.915.12!=1){
  document.getElementById("HCPcheckbox").style.display="none";
}
</script>
