<meta name="TemplateVersion" content="V12.01.00">
<meta name="TemplateHome" content="standard">
<meta name="CrossBrowser" content="true">
<meta name="HelpFileName" content="NoContextSet.html">
<script type="text/javascript">
function CheckIns() {
  f = document.UpdateForm;
  if(document.UpdateForm.nzspr014.value.substr(3,1)=="O") {
    savicomm = "";
    if (document.getElementById("icomment") !=undefined) {
      savicomm = document.getElementById("icomment").value;
    }
    InsurerField.innerHTML=InsurerText.innerHTML;
    f.icomment.value=trim(savicomm);
  }
  else {
    InsurerField.innerHTML="";
  }
}
function checkClaim(){
 ToggleMandatoryFields();
 if(document.UpdateForm.nzspr002.value.substr(9,1)=="P"||
  document.UpdateForm.nzspr002.value.substr(9,1)=="F"){
     document.UpdateForm.nzspr006.className="Mandatory";
     document.UpdateForm.nzspr007.className="Mandatory";
   } else {   
     document.UpdateForm.nzspr006.className="";
     document.UpdateForm.nzspr007.className="";}
}
function claimDetails(){

 checkIncludeWithPrimary();

 if(document.UpdateForm.nzspr008[2].checked=="1"||
    document.UpdateForm.nzspr008[0].checked=="1"){
     ClaimCodeHeading.innerHTML=claimcodehd.innerHTML;
     ClaimCode.innerHTML=claimcode.innerHTML;
     ContractHeading.innerHTML=contracthd.innerHTML;
     Contract.innerHTML=contract.innerHTML;
     ToggleMandatoryFields();
    if((document.UpdateForm.performed.value=="1")||
       (document.UpdateForm.performed.value=="2")&&
        (document.UpdateForm.invoicep.value=="0")||
        (document.UpdateForm.invoicep.value=="1")){

      document.UpdateForm.nzspr002.disabled="true";
      document.UpdateForm.nzspr006.className="readonly";
      document.UpdateForm.nzspr006.readOnly="true";

 if(trim(document.UpdateForm.nzspr002.value.substr(9,1))!="F"&&
   trim(document.UpdateForm.nzspr002.value.substr(9,1))!="P"&&
   (document.UpdateForm.performed.value=="1") && 
   (document.UpdateForm.invoicep.value=="1")||
   (document.UpdateForm.invoicep.value=="2")||
   (document.UpdateForm.invoicep.value=="3")){
    UpdateForm.PrimaryButton.disabled=true;
    UpdateForm.UpdateButton.disabled=true; }
  }
   }else{
     ClaimCodeHeading.innerHTML="";
     ClaimCode.innerHTML=claimcodeblank.innerHTML;
     ContractHeading.innerHTML="";
     Contract.innerHTML=contractblank.innerHTML;
  }
}
function ToggleMandatoryFields(){
  da = document.UpdateForm;
  var contractTypeIndicator9 = da.nzspr002.value.substr(11,1);
  da.nzspr015.className="";
  da.nzspr017.className="";

  if(contractTypeIndicator9=="A"){
     da.nzspr015.className="Mandatory";
  }
  else if(contractTypeIndicator9=="B"){
     da.nzspr017.className="Mandatory";
  }
  else if(contractTypeIndicator9=="C"){
     da.nzspr015.className="Mandatory";
     da.nzspr017.className="Mandatory";
  }
  checkCntrMandatory();
}
function checkCntrMandatory(){
 if((trim(document.UpdateForm.nzspr002.value.substr(9,1))=="P")||
   (trim(document.UpdateForm.nzspr002.value.substr(9,1))=="F")){
     document.UpdateForm.nzspr006.className="Mandatory";
     document.UpdateForm.nzspr007.className="Mandatory";
   }else{
     document.UpdateForm.nzspr006.className="";
     document.UpdateForm.nzspr007.className="";
  }

  if((document.UpdateForm.performed.value=="1")||
     (document.UpdateForm.performed.value=="2")&&
      (document.UpdateForm.invoicep.value=="0")||
      (document.UpdateForm.invoicep.value=="1")||
      (document.UpdateForm.patadmit.value=="2")){

    document.getElementById('contsearch').style.display="none";
    document.getElementById('contclear').style.display="none";

    document.UpdateForm.nzspr002.disabled="true";
    document.UpdateForm.nzspr006.className="readonly";
    document.UpdateForm.nzspr006.readOnly="true";
  }
}
function RefreshSubmit() {
 
  p=document.UpdateForm

  if(p.nzspr002.value.substr(9,1)==" "&& p.nzspr006.value!=""){
    alert("No Contract can be assigned.")
    return;
  }

  if (document.getElementById("d_nzspr013").checked==true) {
     document.getElementById("nzspr013").value="1";
  } else {
     document.getElementById("nzspr013").value="0";
     document.UpdateForm.nzspr014.disabled=false;
     document.UpdateForm.nzspr015.disabled=false;
  }

  if (document.getElementById("d_nzspr016").checked==true) {
     document.getElementById("nzspr016").value="1";
  } else {
     document.getElementById("nzspr016").value="0";
  }

  if(p.nzspr007.value!=""){
  if(!validateContractProcedure(p.nzspr002,p.nzspr004,p.nzspr003,p.nzspr006,p.nzhosp,p.dummy,p.nzadat,p.nzspr007,p.retcontr)){
     p.nzspr007.value=""; }
  }

  if(p.nzspr007.value!=""|
    (p.nzspr002.value.substr(9,1)!="F" && p.nzspr002.value.substr(9,1)!="P")){
      if (validateMandatory(UpdateForm)) {
      UpdateForm.submit();
      return;
    } else {return;}
  }
  validateContract(p.nzspr002,p.nzspr004,p.nzspr003,p.nzspr006,p.nzhosp,p.dummy,p.nzadat,p.retcount,p.retcontr,p.retcdesc);
    if(p.retcount.value==0){
       alert("No Contract Procedure Code can be assigned.");
       return;
    }
    if(p.retcount.value==1){
      ans=confirm("Assigned Contract Procedure Code is : " + p.retcontr.value +
              "\n" + p.retcdesc.value + "\nClick OK to accept or cancel " +
              "to change contract details.")
      if(ans==true){
         document.UpdateForm.nzspr007.value=p.retcontr.value;
         document.UpdateForm.submit();
         return;
      } else {
         document.UpdateForm.nzspr007.value="";
         return;}
    }
    if(p.retcount.value>1){
      ans=confirm("More than one Contract Procedure Code can be assigned." +
              "\nClick OK to Review or cancel " +
              "to change contract details.")
      if(ans==true){
        p=document.UpdateForm
        ContractProcedureCodeSearchFrame(p.nzspr002,p.nzspr004,p.nzspr003,
                  p.nzspr006,p.nzhosp,p.dummy,p.nzadat,p.nzspr007,p.dummy);
        return;
      } else {
        return;}
    }
}
function setDelete(){
  if(document.UpdateForm.primary.value=="1"){
     alert("Unable to delete primary procedure.")
     return;
   }
   setFormactn('D');
}
function setPrimary(){
  if(document.UpdateForm.primary.value=="1"){
     alert("Already set as primary procedure.")
     return;
   }
   setFormactn('P');
}

function checkIncludeWithPrimary()
{
  if(document.UpdateForm.nzspr008[1].checked)
  {
     document.UpdateForm.nzspr007.className=" ";
     document.UpdateForm.nzspr007.setAttribute("readonly","readonly");
     document.UpdateForm.nzspr007.className="readonly";

     document.UpdateForm.nzspr015.className="";

  }
}

function InsuranceUpd() {
  f = document.UpdateForm;
  ind7 = f.nzspr002.value.substr(9,1);
  ind10 = f.nzspr002.value.substr(12,1);
  ind27 = f.nzspr002.value.substr(44,1);
//alert('ind7=' + ind7 + ' ind10=' + ind10 + ' ind27=' + ind27);
  if (ind10=="A") {
    if (document.getElementById("d_nzspr013").checked==true) {
      f.nzspr014.className="Mandatory";
      f.nzspr014.disabled=false;
      f.nzspr015.className="Mandatory";
      f.nzspr015.disabled=false;
      f.nzspr017.disabled=false;
      f.nzspr024.disabled=false;
      f.d_nzspr016.disabled=false;
    }
    else {
      if (ind27=="I") {
        f.nzspr014.className="Mandatory";
        f.nzspr014.disabled=false;
      }
      else {
        f.nzspr014.className="";
      }
      f.nzspr015.className="";
      f.nzspr015.disabled=true;
      f.nzspr017.disabled=true;
      f.nzspr024.disabled=true;
      f.d_nzspr016.disabled=true;
      f.d_nzspr016.checked=false;
    }
  }
  else {
    if (ind27=="I") {
      f.nzspr014.className="Mandatory";
      f.nzspr014.disabled=false;
    }
    else {
      f.nzspr014.className="";
    }
    f.nzspr015.disabled=false;
    f.d_nzspr016.disabled=false;
    f.nzspr017.disabled=false;
    f.nzspr024.disabled=false;
  }
  CheckIns()
}


</script>
</head>
%START.OF.PAGE
<body onload="PageLoad(event);claimDetails();checkIncludeWithPrimary();
document.UpdateForm.nzspr010.focus();CheckIns();InsuranceUpd();">
<span class=DFrameTitleBar>
<img align="right" alt="Exit" class="MenuIcon" 
 src="../images/ExitIcon.gif" onclick="DFrameExit();">
Update Procedure
</span>
<form name=UpdateForm action="patweb89.pbl" method=get style="margin:0">
  <input type=hidden name=reportno value=9>
  <input type=hidden name=template value=3>
  <input type=hidden name=urnumber value="%PATWEB89.09.003">
  <input type=hidden name=admissno value="%PATWEB89.09.081">
  <input type=hidden name=nzspr001 value="%PATWEB89.09.201">
  <input type=hidden name=nzspr005 value="%PATWEB89.09.205">
  <input type=hidden name=nextpage value="2">
  <input type=hidden name=redirect value="%PATWEB89.09.001.patweb89.09.001">
  <input type=hidden name=retcount value="">
  <input type=hidden name=retcontr value="">
  <input type=hidden name=retcdesc value="">
  <input type=hidden name=nzhosp value="%PATWEB89.09.498.013.1">
  <input type=hidden name=nzadat value="%PATWEB89.09.102">
  <input type=hidden name=savepkey value="%PATWEB89.09.102">
  <input type=hidden name=primary value="%PATWEB89.09.208">
  <input type=hidden name=updttype value="U">
  <input type=hidden name=dummy id=dummy>
  <input type=hidden name=performed value="%PATWEB89.09.212">
  <input type=hidden name=invoicep value="%PATWEB89.09.238">
  <input type=hidden name=theadura value="1">
  <input type=hidden name="nzspr013" id="nzspr013" value="%PATWEB89.09.213">
  <input type=hidden name="nzspr016" id="nzspr016" value="%PATWEB89.09.216">
  <input type=hidden name=patadmit value="%PATWEB89.09.199.020">

<table border=0 width=95% cellspacing=0 align=center>
<tr><td width=25% class=DataLabel>Procedure</td>
    <td class=DataLabel>
        <input type=text name=nzspr004 size=10 maxlength=9 tabindex=95
        onblur='validateCode(4,nzspr004,mbsdesc1)' class=Readonly
        value="%PATWEB89.09.204.0" readonly>
        <input type=text notab readonly name=mbsdesc1 size=35 
         value="%PATWEB89.09.204.1" class=Readonly>

<tr><td class=DataLabel>Full Description</td>
    <td><input type=text name=nzspr010 title="Procedure Description"
         size=120 maxlength=80 value="%PATWEB89.09.210">
    </td></tr>

<tr><td></td>
    <td>
    <input type=radio name=nzspr008 value="1" disabled>Primary Procedure
    <input type=radio name=nzspr008 value="2" onclick='claimDetails();'>Include with Primary
    <input type=radio name=nzspr008 value="0" onclick='claimDetails();'>Bill as Separate
    </td></tr>

    <tr><td>
        <div id=ClaimCodeHeading></div></td>
              <td><div id=ClaimCode></div></td></tr>
    <tr><td>
        <div id=ContractHeading></div></td>
              <td colspan=2><div id=Contract></div></td></tr>

<tr><td class=DataLabel>Surgeon</td>
   <td><input type=text name=nzspr003 id=nzspr003
        size=10 maxlength=8 title="Surgeon"
        class=Mandatory value="%PATWEB89.09.203.003"
        onchange="ValidateHCP(18,0,nzspr003,n_nzspr003);">
    <input type=text name=n_nzspr003 id=n_nzspr003
         value="%PATWEB89.09.203.002">
    <img src="../images/SearchIcon.gif" class=Icon
     onclick="HCPSearchFrame(nzspr003,n_nzspr003,1)" name=surgeonsearch>
    <img src="../images/erase.gif" class=Icon
     onclick="clrFields(nzspr003,n_nzspr003);" name=surgeonclear>
    </td></tr>

    <tr><td class=DataLabel>Approval Number</td> <td class=DataLabel>
        <input type=text name=nzspr015 id=nzspr015 size=20 maxlength=20
         value="%PATWEB89.09.215"></td></tr>

    <tr><td class=DataLabel>Claim Number</td> <td class=DataLabel>
        <input type=text name=nzspr017 size=20 maxlength=20
         value="%PATWEB89.09.217"></td></tr>

    <tr><td class=DataLabel>Approval Expiry Date </td>
        <td><input type=text size=12 name=nzspr024 id=nzspr024
              title="Approval Date"
              onblur="checkDate(this,'ApprovalDate');"
              value="%PATWEB89.09.230" >
         <img notab src=../images/CalendarLookup.gif class=Icon
          onclick="DateLookupFrame(nzspr024);">
        <img notab src=../images/DateTimeStamp.gif class=Icon
         onclick="SetCurrentDateTime(nzspr024,null);">
      </td></tr>

    <tr><td class=DataLabel>Patient Insurance</td>
        <td><input type=CheckBox name="d_nzspr013" id="d_nzspr013" 
           onclick="InsuranceUpd();"/> </td>
    </tr>
</table>

<table border=0 width=95% cellspacing=0 align=center>
    <tr><td width=25% class=DataLabel>Insurer</td>
      <td class=DataField>
      <table><tr><td>
      <select name=nzspr014 id=nzspr014 title="Insurer" onchange="CheckIns();">
      <option value=""></option>
      %PATWEB89.09.214.2
      </select></td>
      <td><div id="InsurerField"></div></td></tr></table>
      </td>
      <td class=DataLabel>Session</td>
      <td class=DataField><input type=text readonly value="%PATWEB89.09.308"
       size=20 title="Session" class=readonly tabindex=-1></td>
    </tr>

    <tr><td class=DataLabel>Prior Approval Sighted</td>
        <td><input class="CheckBox" id="d_nzspr016" type="CheckBox" 
            name="d_nzspr016">
        </td>
        <td class=DataLabel>Unique ID</td>
        <td class=DataField><input type=text readonly value="%PATWEB89.09.307"
        size=10 title="Unique ID" class=readonly tabindex=-1
        name="uniqueky"></td>
    </tr>
</table>

<table border=0 width=95% cellspacing=0 align=center>
<tr><td width=25% class=DataLabel>Comments</td>
    <td><input type=text name=nzspr019 size=50 maxlength=30
         value="%PATWEB89.09.219"></td>
    </tr>
<tr><td class=DataLabel>Assigned Contract Procedure Code</td>
<td><input type=text name="nzspr007" title="Contract Procedure Code"
           readonly class="Readonly" value="%PATWEB89.09.207"></td></tr>

<tr><td>&nbsp;</td></tr>
<tr><td colspan=2 align=center>
    <input type=button class="button" value="Update" name=UpdateButton
     id="pat89sub" onclick='tempDisable(this);RefreshSubmit();'>
    <input type=button class="button" value="Set as Primary" name=PrimaryButton
     id="pat89pre" onclick="tempDisable(this);setPrimary('P');">
    <input type=button class="button" value="Delete" name=DeleteButton
     id="pat89del" onclick="tempDisable(this);setDelete('D');">
    <input type=button value="Cancel" class="button" onclick='DFrameClose()'>
</td></tr>
</table>
</form>

<script type="text/javascript">
 var PrimaryIndex="%PATWEB89.09.208"
 for (var i=0; i < document.UpdateForm.nzspr008.length; i++) {
  if (PrimaryIndex=="1"){
      document.UpdateForm.nzspr008[i].disabled=true;}
  if (document.UpdateForm.nzspr008[i].value=="%PATWEB89.09.208"){
      document.UpdateForm.nzspr008[i].checked=1;
  }
 }
function init() {
  invoiced="%PATWEB89.09.238"
  if((invoiced=="2")||(invoiced=="3")){
  UpdateForm.PrimaryButton.disabled=true;
  UpdateForm.UpdateButton.disabled=true; 
  UpdateForm.DeleteButton.disabled=true;}

  notperformed="%PATWEB89.09.212";
  if(notperformed=="2"){
  UpdateForm.UpdateButton.disabled=true;}
  if ((invoiced=="0")||(invoiced=="1") && (notperformed=="1")){
    document.UpdateForm.nzspr003.className="readonly";
    document.UpdateForm.nzspr003.readOnly="true";
    document.UpdateForm.surgeonsearch.disabled="true";
    document.UpdateForm.surgeonclear.disabled="true";
    document.UpdateForm.nzspr007.className="readonly";
    document.UpdateForm.nzspr007.readOnly="true";
    UpdateForm.PrimaryButton.disabled=true;
    UpdateForm.DeleteButton.disabled=true;
  }
  if ((invoiced=="0")&&(notperformed!="2")){
    UpdateForm.PrimaryButton.disabled=false; 
  }
  if (document.getElementById("nzspr013").value=="1") {
    document.getElementById("d_nzspr013").checked=true;
  }
  if (document.getElementById("nzspr016").value=="1") {
    document.getElementById("d_nzspr016").checked=true;
  }

}

</script>
<span id=claimcodehd style="display:none">
%STANDARD.01.017.CL
</span>
<span id=claimcode style="display:none">
    <select name=nzspr002 title="%STANDARD.01.017.CL"
     class=Mandatory onchange="checkClaim();InsuranceUpd();">
    <option></option>
    %PATWEB89.09.202.2
    </select>
</span>
<span id=contracthd style="display:none">
Contract
</span>
<span id=contract style="display:none">
         <input type=text size=6 maxlength=6 name=nzspr006
         title="Contract" class=Mandatory
   onchange="validateCode(16,document.UpdateForm.nzspr006,UpdateForm.funddesc);"
                   value="%PATWEB89.09.206.0">
        <input type=text size=35 name="funddesc" maxlength="30"
         value="%PATWEB89.09.206.1" readonly notab>
        <img src=../images/SearchIcon.gif class=Icon
      onclick="HFundSearchFrameNoFocus(UpdateForm.nzspr006,UpdateForm.funddesc,
                                               dummy,dummy);"
                  name=contsearch id=contsearch>
        <img src="../images/erase.gif" class=Icon
      onclick="clrFields(UpdateForm.nzspr006,UpdateForm.funddesc,dummy,dummy);" 
                  name=contclear id=contclear>
</span>
<span id=claimcodeblank style="display:none">
   <input type=hidden name=nzspr002 value="%PATWEB89.09.202.1">
</span>
<span id=contractblank style="display:none">
   <input type=hidden name=nzspr006 value="%PATWEB89.09.206.0">
</span>
<span id="InsurerText" style="display:none">
        <input type="text" size=50 maxlength=50 name=icomment id=icomment 
        class=Mandatory value="%PATWEB89.09.612" title="Insurer Free text">
</span>
