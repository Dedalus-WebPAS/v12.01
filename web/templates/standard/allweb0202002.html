<meta name="TemplateVersion" content="V12.01.00">
<meta name="TemplateHome" content="standard">
<meta name="CrossBrowser" content="true">
<meta name="HelpFileName" content="NoContextSet.html">
<script type="text/javascript" src="../js/allweb0202002.js"></script>
<script type="text/javascript">
function displayStatusOptions(){
  var referralStatusCode = document.getElementById('rfstcode');
  var viewlink = document.getElementById('viewlink');
  var allow_wait="1";
  if(document.HiddenFields.activenc.value=="1" &&
     !isWhitespace(document.HiddenFields.deptcode.value.substr(10,1))) {
     allow_wait="0";
  }
  if(typeof referralStatusCode != 'undefined') {
    if(referralStatusCode.value == "1" && allow_wait=="1") {
       viewlink.options[viewlink.options.length] = new Option("Waiting","6");
    }
  }
}
function getCloseReferralCookie() {

  var closereferralurl = "";

  if (GetCookieData("CloseReferralCookie") != "unknown") {
    closereferralurl=GetCookieData("CloseReferralCookie");
    ExpireCookiePath("CloseReferralCookie");
    DFrameLink(closereferralurl,50,50,750,500)
  }
}
</script>
</head>
%START.OF.PAGE
<body onload="PageLoad(event);CheckBookings();setTimeout('DisplayDIVS()',100);
             displayStatusOptions();SetFormFocus();getCloseReferralCookie();
             ShowCreateProgramRef();">
<div id=PatientHeading></div>
<script type="text/javascript">
PatientURN="%ALLWEB02.02.003";
PatientVIS="%ALLWEB02.02.081";
PatientNAM="%ALLWEB02.02.002";
PatientSTA="%ALLWEB02.02.086.078";
PatientALT="%ALLWEB02.02.084";
PatientSEX="%ALLWEB02.02.019";
PatientDOB="%ALLWEB02.02.020";
PatientAGE="%ALLWEB02.02.021";
PatientLOC="%ALLWEB02.02.083";
PatientPRI="%ALLWEB02.02.086.066.1";
PatientUNT="%ALLWEB02.02.066.0";
DoctorCOD="%ALLWEB02.02.082.003";
DoctorNAM="%ALLWEB02.02.082.002";
PatientAID="%ALLWEB02.02.086.090";
PatientIND="%ALLWEB02.02.086.091";
PatientCUR="%ALLWEB02.02.086.092";
PatientCLC="%ALLWEB02.02.086.093.1";
PatientCLH="%STANDARD.01.017.CL";
PatientHFT="%ALLWEB02.02.086.094";
PatientCDM="%ALLWEB02.02.086.095";
PatientVDH="%ALLWEB02.02.086.099.015";
InsertPatientHeader()
</script>
<div id=PatientMenu></div>


<form name=HiddenFields style="margin:0">
<input type=hidden name=wbsedall value="%STANDARD.01.028">
<input type=hidden name=refrdept value="%ALLWEB02.02.125.1">
<input type=hidden name=refrstat value="%ALLWEB02.02.103">
<input type=hidden id="rfstcode" name=rfstcode value="%ALLWEB02.02.199.027">
<input type=hidden name=deptcode value="%ALLWEB02.02.125.3">
<input type=hidden name=activenc value="%ALLWEB02.02.251">
<input type=hidden name=deptindc value="%ALLWEB02.02.125.3">
</form>
 
<table width=100% cellspacing=0 cellpadding=1 border=0>
<tr>
<td class=HeadingCell width=15%>
    <select class=PMenuSelectList name=viewlink id=viewlink
     onchange="ViewLink(this);">
    <option>---- Status Update ----</option>
    <option value="0">Inactivate</option>
    <option value="1">Reactivate</option>
    <option value="2">Close</option>
    <option value="3">Cancel</option>
    <option value="4">Reject</option>
    <option value="5">Reinstate</option>
    </select>
    </td>
<td class=HeadingCell width=25%>
<span id=OutpatMenu style="display:none">
    <select class=PMenuSelectList id=viewoutp name=viewoutp
     onchange="ViewOutpatientLink(this);">
    <option>--Outpatient Bookings--</option>
    <option value="0">Book Outpatient</option>
    <option value="1">Series Booking</option>
    <option value="2">Multiple HCP Series Booking</option>
    <option value="3">Linked Visits</option>
    </select>
</span>
<span id=CareLogisticsMenu style="display:none">
    <select class=PMenuSelectList name=viewoutp id=BookingMenu
     onchange="ViewOutpatientLink(this);">
    <option>-- Care Logistics --</option>
    <option value="4">Book Appointment</option>
    <option value="0">Book Outpatient</option>
    <option value="1">Series Booking</option>
    <option value="2">Multiple HCP Series Booking</option>
    <option value="3">Linked Visits</option>
    </select>
</span>

</td>
    <td class=HeadingCell align=centre>
    %ALLWEB02.02.125.0   Referral Details
    </td>
</tr>
</table>

<table width=98% align=center cellspacing=0 cellpadding=1 border=0>
<tr><td class=DataLabel>Priority </td>
    <td class=DataField> %ALLWEB02.02.127.0   </td>
    <td class=DataLabel>Entered by</td>
    <td class=DataField> %ALLWEB02.02.163   </td></tr>
<tr><td class=DataLabel>Referral Date</td>
    <td class=DataField>  %ALLWEB02.02.119   </td>
    <td class=DataLabel>Source of Referral</td>
    <td class=DataField> %ALLWEB02.02.134.0    </td></tr>
<tr><td class=DataLabel>Referred By</td>
    <td class=DataField>
    <a href='javascript:HCPViewFrame("%ALLWEB02.02.122.1","%ALLWEB02.02.123.0","%ALLWEB02.02.124")'>
 %ALLWEB02.02.122.0</a>
    </td>
    <td class=DataLabel>Problem</td>
    <td class=DataField>  %ALLWEB02.02.128.0   </td></tr>
<tr><td class=DataLabel>Diagnosis Code</td>
    <td class=DataField>  %ALLWEB02.02.131.0   </td>
    <td class=DataLabel>Created</td>
    <td class=DataField>  %ALLWEB02.02.161 at %ALLWEB02.02.162.1  </td></tr>
<tr><td class=DataLabel>Status Code</td>
    <td class=DataField>  %ALLWEB02.02.103  %ALLWEB02.02.199.017</td>
    <td class=DataLabel>Case Review Date</td>
    <td class=DataField>%ALLWEB02.02.199.010</td></tr>
<tr id="DisplayBookingInstructions">
    <td class=DataLabel valign=top>Booking Instructions</td>
    <td class=DataField colspan=3>
    <textarea cols=80 rows=3 id="bookinginstruction"
     class=Readonly readonly>%ALLWEB02.02.249.005.0</textarea>
    </td></tr>

<tr><td align=center colspan=4><br>

 <input type=button class="button" value="List Contacts" name=episbutt
   onclick="location.href='%ALLWEB02.02.001.allweb03.01.001';" id=episbutt>

  <span id=InsertEpisodeButtons>
   <input type=button class="button" value="Add Contact"
  onclick="AddEnc('%ALLWEB02.02.003',
                  '%ALLWEB02.02.081',
                  '%ALLWEB02.02.125.1',
                  '%ALLWEB02.02.103',
                  '%ALLWEB02.02.240',
                  '%ALLWEB02.02.276');">
  </span>

 <input type=button class="button" value="Update" id=btnUpdate name=btnUpdate
onclick="getUpdate('%ALLWEB02.02.003','%ALLWEB02.02.081','%ALLWEB02.02.125.1')">

  <input type=button class="button" value="Referral List" 
   onclick="location.href='%ALLWEB02.02.001.allweb02.02.001';">

  <input type=button class="button" value="Copy Referral" 
   title="Copy referral to this department"
 onclick="getCopy('%ALLWEB02.02.003','%ALLWEB02.02.081','%ALLWEB02.02.125.1');">

  <select class=PMenuSelectList name=c_allrf001 id="copselct"
   title="Copy referral to department"
   onmouseover='MenuOver(event,this)'
   onchange="getCopy('%ALLWEB02.02.003','%ALLWEB02.02.081',this.value);">
  <option></option>
   %ALLWEB02.02.208
  </select>

  <span id=InsertHICButtons style="display: none">
  <input type=button class="button" value="Book Outpatient" 
        onclick="BookPatient('%ALLWEB02.02.182.1','%ALLWEB02.02.103',
                             '%ALLWEB02.02.199.017');">
      <input type=button class="button" value="Linked Visits" 
  onclick="LnkVis('%ALLWEB02.02.003','%ALLWEB02.02.081','%ALLWEB02.02.125.1','%ALLWEB02.02.240');">
  </span>

  <span id=InsertSACSButtons style="display: none">
    <input type=button class="Bigbutton" value="Internal Referral"
     id="intbuttn"
     title="Add internal referral for users default department" 
     onclick="AddUserReferral();">
    <select class=PMenuSelectList name=d_allrf001 id="intselct"
      title="Add internal referral for department"
     onmouseover='MenuOver(event,this)'
     onchange="AddNewReferral(this);">
    <option></option>
     %ALLWEB02.02.208
    </select>

  <input type=button class="Bigbutton" value="Linked Referrals" name=linkbutt
  onclick="LnkRef('%ALLWEB02.02.003','%ALLWEB02.02.081','%ALLWEB02.02.125.1');"
  id=linkbutt>
  </span>

  <input type=button class="button" value="Notes" id=comtbutt name=comtbutt
   onclick="PatientLinkTo('cliweb06.pbl',7,1,1,900,500);">

  <input type=button class="button" value="Issues" id=issubutt name=issubutt
   onclick="PatientLinkTo('allweb02.pbl',9,1,1,900,500);">   

  <span id=InsertAssessButton style="display: none">
  <input type=button class="button" value="Assessments" name=assebutt
   onclick="PatientLinkTo('allweb02.pbl',10,1,0,0,0);" id=assebutt>   
  </span>

  <span id=InsertReqAppButton style="display: none">
  <input type=button class="button" value="Request Appts" name=reqabutt
   onclick="PatientLinkTo('outweb08.pbl',08,1,0,0,0);" id=reqabutt>   
  </span>

  <span id=ExtRefBut style="display: none">
  <input type=button class="Bigbutton" value="External Referrals" name=exrfbutt
   onclick="location.href='%ALLWEB02.02.001.allweb02.08.001';" id=exrfbutt>   
  </span>
  
  <span id=ResAdmBut style="display: none">
  <input type=button class="Largebutton" name=readbutt id=readbutt
   onclick="location.href='%ALLWEB02.02.001.allweb03.01.008';">   
  </span>
  
  <span id=RenewalAuditBut style="display: none">
  <input type=button class="button" value="Renewed Ref" name=renwbutt
   onclick="location.href='%ALLWEB02.02.001.allweb02.12.001';" id=renwbutt>   
  </span>

  <span id=BookInstBut style="display: none">
  <input type=button class="button" value="Booking Inst" name=bokibutt
   onclick="PatientLinkTo('allweb02.pbl',13,1,1,900,500);" id=bokibutt>   
  </span>

  <span id=ProgramRef style="display: none">
  <input type=button class="button" value="Create Program" name=primbutt
   onclick="CreateProgramRef();" id=primbutt>   
  </span>
  <br><hr></td>
    </tr>
</table>

<span id="Last5Contacts" style="display:none">
<table width=100% border=1 cellspacing=0 cellpadding=1>
<tr><td align=center class=HeadingCell colspan=4>
     Last 5 Contacts
    </td></tr>
<tr><td class=HeadingCell>Date & Time</td>
    <td class=HeadingCell>Provider</td>
    <td class=HeadingCell>Service Input</td>
    <td class=HeadingCell width=10%>Notes / Other</td>
<tr><td></td><td></td></tr>

%ALLWEB02.02.225.allweb03.01.003

</table>
</span>

<span id="ClinicDoc" style="display:none">
<form name=AddDocumentLink action=../cgi-bin/cliweb08.pbl method=get>
<input type=hidden name=reportno value=1>
<input type=hidden name=template value=011>
<input type=hidden name=urnumber value="%ALLWEB02.02.003">
<input type=hidden name=admissno value="%ALLWEB02.02.101">
<input type=hidden name=referlky value="%ALLWEB02.02.101">
<table width=100% border=1 cellspacing=0 cellpadding=1>
<tr><td colspan=4 class=HeadingCell align=center>
    Clinical Documentation
    </td>
</tr>
<tr><td class=HeadingCell>Linked Documents</td>
    <td class=HeadingCell>Description</td>
    <td class=HeadingCell>Date Input</td>
    <td class=HeadingCell>Input By</td>
</tr>
<tr><td></td><td></td></tr>
 %ALLWEB02.02.202
<tr><td colspan=4 bgcolor=#cccccc align=right>
    <input type=button class="button NoAutoFocus" value="Add File"
    onclick='DFrameSubmit(AddDocumentLink,100,150,500,250);'>
    </td>
</tr>
</table>
</form>
</span>
     
<span id="RefActAud" style="display:none">
<table width=100% border=1 cellspacing=0 cellpadding=1>
<tr><td colspan=5 class=HeadingCell align=center>
    Referral Action Audit
    </td></tr>
<tr>
    <td class=HeadingCell>Web User</td>
    <td class=HeadingCell>Date & Time</td>
    <td class=HeadingCell>Action Code</td>
    <td class=HeadingCell>Update Type</td>
    <td class=HeadingCell>Comment</td>
</tr>
 %ALLWEB02.02.221.allweb02.15.001  
</table>
<table width=100% bgcolor=#CCCCCC><tr>
  <td align=center>
  <input type=button value="<< Previous" class="button"
   onclick='location.href="%ALLWEB02.02.219.002"'>
  <input type=button value="Next >>" class="button"
   onclick='location.href="%ALLWEB02.02.220.002"'>
</td></tr>
</table>
<form name=MarkActn action=allweb02.pbl method=post style="margin:0">
<table width=100% border=1 cellspacing=0 cellpadding=0>
<tr><td bgcolor=#cccccc align=left>
    <input type=button class="button" value="Audit" id=audtbutt name=audtbutt
     onclick="PatientLinkTo('allweb02.pbl',2,13,0,0,0);">
    <span id="LetterHistory" style="display:none">
    <input type="button" class="button"
           value="Letter History"
           id=btnLetterHistory name="btnLetterHistory"
           onclick="PatientLinkTo('allweb02.pbl',2,15,0,0,0);"/>
    </span>
    </td>
    <td align=right bgcolor=#CCCCCC>
<input type="hidden" name="reportno" value="02">
<input type="hidden" name="updatety" value="S">
<input type="hidden" name="nextpage" value="1">  
<input type="hidden" name="wbsehosp" value="%STANDARD.01.032">
<input type="hidden" name="urnumber" value="%ALLWEB02.02.003">
<input type="hidden" name="admissno" value="%ALLWEB02.02.101">
<input type="hidden" name="redirect" value="%ALLWEB02.02.001.allweb02.02.002">
Action Code
<select name=actncode class="selectBig NoAutoFocus">
<option></option>
%ALLWEB02.02.207.2
</select>
Comment
<input type=text name=commenty class="NoAutoFocus" size=40 maxlength=50>
<input type=submit name=markactn Value="Save Action" class="button NoAutoFocus">
</td></tr>
</table>
</form>
</span>

<form name=AddReferral method=get action=allweb02.pbl>
<input type=hidden name=reportno value=3>
<input type=hidden name=template value=1>
<input type=hidden name=urnumber value="%ALLWEB02.02.003">
<input type=hidden name=sacsvisn value="%ALLWEB02.02.101">
<input type=hidden name=allrf001 value="">
<input type=hidden name=saveprim value="1">
</form>

<form name=PatientLinks method=get>
<input type=hidden name=reportno value=01>
<input type=hidden name=template value=002>
<input type=hidden name=urnumber value="%ALLWEB02.02.003">
<input type=hidden name=admissno value="%ALLWEB02.02.081">
<!--Added refrlvis here-->
<input type=hidden name=refrlvis value="">
<!--End here-->
<input type=hidden name=bookflag value="">
<input type=hidden name=wbsesite value="%STANDARD.01.023">
<input type=hidden name=bwarning value="%ALLWEB02.02.213">
<input type=hidden name=ibcnumci value="%STANDARD.01.025.000.132.0.1">
<input type=hidden name=d_alref083 value="%ALLWEB02.02.144">
<input type=hidden name=d_aldep017 value="%ALLWEB02.02.509">
<input type=hidden name=wbsedall value="%STANDARD.01.028">
<input type=hidden name=d_alref119 value="%ALLWEB02.02.182.1">
<input type=hidden name=d_aldep020 value="%ALLWEB02.02.512">
<input type=hidden name=d_mastrefn value="%ALLWEB02.02.508">
<input type=hidden name=d_alrestat value="%ALLWEB02.02.199.027">
<input type=hidden name=d_alrenvin value="%ALLWEB02.02.199.055">
<input type=hidden name=d_alreevpr value="%ALLWEB02.02.199.016.3">
<input type=hidden name=alcndevp value="%STANDARD.01.025.106.225.0.1">
<input type=hidden name=usrsvrsl value="%STANDARD.01.042.ALLWEB02">
</form>


<script type="text/javascript">

document.getElementById('readbutt').value = window.ResidentialAdmDescription;

function ViewOutpatientLink(OptionLink) {
  switch (OptionLink.value) {
    case "0": { 
      BookPatient('%ALLWEB02.02.182.1',
                  '%ALLWEB02.02.103',
                  '%ALLWEB02.02.199.017',
                  '%ALLWEB02.02.240',
                  '%ALLWEB02.02.276'); 
      break; }
    case "1": { 
      BookPatientS('%ALLWEB02.02.182.1',
                   '%ALLWEB02.02.103',
                   '%ALLWEB02.02.199.017',
                   '%ALLWEB02.02.240',
                   '%ALLWEB02.02.276'); 
      break; }
    case "2": { 
      BookPatientMHCPS('%ALLWEB02.02.182.1',
                       '%ALLWEB02.02.103',
                       '%ALLWEB02.02.199.017',
                       '%ALLWEB02.02.240',
                       '%ALLWEB02.02.276'); 
      break;}
    case "3": { 
      LnkVis('%ALLWEB02.02.003',
             '%ALLWEB02.02.081',
             '%ALLWEB02.02.125.1',
             '%ALLWEB02.02.240',
             '%ALLWEB02.02.276');
      break; }
    case "4": {
      OpenCareLogisticsReferral('%ALLWEB02.02.125.1',
                                '%ALLWEB02.02.195',
                                '%ALLWEB02.02.128.1',
                                '%ALLWEB02.02.122.1',
                                '%ALLWEB02.02.138.1'); 
      break; }
  }
  OptionLink.selectedIndex=0;
}
function CheckBookings() {
  if(document.PatientLinks.bwarning.value != "1" ) {
    return;
  }
  if (isWhitespace(document.PatientLinks.admissno.value)) {
   return;
  }
  var serverURL = "../cgi-bin/allweb02.pbl?reportno=6&updatety=1" +
                  "&admissno=" +
                  document.PatientLinks.admissno.value.replace(/ /g,"+")
  var returnValue = RSExecute(serverURL);
  ReturnValue=returnValue.return_value.split("|");
  if (returnValue.status==0) {
    if (ReturnValue[0] == 1) {    // Unbooked referral exists
      var message = "Warning : Unlinked outpatient appointments exist " +
                    "for this Clinic Type/Clinic Id" +
                    "\nClick OK to view appointments and link. " +
                    "Cancel to ignore.";
      if (confirm(message)) { 
        p=document.PatientLinks
        LnkVis('%ALLWEB02.02.003','%ALLWEB02.02.081','%ALLWEB02.02.125.1','%ALLWEB02.02.240');
      }
    }
  }
}

CommentIndicator="%ALLWEB02.02.218";
if ( CommentIndicator =="1" ) {
   document.all.comtbutt.className="RedButton";
}
IssueIndicator="%ALLWEB02.02.229";
if ( IssueIndicator =="1" ) {
   document.all.issubutt.className="RedButton";
}
EpisdIndicator="%ALLWEB02.02.230";
if ( EpisdIndicator =="1" ) {
   document.all.episbutt.className="RedButton";
}
ExrefIndicator="%ALLWEB02.02.231";
if ( ExrefIndicator =="1" ) {
   document.all.exrfbutt.className="BigRedButton";
}
LinkRIndicator="%ALLWEB02.02.232";
if ( LinkRIndicator =="1" ) {
   document.all.linkbutt.className="RedButton";
}
ResAdIndicator="%ALLWEB02.02.247";
if ( ResAdIndicator =="1" ) {
   document.all.readbutt.className="LargeredButton";
}
RefRenewal="%ALLWEB02.02.257";
if ( RefRenewal =="1" ) {
   document.all.renwbutt.className="RedButton";
}
if ( document.PatientLinks.d_aldep020.value =="1" ) {
     InsertEpisodeButtons.style.display="none";  
}

Assessments=document.HiddenFields.deptcode.value.substr(10,1);
if ( ("%ALLWEB02.02.246.3" == "1") ||
     (Assessments == "T" || Assessments == "H") ) {
  InsertAssessButton.style.display="";  
  AssessInd="%ALLWEB02.02.236";
  if ( AssessInd =="1" ) {
    document.all.assebutt.className="RedButton";
  }
} 

UsingRequestAppt="%STANDARD.01.025.032.136.0.1";
if ( ("%ALLWEB02.02.246.4" == "1") ||
     (UsingRequestAppt == "1") ){
  InsertReqAppButton.style.display="";  
  RequestAppt="%ALLWEB02.02.239";
  if ( RequestAppt == "1" ) {
    document.all.reqabutt.className="RedButton";
  }
}

UsingExtRef="%ALLWEB02.02.246.1";
if (UsingExtRef == "1") {
  ExtRefBut.style.display="";
}
UsingResAdm="%ALLWEB02.02.246.2";
if (UsingResAdm == "1") {
  ResAdmBut.style.display="";
}
DisplayLast5Contacts="%ALLWEB02.02.246.5";
if (DisplayLast5Contacts == "1") {
  Last5Contacts.style.display="";
}
DisplayClinicDoc="%ALLWEB02.02.246.6";
if (DisplayClinicDoc == "1") {
  ClinicDoc.style.display="";
}
DisplayActAud="%ALLWEB02.02.246.7";
if (DisplayActAud == "1") {
  RefActAud.style.display="";
}
DisplayLetHis="%ALLWEB02.02.246.8";
if (DisplayLetHis == "1") {
  LetterHistory.style.display="";
}
typeOfProgram=document.HiddenFields.deptcode.value.substr(10,1);
renewReferrals=document.HiddenFields.deptcode.value.substr(33,1);
if ((renewReferrals == '1' || renewReferrals== '2')
     &&
    ( typeOfProgram == "O"  || typeOfProgram == "S") ) {
  RenewalAuditBut.style.display="";
}

function SetFormFocus() {
  if (document.activeElement && (document.activeElement.type == undefined)) {
    if (document.all.btnUpdate) document.all.btnUpdate.focus();
  }
}
if(document.getElementById('bookinginstruction')) {
  if(isWhitespace(document.getElementById('bookinginstruction').value)) {
     document.getElementById('bookinginstruction').style.display="none";
  }
}
//
if(typeOfProgram=="S" || typeOfProgram=="O" || typeOfProgram=="T" ||
   typeOfProgram=="E" || typeOfProgram=="L") {
  BookInstBut.style.display="";
  BookingInstIndicator="%ALLWEB02.02.265";
  if( BookingInstIndicator == "1") {
    document.all.bokibutt.className="RedButton";
  }
}
</script>
