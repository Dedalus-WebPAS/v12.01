<meta name="TemplateVersion" content="V12.01.00">
<meta name="TemplateHome" content="standard">
<meta name="HelpFileName"    content="NoContextSet.html">
<meta name="CrossBrowser" content="true">
<script type="text/javascript">
function TranSource (){
  i=document.CancelBooking.cpadm003.selectedIndex;
  ind=document.CancelBooking.cpadm003.options[i].value.substr(5,1)
  if (ind!="X"&&ind!="T"&&ind!="N") {
    document.CancelBooking.cpadm004.className="Readonly";
    document.CancelBooking.cpadm004.value="";
    document.CancelBooking.trandesc.value="";
    document.CancelBooking.cpadm004.readOnly=true;
  } else {
    document.CancelBooking.cpadm004.className="Mandatory";
    document.CancelBooking.cpadm004.readOnly=false;
  }
}
function CheckRemove() {
  if (document.CancelBooking.cpadm002[1].checked) {
     document.CancelBooking.cpadm003.className="Mandatory";
     document.CancelBooking.cpadm003.disabled=false;
     document.CancelBooking.cpadm004.className="";
     document.CancelBooking.cpadm004.readOnly=false;
     document.CancelBooking.cpadm008.className="Mandatory";
     document.CancelBooking.cpadm008.value="";
     document.CancelBooking.cpadm008.readOnly=false;
  } else {
     document.CancelBooking.cpadm003.className="Readonly";
     document.CancelBooking.cpadm003.selectedIndex="0";
     document.CancelBooking.cpadm003.disabled=true;
     document.CancelBooking.cpadm004.className="Readonly";
     document.CancelBooking.cpadm004.readOnly=true;
     document.CancelBooking.cpadm004.value="";
     document.CancelBooking.trandesc.value="";
     document.CancelBooking.cpadm008.className="Readonly";
     document.CancelBooking.cpadm008.value="";
     document.CancelBooking.cpadm008.readOnly=true;
  }
}
function CheckPread() {
  if (document.CancelBooking.pread002[0].checked) {
     document.CancelBooking.pread003.className="Mandatory";
  } else {
     document.CancelBooking.pread003.className="";
  }
}
function ChkLock() {
  numlock=parseInt(CancelBooking.sesslock.value)
  daylock=parseInt(CancelBooking.noofdays.value)
  if(numlock>daylock) {
    alert("Session is locked. Cannot Cancel patient");
    DFrameExit()
   }
  if(!isWhitespace(CancelBooking.chkprept.value)) {
    alert("Patient has Usage Details. Cannot Cancel patient");
    DFrameExit()
   }
}
function formSubmit() {
  if(!validateMandatory(document.CancelBooking)) {
      return;
  }
  if (document.CancelBooking.cpadm003 != undefined) {
    i=document.CancelBooking.cpadm003.selectedIndex;
    ind=document.CancelBooking.cpadm003.options[i].value.substr(14,1)
    if (ind=="W") {
    alert("Patient must be discharged instead of removed.")
    return;}
  }
  CaseList=GetContentCookie("CasePath");
  if (CaseList!="unknown") {
     CancelBooking.redirect.value=CaseList;
  }

  //T0845646
  //Cancelling a preadmission with Cat PC id2=X then check that the visit 
  //has any Post Discharge Coding?
  if((preadmission.innerHTML != "") &&
     (document.getElementById('d_opdastat').value == "Preadmitted") &&
     (document.CancelBooking.pread002[0].checked) &&
     (document.getElementById('pread003').value.substr(4,1) == 'X')){

     //Visit with Post Discharge Coding
     if(document.getElementById('d_dcexists').value == "1"){
        alert("Error: Pre-admission has associated Post Discharge Coding." +
              "\n\nPlease remove Coding before cancelling Pre-admission.");
        return;
     }
  }
  //

  CancelBooking.submit(); 
}

function AuditChangeReason() {
 if(document.CancelBooking.d_opdastat.value=="Cancelled" &&
  (CancelBooking.d_patcanth.value != CancelBooking.patcanth.value.substr(0,3))){
      document.getElementById('ReasonHeading').innerHTML=
      document.getElementById('ShowReasonHeading').innerHTML
      document.getElementById('ReasonField').innerHTML=
      document.getElementById('ShowReasonField').innerHTML
 } else {
    document.getElementById('ReasonHeading').innerHTML="";
    document.getElementById('ReasonField').innerHTML="";
 }
}
function ChkReq() {
  if (document.CancelBooking.d_oprqstat.value=="1" &&
      isWhitespace(document.CancelBooking.d_thetcomp.value)) {
    TheatreRequestDIV.innerHTML=TheatreRequestSPAN.innerHTML;
  }
}
function ChkCancelled() {
  if (document.CancelBooking.d_opdastat.value=="Cancelled") {
    bookhd.innerHTML = "";
    booking.innerHTML = "";
    adjusttitleDIV.innerHTML = "";
    adjustfieldDIV.innerHTML = "";
    waiting.innerHTML = "";
    preadmission.innerHTML = "";
    TheatreRequestDIV.innerHTML = "";
  }
}
</script>
</head>
%START.OF.PAGE
<body onload="PageLoad(event);ChkLock();ChkReq();ChkCancelled();">
<span class=DFrameTitleBar>
<img align="right" alt="Exit" class="MenuIcon" 
 src="../images/ExitIcon.gif" onclick="DFrameExit();">
Cancel Theatre Booking
</span>

<form name=CancelBooking method=post action=oprweb01.pbl
 onsubmit="return validateMandatory(this);" style="margin:0">

  <input type=hidden name=reportno value=13>
  <input type=hidden name=template value=1>
  <input type=hidden name=casekeys value="%OPRWEB01.08.001">
  <input type=hidden name=nextpage value="0">
  <input type=hidden name=redirect value="%OPRWEB01.08.002.oprweb01.03.003">
  <input type=hidden name=chkblock value="1">
  <input type=hidden name=sesslock value="%OPRWEB01.08.368">
  <input type=hidden name=noofdays value="%OPRWEB01.08.006">
  <input type=hidden name=chkprept value="%OPRWEB01.08.007">
  <input type=hidden name=caseuniq value="%OPRWEB01.08.210">
  <input type=hidden name=opdea031 value="%STANDARD.01.013">
  <input type=hidden name=d_patcanth value="%OPRWEB01.08.229.1">
  <input type=hidden name=d_opdastat id=d_opdastat value="%OPRWEB01.08.207">
  <input type=hidden name=d_oprqstat value="%OPRWEB01.08.705">
  <input type=hidden name=d_thetcomp value="%OPRWEB01.08.790">
  <input type=hidden name=admissno value="%OPRWEB01.08.209">
  <input type=hidden name=d_dcexists id=d_dcexists value="%OPRWEB01.08.829">

  <table width=95% border=0 align=center>
<tr><td class=DataLabel width=50%>Theatre Cancellation Reason</td>
    <td><select name=patcanth class=Mandatory title="Reason for Cancellation"
         onchange="AuditChangeReason();">
        <option></option>
        %OPRWEB01.08.229.9.1.03.2.T
        </select></td>
    <td class=DataLabel><div id=ReasonHeading></div></td>
    <td class=DataField><div id=ReasonField></div></td>
    </tr>

<tr><td><div id=bookhd></div></td>
    <td><div id=booking></div></td>
    <td class=DataLabel></td>
    <td class=DataField></td>
    </tr>

<tr><td class=DataLabel>
    <div id=adjusttitleDIV>Adjust Subsequent Start Times
    </div></td>
    <td><div id=adjustfieldDIV>
    <input type=checkbox name=adjstart value=1 >
    </div></td>
    <td class=DataLabel></td>
    <td class=DataField></td>
    </tr>

</table>


<table width=95% align=center>
<tr><td colspan=2><div id=waiting></div></td></tr>
<tr><td colspan=2><div id=preadmission></div></td></tr>
</table>

<div id=TheatreRequestDIV></div>


<!--</table>-->
<table width=100%>
<tr><td align="center" colspan=2>
    <br>
    <input type="button" id="opr01sub" class="button" value="Ok"
    onclick="tempDisable(this);formSubmit();">
    <input type="button" class="button" value="Cancel" 
    onclick="DFrameClose()">
</td></tr>
</table>
</form>

<div name=bookhead id=bookhead style="display: none;" class="DisplayLocation">
<td class=DataLabel>Booking Cancellation Reason</td>
</div>

<div name=bookdets id=bookdets style="display: none;" class="DisplayLocation">
<td><select name=patcanad title="Booking Cancellation Reason" 
         class=Mandatory>
         <option></option>
         %OPRWEB01.08.512.2
         </select></td>
</div>
<div name=waitdets id=waitdets style="display: none;" class="DisplayLocation">
<table width=100%>
  <tr><td width=50% class=DataLabel>Do you want to return this patient to
                          the Waiting List? </td>
      <td>Yes<input type=radio name=cpadm002 value="Y" checked
              onclick="CheckRemove();">
          No <input type=radio name=cpadm002 value="N" 
              onclick="CheckRemove();">
      </td></tr>

  <tr><td class=DataLabel>Removal Reason </td>
      <td align=left>
      <select name="cpadm003" title="Removal Reason" class=Readonly disabled
               onchange="TranSource();">
        <option> </option>
        %OPRWEB01.08.613.2
      </select>
      </td></tr>
    <tr>
      <td class=DataLabel>Transfer Source</td>
      <td><input type="text" size=7 maxlength=5 name=cpadm004 id=cpadm004 
      title="Transfer Source" tabindex=3 readonly class=Readonly
      onchange="validateCode(9,cpadm004,trandesc);">
     <input type=text size=27 name=trandesc notab
      class=Readonly readonly>
     <img src="../images/SearchIcon.gif"
      onClick="TransferSourceFrame(cpadm004,trandesc)"></td>
   </tr>

  <tr><td class=DataLabel>Removal Date</td>
    <td><input type="text" name="cpadm008" id="cpadm008" title="Removal Date" 
         size="12" class=Readonly readonly maxlength="11" 
         onblur="checkDate(this,'Removal Date')";>
        <img src=../images/DateTimeStamp.gif class=Icon 
         date="CancelBooking.cpadm008" time=null value="%OPRWEB01.08.612">
        <img notab src="../images/DateLookup.gif" class="Icon"
         alt="Calendar" date="CancelBooking.cpadm008"></td></tr>
</table>
</div>
<div name=preadmis id=preadmis style="display: none;" class="DisplayLocation">
<table width=100%>
  <tr><td width=50% class=DataLabel>Do you want to cancel the preadmission?</td>
      <td>Yes<input type=radio name=pread002 value="Y" checked
              onclick="CheckPread();">
          No <input type=radio name=pread002 value="N" 
              onclick="CheckPread();">
      </td></tr>

  <tr><td width=50% class=DataLabel>Reason for Patient Cancellation </td>
      <td align=left>
        <select name="pread003" class=Mandatory title="Cancellation Reason"
         id=pread003>
        <option> </option>
        %STANDARD.01.007.PC
        </select>
</table>
</div>

<span id=ShowReasonHeading style="display:none">

   <td class=DataLabel>Reason</td>

</span>

<span id=ShowReasonField style="display:none">
   <td class=DataField>
    <input type=hidden name=updfld06 value="06">
    <select name=reasfc06 class="Mandatory" title="Reason">
    <option></option>
    %STANDARD.01.007.FX
    </select></td>

</span>

<span id=TheatreRequestSPAN style="display:none">
<table width=95% align=center border=0>
  <tr>
    <td class=DataLabel width=50%>
      Do you want to return this patient to the <br>Request List?
    </td>
    <td class=DataField>
      Yes <input type=radio name=bkreq005 value="0" 
           onclick="document.CancelBooking.bkreq044.className='';">
      No <input type=radio name=bkreq005 value="2" checked
           onclick="document.CancelBooking.bkreq044.className='Mandatory';">
    </td>
  </tr>
  <tr>
    <td class=DataLabel>
      Request Cancellation Reason
    </td>
    <td class=DataField>
      <select name="bkreq044" class=Mandatory
       title="Request Cancellation Reason">
        <option> </option>
        %STANDARD.01.007.BC
      </select>
    </td> 
  </tr>
</table>
</span>

<script type="text/javascript">

  if ( "%OPRWEB01.08.404" == "1")  {
    waiting.innerHTML=waitdets.innerHTML;
  }
  if ( "%OPRWEB01.08.401" == "1")  {
    preadmission.innerHTML=preadmis.innerHTML;
  }
  if ( "%OPRWEB01.08.403" == "1")  {
    bookhd.innerHTML=bookhead.innerHTML;
    booking.innerHTML=bookdets.innerHTML;
  }
</script>
