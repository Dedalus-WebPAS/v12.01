Content-Type: text/html
Cache-Control: no-cache

<meta name="TemplateVersion" content="V12.01.00">
<meta name="TemplateHome" content="standard">
<script type="text/javascript">
function ResultLink(el,url) {
  if (el.style.backgroundColor!="grey") {
    el.setAttribute("saveBGC",el.style.backgroundColor);
    el.style.backgroundColor="grey";
    parent.AppendSingle(url);
  } else {
    parent.RemoveSingle(url);
    el.style.backgroundColor=el.getAttribute("saveBGC");
  }
}
</script>
%START.OF.PAGE
<body onload=InitTable();>
<div id=FilterLocation></div>
<div id=TableLocation></div>
<form name=PatientLinks method=get>
<input type=hidden name=reportno value=1>
<input type=hidden name=template value=004>
<input type=hidden name=urnumber value="%CLIWEB03.01.003">
<input type=hidden name=admissno value="%CLIWEB03.01.081">
<input type=hidden name=MenuType value="%CLIWEB03.01.088">
</form>
<span id=Tag1 style="display:none";>%CLIWEB03.01.106</span>
<span id=Tag2 style="display:none";>%CLIWEB03.01.108</span>

<script type="text/javascript">
function InitTable() {
  var FilterLocation = document.getElementById('FilterLocation');
  var Tag1=document.getElementById('Tag1').innerHTML;
  var Tag2=document.getElementById('Tag2').innerHTML;
  FilterLocation.innerHTML="<table cellspacing=0 cellpadding=0 border=0 width=100%><tr><td>"+
     "<form name=resLnkFrm action=cliweb03.pbl method=get>"+
     "<input type=hidden name=reportno value=1>"+
     "<input type=hidden name=template value=13>"+
     "<input type=hidden name=viewtype value=1>"+
     "<input type=hidden name=urnumber value='%CLIWEB03.01.003'>"+
     "<input type=hidden name=admissno value='%CLIWEB03.01.081'>"+
     "<table width=100% border=0 cellspacing=0 cellpadding=0>"+
     "<tr><td>"+
     "<input type=button value='<< Older' class='btn btn-default btn-primary'"+
     "onclick=\"location.href='%CLIWEB03.01.101.cliweb03.01.013';\"></td>"+
     "<td align=center>"+Tag1+"</td>"+
     "<td ><select name='diagtype' onchange='this.form.submit()'>"+Tag2+"</select></td>"+
     "<td align=right>"+
     "<input type=button value='Newer >>' class='btn btn-default btn-primary'"+
     "onclick=\"location.href='%CLIWEB03.01.102.cliweb03.01.013';\">"+
     "</td></tr></form></table></td></tr></table>";
//
// Create New Table Object
//  border, cellspacing, cellpadding, width, align
//
  t = new Table(0,0,3,"100%","center");
//
// Add Columns in Order Required
// Heading,Type,Display Column,Sort Column, Align, Icon, Link Column
//
  t.addColumn("Date & Time","DateTime",1,1,"left nowrap","add.png","0",150)
  t.addColumn("Result","String",2,2,"left ","","",280)
  t.addColumn("Status","String",5,5,"left nowrap","","",100)
  t.addColumn("Normal","Image",3,3,"center","ResultStatus","",60)
//
// Add Rows to Table (Output from Web Server)
//
   %CLIWEB03.01.103.cliweb10.06.005
   OrderColumn=0; 
   AscDsc=2;
   lastOrderColumn=OrderColumn;
   TableOutput(OrderColumn,AscDsc,lastrow);
}
//========================================================================
// Program   : PathologySelect.js
//
// Function  : Select pathology Result to Add to Document
//
// Modifications : 
//
// V10.04.01 02.07.2014 B.G.Ackland CAR 303287
//           Javascript for adding Pathology Results to Documents
// V10.03.01 02.04.2012 B.G.Ackland
//           New Copied from 10.01
//========================================================================
function Table(Border,Cellspacing,Cellpadding,Width,Align) {
   this.Border = Border;
   this.Cellspacing = Cellspacing;
   this.Cellpadding = Cellpadding;
   this.Width = Width;
   this.Align = Align;
   this.rows = new Array();
   this.addRow = _addTableRow;
   this.columns = new Array();
   this.addColumn = _addTableColumn;
   this.sortTable = _sortTable;
}
function _sortTable(Column,AscDsc) {
  SortOrderBy = t.columns[Column][3]
  if (AscDsc == 1) {
    switch(t.columns[Column][1]) {
      case "Date"      :  t.rows.sort(NumericSort); break;
      case "DateTime"  :  t.rows.sort(StringSort); break;
      case "Number"    :  t.rows.sort(NumericSort); break;
      case "Image"     :  t.rows.sort(StringSort); break;
      case "String"    :  t.rows.sort(StringSort); break;
    }
  }
  else {
    switch(t.columns[Column][1]) {
      case "Date"      :  t.rows.sort(RevNumericSort); break;
      case "DateTime"  :  t.rows.sort(RevStringSort); break;
      case "Number"    :  t.rows.sort(RevNumericSort); break;
      case "Image"     :  t.rows.sort(RevStringSort); break;
      case "String"    :  t.rows.sort(RevStringSort); break;
    }
  }
}
function NumericSort(a,b) {
  return a[SortOrderBy] - b[SortOrderBy];
}
function StringSort(a,b) {
  if (a[SortOrderBy] < b[SortOrderBy] ) { x = -1 }
  if (a[SortOrderBy] == b[SortOrderBy] ) { x = 0  }
  if (a[SortOrderBy] > b[SortOrderBy] ) { x = 1  }
  return x ;
}
function RevNumericSort(a,b) {
  return b[SortOrderBy] - a[SortOrderBy];
}
function RevStringSort(a,b) {
  if (a[SortOrderBy] < b[SortOrderBy] ) { x = 1 }
  if (a[SortOrderBy] == b[SortOrderBy] ) { x = 0  }
  if (a[SortOrderBy] > b[SortOrderBy] ) { x = -1  }
  return x ;
}
function _addTableColumn() {
  this.columns[this.columns.length] = new Array();
  var column = this.columns[this.columns.length-1];
  for(var i = 0; i < arguments.length; i++) 
     column[column.length] = arguments[i];
}
function _addTableRow() {
  this.rows[this.rows.length] = new Array();
  var row = this.rows[this.rows.length-1];
  for(var i = 0; i < arguments.length; i++) 
     row[row.length] = arguments[i];
}
function TableBody() {
 for(var i = 0; i < t.rows.length; i++) {
   RowClass="TableRowEven"
   if (i%2==1) { RowClass="TableRowOdd" }
   LinkHref = t.rows[i][0];
   TableString[TableString.length] = "<tr class=" + RowClass + " onclick='ResultLink(this,\""+LinkHref+"\");'>"
   for(var j = 0; j < t.columns.length; j++) {
     TableString[TableString.length] = "<td align=" + t.columns[j][4]  ;
     TableString[TableString.length] = " width=" + t.columns[j][7] + ">" ;
     LinkFlag = 0
     ImgString = t.columns[j][5];
     switch(t.columns[j][1]) {
       case "Date" :  
         FormatIcon(i);
         TableString[TableString.length] = FormatDate(t.rows[i][t.columns[j][2]]);
         break;
       case "DateTime" :  
         FormatIcon(i);
         TableString[TableString.length] = FormatDateTime(t.rows[i][t.columns[j][2]]);
         break;
       case "Image":  
         if (t.columns[j][5] == "") {
           ImageString=t.rows[i][t.columns[j][2]];
         }
         else {
           ImageString=t.columns[j][5] +
                       t.rows[i][t.columns[j][2]] + ".gif"
         }
         TableString[TableString.length] = FormatImage(ImageString);
         break;
       default    :   
         FormatIcon(i);
         TableString[TableString.length] = t.rows[i][t.columns[j][2]];
         if ( LinkFlag ) { TableString[TableString.length] = "</a>"; }
         break;
     }
     t.rows[i][t.columns[j][2]] 
     TableString[TableString.length] = " &nbsp</td>" ;
     }
   TableString[TableString.length] = "</tr>" ;
   }
}
function FormatIcon(i) {
 if (ImgString != "" ) {
//   ImgString="ResultIcon" + t.rows[i][6].substr(0,2) + ".gif"
   TableString[TableString.length] = "<img src=../images/" + ImgString ; 
   TableString[TableString.length] = " border=0 hspace=4 align=absmiddle>";
   if (LinkFlag ) { 
      LinkFlag = 0;
      TableString[TableString.length] = "</a>" ; }
 }
}
function FormatImage(Value) {
     return("<img src=../images/" + Value + ">");
}
function FormatDateTime(datetime) {
   yyyy = datetime.substr(0,4);
   mm = datetime.substr(4,2);
   dd = datetime.substr(6,2);
   time = datetime.substr(8,5);
   mth3=mm;
   switch(mm) {
     case "01": mth3="Jan"; break;
     case "02": mth3="Feb"; break;
     case "03": mth3="Mar"; break;
     case "04": mth3="Apr"; break;
     case "05": mth3="May"; break;
     case "06": mth3="Jun"; break;
     case "07": mth3="Jul"; break;
     case "08": mth3="Aug"; break;
     case "09": mth3="Sep"; break;
     case "10": mth3="Oct"; break;
     case "11": mth3="Nov"; break;
     case "12": mth3="Dec"; break;
   }
   EndLink="";
   if ( LinkFlag ) { EndLink += "</a>"; }
   return(dd + " " + mth3 +  " at " + time + EndLink);
}
function FormatDate(date) {
   yyyy = date.substr(0,4)
   mm = date.substr(4,2)
   dd = date.substr(6,2)
   mth3=mm
   switch(mm) {
     case "01": mth3="Jan"; break;
     case "02": mth3="Feb"; break;
     case "03": mth3="Mar"; break;
     case "04": mth3="Apr"; break;
     case "05": mth3="May"; break;
     case "06": mth3="Jun"; break;
     case "07": mth3="Jul"; break;
     case "08": mth3="Aug"; break;
     case "09": mth3="Sep"; break;
     case "10": mth3="Oct"; break;
     case "11": mth3="Nov"; break;
     case "12": mth3="Dec"; break;
   }
   EndLink="";
   if ( LinkFlag ) { EndLink += "</a>"; }
   return(dd + " " + mth3 + " " + yyyy + EndLink);
}
function TableOutput(OrderColumn,AscDsc,lastrow) {
   t.sortTable(OrderColumn,AscDsc);
   TableHeading(OrderColumn);
   TableBody();
   TableEnding();
}
function TableHeading(OrderColumn) {
  TableString = [];
  TableString[TableString.length] = "<table border=" + t.Border +
                " cellspacing=" + t.Cellspacing +
                " cellpadding=" + t.Cellpadding +
                " width=" + t.Width +
                " align=" + t.Align + " >";
  TableString[TableString.length] = "<tr>";
  if (isFinite(t.columns[0][7])) {
    TotalWidth=0;
    for(var i = 0; i < t.columns.length; i++) {
       TotalWidth+=parseInt(t.columns[i][7],10) }
    for(var i = 0; i < t.columns.length; i++) {
       t.columns[i][7]=(Math.round(1000*(parseInt(t.columns[i][7],10)/TotalWidth))/10)+'%' }
  }

  for(var i = 0; i < t.columns.length; i++) {
    TableString[TableString.length] = "<td class=HeadingCell align=" + t.columns[i][4] + 
                   " width=" + t.columns[i][7] + " >" ;
    if (t.columns[i][3] == -1) {
      if (OrderColumn == i) { TableString[TableString.length] = "<b>" }
      TableString[TableString.length] = t.columns[i][0] + "</td>"; }
    else {
      TableString[TableString.length] = "<a href='javascript:onClick=TableSort(" + i + ")'>"; 
      if (OrderColumn == i) { TableString[TableString.length] = "<b>" }
      TableString[TableString.length] = t.columns[i][0] + "</a></td>"; }
  }
  TableString[TableString.length] = "</tr>";
}
function TableEnding() {
  // these are defined in the html
  var TableLocation = document.getElementById('TableLocation');
  if (lastrow!=undefined) {
    if (lastrow=="0") {
       TableString[TableString.length] = "<tr><td colspan="
             + t.columns.length + " align=center><b>"
             + "<br>No More Records to Display </b></td></tr>";
    }
  }
  TableString[TableString.length] = "</table></div>";
 
  if (TableString.join) {
    TableLocation.innerHTML = TableString.join("");
  } else {
    TableStringX="";
    for (var i=0; i < TableString.length; i++) TableStringX+=TableString[i];
    TableLocation.innerHTML = TableStringX;
  }
}

function TableSort(OrderColumn) {
 if ( lastOrderColumn == OrderColumn ) { 
   if (AscDsc==1) {AscDsc=2;} else {AscDsc=1;} 
 } else { 
   AscDsc=1; 
 }
 lastOrderColumn=OrderColumn;
 TableOutput(OrderColumn,AscDsc,lastrow);
}
</script>
