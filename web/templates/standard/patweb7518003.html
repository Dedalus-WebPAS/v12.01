<meta name="TemplateVersion" content="V12.01.00">
<meta name="TemplateHome" content="standard">
<meta name="HelpFileName"    content="NoContextSet.html">
<meta name="CrossBrowser"      content="true">
<script type="text/javascript">
function CalcBal() {
  RoundNumber(SelectCode.tmjrn007,2);
  var serverURL = "../cgi-bin/comweb80.pbl?reportno=80" +
                  "&invoicen="+SelectCode.tmjrn003.value.replace(/ /g,"+") +
                  "&jouritem="+SelectCode.tmjrn004.value.replace(/ /g,"+") +
                  "&jourpatt="+SelectCode.tmjrn007.value.replace(/ /g,"+");
  var returnValue = RSExecute(serverURL);

  if (returnValue.status!=0) {
    return true;
  }
  ReturnValues=returnValue.return_value.split("|")
  document.getElementById("totalbal").innerText=ReturnValues[0];
}

function UpdateJournal() {
  if(!validateMandatory(document.SelectCode)) {
    return;
  }
//
  if(document.SelectCode.tmjrn004.value.substr(14,1)!="R") {

   if(document.SelectCode.tmjrn004.value.substr(14,1)=="A") {
      jrnl=(-1*document.SelectCode.tmjrn007.value);
   } else {
      jrnl=document.SelectCode.tmjrn007.value;
   }

   total=parseFloat(document.SelectCode.outstand.value) -
          parseFloat(jrnl);

   if (total < 0 ){
     if (!confirm("Warning: Account will be in credit!\n Ok to Continue ?")) {
      return;
     }
   }
  }
//
  document.SelectCode.updttype.value='C';
  document.all.SelectCode.submit();
}
function DeleteJournal() {
  document.SelectCode.updttype.value='D';
  document.SelectCode.submit();
}
function CheckInvoice() {
 var p=SelectCode;
 var URFlag="0";
 if (isWhitespace(p.tmjrn003.value)) { return ;}
 var Url = "../cgi-bin/patweb80.pbl?reportno=51" +
           "&valdcode="+p.tmjrn003.value.replace(/ /g,"+") +
           "&valdtype=1"; 
      
 var returnValue = RSExecute(Url);
 if (returnValue.status==0) {
   ReturnValue=returnValue.return_value.split("|");
   p.tmjrn003.value=ReturnValue[0];
   justifyRight(p.tmjrn003);
   if(isWhitespace(p.tmjrn001.value)) {
     p.tmjrn001.value=ReturnValue[2];
     URFlag="1";
   }
   if(isWhitespace(p.tmjrn002.value)) {
     p.tmjrn002.value=ReturnValue[1];
   }
   if(ReturnValue[2]!=p.tmjrn001.value ||
      ReturnValue[1]!=p.tmjrn002.value) {
      alert("This invoice is not for this U/R / Visit Number");
      p.tmjrn003.value="";
      p.tmjrn003.focus();
   }
   if(ReturnValue[10]=="1") {
      alert("This invoice is fully credited");
      p.tmjrn003.value="";
      p.tmjrn003.focus();
   }
   p.outstand.value=ReturnValue[4];
   if(URFlag==1) {
     CheckUR();
   }
   return true;
 } else {
  p.tmjrn003.value="";
  p.tmjrn003.focus();
 }
}
function ShowGST(){
   if(document.SelectCode.tmjrn004.value.substr(14,1)=="G") {
      GST.style.display="";
      GST.innerHTML=DisplayGST.innerHTML;
   } else {
      GST.innerHTML="";
      GST.style.display="none";
   }
}
</script>
</head>
%START.OF.PAGE
<body onload="PageLoad(event);CheckInvoice();ShowGST();CalcBal();">
<span class=DFrameTitleBar>
<img align="right" alt="Exit" class="MenuIcon" 
 src="../images/ExitIcon.gif" onclick="DFrameExit();">
Update Bulk Journal
</span>
<form name=SelectCode action=patweb75.pbl method=post>
<table align=center border=0 width=95% cellspacing=0 cellpadding=0>
<input type=hidden name=reportno value=18>
<input type=hidden name=template value=3>
<input type=hidden name=updttype>
<input type=hidden name=nextpage value=0>
<input type=hidden name=redirect value="patweb75.pbl?reportno=18&template=1">
<input type=hidden name=tmjrnbat value="%PATWEB75.18.001">
<input type=hidden name=outstand value="0">

<tr><td class=DataLabel width=30%>U/R Number</td>
    <td colspan=2><input type=text name="tmjrn001" title="U/R Number" size=10
         class="Readonly" readonly maxlength=8 value="%PATWEB75.18.002">
        <input type=text name="patientn" title="Patient Name" size=50
         maxlength=50 class=Readonly readonly>
    </td></tr>

<tr><td class=DataLabel>Visit Number</td>
    <td><input type=text name="tmjrn002" title="Visit Number" size=10
         class="Readonly" maxlength=8 readonly value="%PATWEB75.18.003">
    </td></tr>

<tr><td class=DataLabel>Invoice Number</td>
    <td><input type=text name="tmjrn003" title="Invoice Number" size=10
         class="Readonly" readonly maxlength=8 value="%PATWEB75.18.004">
    </td></tr>

<tr><td class=DataLabel>Date</td>
    <td><input type=text size=11 maxlength=12 name="tmjrn005" tabindex=-1
         value="%PATWEB75.18.006" class="Readonly" readonly title="Date">
    </td></tr>

</table>

<table align=center border=0 width=95% cellspacing=0 cellpadding=0>
<tr><td>&nbsp;</td></tr>

<tr><td width=30% class=DataLabel>Current Invoice Total</td>
    <td width=10% align=right class=DataField>$%PATWEB75.18.014</td>
    <td>&nbsp;</td></tr>

<tr><td class=DataLabel>Current Payment Total</td>
    <td align=right class=DataField>$%PATWEB75.18.015</td></tr>

<tr><td class=DataLabel>Current Journal Total</td>
    <td align=right class=DataField>$%PATWEB75.18.016</td></tr>

<tr><td class=DataLabel>Current Balance Outstanding</td>
    <td align=right class=DataField>$%PATWEB75.18.017</td></tr>

<tr><td>&nbsp;</td></tr>

</table>

<table align=center border=0 width=95% cellspacing=0 cellpadding=0>
<tr><td width=30% class=DataLabel>Type of Journal</td>
    <input type=hidden name=tmjrn004 value="%PATWEB75.18.005.1">
    <td colspan=2><input type=text size=30 maxlength=20 name="d_tmjrn004" tabindex=-1
         value="%PATWEB75.18.005.0" class="Readonly" readonly
         title="Type of Journal">
    </td></tr>

<tr><td class=DataLabel>Alternative Description</td>
    <td><input type=text name="tmjrn006" title="Alternative Description"
        size=32 maxlength=30 value="%PATWEB75.18.007">
    </td></tr>

</table>

<div id=GST></div>

<table cellspacing=0 cellpadding=2 border=0 width=95% align=center>

<tr><td class=DataLabel width=30%>Amount</td>
    <td colspan=2><input type=text name="tmjrn007" title="Amount"
         class="Number Mandatory" onchange="CalcBal();"
         min=0 max=9999999999.99 value="%PATWEB75.18.008"></td>
    </tr>    

<tr><td>&nbsp;</td></tr>

<tr><td class=DataLabel>Calculated Balance Outstanding</td>
    <td class="DataField" id="totalbal"></td>
   </tr>
</table>

<table cellspacing=0 cellpadding=2 border=0 width=95% align=center>
<tr><td>&nbsp;</td></tr>
<tr><td align=center colspan=2>
    <input type=button value="Update" class="button"
     name=updtbutt id=updtbutt
     onclick="tempDisable(this);UpdateJournal();">
    <input type=button value="Close" class="button"
     name=closbutt id=closbutt
     onclick='tempDisable(this);DFrameExitRefresh();'>
    <input type=button value="Delete" class="button"
     name=delebutt id=delebutt
     onclick="tempDisable(this);DeleteJournal();">
    </td></tr>
</table>
</form>

<span id="DisplayGST" style="display:none;">
<table align=center cellspacing=0 cellpadding=1 border=0 width=95%>
<tr><td class=DataLabel width=30%>GST Code</td>
    <td class=DataField><select class="SelectBig Mandatory" name=tmjrn008
     title="GST Code">
    <option></option>
    %PATWEB75.18.013
    </select></td></tr>
</table>
</span>
