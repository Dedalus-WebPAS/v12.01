<meta name="TemplateVersion" content="V12.01.00">
<meta name="TemplateHome"    content="standard">
<meta name="HelpFileName"    content="NoContextSet.html">
<meta name="CrossBrowser"    content="true">
<link rel="stylesheet" href="../html/postcode.css" type="text/css">
<script type="text/javascript" src="../js/AutoPostCode.js"> </script>
<script type="text/javascript" src="../js/patweb89.js"> </script>
<script type="text/javascript" src="../js/AddressSearch.js"></script>

<script type="text/javascript">
function checkVis() {
 if(document.UpdateForm.ptpra001.value!="" | document.UpdateForm.ptpra002!=""){
 if(document.UpdateForm.admissno.value==""){
   alert("Person Responsible will not be saved, no visit selected.");
  }
 }
}
// Default PRA to patient details
function PRASelf() {
  document.UpdateForm.ptpra002.value=document.HiddenForm.padd1.value
  document.UpdateForm.ptpra003.value=document.HiddenForm.padd2.value
  document.UpdateForm.ptpra004.value=document.HiddenForm.padd3.value
  document.UpdateForm.ptpra005.value=document.HiddenForm.padd4.value
  document.UpdateForm.ptpra006.value=document.HiddenForm.ppost.value
  document.UpdateForm.ptpra007.value=document.HiddenForm.ptelep.value
  //document.UpdateForm.ptpra008.value=document.HiddenForm.pteleb.value
  document.UpdateForm.ptpra010.value=document.HiddenForm.pmobil.value
  checkVis();
}
// Clear PRA details
function PRAClear() {
  document.UpdateForm.ptpra001.value="";
  document.UpdateForm.ptpra002.value="";
  document.UpdateForm.ptpra003.value="";
  document.UpdateForm.ptpra004.value="";
  document.UpdateForm.ptpra005.value="";
  document.UpdateForm.ptpra006.value="";
  document.UpdateForm.ptpra007.value="";
  document.UpdateForm.ptpra008.value="";
  document.UpdateForm.ptpra009.value="";
  document.UpdateForm.ptpra010.value="";
}
function PostUpdate() {
  if(validateMandatory(UpdateForm)) {
     UpdateForm.redirect.value="patweb07.pbl?reportno=06&template=004" +
     "&urnumber=" + document.UpdateForm.urnumber.value.replace(/ /g,"+") +
     "&admissno=" + document.UpdateForm.admissno.value.replace(/ /g,"+") +
     "&cpmiskey=" + document.UpdateForm.cpmiskey.value.replace(/ /g,"+")

  if(isWhitespace(document.UpdateForm.ptpra001.value)&&
     isWhitespace(document.UpdateForm.ptpra002.value)){
    alert("Person responsible for account will default to patient address.");
    PRASelf();
  }
    document.UpdateForm.submit();
  }
}
function PageLoadExtended(ev)
{
  PageLoad(ev);
  SetPostVars();
  InitPostCodes();
  InitAddressSearch();
}

//
// Functions called from AddressSearch.js
//
function InitAddressSearch() {
  // line1 - 'ptpra002'
  // line2 - 'ptpra003'
  // suburb - 'ptpra004'
  // state - 'ptpra005'
  // postcode - 'ptpra006'

  InitAddressSearchFields('trAddrSrch','ptpra002','ptpra003','ptpra004','ptpra005','ptpra006');
}
function ShowAddressSearch() {
  OpenAddressSearch('1',PopulateAddress,ClearSearchAddress);
}
function PopulateAddress(StreetLine, Suburb, State, Postcode) {
  LookupSuburb(Postcode);  // validate Postcode with our Lookup values
  if (SelectPC.length == 0) return;  // no match found

  LookupPostCode(Suburb);  // validate Suburb
  if (SelectPC.length == 0) return;  // no match found

  ToggleFieldReadOnly('ptpra002', true);
  ToggleFieldReadOnly('ptpra003', false);
  ToggleFieldReadOnly('ptpra004', true);
  ToggleFieldReadOnly('ptpra005', true);
  ToggleFieldReadOnly('ptpra006', true);

  SetFieldValue('ptpra002',StreetLine);
  SetFieldValue('ptpra003','');
  SetFieldValue('ptpra004',Suburb);
  SetFieldValue('ptpra005',State);
  SetFieldValue('ptpra006',Postcode);
}
function ClearSearchAddress() {
  ToggleFieldReadOnly('ptpra002', false);
  ToggleFieldReadOnly('ptpra003', false);
  ToggleFieldReadOnly('ptpra004', false);
  ToggleFieldReadOnly('ptpra005', false);
  ToggleFieldReadOnly('ptpra006', false);

  SetFieldValue('ptpra002','');
  SetFieldValue('ptpra003','');
  SetFieldValue('ptpra004','');
  SetFieldValue('ptpra005','');
  SetFieldValue('ptpra006','');
}
function SetPostVars() {
  suburb = UpdateForm.ptpra004;
  state = UpdateForm.ptpra005;
  postcode = UpdateForm.ptpra006;
}
</script>
</head>
%START.OF.PAGE
<body onLoad="PageLoadExtended(event);">
<span class=DFrameTitleBar>
<img align="right" alt="Exit" class="MenuIcon"
 src="../images/ExitIcon.gif" onclick="DFrameExit();">
Update Person Responsible For Account
</span>
<script type="text/javascript">
function SetFieldsPRA() {
  if (isWhitespace(UpdateForm.ptpra004.value)){
    return;
  }
  var OldSuburb=trim("%PATWEB89.01.169")
  if (UpdateForm.ptpra004.value!=OldSuburb){
    LookupPostCode(UpdateForm.ptpra004.value);
  }
}
</script>

<form name=UpdateForm action="patweb89.pbl" method=post style="margin:0">
<input type=hidden name=reportno value=2>
<input type=hidden name=template value=001>
<input type=hidden name=updatety value="4">
<input type=hidden name=urnumber value="%PATWEB89.01.003">
<input type=hidden name=admissno value="%PATWEB89.01.081">
<input type=hidden name=nextpage value="0">
<input type=hidden name=redirect value="%PATWEB89.01.001.patweb07.06.004">
<input type=hidden name=dummy value="">
<input type=hidden name=ptmas046 value="%PATWEB89.01.050">
<input type=hidden name=ptmas061 value="%PATWEB89.01.064">
<input type=hidden name=ptmas067 value="%PATWEB89.01.079.0">
<input type=hidden name=pmpmi006 value="%PATWEB89.01.806">
<input type=hidden name=pmpmi009 value="%PATWEB89.01.809">
<input type=hidden name=pmpmi012 value="%PATWEB89.01.812.0">
<input type=hidden name=pmpmi015 value="%PATWEB89.01.815">
<input type=hidden name=pmpmi036 value="">
<input type=hidden name=pmpmi037 value="%PATWEB89.01.837">
<input type=hidden name=pmpmi052 value="">
<input type=hidden name=pmpmi053 value="%PATWEB89.01.853">
<input type=hidden name=pmpmi062 value="%PATWEB89.01.862">
<input type=hidden name=pmpmi063 value="%PATWEB89.01.863">
<input type=hidden name=pmpmi064 value="%PATWEB89.01.864">
<input type=hidden name=pmpmi067 value="%PATWEB89.01.867.0">
<input type=hidden name=pmpmi068 value="%PATWEB89.01.868.0">
<input type=hidden name=cpmiskey value="%PATWEB89.01.999.001">
<input type=hidden name=ptcnhdps value="%PATWEB89.01.929">
<input type=hidden name=showflag value="1">
<input type=hidden name=ptcnuadv id=ptcnuadv
 value="%STANDARD.01.025.123.247.0.1">
<input type=hidden name=pmpmi113 id=pmpmi113 value="%PATWEB89.01.899.049">

<table border=1 cellpadding=0 cellspacing=0 width=100%>
<tr valign=top>
  <td class=HeadingCell align=center>Person Responsible for Account</td>
</tr>

<tr><td>
    <table border=0 cellspacing=0 cellpadding=2 width=100%>
    <tr><td class=DataLabel>Name</td>
        <td colspan=3>
          <input type="text" size="100" maxlength="80"
           name=ptpra001 id=ptpra001 value="%PATWEB89.01.166"
           onchange="checkVis();"></td>
    </tr>

    <tr id=trAddrSrch style="display:none">
      <td class=DataLabel nowrap>Search Address</td>
      <td><input type=text readonly size=42 tabindex="-1"
           style="cursor:pointer;text-align:center;"
           value="Click here to search for an address"
           title="Click here to search for an address"
           onclick="ShowAddressSearch();">
      </td>
    </tr>

    <tr><td class=DataLabel>Address</td>
        <td><input type="text" size="42" maxlength="35" title="Address Line 1"
             name=ptpra002 id=ptpra002 value="%PATWEB89.01.167"
             onchange="checkVis();UpCase(this);"></td>
        <td class=DataLabel>Relation</td>
        <td><select name=ptpra009 id=ptpra009>
              <option value=""></option>
              %STANDARD.01.030
            </select>
        </td>
    </tr>

    <tr><td class=DataLabel></td>
        <td><input type="text" size="42" maxlength="35" title="Address Line 2"
             name=ptpra003 id=ptpra003 value="%PATWEB89.01.168"
             onchange="UpCase(this);"></td>
        <td class=DataLabel>Home Ph</td>
        <td><input type="text" size="15" maxlength="20" 
             name=ptpra007 id=ptpra007 title="Home Phone"
             value="%PATWEB89.01.171"></td>
    </tr>

    <tr><td class=DataLabel>Suburb</td>
        <td><input type="text" size="42" maxlength="35" 
             name=ptpra004 id=ptpra004 title="Suburb"
             value="%PATWEB89.01.169" onblur="SetFieldsPRA();"></td>
        <td class=DataLabel>Work Ph</td>
        <td><input type="text" size="15" maxlength="20" 
             name=ptpra008 id=ptpra008 title="Work Phone"
             value="%PATWEB89.01.172"></td>
    </tr>

    <tr><td class=DataLabel>State</td>
        <td><input type="text" size="42" maxlength="35" 
             name=ptpra005 id=ptpra005 title="State" value="%PATWEB89.01.182">
        <td class=DataLabel>Mobile</td>
        <td><input type="text" size="15" maxlength="20" 
             name=ptpra010 id=ptpra010 value="%PATWEB89.01.199.012"></td>
    </tr>

    <tr><td id="postcode">Post Code</td>
        <td><input type="text" size="4" maxlength="8" 
             name=ptpra006 id=ptpra006 value="%PATWEB89.01.170"
             onchange="LookupSuburb(this.value);"></td>
        <td colspan=2 align=right>
        <input type=button class="button" value="Clear" 
         onclick="PRAClear();" tabIndex="-1">
        <input type=button class="button" value="Default" 
         onclick="PRASelf();" tabIndex="-1"> 
        </td></tr>
    </table>
</td></tr>

<tr>
    <td colspan=4 align=center>
    <input type=button value="Update" class="button"
     id="pat89sub" onclick="tempDisable(this);PostUpdate();">
    <input id="pat89can"type=button value="Cancel" 
     onclick="DFrameExitRefresh();" class="button">
    </td>
</tr>
</table>

<div id=SelectHeading></div>
<div id=SelectLocation></div>
</form>

<form name=HiddenForm>
<input type=hidden name=padd1 value="%PATWEB89.01.012">
<input type=hidden name=padd2 value="%PATWEB89.01.013">
<input type=hidden name=padd3 value="%PATWEB89.01.014">
<input type=hidden name=padd4 value="%PATWEB89.01.015">
<input type=hidden name=ppost value="%PATWEB89.01.016">
<input type=hidden name=ptelep value="%PATWEB89.01.017">
<input type=hidden name=pteleb value="%PATWEB89.01.018">
<input type=hidden name=pemail value="%PATWEB89.01.805">
<input type=hidden name=pmobil value="%PATWEB89.01.643">
</form>

<form name=PatientLinks method=get>
<input type=hidden name=reportno value=1>
<input type=hidden name=template value=004>
<input type=hidden name=regexstm value=102>
<input type=hidden name=newstand value=1>
<input type=hidden name=urnumber value="%PATWEB89.01.003">
<input type=hidden name=admissno value="%PATWEB89.01.081">
<input type=hidden name=MenuType value="%PATWEB89.01.088">
</form>

<script type="text/javascript">
   for (var i =0 ; i < document.UpdateForm.ptpra009.length; i++) {
     if (document.UpdateForm.ptpra009.options[i].value=="%PATWEB89.01.173") {
         document.UpdateForm.ptpra009.selectedIndex=i } };

   //Checks if the hospital is NZ, and if so changes Postcode to Domicile
   if (document.UpdateForm.ptcnhdps.value == 1) {
     document.getElementById("postcode").innerHTML = "Domicile";
   }

</script>
