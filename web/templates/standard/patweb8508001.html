<meta name="TemplateVersion" content="V12.01.00">
<meta name="TemplateHome" content="standard">
<meta name="HelpFileName" content="NoContextSet.html">
<meta name="CrossBrowser" content="true">
<script type="text/javascript" src="../js/patweb8508.js"></script>
<script type="text/javascript" src="../js/MrtLocations.js"></script>
<script type="text/javascript" src="../js/MrtMultiLocations.js"></script>
<script type="text/javascript" src="../js/MrtHomeLocns.js"></script>
<script type="text/javascript" src="../js/MrtMultiHomeLocns.js"></script>
</head>
%START.OF.PAGE
<body onload="PageLoad(event);SetHospitals();">
<form name=AddForm method=post action=patweb85.pbl style="margin:0">
<input type=hidden name=reportno value="8">
<input type=hidden name=template value="001">
<input type=hidden name=updatety value="A">
<input type=hidden name=redirect value="patweb85.pbl?reportno=8&template=1">
<input type=hidden name=nextpage value="6">
<input type=hidden name=ibcnmhos value="%STANDARD.01.025.000.043.1.1">
<input type=hidden name=d_recvlocn value="%PATWEB85.08.003">
<input type=hidden name=d_homelocn value="%PATWEB85.08.004.1">
<input type=hidden name=d_doctype value=" ">
<input type=hidden name=mrcnlzer value="%STANDARD.01.025.097.168.0.1">
<input type=hidden name=mrcnibap value="%STANDARD.01.025.097.165.0.1">
<input type=hidden name=recvdate value="%STANDARD.01.015">
<input type=hidden name=recvtime value="%STANDARD.01.016">
<input type=hidden name=superlev value="%PATWEB85.08.001">
<input type=hidden name=recdirec value="0">
<input type=hidden name=cat_TY value="TY">

<table border=0 align=center width=100% cellpadding=0 cellspacing=0> 
<tr><td class=HeadingCell align=center>
Receive Medical Records
</td>
<td class=HeadingCell align=right>
 <input type=button value="Chg Dflt Rec loc" name=ReqButton id=ReqButton
  class="button" onclick="ChangeReceive();">
</td>
</tr>
</table>

<table border=0 align=center width=90% cellpadding=1> 
<tr><td class=DataLabel>Received Date</td>
    <td class=DataField>%STANDARD.01.015 at Time %STANDARD.01.016
    </td>                                                  
    <td class=DataLabel>Received By</td>
    <td class=DataField>%STANDARD.01.009</td>
    </tr>

<tr><td class=DataLabel><div id=RecvHospitalTitle></div></td>
    <td><div id=RecvHospital></div></td>
    <td class=DataLabel><div id=HomeHospTitle></div></td>
    <td><div id=HomeHosp></div></td>
    </tr>

<tr><td class=DataLabel>Receiving Location</td>
    <td><select name=recvlocn id=recvlocn class="Mandatory"
         title="Location Required">  
        <option></option>
        </select></td> 
    <td class=DataLabel>Home Location</td>
    <td><select name=homelocn id=homelocn class=Mandatory title="Home Location">
        <option></option>
        </select></td>
    </tr>

<tr><td class=DataLabel>Receive Direct Reason</td>
    <td><select name=recvreas id=recvreas title="Receive Direct Reason">
        <option></option>
        %PATWEB85.08.006.0
        </select></td>
    <td class=DataLabel>Document Type</td>
    <td><select name=docmtype id=docmtype class=Mandatory title="Document Type">
        <option></option>
        %PATWEB85.08.005.2
        </select></td>
    </tr>

<tr><td class=DataLabel>Medical Record Scan</td>
    <td><input type=text name=RecordKey id=RecordKey maxlength=22 size=27
         onfocus="CheckMaxLength(this);"
         onkeyDown="SetMedEvent();" title="Record Key">
         <input type=hidden name=fullflag id=fullflag>
    </td>
    <td>U/R Number</td>
    <td><input type=text name=URNumber id=URNumber title="UR"
         onkeyDown="SetUrEvent();">
        <input type=hidden name=d1 id=d1>
        <input type=hidden name=d2 id=d2>
        <input type=hidden name=volumeno id=volumeno>
        <img src=../images/SearchIcon.gif class=Icon notab
         onclick="SearchPatient();">
    <tr>

<tr><td colspan=4 align=center><hr></td></tr>
</table>

<div id=Results></div>

<table border=0 align=center width=100% cellspacing=1>
<tr><td colspan=2 align=center><br>
    <input type=button value="Accept" name=ReqButton id=ReqButton
     class="button" onclick="PostReceiveRecords();">
    <input type=button value="Clear All" class="button" 
     onclick="location.reload()">
</td></tr>
</table>
</form>

<span id=ShowHomeHospTitle style="display:none">
  Home Hospital
</span>
    
<span id=ShowHomeHosp style="display:none">
  <select name=homehosp id=homehosp title="Home Hospital" class="Mandatory"
   onchange="SetHomeLocn(AddForm);">
   %PATWEB85.08.004.0
  </select>
</span>

<span id=ShowNoHospital style="display:none">
  <input type=hidden name=homehosp id=homehosp value="    ">
</span>

<span id=ShowReceiveHospTitle style="display:none">
  Receiving Hospital
</span>

<span id=ShowReceiveHosp style="display:none">
  <select name=recvhosp id=recvhosp title="Receive Hospital" class="Mandatory"
   onchange="SetReceiveLoc(AddForm);">
   %PATWEB85.08.002
  </select>
</span>

<span id=ShowNoReceiveHospital style="display:none">
  <input type=hidden name=recvhosp id=recvhosp value="    ">
</span>
<script>
 function OutputTable(ReturnCode) {
  if (ItemCnt>=99) {
    alert("Page Limit Reached");
    return;
  }
  if (isWhitespace(ReturnCode.value)) return;;

  var MrKeyRecord="";
  var PatientName="";
  var CurrentHosp="";
  var CurrentLoct="";
  var LastMovDate="";
  var Description="";
  var Flag=0;
//
//  Check for a Merged U/R
//
  p=document.AddForm
  if (p.URNumber.value!="") {
    var patname=new Object();
    var Merged=new Object();
    var Mergedur=new Object();
    var mrrecord=new Object();

    validateCodeMerge(28,p.URNumber,patname,Merged,Mergedur,mrrecord)

    if (patname.value!="") {
      if (Merged.value=="1") {
        if (mrrecord.value!="1") {
          alert("Warning : This U/R Number is merged with " + Mergedur.value);
          if (p.wahealth == undefined ) {
            p.URNumber.value=Mergedur.value;
            OutputTable(p.URNumber) // Load U/R that this U/R is merged with!
          } else { p.URNumber.value = "" }
          return;
        } else {
          alert("Warning : This U/R Number is merged with " + Mergedur.value +
               "\nU/R - " + p.URNumber.value + " still has a medical record, " +
                "please merge all medical records for this UR!");
          p.URNumber.value="";
          return;
        }
      }
    }
  } else {
    var patname=new Object();
    var Merged=new Object();
    var Mergedur=new Object();
    var mrrecord=new Object();
    var mrtscanur=new Object();
    mrtscanur.value=ReturnCode.value.substring(0,8);
    validateCodeMerge(28,mrtscanur,patname,Merged,Mergedur,mrrecord);
    if (patname.value!="") {
      if (Merged.value=="1") {
        alert("Warning : This U/R Number is merged with " + Mergedur.value);
        ReturnCode.value="";
        return
      }
    }
  }
//
//  Validate Medical record
//
  var serverURL   = "../cgi-bin/mrtweb01.pbl?reportno=14" +
                    "&mrkeyarr=" + ReturnCode.value.replace(/ /g,"+") +
                    "&docmtype=" + AddForm.docmtype.value.replace(/ /g,"+") +
                    "&volumeno=" + AddForm.volumeno.value.replace(/ /g,"+") +
                    "&homehosp=" + AddForm.homehosp.value.replace(/ /g,"+") +
                    "&location=" + AddForm.homelocn.value.replace(/ /g,"+")
    if(document.AddForm.fullflag=="1"){
    var serverURL = "../cgi-bin/mrtweb01.pbl?reportno=14" +
                  "&mrkeyarr=" + ReturnCode.value.replace(/ /g,"+") +
                  "&volumeno=" + AddForm.volumeno.value.replace(/ /g,"+") }

  var returnValue = RSExecute(serverURL);
  ReturnValue=returnValue.return_value.split("|");
  if (returnValue.status==0) {
//
//  Check for an already entered U/R
//
    for (var i=0; i < document.AddForm.length; i++) {
      if (document.AddForm.elements[i].name.match(/mrkeyarr/)) {
        if(document.AddForm.wahealth!=undefined ){
          enterur=ReturnValue[0].substring(0,20);
          checkey=document.AddForm.elements[i].value.substring(0,20);
        } else {
          enterur=ReturnValue[0].substring(0,8);
          checkey=document.AddForm.elements[i].value.substring(0,8);
        }
        if (enterur == checkey) {
          alert("Warning: U/R already entered!");
          document.AddForm.URNumber.value="";
          document.AddForm.URNumber.focus();
          break;
        }
      }
    }
//
    if(document.AddForm.wahealth!=undefined &&
       document.AddForm.superlev.value!="1") {
       vol_error=false;
       if(AddForm.homehosp.value.substr(0,3) != 
          ReturnValue[0].replace(/\+/g," ").substr(8,3)) {
          vol_error=true;
       }
       if(AddForm.homelocn.value.substr(0,4) !=
          ReturnValue[0].replace(/\+/g," ").substr(11,4)) {
          vol_error=true;
       }
       if(AddForm.docmtype.value.substr(0,3) !=
          ReturnValue[0].replace(/\+/g," ").substr(15,3)) {
          vol_error=true;
       }
       if(vol_error) {
         alert("Volume Not Found, UR - " +
                ReturnValue[0].replace(/\+/g," ").substring(0,8));
         return
       }
    }
//
    AddOutputArraySCol(ReturnValue[0],ReturnValue[1],ReturnValue[2],
                   ReturnValue[3],ReturnValue[4],ReturnValue[5],
                   ReturnValue[6],ReturnValue[7],ReturnValue[9],
                   ReturnValue[10],ReturnValue[32])
    OutputDivision()
    ReturnCode.value="";
    ReturnCode.focus();
    if (!isWhitespace(document.AddForm.volumeno.value)) {
      document.AddForm.volumeno.value="";
    }
  } else {
    ReturnCode.focus();
    ReturnCode.value="";
    if (!isWhitespace(document.AddForm.volumeno.value)) {
      document.AddForm.volumeno.value="";
    }
    ReturnCode.select();
  }
}
</script>
