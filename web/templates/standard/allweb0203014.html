<meta name="TemplateVersion" content="V12.01.00">
<meta name="TemplateHome" content="standard">
<meta name="HelpFileName" content="">
<meta name="CrossBrowser" content="true">
<script language="javascript" src="../js/allweb03.js"></script>
<script type="text/javascript">
function addTransitionDates()
{
  if(!validateMandatory(UpdateForm))
    return;;

  var dest = document.getElementById("alrhl004");
  var date = document.getElementById("alrhl005");
 
  var tcdc =  dest[dest.selectedIndex].value.substr(0,3);    // transition type
  var tcdd =  dest[dest.selectedIndex].innerHTML;

  var table = document.getElementById("referralTranstionCareTable");

  var tr = document.createElement("tr");
  var tdRemove = document.createElement("td");
  var tdDescription = document.createElement("td");
  var tdDate = document.createElement("td");

  var tdRemoveImage = document.createElement("img");
  var form = parent.document.getElementsByTagName("form");
  var obj = parent.document.createElement("input");
  var obj2 = parent.document.createElement("input");

  if(!validateTransitionDate(date,dest[dest.selectedIndex].value.substr(3,1))){ 
    return;
  }
  if(allowMultipleSameDiagnosisCode("document","tcdtr"+tcdc,tcdd,true))
  {
    tdRemoveImage.setAttribute("id","tcdi"+tcdc);
    tdRemoveImage.src="../images/DeleteIcon.gif";

    tdRemove.appendChild(tdRemoveImage);

    tdDescription.innerHTML = tcdd;
    tdDate.innerHTML = date.value;

    tr.setAttribute("id","tcdtr"+tcdc);
    tr.appendChild(tdRemove);
    tr.appendChild(tdDate);
    tr.appendChild(tdDescription);

    table.getElementsByTagName("TBODY")[0].appendChild(tr);

    obj.type="hidden";
    obj.name = "tcdtr"+tcdc;
    obj.id = "tcdtr"+tcdc
    obj.value = tcdc;
 
    obj2.type="hidden";
    obj2.name = "tcdat"+tcdc;
    obj2.id = "tcdat"+tcdc;
    obj2.value = date.value;

    form[0].appendChild(obj);
    form[0].appendChild(obj2);

    //blind event handler
    tdRemoveImage.onclick = function()
    {
       var temp = document.getElementById(tr.id);
       table.getElementsByTagName("TBODY")[0].removeChild(temp);
       form[0].removeChild(obj);
       form[0].removeChild(obj2)
    }
  }
}

function validateTransitionDate(tdate,ttype) {
  var form = parent.document.getElementsByTagName("form");
  var hiddenElement = form[0].getElementsByTagName("input");
  var LastType="";
  var dest = document.getElementById("alrhl004");

  for(var i = 0; i < hiddenElement.length; i++) {

   if(hiddenElement[i].type == "hidden" && 
      hiddenElement[i].name.match("tcdat")){
      if(SetDateYYYYMMDD(tdate.value) <
         SetDateYYYYMMDD( hiddenElement[i].value)) {
         alert("Transition date must be equal to or greater than " +
               "the last transition date");
         return false ;
      }
      for(var z =0 ; z < dest.length; z++) {
       if(document.UpdateForm.alrhl004.options[z].value.substr(0,3)== 
         hiddenElement[i].name.substr(5,3)) {
         LastType=document.UpdateForm.alrhl004.options[z].value.substr(3,1);
       } 
      }
   }
  }
  if(!isWhitespace(LastType) && (LastType==ttype)) {
   alert("Transition type must alternate between home and " +
         "bed based care");
   return false;
  }
  return true;
}

function allowMultipleSameDiagnosisCode(temp,id,description,boolean)
{
  var obj = null;

  if(boolean !== true)
  {
      obj = document.getElementById(id);

      if(obj)
      {
        alert("Warning diagnosis already exist: "+
               id.replace(/tcdtr/,"").replace(/ /g,"")+
               " "+description);

        return false;
      }
   }

   return true;
}

function sendTransitionDatesToParentFrame()
{
  renameTransitionDatesCGI("tcdtr");
  renameTransitionDatesCGI("tcdat");
  renameTransitionDatesCGI("tcdi");

  setBtnTransitionDateColor();
  DFrameExit();
}

function loadTransitionDates()
{
  var form = parent.document.getElementsByTagName("form");
  var hiddenElement = form[0].getElementsByTagName("input");
  var table = document.getElementById("referralTranstionCareTable");
  var temp = "";
  var id = "";

  table.onclick = function(e)
  {
    if(!e)
    {
      e = event;
      e.target = e.srcElement;
    }
    if(e.target.nodeName.toLowerCase() == 'img')
    {
       //the image id is one less - etc tcdi100
      removeObject(table,e.target.parentNode.parentNode);
    }
  }

  for(var i = 0; i < hiddenElement.length; i++)
  {
     if(hiddenElement[i].type == "hidden"
        && hiddenElement[i].name.match("tcdt"))
     {
         var tr = document.createElement("tr");
         var tdRemove = document.createElement("td");
         var tdDescription = document.createElement("td");
         var tdDate = document.createElement("td");
         var tdRemoveImage = document.createElement("img");
         var desc = new Object();
         var desc2 = new Object();
         
         var category = new Object();
         var code = new Object();

         var deptcode = document.getElementById("deptcode");

         if(allowMultipleSameDiagnosisCode("document",hiddenElement[i].id,
                                           "N/A ",true))
         {
           tdRemoveImage.setAttribute("id","tcdi"+hiddenElement[i].id.substr(5,3));
           tdRemoveImage.src="../images/DeleteIcon.gif";
           tdRemove.appendChild(tdRemoveImage);
          
           //category code for transition type
           category.value = "zW";
           code.value = hiddenElement[i].value;
           //remote script               
           validateCatCode(category,code,desc);
        
           tdDescription.innerHTML = desc.value;
           id = hiddenElement[i].name.substr(5,3);
           temp = parent.document.getElementById("tcdat"+id);
           tdDate.innerHTML = temp.value;
///
           tr.setAttribute("id",hiddenElement[i].id);

           tr.appendChild(tdRemove);
           tr.appendChild(tdDate);
           tr.appendChild(tdDescription);

           table.getElementsByTagName("TBODY")[0].appendChild(tr);
         }
     }
  }
}

function removeObject(table,obj)
{
  var temp;
  var temp1;

  var refCode;
  var refDate;

  temp = "tcdtr" + obj.id.substr(5,3);
  refCode = parent.document.getElementById(temp);

  temp1 = "tcdat" + obj.id.substr(5,3);
  refDate = parent.document.getElementById(temp1);

  
  var form =  parent.document.getElementsByTagName("form");
  var hiddenInputs = form[0].getElementsByTagName("input");

  for(var i = 0; i < hiddenInputs.length; i++)
  {
    if(hiddenInputs[i].type == "hidden" && hiddenInputs[i].name == temp) 
       form[0].removeChild(hiddenInputs[i]);
  }

  for(var i = 0; i < hiddenInputs.length; i++)
  {
    if(hiddenInputs[i].type == "hidden" && hiddenInputs[i].name == temp1)
       form[0].removeChild(hiddenInputs[i]);
  }

  table.getElementsByTagName("TBODY")[0].removeChild(obj);

}

function setBtnTransitionDateColor()
{
  var form = parent.document.getElementsByTagName("form");
  var element = form[0].getElementsByTagName("input");
  var button = parent.document.getElementById("btnTransitionDates");

  for(var i = 0; i < element.length; i++)
  {
    if(element[i].type == "hidden" && element[i].name.match("tcdtr"))
    {
      button.style.color = "red";
      return;;
    }
  }

  button.style.color = "black";
}

function renameTransitionDatesCGI(name)
{
  var form = parent.document.getElementsByTagName("form");
  var element = form[0].getElementsByTagName("input");
  var j = 100;

  for(var i = 0; i < element.length; i++)
  {
    if(element[i].type == "hidden" && element[i].name.match(name))
    {
       element[i].name = name+j;
       element[i].id = name+j;
       j++;

    }
  }
}

function valDate(obj,str)
{
  checkDate(obj,str);

  //need to also valdiate date for SAC start Date to SAC end date
  //valid if obj.value date falls between the two ranges 
  //(start and end SAC dates). 
}
</script>
</head>

%START.OF.PAGE
<body onload="PageLoad(event);loadTransitionDates();">
<span class=DFrameTitleBar>
<img class=Icon border=0 align=right src=../images/ExitIcon.gif 
 onclick="sendTransitionDatesToParentFrame();">
Transition Care Dates
</span>
<div id=PageBodySection>
<form id=UpdateForm name=UpdateForm action="allweb03.pbl" method=post
 onsubmit='return validateMandatory(this)'>
<input type=hidden name=reportno value=3>
<input type=hidden name=template value=008>
<input type=hidden name=nextpage value=0>
<input type=hidden name=redirect value="">
<input type=hidden name=urnumber value='%ALLWEB02.03.003'>
<input type=hidden name=admissno value='%ALLWEB02.03.081'>
<input type=hidden name=updatety value="A">

<table align=center cellspacing=0 cellpadding=1 border=1 width=100%>
<tr>
  <td class="HeadingCell">Transition Date</td>
  <td class="HeadingCell" colspan=2>Transition Type</td>
</tr>
<tr>
  <td class="DataLabel">
    <input type="text" id="alrhl005" id=alrhl005 name="alrhl005" 
           class="Mandatory PastDate" size="10"
           value="%STANDARD.01.015"
           onblur="valDate(this,'Date');" title="Transition Date" />
    <img src=../images/DateTimeStamp.gif class=Icon 
         date=UpdateForm.alrhl005
         time=null />
    <img src=../images/DateLookup.gif class=Icon 
         date="UpdateForm.alrhl005" />
  </td>
  <td class="DataLabel">
    <select id="alrhl004" name="alrhl004" class="Mandatory" 
            title="Transition Type">
    <option></option>
      %ALLWEB02.03.619.2
    </select>
  </td>
  <td class="DataLabel">
    <input type="button" class="button" value="Add" 
           onclick="tempDisable(this); addTransitionDates();"/>
    <input type="button" class="button" value="Ok" 
           onclick="sendTransitionDatesToParentFrame()"/>
  </td>
</tr>
</table>
<br />
<div style="height:300px;overflow:auto;">
<table id="referralTranstionCareTable" border="1" width="99%">
<tr><td class="HeadingCell" width="10%">Remove</td>
<td class="HeadingCell">Transition Date</td>
<td class="HeadingCell">Transition Type</td>
</tr>
</table>
</div>
</form>
</div>
