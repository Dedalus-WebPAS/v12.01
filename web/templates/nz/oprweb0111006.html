<meta name="TemplateVersion" content="V12.01.00">
<meta name="TemplateHome" content="nz">
<meta name="HelpFileName" content="NoContextSet.html">
<meta name="CrossBrowser" content="true">
<script type="text/javascript" src="../js/oprweb01.js"></script>
%START.OF.PAGE
<script type="text/javascript">
function changeOperation(theForm) { 
for (var i = 0; i < theForm.operpref.length; i++) {
 if (theForm.operpref.options[i].selected == true) {
  theForm.elements["operdes1"].value=theForm.operpref.options[i].text }
 }
}
function changeAdmitDate(theForm) {   
for (var i = 0; i < theForm.patadmdt.length; i++) {
 if (theForm.patadmdt.options[i].selected == true) {
  theForm.elements["operdes3"].value="Admit:"+theForm.patadmdt.options[i].text }
  }
}
function CancelBooking(linkurl) {
  var Left=(document.body.clientWidth-640)/2;
  DFrameLink(linkurl,0,Left,640,290)
}
function Check(){
  if (!validateMandatory(UpdateForm))
    return;
  UpdateForm.bkrec006.disabled = false;
  UpdateForm.bkrec007.disabled = false;
  UpdateForm.patadmdt.disabled = false;
  UpdateForm.bkrec005.disabled = false;
  p = UpdateForm;
  validateWLSuspension(p.caseuniq,p.patadmdt,p.datefromwl,p.datetowl);
  if (p.datefromwl.value != '0')
  {
    alert("Error: Patient has a Suspension record for period \n" +
            "\t" + p.datefromwl.value  + " - " + p.datetowl.value);
    return;
  }
  if(ChkDateTime(UpdateForm.patadmdt,null,UpdateForm.bookdate,null))
     if(document.getElementById('admitnow').checked){
         admission = "%OPRWEB01.11.525";
         document.UpdateForm.nextpage.value="4";
         document.UpdateForm.redirect.value="patweb89.pbl?reportno=1&template=20"
         + "&urnumber="+document.UpdateForm.urnumber.value.replace(/ /g,"+")
         + "&admissno="+admission.replace(/ /g,"+");
         UpdateForm.submit();
     }
     else{
        UpdateForm.submit();
     }
  else{ 
     alert("Theatre Booking cannot be before Admission Date");
  }
}

function checkWatEntry(){
   if (UpdateForm.bkrec006.value != "") {
     UpdateForm.bkrec006.className="Readonly"
     UpdateForm.bkrec006.disabled=true
   }else {
     UpdateForm.bkrec006.focus()
   }
   if (UpdateForm.bkrec007.value != "") {
     UpdateForm.bkrec007.className="Readonly"
     UpdateForm.bkrec007.disabled=true
   }
}
function DisableIcon(field) {
  if (field.disabled == true) {
    alert(field.title+" is for display only");
  }
}
function validateMBSCode(OptionNumber,ReturnCode,ReturnName,Casekeys) {
  ReturnFunction="" ;
  ReturnName.value="";
  for (var i=4; i < validateMBSCode.arguments.length; i++) {
    if (typeof(validateMBSCode.arguments[i]) == 'function') {
      ReturnFunction=validateMBSCode.arguments[i] }
    else {
      validateMBSCode.arguments[i].value=""; }  }
  if (isWhitespace(ReturnCode.value)) return;;
  var serverURL   = "../cgi-bin/oprweb01.pbl?reportno=" + OptionNumber +
                    "&valdcode=" + ReturnCode.value.replace(/ /g,"+") +
                    "&casekeys=" + Casekeys.value
  var returnValue = RSExecute(serverURL);
  if (returnValue.status==0) {
    ReturnValue=returnValue.return_value.split("|")
    ReturnName.value=trim(ReturnValue[0])
    j=0
    for (var i=4; i < validateMBSCode.arguments.length; i++) {
       if (typeof(validateMBSCode.arguments[i]) != 'function') {
         j++
         validateCode.arguments[i].value=ReturnValue[j] } }
    if (typeof(ReturnFunction) == 'function') {
       ReturnFunction() } }
  else {
    ReturnCode.select();
    return false;
     }
}
function DisplayPreadmNotes() {
  if (!isWhitespace(UpdateForm.bkreproc.value)) {
    document.getElementById('prenotesdet').style.display = "";
  } else {
    document.getElementById('prenotesdet').style.display = "none";
  }
}

//Checks to see whether admission is MH or non-MH and strips the inappropriate
//one from categories P and S
function MentalHealthFilter() {
              FilterMentalHealth(document.UpdateForm.mh_visit.value,
              document.UpdateForm.opdea037,'13');
              FilterMentalHealth(document.UpdateForm.mh_visit.value,
              document.UpdateForm.bkrec019,'14');
}

</script>
</head>
<body onload="PageLoad(event);checkWatEntry();UpdateForm.patclaim.focus();
              DisplayPreadmNotes(); MentalHealthFilter()">
<span class="DFrameTitleBar">
<img align="right" alt="Exit" class="MenuIcon"
 src="../images/ExitIcon.gif" onclick="DFrameExit();" />
Update Theatre Booking
</span>

<div id="PageBodySection" style="overflow: auto;">

<form name="UpdateForm" onSubmit="return validateMandatory(this);"
 action="oprweb01.pbl" method="post"  style="margin:0">
<input type="hidden" name="reportno" value="12" />
<input type="hidden" name="template" value="1" />
<input type="hidden" name="urnumber" value="%OPRWEB01.11.203" />
<input type="hidden" name="casekeys" value="%OPRWEB01.11.001" />
<input type="hidden" name="bookdate" value="%OPRWEB01.11.102" />
<input type="hidden" name="prevconf" value="%OPRWEB01.11.806" />
<input type="hidden" name="nextpage" value="0" />
<input type="hidden" name="redirect">
<input type="hidden" name="datefrom" />
<input type="hidden" name="dateto" />
<input type="hidden" name="datefromwl" />
<input type="hidden" name="datetowl" />
<input type="hidden" name="ptmis068" value="%OPRWEB01.11.905.1" />
<input type="hidden" name="caseuniq" value="%OPRWEB01.11.710" />
<input type="hidden" name="opcnfdur" value="%STANDARD.01.025.113.002.0.1" />
<input type="hidden" name="bkreproc" value="%OPRWEB01.11.817">
<input type=hidden name="mh_visit" value="%OPRWEB01.11.074">

<table border="0" cellpadding="1" cellspacing="0" width="95%" align="center">
<tr><td width="15%" class="DataLabel">Surgeon   </td>
    <td ><a href='javascript:DoctorViewFrame("%OPRWEB01.11.104.003")'>
         <b>%OPRWEB01.11.104.002 &nbsp;</b></a></td>
    <td width="15%">Anaesthetist   </td>
    <td><a href='javascript:DoctorViewFrame("%OPRWEB01.11.116.003")'>
         %OPRWEB01.11.116.002</a></td></tr>

<tr><td width="15%" class="DataLabel">Theatre  </td>
    <td class="DataField"> %OPRWEB01.11.114.0 </td>
    <td class="DataLabel">Session Type       </td>
    <td class="DataField">%OPRWEB01.11.169.0  </td></tr>

<tr><td class="DataLabel">Date  </td>
    <td class="DataField">%OPRWEB01.11.106 %OPRWEB01.11.102    </td>
    <td class="DataLabel">Time  </td>
    <td class="DataField"> %OPRWEB01.11.103 to %OPRWEB01.11.108</td></tr>

<tr><td>&nbsp;</td><td>&nbsp;</td>
    <td class="DataLabel">Unit  </td>
    <td class="DataField"> %OPRWEB01.11.825.0</td></tr>

<tr><td colspan="4" align="center"><hr width="100%" /></td></tr>

<tr><td class="DataLabel">Pre-Admission</td>
    <td class="DataLabel">
    <input type="text" name="bkrec006" id="bkrec006" size="12" 
         maxlength="11" class=""
     value="%OPRWEB01.11.808" onblur="checkDate(this,'Date')"
     title="Pre-Admission Date" tabindex=1 />
    <img src="../images/DateLookup.gif" border="0" hspace="4" align="absmiddle"
    onclick='javascript:DateLookupFrame(bkrec006)'
     onfocus="javascript:DisableIcon(bkrec006);" tabindex="-1" />
    Time
    <input type="text" name="bkrec007" size="7" id="bkrec007"
     title="Pre-Admission Time" tabindex=2 value="%OPRWEB01.11.809" />
    <img src="../images/DateTimeStamp.gif"  border="0" hspace="4" align="absmiddle"  
    onclick="SetCurrentDateTime(bkrec006,bkrec007);"
    onfocus="javascript:DisableIcon(bkrec007);" tabindex="-1">
    <img src="../images/TimeLookup.gif" border="0" hspace="4" align="absmiddle"  
    onclick="TimeLookupFrame(bkrec007);"
    onfocus="javascript:DisableIcon(bkrec007);" tabindex="-1"> 
    </td>
    <td class="DataLabel">Confirmed Admission</td>
    <td class="DataLabel">
     <input type="text" name="patadmdt" id="patadmdt" 
            size="12" maxlength="11" class="Mandatory"
     onblur="checkDate(this,'Date')" title="Confirmed Admission" 
     value="%OPRWEB01.11.806" />
     <img src="../images/DateLookup.gif" border="0" hspace="4" align="absmiddle"
     onclick='javascript:DateLookupFrame(patadmdt)'
     onfocus="javascript:DisableIcon(patadmdt)" tabindex="-1">
    Time
    <input type="text" name="bkrec005" size="7" id="bkrec005"
            title="Admission Time" class="Mandatory"
            value='%OPRWEB01.11.807' tabindex="4" />
    <img src="../images/DateTimeStamp.gif"  border="0" hspace="4" align="absmiddle"
     onclick="javascript:SetCurrentDateTime(patadmdt,bkrec005);"
     onfocus="javascript:DisableIcon(bkrec005);" tabindex="-1" />
    <img src="../images/TimeLookup.gif" border="0" hspace="4" align="absmiddle"
    onclick="javascript:TimeLookupFrame(bkrec005);"
     onfocus="javascript:DisableIcon(bkrec005);" tabindex="-1" />
    </td></tr>

<tr><td class="DataLabel">Admitting Point</td>
    <td class="DataField">
    <select name="bokrx003" title="Admitting Point"  class="Mandatory" tabindex="4">
    <option></option>
    %OPRWEB01.11.603.2
    </select></td></tr>

<tr><td class="DataLabel">Exp.Post Op Ward</td>
    <td class="DataField">
    <select name="bokrx002" title="Exp.Post Op Ward" >
    <option></option>
    %OPRWEB01.11.602.2
    </select></td>
    <td class="DataLabel">Planned Length of Stay </td>
    <td class="DataLabel">
    <input type="text" name="bkrec033" size="4" maxlength="3" class="Integer"
           title="Planned Length of Stay"  
           tabindex="6" />(days)</td></tr>

<tr><td class="DataLabel">%STANDARD.01.017.P </td>
    <td class="DataField">
    <select name="bkrec019"
            title="%STANDARD.01.017.P "
            tabindex="7">
    <option></option>
    %OPRWEB01.11.823.2
    </select></td>
     <td class="DataLabel">Admission Source</td>
     <td class="DataField">
     <select name="opdea037" onchange="DisplayTrnSrc(this);"
             title="Admission Source" class="Mandatory" />
     <option></option>
     %OPRWEB01.11.755.2
     </select></td>
</tr>

<tr><td class="DataLabel">%STANDARD.01.017.CL</td>
    <td class="DataField">
 <select name="patclaim" title="%STANDARD.01.017.CL" class="Mandatory" tabindex="9" />
     <option></option>
     %OPRWEB01.11.827.9.1.10.2.X
     </select></td>
     <td class="DataLabel"><div id=TranSrcHeading></div></td>
     <td class="DataField"><div id=TranSrc></div></td></tr>

<tr valign="top">
    <td class="DataLabel">Anaesthetic Type</td>
    <td><select name="operanae" 
             title="Anaesthetic"
             class="Mandatory"
             tabindex="10" />
    <option></option>
    %OPRWEB01.11.006.2
    </select></td>
    <td class="DataLabel"> Duration </td>
    <td><div id="Duration"></div></td>
    </tr>

<tr><td class="DataLabel">Procedure</td>
    <td><input type=text name="operprv1" size="9" id="operprv1" 
           onblur="validateCode(7,operprv1,mbsdesc1);"
           title="Expected MBS Item 1"
           tabindex="12" />
        <input type="text" class="ReadOnly" readonly name="mbsdesc1" size="35"
           title="Expected MBS Item 1 Name" id="mbsdesc1"
           value="%OPRWEB01.11.721.0" />
     <img src="../images/SearchIcon.gif"
     onclick="Icd10ProSearchFrame(operprv1,mbsdesc1)"></td>
    <td class="DataLabel"> Blood Type </td>
    <td><select name="bokrx032" 
             title="Blood Type">
    <option></option>
    %OPRWEB01.11.632.2
    </select>
    </td></tr>


<tr><td></td><td><input type="text" name="operprv2" size="9" id="operprv2"
           onblur="validateCode(7,operprv2,mbsdesc2);"
           title="Expected MBS Item 2"
           tabindex=13>
    <input type="text" readonly name="mbsdesc2" size="35" id="mbsdesc2"
           title="Expected MBS Item 2 Name" class="ReadOnly"
           value="%OPRWEB01.11.722.0" />
    <img src="../images/SearchIcon.gif"
     onclick="Icd10ProSearchFrame(operprv2,mbsdesc2)" /></td>
    <td class="DataLabel">Infection Status </td>
    <td><select name="operknow" 
             title="Infection Status">
    <option></option>
    %OPRWEB01.11.740.2
    </select>
    </td></tr>


<tr><td></td><td><input type="text" name="operprv3" size="9" id="operprv3"
           onblur="validateCode(7,operprv3,mbsdesc3);"
           title="Expected MBS Item 3"
           tabindex="14" />
    <input type="text" readonly name="mbsdesc3" size="35" id="mbsdesc3"
           title="Expected MBS Item 3 Name" class="ReadOnly" 
           value="%OPRWEB01.11.723.0" />
    <img src="../images/SearchIcon.gif"
     onclick="Icd10ProSearchFrame(operprv3,mbsdesc3);"></td>
    <td class="DataLabel">Equipment Req 1</td>
    <td><select name="opdea032" 
             title="Equipment Required 1">
    <option></option>
    %OPRWEB01.11.745.2
    </select>
    </td></tr>

<tr valign="top">
    <td class="DataLabel">Full Description</td>
    <td><input type="text" size="55" maxlength="80" name="operdes1" 
           title="Operation Description 1"
           tabindex="15" /></td>
    <td class="DataLabel">Equipment Req 2</td>
    <td><select name="opdea033" 
             title="Equipment Required 2">
    <option></option>
    %OPRWEB01.11.746.2
    </select>
    </td></tr>

<tr><td></td><td><input type="text" size="55" maxlength="80" name="operdes2" 
           title="Operation Description 2" value="%OPRWEB01.11.050"
           tabindex="17" /></td>
    <td class="DataLabel">Equipment Req 3</td>
    <td><select name="opdea035" 
             title="Equipment Required 3">
    <option></option>
    %OPRWEB01.11.749.2
    </select>
    </td></tr>

<tr><td></td><td><input type="text" size="55" maxlength="80" name="operdes3" 
           title="Operation Description 2"
           tabindex="18" /> </td>
    <td class="DataLabel">Equipment Loaned</td>
    <td><select name="opdea034" 
             title="Equipment Loaned">
    <option></option>
    %OPRWEB01.11.747.2
    </select>
    </td></tr>

<tr><td class="DataLabel">Prosthesis Required</td>
    <td colspan="3">
    <input type="text" size="40" maxlength="40" name="opercomm"
           title="Operation Comment" tabindex="19" value="%OPRWEB01.11.728" />
    </td>
</tr>
<tr><td class="DataLabel">Comments</td>
    <td colspan="3">
<textarea wrap="hard" cols="60" rows="3" name="opcom011">%OPRWEB01.11.743.011</textarea>
    </td></tr>

<tr id=prenotesdet valign=top><td class=DataLabel>Waiting List Pre-admission Notes</td>
  <td class=DataField colspan=3>
    <textarea wrap=virtual name=prenotes class=Readonly readonly
      cols=60 rows=3>%OPRWEB01.11.458</textarea>
  </td></tr>

<tr id="p_adm_now"><td class=DataLabel>Create Pre-admission now</td>
 <td><input type=checkbox id=admitnow checked></td>
 <td>&nbsp;</td>
 <td>&nbsp;</td>
</tr>

<tr><td colspan="4" align="center">
  <input type="button" class="button" value="Ok" onclick="Check();" />
  <input type="button" class="button" value="Cancel" onclick="DFrameClose();" />
    </td></tr>
</table>

<script type="text/javascript">
function init(){
 validateCode(7,UpdateForm.operprv1,UpdateForm.mbsdesc1);
 validateCode(7,UpdateForm.operprv2,UpdateForm.mbsdesc2);
 validateCode(7,UpdateForm.operprv3,UpdateForm.mbsdesc3);
 DisplayTrnSrc(UpdateForm.opdea037);
}
   document.UpdateForm.bkrec033.value="%OPRWEB01.11.830" ;
   document.UpdateForm.operprv1.value="%OPRWEB01.11.046" ;
   document.UpdateForm.operprv2.value="%OPRWEB01.11.047" ;
   document.UpdateForm.operprv3.value="%OPRWEB01.11.048" ;
   document.UpdateForm.operdes1.value="%OPRWEB01.11.049" ;
   document.UpdateForm.operdes2.value="%OPRWEB01.11.050" ;
   document.UpdateForm.operdes3.value="%OPRWEB01.11.051" ;
   for (var i =0 ; i < document.UpdateForm.patadmdt.length; i++) {
     if (document.UpdateForm.patadmdt.options[i].value=="%OPRWEB01.11.036") {
         document.UpdateForm.patadmdt.selectedIndex=i } };

   document.UpdateForm.patclaim.focus();
</script>

</div>
</form>

<span id="SDuration" style="display:none">
    <select name="operexpd" id="Soperexpd"
             title="sduration Operation Expected Duration"
             class="Mandatory"
             tabindex="11">
    <option value=""></option>
    <option value="  10">10 min</option>
    <option value="  20">20 Min</option>
    <option value="  30">30 min</option>
    <option value="  40">40 min</option>
    <option value="  50">50 min</option>
    <option value="  60">60 min</option>
    <option value="  70">70 min</option>
    <option value="  80">80 min</option>
    <option value="  90">90 min</option>
    <option value=" 100">100 min</option>
    <option value=" 110">110 min</option>
    <option value=" 120">120 Min</option>
    <option value=" 130">130 min</option>
    <option value=" 140">140 min</option>
    <option value=" 150">150 min</option>
    <option value=" 160">160 min</option>
    <option value=" 170">170 min</option>
    <option value=" 180">180 min</option>
    <option value=" 190">190 min</option>
    <option value=" 200">200 min</option>
    <option value=" 210">210 min</option>
    <option value=" 220">220 min</option>
    <option value=" 230">230 min</option>
    <option value=" 240">240 min</option>
    <option value=" 250">250 min</option>
    <option value=" 260">260 min</option>
    <option value=" 270">270 min</option>
    <option value=" 280">280 min</option>
    <option value=" 290">290 min</option>
    <option value=" 300">300 min</option>
    <option value=" 310">310 min</option>
    <option value=" 320">320 Min</option>
    <option value=" 330">330 min</option>
    <option value=" 340">340 min</option>
    <option value=" 350">350 min</option>
    <option value=" 360">360 min</option>
    <option value=" 370">370 min</option>
    <option value=" 380">380 min</option>
    <option value=" 390">390 min</option>
    <option value=" 400">400 min</option>
    <option value=" 410">410 min</option>
    <option value=" 420">420 min</option>
    <option value=" 430">430 min</option>
    <option value=" 440">440 min</option>
    <option value=" 450">450 min</option>
    </select>
</span>

<span id="FDuration" style="display:none">
<input type="text" name="operexpd" size="6" maxlength="4" min="0"
             title="Operation Expected Duration 1" class="Mandatory Integer"
              value="%OPRWEB01.11.038">
        (minutes)
</span>

<span id=transferhd style="display:none">
Transfer Source
</span>

<span id=transfersrc style="display:none">
<input type="text" size=7 maxlength=5 name=trnsfsrc id=trnsfsrc class=Mandatory
      title="Transfer Source" value="%OPRWEB01.11.993.0"
      onchange="validateCode(9,trnsfsrc,trandesc);">
     <input type=text size=27 name=trandesc id=trandesc 
            value="%OPRWEB01.11.993.1"
      class=Readonly readonly tabindex="-1">
     <img src="../images/SearchIcon.gif"
      onClick="TransferSourceFrame(trnsfsrc,trandesc,opdea037)">
</span>

<span id=transferblank style="display:none">
   <input type=hidden name=trnsfsrc value=" ">
</span>

<script type="text/javascript">

  var i, x, node;

  var Duration  = document.getElementById('Duration');
  var FDuration = document.getElementById('FDuration');
  var SDuration = document.getElementById('SDuration');

  if (document.forms['UpdateForm'].opcnfdur.value == "1") 
  {
    Duration.innerHTML     = FDuration.innerHTML;
  }
  else 
  {
    Duration.innerHTML = SDuration.innerHTML;
    node = document.getElementById('Soperexpd');
    for (i =0 ; i < node.length; i++) 
    {
      //x = trim(node.options[i].value)
      if (trim(node.options[i].value)  == trim(%OPRWEB01.11.038))
      {
         node.options[i].selected=true;
         break;
      } 
    }
  }
var bookingStatus = "%OPRWEB01.11.813";
if(bookingStatus=="Booked"){
   document.getElementById("p_adm_now").style.visibility="visible";
   document.getElementById("admitnow").checked=true;
}
else{
   document.getElementById("p_adm_now").style.visibility="hidden";
   document.getElementById("admitnow").checked=false;
}
</script>

<form name="PatientLinks" method="get">
<input type="hidden" name="reportno" value="9" />
<input type="hidden" name="template" value="002" />
<input type="hidden" name="urnumber" value="%OPRWEB01.11.203" />
<input type="hidden" name="admissno" value="%OPRWEB01.11.281" />
<input type="hidden" name="MenuType" value="%OPRWEB01.11.288" />
<input type="hidden" name="casekeys" value="%OPRWEB01.11.001" />
</form>
