<meta name="TemplateVersion" content="V12.01.00">
<meta name="TemplateHome" content="nz">
<meta name="HelpFileName" content="NoContextSet.html">
<meta name="CrossBrowser" content="true">
<script type="text/javascript" src="../js/discharge507.js"></script>
<script type="text/javascript">
function DisplayTrnSrc() {
 if (!isWhitespace(document.pat96pdf.dschstat.value)) {
  var i=document.pat96pdf.dschstat.selectedIndex;
  var ind=document.pat96pdf.dschstat.options[i].value.substring(4,5)
  var ind1=document.pat96pdf.dschstat.options[i].value.substring(3,4)
  if (ind!="1") {
    TranSrcDesc.innerHTML=""
    TranSrcField.innerHTML=transferblank.innerHTML;
    document.pat96pdf.trnsfsrc.value="";
  } else {
    TranSrcDesc.innerHTML="Transfer Destination"
    TranSrcField.innerHTML=transfersrc.innerHTML;
  }
 }
}
function DisplayAutopsy() {
  // Check indicator for deceased
  i=document.pat96pdf.dschstat.selectedIndex
  ind=document.pat96pdf.dschstat.options[i].value.substring(3,4)
  var msg="Warning Message\n" +
          "Patient will be discharged as 'Deceased'.\n" +
          "Depending on system configuration, any future bookings and/or " +
          "pre-admissions may be cancelled.";
  if (ind=="D") {
    alert(msg);
    document.pat96pdf.dschdind.value="1"
    Autop.innerHTML=autopsyDiv.innerHTML;
  }
  else {
    Autop.innerHTML="";
    document.pat96pdf.dschdind.value="0"}
}

function moveMREC() {
  var msg="Do you want to move Medical Record?";
  if (confirm(msg)) {
    document.pat96pdf.movemrec.value=1;
  } else {
    document.pat96pdf.movemrec.value=0;
  }
  document.pat96pdf.submit();
}
function discharge() {

 var form = document.pat96pdf;

  if(validateMandatory(pat96pdf)) {

     var d = form.theadate.value.substring(0,16);
     var td = new Date(d.substring(0,4),parseInt(d.substring(4,6))-1,d.substring(6,8),
              d.substring(8,10),d.substring(11,13),d.substring(14,16));
     var dd = new Date(form.trandate.options[form.trandate.selectedIndex].innerHTML 
              + " " + form.trantime.value);
     td.setDate(td.getDate() + parseInt(form.theadate.value.substring(16,17)));
     if(td>dd){
        alert("Discharge date/time must be greater than or equal to "
        + td.toString().substring(0,20));
        return;
     }
     document.pat96pdf.formactn.value="Discharge";
     SubmitHidden(pat96pdf); 
  }
}

</script>
</head>
%START.OF.PAGE
<body onload="PageLoad(event);FilterDischargeStatus();">
<div id=PageHeadingSection>
<div id=PatientHeading></div>
<script type="text/javascript">
PatientURN="%PATWEB96.05.003";
PatientVIS="%PATWEB96.05.081";
PatientNAM="%PATWEB96.05.002";
PatientSTA="%PATWEB96.05.086.078";
PatientALT="%PATWEB96.05.084";
PatientSEX="%PATWEB96.05.019";
PatientDOB="%PATWEB96.05.020";
PatientAGE="%PATWEB96.05.021";
PatientLOC="%PATWEB96.05.083";
PatientPRI="%PATWEB96.05.086.066.1";
PatientUNT="%PATWEB96.05.066.0";
DoctorCOD="%PATWEB96.05.082.003";
DoctorNAM="%PATWEB96.05.082.002";
PatientAID="%PATWEB96.05.086.090";
PatientIND="%PATWEB96.05.086.091";
PatientCUR="%PATWEB96.05.086.092";
PatientCLC="%PATWEB96.05.086.093.1";
PatientCLH="%STANDARD.01.017.CL";
PatientHFT="%PATWEB96.05.086.094";
PatientCDM="%PATWEB96.05.086.095";
PatientVDH="%PATWEB96.05.086.099.015";
InsertPatientHeader()
</script>
<div id=PatientMenu></div>
</div>
<div id=PageBodySection>

<form name=pat96pdf style=margin:0 %PATWEB96.05.201.001 
<input type=hidden name=reportno value=6>
<input type=hidden name=urnumber value="%PATWEB96.05.003">
<input type=hidden name=admissno value="%PATWEB96.05.101">
<input type=hidden name=formactn value="Discharge">
<input type=hidden name=movemrec value="0">
<input type=hidden name=redirect>
<input type=hidden name=mhdirect>
<input type=hidden name=nextpage value="7">
<input type=hidden name=dschrcct value="%PATWEB96.05.448.1">
<input type=hidden name=dschcom1 value="%PATWEB96.05.131">
<input type=hidden name=dschcom2 value="%PATWEB96.05.132">
<input type=hidden name=mh_visit value="%PATWEB96.05.863">
<input type=hidden name=theadate value="%PATWEB96.05.882">

<table  border=1 width=100% cellspacing=0 cellpadding=0>
  <tr><td class=HeadingCell align=center colspan=4>
      Patient Discharge Form</td></tr>
</table>
<table  border=0 width=100% cellspacing=0 cellpadding=4>
  <tr><td class=DataLabel>Discharge Date </td>
      <td><select name=trandate class=Mandatory title='Discharge Date'>
          %PATWEB96.05.202.001
          </select></td>
      <td class=DataLabel> Discharge Time</t>
      <td width=32%><input type=text size=8 name=trantime class="Mandatory"
           title="Discharge Time" id=trantime>
      <img src="../images/DateTimeStamp.gif" class=Icon
      onclick="SetCurrentDateTime(null,trantime);">
      <img src=../images/TimeLookup.gif class=Icon
      onclick="TimeLookupFrame(trantime);"></td></tr>
  <tr><td class=DataLabel> %STANDARD.01.017.D </td>
            <input type=hidden name=dschdind>
        <td><select name=dschstat onchange="DisplayAutopsy();DisplayTrnSrc();" 
             class=Mandatory
             title="Discharge Status">
            <option></option>
            %STANDARD.01.018.D .   .4
            </select> </td>
    <td class=DataLabel><div id=TranSrcDesc></div></td>
    <td><div id=TranSrcField></div></td>
  </tr>

<tr valign=top>
  <td class=DataLabel>Discharge Diagnosis</td>
  <td colspan=3>
    <input type=text name=dschdia1 size=50 value="%PATWEB96.05.121">
    <br>
    <input type=text name=dschdia2 size=50 value="%PATWEB96.05.122">
  </td>
</tr>

<tr><td class=DataLabel>%STANDARD.01.017.VR</td>
    <td><select name=dschirad title="%STANDARD.01.017.VR">
        <option> </option>
        %PATWEB96.05.445.2
     </select></td>
      <td colspan=2 width=50%><div id=Autop></div></td>
     </tr>
  <tr valign=bottom>
    <td colspan=4 width=100% align=center valign=bottom>
     <input type=button id=disbtn name=formactn value="Discharge"
     class="button" onclick="tempDisable(this);discharge();">
     <input type=button value="Cancel" class="button" onclick=history.go(-1)>
  </td></tr>
  </table>
  </td></tr>
  </table>
 </form>

<form name=PatientLinks method=get>
<input type=hidden name=reportno value=1>
<input type=hidden name=template value=004>
<input type=hidden name=urnumber value="%PATWEB96.05.003">
<input type=hidden name=admissno value="%PATWEB96.05.081">
<input type=hidden name=MenuType value="%PATWEB96.05.088">
<input type=hidden name=alert001 value="">
<input type=hidden name=mehpatnt value="%PATWEB96.05.221">
</form>
<script type="text/javascript">
   for (var i =0 ; i < document.pat96pdf.trantime.length; i++) {
     if (document.pat96pdf.trantime.options[i].value=="%PATWEB96.05.103") {
         document.pat96pdf.trantime.selectedIndex=i } };

//Check if the patient is a Mental Health Patient then redirect to Mentaldischarge screen (1=Yes)
if (document.PatientLinks.mehpatnt.value == "1") {
  document.pat96pdf.redirect.value="%PATWEB96.05.001.mehweb01.09.001";
  document.pat96pdf.mhdirect.value="%PATWEB96.05.001.mehweb01.09.001";
//  document.pat96pdf.redirect.value="%PATWEB96.05.001.xxxxxxxx.04.001";
} else {
  document.pat96pdf.redirect.value="%PATWEB96.05.001.patweb98.01.001";
  document.pat96pdf.mhdirect.value="%PATWEB96.05.001.patweb98.01.001";
}
</script>
<span id=transfersrc style="display:none">
        <input type="text" size=7 maxlength=5 name=trnsfsrc class=Mandatory
         title="Transfer Destination" id=trnsfsrc
         onchange="validateCode(9,trnsfsrc,trandesc);">
        <input type=text size=27 name=trandesc notab 
         id=trandesc class=Readonly readonly>
        <img src="../images/SearchIcon.gif" class=Icon
         onclick="TransferSourceFrame(trnsfsrc,trandesc)">
</span>
<span id=transferblank style="display:none">
   <input type=hidden name=trnsfsrc>
</span>
<span id=autopsyDiv style="display:none">
<table>
<tr>
<td>Autopsy<input type=checkbox name=dschautp value=1 checked></td>
</tr></table>
</span>
