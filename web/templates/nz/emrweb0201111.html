<meta name="TemplateVersion" content="V12.01.00">
<meta name="TemplateHome" content="nz">
<meta name="HelpFileName" content="NoContextSet.html">
<meta name="CrossBrowser" content="true">
<script type="text/javascript">
function UpdateDoct() {
  document.UpdateForm.webuseid.value = document.PatientLinks.webuseid.value;
  if (isWhitespace(document.UpdateForm.reasonfc.value)) { 
    alert("Reason for Change is a required field.\nPlease enter it now." )
    return;
  }
  document.UpdateForm.submit();
//  parent.top.content.location.reload();
}

function DeleteDoct() {
  if (isWhitespace(document.UpdateForm.reasonfc.value)) { 
    alert("Reason for Change is a required field.\nPlease enter it now." )
    return;
  }
  doctor="      ";
  admissno=document.UpdateForm.admissno.value;
  user=document.PatientLinks.webuseid.value;
  reason=document.UpdateForm.reasonfc.value;
  var serverURL   = "../cgi-bin/emrweb08.pbl?reportno=3" +
                    "&admissno=" + admissno.replace(/ /g,"+") +
                    "&doctcode=" + doctor.replace(/ /g,"+") +
                    "&webuseid=" + user.replace(/ /g,"+") +
                    "&updttype=" + "ALDOC" +
                    "&suprvisr=" + "1" +
                    "&reasonfc=" + reason.replace(/ /g,"+")
  var returnValue = RSExecute(serverURL);
  DFrameExitRefresh();
  parent.top.content.location.reload();
}

function DeleteLastDoct() {
  if (isWhitespace(document.LastDoctor.reasonfc.value)) {
    alert("Reason is a required field.\nPlease enter it now." )
    return;
  }
  if (isWhitespace(document.LastDoctor.d_seendate.value)) {
    alert("Invalid deletion - No doctor allocated to patient");
    return;
  }
  if (!confirm("Are you sure you want to delete this doctor?" +
            "\nOk to continue, Cancel to Abort")) {
   return;
  }
  doctor="      ";
  admissno=document.LastDoctor.admissno.value;
  user=document.PatientLinks.webuseid.value;
  reason=document.LastDoctor.reasonfc.value;
  var serverURL   = "../cgi-bin/emrweb08.pbl?reportno=3" +
                    "&admissno=" + admissno.replace(/ /g,"+") +
                    "&doctcode=" + doctor.replace(/ /g,"+") +
                    "&webuseid=" + user.replace(/ /g,"+") +
                    "&updttype=ALDOC&deltlast=1" +
                    "&reasonfc=" + reason.replace(/ /g,"+")
  var returnValue = RSExecute(serverURL);
  DFrameExitRefresh();
  parent.top.content.location.reload();
}

function SearchDoctor() {
  if (UpdateForm.emcndoct.value==1) {
    DoctorEmrSearchFrame(UpdateForm.frstdoct,UpdateForm.dummy3);
  }
  else {
    DoctorSearchFrame(UpdateForm.frstdoct,UpdateForm.dummy3);
  }
}

function doctorName(doctor) {
  if (isWhitespace(doctor.value)) { return;;}
  doctor=doctor.value.toUpperCase()
  admissno=document.PatientLinks.admissno.value;
  user=document.PatientLinks.webuseid.value;
//  validate doctor exists in patdo1af
  var serverURL   = "../cgi-bin/patweb80.pbl?reportno=3" +
                    "&valdcode=" + doctor.replace(/ /g,"+")
  var returnValue = RSExecute(serverURL);
  if (returnValue.status!=0) { 
    UpdateForm.frstdoct.value="";   
    UpdateForm.dummy3.value="";
    UpdateForm.frstdoct.focus();   
    return;
  }
//  validate doctor exists in emrdocaf
  if (UpdateForm.emcndoct.value==1) {
    var serverURL   = "../cgi-bin/emrweb08.pbl?reportno=11" +
                      "&valdcode=" + doctor.replace(/ /g,"+")
    var returnValue = RSExecute(serverURL);
    if (returnValue.status!=0) { 
      UpdateForm.frstdoct.value="";   
      UpdateForm.dummy3.value="";
      UpdateForm.frstdoct.focus();   
      return;
    }
  }
  ReturnValue=returnValue.return_value.split("|");
  UpdateForm.dummy3.value=ReturnValue[0];
}
</script>
</head>
%START.OF.PAGE
<body onload=PageLoad(event);>
<span class=DFrameTitleBar>
<img align="right" alt="Exit" class="MenuIcon"
 src="../images/ExitIcon.gif" onclick="DFrameExit();">
Change Doctor Seen Date/Time
</span>

<form name="UpdateForm" action="emrweb02.pbl" method="post">
<input type=hidden name="reportno" value="14">
<input type=hidden name="template" value="111">
<input type=hidden name="admissno" value="%EMRWEB02.01.081">
<input type=hidden name="urnumber" value="%EMRWEB02.01.003">
<input type=hidden name="updttype" value="ERROR">
<input type=hidden name=webuseid value="">
<input type=hidden name=calcwait value="">
<input type=hidden name=emcndoct value="%EMRWEB02.01.455">
<table width="95%" align=center border="0" cellspacing="0">

<table width="100%" border="0" cellspacing="0" cellpadding="0">
<tr>
  <td class=DataLabel width=25%>First Doctor Seen</td>
  <td class=DataLabel>
    <input type=text size=6 maxlength=6 name=frstdoct title="Doctor Code" 
     value="%EMRWEB02.01.475.0" onblur="UpCase(this);doctorName(frstdoct);">
    <input type=text size=39 name=dummy3 title="Doctor Name"
     readonly class=Readonly value="%EMRWEB02.01.475.1">
    <img class=Icon src="../images/SearchIcon.gif" onclick="SearchDoctor();">
    <img class=Icon src="../images/erase.gif" onclick="clrFields(frstdoct,dummy3);">
  </td>
</tr>

<tr>
  <td class=DataLabel>Doctor Seen Date </td>
  <td class=DataLabel>
    <input type="text" name=doctdate id="doctdate" size="11"
     value="%EMRWEB02.01.130.0" title="Doctor Seen Date">
    <img class=Icon src=../images/DateLookup.gif date=document.UpdateForm.doctdate>
    Time
    <input type="text" name=docttime id="docttime" size="8" value="%EMRWEB02.01.131"
     onblur="checkTime(this,'Doctor Seen Time')" title="Doctor Seen Time">
    <img class=Icon src=../images/TimeLookup.gif
     onclick="TimeLookupFrame(docttime);">
    <img class=Icon src="../images/stopwat1.gif"
     onclick="SetCurrentDateTime(doctdate,docttime);">
  </td>
</tr>

<tr>
  <td class=DataLabel>Reason for Change</td>
  <td>
    <select name=reasonfc title="Reason for Change" class="Mandatory">
    <option></option>
    %STANDARD.01.007.FW
    </select>
  </td>
</tr>
</table>

<table width="95%" align=center border="0" cellspacing="0">
<tr>
  <td align=center colspan=2> 
    <input type="button" value="Change" class="button" onclick="UpdateDoct();">
    <input type="button" value="Delete" class="button" onclick="DeleteDoct();">
    <input type="button" value="Cancel" class="button" onclick="DFrameClose();">
  </td>
</tr>
<tr>
  <td align=center colspan=2><hr></td>
</tr>
</table>
</form>

<form name="LastDoctor" action="emrweb02.pbl" method="post">
<input type=hidden name="reportno" value="14">
<input type=hidden name="template" value="111">
<input type=hidden name="admissno" value="%EMRWEB02.01.081">
<input type=hidden name="urnumber" value="%EMRWEB02.01.003">
<input type=hidden name="d_seendate" value="%EMRWEB02.01.130.0">

<table width="95%" align=center border="0" cellspacing="0">
<tr>
  <td class=DataLabel width=25%>Last Doctor Seen</td>
  <td>
    <input type=text size=39 title="Doctor Name"
     readonly class=Readonly value="%EMRWEB02.01.556.1">
  </td>
</tr>
<tr>
  <td class=DataLabel width=25%>Reason for Change</td>
  <td>
    <select name=reasonfc title="Reason for Change" class="Mandatory">
      <option></option>
      %STANDARD.01.007.FW
    </select>
  </td>
</tr>

<tr>
  <td align=center colspan=2><br>
    <input type="button" value="Delete Last Doctor Allocated" class="Bigbutton" 
     onclick="DeleteLastDoct();">
  </td>
</tr>
</table>
</table>
</form>


<form name=PatientLinks method=get>
<input type=hidden name=reportno value=1>
<input type=hidden name=template value=004>
<input type=hidden name=regexstm value=102>
<input type=hidden name=newstand value=1>
<input type=hidden name=urnumber value="%EMRWEB02.01.003">
<input type=hidden name=admissno value="%EMRWEB02.01.081">
<input type=hidden name=MenuType value="%EMRWEB02.01.088">
<input type=hidden name=webuseid value="%STANDARD.01.008">
</form>
</body>
<script type="text/javascript">
//
 Discharged="%EMRWEB02.01.147";
 if(Discharged==2 || Discharged==3){
   document.UpdateForm.calcwait.value="1";
 }
</script>
