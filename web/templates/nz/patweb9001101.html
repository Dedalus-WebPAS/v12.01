<meta name="TemplateVersion" content="V12.01.00">
<meta name="TemplateHome"    content="nz">
<meta name="HelpFileName"    content="NoContextSet.html">
<meta name="CrossBrowser" content="true">
<script type="text/javascript" src="../js/patweb90.js"></script>
<script type="text/javascript">
function newRegistration() {
  document.Registration.srchsnam.value=document.search.srchsnam.value;
  document.Registration.srchgnam.value=document.search.srchgnam.value;
  document.Registration.srchpage.value=document.search.srchpage.value;
  document.Registration.srchpdob.value=document.search.srchpdob.value;
  document.Registration.srchpsex.value=" ";
  if(document.search.srchpsex[1].checked==true) {
     document.Registration.srchpsex.value="M";
   }
  if(document.search.srchpsex[2].checked==true) {
     document.Registration.srchpsex.value="F";
  }
  document.Registration.submit();
} 
//
function updateParent(Name,urnumber,admissno) {
  ans=confirm("Allocate to Emergency Visit" +
              "\nU/R " + urnumber + 
              "\nName  " + Name )
  if (ans) {
    Allocate.urnumber.value=urnumber
    Allocate.admissno.value=top.content.PatientLinks.admissno.value
    Allocate.emvis147.value=top.content.PatientLinks.emvis147.value
    Allocate.updateky.value=top.content.UpdateForm.updateky.value
    Allocate.redirect.value="emrweb02.pbl?reportno=01&template=001"
     + "&admissno=" + Allocate.admissno.value.replace(/ /g,"+") 
    Allocate.submit()
  }
}
//----------------------------------------------------------------
// Function to ignore enter key press doing urnumber search 
//----------------------------------------------------------------
function onKeyDown() {
  if ( (event.keyCode == 13) && (event.srcElement.name=="urnumber") ) {
     event.keyCode = 0;
     event.returnValue = false; }
}
function setURNumber(urnumber) {
  if (isWhitespace(urnumber)){ return;}
  p=document.search
  justifyRight(p.urnumber)

  if (CheckEmrVisit(urnumber)) {

    if (validateCode(8,p.urnumber,p.test,p.dum1,p.dum2,p.dum3)) {

      ans=confirm("Allocate to Emergency Visit - " + p.test.value +
                  "\nU/R : " + trim(urnumber) + 
                  "\nDOB : " + trim(p.dum2.value) + 
                  "\nSEX : " + trim(p.dum1.value) ) 
      if (ans) {
        Allocate.urnumber.value=urnumber
        Allocate.admissno.value=top.content.PatientLinks.admissno.value
        Allocate.emvis147.value=top.content.PatientLinks.emvis147.value
        Allocate.updateky.value=top.content.UpdateForm.updateky.value
        Allocate.redirect.value="emrweb02.pbl?reportno=01&template=001"
         + "&admissno=" + Allocate.admissno.value.replace(/ /g,"+") 
        Allocate.submit();
      }
      else {
        search.urnumber.value="";
        search.template.value="101";
      }
    }
    else {
      search.urnumber.value="";
      search.template.value="101";
    }
  }
  else {
    search.urnumber.value="";
    search.template.value="101";
  }
}

//-----------------------------------------------------------------
// Function to check for any visits for this ur on todays date
//-----------------------------------------------------------------
function CheckEmrVisit(urnum) {
  if (isWhitespace(urnum)) {
     return true;
  }
  var serverURL = "../cgi-bin/emrweb08.pbl?reportno=17" +
                  "&valdurno=" + urnum.replace(/ /g,"+")
  var returnValue = RSExecute(serverURL);
  if (returnValue.status==0) {
    ReturnValue=returnValue.return_value.split("|")
    if(!isWhitespace(ReturnValue[0])) {
      if(!confirm("Patient has already presented on.\n" +
                 "Date - \t" + ReturnValue[1] + "\n" +
                 "U/R - \t" + ReturnValue[0].replace(/ /g,"") + "\n" +
                 "Visit - \t" + ReturnValue[2].replace(/ /g,"") + "\n" +
                 "Select OK to continue with registration.\n" +
                 "Select Cancel to abort registration.")) {
         return false;
      }
    }
  }
  return true;
}

function nhiSearch() {
  document.nhisrch.nzsrh003.value=document.search.srchtype.value;
  document.nhisrch.nzsrh004.value=document.search.srchsnam.value;
  document.nhisrch.nzsrh005.value=document.search.srchgnam.value;
  document.nhisrch.nzsrh006.value=document.search.srchpdob.value;
  document.nhisrch.nzsrh007.value=document.search.srchpage.value;
  document.nhisrch.nzsrh008.value=document.search.srcharan.value;
  for (var i =0 ; i < document.search.srchpsex.length; i++) {
    if (document.search.srchpsex[i].checked=="1" ) {
      document.nhisrch.nzsrh009.value=document.search.srchpsex[i].value;
    }
  }
  document.nhisrch.submit();
}
</script>
</head>
%START.OF.PAGE
<body onload="PageLoad(event);setUR();setTimeout('setDefault()',100);">
<span class=DFrameTitleBar>
<img align="right" alt="Exit" class="MenuIcon"
 src="../images/ExitIcon.gif" onclick="DFrameExitRefresh()">
Emergency Patient Search
</span>

<form name=nhisrch method=get action=nhiweb96.pbl style="margin:0"
onsubmit='return validateMandatory(this)'>
<input type=hidden name=reportno value=1>
<input type=hidden name=template value=101>
<input type=hidden name=norecord value=10>
<input type=hidden name=nzsrh001 value=0>
<input type=hidden name=nzsrh002 value="">
<input type=hidden name=nzsrh003 value="">
<input type=hidden name=nzsrh004 value="">
<input type=hidden name=nzsrh005 value="">
<input type=hidden name=nzsrh006 value="">
<input type=hidden name=nzsrh007 value="">
<input type=hidden name=nzsrh008 value="">
<input type=hidden name=nzsrh009 value="">
</form>
<form name=Allocate method=get action=emrweb02.pbl style="margin:0">
<input type=hidden name=reportno value=1>
<input type=hidden name=template value=1>
<input type=hidden name=formactn value="EX">
<input type=hidden name=updttype value="ALLEX">
<input type=hidden name=urnumber value="">
<input type=hidden name=admissno value="%PATWEB90.01.013">
<input type=hidden name=updateky value="">
<input type=hidden name=nextpage value="2">
<input type=hidden name=redirect value="emrweb02.pbl?reportno=01&template=001">
<input type=hidden name=emvis147>
</form>
<form name=Registration method=get action=patweb89.pbl style="margin:0">
<input type=hidden name=reportno value=05>
<input type=hidden name=template value=3>
<input type=hidden name=admissno value="%PATWEB90.01.013">
<input type=hidden name=srchsnam value="">
<input type=hidden name=srchgnam value="">
<input type=hidden name=srchpdob value="">
<input type=hidden name=srchpage value="">
<input type=hidden name=srchpsex value="">
</form>
<form name=search method=get action=patweb90.pbl style="margin:0"
    onsubmit="setUR();checkDate(srchpdob,'Date of Birth');setBirth(srchpdob);">
<input type=hidden name=reportno value=1>
<input type=hidden name=template value=101>
<input type=hidden name=norecord value="%PATWEB90.01.032">
<input type=hidden name=test> 
<input type=hidden name=dum> 
<input type=hidden name=dum1> 
<input type=hidden name=dum2> 
<input type=hidden name=dum3> 
<input type=hidden name=redirect value="patweb98.pbl?reportno=1&template=001">

<table align="center" width=100% border=1 cellspacing=0 
 cellpadding=0 bgcolor=#CCCCCC>
<tr><td>
<table width=100% border=0 cellpadding=0 cellspacing=0 bgcolor=#CCCCCC>
<tr><td class=DataLabel>U/R Number<br>
    <input type=text name=urnumber maxlength=8 size=10 tabindex=1
     onblur="setUR();setURNumber(this.value);"></td>
    <td class=DataLabel colspan=2>Surname<br>
    <input type=text name=srchsnam size=15 tabindex=2
     onblur="UpCase(this);TextBlurHandler(this);"></td>
    <td colspan=2 class=DataLabel>Given Name<br>
    <input type=text name=srchgnam size=15 tabindex=3
     onblur="UpCase(this);TextBlurHandler(this);"></td>

<td rowspan=2>
    <input type=radio name=srchpsex value=" " checked tabindex=9> All <br>
    <input type=radio name=srchpsex value="M"> Male <br>
    <input type=radio name=srchpsex value="F"> Female</td>
    <td align=center valign=middle rowspan=2>
    <input type=button value="NHI Search" class="button"
      onclick="nhiSearch()"><br>
    <input type=button value=Search class="button" tabindex=10
     name="btnSearch" id="btnSearch"
     onclick="tempDisable(this);validateSearchAndSubmit();"><br>
    <input type=reset value=Reset class="button" 
     onclick='location.href="patweb90.pbl?reportno=1&template=101&nodetail=R"'>
    </td></tr>
<tr><td class=DataLabel>Date of Birth<br>
       <input type="text" size="12" name="srchpdob" tabindex=5
       onblur="checkDate(this,'Date of Birth');setBirth(this);" ></td>
    <td><i>Age</i><br>
       <input type=text name=srchpage class="JustifyLeft Integer" 
         size=4 tabindex=6 title="Age"></td>
    <td class=DataLabel>Range<br>
       <select name=srcharan tabindex=7 > 
       <option value=2 selected>2 years</option>
       <option value=4>4 years</option>
       <option value=6>6 years</option>
       <option value=8>8 years</option>
       <option value=10>10 years</option>
       </select></td>
    <td class=DataLabel colspan=2>Search Type<br>
       <select name=srchtype tabindex=8 onchange="checkType();">
       <option value=1>Surname</option>
       <option value=2>Sound-Ex</option>
       <option value=3>Date of Birth</option>
       <option value=4>U/R Number</option>
       </select></td></tr>
</table>
%PATWEB90.01.011.300.0
<table width=100% border=1 cellspacing=0 cellpadding=0>
  <tr><td>
  <table width=100% bgcolor=#CCCCCC><tr>
     <td align=center>
     <input type=button value="<< Previous" class="button"
      onclick='location.href="%PATWEB90.01.002.101"'></td>
     <td align=center width=20%><div id=RegOption></div></td>
     <td align=center>
     <input type=button value="Next >>" class="button"
     onclick='location.href="%PATWEB90.01.001.101"'>
  </td></tr>
  </table>
</td></tr>
</table>
</td></tr>
</table>
</form>
<form name=linkForm action=patweb98.pbl method=get style="margin:0">
<input type=hidden name=reportno value=1>
<input type=hidden name=template value=101>
<input type=hidden name=urnumber value="">
<input type=hidden name=admissno value="">
<input type=hidden name=nodetail value="%PATWEB90.01.022">
</form>
<script type="text/javascript">
function setDefault() {
  if (document.all.BodyDivision!=undefined) {
     BodyDivision.style.height=document.body.clientHeight - 86 -
                               BodyDivision.offsetTop
  }
  if (document.linkForm.nodetail.value == "R") { return;}

   document.search.srchsnam.value="%PATWEB90.01.003";
   if (isWhitespace(document.search.srchsnam.value)){
     document.search.srchsnam.value=trim(top.content.UpdateForm.searchgn.value)
   }
   document.search.srchgnam.value="%PATWEB90.01.004";
   if (isWhitespace(document.search.srchgnam.value)){
     document.search.srchgnam.value=trim(top.content.UpdateForm.searchsn.value)
   }
   document.search.srchpage.value="%PATWEB90.01.006";
   document.search.srchpdob.value="%PATWEB90.01.007";
//
   if (isWhitespace(document.search.srchpdob.value)){
     document.search.srchpdob.value=trim(top.content.UpdateForm.searchpd.value)
   }
//
   for (var i =0 ; i < document.search.srcharan.length; i++) {
     if (document.search.srcharan.options[i].value==trim("%PATWEB90.01.008")) {
         document.search.srcharan.selectedIndex=i } };

   DefSearchType="%PATWEB90.01.009.2";
   if(DefSearchType=="6") {
     DefSearchType="2";
   }
   for (var i =0 ; i < document.search.srchtype.length; i++) {
     if (document.search.srchtype.options[i].value==DefSearchType) {
         document.search.srchtype.selectedIndex=i; 
         checkType(); }  };

   for (var i =0 ; i < document.search.srchpsex.length; i++) {
     if (document.search.srchpsex[i].value==
         top.content.UpdateForm.searchps.value.substr(0,1)) {
         document.search.srchpsex[i].checked="1" } };

  document.linkForm.admissno.value=top.content.PatientLinks.admissno.value;
  document.PatientLinks.admissno.value=top.content.PatientLinks.admissno.value;

  ind=document.search.srchsnam.value;
}
</script>
<form name=PatientLinks method=get style="margin:0">
<input type=hidden name=reportno value=1>
<input type=hidden name=template value=004>
<input type=hidden name=regexstm value=102>
<input type=hidden name=urnumber>
<input type=hidden name=admissno>
<input type=hidden name=MenuType value="11">
</form>
