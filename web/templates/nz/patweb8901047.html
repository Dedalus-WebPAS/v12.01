<meta name="TemplateVersion" content="V12.01.00">
<meta name="TemplateHome" content="nz">
<meta name="HelpFileName" content="NoContextSet.html">
<meta name="CrossBrowser" content="true">
<script type="text/javascript" src="../js/preadmission.js"></script>
<script type="text/javascript" src="../js/CaseTeamSelect.js"></script>
<script type="text/javascript">   
function SubmitAdm() {
  p=document.UpdateForm
  if(!checkSiteOpBooking(p.urnumber,p.ptmis001)) {
    return;
  }
  UpdateForm.ptmis004.value=UpdateForm.ptmis068.value;
  UpdateForm.ptmis009.disabled=false;

  document.UpdateForm.redirect.value="patweb98.pbl?reportno=01&template=043"
    + "&urnumber=" + document.UpdateForm.urnumber.value
    + "&admissno=";

  validateBedRequestUpdate(UpdateForm.admissno,UpdateForm.ptmis068,
                           UpdateForm.ptmis005,UpdateForm.bedrqqry);
  SetLinkACC(UpdateForm,"ADM");
  SubmitHidden(UpdateForm);
}

function valClaimCode() {
  validateCode(41,UpdateForm.urnumber,UpdateForm.claimc);
  for (var i =0 ; i < document.UpdateForm.ptmis027.length; i++) {
    if (document.UpdateForm.claimc.value==
        trim(document.UpdateForm.ptmis027.options[i].value.substr(0,3))) {
      document.UpdateForm.ptmis027.selectedIndex=i;
    }
  }
}

function displayDivEmr(OptionType,Field) {
  if (Field == "PT") {
    if (OptionType.value.substr(6,1) == "B") {
      document.UpdateForm.ptmis041.className="Mandatory";
    } else {
      document.UpdateForm.ptmis041.className="";
    }
    displayDiv(OptionType,Field);
  }
  AdmitMandatory();
}

function validateCodeOnChange(num,trnsfsrc,trndesc,ptmis009) {
  if (validateCode(num,trnsfsrc,trndesc))
  {
    validateTransSrcWithRef(trnsfsrc,ptmis009,trndesc);
  }
}

function AdmitMandatory() {
  if (document.UpdateForm.admitbox.checked == true) {
    document.UpdateForm.admitbox.value="1";
  } else {
    document.UpdateForm.admitbox.value="0";
  }
}
function getLOSDefault() {
  UpdateForm.ptmis030.value="0";
  var serverURL = "../cgi-bin/comweb80.pbl?reportno=99&remoteno=1" +
                  "&valdcode="+UpdateForm.ptmis011.value.replace(/ /g,"+");
  var returnValue = RSExecute(serverURL);
  if (returnValue.status!=0) {
    return true;
  }
  ReturnValues=returnValue.return_value.split("|")
  UpdateForm.ptmis030.value=ReturnValues[0];
  if (trim(UpdateForm.ptmis030.value)=="") { UpdateForm.ptmis030.value="0"; }
}
</script>
%START.OF.PAGE
<body onload="PageLoad(event);displayDivEmr(document.UpdateForm.ptmis011,'PT'); 
              displayDiv(document.UpdateForm.ptmis012,'AT'); 
              customLoad();valClaimCode();
              createSpecialtyArray();getHCPSpecialtySelectList();
              defaultSpecialty();">
<div id=PatientHeading></div>
<script type="text/javascript">
PatientURN="%PATWEB89.01.003";
PatientVIS="%PATWEB89.01.081";
PatientNAM="%PATWEB89.01.002";
PatientSTA="%PATWEB89.01.086.078";
PatientALT="%PATWEB89.01.084";
PatientSEX="%PATWEB89.01.019";
PatientDOB="%PATWEB89.01.020";
PatientAGE="%PATWEB89.01.021";
PatientLOC="%PATWEB89.01.083";
PatientPRI="%PATWEB89.01.086.066.1";
PatientUNT="%PATWEB89.01.066.0";
DoctorCOD="%PATWEB89.01.082.003";
DoctorNAM="%PATWEB89.01.082.002";
PatientAID="%PATWEB89.01.086.090";
PatientIND="%PATWEB89.01.086.091";
PatientCUR="%PATWEB89.01.086.092";
PatientCLC="%PATWEB89.01.086.093.1";
PatientCLH="%STANDARD.01.017.CL";
PatientHFT="%PATWEB89.01.086.094";
PatientCDM="%PATWEB89.01.086.095";
PatientVDH="%PATWEB89.01.086.099.015";
InsertPatientHeader()
</script>
<div id=PatientMenu></div>

<div id=PageBodySection>

<form name=UpdateForm method=post action=patweb89.pbl style=margin:0> 
<input type=hidden name="reportno" value=2>
<input type=hidden name="template" value="001">
<input type=hidden name="urnumber" value="%PATWEB89.01.003">
<input type=hidden name="admissno" value="%PATWEB89.01.081">
<input type=hidden name="emadmiss" value="%PATWEB89.01.081">
<input type=hidden name="mhadmflg" value="1">
<input type=hidden name="updatety" value="1">
<input type=hidden name="redirect" value="%PATWEB89.01.001.emrweb02.01.105">
<input type=hidden name="allocate" value="1">
<input type=hidden name="chckname" value="0">
<input type=hidden name="emradmit" value="0">
<input type=hidden name="emradmis" value="0">
<input type=hidden name="admitnow" value="1">
<input type=hidden name="newbmand" value="0">
<input type=hidden name="agebmand" value="0">
<input type=hidden name="ptcnueoc" value="%PATWEB89.01.925">
<input type=hidden name="claimc">
<input type=hidden name="exstward" value="%PATWEB89.01.449.1">
<input type=hidden name="ptcnhpcd" value="%PATWEB89.01.930">
<input type=hidden name="ptcnbage" value="%STANDARD.01.025.021.046.1.3">
<input type=hidden name="pbdate"   value="%PATWEB89.01.020">
<input type=hidden name="c_ptmis010" id="c_ptmis010"
       value="%PATWEB89.01.111.1">
<input type=hidden name="mh_visit" value="1">
<input type=hidden name="ptvis029" value="" id=ptvis029>
<input type=hidden name="ptvis030" value="" id=ptvis030>
<input type=hidden name="genpprov" id=genpprov>
<input type=hidden name="dummy1" value="" id=dummy1>
<input type=hidden name="admiscat" value="A ">
<input type=hidden name="bedstat1" id=bedstat1>
<input type=hidden name="ptmis004" id=ptmis004>
<input type=hidden name="warddesc" id=warddesc>
<input type=hidden name="userdef5" value="U5">
<input type=hidden name=bedrqqry value="">

<table border=0 width=100% cellspacing=1 cellpadding=1>
<tr><td class=HeadingCell align=center>
    Mental Health Patient Admission Details (From Emergency Visit)</td>
</tr>
</table>

<table border=1 width=100% cellspacing=1 cellpadding=1>
<tr><td>
    <table width=100% border=0 class=TableBody cellpadding=2 cellspacing=2>
    <tr><td width=50%>

      <table width=100% border=0 class=TableBody cellpadding=0 cellspacing=0>
      <tr height=20><td class=DataLabel>&nbsp;</td>
          <td class=DataField>&nbsp;</td>                              
      </tr>

      <tr><td class=DataLabel>Admission Date </td>                              
          <td class=DataLabel><input type=text size=12 name=ptmis001 tabindex=1
           value="%STANDARD.01.015" id=ptmis001
       onblur="checkDate(this,'AdmissionDate');ShowAdmissionWeight(UpdateForm);
               getHCPSpecialtySelectList();defaultSpecialty();"
           class="Mandatory" title="Admission Date">
          <img src=../images/CalendarLookup.gif 
           class=Icon onclick="DateLookupFrame(ptmis001);">
           Time <input type=text name=ptmis002 size=8 tabindex=2 
           class="Mandatory" title="Admission Time"  id=ptmis002
           onblur="checkTime(this,'AdmissionTime');" value="%STANDARD.01.016">
          <img src=../images/DateTimeStamp.gif class=Icon
           onclick="SetCurrentDateTime(null,ptmis002);">
          <img src=../images/TimeLookup.gif class=Icon
           onclick="TimeLookupFrame(ptmis002);">
          </td>
      </tr>

      <tr><td class=DataLabel>%STANDARD.01.017.P </td>
          <td><select name=ptmis011 tabindex=3 class="Mandatory SelectMed"
                      title="%STANDARD.01.017.P "
                      onchange="displayDivEmr(ptmis011,'PT');
                                getLOSDefault();"> 
              <option> </option>
               %PATWEB89.01.112.2
              </select>
          </td>
      </tr>

      <tr><td class=DataLabel>Referral Source</td>
          <td><select name=ptmis009 tabindex=4
               onchange="DisplayTrnSrc()"
               onblur="validateCodeOnChange(9,trnsfsrc,trandesc,ptmis009);"
               class="Mandatory SelectMed" title="Referral Source">
                 <option> </option>
                 %PATWEB89.01.110.2
              </select>
          </td>
      </tr>

      <tr>
          <td><div id=TranSrcHeading></div></td>
          <td><div id=TranSrc></div></td>
      </tr>

      <tr><td class=DataLabel>Referring HCP</td>
          <td><input type="text" size=10 maxlength=10 name=ptvis028 tabindex=5
               title="Referring HCP" id=ptvis028
               onchange="ReadDoc(18,0,ptvis028,genpname,ptvis029,
                                 genpprac,ptvis030,genpprov);">
              <input type=text size=25 notab readonly id=genpname name=genpname>
              <img src="../images/SearchIcon.gif" class=Icon
               onclick="GPHCPSearchFrame(ptvis028,genpname,genpprov,ptvis029,
                                         genpprac,ptvis030,0)">
              <img src="../images/erase.gif" class=Icon
               onclick="clrFields(ptvis028,genpname);">
          </td>
      </tr>

      <tr><td class=DataLabel>Practice</td>
          <td><input type=text name=genpprac size=35 readonly value=""
               title="Practice" id=genpprac>
              <img src="../images/SearchIcon.gif" class=Icon
               onclick="GPHCGSearchFrame(ptvis028,genpname,genpprov,
                                         ptvis029,genpprac,ptvis030)">
              <img src="../images/erase.gif" class=Icon
               onclick="clrFields(ptvis029,genpprac,ptvis030,genpprov);">
          </td>
      </tr>

      <tr><td class=DataLabel>Readmission Indicator</td>
          <td><select name=ptmis042 tabindex=6 class="SelectMed"
               title="Readmission Indicator">
                <option> </option>
                %PATWEB89.01.138.2
              </select>
          </td>
      </tr>     

      <tr><td class=DataLabel>Admission Type</td>
          <td><select name=ptmis012 tabindex=7 title="Admission Type" 
               class="Mandatory SelectMed" 
               onchange="displayDiv(ptmis012,'AT');"> 
                <option> </option>
                %PATWEB89.01.113.2
              </select>
          </td>
      </tr> 

      <tr><td class=DataLabel>Admitting Doctor</td>
          <td><input type=text size=11 maxlength=6 name=ptmis007 id=ptmis007
               tabindex=8 class="Mandatory" title="Admitting Doctor"
	       value="%PATWEB89.01.108.003"
	       onblur="UpCase(this); validateCode(3,ptmis007,doctnam2);
                       getHCPSpecialtySelectList();defaultSpecialty();"
              onchange="getCaseTeamByHCP(ptmis007,pmsvx146,n_pmsvx146,dummy1);">
              <input type=text readonly name=doctnam2 id=doctnam2
               value="%PATWEB89.01.108.002">
              <img src="../images/SearchIcon.gif" class=Icon
      onclick="HCPSelectOnClick(ptmis007,doctnam2,pmsvx146,n_pmsvx146,dummy1);">
              <img src="../images/erase.gif" class=Icon
               onclick="clrFields(ptmis007,doctnam2);">
          </td>
      </tr>

      <tr><td class=DataLabel>Case Team</td>
          <td><input type=text name=pmsvx146 size=11 maxlength=10
               title="Case Team" tabindex=9 id=pmsvx146
               onblur="validateCode2(7,pmsvx146,n_pmsvx146);"
               onchange="getHCPbyCaseTeam(pmsvx146,ptmis007,doctnam2,dummy1);">
              <input type=text name=n_pmsvx146 size=42 readonly id=n_pmsvx146
               class=Readonly tabindex=-1 title="Team Description">
              <img src="../images/SearchIcon.gif" class=Icon
       onclick="CaseTeamOnClick(pmsvx146,n_pmsvx146,ptmis007,doctnam2,dummy1);">
              <img src="../images/erase.gif" class=Icon
               onclick="clrFields(pmsvx146,n_pmsvx146);">
          </td>
      </tr>

      <tr><td class=DataLabel>%STANDARD.01.017.A </td>
          <td><select name=ptmis010 tabindex=10 id=ptmis010
               title="%STANDARD.01.017.A " class="Mandatory SelectMed">
                <option> </option>
                %PATWEB89.01.111.2
              </select>
	  </td>
      </tr>

      <tr><td class=DataLabel>%STANDARD.01.017.CL</td>
          <td><select name=ptmis027 title="%STANDARD.01.017.CL"
               class="Mandatory SelectMed" tabindex=11>
                <option> </option>
                 %PATWEB89.01.915.2
              </select>
           </td>
      </tr>

      <tr><td class=DataLabel>Inform GP</td>
          <td><select name=ptvis022 tabindex=12 class="SelectMed"
               title="Inform GP">
                <option value="0">No</option>
                <option value="1" selected>Yes</option>
              </select>
          </td>
      </tr>
      </table>
    </td>

    <td width=50%>
      <table width=100% border=0 class=TableBody cellpadding=0 cellspacing=0>
      <tr height=20>
          <td class=DataLabel><b>Admit Now?</b></td>
          <td class=DataField><input type="checkbox" name="admitbox" 
           value="0" checked notab onclick='AdmitMandatory();'>
          </td>
      </tr>

      <tr><td class=DataLabel>Reason For Admission </td>
          <td><input type=text name="ptmis020" size=50 tabindex=13
               value="%PATWEB89.01.404" maxlength=80>
          </td>
      </tr>

      <tr><td class=DataLabel>&nbsp; </td>
          <td><input type=text name="ptmis021" size=50 tabindex=14
               value="%PATWEB89.01.405" maxlength=50> 
          </td>
      </tr>

      <tr><td class=DataLabel>&nbsp;</td>
          <td>&nbsp;</td>
      </tr>

      <tr><td class=DataLabel>%STANDARD.01.017.HP</td>
          <td><select name="ptmis060" tabindex=16 class="Mandatory SelectMed"
               title="%STANDARD.01.017.HP">
                <option> </option>
                %PATWEB89.01.151.2
              </select>
          </td>
      </tr>
 
      <tr><td class=DataLabel>Health Agency</td>
          <td><select name="ptmis061" tabindex=17 class="Mandatory SelectMed"
               title="Hospital">
                <option> </option>
                %PATWEB89.01.152.4
              </select>
          </td>
      </tr>

      <tr><td>Admitting Point</td>
          <td><select name=ptvis046 tabindex=18 class="SelectMed"
               onchange="defaultWard()" title="Admitting Point">
                <option></option>
                %PATWEB89.01.290.2
              </select>
          </td>
      </tr>

      <tr><td class=DataLabel>Ward / Bed </td>
          <td><select name=ptmis068 tabindex=19 class="Mandatory SelectMed"
               title="Ward" id=ptmis068>
                <option> </option>
                %PATWEB89.01.449.2
              <select>
              <input type=text name=ptmis005 id=ptmis005 maxlength=3 size=3 title="Bed"
               value="%PATWEB89.01.106" onchange="UpCase(this);">
              <img src=../images/SearchIcon.gif class=Icon 
             onclick="WardBedSearchFrame(ptmis068,warddesc,ptmis005,bedstat1);">
          </td>
      </tr>

      <tr><td class=DataLabel> Planned Length of Stay</td>
          <td><input type=text size=5 maxlength=5 name=ptmis030 tabindex=20
               title='Planned Length of Stay' class=Integer
               onblur="checkInteger(this,this.value);">
          </td>
      </tr>

      <tr><td class=DataLabel>Diet</td>
          <td><select name=ptmis028 tabindex=21 class="SelectMed"
               title="Diet">
              <option></option>
              %PATWEB89.01.065.2
              </select>
          </td>
      </tr>

      <tr><td colspan=2 rowspan=4>
          <table width=100%>
          <tr><td>
            <span id=BabyAge style="display:none">
             <table width=100% height=100% border=0 cellspacing=0 cellpadding=0>
             <tr><td class=DataLabel width=30%>Admission Weight</td>
                 <td><input type=text name=ptmis051 size=8
                      title="Admission Weight" maxlength=6 tabindex=22
                      onblur="justifyRight(this);">&nbsp;grams</td>
             </tr>
             </table>
            </span>
            </td>
          </tr>

          <tr><td>
            <span id=NewBorn style="display:none">
             <table width=100% height=100% border=0 cellspacing=0 cellpadding=0>
             <tr><td class=DataLabel width=30%>Gestation Period</td>
                 <td><input type=text name=ptmis041 maxlength=3 size=4
                      title="Gestation Period" tabindex=23
                      onchange="validateCatCode(userdef5,ptmis041,'');"
                      value="">&nbsp;weeks</td>
             </tr>
             </table>
            </span>
            </td>
          </tr>

          <tr><td rowspan=2>
            <span id=WaitingList style="display:none">
            <table width=100% height=100% border=0 cellspacing=0 cellpadding=0>
            <tr><td class=DataLabel width=30%>Date of Referral</td>
                <td><input type=text size=12 name=ptmis058 tabindex=24
                     id=ptmis058 onblur="checkDate(this,'ReferralDate')">
                     <img notab src=../images/CalendarLookup.gif
                      class=Icon
                      onclick="DateLookupFrame(ptmis058);"></td>
            </tr>
            <tr><td class=DataLabel>Date of 1st Spec Consult</td>
                <td><input type=text size=12 name=ptmis059 tabindex=25
                     id=ptmis059 onblur="checkDate(this,'SpecConDate')">
                     <img notab src=../images/CalendarLookup.gif
                      class=Icon
                      onclick="DateLookupFrame(ptmis059);"></td>
            </tr>
            </table>
            </span>
            </td>
          <tr>
          </table>
        </td>
      </tr>
      </table>
      </td>
    </tr>

    <tr><td colspan=2>&nbsp;</td></tr>

    <tr align=center>
      <td colspan=2>
        <input type=button value="Ok" class="button" tabindex=35 id="pat89sub"
         onclick="tempDisable(this);
                  checkBedStatus(UpdateForm.ptmis068.value,
                                 UpdateForm.ptmis005.value,
                                 UpdateForm.ptmis001.value,
                                 UpdateForm.ptmis030.value,SubmitAdm)";>
        <input tabindex=36 type=button value="Cancel" class="button"
         onclick='fnPatientLink("%PATWEB89.01.003","%PATWEB89.01.081");'>
      </td>
    </tr>
    </table>

</td></tr>
</table>
</form>

<form name=PatientLinks method=get>
<input type=hidden name=reportno value=1>
<input type=hidden name=template value=004>
<input type=hidden name=urnumber value="%PATWEB89.01.003">
<input type=hidden name=admissno value="%PATWEB89.01.081">
</form>

<form name=linkForm action=patweb89.pbl method=post>
<input type=hidden name=reportno value=1>
<input type=hidden name=template value=1>
<input type=hidden name=urnumber value="%PATWEB89.01.003">
<input type=hidden name=admissno value="%PATWEB89.01.101">
</form>

<form name=Lookup action=patweb94.pbl method=post>
<input type=hidden name=reportno value=9>
<input type=hidden name=template value=1>
<input type=hidden name=valcateg>
<input type=hidden name=valdtype>
<input type=hidden name=valdcode>
</form>

</div>

<script language="javascript">
function customLoad() {
  if ("%PATWEB89.01.466.1" == "BED") {
    var site="4711";
  } else {
    var site="4712";
  }

  for (var i=0;i<document.UpdateForm.ptmis009.length;i++) {
    if (document.UpdateForm.ptmis009.options[i].value.substr(0,3)=="AE ") {
      document.UpdateForm.ptmis009.selectedIndex=i;
    }
  }

  for (var i=0;i<document.UpdateForm.ptmis068.length;i++) {
    if (document.UpdateForm.ptmis068.options[i].value.substr(0,3)==
        "%PATWEB89.01.449.0") {
      document.UpdateForm.ptmis068.selectedIndex=i;
    }
  }

  for (var i=0;i<document.UpdateForm.ptmis011.length;i++) {
    if (document.UpdateForm.ptmis011.options[i].value.substr(0,3)=="G  ") {
      document.UpdateForm.ptmis011.selectedIndex=i;
    }
  }

  for (var i=0;i<document.UpdateForm.ptmis060.length;i++) {
    if (document.UpdateForm.ptmis060.options[i].value.substr(0,3)==
        document.UpdateForm.ptcnhpcd.value) {
      document.UpdateForm.ptmis060.selectedIndex=i;
    }
  }

  if ("%PATWEB89.01.903" == "1") {
    alert("Warning: Patient has a Waiting List Procedure");
  }
  if ("%PATWEB89.01.904" == "1") {
    alert("Warning: Patient has a Booking");
  }
  if ("%PATWEB89.01.905" == "1") {
    alert("Warning: Patient is currently admitted");
  }
  if ("%PATWEB89.01.908" == "1") {
    alert("Warning: Patient has a pre-admission record");
  }

  ShowAdmissionWeight(UpdateForm);
  ibcnmhos="%STANDARD.01.025.000.043.1.1";

  if (ibcnmhos=="1") {
    UpdateForm.ptmis068.className="Mandatory";
  }
  emcndfsd="%STANDARD.01.025.122.004.1.1";
// first seen by doctor date
  emerdfsd="%PATWEB89.01.999.054.0";
// first seen by doctor time
  emerdfst="%PATWEB89.01.999.054.1";
  if(emcndfsd=="1"){
    if(!isWhitespace(emerdfsd)){
      UpdateForm.ptmis001.value=emerdfsd;
    }
    if(!isWhitespace(emerdfst)){
      UpdateForm.ptmis002.value=emerdfst;
     }
  }

FilterMentalHealth(document.UpdateForm.mh_visit.value);

}
</script>
<span id=transferhd style="display:none">
<td class=DataLabel>Transfer Source</td>
</tr>
</span>
<span id=transfersrc style="display:none">
<td><input type="text" size=7 maxlength=5 name=trnsfsrc class=Mandatory
      title="Transfer Source" tabindex=5 id=trnsfsrc
 onblur="validateCodeOnChange(9,trnsfsrc,trandesc,ptmis009);">
     <input type=text size=27 name=trandesc notab id=trandesc
      class=Readonly readonly >
     <img src="../images/SearchIcon.gif" class=Icon
      onclick="TransferSourceFrame(trnsfsrc,trandesc,ptmis009)"></td>
</tr>
</span>
<span id=transferblank style="display:none">
   <input type=hidden name=trnsfsrc>
</span>
