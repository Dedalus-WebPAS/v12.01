<meta name="TemplateVersion" content="V12.01.00">
<meta name="TemplateHome" content="nz">
<meta name="HelpFileName" content="NoContextSet.html">
<meta name="CrossBrowser" content="true">
<script type="text/javascript">
function CheckRemove() {
  if (document.UpdateForm.cpadm002[1].checked) {
    document.UpdateForm.cpadm003.className="Mandatory";
    document.UpdateForm.cpadm008.className="Mandatory";
    document.UpdateForm.cpadm003.disabled=false;
    document.UpdateForm.cpadm008.readOnly=false;
  } else {
    document.UpdateForm.cpadm003.className="readonly";
    document.UpdateForm.cpadm008.className="readonly";
    document.UpdateForm.cpadm003.value="";
    document.UpdateForm.cpadm008.value="";
    document.UpdateForm.cpadm003.disabled=true;
    document.UpdateForm.cpadm008.readOnly=true;
  }
}
function PostCancel() {
  if (!validateMandatory(document.UpdateForm))
    return;

  // check for any Cross Consultations
  var p = document.UpdateForm;
  var serverURL = "../cgi-bin/comweb80.pbl?reportno=86" +
                  "&valdcode=" + p.admissno.value.replace(/ /g,"+")
  var returnValue = RSExecute(serverURL);

  if (returnValue.status == 0) {
    ReturnValue = returnValue.return_value.split("|");
    if (ReturnValue[0] == "1") {
      // Cross Consultation exists; prompt for action
      if (!confirm("Cross Consulting record exists. " +
             "Click OK to continue, Cancel to remove Cross Consulting.")) {

        // Redirect to Cross Consultations management template
        var URL = "patweb78.pbl?reportno=02&template=001"
                  + "&urnumber=" + p.urnumber.value.replace(/ /g,"+")
                  + "&admissno=" + p.admissno.value.replace(/ /g,"+")

        if (window.parent != undefined) {
          window.parent.LinkPatient(URL);
        }
        else {
          window.location.href = URL; 
        }
        return;
      }
    }
  }
  else {
    alert("Error: Server not responding. Please restart COMWEB80.");
    return;
  }

  if (!isWhitespace(p.d_emviadmn.value)) {
    if (!confirm("Warning - Linked ED visit " + p.d_emviadmn.value + " exists."
         + "\nPress Ok to continue, Cancel to Abort.")) {
      return;
    }
  }

 //T0845646
 //Cancelling a preadmission with Cat PC id2=X then Check that the visit
 //has any Post Discharge Coding or Bookings?
  if(document.getElementById('ptmis003').value.substr(4,1) == 'X'){

     //Visit with Post Discharge Coding and a Booking
     if((document.getElementById('d_dcexists').value == "1") &&
        (document.getElementById('d_bkexists').value == "1")){
        alert("Error: Pre-admission has associated Post Discharge Coding " +
              "and Booking" +
              "\n\nPlease remove Coding and cancel Booking before " +
              "cancelling Pre-admission.");
        return;
     }

     //Visit with Post Discharge Coding
     if(document.getElementById('d_dcexists').value == "1"){
        alert("Error: Pre-admission has associated Post Discharge Coding." +
              "\n\nPlease remove Coding before cancelling Pre-admission.");
        return;
     }

     //Visit with a Booking
//   if(document.getElementById('d_bkexists').value == "1"){
//      alert("Error: Pre-admission has associated Booking.              " +
//            "\n\nPlease cancel Booking before cancelling Pre-admission.");
//      return;
//   }

     //Visit with a Theatre Booking
     if(document.getElementById('d_tbexists').value == "1"){
        alert("Error: Pre-admission has associated Theatre Booking.     " +
              "\n\nPlease cancel Booking before cancelling Pre-admission.");
        return;
     }

  }
  //
  if(parent.document.getElementById("PatientMenu")) {
     document.UpdateForm.nextpage.value="9";
  }
  if(parent.parent.document.getElementById("PatientMenu")) {
     UpdateForm.target = "_parent";
     document.UpdateForm.nextpage.value="9";
  }

  tempDisable(p.pat89sub);
  p.submit();
}
</script>
</head>
%START.OF.PAGE
<body onload="PageLoad(event);">
<span class=DFrameTitleBar>
<img border=0 align=right src=../images/ExitIcon.gif onclick="DFrameExit();">
Cancel Pre-Admission 
</span>
  <form name=UpdateForm  action="patweb89.pbl" method=post>
  <input type="hidden" name="reportno" value="2">
  <input type="hidden" name="template" value="010">
  <input type="hidden" name="updatety" value="3">
  <input type="hidden" name="urnumber" value="%PATWEB89.01.003">
  <input type="hidden" name="admissno" value="%PATWEB89.01.101">
  <input type="hidden" name="nextpage" value="1">
  <input type="hidden" name="d_emviadmn" value="%PATWEB89.01.999.022">
  <input type="hidden" name="savtdept" value="%PATWEB89.01.999.028">
  <input type=hidden name=d_dcexists id=d_dcexists value="%PATWEB89.01.912.004">
  <input type=hidden name=d_bkexists id=d_bkexists value="%PATWEB89.01.912.005">
  <input type=hidden name=d_tbexists id=d_tbexists value="%PATWEB89.01.912.006">
  <input type=hidden name=redirect value="%PATWEB89.01.001.patweb98.01.002">
<table border=0 colspan=1 width=95% align=center cellspacing=1 cellpadding=1 >

<tr><td colspan=2>
  <table width=100%>
  <tr><td width=50% class=DataLabel>Reason for Patient Cancellation </td>
      <td align=left>
        <select name="ptmis003" class=Mandatory title="Cancellation Reason"
         id=ptmis003>
        <option> </option>
        %STANDARD.01.007.PC
        </select>
      </td></tr>
</table>
</td></tr>
<tr><td colspan=2><div id=booking></div></td></tr>
<tr><td colspan=2><div id=waiting></div></td></tr>
<tr><td colspan=2><div id=theatre></div></td></tr>
<tr><td colspan=2 align=center>
    <input type=button value="Cancel Pre-Admission" class="Largebutton"
     id="pat89sub" onclick="PostCancel();">
    <input type=button value="Close" class="button" onClick="DFrameExit()">
</td></tr>
</table>
</form>

<div name=bookdets id=bookdets style="display: none;"
 class="DisplayLocation">
<table width=100% >
  <tr><td width=50% class=DataLabel>Booking Cancellation Reason </td> 
      <td align=left><select name="cpadm001" class=Mandatory 
           title="Booking Cancellation Reason">
        <option> </option>
        %STANDARD.01.007.BC
      </select>
      </td></tr>
</table>
</div>

<div name=bookdtbe id=bookdtbe style="display: none;"
 class="DisplayLocation">
<table width=100% >
  <tr><td width=50% class=DataLabel>Booking Cancellation Reason </td>
      <td align=left><select name="cpadm007" class=Mandatory 
           title="Booking Cancellation Reason">
        <option> </option>
        %STANDARD.01.007.BE
      </select>
      </td></tr>
</table>
</div>

<div name=waitdets id=waitdets style="display: none;"
 class="DisplayLocation">
<table width=100%> 
  <tr><td width=50% class=DataLabel>Do you want to return this patient to 
                          the Waiting List? </td>
      <td>Yes<input type=radio name=cpadm002 value="Y" checked
              onclick="CheckRemove();">
          No <input type=radio name=cpadm002 value="N"
              onclick="CheckRemove();">
      </td></tr>

  <tr><td class=DataLabel>Removal Reason </td>
      <td align=left>
      <select name="cpadm003" title="Removal Reason" disabled class=readonly>
        <option> </option>
        %STANDARD.01.007.WR
      </select>
      </td></tr>

  <tr><td class=DataLabel>Removal Date</td>
  <td><input type="text" name="cpadm008" title="Removal Date" size="12"
         readOnly class=readonly
         maxlength="11" onBlur="checkDate(this,'Removal Date');">
        <img src=../images/DateTimeStamp.gif class=Icon 
         date="UpdateForm.cpadm008" time=null>
        <img notab src="../images/DateLookup.gif" class="Icon"
         alt="Calendar" date="UpdateForm.cpadm008"></td></tr>
</table>
</div>

<div name=theatdets id=theatdets style="display: none;"
 class="DisplayLocation">
<table align=center>
  <tr><td width=50% class=DataLabel>Theatre Booking Cancellation Reason </td>
      <td align=left>
      <select name="cpadm006" title="Theatre Cancellation Reason"
           class=Mandatory>
        <option> </option>
        %STANDARD.01.007.SC
      </select>
      </td></tr>
</table>
</div>

<script type="text/javascript">
function init(){
  if ( "%PATWEB89.01.912.003" == "1")  {
     alert("Warning: Patient has associated theatre bookings.")
     return}
  if ( "%PATWEB89.01.912.001" == "1")  {
    if ( "%PATWEB89.01.913" == "1")  {
      booking.innerHTML=bookdets.innerHTML;
      parent.document.getElementById('PopUpScreen').style.height=
            (parseInt(parent.document.getElementById('PopUpScreen').style.height.substr(0,3)) + 60);
    } else {
      booking.innerHTML=bookdtbe.innerHTML;
      parent.document.getElementById('PopUpScreen').style.height=
            (parseInt(parent.document.getElementById('PopUpScreen').style.height.substr(0,3)) + 60);
    } 

  }

  if ( "%PATWEB89.01.912.002" == "1")  {
   if ( "%PATWEB89.01.913" == "1")  {
    waiting.innerHTML=waitdets.innerHTML;
    parent.document.getElementById('PopUpScreen').style.height=
          (parseInt(parent.document.getElementById('PopUpScreen').style.height.substr(0,3)) + 80);
    }
  }

  if ( "%PATWEB89.01.912.003" == "1")  {
    theatre.innerHTML=theatdets.innerHTML;
    parent.document.getElementById('PopUpScreen').style.height=
          (parseInt(parent.document.getElementById('PopUpScreen').style.height.substr(0,3)) + 70);
  }
}
</script>
