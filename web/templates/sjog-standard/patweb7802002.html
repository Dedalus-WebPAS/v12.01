<meta name="TemplateVersion" content="V12.01.00">
<meta name="TemplateHome" content="sjog-standard">
<meta name="HelpFileName" content="NoContextSet.html">
<meta name="CrossBrowser" content="true">
<script type="text/javascript" src="../js/patweb7802.js"></script>
<script type="text/javascript" src="../js/patweb9801001.js"></script>
<script type="text/javascript">

function SpecialitySelected(obj) {
  if (obj.selectedIndex == 0) {
    UpdateForm.ptcrc002.className = "Mandatory";  // Referred HCP
  }
  else {
    UpdateForm.ptcrc002.className = "";           // Referred HCP
  }
  UpdateForm.ptcrc008.className = "";             // Speciality
}
function valDoctorUnit() {
  ValidateHCP(18,0,UpdateForm.ptcrc002,UpdateForm.name_ptcrc002);
  if (UpdateForm.ptcrc002.value.length > 0) {
      selectOptions("30",UpdateForm.ptcrc002,UpdateForm.ptcrc011);
  } else {
      UpdateForm.ptcrc011.length=0;
  }
  if (UpdateForm.ptcrc011.length == 2){
     // only one unit pulled down; so select it
    UpdateForm.ptcrc011.selectedIndex = 1;
  }

  if (UpdateForm.dispspec.value == "1") {
    if (UpdateForm.ptcrc002.value.length > 0) {
      // is a valid HCP; get their Specialities
      selectOptions("30",UpdateForm.ptcrc002,UpdateForm.ptcrc008);
    }
    else {
      // no linked Specialities; pull complete list down from server
      selectOptions3("15",UpdateForm.CATEG_AC,UpdateForm.ptcrc008);
    }

    if (UpdateForm.ptcrc008.length == 2){
      // only one Speciality pulled down; so select it
      UpdateForm.ptcrc008.selectedIndex = 1;
    }

    if (UpdateForm.ptcrc008.selectedIndex > 0){
      // a Speciality has been selected; make Referred Consultant non-mandatory
      UpdateForm.ptcrc002.className = "";
    }
  }
}
function CompareTimestamps(offendingField){

  UF = document.UpdateForm;
  if(offendingField.value==""){
     return;
  }
  ts1 = SetDateYYYYMMDD(UF.ptcrc005.value) + UF.ptcrc009.value;
  if(ts1 < UpdateForm.d_emvidate.value){
     alert("Date/Time cannot be before admission timestamp");
     offendingField.value="";
     offendingField.focus();
     return;
  }
}
function ValDate(dateField,timeField){
   if (!checkDate(dateField,dateField.title)) {
      return;
   }
   if (!isWhitespace(timeField.value)) {
     CheckFutureTime(UpdateForm,dateField.value,timeField);
   }
}
function CheckSPecialtyAndRC(){
  if (UpdateForm.dispspec.value != "1") {
    return;
  }
  if(UpdateForm.ptcrc008.value==""){
     UpdateForm.ptcrc002.className="Mandatory";
  }
  else{
     UpdateForm.ptcrc002.className="";
  }
  if(UpdateForm.ptcrc002.value==""){
     UpdateForm.ptcrc008.className="Mandatory";
  }
  else{
     UpdateForm.ptcrc008.className="";
  }
}
function SetDateTime(){
  Updateform.ptcrc005=UpdateFormptcrdate;
  Updateform.ptcrc009=UpdateFormptcrtime;
}
function CharLimit(limitField, limitNum) {
  if(limitField.value.length > limitNum) {
     limitField.value = limitField.value.substring(0, limitNum);
     alert("The comments field has a maximum length of 100 characters");
  }
}
</script>
</head>
%START.OF.PAGE
<body onload="PageLoad(event);
              setFocus();
              SetCurrentDateTime(document.UpdateForm.ptcrc005,
                                 document.UpdateForm.ptcrc009);
              ValidateHCP(18,0,
                          document.UpdateForm.ptcrc001,
                          document.UpdateForm.name_ptcrc001);
              CheckSPecialtyAndRC();
              valDoctorUnit();">
<span class=DFrameTitleBar id=DFrameHeading>
<img align="right" alt="Exit" class="MenuIcon"
     src="../images/ExitIcon.gif"
     onclick="DFrameExitRefresh();">
 Add Consult                    
</span>
<div id=PageHeadingSection>
<form name=UpdateForm action=patweb78.pbl method=post style="margin:0">
<input type=hidden name=reportno value=2>
<input type=hidden name=template value=002>
<input type=hidden name=urnumber value="%PATWEB78.02.003">
<input type=hidden name=admissno value="%PATWEB78.02.081">
<input type=hidden name=updttype value="E">
<input type=hidden name=strtdate value="%PATWEB78.02.211">
<input type=hidden name=stopdate value="%PATWEB78.02.207">
<input type=hidden name=multhosp value="">
<input type=hidden name=dispspec id=dispspec value="%PATWEB78.02.214">
<input type=hidden name=CATEG_AC value="AC">
<input type=hidden name=currdate value="%STANDARD.01.013">
<input type=hidden name=currtime value="%STANDARD.01.016">
<input type=hidden name=19 value="%PATWEB78.02.219">
<input type=hidden name=20 value="%PATWEB78.02.220">
<input type=hidden name=21 value="%PATWEB78.02.221">
<input type=hidden name=22 value="%PATWEB78.02.222">
<input type=hidden name=23 value="%PATWEB78.02.223">
<input type=hidden name=d_emvidate value="%PATWEB78.02.224">
<input type=hidden name=ptcrc003 value="1">
<input type=hidden name=dummy2 value=" ">

<table width=99% border=0 cellpadding=1 cellspacing=0 align=center>
  <tr>
    <td class=DataLabel>Date / Time</td>
    <td>
      <input type=text name=ptcrc005 size=12 class="Mandatory PastDate"
       title="Date" 
       onblur="ValDate(UpdateForm.ptcrc005,UpdateForm.ptcrc009);
               CompareTimestamps(this)">
      <img src="../images/DateLookup.gif" class=Icon
       onclick="DateLookupFrame(UpdateForm.ptcrc005);">
      <input type=text size=8 title="Time" name=ptcrc009 class="Mandatory"
       onblur="checkTime(this,this.title);
               ValDate(UpdateForm.ptcrc005,UpdateForm.ptcrc009);
               CompareTimestamps(this)">
      <img notab src="../images/DateTimeStamp.gif" class=Icon
       onclick="SetCurrentDateTime(UpdateForm.ptcrc005,UpdateForm.ptcrc009);">
      <img notab src="../images/TimeLookup.gif" class=Icon
       onclick="TimeLookupFrame(UpdateForm.ptcrc009);">
    </td>
  </tr>

  <tr>
    <td class=DataLabel>Referring Senior Doctor</td>
    <td class=DataField>
      <input type=text name=ptcrc001 size=6 maxlength=6 class=Mandatory
       title="Referring Senior Doctor" value="%PATWEB78.02.212.003"
       onblur="UpCase(this);
               ValidateHCP(18,0,
                           UpdateForm.ptcrc001,
                           UpdateForm.name_ptcrc001);">
      <input notab type=text name=name_ptcrc001 size=22 maxlength=30
       readonly class=Readonly value="%PATWEB78.02.212.002">
      <img notab src="../images/SearchIcon.gif" class=Icon 
       onclick="HCPSearchFrame(UpdateForm.ptcrc001,
                               UpdateForm.name_ptcrc001,
                               0)">
    </td>
  </tr>

  <tr>
    <td class=DataLabel>Referred to Senior Doctor</td>
    <td class=DataField>
      <input type=text name=ptcrc002 size=6 maxlength=6
       title="Referred to Senior Doctor"
       onblur="UpCase(this);
               valDoctorUnit();
               CheckSPecialtyAndRC();">
      <input notab type=text name=name_ptcrc002 size=22 maxlength=30
       readonly class=Readonly>
      <img notab src="../images/SearchIcon.gif" class=Icon
       onclick="HCPSearchFrame(UpdateForm.ptcrc002,
                               UpdateForm.name_ptcrc002,
                               0,
                               valDoctorUnit);">
      <input type=hidden name=dummy>
    </td>
  </tr>

  <tr>
    <td class=DataLabel>Referred to Senior Doctor Unit</td>
    <td class=DataField>
      <select name=ptcrc011>
      </select>
    </td>
  </tr>

  <tr>
    <td class=DataLabel><span id=SpecialityLbl></span></td>
    <td class=DataField><span id=SpecialityVal></span></td>
  </tr>

  <tr>
    <td class=DataLabel>Comments</td>
    <td class=DataField>
       <input type=text name=ptcrc012 size=75 maxlength=100 title="Comments">
    </td>
  </tr>
</table>

<table width=95% border=0 align=center>
  <tr>
    <td align=center>
      <input type=button value="Add" class=button id=btnAdd
       onclick="tempDisable(this);AddCrossCons()">
      <input type=button value="Cancel" class=button
       onclick='DFrameCloseRefresh()'>
    </td>
  </tr>
</table>

</form>
</div>

<span id="spSpecLbl" style="display:none">Speciality</span>
<span id="spSpecVal" style="display:none">
  <select name=ptcrc008 id=ptcrc008 title="Speciality"
    onchange="SpecialitySelected(this);
              CheckSPecialtyAndRC();">
    <option></option>
    %PATWEB78.02.215.2
  </select>
</span>

<script type="text/javascript">

  var hDispSpec = document.getElementById('dispspec');
  if (hDispSpec.value == '1') {
    var spLbl = document.getElementById('spSpecLbl');
    var spVal = document.getElementById('spSpecVal');
    var SpecLbl = document.getElementById('SpecialityLbl');
    var SpecVal = document.getElementById('SpecialityVal');

    if (spLbl && spVal && SpecLbl && SpecVal) {
      SpecLbl.innerHTML = spLbl.innerHTML;
      SpecVal.innerHTML = spVal.innerHTML;
      spVal.innerHTML = "";

      var ddlSpec = document.getElementById('ptcrc008');
      if (ddlSpec && (ddlSpec.selectedIndex == 0)) {
        document.UpdateForm.ptcrc002.className = "Mandatory";
      }
    }
  }
  else {
    document.UpdateForm.ptcrc002.className = "Mandatory";  // Referred HCP
  }
</script>

<form name=PatientLinks method=get>
<input type=hidden name=reportno value=2>
<input type=hidden name=template value=002>
<input type=hidden name=urnumber value="%PATWEB78.02.003">
<input type=hidden name=admissno value="%PATWEB78.02.081">
<input type=hidden name=MenuType value="%PATWEB78.02.088">
</form>
