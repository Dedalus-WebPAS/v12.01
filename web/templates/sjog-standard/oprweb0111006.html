<meta name="TemplateVersion" content="V12.01.00">
<meta name="TemplateHome" content="sjog-standard">
<meta name="HelpFileName" content="NoContextSet.html">
<meta name="CrossBrowser" content="true"> 
<script type="text/javascript" src="../js/oprweb0111.js"></script>
<script type="text/javascript">
function changeOperation(theForm) { 
for (var i = 0; i < theForm.operpref.length; i++) {
 if (theForm.operpref.options[i].selected == true) {
  theForm.elements["operdes1"].value=theForm.operpref.options[i].text }
 }
}
function changeAdmitDate(theForm) {   
for (var i = 0; i < theForm.patadmdt.length; i++) {
 if (theForm.patadmdt.options[i].selected == true) {
  theForm.elements["operdes3"].value="Admit:"+theForm.patadmdt.options[i].text }
  }
}
function CancelBooking(linkurl) {
  Left=(document.body.clientWidth-640)/2
  DFrameLink(linkurl,0,Left,640,290)
}
function Check(){
 if(!validateMandatory(UpdateForm))
   return;
 UpdateForm.bkrec006.disabled=false
 UpdateForm.bkrec007.disabled=false
 UpdateForm.patadmdt.disabled=false
 UpdateForm.bkrec005.disabled=false
 p=UpdateForm
 validateWLSuspension(p.caseuniq,p.patadmdt,p.datefromwl,p.datetowl);
 if(p.datefromwl.value!='0'){
   alert("Error: Patient has a Suspension record for period \n" +
            "\t" + p.datefromwl.value  + " - " + p.datetowl.value);
   return;
 }
 if(ChkDateTime(UpdateForm.patadmdt,null,UpdateForm.bookdate,null)){
       UpdateForm.submit();
    }
 else {
       alert("Theatre Booking cannot be before Admission Date");
      }
}
function checkWatEntry(){
   if (UpdateForm.bkrec006.value != "") {
     UpdateForm.bkrec006.className="Readonly"
     UpdateForm.bkrec006.disabled=true
     UpdateForm.bkrec015.focus()
   }else {
     UpdateForm.bkrec006.focus()
   }
   if (UpdateForm.bkrec007.value != "") {
     UpdateForm.bkrec007.className="Readonly"
     UpdateForm.bkrec007.disabled=true
   }
}
function DisableIcon(field) {
  if (field.disabled == true) {
    alert(field.title+" is for display only")
    UpdateForm.bkrec015.focus()
  }
}
function validateDateBookingRules() {

  var admdate;
  var wtldate;
  var admdateDATEOBJECT;
  var wtldateDATEOBJECT;
  var oneDay = 24*60*60*1000;
  var diffDays = 0;

  if (isWhitespace(UpdateForm.patadmdt.value) ||
      isWhitespace(UpdateForm.watldate.value)) {
    clearDateBookingRules();
    return;
  }

  admdate = SetDateYYYYMMDD(UpdateForm.patadmdt.value);
  wtldate = UpdateForm.watldate.value;

  if (admdate < wtldate) {
    clearDateBookingRules();
    return;
  }

  admdateDATEOBJECT = new Date();
  wtldateDATEOBJECT = new Date();

  admdateDATEOBJECT.setFullYear(admdate.substr(0,4));
  admdateDATEOBJECT.setMonth(parseInt(admdate.substr(4,2)-1));
  admdateDATEOBJECT.setDate(admdate.substr(6,2));

  wtldateDATEOBJECT.setFullYear(wtldate.substr(0,4));
  wtldateDATEOBJECT.setMonth(parseInt(wtldate.substr(4,2)-1));
  wtldateDATEOBJECT.setDate(wtldate.substr(6,2));

  diffDays = Math.round(Math.abs((admdateDATEOBJECT.getTime() -
                                  wtldateDATEOBJECT.getTime())/(oneDay)));

  if (diffDays > 31 && diffDays <= 91) {

    if (document.UpdateForm.watprior.value.substr(14,1) != 3) {
      return;
    }

    if (UpdateForm.bokrx045!=undefined) {
      if (!isWhitespace(UpdateForm.bokrx045.value)) {
        return;
      }
    }

    if (confirm("Booking date is less than 91 days and does not meet \n" +
                 "the Category 3 guidelines. Select OK to accept this \n" +
                 "date, Select Cancel to clear the date.")) {
      assignWaitingListBookingSpans();
      return;
      } else {
      document.UpdateForm.patadmdt.value="";
      return;
    }
  } else {
    if (diffDays <= 31) {

      if (document.UpdateForm.watprior.value.substr(14,1) != 2 &&
          document.UpdateForm.watprior.value.substr(14,1) != 3) {
        return;
      }

      if (UpdateForm.bokrx045!=undefined) {
        if (!isWhitespace(UpdateForm.bokrx045.value)) {
        return;
        }
      }

      if (document.UpdateForm.watprior.value.substr(14,1) == 2) {
        if (confirm("Booking date is less than 31 days and does not meet \n" +
                     "the Category 2 guidelines. Select OK to accept this \n" +
                     "date, Select Cancel to clear the date.")) {
          assignWaitingListBookingSpans();
          return;
        } else {
          document.UpdateForm.patadmdt.value="";
          return;
        }
      }

      if (document.UpdateForm.watprior.value.substr(14,1) == 3) {
        if (confirm("Booking date is less than 91 days and does not meet \n" +
                     "the Category 3 guidelines. Select OK to accept this \n" +
                     "date, Select Cancel to clear the date.")) {
          assignWaitingListBookingSpans();
          return;
        } else {
          document.UpdateForm.patadmdt.value="";
          return;
        }
      }
    }
  }
  clearDateBookingRules();
}

function assignWaitingListBookingSpans() {

  PBRTitleDIV.innerHTML=PBRTitleVisibleSPAN.innerHTML;
  PBRFieldDIV.innerHTML=PBRFieldVisibleSPAN.innerHTML;

  AuthByTitleDIV.innerHTML=AuthByTitleVisibleSPAN.innerHTML;
  AuthByFieldDIV.innerHTML=AuthByFieldVisibleSPAN.innerHTML;

}

function validateDateBookingRulesOnLoad() {

  var admdate;
  var wtldate;
  var admdateDATEOBJECT;
  var wtldateDATEOBJECT;
  var oneDay = 24*60*60*1000;
  var diffDays = 0;

  if (isWhitespace(UpdateForm.patadmdt.value) ||
      isWhitespace(UpdateForm.watldate.value)) {
    clearDateBookingRules();
    return;
  }

  if (UpdateForm.bokrx045!=undefined) {
    if (!isWhitespace(UpdateForm.bokrx045.value)) {
      return;
    }
  }

  admdate = SetDateYYYYMMDD(UpdateForm.patadmdt.value);
  wtldate = UpdateForm.watldate.value;

  if (admdate < wtldate) {
    clearDateBookingRules();
    return;
  }

  admdateDATEOBJECT = new Date();
  wtldateDATEOBJECT = new Date();

  admdateDATEOBJECT.setFullYear(admdate.substr(0,4));
  admdateDATEOBJECT.setMonth(parseInt(admdate.substr(4,2)-1));
  admdateDATEOBJECT.setDate(admdate.substr(6,2));

  wtldateDATEOBJECT.setFullYear(wtldate.substr(0,4));
  wtldateDATEOBJECT.setMonth(parseInt(wtldate.substr(4,2)-1));
  wtldateDATEOBJECT.setDate(wtldate.substr(6,2));

  diffDays = Math.round(Math.abs((admdateDATEOBJECT.getTime() -
                                  wtldateDATEOBJECT.getTime())/(oneDay)));

  if (diffDays > 31 && diffDays <= 91) {

    if (document.UpdateForm.watprior.value.substr(14,1) != 3) {
      return;
    }

    assignWaitingListBookingSpans();
    return;

  } else {
    if (diffDays <= 31) {

      if (document.UpdateForm.watprior.value.substr(14,1) != 2 &&
          document.UpdateForm.watprior.value.substr(14,1) != 3) {
        return;
      }

        assignWaitingListBookingSpans();
        return;
    }
  }

  clearDateBookingRules();

}

function clearDateBookingRules() {

  PBRTitleDIV.innerHTML="";
  PBRFieldDIV.innerHTML=PBRFieldHiddenSPAN.innerHTML;

  AuthByTitleDIV.innerHTML="";
  AuthByFieldDIV.innerHTML=AuthByFieldHiddenSPAN.innerHTML;

}
</script>
</head>
%START.OF.PAGE
<body onload="PageLoad(event);checkWatEntry();UpdateForm.patclaim.focus();
              validateDateBookingRulesOnLoad();">
<span class=DFrameTitleBar>
<img align="right" alt="Exit" class="MenuIcon"
 src="../images/ExitIcon.gif" onclick="DFrameExit();">
Update Theatre Booking
</span>

<div id=PageBodySection style="overflow: auto;">

<form name=UpdateForm onsubmit="return validateMandatory(this);"
       action=oprweb01.pbl method=post  style="margin:0">
<input type=hidden name=reportno value=12>
<input type=hidden name=template value=1>
<input type=hidden name=casekeys value="%OPRWEB01.11.001">
<input type=hidden name=bookdate value="%OPRWEB01.11.102">
<input type=hidden name=prevconf value="%OPRWEB01.11.806">
<input type=hidden name=nextpage value="0">
<input type=hidden name=datefrom >
<input type=hidden name=dateto >
<input type=hidden name=datefromwl>
<input type=hidden name=datetowl>
<input type=hidden name=caseuniq value="%OPRWEB01.11.710">
<input type=hidden name=watprior value="%OPRWEB01.11.517.3">
<input type=hidden name=watldate value="%OPRWEB01.11.596">
<input type=hidden name=firstbok value="1">
<input type=hidden name="nobkdes2" value="1">

<table border="0" cellpadding="1" cellspacing="0" width="95%" align=center>
<tr><td width=15% class=DataLabel>Surgeon   </td>
    <td ><a href='javascript:DoctorViewFrame("%OPRWEB01.11.104.003")'>
         <b>%OPRWEB01.11.104.002 &nbsp;</b></a></td>
    <td width=15%>Anaesthetist   </td>
    <td><a href='javascript:DoctorViewFrame("%OPRWEB01.11.116.003")'>
         %OPRWEB01.11.116.002</a></td></tr>

<tr><td width=15% class=DataLabel>Theatre  </td>
    <td class=DataField> %OPRWEB01.11.114.0 </td>
    <td class=DataLabel>Session Type       </td>
    <td class=DataField>%OPRWEB01.11.169.0  </td></tr>

<tr><td class=DataLabel>Date  </td>
    <td class=DataField>%OPRWEB01.11.106 %OPRWEB01.11.102    </td>
    <td class=DataLabel>Time  </td>
    <td class=DataField> %OPRWEB01.11.103 to %OPRWEB01.11.108</td></tr>
<tr><td>&nbsp;</td><td>&nbsp;</td>
    <td class=DataLabel>Unit  </td>
    <td class=DataField> %OPRWEB01.11.825.0</td></tr>
<tr><td colspan=4 align=center><hr width=100%></td></tr>
<tr><td class=DataLabel>Pre-Assessment</td>
    <td class=DataLabel>
    <input type=text name=bkrec006 id=bkrec006 size=12 maxlength=11 class=""
     value="%OPRWEB01.11.808" onblur="checkDate(this,'Date')"
     title="Pre-Admission Date" tabindex=1 >
    <img src=../images/DateLookup.gif border=0 hspace=4 align=absmiddle
    onclick='DateLookupFrame(UpdateForm.bkrec006)'
     onfocus='DisableIcon(UpdateForm.bkrec006)' tabindex=-1>
    Time
    <input type=text name=bkrec007 size=7 id=bkrec007
     title="Pre-Admission Time" tabindex=2 value="%OPRWEB01.11.809">
    <img src=../images/DateTimeStamp.gif  border=0 hspace=4 align=absmiddle  
    onclick="SetCurrentDateTime(UpdateForm.bkrec006,UpdateForm.bkrec007);"
    onfocus='DisableIcon(UpdateForm.bkrec007)' tabindex=-1>
    <img src=../images/TimeLookup.gif border=0 hspace=4 align=absmiddle  
    onclick="TimeLookupFrame(UpdateForm.bkrec007);"
    onfocus='DisableIcon(UpdateForm.bkrec007)' tabindex=-1> 
    </td>
    <td class=DataLabel>Confirmed Admission</td>
    <td class=DataLabel>
     <input type=text name=patadmdt id=patadmdt 
            size=12 maxlength=11 class=Mandatory
     onblur="if(checkDate(this,this.title)){validateDateBookingRules();}"
     title="Confirmed Admission"  tabindex=25
     value="%OPRWEB01.11.806">
     <img src=../images/DateLookup.gif border=0 hspace=4 align=absmiddle
     onclick='DateLookupFrame(UpdateForm.patadmdt)'
     onfocus='DisableIcon(UpdateForm.patadmdt)' tabindex=-1>
    Time
    <input type=text name=bkrec005 size=7 id=bkrec005
            title="Admission Time" class=Mandatory
            value='%OPRWEB01.11.807' tabindex=26 >
    <img src=../images/DateTimeStamp.gif  border=0 hspace=4 align=absmiddle
     onclick='SetCurrentDateTime(UpdateForm.patadmdt,UpdateForm.bkrec005)'
     onfocus='DisableIcon(UpdateForm.bkrec005)' tabindex=-1>
    <img src=../images/TimeLookup.gif border=0 hspace=4 align=absmiddle
    onclick='TimeLookupFrame(UpdateForm.bkrec005)'
     onfocus='DisableIcon(UpdateForm.bkrec005)' tabindex=-1>
    </td></tr>

<tr><td class=DataLabel>Admitting Point</td>
    <td class=DataField>
    <select name=bokrx003 title="Admitting Point"  class=Mandatory tabindex=4>
    <option></option>
    %OPRWEB01.11.603.2
    </select></td>

  <td><div id="PBRTitleDIV"></div></td>
  <td><div id="PBRFieldDIV"></div></td>
</tr>

<tr>
  <td class=DataLabel>Expected Ward</td>
    <td class=DataField>
    <select name=bkrec015
            title="Expected Ward"
            tabindex=5 >
    <option></option>
    %OPRWEB01.11.560
    </select>
  </td>
  <td><div id="AuthByTitleDIV"></div></td>
  <td><div id="AuthByFieldDIV"></div></td>
</tr>

<tr><td class=DataLabel>%STANDARD.01.017.P </td>
    <td class=DataField>
    <select name=bkrec019
            title="%STANDARD.01.017.P "
            tabindex=7>
    <option></option>
    %OPRWEB01.11.823.2
    </select></td>
    <td class=DataLabel>Exp.Post Op Ward</td>
    <td class=DataLabel>
    <select name=bokrx002 title="Exp.Post Op Ward" tabindex=27
     onchange="selectOptions2('31',UpdateForm.bokrx002,UpdateForm.bokrx038);">
    <option></option>
    %OPRWEB01.11.602.2
    </select>
    Bed
    <select name=bokrx038 title="Expected Post-Op Bed" tabindex=28>
    <option></option>
    %OPRWEB01.11.638.1
    </select>
    </td>
</tr>

<tr><td class=DataLabel>%STANDARD.01.017.CL</td>
    <td class=DataField>
 <select name="patclaim" title="%STANDARD.01.017.CL" class=Mandatory tabindex=9>
     <option></option>
     %OPRWEB01.11.827.9.1.10.2.X
     </select></td>
    <td class=DataLabel>Planned Length of Stay </td>
    <td class=DataLabel>
    <input type=text name=bkrec033 size=4 maxlength=3 class=Integer
           title="Planned Length of Stay"
           tabindex=29>(days)</td></tr>

<tr><td class=DataLabel>Anaesthetic Type</td>
    <td><select name="operanae"
             title="Anaesthetic"
             class=Mandatory
             tabindex=10>
    <option></option>
    %OPRWEB01.11.006.2
    </select></td>
     <td class=DataLabel>Admission Source</td>
     <td class=DataField>
     <select name="opdea037"
             title="Admission Source" tabindex=30>
     <option></option>
     %OPRWEB01.11.755.2
     </select></td></tr>

<tr valign=top>
    <td class=DataLabel></td>
    <td></td>
    <td class=DataLabel> Duration </td>
    <td><input type=text name="operexpd" size=6 maxlength=4 min=0
             title="Operation Expected Duration" class="Mandatory Integer"
             value="%OPRWEB01.11.038" tabindex=31>
        (minutes)
    </td>
    </tr>

<tr><td class=DataLabel>MBS Codes</td>
    <td><input type=text name=operprv1 size=9 id=operprv1 
           onblur='validateMBSCode(17,
                                   UpdateForm.operprv1,
                                   UpdateForm.mbsdesc1,
                                   UpdateForm.casekeys,
                                   UpdateForm.bookdate)'
           title="Expected MBS Item 1"
           tabindex=12>
        <input type=text class=ReadOnly readonly name=mbsdesc1 size=35
           title="Expected MBS Item 1 Name " id=mbsdesc1
           value="%OPRWEB01.11.721.0" >
         <img src="../images/SearchIcon.gif" class=Icon
           onClick="MbsSearchFrame(UpdateForm.operprv1,
                                   UpdateForm.mbsdesc1,
                                   UpdateForm.bookdate)"></td>
    <td class=DataLabel>%STANDARD.01.017.Y6</td>
    <td><select id=readonlyY6>
    <option></option>
    %OPRWEB01.11.716.2
    </select>
    </td>
</tr>
<script language=javascript>
  document.getElementById("readonlyY6").disabled="true";
</script>

<tr><td></td>
    <td><input type=text name=operprv2 size=9 id=operprv2
           onblur='validateCode(4,
                                UpdateForm.operprv2,
                                UpdateForm.mbsdesc2,
                                UpdateForm.bookdate)'
           title="Expected MBS Item 2"
           tabindex=13>
        <input type=text readonly name=mbsdesc2 size=35 id=mbsdesc2
           title="Expected MBS Item 2 Name" class=ReadOnly
           value="%OPRWEB01.11.722.0">
         <img src="../images/SearchIcon.gif" class=Icon
           onClick="MbsSearchFrame(UpdateForm.operprv2,
                                   UpdateForm.mbsdesc2,
                                   UpdateForm.bookdate)"></td>
    <td class=DataLabel>Infection Status </td>
    <td><select name="operknow" 
             title="Infection Status" tabindex=32>
    <option></option>
    %OPRWEB01.11.740.2
    </select>
    </td></tr>


<tr><td></td>
    <td><input type=text name=operprv3 size=9 id=operprv3
           onblur='validateCode(4,
                                UpdateForm.operprv3,
                                UpdateForm.mbsdesc3,
                                UpdateForm.bookdate)'
           title="Expected MBS Item 3"
           tabindex=14>
        <input type=text readonly name=mbsdesc3 size=35 id=mbsdesc3
           title="Expected MBS Item 3 Name" class=ReadOnly 
           value="%OPRWEB01.11.723.0">
         <img src="../images/SearchIcon.gif" class=Icon
           onClick="MbsSearchFrame(UpdateForm.operprv3,
                                   UpdateForm.mbsdesc3,
                                   UpdateForm.bookdate)"></td>
    <td class=DataLabel>Equipment Req 1</td>
    <td><select name="opdea032" tabindex=33
             title="Equipment Required 1">
    <option></option>
    %OPRWEB01.11.745.2
    </select>
    </td></tr>

<tr valign=top>
    <td class=DataLabel>Full Description</td>
    <td><input type="text" size="55" maxlength=80 name="operdes1" 
           title="Operation Description 1" class="AlphanumSpec4"
           tabindex=15></td>
    <td class=DataLabel>Equipment Req 2</td>
    <td><select name="opdea033" tabindex=34
             title="Equipment Required 2">
    <option></option>
    %OPRWEB01.11.746.2
    </select>
    </td></tr>

<tr><td></td><td><input type="text" size="55" maxlength=80 name="operdes2" 
           title="Operation Description 2" value="%OPRWEB01.11.050"
           tabindex=17 class="AlphanumSpec4"></td>
    <td class=DataLabel>Equipment Req 3</td>
    <td><select name="opdea035" tabindex=35
             title="Equipment Required 3">
    <option></option>
    %OPRWEB01.11.749.2
    </select>
    </td></tr>

<tr><td></td><td><input type="text" size="55" maxlength=80 name="operdes3" 
           title="Operation Description 2"
           tabindex=18 class="AlphanumSpec4"> </td>
    <td class=DataLabel>Equipment Loaned</td>
    <td><select name="opdea034" tabindex=36 
             title="Equipment Loaned">
    <option></option>
    %OPRWEB01.11.747.2
    </select>
    </td></tr>

<tr><td class=DataLabel>Prosthesis Required</td>
    <td>
    <input type="text" size="40" maxlength=40 name=opercomm
           title="Operation Comment" tabindex=19 value='%OPRWEB01.11.728'>
    </td>
    <td class=DataLabel>Operating Unit</td>
    <td class=DataField><select name=opdea036 title="Operating Unit"
                         class="Mandatory" tabindex=37>
                        <option></option>
                        %OPRWEB01.11.750.2
                        </select></td>
</tr>
<tr><td></td><td></td>
    <td class=DataLabel>Date Created        </td>
    <td class=DataField><input type=text size=12 class=Readonly
        title="Date Created" value="%OPRWEB01.11.837">
        </td>
</tr>
<tr><td></td>
    <td></td>
    <td class=DataLabel>Created By        </td>
    <td class=DataField><input type=text size=25 class=Readonly
        value="%OPRWEB01.11.760">
</td></tr>
<tr><td class=DataLabel>Comments</td>
    <td colspan=3>
<textarea wrap=hard cols=60 rows=3 name=opcom009>%OPRWEB01.11.743.009</textarea>
    </td></tr>

<tr><td colspan=4>&nbsp;</td></tr>

<tr><td colspan=4 align="center">
  <input type=button class="button" value="Ok" onclick="Check()">
  <input type=button class="button" value="Cancel" onclick='DFrameClose()'>
    </td></tr>
</table>
</form>
</div>

<form name=PatientLinks method=get>
<input type=hidden name=reportno value=9>
<input type=hidden name=template value=002>
<input type=hidden name=urnumber value="%OPRWEB01.11.203">
<input type=hidden name=admissno value="%OPRWEB01.11.281">
<input type=hidden name=MenuType value="%OPRWEB01.11.288">
<input type=hidden name=casekeys value="%OPRWEB01.11.001">
</form>

<script type="text/javascript">
document.UpdateForm.bkrec033.value="%OPRWEB01.11.830";
document.UpdateForm.operprv1.value="%OPRWEB01.11.046";
document.UpdateForm.operprv2.value="%OPRWEB01.11.047";
document.UpdateForm.operprv3.value="%OPRWEB01.11.048";
document.UpdateForm.operdes1.value="%OPRWEB01.11.049";
document.UpdateForm.operdes2.value="%OPRWEB01.11.050";
document.UpdateForm.operdes3.value="%OPRWEB01.11.051";

for (var i =0 ; i < document.UpdateForm.patadmdt.length; i++) {
  if (document.UpdateForm.patadmdt.options[i].value=="%OPRWEB01.11.036") {
    document.UpdateForm.patadmdt.selectedIndex=i;
  }
}

for (var i =0 ; i < document.UpdateForm.bkrec015.length; i++) {
  if (document.UpdateForm.bkrec015.options[i].value=="%OPRWEB01.11.819") {
    document.UpdateForm.bkrec015.selectedIndex=i;
  }
}

document.UpdateForm.patclaim.focus();
</script>

<span id=PBRFieldHiddenSPAN style="display:none">
<input type=hidden name=bokrx045 value="">
<input type=hidden name=bokrx047 value="">
</span>
<span id=AuthByFieldHiddenSPAN style="display:none">
<input type=hidden name=bokrx046 value="">
</span>
<span id=PBRTitleVisibleSPAN style="display:none">
%STANDARD.01.017.b1
</span>
<span id=PBRFieldVisibleSPAN style="display:none">
<select name="bokrx045" title="%STANDARD.01.017.b1" class=Mandatory
 tabindex=26>
    <option></option>
    %OPRWEB01.11.645.2
</select>
<input type=hidden name=bokrx047 value="%STANDARD.01.008">
</span>
<span id=AuthByTitleVisibleSPAN style="display:none">
%STANDARD.01.017.b2
</span>
<span id=AuthByFieldVisibleSPAN style="display:none">
<select name="bokrx046" title="%STANDARD.01.017.b2" class=Mandatory
 tabindex=26>
    <option></option>
    %OPRWEB01.11.646.2
</select>
</span>
