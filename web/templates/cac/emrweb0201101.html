<meta name="TemplateVersion" content="V12.01.01">
<meta name="TemplateHome" content="cac">
<meta name="HelpFileName" content="NoContextSet.html">
<meta name="CrossBrowser" content="true">
<script type="text/javascript" src="../js/emrweb0201101.js"></script>
<script type="text/javascript">
function init() {
  var strg1= trim(HiddenFields.Pres01.value)
  var strg2= trim(HiddenFields.Pres02.value)
  UpdateForm.prcom001.value=strg1+'\n'+strg2

  if (HiddenFields.DischargeComplete.value != "1") {
    alert("Patient is already discharged")
    document.UpdateForm.DButton.disabled=true
  }

// this checks to see if it is being used outside the MAPVIEW
  if(top.location.pathname.match(/EmergencyMap/g)) {
    document.UpdateForm.mapvflag.value=1
  }
}
function SearchDoctor() {
  if (UpdateForm.emcndoct.value==1) {
    DoctorEmrSearchFrame(UpdateForm.emvis007,UpdateForm.dummy3);
  }
  else {
    DoctorSearchFrame(UpdateForm.emvis007,UpdateForm.dummy3);
  }
}

function doctorName(doctor) {
  if (isWhitespace(doctor.value)) { return;;}
  doctor=doctor.value.toUpperCase()
  admissno=document.PatientLinks.admissno.value;
  user=document.PatientLinks.webuseid.value;
//  validate doctor exists in patdo1af
  var serverURL   = "../cgi-bin/patweb80.pbl?reportno=3" +
                    "&valdcode=" + doctor.replace(/ /g,"+")
  var returnValue = RSExecute(serverURL);
  if (returnValue.status!=0) {
    UpdateForm.emvis007.value="";
    UpdateForm.dummy3.value="";
    UpdateForm.emvis007.focus();
    return;
  }
//  validate doctor exists in emrdocaf
  if (UpdateForm.emcndoct.value==1) {
    var serverURL   = "../cgi-bin/emrweb08.pbl?reportno=11" +
                      "&valdcode=" + doctor.replace(/ /g,"+")
    var returnValue = RSExecute(serverURL);
    if (returnValue.status!=0) {
      UpdateForm.emvis007.value="";
      UpdateForm.dummy3.value="";
      UpdateForm.emvis007.focus();
      return;
    }
  }
  ReturnValue=returnValue.return_value.split("|");
  UpdateForm.dummy3.value=ReturnValue[0];
}

function validateLocation(SearchField,SearchName) {
  if (isWhitespace(SearchField.value)) {
      SearchName.value="";
      return;;
  }
  SearchField.value=SearchField.value.toUpperCase()
  var serverURL   = "../cgi-bin/emrweb08.pbl?reportno=2" +
                    "&valdcode=" + SearchField.value.replace(/ /g,"+")
  var returnValue = RSExecute(serverURL);
  if (returnValue.status==0) {
    ReturnValue=returnValue.return_value.split("|")
    SearchName.value=trim(ReturnValue[1])
    SearchField.value=ReturnValue[0]
  }
  else {
     document.UpdateForm.emvis006.focus();
     document.UpdateForm.emvis006.value="";
     document.UpdateForm.name_emvis006.value="";
  }
}
function EventTimeCheckDepartureDateNZ() {
  if(ValTime(document.UpdateForm.emvis024,document.UpdateForm.emvis025)){
    CheckDepartureDateNZ();
  }
}
function DepartureTimeCheckDepartureDateNZ() {
  if(ValTime(document.UpdateForm.emvis150,document.UpdateForm.emvis151)){
    CheckDepartureDateNZ();
  }
}
function checkTrans()
{
 deceasedIndicator = document.UpdateForm.emvis026.value.substr(3,1);
 checkDeceasedEMR(deceasedIndicator);
}

function ValTime(dateField,timeField) {
  if (!checkTime(timeField,timeField.title)) {
     return false;
  }
  if (!checkDate(dateField,dateField.title)) {
     return false;
  }

  SetCurrentDateTimeNoFocus(null,document.UpdateForm.currtime);
  var curDate = document.UpdateForm.currdate.value;
  var curTime = trim(document.UpdateForm.currtime.value.replace(/:/g,"")) - 0;
  var newTime = trim(timeField.value.replace(/:/g,"")) - 0;

  if (SetDateYYYYMMDD(dateField.value) == curDate) {
    if (newTime > curTime) {
      alert("Time is in the future");
      timeField.value = "";
      timeField.focus();
      return false;
    }
  }

  return true;
}
function BtnDischargeClick()
{
  CheckDepartureDateNZ();
  if (!ValTime(document.UpdateForm.emvis024,document.UpdateForm.emvis025))
    {return};
  if (!ValTime(document.UpdateForm.emvis150,document.UpdateForm.emvis151))
    {return};

  PostDischargeNZ();
}
function displayReferralFields() {
  if (document.UpdateForm.stfrefin.value != "1") {
    emvis174TitleDIV.innerHTML = "";
    emvis175TitleDIV.innerHTML = "";
    emvis176TitleDIV.innerHTML = "";
    emvis174FieldDIV.innerHTML = "";
    emvis175FieldDIV.innerHTML = "";
    emvis176FieldDIV.innerHTML = "";
    return;
  }
  displaycatRF();
}
</script>
</head>
%START.OF.PAGE
<body onload="PageLoad(event);displayReferralFields();CheckDepartureDateNZ();">
<div id=PatientHeading></div>
<script type="text/javascript">
PatientURN="%EMRWEB02.01.003";
PatientVIS="%EMRWEB02.01.081";
PatientNAM="%EMRWEB02.01.002";
PatientSTA="%EMRWEB02.01.086.078";
PatientALT="%EMRWEB02.01.084";
PatientSEX="%EMRWEB02.01.019";
PatientDOB="%EMRWEB02.01.020";
PatientAGE="%EMRWEB02.01.021";
PatientLOC="%EMRWEB02.01.083";
PatientPRI="%EMRWEB02.01.086.066.1";
PatientUNT="%EMRWEB02.01.066.0";
PatientIND="%EMRWEB02.01.086.091";
GpCOD="%EMRWEB02.01.086.084.001";
GpNAM="%EMRWEB02.01.086.084.081";
GpPRAC="%EMRWEB02.01.086.085.001";
GpPRACCNT="%EMRWEB02.01.086.085.002";
GpPRACNAM="%EMRWEB02.01.086.085.005";
PatientARR="%EMRWEB02.01.101.0 %EMRWEB02.01.102";
PatientSEE="%EMRWEB02.01.130.0 %EMRWEB02.01.131";
PatientTRI="%EMRWEB02.01.103.3";
PatientECLC="%EMRWEB02.01.484.1";
PatientCLH="%STANDARD.01.017.CL";
PatientEHFT="%EMRWEB02.01.485";
InsertEmergencyHeader()
</script>

<div id=PatientMenu></div>
<div id=PageBodySection>
<table width=100% border=0 cellspacing=0 cellpadding=1>
<tr><td class=HeadingCell align=center>
    Emergency Patient Discharge </td></tr>
</table>

<form name=UpdateForm action=emrweb02.pbl method=post style="margin:0">
<input type=hidden name=reportno value="01">
<input type=hidden name=template value="101">
<input type=hidden name=formactn>
<input type=hidden name=updttype>
<input type=hidden name=emvis133>
<input type=hidden name=admissno value="%EMRWEB02.01.081">
<input type=hidden name=updateky value="%EMRWEB02.01.404">
<input type=hidden name=urnumber value="%EMRWEB02.01.003">
<input type=hidden name=emvis118 value="%EMRWEB02.01.003">
<input type=hidden name=nextpage value="1">
<input type=hidden name=redirect value="%EMRWEB02.01.001.emrweb01.01.001">
<input type=hidden name=chkdot value="%EMRWEB02.01.107.001">
<input type=hidden name=chknur value="%EMRWEB02.01.164.1">
<input type=hidden name=loadflag >
<input type=hidden name=waittime value="%EMRWEB02.01.701">
<input type=hidden name=depttime value="%EMRWEB02.01.125">
<input type=hidden name=deptdate value="%EMRWEB02.01.124.0">
<input type=hidden name=pmpxi067 value="%EMRWEB02.01.667.0">
<input type=hidden name=mapvflag value="0">
<input type=hidden name=ptcnhdps value="%STANDARD.01.025.080.250.1.1">
<input type=hidden name=emcndoct value="%EMRWEB02.01.455">
<input type=hidden name=emcnevrm value="%STANDARD.01.025.089.226.0.4">
<input type=hidden name=ptdocsee value="%EMRWEB02.01.130.0 %EMRWEB02.01.131">
<input type=hidden name=currdate value="%STANDARD.01.013">
<input type=hidden name=currtime value="">
<input type="hidden" name="stfrefin" id="stfrefin"
 value="%EMRWEB02.01.919">

<table width=95% align=center border=0 cellspacing=0 cellpadding=1>
<tr valign=top><td>
<table width=100% border=0 cellspacing=0 cellpadding=2>
<tr valign=top><td class=DataLabel width=15%>Presenting Complaint </td>
    <td><input type=text name=emvis060 max=3 size=3 value="%EMRWEB02.01.220.1"
       readonly class="Readonly">
        <input type=text name=v060name value="%EMRWEB02.01.220.0" readonly 
         class="Readonly">
    </td>
    <td colspan=4>
    <textarea name=prcom001 wrap=hard cols=50 rows=2 
              title="Presenting Complaint"></textarea>
    </td></tr>

<tr><td>&nbsp;</td></tr>

<tr><td class=DataLabel>ED Site </td>
     <td><input type=text name=emrsite title="ED Site" readonly
          value="%EMRWEB02.01.185.0"></td></tr>

<tr><td class=DataLabel>Patient Location</td>
     <td><input type=hidden name=name_emvis006 title="Patient Location"
          tabindex=31 value="%EMRWEB02.01.106.0">
         <input type=hidden name=savelocn value="%EMRWEB02.02.106.1">
    <select class=SelectMed name=emvis006
     onchange="validateLocation(UpdateForm.emvis006,UpdateForm.name_emvis006);">
    <option></option>
    %EMRWEB02.01.106.2
    </select></td></tr>

<tr><td class=DataLabel>ED Doctor Seen</td>
<td><input type=text size=6 name=emvis007 title="ED Doctor Seen"
         class="Mandatory" value="%EMRWEB02.01.107.001" 
         onblur="UpCase(this);doctorName(UpdateForm.emvis007);">
        <input type=text size=18 name=dummy3 title="Doctor Name"
         readonly class=Readonly value="%EMRWEB02.01.107.003">
        <img src="../images/SearchIcon.gif" class=Icon
         onclick="SearchDoctor();">
        <img src="../images/erase.gif" class=Icon
         onclick="clrFields(UpdateForm.emvis007,UpdateForm.dummy3);">

<tr>
  <td class=DataLabel>Event End Date</td>
  <td width=30%>
    <input type=text size=12 class="Mandatory PastDate" title="Event End Date"
     name=emvis024 value="%EMRWEB02.01.124.0" onblur=""
     onchange="if(ValTime(UpdateForm.emvis024,UpdateForm.emvis025)){
     CheckDepartureDateNZ();}">
     <img notab src=../images/DateLookup.gif class=Icon
      onclick="DateLookupFrame(UpdateForm.emvis024,
      EventTimeCheckDepartureDateNZ);">
     <input class=Mandatory type=text name=emvis025
     size=8 value="%EMRWEB02.01.125" title="Event End Time"
     onchange="if(ValTime(UpdateForm.emvis024,UpdateForm.emvis025)){
     CheckDepartureDateNZ();}">
     <img class=Icon src="../images/erase.gif"
     onclick="clrFields(UpdateForm.emvis024,UpdateForm.emvis025);
     CheckDepartureDateNZ()">
     <img notab src=../images/DateTimeStamp.gif class=Icon
     onclick="SetCurrentDateTime(UpdateForm.emvis024,UpdateForm.emvis025);
     CheckDepartureDateNZ();">
     <img notab src=../images/TimeLookup.gif class=Icon
     onclick="TimeLookupFrame(UpdateForm.emvis025,
     EventTimeCheckDepartureDateNZ);">
  </td>
  <td class=DataLabel id="ExtDesc" disabled=true>%STANDARD.01.017.RX</td>
  <td>
    <select class="Mandatory" name=emvis152 title="%STANDARD.01.017.RX" 
     disabled=true id="ExtField">
      <option></option>
      %EMRWEB02.01.193.2
    </select>
  </td>
</tr>

<tr>
  <td class=DataLabel>Departure Date</td>
  <td width=30%>
    <input type=text size=12 name=emvis150 class="Mandatory PastDate" onblur=""
     title="Departure Date" value="%EMRWEB02.01.191" 
     onchange="checkDate(this,'Date');
     if(ValTime(UpdateForm.emvis150,UpdateForm.emvis151)){
     CheckDepartureDateNZ();}">
    <img notab src=../images/DateLookup.gif class=Icon
     onclick="DateLookupFrame(UpdateForm.emvis150,
     DepartureTimeCheckDepartureDateNZ);">
    <input class=Mandatory type=text name=emvis151 size=8 title="Departure Time"
     value="%EMRWEB02.01.192"
     onchange="if(ValTime(UpdateForm.emvis150,UpdateForm.emvis151)){
     CheckDepartureDateNZ();}">
    <img class=Icon src="../images/erase.gif"
     onclick="clrFields(UpdateForm.emvis150,UpdateForm.emvis151);
     CheckDepartureDateNZ();">
    <img notab src=../images/DateTimeStamp.gif class=Icon
    onclick="SetCurrentDateTime(UpdateForm.emvis150,UpdateForm.emvis151);
    CheckDepartureDateNZ();">
    <img notab src=../images/TimeLookup.gif class=Icon
     onclick="TimeLookupFrame(UpdateForm.emvis151,
     DepartureTimeCheckDepartureDateNZ);">
    <img notab src=../images/SwapIcon.gif class=Icon
     onclick="SetDepartureDateNZ();CheckDepartureDateNZ();">
  </td>
  <td class=DataLabel id="DelayDesc" disabled=true>%STANDARD.01.017.RY</td>
  <td>
    <select class="Mandatory" name=emvis153 title="%STANDARD.01.017.RY" disabled=true id="DelayField">
      <option></option>
      %EMRWEB02.01.194.2
    </select>
  </td>
</tr>

<tr><td class=DataLabel>Departure Destination</td>
    <td><select name=emvis026 onchange="checkTrans();"
         class=Mandatory title="Departure Destination">
        <option></option>
        %EMRWEB02.01.126.4
        </select></td></tr>

<tr><td class=DataLabel>Departure Disposition</td>
    <td><select name=emvis015
         class=Mandatory title="Departure Disposition">
        <option></option>
        %EMRWEB02.01.115.4
        </select></td></tr>
<!-- Alcohol Involved - CAR 312772 -->
<tr><td>%STANDARD.01.017.es</td>
  <td>
    <select name=emvis067 class=Mandatory>
      <option value=""></option>
      %EMRWEB02.01.227.2
    </select>
  </td></tr>

<tr>
     <td class=DataLabel>
       <div id="emvis174TitleDIV">
         %STANDARD.01.017.RF
       </div>
     </td>
     <td>
       <div id="emvis174FieldDIV">
       <select name="emvis174" tabindex=38 class="SelectMed"
        title="%STANDARD.01.017.RF" onchange="displaycatRF();">
         <option></option>
         %EMRWEB02.01.293.2
         </select>
       </div>
     </td>
     <td class=DataLabel>
       <div id="emvis176TitleDIV">
         Referral Date
       </div>
     </td>
     <td>
       <div id="emvis176FieldDIV">
         <input type=text size=12 name=emvis176 title="Referral Date"
          value="%EMRWEB02.01.295" tabindex=41
          onblur="checkDateSV(this,'Valid to');" >
         <img notab src="../images/DateLookup.gif" class="Icon"
           alt="Show Calendar" date="UpdateForm.emvis176">
       </div>
     </td>
     </tr>

<tr>
     <td class=DataLabel>
       <div id="emvis175TitleDIV">
         Referral Period (Months)
       </div>
     </td>
     <td>
       <div id="emvis175FieldDIV">
         <input type=text name=emvis175 title="Referral Period (Months)"
          class=Number size=15 maxlength=2 min=1 max=98
          value="%EMRWEB02.01.294">
       </div>
     </td>
     <td class=DataLabel></td>
     <td>

     </td>
     </tr>

</table>

<table width=100% border=0 cellspacing=0 cellpadding=2>
<tr><td colspan=4 align=center><br>
    <input name=DButton type=button value="Discharge" class="button" 
     onclick="BtnDischargeClick();">
    <input type=button value="Cancel" class="button" 
     onclick='fnPatientLink("%EMRWEB02.01.003","%EMRWEB02.01.081");'>
</td></tr>
</table>
</table>
</form>

<form name=HiddenFields method=get style="margin:0">
<input type=hidden name=DischargeComplete value="%EMRWEB02.01.147">
<input type=hidden name=HospitalAdmission value="%EMRWEB02.01.148">
<input type=hidden name=ExpectedUnit value="%EMRWEB02.01.173.1"> 
<input type=hidden name=ShowOutstanding value="%EMRWEB02.01.474"> 
<input type=hidden name=Pres01 value="%EMRWEB02.01.104">
<input type=hidden name=Pres02 value="%EMRWEB02.01.105">
</form>
<form name=PatientLinks method=get style="margin:0">
<input type=hidden name=reportno value=1>
<input type=hidden name=template value=004>
<input type=hidden name=regexstm value=102>
<input type=hidden name=newstand value=1>
<input type=hidden name=urnumber value="%EMRWEB02.01.003">
<input type=hidden name=admissno value="%EMRWEB02.01.081">
<input type=hidden name=emrgflag value="Y">
<input type=hidden name=nextpage value="4">
<input type=hidden name=MenuType value="11">
<input type=hidden name=webuseid value="%STANDARD.01.008">
</form>

<span id="emvis175TitleSPAN" style="display:none">
         Referral Period (Months)
</span>
<span id="emvis175FieldSPAN" style="display:none">
         <input type=text name=emvis175 title="Referral Period (Months)"
          class=Number size=15 maxlength=2 min=1 max=98
          value="%EMRWEB02.01.294">
</span>
<span id="emvis020TitleSPAN" style="display:none">
Referring HCP
</span>

<script type="text/javascript">
if ( document.UpdateForm.deptdate.value == "") {
  document.UpdateForm.deptdate.value="%EMRWEB02.01.233.0";
  document.UpdateForm.depttime.value="%EMRWEB02.01.243";
}
</script>
