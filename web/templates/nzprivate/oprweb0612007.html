<meta name="TemplateVersion" content="V12.01.00">
<meta name="TemplateHome" content="nzprivate">
<meta name="CrossBrowser" content="true">
<meta name="HelpFileName" content="NoContextSet.html">
<script type="text/javascript" src="../js/oprweb06.js"> </script>
<script type="text/javascript">
function init()
{
  setFocusOnTimeArrived();
}

function setFocusOnTimeArrived()
{
  var opard002 = document.getElementById("opard002");

  if(opard002)
    opard002.focus();
}

function chkTime(field){
  if(isWhitespace(field.value))
    return;

  endTime=UpdateForm.opsrg006.value.replace(/:/g,"");
  if(isWhitespace(endTime)){
     alert("Patient out of Theatre Time must be entered first");
     field.value=""
     return;
  }

  OperDate=document.UpdateForm.casekeys.value.substring(3,11);
  if(document.UpdateForm.currdate.value > OperDate) {
    return;
  }

  if(field.value.replace(/:/g,"")<=endTime){
    if(!confirm(""+field.title+" must be after Patient out of Theatre Time." +
                "\n Do you want to override")) {
      field.value="";
    }
  }
}

function ChgSurgeon() {
  UpdateForm.target="PopUpFrame"
  if (UpdateDayProc()) {
    setTimeout('showChgSur()',100);
  }
  UpdateForm.target="";
}

function showChgSur() {
  caseKeys=UpdateForm.casekeys.value.replace(/ /g,"+");
  teamNumb=UpdateForm.teamnumb.value;
  linkurl="oprweb06.pbl?reportno=12&template=005&casekeys="+caseKeys+
          "&teamnumb="+teamNumb;
  Left=(document.body.clientWidth-750)/2
  DFrameLink(linkurl,100,Left,750,350)
}

// Change Theatre
function ChgOpr() {
  UpdateForm.target="PopUpFrame"
  if (UpdateDayProc()) {
    setTimeout('showChgOpr()',100);
  }
  UpdateForm.target="";
}

function showChgOpr() {
  linkurl="oprweb01.pbl?reportno=4&template=014&casekeys="
           +UpdateForm.casekeys.value; 
  Left=(document.body.clientWidth-350)/2
  DFrameLink(linkurl,100,Left,350,180)
}

function AddImplant(){
  UpdateForm.target="PopUpFrame"
  if (UpdateDayProc()) {
    setTimeout('showImplant()',100);
  }
  UpdateForm.target="";
}

function PrintItems(){
  UpdateForm.target="PopUpFrame"
  if (UpdateDayProc()) {
    setTimeout('showPrintItm()',100);
  }
  UpdateForm.target="";
}

function showPrintItm() {
    LinkURL="patweb05.pbl?reportno=03&template=001&urnumber=" +
             PatientLinks.urnumber.value.replace(/ /g,"+") +
            "&admissno=" +
             PatientLinks.admissno.value.replace(/ /g,"+") +
            "&menuflag=1"

    Left=(document.body.clientWidth-550)/2
    DFrameLink(LinkURL,100,Left,650,280);
}

function showImplant() {
  Left=(document.body.clientWidth-750)/2
  LinkUrl="oprweb06.pbl?reportno=7&template=4&casekeys=" +
           PatientLinks.casekeys.value+"&teamnumb="+
           PatientLinks.teamnumb.value;
  DFrameLink(LinkUrl,100,Left,750,350);
}

function AddMiscItem() {
  UpdateForm.target="PopUpFrame"
  if (UpdateDayProc()) {
    setTimeout('showMiscItem()',100);
  }
  UpdateForm.target="";
}

function showMiscItem() {
  Left=(document.body.clientWidth-870)/2
  if (!AddItemsNoCharge) {
    LinkUrl="patweb75.pbl?reportno=1&template=1" +
            "&urnumber=" + PatientLinks.urnumber.value.replace(/ /g,"+") +
            "&admissno=" + PatientLinks.admissno.value.replace(/ /g,"+") +
            "&casekeys=" + UpdateForm.casekeys.value.replace(/ /g,"+") +
            "&teamnumb=" + UpdateForm.teamnumb.value.replace(/ /g,"+") ;
    DFrameLink(LinkUrl,50,Left,870,530);
   } else {
     ScreenLinkNZP("patweb75.pbl","1","7",1024,768);
   }
}
function ScreenLinkNZP(action,reportno,template,width,height) {
  document.PatientLinks.action=action;
  document.PatientLinks.reportno.value=reportno;
  document.PatientLinks.template.value=template;
  var NewWindow=window.open("","ScreenLink",
  "width="+width+",height="+height+",location=no,resizable=yes,scrollbars=yes,titlebar=no");
  NewWindow.focus();
  document.PatientLinks.target="ScreenLink";
  document.PatientLinks.submit();
}

// Update Day Procedure Details
function UpdateDayProc() {
   document.UpdateForm.updatety.value="U";

   // Set Anaesthetic Prep Time to be equal to Anaesthetic Start Time.  
   document.UpdateForm.opard041.value = document.UpdateForm.opard042.value;

   // Set Prep Time to be equal to Surgery Start Time. This is required
   // for calculation of Actual Operation Minutes.
   document.UpdateForm.opsrg003.value = document.UpdateForm.opsrg005.value;

   // Set Dressing Time to be equal to Patient out of Theatre Time. 
   // This is required for calculation of Actual Operation Minutes.
   document.UpdateForm.opsrg004.value = document.UpdateForm.opsrg006.value;

   // Set Ready To Depart Time to be equal to the Patient out of Recovery Time.
   //This is needed as opard085 is not displayed on the screen
   document.UpdateForm.opard085.value = document.UpdateForm.opard080.value;

   document.UpdateForm.opard043.value = document.UpdateForm.opard077.value;

   return(formSubmit());

}

// Validate Patient out of Theatre Time
function chkSurgEnd() {
  if(!isWhitespace(UpdateForm.opsrg006.value)) {
    if(isWhitespace(UpdateForm.opsrg005.value)) {
      alert("Surgery Start Time must be entered first.");
      UpdateForm.opsrg006.value="";
      UpdateForm.opsrg005.focus(); 
      return;
    }
    else {
      SetNoRecovery();     
    }
  }
}

// Refresh Page
function RefreshPage() {
   document.UpdateForm.method="get"
   document.UpdateForm.updatety.value="";
   document.UpdateForm.submit();
}

// Link To Procedure List
function goToProcedure() {
  uniqueky=UpdateForm.uniqueky.value.replace(/ /g,"+")
  Urnumber=PatientLinks.urnumber.value.replace(/ /g,"+")
  Admissno=PatientLinks.admissno.value.replace(/ /g,"+")
  UpdateForm.redirect.value="patweb89.pbl?reportno=09&template=4&uniqueky="+
                             uniqueky + "&urnumber=" + Urnumber +
                             "&admissno="+Admissno
  UpdateDayProc();
}

// Link To Staff List
function goToStaff() {
  caseKey=UpdateForm.casekeys.value.replace(/ /g,"+")
  temp=document.UpdateForm.teamnumb.value;
  supr=document.UpdateForm.suprlevl.value;
  UpdateForm.redirect.value="oprweb06.pbl?reportno=12&template=2&casekeys="+
                             caseKey+"&teamnumb="+temp+"&rdirflag=2"+
                             "&suprlevl="+supr;
  UpdateDayProc();
}

// Form Submit
function formSubmit() {
   if(validateMandatory(UpdateForm)) {
      casekey=UpdateForm.casekeys.value.substr(0,26);
      casekey=casekey.replace(/ /g,"+");
      uniqkey=UpdateForm.uniqueky.value
      uniqkey=uniqkey.replace(/ /g,"+");
      if (isWhitespace(UpdateForm.redirect.value)) {
        UpdateForm.redirect.value="oprweb06.pbl?reportno=12&template=007"+
                                  "&uniqueky="+uniqkey+"&teamnumb="; 
      }
      document.UpdateForm.submit();
      return true;
    }
    else
      return false;
}

// Set Team no.
function set(){
 PatientLinks.teamnumb.value=UpdateForm.teamnumb.value;
}

// Procedure Description to be made Mandatory
function ProcMan() {
  if(!isWhitespace(UpdateForm.opard077.value))  
    UpdateForm.opdea014.className="Mandatory";
  else
    UpdateForm.opdea014.className="";
}

function ShowItemOpt() {
  if (!AddItemsNoCharge) {
    ItemOpt.innerHTML=ItemOption1.innerHTML;
  } else {
    ItemOpt.innerHTML=ItemOption2.innerHTML;
  }
  if(UpdateForm.firstitm.value != "         "){
    document.UpdateForm.miscbutton.className="RedButton";}
}

function UpdateInTime() {
  UpdateForm.opard042.value = UpdateForm.opard002.value;
  UpdateForm.opsrg005.value = UpdateForm.opard002.value;

}

// Default field values according to 'No Recovery' checkbox checked status
function SetNoRecovery() {
  var chkbox = UpdateForm.norecovr;
  if (chkbox == undefined)
    return;

  if (chkbox.checked) {
    // Default 'Into/Out Recovery' field with value of 'Patient out of Theatre'
    UpdateForm.opard077.value = UpdateForm.opsrg006.value;  // Into Recovery
    UpdateForm.opard077.readOnly = true;
    UpdateForm.opard077.className = "Readonly";

    UpdateForm.opard080.value = UpdateForm.opsrg006.value;  // Out of Recovery
    UpdateForm.opard080.readOnly = true;
    UpdateForm.opard080.className = "Readonly";
  }
  else {
    UpdateForm.opard077.readOnly = false;
    UpdateForm.opard077.className = "";
    UpdateForm.opard080.readOnly = false;
    UpdateForm.opard080.className = "";
  }
}

// Show Billing Comments
function BillingComments() {
  UpdateForm.target="PopUpFrame"
  if (UpdateDayProc()) {
    setTimeout('showBillCommts()',100);
  }
  UpdateForm.target="";
}

function showBillCommts() {
  LinkURL="cliweb06.pbl?reportno=12&template=007&urnumber=" +
           document.PatientLinks.urnumber.value.replace(/ /g,"+") +
          "&admissno=" + document.PatientLinks.admissno.value.replace(/ /g,"+");
  Left=(document.body.clientWidth-880)/2
  DFrameLink(LinkURL,50,Left,880,300);
}

function BackToSessionList() {
  UpdateForm.target="PopUpFrame"
  if (UpdateDayProc()) {
    setTimeout('SessCaseList()',100);
  }
  UpdateForm.target="";
}

</script>
</head>
%START.OF.PAGE
<body onload="PageLoad(event);UpdateForm.opard002.focus();set();ProcMan();ShowItemOpt();">
<div id=PatientHeading></div>
<script type="text/javascript">
PatientURN="%OPRWEB06.12.003";
PatientVIS="%OPRWEB06.12.081";
PatientNAM="%OPRWEB06.12.002";
PatientSTA="%OPRWEB06.12.086.078";
PatientALT="%OPRWEB06.12.084";
PatientSEX="%OPRWEB06.12.019";
PatientDOB="%OPRWEB06.12.020";
PatientAGE="%OPRWEB06.12.021";
PatientLOC="%OPRWEB06.12.083";
PatientPRI="%OPRWEB06.12.086.066.1";
PatientUNT="%OPRWEB06.12.066.0";
DoctorCOD="%OPRWEB06.12.082.003";
DoctorNAM="%OPRWEB06.12.082.002";
PatientAID="%OPRWEB06.12.086.090";
PatientIND="%OPRWEB06.12.086.091";
PatientCUR="%OPRWEB06.12.086.092";
PatientCLC="%OPRWEB06.12.086.093.1";
PatientCLH="%STANDARD.01.017.CL";
PatientHFT="%OPRWEB06.12.086.094";
PatientCDM="%OPRWEB06.12.086.095";
PatientVDH="%OPRWEB06.12.086.099.015";
InsertPatientHeader()
</script>
<div id="PatientMenu"></div>

<div id=PageBodySection>
<form name=UpdateForm method=post action="oprweb06.pbl" style="margin:0">
<input type=hidden name=reportno value=12>
<input type=hidden name=template value=7>
<input type=hidden name=updatety value="">
<input type=hidden name=urnumber value='%OPRWEB06.12.003'>
<input type=hidden name=casekeys value="%OPRWEB06.12.101">
<input type=hidden name=uniqueky value='%OPRWEB06.12.110'>
<input type=hidden name=redirect value="">
<input type=hidden name=nextpage value=1>
<input type=hidden name=gnm>
<input type=hidden name=suprlevl value="%OPRWEB06.12.313">
<input type=hidden name=opdunqid value="">
<input type=hidden name=teamnumb value="%OPRWEB06.12.334">
<input type=hidden name=currdate value="%STANDARD.01.013">
<input type=hidden name=opard041>
<input type=hidden name=opsrg003>
<input type=hidden name=opsrg004>
<input type=hidden name=opard085>
<input type=hidden name=mbsitem value="%OPRWEB06.12.346">
<input type=hidden name=opard042 value="">
<input type=hidden name=opsrg005 value="">
<input type=hidden name=opard043 value=" ">
<input type=hidden name=opdea003 value="%OPRWEB06.12.113.1">
<input type=hidden name=firstitm value="%OPRWEB06.12.213">

<table border="0" cellpadding="0" cellspacing="0" width="100%" align="center">
<tr><td class=HeadingCell align=left>
      <img src="../images/ListIcon.gif" class=Icon onclick="BackToSessionList();">
    </td>
    <td align=center class=HeadingCell width=85%>Theatre Procedure Details</td>
    <td align=right class=HeadingCell><font color=red>
     %OPRWEB06.12.208</font></td></tr>

</table>
<table border="0" cellpadding="0" cellspacing="0" width="100%" align="center">
<tr><td class=DataLabel>Consultant</td>
    <td class=DataField>
    <a href='javascript:DoctorViewFrame("%OPRWEB06.12.404.003")'>
    %OPRWEB06.12.404.002 </a></td>
    <td class=DataLabel>Operating Surgeon</td>
    <td class=DataField>
    <a href='javascript:DoctorViewFrame("%OPRWEB06.12.311.003")'>
    %OPRWEB06.12.311.002 </a></td>
    <td class=DataField>
    <input type=button value="Change Surgeon" class="button"
     onclick="ChgSurgeon();"></td>
</tr>

<tr><td class=DataLabel>Unit</td>
    <td class="DataField">
      <select name=opses012 title="Unit" class=SelectBig>
        <option></option>
         %OPRWEB06.12.413.2
      </select>
    </td>
    <td class=DataLabel>Theatre</td>
    <td class=DataField>%OPRWEB06.12.302</td>
    <td class=DataField>
       <input type=button value="Change Theatre" class="button" 
        onclick="ChgOpr();"></td></tr> 

<tr><td class=DataLabel>Date </td>
    <td class=DataField>%OPRWEB06.12.406 %OPRWEB06.12.402</td>
    <td class=DataLabel>Time </td>
    <td class=DataField>%OPRWEB06.12.403</td></tr>
</table>

<hr>

<table border="0" cellpadding="0" cellspacing="0" align="center">
<tr><td class=DataLabel width=140>&nbsp;Procedure</td>
    <td>
      <input type=text size=116 name=opdea014 maxlength=80 tabindex="1"
       title="Procedure Description" value="%OPRWEB06.12.305">
    </td>
    <td width=80>&nbsp;</td>
</tr>

<tr><td class=DataLabel>&nbsp;</td>
    <td>
      <input type=text size=116 name=opdea015 maxlength=80 tabindex="2"
       title="Procedure Description" value="%OPRWEB06.12.343">
    </td>
    <td>&nbsp;</td>
</tr> 

<tr><td class=DataLabel>&nbsp;</td>
    <td>
      <input type=text size=116 name=opdea016 maxlength=80 tabindex="3"
       title="Procedure Description" value="%OPRWEB06.12.344">
    </td>
    <td>&nbsp;</td>
</tr>
</table>

<br>

<table border="0" cellpadding="2" cellspacing="2" align="center">
<tr><td class=DataLabel width=135>Patient into Theatre</td>
    <td class=DataField>
      <input type=text name=opard002 id="opard002" size=8 maxlength=8 
       title="Patient into Theatre Time" value="%OPRWEB06.12.502" tabindex="4"
       onblur="checkTime(this,this.title);UpdateInTime();">
      <img src="../images/DateTimeStamp.gif" class=Icon
       onclick="SetCurrentDateTime(null,opard002);UpdateInTime();">
      <img src="../images/TimeLookup.gif" class=Icon
       onclick="TimeLookupFrame(opard002);">
    </td>
    <td width=100>
      <input class="button" type=button name="procbutton" value="Procedures"
       tabindex="10" onclick="goToProcedure();">
    </td>
</tr>

<tr><td class=DataLabel>Patient out of Theatre</td>
    <td>
      <input type=text name=opsrg006 id=opsrg006 size=8 maxlength=8 
       title="Patient out of Theatre Time" value="%OPRWEB06.12.338" tabindex="5"
       onblur="checkTime(this,this.title);chkSurgEnd();
              if (!isWhitespace(UpdateForm.opsrg006.value) &&
                   isWhitespace(UpdateForm.opard077.value)) {
                UpdateForm.opard077.value=UpdateForm.opsrg006.value;
              }">
      <img src="../images/DateTimeStamp.gif" class=Icon
       onclick="SetCurrentDateTime(null,opsrg006);">
      <img src="../images/TimeLookup.gif" class=Icon
       onclick="TimeLookupFrame(opsrg006);">
      &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
      No Recovery for this Patient &nbsp;
      <input type=checkbox name=norecovr title="No Recovery for this Patient"
       tabindex="6" onclick="SetNoRecovery();">
    </td>

    <td>
      <input type=button name="impbutton" class="button" value="Add Implant"
       tabindex="11" onclick="AddImplant();">
    </td>
</tr>

<tr><td class=DataLabel>Theatre Comments</td>
    <td class=DataField><div id=CommentText></div></td>
    <td>
      <table cellpadding=0 cellspacing=0>
      <tr>
        <td height=28>
        <div id=ItemOpt></div>
        </td>
      </tr>
      <tr>
        <td height=28>
          <input type=button class="button" name=staffbutton tabindex="13"
           value="Staff Members" onclick="goToStaff();">
        </td>
      </tr>
      </table>
    </td>
</tr>

<tr><td class=DataLabel>Extended Procedure Description</td>
    <td colspan=3>
       <textarea wrap=hard cols=70 rows=6 id=extprcmt name=extprcmt
              title="Extended Procedure Description"
              onkeydown="LimitText(this,999,69930);"
              tabindex=7>%OPRWEB06.12.143.024</textarea>
    </td>
</tr>

<tr><td class=DataLabel>Patient into Recovery</td>
    <td class=DataField colspan=2>
      <input type=text name=opard077 id=opard077 size=8 maxlength=8 tabindex=8
       title="Patient into Recovery" value="%OPRWEB06.12.577"
       onBlur="checkTime(this,this.title);chkTime(this);ProcMan();">
      <img src="../images/DateTimeStamp.gif" class=Icon
       onclick="SetCurrentDateTime(null,opard077);">
      <img src="../images/TimeLookup.gif" class=Icon
       onclick="TimeLookupFrame(opard077);"></td>
</tr>

<tr><td class=DataLabel>Patient out of Recovery</td>
    <td class=DataField colspan=2>
      <input type=text name=opard080 id=opard080 size=8 maxlength=8 tabindex=8
       title="Patient out of Recovery Time" value="%OPRWEB06.12.580"
       onBlur="checkTime(this,this.title);chkTime(this);">
      <img src="../images/DateTimeStamp.gif" class=Icon
       onclick="SetCurrentDateTime(null,opard080);">
      <img src="../images/TimeLookup.gif" class=Icon
       onclick="TimeLookupFrame(opard080);">
    </td>
</tr>
</table>

<br>

<table border="0" cellpadding="0" cellspacing="0" width="100%" align="center">
<tr>
  <td align=center>
    <input type=button value="Billing Comments" class="button" tabindex=20 
           onclick="BillingComments();" name=cmtsBttn>
    <input type=button value="Update" class="button" tabindex="21" 
           name="btnUpdate" id="btnUpdate"
           onclick="tempDisable(this);UpdateDayProc();">
    <input type=button value="Cancel" class="button" tabindex="22"
           onclick="RefreshPage();">
  </td>
</tr>
</table>
</form>

<form  name=PatientLinks method=get style="margin:0">
<input type=hidden name=reportno value=12>
<input type=hidden name=template value=001>
<input type=hidden name=urnumber value='%OPRWEB06.12.003'>
<input type=hidden name=admissno value='%OPRWEB06.12.081'>
<input type=hidden name=MenuType value='%OPRWEB06.12.088'>
<input type=hidden name=casekeys value='%OPRWEB06.12.101'>
<input type=hidden name=uniqueky value='%OPRWEB06.12.110'>
<input type=hidden name=teamnumb value='%OPRWEB06.12.334'>
<input type=hidden name=sesskeys value='%OPRWEB06.12.102.oprweb01.03.003'>
</form>
</div>

<span id=ThtrCom style="display:none">
  <textarea wrap=hard cols=70 rows=3 name=opcom008 tabindex="6" 
   onkeydown="LimitText(this,999,69930);">
%OPRWEB06.12.143.008
  </textarea>
</span>

<span id=BookCom style="display:none">
  <textarea wrap=hard cols=70 rows=3 name=opcom008 tabindex="6" 
   onkeydown="LimitText(this,999,69930);">
%OPRWEB06.12.143.009
  </textarea>
</span>

<span id=ItemOption1 style="display:none">
     <input type=button class="button" name=miscbutton tabindex="12"
	value="Add Misc Item" onclick="AddMiscItem();">
</span>

<span id=ItemOption2 style="display:none">
     <input type=button class="button" name=miscbutton tabindex="12"
	value="Add Misc Item" onclick="AddMiscItem();">
     <input type=button class="button" name=prntbutton tabindex="12"
	value="Print Items" onclick="PrintItems();">
</span>

<script type="text/javascript">
var mbsCount = %OPRWEB06.12.201
if (mbsCount >= 1){
  document.UpdateForm.procbutton.className="RedButton";}

var impCount = %OPRWEB06.12.203
if (impCount > 1){
  document.UpdateForm.impbutton.className="RedButton";}

var staffExist = "%OPRWEB06.12.214"
if (staffExist == "1"){
  document.UpdateForm.staffbutton.className="RedButton";}

// Default MBS Item from Booking
if (isWhitespace(document.UpdateForm.mbsitem.value))
  document.UpdateForm.mbsitem.value="%OPRWEB06.12.345";

// Default Comment from Booking
if (%OPRWEB06.12.211 == 0)                       // First display of this page?
  CommentText.innerHTML = BookCom.innerHTML;     // Yes, default from booking
else
  CommentText.innerHTML = ThtrCom.innerHTML;     // No, use Day Proc comments

// Billing Comments exists?
var billCmntsInd = "%OPRWEB06.12.355";
if (billCmntsInd == "1") {
  UpdateForm.cmtsBttn.className = UpdateForm.cmtsBttn.className + " RedButton"; 
}

// Patient into/out of Recovery times the same?
if (!isWhitespace(UpdateForm.opard077.value)) {
  if (UpdateForm.opard077.value == UpdateForm.opard080.value) {
    UpdateForm.norecovr.checked = true;
    UpdateForm.opard077.readOnly = true;
    UpdateForm.opard077.className = "Readonly";
    UpdateForm.opard080.readOnly = true;
    UpdateForm.opard080.className = "Readonly";
  }
}

</script>

