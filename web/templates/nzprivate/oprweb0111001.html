<meta name="TemplateVersion" content="V12.01.00">
<meta name="TemplateHome" content="nzprivate">
<meta name="HelpFileName" content="NoContextSet.html">
<meta name="CrossBrowser" content="true">
<script type="text/javascript" >
function RemoveQuote(Field) {
    Field.value=Field.value.replace(/\"/g,"");
    Field.value=Field.value.replace(/\'/g,"");
}
function changeOperation(theForm) { 
for (var i = 0; i < theForm.operpref.length; i++) {
 if (theForm.operpref.options[i].selected == true) {
  theForm.elements["operdes1"].value=theForm.operpref.options[i].text }
 }
}
function changeAdmitDate(theForm) {   
for (var i = 0; i < theForm.patadmdt.length; i++) {
 if (theForm.patadmdt.options[i].selected == true) {
  theForm.elements["operdes3"].value="Admit:"+theForm.patadmdt.options[i].text }
  }
}
function CancelBooking(linkurl) {
  Left=(document.body.clientWidth-640)/2
  DFrameLink(linkurl,0,Left,640,290)
}
function Check(){
 if(!validateMandatory(UpdateForm))
   return;
 UpdateForm.bkrec006.disabled=false
 UpdateForm.bkrec007.disabled=false
 UpdateForm.patadmdt.disabled=false
 UpdateForm.bkrec005.disabled=false
 p=document.UpdateForm
 validateSuspension(p.urnumber,p.bookdate,p.datefrom,p.dateto);
 if(p.datefrom.value!='0'){
      ans=confirm("Warning : Patient has a Suspension record for period \n" +
            "\t" + p.datefrom.value  + " - " + p.dateto.value);
      if (ans!=true) {
         return; }
      }
 if(ChkDateTime(UpdateForm.patadmdt,null,UpdateForm.bookdate,null)){
   if (UpdateForm.bkrestat.value == "Pre-admitted") {
       UpdateForm.redirect.value="patweb89.pbl?reportno=01&template=032"
          + "&urnumber="+document.PatientLinks.urnumber.value.replace(/ /g,"+")
          + "&admissno="+document.PatientLinks.admissno.value.replace(/ /g,"+");
   } else {
       UpdateForm.redirect.value="oprweb01.pbl?reportno=04&template=001"+
                  "&caseuniq="+UpdateForm.caseuniq.value.replace(/ /g,"+")
   }
       UpdateForm.submit();
    }
 else {
       alert("Theatre Booking cannot be before Admission Date");
      }
}
function checkWatEntry(){
   if (UpdateForm.bkrec006.value != "") {
     UpdateForm.bkrec006.className="Readonly"
     UpdateForm.bkrec006.disabled=true
     UpdateForm.bokrx002.focus()
   }else {
     UpdateForm.bkrec006.focus()
     return;
   }
   if (UpdateForm.bkrec007.value != "") {
     UpdateForm.bkrec007.className="Readonly"
     UpdateForm.bkrec007.disabled=true
   }
}
function DisableIcon(field) {
  if (field.disabled == true) {
    alert(field.title+" is for display only")
    UpdateForm.bokrx002.focus()
  }
}
function validateMBSCode(OptionNumber,ReturnCode,ReturnName,Casekeys) {
  ReturnFunction="" ;
  ReturnName.value="";
  for (var i=5; i < validateMBSCode.arguments.length; i++) {
    if (typeof(validateMBSCode.arguments[i]) == 'function') {
      ReturnFunction=validateMBSCode.arguments[i] }
    else {
      validateMBSCode.arguments[i].value=""; }  }
  if (isWhitespace(ReturnCode.value)) return;;

  if(validateMBSCode.arguments[4] != undefined){
  var serverURL   = "../cgi-bin/oprweb01.pbl?reportno=" + OptionNumber +
                    "&valdcode=" + ReturnCode.value.replace(/ /g,"+") +
                    "&casekeys=" + Casekeys.value +
                    "&valdedat=" +
                    validateMBSCode.arguments[4].value.replace(/ /g,"+")

  } else {

  var serverURL   = "../cgi-bin/oprweb01.pbl?reportno=" + OptionNumber +
                    "&valdcode=" + ReturnCode.value.replace(/ /g,"+") +
                    "&casekeys=" + Casekeys.value
  }

  var returnValue = RSExecute(serverURL);
  if (returnValue.status==0) {
    ReturnValue=returnValue.return_value.split("|")
    ReturnName.value=trim(ReturnValue[0])

    if (typeof(ReturnFunction) == 'function') {
       ReturnFunction() } }
  else {
    ReturnCode.value="";
    ReturnCode.focus();
    ReturnCode.select();
    return false;
     }
}
function AddDescToExtendedProcDesc(desc) {
  f = document.UpdateForm;

  if (isWhitespace(desc.value)) { return; }

  if (isWhitespace(f.extprcmt.value)) {
    f.extprcmt.value = desc.value;
  }
  else {
    f.extprcmt.value = f.extprcmt.value + "\n" + desc.value;
  }
  
  LimitText(f.extprcmt,999,69930);
  
  // set cursor at end of text
  SetCaretPosition('extprcmt',"-1");
}
</script>
</head>
%START.OF.PAGE
<body onload="PageLoad(event);UpdateForm.patclaim.focus();">
<div id=PatientHeading></div>
<script type="text/javascript">
PatientURN="%OPRWEB01.11.203";
PatientVIS="%OPRWEB01.11.281";
PatientNAM="%OPRWEB01.11.202";
PatientSTA="%OPRWEB01.11.286.078";
PatientALT="%OPRWEB01.11.284";
PatientSEX="%OPRWEB01.11.219";
PatientDOB="%OPRWEB01.11.220";
PatientAGE="%OPRWEB01.11.221";
PatientLOC="%OPRWEB01.11.283";
PatientPRI="%OPRWEB01.11.286.066.1";
PatientUNT="%OPRWEB01.11.266.0";
DoctorCOD="%OPRWEB01.11.282.003";
DoctorNAM="%OPRWEB01.11.282.002";
PatientAID="%OPRWEB01.11.286.090";
PatientIND="%OPRWEB01.11.286.091";
PatientCUR="%OPRWEB01.11.286.092";
PatientCLC="%OPRWEB01.11.286.093.1";
PatientCLH="%STANDARD.01.017.CL";
PatientHFT="%OPRWEB01.11.286.094";
PatientCDM="%OPRWEB01.11.286.095";
PatientVDH="%OPRWEB01.11.286.099.015";
InsertPatientHeader()
</script>

<div id=PatientMenu></div>
<div id=PageBodySection>

<form name=UpdateForm onSubmit="return validateMandatory(this);"
 action=oprweb01.pbl method=post style="margin:0">
<input type=hidden name=reportno value=12>
<input type=hidden name=template value=1>
<input type=hidden name=casekeys value="%OPRWEB01.11.001">
<input type=hidden name=caseuniq value="%OPRWEB01.11.710">
<input type=hidden name=bookdate id=bookdate value="%OPRWEB01.11.102">
<input type=hidden name=urnumber value="%OPRWEB01.11.203">
<input type=hidden name=nextpage value="1">
<input type=hidden name=redirect >
<input type=hidden name=datefrom >
<input type=hidden name=dateto >
<input type=hidden name=opcnfdur value="%STANDARD.01.025.113.002.0.1">
<input type=hidden name=firstbok value="1">
<input type=hidden name=autopref value="1">
<input type=hidden name=bkrestat value="%OPRWEB01.11.813">

<table border="0" cellpadding="0" cellspacing="0" width="95%" align=center>
<tr><td align=center class=HeadingCell>Update Booking Form</td></tr>
</table>

<table border="0" cellpadding="0" cellspacing="0" width="95%" align=center>
<tr><td width=15% class=DataLabel>Surgeon   </td>
    <td ><a href='javascript:DoctorViewFrame("%OPRWEB01.11.104.003")'>
         <b>%OPRWEB01.11.104.002</b>&nbsp;</a></td>
    <td width=15%>Anaesthetist   </td>
    <td><a href='javascript:DoctorViewFrame("%OPRWEB01.11.116.003")'>
         %OPRWEB01.11.116.002</a></td></tr>

<tr><td class=DataLabel>Unit  </td>
    <td class=DataField> %OPRWEB01.11.113.0</td></tr>

<tr><td width=15% class=DataLabel>Theatre  </td>
    <td class=DataField> %OPRWEB01.11.114.0 </td>
    <td class=DataLabel>Session Type       </td>
    <td class=DataField>%OPRWEB01.11.169.0  </td></tr>

<tr><td class=DataLabel>Date  </td>
    <td class=DataField>%OPRWEB01.11.106 %OPRWEB01.11.102</td>
    <td class=DataLabel>Time  </td>
    <td class=DataField> %OPRWEB01.11.103 to %OPRWEB01.11.108</td></tr>
<tr><td colspan=4 align=center><hr width=100%></td></tr>
<tr><td class=DataLabel>Pre-Admission</td>
    <td class=DataLabel>
    <input type=text name=bkrec006 id=bkrec006 size=12 maxlength=11 class=""
     value="%OPRWEB01.11.808" onblur="checkDate(this,'Date')"
     title="Pre-Admission Date" tabindex=1 >
    <img src="../images/DateLookup.gif" class=Icon
     onclick='javascript:DateLookupFrame(bkrec006)'
     onFocus='javascript:DisableIcon(bkrec006)' tabindex=-1>
    Time
    <input type=text name=bkrec007 id=bkrec007 size=7
     title="Pre-Admission Time" tabindex=2 value="%OPRWEB01.11.809">
    <img src="../images/DateTimeStamp.gif" class=Icon  
    onclick="SetCurrentDateTime(bkrec006,bkrec007);"
    onFocus='javascript:DisableIcon(bkrec007)' tabindex=-1>
    <img src="../images/TimeLookup.gif" class=Icon  
    onclick="TimeLookupFrame(bkrec007);"
    onFocus='javascript:DisableIcon(bkrec007)' tabindex=-1> 
    </td>

<tr><td class=DataLabel>Admitting Point</td>
    <td class=DataField>
    <select name=bokrx003 title="Admitting Point" class=Mandatory tabindex=3>
    <option></option>
    %OPRWEB01.11.603.2
    </select></td>
    <td class=DataLabel>Equipment Req 1</td>
    <td><select name="opdea032" tabindex=31
             title="Equipment Required 1">
    <option></option>
    %OPRWEB01.11.745.2
    </select>
    </td></tr>

<tr> <td class=DataLabel>Exp.Post Op Ward</td>
    <td class=DataField>
    <select name=bokrx002 title="Exp.Post Op Ward" tabindex=4 class=Mandatory>
    <option></option>
    %OPRWEB01.11.602.2
    </select>
    </td>
    <td class=DataLabel>Equipment Req 2</td>
    <td><select name="opdea033" tabindex=32
             title="Equipment Required 2">
    <option></option>
    %OPRWEB01.11.746.2
    </select>
    </td></tr>

<tr><td class=DataLabel>%STANDARD.01.017.CL</td>
    <td class=DataField>
 <select name="patclaim" title="%STANDARD.01.017.CL" class=Mandatory tabindex=5>
     <option></option>
     %OPRWEB01.11.827.2
     </select></td>
    <td class=DataLabel>Equipment Req 3</td>
    <td><select name="opdea035" tabindex=33
             title="Equipment Required 3">
    <option></option>
    %OPRWEB01.11.749.2
    </select>
    </td></tr>
<tr><td class=DataLabel>Referral Source</td>
     <td class=DataField>
     <select name="bokrx031" tabindex=6
             title="Referral Source" class=Mandatory>
     <option></option>
     %OPRWEB01.11.631.2
     </select></td>
    <td class=DataLabel>Equipment Loaned</td>
    <td><select name="opdea034" tabindex=34
             title="Equipment Loaned">
    <option></option>
    %OPRWEB01.11.747.2
    </select>
    </td></tr>

<tr><td class=DataLabel>Intended Length of Stay </td>
    <td class=DataLabel>
    <input type=text name=bkrec033 size=4 maxlength=3 class=Integer
           title="Planned Length of Stay"
           tabindex=7>(days)</td>
    <td class=DataLabel>Operation Type </td>
    <td><select name="opertype" tabindex=35
             title="Operation Type">
    <option></option>
    %OPRWEB01.11.714.2
    </select>
    </td></tr>
<tr><td class=DataLabel>Confirmed Admission</td>
    <td class=DataLabel>
     <input type=text name=patadmdt id=patadmdt 
             size=12 maxlength=11 class=Mandatory
     onblur="checkDate(this,'Date')" title="Confirmed Admission" 
     value="%OPRWEB01.11.806" tabindex=8>
     <img src="../images/DateLookup.gif" class=Icon
     onclick='javascript:DateLookupFrame(patadmdt)'
     onFocus='javascript:DisableIcon(patadmdt)' tabindex=-1>
    Time
    <input type=text name=bkrec005 id=bkrec005 size=7 tabindex=9
            title="Admission Time" class=Mandatory
            value='%OPRWEB01.11.807' >
    <img src="../images/DateTimeStamp.gif" class=Icon
     onclick='javascript:SetCurrentDateTime(patadmdt,bkrec005)'
     onFocus='javascript:DisableIcon(bkrec005)' tabindex=-1>
    <img src="../images/TimeLookup.gif" class=Icon
     onclick='javascript:TimeLookupFrame(bkrec005)'
     onFocus='javascript:DisableIcon(bkrec005)' tabindex=-1>
    </td></tr>

<tr><td class=DataLabel>Procedure</td>
    <td><input type=text name=operprv1 id=operprv1 size=9 
           onblur='validateMBSCode(17,operprv1,mbsdesc1,casekeys,bkrec006);
                   operdes1.value=mbsdesc1.value'
           title="Expected Proc Item 1"
           tabindex=10>
        <input type=text class=ReadOnly readonly name=mbsdesc1
           id=mbsdesc1  size=35 title="Expected Proc Item 1 Name " 
           value="%OPRWEB01.11.766.0" tabindex=-1>
        <img src="../images/SearchIcon.gif" class=Icon
         onclick="MbsSearchFrame(operprv1,mbsdesc1,bookdate)"></td>
    <td class=DataLabel>Full Description</td>
    <td><input type="text" size="120" maxlength=80 name="operdes1" 
           title="Operation Description 1"
           tabindex=35 onblur="RemoveQuote(this);">
        <img src="../images/copy.gif" class=Icon
         onclick="AddDescToExtendedProcDesc(UpdateForm.operdes1)">
    </td>

<tr><td></td>
    <td><input type=text name=operprv2 id=operprv2 size=9
           onblur='validateCode(4,operprv2,mbsdesc2,bookdate);
                   operdes2.value=mbsdesc2.value'
           title="Expected Proc Item 2"
           tabindex=11>
    <input type=text readonly name=mbsdesc2 id=mbsdesc2 size=35
           title="Expected Proc Item 2 Name" class=ReadOnly
           value="%OPRWEB01.11.722.0" tabindex=-1>
    <img src="../images/SearchIcon.gif" class=Icon
     onclick="MbsSearchFrame(operprv2,mbsdesc2,bookdate)"></td>
    <td></td>
    <td><input type="text" size="120" maxlength=80 name="operdes2" 
           title="Operation Description 2" tabindex=37 
           onblur="RemoveQuote(this);">
        <img src="../images/copy.gif" class=Icon
         onclick="AddDescToExtendedProcDesc(UpdateForm.operdes2)">
    </td>

<tr><td></td>
    <td><input type=text name=operprv3 id=operprv3 size=9
           onblur='validateCode(4,operprv3,mbsdesc3,bookdate);
                   operdes3.value=mbsdesc3.value'
           title="Expected Proc Item 3"
           tabindex=12>
    <input type=text readonly name=mbsdesc3 id=mbsdesc3 size=35
           title="Expected Proc Item 3 Name" class=ReadOnly 
           value="%OPRWEB01.11.723.0" tabindex=-1>
    <img src="../images/SearchIcon.gif"
     onclick="MbsSearchFrame(operprv3,mbsdesc3,bookdate)"></td>

    <td></td>
    <td><input type="text" size="120" maxlength=80 name="operdes3" 
           title="Operation Description 2" onblur="RemoveQuote(this);"
           tabindex=38>
        <img src="../images/copy.gif" class=Icon
         onclick="AddDescToExtendedProcDesc(UpdateForm.operdes3)">
    </td>

    <tr><td class=DataLabel> Duration </td>
    <td><div id=Duration></div></td>
    
    <td class=DataLabel> Blood Type </td>
    <td><select name="bokrx032" tabindex=39
             title="Blood Type">
    <option></option>
    %OPRWEB01.11.632.2
    </select>
    </td></tr>

    <tr><td class=DataLabel>Anaesthetic Type</td>
    <td><select name="operanae" title="Anaesthetic" class=Mandatory tabindex=18>
    <option></option>
    %OPRWEB01.11.006.2
    </select></td>
    <td class=DataLabel>Infection Status </td>
    <td><select name="operknow" tabindex=40
             title="Infection Status">
    <option></option>
    %OPRWEB01.11.740.2
    </select>
    </td></tr>

<tr><td class=DataLabel>Prosthesis Required</td>
    <td><input type="text" size="40" maxlength=40 name=opercomm 
           title="Operation Comment" tabindex=19 value='%OPRWEB01.11.728'>
    </td></tr>

<tr><td class=DataLabel>Comments</td>
    <td colspan=3>
       <textarea wrap=hard cols=60 rows=3 tabindex=21
              onkeydown="LimitText(this,999,59940);"
              name=opcom011>%OPRWEB01.11.743.011</textarea>
    </td></tr>

<tr><td>&nbsp;</td><td>&nbsp;</td></tr>
<tr><td class=DataLabel>Extended Procedure Description</td>
    <td colspan=3>
       <textarea wrap=hard cols=70 rows=6 id=extprcmt name=extprcmt
              title="Extended Procedure Description"
              onkeydown="LimitText(this,999,69930);"
              tabindex=22>%OPRWEB01.11.743.024</textarea>
    </td>
</tr>

<tr><td colspan=4 align="center">
    <input type=button id="opr01sub" class=button value="Ok" 
     onclick="tempDisable(this);Check();" tabindex=50>
    <input type=button class=button value="Cancel"
           onclick="history.go(-1)"
           tabindex=51>
    </td></tr>
</table>
</form>
</div>

<span id=SDuration style="display:none">
    <td><select name="operexpd"
             title="Operation Expected Duration"
             class=Mandatory
             tabindex=16>
    <option value=""></option>
    <option value="  10">10 min</option>
    <option value="  15">15 min</option>
    <option value="  20">20 Min</option>
    <option value="  30">30 min</option>
    <option value="  40">40 min</option>
    <option value="  50">50 min</option>
    <option value="  60">60 min</option>
    <option value="  70">70 min</option>
    <option value="  80">80 min</option>
    <option value="  90">90 min</option>
    <option value=" 100">100 min</option>
    <option value=" 110">110 min</option>
    <option value=" 120">120 Min</option>
    <option value=" 130">130 min</option>
    <option value=" 140">140 min</option>
    <option value=" 150">150 min</option>
    <option value=" 160">160 min</option>
    <option value=" 170">170 min</option>
    <option value=" 180">180 min</option>
    <option value=" 190">190 min</option>
    <option value=" 200">200 min</option>
    <option value=" 210">210 min</option>
    <option value=" 220">220 min</option>
    <option value=" 230">230 min</option>
    <option value=" 240">240 min</option>
    <option value=" 250">250 min</option>
    <option value=" 260">260 min</option>
    <option value=" 270">270 min</option>
    <option value=" 280">280 min</option>
    <option value=" 290">290 min</option>
    <option value=" 300">300 min</option>
    </select>
    </td>
</span>
<span id=FDuration style="display:none">
<td><input type=text name="operexpd" size=6 maxlength=4 min=0
             title="Operation Expected Duration" class="Mandatory Integer"
              value="%OPRWEB01.11.038" tabindex=17>
        (minutes)
</td>
</span>
<form name=PatientLinks method=get>
<input type=hidden name=reportno value=9>
<input type=hidden name=template value=002>
<input type=hidden name=urnumber value="%OPRWEB01.11.203">
<input type=hidden name=admissno value="%OPRWEB01.11.281">
<input type=hidden name=MenuType value="%OPRWEB01.11.288">
<input type=hidden name=casekeys value="%OPRWEB01.11.001">
</form>
<SCRIPT LANGUAGE=javascript>
if(document.UpdateForm.opcnfdur.value=="1") {
  Duration.style.display="";
  Duration.innerHTML=FDuration.innerHTML;
} else {
  Duration.style.display="";
  Duration.innerHTML=SDuration.innerHTML;
  for (var i =0 ; i < document.UpdateForm.operexpd.length; i++) {
    if (document.UpdateForm.operexpd.options[i].value=="%OPRWEB01.11.038") {
        document.UpdateForm.operexpd.selectedIndex=i } };
}
   document.UpdateForm.bkrec033.value="%OPRWEB01.11.830" ;
   document.UpdateForm.operprv1.value="%OPRWEB01.11.046" ;
   document.UpdateForm.operprv2.value="%OPRWEB01.11.047" ;
   document.UpdateForm.operprv3.value="%OPRWEB01.11.048" ;

//   document.UpdateForm.operdes1.value="%OPRWEB01.11.751" ;
//   document.UpdateForm.operdes2.value="%OPRWEB01.11.752" ;
//   document.UpdateForm.operdes3.value="%OPRWEB01.11.753" ;

   document.UpdateForm.operdes1.value="%OPRWEB01.11.724" ;
   document.UpdateForm.operdes2.value="%OPRWEB01.11.725" ;
   document.UpdateForm.operdes3.value="%OPRWEB01.11.726" ;
   for (var i =0 ; i < document.UpdateForm.patadmdt.length; i++) {
     if (document.UpdateForm.patadmdt.options[i].value=="%OPRWEB01.11.036") {
         document.UpdateForm.patadmdt.selectedIndex=i } };
   for (var i =0 ; i < document.UpdateForm.operexpd.length; i++) {
     if (document.UpdateForm.operexpd.options[i].value=="%OPRWEB01.11.038") {
         document.UpdateForm.operexpd.selectedIndex=i } };

/*
   for (var i =0 ; i < document.UpdateForm.bkrec019.length; i++) {
     if (document.UpdateForm.bkrec019.options[i].value=="%OPRWEB01.11.423.0") {
         document.UpdateForm.bkrec019.selectedIndex=i } };
   for (var i =0 ; i < document.UpdateForm.bkrec021.length; i++) {
     if (document.UpdateForm.bkrec021.options[i].value=="%OPRWEB01.11.413.0") {
         document.UpdateForm.bkrec021.selectedIndex=i } };
*/
   for (var i =0 ; i < document.UpdateForm.bokrx002.length; i++) {
     if (document.UpdateForm.bokrx002.options[i].value=="%OPRWEB01.11.819") {
         document.UpdateForm.bokrx002.selectedIndex=i } };

   document.UpdateForm.patclaim.focus();
</SCRIPT>

