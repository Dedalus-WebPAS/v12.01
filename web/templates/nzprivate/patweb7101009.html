<meta name="TemplateVersion" content="V12.01.00">
<meta name="TemplateHome" content="nzprivate">
<meta name="HelpFileName"    content="NoContextSet.html">
<meta name="CrossBrowser"      content="true">
<script type="text/javascript">
function displayUnitPrice() {
  ind=document.ItemForm.keyinprc.value;
  if (ind=="Y") {
    DisUnitPriceHead.innerHTML=disunithd.innerHTML;
    DisUnitPrice.innerHTML=disunitprice.innerHTML;
    justifyLeft(ItemForm.mschg013,2);
  } else {
    DisUnitPriceHead.innerHTML="";
    DisUnitPrice.innerHTML=blankunitprice.innerHTML;
  }
}

function GetAmount(ReturnCode,DateField,PatPr,RebPr,ItemDesc)
{
  var code=ReturnCode.name;

  if (isWhitespace(ReturnCode.value)) {
    return;
  }
  ReturnCode.value=ReturnCode.value.replace(/ /g,"")

  if (isWhitespace(ReturnCode.value)) { return; }

  var serverURL = "../cgi-bin/patweb80.pbl?reportno=4" +
        "&valdcode=" + ReturnCode.value.replace(/ /g,"+") +
        "&returndt=" + DateField.value.replace(/ /g,"+") +
        "&valdadno=" + ItemForm.admissno.value.replace(/ /g,"+") +
        "&valduniq=" + ItemForm.mschg011.value.replace(/ /g,"+")

       serverURL+="&valdtype=3"

  var returnValue = RSExecute(serverURL);
  if (returnValue.status==0) {
    ReturnValue=returnValue.return_value.split("|");

//      ItemDesc.value=ReturnValue[0];
//      ItemDesc.value=ItemDesc.value.toUpperCase()

//      PatPr.value=ReturnValue[12];
//      RebPr.value=ReturnValue[13];
  }
}

function LookupProc(admissno,RETuniq,RETproc){
  var PopUpFrameDoc = DFrameStart();
  window.admissno=admissno;
  window.RETproc=RETproc;
  window.RETuniq=RETuniq;
  PopUpFrameDoc.location.href = "../lookups/NZProcedureSearchFrame1.html";
  SearchFrameShow();

}

function checkamnt() {

   if(ItemForm.mschg004.value!=0) {
   ItemForm.mschg006.value=(ItemForm.mschg004.value*ItemForm.patportn.value);

   if (trim(ItemForm.contrtyp.value.substr(9,1)!=" ")) {
     ItemForm.mschg007.value=(ItemForm.mschg004.value*ItemForm.rebportn.value);
     RoundNumber(ItemForm.mschg007,2);
   } else {
     ItemForm.mschg007.value=0
     RoundNumber(ItemForm.mschg007,2);
   }

   ItemForm.stdiamnt.value=(ItemForm.mschg004.value*ItemForm.stdprice.value);
   RoundNumber(ItemForm.mschg006,2);
   RoundNumber(ItemForm.stdiamnt,2);
    if (ItemForm.mschg007.value==0)
      { ItemForm.mschg007.value="0.00"; }
    if (ItemForm.mschg006.value==0)
      { ItemForm.mschg006.value="0.00"; }
    if (ItemForm.stdiamnt.value==0)
      { ItemForm.stdiamnt.value="0.00"; }
   }
 }

function calcamnt() {
  if (ItemForm.mschg006.value!="0.00") {
   ItemForm.mschg006.value=(ItemForm.mschg004.value*ItemForm.mschg013.value);
   RoundNumber(ItemForm.mschg006,2);
  }

  if (ItemForm.mschg007.value!="0.00") {
   ItemForm.mschg007.value=(ItemForm.mschg004.value*ItemForm.mschg013.value);
   RoundNumber(ItemForm.mschg007,2);
  }
  RoundNumber(ItemForm.mschg013,2);
}

function UpdateItm() {
  if (validateMandatory(ItemForm)) 
      ItemForm.updttype.value = "U";
      ItemForm.submit(); 
 }

function DeleteItm() {
   ans=confirm("Are you sure you want to Delete ?")
   if (ans)  {
      if (validateMandatory(ItemForm)) {
        ItemForm.updttype.value = "D";
        ItemForm.submit(); 
      }
   }
}

function CheckIDate(DateField) {
  if (isWhitespace(DateField.value)) {
    DateField.value="";
    DateField.select();
    return;
  }
  if (!checkDate(DateField,'Item-Date')) {
     DateField.value="";
     DateField.focus();
     return; }

  var serverURL = "../cgi-bin/patweb80.pbl?reportno=4" +
        "&returndt=" + DateField.value.replace(/ /g,"+") +
        "&valdadno=" + ItemForm.admissno.value.replace(/ /g,"+") +
        "&valdtype=2"

  var returnValue = RSExecute(serverURL);
  if (returnValue.status!=0) {
     DateField.value="";
     DateField.focus();
  }
}

function ChkPack() {
   if (ItemForm.packitem.value != 1) {
      ItemForm.dispitem.disabled = true;
   }
}

function PackItm() {

 URNUMBER=document.ItemForm.urnumber.value.replace(/ /g,"+")
 ADMISSNO=document.ItemForm.admissno.value.replace(/ /g,"+")
 TRANSNUM=document.ItemForm.transnum.value.replace(/ /g,"+")

 LinkUrl="patweb71.pbl?reportno=01&template=024&urnumber=" +
                URNUMBER + "&admissno=" + ADMISSNO + "&transnum=" + TRANSNUM;

  Left=(document.body.clientWidth-880)/2
  DFrameLink(LinkUrl,30,10,880,310)
}
</script>
%START.OF.PAGE
<body onload="PageLoad(event);checkamnt();ChkPack();displayUnitPrice();">
<span class=DFrameTitleBar>
<img align="right" alt="Exit" class="MenuIcon" 
 src="../images/ExitIcon.gif" onclick="DFrameExitRefresh();">
Update/Delete Miscellaneous Item
</span>

<div id=PageBodySection>

<form name=ItemForm action="patweb71.pbl" method=post style="margin:0">
  <input type=hidden name=reportno value="1">
  <input type=hidden name=template value=009>
  <input type=hidden name=updttype value=" ">
  <input type=hidden name=dummy value="">
  <input type=hidden name=nextpage value="0">
  <input type=hidden name=contrtyp value="%PATWEB71.01.902.3">
  <input type=hidden name=urnumber value="%PATWEB71.01.003">
  <input type=hidden name=admissno value="%PATWEB71.01.081">
  <input type=hidden name=transnum value="%PATWEB71.01.323">
  <input type=hidden name=keyinprc value="%PATWEB71.01.737">
  <input type=hidden name=patportn value="%PATWEB71.01.706">
  <input type=hidden name=rebportn value="%PATWEB71.01.707">
  <input type=hidden name=mschg011 value="%PATWEB71.01.727">
  <input type=hidden name=stdprice value="%PATWEB71.01.724">
  <input type=hidden name=packitem value="%PATWEB71.01.729">
  <input type=hidden name=itemtype value="%PATWEB71.01.731">
  <input type=hidden name=redirect value="%PATWEB71.01.001.patweb71.01.001">

<table border=0 width=100% cellspacing=1 cellpadding=0>
  <tr><td class=DataLabel width=20%>Date</td>
      <td class=DataField>
    <input type=text name=mschg001 size=12 maxlength=12 class="Mandatory"
           tabindex=1 value="%PATWEB71.01.701" title='Item Date'
           onblur=CheckIDate(document.ItemForm.mschg001);>
    <img notab src=../images/DateTimeStamp.gif class='Icon' alt='Current' 
      date='ItemForm.mschg001'>
    <img notab src=../images/DateLookup.gif class='Icon' alt='Show Calendar'
      date='ItemForm.mschg001'>

    </td></tr>

  <tr><td class=DataLabel>Item</td>
      <td class=DataField>
      <input type=text name=mschg002 class=Readonly readonly tabindex=-1
   title="Item" value="%PATWEB71.01.702"></td></tr>

  <tr><td class=DataLabel>Description</td>
      <td class=DataField>
      <input type=text name=mschg012 size=65 maxlength=65 tabindex=2
           value="%PATWEB71.01.728" title="Description"> </td></tr>

  <tr><td class=DataLabel>Inc Type</td>
      <td><select name=mschg010 class="Mandatory" title="Inc Type" tabindex=3>
        <option></option>
        %PATWEB71.01.725
        </select>
    </td>
  </tr>

  <tr><td class=DataLabel>Procedure</td>
      <td><input type=text name=proccode class=readonly ReadOnly size=10
           title="Procedure" value="%PATWEB71.01.726">
          <img src=../images/SearchIcon.gif class='Icon'
            onclick="LookupProc(document.ItemForm.admissno,
                                document.ItemForm.mschg011,
                                document.ItemForm.proccode);">
      </td>
  </tr>

  <tr><td class=DataLabel>Quantity</td>
     <td class=DataField>
     <input type=text name=mschg004 size=5 maxlength=5  min="1" tabindex=4
           class="Integer Mandatory" onblur=checkamnt();
           value="%PATWEB71.01.704" title="Quantity" ></td></tr>
</table>

<table border=0 width=100% cellspacing=1 cellpadding=0>
  <tr><td class=DataLabel width=20%>Patient Portion</td>
    <td class=DataField width=20%>
    <input type=text name=mschg006
           size=10 class=readonly ReadOnly
           title="Patient Amount" value="%PATWEB71.01.710">
    </td>
    <td width=10%><div id=DisUnitPriceHead></div></td>
    <td width=50%><div id=DisUnitPrice></div></td>
  </tr>
</table>

<table border=0 width=100% cellspacing=1 cellpadding=0>
  <tr><td class=DataLabel width=20%>Funder Portion</td>
    <td class=DataField>
    <input type=text name=mschg007 size=10 class=readonly ReadOnly
           title="Rebate Amount" value="%PATWEB71.01.711">
    </td></tr>

  <tr><td class=DataLabel>Standard Item Price</td>
      <td class=DataField>
      <input type=text class="Number Readonly" readonly value="%PATWEB71.01.724"
       name=stdiamnt title="Standard Item Price" tabindex=-1 ></td></tr>

<tr><td colspan=3 align=center>
  <input type=button value="Update" id=updbtn class="button" tabindex=10
   onclick="tempDisable(this);UpdateItm();">
  <input type=button value="Delete" id=delbtn class="button" tabindex=11
   onclick="tempDisable(this);DeleteItm();">
  <input type=button value="Items" class="button" name=dispitem tabindex=12
   onclick='PackItm()'>
  <input type=button value="Close" class="button" tabindex=13
   onclick="DFrameCloseRefresh();">
  </td></tr>
</table>
</form>
</div>

<form name=PatientLinks method=get>
<input type=hidden name=reportno value=1>
<input type=hidden name=template value=004>
<input type=hidden name=urnumber value="%PATWEB71.01.003">
<input type=hidden name=admissno value="%PATWEB71.01.081">
<input type=hidden name=MenuType value="%PATWEB71.01.088">
</form>

<script type="text/javascript">

  cdes="%PATWEB71.01.708";
  if (cdes=="0") {
     ItemForm.mschg012.disabled=true;
     ItemForm.mschg012.className="";
    }
  else {
     ItemForm.mschg012.disabled=false;
     ItemForm.mschg012.className="Mandatory";
  }

</script>

<span id=disunithd style="display:none">
Unit Price
</span>

<span id=disunitprice style="display:none">
    <input type=text name=mschg013 size=10 maxlength=10 
           tabindex=6 min=0.00 max=999999.99
           title="Patient Amount" value="%PATWEB71.01.738"
           onblur="calcamnt();">
</span>

<span id=blankunitprice tyle="display:none">
</span>

