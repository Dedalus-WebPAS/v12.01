<meta name="TemplateVersion" content="V12.01.00">
<meta name="TemplateHome" content="stv">
<meta name="HelpFileName" content="NoContextSet.html">
<meta name="CrossBrowser" content="true">
<script type="text/javascript">
function Update() {
  if (validateMandatory(PatCondPopup)) {
    if (document.PatCondPopup.d_falrsk.checked) {
      document.PatCondPopup.acval005.value="1";
    }
    else {
      document.PatCondPopup.acval005.value="0";
    }

    if (document.PatCondPopup.d_prirsk.checked) {
      document.PatCondPopup.acval006.value="1";
    }
    else {
      document.PatCondPopup.acval006.value="0";
    }

    if (document.PatCondPopup.d_absrsk.checked) {
      document.PatCondPopup.acval007.value="1";
    }
    else {
      document.PatCondPopup.acval007.value="0";
    }

    if (document.PatCondPopup.d_malrsk.checked) {
      document.PatCondPopup.acval008.value="1";
    }
    else {
      document.PatCondPopup.acval008.value="0";
    }

    if (document.PatCondPopup.d_nonwbr.checked) {
      document.PatCondPopup.acval010.value="1";
    }
    else {
      document.PatCondPopup.acval010.value="0";
    }

    PatCondPopup.submit();
  }
}

function CopyPrev() {
  if (!isWhitespace(document.PatCondPopup.prevadmn.value)) {
    var serverURL   = "../cgi-bin/patweb93.pbl?reportno=15&valdtype=2" +
      "&pataturn=" + document.PatCondPopup.urnumber.value.replace(/ /g,"+") +
      "&patatvis=" + document.PatCondPopup.prevadmn.value.replace(/ /g,"+")

    var returnValue = RSExecute(serverURL);
    if (returnValue.status==0) {
      var chkbox=null;
      var arrRisks = returnValue.return_value.split("|");
      for (i=0; i < arrRisks.length; i++) {
        switch (i) {
          case 0:
            chkbox = document.PatCondPopup.d_falrsk;
            (arrRisks[i] == 1)? chkbox.checked=true : chkbox.checked=false;
            break;

          case 1:
            chkbox = document.PatCondPopup.d_prirsk;
            (arrRisks[i] == 1)? chkbox.checked=true : chkbox.checked=false;
            break;

          case 2:
            chkbox = document.PatCondPopup.d_absrsk;
            (arrRisks[i] == 1)? chkbox.checked=true : chkbox.checked=false;
            break;

          case 3:
            chkbox = document.PatCondPopup.d_malrsk;
            (arrRisks[i] == 1)? chkbox.checked=true : chkbox.checked=false;
            break;

          case 4:
            chkbox = document.PatCondPopup.d_nonwbr;
            (arrRisks[i] == 1)? chkbox.checked=true : chkbox.checked=false;
            break;

        }
      }
    }

    // Get Expected Discharge Destination text
    serverURL   = "../cgi-bin/patweb93.pbl?reportno=15&valdtype=3" +
      "&pataturn=" + document.PatCondPopup.urnumber.value.replace(/ /g,"+") +
      "&patatvis=" + document.PatCondPopup.prevadmn.value.replace(/ /g,"+")

    var returnValue = RSExecute(serverURL);
    if (returnValue.status==0) {
      document.PatCondPopup.atexpdsc.value = returnValue.return_value;
    }

    // Get Patient Attribute Notes (Working Diagnosis)
    serverURL   = "../cgi-bin/patweb93.pbl?reportno=15&valdtype=4" +
      "&pataturn=" + document.PatCondPopup.urnumber.value.replace(/ /g,"+") +
      "&patatvis=" + document.PatCondPopup.prevadmn.value.replace(/ /g,"+") +
      "&patatnot=002" 

    var returnValue = RSExecute(serverURL);
    if (returnValue.status==0)
    {
      if (!isWhitespace(returnValue.return_value)) {
        document.PatCondPopup.attxt002.value = 
          trim(returnValue.return_value).replace(/\\n/g, '\n');
      }
      else {
        document.PatCondPopup.attxt002.value = "";
      }
    }

    // Get Patient Attribute Notes (Relevant Medical History)
    serverURL   = "../cgi-bin/patweb93.pbl?reportno=15&valdtype=4" +
      "&pataturn=" + document.PatCondPopup.urnumber.value.replace(/ /g,"+") +
      "&patatvis=" + document.PatCondPopup.prevadmn.value.replace(/ /g,"+") +
      "&patatnot=003"

    var returnValue = RSExecute(serverURL);
    if (returnValue.status==0)
    {
      if (!isWhitespace(returnValue.return_value)) {
        document.PatCondPopup.attxt003.value =
          trim(returnValue.return_value).replace(/\\n/g, '\n');
      }
      else {
        document.PatCondPopup.attxt003.value = "";
      }
    }

    // Get Patient Attribute Notes (Barriers to Discharge)
    serverURL   = "../cgi-bin/patweb93.pbl?reportno=15&valdtype=4" +
      "&pataturn=" + document.PatCondPopup.urnumber.value.replace(/ /g,"+") +
      "&patatvis=" + document.PatCondPopup.prevadmn.value.replace(/ /g,"+") +
      "&patatnot=004"

    var returnValue = RSExecute(serverURL);
    if (returnValue.status==0)
    {
      if (!isWhitespace(returnValue.return_value)) {
        document.PatCondPopup.attxt004.value =
          trim(returnValue.return_value).replace(/\\n/g, '\n');
      }
      else {
        document.PatCondPopup.attxt004.value = "";
      }
    }
  }
}

function init() {
  if (document.PatCondPopup.vistallw.value == "1")
  {
    document.PatCondPopup.patconva.checked=true;  // Visitors allowed
  }

  if (document.PatCondPopup.phonallw.value == "1")
  {
    document.PatCondPopup.patconpa.checked=true;  // Phone calls allowed
  }

  if (trim(document.PatCondPopup.fallsrsk.value) == "1")
  {
    document.PatCondPopup.d_falrsk.checked=true;  // Falls Risk
                                                  // (Type - '005')
  }

  if (trim(document.PatCondPopup.pressrsk.value) == "1")
  {
    document.PatCondPopup.d_prirsk.checked=true;  // Pressure Injury Risk
                                                  // (Type - '006')
  }

  if (trim(document.PatCondPopup.abscnrsk.value) == "1")
  {
    document.PatCondPopup.d_absrsk.checked=true;  // Abscond Risk
                                                  // (Type - '007')
  }

  if (trim(document.PatCondPopup.malnursk.value) == "1")
  {
    document.PatCondPopup.d_malrsk.checked=true;  // Malnutrition Risk
                                                  // (Type - '008')
  }

  if (trim(document.PatCondPopup.nonwbrsk.value) == "1")
  {
    document.PatCondPopup.d_nonwbr.checked=true;  // Non Weight Bearing Risk
                                                  // (Type - '010')
  }

  //
  // Enable 'Copy Previous' button if no Patient Attributes records exist
  //
  if (VariableNameExists('MinsDiffPrevDisch'))
  {
    if (MinsDiffPrevDisch == '999999') {
      document.getElementById('btnCopyPrev').style.display = "";  // always show
    }
    else {
      if (isWhitespace(document.PatCondPopup.minsdiff.value))
        return;

      var mindiff = parseInt(document.PatCondPopup.minsdiff.value);
      if (document.PatCondPopup.patexist.value != "1" && 
          mindiff <= parseInt(MinsDiffPrevDisch,10)) {
        // show button
        document.getElementById('btnCopyPrev').style.display = "";
      }
    }
  }
}

</script>
</head>
%START.OF.PAGE
<body onload="PageLoad(event);checkShowDischargeDelay();">
<!--        Sub-Frame Header Section       -->
<span class=DFrameTitleBar>
<img align="right" alt="Exit" class="MenuIcon" 
 src="../images/ExitIcon.gif" onclick="DFrameExitRefresh();">
Update Condition - %PATWEB93.05.002
</span>
<!--        Sub-Frame Details Sections     -->
<form name=PatCondPopup method=post style="margin:0" %PATWEB93.05.101 
<input type=hidden name=nextpatn value="patweb93.pbl?reportno=05&template=001">
<input type=hidden name=acval005 value="0">
<input type=hidden name=acval006 value="0">
<input type=hidden name=acval007 value="0">
<input type=hidden name=acval008 value="0">
<input type=hidden name=acval010 value="0">
<input type=hidden name=calcexls value=1>

<input type=hidden name=vistallw value="%PATWEB93.05.106.1">
<input type=hidden name=phonallw value="%PATWEB93.05.106.2">

<input type=hidden name=fallsrsk value="%PATWEB93.05.117">
<input type=hidden name=pressrsk value="%PATWEB93.05.118">
<input type=hidden name=abscnrsk value="%PATWEB93.05.119">
<input type=hidden name=malnursk value="%PATWEB93.05.120">
<input type=hidden name=nonwbrsk value="%PATWEB93.05.122">

<input type=hidden name=patexist value="%PATWEB93.05.127">
<input type=hidden name=minsdiff value="%PATWEB93.05.128">
<input type=hidden name=prevadmn value="%PATWEB93.05.129">

<table border=0 align=center cellpadding=1 cellspacing=1 width=100%>
<tr>
    <td class=DataLabel>Last Update</td>
    <td>
      <input type=text class=readonly readonly size=20 name=patconup
         value="%PATWEB93.05.108">
    </td>
    <td>
      <input id=btnCopyPrev type=button class="button" value="Copy Previous"
       style="display:none" onclick="CopyPrev();">
    </td>
</tr>

<tr><td class=DataLabel>Condition </td>
    <td colspan=3><select name=patconcd>
        <option value="   "></option>
        %PATWEB93.05.102
        </select></td></tr>

<tr><td class=DataLabel>Ambulatory Status</td>
    <td colspan=3><select name=patconam>
        <option value="   "></option>
        %PATWEB93.05.107
        </select></td></tr>

<tr><td class=DataLabel> Visitors Allowed ?</td>
    <td colspan=3><input name=patconva type=checkbox value=1></td></tr>

<tr><td class=DataLabel> Phone Calls Allowed ?</td>
    <td colspan=3><input name=patconpa type=checkbox value=1></td></tr>

<tr><td class=DataLabel>Cordless Telephone</td>
    <td colspan=3>
      <input name=pmswo019 size=5 maxlength=4 value="%PATWEB93.05.226">
    </td>
</tr>

<tr><td class=DataLabel>Comments for Enquiries</td>
    <td colspan=3>
      <input name=patconds size=45 maxlength=35 value="%PATWEB93.05.103"
       onblur="validateFreeTextFields(this);">
    </td>
</tr>

<tr><td class=DataLabel>Expected Discharge Date</td>
    <td colspan=3><input type=text size=12 name=pmswo005
         class="FutureDate" value="%PATWEB93.05.205"
         title="Expected Discharge Date">
         <img notab src="../images/DateLookup.gif" class=Icon
          onclick="DateLookupFrame(PatCondPopup.pmswo005);">
        Time
        <input type=text name=pmswo006 size=8 title="Expected Discharge Time"
         value="%PATWEB93.05.213">
        <img notab src="../images/DateTimeStamp.gif" class=Icon
          onclick="SetCurrentDateTime(PatCondPopup.pmswo005,
                                      PatCondPopup.pmswo006);">
        <img notab src="../images/TimeLookup.gif" class=Icon
          onclick="TimeLookupFrame(PatCondPopup.pmswo006);">
    </td>
</tr>

<tr><td class=DataLabel>Falls Risk?</td>
    <td>
      <input name=d_falrsk type=checkbox value=1>
    </td>
    <td colspan=2>
      <table width=100% border=0 cellpadding=0 cellspacing=0>
      <tr>
        <td class=DataLabel>Abscond Risk?&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
          <input name=d_absrsk type=checkbox value=1>
        </td>
        <td class=DataLabel>Non Weight Bearing&nbsp;&nbsp;&nbsp;
          <input name=d_nonwbr type=checkbox value=1>
        </td>
      </tr>
      </table>
    </td>
</tr>

<tr><td class=DataLabel>Pressure Injury Risk?</td>
    <td><input name=d_prirsk type=checkbox value=1></td>
    <td colspan=2>
      <table width=100% border=0 cellpadding=0 cellspacing=0>
      <tr>
        <td class=DataLabel>Malnutrition Risk?
          <input name=d_malrsk type=checkbox value=1>
        </td>
      </tr>
      </table>
    </td>
</tr>

<tr><td class=DataLabel>Expected Discharge Destination</td>
    <td colspan=3>
      <input name=atexpdsc size=45 maxlength=80 value="%PATWEB93.05.123">
    </td>
</tr>

<tr valign=top><td class=DataLabel>Working Diagnosis</td>
    <td class=DataField colspan=3>
    <textarea name=attxt002 wrap=hard rows=3 cols=80 title="Working Diagnosis"
     onkeydown="CheckTextAreaLimits(event,this);">%PATWEB93.05.124</textarea>
    </td>
</tr>

<tr valign=top><td class=DataLabel>Relevant Medical History</td>
    <td class=DataField colspan=3>
    <textarea name=attxt003 wrap=hard rows=3 cols=80
     title="Relevant Medical History"
     onkeydown="CheckTextAreaLimits(event,this);">%PATWEB93.05.125</textarea>
    </td>
</tr>

<tr valign=top><td class=DataLabel>Barriers to Discharge</td>
    <td class=DataField colspan=3>
    <textarea name=attxt004 wrap=hard cols=80 rows=3
     title="Barriers to Discharge"
     onkeydown="CheckTextAreaLimits(event,this);">%PATWEB93.05.126</textarea>
    </td>
</tr>

<tr id="clredida">
    <td class=DataLabel>Clinically Ready for Discharge Date</td>
    <td><input type=text size=15 maxlength=12 name=mrfddate
           id=mrfddate title="Clinically Ready for Discharge Date"
           onblur="checkDate(this,'Date');disDelay(this);" class="Date"
           value="%PATWEB93.05.134" >
         <img notab src="../images/DateTimeStamp.gif" class=Icon
              alt="Current"
              onclick="SetCurrentDateTime(mrfddate,null);">
         <img notab src="../images/DateLookup.gif" class=Icon
              alt="Calendar" date="PatCondPopup.mrfddate"></td></tr>
<tr id=rsndisde style="display: none;">
<td class=DataLabel>Reason for Discharge Delay</td>
    <td><select name=vsxdc014 id=vsxdc014 title="Reason for Discharge Delay">
        <option></option>
        %STANDARD.01.007.z1
        </select></td></tr></span>

<tr><td colspan=6>&nbsp;</td></tr>

<tr><td align=center colspan=4>
      <input type=button value="Update" class=button id=btnUpdate
       onclick="tempDisable(this, 5);Update();">
      <input type=button value="Cancel" class=button
       onclick="DFrameCloseRefresh();">
    </td>
</tr>
</table>
</form>

<script type="text/javascript">
function validateFreeTextFields(textfieldvar) {
  textfieldvar.value=textfieldvar.value.replace(/</g,"< ");
  textfieldvar.value=textfieldvar.value.replace(/"/g,"'");
  textfieldvar.value=textfieldvar.value.replace(/\\/g,"/");
}
function disDelay(cliDis) {
  if (!isWhitespace(cliDis.value)) {
    document.getElementById("rsndisde").style.display = "";
    document.getElementById("vsxdc014").className = "Mandatory";
    document.getElementById("vsxdc014").disabled = false;
  } else {
    document.getElementById("rsndisde").style.display = "none";
    document.getElementById("vsxdc014").className = "";
    document.getElementById("vsxdc014").disabled = true;
    document.getElementById("vsxdc014").value = "";
  }
}
function checkShowDischargeDelay() {
  if (ShowDischargeDelayFields !== true) {
    document.getElementById("clredida").style.display = "none";
    document.getElementById("rsndisde").style.display = "none";
    document.getElementById("mrfddate").disabled = true;
    document.getElementById("vsxdc014").disabled = true;
  }
}

disDelay(document.getElementById('mrfddate'));
for (var j=0; j < document.getElementById('vsxdc014').length; j++) {
  if (document.getElementById('vsxdc014').options[j].value.substr(0,3)
      =="%PATWEB93.05.135") {
      document.getElementById('vsxdc014').selectedIndex=j;
  }
}
</script> 
