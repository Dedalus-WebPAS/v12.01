<meta name="TemplateVersion" content="V12.01.00">
<meta name="TemplateHome" content="stv">
<meta name="HelpFileName"    content="NoContextSet.html">
<meta name="CrossBrowser" content="true">
</head>
%START.OF.PAGE
<body onload="PageLoad(event);ChkLock();ChkCur();ChkInp();">
<span class=DFrameTitleBar>
<img align="right" alt="Exit" class="MenuIcon" 
 src="../images/ExitIcon.gif" onclick="DFrameExit();">
Transfer Theatre Booking
</span>
<script type="text/javascript">
function CheckAdmDate(){
      var strtDay  = document.UpdateForm.patadmdt.value.substring(0,2);
      var strtMon  = document.UpdateForm.patadmdt.value.substring(3,6);
      var strtYear = document.UpdateForm.patadmdt.value.substring(7,11);
      strtMon = GetMonthNumber(strtMon);

      var strtDate = strtYear + strtMon + strtDay
      if(!CheckFuture(strtDate)){
        if(!confirm("Warning: Admission date is prior to current date.")){
          return false;
        }
      }
      return true;
}
function SubmitForm() {
  p=document.UpdateForm;
  validateWLKeySuspension(p.wattrkey,p.patadmdt,p.datefromwl,p.datetowl);
  if(p.datefromwl.value!='0'){
    alert("Error: Patient has a Suspension record for period \n" +
             "\t" + p.datefromwl.value  + " - " + p.datetowl.value);
   return;
 }
 if(!CheckAdmDate()) {
   return;
 }
 if(validateMandatory(UpdateForm)){
 document.UpdateForm.submit();}
}
function SessionDoc() {
UpdateForm.doctcode.value=UpdateForm.casekeys.value.substr(16,6)
/*
linkurl="../lookups/SessionSearchFrame.html"
  window.open(linkurl,"SearchScreen",
    "width=600,height=350,top=150,left=50," +
    "titlebar=no,scrollbars=yes,status=no,toolbar=no,menubar=no");
*/
SessionSearchFrame()
}
function ChkLock() {
  numlock=parseInt(UpdateForm.sesslock.value)
  daylock=parseInt(UpdateForm.noofdays.value)
  if(numlock>daylock) {
    alert("Session is locked. Cannot Transfer patient");
    DFrameExit()
   }
}
function ChkInp() {
 if (UpdateForm.admissno.value!="") {
   if(UpdateForm.currenta.value!="1"){
     if(trim(UpdateForm.adstatus.value)!="Cancelled"){
       UpdateForm.patadmdt.value=UpdateForm.admndate.value
       UpdateForm.bkrec005.value=UpdateForm.admntime.value}
     }
   if(UpdateForm.patadmdt.value!="") { 
     UpdateForm.patadmdt.className="ReadOnly";
     UpdateForm.patadmdt.readOnly=true;
     UpdateForm.bkrec005.className="ReadOnly";
     UpdateForm.bkrec005.readOnly=true;
     UpdateForm.sessidisp.focus();
   }else {
     UpdateForm.patadmdt.className="Mandatory";
     UpdateForm.bkrec005.className="Mandatory"; }
 } else {
     if(UpdateForm.patadmdt.value!="") { 
       UpdateForm.patadmdt.className="ReadOnly";
       UpdateForm.patadmdt.readOnly=true;
       UpdateForm.bkrec005.className="ReadOnly";
       UpdateForm.bkrec005.readOnly=true;
       UpdateForm.sessidisp.focus();
     } else {
       UpdateForm.patadmdt.className="Mandatory";
       UpdateForm.bkrec005.className="Mandatory"; }
 }
     if(trim(UpdateForm.adstatus.value)!="Pre-Admission"){
       UpdateForm.updatdoc.checked=false;
       UpdateForm.updatdoc.disabled="true";
     }
if((trim(UpdateForm.adstatus.value)!="Current")&&(UpdateForm.currenta.value=="0")){
       UpdateForm.patadmdt.className="Mandatory";
       UpdateForm.bkrec005.className="Mandatory"; }
}
//
function ChkCur() {
 if (UpdateForm.admissno.value!="") {
   if(trim(UpdateForm.adstatus.value)=="Current") { 
     ans=confirm("Will this be part of the current admission?");
     if(ans){
       document.UpdateForm.currenta.value="0"}
     else {
       document.UpdateForm.currenta.value="1"}
   }
 }
}
//
function SetCDate() {
 if(document.UpdateForm.patadmdt.className=="ReadOnly"){
   return;
 }
 SetCurrentDateTime(UpdateForm.patadmdt,null);
}
//
function SearchDate() {
 if(document.UpdateForm.patadmdt.className=="ReadOnly"){
   return;
 }
 DateLookupFrame(UpdateForm.patadmdt);
}
//
</script>
<form name=UpdateForm onsubmit="return validateMandatory(this)"
 method=post action=oprweb01.pbl   style="margin:0">
<input type=hidden name=reportno value=15>
<input type=hidden name=template value=2>
<input type=hidden name=admissno value="%OPRWEB01.11.281">
<input type=hidden name=adstatus value="%OPRWEB01.11.904">
<input type=hidden name=admndate value="%OPRWEB01.11.902">
<input type=hidden name=admntime value="%OPRWEB01.11.903">
<input type=hidden name=casekeys value="%OPRWEB01.11.001">
<input type=hidden name=sesslock value="%OPRWEB01.11.168">
<input type=hidden name=noofdays value="%OPRWEB01.11.065">
<input type=hidden name=currenta value="0">
<input type=hidden name=doctcode>
<input type=hidden name=newsessi>
<input type=hidden name=docttype value="%OPRWEB01.11.113.1">
<input type=hidden name=wattrkey value="%OPRWEB01.11.501">
<input type=hidden name=datefromwl>
<input type=hidden name=datetowl>
<input type=hidden name=opdea031 value="%STANDARD.01.013">
<!--<tr><td class=DataLabel>Select New Theatre Session</td>
    <td><select name=newsessi class=Mandatory title="New Session">
        OPRWEB01.11.060
        </select></td>
</tr>
-->
<table border="0" cellpadding="2" cellspacing="0" width="95%" align=center >
<tr><td class=DataLabel>Select New Theatre Session</td>
<td><input type=text name=sessidisp class="Mandatory" id=sessidisp 
      title="New Theatre Session" readonly size=45>
    <img src=../images/SearchIcon.gif class=Icon onClick="SessionDoc();">
</td></tr>
<tr><td class=DataLabel>Admission Date</td>
    <td><input type=text size=12 name=patadmdt id=patadmdt
        title="Admission Date">
     <img src=../images/DateLookup.gif border=0 hspace=4 align=absmiddle
     onclick='DateLookupFrame(patadmdt);' tabindex=-1>
    Time
    <input type=text name=bkrec005 size=7 id=bkrec005
            title="Admission Time" class=Mandatory>
    <img src=../images/DateTimeStamp.gif  border=0 hspace=4 align=absmiddle
     onclick='SetCurrentDateTime(patadmdt,bkrec005)' tabindex=-1>
    <img src=../images/TimeLookup.gif border=0 hspace=4 align=absmiddle
    onclick='TimeLookupFrame(bkrec005);' tabindex=-1>
    </td></tr>
<!--
    <td><input type=text size=12 name=patadmdt class="Mandatory" 
    <a href='javascript:SetCurrentDateTime(UpdateForm.patadmdt,null)'>
    <a href='javascript:DateLookupFrame(UpdateForm.patadmdt)'>
    <img src=../images/DateTimeStamp.gif  border=0 hspace=4 align=absmiddle
     onclick="SetCDate();">

    <img src=../images/DateLookup.gif border=0 hspace=4 align=absmiddle
     onclick="SearchDate();">
-->

<tr><td class=DataLabel>Transfer Reason</td>
    <td><select name=tranreas class=Mandatory title="Transfer Reason">
        <option></option>
        %STANDARD.01.007.SC
        </select></td></tr>

<tr><td class=DataLabel>Adjust Subsequent Start Times</td>
    <td><input type=checkbox name=adjstart value=1 ></td></tr>

<tr><td class=DataLabel>Update Attending Doctor</td>
    <td><input type=checkbox name=updatdoc value=1 checked></td></tr>

<tr><td align="center" colspan=2><br>
        <input type=button id="opr01sub" value="Ok" class="button"
        onclick="tempDisable(this);SubmitForm();">
        <input type=button value="Cancel" class="button" onClick='DFrameClose()'>
    </td></tr>
</table>
</form>

