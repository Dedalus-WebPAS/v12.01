<meta name="TemplateVersion" content="V12.01.00">
<meta name="TemplateHome" content="stv">
<meta name="HelpFileName" content="NoContextSet.html">
<meta name="CrossBrowser" content="true">
<script type="text/javascript" src="../js/emrweb0201004.js"></script>
<script type="text/javascript">
function PresComExpFocus() {
  document.getElementById('prcom001').style.height=100;
}
function PresComExpOffFocus() {
  document.getElementById('prcom001').style.height=36;
}
function ReturnToMap() {
  if(parent.TogglePanel==null){
     parent.menu.location.href='emrweb01.pbl?reportno=1&template=1';
  }
  else{
     parent.TogglePanel();
  }
}
function UpdDoctor() {
  if (UpdateForm.emcndoct.value==1) {
    UpdEmrDoc(UpdateForm.emvis007);
  }
  else {
    UpdDoc(UpdateForm.emvis007);
  }
}
function SearchDoctor() {
  if (UpdateForm.emcndoct.value==1) {
    DoctorEmrSearchFrame(UpdateForm.emvis007,UpdateForm.dummy3);
  }
  else {
    DoctorSearchFrame(UpdateForm.emvis007,UpdateForm.dummy3);
  }
}
function PageLoadExtended() {
   PageLoad();
   setFocus("btnUpdate");
   SetDischarged();
}
function setFocus(id) {
  var  object = document.getElementById(id);

  if(object)
     object.focus();

}
function RemoveSlash(obj) {
  obj.value=obj.value.replace("\\","");
}
function RemoveDoubleQuotes(obj) {
  obj.value=obj.value.replace("\"","'");
}
function validateattendingdoctor(RetFuncTrue) {
    var serverURL   = "../cgi-bin/emrweb08.pbl?reportno=58" +
                      "&admissno=" +
                      document.UpdateForm.admissno.value.replace(/ /g,"+") +
                      "&doctcode=" +
                      document.UpdateForm.emvis007.value.replace(/ /g,"+")

  if (IEBrowser) {
    var returnValue = RSExecute(serverURL);

    if (returnValue.status==0)
    {
      if (returnValue.return_value == "1") {
        alert("Doctor has been updated previously. Page will reload, " +
              "details not updated.");
        location.reload();

        if (top.TogglePanel) {
          parent.menu.location.reload();
        } else {
          if (top.menu.EmergencyFrame) {
            if (top.menu.EmergencyFrame.location=="about:blank") {
              parent.menu.location.reload();
            } else {
              parent.menu.EmergencyFrame.location.reload();
            }
          }
        }
        return false;
      }

      if (typeof(RetFuncTrue) == 'function') { RetFuncTrue() }
    }
  }
  else {
    var returnValue = RSExecuteFetch(serverURL);

    returnValue.then(
      function (returnValue) {
        returnValue = ParseFetchData(returnValue);  // parse fetch() result

        if (returnValue.status==0)
        {
          if (returnValue.return_value == "1") {
            alert("Doctor has been updated previously. Page will reload, " +
                  "details not updated.");
            location.reload();

            if (top.TogglePanel) {
              parent.menu.location.reload();
            } else {
              if (top.menu.EmergencyFrame) {
                if (top.menu.EmergencyFrame.location=="about:blank") {
                  parent.menu.location.reload();
                } else {
                  parent.menu.EmergencyFrame.location.reload();
                }
              }
            }
            return false;  // do nothing further
          }

          if (typeof(RetFuncTrue) == 'function') { RetFuncTrue() }
        }
      }
    );
  }
}
function SaveDontLeave() {
 if(document.UpdateForm.d_emvis093.checked == true) {
   document.UpdateForm.emvis093.value="1";
 } else {
   document.UpdateForm.emvis093.value="0";
 }
 RemoteEmrUpdate(UpdateForm.admissno,UpdateForm.emvis093);
 refreashTop();
}

var valError = false;
function CheckPresComplTextLimit(TextArea) {
  valError = false;

  if (!LimitText(TextArea,6,300)) {
    valError = true;
    TextArea.onblur = null;  // clear to prevent infinite loop with alerts

    window.setTimeout(function () {
      TextArea.onblur = function() {
        SavePresComplCommt(TextArea);
        PresComExpOffFocus();
      }
    },100);
  }
  else { valError = false; };
}
function SavePresComplCommt(TextArea) {
  RemoveSlash(TextArea);

  if (!prcom001TopFrame()) {
    valError = true;
  }
  else { valError = false; }
}
function CheckMntNotesTextLimit(TextArea) {
  if (!LimitText(TextArea,99,16930)) {
    TextArea.onblur = null;  // clear to prevent infinite loop with alerts

    window.setTimeout(function () {
      TextArea.onblur = function() {
        SaveMntNotes(TextArea);
      }
    },100);
  }
}
function SaveMntNotes(TextArea) {
  if (valError) return;

  SaveMgtNteBLANK(TextArea);
}
function reEnable() {
  reEnableControl('btnUpdate');
}
</script>
</head>
%START.OF.PAGE
<body onload="PageLoadExtended();" onunload="submitFormRedirect();">
<div id=PatientHeading style="height:25%;overflow:auto;"></div>
<script type="text/javascript">
PatientURN="%EMRWEB02.01.003";
PatientVIS="%EMRWEB02.01.081";
PatientNAM="%EMRWEB02.01.002";
PatientSTA="%EMRWEB02.01.086.078";
PatientALT="%EMRWEB02.01.084";
PatientSEX="%EMRWEB02.01.019";
PatientDOB="%EMRWEB02.01.020";
PatientAGE="%EMRWEB02.01.021";
PatientLOC="%EMRWEB02.01.083";
PatientPRI="%EMRWEB02.01.086.066.1";
PatientUNT="%EMRWEB02.01.066.0";
PatientIND="%EMRWEB02.01.086.091";
GpCOD="%EMRWEB02.01.086.084.001";
GpNAM="%EMRWEB02.01.086.084.081";
GpPRAC="%EMRWEB02.01.086.085.001";
GpPRACCNT="%EMRWEB02.01.086.085.002";
GpPRACNAM="%EMRWEB02.01.086.085.005";
PatientARR="%EMRWEB02.01.101.0 %EMRWEB02.01.102";
PatientSEE="%EMRWEB02.01.199.008";
PatientTRI="%EMRWEB02.01.103.3";
PatientECLC="%EMRWEB02.01.484.1";
PatientCLH="%STANDARD.01.017.CL";
PatientEHFT="%EMRWEB02.01.485";
InsertEmergencyHeader();
</script>

<form name=UpdateForm action="emrweb02.pbl" method=post style="margin:0"
 onsubmit='return validateMandatory(this);'>
<input type=hidden name=reportno value="01">
<input type=hidden name=resavail value="0">
<input type=hidden name=template value="001">
<input type=hidden name=admissno value="%EMRWEB02.01.081">
<input type=hidden name=urnumber value="%EMRWEB02.01.003">
<input type=hidden name=formactn value="C1">
<input type=hidden name=redirect value="emrweb02.pbl?reportno=1&template=4">
<input type=hidden name=updateky value="%EMRWEB02.01.404">
<input type=hidden name=updttype value="UPDAT">
<input type=hidden name=nextpage value=17>
<input type=hidden name=pmpxi067 value="%EMRWEB02.01.667.0">
<input type=hidden name=username>
<input type=hidden name=password>
<input type=hidden name=dummy1>
<input type=hidden name=dummy2>
<input type=hidden name=emvis004>
<input type=hidden name=emvis005>
<input type=hidden name=emvis093>
<input type=hidden name=emvis135>
<input type=hidden name=emvis136>
<input type=hidden name=emvis137>
<input type=hidden name=emvis138>
<input type=hidden name=emvis147>
<input type=hidden name=emvis118 value="%EMRWEB02.01.003">
<input type=hidden name=savdesc1>
<input type=hidden name=savmanag>
<input type=hidden name=searchgn value="%EMRWEB02.01.009">
<input type=hidden name=searchsn value="%EMRWEB02.01.010">
<input type=hidden name=searchps value="%EMRWEB02.01.019">
<input type=hidden name=searchpd value="%EMRWEB02.01.020">
<input type=hidden name=discstat value="%EMRWEB02.01.147">
<input type=hidden name=emcndoct value="%EMRWEB02.01.455">
<input type=hidden name=webuseid value="%STANDARD.01.008">
<input type="hidden" name="current_precom" id="current_precom" 
 value="%EMRWEB02.01.220.1" />
<input type=hidden name=d_ptvis022 id=d_ptvis022 value="%EMRWEB02.01.510">
<input type=hidden name=nurupind value="1">
<input type=hidden name=emcnurse id=emcnurse 
       value="%STANDARD.01.025.122.008.0.1">

<div id=PageBodySection style="height:98%;overflow: auto;">
<table width=99% align=center border=0 cellspacing=0 cellpadding=1>
<tr valign=top><td class=DataLabel width=15%>Presenting Complaint </td>
    <input type=hidden name=emrviscat value="el">
    <td>
      <input type="text" size=10 tabindex=7 name=test
             value="%EMRWEB02.01.220.0"
             class="NoAutoFocus"
             onblur="emvis060TopFrame();savePresentingComplaint();"
             onKeyUp='UpCase(this);getPresentCom(this,UpdateForm.emvis060,
                      UpdateForm.emrviscat);
                      SetDirty();'/>

    <select name=emvis060 class=SelectBig onblur="emvis060TopFrame();"
            onchange="SetDirty();">

         <option value="%EMRWEB02.01.220.1">%EMRWEB02.01.220.0</option>
    </select>

    </td>
    <td>
    <textarea name=prcom001 id=prcom001 wrap=hard cols=50 rows=2
     class="PresComExp"
     style="overflow-y:hidden" title="Presenting Complaint Comments"
     onfocus="PresComExpFocus();"
     onblur="SavePresComplCommt(this);PresComExpOffFocus();"
     onkeydown="CheckPresComplTextLimit(this);"></textarea> 
    </td>
    <td>Not to Leave&nbsp;<input type=checkbox name=d_emvis093
                          title="Not to Leave"
                          onclick="SaveDontLeave();"></td>
    </tr>

<tr><td class=DataLabel>Location</td>
     <td><input type=hidden name=name_emvis006 title="Location"
         value="%EMRWEB02.01.106.0">
    <select class=SelectMed name=emvis006 
     onchange='validateattendingdoctor(refreashTop);'>
    <option></option>
    %EMRWEB02.01.106.2
    </select>
    <input type=text size=30 name=emvis149 title="Location Note" 
     value="%EMRWEB02.01.136">
    <td rowspan=4 class=DataLabel valign=top>Management Notes<br>
    <textarea name=vicmt002 id=vicmt002 rows=4 wrap=hard cols=60
     onkeydown="CheckMntNotesTextLimit(this);" title="Management Notes"
     onblur="SaveMntNotes(this);">%EMRWEB02.01.434.002</textarea>
    </td>
    <td rowspan=4></td>
    </tr>

<tr><td class=DataLabel>Doctor</td>
<td><input type=text size=6 maxlength=6 name=emvis007 title="Doctor Code"
         value="%EMRWEB02.01.107.001" onfocus="disableObject('btnUpdate');"
         onblur="UpdDoctor();setTimeout(reEnable,2000);">
        <input type=text size=18 name=dummy3 title="Doctor Name"
         readonly class=Readonly value="%EMRWEB02.01.107.003">
        <img class=Icon src="../images/erase.gif"
         id="DocDelBut" onclick="DelDoc();">
        <img class=Icon src="../images/SearchIcon.gif"
          onclick="SearchDoctor();">
        <input type="button" class="BigButton" value="Doctor Handover"
         onclick='DoctorData();'>
        &nbsp;%STANDARD.01.017.eh&nbsp;
        <select name=emvis056 title="%STANDARD.01.017.eh"
         class="SelectMed"
         onchange="RemoteEmrUpdate(UpdateForm.admissno,UpdateForm.emvis056,
                   refreashTop);">
        <option></option>
        %EMRWEB02.01.216.2
        </select>
        </td></tr>

<tr><td class=DataLabel>Treating Nurse</td>
    <input type=hidden name=gnm id=gnm>
    <td><input type=text size=6 name=emvis130 id=emvis130 title="Nurse Code"
         value="%EMRWEB02.01.164.1" onfocus="disableObject('btnUpdate');"
         onblur="UpdNur(UpdateForm.emvis130);setTimeout(reEnable,2000);"> 
        <input type=text size=18 name=dummy5 title="Nurse Name" readonly
         class=Readonly id=dummy5 value="%EMRWEB02.01.164.0">
        <img class=Icon src="../images/erase.gif"
         id="NurDelBut" onclick="DelNurse();">
        <img class=Icon src="../images/SearchIcon.gif"
         onclick="SearchEDNurse(UpdateForm.emvis130,UpdateForm.dummy5);">
        <input type=button class="BigButton"
         value="Nurse Handover" onclick='NurseData();'></td></tr>

<tr><td>Triage Nurse</td>
    <td><input type=text size=29 name=name_triage title="Triage Nurse" readonly 
         Class=Readonly value="%EMRWEB02.01.161.0">
    </td></tr>

<tr><td colspan=6 align=center>
    <input type=button class="button" 
           id="btnUpdate"
           name="btnUpdate"
           value="Update" 
     onclick="tempDisable(this);
              RemoveDoubleQuotes(document.UpdateForm.vicmt002);
              validateattendingdoctor(onUpdate);"/>
    <input type=button class="button" value="Clinical" 
     onclick="PatientLink('emrweb02.pbl',1,100);"> 
    <input type=button class="button" value="Registration" 
     onclick="checkurno();">
    <input type=button class="button" value="Injury Data" name=injbuttn
     onclick="SmallFrameEmr('71');"> 
    <input type=button class="button" value="Outstanding" 
     onclick="SmallFrameEmr('51');"> 
    <input type=button class="button" value="Discharge" 
     onclick="checkUR(document.UpdateForm.discstat.value);"> 
    <input type=button class="button" value="Labels & Forms" 
     onclick="SmallFrameEmr('5');"> 
    <input type=button class=RedButton value="Return to Map" 
     onclick="ReturnToMap();">
    <input type=button class=RedButton value="Return to List" 
     onclick="PatientLink('emrweb01.pbl','01','021');">
    <input type=button class="button" value="Jump Queue"
     onclick="updateNext();">
    <input type=button class="button" name=mhprabut
     value="MH Practitioner" onclick="changeMHDocDateTime();">
    </td></tr>
</table>
</div>
</form>

<form name=PatientLinks method=get>
<input type=hidden name=reportno value=1>
<input type=hidden name=template value=004>
<input type=hidden name=regexstm value=102>
<input type=hidden name=newstand value=1>
<input type=hidden name=webuseid value="%STANDARD.01.008">
<input type=hidden name=urnumber value="%EMRWEB02.01.003">
<input type=hidden name=admissno value="%EMRWEB02.01.081">
<input type=hidden name=MenuType value="11">
<input type=hidden name=checksub value="0">
<input type=hidden name=emvis147>
<input type=hidden name=newdoctr value="">
</form>

<form name=HiddenFields>
<input type=hidden name=InjuryIndicator value="%EMRWEB02.01.447">
<input type=hidden name=CheckUr value="%EMRWEB02.01.448">
<input type=hidden name=DoctorCode value="%EMRWEB02.01.107.001">
<input type=hidden name=NurseCode value="%EMRWEB02.01.164.1">
<input type=hidden name=Location value="%EMRWEB02.01.083">
<input type=hidden name=DischargeComplete value="%EMRWEB02.01.147">
<input type=hidden name=Pres01 value="%EMRWEB02.01.104">
<input type=hidden name=Pres02 value="%EMRWEB02.01.105">
<input type=hidden name=Pres03 value="%EMRWEB02.01.174">
<input type=hidden name=Pres04 value="%EMRWEB02.01.175">
<input type=hidden name=Pres05 value="%EMRWEB02.01.176">
<input type=hidden name=Pres06 value="%EMRWEB02.01.177">
<input type=hidden name=linkadmn value="%EMRWEB02.01.081">
</form>

<script type="text/javascript">
 CTypeAdm="%EMRWEB02.01.252";
 if ( CTypeAdm == "Yes") {
   document.UpdateForm.emvis147.value=1; 
   document.PatientLinks.emvis147.value=1; }
 else { 
   document.UpdateForm.emvis147.value=0; 
   document.PatientLinks.emvis147.value=0; }
 ShowReg="%EMRWEB02.01.461";
 if(ShowReg=="1") {
   checkurno();
 }
 InjData="%EMRWEB02.01.188";
 if ( InjData =="1" ) {
    document.UpdateForm.injbuttn.className="RedButton";
 }
 if(!isWhitespace("%EMRWEB02.01.271.1")) {
   document.UpdateForm.mhprabut.className="RedButton";
 }
 if(document.HiddenFields.DischargeComplete.value=="4") {
   alert("Warning: This visit is Cancelled");
 }
 if("%EMRWEB02.01.253" == "Yes") {
   document.UpdateForm.emvis093.value="1";
   document.UpdateForm.d_emvis093.checked=true;
 } else {
   document.UpdateForm.emvis093.value="0";
   document.UpdateForm.d_emvis093.checked=false;
 }
</script>
