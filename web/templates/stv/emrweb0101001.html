<meta name="TemplateVersion" content="V12.01.00">
<meta name="TemplateHome"    content="stv">
<meta name="HelpFileName"    content="NoContextSet.html">
<meta name="RefreshTime"     content="90">
<meta name="CrossBrowser" content="true">
<script type="text/javascript" src="../js/SmallTable.js"></script>
<script type="text/javascript" src="../js/EmergencyMapSetupSTV2.js"></script>
</head>
%START.OF.PAGE
<body onload="PageLoad(event);">
<form name=Parameters>
<!--Removed for TSK 0876992
<input type=hidden name=emcndrth id=emcndrth
 value="STANDARD.01.025.122.011.0.1">
-->
</form>

<script type="text/javascript">
 var obj = new Map("blkbkgr1.gif");
 immediate = 0
 emergency = 0
 urgent = 20
 semi = 50
 non = 110

<!-- Paste below from site file emrergencymap.txt-->

//  Location
//  Description, Code, left, top, right, botton, Start Position Left, Top

 obj.AddLocation("Waiting Room  ","WR ",1006,185,1406,590,1006,185,"WAIT");

 obj.AddLocation("INT2          ","IN2",1206,140,1406,185,1206,140);
 obj.AddLocation("H6            ","H6 ",1206,90,1406,135,1206,90);
 obj.AddLocation("H5            ","H5 ",1206,45,1406,90,1206,45);
 obj.AddLocation("H4            ","H4 ",1206,0,1406,45,1206,0);

 obj.AddLocation("INT1          ","IN1",1006,140,1206,185,1006,140);
 obj.AddLocation("H3            ","H3 ",1006,90,1206,135,1006,90);
 obj.AddLocation("H2            ","H2 ",1006,45,1206,90,1006,45);
 obj.AddLocation("H1            ","H1 ",1006,0,1206,45,1006,0);

 obj.AddLocation("14            ","14 ",801,545,1001,590,801,545);
 obj.AddLocation("13            ","13 ",801,500,1001,545,801,500);
 obj.AddLocation("12            ","12i",801,455,1001,500,801,455);
 obj.AddLocation("11            ","11 ",801,410,1001,455,801,410);
 obj.AddLocation("10            ","10 ",801,365,1001,410,801,365);
 obj.AddLocation("9             ","09 ",801,320,1001,365,801,320);
 obj.AddLocation("8             ","08 ",801,275,1001,320,801,275);
 obj.AddLocation("7             ","07 ",801,230,1001,275,801,230);
 obj.AddLocation("6             ","06 ",801,185,1001,230,801,185);
 obj.AddLocation("5             ","05 ",801,140,1001,185,801,140);
 obj.AddLocation("41            ","41 ",801,90,1001,135,801,90);
 obj.AddLocation("40            ","40 ",801,45,1001,90,801,45);
 obj.AddLocation("39            ","39 ",801,0,1001,45,801,0);

 obj.AddLocation("Other         ","00 ",601,545,801,590,601,545,"HIDE");
 obj.AddLocation("AC            ","AC ",601,185,801,230,601,185);
 obj.AddLocation("4             ","4  ",601,140,801,185,601,140);
 obj.AddLocation("38            ","38 ",601,90,801,135,601,90);
 obj.AddLocation("37            ","37 ",601,45,801,90,601,45);
 obj.AddLocation("36            ","36 ",601,0,801,45,601,0);

 obj.AddLocation("AB            ","AB ",401,185,601,230,401,185);
 obj.AddLocation("3             ","3  ",401,140,601,185,401,140);
 obj.AddLocation("33            ","33 ",401,90,601,135,401,90);
 obj.AddLocation("34            ","34 ",401,45,601,90,401,45);
 obj.AddLocation("35            ","35 ",401,0,601,45,401,0);
// obj.AddLocation("Paediatrics   ","PA ",404,0,604,45,404,0);

 obj.AddLocation("15            ","15 ",201,545,401,590,201,545);
 obj.AddLocation("16            ","16 ",201,500,401,545,201,500);
 obj.AddLocation("17            ","17 ",201,455,401,500,201,455);
 obj.AddLocation("18            ","18 ",201,410,401,455,201,410);
 obj.AddLocation("19            ","19 ",201,365,401,410,201,365);
 obj.AddLocation("20            ","20 ",201,320,401,365,201,320);
 obj.AddLocation("21            ","21 ",201,275,401,320,201,275);
 obj.AddLocation("FAM           ","FM ",201,230,401,275,201,230);
 obj.AddLocation("AA            ","AA ",201,185,401,230,201,185);
 obj.AddLocation("2R            ","2R ",201,140,401,185,201,140);
 obj.AddLocation("32            ","32 ",201,90,401,135,201,90);
 obj.AddLocation("31            ","31 ",201,45,401,90,201,45);
 obj.AddLocation("30            ","30 ",201,0,401,45,201,0);

 obj.AddLocation("TR            ","TR ",0,545,201,590,0,545);
 obj.AddLocation("PL            ","PL ",0,500,201,545,0,500);
 obj.AddLocation("Eye / TH      ","ETH",0,455,201,500,0,455);
 obj.AddLocation("26            ","26 ",0,410,201,455,0,410);
 obj.AddLocation("25            ","25 ",0,365,201,410,0,365);
 obj.AddLocation("24            ","24 ",0,320,201,365,0,320);
 obj.AddLocation("23            ","23 ",0,275,201,320,0,275);
 obj.AddLocation("22            ","22 ",0,230,201,275,0,230);
 obj.AddLocation("BAR           ","BR ",0,185,201,230,0,185);
 obj.AddLocation("1R            ","1R ",0,140,201,185,0,140);
 obj.AddLocation("27            ","27 ",0,90,201,135,0,90);
 obj.AddLocation("28            ","28 ",0,45,201,90,0,45);
 obj.AddLocation("29            ","29 ",0,0,201,45,0,0);

 obj.AddLocation("Other         ","OTH",1024,1024,1024,1024,1024,1024);

<!-- Paste above from site file emergencymap.txt -->
// Output Expected Patients
//
%EMRWEB01.01.043
//
//  Patients
//  Name, Location Code, U/R, Triage, Arrival, Time,Sex, Age, Complaint, Doctor
%EMRWEB01.01.006
//
// Output Map View
//
ShowMap(immediate,emergency,urgent,semi,non);
//
// Output Hall of Shame
//
 t = new Table(1,0,1,"100%","center","Incomplete Patients")
//
// Add Columns in Order Required
// Heading,Type,Display Column,Sort Column,Align
//
 t.addColumn("Incomplete Patients","String",1,1,"left","EditIcon.gif","0",150)
 t.addColumn("Patients","String",2,2,"right","","",40)
//
// Add Rows to Table (Output from Web Server)
//
%EMRWEB01.01.032
 TableOutput(1,0)

SystemComments.innerHTML=
"<table width=100% border=1 cellspacing=0 cellpadding=3>" +
"<tr><td class=HeadingCell align=center>" +
"<a href='http://intranet/Departments/Emergency/Pages/Emergency.aspx' target='_blank'>" +
"Emergency Department Intranet</a></td></tr>" +
"<tr valign=top height=115><td>%EMRWEB01.01.031</td></tr></table>";

EmergencyCount.innerHTML=
"<table border=0 cellspacing=0 cellpadding=1 width=100%>" +
"<tr height=20><td>Total :</td><td><b>%EMRWEB01.01.007</td>" +
"    <td>Waiting</td><td><b>%EMRWEB01.01.009</td>" +
"    <td>Unseen</td><td><b>%EMRWEB01.01.010</td>" +
"<tr height=20><td>Inc Dr</td><td><b>%EMRWEB01.01.012</td>" +
"    <td>Nurse </td><td><b>%EMRWEB01.01.013</td>" +
"    <td>PSC </td><td><b>%EMRWEB01.01.014</td>" +
"</tr></table>"

BlackHole.innerHTML=
"<table border=0 cellspacing=2 cellpadding=4 width=100%>" +
"<tr height=40 valign=middle><td align=center>" +
"<img src=../images/TrekIcon.gif class=Icon onclick=OtherLocations()></td>" +
"<td><font color=white size=2>Patients in other Departments</td>" +
"<td><font color=white size=2>%EMRWEB01.01.011</td>" +
"</tr></table>"

if(trim("%EMRWEB01.01.044.WR ") > 18) {
  WaitingRoomFull.style.display="";
  WaitingRoomFull.innerHTML=
  "<table border=0 cellspacing=2 cellpadding=4 width=100%>" +
  "<tr height=39 valign=middle><td align=center>" +
  "<img src=../images/LargePlus.gif class=Icon " +
  "onclick='ListWaitingRoomPatients();'></td>" +
  "</tr></table>"
} else {
  WaitingRoomFull.style.display="none";
}

EmergencyMenu.innerHTML=parent.MenuList.innerHTML 

</script>

<script type="text/javascript">
function ShowPatientDetails(PatientNo) {
  if(!isWhitespace(obj.patients[PatientNo][4])) {
    PageLocation="?reportno=1&template=4" +
                 "&urnumber=" + obj.patients[PatientNo][0].replace(/ /g,"+") +
                 "&admissno=" + obj.patients[PatientNo][1].replace(/ /g,"+") 
  } else {
     PageLocation="?reportno=1&template=11" +
                  "&urnumber=" + obj.patients[PatientNo][0].replace(/ /g,"+") +
                  "&admissno=" + obj.patients[PatientNo][1].replace(/ /g,"+") 
  }
  globalLinkType=0;
  globalLinkUrl="../cgi-bin/emrweb02.pbl" + PageLocation
  top.content.location="../cgi-bin/emrweb02.pbl" + PageLocation
}
function ListWaitingRoomPatients() {
 if(top.content.location.search.substring(1,23)=="reportno=2&template=3"){
 if (IsDirtyTriage(top.content.UpdateForm)==true) { return; }} 
 url = "../cgi-bin/emrweb01.pbl?reportno=01&template=024" 
 top.menu.EmergencyFrameLink(url,0,0,1008,521)
}
function OtherLocations() {
 if(top.content.location.search.substring(1,23)=="reportno=2&template=3"){
 if (IsDirtyTriage(top.content.UpdateForm)==true) { return; }} 
 url = "../cgi-bin/emrweb01.pbl?reportno=01&template=012" 
 parent.content.location=url
}
function EMULocations() {
 if(top.content.location.search.substring(1,23)=="reportno=2&template=3"){
 if (IsDirtyTriage(top.content.UpdateForm)==true) { return; }} 
 url = "../cgi-bin/patweb93.pbl?reportno=01&template=011" 
 top.menu.EmergencyFrameLink(url,0,0,1008,521)
}
function SelectPatient(admissno) {
 url = "../cgi-bin/emrweb02.pbl?reportno=01&template=100" +
       "&admissno=" + admissno.replace(/ /g,"+") 
 parent.menu.EmergencyMenu.innerHTML=""
 EmergencyFrameLink(url,1,1,1004,525)
}
function updDoc(doctor) {
if(isWhitespace(doctor.value)){return;}
doctor=doctor.value.toUpperCase()
admissno='%EMRWEB01.01.021';
emcndoct='%EMRWEB01.01.040';
// validate doctor exists in patdo1af
  var serverURL   = "../cgi-bin/patweb80.pbl?reportno=3" +
                    "&valdcode=" + doctor.replace(/ /g,"+")
  var returnValue = RSExecute(serverURL);
  if (returnValue.status!=0) {  return; }   

// validate doctor exists in emrdocaf
  if (emcndoct==1) {
    var serverURL   = "../cgi-bin/emrweb08.pbl?reportno=11" +
                      "&valdcode=" + doctor.replace(/ /g,"+")
    var returnValue = RSExecute(serverURL);
    if (returnValue.status!=0) { return; }   
  }

  var serverURL   = "../cgi-bin/emrweb08.pbl?reportno=3" +
                    "&admissno=" + admissno +
                    "&doctcode=" + doctor +
                    "&updttype=ALDOC" +
                    "&updateky=1"
  var returnValue = RSExecute(serverURL);

  if(top.content.location.search.substring(1,22)=="reportno=1&template=4"){
    admissno=admissno - 0
    if (top.content.PatientLinks.admissno.value == admissno) {
        top.content.location.reload();
    }
  }

  location.reload();
}
function SelectDoctor(doctcode) {
 if(top.content.location.search.substring(1,23)=="reportno=2&template=3"){
 if (IsDirtyTriage(top.content.UpdateForm)==true) { return; }} 
  var url = "../cgi-bin/emrweb01.pbl?" +
            "reportno=1&template=16" +
            "&doctcode=" + doctcode.replace(/ /g,"+")
 parent.content.location=url
}
function IsDirtyTriage(eForm) {
  for (var i=0; i < eForm.length; i++) {
    var eElem = eForm.elements[i];
    if ("text" == eElem.type || "textarea" == eElem.tagName)
    {
      if (eElem.value.replace(/ /g,"") != eElem.defaultValue.replace(/ /g,""))  {
      return true;}
    }
    else if ("checkbox" == eElem.type || "radio" == eElem.type)
    {
      if (eElem.checked != eElem.defaultChecked) return true;
    }
  }
  return false;
}
</script>
<form name=defPatientLink method=get>
<input type=hidden name=serverid value="emrweb02">
<input type=hidden name=reportno value="01">
<input type=hidden name=template value="100">
<input type=hidden name=nextseq value="%EMRWEB01.01.021">
<input type=hidden name=waiting> 
</form>
