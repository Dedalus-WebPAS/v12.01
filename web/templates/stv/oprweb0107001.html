<meta name="TemplateVersion" content="V12.01.00">
<meta name="TemplateHome" content="stv">
<meta name="HelpFileName" content="NoContextSet.html">
<meta name="CrossBrowser" content="true">
<script type="text/javascript" src="../js/oprweb01.js"></script>
<style type="text/css">
textarea {
      font-family: Arial;
      background-color:white;
      font-size:8pt;
}
</style>
<script type="text/javascript"> 
function checkMaxPat() {
  var serverURL="../cgi-bin/patweb96.pbl?reportno=12&remoteno=7" +
                "&wardcode="+UpdateForm.bkrec015.value.replace(/ /g,"+") +
                "&admisdte="+UpdateForm.bkrec004.value.replace(/ /g,"+");
  
  var returnValue=RSExecute(serverURL);
  if (returnValue.status==0) {
    if (returnValue.return_value==1) {
      alert("Warning: Maximum number of Patients exceeded.");
    }               
  }                 
  
  return;
} 
function valDoctorUnit() {
  if(!isWhitespace(UpdateForm.bkrec002.value)){
    validateCode(31,UpdateForm.bkrec002,UpdateForm.n_bkrec002);
    selectOptions("30",UpdateForm.bkrec002,UpdateForm.bkrec021);

    UpdateForm.bkrec021.selectedIndex=1
  }
}
function checkBedManagement() {
  if(!validateMandatory(document.UpdateForm)) {
    return;
  }
  admissno=PatientLinks.admissno.value.replace(/ /g,"+")
  prnxindi="0";

  if (isWhitespace(document.UpdateForm.bkrec015.value)) {
    document.UpdateForm.submit();
    return;
  }

  if (isWhitespace(document.UpdateForm.bkrec018.value)) {
    document.UpdateForm.submit();
    return;
  }

  var serverURL = "../cgi-bin/patweb96.pbl?reportno=12&remoteno=6" +
                  "&wardcode="+UpdateForm.bkrec015.value.replace(/ /g,"+") +
                  "&beddcode="+UpdateForm.bkrec018.value.replace(/ /g,"+") +
                  "&admisdte="+UpdateForm.bkrec004.value.replace(/ /g,"+") +
                  "&admistme="+UpdateForm.bkrec005.value.replace(/ /g,"+")

  var returnValue = RSExecute(serverURL);
  if (returnValue.status==0) {
    if (returnValue.return_value==1) {
      alert("Selected Bed is closed during this date/time.");
      return;
    }
  }

  if (UpdateForm.pswdindc.value==0) {
    var serverURL = "../cgi-bin/patweb96.pbl?reportno=12&remoteno=5" +
                    "&wardcode="+UpdateForm.bkrec015.value.replace(/ /g,"+") +
                    "&beddcode="+UpdateForm.bkrec018.value.replace(/ /g,"+") +
                    "&admissno="+admissno.replace(/ /g,"+") +
                    "&admisdte="+UpdateForm.bkrec004.value.replace(/ /g,"+") +
//                    "&staydays="+UpdateForm.bkrec033.value.replace(/ /g,"+") +
                    "&admistme="+UpdateForm.bkrec005.value.replace(/ /g,"+") +
                    "&ptrgm001="+UpdateForm.ptrgm001.value.replace(/ /g,"+") +
                    "&ptrgm002="+UpdateForm.ptrgm002.value.replace(/ /g,"+") +
                    "&ptrgm003="+UpdateForm.ptrgm003.value.replace(/ /g,"+") +
                    "&prnxindi="+prnxindi.replace(/ /g,"+")
    var returnValue = RSExecute(serverURL);
    if (returnValue.status==0) {
      if (returnValue.return_value==1) {
        if (!confirm("Warning: Another patient booked at this time. Do you want to override?")) {
          return;
        }
      }
      prevretval=returnValue.return_value;
      prnxindi="1";
      var serverURL = "../cgi-bin/patweb96.pbl?reportno=12&remoteno=5" +
                      "&wardcode="+UpdateForm.bkrec015.value.replace(/ /g,"+") +
                      "&beddcode="+UpdateForm.bkrec018.value.replace(/ /g,"+") +
                      "&admissno="+admissno.replace(/ /g,"+") +
                      "&admisdte="+UpdateForm.bkrec004.value.replace(/ /g,"+") +
//                      "&staydays="+UpdateForm.bkrec033.value.replace(/ /g,"+")
 +
                      "&admistme="+UpdateForm.bkrec005.value.replace(/ /g,"+") +
                      "&ptrgm001="+UpdateForm.ptrgm001.value.replace(/ /g,"+") +
                      "&ptrgm002="+UpdateForm.ptrgm002.value.replace(/ /g,"+") +
                      "&ptrgm003="+UpdateForm.ptrgm003.value.replace(/ /g,"+") +
                      "&prnxindi="+prnxindi.replace(/ /g,"+")
      var returnValue = RSExecute(serverURL);
      if (returnValue.status==0) {
        if (returnValue.return_value==1) {
          if (!confirm("Warning: Another patient booked at this time. Do you want to override?")) {
            return;
          }
        }

        if (prevretval==1 || returnValue.return_value==1) {
          UpdateForm.pswdindc.value="1";
          PasswordHead.innerHTML=passwordhd.innerHTML;
          PasswordCode.innerHTML=passwordcd.innerHTML;
          UserNameHead.innerHTML=usernamehd.innerHTML;
          UserNameCode.innerHTML=usernamcd.innerHTML;
          return;
        }
        checkMaxPat();
        PostData();
      }
    }
  } else {
    checkMaxPat();
    PostData();
  }
}
function displayRegime() {
    x=document.UpdateForm.bkrec008.value.substring(3,4);
//alert(x);
    if(x=="O") {
      RegimeHead1.innerHTML=regimehd1.innerHTML;
      RegimeCode1.innerHTML=regimecod1.innerHTML;
      RegimeHead2.innerHTML=regimehd2.innerHTML;
      RegimeCode2.innerHTML=regimecod2.innerHTML;
      RegimeHead3.innerHTML=regimehd3.innerHTML;
      RegimeCode3.innerHTML=regimecod3.innerHTML;
    validateCode(75,UpdateForm.ptrgm001,UpdateForm.t_ptrgm001);
    validateCode(75,UpdateForm.ptrgm002,UpdateForm.t_ptrgm002);
    validateCode(75,UpdateForm.ptrgm003,UpdateForm.t_ptrgm003);
    if (isWhitespace(UpdateForm.ptrgm001.value)) UpdateForm.ptrgm001.value="";
    if (isWhitespace(UpdateForm.ptrgm002.value)) UpdateForm.ptrgm002.value="";
    if (isWhitespace(UpdateForm.ptrgm003.value)) UpdateForm.ptrgm003.value="";
      UpdateForm.bkrec028.className="Mandatory";
    } else {
      RegimeHead1.innerHTML="";
      RegimeCode1.innerHTML=regimeblank1.innerHTML;
      RegimeHead2.innerHTML="";
      RegimeCode2.innerHTML=regimeblank2.innerHTML;
      RegimeHead3.innerHTML="";
      RegimeCode3.innerHTML=regimeblank3.innerHTML;
      UpdateForm.bkrec028.className="";
    }
}
function DeleteBooking(){
    LinkUrl="patweb92.pbl?reportno=06&template=007&urnumber=" + 
            document.UpdateForm.urnumber.value.replace(/ /g,"+") +
            "&admissno=" + document.UpdateForm.admissno.value.replace(/ /g,"+");
    Left=(document.body.clientWidth-700)/2;
    DFrameLink(LinkUrl,100,Left,700,250);
}
  function CheckBooking() {
    if (UpdateForm.bkrec008.value.substr(14,3)=="MAT") {
     LinkUrl="oprweb01.pbl?reportno=7&template=2&admissno="
                  + document.UpdateForm.admissno.value.replace(/ /g,"+") 
                  + "&urnumber=" +document.UpdateForm.urnumber.value.replace(/ /g,"+");
       alert(LinkUrl);
     location.href=LinkUrl;
//     DFrameLink(LinkUrl,50,0,740,390);
    }
  }
function valClaimCode() {
  if (UpdateForm.bkrec023.value=="") {
  validateCode(41,LinkForm.urnumber,UpdateForm.claimc);
  for (var i =0 ; i < document.UpdateForm.bkrec023.length; i++) {
    if (document.UpdateForm.claimc.value==
        trim(document.UpdateForm.bkrec023.options[i].value.substr(0,3))){
          document.UpdateForm.bkrec023.selectedIndex=i;
    }
  } }
}


function PageLoadExtended()
{
  PageLoad();
  removeTheatreIfMedicalType();
  valClaimCode();
  displayRegime();
}

function removeTheatreIfMedicalType()
{
  var bktype = document.getElementById("bktype");
  var selectionList = document.getElementById("bkrec008");

  if(bktype)
  {
    //if its not a theatre booking - remove it
    if( bktype.value.substr(14,3) != "THE")
    {
      //scan the whole drop down
      for(var i = 0; i < selectionList.length; i++)
      {
        //checking for Theatre booking type 
        if(selectionList[i].value.substr(14,3) == "THE")
        {
           selectionList.remove(i); //if we remove one element
           i--;//we also need need to reduce the counter
        }
      }
    }
  }
}

function PostData()
{
UpdateForm.submit();
}
function getBMRDCookie() {

  var strposition = "";
  var endposition = "";

//alert(GetCookieData("BMRDCookie").substring(50,127));

  if (GetCookieData("BMRDCookie")!="unknown") {

    strposition = GetCookieData("BMRDCookie").search("patweb93");
    endposition = GetCookieData("BMRDCookie").length;

    document.UpdateForm.redirect.value=
    GetCookieData("BMRDCookie").substring(parseInt(strposition),
                                          parseInt(endposition));
  }

//alert(document.UpdateForm.redirect.value);

  ExpireCookiePath("BMRDCookie");

}
</script>
</head>
%START.OF.PAGE
<body onload="PageLoadExtended();valDoctorUnit();getBMRDCookie();">
<div id=PageHeadingSection>
<div id=PatientHeading></div>
<script type="text/javascript">
PatientURN="%OPRWEB01.07.003";
PatientVIS="%OPRWEB01.07.081";
PatientNAM="%OPRWEB01.07.002";
PatientSTA="%OPRWEB01.07.086.078";
PatientALT="%OPRWEB01.07.084";
PatientSEX="%OPRWEB01.07.019";
PatientDOB="%OPRWEB01.07.020";
PatientAGE="%OPRWEB01.07.021";
PatientLOC="%OPRWEB01.07.083";
PatientPRI="%OPRWEB01.07.086.066.1";
PatientUNT="%OPRWEB01.07.066.0";
DoctorCOD="%OPRWEB01.07.082.003";
DoctorNAM="%OPRWEB01.07.082.002";
PatientAID="%OPRWEB01.07.086.090";
PatientIND="%OPRWEB01.07.086.091";
PatientCUR="%OPRWEB01.07.086.092";
PatientCLC="%OPRWEB01.07.086.093.1";
PatientCLH="%STANDARD.01.017.CL";
PatientHFT="%OPRWEB01.07.086.094";
PatientCDM="%OPRWEB01.07.086.095";
PatientVDH="%OPRWEB01.07.086.099.015";
InsertPatientHeader()
</script>
<div id=PatientMenu></div>
</div>
<div id=PageBodySection>
<form name=LinkForm action=oprweb01.pbl method=get target=content
 style="margin:0">
<input type=hidden name=reportno value=9>
<input type=hidden name=template value=2>
<input type=hidden name=urnumber value="%OPRWEB01.07.003">
<input type=hidden name=sesskeys value="">
</form>

<form name=UpdateForm action=oprweb01.pbl method=post style="margin:0"
 onsubmit="return validateMandatory(this);">
<input type=hidden name=reportno value=7>
<input type=hidden name=template value=1>
<input type=hidden name=setbookf value=1>
<input type=hidden name=updttype value=U>
<input type=hidden name=urnumber value="%OPRWEB01.07.003">
<input type=hidden name=ibcnmhos value="%STANDARD.01.025.000.043.1.1">
<input type=hidden name=claimc>
<input type=hidden name=exptward value="%OPRWEB01.07.119">
<input type=hidden name=admissno value="%OPRWEB01.07.081">
<input type=hidden name=nextpage value="1">
<input type=hidden name=redirect value="%OPRWEB01.07.001.patweb98.01.001">
<input type=hidden name=ptcnbman value="%STANDARD.01.025.112.107.0.1">
<input type=hidden name=pswdindc value="0">
<input type="hidden" name="bktype"   value="%OPRWEB01.07.111.3" />

<table border="0" cellpadding="0" cellspacing="0" width="100%">
<tr><td>&nbsp;</td></tr>
<tr><td class=DataLabel>Booking Type</td>
   <td class=DataField >
   <select name=bkrec008 onchange="CheckBooking();displayRegime();"
    class=Mandatory title="Booking Type">
   <option></option>
    %OPRWEB01.07.111.2
   </select></td>
   <td><div id=RegimeHead1></div></td>
   <td><div id=RegimeCode1></div></td>
</tr>
<tr><td class=DataLabel>Admission Date</td>
    <td class=DataLabel >
    <input type=text name=bkrec004 size=12 value="%OPRWEB01.07.106"  
     class=Mandatory title="Scheduled Admission Date">
    <img src="../images/DateLookup.gif" class=Icon date=UpdateForm.bkrec004>
    Time
    <input type=text name=bkrec005 size=10 value="%OPRWEB01.07.107"
    class=Mandatory title="Scheduled Admission Time">
    <img src="../images/DateTimeStamp.gif" class=Icon date=UpdateForm.bkrec004
     time=UpdateForm.bkrec005>  
    <img src="../images/TimeLookup.gif" class=Icon time=UpdateForm.bkrec005>  
    </td>
    <td><div id=RegimeHead2></div></td>
    <td><div id=RegimeCode2></div></td>
</tr>
<tr><td class=DataLabel>Admitting Point</td>
    <td class=DataField>
    <select name=bokrx003>
    <option></option>
    %OPRWEB01.07.203.2
    </select></td>
    <td><div id=RegimeHead3></div></td>
    <td><div id=RegimeCode3></div></td>
</tr>

<tr><td class=DataLabel>Expected Ward</td>
    <td class=DataField><input type=hidden name=bedstat1>
                        <input type=hidden name=warddesc>
    <select name=bkrec015>
    <option></option>
     %OPRWEB01.07.202.2
    </select>
    <input type=text name=bkrec018 readonly maxlength=3 size=3 title="Bed"
     value="%OPRWEB01.07.122">
    <img notab src="../images/SearchIcon.gif" class=Icon
     onclick="WardBedSearchFrame(UpdateForm.bkrec015,
                                 UpdateForm.warddesc,
                                 UpdateForm.bkrec018,
                                 UpdateForm.bedstat1);">
    </td>
    </tr>

<tr><td class=DataLabel>Admitting Doctor</td>
    <td class=DataField colspan=3>
    <input type=text name=bkrec002 size=8 maxlength=8 
     value="%OPRWEB01.07.104.003"
     onblur="UpCase(this);valDoctorUnit();">
    <input type=text name=n_bkrec002 size=40 radonly notab
     value="%OPRWEB01.07.104.002">
    <a href="javascript:DoctorSearchFrame(UpdateForm.bkrec002,
                                          UpdateForm.n_bkrec002)">
    <img src="../images/SearchIcon.gif" class=Icon></a></td>

<tr><td class=DataLabel>Unit</td>
    <td class=DataField>
    <select name=bkrec021>
    <option></option>
     %OPRWEB01.07.125.2
    </select></td>
</tr>

<tr><td class=DataLabel>%STANDARD.01.017.CC</td>
    <td><select name=bkrec028 title="%STANDARD.01.017.CC"
         onchange="">
         <option> </option>
         %OPRWEB01.07.128.2
         </select></td></tr>


<tr><td class=DataLabel>%STANDARD.01.017.CL</td>
    <td class=DataField>
    <select name=bkrec023>
    <option></option>
    %OPRWEB01.07.127.9.1.10.2.X
    </select></td>
    <td><div id=UserNameHead></div></td>
    <td><div id=UserNameCode></div></td>
    </tr>

<tr><td class=DataLabel>%STANDARD.01.017.VI </td>
    <td class=DataField>
    <select name=bokrx011>
    <option></option>
    %OPRWEB01.07.211.2
    </select></td>
    <td><div id=PasswordHead></div></td>
    <td><div id=PasswordCode></div></td>
    </tr>

<tr><td class=DataLabel>%STANDARD.01.017.S </td>
    <td class=DataField>
    <select name=bokrx031>
    <option></option>
     %OPRWEB01.07.231.2
    </select></td>

<tr><td class=DataLabel>Attending HCP</td>
    <td class=DataField colspan=3>
    <input type=text name=bokrx020 size=8 maxlength=8 
       onchange="validateCode(31,UpdateForm.bokrx020,UpdateForm.n_bokrx020);"
       value='%OPRWEB01.07.220.1'>
    <input type=text name=n_bokrx020 size=40 class=readonly
       value='%OPRWEB01.07.220.0'>
    <a href="javascript:HCPSearchFrame(UpdateForm.bokrx020,
                                       UpdateForm.n_bokrx020,4)">
    <img src="../images/SearchIcon.gif" class=Icon></a></td>
</tr>

<tr><td class=DataLabel>%STANDARD.01.017.DC</td>
    <td><select name=bokrx040 title="%STANDARD.01.017.DC"
         onchange="">
         <option> </option>
         %OPRWEB01.07.240.2
         </select></td></tr>

<tr><td class=DataLabel>%STANDARD.01.017.OB</td>
    <td><select name=bokrx041 title="%STANDARD.01.017.OB"
         onchange="">
         <option> </option>
         %OPRWEB01.07.241.2
         </select></td></tr>

<tr><td class=DataLabel>Diagnosis</td>
   <td class=DataField colspan=3>
   <input type=text name=bkrec036 size=70 maxlength=50 value="%OPRWEB01.07.132">
</td></tr>

      <tr>
        <td>
          <table border=0 width=100% class=TableBody cellpadding=0
                 cellspacing=0>
            <tr><td class=DataLabel> Admission Comments </td></tr>
            <tr><td colspan=6 align=left>
                <input type=button value="Add" class="button" tabindex=19
                 name="AddComm" id="AddComm"
                 onclick="tempDisable(this);AddComment();"></td></tr>
            <tr><td>&nbsp;</td></tr>
            <tr><td>&nbsp;</td></tr>
          </table>
        </td>
        <td colspan=6 align=left>
          <textarea wrap=hard name=adcommna class=Readonly readonly
           rows=5 cols=70>%OPRWEB01.07.312.005</textarea>
        </td>
      </tr>

<tr><td>&nbsp;</td></tr>
<tr><td colspan=10 align=center> 
    <input type=button id="opr01web" 
     onclick="tempDisable(this);checkBedManagement();"
     value=Ok class="button">
    <input type=button value=Cancel class="button" onclick='history.go(-2)'>
    <input type=button value=Delete class="button" onclick='DeleteBooking();'>
    </td></tr>

</table>
</form>
</div>

<form name=PatientLinks method=get>
<input type=hidden name=reportno value=1>
<input type=hidden name=template value=004>
<input type=hidden name=urnumber value="%OPRWEB01.07.003">
<input type=hidden name=admissno value="%OPRWEB01.07.081">
<input type=hidden name=MenuType value="%OPRWEB01.07.088">
</form>

<script type="text/javascript" >
if(document.UpdateForm.ibcnmhos.value=="1"){
   UpdateForm.bkrec015.className="Mandatory"}
function init(){
 for (var i =0 ; i < document.UpdateForm.bkrec015.length; i++) {
    if (trim(document.UpdateForm.exptward.value)==
        trim(document.UpdateForm.bkrec015.options[i].value.substr(0,3))){
          document.UpdateForm.bkrec015.selectedIndex=i;
    }
 }
}
</script>

<span id=regimehd1 style="display:none">
<td class=DataLabel>Regime Code 1</td>
</span>
<span id=regimecod1 style="display:none">
<td><input type="text" size=10 maxlength=10
     name=ptrgm001 value="%OPRWEB01.07.309. 1"
     onblur="validateCode(75,UpdateForm.ptrgm001,UpdateForm.t_ptrgm001);">
    <input type=text name=t_ptrgm001 size=20 readonly
     class=Readonly title="Regime Description">
    <img src="../images/SearchIcon.gif" class=Icon
     onclick="RegimeSearchFrame(UpdateForm.ptrgm001,UpdateForm.t_ptrgm001);">
    <img src="../images/erase.gif" class=Icon
     onclick="clrFields(UpdateForm.ptrgm001,UpdateForm.t_ptrgm001);">
</td>
</span>

<span id=regimehd2 style="display:none">
<td class=DataLabel>Regime Code 2</td>
</span>
<span id=regimecod2 style="display:none">
<td><input type="text" size=10 maxlength=10
     name=ptrgm002 value="%OPRWEB01.07.309. 2"
     onblur="validateCode(75,UpdateForm.ptrgm002,UpdateForm.t_ptrgm002);">
    <input type=text name=t_ptrgm002 size=20 readonly
     class=Readonly title="Regime Description">
    <img src="../images/SearchIcon.gif" class=Icon
     onclick="RegimeSearchFrame(UpdateForm.ptrgm002,UpdateForm.t_ptrgm002);">
    <img src="../images/erase.gif" class=Icon
     onclick="clrFields(UpdateForm.ptrgm002,UpdateForm.t_ptrgm002);">
</td>
</span>

<span id=regimehd3 style="display:none">
<td class=DataLabel>Regime Code 3</td>
</span>
<span id=regimecod3 style="display:none">
<td><input type="text" size=10 maxlength=10
     name=ptrgm003 value="%OPRWEB01.07.309. 3"
     onblur="validateCode(75,UpdateForm.ptrgm003,UpdateForm.t_ptrgm003);">
    <input type=text name=t_ptrgm003 size=20 readonly
     class=Readonly title="Regime Description">
    <img src="../images/SearchIcon.gif" class=Icon
     onclick="RegimeSearchFrame(UpdateForm.ptrgm003,UpdateForm.t_ptrgm003);">
    <img src="../images/erase.gif" class=Icon
     onclick="clrFields(UpdateForm.ptrgm003,UpdateForm.t_ptrgm003);">
</td>
</span>

<span id=regimeblank1 style="display:none">
<td><input type=hidden name=ptrgm001 value=""></td>
</span>

<span id=regimeblank2 style="display:none">
<td><input type=hidden name=ptrgm002 value=""></td>
</span>

<span id=regimeblank3 style="display:none">
<td><input type=hidden name=ptrgm003 value=""></td>
</span>


<span id=usernamehd style="display:none">
<td class=DataLabel>User Name</td>
</span>

<span id=usernamcd style="display:none">
<td><input size=12 type=text name=username class=Mandatory title="UserName">
</td>
</span>

<span id=passwordhd style="display:none">
<td class=DataLabel>Password</td>
</span>

<span id=passwordcd style="display:none">
<td><input size=12 type=password name=password
     onblur="checkPass();" class=Mandatory
     title="Password"></td>
</span>
