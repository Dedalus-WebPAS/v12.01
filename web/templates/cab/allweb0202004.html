<meta name="TemplateVersion" content="V12.01.00">
<meta name="TemplateHome" content="cab">
<meta name="HelpFileName" content="NoContextSet.html">
<meta name="CrossBrowser" content="true">
<script type="text/javascript" src="../js/allweb0202004.js"></script>
<script>
function PageLoadExtended(event)
{
  PageLoad(event);
  checkIfSACClosure();
  checkIfPCRMandatory();
  checkStatusOfReferral();
  checkVINAHMandatoryClosure();
}

function checkIfPCRMandatory() {
  if ((document.UpdateForm.ptcnhdps.value == "3") ||
      (document.UpdateForm.ptcnhdps.value == "1")) {
    document.UpdateForm.alref072.className="Mandatory";
  }
}

function checkIfSACClosure()
{
  var alreuyn4 = document.getElementById("sacs_master");
  var alref006 = document.getElementById("alref006");
  var placeHolder = document.getElementById("reasonForClosurePlaceHolder");

  if (document.UpdateForm.ptcnhdps.value!="3") {  // Not Victoria
    alref006.className ="Mandatory";
    return;
  }

  if (alreuyn4.value.replace(/ /g,"") == "Yes")
  {
    placeHolder.style.display="none";
    if (alref006)
      alref006.className = "";
  }
  else
  {
    placeHolder.style.display="";

    if (alref006) {
        alref006.className ="Mandatory";
    }
  }
}

</script>
<script type="text/javascript" >
REFERRALTRANSITIONDATES="%ALLWEB02.02.818";
</script>
</head>
%START.OF.PAGE
<body onload="PageLoadExtended(event);">
<span class=DFrameTitleBar>
<img align=right alt="Exit" class="MenuIcon" 
 src="../images/ExitIcon.gif" onclick="DFrameExit()">
Close a Referral    
</span>
<form id=UpdateForm name=UpdateForm action="allweb02.pbl" method=post
 onsubmit='return validateMandatory(this);'>

<input type=hidden name=reportno value="2">
<input type=hidden name=updatety value="C">
<input type=hidden name=urnumber value="%ALLWEB02.02.003">
<input type=hidden name=admissno value="%ALLWEB02.02.081">
<input type=hidden name=MenuType value="%ALLWEB02.02.088">
<input type=hidden name=deptcode value="%ALLWEB02.02.125.3">
<input type=hidden name=alref036 value="">
<input type=hidden name=alref083 value="">
<input type=hidden name=dummy value="">
<input type=hidden name=checkappt value="0">
<input type=hidden name=sacs_master id=sacs_master value="%ALLWEB02.02.144">
<input type=hidden name=d_alref164 value="%ALLWEB02.02.199.039">
<input type=hidden name=ptcnhdps value="%STANDARD.01.025.080.250.1.1">
<input type=hidden name=d_alref049 value="%ALLWEB02.02.140.10.1">
<input type=hidden name=fapbookd value="%ALLWEB02.02.199.034">
<input type=hidden name=fapnotfd value="%ALLWEB02.02.199.036">
<input type=hidden name=d_alref075 value="%ALLWEB02.02.140.36.1">
<input type=hidden name=d_alref077 value="%ALLWEB02.02.140.38.1">
<input type=hidden name=d_alref078 value="%ALLWEB02.02.140.39.1">
<input type=hidden name=d_alref094 value="%ALLWEB02.02.155">
<input type=hidden name=d_alref132 value="%ALLWEB02.02.199.003">
<input type=hidden name=firstenc value="%ALLWEB02.02.244">
<input type=hidden name=linkedop value="%ALLWEB02.02.516">
<input type=hidden name=encountr value="%ALLWEB02.02.230">

<table align=center cellspacing=0 cellpadding=2 border=0 width=95%>
<tr><td class=DataLabel width=20%>Department</td>
  <td><input readonly type=text value="%ALLWEB02.02.125.0" 
       class=Readonly></td>
    <td class=DataLabel>Entered by</td>
    <td><input readonly type=text class=Readonly  
         value="%ALLWEB02.02.163" >
        <input type=hidden name="d_wbsehosp" value="%STANDARD.01.032">
    </td>
</tr>
<tr><td class=DataLabel>Date Closed</td>
 <td class=DataLabel><input type=text name=alref007 value="%ALLWEB02.02.107" 
    id=alref007 title="Date Closed" class="PastDate Mandatory">
    <img src=../images/DateLookup.gif class=Icon date=date1
     align=absmiddle onclick="DateLookupFrame(alref007);">
     Time<input type=text size=6 title="Time" value="%ALLWEB02.02.108" 
        class="Mandatory Time" id=alref008 name=alref008>
    <img src="../images/DateTimeStamp.gif" class=Icon 
      onclick="SetCurrentDateTime(alref007,alref008);">
    <img src="../images/TimeLookup.gif" class=Icon time=time1
      onclick="TimeLookupFrame(alref008);">
    </td>
</tr>
</table>
    
<div id="reasonForClosurePlaceHolder">
<table  align=center cellspacing=0 cellpadding=2 border=0 width=95%>
<tr>
    <td class=DataLabel width="20%">%STANDARD.01.017.LL</td>
    <td>
      <select name=alref006 id=alref006 title="%STANDARD.01.017.LL">
        <option></option>
         %ALLWEB02.02.106.2
        </select>
    </td>
</tr>
</table>
</div>

<table  align=center cellspacing=0 cellpadding=2 border=0 width=95%>
<tr><td class=DataLabel>Comment</td>
    <td class=DataLabel>
       <input type=text id="commenty" value="%ALLWEB02.02.233"
       name=commenty size=51 maxlength=50>
    </td>
</tr>

<tr><td class=DataLabel width=20%>%STANDARD.01.017.lG</td>
    <td><select name=alref072 title="%STANDARD.01.017.lG" />
        <option></option>
         %ALLWEB02.02.140.33.2
        </select></td>
</tr>

<tr><td class=DataLabel>Date of Next Review</td>
 <td class=DataLabel><input type=text size=12 name=alref037 
     value="%ALLWEB02.02.137"
     title="Date of Next Review" >
    <img src=../images/DateLookup.gif class=Icon date=date1
     align=absmiddle onclick="DateLookupFrame(alref037);">
    <img src="../images/DateTimeStamp.gif" class=Icon
      onclick="SetCurrentDateTime(alref037);">
    </td>
</tr>
</table>

<div id=InsertSACS></div>

<table align=center cellspacing=0 cellpadding=2 border=0 width=95%>
<tr><td colspan=4 align=center><br>
    <input type=button value="Ok" id=okbutton name=okbutton class="button"
     onclick="tempDisable(this); CloseReferral();">
    <input type=button Value="Cancel" class="button" 
     onclick="DFrameClose();">
    </td>
</tr>
</table>
</form>
<div id="ShowSACSFields" style="display:none;">
<table align=center cellspacing=0 cellpadding=2 border=0 width=95%>
<tr>
 <td class=DataLabel width=137>Case End Date</td>
 <td class=DataLabel><input type=text name=alref136 value="%ALLWEB02.02.199.007"
     id=alref136 title="Case End Date" class="Mandatory PastDate">
    <img src=../images/DateLookup.gif class=Icon date=date1
     align=absmiddle onclick="DateLookupFrame(alref136);">
     Time &nbsp;<input type=text size=6 title="Time" value="%ALLWEB02.02.199.008"
        class="Mandatory Time" id=alref137 name=alref137>
    <img src="../images/DateTimeStamp.gif" class=Icon
      onclick="SetCurrentDateTime(alref136,alref137);">
    <img src="../images/TimeLookup.gif" class=Icon time=time1
      onclick="TimeLookupFrame(alref137);">
    </td>
</tr>
</table>
</div>

<script type="text/javascript">
function checkStatusOfReferral() {
 p=document.UpdateForm
//
 var InsertSACS = document.getElementById('InsertSACS');

 InsertSACS.innerHTML="";

 var BulkBill = "%ALLWEB02.02.136";
 if ( BulkBill == "Yes") {
   document.UpdateForm.alref036.value=1;
 }

 var SACSRef="%ALLWEB02.02.144";
 if ( SACSRef == "Yes" ) {
   if (document.UpdateForm.ptcnhdps.value == "3") {  // only Victoria
     InsertSACS.innerHTML = document.getElementById('ShowSACSFields').innerHTML;
   }
   document.UpdateForm.alref083.value = 1;
  } else {
   document.UpdateForm.alref083.value = 0;
  }
 
 var comment = document.getElementById("commenty");
 Status="%ALLWEB02.02.103"
 if (Status=="Closed    "){
    if (comment)
    {
     comment.readOnly = true;
     comment.className = "Readonly";
    }
    document.UpdateForm.okbutton.disabled = true;
 } else {
    if (comment)
       comment.value = ""; //blank comment if new close
    document.UpdateForm.alref007.value = "%STANDARD.01.015";
    document.UpdateForm.alref008.value = "%STANDARD.01.016";
 }
// var VINAH_Ref = (document.UpdateForm.deptcode.value.substr(10,1));
// if ((VINAH_Ref == "T") && 
//      document.UpdateForm.alref083.value!="1") {
//   if (isWhitespace(document.UpdateForm.d_alref164.value)) {
//    alert("The advanced care plan documented date is a mandatory field " +
//          "prior to closing this referral\n"  +
//          "Please update via the update referral page");
//    document.UpdateForm.okbutton.disabled = true;
//    }
//    AssessCount = "%ALLWEB02.02.237"
//    if (parseInt(AssessCount,10) < 2) {
//       alert("Two assessments are a mandatory " +
//             "prior to closing this referral\n"  +
//             "Please add via the assessment page");
//       document.UpdateForm.okbutton.disabled = true;
//    }
// }
// if ((VINAH_Ref == "T" || VINAH_Ref == "H" || VINAH_Ref == "S") &&
//     document.UpdateForm.alref083.value!="1") {
//   mainHealthRecord = "%ALLWEB02.02.808";
//   if (mainHealthRecord != 1) {
//      alert("The main health condition is mandatory " +
//            "prior to closing this referral\n"  +
//            "Please add via the update referral page");
//      document.UpdateForm.okbutton.disabled = true;
//   }
// }
// if (VINAH_Ref == "P" && document.UpdateForm.alref083.value!="1" &&
//     isWhitespace(document.UpdateForm.d_alref049.value)) {
//     alert("The death place is mandatory " +
//           "prior to closing this referral\n"  +
//           "Please add via the update referral page");
//     document.UpdateForm.okbutton.disabled = true;
// }
// if ((VINAH_Ref == "S"  || VINAH_Ref == "H" || VINAH_Ref == "O"
//     || VINAH_Ref == "P" || VINAH_Ref == "R" || VINAH_Ref == "A") &&
//      document.UpdateForm.alref083.value!="1" ) {
//   referralDestination = "%ALLWEB02.02.813"
//   if (referralDestination != 1) {
//      alert("Warning no referral out details have been " +
//            "captured for this referral");
//   }
// }
// if (VINAH_Ref == "O" && document.UpdateForm.alref083.value=="1" ) {
//   if (isWhitespace(document.UpdateForm.d_alref094.value)) {
//        alert("The Referral In Clinical Referral Date is a mandatory " +
//              "field prior to closing this referral\n"  +
//              "Please update via the update referral page");
//        document.UpdateForm.okbutton.disabled = true;
//     }
// }
//  if ((VINAH_Ref == "O") && document.UpdateForm.alref083.value!="1" ) {
//    if(document.UpdateForm.fapbookd.value==""||
//       document.UpdateForm.fapnotfd.value==""){
//      if(!(Status=="Waiting   " && document.UpdateForm.linkedop.value=="0" &&
//         document.UpdateForm.encountr.value!="1")) {
//        alert("The First Appointment Booked and Notified of First \n" +
//              "Appointment is mandatory prior to closing this referral. \n" +
//              "Please add via the update referral page");
//        document.UpdateForm.okbutton.disabled = true;
//      }
//    }
//  }
//  if (VINAH_Ref == "T" && document.UpdateForm.alref083.value!="1" &&
//      REFERRALTRANSITIONDATES == 0) {
//     alert("The Transition Date is mandatory prior"+
//           " to closing this referral. Please add "+
//           "via the update referral page");
//     document.UpdateForm.okbutton.disabled = true;
//  }
//  if (VINAH_Ref == "T" && document.UpdateForm.alref083.value!="0" &&
//     document.UpdateForm.firstenc.value == "1") {
//     if (isWhitespace(document.UpdateForm.d_alref078.value)) {
//        alert("The Accommodation Type is a mandatory field prior to closing" +
//              " this referral\n"  +
//              "Please update via the update referral page");
//        document.UpdateForm.okbutton.disabled = true;
//     }
//     if (isWhitespace(document.UpdateForm.d_alref132.value)) {
//        alert("The Date of Referral Receipt Acknowledgement is a mandatory " +
//              "field prior to closing this referral\n"  +
//              "Please update via the update referral page");
//        document.UpdateForm.okbutton.disabled = true;
//     }
//  }


 // Do not add 'var' to the 2 variables below as they need to stay global.
  VINAH_Ref = (document.UpdateForm.deptcode.value.substr(10,1));
  CloseMaster = "%ALLWEB02.02.520";

  if(CloseMaster=="1") {
//    if(!isWhitespace(VINAH_Ref)) {
//      alert("Warning: This is the last linked episode referral.\n" +
//            "Please close the Program Referral.");
//    } else {
      alert("Warning: This is the last linked internal referral.\n" +
            "Please close the master referral.");
//    }
  }
}
</script>
