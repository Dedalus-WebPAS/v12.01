Content-Type: text/html
Cache-Control: no-cache

<!DOCTYPE html>
<head>
<title>Reschedule Appointment</title>
<meta name="TemplateVersion" content="V12.01.00">
<meta name="TemplateHome"    content="mobile">
<meta name="TemplateFile"    content="outweb0203035.html">
<meta name="HelpFileName"    content="NoContextSet.html">
<script type="text/javascript" src="../html/ipad/ipad.js"> </script>
<script type="text/javascript" src="../html/ipad/ipadform.js"> </script>
<script type="text/javascript" src="../html/ipad/AutoSuggestionPopup/AutoSuggestionPopup.class.js"></script>
<script type="text/javascript" src="../js/OutpatientSelect.js"></script>
<script type="text/javascript" src="../js/OutpatientTypeClinic.js"></script>
<link   rel="stylesheet" href="../html/ipad/ipad.css" type="text/css">
<link   rel="stylesheet" href="../html/ipad/AutoSuggestionPopup/AutoSuggestionPopup.css" type="text/css">
<script type="text/javascript">
var SearchJSON = new Object();
//
// Prompt confirmation question if this booking if part of a series
//
function SubmitForm() {
  if (isWhitespace(document.UpdateForm.newslotk.value)) {
     alertify.alert("Please Select a new Appointment.");
     return;;
  }
// Check for Same Day Appointments
  var serverURL = "../cgi-bin/outweb02.pbl?reportno=9&updatety=5" +
                  "&newslotk="+document.UpdateForm.newslotk.value.replace(/ /g,"+") +
                  "&urnumber="+document.UpdateForm.urnumber.value.replace(/ /g,"+") +
                  "&admissno="+document.UpdateForm.admissno.value.replace(/ /g,"+")
  var returnValue = RSExecute(serverURL);
  if (returnValue.status!=0) { return; }
  p=document.UpdateForm
  p.valddate.value=p.clindate.value.substr(4,12);
  p.datefrom.value.value="";
  p.dateto.value.value="";
// Check for Suspension in care for patient
  serverURL   = "../cgi-bin/comweb80.pbl?reportno=17" +
                    "&valdcode=" + p.urnumber.value.replace(/ /g,"+") +
                    "&valddate=" + p.valddate.value.replace(/ /g,"+")
  var returnValue = RSExecute(serverURL);
  if (returnValue.status==0) {
    ReturnValue=returnValue.return_value.split("|")
    p.datefrom.value=trim(ReturnValue[0])
    if (ReturnValue[1]) p.dateto.value=trim(ReturnValue[1])
  }
  if (p.datefrom.value!="0"){
    confirmMsg="Warning : Patient has a Suspension record for period " +
               + p.datefrom.value  + " - " + p.dateto.value+
               " <br>Click Ok to continue?";
    alertify.confirm(confirmMsg, function (e) {    
      if (!e) { return; } } );
  } 
// Check for Series Bookings
  if(document.UpdateForm.isseries.value=="1") {
    confirmMsg="Warning : This booking is part of a series. <br>Click Ok to continue?";
    alertify.confirm(confirmMsg, function (e) {    
      if (!e) { return; } } );
  }
// Check for Series Bookings
  if (validateMandatory(document.UpdateForm)) {
    UpdateForm.submit() 
  } 
}
function setButtons() {
  if (document.UpdateForm.outrshaf.value > 5) {
    alertify.alert("Patient has been Rescheduled > 5 times");
  }
  document.UpdateForm.redirect.value="outweb02.pbl?reportno=3&template=43" +
                                     "&urnumber=" + PatientLinks.urnumber.value.replace(/ /g,"+")
  ShowAppointments();
  var actionBtn = parent.document.getElementById('actionButton');
  if(actionBtn) {
    actionBtn.className = actionBtn.className.replace(/SpanButton/g,"");
    actionBtn.className = actionBtn.className.replace(/Blue/g,"");
    actionBtn.className = actionBtn.className + " SpanButtonBlue";
    actionBtn.innerText = "Save";
    actionBtn.onclick = function() { SubmitForm() }
  }
  theForm=document.UpdateForm
  for (i=0; i<theForm.elements.length; i++) {
    el=theForm.elements[i]
    if (el.type=="text")  el.value=trim(el.value);
    if (el.type=="textarea"){
      el.value=el.value.replace(/ *$/gm,'');
      el.value=el.value.replace(/^(\r\n)|(\n)$/gm,'');
    }
  }
}
function SetPrinter(SelectList) {
  if (SelectList.className=="Mandatory SelectBig") {
     SelectList.className="SelectBig" 
  } else {
     SelectList.className="Mandatory SelectBig" 
  }
}
//--------------------------------------------------
// Search for Appointment
//--------------------------------------------------
function ShowAppointments() {
  SearchJSON = new Object();
  var ListLocation = document.getElementById("SearchResults");
  el = document.getElementById("startnum");
  var startnum=el.value.replace(/ /g,"+");
  el = document.getElementById("clinicty");
  var clinicty=el.value.replace(/ /g,"+");
  el = document.getElementById("clinicid");
  var clinicid=el.value.replace(/ /g,"+");
  el = document.getElementById("visittyp");
  var visittyp=el.options[el.selectedIndex].value.replace(/ /g,"+");
  el = document.getElementById("srchtime");
  var srchtime=el.options[el.selectedIndex].value.replace(/ /g,"+");
  el = document.getElementById("srchperd");
  var srchperd=el.options[el.selectedIndex].value.replace(/ /g,"+");
  el = document.getElementById("srchdate");
  var srchdate="";
  if (el.selectedIndex>0) srchdate=el.options[el.selectedIndex].value.replace(/ /g,"+");
  var SelectOptionStartDate=new Date();
  var FirstAppointment=""
  top.setCookie("outweb0203035-srchperd",srchperd.replace(/\+/g," "));
  var url   = "outweb01.pbl?reportno=2&template=5&norecord=20&srchflag=1"+
              "&startnum="+ startnum +
              "&clinicid="+ clinicid +
              "&clinicty="+ clinicty +
              "&srchperd="+ srchperd +
              "&srchdate="+ srchdate +
              "&visittyp="+ visittyp +
              "&srchtime="+ srchtime ;
  var xmlHttp = createHttpObject();
  xmlHttp.open('GET',url,true);
  xmlHttp.send();
  xmlHttp.onreadystatechange = function() {
    if (xmlHttp.readyState == 4) {
      if (xmlHttp.status == 200) {
        //alert(xmlHttp.responseText); //convert text to javascript object
        SearchJSON = eval("("+xmlHttp.responseText+")"); //convert text to javascript object
        if (SearchJSON.length==0) {
          ListLocation.innerHTML = "<ul class='sectionList'>"+
                                   "<li class='sectionItem' style='text-align:center'>"+
                                   "No Available Appointments Found</li></ul>";
          return;
        }
        var OS2="<ul class='sectionList'> ";
        for(var i =0; i < SearchJSON.length; i++) {
          if (FirstAppointment=="") FirstAppointment=SearchJSON[i].code;
          OS2 += "<li class=sectionItem onclick=\"AddAppointment("+i+");\" />"+ SearchJSON[i].value +
                 "<br /><span class=subText>"+SearchJSON[i].clinic + 
                                      " - " + SearchJSON[i].type +
                                      " - " + SearchJSON[i].visit + 
                 "</span></li>";
        }
        ListLocation = document.getElementById("SearchResults");
        ListLocation.innerHTML = OS2+"</ul>";
      } else {
        alertify.alert("Web Service Call Failed Error : "+xmlHttp.status);
      }
    }
    if (FirstAppointment!="") {
      var setDay=FirstAppointment.substr(18,2);
      var setMonth=parseInt(FirstAppointment.substr(16,2),10)-1;
      var setYear=FirstAppointment.substr(12,4);
      SelectOptionStartDate = new Date(setYear,setMonth,setDay,0,0,0);       // midnight
    }
    el = document.getElementById("srchdate");
    el.options.length=1;
    dateSelectionList(el,SelectOptionStartDate,"84")
  }
}
//--------------------------------------------------
// Reserve Slot and Set Form
//--------------------------------------------------
function AddAppointment(objectNo) {
  var casekeys=document.UpdateForm.newslotk.value
  if (!isWhitespace(casekeys)) {
    var serverURL = "../cgi-bin/outweb02.pbl?reportno=9&updatety=2" +
                    "&casekeys="+casekeys.replace(/ /g,"+") 
    var returnValue = RSExecute(serverURL);
    if (returnValue.status!=0) {
      alertify.alert("Cancel Slot Reservation Failed");
      return;
    }
  }
  var serverURL = "../cgi-bin/outweb02.pbl?reportno=9&updatety=1" +
                  "&casekeys="+SearchJSON[objectNo].code.replace(/ /g,"+");
  var returnValue = RSExecute(serverURL);
  if (returnValue.status==0) {
    document.UpdateForm.newslotk.value=SearchJSON[objectNo].code;
    document.UpdateForm.clindesc.value=SearchJSON[objectNo].clinic;
    document.UpdateForm.clindate.value=SearchJSON[objectNo].value;
    document.UpdateForm.defclnty.value=SearchJSON[objectNo].typecode;
    document.UpdateForm.othendps.value=SearchJSON[objectNo].othendps;
    el=document.UpdateForm.outbb047;
    var visittyp=SearchJSON[objectNo].type;
    for (var i=0;i<el.options.length;i++) {
      if (visittyp.substr(0,3)==el.options[i].value.substr(0,3)) { el.selectedIndex=i; }
    }
  }
}
function SendLetter03(theForm) {
  var visitcode=theForm.outbb047.options[theForm.outbb047.selectedIndex].value;
  if(visitcode.substr(10,1) == "C" ||
    (SetDateYYYYMMDD(theForm.clindate.value.substr(4,11)) <
     SetDateYYYYMMDD(theForm.currdate.value))) {   // Ind 8 - Chart Only or
    theForm.outbb067.selectedIndex=3;              // new booking less than
    theForm.outbb067.className="Readonly";         // today set send letter
    theForm.outbb067.disabled=true;                // N/A
  } else {
    if(theForm.outbb067.disabled==true) {          // Defalut send letter to
       theForm.outbb067.selectedIndex=0;           // Blank when re enabled
    }   
    theForm.outbb067.className="";
    theForm.outbb067.disabled=false;
  }
  SendLetterDate03(theForm);
}
function SendLetterDate03(theForm) {
  if(theForm.outbb067.value=="1") {                // Yes Send Letter
    theForm.outbb066.className="Mandatory FutureDate";
    theForm.outbb066.readOnly=false;
    if(isWhitespace(theForm.outbb066.value)) {     // Calculate Letter Date
      CalculateLetterDate03(theForm)
    }
  } else {
    theForm.outbb066.className="Readonly Date";
    theForm.outbb066.value="";
    theForm.outbb066.readOnly=true;
  }
}
function CalculateLetterDate03(theForm) {
  theForm.outbb066.value=theForm.clindate.value.substr(4,11);
  if(isWhitespace(theForm.clindate.value.substr(4,11))) {
    return;
  }
  AddSubtractDate(theForm.outbb066,theForm.othendps.value,"S");
  if(SetDateYYYYMMDD(theForm.outbb066.value) <=
     SetDateYYYYMMDD(theForm.currdate.value)) {
     theForm.outbb066.value=theForm.currdate.value;
  }
}
function dateSelectionList(el,StartDate,noDays) {
  var theDay;
  var weekday=new Array(7);
  weekday[0]="Sun";
  weekday[1]="Mon";
  weekday[2]="Tue";
  weekday[3]="Wed";
  weekday[4]="Thu";
  weekday[5]="Fri";
  weekday[6]="Sat";
  for (var i=0;i<noDays;i++) {
     theDay = new Date(StartDate.getTime()+(i*24*60*60*1000));
     dayVal = "0"+theDay.getDate();
     mthVal = "0"+(theDay.getMonth()+1);
     dayVal=dayVal.substr(dayVal.length-2,2);
     mthVal=mth3Name(mthVal.substr(mthVal.length-2,2));
     dateVal = dayVal+' ' + mthVal + ' ' +  theDay.getFullYear();
     dateName=weekday[theDay.getDay()] + ' ' + dateVal;
     el.options[el.options.length]=new Option(dateName,dateVal);
  }
}
</script>
%START.OF.PAGE
<meta name="ServerID"        content="%STANDARD.01.004">
<meta name="ServerName"      content="%STANDARD.01.005">
<meta name="ServerVersion"   content="%STANDARD.01.006">
<meta name="ServerOption"    content="%STANDARD.01.002">
<meta name="ServerTemplate"  content="%STANDARD.01.003">
<meta name="TemplateFile"    content="outweb0203034.html">
<meta name="TemplateVersion" content="V12.01.00">
<meta name="TemplateHome"    content="mobile">
</head>
<body onload="setButtons();">
<ul class=sectionList>
  <li class=sectionItem>
  <div style='text-align:center;font-family:Arial;'>
  %OUTWEB02.03.002
  (%OUTWEB02.03.019,  %OUTWEB02.03.020,  %OUTWEB02.03.021, %OUTWEB02.03.003) <br />
  </div>
  </li>
</ul>
<form action=outweb02.pbl method=post name=UpdateForm>
<input type=hidden name=reportno value="4">
<input type=hidden name=nextpage value="1">
<input type=hidden name=redirect value="">
<input type=hidden name=updatety value="5">
<input type=hidden name=urnumber value="%OUTWEB02.03.003">
<input type=hidden name=admissno value="%OUTWEB02.03.081">
<input type=hidden name=casekeys value="%OUTWEB02.03.366">
<input type=hidden name=defclnty value="%OUTWEB02.03.308">
<input type=hidden name=defclnid value="%OUTWEB02.03.303.0">
<input type=hidden name=defvisty value="%OUTWEB02.03.310.1">
<input type=hidden name=defvflag value="1">
<input type=hidden name=rsinntfg value="1">
<input type=hidden name=valddate>
<input type=hidden name=datefrom>
<input type=hidden name=dateto>
<input type=hidden name=isseries value="%OUTWEB02.03.618.0">
<input type=hidden name=refrwarn value="%OUTWEB02.03.630">
<input type=hidden name=refrexpr value="%OUTWEB02.03.631">
<input type=hidden name=refrdate value="%OUTWEB02.03.632">
<input type=hidden name=othendps value="%OUTWEB02.03.658">
<input type=hidden name=currdate value="%STANDARD.01.015">
<input type=hidden name=slotbtyp value="4">
<input type=hidden name=alrevisn value="%OUTWEB02.03.646">
<input type=hidden name=deftovrd value="">

<table border="0" cellspacing=0 cellpadding=1 width=100%>
<tr valign=top>
<td>
<ul class=sectionList>
  <li class=sectionItem>
  <span class="labelText">Clinic</span>
  <span class="sectionText">
    <input type=hidden name=newslotk value="">
    <input type=text size=40 readonly name=clindesc title="Clinic" class=Mandatory 
     value="%OUTWEB02.03.303.1"> 
  </span></li>

  <li class=sectionItem>
  <span class="labelText">Date</span>
  <span class="sectionText">
    <input type=text size=40 readonly name=clindate class=Mandatory 
     title="Appointment" value="%OUTWEB02.03.304 at %OUTWEB02.03.305">
  </span></li>

  <li class=sectionItem>
  <span class="labelText">Visit Type</span>
  <span class="sectionText">
    <select style='width:250px;' name=outbb047 title="Visit Type" class="SelectBig Mandatory"
     onchange="SendLetter03(document.UpdateForm);" >
    <option></option>
    %OUTWEB02.03.329   
    </select>
  </span></li>

  <li class=sectionItem>
  <span class="labelText">Reason for Reschedule </span>
  <span class="sectionText">
    <select style='width:250px;' name=outbb014 title="Reason for Reschedule"
    class="SelectBig Mandatory">
    <option></option>
    %OUTWEB02.03.333.2
   </select>
  </span></li>

  <li class=sectionItem>
  <span class="labelText">Rescheduled </span>
  <span class="sectionText">
    <input type=text class=DataField name=outrshaf readonly size=3 
        value="%OUTWEB02.03.602">Times
  </span></li>

  <li class=sectionItem>
  <span class="labelText">Source of Referral</span>
  <span class="sectionText">
    <select  style='width:250px;' name=outbb001 class="Mandatory SelectBig"
     title="Source of Referral">
    <option></option>
    %OUTWEB02.03.320.2
    </select>
  </span></li>

  <li class=sectionItem>
  <span class="labelText">Unit</span>
  <span class="sectionText">
    <select style='width:250px;' name=outbb022 class="SelectBig" title="Unit">
    <option></option>
    %OUTWEB02.03.341.2
    </select>
  </span></li>

  <li class=sectionItem>
  <span class="labelText">Special Arrangements</span>
  <span class="sectionText">
    <select style='width:250px;' name=outbb054 class=SelectBig>
    <option></option>
    %OUTWEB02.03.378.2
    </select>
  </span></li>

  <li class=sectionItem>
  <span class="labelText">Reset Confirmed Appointment</span>
  <span class="sectionText">
    <input type="checkbox" name="resetcap" value="1" checked
  </span></li>

  <li class=sectionItem>
  <span class="labelText">Print Reschedule Letter </span>
  <span class="sectionText">
    <input type=checkbox name=letprt06  value="1" checked onclick="SetPrinter(UpdateForm.letpsl06);">
  </span></li>

  <li class=sectionItem>
  <span class="labelText">Printer </span>
  <span class="sectionText">
    <select style='width:250px;' name=letpsl06 class="Mandatory SelectBig" title="Printer">
    <option></option>
    %STANDARD.01.001.OUTWEB03.02
    </select>
  </span></li>

  <li class=sectionItem>
  <span class="labelText">Send Letter </span>
  <span class="sectionText">
    <select name=outbb067 title="Send Letter" 
      onchange="SendLetterDate03(UpdateForm);">
    <option></option>
    <option value="0">No</option>
    <option value="1">Yes</option>
    <option value="2">N/A</option>
    </select>
  </span></li>

  <li class=sectionItem>
  <span class="labelText">Generate Letter date</span>
  <span class="sectionText">
    <input type=text name=outbb066 size=12 onblur="checkDate(this,'Date')" value=""
     class="Date" title="Generate Letter Date">
  </span></li>

  <li class=sectionItem>
  <span class="labelText">New Comments</span>
  <span class="sectionText">
    <textarea name=newcmmnt wrap=hard cols=40 rows=3></textarea>
  </span></li>

  <li class=sectionItem>
  <span class="labelText">Comments</span>
  <span class="sectionText">
  <textarea name=outptcoa wrap=hard  class=Readonly readonly
   rows=4 cols=40>%OUTWEB02.03.327.016.005</textarea>
  </span></li>
</ul>

</form>

</td>
</ul>
  </td>
<form name=SelectPeriod>
<input type=hidden name=defclnty value="%OUTWEB02.03.308" id=clinicty>
<input type=hidden name=defclnid value="%OUTWEB02.03.303.0" id=clinicid>
<input type=hidden name=defvisty value="%OUTWEB02.03.310.1">
  <td width=35%>
  <ul id=SearchAppointment class=sectionList>
    <li class='sectionItem' style='text-align:center'>
    <b >Appointment Search</b><br>
    <select name=visittyp style='width:250px;margin-bottom:10px;'
     onchange='ShowAppointments()' id=visittyp title='Visit Type'>
    <option value="">Select Visit Type</option>
    %OUTWEB02.03.329
    </select>
    <select name=srchperd style='width:250px;margin-bottom:10px;'
     onchange='ShowAppointments()' id=srchperd title='Next Appoinment'>
     <option value="   ">After Today</option>
     <option value="01D">Tomorrow</option>
     <option value="02D">After 2 days</option>
     <option value="03D">After 3 days</option>
     <option value="04D">After 4 days</option>
     <option value="05D">After 5 days</option>
     <option value="06D">After 6 days</option>
     <option value="01W">After 1 week</option>
     <option value="02W">After 2 weeks</option>
     <option value="03W">After 3 weeks</option>
     <option value="04W">After 4 weeks</option>
     <option value="05W">After 5 weeks</option>
     <option value="06W">After 6 weeks</option>
     <option value="07W">After 7 weeks</option>
     <option value="08W">After 8 weeks</option>
     <option value="01M">After 1 month</option>
     <option value="02M">After 2 months</option>
     <option value="03M">After 3 months</option>
     <option value="04M">After 4 months</option>
     <option value="05M">After 5 months</option>
     <option value="06M">After 6 months</option>
     <option value="07M">After 7 months</option>
     <option value="08M">After 8 months</option>
     <option value="09M">After 9 months</option>
     <option value="10M">After 10 months</option>
     <option value="11M">After 11 months</option>
     <option value="12M">After 12 months</option>
    </select>
    <select name=srchtime style='width:250px;margin-bottom:10px;'
     onchange='ShowAppointments()' id=srchtime title='Preferred Time'>
     <option value="00:0024:00">Any Time</option>
     <option value="07:0012:00">Morning</option>
     <option value="12:0018:00">Afternoon</option>
     <option value="18:0024:00">Evening</option>
     <option value="07:0010:00">7am to 10am</option>
     <option value="16:0020:00">4pm to 8pm</option>
     <option value="12:0014:00">Lunch Time</option>
    </select>
    <select name=srchdate style='width:250px;margin-bottom:10px;'
     onchange='ShowAppointments()' id=srchdate title='Available on or After'>
    <option value="">Appointments on or After</option>
    </select>
    </li>
  </ul>
  <div id=SearchResults></div>
  </td>
  </tr>
  </table>
<div id='-suggestion-panel-wrapper' style='display:none;'>
 <div id='-suggestion-panel-wrapper2' style='width:100%'>
  <ul id='-suggestion-table' style='width:100%'></ul>
 </div>
</div>

<input type=hidden name=usersite value="%STANDARD.01.023">
<input type=hidden name=startnum id=startnum value=0>
</form>
<form name=PatientLinks method=get>
<input type=hidden name=reportno value=1>
<input type=hidden name=template value=004>
<input type=hidden name=urnumber value="%OUTWEB02.03.003">
<input type=hidden name=admissno value="%OUTWEB02.03.081">
<input type=hidden name=MenuType value="%OUTWEB02.03.088">
<input type=hidden name=casekeys value="%OUTWEB02.03.366">
</form>
</body>
