Content-Type: text/html
Cache-Control: no-cache

<!DOCTYPE HTML>
<head>
<!--"TemplateVersion"  : "V12.01.00"
    "TemplateHome"     : "mobile"-->
<title>Clinic Slot List</title>
<script type="text/javascript" src="../html/ipad/ipad.js"> </script>
<link   rel="stylesheet"       href="../html/ipad/ipad.css" type="text/css">
<script type="text/javascript">
// Source Code:  ./ipad/outweb0202021.js
// Modification 
// Version         Date                         Responsible/Changes Made
//------------------------------------------------------------------------------
var SlotRecords;
var TodaysClinic=false;
function SortSlots(el) {
 SortOrderBy=el.options[el.selectedIndex].value;
 SlotRecords.rows.sort(StringSort);
 ShowSlotList();
}
function InitTable() {
  el=document.SelectPeriod.sesskeys;
  var sessdate=el.options[el.selectedIndex].value.substr(12,8);
  if (document.SelectPeriod.currdate.value==sessdate) {
      TodaysClinic=true;
  }
  SlotRecords = new Table("patient-list","patient-item");
  t=SlotRecords;
  SlotList();
  SortOrderBy=2;
  SlotRecords.rows.sort(StringSort);
  ShowSlotList();
  MaxRowNo=t.rows.length;
}
function LinkSlot(rowNo) {
  if (isWhitespace(SlotRecords.rows[rowNo][6])) {
    alertify.alert('Empty Slot.  No Patient Details Available.');
  } else {
    theURL = CGIPath+ "patweb98.pbl?reportno=1&template=187" +
                      "&urnumber="+SlotRecords.rows[rowNo][6].replace(/ /g,"+") +
                      "&admissno="+SlotRecords.rows[rowNo][7].replace(/ /g,"+");
    openMedicalRecord(theURL)
  }
}
function ShowSlotList() {
 var OS = "<ul class=sectionList>";
 for(var i = 0; i < SlotRecords.rows.length; i++) {
   SlotStatus="";
   strFolder="";
   SlotName=SlotRecords.rows[i][5];
   if (isWhitespace(SlotRecords.rows[i][6])) {
     nextAction="";
   } else {
     strFolder=FormatPatientIcon(SlotRecords.rows[i][32])
     SlotStatus=SlotRecords.rows[i][31];
     if (!isWhitespace(SlotStatus)) SlotStatus=" - "+SlotStatus;
     nextAction="<input type=button class=stdButton "+
                "onclick='Arrived(\""+i+"\");' value='Check In'>";
     if (!isWhitespace(SlotRecords.rows[i][15])) {
       SlotStatus=" - Arrived : "+ SlotRecords.rows[i][15];
       nextAction="<input type=button class=stdButton "+
                  "onclick='TimeSeen(\""+i+"\");' value='Time Seen'>";
     }
     if (!isWhitespace(SlotRecords.rows[i][14])) {
       SlotStatus=" - Seen : "+ SlotRecords.rows[i][14];
       nextAction="<input type=button class=stdButton "+
                  "onclick='Departure(\""+i+"\");' value='Departure'>";
     }
     if (!isWhitespace(SlotRecords.rows[i][16])) {
       SlotStatus=" - Departed : "+ SlotRecords.rows[i][16];
       nextAction="<span class=AppointmentDone></span>";
       if (isWhitespace(SlotRecords.rows[i][20])) {
         nextAction="<input type=button class=stdButton "+
                    "onclick='FollowUp(\""+i+"\");' value='Follow Up'>";
       }
     }
     if (SlotRecords.rows[i][33]=="DNA") {
       SlotStatus=" - "+SlotRecords.rows[i][33];
       nextAction="";
     }
   }
   if (!TodaysClinic) {
     nextAction="";
     OS += "<li class=sectionItem  onclick='LinkSlot(\""+i+"\");'><b>"
       if (isWhitespace(SlotRecords.rows[i][6])) {
         SlotName=SlotRecords.rows[i][35];
         if (isWhitespace(SlotName)) SlotName=SlotRecords.rows[i][4];
         OS+=SlotRecords.rows[i][1].substr(8,5)+"</b> " + SlotName + SlotStatus 
       } else {
         OS+=SlotRecords.rows[i][1].substr(8,5)+"</b> " + SlotName + SlotStatus +
             "<br><span class=ntTimeframe>Problem : "+ 
              SlotRecords.rows[i][22].replace(/<br.*/," ...") + "</span>" 
         if (!isWhitespace(SlotRecords.rows[i][15])) {
           OS+="<span class=ntWhen>Arr.: " + SlotRecords.rows[i][15] + "</span>" 
         }
         OS+="<br><span class=ntTimeframe>Type : "+ SlotRecords.rows[i][4] + "</span>" 
         if (!isWhitespace(SlotRecords.rows[i][14])) {
           OS+="<span class=ntWhen>Seen: " + SlotRecords.rows[i][14] + "</span>" 
         }
         OS+="<br><span class=ntTimeframe>Arrangements : "+ SlotRecords.rows[i][30] + "</span>" 
         if (!isWhitespace(SlotRecords.rows[i][16])) {
           OS+="    <span class=ntWhen>Dep.: " + SlotRecords.rows[i][16] + "</span>"
         }
       if (!isWhitespace(SlotRecords.rows[i][36].replace(/<br.*/,""))) {
         OS+="<br><span class=ntTimeframe>Comments : "+
             SlotRecords.rows[i][36].replace(/<br.*/," ...") + "</span>" 
       }
     }
     OS += "</li>";
   } else {
     OS += "<li class=sectionItem>"+
           "<span style='display:inline-block;width:80%' onclick='LinkSlot(\""+i+"\");'><b>" + 
           SlotRecords.rows[i][1].substr(8,5)+"</b> " + SlotName + SlotStatus 
     if (SlotRecords.rows[i][4]!=SlotName) {
       OS+="<br><span class=ntTimeframe>Type : "+
           SlotRecords.rows[i][4] + "</span>" 
     }
     if (!isWhitespace(SlotRecords.rows[i][22].replace(/<br.*/,""))) {
       OS+="<br><span class=ntTimeframe>Problem : "+
            SlotRecords.rows[i][22].replace(/<br.*/," ...") + "</span>" 
     }
     if (!isWhitespace(SlotRecords.rows[i][30])) {
       OS+="<br><span class=ntTimeframe>Arrangements : "
            +SlotRecords.rows[i][30] + "</span>" 
     }
     if (!isWhitespace(SlotRecords.rows[i][36].replace(/<br.*/,""))) {
       OS+="<br><span class=ntTimeframe>Comments : "+
           SlotRecords.rows[i][36].replace(/<br.*/," ...") + "</span>" 
     }
     OS += "</span><span style='display:inline;' class=ntWhen>"+nextAction+"</span>" +
           "</li>";
   }
 }
 if (SlotRecords.rows.length==0) {
   OS += "<li class=sectionItem style='text-align:center;'>" +
         "No clinics found in this period.</span>";
 }
 OS += "</ul>";
 el=document.getElementById("ListLocation");
 el.innerHTML=OS;
}
function FormatPatientIcon(Indicators) {
  ImageStr="<span class=PatientFolder"+ Indicators.substr(0,3) + "></span>"
  return ImageStr;
}
function ShowDetails() {
  el=document.getElementById("ClinicDetails");
  if (el.style.display=="none") {
    el.style.display="";
  } else {
    el.style.display="none";
  }
}
//------------------------------------------------------------------------
//             Function to Update Check-In,Time Seen
//------------------------------------------------------------------------
function Arrived(rowNo) {
  ReferralNo=t.rows[rowNo][45];
  ConfirmPMI=t.rows[rowNo][67];
  CollectingEnc=t.rows[rowNo][50];
  UsingCheckInPage=t.rows[rowNo][68];
  if (isWhitespace(ReferralNo) && CollectingEnc=="1") {
    alertify.alert("Note : No referral has been attached to this clinic appointment.", function() {
      if (ConfirmPMI == "1") {
        alertify.alert("Function not available. Confirm PMI date less than clinic date.");
        return;
      }
      var ur=SlotRecords.rows[rowNo][6];
      var ad=SlotRecords.rows[rowNo][7];
      var ck=SlotRecords.rows[rowNo][28];
      updateTimeSlot(ur,ad,3,ck);
    } );
  } else {
    var ur=SlotRecords.rows[rowNo][6];
    var ad=SlotRecords.rows[rowNo][7];
    var ck=SlotRecords.rows[rowNo][28];
    updateTimeSlot(ur,ad,3,ck);
  }
}
function TimeSeen(rowNo) {
  var ur=SlotRecords.rows[rowNo][6];
  var ad=SlotRecords.rows[rowNo][7];
  var ck=SlotRecords.rows[rowNo][28];
  linkurl=CGIPath+"outweb02.pbl?reportno=03&template=033" +
          "&urnumber="+ur.replace(/ /g,"+") +
          "&admissno="+ad.replace(/ /g,"+");
          "&casekeys="+ck.replace(/ /g,"+");
  openDocument(linkurl,"Update Attendance Details");
}
function Departure(rowNo) {
  var ur=SlotRecords.rows[rowNo][6];
  var ad=SlotRecords.rows[rowNo][7];
  var ck=SlotRecords.rows[rowNo][28];
  linkurl=CGIPath+"outweb02.pbl?reportno=03&template=033" +
          "&urnumber="+ur.replace(/ /g,"+") +
          "&admissno="+ad.replace(/ /g,"+");
          "&casekeys="+ck.replace(/ /g,"+");
  openDocument(linkurl,"Update Departure Details");
}
function FollowUp(rowNo) {
  var ur=SlotRecords.rows[rowNo][6];
  var ad=SlotRecords.rows[rowNo][7];
  var ck=SlotRecords.rows[rowNo][28];
  linkurl=CGIPath+"outweb02.pbl?reportno=03&template=034" +
          "&urnumber="+ur.replace(/ /g,"+") +
          "&admissno="+ad.replace(/ /g,"+");
          "&casekeys="+ck.replace(/ /g,"+");
  openDocument(linkurl,"Create Follow Up Appointment");
}
function updateTimeSlot(ur,ad,ut,ck) {
  var serverURL = "outweb02.pbl?reportno=9&urnumber="+ur+
                  "&admissno=" + ad + "&updttime="+ut+
                  "&updatety=3" + "&casekeys="+ck;
  serverURL=serverURL.replace(/ /g,"+")
  var returnValue = RSExecute(serverURL);
  if (returnValue.status==0) {
    document.location.reload();
  } else {
    alertify.alert("Update Failed Web Service Not Available. Please try again.");
  }
}
function ClinicList() {
  document.location.href=top.getCookie("returnClinicList");
}
</script>
</head>
%START.OF.PAGE
<body onload="InitTable();">
<div class=subMenu>
<form name=SelectPeriod action=outweb02.pbl method=get>
<input type=hidden name=reportno value=2>
<input type=hidden name=template value=21>
<input type=hidden name=currdate value="%STANDARD.01.013">
<input type=hidden name=contview value="%OUTWEB02.02.057">
<input type=hidden name=tablview value="%OUTWEB02.02.044">
<span class=SpanButton onclick='ClinicList();'>Clinic List</span>
<span class=SpanButton onclick='ShowDetails()'>Clinic Details</span>
<select name=sesskeys onchange='document.SelectPeriod.submit();' 
 class=selectMenu title='Clinic Date'>
%OUTWEB02.02.003
</select>
<span class=MenuLogo></span>
</form>
</div>
<div class=sectionDiv>
<ul class=sectionList>
<li class=sectionItem style='text-align:center'>
  <span class=subheading>%OUTWEB02.02.014</span>
</li>
</ul>
<ul class=sectionList id=ClinicDetails style="display:none;">
<li class=sectionItem>
  <span class=labelText>Clinic Type</span>
  <span class=sectionText>%OUTWEB02.02.027.0</span>
</li>
<li class=sectionItem>
  <span class=labelText>Location</span>
  <span class=sectionText>%OUTWEB02.02.029.0</span>
</li>
<li class=sectionItem>
  <span class=labelText>Session Status</span>
  <span class=sectionText>%OUTWEB02.02.020.0</span>
</li>
<li class=sectionItem>
  <span class=labelText>Comments   </span>
  <span class=sectionText>%OUTWEB02.02.026</span>
</li>
<li class=sectionItem>
  <span class=labelText>Instructions</span>
  <span class=sectionText>%OUTWEB02.02.028
                      <br><b>%OUTWEB02.02.021
                      <br>%OUTWEB02.02.022</b></span>
</li>
</ul>

<div id=ListLocation></div>
</div>
<script type="text/javascript">
function SlotList() {
%OUTWEB02.02.009.outweb02.03.001
}
</script>
</body>
