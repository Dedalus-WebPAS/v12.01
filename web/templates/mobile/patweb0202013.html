Content-Type: text/html
Cache-Control: no-cache

%START.OF.PAGE
<!DOCTYPE HTML>
<head>
<!--"TemplateVersion"  : "V12.01.00"
    "TemplateHome"     : "mobile"-->
<title>Favourite Patient List</title>
<script type="text/javascript" src="../html/ipad/ipad.js"></script>
<link   rel="stylesheet"       href="../html/ipad/ipad.css" type="text/css">
<script type="text/javascript" src="https://maps.googleapis.com/maps/api/js?v=3&key=%STANDARD.01.044.124.161.050"></script>
<script type="text/javascript" src="../js/GoogleLibrary.js"> </script>
<style  type=text/css>
.InformationIcon {
  background: url("../images/AlertSprite.png") -0px -140px no-repeat;
  width:20px;
  height:20px;
}
</style>
<script type="text/javascript">
function InitTable() {
  el=document.DisplayForm;
  webpd002=el.webpd002.options[el.webpd002.selectedIndex].value;
  if (isWhitespace(webpd002)) {
    var d = new Date();
    var n = d.getDay(); 
    var DefaultList="HV"+n;
    for (i=0;i<el.webpd002.options.length;i++) {
      if (el.webpd002.options[i].value==DefaultList) el.webpd002.selectedIndex=i;
    }
  }
  el=document.getElementById("MapLocation");
  el.innerHTML="<span style='font-size:12px;background-color:#111;color:eee;"+
               "border:1px solid grey;position:absolute;"+
               "text-align:center;height:50px;width:300px;"+
               "margin-left:200px;margin-top:100px;padding:50px;'>"+
               "<img src='../images/loading.gif'><br><br>Geo Coding in Progress<br>Please Wait</span>";
  setTimeout(function(){ DisplayTable(); }, 100);
}
function DisplayTable() {
 t = new Table();    // Create New Table Object
 el=document.DisplayForm;
 if (el.webpd002.options.length<=0) {
   alertify.alert("You currently have no patient lists.<br>Please create your list before using this facility.");
   el=document.getElementById("MapLocation");
   el.innerHTML="";
   return;
 }
 webpd002=el.webpd002.options[el.webpd002.selectedIndex].value;
 theURL="geocod01.php?reportno=2&webpd002="+webpd002
 var xmlHttp = createHttpObject();
 xmlHttp.open("GET", theURL, false);
 xmlHttp.send();
 if (xmlHttp.responseText!=""&&xmlHttp.status == 200) {
    h = document.getElementsByTagName("head")[0];
    s = document.createElement("script");
    s.type="text/javascript";
    h.appendChild(s);
    s.text=xmlHttp.responseText;
    AddRows();
    SortOrderBy=11;
    t.rows.sort(StringSort);
    ShowList();
    DisplayMap();
 } else {
   alertify.alert("No Patient Found");
   el=document.getElementById("MapLocation");
   el.innerHTML="";
 }
}
function StringSort(a,b) {
  if (a[SortOrderBy] < b[SortOrderBy] ) { x = -1 }
  if (a[SortOrderBy] == b[SortOrderBy] ) { x = 0  }
  if (a[SortOrderBy] > b[SortOrderBy] ) { x = 1  }
  return x ;
}
function SortPatients(el) {
  SortOrderBy=el.options[el.selectedIndex].value;
  t.rows.sort(StringSort);
  ShowList();
  DisplayMap();
}
function ShowList() {
 var OS = "<ul class=patient-list>";
 LinkFlag=false;
 for(var i = 0; i < t.rows.length; i++) {
   sAlpha=getMarkerColor(i);
   OS += "<li class=patient-item style='font-size:14px;' onclick='LinkPatient(\""+i+"\");'>" + 
         "<span style='padding:5px;display:inline-block;vertical-align:top'><img "+
         "src='https://maps.gstatic.com/mapfiles/marker"+sAlpha+".png'></span>"+
         "<span style='width:80%;padding:5px;display:inline-block;vertical-align:top'>"+t.rows[i][2] + 
         "<br>"+t.rows[i][3]  
   if (t.rows[i][6]=="1") {
      OS += "<span class=InformationIcon title='Partial Address Match\n"+t.rows[i][7]+"'></span>"
   }
   if (!isWhitespace(t.rows[i][8])) {
      OS += " ("+t.rows[i][8]+")"
   }
   if (!isWhitespace(t.rows[i][9])) OS += "<br>Status   : "+t.rows[i][9];
   if (!isWhitespace(t.rows[i][10])) OS += "<br>Comment  : "+t.rows[i][10];
   if (!isWhitespace(t.rows[i][11])) OS += "<br>" + t.rows[i][11];
   OS += "</span><li>"

 }
 if (t.rows.length==0) {
    OS+="<li style='text-align:center;color:darkred;'>"+
        "No Patients this List."+
        "</li>";
 }
 OS += "</ul>";
 document.getElementById("ListLocation").innerHTML=OS;
}
function FormatPatientIconSpan(Indicators) {
  ImageStr="<span class=PatientFolder"+ Indicators.substr(0,3) + "></span>"
  return ImageStr;
}
function LinkPatient(rowNo) {
  theURL = CGIPath+ "patweb98.pbl?reportno=1&template=187" +
                     "&urnumber="+t.rows[rowNo][0].replace(/ /g,"+") +
                     "&admissno="+t.rows[rowNo][1].replace(/ /g,"+");
  openMedicalRecord(theURL)
}
function EditList() {
  if (isWhitespace(DisplayForm.webpd002.value)) {
    alertify.alert("Select List Before Editing Details") 
  } else {
    LinkUrl="patweb02.pbl?reportno=1&template=1&webpd002="+
            document.DisplayForm.webpd002.value
    DFrameLink(LinkUrl,20,100,500,200)
  }
}
function AddPatient() {
  if (isWhitespace(DisplayForm.webpd002.value)) {
    alertify.alert("Select List Before Adding Patients") 
  } else {
    LinkUrl="patweb02.pbl?reportno=2&template=2&webpd002="+
            document.DisplayForm.webpd002.value
    DFrameLink(LinkUrl,20,60,700,420)
  }
}
function UpdateItem(listno,urno) {
  LinkUrl="patweb02.pbl?reportno=2&template=3&webpd002="+listno+"&webpt003="+urno
  DFrameLink(LinkUrl,20,120,500,220)
}
</script>
</head>
<body onload='InitTable();'>
<div class=subMenu>
<form name=DisplayForm action=patweb02.pbl method=get>
<input type=hidden name=reportno value=2>
<input type=hidden name=template value=13>
<input type=hidden name=updttype value=" ">
   <select name=webpd002 class=selectMenu style='max-width:220px;'
    title="Favourites List" id=webpd002
    onchange="document.DisplayForm.submit();">
   <option value="">View List</options>
   %PATWEB02.02.011
   </select>
  <select name=orderby onchange="SortPatients(this);" 
  title="Order By" class=selectMenu>
  <option value=11>Order By Time</option>
  <option value=2>Order By Name</option>
  </select>
   <span class=MenuLogo></span>
</form>
</div>
<table width=100% border=1 cellpadding=0 cellspacing=0 
 style='background-color:white;margin-top:41px;border:1px solid #ccc;'>
<tr valign=top><td width=30%><div id="ListLocation"></div></td>
    <td><div id=MapLocation style='width:100%;height:700px;'></div></td>
</table>
</body>
</html>
