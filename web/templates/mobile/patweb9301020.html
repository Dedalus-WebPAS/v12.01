Content-Type: text/html
Cache-Control: no-cache
%START.OF.PAGE

<!doctype html>
<head>
<!--"TemplateVersion"  : "V12.01.00"
    "TemplateHome"     : "mobile"-->
<title>Ward Patient List Community View</title>
<script type="text/javascript" src="https://maps.googleapis.com/maps/api/js?v=3&key=%STANDARD.01.044.124.161.050"></script>
<script type="text/javascript"  src="../html/ipad/ipad.js"> </script>
<script type="text/javascript"  src="../html/ipad/patweb9301020.js"> </script>
<link   rel="stylesheet"        href="../html/ipad/ipad.css" type="text/css">

<script type="text/javascript">
 var handleCreated = false;
 var listLocation = null;

 function displayLocationPanel(options) {
   switch(parseInt(options.value,10)) {
      case 10: 
            showUserDefinedPanel(true);
            makeListMovable(false);
            setUserDefined(false);
	    break;
      case 20:
	    setUsingStartLocation(true);
	    setRoundRobbin(false);
            makeListMovable(false);
            setUserDefined(false);
            break;
      case 30:
	    setUsingStartLocation(true);
	    setRoundRobbin(true);
            makeListMovable(false);
            setUserDefined(false);
            break;
      case 40:
	    setUsingStartLocation(false);
	    setRoundRobbin(false);
            makeListMovable(false);
            setUserDefined(false);
            break;
      case 50:
	    setUsingStartLocation(false);
	    setRoundRobbin(true);
            makeListMovable(false);
            setUserDefined(false);
            break;
      case 60:
	    setUsingStartLocation(false);
            showUserDefinedPanel(false);
	    setRoundRobbin(false);
            makeListMovable(true);
            setUserDefined(true);
            break;
      case 61:
	    setUsingStartLocation(true);
            showUserDefinedPanel(false);
	    setRoundRobbin(false);
            makeListMovable(true);
            setUserDefined(true);
            break;
	
      case 70:
	    setUsingStartLocation(false);
            showUserDefinedPanel(false);
	    setRoundRobbin(true);
            makeListMovable(true);
            setUserDefined(true);
            break;
      case 71:
	    setUsingStartLocation(true);
            showUserDefinedPanel(false);
	    setRoundRobbin(true);
            makeListMovable(true);
            setUserDefined(true);
            break;
      default:
            showUserDefinedPanel(false);
            showUserDefinedPanel(false);
            makeListMovable(false);
            setUserDefined(false);
            break;
   }
 }
 
 function setUserDefined(bool) {
   var userdefinedused = document.getElementById('userdefinedused');

   if(bool) {
   	userdefinedused.value = 1;    
   }else {
   	userdefinedused.value = 0;  
   }
 }

 function setUsingStartLocation(bool) {
    var startlocation = document.getElementById('startlocation');

    if(bool) {
       startlocation.value = 1;
    }else{
       startlocation.value = 0;
    }
 }

 function setRoundRobbin(bool) {
    var roundrobbin = document.getElementById('roundrobbin');

    if(bool) {
       roundrobbin.value = 1;
    }else{
       roundrobbin.value = 0;
    }

 }

 function showUserDefinedPanel(bool) {
    var userDefinedLocationPanel = document.getElementById('userDefinedLocationPanel');
    if(bool) {
      userDefinedLocationPanel.style.display = "";
    }else {
      userDefinedLocationPanel.style.display = "none";
    } 
 }

 function checkAddress() {
   var geocoder = null;
   var addressString = document.getElementById("userDefinedLocation");
   var validationLocation = document.getElementById("validationLocation");
   validationLocation.innerHTML = "";
   geocoder = new google.maps.Geocoder();
   geocoder.geocode({"address": addressString.value}, 
      function(results, status) {
        if (status == google.maps.GeocoderStatus.OK) {
          if (results.length <  5) {
             if(results.length == 1) {
                validationLocation.innerHTML =  "<input id='addressGroup' style='width:90%;border:none;'"+
                                                " readonly name='addressGroup' type='text' value='"
                                                +results[0].formatted_address+"' />";
             }else {
	       for( var i = 0; i < results.length; i++ ) {
                 validationLocation.innerHTML += "<input name='addressGroup' type='radio' value='"
                                                 +results[i].formatted_address+"' />"+
	                                          results[i].formatted_address+"<br />";
               }
             }

          }else {
             validationLocation.innerHTML = "need more information!";
          }
        }
      });
 }

function saveLocation() {
  var tmpAddress = document.getElementsByName('addressGroup');
  var addressToSave = "";
  if(tmpAddress.length > 1) {
    for(var i = 0; i < tmpAddress.length; i++) {
      if(tmpAddress[i].type == 'radio' && tmpAddress[i].checked) {
        addressToSave = tmpAddress[i].value;
      }
    }
  }else {
     addressToSave = tmpAddress[0].value;
  }

  //setCookie(c_name,value,expiredays)
  setCookie('savedStartingLocation',addressToSave);
}


function makeListMovable(bool) {
  if(listLocation == null) {
  listLocation = document.getElementById('ListLocation');
     while(listLocation.childNodes != null && listLocation.nodeName != "UL") {
          listLocation = listLocation.childNodes[0];
     }

     listLocation.id = "test-list";
  }
  
  if(bool) {
     var j = 0;
     if(handleCreated == false) {
      for(var i = 0; i < listLocation.childNodes.length; i++) {
        if(listLocation.childNodes[i].nodeName == "LI") {
           var dynamicSelect = document.createElement('select');
           dynamicSelect.id="orderSelect_"+i;
	   for(var j = 0; j <  listLocation.childNodes.length; j++) {
		dynamicSelect.options.add( new Option(j,j));
                if(i == j) {
                   selected = j;
                }   
           }

           dynamicSelect.selectedIndex = selected; 
           listLocation.childNodes[i].id = "list_"+j
           listLocation.childNodes[i].appendChild(dynamicSelect);
 
	   j++;
         }
      }
      handleCreated = true;
     }else {
      for(var i = 0; i < listLocation.childNodes.length; i++) {
        var tmp = document.getElementById('orderSelect_'+i);
        tmp.style.display = "";
	
      }
     }
   }else {
      for(var i = 0; i < listLocation.childNodes.length; i++) {
        var tmp = document.getElementById('orderSelect_'+i);
	if(typeof tmp != 'undefined' && tmp != null) {
          tmp.style.display = "none";
        }
      }
   }
}

function nullListLocation() {
  listLocation = null;
  handleCreated = false;
}

</script>
</head>
<body onload="InitTable();">
<div class=subMenu>
<form name=SelectWard action=patweb93.pbl method=get>
<input type=hidden name=reportno value="1">
<input type=hidden name=template value="20">
<input type=hidden id=startlocation name=startlocation value="">
<input type="hidden" id="roundrobbin" name="roundrobbin" value=""/>
<input type="hidden" id="userdefinedroute" name="userdefinedroute" value=""/>
<input type="hidden" id="userdefinedused" name="userdefinedused" value=""/>
  <select name=wardcode onchange="this.form.submit();" 
  title="Select Ward" class=selectMenu>
  %PATWEB93.01.001
  </select>
  <select name=orderby id=orderby onchange="nullListLocation();SortPatients(this);" 
  title="Order By" class=selectMenu>
  <option value=23>Order By Post Code</option>
  <option value=22>Order By Suburb</option>
  <option value=15>Order By Bed</option>
  <option value=18>Order by Name</option>
  <option value=16>Order by Unit</option>
  <option value=17>Order by Doctor</option>
  </select>
  <select  class="selectMenu" title="Task" id="locationSetting" onchange="displayLocationPanel(this);">
    <option value="10">Input start location</option>
    <option value="20">Start location / last location</option>
    <option value="30">Start location and back</option>
    <option value="40">Current location / last location</option>
    <option value="50">Current location and back</option>
    <option value="60">User defined Route Current location/ last location</option>
    <option value="61">User defined Route Start location / last location</option>
    <option value="70">User defined Route Current location and back</option>
    <option value="71">User defined Route Start location and back</option>
    <option selected="" selected>Route Options</option>
  </select>
  <span class=SpanButton onclick='ShowRoute();'>Show Route</span>
  <span class=MenuLogo></span>
</form>
</div>

<div id=ListLocation>
</div>

<div class="selectFavorite" style="display:none;width:600px;height:270px;" id="userDefinedLocationPanel">
  <div class="boxHeader">
    <span style="width:42px" class="LeftAlign SpanButtonRed" onclick="displayLocationPanel(999);">Exit</span>
    Starting Location
    <span style="width:42px" class="RightAlign SpanButtonBlue" onclick="saveLocation();displayLocationPanel(999);">Save</span>
  </div>
  <div class="boxContent" style="text-align:left;height:200px;"> 
    <label for="userDefinedLocation" style="color:#000;text-align:left;">Starting Location Address</label><br />
    <input type="text" id="userDefinedLocation" name="userDefinedLocation" size="50"/>
    <span class="SpanButtonBlue" style="width:42px;text-align:left;" onclick="checkAddress();" >Check</span>
    <div style="text-align:left;" id="validationLocation" name="validationLocation"></div>
  </div>
</div>

</body>
