.----------------------------------------------------------------------
. Program       : WEBSEC01
.
. Function      : Web Security Login Web Server
.
. Modifications  :
.----------------------------------------------------------------------
. V12.00.01 24/09/2025  Alina Bhari    TSK 0946088
.           Added Functionality to add login cookied in browser
.           - MAIN2600,COKIEFLG,WEBLOG30
. V11.05.04 02/05/2025  Ebon Clements  TSK 0959486
.           Removed read of websecaf from WSEC9600
. V11.05.03 22/04/2025  Bella Turco    TSK 0959486
.           Added tag WSEC9600 to return if userID has Alert Levels           
. V11.05.02 10/02/2025  Nikitha B      TSK 0945530
.           Added Cookie called IBAPasscode to GetCookieData for User Passcode
.           at WEBLOG11, WEBLOG20 and WEBLOG60.
. V11.05.01 31/01/2025  Nikitha B      TSK 0953087
.           Added a new tag for user's HCP Code(WBSEHCPC) at WSEC9500 
.           and cgi WBSEC065 for the same.
. V11.04.09 01/11/2024  J.Tan          TSK 0949725
.           Added tag for checking Report Group details records
. V11.04.08 04/10/2024  Nikitha B      TSK 0944502
.           Added new tags to apply red button at WSEC9100, WSEC9200,
.           WSEC9300 and WSEC9400 
. V11.04.07 24/09/2024  Ebon Clements  TSK 0942633
.           Added branch on exist after COPSEC00 call
. V11.04.06 15/08/2024  Peter Vela     TSK 0950535
.           Added FHIR API Practitioner/Longn-.......
. V11.04.05 08/08/2024  Ebon Clements  TSK 0942074
.           Modified password length
. V11.04.04 29/07/2024  Thanh T        TSK 0944001 
.           Added WSEC8800 to return user id tag 
. V11.04.03 08/07/2024  Ebon Clements  TSK 0948873 
.           Fixed display of blank user hospital id tag - WSEC3430
. V11.04.02 01/07/2024  Nikitha B      TSK 0948416 
.           Made changes to display temp variables and not file variable  
.           from WBTP1200 to WBTP1900 tags.
. V11.04.01 30/01/2024  Sunny          TSK 0911988
.           Added changes for Report Server selection list in RPTSEL00 
.           NXTPAG70 PREDIR00
. V11.03.05 12/10/2023  Jacob Jackson  TSK 0926282
.           Add flag to determine hospital vs patient MR Change Location
.           redirect
. V11.03.04 14/08/2023  Ebon Clements  Peter Vela TSK 0936480
.           Added 2 leading alpha character passcode generation - GNIX0000
. V11.03.03 27/07/2023  Thanh T.       TSK 0930950
.           Added WSEC8500 and WSEC8600 tags to return last login date and
.           time
. V11.03.02 15/12/2022  Jacob Jackson   TSK 0927674
.           Fix issue where 'Department' column data would not display properly
. V11.03.01 24/11/2022  PJ Le Febour    TSK 0927131
.           SHED0000 - switched position of column header
.           moving Active before Login URL
. V11.02.04 27/07/2022  Bella Turco     TSK 0921957
.           PRGTAB00 now uppercases the startkey so you can search 'websec01' 
.           & it will goto 'WEBSEC01' instead of displaying no records 
. V11.02.03 14/07/2022  Bella Turco     TSK 0921957
.           Added NOMORE00 - Display "No more records" at end of list
.           Added PTCNNRTD - Displays number of rows set by parameter value
. V11.02.02 08/06/2022  Alina Bhari    TSK 0919750
.           Exclude Email ID to be copied when copying an 
.           existing security ID from another
. V11.02.01 22/04/2022  Jacob Jackson  TSK 0917301
.           Fix issue where user copy selection checkbox selections do 
.           not carry over to the new user.
. V11.00.02 25/05.2020  Thanh T.       TSK 0871644
.           Changed SROWA010 to return login details 
. V11.00.01 06/04/2020  Ebon Clements  TSK 0889053
.           Fixed update user login name already on file test - UPDSEC00
. V10.15.02 31/01/2020  Thanh T.        TSK 0871644
.           Added User ID keyword Search. WSEC8200, WSEC8300 and
.           WSEC8400 
. V10.15.01 13/01/2020  Ebon Clements  TSK 0886841
.           Added call of HospitalFieldsAdd() and HospitalFieldsUpd() to
.           the user id hospital selection list -  WSEC3430
. V10.14.01 05/02/2019  Thanh T.       TSK 0862937
.           Changed SROWA000 to return the login name 
. V10.13.02 14/08/2018  Ebon Clements  TSK 0853101
.           Call clear CLWEBSEC at start of add user routine ADDSEC00
. V10.13.01 03/08/2018  Peter Vela     TSK 0861328
.           Modified COPSEC00 to move spaces to WBSELACD, WBSELACT
. V10.12.01 10.01.2018  Tracey Nguyen  TSK 0825792 
.           Modified WSEC3800 to read pmshcpaf if opcnurse=1
. V10.11.03 28.08.2017  B.G.Ackland    TSK 0835482 
.           FHIR Change Extension Naming
. V10.11.02 31/07/2017  Richa Phogat    TSK 0841729
.           Fixed issue with O/P site access security maintenance. Updated its
.           limit from 99 to 200
. V10.11.01 21.07.2017  Richa Phogat    TSK 0820753
.           Added EMSTACTV in LOCSIT00 to display warning message when inactive 
.           Site Code is selected 
. V10.10.04 10.05.2017  B.G.Ackland     TSK 0835481
.           Revised FHIR Extension to meet standard
. V10.10.03 28/04/2017  Thanh T.        TSK 0836969
.           Fixed issue with hospital access security maintenance.
.           It was limited to 99 hospitals can be entered and is now 
.           changed to 200 hospitals 
. V10.10.02 21/01/2017  B.G.Ackland     TSK 0835482 
.           FHIR Interface Changes
. V10.10.01 21/01/2017  B.G.Ackland     TSK 0835482 
.           FHIR Interface Changes
. V10.09.01 13/02/2017  Davin           TSK 0833029
.           Increased template/security id selection array to 250 (markedky)
. V10.08.04 14/09/2016  Peter McMullen  0826151
.           Stop expiry date default on add user if not internal
.           password management.
. V10.08.03 20/06/2016  Peter McMullen  0821135
.           Remove lower case update of wbselogn (if apache file
.           authentication)
. V10.08.02 20/04/2016  Ebon Clements    TSK 0321772
.           Changed WBSEC064 generic user CLRPAR00 to Z70 not zero
. V10.08.01 20/04/2016  Ebon Clements    TSK 0321772
.           Changed WBSEC064 generic user CLRPAR00 to Z70 not zero
. V10.07.02 10/12/2015  Ebon Clements    CAR 324671
.           Changed REPUNIQ to also use uppercase letters for passcodes
. V10.07.01 23.10.2015  B.G.Ackland      CAR 323085
.           Extend WEBTPLAF for Menu Generation Elements
.           27.10.2015  P Mc.  Fold loginame to lower case at capture
. V10.06.01 22/06/2015  Don Nguyen       CAR 312297
.           Modified SROWA000 to read Printer Department table (ibadptaf)
.           instead of 'ibacodef'.
.----------------------------------------------------------------------
. V10.05.10 23.02.2015  Peter McMullen   CAR 313250
.           Bypass PASS0000 routine for externaly manages passwords            
. V10.05.09 19.02.2015  Ebon Clements    CAR 312313
.           Fixed password reset in check for duplicate login name in UPDSEC00.
. V10.05.08 13.02.2015  Ebon Clements    CAR 312313
.           Fixed check for duplicate login name in UPDSEC00.
. V10.05.07 06.02.2015  Ebon Clements    CAR 310006
.           Fixed WEBHED00 branch on exit in user id maintenance - SECID850
. V10.05.06 21.01.2015  Ebon Clements    CAR 310006
.           Recompiled for IBAWEBCD - SECTEM00 user read
. V10.05.05 19.12.2014  B.G.Ackland  CAR 310348
.           Escape ! in username and password verification
. V10.05.04 08/12/2014  Ebon Clements CAR 294083
.           Fixed .0 displaying on screen when not multi hospital - WSEC3430
. V10.05.03 06/10/2014  Ebon Clements CAR 268970
.           Change to use OUTCLIFD index 1 instead of index 2
. V10.05.02 22/09/2014  Ebon Clements CAR 305030
.           Removed multi hospital tests from OP site security access.
.           SHCP0000, ASIT0000, CPSIT000,DLSIT000,WSEC7400 and LSIT0000
. V10.05.01 20/08/2014  Ania P        CAR 305135
.           Added extra <td> tags to WSEC7000 to fix alignment issue
.----------------------------------------------------------------------
. V10.04.03 31.03.2014  B.G.Ackland  CAR 299363
.           Replace META Tag Redirect with Javascript 
. V10.04.02 19/03/2014 J.Tan          CAR 279251
.           Added new field for Generic User ID
. V10.04.01 05/03/2014 Peter McMullen CAR 294083 
.           Added maintenance for long Login name WBSELOGN 
.----------------------------------------------------------------------
. V10.03.15 31/07/2013  Ebon Clements  CAR 286034
.           Open mltsitaf regardless of multi hospital
. V10.03.14 19/07/2013  Ebon Clements  CAR 288881
.           Removed multi hospital test from OP site selection list - WSEC7600
. V10.03.13 16/07/2013  Jill Parkinson CAR 287923
.           Added include of PATCONFD
. V10.03.12 26/06/2013  Peter McMullen CAR 286727
.           Escape characters "$" and "`" when calling password command 
. V10.03.11 17/06/2013  Ebon Clements  CAR 286034
.           Added REDIRECT tag to report 5
. V10.03.10 22/04/2013  Ania P         CAR 283794
.           Fixed I*C error. Ensure check for multihospital is done before 
.           reading MLTSITAF
. V10.03.09 07/03/2013  Peter McMullen CAR 271555
.           Change PASS0000 to allow long uids, password and meta chars 
. V10.03.08 05/09/2012  Patrick Adair  CAR 246166
.           Update Emergency Site Code selection list based on selected 
.           Hospital Id.
. V10.03.07 02/11/2012  Ania P         CAR 270328
.           Added functionality to allow users multiple O/P Site Access.
.           Created new table MLTSITAF to store multiple O/P site access.
.           This table will initially be populated by Fix-It FX270328.
.           Created ASIT0000, MLTACC00, CPSIT000, DLSIT000,
.                   SHCP0000, SCHD0000, LSIT0000.
.           New tags in: WSEC7400, WSEC7500, WSEC7600
. V10.03.06 05/09/2012  Patrick Adair  CAR 246166
.           Added IBAUserEMR, IBAUserOUT and IBAUserRFD cookies
. V10.03.05 04/09/2012  Davin          CAR 270329
.           Added emergency site tag for change hospital screen (locsit30)
.           Added printer dept tag for change hospital screen (dselh000)
.           Added new table to save user/hospital defaults from change hospital
.           screen (chnghosp/webhspaf).
. V10.03.04 17/07/2012  Ebon Clements  CAR 267603
.           Fixed (Removed) lock of websecaf in WEBLOG10
. V10.03.03 15/05/2012  Peter McMullen CAR 265294
.           blank pad WBSEC001 to prevent cascading comaprisons
. V10.03.02 03/02/2012  Peter McMullen CAR 259587 
.           Remove reference to redundant patyearf1 
. V10.03.01 03/02/2012  Ebon Clements  CAR 259564 
.           Recompiled for WEBSKIPR - Trap to fix I * D
. V10.02.13 12/10/2011  Ebon Clements  CAR 252985 
.           Fixed length of FILTHOSP - changed to DIM 3
. V10.02.12 10/10/2011  Ebon Clements  CAR 249640 
.           Fixed user id keyword search  - changed SECARRAY to dim 10
. V10.02.11 29/09/2011  Mike Laming    CAR 251218 
.           Added new Dept Table IBADPTaf and changed DSEL000 to use new table
. V10.02.10 24/08/2011  Ebon Clements  CAR 242014 
.           Added OP direct user to security maintenance
. V10.02.09 12/08/2011  Ebon Clements  CAR 243582 
.           Added recvflag cgi
. V10.02.08 10/08/2011  Peter McMullen CAR 2????? 
.           Do not check password expiry if passwrd management is external
. V10.02.07 27/07/2011  Ebon Clements  CAR 243582 
.           Added usual tracking location to web user id
. V10.02.06 29/06/2011  Peter McMullen CAR 240725 
.           Change ward seection list to sort by name, not code 
. V10.02.05 10/06/2011  Mike Laming    CAR 240724 
.           Changed Key for RSMRLOC1 to KEY7
. V10.02.04 23/05/2011  Mike Laming    CAR 240724 
.           Added WBSEHHOS MRT Home Hospital (WBSEC057) see WSEC3400 & WSEC6800
.           Changed 
. V10.02.03 06/05/2011  Ebon Clements  CAR 242693 
.           Fixed security ID GOTO button read - SECTAB10
. V10.02.02 03/05/2011  Davin          CAR 239543
.           Added category based security functionality for viewing and
.           adding alerts (ALERTS00/MVASEC00/ASLT0000)
. V10.02.01 07/04/2011  Jill Parkinson CAR 239574
.           Increased department to 6 characters     
. V10.01.05 01/03/2011  Peter McMullen CAR 238972
.           Allow for external password management 
. V10.01.04 05/01/2011  Ebon Clements  CAR 235514
.           Added mandward cgi and tag
. V10.01.03 04/01/2011  Mike Laming    CAR 235635
.           Changed "Last Access ..." to "Last Login Date/Time" & added logic
.           to update "websecaf" (taken from PATWEB80).
. V10.01.02 05/11/2010  Ebon Clements  CAR 233150 
.           Added report 15 - Template security maintenance
. V10.01.01 28/10/2010  Ebon Clements  CAR 233151 
.           Added web user id keyword search functionality
. V10.00.01 25/10/2010  Jill Parkinson CAR 230131 
.           Added wardflag
. V9.12.04  17/12/2009  Peter McMullen CAR 210130
.           Convert to newer Dr name format routine DOCNM000
. V9.12.03  23/10/2009  WeeLee Koo     CAR 208352
.           Changed WSEC2300 back to read CODSEL00
.           Created new tag to read CODITM00 (WSEC4700)
. V9.12.02  21/10/2009  Peter Vela     CAR 208352
.           Fixed Z70 validations for wbste variables
. V9.12.01  28/09/2009  WeeLee Koo     CAR 191284
.           Changed Allied Health Field to read CODITM00 (WSEC2300)
. V9.11.04  15/04/2009  Jill Habasque  CAR 145706
.           Added WBSEGPAC - GP Access          
. V9.11.03  18/03/2009  Ebon Clements  CAR 190945
.           Added Report 14 - Security groups
. V9.11.02  11/11/2008  Peter Vela     CAR 182889
.           Fixed Add, Update and Delete of Security Levels
. V9.11.01  23/09/2008  Ebon Clements  CAR 174044
.           Added bed board view number to user id maintenance
. V9.09.03  12/12/2007  Peter McMullen CAR 154185
.           Eliminate wrapping problem on setting new expiry date
. V9.09.02  20/07/2007  Jill Habasque CAR 145653
.           Added warnings if period date range or 1st day of year not set up
. V9.09.01  26/06/2007  Jill Habasque CAR 143707
.           Added checks for IBCNMHOS in CPHOS000 and DLHOS000   
. V9.08.04  21/02/2007  Peter Vela    CAR 127828
.           Fixed write to update date/time websecaf at UPDSEC16
. V9.08.03  21/02/2007  Peter Vela    CAR 127828
.           Fixed write to update date/time websecaf at PASS1100
. V9.08.02  31/01/2007  Peter Vela    CAR 127930
.           Recompled for MRTCONFD
. V9.08.01  28/09/2006  Jill Habasque CAR 119977
.           Added multi hospital access functionality
. V9.07.02  06/09/2006  Peter Vela    CAR 118223
.           Added functionality of User ID create and update fields in websecaf
. V9.07.01  11/07/2006  Peter Vela    CAR 105665
.           Added tag for Hospital (with default home location)
. V9.06.01  03/05/2006  Peter Vela    CAR 103347
.           Added mandatory Hospital ID tag
. V9.05.02  05/04/2006  Ebon Clements CAR 97709
.           Added IBAUserHosp cookie
. V9.05.01  09/03/2006  Ebon Clements CAR 78533
.           Mods for PATCODTM - Hospital specific category codes
. V9.05.B01 30/01/2006  Ebon Clements CAR 93186
.           Mods for REDIRECT length change. Recompiled for IBAWEBDF
. V9.04.08  25/08/2005  Ebon Clements    CAR 57209
.           Added WBSENURS - Nurse code
. V9.04.07  05/05/2005  Ebon Clements    CAR 61268
.           Added WBSEFDEP - free format user department
. V9.04.06  05/05/2005  Ebon Clements    CAR 61122
.           Added tag for security id outpatient clinic description
. V9.04.05  29/04/2005  Peter Vela       CAR 55214
.           Recompiled for MRTCONFD
. V9.04.04  08.08.2005  Davin        CAR 56683
.           Added tag for clinic location type (wbsec032/wbseltyp)
. V9.04.03  09.09.2004  Lina Vo      CAR 53211
.           Changed web security to use old GP Code and GP Practice Code Fields
.           but with the new size.
. V9.04.02  08.09.2004  Lina Vo      CAR 53211
.           Changed web security to use new GP Code and GP Practice Code Fields.
. V9.04.01  18.08.2004  Lina Vo      CAR 52746
.           Added Multi-hospital to Web User Security.                  
. V9.03.13  23.04.2004  Peter Vela   CAR 49202
.           Added condition not to display inactive home locations
. V9.03.12  26.03.2004 Peter Vela    CAR 13038
.           Recompiled for PATDOCCD - Doctor Name format Parameter
. V9.03.11  04.04.2004 Davin         CAR 34825
.           Added MRT Security Number (wbsec030/wbsemrts)
. V9.03.10  20.01.2004 Pat Dirito    CAR 44871
.           Added UpdateParent() to SECTAB00               
. V9.03.09  15.01.2004 Ebon Clements CAR 46743
.           Pack WBSEC028 with SP70 in WBSEC000
.           14/01/2003 Ebon Clements CAR 46743
.           Fixed WBSEC028 cgi update to WBSEFPCD
. V9.03.08  18/12/2003 Peter Vela    CAR 43134
.           Recompiled for MRTCONFD
. V9.03.06  27/11/2003 Jill Habasque CAR 43980
.           Removed rcpcshaf and added wbsecash                    
. V9.03.05  20.10.2003 Ebon Clements CAR 44461
.           Added new field WBSEFPCD finance passcode to websecaf
. V9.03.04  07.10.2003 Ebon Clements CAR 43980
.           Added user id to rcpcshaf cashier table
. V9.03.03  07.10.2003 Tracey Nguyen CAR 43980
.           Added Insert/Update to Cashier table (rcpcshaf) when cashier
.           user flag is changed during Security Id Maintenance (report 3) 
. V9.03.02  25.08.2003 Ebon Clements CAR 42813
.           Recompiled for EMRSITFD changes that were missing in V9 that        
.           had been made in 5.09 - EMSTDLOC
. V9.03.01  25.06.2003 Sylvek Litewka  CAR 38345
.           Added standard processing for a new filed - websecaf.WBSEDGSI
.           (Day / General Operation Room Surgery Indicator).
. ----------------------------------------------------------------------------
. V9.02.11  02.05.2003 Jill Habasque SRF 38508
.           Fixed copying of security levels
. V9.02.10  24.10.2002 B.G.Ackland SRF 22413
.           Added functionality for Swap User on Same Menu
. V9.02.09  30.09.2002 Peter Vela    SRF 22514
.           Added functionality for WBSEVWSL (View Alert Security Level) field
.           Added functionality for WBSEADSL (Add Alert Security Level) field
. V9.02.08  16.08.2002 Ebon Clements SRF 20552
.           Added startkey to NEXT0000 and PREV0000 for security id maintenance
. V9.02.07  29.04.2002 Pat Dirito  
.           Added WBSEOCG line in WEBLOG00. Defect No:3624
. V9.02.06  30.01.2002 B.G.Ackland
.           Expire Password on Copy Function
. V9.02.05  21.12.2001 B.G.Ackland
.           Check New Password Not the Same as Old
.           Added Password History File for last 5 passwords
. V9.02.04  07.12.2001 Ebon Clements 
.           Changed the reset password option to reset the password only 
.           not delete the user id and security levels
.           Changed age by days to be 3 characters not two
. V9.02.03  26.10.2001 Jill Habasque
.           Added Document Type (WBSEDTYP) and Home Location (WBSEHLOC)
. V9.02.02  24.10.2001 B.G.Ackland
.           Error Logging.
. V9.02.01  18.09.2001 Ebon Clements 
.           Removed passcode from add and update user id. Add automatic
.           allocation of passcode and update IHAPASFD with passcode and name
.           Web users will have passcodes from a000 to z999
. V9.00.B03 13.07.2001 Sandra Barcham
.           Replace GP with HCP
. V9.00.B02 05/07/2001 J.Tan
.           Added Allied Health Department code
. V9.00.B01 02.03.2001  Ebon Clements
.           Copy security id did not work
.----------------------------------------------------------------------
.                 V5.09.B02 07.02.2001  B.G.Ackland
.                           Fix Cache Control
.                 V5.08.05 07.11.2000  B.G.Ackland
.                          Check for Blank ID on Add
.                 V5.08.04 19/10/2000  K.C.Nelson
.                          Added password addition to Copy Facility
.                 V5.08.03 15/09/2000 Sandra Barcham & Jeni Tan
.                          Change age by days to 3 digits
.                          Read paramenter for default password not password
.                          Add new fields for websecaf
.                 V5.08.02 25/07/2000  Bronko Sosic
.                          Added option 9 -Report Template Master
.                          Added option 10-Report Group Master
.                          Added option 11-Report Group Details
.                          Added option 12-Web user Report Groups
.                 V5.08.01 11/05/2000  B.G.Ackland       
.                          Added Copy Facility
.                 V5.07.08 10/03/2000  B.G.Ackland       
.                          Added Cookies
.                 V5.07.07 09/02/2000  Pat Dirito        
.                          Added Report numbering of ShowDetail   
.                 V5.07.06 18/01/2000  B.G.Ackland       
.                          changes Ward Name to Not be Title Text
.                 V5.07.05 05/01/2000  B.G.Ackland       
.                          Recompiled for IBAWEBDF/IBAWEBCD  
.                 V5.07.04 20/12/1999  Katie Nelson      
.                          Recompiled for IBAWEBDF/IBAWEBCD  
.                 V5.07.03 07/10/1999  Katie Nelson      
.                          Added Reset Password Option 
.                 V5.07.02 20/09/1999  Nicole Harrington
.                          Changed for "Goto" in security ID table
.                 V5.07.01 06/09/1999  Nicole Harrington
.                          Changed to accept EOS for expiry date
.                 V5.07.00 08/07/1999 Pat Dirito
.                          Ported from V6.06
.                          Modified to OPPTDOC1 instead of patdo1af
.                 V6.06.03 05/07/1999 Pat Dirito 
.                          Added Server Template Maintenance - Options 6,7&8 
.                 V6.06.02 24/06/1999 N Harrington
.                          Added password ageing 
.                 V6.06.01 10.06.1999 B.G.Ackland      
.                          Added Option 5 for Staff to Change Settings ie Ward
.                 V6.06.00 14/05/1999 Nicole Harrington
.                          Added report options 2-4 and extended option 1 
.                 V6.05.00 24.02.1999 Katie C. Nelson
.                          Created Program
.
.----------------------------------------------------------------------
          INC       IBAWEBDF    
          INC       WEBDATDF    
.
          INC       APSMASFD/INC
          INC       EMRLOCFD/INC
          INC       EMRSITFD/INC
          INC       IBADPTFD/INC
          INC       MRTCONFD/INC
          INC       MRTLOCFD/INC
          INC       OPRCONFD/INC
          INC       PATDO1FD/INC
          INC       PATDRGFD/INC
          INC       PATHSPFD/INC
          INC       PATIN1FD/INC
          INC       PMSHCPFD/INC
          INC       PMSHCGFD/INC
          INC       PATCONFD/INC
          INC       PATWR1FD/INC
          INC       OUTSITFD/INC
          INC       OUTCLIFD/INC
          INC       OPRNURFD/INC
          INC       MLTSECFD/INC
          INC       MLTSITFD/INC
          INC       IBACUSFD/INC     * Category Security User IDs
.
          INC       WEBGRPFD/INC     * Security Groups
          INC       WEBHSPFD/INC     * WEB Hospital Login Details
          INC       WEBSGPFD/INC     * User Security Groups
          INC       WEBSKIFD/INC     * User keywords
          INC       WEBSPGFD/INC     * Web Server Program Details
          INC       WEBSOPFD/INC     * Web Server Options 
          INC       WEBRTMFD/INC     * Report Template Master
          INC       WEBRGMFD/INC     * Report Groups Master
          INC       WEBRDTFD/INC     * Report Group Details
          INC       WEBRURFD/INC     * Web User Report Groups
          INC       WEBRSPFD/INC     * Report Spool Files Available
          INC       WEBPASFD/INC     * Password History
.
          INC       PRIALSFD/INC     * Private Practice All User Access
          INC       PRISECFD/INC     * Private Practice User Access
.
          INC       PMSHCPTD/INC
          INC       PMSHCGTD/INC
.
.  Program Variables
.
ALERTLEV  DIM       1
ARRCNT    FORM      3        * Array count
ARRCOUNT  FORM      3   
CFILEPRE  DIM       3   * Current Open File Prefix for Outpatient Files
COKIEFLG  FORM      1
DFLTWARD  DIM       3
FILTACTV  DIM       1
FILTCLID  DIM       6
FILTCLOC  DIM       6
FILTESIT  DIM       3
FILTHOSP  DIM       3
FILTOSIT  DIM       6
FLTUSRID  DIM       10
FILTOCCG  DIM       3
FLTPRGID  DIM       10
FILTREPT  DIM       2
FILTSERV  DIM       8
FILTTEMP  DIM       3
FILTUSID  DIM       10
FILTWARD  DIM       3
ERRORKEY  DIM       24
ADDFLAG   FORM      1
CENT      DIM       2
CPTDATE   DIM       8         * Date parameter for GPERD
DAY       DIM       2
DIM3      DIM       3
DIM8      DIM       8
EXPIRY    FORM      8
FCENT     FORM      2
FHIRLONG  DIM       1
FYEAR     FORM      2
FMON      FORM      2
FDAY      FORM      2
FORM3     FORM      3
LHOSPCNT  FORM      3          * Count of hospital array fields
LSITECNT  FORM      3          * Count of O/P site array fields
LHOSPARR  DIM       3[200]     * Array of hospital codes
LSITPARR  DIM       6[200]     * Array of O/P site codes
GROUPCNT  FORM      3          * Count of security group array fields
GROUPARR  DIM       10[99]     * Array of security group codes
MANDWARD  DIM       1
MONTH     DIM       2
MONDESC   DIM       3
NAME      DIM       30
MARKEDKY  DIM       18[250]
MARKINDX  FORM      3
TODAY     FORM      8
DYEAR     DIM       2
PERDWARN  FORM      1     
PROGID    DIM       8     
PROGNAM   DIM       40
RECVFLAG  DIM       1
RPRTFLG   DIM       1
SAVKEY10  DIM       10
SAVKEY90  DIM       90
SAVPRGID  DIM       8
SECARRAY  DIM       10[200]     * Web Users displayed in search results
SECLEVEL  DIM       2
SECPASSC  DIM       4
SECCOUNT  FORM      1
SECCOUND  DIM       1
SAVUID    DIM       10
SECAREND  FORM      3          * Number of web users in SECARRAY[]
SHOWPASS  FORM      1
SWAPUSER  FORM      1
SWAPTURL  DIM       127
OPTNUM    DIM       2
OPTDESC   DIM       35
TEMPNO    DIM       3
TEMPDES   DIM       25
TEMPFIL   DIM       40
TEMPLEV   DIM       2  
TEMPMTY   DIM       1
TEMPTAR   DIM       1
TEMPWID   DIM       5
TEMPHIG   DIM       5
TEMPLP1   DIM       8
TEMPLP2   DIM       8
TEMPLP3   DIM       8
TEMPLP4   DIM       8
LNK2PRT   FORM      1   * Table Type : Update Parent
DOCTCODE  DIM       6   * unused, just to keep inc PATDOCTM happy
SECMDEPT  DIM       80
MRHOSFLG  DIM       1
.
.  CGI Parameters
.
WBGRP001  DIM       10     * Group Code
WBGRP002  DIM       50     * Group Description
WBGRP003  DIM       70     * Url
WBGRP004  DIM       1      * Active (0=Active 1=Inactive)
.
CPSEC001  DIM       10     * Web user ID (Copy To)
CPSEC002  DIM       30     * User Name   (Copt To)
CPSEC063  DIM       80     * Login Name  (Copt To)
.
WBSEC001  DIM       10     * Web user ID
WBSEC002  DIM       30     * User Name
WBSEC003  DIM       6      * Linked Doctor Code
WBSEC004  DIM       4      * System Passcode
WBSEC005  DIM       3      * Ward Code
WBSEC006  DIM       6      * Outpatient Site
WBSEC007  DIM       6      * Outpatient Clinic
WBSEC008  DIM       3      * Occupational Group
WBSEC009  DIM       40     * Log in URL
WBSEC010  DIM       3      * Emergency Site Code
WBSEC011  DIM       1      * Active 0=No 1=Yes
WBSEC012  DIM       11     * Expiry Date
WBSEC013  DIM       1      * Post level security enabled 0=No 1=Yes
WBSEC014  DIM       1      * Automatice Ageing (Y/N) 1=Yes 0=No
WBSEC015  DIM       3      * Age by Number of Days
.
WBSEC016  DIM       8      * Default Menu
WBSEC017  DIM       6      * Department
WBSEC018  DIM      10      * GP Code
WBSEC019  DIM      10      * GP Practice Code
WBSEC020  DIM       2      * GP Practice Count
WBSEC021  DIM       3      * Allied Health Departmenta Code
WBSEC022  DIM       3      * Document Type
WBSEC023  DIM       4      * MRT Home Location
WBSEC024  DIM       1      * View Alert Security Level
WBSEC025  DIM       1      * Add Alert Security Level
WBSEC026  DIM       3      * Day Surgery/General Operation Room Indicator
WBSEC027  DIM       1      * Cashier Indicator
WBSEC028  DIM       4      * Finance Passcode
WBSEC029  DIM       1      * All Practice Access
WBSEC030  DIM       8      * MRT Security Number
WBSEC031  DIM       3      * Hospital ID          
WBSEC032  DIM       3      * Clinic Location Type 
WBSEC033  DIM      15      * User Department (Free Format)
WBSEC034  DIM      10      * Nurse Code
WBSEC035  DIM       1      * All Hospital Access (not stored)
WBSEC036  DIM       1      * Bed Board View Number
WBSEC037  DIM       1      * All Security Group Access (not stored)
WBSEC038  DIM       1      * GP Access
WBSEC039  DIM       1      * View H1 Security Level
WBSEC040  DIM       1      * Add H1 Security Level
WBSEC041  DIM       1      * View H2 Security Level
WBSEC042  DIM       1      * Add H2 Security Level
WBSEC043  DIM       1      * View H3 Security Level
WBSEC044  DIM       1      * Add H3 Security Level
WBSEC045  DIM       1      * View H4 Security Level
WBSEC046  DIM       1      * Add H4 Security Level
WBSEC047  DIM       1      * View H5 Security Level
WBSEC048  DIM       1      * Add H5 Security Level
WBSEC049  DIM       1      * View H6 Security Level
WBSEC050  DIM       1      * Add H6 Security Level
WBSEC051  DIM       1      * View H7 Security Level
WBSEC052  DIM       1      * Add H7 Security Level
WBSEC053  DIM       1      * View H8 Security Level
WBSEC054  DIM       1      * Add H8 Security Level
WBSEC055  DIM       1      * View H9 Security Level
WBSEC056  DIM       1      * Add H9 Security Level
WBSEC057  DIM       3      * MRT Home Hospital
WBSEC058  DIM       3      * Usual Tracking Location Hospital
WBSEC059  DIM       4      * Usual Tracking Location
WBSEC060  DIM       3      * OP Direct User
WBSEC061  DIM       1      * All O/P Site Access
WBSEC062  DIM       80     * Email Address           
WBSEC063  DIM       80     * Long Login Name         
WBSEC064  DIM       1      * Generic User ID
WBSEC065  DIM       10     * HCP Code
.
WBSTE001  DIM       8      * Server Program ID
WBSTE002  FORM      2      * Security Level
WBSTE003  DIM       30     * User Def Ref 1
WBSTE004  DIM       30     * User Def Ref 2
WBSTE005  DIM       8      * User Def Date 1
WBSTE006  DIM       8      * User Def Date 2
WBSTE007  DIM       1      * User Def Y/N 1
WBSTE008  DIM       1      * User Def Y/N 2
. 
WBSPG001  DIM       8      * Program ID
WBSPG002  DIM       40     * Program Name
WBSPG003  DIM       40     * Fifo File Name
WBSPG004  DIM       40     * Output Directory
WBSPG005  DIM       40     * Dfault Template File
WBSPG006  DIM       30     * User Def Ref 1
WBSPG007  DIM       30     * User Def Ref 2
WBSPG008  DIM       8      * User Def Date 1
WBSPG009  DIM       8      * User Def Date 2
WBSPG010  DIM       1      * User Def Y/N 1
WBSPG011  DIM       1      * User Def Y/N 2
. 
WBSOP001  DIM       2      * Server Option
WBSOP002  DIM       35     * Description
WBSOP003  DIM       30     * User Def Ref 1
WBSOP004  DIM       30     * User Def Ref 2
WBSOP005  DIM       8      * User Def Date 1
WBSOP006  DIM       8      * User Def Date 2
WBSOP007  DIM       1      * User Def Y/N 1
WBSOP008  DIM       1      * User Def Y/N 2
.
WBTPL001  DIM       3      * Template
WBTPL002  DIM       25     * Description
WBTPL003  DIM       40     * File Name
WBTPL004  DIM       2      * Security Level
WBTPL005  DIM       1      * Menu Link type
WBTPL006  DIM       1      * Menu link Target
WBTPL007  DIM       5      * Width
WBTPL008  DIM       5      * Height
WBTPL009  DIM       8      * Link Parameter 1
WBTPL010  DIM       8      * Link Parameter 2
WBTPL011  DIM       8      * Link Parameter 3
WBTPL012  DIM       8      * Link Parameter 4
.
WBRTM001  DIM       8      * Program ID
WBRTM002  DIM       3      * Template Number
WBRTM003  DIM       35     * Description
WBRTM004  DIM       50     * Last Spool File Id
.
WBRGM001  DIM       5      * Report Group ID
WBRGM002  DIM       35     * Description
.
WBRDT001  DIM       5      * Report Group ID
WBRDT002  DIM       8      * Program ID
WBRDT003  DIM       3      * Tempate ID
.
WBRUR001  DIM       10     * Web User ID
WBRUR002  DIM       5      * Report Group ID
.
WEBUSEID  DIM       10        * User ID
WBIDNAME  DIM       30        * User name
CHNGHOSP  FORM      1
NEXTPAGE  DIM       1
UPDTTYPE  DIM       1      * A=Add U=Update D=Delete Blank=Display
USERUID   DIM       10
USERNAME  DIM       80
STARTKEY  DIM       10     * Starting Key
.
PASSWORD  DIM       128    * Current password
NEWPASSW  DIM       128    * New password
VERPASSW  DIM       128    * Verify password
INTPASSW  DIM       1      * Password management is internal (Y/N)
.
WARDFLAG  DIM       1
WORKDATE  DATE      8      * work field for calculating WBSEEXP
.
.  Program Constants
.
NINETY1   FORM      "91"
TOPTARG   INIT      "target='_top'"
ZERO8     INIT      "00000000"
REPUNIQ   INIT      "YZXYWXVWUVTUSTRSQRPQOPNOMNLMKLJKIJHIGHFGEFDECDBCABzAyzxywxvwuvtustrsqrpqopnomnlmkljkijhighfgefdecdbcab"
ZEND      INIT      "z~~~"
.
.
TYPENAME  DIM       40
MENUTY00  INIT      "Not Applicable"
MENUTY01  INIT      "Application"
MENUTY02  INIT      "Patient"
MENUTY03  INIT      "Report"
.
TARGNAME  DIM       40
MENUTA00  INIT      "Not Applicable"
MENUTA01  INIT      "Content Frame"
MENUTA02  INIT      "Pop Up Frame"
MENUTA03  INIT      "New Window"
.------------------------------------------------------------
PRGID     INIT      "WEBSEC01"
VERSION   INIT      "V12.01.00"
PRGNAM    INIT      "Web Security Login Web Server"
.------------------------------------------------------------
.         MAIN0000  Mainline
.------------------------------------------------------------
MAIN0000  CALL      WEBINT00       * Initialise Fifo Etc.
          CALL      INIT0000       * Open Files
.
MAIN1000  CALL      WEBRED00       * Read Fifo WEBPID and USERID
.
          COMPARE   "999",REPORTNO * End Server Process on Report Option 999
          GOTO      MAIN9999 IF EQUAL
.
          BRANCH    REPORTNO,MAIN1100,MAIN1200,MAIN1300,MAIN1400,MAIN1500:
                             MAIN1600,MAIN1700,MAIN1800,MAIN1900,MAIN2000:
                             MAIN2100,MAIN2200,MAIN2300,MAIN2400,MAIN2500:
                             MAIN2600
.
          PACK      WEBTITLE,PRGID,SP1,VERSION,SP1,PRGNAM,SP70
          MOVE      "Invalid Option",WEBTITLE
          CALL      WEBERR00   * Create Output File and Write HTML Page Header
          GOTO      MAIN1000
.
MAIN1100  CALL      WEBLOG00 
          GOTO      MAIN1000
.
MAIN1200  CALL      PASS0000                * User password maintenance
          BRANCH    EXIT,MAIN1000
          CALL      NXTPAG00
          GOTO      MAIN1000
.
MAIN1300  CALL      SECID000                * Security ID Mainetance
          BRANCH    EXIT,MAIN1000
          CALL      NXTPAG00
          GOTO      MAIN1000
.
MAIN1400  CALL      LEVEL000                * Security Level Maintenance
          BRANCH    EXIT,MAIN1000
          CALL      NXTPAG00
          GOTO      MAIN1000
.
MAIN1500  MOVE      USERID,WBSEC001         * Ward maintenance
          CALL      SECID000  
          BRANCH    EXIT,MAIN1000
          CALL      NXTPAG00
          GOTO      MAIN1000
.
MAIN1600  CALL      SERPRG00  * Level 1: Web Server Details Maintenance
          BRANCH    EXIT,MAIN1000
          MOVE      "Update Complete",WEBTITLE
          CALL      NXTPAG00
          GOTO      MAIN1000
.
MAIN1700  CALL      SEROPT00  * Level 2: Web Server Options Maintenance 
          BRANCH    EXIT,MAIN1000
          MOVE      "Update Complete",WEBTITLE
          CALL      NXTPAG00
          GOTO      MAIN1000
.
MAIN1800  CALL      SERTMP00  * Level 3: Web Server Master Template Maintenance
          BRANCH    EXIT,MAIN1000
          MOVE      "Update Complete",WEBTITLE
          CALL      NXTPAG00
          GOTO      MAIN1000
.
MAIN1900  CALL      RTMWEB00  * Report Template Master Maintenance
          BRANCH    EXIT,MAIN1000
          MOVE      "Update Complete",WEBTITLE
          CALL      NXTPAG00
          GOTO      MAIN1000
.
MAIN2000  CALL      RGMWEB00  * Report Groups Master Maintenance
          BRANCH    EXIT,MAIN1000
          MOVE      "Update Complete",WEBTITLE
          CALL      NXTPAG00
          GOTO      MAIN1000
.
MAIN2100  CALL      RDTWEB00  * Report Group Details Maintenance
          BRANCH    EXIT,MAIN1000
          MOVE      "Update Complete",WEBTITLE
          CALL      NXTPAG00
          GOTO      MAIN1000
.
MAIN2200  CALL      RURWEB00  * Web User Report Groups Maintenance
          BRANCH    EXIT,MAIN1000
          MOVE      "Update Complete",WEBTITLE
          CALL      NXTPAG00
          GOTO      MAIN1000
.
MAIN2300  CALL      ERRWEB00  * Web Error Reporting
          GOTO      MAIN1000
.
MAIN2400  CALL      GRPM0000                * Group Id Maintenance
          BRANCH    EXIT,MAIN1000
          CALL      NXTPAG00
          GOTO      MAIN1000
.
MAIN2500  CALL      TEMS0000                * Template Security Maintenance
          BRANCH    EXIT,MAIN1000
          CALL      NXTPAG00
          GOTO      MAIN1000
.
MAIN2600  MOVE      ONE,COKIEFLG
          CALL      WEBLOG00
          GOTO      MAIN1000
.
MAIN9999  MOVE      "SERVER SHUTDOWN COMPLETE",WEBTITLE
          CALL      WEBERR00
          STOP
.------------------------------------------------------------
. Errors Generated by WMASTER
.------------------------------------------------------------
ERRWEB00  CALL      CURPER00   * Set Current Periods
          CALL      CALCDT00   * Calc Next and Last Periods
.
          CALL      CLWEBERR
          MATCH     SP70,ERRORKEY
          GOTO      ERRWEB10 IF EQUAL
          MOVE      ERRORKEY,KEY24
          CALL      RDWBER1
          IF        OVRCD=1
            CALL      CLWEBERR
          ENDIF
.
ERRWEB10  MOVE      "Web Error Report",WEBTITLE
          CALL      WEBHED00
          BRANCH    EXIT,ERRWEB99
          CALL      WEBBOD00
          CALL      WEBEND00
.
ERRWEB99  RETURN
.------------------------------------------------------------
. Clear Web Error Fields
.------------------------------------------------------------
CLWEBERR  MOVE      SP70,WBERPID   * Program ID
          MOVE      SP70,WBERDAT   * Error Date
          MOVE      SP70,WBERTIM   * Error Time
          MOVE      SP70,WBERUID   * User ID
          MOVE      SP70,WBERREP   * Report No
          MOVE      SP70,WBERTMP   * Template
          MOVE      SP70,WBERURN   * U/R
          MOVE      SP70,WBERVIS   * Visit No
          MOVE      SP70,WBERCNT   * Server Error Count
          MOVE      SP70,WBERERR   * Program Error
          MOVE      SP70,WBERSPA   * Spare
          RETURN
.------------------------------------------------------------
. Output Next Page Based on CGI Parameter nextpage
.------------------------------------------------------------
NXTPAG00  MOVE      ZERO,F1
          MOVE      NEXTPAGE,F1
          BRANCH    F1,NXTPAG10,NXTPAG20,NXTPAG30,NXTPAG40,NXTPAG50:
                       NXTPAG60,NXTPAG70
.
          CALL      WINCLS00
          GOTO      NXTPAG99
.
NXTPAG10  CALL      RDIREC00
          GOTO      NXTPAG99
.
NXTPAG20  CALL      GOBACK00
          GOTO      NXTPAG99
.
NXTPAG30  CALL      GOBACK00
          GOTO      NXTPAG99
.
NXTPAG40  CALL      GOBACK00
          GOTO      NXTPAG99
.
NXTPAG50  CALL      RETURN00
          GOTO      NXTPAG99
.
NXTPAG60  CALL      BACK1000
          GOTO      NXTPAG99
.
NXTPAG70  CALL      PREDIR00
          GOTO      NXTPAG99
.
NXTPAG99  RETURN
.
.------------------------------------------------------------------------------
.  Redirect Parent URL
.------------------------------------------------------------------------------
PREDIR00  CALL      OPENHTML
          BRANCH    EXIT,PREDIR90
.
          WRITE     HTMLFILE;"<script type=#"text/javascript#"> {":
.                             " alert(#"",WEBTITLE,"#");":
                             " parent.location.href=#"",REDIRECT,"#";":
                             "}":
                             "</script>"
          CALL      CLOSHTML
          GOTO      PREDIR99
.
PREDIR90  DISPLAY   "*** Fifo Not Found ***"
.
PREDIR99  RETURN
.
.-------------------------------------------------------------------------------
. Returns to Current Page After Alert for Update
.-------------------------------------------------------------------------------
RETURN00  CALL      OPENHTML
          BRANCH    EXIT,RETURN99
          MOVE      NEXTPAGE,F1
          SUB       TWO,F1
          WRITE     HTMLFILE;"<script type=#"text/javascript#"> {":
                             "    alert(#"",WEBTITLE,"#");":
                             "    self.close();":
                             "}":
                             "</script>"
          CALL      CLOSHTML
RETURN99  RETURN
.-------------------------------------------------------------------------------
.  Goes back x number of pages
.-------------------------------------------------------------------------------
GOBACK00  CALL      OPENHTML
          BRANCH    EXIT,GOBACK99
          MOVE      NEXTPAGE,F1
          SUB       TWO,F1
          WRITE     HTMLFILE;"<script type=#"text/javascript#"> {":
                             "    alert(#"",WEBTITLE,"#");":
.                            "    self.close();":
                             "    window.history.go(-",F1,");":
                             "}":
                             "</script>"
          CALL      CLOSHTML
GOBACK99  RETURN
.-------------------------------------------------------------------------------
.  Goes back 1 page
.-------------------------------------------------------------------------------
BACK1000  CALL      OPENHTML
          BRANCH    EXIT,BACK1999
          WRITE     HTMLFILE;"<script type=#"text/javascript#"> {":
                             "  history.go(-2);":
                             "}":
                             "</script>"
          CALL      CLOSHTML
BACK1999  RETURN
+
.------------------------------------------------------------
.         WEBLOG00  Login redirect
.------------------------------------------------------------
WEBLOG00  MOVE      ZERO,F1
          MOVE      ZERO,PERDWARN
          MOVE      WBSEACT,F1
          COMPARE   F1,ONE                         * Active??
          GOTO      WEBLOG70 IF NOT EQUAL 
.
          READ      CONTROLF,NINETY1;*19,CWEBPCMD
          SCAN      "ibapasswd",CWEBPCMD
          IF        @EQUAL
            MOVE      "1",INTPASSW 
          ELSE
            MOVE      "0",INTPASSW
          ENDIF
          RESET     CWEBPCMD
.
          CALL      HTMLOPEN
          BRANCH    EXIT,WEBLOG90
.
          CALL      IBACLOCK
          PACK      DIM8,CCC,CYY,CMM,CDD
          REP       " 0",DIM8
          MOVE      DIM8,TODAY
          CLOCK     TIME,CTIMEIS
. 
          MOVE      TODAY,CPTDATE
          REP       " 0",CPTDATE
          CALL      GPERD                   * Get the financial period for date
          IF        EXIT=1
            MOVE      ONE,PERDWARN
          ENDIF
.
          MATCH     "1",INTPASSW            * internal password management ?
          GOTO      WEBLOG10 IF NOT EQUAL
.
          MATCH     SP70,WBSEEXP
          GOTO      WEBLOG10 IF EQUAL
.
          REP       " 0",WBSEEXP
          MOVE      WBSEEXP,EXPIRY
.
          COMPARE   ONE,COKIEFLG
          GOTO      WEBLOG30 IF EQUAL
.
          COMPARE   TODAY,EXPIRY
          IF        @LESS | @EQUAL
            GOTO      WEBLOG60
          ENDIF 
.
WEBLOG10  PACK      KEY10,WBSEUID
          CALL      RDWBSE1               * (re-)read websecaf
          BRANCH    OVRCD,WEBLOG11
.
          PACK      WBSELACD,CCC,CYY,CMM,CDD
          REP       " 0",WBSELACD
          CLOCK     TIME,CTIMEIS
          MOVE      CTIMEIS,WBSELACT
.
          CALL      UPWBSE1               * Update Date & Time Last Accessed
.
WEBLOG11  MATCH     SP70,WBSEDIR
          GOTO      WEBLOG80 IF EQUAL
.
          BRANCH    SWAPUSER,WEBLOG20
.
          WRITE     HTMLFILE;"Content-Type: text/html",012:
                             "Cache-Control: no-cache",012:
                             "Set-Cookie: IBAUserName=",USERID,";path=/;",012:
                             "Set-Cookie: IBALoginDate=",TODAY,";path=/;",012:
                             "Set-Cookie: IBALoginTime=",CTIMEIS,";path=/;",012:
                             "Set-Cookie: IBAUserDesc=",WBSENAM,";path=/;",012:
                             "Set-Cookie: IBAOccGroup=",WBSEOCG,";path=/;",012:
                             "Set-Cookie: IBAUserHosp=",WBSEHOSP,";path=/;",012:
                             "Set-Cookie: IBAUserEMR=",WBSEESC,";path=/;",012:
                             "Set-Cookie: IBAUserOUT=",WBSESIT,";path=/;",012:
                             "Set-Cookie: IBAUserRFD=",WBSEDALL,";path=/;",012:
                             "Set-Cookie: IBAPasscode=",WBSEPCD,";path=/;",012:
                             012:
                             "<html><head>":
                             "<title> Redirect </title>",012:
                             "<script type=#"text/javascript#">"
          IF        PERDWARN=1
            WRITE     HTMLFILE;"alert(#"Warning: Period Date Range ":
                               "not set up. Contact your system administrator":
                               " immediately.#");"
          ENDIF
          WRITE     HTMLFILE;"location.href='",WBSEDIR,"';":
                             "</script></head></html>"
          GOTO      WEBLOG95
.
WEBLOG20  WRITE     HTMLFILE;"Content-Type: text/html",012:
                             "Cache-Control: no-cache",012:
                             "Set-Cookie: IBAUserName=",USERID,";path=/;",012:
                             "Set-Cookie: IBALoginDate=",TODAY,";path=/;",012:
                             "Set-Cookie: IBALoginTime=",CTIMEIS,";path=/;",012:
                             "Set-Cookie: IBAUserDesc=",WBSENAM,";path=/;",012:
                             "Set-Cookie: IBAOccGroup=",WBSEOCG,";path=/;",012:
                             "Set-Cookie: IBAUserHosp=",WBSEHOSP,";path=/;",012:
                             "Set-Cookie: IBAUserEMR=",WBSEESC,";path=/;",012:
                             "Set-Cookie: IBAUserOUT=",WBSESIT,";path=/;",012:
                             "Set-Cookie: IBAUserRFD=",WBSEDALL,";path=/;",012:
                             "Set-Cookie: IBAPasscode=",WBSEPCD,";path=/;",012:
                             012:
                             "<html><head>":
                             "<title> Redirect </title>",012:
                             "<script type=#"text/javascript#">"
          IF        PERDWARN=1
            WRITE     HTMLFILE;"alert(#"Warning: Period Date Range ":
                               "not set up. Contact your system administrator":
                               " immediately.#");"
          ENDIF
          WRITE     HTMLFILE;"location.href='",SWAPTURL,"';":
                             "</script></head></html>"
          GOTO      WEBLOG95
.
WEBLOG30  WRITE     HTMLFILE;"Content-Type: text/html",012:
                             "Cache-Control: no-cache",012:
                             "Set-Cookie: IBAUserName=",USERID,";path=/;",012:
                             "Set-Cookie: IBALoginDate=",TODAY,";path=/;",012:
                             "Set-Cookie: IBALoginTime=",CTIMEIS,";path=/;",012:
                             "Set-Cookie: IBAUserDesc=",WBSENAM,";path=/;",012:
                             "Set-Cookie: IBAOccGroup=",WBSEOCG,";path=/;",012:
                             "Set-Cookie: IBAUserHosp=",WBSEHOSP,";path=/;",012:
                             "Set-Cookie: IBAUserEMR=",WBSEESC,";path=/;",012:
                             "Set-Cookie: IBAUserOUT=",WBSESIT,";path=/;",012:
                             "Set-Cookie: IBAUserRFD=",WBSEDALL,";path=/;",012:
                             "Set-Cookie: IBAPasscode=",WBSEPCD,";path=/;",012:
                             012:
                             "<html><head>":
                             "<title> Redirect </title>",012:
                             "<script type=#"text/javascript#">"
          IF        PERDWARN=1
            WRITE     HTMLFILE;"alert(#"Warning: Period Date Range ":
                               "not set up. Contact your system administrator":
                               " immediately.#");"
          ENDIF
          WRITE     HTMLFILE;"</script></head></html>";
          GOTO      WEBLOG95
.
WEBLOG60  WRITE     HTMLFILE;"Content-Type: text/html",012:
                             "Cache-Control: no-cache",012:
                             "Set-Cookie: IBAUserName=",USERID,";path=/;",012:
                             "Set-Cookie: IBALoginDate=",TODAY,";path=/;",012:
                             "Set-Cookie: IBALoginTime=",CTIMEIS,";path=/;",012:
                             "Set-Cookie: IBAUserDesc=",WBSENAM,";path=/;",012:
                             "Set-Cookie: IBAOccGroup=",WBSEOCG,";path=/;",012:
                             "Set-Cookie: IBAUserHosp=",WBSEHOSP,";path=/;",012:
                             "Set-Cookie: IBAUserEMR=",WBSEESC,";path=/;",012:
                             "Set-Cookie: IBAUserOUT=",WBSESIT,";path=/;",012:
                             "Set-Cookie: IBAUserRFD=",WBSEDALL,";path=/;",012:
                             "Set-Cookie: IBAPasscode=",WBSEPCD,";path=/;",012:
                             012:
                             "<html><head>":
                             "<title> Redirect </title>",012:
                             "<script type=#"text/javascript#">"
          IF        PERDWARN=1
            WRITE     HTMLFILE;"alert(#"Warning: Period Date Range ":
                               "not set up. Contact your system administrator":
                               " immediately.#");"
          ENDIF
          WRITE     HTMLFILE;"location.href='websec01.pbl?reportno=2&template=2":
                              "&wbsec001=",WBSEUID,"';":
                             "</script></head></html>"
          GOTO      WEBLOG95          
.
WEBLOG70  CLEAR     WEBTITLE
          APPEND    "User ",WEBTITLE
          APPEND    WBSEUID,WEBTITLE
          APPEND    " is not active.",WEBTITLE
          RESET     WEBTITLE
          CALL      WEBERR00
          GOTO      WEBLOG99
 
WEBLOG80  WRITE     HTMLFILE;"Content-Type: text/html",012:
                             "Cache-Control: no-cache",012,012:
                             "<html><head>":
                             "<title> Redirect </title>",012:
                             "<script type=#"text/javascript#">"
          IF        PERDWARN=1
            WRITE     HTMLFILE;"alert(#"Warning: Period Date Range ":
                               "not set up. Contact your system administrator":
                               " immediately.#");"
          ENDIF
          WRITE     HTMLFILE;"location.href='/';":
                             "</script></head></html>"
          GOTO      WEBLOG95
.
WEBLOG90  MOVE      "*** Fifo Not Found ***",WEBTITLE
          CALL      WEBERR00
          GOTO      WEBLOG99
.
WEBLOG95  CALL      CLOSHTML
.
WEBLOG99  RETURN
.------------------------------------------------------------
.         PASS0000  User Password Maintenance
.------------------------------------------------------------
PASS0000  RESET     UPDTTYPE
          MATCH     SP1,UPDTTYPE
          GOTO      PASS4000 IF EQUAL
.
          MOVE      ZERO,EXIT
.
          MATCH     "1",INTPASSW            * internal password management ?
          GOTO      PASS9999 IF NOT EQUAL
.
.
. set up the command line basics 
.
          MOVE      SP70,TASKID
          CLEAR     SYSCMDLN
          STRIP     CWEBPCMD
          APPEND    CWEBPCMD,SYSCMDLN
          APPEND    SP1,SYSCMDLN
          STRIP     CWEBPFIL
.
          MATCH     "A",UPDTTYPE
          GOTO      PASS2000 IF EQUAL
.
          MATCH     "D",UPDTTYPE
          GOTO      PASS3000 IF EQUAL 
.
          MATCH     "U",UPDTTYPE
          GOTO      PASS1000 IF EQUAL
. 
.     * password verification is no longer required 
.     * (checked before form submit) so go straight to redirect
          MATCH     "V",UPDTTYPE
          GOTO      PASS9999 IF EQUAL
. 
          GOTO      PASS9000
.
PASS1000  CALL      DUPPAS00                  * Check Password History
          BRANCH    EXIT,PASS9500
.
PASS2000  APPEND    CWEBPFIL,SYSCMDLN
          APPEND    SP1,SYSCMDLN
          APPEND    QUOTE,SYSCMDLN
          STRIP     USERNAME
PASS2010  MOVE      USERNAME,DIM1             * select next char from username
          MATCH     BSLASH,DIM1
          GOTO      PASS2020 IF EQUAL      
          MATCH     QUOTE,DIM1
          GOTO      PASS2020 IF EQUAL      
          MATCH     "!",DIM1
          GOTO      PASS2015 IF EQUAL
          MATCH     "$",DIM1
          GOTO      PASS2020 IF EQUAL
          MATCH     "`",DIM1
          GOTO      PASS2020 IF EQUAL
          GOTO      PASS2030
.
PASS2015  APPEND    QUOTE,SYSCMDLN            * escape exclamation character "'!'"
          APPEND    "'",SYSCMDLN        
          APPEND    DIM1,SYSCMDLN      
          APPEND    "'",SYSCMDLN      
          APPEND    QUOTE,SYSCMDLN   
          GOTO      PASS2035
.
PASS2020  APPEND    BSLASH,SYSCMDLN           * escape the next character
PASS2030  APPEND    DIM1,SYSCMDLN
PASS2035  BUMP      USERNAME                  * move up one character
          GOTO      PASS2010 IF NOT EOS       * loop again if more
.     
          APPEND    QUOTE,SYSCMDLN
          APPEND    SP1,SYSCMDLN
          APPEND    QUOTE,SYSCMDLN
.
          STRIP     NEWPASSW
PASS2040  MOVE      NEWPASSW,DIM1
          MATCH     BSLASH,DIM1
          GOTO      PASS2050 IF EQUAL      
          MATCH     QUOTE,DIM1
          GOTO      PASS2050 IF EQUAL      
          MATCH     "!",DIM1
          GOTO      PASS2045 IF EQUAL
          MATCH     "$",DIM1
          GOTO      PASS2050 IF EQUAL
          MATCH     "`",DIM1
          GOTO      PASS2050 IF EQUAL
          GOTO      PASS2060
.
PASS2045  APPEND    QUOTE,SYSCMDLN            * escape exclamation character "'!'"
          APPEND    "'",SYSCMDLN        
          APPEND    DIM1,SYSCMDLN      
          APPEND    "'",SYSCMDLN      
          APPEND    QUOTE,SYSCMDLN   
          GOTO      PASS2065
.
PASS2050  APPEND    BSLASH,SYSCMDLN           * escape the next character
PASS2060  APPEND    DIM1,SYSCMDLN
PASS2065  BUMP      NEWPASSW                  * move up one character
          GOTO      PASS2040 IF NOT EOS       * loop again if more
.
          APPEND    QUOTE,SYSCMDLN
          APPEND    SP1,SYSCMDLN
          APPEND    QUOTE,SYSCMDLN
.
          RESET     NEWPASSW
          STRIP     NEWPASSW
PASS2070  MOVE      NEWPASSW,DIM1
          MATCH     BSLASH,DIM1
          GOTO      PASS2080 IF EQUAL      
          MATCH     QUOTE,DIM1
          GOTO      PASS2080 IF EQUAL      
          MATCH     "!",DIM1
          GOTO      PASS2075 IF EQUAL
          MATCH     "$",DIM1
          GOTO      PASS2080 IF EQUAL
          MATCH     "`",DIM1
          GOTO      PASS2080 IF EQUAL
          GOTO      PASS2090
.
PASS2075  APPEND    QUOTE,SYSCMDLN            * escape exclamation character "'!'"
          APPEND    "'",SYSCMDLN        
          APPEND    DIM1,SYSCMDLN      
          APPEND    "'",SYSCMDLN      
          APPEND    QUOTE,SYSCMDLN   
          GOTO      PASS2095
.
PASS2080  APPEND    BSLASH,SYSCMDLN           * escape the next character
PASS2090  APPEND    DIM1,SYSCMDLN
PASS2095  BUMP      NEWPASSW                  * move up one character
          GOTO      PASS2070 IF NOT EOS       * loop again if more
.
          APPEND    QUOTE,SYSCMDLN
          RESET     SYSCMDLN
          RESET     USERNAME
          RESET     NEWPASSW
.
          EXECUTE   SYSCMDLN,TASKID
          MATCH     "0",TASKID
          GOTO      PASS9100 IF NOT EQUAL
.
          MATCH     "A",UPDTTYPE              * that's all for new entries
          GOTO      PASS9999 IF EQUAL
.
          PACK      KEY10,WBSEUID
          CALL      RDWBSE1
          PACK      WBSEEXP,SP70
.
          MATCH     "1",WBSEAUT
          GOTO      PASS2100 IF NOT EQUAL
.
          CALL      IBACLOCK
.
          REP       " 0",XDATE         * just in case we have spurious spaces
          MOVE      XDATE,WORKDATE     * set workdate = today
.
          MOVE      ZERO,FORM3
          MOVE      WBSEAGE,DIM3       * Remove spaces before move to form field
          SQUEEZE   DIM3
          MOVE      DIM3,FORM3
          ADD       FORM3,WORKDATE
          MOVE      WORKDATE,WBSEEXP   * Reset expiry date
.
.
PASS2100  MOVE      USERID,WBSEUUID
          CALL      IBACLOCK
          PACK      WBSEUDAT,CCC,CYY,CMM,CDD
          REP       " 0",WBSEUDAT
          MOVE      CTIMEIS,WBSEUTIM
          CALL      UPWBSE1
          MOVE      "Password Change Successful",WEBTITLE
          MOVE      ZERO,EXIT
          GOTO      PASS9999
.
PASS3000  MOVE      WBSELOGN,USERNAME
          APPEND    "-d ",SYSCMDLN           * password deletion
          STRIP     CWEBPFIL
          APPEND    CWEBPFIL,SYSCMDLN
          APPEND    SP1,SYSCMDLN
          APPEND    QUOTE,SYSCMDLN
          STRIP     USERNAME
PASS3010  MOVE      USERNAME,DIM1             * select next char from username
          MATCH     BSLASH,DIM1
          GOTO      PASS3020 IF EQUAL      
          MATCH     QUOTE,DIM1
          GOTO      PASS3020 IF EQUAL      
          MATCH     "!",DIM1
          GOTO      PASS3020 IF EQUAL
          GOTO      PASS3030
PASS3020  APPEND    BSLASH,SYSCMDLN           * escape the next character
PASS3030  APPEND    DIM1,SYSCMDLN
          BUMP      USERNAME                  * move up one character
          GOTO      PASS3010 IF NOT EOS       * loop again if more
.     
          APPEND    QUOTE,SYSCMDLN
          APPEND    SP1,SYSCMDLN
          RESET     USERNAME
          RESET     SYSCMDLN
          EXECUTE   SYSCMDLN,TASKID
          GOTO      PASS9999
.
.
PASS4000  MOVE      "Password Maintenance",WEBTITLE
          CALL      WEBHED00
          BRANCH    EXIT,PASS9990
          CALL      WEBBOD00
          CALL      WEBEND00
          MOVE      ONE,EXIT
          GOTO      PASS9999
.
PASS9000  MOVE      "Invalid update type",WEBTITLE
          CALL      WEBERR00 
          MOVE      ONE,EXIT
          GOTO      PASS9999
.
PASS9100  CLEAR     WEBTITLE 
          APPEND    "Password change unsuccessful. Error: ",WEBTITLE
         APPEND    SYSCMDLN,WEBTITLE
.         APPEND    TASKID,WEBTITLE
          RESET     WEBTITLE
          CALL      WEBERR00
          MOVE      ONE,EXIT
          GOTO      PASS9999
.
PASS9200  CLEAR     WEBTITLE
          APPEND    "Password invalid. Error: ",WEBTITLE
          APPEND    TASKID,WEBTITLE
          RESET     WEBTITLE
          CALL      WEBERR00
          MOVE      ONE,EXIT
          GOTO      PASS9999
.
PASS9300  CLEAR     WEBTITLE
          APPEND    "Password addition unsuccessful. Error: ",WEBTITLE
          APPEND    TASKID,WEBTITLE
          RESET     WEBTITLE
          CALL      WEBERR00
          MOVE      ONE,EXIT
          GOTO      PASS9999
.
PASS9400  MOVE      "ERROR: Password Must Be Changed",WEBTITLE
          CALL      WEBERR00
          MOVE      ONE,EXIT
          GOTO      PASS9999
.
PASS9500  MOVE      "ERROR: Password Used in Last 5 Times",WEBTITLE
          CALL      WEBERR00
          MOVE      ONE,EXIT
          GOTO      PASS9999
.
PASS9990  MOVE      ZERO,EXIT
.
PASS9999  RETURN
.------------------------------------------------------------
. DUPPAS00 - Check Password History Table
.------------------------------------------------------------
DUPPAS00  MOVE      ZERO,EXIT
          MATCH     "1",INTPASSW
          GOTO      DUPPAS99 IF NOT EQUAL  * externally managed passwords
.
          PACK      KEY80,USERNAME,SP256
          CALL      RDWBSE7
          BRANCH    OVRCD,DUPPAS90
.
          MOVE      WBSEUID,KEY10
          CALL      RDWBPAS1
          BRANCH    OVRCD,DUPPAS50
          MATCH     NEWPASSW,WBPAPAS1
          GOTO      DUPPAS90 IF EQUAL
          MATCH     NEWPASSW,WBPAPAS2
          GOTO      DUPPAS90 IF EQUAL
          MATCH     NEWPASSW,WBPAPAS3
          GOTO      DUPPAS90 IF EQUAL
          MATCH     NEWPASSW,WBPAPAS4
          GOTO      DUPPAS90 IF EQUAL
          MATCH     NEWPASSW,WBPAPAS5
          GOTO      DUPPAS90 IF EQUAL
.
          MOVE      WBPAPAS4,WBPAPAS5
          MOVE      WBPAPAS3,WBPAPAS4
          MOVE      WBPAPAS2,WBPAPAS3
          MOVE      WBPAPAS1,WBPAPAS2
          MOVE      PASSWORD,WBPAPAS1
          CALL      UPWBPAS1
          MOVE      ZERO,EXIT
          GOTO      DUPPAS99
.
DUPPAS50  MOVE      WBSEUID,WBPAUID
          MOVE      SP70,WBPAPAS5
          MOVE      SP70,WBPAPAS4
          MOVE      SP70,WBPAPAS3
          MOVE      SP70,WBPAPAS2
          MOVE      PASSWORD,WBPAPAS1
          CALL      WRWBPAS1
          MOVE      ZERO,EXIT
          GOTO      DUPPAS99
.
DUPPAS90  MOVE      ONE,EXIT
.
DUPPAS99  RETURN
.------------------------------------------------------------
.         SECID000  Security ID Maintenance
.------------------------------------------------------------
SECID000  RESET     UPDTTYPE 
.
          READ      CONTROLF,NINETY1;*19,CWEBPCMD
          SCAN      "ibapasswd",CWEBPCMD
          IF        @EQUAL
            MOVE      "1",INTPASSW 
          ELSE
            MOVE      "0",INTPASSW
          ENDIF
          RESET     CWEBPCMD
.
          MATCH     SP1,UPDTTYPE
          GOTO      SECID800 IF EQUAL
.
          MATCH     "A",UPDTTYPE
          IF        @EQUAL
            CALL      ADDSEC00
            BRANCH    EXIT,SECID999
.
            CALL      PRIPRC00     * Write/Update Private Practice Security
            CALL      MLTACH00     * Write Multi Hospital Access Security
            CALL      MLTACC00     * Write/Update All Multi Hosp Access Security
            CALL      GRPSEC00     * Write/Update Group Security
            CALL      ASIT0000     * Update All Outpatient Site Access Security
            GOTO      SECID999
          ENDIF  
.
          MATCH     "U",UPDTTYPE
          IF        @EQUAL
            CALL      UPDSEC00
            BRANCH    EXIT,SECID999
.
            CALL      PRIPRC00     * Write/Update Private Practice Security
            CALL      MLTACC00     * Write/Update All Multi Hospital Access Security
            CALL      GRPSEC00     * Write/Update Group Security
            CALL      ASIT0000     * Update All Outpatient Site Access Security
            GOTO      SECID999
          ENDIF  
.
          MATCH     "H",UPDTTYPE
          IF        @EQUAL
            CALL      LHOS0000     * Write/Update Hospital Access Security
            GOTO      SECID999
          ENDIF
.
          MATCH     "S",UPDTTYPE
          IF        @EQUAL
            CALL      LSIT0000     * Write/Update Site Access Security
            GOTO      SECID999
          ENDIF
.
          MATCH     "D",UPDTTYPE
          IF        @EQUAL
            CALL      DELSEC00
            CALL      DELPRC00     * Delete Private Practice Security
            GOTO      SECID999
          ENDIF
.
          MATCH     "R",UPDTTYPE
          IF        @EQUAL
            CALL      RESSEC00
            GOTO      SECID999
          ENDIF
.
          MATCH     "C",UPDTTYPE
          IF        @EQUAL
            CALL      COPSEC00
            BRANCH    EXIT,SECID999
.
            CALL      PRIPRC00     * Write/Update Private Practice Security
            CALL      MLTACH00     * Write Multi Hospital Access Security
            CALL      MLTACC00     * Write/Update All Multi Hosp Access Security
            CALL      GRPSEC00     * Write/Update Group Security
            CALL      ASIT0000     * Update All Outpatient Site Access Security
            GOTO      SECID999
          ENDIF
.
          MATCH     "G",UPDTTYPE
          IF        @EQUAL
            CALL      LGRP0000     * Write/Update Group Security Access Security
            GOTO      SECID999
          ENDIF
.
          MATCH     "L",UPDTTYPE
          IF        @EQUAL
            CALL      ALERTS00     * Write/Update Alert Level Security
            GOTO      SECID999
          ENDIF
.
          GOTO      SECID900
.
SECID800  MATCH     "1",FHIRLONG
          IF        @EQUAL
            PACK      KEY80,WBSEC063
            CALL      RDWBSE7
            IF        OVRCD=1
              CALL      CLSECVAR
              BRANCH    FHIRTYPE,SECID910
            ENDIF
          ELSE
            PACK      KEY10,WBSEC001
            CALL      RDWBSE1
            IF        OVRCD=1
              CALL      CLSECVAR
              BRANCH    FHIRTYPE,SECID910
            ENDIF 
          ENDIF
.
SECID850  MOVE      "Security ID Maintenance",WEBTITLE
          CALL      WEBHED00
          BRANCH    EXIT,SECID999
.
          CALL      WEBBOD00
          CALL      WEBEND00
          MOVE      ONE,EXIT
          GOTO      SECID999 
.
SECID900  MOVE      "Invalid update type",WEBTITLE
          CALL      WEBERR00
          MOVE      ONE,EXIT
          GOTO      SECID999
.
SECID910  MOVE      "Invalid Practitioner ID",WEBTITLE
          CALL      WEBERR00
          MOVE      ONE,EXIT
          GOTO      SECID999
.
SECID920  MOVE      "Site Code Inactive",WEBTITLE
          CALL      WEBERR00
          MOVE      ONE,EXIT
          GOTO      SECID999
.
SECID999  RETURN
.
.-----------------------------------------------------------------------
. Set Private Practice Security Records
. If WBSEC029=1 then All Practices set! Will delete all records from
. Practice User Security File (PRISECFD). A new record will be writen
. to All Practice File(PRIALSFD).
. If WBSEC029 not 1 then it will delete the All Practice Record 
.-----------------------------------------------------------------------
PRIPRC00  MATCH     "1",WBSEC029
          GOTO      PRIPRC10 IF EQUAL

          PACK      KEY10,WBSEUID,SP70    * All Practice File
          CALL      RDPRALS1
          BRANCH    OVRCD,PRIPRC99
.
          CALL      DEPRALS1 
.
          GOTO      PRIPRC99
.
PRIPRC10  PACK      KEY16,WBSEUID,SP70    * Practice User File
          CALL      RSPRSEC2
          CALL      RKPRSEC2
          BRANCH    OVRCD,PRIPRC20
.
          MATCH     WBSEUID,PRSEUSID       * User ID the same
          GOTO      PRIPRC20 IF NOT EQUAL
.
          PACK      KEY16,PRSEUSID,PRSEPRAC,SP70
          CALL      DEPRSEC2
          GOTO      PRIPRC10
.
PRIPRC20  PACK      KEY10,WBSEUID,SP70   * All Practice File
          CALL      RDPRALS1
          BRANCH    OVRCD,PRIPRC30
.
          GOTO      PRIPRC99
.
PRIPRC30  MOVE      WBSEUID,PRALUSID     * Set User ID
          MOVE      SP70,PRALSPAR
.
          PACK      KEY10,PRALUSID,SP70
          CALL      WRPRALS1             * Writes away the data
.
PRIPRC99  RETURN
.-----------------------------------------------------------------------
. Set Hospital Access Security Records
. If WBSEC035=1 then All Hospitals set! Will delete all records from
. Multi Hospital Security File (MLTSECFD). A new record will be writen
. with the user ID and a blank hospital ID
. If WBSEC029 not 1 then it will delete the All Practice Record
.-----------------------------------------------------------------------
MLTACC00  COMPARE   ONE,IBCNMHOS
          GOTO      MLTACC99 IF NOT EQUAL
.
          PACK      WBSEC001,WBSEC001,SP70
          MATCH     Z70,WBSEC035
          GOTO      MLTACC99 IF EQUAL
          MATCH     "1",WBSEC035
          GOTO      MLTACC10 IF EQUAL

          PACK      KEY13,WBSEC001,SP70    * All Hospital Access?
          CALL      RDMLSEC1
          BRANCH    OVRCD,MLTACC99
.
          CALL      DEMLSEC1
.
          GOTO      MLTACC99
.
MLTACC10  PACK      KEY13,WBSEC001,SP70    * Hospital Access File
          CALL      RSMLSEC1
          CALL      RKMLSEC1
          BRANCH    OVRCD,MLTACC20
.
          MATCH     WBSEC001,MLSCUSID       * User ID the same
          GOTO      MLTACC20 IF NOT EQUAL
.
          PACK      KEY13,MLSCUSID,MLSCHOSP,SP70
          CALL      DEMLSEC1
          GOTO      MLTACC10
.
MLTACC20  PACK      KEY13,WBSEC001,SP70   * All Hospital Record
          CALL      RDMLSEC1
          BRANCH    OVRCD,MLTACC30
.
          GOTO      MLTACC99
.
MLTACC30  MOVE      WBSEC001,MLSCUSID     * Set User ID
          PACK      MLSCHOSP,SP70         * Blank means all Hospital Access
          MOVE      SP70,MLSCSPAR
.
          PACK      KEY13,MLSCUSID,MLSCHOSP,SP70
          CALL      WRMLSEC1             * Writes away the data
.
MLTACC99  RETURN
.
.-----------------------------------------------------------------------
. If multi hospital set access to the users default hospital
.-----------------------------------------------------------------------
MLTACH00  COMPARE   ONE,IBCNMHOS
          GOTO      MLTACH99 IF NOT EQUAL
.
          PACK      WBSEC031,WBSEC031,SP70
.
          MATCH     Z70,WBSEC031
          GOTO      MLTACH99 IF EQUAL
.
          MATCH     SP70,WBSEC031
          GOTO      MLTACH99 IF EQUAL

          MOVE      WBSEC001,MLSCUSID     * Set User ID
          MOVE      WBSEC031,MLSCHOSP     * Set Access to Hospital Access
          MOVE      SP70,MLSCSPAR
.
          PACK      KEY13,MLSCUSID,MLSCHOSP,SP70
          CALL      RAMLSEC1
          IF        OVRCD=1
            CALL      WRMLSEC1             * Writes away the data
          ENDIF
.
MLTACH99  RETURN
.
.-----------------------------------------------------------------------
. Delete Private Practice Security records
.-----------------------------------------------------------------------
DELPRC00  PACK      KEY10,WBSEUID,SP70   * All Practices File
          CALL      RDPRALS1
          BRANCH    OVRCD,DELPRC10
.
          CALL      DEPRALS1 
.
DELPRC10  PACK      KEY16,WBSEUID,SP70   * Practice User File
          CALL      RSPRSEC2
          CALL      RKPRSEC2
          BRANCH    OVRCD,DELPRC99
.
          MATCH     WBSEUID,PRSEUSID     * User ID the same
          GOTO      DELPRC99 IF NOT EQUAL
.
          PACK      KEY16,PRSEUSID,PRSEPRAC,SP70
          CALL      DEPRSEC2
          GOTO      DELPRC10
.
DELPRC99  RETURN
.------------------------------------------------------------
.         COPSEC00  Copy Security ID
.------------------------------------------------------------
COPSEC00  MATCH     SP70,CPSEC001
          GOTO      COPSEC92 IF EQUAL
.
          MATCH     Z70,CPSEC001
          GOTO      COPSEC92 IF EQUAL
.
          PACK      KEY10,CPSEC001               * Check if target uid exists
          CALL      RDWBSE1
          COMPARE   ZERO,OVRCD
          GOTO      COPSEC91 IF EQUAL
.
          PACK      KEY80,CPSEC063,SP256         * Check if target Logon name 
          CALL      RDWBSE7
          COMPARE   ZERO,OVRCD
          GOTO      COPSEC94 IF EQUAL
.
          PACK      KEY10,WBSEC001               * reposition on record  copy
          CALL      RDWBSE1
          BRANCH    OVRCD,COPSEC90
.
          MOVE      CPSEC001,WBSEUID
          MOVE      CPSEC002,WBSENAM
          MOVE      CPSEC063,WBSELOGN
.
          CALL      GNID0000                     * Generate new passcode
          BRANCH    EXIT,COPSEC93
.
          MOVE      SECPASSC,WBSEPCD
          CALL      ALLP0000                     * Save new passcode in ihapassf
.
          PACK      WBSEEXP,CCC,CYY,CMM,CDD
          REP       " 0",WBSEEXP
          PACK      WBSEMRTS,SP70                * don't copy mrt security no.
.
          MOVE      USERID,WBSECUID
          PACK      WBSECDAT,CCC,CYY,CMM,CDD
          REP       " 0",WBSECDAT
          MOVE      CTIMEIS,WBSECTIM
          MOVE      SP70,WBSEUUID
          MOVE      SP70,WBSEUDAT
          MOVE      SP70,WBSEUTIM
          MOVE      SP70,WBSELACD
          MOVE      SP70,WBSELACT
.
          MOVE      SP70,WBSEEMAI                * Donot copy Email
.
          PACK      KEY10,CPSEC001
          CALL      WRWBSE1
.
          PROC      WEBSKIUP                * Generate keyword index
.
          CALL      CPLEV000              * copy security levels
          CALL      CPHOS000              * copy hospital access
          CALL      CPSIT000              * copy site access
          CALL      CPGRP000              * copy group security access
.
          MOVE      "A",UPDTTYPE
          MOVE      WBSELOGN,USERNAME
          MOVE      "password",NEWPASSW
          MOVE      "password",VERPASSW
          CALL      PASS0000
.
          MOVE      ZERO,EXIT
          GOTO      COPSEC99
.
COPSEC90  MOVE      "Copy From Security ID NOT on file",WEBTITLE
          CALL      WEBERR00
          MOVE      ONE,EXIT
          GOTO      COPSEC99
.
COPSEC91  MOVE      "Copy To Security ID already on file",WEBTITLE
          CALL      WEBERR00
          MOVE      ONE,EXIT
          GOTO      COPSEC99
.
COPSEC92  MOVE      "Security ID Mandatory.",WEBTITLE
          CALL      WEBERR00
          MOVE      ONE,EXIT
          GOTO      COPSEC99
.
COPSEC93  MOVE      "CONTACT IBA - passcode allocation full.",WEBTITLE
          CALL      WEBERR00
          MOVE      ONE,EXIT
          GOTO      COPSEC99
.
COPSEC94  MOVE      "Copy To Login Name already on file",WEBTITLE
          CALL      WEBERR00
          MOVE      ONE,EXIT
          GOTO      COPSEC99
.
COPSEC99  RETURN
.------------------------------------------------------------
.  Copy Levels from WBSEC001 to CPSEC001
.------------------------------------------------------------
CPLEV000  PACK      WBSEC001,WBSEC001,SP70
          PACK      KEY18,WBSEC001,SP70
          CALL      RSWBST1
CPLEV100  CALL      RKWBST1
          BRANCH    OVRCD,CPLEV999
          MATCH     WBSEC001,WBSTUID
          GOTO      CPLEV999 IF NOT EQUAL
.
          MOVE      CPSEC001,WBSTUID
          PACK      KEY18,WBSTUID,WBSTPRG
          CALL      RAWBST1
          BRANCH    OVRCD,CPLEV200
          GOTO      CPLEV100
.
CPLEV200  CALL      WRWBST1
          PACK      KEY18,WBSEC001,WBSTPRG
          CALL      RDWBST1
          GOTO      CPLEV100
.
CPLEV999  RETURN
.------------------------------------------------------------
.  Copy Hospital Access from WBSEC001 to CPSEC001
.------------------------------------------------------------
CPHOS000  COMPARE   ONE,IBCNMHOS
          GOTO      CPHOS999 IF NOT EQUAL
.
          PACK      WBSEC001,WBSEC001,SP70
          PACK      CPSEC001,CPSEC001,SP70
          PACK      KEY13,WBSEC001,SP70
          CALL      RDMLSEC1
          BRANCH    OVRCD,CPHOS050
          GOTO      CPHOS200
.
CPHOS050  PACK      KEY13,WBSEC001,SP70
          CALL      RSMLSEC1
CPHOS100  CALL      RKMLSEC1
          BRANCH    OVRCD,CPHOS999
          MATCH     WBSEC001,MLSCUSID
          GOTO      CPHOS999 IF NOT EQUAL
.
CPHOS200  MOVE      CPSEC001,MLSCUSID
          PACK      KEY13,MLSCUSID,MLSCHOSP,SP70
          CALL      RAMLSEC1
          BRANCH    OVRCD,CPHOS300
          GOTO      CPHOS100
.
CPHOS300  CALL      WRMLSEC1
          PACK      KEY13,WBSEC001,MLSCHOSP,SP70
          CALL      RDMLSEC1
          GOTO      CPHOS100
.
CPHOS999  RETURN
.------------------------------------------------------------
.  Copy Site Access from WBSEC001 to CPSEC001
.------------------------------------------------------------
CPSIT000  PACK      WBSEC001,WBSEC001,SP70
          PACK      CPSEC001,CPSEC001,SP70
          PACK      KEY16,WBSEC001,SP70
          CALL      RDMLSIT1
          BRANCH    OVRCD,CPSIT050
          GOTO      CPSIT200
.
CPSIT050  PACK      KEY16,WBSEC001,SP70
          CALL      RSMLSIT1
CPSIT100  CALL      RKMLSIT1
          BRANCH    OVRCD,CPSIT999
          MATCH     WBSEC001,MLSTUSID
          GOTO      CPSIT999 IF NOT EQUAL
.
CPSIT200  MOVE      CPSEC001,MLSTUSID
          PACK      KEY16,MLSTUSID,MLSTSITE,SP70
          CALL      RAMLSIT1
          BRANCH    OVRCD,CPSIT300
          GOTO      CPSIT100
.
CPSIT300  CALL      WRMLSIT1
          PACK      KEY16,WBSEC001,MLSTSITE,SP70
          CALL      RDMLSIT1
          GOTO      CPSIT100
.
CPSIT999  RETURN

.------------------------------------------------------------
.  Delete Levels from websteaf for WBSEC001
.------------------------------------------------------------
DLLEV000  PACK      KEY18,WBSEC001,SP70
          CALL      RSWBST1
DLLEV100  CALL      RKWBST1
          BRANCH    OVRCD,DLLEV999
.
          MATCH     WBSEC001,WBSTUID
          GOTO      DLLEV999 IF NOT EQUAL
.
          PACK      KEY18,WBSTUID,WBSTPRG
          CALL      DEWBST1
          GOTO      DLLEV000
.
DLLEV999  RETURN
.------------------------------------------------------------
.  Delete Hospital access from websteaf for WBSEC001
.------------------------------------------------------------
DLHOS000  COMPARE   ONE,IBCNMHOS
          GOTO      DLHOS999 IF NOT EQUAL
.
          PACK      KEY13,WBSEC001,SP70
          CALL      RDMLSEC1
          BRANCH    OVRCD,DLHOS050
.
          CALL      DEMLSEC1
.
DLHOS050  PACK      KEY13,WBSEC001,SP70
          CALL      RSMLSEC1
DLHOS100  CALL      RKMLSEC1
          BRANCH    OVRCD,DLHOS999
.
          MATCH     WBSEC001,MLSCUSID
          GOTO      DLHOS999 IF NOT EQUAL
.
          PACK      KEY13,MLSCUSID,MLSCHOSP,SP70
          CALL      DEMLSEC1
          GOTO      DLHOS000
.
DLHOS999  RETURN
.
.------------------------------------------------------------
.  Delete Site access from websitaf for WBSEC001
.------------------------------------------------------------
DLSIT000  PACK      KEY16,WBSEC001,SP70
          CALL      RDMLSIT1
          BRANCH    OVRCD,DLSIT050
.
          CALL      DEMLSIT1
.
DLSIT050  PACK      KEY16,WBSEC001,SP70
          CALL      RSMLSIT1
DLSIT100  CALL      RKMLSIT1
          BRANCH    OVRCD,DLSIT999
.
          MATCH     WBSEC001,MLSTUSID
          GOTO      DLSIT999 IF NOT EQUAL
.
          PACK      KEY16,MLSTUSID,MLSTSITE,SP70
          CALL      DEMLSIT1
          GOTO      DLSIT000
.
DLSIT999  RETURN
.
.------------------------------------------------------------
.         ADDSEC00  Add Security ID
.------------------------------------------------------------
ADDSEC00  CALL      CLWEBSEC                     * Clear file vars
.
          PACK      WBSEC001,WBSEC001,SP70
          MATCH     SP70,WBSEC001
          GOTO      ADDSEC91 IF EQUAL
          MATCH     Z70,WBSEC001
          GOTO      ADDSEC91 IF EQUAL
.    
          PACK      KEY10,WBSEC001              * Check if webseuid on file 
          CALL      RDWBSE1
          COMPARE   ZERO,OVRCD
          GOTO      ADDSEC90 IF EQUAL
.
          PACK      KEY80,WBSEC063              * Check if webselogn on file 
          CALL      RDWBSE7
          COMPARE   ZERO,OVRCD
          GOTO      ADDSEC98 IF EQUAL
.
          MATCH     Z70,WBSEC028
          GOTO      ADDSEC05 IF EQUAL
.
          MATCH     SP70,WBSEC028
          GOTO      ADDSEC05 IF EQUAL
.
          PACK      KEY4,WBSEC028,SP70           * Check finance passcode
          CALL      RDPASS1
          BRANCH    OVRCD,ADDSEC97
.
ADDSEC05  MATCH     Z70,WBSEC003
          GOTO      ADDSEC10 IF EQUAL
          GOTO      ADDSEC10 IF EOS
.
          PACK      KEY6,WBSEC003
          CALL      RDDOCT1
          BRANCH    OVRCD,ADDSEC95
.
ADDSEC10  MATCH     "1",WBSEC014                * automatic ageing of passwords
          GOTO      ADDSEC15 IF NOT EQUAL
.
          MATCH     "1",INTPASSW
          GOTO      ADDSEC15 IF NOT EQUAL
.
          MATCH     Z70,WBSEC015
          IF        @EQUAL | @EOS
            MOVE      "Please specify a number of days",WEBTITLE
            CALL      WEBERR00
            MOVE      ONE,EXIT
            GOTO      ADDSEC99
          ENDIF
.
ADDSEC15  MOVE      ONE,ADDFLAG
          CALL      STSECVAR
.
          CMATCH     "1",INTPASSW        * expire internally managed passwords  
          IF        @EQUAL             
            CALL      IBACLOCK
            PACK      WBSEEXP,CCC,CYY,CMM,CDD
            REP       " 0",WBSEEXP
          ENDIF 
.
          CALL      GNID0000                     * Generate new passcode
          BRANCH    EXIT,ADDSEC96
.
          MOVE      SECPASSC,WBSEPCD
          CALL      ALLP0000                     * Save new passcode in ihapassf
.
ADDSEC20  MOVE      USERID,WBSECUID
          PACK      WBSECDAT,CCC,CYY,CMM,CDD
          REP       " 0",WBSECDAT
          MOVE      CTIMEIS,WBSECTIM
          MOVE      SP70,WBSEUUID
          MOVE      SP70,WBSEUDAT
          MOVE      SP70,WBSEUTIM
.
          PACK      KEY10,WBSEUID
          CALL      WRWBSE1
.
          PROC      WEBSKIUP                * Generate keyword index
.
          MOVE      "A",UPDTTYPE
          MOVE      WBSELOGN,USERNAME
          MOVE      "password",NEWPASSW
          MOVE      "password",VERPASSW
          CALL      PASS0000
.
          MOVE      ZERO,EXIT
          GOTO      ADDSEC99
.
ADDSEC90  MOVE      "Security ID already on file",WEBTITLE
          CALL      WEBERR00
          MOVE      ONE,EXIT
          GOTO      ADDSEC99
.
ADDSEC91  MOVE      "Security ID Mandatory",WEBTITLE
          CALL      WEBERR00
          MOVE      ONE,EXIT
          GOTO      ADDSEC99
.
ADDSEC95  MOVE      "Invalid doctor code entered",WEBTITLE
          CALL      WEBERR00
          MOVE      ONE,EXIT
          GOTO      ADDSEC99
.
ADDSEC96  MOVE      "CONTACT IBA - passcode allocation full.",WEBTITLE
          CALL      WEBERR00
          MOVE      ONE,EXIT
          GOTO      ADDSEC99
.
ADDSEC97  MOVE      "Invalid Finance Passcode.",WEBTITLE
          CALL      WEBERR00
          MOVE      ONE,EXIT
          GOTO      ADDSEC99
.
ADDSEC98  MOVE      "Login Name already on file",WEBTITLE
          CALL      WEBERR00
          MOVE      ONE,EXIT
          GOTO      ADDSEC99
.
ADDSEC99  RETURN
.------------------------------------------------------------
.         UPDSEC00  Update Security ID
.------------------------------------------------------------
UPDSEC00  PACK      KEY10,WBSEC001
          CALL      RDWBSE1
          BRANCH    OVRCD,UPDSEC90
.         
          MATCH     Z70,WBSEC063        * No login name so skip
          GOTO      UPDSEC09 IF EQUAL
.
          PACK      WBSEC063,WBSEC063,SP70
.
          MATCH     WBSEC063,WBSELOGN   * Has login name changed? 
          GOTO      UPDSEC09 IF EQUAL
.
          PACK      KEY80,WBSEC063,SP256
          CALL      RDWBSE7
          COMPARE   ZERO,OVRCD
          GOTO      UPDSEC98 IF EQUAL
.
          CMATCH     "1",INTPASSW      * altered longname gets reset password  
          IF        @EQUAL
            CALL      IBACLOCK
            MOVE      Z70,WBSEC012 
            MOVE      "A",UPDTTYPE
            MOVE      WBSEC063,USERNAME
            MOVE      "password",NEWPASSW
            MOVE      "password",VERPASSW 
            CALL      PASS0000
          ENDIF
.
          PACK      KEY10,WBSEC001      * re-position on target record 
          CALL      RDWBSE1
          BRANCH    OVRCD,UPDSEC90
.
          PACK      WBSEEXP,CCC,CYY,CMM,CDD  * force password expiry
          REP       " 0",WBSEEXP
.
UPDSEC09  MATCH     Z70,WBSEC003
          GOTO      UPDSEC10 IF EQUAL
          GOTO      UPDSEC10 IF EOS
.
          PACK      KEY6,WBSEC003
          CALL      RDDOCT1
          BRANCH    OVRCD,UPDSEC95
.
UPDSEC10  MATCH     "1",WBSEC014
          GOTO      UPDSEC15 IF NOT EQUAL
.
          MATCH     Z70,WBSEC015
          IF        @EQUAL | @EOS
            MOVE      "Please specify a number of days",WEBTITLE
            CALL      WEBERR00
            MOVE      ONE,EXIT
            GOTO      UPDSEC99
          ENDIF
.
          MATCH     WBSEAUT,WBSEC014
          GOTO      UPDSEC15 IF EQUAL
.
          MATCH     SP70,WBSEC012
          IF        !@EQUAL
            IF        @EOS
              GOTO      UPDSEC11
            ENDIF
            MATCH     Z70,WBSEC012
            GOTO      UPDSEC15 IF NOT EQUAL
          ENDIF
.
UPDSEC11  CALL      IBACLOCK
.
          REP       " 0",XDATE                  * in case of spurious spaces
          MOVE      XDATE,WORKDATE
.
          MOVE      ZERO,FORM3
          MOVE      WBSEAGE,DIM3       * Remove spaces before move to form field
          SQUEEZE   DIM3
          MOVE      DIM3,FORM3
          ADD       FORM3,WORKDATE
          MOVE      WORKDATE,WBSEEXP   * Reset expiry date
.
UPDSEC15  MOVE      ZERO,ADDFLAG
          CALL      STSECVAR
.
          MATCH     SP70,WBSEFPCD
          GOTO      UPDSEC16 IF EQUAL
.
          PACK      KEY4,WBSEFPCD,SP70           * Update user name
          CALL      RDPASS1
          BRANCH    OVRCD,UPDSEC97
.
UPDSEC16  MOVE      USERID,WBSEUUID
          CALL      IBACLOCK
          PACK      WBSEUDAT,CC,YY,MM,DD
          REP       " 0",WBSEUDAT
          MOVE      CTIMEIS,WBSEUTIM
.
          CALL      UPWBSE1
.
          PACK      KEY4,WBSEPCD                 * Update user name 
          CALL      RDPASS1
          BRANCH    OVRCD,UPDSEC96
.
          MOVE      WBSENAM,SECUSER
          PACK      KEY4,WBSEPCD
          CALL      UPPASS1
.
          IF        CHNGHOSP=1
            MOVE      WBSEUUID,WBHOUSID
            MOVE      WBSEHOSP,WBHOHOSP
            MOVE      WBSEWRD,WBHOWARD
            MOVE      WBSEESC,WBHOSITE
            MOVE      WBSEDEPT,WBHOPRIN
            MOVE      SP70,WBHOSPAR
            PACK      KEY13,WBSEUUID,WBSEHOSP,SP70
            CALL      RAWBHSP1
            IF        OVRCD=1
              CALL      WRWBHSP1            * update/write user hosp details
            ELSE
              CALL      UPWBHSP1
            ENDIF
          ENDIF
.
          PROC      WEBSKIUP                * Generate keyword index
.
UPDSEC80  MOVE      ZERO,EXIT
          GOTO      UPDSEC99
.
UPDSEC90  MOVE      "Security ID not on file",WEBTITLE
          CALL      WEBERR00
          MOVE      ONE,EXIT
          GOTO      UPDSEC99
.
UPDSEC95  MOVE      "Invalid Doctor Code",WEBTITLE
          CALL      WEBERR00
          MOVE      ONE,EXIT
          GOTO      UPDSEC99
.
UPDSEC96  MOVE      "Invalid PassCode",WEBTITLE
          CALL      WEBERR00
          MOVE      ONE,EXIT
          GOTO      UPDSEC99
.
UPDSEC97  MOVE      "Invalid Finance PassCode",WEBTITLE
          CALL      WEBERR00
          MOVE      ONE,EXIT
          GOTO      UPDSEC99
.
UPDSEC98  MOVE      "Login Name already on file",WEBTITLE
          CALL      WEBERR00
          MOVE      ONE,EXIT
          GOTO      UPDSEC99
.
UPDSEC99  RETURN
.------------------------------------------------------------
.         DELSEC00  Delete Security ID
.------------------------------------------------------------
DELSEC00  PACK      KEY10,WBSEC001
          CALL      RDWBSE1
          BRANCH    OVRCD,DELSEC90
.
          PACK      KEY4,WBSEPCD,SP70
          CALL      RDPASS1
          BRANCH    OVRCD,DELSEC50
.
          CALL      DEPASS1
.
DELSEC50  CALL      DEWBSE1
          PACK      KEY10,WBSEC001
          CALL      RDWBPAS1
          IF        OVRCD=0
            CALL      DEWBPAS1
          ENDIF
.
          MOVE      "D",UPDTTYPE
          CALL      PASS0000
          MOVE      ZERO,EXIT
.
          CALL      DLLEV000                     * Delete security levels
          CALL      DLHOS000                     * Delete hospital access
          CALL      DLSIT000                     * Delete site access
          CALL      DLGRP000                     * Delete group security  access
.
          GOTO      DELSEC99
.
DELSEC90  MOVE      "Security ID not on file",WEBTITLE                         
          CALL      WEBERR00
          MOVE      ONE,EXIT                                
          GOTO      DELSEC99                                
.
DELSEC99  RETURN
.------------------------------------------------------------
.         LEVEL000  Security Level Maintenance
.------------------------------------------------------------
LEVEL000  MOVE      WBSEUID,SAVUID
          MOVE      WBSTPRG,SAVPRGID
          MOVE      WBSEC001,KEY10
          CALL      RDWBSE1
          BRANCH    OVRCD,LEVEL900
.
          RESET     UPDTTYPE
          MATCH     SP70,UPDTTYPE
          GOTO      LEVEL100 IF EQUAL
.
          MATCH     "A",UPDTTYPE
          IF        @EQUAL
            CALL      ADDLEV00
            GOTO      LEVEL999
          ENDIF
.
          MATCH     "U",UPDTTYPE
          IF        @EQUAL
            CALL      UPDLEV00
            GOTO      LEVEL999
          ENDIF
.
          MATCH     "D",UPDTTYPE
          IF        @EQUAL
            CALL      DELLEV00
            GOTO      LEVEL999
          ENDIF
.
          MOVE      "Invalid update type",WEBTITLE
          CALL      WEBERR00
          MOVE      ONE,EXIT
          GOTO      LEVEL999
.
LEVEL100  PACK      WBSEC001,WBSEC001,SP70
          PACK      WBSTE001,WBSTE001,SP70
          PACK      KEY18,WBSEC001,WBSTE001,SP70
          CALL      RDWBST1
          IF        OVRCD=1
            CALL      CLSECVAR
            CALL      CLSTEVAR
            MOVE      WBSEC001,WBSEUID
          ENDIF
.
          MOVE      "Security Level Maintenance",WEBTITLE
          MOVE      SAVUID,WBSEUID
          MOVE      WBSEC001,SAVUID
          CALL      WEBHED00
          MOVE      SAVUID,WBSEUID
          BRANCH    EXIT,LEVEL999
          CALL      WEBBOD00
          CALL      WEBEND00
          MOVE      ONE,EXIT
          GOTO      LEVEL999
.
LEVEL900  MOVE      "Security ID not on file",WEBTITLE
          CALL      WEBERR00
          MOVE      ONE,EXIT
          GOTO      LEVEL999
.
LEVEL990  MOVE      ZERO,EXIT
.
LEVEL999  RETURN
.------------------------------------------------------------
.         ADDLEV00  Add Security Level
.------------------------------------------------------------
ADDLEV00  PACK      WBSEC001,WBSEC001,SP70
          PACK      WBSTE001,WBSTE001,SP70
.
          PACK      KEY18,WBSEC001,WBSTE001
          CALL      RDWBST1
          IF        OVRCD=0
            GOTO      ADDLEV90
          ENDIF
.
          PACK      KEY10,WBSEC001
          CALL      RDWBSE1
.
          MOVE      WBSTE001,KEY8
          CALL      RDWBSP1
          BRANCH    OVRCD,ADDLEV98
.
          CALL      STSTEVAR
          PACK      KEY18,WBSTUID,WBSTPRG
          CALL      WRWBST1
          MOVE      ZERO,EXIT
          GOTO      ADDLEV99
.
ADDLEV90  MOVE      "Security level already on file",WEBTITLE
          CALL      WEBERR00
          MOVE      ONE,EXIT
          GOTO      ADDLEV99 
.
ADDLEV95  MOVE      "Invalid doctor code on file",WEBTITLE
          CALL      WEBERR00
          MOVE      ONE,EXIT
          GOTO      ADDLEV99
.
ADDLEV98  MOVE      "Invalid program entered",WEBTITLE
          CALL      WEBERR00
          MOVE      ONE,EXIT
          GOTO      ADDLEV99
.
ADDLEV99  RETURN
.------------------------------------------------------------
.         UPDLEV00
.------------------------------------------------------------
UPDLEV00  PACK      WBSEC001,WBSEC001,SP70
          PACK      WBSTE001,WBSTE001,SP70
.
          PACK      KEY18,WBSEC001,WBSTE001,SP70
          CALL      RDWBST1
          BRANCH    OVRCD,UPDLEV90
.
          CALL      STSTEVAR
          CALL      UPWBST1
          MOVE      ZERO,EXIT
          GOTO      UPDLEV99
.
UPDLEV90  MOVE      "Security level not on file",WEBTITLE
          CALL      WEBERR00
          MOVE      ONE,EXIT
          GOTO      UPDLEV99
.
UPDLEV99  RETURN
.------------------------------------------------------------
.         DELLEV00  Delete Security Level
.------------------------------------------------------------
DELLEV00  PACK      WBSEC001,WBSEC001,SP70
          PACK      WBSTE001,WBSTE001,SP70
.
          PACK      KEY18,WBSEC001,WBSTE001,SP70
          CALL      RDWBST1
          BRANCH    OVRCD,DELLEV90
.
          PACK      KEY18,WBSEC001,WBSTE001
          CALL      DEWBST1
          MOVE      ZERO,EXIT
          GOTO      DELLEV99
.
DELLEV90  MOVE      "Security level not on file",WEBTITLE
          CALL      WEBERR00
          MOVE      ONE,EXIT
          GOTO      DELLEV99
.
DELLEV99  RETURN
.------------------------------------------------------------
. Option 6: Web Server Details Maintenance
.------------------------------------------------------------
SERPRG00  RESET     UPDTTYPE
          MATCH     SP1,UPDTTYPE
          GOTO      SERPRG40 IF EQUAL
.
          MATCH     "A",UPDTTYPE    * Add formaction
          GOTO      SERPRG10 IF EQUAL
.
          MATCH     "U",UPDTTYPE    * Update formaction
          GOTO      SERPRG20 IF EQUAL
.
          MATCH     "D",UPDTTYPE    * Delete formaction
          GOTO      SERPRG30 IF EQUAL
.
          GOTO      SERPRG93
.
SERPRG10  CALL      CHKPRG00    * Checks mandatory fields and for blanks
          BRANCH    EXIT,SERPRG99
          PACK      KEY8,WBSPG001,SP70    * ADD FORMACTION
          CALL      RDWBSP1
          COMPARE   ZERO,OVRCD
          GOTO      SERPRG92 IF EQUAL
          CALL      PRGSAV00      * Moves input variables to file variables
          CALL      WRWBSP1       * Writes record...
          MOVE      ZERO,EXIT
          GOTO      SERPRG99
.
SERPRG20  PACK      KEY8,WBSPG001,SP70    * UPDATE FORMACTION
          CALL      RDWBSP1
          BRANCH    OVRCD,SERPRG91
          CALL      CHKPRG00      * Checks mandatory fields
          BRANCH    EXIT,SERPRG99
          CALL      RLWBSP1       * Readlock file record
          BRANCH    OVRCD,SERPRG91
          CALL      PRGSAV00      * Moves input variables to file variables
          CALL      UPWBSP1       * Writes away the data
          CALL      UUWBSP1       * Unlock file record
          MOVE      ZERO,EXIT
          GOTO      SERPRG99
.
SERPRG30  PACK      KEY8,WBSPG001,SP70    * DELETE FORMACTION
          CALL      RDWBSP1
          BRANCH    OVRCD,SERPRG91
          CALL      DEWBSP1       * Deletes the data
.        **********  Drill down 2 levels delete all Server Options & Templates 
          PACK      KEY10,KEY8,SP70
          CALL      DELALL00      * Deletes Cascading Options and Templates 
          MOVE      ZERO,EXIT
          GOTO      SERPRG99
.
SERPRG40  PACK      KEY8,WBSPG001,SP70
          CALL      RDWBSP1
          IF        OVRCD=1
            CALL      CLRPRG00    * Clear all the file variables
          ENDIF
.
          CLEAR     WEBTITLE
          MOVE      "Web Server Details Maintenance",WEBTITLE
          RESET     WEBTITLE
.
          CALL      WEBHED00   * Create Output File and Write HTML Page Header
          BRANCH    EXIT,SERPRG99
          CALL      WEBBOD00   * Process Web Body
          CALL      WEBEND00   * Process End of HTML File
          MOVE      ONE,EXIT
          GOTO      SERPRG99
.
SERPRG91  MOVE      "Web Server does not exist",WEBTITLE
          CALL      WEBERR00
          MOVE      ONE,EXIT
          GOTO      SERPRG99
.
SERPRG92  MOVE      "Web Server exists",WEBTITLE
          CALL      WEBERR00
          MOVE      ONE,EXIT
          GOTO      SERPRG99
.
SERPRG93  MOVE      "Invalid Form Action.",WEBTITLE
          CALL      WEBERR00
          MOVE      ONE,EXIT
          GOTO      SERPRG99
.
SERPRG99  RETURN
.-----------------------------------------------------------
. Initialize's file data
.-----------------------------------------------------------
CLRPRG00  MOVE      SP70,WBSPPRG
          MOVE      SP70,WBSPNAM
          MOVE      SP70,WBSPFIFO 
          MOVE      SP70,WBSPOUTD 
          MOVE      SP70,WBSPDEFT 
          MOVE      SP70,WBSPUR1   
          MOVE      SP70,WBSPUR2   
          MOVE      SP70,WBSPUD1   
          MOVE      SP70,WBSPUD2   
          MOVE      SP70,WBSPUY1   
          MOVE      SP70,WBSPUY2   
          MOVE      SP70,WBSPSPA
.
CLRPRG99  RETURN
.------------------------------------------------------------
. Moves cgi variables into file variables
.------------------------------------------------------------
PRGSAV00  MOVE      WBSPG001,KEY8
          SQUEEZE   KEY8
          MOVE      KEY8,WBSPPRG
          MOVE      WBSPG002,WBSPNAM
          MOVE      SP70,WBSPFIFO
          MOVE      SP70,WBSPOUTD
          MOVE      SP70,WBSPDEFT
          MOVE      SP70,WBSPUR1
          MOVE      SP70,WBSPUR2
          MOVE      SP70,WBSPUD1
          MOVE      SP70,WBSPUD2
          MOVE      SP70,WBSPUY1
          MOVE      SP70,WBSPUY2
          MOVE      SP70,WBSPSPA
.
PRGSAV99  RETURN
.------------------------------------------------------------
. * Checks mandatory fields for Web Server Program Details
.------------------------------------------------------------
CHKPRG00  RESET     WBSPG001       * Web Server Program Detail cannot be blank
          MATCH     SP70,WBSPG001
          GOTO      CHKPRG90 IF EQUAL
.
          RESET     WBSPG002
          MATCH     SP70,WBSPG002
          GOTO      CHKPRG91 IF EQUAL
.
          GOTO      CHKPRG98
.
CHKPRG90  MOVE      "Server ID cannot be blank.",WEBTITLE
          CALL      WEBERR00
          MOVE      ONE,EXIT
          GOTO      CHKPRG99
.
CHKPRG91  MOVE      "Server Name is mandatory!",WEBTITLE
          CALL      WEBERR00
          MOVE      ONE,EXIT
          GOTO      CHKPRG99
.
CHKPRG98  MOVE      ZERO,EXIT
CHKPRG99  RETURN
.--------------------------------------------------------------
. Deletes cascading Server Options and Server Templates 
.--------------------------------------------------------------
DELALL00  CALL      RSWBSO1
DELALL10  CALL      RKWBSO1
          BRANCH    OVRCD,DELALL99
          MATCH     KEY8,WBSOPRG
          GOTO      DELALL99 IF NOT EQUAL
          MOVE      WBSOPRG,KEY8
          MOVE      WBSOOPT,KEY2
          PACK      KEY13,KEY8,KEY2,SP70
          CALL      DLEVL000 * Delete all Templates for Option No.
          PACK      KEY10,KEY8,KEY2,SP70
          CALL      DEWBSO1  * Delete Option No.
          GOTO      DELALL10
.
DELALL99  RETURN
.------------------------------------------------------------
. Option 7: Web Server Options 
.------------------------------------------------------------
SEROPT00  RESET     UPDTTYPE
          MATCH     SP1,UPDTTYPE
          GOTO      SEROPT40 IF EQUAL
.
          MATCH     "A",UPDTTYPE    * Add formaction
          GOTO      SEROPT10 IF EQUAL
.
          MATCH     "U",UPDTTYPE    * Update formaction
          GOTO      SEROPT20 IF EQUAL
.
          MATCH     "D",UPDTTYPE    * Delete formaction
          GOTO      SEROPT30 IF EQUAL
.
          GOTO      SEROPT93
.
SEROPT10  CALL      CHKOPT00  * Checks mandatory fields & checks for blank
          BRANCH    EXIT,SEROPT99
          PACK      KEY10,WBSPG001,WBSOP001,SP70    * ADD FORMACTION
          CALL      RDWBSO1
          COMPARE   ZERO,OVRCD
          GOTO      SEROPT92 IF EQUAL
          CALL      OPTSAV00      * Moves input variables to file variables
          PACK      KEY10,WBSPG001,WBSOP001,SP70
          CALL      WRWBSO1       * Writes away the data
          MOVE      ZERO,EXIT
          GOTO      SEROPT99
.
SEROPT20  PACK      KEY10,WBSPG001,WBSOP001,SP70    * UPDATE FORMACTION
          CALL      RDWBSO1
          BRANCH    OVRCD,SEROPT91
          CALL      CHKOPT00      * Checks mandatory fields
          BRANCH    EXIT,SEROPT99
          CALL      OPTSAV00      * Moves input variables to file variables
          CALL      UPWBSO1       * Writes away the data
          MOVE      ZERO,EXIT
          GOTO      SEROPT99
.
SEROPT30  PACK      KEY10,WBSPG001,WBSOP001,SP70    * DELETE FORMACTION
          CALL      RDWBSO1
          BRANCH    OVRCD,SEROPT91
          CALL      DEWBSO1       * Deletes the data
.          **********  Drill down a level delete all Server Templates 
          MOVE      WBSPG001,KEY8
          MOVE      WBSOP001,KEY2
          PACK      KEY13,KEY8,KEY2,SP70
          CALL      DLEVL000
          MOVE      ZERO,EXIT
          GOTO      SEROPT99
.
SEROPT40  PACK      KEY8,WBSPG001,SP70
          CALL      RDWBSP1
          BRANCH    OVRCD,SEROPT94
          MOVE      WBSPPRG,PROGID
          MOVE      WBSPNAM,PROGNAM
.
          PACK      KEY10,WBSPG001,WBSOP001,SP70
          CALL      RDWBSO1
          IF        OVRCD=1
            CALL      CLROPT00    * Clear all the file variables
          ENDIF
.
          CLEAR     WEBTITLE
          MOVE      "Server Option Maintenance",WEBTITLE
          RESET     WEBTITLE
.
          CALL      WEBHED00   * Create Output File and Write HTML Page Header
          BRANCH    EXIT,SEROPT99
          CALL      WEBBOD00   * Process Web Body
          CALL      WEBEND00   * Process End of HTML File
          MOVE      ONE,EXIT
          GOTO      SEROPT99
.
SEROPT91  MOVE      "Server Option does not exist",WEBTITLE
          CALL      WEBERR00
          MOVE      ONE,EXIT
          GOTO      SEROPT99
.
SEROPT92  MOVE      "Server Option exists",WEBTITLE
          CALL      WEBERR00
          MOVE      ONE,EXIT
          GOTO      SEROPT99
.
SEROPT93  MOVE      "Invalid Form Action.",WEBTITLE
          CALL      WEBERR00
          MOVE      ONE,EXIT
          GOTO      SEROPT99
.
SEROPT94  MOVE      "Invalid Program ID.",WEBTITLE
          CALL      WEBERR00
          MOVE      ONE,EXIT
          GOTO      SEROPT99
.
SEROPT99  RETURN
.-----------------------------------------------------------
. Initialize's file data
.-----------------------------------------------------------
CLROPT00  MOVE      SP70,WBSOPRG   
          MOVE      SP70,WBSOOPT   
          MOVE      SP70,WBSODES   
          MOVE      SP70,WBSOUR1   
          MOVE      SP70,WBSOUR2   
          MOVE      SP70,WBSOUD1   
          MOVE      SP70,WBSOUD2   
          MOVE      SP70,WBSOUY1   
          MOVE      SP70,WBSOUY2  
          MOVE      SP70,WBSOSPA  
.
CLROPT99  RETURN
.------------------------------------------------------------
. Moves cgi variables into file variables
.------------------------------------------------------------
OPTSAV00  MOVE      WBSPG001,KEY8
          SQUEEZE   KEY8
          MOVE      KEY8,WBSOPRG
          MOVE      WBSOP001,F2
          MOVE      F2,WBSOOPT
          REP       " 0",WBSOOPT
          MOVE      WBSOP002,WBSODES
          MOVE      SP70,WBSOUR1
          MOVE      SP70,WBSOUR2
          MOVE      SP70,WBSOUD1
          MOVE      SP70,WBSOUD2
          MOVE      SP70,WBSOUY1
          MOVE      SP70,WBSOUY2
          MOVE      SP70,WBSOSPA
.
OPTSAV99  RETURN
.------------------------------------------------------------------
. * Checks mandatory fields for Server Options Maintenace
.------------------------------------------------------------------
CHKOPT00  RESET     WBSOP001
          MATCH     SP70,WBSOP001     
          GOTO      CHKOPT90 IF EQUAL
.
          RESET     WBSOP002
          MATCH     SP70,WBSOP002
          GOTO      CHKOPT91 IF EQUAL
.
          GOTO      CHKOPT98
.
CHKOPT90  MOVE      "Server Option Cannot be blank!",WEBTITLE
          CALL      WEBERR00
          MOVE      ONE,EXIT
          GOTO      CHKOPT99
.
CHKOPT91  MOVE      "Server Option Description is mandatory!",WEBTITLE
          CALL      WEBERR00
          MOVE      ONE,EXIT
          GOTO      CHKOPT99
.
CHKOPT98  MOVE      ZERO,EXIT
CHKOPT99  RETURN
.------------------------------------------------------------
. Deletes all Templates for Option No. 
.------------------------------------------------------------
DLEVL000  CALL      RSWBTP1
DLEVL100  CALL      RKWBTP1
          BRANCH    OVRCD,DLEVL999
          MATCH     KEY8,WBTPPRG
          GOTO      DLEVL999 IF NOT EQUAL
          MATCH     KEY2,WBTPOPT
          GOTO      DLEVL999 IF NOT EQUAL
          PACK      KEY13,WBTPPRG,WBTPOPT,WBTPTPL,SP70
          CALL      DEWBTP1
          GOTO      DLEVL100
.
DLEVL999  RETURN
.------------------------------------------------------------
. Option 8: Server Template Details Maintenace 
.------------------------------------------------------------
SERTMP00  RESET     UPDTTYPE
          MATCH     SP1,UPDTTYPE
          GOTO      SERTMP40 IF EQUAL
.
          MATCH     "A",UPDTTYPE    * Add formaction
          GOTO      SERTMP10 IF EQUAL
.
          MATCH     "U",UPDTTYPE    * Update formaction
          GOTO      SERTMP20 IF EQUAL
.
          MATCH     "D",UPDTTYPE    * Delete formaction
          GOTO      SERTMP30 IF EQUAL
.
          GOTO      SERTMP93
.
SERTMP10  CALL      CHKTMP00  * Checks mandatory fields & checks for blank
          BRANCH    EXIT,SERTMP99
          PACK      KEY13,WBSPG001,WBSOP001,WBTPL001,SP70  * ADD FORMACTION
          CALL      RDWBTP1
          COMPARE   ZERO,OVRCD
          GOTO      SERTMP92 IF EQUAL
          CALL      TMPSAV00      * Moves input variables to file variables
          CALL      WRWBTP1       * Writes away the data
          MOVE      ZERO,EXIT
          GOTO      SERTMP99
.
SERTMP20  PACK      KEY13,WBSPG001,WBSOP001,WBTPL001,SP70  * UPDATE FORMACTION
          CALL      RDWBTP1
          BRANCH    OVRCD,SERTMP91
          CALL      CHKTMP00      * Checks mandatory fields
          BRANCH    EXIT,SERTMP99
          CALL      RLWBTP1       * Readlock file record
          BRANCH    OVRCD,SERTMP91
          CALL      TMPSAV00      * Moves input variables to file variables
          CALL      UPWBTP1       * Writes away the data
          CALL      UUWBTP1       * Unlock file record
          MOVE      ZERO,EXIT
          GOTO      SERTMP99
.
SERTMP30  PACK      KEY13,WBSPG001,WBSOP001,WBTPL001,SP70   * DELETE FORMACTION
          CALL      RDWBTP1
          BRANCH    OVRCD,SERTMP91
          CALL      DEWBTP1       * Deletes the data
          MOVE      ZERO,EXIT
          GOTO      SERTMP99
.
SERTMP40  PACK      KEY8,WBSPG001,SP70
          CALL      RDWBSP1
          BRANCH    OVRCD,SERTMP94
          MOVE      WBSPPRG,PROGID
          MOVE      WBSPNAM,PROGNAM

          PACK      KEY10,WBSPG001,WBSOP001,SP70
          CALL      RDWBSO1
          BRANCH    OVRCD,SERTMP95
          MOVE      WBSOOPT,OPTNUM
          MOVE      WBSODES,OPTDESC           
.
          PACK      KEY13,WBSPG001,WBSOP001,WBTPL001,SP70
          CALL      RDWBTP1
          IF        OVRCD=1
            CALL      CLRTMP00    * Clear all the file variables
          ELSE
            MOVE      WBTPTPL,TEMPNO
            MOVE      WBTPDES,TEMPDES
            MOVE      WBTPFIL,TEMPFIL
            MOVE      WBTPLEV,TEMPLEV  
            MOVE      WBTPMTY,TEMPMTY
            MOVE      WBTPTAR,TEMPTAR
            MOVE      WBTPWID,TEMPWID
            MOVE      WBTPHIG,TEMPHIG
            MOVE      WBTPLP1,TEMPLP1
            MOVE      WBTPLP2,TEMPLP2
            MOVE      WBTPLP3,TEMPLP3
            MOVE      WBTPLP4,TEMPLP4
          ENDIF
.
          CLEAR     WEBTITLE
          MOVE      "Server Template Maintenance",WEBTITLE
          RESET     WEBTITLE
.
          CALL      WEBHED00   * Create Output File and Write HTML Page Header
          BRANCH    EXIT,SERTMP99
          CALL      WEBBOD00   * Process Web Body
          CALL      WEBEND00   * Process End of HTML File
          MOVE      ONE,EXIT
          GOTO      SERTMP99
.
SERTMP91  MOVE      "Server Template does not exist",WEBTITLE
          CALL      WEBERR00
          MOVE      ONE,EXIT
          GOTO      SERTMP99
.
SERTMP92  MOVE      "Server Template exists",WEBTITLE
          CALL      WEBERR00
          MOVE      ONE,EXIT
          GOTO      SERTMP99
.
SERTMP93  MOVE      "Invalid Form Action.",WEBTITLE
          CALL      WEBERR00
          MOVE      ONE,EXIT
          GOTO      SERTMP99
.
SERTMP94  MOVE      "Invalid Program ID.",WEBTITLE
          CALL      WEBERR00
          MOVE      ONE,EXIT
          GOTO      SERTMP99
.
SERTMP95  MOVE      "Invalid Server Option.",WEBTITLE
          CALL      WEBERR00
          MOVE      ONE,EXIT
          GOTO      SERTMP99
.
SERTMP99  RETURN
.-----------------------------------------------------------
. Initialize's file data
.-----------------------------------------------------------
CLRTMP00  MOVE      SP70,WBTPPRG   
          MOVE      SP70,WBTPOPT   
          MOVE      SP70,WBTPTPL   
          MOVE      SP70,WBTPDES   
          MOVE      SP70,WBTPFIL   
          MOVE      SP70,WBTPLEV   
          MOVE      SP70,WBTPMTY   
          MOVE      SP70,WBTPTAR   
          MOVE      SP70,WBTPWID   
          MOVE      SP70,WBTPHIG   
          MOVE      SP70,WBTPLP1   
          MOVE      SP70,WBTPLP2   
          MOVE      SP70,WBTPLP3   
          MOVE      SP70,WBTPLP4   
          MOVE      SP70,WBTPSPA   
.  
CLRTMP99  RETURN
.------------------------------------------------------------
. Moves cgi variables into file variables
.------------------------------------------------------------
TMPSAV00  MOVE      WBSPG001,KEY8
          SQUEEZE   KEY8
          MOVE      KEY8,WBTPPRG
          MOVE      WBSOP001,F2
          MOVE      F2,WBTPOPT
          REP       " 0",WBTPOPT
          MOVE      WBTPL001,F3
          MOVE      F3,WBTPTPL
          REP       " 0",WBTPTPL
          MOVE      WBTPL002,WBTPDES
          MOVE      WBTPL003,WBTPFIL
          MOVE      WBTPL004,WBTPLEV
          MOVE      WBTPL005,WBTPMTY
          MOVE      WBTPL006,WBTPTAR
          MOVE      WBTPL007,WBTPWID
          MOVE      WBTPL008,WBTPHIG
          MOVE      WBTPL009,WBTPLP1
          MOVE      WBTPL010,WBTPLP2
          MOVE      WBTPL011,WBTPLP3
          MOVE      WBTPL012,WBTPLP4
.
          MOVE      SP70,WBTPSPA   
.
TMPSAV99  RETURN
.------------------------------------------------------------------
. * Checks mandatory fields for Server Template Maintenace
.------------------------------------------------------------------
CHKTMP00  RESET     WBTPL001
          MATCH     SP70,WBTPL001
          GOTO      CHKTMP90 IF EQUAL
.
          RESET     WBTPL002
          MATCH     SP70,WBTPL002
          GOTO      CHKTMP91 IF EQUAL
.
          RESET     WBTPL003
          MATCH     SP70,WBTPL003
          GOTO      CHKTMP92 IF EQUAL
.
          GOTO      CHKTMP98
.
CHKTMP90  MOVE      "Server Template Cannot be blank!",WEBTITLE
          CALL      WEBERR00
          MOVE      ONE,EXIT
          GOTO      CHKTMP99
.
CHKTMP91  MOVE      "Server Template Description is mandatory!",WEBTITLE
          CALL      WEBERR00
          MOVE      ONE,EXIT
          GOTO      CHKTMP99
.
CHKTMP92  MOVE      "Server Template File Name is mandatory!",WEBTITLE
          CALL      WEBERR00
          MOVE      ONE,EXIT
          GOTO      CHKTMP99
.
CHKTMP98  MOVE      ZERO,EXIT
CHKTMP99  RETURN
.------------------------------------------------------------
. Option 9: Report template Master Maintenace 
.------------------------------------------------------------
RTMWEB00  RESET     UPDTTYPE
          MATCH     SP1,UPDTTYPE
          GOTO      RTMWEB40 IF EQUAL
.
          MATCH     "A",UPDTTYPE    * Add formaction
          GOTO      RTMWEB10 IF EQUAL
.
          MATCH     "U",UPDTTYPE    * Update formaction
          GOTO      RTMWEB20 IF EQUAL
.
          MATCH     "D",UPDTTYPE    * Delete formaction
          GOTO      RTMWEB30 IF EQUAL
.
          GOTO      RTMWEB93
.
.       *******************  ADD   *******************
.
RTMWEB10  CALL      CHKRTM00  * Checks mandatory fields & checks for blank
          BRANCH    EXIT,RTMWEB99
          PACK      KEY11,WBRTM001,WBRTM002,SP70
          CALL      RDWBRTM1
          COMPARE   ZERO,OVRCD
          GOTO      RTMWEB92 IF EQUAL
          CALL      RTMSAV00      * Moves input variables to file variables
          CALL      WRWBRTM1      * Writes away the data
          MOVE      ZERO,EXIT
          GOTO      RTMWEB99
.
.      ********************  UPDATE  ****************
.
RTMWEB20  PACK      KEY11,WBRTM001,WBRTM002,SP70  * UPDATE FORMACTION
          CALL      RDWBRTM1
          BRANCH    OVRCD,RTMWEB91
          CALL      CHKRTM00      * Checks mandatory fields
          BRANCH    EXIT,RTMWEB99
          CALL      RLWBRTM1      * Readlock file record
          BRANCH    OVRCD,RTMWEB91
          CALL      RTMSAV00      * Moves input variables to file variables
          CALL      UPWBRTM1      * Writes away the data
          CALL      UUWBRTM1      * Unlock file record
          MOVE      ZERO,EXIT
          GOTO      RTMWEB99
.
.       *******************   DELETE  *****************
.
RTMWEB30  PACK      KEY11,WBRTM001,WBRTM002,SP70 
          CALL      RDWBRTM1
          BRANCH    OVRCD,RTMWEB91
          CALL      DEWBRTM1      * Deletes the data
          MOVE      ZERO,EXIT
          GOTO      RTMWEB99
.
.      ********************   DISPLAY  ***********************
.
RTMWEB40  PACK      KEY11,WBRTM001,WBRTM002,SP70 
          CALL      RDWBRTM1
          IF        OVRCD=1
            CALL      CLRRTM00    * Clear all the file variables
          ENDIF
.
          CLEAR     WEBTITLE
          MOVE      "Report Template Master Maintenance",WEBTITLE
          RESET     WEBTITLE
.
          CALL      WEBHED00   * Create Output File and Write HTML Page Header
          BRANCH    EXIT,RTMWEB99
          CALL      WEBBOD00   * Process Web Body
          CALL      WEBEND00   * Process End of HTML File
          MOVE      ONE,EXIT
          GOTO      RTMWEB99
.
RTMWEB91  MOVE      "Report Template Master does not exist",WEBTITLE
          CALL      WEBERR00
          MOVE      ONE,EXIT
          GOTO      RTMWEB99
.
RTMWEB92  MOVE      "Report Template Master exists",WEBTITLE
          CALL      WEBERR00
          MOVE      ONE,EXIT
          GOTO      RTMWEB99
.
RTMWEB93  MOVE      "Invalid Form Action.",WEBTITLE
          CALL      WEBERR00
          MOVE      ONE,EXIT
          GOTO      RTMWEB99
.
RTMWEB99  RETURN
.-----------------------------------------------------------
. Initialize's file data
.-----------------------------------------------------------
CLRRTM00  MOVE      SP70,WBRTPRID  
          MOVE      SP70,WBRTTMNM  
          MOVE      SP70,WBRTDESC  
          MOVE      SP70,WBRTSPID  
          MOVE      SP70,WBRTSPAR  
.  
CLRRTM99  RETURN
.------------------------------------------------------------
. Moves cgi variables into file variables
.------------------------------------------------------------
RTMSAV00  MOVE      WBRTM001,WBRTPRID
          MOVE      WBRTM002,WBRTTMNM
          MOVE      WBRTM003,WBRTDESC
          MOVE      WBRTM004,WBRTSPID
.
          MOVE      SP70,WBRTSPAR  
.
RTMSAV99  RETURN
.------------------------------------------------------------------
. * Checks mandatory fields 
.------------------------------------------------------------------
CHKRTM00  RESET     WBRTM001
          MATCH     SP70,WBRTM001
          GOTO      CHKRTM90 IF EQUAL
.
          RESET     WBRTM002
          MATCH     SP70,WBRTM002
          GOTO      CHKRTM91 IF EQUAL
.
          GOTO      CHKRTM98
.
CHKRTM90  MOVE      "Program ID Cannot be blank!",WEBTITLE
          CALL      WEBERR00
          MOVE      ONE,EXIT
          GOTO      CHKRTM99
.
CHKRTM91  MOVE      "Template Number is mandatory!",WEBTITLE
          CALL      WEBERR00
          MOVE      ONE,EXIT
          GOTO      CHKRTM99
.
CHKRTM98  MOVE      ZERO,EXIT
CHKRTM99  RETURN
.------------------------------------------------------------
. Option 10: Report Groups Master Maintenace 
.------------------------------------------------------------
RGMWEB00  RESET     UPDTTYPE
          MATCH     SP1,UPDTTYPE
          GOTO      RGMWEB40 IF EQUAL
.
          MATCH     "A",UPDTTYPE    * Add formaction
          GOTO      RGMWEB10 IF EQUAL
.
          MATCH     "U",UPDTTYPE    * Update formaction
          GOTO      RGMWEB20 IF EQUAL
.
          MATCH     "D",UPDTTYPE    * Delete formaction
          GOTO      RGMWEB30 IF EQUAL
.
          GOTO      RGMWEB93
.
.       *******************  ADD   *******************
.
RGMWEB10  CALL      CHKRGM00  * Checks mandatory fields & checks for blank
          BRANCH    EXIT,RGMWEB99
          PACK      KEY5,WBRGM001,SP70
          CALL      RDWBRGM1
          COMPARE   ZERO,OVRCD
          GOTO      RGMWEB92 IF EQUAL
          CALL      RGMSAV00      * Moves input variables to file variables
          CALL      WRWBRGM1      * Writes away the data
          MOVE      ZERO,EXIT
          GOTO      RGMWEB99
.
.      ********************  UPDATE  ****************
.
RGMWEB20  PACK      KEY5,WBRGM001,SP70  * UPDATE FORMACTION
          CALL      RDWBRGM1
          BRANCH    OVRCD,RGMWEB91
          CALL      CHKRGM00      * Checks mandatory fields
          BRANCH    EXIT,RGMWEB99
          CALL      RLWBRGM1      * Readlock file record
          BRANCH    OVRCD,RGMWEB91
          CALL      RGMSAV00      * Moves input variables to file variables
          CALL      UPWBRGM1      * Writes away the data
          CALL      UUWBRGM1      * Unlock file record
          MOVE      ZERO,EXIT
          GOTO      RGMWEB99
.
.       *******************   DELETE  *****************
.
RGMWEB30  PACK      KEY5,WBRGM001,SP70 
          CALL      RDWBRGM1
          BRANCH    OVRCD,RGMWEB91
          CALL      DEWBRGM1      * Deletes the data
          MOVE      ZERO,EXIT
          GOTO      RGMWEB99
.
.      ********************   DISPLAY  ***********************
.
RGMWEB40  PACK      KEY5,WBRGM001,SP70 
          CALL      RDWBRGM1
          IF        OVRCD=1
            CALL      CLRRGM00    * Clear all the file variables
          ENDIF
.
          CLEAR     WEBTITLE
          MOVE      "Report Groups Master Maintenance",WEBTITLE
          RESET     WEBTITLE
.
          CALL      WEBHED00   * Create Output File and Write HTML Page Header
          BRANCH    EXIT,RGMWEB99
          CALL      WEBBOD00   * Process Web Body
          CALL      WEBEND00   * Process End of HTML File
          MOVE      ONE,EXIT
          GOTO      RGMWEB99
.
RGMWEB91  MOVE      "Report Groups Master does not exist",WEBTITLE
          CALL      WEBERR00
          MOVE      ONE,EXIT
          GOTO      RGMWEB99
.
RGMWEB92  MOVE      "Report Groups Master exists",WEBTITLE
          CALL      WEBERR00
          MOVE      ONE,EXIT
          GOTO      RGMWEB99
.
RGMWEB93  MOVE      "Invalid Form Action.",WEBTITLE
          CALL      WEBERR00
          MOVE      ONE,EXIT
          GOTO      RGMWEB99
.
RGMWEB99  RETURN
.-----------------------------------------------------------
. Initialize's file data
.-----------------------------------------------------------
CLRRGM00  MOVE      SP70,WBRGGRID  
          MOVE      SP70,WBRGDESC  
.  
CLRRGM99  RETURN
.------------------------------------------------------------
. Moves cgi variables into file variables
.------------------------------------------------------------
RGMSAV00  MOVE      WBRGM001,WBRGGRID
          MOVE      WBRGM002,WBRGDESC
.
          MOVE      SP70,WBRGSPAR  
.
RGMSAV99  RETURN
.------------------------------------------------------------------
. * Checks mandatory fields 
.------------------------------------------------------------------
CHKRGM00  RESET     WBRGM001
          MATCH     SP70,WBRGM001
          GOTO      CHKRGM90 IF EQUAL
.
          GOTO      CHKRGM98
.
CHKRGM90  MOVE      "Report Group ID Cannot be blank!",WEBTITLE
          CALL      WEBERR00
          MOVE      ONE,EXIT
          GOTO      CHKRGM99
.
CHKRGM98  MOVE      ZERO,EXIT
CHKRGM99  RETURN
.------------------------------------------------------------
. Option 11: Report Groups Details Maintenace 
.------------------------------------------------------------
RDTWEB00  RESET     UPDTTYPE
          MATCH     SP1,UPDTTYPE
          GOTO      RDTWEB40 IF EQUAL
.
          MATCH     "A",UPDTTYPE    * Add formaction
          GOTO      RDTWEB10 IF EQUAL
.
          MATCH     "U",UPDTTYPE    * Update formaction
          GOTO      RDTWEB20 IF EQUAL
.
          MATCH     "D",UPDTTYPE    * Delete formaction
          GOTO      RDTWEB30 IF EQUAL
.
          GOTO      RDTWEB93
.
.       *******************  ADD   *******************
.
RDTWEB10  CALL      CHKRDT00  * Checks mandatory fields & checks for blank
          BRANCH    EXIT,RDTWEB99
.
          PACK      KEY11,WBRDT002,WBRDT003,SP70  *Check to see template exists
          CALL      RDWBRTM1
          BRANCH    OVRCD,RDTWEB89
.
          PACK      KEY16,WBRDT001,WBRDT002,WBRDT003,SP70
          CALL      RDWBRDT1
          COMPARE   ZERO,OVRCD
          GOTO      RDTWEB92 IF EQUAL
          CALL      RDTSAV00      * Moves input variables to file variables
          CALL      WRWBRDT1      * Writes away the data
          MOVE      ZERO,EXIT
          GOTO      RDTWEB99
.
.      ********************  UPDATE  ****************
.
RDTWEB20  PACK      KEY16,WBRDT001,WBRDT002,WBRDT003,SP70  * UPDATE FORMACTION
          CALL      RDWBRDT1
          BRANCH    OVRCD,RDTWEB91
          CALL      CHKRDT00      * Checks mandatory fields
          BRANCH    EXIT,RDTWEB99
          CALL      RLWBRDT1      * Readlock file record
          BRANCH    OVRCD,RDTWEB91
          CALL      RDTSAV00      * Moves input variables to file variables
          CALL      UPWBRDT1      * Writes away the data
          CALL      UUWBRDT1      * Unlock file record
          MOVE      ZERO,EXIT
          GOTO      RDTWEB99
.
.       *******************   DELETE  *****************
.
RDTWEB30  PACK      KEY16,WBRDT001,WBRDT002,WBRDT003,SP70  
          CALL      RDWBRDT1
          BRANCH    OVRCD,RDTWEB91
          CALL      DEWBRDT1      * Deletes the data
          MOVE      ZERO,EXIT
          GOTO      RDTWEB99
.
.      ********************   DISPLAY  ***********************
.
RDTWEB40  PACK      KEY5,WBRDT001,SP70 
          CALL      RDWBRGM1
          BRANCH    OVRCD,RDTWEB90
.          
          PACK      KEY16,WBRDT001,WBRDT002,WBRDT003,SP70  
          CALL      RDWBRDT1
          IF        OVRCD=1
            CALL      CLRRDT00    * Clear all the file variables
          ENDIF
.
          CLEAR     WEBTITLE
          MOVE      "Report Group Details Maintenance",WEBTITLE
          RESET     WEBTITLE
.
          CALL      WEBHED00   * Create Output File and Write HTML Page Header
          BRANCH    EXIT,RDTWEB99
          CALL      WEBBOD00   * Process Web Body
          CALL      WEBEND00   * Process End of HTML File
          MOVE      ONE,EXIT
          GOTO      RDTWEB99
.
RDTWEB89  MOVE      "Report Template Master does not exist",WEBTITLE
          CALL      WEBERR00
          MOVE      ONE,EXIT
          GOTO      RGMWEB99
.
RDTWEB90  MOVE      "Report Groups Master does not exist",WEBTITLE
          CALL      WEBERR00
          MOVE      ONE,EXIT
          GOTO      RGMWEB99
.
RDTWEB91  MOVE      "Report Group Details does not exist",WEBTITLE
          CALL      WEBERR00
          MOVE      ONE,EXIT
          GOTO      RDTWEB99
.
RDTWEB92  MOVE      "Report Group Details exists",WEBTITLE
          CALL      WEBERR00
          MOVE      ONE,EXIT
          GOTO      RDTWEB99
.
RDTWEB93  MOVE      "Invalid Form Action.",WEBTITLE
          CALL      WEBERR00
          MOVE      ONE,EXIT
          GOTO      RDTWEB99
.
RDTWEB99  RETURN
.-----------------------------------------------------------
. Initialize's file data
.-----------------------------------------------------------
CLRRDT00  MOVE      SP70,WBRDGRID  
          MOVE      SP70,WBRDPRID  
          MOVE      SP70,WBRDTMID  
.  
CLRRDT99  RETURN
.------------------------------------------------------------
. Moves cgi variables into file variables
.------------------------------------------------------------
RDTSAV00  MOVE      WBRDT001,WBRDGRID
          MOVE      WBRDT002,WBRDPRID
          MOVE      WBRDT003,WBRDTMID
.
          MOVE      SP70,WBRDSPAR  
.
RDTSAV99  RETURN
.------------------------------------------------------------------
. * Checks mandatory fields 
.------------------------------------------------------------------
CHKRDT00  RESET     WBRDT001
          MATCH     SP70,WBRDT001
          GOTO      CHKRDT90 IF EQUAL
.
          RESET     WBRDT002
          MATCH     SP70,WBRDT002
          GOTO      CHKRDT91 IF EQUAL
.
          RESET     WBRDT003
          MATCH     SP70,WBRDT003
          GOTO      CHKRDT92 IF EQUAL
.
          GOTO      CHKRDT98
.
CHKRDT90  MOVE      "Report Group ID Cannot be blank!",WEBTITLE
          CALL      WEBERR00
          MOVE      ONE,EXIT
          GOTO      CHKRDT99
.
CHKRDT91  MOVE      "Program ID Cannot be blank!",WEBTITLE
          CALL      WEBERR00
          MOVE      ONE,EXIT
          GOTO      CHKRDT99
.
CHKRDT92  MOVE      "Template ID Cannot be blank!",WEBTITLE
          CALL      WEBERR00
          MOVE      ONE,EXIT
          GOTO      CHKRDT99
.
CHKRDT98  MOVE      ZERO,EXIT
CHKRDT99  RETURN
.------------------------------------------------------------
. Option 12: Web User Report Groups Maintenace 
.------------------------------------------------------------
RURWEB00  RESET     UPDTTYPE
          MATCH     SP1,UPDTTYPE
          GOTO      RURWEB40 IF EQUAL
.
          MATCH     "A",UPDTTYPE    * Add formaction
          GOTO      RURWEB10 IF EQUAL
.
          MATCH     "U",UPDTTYPE    * Update formaction
          GOTO      RURWEB20 IF EQUAL
.
          MATCH     "D",UPDTTYPE    * Delete formaction
          GOTO      RURWEB30 IF EQUAL
.
          GOTO      RURWEB93
.
.       *******************  ADD   *******************
.
RURWEB10  CALL      CHKRUR00  * Checks mandatory fields & checks for blank
          BRANCH    EXIT,RURWEB99
          PACK      KEY15,WBRUR001,WBRUR002,SP70
          CALL      RDWBRUR1
          COMPARE   ZERO,OVRCD
          GOTO      RURWEB92 IF EQUAL
          CALL      RURSAV00      * Moves input variables to file variables
          CALL      WRWBRUR1      * Writes away the data
          MOVE      ZERO,EXIT
          GOTO      RURWEB99
.
.      ********************  UPDATE  ****************
.
RURWEB20  PACK      KEY15,WBRUR001,WBRUR002,SP70  * UPDATE FORMACTION
          CALL      RDWBRUR1
          BRANCH    OVRCD,RURWEB91
          CALL      CHKRUR00      * Checks mandatory fields
          BRANCH    EXIT,RURWEB99
          CALL      RLWBRUR1      * Readlock file record
          BRANCH    OVRCD,RURWEB91
          CALL      RURSAV00      * Moves input variables to file variables
          CALL      UPWBRUR1      * Writes away the data
          CALL      UUWBRUR1      * Unlock file record
          MOVE      ZERO,EXIT
          GOTO      RURWEB99
.
.       *******************   DELETE  *****************
.
RURWEB30  PACK      KEY15,WBRUR001,WBRUR002,SP70  
          CALL      RDWBRUR1
          BRANCH    OVRCD,RURWEB91
          CALL      DEWBRUR1      * Deletes the data
          MOVE      ZERO,EXIT
          GOTO      RURWEB99
.
.      ********************   DISPLAY  ***********************
.
RURWEB40  PACK      KEY15,WBRUR001,WBRUR002,SP70  
          CALL      RDWBRUR1
          IF        OVRCD=1
            CALL      CLRRUR00    * Clear all the file variables
          ENDIF
.
          CLEAR     WEBTITLE
          MOVE      "Web User Report Groups Maintenance",WEBTITLE
          RESET     WEBTITLE
.
          CALL      WEBHED00   * Create Output File and Write HTML Page Header
          BRANCH    EXIT,RURWEB99
          CALL      WEBBOD00   * Process Web Body
          CALL      WEBEND00   * Process End of HTML File
          MOVE      ONE,EXIT
          GOTO      RURWEB99
.
RURWEB91  MOVE      "Report Group does not exist",WEBTITLE
          CALL      WEBERR00
          MOVE      ONE,EXIT
          GOTO      RURWEB99
.
RURWEB92  MOVE      "Report Group exists",WEBTITLE
          CALL      WEBERR00
          MOVE      ONE,EXIT
          GOTO      RURWEB99
.
RURWEB93  MOVE      "Invalid Form Action.",WEBTITLE
          CALL      WEBERR00
          MOVE      ONE,EXIT
          GOTO      RURWEB99
.
RURWEB99  RETURN
.-----------------------------------------------------------
. Initialize's file data
.-----------------------------------------------------------
CLRRUR00  MOVE      SP70,WBRUUSID  
          MOVE      SP70,WBRUGRID  
.  
CLRRUR99  RETURN
.------------------------------------------------------------
. Moves cgi variables into file variables
.------------------------------------------------------------
RURSAV00  MOVE      WBRUR001,WBRUUSID
          MOVE      WBRUR002,WBRUGRID
.
          MOVE      SP70,WBRUSPAR  
.
RURSAV99  RETURN
.------------------------------------------------------------------
. * Checks mandatory fields 
.------------------------------------------------------------------
CHKRUR00  RESET     WBRUR001
          MATCH     SP70,WBRUR001
          GOTO      CHKRUR90 IF EQUAL
.
          RESET     WBRUR002
          MATCH     SP70,WBRUR002
          GOTO      CHKRUR91 IF EQUAL
.
          GOTO      CHKRUR98
.
CHKRUR90  MOVE      "Web User ID Cannot be blank!",WEBTITLE
          CALL      WEBERR00
          MOVE      ONE,EXIT
          GOTO      CHKRUR99
.
CHKRUR91  MOVE      "Report Group ID Cannot be blank!",WEBTITLE
          CALL      WEBERR00
          MOVE      ONE,EXIT
          GOTO      CHKRUR99
.
CHKRUR98  MOVE      ZERO,EXIT
CHKRUR99  RETURN
.------------------------------------------------------------
. Open Files and Initialize Variables
.------------------------------------------------------------
INIT0000  OPEN      CONTROLF,"controlf"
          READ      CONTROLF,ZERO;*43,IBCNMHOS
          READ      CONTROLF,NINETY1;*19,CWEBPCMD,*59,CWEBPFIL
          READ      CONTROLF,HUND13;*51,OPCNURSE
          READ      CONTROLF,HUND25;*238,PTCNNRTD
.
          SCAN      "ibapasswd",CWEBPCMD
          IF        @EQUAL
            MOVE      "1",INTPASSW 
          ELSE
            MOVE      "0",INTPASSW
          ENDIF
          RESET     CWEBPCMD
.
          MOVE      ZERO,F2
          MOVE      PTCNNRTD,F2
          IF        F2 = 0
            MOVE      "10",PTCNNRTD
          ENDIF
.
          OPEN      EMRSITA1,"emrsitaf"
          OPEN      IBACODE1,"ibacodef"
          OPEN      IBADPTA1,"ibadptaf"
          OPEN      OUTSITA1,"outsitaf"
          OPEN      MRTLOCA1,"mrtlocaf"
          OPEN      PATCODE1,"patcodes"
          OPEN      PATCODE2,"patcodes"
          OPEN      PATDO1A1,"patdo1af"
          OPEN      PATHSPA1,"pathspaf"
          OPEN      PMSHCPA1,"pmshcpaf"
          OPEN      PMSHCGA1,"pmshcgaf"
          OPEN      PATWR1A1,"patwr1af"
          OPEN      PATWR1A3,"patwr1af"
          OPEN      PATWR1A7,"patwr1af"
.
          OPEN      WEBERRA1,"weberraf"
          OPEN      WEBERRA2,"weberraf"
          OPEN      WEBGRPA1,"webgrpaf"
          OPEN      WEBGRPA2,"webgrpaf"
          OPEN      WEBHSPA1,"webhspaf"
          OPEN      WEBSKIA1,"webskiaf"
          OPEN      WEBSKIA2,"webskiaf"
          OPEN      WEBSGPA1,"websgpaf"
          OPEN      WEBSPGA1,"webspgaf"
          OPEN      WEBSOPA1,"websopaf"
          OPEN      WEBTPLA1,"webtplaf"
          OPEN      WEBRTMA1,"webrtmaf"
          OPEN      WEBRGMA1,"webrgmaf"
          OPEN      WEBRDTA1,"webrdtaf"
          OPEN      WEBRURA1,"webruraf"
          OPEN      WEBPASA1,"webpasaf"
          OPEN      IHAPASS1,"ihapassf"
          OPEN      IBACUSA2,"ibacusaf"
.
          OPEN      PRIALSA1,"prialsaf"
          OPEN      PRISECA2,"prisecaf"
          OPEN      OPRNURA1,"oprnuraf"
.
.
. Open outpatient file with site prefix
.
          MOVE      "out",CFILEPRE       * Save Current File Prefix
          CALL      OPNOUT00             * Open Outpatient Files
.
          OPEN      MLTSITA1,"mltsitaf"
.
          IF        IBCNMHOS=1
            OPEN      MLTCODA1,"mltcodaf"
            OPEN      MLTCODA2,"mltcodaf"
            OPEN      MLTSECA1,"mltsecaf"
          ENDIF
.
          RETURN
.
.*******************************************************************************
.                    Open Outpateint Files
.*******************************************************************************
OPNOUT00  PACK      CFNAME,CFILEPRE,FILCLIA1  * Get the name of the CLIA1 file
          CLOSE     OUTCLIA1
          OPEN      OUTCLIA1,CFNAME           * Open the file
.
OPNOUT99  RETURN
.
.*******************************************************************************
. COTFIL00 - Check that the correct outpatient site prefix files are open
.            according to the user id site code. If the site is invalid
.            or blank just open the default site of out.

.*******************************************************************************
COTFIL00  MATCH     SP70,WBSESIT             * Does the user have a site
          GOTO      COTFIL50 IF NOT EQUAL
.
COTFIL10  MATCH     "out",CFILEPRE           * Is out currently open
          IF        !@EQUAL
            MOVE      "out",OSTFILE          * open default prefix of out
            MOVE      OSTFILE,CFILEPRE       * Save Current File Prefix
            CALL      OPNOUT00               * Open out Outpatient Files
          ENDIF
.
          GOTO      COTFIL99
.
COTFIL50  MOVE      WBSESIT,KEY6
          CALL      RDSITA1
          BRANCH    OVRCD,COTFIL10           * error invalid site code
.
          MATCH     OSTFILE,CFILEPRE         * Save Current File Prefix
          IF        !@EQUAL
            MOVE      OSTFILE,CFILEPRE       * Save Current File Prefix
            CALL      OPNOUT00               * Open prefixed Outpatient Files
          ENDIF
.
          GOTO      COTFIL99
.
COTFIL99  RETURN
.
.------------------------------------------------------------
. Clear Parameters
.-------------------------------------------------------------
CLRPAR00  MOVE      SP70,FLTUSRID
          MOVE      SP70,FLTPRGID
          MOVE      SP70,ERRORKEY
          MOVE      SP70,VIEWTYPE
          MOVE      SP70,FRSTDATE
          MOVE      SP70,LASTDATE
          MOVE      SP70,VYEARMTH
          MOVE      ZERO,CHNGHOSP
          MOVE      SP70,NEXTPAGE
          PACK      REDIRECT,SP70,SP70,SP70,SP70
          MOVE      ZERO,NORECORD
          MOVE      SP70,STARTNUM
          MOVE      SP70,UPDTTYPE 
          MOVE      SP70,USERUID  
          MOVE      SP256,USERNAME 
          MOVE      SP256,PASSWORD 
          MOVE      SP256,NEWPASSW
          MOVE      SP256,VERPASSW
          MOVE      ZERO,ADDFLAG
          MOVE      SP70,WEBUSEID
          MOVE      SP70,WBIDNAME
          MOVE      ZERO,STARTNUM
          MOVE      SP70,STARTKEY
          MOVE      SP70,PROGID
          MOVE      SP70,PROGNAM
          MOVE      SP70,OPTNUM
          MOVE      SP70,OPTDESC
          MOVE      SP70,TEMPNO
          MOVE      SP70,TEMPDES
          MOVE      SP70,TEMPFIL
          MOVE      SP70,TEMPLEV
          MOVE      SP70,TEMPMTY
          MOVE      SP70,TEMPTAR
          MOVE      SP70,TEMPWID
          MOVE      SP70,TEMPHIG
          MOVE      SP70,TEMPLP1
          MOVE      SP70,TEMPLP2
          MOVE      SP70,TEMPLP3
          MOVE      SP70,TEMPLP4
          MOVE      ZERO,SWAPUSER
          MOVE      SP70,WARDFLAG
          MOVE      SP70,RECVFLAG
          MOVE      SP70,MRHOSFLG
          PACK      SWAPTURL,SP256     
          MOVE      SP70,MANDWARD
          MOVE      SP70,FILTACTV
          MOVE      SP70,FILTHOSP
          MOVE      ZERO,SHOWPASS
          MOVE      SP70,KEYWORDS
          MOVE      SP70,FILTREPT
          MOVE      SP70,FILTSERV
          MOVE      SP70,FILTTEMP
          MOVE      SP70,FILTUSID
          MOVE      SP70,FILTOCCG
          MOVE      SP70,FILTCLOC
          MOVE      SP70,FILTCLID
          MOVE      SP70,FILTWARD
          MOVE      SP70,FILTESIT
          MOVE      SP70,FILTOSIT
.
          MOVE      Z70,WBGRP001
          MOVE      Z70,WBGRP002
          MOVE      Z70,WBGRP003
          MOVE      Z70,WBGRP004
.
          MOVE      Z70,CPSEC001
          MOVE      Z70,CPSEC002
          MOVE      Z70,CPSEC063
.
          MOVE      Z70,WBSEC001
          MOVE      Z70,WBSEC002
          MOVE      Z70,WBSEC003
          MOVE      Z70,WBSEC004
          MOVE      Z70,WBSEC005
          MOVE      Z70,WBSEC006
          MOVE      Z70,WBSEC007
          MOVE      Z70,WBSEC008
          MOVE      Z70,WBSEC009
          MOVE      Z70,WBSEC010
          MOVE      ZERO,WBSEC011
          MOVE      Z70,WBSEC012
          MOVE      ZERO,WBSEC013
          MOVE      Z70,WBSEC014
          MOVE      Z70,WBSEC015
.
          MOVE      Z70,WBSEC016
          MOVE      Z70,WBSEC017
          MOVE      Z70,WBSEC018
          MOVE      Z70,WBSEC019
          MOVE      Z70,WBSEC020
          MOVE      Z70,WBSEC021
          MOVE      Z70,WBSEC022
          MOVE      Z70,WBSEC023
          MOVE      Z70,WBSEC024
          MOVE      Z70,WBSEC025
          MOVE      Z70,WBSEC026
          MOVE      Z70,WBSEC027
          MOVE      Z70,WBSEC028
          MOVE      Z70,WBSEC029
          MOVE      Z70,WBSEC030
          MOVE      Z70,WBSEC031
          MOVE      Z70,WBSEC032
          MOVE      Z70,WBSEC033
          MOVE      Z70,WBSEC034
          MOVE      Z70,WBSEC035
          MOVE      Z70,WBSEC036
          MOVE      Z70,WBSEC037
          MOVE      Z70,WBSEC038
          MOVE      Z70,WBSEC039
          MOVE      Z70,WBSEC040
          MOVE      Z70,WBSEC041
          MOVE      Z70,WBSEC042
          MOVE      Z70,WBSEC043
          MOVE      Z70,WBSEC044
          MOVE      Z70,WBSEC045
          MOVE      Z70,WBSEC046
          MOVE      Z70,WBSEC047
          MOVE      Z70,WBSEC048
          MOVE      Z70,WBSEC049
          MOVE      Z70,WBSEC050
          MOVE      Z70,WBSEC051
          MOVE      Z70,WBSEC052
          MOVE      Z70,WBSEC053
          MOVE      Z70,WBSEC054
          MOVE      Z70,WBSEC055
          MOVE      Z70,WBSEC056
          MOVE      Z70,WBSEC057
          MOVE      Z70,WBSEC058
          MOVE      Z70,WBSEC059
          MOVE      Z70,WBSEC060
          MOVE      Z70,WBSEC061
          PACK      WBSEC062,Z70,Z70
          PACK      WBSEC063,Z70,Z70
          MOVE      Z70,WBSEC064
          MOVE      Z70,WBSEC065
.
          MOVE      Z70,WBSTE001
          MOVE      ZERO,WBSTE002
          MOVE      Z70,WBSTE003
          MOVE      Z70,WBSTE004
          MOVE      Z70,WBSTE005
          MOVE      Z70,WBSTE006
          MOVE      Z70,WBSTE007
. 
          MOVE      SP70,WBSPG001  
          MOVE      SP70,WBSPG002  
          MOVE      SP70,WBSPG003  
          MOVE      SP70,WBSPG004  
          MOVE      SP70,WBSPG005  
          MOVE      SP70,WBSPG006  
          MOVE      SP70,WBSPG007  
          MOVE      SP70,WBSPG008  
          MOVE      SP70,WBSPG009  
          MOVE      SP70,WBSPG010  
          MOVE      SP70,WBSPG011  
.
          MOVE      SP70,WBSOP001  
          MOVE      SP70,WBSOP002  
          MOVE      SP70,WBSOP003  
          MOVE      SP70,WBSOP004  
          MOVE      SP70,WBSOP005  
          MOVE      SP70,WBSOP006  
          MOVE      SP70,WBSOP007  
          MOVE      SP70,WBSOP008  
.
          MOVE      SP70,WBTPL001  
          MOVE      SP70,WBTPL002  
          MOVE      SP70,WBTPL003  
          MOVE      SP70,WBTPL004  
          MOVE      SP70,WBTPL005  
          MOVE      SP70,WBTPL006  
          MOVE      SP70,WBTPL007  
          MOVE      SP70,WBTPL008  
          MOVE      SP70,WBTPL009  
          MOVE      SP70,WBTPL010  
          MOVE      SP70,WBTPL011  
          MOVE      SP70,WBTPL012  
.
          MOVE      SP70,WBRTM001
          MOVE      SP70,WBRTM002
          MOVE      SP70,WBRTM003
          MOVE      SP70,WBRTM004
.
          MOVE      SP70,WBRGM001
          MOVE      SP70,WBRGM002
.
          MOVE      SP70,WBRDT001
          MOVE      SP70,WBRDT002 
          MOVE      SP70,WBRDT003
.
          MOVE      SP70,WBRUR001
          MOVE      SP70,WBRUR002
          MOVE      SP70,SECLEVEL
.
          MOVE      ONE,LHOSPCNT
          WHILE     LHOSPCNT <= 200
            MOVE      SP70,LHOSPARR[LHOSPCNT]
            ADD       ONE,LHOSPCNT
          DO
.
          MOVE      ONE,LSITECNT
          WHILE     LSITECNT <= 200
            MOVE      SP70,LSITPARR[LSITECNT]
            ADD       ONE,LSITECNT
          DO

.
          MOVE      ZERO,LHOSPCNT
          MOVE      ZERO,LSITECNT
.
          MOVE      ONE,GROUPCNT
          WHILE     GROUPCNT <= 99
            MOVE      SP70,GROUPARR[GROUPCNT]
            ADD       ONE,GROUPCNT
          DO
.
          MOVE      ZERO,GROUPCNT
.
          MOVE      ONE,MARKINDX
          WHILE     MARKINDX <= 250
            MOVE      SP70,MARKEDKY[MARKINDX]
            ADD       ONE,MARKINDX
          DO
.
          MOVE      ZERO,MARKINDX
          MOVE      SP70,FHIRLONG
.
          MOVE      ZERO,COKIEFLG
.
          RETURN
.------------------------------------------------------------
. Set Parameters
.------------------------------------------------------------
SETPAR00  MATCH     "fltusrid=",QRYNAME
          IF        @EQUAL
            PACK      FLTUSRID,QRYDATA,SP70
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "fltprgid=",QRYNAME
          IF        @EQUAL
            PACK      FLTPRGID,QRYDATA,SP70
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "swapturl=",QRYNAME
          IF        @EQUAL
            PACK      SWAPTURL,QRYDATA,SP70
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "swapuser=",QRYNAME
          IF        @EQUAL
            MOVE      QRYDATA,SWAPUSER
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "wardflag=",QRYNAME
          IF        @EQUAL
            MOVE      QRYDATA,WARDFLAG
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "recvflag=",QRYNAME
          IF        @EQUAL
            MOVE      QRYDATA,RECVFLAG
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "mrhosflg=",QRYNAME
          IF        @EQUAL
            MOVE      QRYDATA,MRHOSFLG
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "errorkey=",QRYNAME
          IF        @EQUAL
            PACK      ERRORKEY,QRYDATA,SP70
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "viewtype=",QRYNAME
          IF        @EQUAL
            MOVE      QRYDATA,VIEWTYPE
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "frstdate=",QRYNAME 
          IF        @EQUAL
            MOVE      QRYDATA,FRSTDATE
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "lastdate=",QRYNAME
          IF        @EQUAL
            MOVE      QRYDATA,LASTDATE
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "vyearmth=",QRYNAME
          IF        @EQUAL
            MOVE      QRYDATA,VYEARMTH
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "cpsec001=",QRYNAME
          IF        @EQUAL
            MOVE      QRYDATA,CPSEC001
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "cpsec002=",QRYNAME
          IF        @EQUAL
            MOVE      QRYDATA,CPSEC002
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "cpsec063=",QRYNAME
          IF        @EQUAL
            MOVE      QRYDATA,CPSEC063
            MATCH     "0",INTPASSW
            IF        @EQUAL
              REPLACE   LOWUPP,CPSEC063     
            ENDIF
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "chnghosp=",QRYNAME
          IF        @EQUAL
            MOVE      QRYDATA,CHNGHOSP
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "nextpage=",QRYNAME
          IF        @EQUAL
            MOVE      QRYDATA,NEXTPAGE
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "redirect=",QRYNAME
          IF        @EQUAL
            MOVE      QRYDATA,REDIRECT
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "norecord=",QRYNAME
          IF        @EQUAL
            MOVE      QRYDATA,NORECORD
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "startnum=",QRYNAME
          IF        @EQUAL
            MOVE      QRYDATA,STARTNUM
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "updttype=",QRYNAME
          IF        @EQUAL
            MOVE      QRYDATA,UPDTTYPE
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "webuseid=",QRYNAME
          IF        @EQUAL
            MOVE      QRYDATA,WEBUSEID
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "wbidname=",QRYNAME
          IF        @EQUAL
            MOVE      QRYDATA,WBIDNAME
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "startkey=",QRYNAME
          IF        @EQUAL
            MOVE      QRYDATA,STARTKEY
            PACK      STARTKEY,STARTKEY,SP70
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "useruid=",QRYNAME
          IF        @EQUAL
            MOVE      QRYDATA,USERUID 
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "username=",QRYNAME
          IF        @EQUAL
            MOVE      QRYDATA,USERNAME
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "password=",QRYNAME
          IF        @EQUAL
            MOVE      QRYDATA,PASSWORD
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "newpassw=",QRYNAME
          IF        @EQUAL
            MOVE      QRYDATA,NEWPASSW
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "verpassw=",QRYNAME
          IF        @EQUAL
            MOVE      QRYDATA,VERPASSW
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "mandward=",QRYNAME
          IF        @EQUAL
            PACK      MANDWARD,QRYDATA,SP70
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "filtactv=",QRYNAME
          IF        @EQUAL
            PACK      FILTACTV,QRYDATA,SP70
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "filtrept=",QRYNAME
          IF        @EQUAL
            PACK      FILTREPT,QRYDATA,SP70
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "seclevel=",QRYNAME
          IF        @EQUAL
            PACK      SECLEVEL,QRYDATA,SP70
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "filtserv=",QRYNAME
          IF        @EQUAL
            PACK      FILTSERV,QRYDATA,SP70
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "filttemp=",QRYNAME
          IF        @EQUAL
            PACK      FILTTEMP,QRYDATA,SP70
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "filthosp=",QRYNAME
          IF        @EQUAL
            PACK      FILTHOSP,QRYDATA,SP70
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "showpass=",QRYNAME
          IF        @EQUAL
            MOVE      QRYDATA,SHOWPASS
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "wbsec",QRYNAME
          IF        @EQUAL
            CALL      WBSEC000
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "wbste",QRYNAME
          IF        @EQUAL
            CALL      WBSTE000
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "wbspg",QRYNAME
          IF        @EQUAL
            CALL      WBPRG000
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "wbsop",QRYNAME
          IF        @EQUAL
            CALL      WBOPT000
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "wbtpl",QRYNAME
          IF        @EQUAL
            CALL      WBTMP000
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "wbrtm",QRYNAME
          IF        @EQUAL
            CALL      WBTEM000
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "wbrgm",QRYNAME
          IF        @EQUAL
            CALL      WBGRU000
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "wbrdt",QRYNAME
          IF        @EQUAL
            CALL      WBDET000
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "wbrur",QRYNAME
          IF        @EQUAL
            CALL      WBUSE000
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "lhosparr=",QRYNAME
          IF        @EQUAL
            COMPARE   "200",LHOSPCNT
            GOTO      SETPAR99 IF EQUAL
            ADD       ONE,LHOSPCNT
            PACK      LHOSPARR[LHOSPCNT],QRYDATA,SP70
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "lsitparr=",QRYNAME
          IF        @EQUAL
            COMPARE   "200",LSITECNT
            GOTO      SETPAR99 IF EQUAL
            ADD       ONE,LSITECNT
            PACK      LSITPARR[LSITECNT],QRYDATA,SP70
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "wbgrp",QRYNAME
          IF        @EQUAL
            CALL      WBGRP000
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "grouparr=",QRYNAME
          IF        @EQUAL
            COMPARE   "99",GROUPCNT
            GOTO      SETPAR99 IF EQUAL
.
            ADD       ONE,GROUPCNT
            PACK      GROUPARR[GROUPCNT],QRYDATA,SP70
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "keywords=",QRYNAME
          IF        @EQUAL
            MOVE      QRYDATA,KEYWORDS
            REP       "~'",KEYWORDS
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "markedky=",QRYNAME
          IF        @EQUAL
            CALL      STMPKY00
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "filtusid=",QRYNAME
          IF        @EQUAL
            PACK      FILTUSID,QRYDATA,SP70
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "filtoccg=",QRYNAME
          IF        @EQUAL
            PACK      FILTOCCG,QRYDATA,SP70
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "filtcloc=",QRYNAME
          IF        @EQUAL
            PACK      FILTCLOC,QRYDATA,SP70
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "filtclid=",QRYNAME
          IF        @EQUAL
            PACK      FILTCLID,QRYDATA,SP70
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "filtward=",QRYNAME
          IF        @EQUAL
            PACK      FILTWARD,QRYDATA,SP70
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "filtesit=",QRYNAME
          IF        @EQUAL
            PACK      FILTESIT,QRYDATA,SP70
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "filtosit=",QRYNAME
          IF        @EQUAL
            PACK      FILTOSIT,QRYDATA,SP70
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "fhirlong=",QRYNAME
          IF        @EQUAL
            PACK      FHIRLONG,QRYDATA,SP70
            GOTO      SETPAR99
          ENDIF
.
SETPAR99  RETURN
.------------------------------------------------------------
.         WBSTE000  Store User Server Security Query Data
.------------------------------------------------------------
WBSTE000  MOVE      ZERO,EXIT
          UNPACK    QRYNAME,KEY5,KEY3
          MOVE      KEY3,F3
          STORE     QRYDATA,F3,WBSTE001,WBSTE002,WBSTE003,WBSTE004,WBSTE005:
                               WBSTE006,WBSTE007,WBSTE008
.
WBSTE999  RETURN
.------------------------------------------------------------
.         WBSEC000  Store Web Security Query Data
.------------------------------------------------------------
WBSEC000  MOVE      ZERO,EXIT
          UNPACK    QRYNAME,KEY5,KEY3
          MOVE      KEY3,F3
          STORE     QRYDATA,F3,WBSEC001,WBSEC002,WBSEC003,WBSEC004,WBSEC005:
                               WBSEC006,WBSEC007,WBSEC008,WBSEC009,WBSEC010:
                               WBSEC011,WBSEC012,WBSEC013,WBSEC014,WBSEC015:
                               WBSEC016,WBSEC017,WBSEC018,WBSEC019,WBSEC020:
                               WBSEC021,WBSEC022,WBSEC023,WBSEC024,WBSEC025:
                               WBSEC026,WBSEC027,WBSEC028,WBSEC029,WBSEC030:
                               WBSEC031,WBSEC032,WBSEC033,WBSEC034,WBSEC035:
                               WBSEC036,WBSEC037,WBSEC038,WBSEC039,WBSEC040:
                               WBSEC041,WBSEC042,WBSEC043,WBSEC044,WBSEC045:
                               WBSEC046,WBSEC047,WBSEC048,WBSEC049,WBSEC050:
                               WBSEC051,WBSEC052,WBSEC053,WBSEC054,WBSEC055:
                               WBSEC056,WBSEC057,WBSEC058,WBSEC059,WBSEC060:
                               WBSEC061,WBSEC062,WBSEC063,WBSEC064,WBSEC065
.
          IF        F3=1 
            PACK      WBSEC001,WBSEC001,SP70           * web uid 
          ENDIF
          IF        F3=28
            PACK      WBSEC028,WBSEC028,SP70           * Finance Passcode
          ENDIF
          IF        F3=63
            MATCH     "0",INTPASSW
            IF        @EQUAL
              REPLACE   LOWUPP,WBSEC063            * Fold loginname to lowercase
            ENDIF
          ENDIF
.
WBSEC999  RETURN
.-------------------------------------------------------------------------------
.   Set Parameters for Option 6: Web Server Program Details 
.-------------------------------------------------------------------------------
WBPRG000  MOVE      ZERO,EXIT
          UNPACK    QRYNAME,KEY5,KEY3
          MOVE      KEY3,F3
          BRANCH    F3,WBPRG001,WBPRG002,WBPRG003,WBPRG004,WBPRG005:
                       WBPRG006,WBPRG007,WBPRG008,WBPRG009,WBPRG010:
                       WBPRG011
.
          MOVE      ONE,EXIT
          GOTO      WBPRG999
.
WBPRG001  SQUEEZE   QRYDATA
          MOVE      QRYDATA,WBSPG001
          PACK      WBSPG001,WBSPG001,SP70
          GOTO      WBPRG999
WBPRG002  MOVE      QRYDATA,WBSPG002
          GOTO      WBPRG999
WBPRG003  MOVE      QRYDATA,WBSPG003
          GOTO      WBPRG999
WBPRG004  MOVE      QRYDATA,WBSPG004
          GOTO      WBPRG999
WBPRG005  MOVE      QRYDATA,WBSPG005
          GOTO      WBPRG999
WBPRG006  MOVE      QRYDATA,WBSPG006
          GOTO      WBPRG999
WBPRG007  MOVE      QRYDATA,WBSPG007
          GOTO      WBPRG999
WBPRG008  MOVE      QRYDATA,WBSPG008
          GOTO      WBPRG999
WBPRG009  MOVE      QRYDATA,WBSPG009
          GOTO      WBPRG999
WBPRG010  MOVE      QRYDATA,WBSPG010
          GOTO      WBPRG999
WBPRG011  MOVE      QRYDATA,WBSPG011
          GOTO      WBPRG999
.
WBPRG999  RETURN
.-------------------------------------------------------------------------------
.   Set Parameters for Option 7: Web Server Options 
.-------------------------------------------------------------------------------
WBOPT000  MOVE      ZERO,EXIT
          UNPACK    QRYNAME,KEY5,KEY3
          MOVE      KEY3,F3
          BRANCH    F3,WBOPT001,WBOPT002,WBOPT003,WBOPT004,WBOPT005:
                       WBOPT006,WBOPT007,WBOPT008
.
          MOVE      ONE,EXIT
          GOTO      WBOPT999
.
WBOPT001  MOVE      QRYDATA,F2
          MOVE      F2,WBSOP001
          REP       " 0",WBSOP001 
          GOTO      WBOPT999
WBOPT002  MOVE      QRYDATA,WBSOP002
          GOTO      WBOPT999
WBOPT003  MOVE      QRYDATA,WBSOP003
          GOTO      WBOPT999
WBOPT004  MOVE      QRYDATA,WBSOP004
          GOTO      WBOPT999
WBOPT005  MOVE      QRYDATA,WBSOP005
          GOTO      WBOPT999
WBOPT006  MOVE      QRYDATA,WBSOP006
          GOTO      WBOPT999
WBOPT007  MOVE      QRYDATA,WBSOP007
          GOTO      WBOPT999
WBOPT008  MOVE      QRYDATA,WBSOP008
          GOTO      WBOPT999
.
WBOPT999  RETURN
.-------------------------------------------------------------------------------
.   Set Parameters for Option 8: Web Server Templates Details 
.-------------------------------------------------------------------------------
WBTMP000  MOVE      ZERO,EXIT
          UNPACK    QRYNAME,KEY5,KEY3
          MOVE      KEY3,F3
          BRANCH    F3,WBTMP001,WBTMP002,WBTMP003,WBTMP004,WBTMP005:
                       WBTMP006,WBTMP007,WBTMP008,WBTMP009,WBTMP010:
                       WBTMP011,WBTMP012
.
          MOVE      ONE,EXIT
          GOTO      WBTMP999
.
WBTMP001  MOVE      QRYDATA,F3
          MOVE      F3,WBTPL001
          REP       " 0",WBTPL001 
          GOTO      WBTMP999
WBTMP002  MOVE      QRYDATA,WBTPL002
          GOTO      WBTMP999
WBTMP003  MOVE      QRYDATA,WBTPL003
          GOTO      WBTMP999
WBTMP004  MOVE      QRYDATA,WBTPL004
          GOTO      WBTMP999
WBTMP005  MOVE      QRYDATA,WBTPL005
          GOTO      WBTMP999
WBTMP006  MOVE      QRYDATA,WBTPL006
          GOTO      WBTMP999
WBTMP007  MOVE      QRYDATA,WBTPL007
          GOTO      WBTMP999
WBTMP008  MOVE      QRYDATA,WBTPL008
          GOTO      WBTMP999
WBTMP009  MOVE      QRYDATA,WBTPL009
          GOTO      WBTMP999
WBTMP010  MOVE      QRYDATA,WBTPL010
          GOTO      WBTMP999
WBTMP011  MOVE      QRYDATA,WBTPL011
          GOTO      WBTMP999
WBTMP012  MOVE      QRYDATA,WBTPL012
          GOTO      WBTMP999
.
WBTMP999  RETURN
.-------------------------------------------------------------------------------
.   Set Parameters for Option 9: Report Template Master Details 
.-------------------------------------------------------------------------------
WBTEM000  MOVE      ZERO,EXIT
          UNPACK    QRYNAME,KEY5,KEY3
          MOVE      KEY3,F3
          BRANCH    F3,WBTEM001,WBTEM002,WBTEM003,WBTEM004
.
          MOVE      ONE,EXIT
          GOTO      WBTEM999
.
WBTEM001  SQUEEZE   QRYDATA
          MOVE      QRYDATA,WBRTM001
          PACK      WBRTM001,WBRTM001,SP70
          GOTO      WBTEM999
.
WBTEM002  MOVE      QRYDATA,WBRTM002
          GOTO      WBTEM999
WBTEM003  MOVE      QRYDATA,WBRTM003
          GOTO      WBTEM999
WBTEM004  MOVE      QRYDATA,WBRTM004
          GOTO      WBTEM999
.
WBTEM999  RETURN
.-------------------------------------------------------------------------------
.   Set Parameters for Option 10: Report Group Master Details 
.-------------------------------------------------------------------------------
WBGRU000  MOVE      ZERO,EXIT
          UNPACK    QRYNAME,KEY5,KEY3
          MOVE      KEY3,F3
          BRANCH    F3,WBGRU001,WBGRU002
.
          MOVE      ONE,EXIT
          GOTO      WBGRU999
.
WBGRU001  SQUEEZE   QRYDATA
          MOVE      QRYDATA,WBRGM001
          PACK      WBRGM001,WBRGM001,SP70
          GOTO      WBGRU999
.
WBGRU002  MOVE      QRYDATA,WBRGM002
          GOTO      WBGRU999
.
WBGRU999  RETURN
.-------------------------------------------------------------------------------
.   Set Parameters for Option 11: Report Group Details 
.-------------------------------------------------------------------------------
WBDET000  MOVE      ZERO,EXIT
          UNPACK    QRYNAME,KEY5,KEY3
          MOVE      KEY3,F3
          BRANCH    F3,WBDET001,WBDET002,WBDET003
.
          MOVE      ONE,EXIT
          GOTO      WBDET999
.
WBDET001  SQUEEZE   QRYDATA
          MOVE      QRYDATA,WBRDT001
          PACK      WBRDT001,WBRDT001,SP70
          GOTO      WBDET999
.
WBDET002  SQUEEZE   QRYDATA
          MOVE      QRYDATA,WBRDT002
          PACK      WBRDT002,WBRDT002,SP70
          GOTO      WBDET999
.
WBDET003  SQUEEZE   QRYDATA
          MOVE      QRYDATA,WBRDT003
          PACK      WBRDT003,WBRDT003,SP70
          GOTO      WBDET999
.
WBDET999  RETURN
.-------------------------------------------------------------------------------
.   Set Parameters for Option 12: Web User Report Groups
.-------------------------------------------------------------------------------
WBUSE000  MOVE      ZERO,EXIT
          UNPACK    QRYNAME,KEY5,KEY3
          MOVE      KEY3,F3
          BRANCH    F3,WBUSE001,WBUSE002
.
          MOVE      ONE,EXIT
          GOTO      WBUSE999
.
WBUSE001  SQUEEZE   QRYDATA
          MOVE      QRYDATA,WBRUR001
          PACK      WBRUR001,WBRUR001,SP70
          GOTO      WBUSE999
.
WBUSE002  SQUEEZE   QRYDATA
          MOVE      QRYDATA,WBRUR002
          PACK      WBRUR002,WBRUR002,SP70
          GOTO      WBUSE999
.
WBUSE999  RETURN
.------------------------------------------------------------
. Process Fields 
.------------------------------------------------------------
PROFLD00  BRANCH    REPORTNO,PROFLD10,PROFLD20,PROFLD30,PROFLD40,PROFLD50:
                             PROFLD60,PROFLD70,PROFLD80,PROFLD90,PROFL100:
                             PROFL110,PROFL120,PROFL130,PROFL140,PROFL150
          GOTO      PROFLD99
.
PROFLD10  GOTO      PROFLD99
.
PROFLD20  BRANCH    FLDSETNO,PROFLD21
          GOTO      PROFLD99
.
PROFLD21  CALL      USEC0000
          GOTO      PROFLD99
.
PROFLD30  BRANCH    FLDSETNO,PROFLD31
          GOTO      PROFLD99
.
PROFLD31  CALL      WSEC0000
          GOTO      PROFLD99 
.
PROFLD40  BRANCH    FLDSETNO,PROFLD41
. 
PROFLD41  CALL      WSTE0000
          GOTO      PROFLD99
.
PROFLD50  BRANCH    FLDSETNO,PROFLD51
. 
PROFLD51  CALL      WSEC0000
          GOTO      PROFLD99
.
. Web Server Program Details 
.
PROFLD60  CALL      WBPG0000     * Web Server Program Details 
          GOTO      PROFLD99
.
. Web Server Options 
.
PROFLD70  CALL      WBSO0000     * Web Server Options 
          GOTO      PROFLD99
.
. Web Server Templates 
.
PROFLD80  CALL      WBTP0000     * Web Server Templates 
          GOTO      PROFLD99
.
. Report Template Master Maintanence 
.
PROFLD90  CALL      RTMW0000     * Report Template Master
          GOTO      PROFLD99
.
. Report Groups Master Maintanence 
.
PROFL100  CALL      RGMW0000     * Report Groups Master
          GOTO      PROFLD99
.
. Report Groups Details Maintanence 
.
PROFL110  BRANCH    FLDSETNO,PROFL111,PROFL112
.
PROFL111  CALL      RGMW0000     * Report Groups Master
          GOTO      PROFLD99
.
PROFL112  CALL      RDTW0000     * Report Group Details
          GOTO      PROFLD99
.
. Web User Report Groups
.
PROFL120  CALL      RURW0000     * Web User Report Groups
          GOTO      PROFLD99
.
. Web Errors Generated by WMASTER
.
PROFL130  CALL      ERRW0000     * Web Errors
          GOTO      PROFLD99

. Web Security Groups
.
PROFL140  CALL      WBGR0000     * Web Security Groups
          GOTO      PROFLD99
.
. Template Security Maintenance
.
PROFL150  CALL      TTAG0000     * Template Security Maintenance Tags
          GOTO      PROFLD99
.
PROFLD99  RETURN
.------------------------------------------------------------
. ERRW0000 - Web Server Errors
.------------------------------------------------------------
ERRW0000  BRANCH    FLDITMNO,ERRW0100,ERRW0200,ERRW0300,ERRW0400,ERRW0500:
                             ERRW0600,ERRW0700,ERRW0800,ERRW0900,ERRW1000:
                             ERRW1100,ERRW1200,ERRW1300,ERRW1400,ERRW1500:
                             ERRW1600,ERRW1700,ERRW1800,ERRW1900,ERRW2000:
                             ERRW2100
          WRITE     HTMLFILE;"Invalid Tag";
          GOTO      ERRW9999
.
ERRW0100  CALL      NXTPER00
          GOTO      ERRW9999
.
ERRW0200  CALL      PREPER00
          GOTO      ERRW9999
.
ERRW0300  CALL      CURSTD00
          GOTO      ERRW9999
.
ERRW0400  CALL      CUREND00
          GOTO      ERRW9999
.
ERRW0500  CALL      CURYR000
          GOTO      ERRW9999
.
ERRW0600  CALL      CURMON00
          GOTO      ERRW9999
.
ERRW0700  CALL      SELV0000
          GOTO      ERRW9999
.
ERRW0800  CALL      ETABA000        * Table of Errors
          GOTO      ERRW9999
.
ERRW0900  WRITE     HTMLFILE;VIEWTYPE;
          GOTO      ERRW9999
.
ERRW1000  WRITE     HTMLFILE;FLTUSRID;
          GOTO      ERRW9999
.
ERRW1100  WRITE     HTMLFILE;FLTPRGID;
          GOTO      ERRW9999
.
ERRW1200  MATCH     SP70,WBERPID
          GOTO      ERRW9999 IF EQUAL
          WRITE     HTMLFILE;WBERPID; * Program ID
          GOTO      ERRW9999
.
ERRW1300  MATCH     SP70,WBERDAT
          GOTO      ERRW9999 IF EQUAL
          UNPACK    WBERDAT,CCENT,CYEAR,CMON,CDAY
          MATCH     "00",CDAY
          GOTO      ERRW9999 IF EQUAL
          MOVE      CMON,F2
          LOAD      MTHNAM3,F2,JAN,FEB,MAR,APR,MAY,JUN,JUL,AUG,SEP,OCT,NOV,DEC
          WRITE     HTMLFILE;CDAY,SP1,MTHNAM3,SP1,CCENT,CYEAR
          GOTO      ERRW9999
.
ERRW1400  MATCH     SP70,WBERTIM
          GOTO      ERRW9999 IF EQUAL
          WRITE     HTMLFILE;WBERTIM; * Error Time
          GOTO      ERRW9999
.
ERRW1500  MATCH     SP70,WBERUID
          GOTO      ERRW9999 IF EQUAL
          WRITE     HTMLFILE;WBERUID; * User ID
          GOTO      ERRW9999
.
ERRW1600  MATCH     SP70,WBERREP
          GOTO      ERRW9999 IF EQUAL
          WRITE     HTMLFILE;WBERREP; * Report No
          GOTO      ERRW9999
.
ERRW1700  MATCH     SP70,WBERTMP
          GOTO      ERRW9999 IF EQUAL
          WRITE     HTMLFILE;WBERTMP; * Template
          GOTO      ERRW9999
.
ERRW1800  MATCH     SP70,WBERURN
          GOTO      ERRW9999 IF EQUAL
          WRITE     HTMLFILE;WBERURN; * U/R
          GOTO      ERRW9999
.
ERRW1900  MATCH     SP70,WBERVIS
          GOTO      ERRW9999 IF EQUAL
          WRITE     HTMLFILE;WBERVIS; * Visit No
          GOTO      ERRW9999
.
ERRW2000  MATCH     SP70,WBERCNT
          GOTO      ERRW9999 IF EQUAL
          WRITE     HTMLFILE;WBERCNT; * Server Error Count
          GOTO      ERRW9999
.
ERRW2100  MATCH     SP70,WBERERR
          GOTO      ERRW9999 IF EQUAL
          WRITE     HTMLFILE;WBERERR; * Program Error
          GOTO      ERRW9999
.
ERRW9999  RETURN
.------------------------------------------------------------
. Error Table
.------------------------------------------------------------
ETABA000  MOVE      ZERO,DISNUMB
          MOVE      ZERO,RECNUMB
          PACK      KEY24,LASTDATE,Z70
          CALL      RSWBER2
ETABA100  CALL      RPWBER2
          BRANCH    OVRCD,ETABA999
          MATCH     FRSTDATE,WBERDAT
          GOTO      ETABA999 IF LESS
.
          MATCH     SP70,FLTUSRID             * Filter by User
          IF        !@EQUAL
            MATCH     FLTUSRID,WBERUID
            GOTO      ETABA100 IF NOT EQUAL
          ENDIF
.
          MATCH     SP70,FLTPRGID             * Filter by Program
          IF        !@EQUAL
            MATCH     FLTPRGID,WBERPID
            GOTO      ETABA100 IF NOT EQUAL
          ENDIF
.
          ADD       ONE,RECNUMB
          IF        STARTNUM>=RECNUMB
            GOTO      ETABA100
          ENDIF
.
          CALL      EROWA000
.
          ADD       ONE,DISNUMB
          IF        DISNUMB<50
            GOTO      ETABA100
          ENDIF
.
          WRITE     HTMLFILE;"alert('Too Many Rows to Output. Use Filters');"
          WRITE     HTMLFILE;"viewMore('",RECNUMB,"');"
.
ETABA999  RETURN
.-----------------------------------------------------------
. Output Error Row
.-----------------------------------------------------------
EROWA000  PACK      KEY24,WBERPID,WBERDAT,WBERTIM,SP70
          WRITE     HTMLFILE;"t.addRow(":
                    QUOTE,"javascript:ViewError('",KEY24,"');",QUOTE,COMMA:
                    QUOTE,WBERDAT,WBERTIM,QUOTE,COMMA:
                    QUOTE,WBERUID,QUOTE,COMMA:
                    QUOTE,WBERPID,QUOTE,COMMA:
                    QUOTE,WBERREP,QUOTE,COMMA:
                    QUOTE,WBERTMP,QUOTE,COMMA:
                    QUOTE,WBERURN,QUOTE,COMMA:
                    QUOTE,WBERVIS,QUOTE,COMMA:
                    QUOTE,WBERCNT,QUOTE,COMMA:
                    QUOTE,WBERERR,QUOTE,");"
EROWA999  RETURN
.------------------------------------------------------------
.         USEC0000
.------------------------------------------------------------
USEC0000  BRANCH    FLDITMNO,USEC0100,USEC0200,USEC0300
.
USEC0100  WRITE     HTMLFILE;WBSEUID;
          GOTO      USEC9999
.
USEC0200  WRITE     HTMLFILE;WBSENAM;
          GOTO      USEC9999
.
USEC0300  WRITE     HTMLFILE;WBSELOGN;
          GOTO      USEC9999
.
USEC9999  RETURN
.------------------------------------------------------------
.         WSEC0000
.------------------------------------------------------------
WSEC0000  BRANCH    FLDITMNO,WSEC0100,WSEC0200,WSEC0300,WSEC0400,WSEC0500:
                             WSEC0600,WSEC0700,WSEC0800,WSEC0900,WSEC1000:
                             WSEC1100,WSEC1200,WSEC1300,WSEC1400,WSEC1500:
                             WSEC1600,WSEC1700,WSEC1800,WSEC1900,WSEC2000:
                             WSEC2100,WSEC2200,WSEC2300,WSEC2400,WSEC2500:
                             WSEC2600,WSEC2700,WSEC2800,WSEC2900,WSEC3000:
                             WSEC3100,WSEC3200,WSEC3300,WSEC3400,WSEC3500:
                             WSEC3600,WSEC3700,WSEC3800,WSEC3900,WSEC4000:
                             WSEC4100,WSEC4200,WSEC4300,WSEC4400,WSEC4500:
                             WSEC4600,WSEC4700,WSEC4800,WSEC4900,WSEC5000:
                             WSEC5100,WSEC5200,WSEC5300,WSEC5400,WSEC5500:
                             WSEC5600,WSEC5700,WSEC5800,WSEC5900,WSEC6000:
                             WSEC6100,WSEC6200,WSEC6300,WSEC6400,WSEC6500:
                             WSEC6600,WSEC6700,WSEC6800,WSEC6900,WSEC7000:
                             WSEC7100,WSEC7200,WSEC7300,WSEC7400,WSEC7500:
                             WSEC7600,WSEC7700,WSEC7800,WSEC7900,WSEC8000:
                             WSEC8100,WSEC8200,WSEC8300,WSEC8400,WSEC8500:
                             WSEC8600,WSEC8700,WSEC8800,WSEC8900,WSEC9000:
                             WSEC9100,WSEC9200,WSEC9300,WSEC9400,WSEC9500:
                             WSEC9600
.
          WRITE     HTMLFILE;"Invalid Tag - WSEC";
          GOTO      WSEC9999
.
WSEC0100  MATCH     SP70,WBSEUID
          GOTO      WSEC9999 IF EQUAL
          WRITE     HTMLFILE;WBSEUID;
          GOTO      WSEC9999
.
WSEC0200  MATCH     SP70,WBSENAM
          GOTO      WSEC9999 IF EQUAL
          WRITE     HTMLFILE;WBSENAM;
          GOTO      WSEC9999
.
WSEC0300  UNPACK    DIM127,D1,KEY1,DIM127
          MATCH     SP70,WBSEDOC
          GOTO      WSEC9999 IF EQUAL
          MOVE      ZERO,F1
          MOVE      KEY1,F1
          BRANCH    F1,WSEC0310             * 0=description, 1=code
.
          MOVE      WBSEDOC,KEY6
          CALL      RDDOCT1
          MOVE      DTITL,FMTTITLE
          MOVE      DGNAME,FMTGNAME
          MOVE      DSNAME,FMTSNAME
          CALL      DOCNM000
          WRITE     HTMLFILE;DOCFNAME;
          GOTO      WSEC9999
.
WSEC0310  WRITE     HTMLFILE;WBSEDOC;
          GOTO      WSEC9999
.
WSEC0400  MATCH     SP70,WBSEPCD
          GOTO      WSEC9999 IF EQUAL
          WRITE     HTMLFILE;WBSEPCD;
          GOTO      WSEC9999
.
WSEC0500  UNPACK    DIM127,D1,KEY1,DIM127
          MOVE      ZERO,F1
          MOVE      KEY1,F1
          BRANCH    F1,WSEC0510,WSEC0520    0=desc, 1=code, 2=select
.
          MATCH     SP70,WBSEWRD            * Description
          GOTO      WSEC9999 IF EQUAL  
          PACK      KEY6,WBSEWRD
          CALL      RDWARD1
          BRANCH    OVRCD,WSEC9999
          WRITE     HTMLFILE;WBDESC;
          GOTO      WSEC9999
.
WSEC0510  MATCH     SP70,WBSEWRD            * Code
          GOTO      WSEC9999 IF EQUAL
          WRITE     HTMLFILE;WBSEWRD;
          GOTO      WSEC9999
.
WSEC0520  PACK      DFLTWARD,WBSEWRD
          CALL      WSEL0000                * ward
          GOTO      WSEC9999
.
WSEC0600  CALL      OUTSIT00                * emergency location 
          GOTO      WSEC9999
.
WSEC0700  MATCH     SP70,WBSECLI
          GOTO      WSEC9999 IF EQUAL
          WRITE     HTMLFILE;WBSECLI;
          GOTO      WSEC9999
.
WSEC0800  MOVE      WBSEOCG,CODE
          MOVE      "w0",CATEGORY
          CALL      CODITM00
          GOTO      WSEC9999
.
WSEC0900  MATCH     SP70,WBSEDIR
          GOTO      WSEC9999 IF EQUAL
          WRITE     HTMLFILE;WBSEDIR;
          GOTO      WSEC9999
.
WSEC1000  CALL      LOCSIT00
          GOTO      WSEC9999
.
WSEC1100  UNPACK    DIM127,D1,KEY1,DIM127
          MOVE      ZERO,F1
          MOVE      KEY1,F1
          BRANCH    F1,WSEC1150
          MATCH     "1",WBSEACT
          IF        @EQUAL
            WRITE     HTMLFILE;"Yes";
          ELSE
            WRITE     HTMLFILE;"No";
          ENDIF
          GOTO      WSEC9999
.
WSEC1150  MATCH     "1",WBSEACT
          IF        @EQUAL
            WRITE     HTMLFILE;ONE;
          ELSE
            WRITE     HTMLFILE;ZERO;
          ENDIF
          GOTO      WSEC9999
.
WSEC1200  MATCH     SP70,WBSEEXP
          GOTO      WSEC9999 IF EQUAL 
          UNPACK    WBSEEXP,CCENT,CYEAR,CMON,CDAY
          MATCH     "00",CDAY
          GOTO      WSEC9999 IF EQUAL
          MOVE      CMON,F2
          LOAD      MTHNAM3,F2,JAN,FEB,MAR,APR,MAY,JUN,JUL,AUG,SEP,OCT,NOV,DEC
          WRITE     HTMLFILE;CDAY,SP1,MTHNAM3,SP1,CCENT,CYEAR
          GOTO      WSEC9999
.
WSEC1300  UNPACK    DIM127,D1,KEY1,DIM127
          MOVE      ZERO,F1
          MOVE      KEY1,F1
          BRANCH    F1,WSEC1350
          MATCH     "1",WBSEPSE
          IF        @EQUAL
            WRITE     HTMLFILE;"Yes";
          ELSE
            WRITE     HTMLFILE;"No";
          ENDIF
          GOTO      WSEC9999
.
WSEC1350  MATCH     "1",WBSEPSE
          IF        @EQUAL 
            WRITE     HTMLFILE;ONE;
          ELSE
            WRITE     HTMLFILE;ZERO;
          ENDIF
          GOTO      WSEC9999
. 
WSEC1400  MOVE      ZERO,LNK2PRT              * Table of Security ID's
          CALL      SECTAB00                  
          GOTO      WSEC9999 
.
WSEC1500  CALL      NEXT0000                  * link to next group
          GOTO      WSEC9999 
.
WSEC1600  CALL      PREV0000                  * link to last group
          GOTO      WSEC9999 
.
WSEC1700  UNPACK    DIM127,D1,KEY1,DIM127
          MOVE      ZERO,F1
          MOVE      KEY1,F1
          BRANCH    F1,WSEC1750
          MATCH     "1",WBSEAUT
          IF        @EQUAL
            WRITE     HTMLFILE;"Yes";
          ELSE
            WRITE     HTMLFILE;"No";
          ENDIF
          GOTO      WSEC9999
.
WSEC1750  MATCH     "1",WBSEAUT
          IF        @EQUAL
            WRITE     HTMLFILE;ONE;
          ELSE
            WRITE     HTMLFILE;ZERO;
          ENDIF
          GOTO      WSEC9999
.
WSEC1800  MATCH     SP70,WBSEAGE
          GOTO      WSEC9999 IF EQUAL
.
          WRITE     HTMLFILE;WBSEAGE;
          GOTO      WSEC9999 
.
WSEC1900  MATCH     SP70,WBSEDFM
          GOTO      WSEC9999 IF EQUAL
.
          WRITE     HTMLFILE;WBSEDFM;
          GOTO      WSEC9999
.
WSEC2000  UNPACK    DIM127,D1,KEY1,DIM127
          MOVE      ZERO,F1
          MOVE      KEY1,F1
          BRANCH    F1,WSEC2010,WSEC2020    * 0=code, 1=select, 2=sel for hosp
.
          MATCH     SP70,WBSEDEPT
          GOTO      WSEC9999 IF EQUAL
          WRITE     HTMLFILE;WBSEDEPT;
          GOTO      WSEC9999
.
WSEC2010  CALL      DSEL0000                * printer dept
          GOTO      WSEC9999
.
WSEC2020  CALL      DSELH000                * printer dept for hospital
          GOTO      WSEC9999
.
WSEC2100  UNPACK    DIM127,D1,KEY1,DIM127
          MATCH     SP70,WBSEGPCD
          GOTO      WSEC9999 IF EQUAL
          MOVE      ZERO,F1
          MOVE      KEY1,F1
          BRANCH    F1,WSEC2110             * 0=description, 1=code
.
          PACK      KEY10,WBSEGPCD,SP70
          CALL      RDPMHCP1
          BRANCH    OVRCD,WSEC2110
          MOVE      PMHCTITL,FMTTITLE
          MOVE      PMHCSNAM,FMTSNAME
          MOVE      PMHCGNAM,FMTGNAME
          CALL      DOCNM000
          WRITE     HTMLFILE;DOCFNAME;
          GOTO      WSEC9999
.
WSEC2110  WRITE     HTMLFILE;WBSEGPCD;
          GOTO      WSEC9999
.
WSEC2200  UNPACK    DIM127,D1,KEY1,DIM127
          MATCH     SP70,WBSEGPPC
          GOTO      WSEC9999 IF EQUAL
          MOVE      ZERO,F1
          MOVE      KEY1,F1
          BRANCH    F1,WSEC2210,WSEC2220    * 0=desc., 1=GP Prac code, 2=Count
.
          PACK      KEY10,WBSEGPPC,SP70
          PACK      KEY12,KEY10,WBSEGPCN,SP70
          CALL      RDPMHCG1
          WRITE     HTMLFILE;PMHGPNAM;
          GOTO      WSEC9999
.
WSEC2210  WRITE     HTMLFILE;WBSEGPPC;
          GOTO      WSEC9999
.
WSEC2220  WRITE     HTMLFILE;WBSEGPCN;
          GOTO      WSEC9999
.
WSEC2300  MOVE      WBSEDALL,CODE
          MOVE      "CG",CATEGORY
          CALL      CODSEL00
          GOTO      WSEC9999
.
WSEC2400  MOVE      WBSEDTYP,CODE
          MOVE      "TY",CATEGORY
          CALL      CODITM00
          GOTO      WSEC9999
.
WSEC2500  OPEN      CONTROLF,"controlf"
          READ      CONTROLF,SIXTY;*105,MRCNHMTY
          PACK      KEY7,SP70                                         *C-240724
          CALL      RSMRLOC1
WSEC2550  CALL      RKMRLOC1
          BRANCH    OVRCD,WSEC9999
.
          MATCH     MRLOTYPE,MRCNHMTY
          GOTO      WSEC2550 IF NOT EQUAL
.
          COMPARE   ONE,MRLOSTAT                   * I-49202
          GOTO      WSEC2550 IF EQUAL
.
          MATCH     WBSEHLOC,MRLOCODE
          IF        @EQUAL
            WRITE     HTMLFILE;"<option value=#"",MRLOCODE,"#" selected>":
                               MRLODESC,"</option>"
          ELSE
            WRITE     HTMLFILE;"<option value=#"",MRLOCODE,"#">",MRLODESC:
                               "</option>"
          ENDIF
          GOTO      WSEC2550
.
WSEC2600  MOVE      ZERO,SECCOUNT
          MOVE      SP70,SECCOUND
.
WSEC2610  ADD       ONE,SECCOUNT                  * I SRF 22514
          MOVE      SECCOUNT,SECCOUND
          MATCH     SECCOUND,WBSEVWSL
          IF        @EQUAL
            WRITE     HTMLFILE;"<option value=#"",SECCOUNT,"#" selected>":
                               SECCOUNT,"</option>"
          ELSE
            WRITE     HTMLFILE;"<option value=#"",SECCOUNT,"#">",SECCOUNT:
                               "</option>"
          ENDIF
          COMPARE   NINE,SECCOUNT
          GOTO      WSEC2610 IF NOT EQUAL
          GOTO      WSEC9999
.
WSEC2700  MOVE      ZERO,SECCOUNT
          MOVE      SP70,SECCOUND
.
WSEC2710  ADD       ONE,SECCOUNT                  
          MOVE      SECCOUNT,SECCOUND
          MATCH     SECCOUND,WBSEADSL
          IF        @EQUAL
            WRITE     HTMLFILE;"<option value=#"",SECCOUNT,"#" selected>":
                               SECCOUNT,"</option>"
          ELSE
            WRITE     HTMLFILE;"<option value=#"",SECCOUNT,"#">",SECCOUNT:
                               "</option>"
          ENDIF
          COMPARE   NINE,SECCOUNT
          GOTO      WSEC2710 IF NOT EQUAL
          GOTO      WSEC9999                    * end I SRF 22514
.
WSEC2800  MOVE      WBSEDGSI,CODE
          MOVE      "YD",CATEGORY
          CALL      CODITM00
          GOTO      WSEC9999
.
WSEC2900  WRITE     HTMLFILE;WBSECASH;
          GOTO      WSEC9999
.
WSEC3000  MATCH     SP70,WBSEFPCD               * Finance passcode
          GOTO      WSEC9999 IF EQUAL
          WRITE     HTMLFILE;WBSEFPCD;
          GOTO      WSEC9999
. 
WSEC3100  MOVE      ONE,LNK2PRT         * Table of Security ID's with 
          CALL      SECTAB00            * UpdateParent()
          GOTO      WSEC9999 
.
WSEC3200  PACK      KEY10,WBSEUID,SP70   * Private Practice All Sec Record
          CALL      RDPRALS1
          IF        OVRCD=1
            WRITE     HTMLFILE;ZERO;
          ELSE
            WRITE     HTMLFILE;ONE;
          ENDIF
          GOTO      WSEC9999 
.
WSEC3300  MATCH     SP70,WBSEMRTS               * MRT Security Number
          GOTO      WSEC9999 IF EQUAL
          WRITE     HTMLFILE;WBSEMRTS;
          GOTO      WSEC9999
.
WSEC3400  UNPACK    DIM127,D1,KEY1,DIM127
          MOVE      ZERO,F1
          MOVE      KEY1,F1
          BRANCH    F1,WSEC3410,WSEC3420,WSEC3430,WSEC3440,WSEC3450,WSEC3430
.
. 0=desc 1=code 2=select 3=field 4=select(w/home loc) 5=select hospital allowed
. 6=Option 3 for Add screen
.
          MATCH     SP70,WBSEHOSP
          GOTO      WSEC9999 IF EQUAL
          MOVE      WBSEHOSP,KEY3
          CALL      RDPTHSP1
          WRITE     HTMLFILE;PTHSNAME;
          GOTO      WSEC9999
.
WSEC3410  WRITE     HTMLFILE;WBSEHOSP;
          GOTO      WSEC9999
.
WSEC3420  MOVE      WBSEHOSP,DIM3
          CALL      HSEL0000
          GOTO      WSEC9999
.
WSEC3430  COMPARE   ONE,IBCNMHOS
          IF        !@EQUAL
            UNPACK    DIM127,D1,KEY1,DIM127
            WRITE     HTMLFILE;"<td>&nbsp;</td><td>&nbsp;</td>";
            GOTO      WSEC9999
          ENDIF
.
          MOVE      F1,FORM1                * save screen type (3=Update 6=Add)
.
          UNPACK    DIM127,D1,KEY1,DIM127
          MOVE      ZERO,F1
          MOVE      KEY1,F1
.
          IF        F1=ONE
            WRITE     HTMLFILE;"<td class=DataLabel>Current Hospital </td>":
               "<td><select name=wbsec031 title='Current Hospital'":
                             " class=Mandatory "
          ELSE
            WRITE     HTMLFILE;"<td class=DataLabel>Hospital ID</td>":
                             "<td><select name=wbsec031 title='Hospital ID' "
          ENDIF
.
          IF        FORM1 = 6
           WRITE     HTMLFILE;"onchange=":
                              "#"selectOptions2('3',wbsec031,wbsec005);":
                              "selectOptions2('63',wbsec031,wbsec010);":
                              "GenHomeHospital();HospitalFieldsAdd();#">"
           WRITE     HTMLFILE;"<option></option>"
          ELSE
           WRITE     HTMLFILE;"onchange=":
                              "#"selectOptions2('3',wbsec031,wbsec005);":
                              "selectOptions2('63',wbsec031,wbsec010);":
                              "HospitalFieldsUpd();#">"
           WRITE     HTMLFILE;"<option></option>"
          ENDIF
.
          MOVE      WBSEHOSP,DIM3
          CALL      HSEL0000
          WRITE     HTMLFILE;"</select></td>";
          GOTO      WSEC9999
.
WSEC3440  MOVE      WBSEHOSP,DIM3
          CALL      HSED0000
          GOTO      WSEC9999
.
WSEC3450  MOVE      WBSEHOSP,DIM3
          MOVE      USERID,KEY10
          CALL      HSLU0000
          GOTO      WSEC9999
.
WSEC3500  MOVE      WBSELTYP,CODE           * Clinic Location Type (Cat. CT)
          MOVE      "CT",CATEGORY
          CALL      CODITM00
          GOTO      WSEC9999
.
WSEC3600  MATCH     SP70,WBSESIT
          GOTO      WSEC9999 IF EQUAL
.
          MATCH     SP70,WBSECLI            
          GOTO      WSEC9999 IF EQUAL
.
          CALL      COTFIL00                * Check outpatient file prefix
.
          PACK      KEY20,WBSESIT,WBSECLI,Z70
          CALL      RDSCLIA1          * Read Clinic Record
          CALL      RDPCLIA1          * Read Clinic Record
          BRANCH    OVRCD,WSEC9999
.
          MATCH     WBSESIT,OCASITE
          GOTO      WSEC9999 IF NOT EQUAL
.
          MATCH     WBSECLI,OCACLIN
          GOTO      WSEC9999 IF NOT EQUAL
.
          WRITE     HTMLFILE;OCADESC;
          GOTO      WSEC9999
.
WSEC3700  WRITE     HTMLFILE;WBSEFDEP;      * User department (Free Format)
          GOTO      WSEC9999
.
WSEC3800  UNPACK    DIM127,D1,KEY1,DIM127
          MOVE      ZERO,F1
          MOVE      KEY1,F1
          BRANCH    F1,WSEC3810
.
.         CONTROL.OPCNURSE - Use oprnuraf or pmshcpaf for OT Nurse?
          MATCH     "1",OPCNURSE                * Use pmshcpaf for OT nurse?
          IF  @EQUAL
            PACK      KEY10,WBSENURS,SP70
            CALL      RDPMHCP1                  * opcnurse=1 use pmshcpaf
            BRANCH    OVRCD,WSEC9999
            SQUEEZE   PMHCSNAM
            SQUEEZE   PMHCGNAM
            PACK      KEY60,PMHCGNAM,SP1,PMHCSNAM
            WRITE     HTMLFILE;KEY60;
            GOTO      WSEC9999
          ELSE
            PACK      KEY6,WBSENURS,SP70
            CALL      RDOPNUR1                  * opcnurse=0 use oprnuraf
            BRANCH    OVRCD,WSEC9999
            SQUEEZE   OPNRSNAM
            SQUEEZE   OPNRGNAM
            PACK      KEY60,OPNRGNAM,SP1,OPNRSNAM
            WRITE     HTMLFILE;KEY60;
            GOTO      WSEC9999
          ENDIF
.
WSEC3810  PACK      WBSENURS,WBSENURS,SP70
          MATCH     SP70,WBSENURS
          GOTO      WSEC9999 IF EQUAL
          WRITE     HTMLFILE;WBSENURS;
          GOTO      WSEC9999
.
WSEC3900  MOVE      WBSEUID,SAVKEY10
          PACK      KEY10,WBSECUID,SP70
          CALL      RDWBSE1
          IF        OVRCD=0
            WRITE     HTMLFILE;WBSENAM;
          ELSE
            WRITE     HTMLFILE;KEY10;
          ENDIF
.
          PACK      KEY10,SAVKEY10,SP70
          CALL      RDWBSE1
.
          GOTO      WSEC9999
.
WSEC4000  MATCH     SP70,WBSECDAT
          GOTO      WSEC9999 IF EQUAL
.
          UNPACK    WBSECDAT,CCENT,CYEAR,CMON,CDAY
          MATCH     "00",CDAY
          GOTO      WSEC9999 IF EQUAL
          MOVE      CMON,F2
          LOAD      MTHNAM3,F2,JAN,FEB,MAR,APR,MAY,JUN,JUL,AUG,SEP,OCT,NOV,DEC
          WRITE     HTMLFILE;CDAY,SP1,MTHNAM3,SP1,CCENT,CYEAR
          GOTO      WSEC9999
.
WSEC4100  MATCH     SP70,WBSECTIM
          GOTO      WSEC9999 IF EQUAL
          WRITE     HTMLFILE;WBSECTIM;
          GOTO      WSEC9999
.
WSEC4200  MOVE      WBSEUID,SAVKEY10
          PACK      KEY10,WBSEUUID,SP70
          CALL      RDWBSE1
          IF        OVRCD=0
            WRITE     HTMLFILE;WBSENAM;
          ELSE
            WRITE     HTMLFILE;KEY10;
          ENDIF
.         
          PACK      KEY10,SAVKEY10,SP70
          CALL      RDWBSE1
.
          GOTO      WSEC9999
.
WSEC4300  MATCH     SP70,WBSEUDAT
          GOTO      WSEC9999 IF EQUAL
.
          UNPACK    WBSEUDAT,CCENT,CYEAR,CMON,CDAY
          MATCH     "00",CDAY
          GOTO      WSEC9999 IF EQUAL
          MOVE      CMON,F2
          LOAD      MTHNAM3,F2,JAN,FEB,MAR,APR,MAY,JUN,JUL,AUG,SEP,OCT,NOV,DEC
          WRITE     HTMLFILE;CDAY,SP1,MTHNAM3,SP1,CCENT,CYEAR
          GOTO      WSEC9999
.
WSEC4400  MATCH     SP70,WBSEUTIM
          GOTO      WSEC9999 IF EQUAL
          WRITE     HTMLFILE;WBSEUTIM;
          GOTO      WSEC9999
.
WSEC4500  COMPARE   ONE,IBCNMHOS
          GOTO      WSEC9999 IF NOT EQUAL
.
          PACK      KEY13,WBSEUID,SP70   * Access to all hospitals
          CALL      RDMLSEC1
          IF        OVRCD=1
            WRITE     HTMLFILE;ZERO;
          ELSE
            WRITE     HTMLFILE;ONE;
          ENDIF
          GOTO      WSEC9999
.
WSEC4600  CALL      HHCP0000             * Hospital Access List
          GOTO      WSEC9999
.
WSEC4700  MATCH     SP70,WBSEBEDV        * Bed Board View Number
          GOTO      WSEC9999 IF EQUAL
.
          WRITE     HTMLFILE;WBSEBEDV;
          GOTO      WSEC9999
.
WSEC4800  PACK      KEY20,WBSEUID,SP70   * All security groups record
          CALL      RDWBSGP1 
          IF        OVRCD=1
            WRITE     HTMLFILE;ZERO;
          ELSE
            WRITE     HTMLFILE;ONE;
          ENDIF
          GOTO      WSEC9999 
.
WSEC4900  CALL      UGRP0000             * Security Group Access List
          GOTO      WSEC9999
.
WSEC5000  WRITE     HTMLFILE;WBSEGPAC;
          GOTO      WSEC9999
.
WSEC5100  MOVE      WBSEDALL,CODE
          MOVE      "CG",CATEGORY
          CALL      CODITM00
          GOTO      WSEC9999
.
WSEC5200  WRITE     HTMLFILE;WARDFLAG;      * Flag for ward list view
          GOTO      WSEC9999
.
WSEC5300  WRITE     HTMLFILE;FILTACTV;      * Active/Inactive filter
          GOTO      WSEC9999
.
WSEC5400  CALL      HFIL0000                * Hospital filter
          GOTO      WSEC9999
.
WSEC5500  WRITE     HTMLFILE;SHOWPASS;      * Show reset password
          GOTO      WSEC9999
.
WSEC5600  WRITE     HTMLFILE;KEYWORDS;      * Keyword search
          GOTO      WSEC9999
.
WSEC5700  MOVE      ZERO,LNK2PRT            * Table of Security ID's
          CALL      SECKTB00                * Keyword search
          GOTO      WSEC9999
.
WSEC5800  UNPACK    DIM127,D1,KEY1,DIM127
          MOVE      ZERO,F1
          MOVE      KEY1,F1
          BRANCH    F1,WSEC5810
.
          PACK      KEY10,FILTUSID,SP70
          CALL      RDWBSE1
          BRANCH    OVRCD,WSEC9999
.
          WRITE     HTMLFILE;WBSENAM;
          GOTO      WSEC9999
.
WSEC5810  WRITE     HTMLFILE;FILTUSID;      * User id filter
          GOTO      WSEC9999
.
WSEC5900  MOVE      FILTOCCG,CODE           * Occupational group filter
          MOVE      "w0",CATEGORY
          CALL      CODITM00
          GOTO      WSEC9999
.
WSEC6000  MOVE      FILTCLOC,CODE           * Clinic location type
          MOVE      "CT",CATEGORY
          CALL      CODITM00
          GOTO      WSEC9999
.
WSEC6100  WRITE     HTMLFILE;FILTCLID;      * Clinic ID
          GOTO      WSEC9999
.
WSEC6200  CALL      WRDS0000                * Ward filter
          GOTO      WSEC9999
.
WSEC6300  CALL      ESSL0000                * Emergency site code filter
          GOTO      WSEC9999
.
WSEC6400  CALL      OSEL0000                * OP Site
          GOTO      WSEC9999
.
WSEC6500  WRITE     HTMLFILE;MANDWARD;      * Flag for mandatory ward
          GOTO      WSEC9999
.
WSEC6600  WRITE     HTMLFILE;INTPASSW;      * Internal password management Y/N
          GOTO      WSEC9999
.
WSEC6700  CALL      ASLT0000                * Alert Security Levels Tags
          GOTO      WSEC9999
.
WSEC6800  UNPACK    SP70,KEY3,KEY4
          COMPARE   ONE,IBCNMHOS
          IF        @EQUAL
            WRITE     HTMLFILE;"<td class=DataLabel>MRT Home Hospital</td>":
                          "<td><select name=wbsec057 title='MRT Home Hospital'":
                          " onchange=SetLocations()>":
                          "<option></option>"
            MOVE      WBSEHHOS,DIM3 
            MOVE      WBSEUID,KEY10
            CALL      HSLU0000              * select Hospital access
            WRITE     HTMLFILE;"</select></td></tr>":
                          "<tr><td></td><td></td>";
          ENDIF
.
          GOTO      WSEC9999
.
WSEC6900  WRITE     HTMLFILE;WBSEHLOC;      * MR Home Location
          GOTO      WSEC9999
.
WSEC7000  IF        IBCNMHOS=1
            WRITE     HTMLFILE;"<td class=DataLabel>Usual Tracking Hospital":
                               "</td>":
                          "<td><select name=wbsec058":
                          " title='Usual Tracking Hospital'":
                          " onchange=SetUsualTrackingLocation()>":
                          "<option></option>"
            MOVE      WBSEUTLH,DIM3
            MOVE      WBSEUID,KEY10
            CALL      HSLU0000              * select Hospital access
            WRITE     HTMLFILE;"</select></td>";
          ELSE
            WRITE     HTMLFILE;"<td><input type=hidden name=wbsec058 ":
                              "value=#"   #"></td><td>&nbsp;</td>";
          ENDIF
          GOTO      WSEC9999
.
WSEC7100  WRITE     HTMLFILE;WBSEUTLC;      * Usual Tracking Location
          GOTO      WSEC9999
.
WSEC7200  WRITE     HTMLFILE;RECVFLAG;      * Receive MR view flag     
          GOTO      WSEC9999
.
WSEC7300  MOVE      WBSEOPDU,CODE           * OP Direct User
          MOVE      "Tz",CATEGORY
          CALL      CODITM00
          GOTO      WSEC9999
.
WSEC7400  PACK      KEY16,WBSEC001,SP70     * Access to all Sites
          CALL      RDMLSIT1
          IF        OVRCD=1
            WRITE     HTMLFILE;"0";
          ELSE
            WRITE     HTMLFILE;"1";
          ENDIF
          GOTO      WSEC9999

WSEC7500  CALL      SHCP0000                * O/P Site Access List (websec0103003.html)
          GOTO      WSEC9999          
.
WSEC7600  PACK      KEY16,WBSEC001,SP70
          CALL      RDMLSIT1
          BRANCH    OVRCD,WSEC7620
.
          MATCH     SP70,MLSTSITE
          GOTO      WSEC7620 IF NOT EQUAL
.
          PACK      KEY6,SP70
          CALL      RDSSITA1
WSEC7610  CALL      RDKSITA1                * User has access to all sites
          BRANCH    OVRCD,WSEC9999
.
          WRITE     HTMLFILE;"<option value=",OSTSITE;
.
          MATCH     WBSESIT,OSTSITE
          IF        @EQUAL
            WRITE     HTMLFILE;" selected ";
          ENDIF
.
          WRITE     HTMLFILE;">",OSTDESC,"</option>"
          GOTO      WSEC7610
.
WSEC7620  PACK      KEY16,WBSEC001,SP70     * User has access to select sites
          CALL      RSMLSIT1
WSEC7621  CALL      RKMLSIT1
          BRANCH    OVRCD,WSEC9999
.   
          MATCH     WBSEC001,MLSTUSID
          GOTO      WSEC9999 IF NOT EQUAL
.
          PACK      KEY6,MLSTSITE
          CALL      RDSITA1
          IF        OVRCD=1
            MOVE      "Site Name Not Found",OSTDESC
          ENDIF
.
          WRITE     HTMLFILE;"<option value=",MLSTSITE;
.
          MATCH     WBSESIT,OSTSITE
          IF        @EQUAL
            WRITE     HTMLFILE;" selected ";
          ENDIF
.
          WRITE     HTMLFILE;">",OSTDESC,"</option>"
.
          GOTO      WSEC7621
.
WSEC7700  MATCH     SP70,REDIRECT
          GOTO      WSEC9999 IF EQUAL
.
          WRITE     HTMLFILE;REDIRECT;      * Redirect
          GOTO      WSEC9999
.
WSEC7800  MATCH     SP70,WBSEEMAI
          GOTO      WSEC9999 IF EQUAL
          WRITE     HTMLFILE;WBSEEMAI;
          GOTO      WSEC9999
.
WSEC7900  WRITE     HTMLFILE;WBSELOGN;
          GOTO      WSEC9999
.
WSEC8000  WRITE     HTMLFILE;WBSEGENR;      * Generic User ID
          GOTO      WSEC9999
.
WSEC8100  MATCH     SP70,WBSEDOC
          IF        !@EQUAL
            PACK      KEY10,WBSEDOC,SP70
            CALL      FHRSPC00
          ELSE
            MATCH     SP70,WBSEGPCD
            IF        !@EQUAL
              PACK      KEY10,WBSEGPCD,SP70
              CALL      FHRSPC00
            ENDIF
          ENDIF
          GOTO      WSEC9999
.
WSEC8200  CALL      SECSRC00                * Securiry User ID Search
          GOTO      WSEC9999
.
WSEC8300  CALL      NEXTSR00                  * link to next group
          GOTO      WSEC9999 
.
WSEC8400  CALL      PREVSR00                  * link to last group
          GOTO      WSEC9999 
.
WSEC8500  MATCH     SP70,WBSELACD
          GOTO      WSEC9999 IF EQUAL
.
          UNPACK    WBSELACD,CCENT,CYEAR,CMON,CDAY
          MATCH     "00",CDAY
          GOTO      WSEC9999 IF EQUAL
          MOVE      CMON,F2
          LOAD      MTHNAM3,F2,JAN,FEB,MAR,APR,MAY,JUN,JUL,AUG,SEP,OCT,NOV,DEC
          WRITE     HTMLFILE;CDAY,SP1,MTHNAM3,SP1,CCENT,CYEAR;
          GOTO      WSEC9999
.
WSEC8600  MATCH     SP70,WBSELACT
          GOTO      WSEC9999 IF EQUAL
          WRITE     HTMLFILE;WBSELACT;
          GOTO      WSEC9999
.
WSEC8700  WRITE     HTMLFILE;MRHOSFLG;      
          GOTO      WSEC9999
.
WSEC8800  WRITE     HTMLFILE;USERID;
          GOTO      WSEC9999
.
WSEC8900  MATCH     SP70,WBSEUID
          IF        !@EQUAL & !@EOS
            MOVE      WBSEUID,KEY10
            STRIP     KEY10
            WRITE     HTMLFILE;*+,",{ #"url#": #"%BASEURL/extension/dxc-hc-user#"":
                                  "  ,#"valueReference#" : #"Practitioner/User-",KEY10,"#"}";
          ENDIF
          GOTO      WSEC9999
.
WSEC9000  MATCH     SP70,WBSELOGN
          IF        !@EQUAL & !@EOS
            MOVE      WBSELOGN,KEY80
            STRIP     KEY80
            WRITE     HTMLFILE;*+,",{ #"url#": #"%BASEURL/extension/dxc-hc-longn#"":
                                  "  ,#"valueReference#" : #"Practitioner/Longn-",KEY80,"#"}";
          ENDIF
          GOTO      WSEC9999
.
WSEC9100  PACK      KEY18,WBSEC001,SP70
          CALL      RSWBST1
          CALL      RKWBST1
          BRANCH    OVRCD,WSEC9999
.
          MATCH     WBSEC001,WBSTUID
          GOTO      WSEC9999 IF NOT EQUAL
.
          WRITE     HTMLFILE;ONE; * to display red for Server Levels button
          GOTO      WSEC9999        
.
WSEC9200  PACK      KEY13,WBSEC001,SP70    
          CALL      RSIBCUS2
          CALL      RKIBCUS2
          BRANCH    OVRCD,WSEC9999
.
          MATCH     WBSEC001,IBCUUSER
          GOTO      WSEC9999 IF NOT EQUAL
.
          WRITE     HTMLFILE;ONE; * to display red for Category Security button
          GOTO      WSEC9999
.
WSEC9300  PACK      KEY15,WBSEC001,SP70    
          CALL      RSWBRUR1
          CALL      RKWBRUR1
          BRANCH    OVRCD,WSEC9999
.
          MATCH     WBSEC001,WBRUUSID
          GOTO      WSEC9999 IF NOT EQUAL
.
          WRITE     HTMLFILE;ONE; * to display red for Report Menu button
          GOTO      WSEC9999
.
WSEC9400  PACK      KEY18,WBSEC001,SP70
          CALL      RSWBST1
.
WSEC9401  CALL      RKWBST1
          BRANCH    OVRCD,WSEC9999
.
          MATCH     WBSTUID,WBSEC001
          GOTO      WSEC9999 IF NOT EQUAL
.
          PACK      KEY13,WBSTPRG,SP70
          CALL      RSWBTP1
          CALL      RKWBTP1
          BRANCH    OVRCD,WSEC9401
.
          MATCH     WBSTPRG,WBTPPRG
          GOTO      WSEC9401 IF NOT EQUAL
.
          MATCH     "3",WBTPMTY
          GOTO      WSEC9401 IF NOT EQUAL
.
          WRITE     HTMLFILE;ONE; * to display red for Report Levels button
          GOTO      WSEC9999
.
WSEC9500  UNPACK    DIM127,D1,KEY1,DIM127
          MATCH     SP70,WBSEHCPC
          GOTO      WSEC9999 IF EQUAL
          MOVE      ZERO,F1
          MOVE      KEY1,F1
          BRANCH    F1,WSEC9510             * 0=description, 1=code
.
          MOVE      WBSEHCPC,KEY10
          CALL      RDPMHCP1
          MOVE      PMHCTITL,FMTTITLE
          MOVE      PMHCGNAM,FMTGNAME
          MOVE      PMHCSNAM,FMTSNAME
          CALL      DOCNM000
          WRITE     HTMLFILE;DOCFNAME;
          GOTO      WSEC9999
.
WSEC9510  WRITE     HTMLFILE;WBSEHCPC;
          GOTO      WSEC9999 
.
WSEC9600  MATCH     WBSEVH1L,SP70
          GOTO      WSEC9610 IF NOT EQUAL        
          MATCH     WBSEAH1L,SP70
          GOTO      WSEC9610 IF NOT EQUAL        
          MATCH     WBSEVH2L,SP70
          GOTO      WSEC9610 IF NOT EQUAL        
          MATCH     WBSEAH2L,SP70
          GOTO      WSEC9610 IF NOT EQUAL        
          MATCH     WBSEVH3L,SP70
          GOTO      WSEC9610 IF NOT EQUAL        
          MATCH     WBSEAH3L,SP70
          GOTO      WSEC9610 IF NOT EQUAL        
          MATCH     WBSEVH4L,SP70
          GOTO      WSEC9610 IF NOT EQUAL        
          MATCH     WBSEAH4L,SP70
          GOTO      WSEC9610 IF NOT EQUAL        
          MATCH     WBSEVH5L,SP70
          GOTO      WSEC9610 IF NOT EQUAL        
          MATCH     WBSEAH5L,SP70
          GOTO      WSEC9610 IF NOT EQUAL        
          MATCH     WBSEVH6L,SP70
          GOTO      WSEC9610 IF NOT EQUAL        
          MATCH     WBSEAH6L,SP70
          GOTO      WSEC9610 IF NOT EQUAL        
          MATCH     WBSEVH7L,SP70
          GOTO      WSEC9610 IF NOT EQUAL        
          MATCH     WBSEAH7L,SP70
          GOTO      WSEC9610 IF NOT EQUAL        
          MATCH     WBSEVH8L,SP70
          GOTO      WSEC9610 IF NOT EQUAL        
          MATCH     WBSEAH8L,SP70
          GOTO      WSEC9610 IF NOT EQUAL        
          MATCH     WBSEVH9L,SP70
          GOTO      WSEC9610 IF NOT EQUAL        
          MATCH     WBSEAH9L,SP70
          GOTO      WSEC9610 IF NOT EQUAL        
          GOTO      WSEC9999
.
WSEC9610  WRITE     HTMLFILE;ONE; * to display red for Alert Levels button
          GOTO      WSEC9999
.
WSEC9999  RETURN
+
.------------------------------------------------------------
. Output FHIR Extension for Link to Dcotor and Speciality
.------------------------------------------------------------
FHRSPC00  MOVE      SP70,TDESC
          CALL      RDPMHCP1
          IF        OVRCD=0
            MATCH     SP70,PMHCSPC1
            IF        !@EQUAL
              MOVE      "DT",KEY2
              PACK      KEY5,KEY2,PMHCSPC1,SP70
              CALL      RDCODE1
            ENDIF
          ENDIF
          STRIP     KEY10
          WRITE     HTMLFILE;*+,",{ #"url#": #"%BASEURL/extension/dxc-hc-hcp#"":
                                "  ,#"valueReference#" : #"Practitioner/HCP-",KEY10,"#"}";
          MATCH     SP70,TDESC
          IF        !@EQUAL
            WRITE     HTMLFILE;*+,",{#"url#":#"%BASEURL/extension/dxc-hc-speciality#"":
                                  ",#"valueString#" : #"",TDESC,"#"}";
          ENDIF
          RETURN
+
.------------------------------------------------------------
. Hospital Selection
.------------------------------------------------------------
HSEL0000  PACK      KEY3,SP70
          CALL      RSPTHSP1
HSEL0100  CALL      RKPTHSP1
          BRANCH    OVRCD,HSEL9999
.
          MOVE      PTHSNAME,KEY50
          PACK      KEY5,QUOTE,PTHSHOSP,QUOTE
          MATCH     DIM3,PTHSHOSP
          IF        @EQUAL
            WRITE     HTMLFILE;"<option value=",KEY5," selected>":
                               KEY50,"</option>"
          ELSE
            WRITE     HTMLFILE;"<option value=",KEY5,">",KEY50,"</option>"
          ENDIF
          GOTO      HSEL0100
.
HSEL9999  RETURN
.
.-----------------------------------------------------------------
. Hospital Selection with "~~~" - All Hospital Access option
.-----------------------------------------------------------------
HFIL0000  MATCH     Z70,FILTHOSP
          IF        @EQUAL
            WRITE     HTMLFILE;"<option value=#"~~~#" selected>":
                              "All Hospital Access</option>"
          ELSE
            WRITE     HTMLFILE;"<option value=#"~~~#">":
                              "All Hospital Access</option>"
          
          ENDIF
.
          PACK      KEY3,SP70
          CALL      RSPTHSP1
HFIL0100  CALL      RKPTHSP1
          BRANCH    OVRCD,HFIL9999
.
          MOVE      PTHSNAME,KEY50
          PACK      KEY5,QUOTE,PTHSHOSP,QUOTE
          MATCH     FILTHOSP,PTHSHOSP
          IF        @EQUAL
            WRITE     HTMLFILE;"<option value=",KEY5," selected>":
                               KEY50,"</option>"
          ELSE
            WRITE     HTMLFILE;"<option value=",KEY5,">",KEY50,"</option>"
          ENDIF
          GOTO      HFIL0100
.
HFIL9999  RETURN
.------------------------------------------------------------
. Hospital Selection - only hospitals that user has access to
.------------------------------------------------------------
HSLU0000  COMPARE   ONE,IBCNMHOS
          GOTO      HSLU9999 IF NOT EQUAL
.
          MOVE      ZERO,F1
...       PACK      KEY13,USERID,SP70
          PACK      KEY13,KEY10,SP70
          CALL      RDMLSEC1
          IF        OVRCD<>1
            MOVE      ONE,F1               * Access to all hospitals
          ENDIF
.
          PACK      KEY3,SP70
          CALL      RSPTHSP1
HSLU0100  CALL      RKPTHSP1
          BRANCH    OVRCD,HSLU9999
.
          BRANCH    F1,HSLU0200             
.
....      PACK      KEY13,USERID,PTHSHOSP,SP70
          PACK      KEY13,KEY10,PTHSHOSP,SP70
          CALL      RDMLSEC1
          BRANCH    OVRCD,HSLU0100
.
HSLU0200  MOVE      PTHSNAME,KEY50
          PACK      KEY5,QUOTE,PTHSHOSP,QUOTE
          MATCH     DIM3,PTHSHOSP
          IF        @EQUAL
            WRITE     HTMLFILE;"<option value=",KEY5," selected>":
                               KEY50,"</option>"
          ELSE
            WRITE     HTMLFILE;"<option value=",KEY5,">",KEY50,"</option>"
          ENDIF
          GOTO      HSLU0100
.
HSLU9999  RETURN

.------------------------------------------------------------
.         WSTE0000
.------------------------------------------------------------
WSTE0000  BRANCH    FLDITMNO,WSTE0100,WSTE0200,WSTE0300,WSTE0400,WSTE0500:
                             WSTE0600,WSTE0700,WSTE0800,WSTE0900,WSTE1000:
                             WSTE1100,WSTE1200,WSTE1300
.
WSTE0100  WRITE     HTMLFILE;WBSEUID;
          GOTO      WSTE9999
.
WSTE0200  MOVE      WBSEUID,KEY10
          CALL      RDWBSE1
          WRITE     HTMLFILE;WBSENAM;
          GOTO      WSTE9999
.
WSTE0300  UNPACK    DIM127,D1,KEY1,DIM127
          MOVE      ZERO,F1
          MOVE      KEY1,F1
          BRANCH    F1,WSTE0310,WSTE0320,WSTE0330   * 0=desc, 1=code, 2=select
.
          MOVE      SP70,WBSPNAM
          PACK      KEY8,WBSTPRG
          CALL      RDWBSP1
          WRITE     HTMLFILE;WBSPNAM;
          GOTO      WSTE9999
.
WSTE0310  WRITE     HTMLFILE;WBSTPRG;
          GOTO      WSTE9999
.
WSTE0320  CALL      PRGSEL00
          GOTO      WSTE9999
.
WSTE0330  CALL      RPTSEL00
          GOTO      WSTE9999
.
WSTE0400  WRITE     HTMLFILE;WBSTLEV;
          GOTO      WSTE9999
.
WSTE0500  WRITE     HTMLFILE;WBSTUR1;
          GOTO      WSTE9999
.
WSTE0600  WRITE     HTMLFILE;WBSTUR2;
          GOTO      WSTE9999
.
WSTE0700  WRITE     HTMLFILE;WBSTUD1;
          GOTO      WSTE9999
.
WSTE0800  WRITE     HTMLFILE;WBSTUD2;
          GOTO      WSTE9999
.
WSTE0900  WRITE     HTMLFILE;WBSTUY1;
          GOTO      WSTE9999
.
WSTE1000  WRITE     HTMLFILE;WBSTUY2;
          GOTO      WSTE9999
.
WSTE1100  CALL      LEVTAB00
          GOTO      WSTE9999
.
WSTE1200  CALL      NXSL0000
          GOTO      WSTE9999
.
WSTE1300  CALL      PRSL0000
          GOTO      WSTE9999
.
WSTE9999  RETURN
.------------------------------------------------------------
. Option 6: Web Server Program Details
.------------------------------------------------------------
WBPG0000  BRANCH    FLDITMNO,WBPG0100,WBPG0200,WBPG0300,WBPG0400,WBPG0500
          GOTO      WBPG9999                
.
WBPG0100  WRITE     HTMLFILE;WBSPPRG;
          GOTO      WBPG9999                
.
WBPG0200  WRITE     HTMLFILE;WBSPNAM;
          GOTO      WBPG9999                
.
WBPG0300  CALL      PRGTAB00   * Table of Web Server Program Details
          GOTO      WBPG9999                
.
WBPG0400  CALL      NXTTMP00   * Next Set of Server Programs
          GOTO      WBPG9999                
.
WBPG0500  CALL      PRETMP00   * Prev Set of Server Programs
          GOTO      WBPG9999                
.
WBPG9999  RETURN
.------------------------------------------------------------
. Option 7: Web Server Options 
.------------------------------------------------------------
WBSO0000  BRANCH    FLDITMNO,WBSO0100,WBSO0200,WBSO0300,WBSO0400,WBSO0500:
                             WBSO0600,WBSO0700,WBSO0800
          GOTO      WBSO9999
.
WBSO0100  WRITE     HTMLFILE;WBSOPRG;
          GOTO      WBSO9999
.
WBSO0200  WRITE     HTMLFILE;WBSOOPT;
          GOTO      WBSO9999
.
WBSO0300  WRITE     HTMLFILE;WBSODES;
          GOTO      WBSO9999
.
WBSO0400  CALL      OPTTAB00   * Table of Web Server Options 
          GOTO      WBSO9999
.
WBSO0500  CALL      NXTTMP00   * Next Set of Server Programs
          GOTO      WBSO9999
.
WBSO0600  CALL      PRETMP00   * Prev Set of Server Programs
          GOTO      WBSO9999
.
WBSO0700  WRITE     HTMLFILE;PROGID;   * Used for Template headings
          GOTO      WBSO9999
.
WBSO0800  WRITE     HTMLFILE;PROGNAM;  * Used for Template headings
          GOTO      WBSO9999
.
WBSO9999  RETURN
.------------------------------------------------------------
. Option 8: Web Server Templates
.------------------------------------------------------------
WBTP0000  BRANCH    FLDITMNO,WBTP0100,WBTP0200,WBTP0300,WBTP0400,WBTP0500:
                             WBTP0600,WBTP0700,WBTP0800,WBTP0900,WBTP1000:
                             WBTP1100,WBTP1200,WBTP1300,WBTP1400,WBTP1500:
                             WBTP1600,WBTP1700,WBTP1800,WBTP1900
          GOTO      WBTP9999
.
WBTP0100  WRITE     HTMLFILE;PROGID;
          GOTO      WBTP9999
.
WBTP0200  WRITE     HTMLFILE;OPTNUM;
          GOTO      WBTP9999
.
WBTP0300  WRITE     HTMLFILE;TEMPNO;
          GOTO      WBTP9999
.
WBTP0400  WRITE     HTMLFILE;TEMPDES;
          GOTO      WBTP9999
.
WBTP0500  WRITE     HTMLFILE;TEMPFIL;
          GOTO      WBTP9999
.
WBTP0600  WRITE     HTMLFILE;TEMPLEV;
          GOTO      WBTP9999
.
WBTP0700  CALL      TMPTAB00   * Table of Web Server Templates 
          GOTO      WBTP9999
.
WBTP0800  CALL      NXTTMP00   * Next Set of Server Programs
          GOTO      WBTP9999
.
WBTP0900  CALL      PRETMP00   * Prev Set of Server Programs
          GOTO      WBTP9999
.
WBTP1000  WRITE     HTMLFILE;PROGNAM;  * Used for Template headings
          GOTO      WBTP9999
.
WBTP1100  WRITE     HTMLFILE;OPTDESC;  * Used for Template headings
          GOTO      WBTP9999
.
WBTP1200  WRITE     HTMLFILE;TEMPMTY;
          GOTO      WBTP9999
.
WBTP1300  WRITE     HTMLFILE;TEMPTAR;
          GOTO      WBTP9999
.
WBTP1400  WRITE     HTMLFILE;TEMPWID;
          GOTO      WBTP9999
.
WBTP1500  WRITE     HTMLFILE;TEMPHIG;
          GOTO      WBTP9999
.
WBTP1600  WRITE     HTMLFILE;TEMPLP1;
          GOTO      WBTP9999
.
WBTP1700  WRITE     HTMLFILE;TEMPLP2;
          GOTO      WBTP9999
.
WBTP1800  WRITE     HTMLFILE;TEMPLP3;
          GOTO      WBTP9999
.
WBTP1900  WRITE     HTMLFILE;TEMPLP4;
          GOTO      WBTP9999
.
WBTP9999  RETURN
.------------------------------------------------------------
. Option 9: Report Template Master Maintenance
.------------------------------------------------------------
RTMW0000  BRANCH    FLDITMNO,RTMW0100,RTMW0200,RTMW0300,RTMW0400,RTMW0500:
                             RTMW0600,RTMW0700
          GOTO      RTMW9999
.
RTMW0100  WRITE     HTMLFILE;WBRTPRID;
          GOTO      RTMW9999
.
RTMW0200  WRITE     HTMLFILE;WBRTTMNM;
          GOTO      RTMW9999
.
RTMW0300  WRITE     HTMLFILE;WBRTDESC;
          GOTO      RTMW9999
.
RTMW0400  WRITE     HTMLFILE;WBRTSPID;
          GOTO      RTMW9999
.
RTMW0500  CALL      RTMTAB00   * Table of Web Server Templates 
          GOTO      RTMW9999
.
RTMW0600  CALL      NEXT0000   * Next Set of Server Programs
          GOTO      RTMW9999
.
RTMW0700  CALL      PREV0000   * Prev Set of Server Programs
          GOTO      RTMW9999
.
RTMW9999  RETURN
.------------------------------------------------------------
. Option 10: Report Groups Master Maintenance
.------------------------------------------------------------
RGMW0000  BRANCH    FLDITMNO,RGMW0100,RGMW0200,RGMW0300,RGMW0400,RGMW0500:
                             RGMW0600
          GOTO      RGMW9999
.
RGMW0100  WRITE     HTMLFILE;WBRGGRID;
          GOTO      RGMW9999
.
RGMW0200  WRITE     HTMLFILE;WBRGDESC;
          GOTO      RGMW9999
.
RGMW0300  CALL      RGMTAB00   * Table of Web Server Templates 
          GOTO      RGMW9999
.
RGMW0400  CALL      NEXT0000   * Next Set of Server Programs
          GOTO      RGMW9999
.
RGMW0500  CALL      PREV0000   * Prev Set of Server Programs
          GOTO      RGMW9999
.
RGMW0600  CALL      GRDT0000   * Check if any record in Report Group details
          WRITE     HTMLFILE;F1;
          GOTO      RGMW9999
.
RGMW9999  RETURN
.------------------------------------------------------------
. Option 11: Report Group Details Maintenance
.------------------------------------------------------------
RDTW0000  BRANCH    FLDITMNO,RDTW0100,RDTW0200,RDTW0300,RDTW0400,RDTW0500:
                             RDTW0600
          GOTO      RDTW9999
.
RDTW0100  WRITE     HTMLFILE;WBRDGRID;
          GOTO      RDTW9999
.
RDTW0200  WRITE     HTMLFILE;WBRDPRID;
          GOTO      RDTW9999
.
RDTW0300  WRITE     HTMLFILE;WBRDTMID;
          GOTO      RDTW9999
.
RDTW0400  CALL      RDTTAB00   * Table of Web Server Templates 
          GOTO      RDTW9999
.
RDTW0500  CALL      NEXT0000   * Next Set of Server Programs
          GOTO      RDTW9999
.
RDTW0600  CALL      PREV0000   * Prev Set of Server Programs
          GOTO      RDTW9999
.
RDTW9999  RETURN
.------------------------------------------------------------
. Option 12: Web User Report Groups Maintenance
.------------------------------------------------------------
RURW0000  BRANCH    FLDITMNO,RURW0100,RURW0200,RURW0300,RURW0400,RURW0500:
                             RURW0600,RURW0700
          GOTO      RURW9999
.
RURW0100  WRITE     HTMLFILE;WBRUUSID;
          GOTO      RURW9999
.
RURW0200  CALL      REPGRP00          
          GOTO      RURW9999

RURW0300  CALL      RURTAB00   * Table of Web User Report Groups
          GOTO      RURW9999
.
RURW0400  CALL      NEXT0000   * Next Set of Server Programs
          GOTO      RURW9999
.
RURW0500  CALL      PREV0000   * Prev Set of Server Programs
          GOTO      RURW9999
.
RURW0600  WRITE     HTMLFILE;WEBUSEID;
          GOTO      RURW9999
.
RURW0700  WRITE     HTMLFILE;WBIDNAME;
          GOTO      RURW9999
.
RURW9999  RETURN
.
.------------------------------------------------------------
. Security ID Table - Keywords
.------------------------------------------------------------
SECKTB00  UNPACK    DIM127,D1,LINKPRG,DIM127
          UNPACK    DIM127,D1,LINKREP,DIM127
          UNPACK    DIM127,D1,LINKTEM,DIM127
.
          CALL      GETWRD00       * This routine Splits the KEYWORDS field
.                                  * into KEYWRD01 to KEYWRD10
          CALL      SECHED00       * Output Table Heading
.
          IF        NORECORD=0
            MOVE      PTCNNRTD,NORECORD     * Set Default No Records to Display
          ENDIF
          MOVE      ZERO,RECNUMB
          MOVE      ZERO,DISNUMB
          MOVE      ZERO,SECAREND         * Number of doctors in SECARRAY[]
.
          STRIP     KEYWRD01
          PACK      KEY90,KEYWRD01,SP70,SP70
          CALL      RSWBSKI2
.
SECKTB10  CALL      RKWBSKI2
          BRANCH    OVRCD,SECKTB90
.
          PACK      KEY10,WBSKUSID,SP70
          CALL      RDWBSE1                      * Valid web user id
          BRANCH    OVRCD,SECKTB10
.
          CALL      SECDKB00
          BRANCH    OVRCD,SECKTB10,SECKTB90
.
          MATCH     "1",FILTACTV                 * Active
          IF        @EQUAL
            MATCH     "1",WBSEACT
            GOTO      SECKTB10 IF NOT EQUAL
          ENDIF
.
          MATCH     "0",FILTACTV                 * Inactive
          IF        @EQUAL
            MATCH     "1",WBSEACT
            GOTO      SECKTB10 IF EQUAL
          ENDIF
.
          MATCH     SP70,FILTUSID                * User Id
          IF        !@EQUAL
            MATCH     WBSEUID,FILTUSID
            GOTO      SECKTB10 IF NOT EQUAL
          ENDIF
.
          MATCH     SP70,FILTOCCG                * Occupational Group
          IF        !@EQUAL
            MATCH     WBSEOCG,FILTOCCG
            GOTO      SECKTB10 IF NOT EQUAL
          ENDIF
.
          MATCH     SP70,FILTCLOC                * Clinic location type
          IF        !@EQUAL
            MATCH     WBSELTYP,FILTCLOC
            GOTO      SECKTB10 IF NOT EQUAL
          ENDIF
.
          MATCH     SP70,FILTCLID                * Clinic ID
          IF        !@EQUAL
            MATCH     WBSECLI,FILTCLID
            GOTO      SECKTB10 IF NOT EQUAL
          ENDIF
.
          MATCH     SP70,FILTWARD                * Ward
          IF        !@EQUAL
            MATCH     WBSEWRD,FILTWARD
            GOTO      SECKTB10 IF NOT EQUAL
          ENDIF
.
          MATCH     SP70,FILTOSIT                * OP Site
          IF        !@EQUAL
            MATCH     WBSESIT,FILTOSIT
            GOTO      SECKTB10 IF NOT EQUAL
          ENDIF
.
          MATCH     SP70,FILTESIT                * EMR Site
          IF        !@EQUAL
            MATCH     WBSEESC,FILTESIT
            GOTO      SECKTB10 IF NOT EQUAL
          ENDIF
.
          COMPARE   "1",IBCNMHOS                      * Multi Hospital
          GOTO      SECKTB50 IF NOT EQUAL
.
          MATCH     SP70,FILTHOSP                     * All
          GOTO      SECKTB50 IF EQUAL
.
          MATCH     Z70,FILTHOSP
          IF        @EQUAL
            PACK      KEY13,WBSEUID,SP70              * All Hospital Access
            CALL      RDMLSEC1
            BRANCH    OVRCD,SECKTB10
          ELSE
            PACK      KEY13,WBSEUID,SP70              * Include all hospital  
            CALL      RDMLSEC1                        * accedd to individual 
            COMPARE   ZERO,OVRCD                      * hospital
            GOTO      SECKTB50 IF EQUAL
.
            PACK      KEY13,WBSEUID,FILTHOSP,SP70     * Access to Hospital
            CALL      RDMLSEC1
            BRANCH    OVRCD,SECKTB10
          ENDIF
.
SECKTB50  ADD       ONE,RECNUMB
          IF        STARTNUM>=RECNUMB
            GOTO      SECKTB10
          ENDIF
.
          CALL      SROWA000      * Display Security ID Row
          ADD       ONE,DISNUMB
          COMPARE   NORECORD,DISNUMB
          GOTO      SECKTB10 IF NOT EQUAL
          GOTO      SECKTB99
.
SECKTB90  CALL      NOMORE00      * Display No More Records Message
.
SECKTB99  RETURN
.
.------------------------------------------------------------
. Check Record
.------------------------------------------------------------
SECDKB00  MATCH     KEYWRD01,WBSKKWRD
          GOTO      SECDKB92 IF NOT EQUAL
.
          IF        KEYWRDNO>1
            PACK      SAVKEY90,WBSKKWRD,WBSKUSID,SP70
            CALL      SECDKC00
            BRANCH    EXIT,SECDKB91
.
            MOVE      SAVKEY90,KEY90
            CALL      RDWBSKI2
          ENDIF
.
SECDKB90  CALL      CSEC0000                * Check if Web user has been
          BRANCH    EXIT,SECDKB91           * displayed before
.
          MOVE      ZERO,OVRCD
          GOTO      SECDKB99
.
SECDKB91  MOVE      ONE,OVRCD
          GOTO      SECDKB99
.
SECDKB92  MOVE      TWO,OVRCD
.
SECDKB99  RETURN
.
.------------------------------------------------------------
. Check if this Web user id has already been output in the search
.------------------------------------------------------------
CSEC0000  MOVE       ZERO,F3
          MOVE       ZERO,EXIT
.
CSEC1000  ADD        ONE,F3
          IF         F3>SECAREND
            IF         F3>200
              GOTO       CSEC9999
            ENDIF
            MOVE       F3,SECAREND
            MOVE       WBSEUID,SECARRAY[F3]
            GOTO       CSEC9999
          ENDIF
.
          MATCH      WBSEUID,SECARRAY[F3]
          GOTO       CSEC1000 IF NOT EQUAL
.
          MOVE       ONE,EXIT
.
CSEC9999  RETURN
.------------------------------------------------------------
. Check for Matching Words
.------------------------------------------------------------
SECDKC00  MOVE      ONE,F2
          MOVE      ZERO,EXIT
          PACK      SAVKEY10,WBSKUSID,SP70
.
SECDKC10  COMPARE   KEYWRDNO,F2           * Loop through each Key Word in Search
          GOTO      SECDKC99 IF EQUAL     * Exit OK
.
          ADD       ONE,F2
          LOAD      KEYWRDXX,F2,KEYWRD01,KEYWRD02,KEYWRD03,KEYWRD04,KEYWRD05:
                             KEYWRD06,KEYWRD07,KEYWRD08,KEYWRD09,KEYWRD10
          PACK      KEY90,WBSKUSID,KEYWRDXX,SP70
          CALL      RDWBSKI1              * Check for Exact Match
          COMPARE   ZERO,OVRCD            * Ok so Continue Loop
          GOTO      SECDKC10 IF EQUAL
.
          CALL      RKWBSKI1              * Not Exact so Read Next Record
          BRANCH    OVRCD,SECDKC90        * No Match So Exit No Match
.
          PACK      KEY10,WBSKUSID,SP70
          MATCH     SAVKEY10,KEY10          * Match Key Fields
          GOTO      SECDKC90 IF NOT EQUAL * No Match So Exit
.
          STRIP     KEYWRDXX
          MATCH     WBSKKWRD,KEYWRDXX       * Check Key Word
          GOTO      SECDKC90 IF NOT EQUAL * No Match So Exit
          GOTO      SECDKC10              * Check Next Search Word
.
SECDKC90  MOVE      ONE,EXIT
.
SECDKC99  RETURN
.
.------------------------------------------------------------
. Security ID Table
.------------------------------------------------------------
SECTAB00  UNPACK    DIM127,D1,LINKPRG,DIM127
          UNPACK    DIM127,D1,LINKREP,DIM127
          UNPACK    DIM127,D1,LINKTEM,DIM127
.
          CALL      SECHED00      * Output Table Heading
.
          IF        NORECORD=0
            MOVE      PTCNNRTD,NORECORD     * Set Default No Records to Display
          ENDIF
          MOVE      ZERO,RECNUMB
          MOVE      ZERO,DISNUMB
.
          PACK      KEY10,STARTKEY,SP70
          CALL      RDWBSE1
          IF        OVRCD<>1
            GOTO      SECTAB11
          ENDIF
.
SECTAB10  CALL      RKWBSE1
          BRANCH    OVRCD,SECTAB90
.
SECTAB11  MATCH     "1",FILTACTV                 * Active
          IF        @EQUAL
            MATCH     "1",WBSEACT
            GOTO      SECTAB10 IF NOT EQUAL
          ENDIF
.
          MATCH     "0",FILTACTV                 * Inactive
          IF        @EQUAL
            MATCH     "1",WBSEACT 
            GOTO      SECTAB10 IF EQUAL
          ENDIF
.
          MATCH     SP70,FILTUSID                * User Id
          IF        !@EQUAL
            MATCH     WBSEUID,FILTUSID
            GOTO      SECTAB10 IF NOT EQUAL
          ENDIF
.
          MATCH     SP70,FILTOCCG                * Occupational Group
          IF        !@EQUAL
            MATCH     WBSEOCG,FILTOCCG
            GOTO      SECTAB10 IF NOT EQUAL
          ENDIF
.
          MATCH     SP70,FILTCLOC                * Clinic location type
          IF        !@EQUAL
            MATCH     WBSELTYP,FILTCLOC
            GOTO      SECTAB10 IF NOT EQUAL
          ENDIF
.
          MATCH     SP70,FILTCLID                * Clinic ID
          IF        !@EQUAL
            MATCH     WBSECLI,FILTCLID
            GOTO      SECTAB10 IF NOT EQUAL
          ENDIF
.
          MATCH     SP70,FILTWARD                * Ward
          IF        !@EQUAL
            MATCH     WBSEWRD,FILTWARD
            GOTO      SECTAB10 IF NOT EQUAL
          ENDIF
.
          MATCH     SP70,FILTOSIT                * OP Site
          IF        !@EQUAL
            MATCH     WBSESIT,FILTOSIT
            GOTO      SECTAB10 IF NOT EQUAL
          ENDIF
.
          MATCH     SP70,FILTESIT                * EMR Site
          IF        !@EQUAL
            MATCH     WBSEESC,FILTESIT
            GOTO      SECTAB10 IF NOT EQUAL
          ENDIF
.
          COMPARE   "1",IBCNMHOS                      * Multi Hospital
          GOTO      SECTAB50 IF NOT EQUAL
.
          MATCH     SP70,FILTHOSP                     * All 
          GOTO      SECTAB50 IF EQUAL
.
          MATCH     Z70,FILTHOSP
          IF        @EQUAL
            PACK      KEY13,WBSEUID,SP70              * All Hospital Access
            CALL      RDMLSEC1
            BRANCH    OVRCD,SECTAB10
          ELSE
            PACK      KEY13,WBSEUID,SP70              * Include all hospital
            CALL      RDMLSEC1                        * accedd to individual
            COMPARE   ZERO,OVRCD                      * hospital
            GOTO      SECTAB50 IF EQUAL
.
            PACK      KEY13,WBSEUID,FILTHOSP,SP70     * Access to Hospital 
            CALL      RDMLSEC1
            BRANCH    OVRCD,SECTAB10
          ENDIF
.
SECTAB50  ADD       ONE,RECNUMB
          IF        STARTNUM>=RECNUMB
            GOTO      SECTAB10
          ENDIF
.
          CALL      SROWA000      * Display Security ID Row
          ADD       ONE,DISNUMB
          COMPARE   NORECORD,DISNUMB
          GOTO      SECTAB10 IF NOT EQUAL
          GOTO      SECTAB99
.
SECTAB90  CALL      NOMORE00
.
SECTAB99  RETURN
.------------------------------------------------------------
. Security ID Maintenance (TABLE HEADING)
.------------------------------------------------------------
SECHED00  WRITE     HTMLFILE;"<tr>":
                             "<td class=HeadingCell>Security ID</td>":
                             "<td class=HeadingCell>Name</td>":
                             "<td class=HeadingCell>Login Name</td>":
                             "<td class=HeadingCell>Active</td>":
                             "<td class=HeadingCell>Login URL</td>":
                             "<td class=HeadingCell>Department (Free Format)":
                             "</td>":
                             "<td class=HeadingCell>Department</td>";
.
          MATCH     "1",INTPASSW        * internally managed passwords  
          IF        @EQUAL
            IF        SHOWPASS=1
              WRITE     HTMLFILE;"<td class=HeadingCell>Password Reset</td>";
            ENDIF
          ENDIF
.
          WRITE     HTMLFILE;"</tr>"
.
SECHED99  RETURN
.------------------------------------------------------------
. Security ID Maintenance (TABLE ROW)
.------------------------------------------------------------
SROWA000  MOVE      WBSENAM,NAME
          MATCH     SP70,NAME
          IF        @EQUAL
            MOVE      "&nbsp;",NAME
          ENDIF
.
          MOVE      "No",KEY3
          MATCH     "1",WBSEACT
          IF        @EQUAL
            MOVE      "Yes",KEY3
          ENDIF
.
          MOVE      SP70,IBDPDESC
.
          MATCH     SP70,WBSEDEPT
          IF        !@EQUAL
            PACK      KEY6,WBSEDEPT,SP70   * read Printer Department table
            CALL      RDIBDPT1
            IF        OVRCD=1
              MOVE      WBSEDEPT,IBDPDESC  * default websec printer dept code
            ENDIF
          ENDIF
.
          BRANCH    LNK2PRT,SROWA010       * Update Parent
.
          WRITE     HTMLFILE;"<tr><td nowrap><A HREF='javascript:ShowDetail03":
                             "(#"",LINKPRG,"#.pbl":
                             "?reportno=",LINKREP:
                             "&template=",LINKTEM:
                             "&wbsec001=",WBSEUID,"#")'>":
                             "<img src=../images/MaintenanceIcon.gif hspace=4":
                             " border=0 align=absmiddle></a>":
                             WBSEUID,"</td>":
                             "<td>",NAME,"</td>":
                             "<td>",WBSELOGN,"</td>":
                             "<td>",KEY3,"</td>":
                             "<td>",WBSEDIR,"&nbsp;</td>":
                             "<td>",WBSEFDEP,"&nbsp;</td>":
                             "<td>",IBDPDESC,"&nbsp;</td>";
.
          MATCH     "1",INTPASSW        * internally managed passwords  
          IF        @EQUAL
            IF        SHOWPASS=1
              WRITE     HTMLFILE;"<td><input type=button value=#"Reset#" ":
                               " class=#"button#" ":
                               "onclick='ResetPassword03(#"",WBSEUID,"#");'>":
                               "</td>";
            ENDIF
          ENDIF
.
          WRITE     HTMLFILE;"</tr>"
.
          GOTO      SROWA999
.
SROWA010  REP       "' ",NAME  * Get Rid of them as when present stuff up link
          WRITE     HTMLFILE;"<tr valign=top>":
                             "<td><img src=../images/MaintenanceIcon.gif ":
                             " class=ListIcon onclick=#"UpdateParent('":
                             WBSEUID,"','",NAME,"');#">":
                             WBSEUID,"</td>":
                             "<td>",WBSENAM,"</td>":
                             "<td>",WBSELOGN,"</td>":
                             "<td>",KEY3,"</td>":
                             "<td>",WBSEDIR,"&nbsp;</td>":
                             "<td>",WBSEFDEP,"&nbsp;</td>":
                             "<td>",IBDPDESC,"&nbsp;</td>":
                             "</tr>"
.
SROWA999 RETURN
.
.------------------------------------------------------------
. Securiry User ID Search - Keywords
.------------------------------------------------------------
SECSRC00  CALL      GETWRD00       * This routine Splits the KEYWORDS field
.                                  * into KEYWRD01 to KEYWRD10
          CALL      SCSRHD00       * Output Table Heading
.
          IF        NORECORD=0
            MOVE      PTCNNRTD,NORECORD     * Set Default No Records to Display
          ENDIF
          MOVE      ZERO,RECNUMB
          MOVE      ZERO,DISNUMB
          MOVE      ZERO,SECAREND         * Number of doctors in SECARRAY[]
.
          STRIP     KEYWRD01
          PACK      KEY90,KEYWRD01,SP70,SP70
          CALL      RSWBSKI2
.
SECSRC10  CALL      RKWBSKI2
          BRANCH    OVRCD,SECSRC90
.
          PACK      KEY10,WBSKUSID,SP70
          CALL      RDWBSE1                      * Valid web user id
          BRANCH    OVRCD,SECSRC10
.
SECSRC20  CALL      SECDKB00
          BRANCH    OVRCD,SECSRC10,SECSRC90
.
          MATCH     "1",FILTACTV                 * Active
          IF        @EQUAL
            MATCH     "1",WBSEACT
            GOTO      SECSRC10 IF NOT EQUAL
          ENDIF
.
          MATCH     "0",FILTACTV                 * Inactive
          IF        @EQUAL
            MATCH     "1",WBSEACT
            GOTO      SECSRC10 IF EQUAL
          ENDIF
.
          COMPARE   "1",IBCNMHOS                      * Multi Hospital
          GOTO      SECSRC50 IF NOT EQUAL
.
          MATCH     SP70,FILTHOSP                     * All
          GOTO      SECSRC50 IF EQUAL
.
          PACK      KEY13,WBSEUID,SP70              * Include all hospital
          CALL      RDMLSEC1                        * access to individual
          COMPARE   ZERO,OVRCD                      * hospital
          GOTO      SECSRC50 IF EQUAL
.
          PACK      KEY13,WBSEUID,FILTHOSP,SP70     * Access to Hospital
          CALL      RDMLSEC1
          BRANCH    OVRCD,SECSRC10
.
SECSRC50  ADD       ONE,RECNUMB
          IF        STARTNUM>=RECNUMB
            GOTO      SECSRC10
          ENDIF
.
          CALL      SCSRRW00      * Display Security ID Row
          ADD       ONE,DISNUMB
          COMPARE   NORECORD,DISNUMB
          GOTO      SECSRC10 IF NOT EQUAL
          GOTO      SECSRC99
.
SECSRC90  CALL      NOMORE00      * Display No More Records Message
.
SECSRC99  RETURN
.
.------------------------------------------------------------
. Securiry User ID Search (TABLE HEADING)
.------------------------------------------------------------
SCSRHD00  WRITE     HTMLFILE;"<tr>":
                             "<td class=HeadingCell>Security ID</td>":
                             "<td class=HeadingCell>Name</td>":
                             "<td class=HeadingCell>Login Name</td>":
                             "<td class=HeadingCell>Active</td>";
.
          WRITE     HTMLFILE;"</tr>"
.
SCSRHD99  RETURN
.
.------------------------------------------------------------
. Securiry User ID Search (TABLE ROW)
.------------------------------------------------------------
SCSRRW00  MOVE      WBSENAM,NAME
          MATCH     SP70,NAME
          IF        @EQUAL
            MOVE      "&nbsp;",NAME
          ENDIF
.
          MOVE      "No",KEY3
          MATCH     "1",WBSEACT
          IF        @EQUAL
            MOVE      "Yes",KEY3
          ENDIF
.
          REP       "' ",NAME  * Get rid of ' as t will stuff up link
          WRITE     HTMLFILE;"<tr valign=top>":
                             "<td><img src=../images/MaintenanceIcon.gif ":
                             " class=ListIcon onclick=#"UpdateParent('":
                             WBSEUID,"','",NAME,"');#">":
                             WBSEUID,"</td>":
                             "<td>",WBSENAM,"</td>":
                             "<td>",WBSELOGN,"</td>":
                             "<td>",KEY3,"</td>":
                             "</tr>"
.
SCSRRW99 RETURN
.
.------------------------------------------------------------
. Link to Next 
.------------------------------------------------------------
NEXT0000  MOVE      NORECORD,KEY2
          REP       " +",KEY2
          ASSIGN    STARTNUM+NORECORD,F3
          MOVE      F3,KEY3
          REP       " +",KEY3
          UNPACK    DIM127,D1,FLDPARA,DIM127
          MOVE      REPORTNO,F2
.
          REP       " +",WBRDGRID
          REP       " +",WEBUSEID
          REP       " +",STARTKEY
          REP       " +",FILTACTV
          REP       " +",FILTHOSP
          REP       "'~",KEYWORDS
          REP       " +",KEYWORDS
          REP       " +",FILTUSID
          REP       " +",FILTOCCG
          REP       " +",FILTCLOC
          REP       " +",FILTCLID
          REP       " +",FILTWARD
          REP       " +",FILTESIT
          REP       " +",FILTOSIT
.
          WRITE     HTMLFILE;"websec01.pbl":
                                 "?reportno=",F2:
                                 "&template=",FLDPARA:
                                 "&startnum=",KEY3:
                                 "&norecord=",KEY2:
                                 "&wbrgm001=",WBRDGRID:
                                 "&wbrur001=",WEBUSEID:
                                 "&webuseid=",WEBUSEID:
                                 "&wbrdt001=",WBRDGRID:
                                 "&startkey=",STARTKEY:
                                 "&filtactv=",FILTACTV:
                                 "&filthosp=",FILTHOSP:
                                 "&showpass=",SHOWPASS:
                                 "&keywords=",KEYWORDS:
                                 "&filtusid=",FILTUSID:
                                 "&filtoccg=",FILTOCCG:
                                 "&filtcloc=",FILTCLOC:
                                 "&filtclid=",FILTCLID:
                                 "&filtward=",FILTWARD:
                                 "&filtesit=",FILTESIT:
                                 "&filtosit=",FILTOSIT;
.
          REP       "+ ",WBRDGRID
          REP       "+ ",WEBUSEID
          REP       "+ ",STARTKEY
          REP       "+ ",FILTACTV
          REP       "+ ",FILTHOSP
          REP       "~'",KEYWORDS
          REP       "+ ",KEYWORDS
          REP       "+ ",FILTUSID
          REP       "+ ",FILTOCCG
          REP       "+ ",FILTCLOC
          REP       "+ ",FILTCLID
          REP       "+ ",FILTWARD
          REP       "+ ",FILTESIT
          REP       "+ ",FILTOSIT
.
NEXT9999  RETURN
.
.------------------------------------------------------------
. Link to Next - Security User ID Search
.------------------------------------------------------------
NEXTSR00  MOVE      NORECORD,KEY2
          REP       " +",KEY2
          ASSIGN    STARTNUM+NORECORD,F3
          MOVE      F3,KEY3
          REP       " +",KEY3
          UNPACK    DIM127,D1,FLDPARA,DIM127
          MOVE      REPORTNO,F2
.
          REP       " +",STARTKEY
          REP       " +",FILTACTV
          REP       " +",FILTHOSP
          REP       "'~",KEYWORDS
          REP       " +",KEYWORDS
.
          WRITE     HTMLFILE;"websec01.pbl":
                                 "?reportno=",F2:
                                 "&template=",FLDPARA:
                                 "&startnum=",KEY3:
                                 "&norecord=",KEY2:
                                 "&startkey=",STARTKEY:
                                 "&filtactv=",FILTACTV:
                                 "&filthosp=",FILTHOSP:
                                 "&keywords=",KEYWORDS;
.
          REP       "+ ",STARTKEY
          REP       "+ ",FILTACTV
          REP       "+ ",FILTHOSP
          REP       "~'",KEYWORDS
          REP       "+ ",KEYWORDS
.
NEXTSR99  RETURN
.
.-------------------------------------------------------------------------------
. Link to previous - Security User ID Search
.-------------------------------------------------------------------------------
PREVSR00  MOVE      NORECORD,KEY2
          REP       " +",KEY2
          ASSIGN    STARTNUM-NORECORD,F3
          IF        F3<0
            MOVE    ZERO,F3
          ENDIF
          MOVE      F3,KEY3
          REP       " +",KEY3
          UNPACK    DIM127,D1,FLDPARA,DIM127
          MOVE      REPORTNO,F2
.
          REP       " +",STARTKEY
          REP       " +",FILTACTV
          REP       " +",FILTHOSP
          REP       "'~",KEYWORDS
          REP       " +",KEYWORDS
.
          WRITE     HTMLFILE;"websec01.pbl":
                                 "?reportno=",F2:
                                 "&template=",FLDPARA:
                                 "&startnum=",KEY3:
                                 "&norecord=",KEY2:
                                 "&startkey=",STARTKEY:
                                 "&filtactv=",FILTACTV:
                                 "&filthosp=",FILTHOSP:
                                 "&keywords=",KEYWORDS;

.
          REP       "+ ",STARTKEY
          REP       "+ ",FILTACTV
          REP       "+ ",FILTHOSP
          REP       "~'",KEYWORDS
          REP       "+ ",KEYWORDS
.
PREVSR99  RETURN
.
.------------------------------------------------------------
. Link to Next security level page
.------------------------------------------------------------
NXSL0000  MOVE      NORECORD,KEY2
          REP       " +",KEY2
          ASSIGN    STARTNUM+NORECORD,F3
          MOVE      F3,KEY3
          REP       " +",KEY3
          UNPACK    DIM127,D1,FLDPARA,DIM127
          MOVE      REPORTNO,F1
.
          WRITE     HTMLFILE;"websec01.pbl":
                                 "?reportno=",F1:
                                 "&template=",FLDPARA:
                                 "&wbsec001=",WBSEUID:
                                 "&startnum=",KEY3:
                                 "&norecord=",KEY2;
.
NXSL9999  RETURN
.------------------------------------------------------------
. Link to Next Set of Server Programs, Options and Templates
.------------------------------------------------------------
NXTTMP00  MOVE      NORECORD,KEY2
          REP       " +",KEY2
          ASSIGN    STARTNUM+NORECORD,F3
          MOVE      F3,KEY3
          REP       " +",KEY3
          UNPACK    DIM127,D1,FLDPARA,DIM127
          MOVE      REPORTNO,F1
          REP       " +",STARTKEY
          REP       " +",PROGID 
          REP       " +",OPTNUM 
.
          WRITE     HTMLFILE;"websec01.pbl":
                                 "?reportno=",F1:
                                 "&template=",FLDPARA:
                                 "&startnum=",KEY3:
                                 "&norecord=",KEY2:
                                 "&wbspg001=",PROGID:
                                 "&wbsop001=",OPTNUM:
                                 "&startkey=",STARTKEY;
.
          REP       "+ ",STARTKEY
          REP       "+ ",PROGID
          REP       "+ ",OPTNUM
.
NXTTMP99  RETURN
.-------------------------------------------------------------------------------
. Link to previous
.-------------------------------------------------------------------------------
PREV0000  MOVE      NORECORD,KEY2
          REP       " +",KEY2
          ASSIGN    STARTNUM-NORECORD,F3
          IF        F3<0
            MOVE    ZERO,F3
          ENDIF
          MOVE      F3,KEY3
          REP       " +",KEY3
          UNPACK    DIM127,D1,FLDPARA,DIM127
          MOVE      REPORTNO,F2
.
          REP       " +",WBRDGRID
          REP       " +",WEBUSEID
          REP       " +",STARTKEY
          REP       " +",FILTACTV
          REP       " +",FILTHOSP
          REP       "'~",KEYWORDS
          REP       " +",KEYWORDS
          REP       " +",FILTUSID
          REP       " +",FILTOCCG
          REP       " +",FILTCLOC
          REP       " +",FILTCLID
          REP       " +",FILTWARD
          REP       " +",FILTESIT
          REP       " +",FILTOSIT
.
          WRITE     HTMLFILE;"websec01.pbl":
                                 "?reportno=",F2:
                                 "&template=",FLDPARA:
                                 "&startnum=",KEY3:
                                 "&norecord=",KEY2:
                                 "&wbrgm001=",WBRDGRID:
                                 "&webuseid=",WEBUSEID:
                                 "&wbrur001=",WEBUSEID:
                                 "&wbrdt001=",WBRDGRID:
                                 "&startkey=",STARTKEY:
                                 "&filtactv=",FILTACTV:
                                 "&filthosp=",FILTHOSP:
                                 "&showpass=",SHOWPASS:
                                 "&keywords=",KEYWORDS:
                                 "&filtusid=",FILTUSID:
                                 "&filtoccg=",FILTOCCG:
                                 "&filtcloc=",FILTCLOC:
                                 "&filtclid=",FILTCLID:
                                 "&filtward=",FILTWARD:
                                 "&filtesit=",FILTESIT:
                                 "&filtosit=",FILTOSIT;
.
          REP       "+ ",WBRDGRID
          REP       "+ ",WEBUSEID
          REP       "+ ",STARTKEY
          REP       "+ ",FILTACTV
          REP       "+ ",FILTHOSP
          REP       "~'",KEYWORDS
          REP       "+ ",KEYWORDS
          REP       "+ ",FILTUSID
          REP       "+ ",FILTOCCG
          REP       "+ ",FILTCLOC
          REP       "+ ",FILTCLID
          REP       "+ ",FILTWARD
          REP       "+ ",FILTESIT
          REP       "+ ",FILTOSIT
.
PREV9999  RETURN
.-------------------------------------------------------------------------------
. Link to previous
.-------------------------------------------------------------------------------
PRSL0000  MOVE      NORECORD,KEY2
          REP       " +",KEY2
          ASSIGN    STARTNUM-NORECORD,F3
          IF        F3<0
            MOVE    ZERO,F3
          ENDIF
          MOVE      F3,KEY3
          REP       " +",KEY3
          UNPACK    DIM127,D1,FLDPARA,DIM127
          MOVE      REPORTNO,F1
.
          WRITE     HTMLFILE;"websec01.pbl":
                                 "?reportno=",F1:
                                 "&template=",FLDPARA:
                                 "&wbsec001=",WBSEUID:
                                 "&startnum=",KEY3:
                                 "&norecord=",KEY2;
.
PRSL9999  RETURN
.-------------------------------------------------------------------------------
. Link to previous Set of Server Programs, Options and Templates
.-------------------------------------------------------------------------------
PRETMP00  MOVE      NORECORD,KEY2
          REP       " +",KEY2
          ASSIGN    STARTNUM-NORECORD,F3
          IF        F3<0
            MOVE    ZERO,F3
          ENDIF
          MOVE      F3,KEY3
          REP       " +",KEY3
          UNPACK    DIM127,D1,FLDPARA,DIM127
          MOVE      REPORTNO,F1
          REP       " +",STARTKEY
          REP       " +",PROGID
          REP       " +",OPTNUM
.
          WRITE     HTMLFILE;"websec01.pbl":
                                 "?reportno=",F1:
                                 "&template=",FLDPARA:
                                 "&startnum=",KEY3:
                                 "&norecord=",KEY2:
                                 "&wbspg001=",PROGID:
                                 "&wbsop001=",OPTNUM:
                                 "&startkey=",STARTKEY;
.
          REP       "+ ",STARTKEY
          REP       "+ ",PROGID 
          REP       "+ ",OPTNUM 
.
PRETMP99  RETURN
.------------------------------------------------------------
. NOMORE00 - Display "No more records" at end of list
.------------------------------------------------------------
NOMORE00  WRITE     HTMLFILE;"<tr>":
                             "<td class=RedCell colspan=20 align=center>":
                             "No more records</td>"
.
NOMORE99  RETURN
.
.------------------------------------------------------------
. Security Level Table
.------------------------------------------------------------
LEVTAB00  UNPACK    DIM127,D1,LINKPRG,DIM127
          UNPACK    DIM127,D1,LINKREP,DIM127
          UNPACK    DIM127,D1,LINKTEM,DIM127
          UNPACK    DIM127,D1,RPRTFLG,DIM127
.
          CALL      LEVHED00      * Output Table Heading
.
          IF        NORECORD=0
            MOVE      PTCNNRTD,NORECORD     * Set Default No Records to Display
          ENDIF
          MOVE      ZERO,RECNUMB
          MOVE      ZERO,DISNUMB
.
          PACK      KEY18,WBSEC001,SP70
          CALL      RSWBST1
.      
LEVTAB10  CALL      RKWBST1
          BRANCH    OVRCD,LEVTAB90
.
          MATCH     WBSTUID,WBSEC001
          GOTO      LEVTAB90 IF NOT EQUAL
.
          PACK      KEY13,WBSTPRG,SP70
          CALL      RSWBTP1
          CALL      RKWBTP1
          BRANCH    OVRCD,LEVTAB10 
.
          MATCH     WBSTPRG,WBTPPRG 
          GOTO      LEVTAB10 IF NOT EQUAL       
.
          MATCH     "1",RPRTFLG    * report list            
          IF        @EQUAL
            MATCH     "3",WBTPMTY
            GOTO      LEVTAB10 IF NOT EQUAL 
          ELSE
            MATCH     "3",WBTPMTY
            GOTO      LEVTAB10 IF EQUAL
          ENDIF
.                        
LEVTAB15  ADD       ONE,RECNUMB
          IF        STARTNUM>=RECNUMB
            GOTO      LEVTAB10
          ENDIF
.
          CALL      LROWA000      * Display Security ID Row
          ADD       ONE,DISNUMB
          COMPARE   NORECORD,DISNUMB
          GOTO      LEVTAB10 IF NOT EQUAL
          GOTO      LEVTAB99
.
LEVTAB90  CALL      NOMORE00      * Display No More Records Message
.
LEVTAB99  RETURN
.------------------------------------------------------------
. Security Level Maintenance (TABLE HEADING)
.------------------------------------------------------------
LEVHED00  WRITE     HTMLFILE;"<tr>":
                             "<td class=HeadingCell>Server ID</td>":
                             "<td class=HeadingCell>Description</td>":
                             "<td class=HeadingCell>Level</td>":
                             "</tr>"
.
LEVHED99  RETURN
.------------------------------------------------------------
. Security Level Maintenance (TABLE ROW)
.------------------------------------------------------------
LROWA000  PACK      KEY8,WBSTPRG
          CALL      RDWBSP1
          MOVE      WBSPNAM,NAME
          MATCH     SP70,NAME
          IF        @EQUAL
            MOVE      "&nbsp;",NAME
          ENDIF
.
          WRITE     HTMLFILE;"<tr><td nowrap><A HREF='javascript:ShowDetail04":
                             "(#"",LINKPRG,"#.pbl":
                             "?reportno=",LINKREP:
                             "&template=",LINKTEM:
                             "&wbsec001=",WBSTUID,"&wbste001=",WBSTPRG,"#")'>":
                             "<img src=../images/MaintenanceIcon.gif hspace=4":
                             " border=0 align=absmiddle></a>":
                             WBSTPRG,"</td>":
                             "<td>",NAME,"</td>":
                             "<td>",WBSTLEV,"</td>":
                             "</tr>"
.
LROWA999 RETURN
.------------------------------------------------------------
. Option 6: Web Server Programs Table
.------------------------------------------------------------
PRGTAB00  UNPACK    DIM127,D1,LINKPRG,DIM127
          UNPACK    DIM127,D1,LINKREP,DIM127
          UNPACK    DIM127,D1,LINKTEM,DIM127
.
          CALL      PRGHED00      * Output Table Heading
.
          IF        NORECORD=0
            MOVE      PTCNNRTD,NORECORD     * Set Default No Records to Display
          ENDIF
          MOVE      ZERO,RECNUMB
          MOVE      ZERO,DISNUMB
.
          REP       UPPLOW,STARTKEY         * Uppercase startkey if not already 
.
          PACK      KEY8,STARTKEY,SP70
          CALL      RSWBSP1
          IF        OVRCD=0
            CALL      RPWBSP1
          ENDIF   
.
PRGTAB10  CALL      RKWBSP1
          BRANCH    OVRCD,PRGTAB90
.
          ADD       ONE,RECNUMB
          IF        STARTNUM>=RECNUMB
            GOTO      PRGTAB10
          ENDIF
.
          CALL      PRGRW000      * Web Server Programs Row
          ADD       ONE,DISNUMB
          COMPARE   NORECORD,DISNUMB
          GOTO      PRGTAB10 IF NOT EQUAL
          GOTO      PRGTAB99
.
PRGTAB90  CALL      NOMORE00      * Display No More Records Message
.
PRGTAB99  RETURN
.------------------------------------------------------------
. Web Server Programs (TABLE HEADING)
.------------------------------------------------------------
PRGHED00  WRITE     HTMLFILE;"<tr>":
                             "<td class=HeadingCell>Server ID</td>":
                             "<td class=HeadingCell>Server Name</td>":
                             "</tr>"
.
PRGHED99  RETURN
.------------------------------------------------------------
. Web Server Programs (TABLE ROW)
.------------------------------------------------------------
PRGRW000  WRITE     HTMLFILE;"<tr><td nowrap><A HREF='javascript:ShowDetail06":
                             "(#"",LINKPRG,"#.pbl":
                             "?reportno=",LINKREP:
                             "&template=",LINKTEM:
                             "&wbspg001=",WBSPPRG,"#")'>":
                             "<img src=../images/MaintenanceIcon.gif hspace=4":
                             " border=0 align=absmiddle></a>":
                             WBSPPRG,"</td>":
                             "<td>",WBSPNAM,"</td>":
                             "</tr>"
.
PRGRW999 RETURN
.------------------------------------------------------------
. Option 7: Web Server Options Table
.------------------------------------------------------------
OPTTAB00  UNPACK    DIM127,D1,LINKPRG,DIM127
          UNPACK    DIM127,D1,LINKREP,DIM127
          UNPACK    DIM127,D1,LINKTEM,DIM127
.
          CALL      OPTHED00      * Output Table Heading
.
          IF        NORECORD=0
            MOVE      PTCNNRTD,NORECORD     * Set Default No Records to Display
          ENDIF
          MOVE      ZERO,RECNUMB
          MOVE      ZERO,DISNUMB
.
          PACK      KEY10,WBSPG001,STARTKEY,SP70
          CALL      RSWBSO1
          IF        OVRCD=0
            CALL      RPWBSO1
          ENDIF   
.
OPTTAB10  CALL      RKWBSO1
          BRANCH    OVRCD,OPTTAB90
.
          MATCH     WBSPG001,WBSOPRG       * Check Program ID
          GOTO      OPTTAB90 IF NOT EQUAL 
.
          ADD       ONE,RECNUMB
          IF        STARTNUM>=RECNUMB
            GOTO      OPTTAB10
          ENDIF
.
          CALL      OPTRW000      * Web Server Options Row
          ADD       ONE,DISNUMB
          COMPARE   NORECORD,DISNUMB
          GOTO      OPTTAB10 IF NOT EQUAL
          GOTO      OPTTAB99
.
OPTTAB90  CALL      NOMORE00      * Display No More Records Message
.
OPTTAB99  RETURN
.------------------------------------------------------------
. Web Server Options (TABLE HEADING)
.------------------------------------------------------------
OPTHED00  WRITE     HTMLFILE;"<tr>":
                             "<td class=HeadingCell>Report Option</td>":
                             "<td class=HeadingCell>Description</td>":
                             "</tr>"
.
OPTHED99  RETURN
.------------------------------------------------------------
. Web Server Options (TABLE ROW)
.------------------------------------------------------------
OPTRW000  WRITE     HTMLFILE;"<tr><td nowrap><A HREF='javascript:ShowDetail07":
                             "(#"",LINKPRG,"#.pbl":
                             "?reportno=",LINKREP:
                             "&template=",LINKTEM:
                             "&wbspg001=",WBSOPRG:
                             "&wbsop001=",WBSOOPT,"#")'>":
                             "<img src=../images/MaintenanceIcon.gif hspace=4":
                             " border=0 align=absmiddle></a>":
                             WBSOOPT,"</td>":
                             "<td>",WBSODES,"</td>":
                             "</tr>"
.
OPTRW999 RETURN
.------------------------------------------------------------
. Option 8: Web Server Templates Table
.------------------------------------------------------------
TMPTAB00  UNPACK    DIM127,D1,LINKPRG,DIM127
          UNPACK    DIM127,D1,LINKREP,DIM127
          UNPACK    DIM127,D1,LINKTEM,DIM127
.
          CALL      TMPHED00      * Output Table Heading
.
          IF        NORECORD=0
            MOVE      PTCNNRTD,NORECORD     * Set Default No Records to Display
          ENDIF
          MOVE      ZERO,RECNUMB
          MOVE      ZERO,DISNUMB
.
          PACK      KEY13,WBSPG001,WBSOP001,STARTKEY,SP70
          CALL      RSWBTP1
          IF        OVRCD=0
            CALL      RPWBTP1
          ENDIF   
.
TMPTAB10  CALL      RKWBTP1
          BRANCH    OVRCD,TMPTAB90
.
          MATCH     WBSPG001,WBTPPRG       * Check Program ID
          GOTO      TMPTAB90 IF NOT EQUAL 
.
          MATCH     WBSOP001,WBTPOPT       * Check Server Option 
          GOTO      TMPTAB90 IF NOT EQUAL 
.
          ADD       ONE,RECNUMB
          IF        STARTNUM>=RECNUMB
            GOTO      TMPTAB10
          ENDIF
.
          CALL      TMPRW000      * Web Server Templates Row
          ADD       ONE,DISNUMB
          COMPARE   NORECORD,DISNUMB
          GOTO      TMPTAB10 IF NOT EQUAL
          GOTO      TMPTAB99
.
TMPTAB90  CALL      NOMORE00      * Display No More Records Message
.
TMPTAB99  RETURN
.------------------------------------------------------------
. Web Server Templates (TABLE HEADING)
.------------------------------------------------------------
TMPHED00  WRITE     HTMLFILE;"<tr>":
                             "<td class=HeadingCell>Template No</td>":
                             "<td class=HeadingCell>Template Description</td>":
                             "<td class=HeadingCell>File Name</td>":
                             "<td class=HeadingCell>Menu Type</td>":
                             "<td class=HeadingCell>Menu Target</td>":
                             "<td class=HeadingCell>Security Level</td>":
                             "</tr>"
.
TMPHED99  RETURN
.------------------------------------------------------------
. Web Server Templates (TABLE ROW)
.------------------------------------------------------------
TMPRW000  MATCH     SP70,WBTPLEV
          IF        @EQUAL 
            MOVE      "&nbsp;",KEY6
          ELSE
            MOVE      WBTPLEV,KEY6
          ENDIF  
.
          MOVE      MENUTY00,TYPENAME
          MOVE      WBTPMTY,F1
          LOAD      TYPENAME,F1,MENUTY01,MENUTY02,MENUTY03
          MOVE      MENUTA00,TARGNAME
          MOVE      WBTPTAR,F1
          LOAD      TARGNAME,F1,MENUTA01,MENUTA02,MENUTA03
          WRITE     HTMLFILE;"<tr><td nowrap><A HREF='javascript:ShowDetail08":
                             "(#"",LINKPRG,"#.pbl":
                             "?reportno=",LINKREP:
                             "&template=",LINKTEM:
                             "&wbspg001=",WBTPPRG:
                             "&wbsop001=",WBTPOPT:
                             "&wbtpl001=",WBTPTPL,"#")'>":
                             "<img src=../images/MaintenanceIcon.gif hspace=4":
                             " border=0 align=absmiddle></a>":
                             WBTPTPL,"</td>":
                             "<td>",WBTPDES,"</td><td>",WBTPFIL,"</td>":
                             "<td>",TYPENAME,"</td>":
                             "<td>",TARGNAME,"</td>":
                             "<td>",KEY6,"</td>":
                             "</tr>"
.
TMPRW999 RETURN
.------------------------------------------------------------
. Option 9: report Template Master Table
.------------------------------------------------------------
RTMTAB00  UNPACK    DIM127,D1,LINKPRG,DIM127
          UNPACK    DIM127,D1,LINKREP,DIM127
          UNPACK    DIM127,D1,LINKTEM,DIM127
.
          CALL      RTMHED00      * Output Table Heading
.
          IF        NORECORD=0
            MOVE      PTCNNRTD,NORECORD     * Set Default No Records to Display
          ENDIF
          MOVE      ZERO,RECNUMB
          MOVE      ZERO,DISNUMB
.
          PACK      KEY11,STARTKEY,SP70
          CALL      RSWBRTM1
          IF        OVRCD=0
            CALL      RPWBRTM1
          ENDIF   
.
RTMTAB10  CALL      RKWBRTM1
          BRANCH    OVRCD,RTMTAB90
.
          ADD       ONE,RECNUMB
          IF        STARTNUM>=RECNUMB
            GOTO      RTMTAB10
          ENDIF
.
          CALL      RTMRW000      * Web Server Templates Row
          ADD       ONE,DISNUMB
          COMPARE   NORECORD,DISNUMB
          GOTO      RTMTAB10 IF NOT EQUAL
          GOTO      RTMTAB99
.
RTMTAB90  CALL      NOMORE00      * Display No More Records Message
.
RTMTAB99  RETURN
.------------------------------------------------------------
. Report Template Master (TABLE HEADING)
.------------------------------------------------------------
RTMHED00  WRITE     HTMLFILE;"<tr>":
                             "<td class=HeadingCell>Program ID</td>":
                             "<td class=HeadingCell>Template Number</td>":
                             "<td class=HeadingCell>Description</td>":
                             "</tr>"
.
RTMHED99  RETURN
.------------------------------------------------------------
. Report Template Master (TABLE ROW)
.------------------------------------------------------------
RTMRW000  MATCH     SP70,WBRTDESC
          IF        @EQUAL 
            MOVE      "&nbsp;",KEY35
          ELSE
            MOVE      WBRTDESC,KEY35
          ENDIF  
.
          WRITE     HTMLFILE;"<tr><td nowrap><A HREF='javascript:ShowDetail09":
                             "(#"",LINKPRG,"#.pbl":
                             "?reportno=",LINKREP:
                             "&template=",LINKTEM:
                             "&wbrtm001=",WBRTPRID:
                             "&wbrtm002=",WBRTTMNM,"#")'>":
                             "<img src=../images/MaintenanceIcon.gif hspace=4":
                             " border=0 align=absmiddle></a>":
                             WBRTPRID,"</td>":
                             "<td>",WBRTTMNM,"</td><td>",KEY35,"</td>":
                             "</tr>"
.
RTMRW999 RETURN
.------------------------------------------------------------
. Option 10: report Groups Master Table
.------------------------------------------------------------
RGMTAB00  UNPACK    DIM127,D1,LINKPRG,DIM127
          UNPACK    DIM127,D1,LINKREP,DIM127
          UNPACK    DIM127,D1,LINKTEM,DIM127
.
          CALL      RGMHED00      * Output Table Heading
.
          IF        NORECORD=0
            MOVE      PTCNNRTD,NORECORD     * Set Default No Records to Display
          ENDIF
          MOVE      ZERO,RECNUMB
          MOVE      ZERO,DISNUMB
.
          PACK      KEY5,STARTKEY,SP70
          CALL      RDWBRGM1
          IF        OVRCD=0
            CALL      RPWBRGM1
          ENDIF   
.
RGMTAB10  CALL      RKWBRGM1
          BRANCH    OVRCD,RGMTAB90
.
          ADD       ONE,RECNUMB
          IF        STARTNUM>=RECNUMB
            GOTO      RGMTAB10
          ENDIF
.
          CALL      RGMRW000      * Web Server Templates Row
          ADD       ONE,DISNUMB
          COMPARE   NORECORD,DISNUMB
          GOTO      RGMTAB10 IF NOT EQUAL
          GOTO      RGMTAB99
.
RGMTAB90  CALL      NOMORE00      * Display No More Records Message
.
RGMTAB99  RETURN
.------------------------------------------------------------
. Report Groups Master (TABLE HEADING)
.------------------------------------------------------------
RGMHED00  WRITE     HTMLFILE;"<tr>":
                             "<td class=HeadingCell width=20%>Report Group ID</td>":
                             "<td class=HeadingCell width=80%>Description</td>":
                             "</tr>"
.
RGMHED99  RETURN
.------------------------------------------------------------
. Report Groups Master (TABLE ROW)
.------------------------------------------------------------
RGMRW000  MATCH     SP70,WBRGDESC
          IF        @EQUAL 
            MOVE      "&nbsp;",KEY35
          ELSE
            MOVE      WBRGDESC,KEY35
          ENDIF  
.
          WRITE     HTMLFILE;"<tr><td nowrap><A HREF='javascript:ShowDetail10":
                             "(#"",LINKPRG,"#.pbl":
                             "?reportno=",LINKREP:
                             "&template=",LINKTEM:
                             "&wbrgm001=",WBRGGRID,"#")'>":
                             "<img src=../images/MaintenanceIcon.gif hspace=4":
                             " border=0 align=absmiddle></a>":
                             WBRGGRID,"</td>":
                             "<td>",KEY35,"</td>":
                             "</tr>"
.
RGMRW999 RETURN
+
.------------------------------------------------------------
. Check if any record in Report Group details
.------------------------------------------------------------
GRDT0000  MOVE      ZERO,F1
          PACK      KEY16,WBRGM001,SP70
          CALL      RSWBRDT1
          CALL      RKWBRDT1
          BRANCH    OVRCD,GRDT9999
.
          MATCH     WBRGM001,WBRDGRID
          GOTO      GRDT9999 IF NOT EQUAL     * different program id
          MOVE      ONE,F1
.
GRDT9999  RETURN
+
.------------------------------------------------------------
. Option 11: report Group Details Table
.------------------------------------------------------------
RDTTAB00  UNPACK    DIM127,D1,LINKPRG,DIM127
          UNPACK    DIM127,D1,LINKREP,DIM127
          UNPACK    DIM127,D1,LINKTEM,DIM127
.
          CALL      RDTHED00      * Output Table Heading
.
          IF        NORECORD=0
            MOVE      PTCNNRTD,NORECORD     * Set Default No Records to Display
          ENDIF
          MOVE      ZERO,RECNUMB
          MOVE      ZERO,DISNUMB
.
          PACK      KEY16,WBRGM001,STARTKEY,SP70
          CALL      RDWBRDT1
          IF        OVRCD=0
            CALL      RPWBRDT1
          ENDIF   
.
RDTTAB10  CALL      RKWBRDT1
          BRANCH    OVRCD,RDTTAB90
.
          MATCH     WBRDGRID,WBRDT001
          GOTO      RDTTAB10 IF NOT EQUAL
. 
          ADD       ONE,RECNUMB
          IF        STARTNUM>=RECNUMB
            GOTO      RDTTAB10
          ENDIF
.
          CALL      RDTRW000      * Web Server Templates Row
          ADD       ONE,DISNUMB
          COMPARE   NORECORD,DISNUMB
          GOTO      RDTTAB10 IF NOT EQUAL
          GOTO      RDTTAB99
.
RDTTAB90  CALL      NOMORE00      * Display No More Records Message
.
RDTTAB99  RETURN
.------------------------------------------------------------
. Report Group Details (TABLE HEADING)
.------------------------------------------------------------
RDTHED00  WRITE     HTMLFILE;"<tr>":
                             "<td class=HeadingCell width=20%>Program ID</td>":
                             "<td class=HeadingCell width=20%>Template ID</td>":
                             "<td class=HeadingCell width=60%>Description</td>":
                             "</tr>"
.
RDTHED99  RETURN
.------------------------------------------------------------
. Report Groups Details (TABLE ROW)
.------------------------------------------------------------
RDTRW000  PACK      KEY11,WBRDPRID,WBRDTMID,SP70
          CALL      RDWBRTM1 
          IF        OVRCD=1
            MOVE      SP70,WBRTDESC
          ENDIF
.   
          WRITE     HTMLFILE;"<tr><td nowrap><A HREF='javascript:ShowDetail11":
                             "(#"",LINKPRG,"#.pbl":
                             "?reportno=",LINKREP:
                             "&template=",LINKTEM:
                             "&wbrdt001=",WBRDGRID:
                             "&wbrdt002=",WBRDPRID:
                             "&wbrdt003=",WBRDTMID:
                             "&wbrgm001=",WBRGGRID,"#")'>":
                             "<img src=../images/MaintenanceIcon.gif hspace=4":
                             " border=0 align=absmiddle></a>":
                             WBRDPRID,"</td>":
                             "<td>",WBRDTMID,"</td>":
                             "<td>",WBRTDESC,"</td>":
                             "</tr>"
.
RDTRW999 RETURN
.------------------------------------------------------------
. Option 12: Web User Report Groups Table
.------------------------------------------------------------
RURTAB00  UNPACK    DIM127,D1,LINKPRG,DIM127
          UNPACK    DIM127,D1,LINKREP,DIM127
          UNPACK    DIM127,D1,LINKTEM,DIM127
.
          CALL      RURHED00      * Output Table Heading
.
          IF        NORECORD=0
            MOVE      PTCNNRTD,NORECORD     * Set Default No Records to Display
          ENDIF
          MOVE      ZERO,RECNUMB
          MOVE      ZERO,DISNUMB
.
          PACK      KEY15,WBRUR001,STARTKEY,SP70
          CALL      RDWBRUR1
          IF        OVRCD=0
            CALL      RPWBRUR1
          ENDIF   
RURTAB10  CALL      RKWBRUR1
          BRANCH    OVRCD,RURTAB99
.
          MATCH     WBRUR001,WBRUUSID
          GOTO      RURTAB10 IF NOT EQUAL
.
          ADD       ONE,RECNUMB
          IF        STARTNUM>=RECNUMB
            GOTO      RURTAB10
          ENDIF
.
          CALL      RURRW000      * Web Server Templates Row
          ADD       ONE,DISNUMB
          COMPARE   NORECORD,DISNUMB
          GOTO      RURTAB10 IF NOT EQUAL
.
RURTAB99  RETURN
.------------------------------------------------------------
. Web User Report Groups (TABLE HEADING)
.------------------------------------------------------------
RURHED00  WRITE     HTMLFILE;"<tr>":
                         "<td class=HeadingCell width=30%>Report Group ID</td>":
                         "<td class=HeadingCell width=70%>Description</td>":
                             "</tr>"
.
RURHED99  RETURN
.------------------------------------------------------------
. Web User Report Groups (TABLE ROW)
.------------------------------------------------------------
RURRW000  PACK      KEY5,WBRUGRID,SP70
          CALL      RDWBRGM1
          IF        OVRCD=1
            MOVE      SP70,WBRGDESC
          ENDIF
.
          WRITE     HTMLFILE;"<tr><td nowrap><A HREF='javascript:ShowDetail12":
                             "(#"",LINKPRG,"#.pbl":
                             "?reportno=",LINKREP:
                             "&template=",LINKTEM:
                             "&wbrur002=",WBRUGRID:
                             "&wbrur001=",WBRUUSID,"#")'>":
                             "<img src=../images/MaintenanceIcon.gif hspace=4":
                             " border=0 align=absmiddle></a>":
                             WBRUGRID,"</td>":
                             "<td>",WBRGDESC,"</td>":
                             "</tr>"
.
RURRW999 RETURN
.------------------------------------------------------------
.         STSECVAR  Store WBSECXXX vars in file variables
.------------------------------------------------------------
STSECVAR  MATCH     Z70,WBSEC001
          IF        !@EQUAL
            MOVE      WBSEC001,WBSEUID
          ENDIF
.
          MATCH     Z70,WBSEC002
          IF        !@EQUAL
            MOVE      WBSEC002,WBSENAM
          ENDIF
.
          MATCH     Z70,WBSEC003
          IF        !@EQUAL
            MOVE      WBSEC003,WBSEDOC
          ENDIF
.
          MATCH     Z70,WBSEC004
          IF        !@EQUAL
            MOVE      WBSEC004,WBSEPCD
          ENDIF
.
          MATCH     Z70,WBSEC005
          IF        !@EQUAL
            MOVE      WBSEC005,WBSEWRD
          ENDIF
.
          MATCH     Z70,WBSEC006
          IF        !@EQUAL
            MOVE      WBSEC006,WBSESIT
          ENDIF
.
          MATCH     Z70,WBSEC007
          IF        !@EQUAL
            MOVE      WBSEC007,WBSECLI
          ENDIF
.
          MATCH     Z70,WBSEC008
          IF        !@EQUAL
            MOVE      WBSEC008,WBSEOCG
          ENDIF
.
          MATCH     Z70,WBSEC009
          IF        !@EQUAL
            MOVE      WBSEC009,WBSEDIR
          ENDIF
.
          MATCH     Z70,WBSEC010
          IF        !@EQUAL
            MOVE      WBSEC010,WBSEESC
          ENDIF
.
          MATCH     "1",INTPASSW        * internally managed passwords  
          IF        @EQUAL
            PACK      WBSEC012,WBSEC012,SP70
          ELSE             
            PACK      WBSEC012,SP70
          ENDIF
.
          MATCH     Z70,WBSEC012
          IF        !@EQUAL
            MATCH     SP70,WBSEC012
            IF        !@EQUAL
              UNPACK    WBSEC012,DAY,ANS,MONDESC,ANS,CENT,DYEAR
              CALL      MONNUM00
              MOVE      MONTH,FMON
              MOVE      DAY,FDAY
              MOVE      CENT,FCENT
              MOVE      DYEAR,FYEAR
              PACK      WBSEC012,FCENT,FYEAR,FMON,FDAY
              REP       " 0",WBSEC012
              MATCH     ZERO8,WBSEC012
              IF        @EQUAL
                PACK      WBSEEXP,SP70
              ELSE
                MOVE      WBSEC012,WBSEEXP
              ENDIF
            ELSE
              PACK      WBSEEXP,SP70
            ENDIF
          ENDIF
.
          MATCH     WBSEACT,WBSEC011
          IF         !@EQUAL
            MATCH     "1",WBSEC011 
            IF        @EQUAL 
              MOVE      ONE,WBSEACT
            ELSE
              MOVE      ZERO,WBSEACT
            ENDIF 
.
            MATCH     "1",INTPASSW            * internal password management ?
            GOTO      STSEC100 IF NOT EQUAL
.
            MATCH     "1",WBSEC011 
            IF        @EQUAL 
              CALL      IBACLOCK
              PACK      WBSEEXP,CCC,CYY,CMM,CDD
              REP       " 0",WBSEEXP
              MOVE      "A",UPDTTYPE
              MOVE      WBSEUID,USERNAME
              MOVE      "password",NEWPASSW
              MOVE      "password",VERPASSW 
              CALL      PASS0000
            ELSE
              BRANCH    ADDFLAG,STSEC100
              MOVE      "D",UPDTTYPE
              CALL      PASS0000
            ENDIF
          ENDIF
.
STSEC100  MATCH     "1",WBSEC013
          IF        @EQUAL
            MOVE      ONE,WBSEPSE
          ELSE
            MOVE      ZERO,WBSEPSE
          ENDIF
.
          MATCH     "1",WBSEC014
          IF        @EQUAL
            MOVE      ONE,WBSEAUT
          ELSE
            MOVE      ZERO,WBSEAUT
          ENDIF
.
          MATCH     Z70,WBSEC015
          IF        !@EQUAL
            MOVE      WBSEC015,WBSEAGE
          ENDIF
.
          MATCH     Z70,WBSEC016
          IF        !@EQUAL
            MOVE      WBSEC016,WBSEDFM
          ENDIF
.
          MATCH     Z70,WBSEC017
          IF        !@EQUAL
            MOVE      WBSEC017,WBSEDEPT
          ENDIF
.
          MATCH     Z70,WBSEC018
          IF        !@EQUAL
            MOVE      WBSEC018,WBSEGPCD
          ENDIF
.
          MATCH     Z70,WBSEC019
          IF        !@EQUAL
            MOVE      WBSEC019,WBSEGPPC
          ENDIF
.
          MATCH     Z70,WBSEC020
          IF        !@EQUAL
            MOVE      WBSEC020,WBSEGPCN
          ENDIF
.
          MATCH     Z70,WBSEC021
          IF        !@EQUAL
            MOVE      WBSEC021,WBSEDALL
          ENDIF
.
          MATCH     Z70,WBSEC022
          IF        !@EQUAL
            MOVE      WBSEC022,WBSEDTYP
          ENDIF
.
          MATCH     Z70,WBSEC023
          IF        !@EQUAL
            MOVE      WBSEC023,WBSEHLOC
          ENDIF
.
          MATCH     Z70,WBSEC024
          IF        !@EQUAL
            MOVE      WBSEC024,WBSEVWSL
          ENDIF
.
          MATCH     Z70,WBSEC025
          IF        !@EQUAL
            MOVE      WBSEC025,WBSEADSL
          ENDIF
.
          MATCH     Z70,WBSEC026
          IF        !@EQUAL
            MOVE      WBSEC026,WBSEDGSI
          ENDIF
.
          MATCH     Z70,WBSEC027
          IF        !@EQUAL
            MOVE      WBSEC027,WBSECASH
          ENDIF
.
          MATCH     Z70,WBSEC028
          IF        !@EQUAL
            MOVE      WBSEC028,WBSEFPCD
          ENDIF
.
          MATCH     Z70,WBSEC030
          IF        !@EQUAL
            MOVE      WBSEC030,WBSEMRTS
          ENDIF
.
          IF        IBCNMHOS=1
            MATCH     Z70,WBSEC031
            IF        !@EQUAL
              MOVE      WBSEC031,WBSEHOSP     * Multi Hospital ID
            ENDIF
          ENDIF
.
          MATCH     Z70,WBSEC032
          IF        !@EQUAL
            MOVE      WBSEC032,WBSELTYP     * Clinic Location Type
          ENDIF
.
          MATCH     Z70,WBSEC033
          IF        !@EQUAL
            MOVE      WBSEC033,WBSEFDEP     * User department free format
          ENDIF
.
          MATCH     Z70,WBSEC034
          IF        !@EQUAL
            MOVE      WBSEC034,WBSENURS     * User Nurse Code             
          ENDIF
.
          MATCH     Z70,WBSEC036
          IF        !@EQUAL
            MOVE      WBSEC036,WBSEBEDV     * Bed Board View Number       
          ENDIF
.
          MATCH     Z70,WBSEC038
          IF        !@EQUAL
            MOVE      WBSEC038,WBSEGPAC
          ENDIF
.
.                                           * see MVASEC00 for Security stuff
.
          IF        IBCNMHOS=1
            MATCH     Z70,WBSEC057
            IF        !@EQUAL
              MOVE      WBSEC057,WBSEHHOS   * MRT Home Hospital (if Multi Hosp)
            ENDIF
          ENDIF
.
          MATCH     Z70,WBSEC058
          IF        !@EQUAL
            MOVE      WBSEC058,WBSEUTLH     * Usual tracking location hospital
          ENDIF
.
          MATCH     Z70,WBSEC059
          IF        !@EQUAL
            MOVE      WBSEC059,WBSEUTLC     * Usual tracking location
          ENDIF
.
          MATCH     Z70,WBSEC060
          IF        !@EQUAL
            MOVE      WBSEC060,WBSEOPDU     * OP Direct User
          ENDIF
.
          MATCH     Z70,WBSEC062
          IF        !@EQUAL
            MOVE      WBSEC062,WBSEEMAI     * Email address  
          ENDIF
.
          MATCH     Z70,WBSEC063
          IF        !@EQUAL
            MOVE      WBSEC063,WBSELOGN     * Login Name
            MATCH     "0",INTPASSW
            IF        @EQUAL
              REPLACE   LOWUPP,WBSELOGN     * Fold loginname to lowercase
            ENDIF
          ENDIF
.
          MATCH     Z70,WBSEC064
          IF        !@EQUAL
            MOVE      WBSEC064,WBSEGENR     * Generic user id
          ENDIF
.
          MATCH     Z70,WBSEC065
          IF        !@EQUAL
            MOVE      WBSEC065,WBSEHCPC     * User HCP Code
          ENDIF
.
STSEC999  RETURN
.------------------------------------------------------------
.         STSTEVAR  Store WBSTEXXX vars in file vars
.------------------------------------------------------------
STSTEVAR  MATCH     Z70,WBSEC001
          IF        !@EQUAL
            MOVE      WBSEC001,WBSTUID
          ENDIF
.
          MATCH     Z70,WBSTE001
          IF        !@EQUAL
            MOVE      WBSTE001,WBSTPRG
          ENDIF
.
          COMPARE   ZERO,WBSTE002
          IF        !@EQUAL
            MOVE      WBSTE002,WBSTLEV
          ENDIF  
.
          MATCH     Z70,WBSTE003 
          IF        !@EQUAL
            MOVE      WBSTE003,WBSTUR1
          ENDIF
.
          MATCH     Z70,WBSTE004
          IF        !@EQUAL
            MOVE      WBSTE004,WBSTUR2
          ENDIF
.
          MATCH     Z70,WBSTE005
          IF        !@EQUAL
            MOVE      WBSTE005,WBSTUD1
          ENDIF
.
          MATCH     Z70,WBSTE006
          IF        !@EQUAL
            MOVE      WBSTE006,WBSTUD2
          ENDIF
.
          MATCH     Z70,WBSTE007
          IF        !@EQUAL
            MOVE      WBSTE007,WBSTUY1
          ENDIF
.
          MATCH     Z70,WBSTE008
          IF        !@EQUAL
            MOVE      WBSTE008,WBSTUY2
          ENDIF
.
STSTE999  RETURN
.------------------------------------------------------------
.         MONNUM00  Convert month name to number
.------------------------------------------------------------
MONNUM00    MATCH     JAN,MONDESC
            IF        @EQUAL
              MOVE      ONE,MONTH
              GOTO      MONNUM99
            ENDIF
.
            MATCH     FEB,MONDESC
            IF        @EQUAL
              MOVE      TWO,MONTH
              GOTO      MONNUM99
            ENDIF
.
            MATCH     MAR,MONDESC
            IF        @EQUAL
              MOVE      THREE,MONTH
              GOTO      MONNUM99
            ENDIF
.
            MATCH     APR,MONDESC
            IF        @EQUAL
              MOVE      FOUR,MONTH
              GOTO      MONNUM99
            ENDIF
.
            MATCH     MAY,MONDESC
            IF        @EQUAL
              MOVE      FIVE,MONTH
              GOTO      MONNUM99
            ENDIF
.
            MATCH     JUN,MONDESC
            IF        @EQUAL
              MOVE      SIX,MONTH
              GOTO      MONNUM99
            ENDIF
.
            MATCH     JUL,MONDESC
            IF        @EQUAL
              MOVE      SEVEN,MONTH
              GOTO      MONNUM99
            ENDIF
.
            MATCH     AUG,MONDESC
            IF        @EQUAL
              MOVE      EIGHT,MONTH
              GOTO      MONNUM99
            ENDIF
.
            MATCH     SEP,MONDESC
            IF        @EQUAL
              MOVE      NINE,MONTH
              GOTO      MONNUM99
            ENDIF
.
            MATCH     OCT,MONDESC
            IF        @EQUAL
              MOVE      TEN,MONTH
              GOTO      MONNUM99
            ENDIF
.
            MATCH     NOV,MONDESC
            IF        @EQUAL
              MOVE      TEN1,MONTH
              GOTO      MONNUM99
            ENDIF
.
            MATCH     DEC,MONDESC
            IF        @EQUAL
              MOVE      TEN2,MONTH
              GOTO      MONNUM99
            ENDIF
.
MONNUM99  RETURN
.------------------------------------------------------------
.         CLSECVAR  Clear Security ID Variables
.------------------------------------------------------------
CLSECVAR  MOVE      SP70,WBSEUID 
          MOVE      SP70,WBSENAM
          MOVE      SP70,WBSEDOC
          MOVE      SP70,WBSEPCD
          MOVE      SP70,WBSEWRD
          MOVE      SP70,WBSESIT
          MOVE      SP70,WBSECLI
          MOVE      SP70,WBSEOCG
          MOVE      SP70,WBSEDIR
          MOVE      SP70,WBSEESC
          MOVE      ZERO,WBSEACT
          MOVE      SP70,WBSEEXP
          MOVE      ZERO,WBSEPSE
          MOVE      SP70,WBSEDALL
          MOVE      SP70,WBSEDTYP
          MOVE      SP70,WBSEHLOC
          MOVE      SP70,WBSEVWSL
          MOVE      SP70,WBSEADSL
          MOVE      SP70,WBSEDGSI
          MOVE      SP70,WBSEDGSI
          MOVE      SP70,WBSEFPCD
	  MOVE      SP70,WBSECASH
          MOVE      SP70,WBSEHOSP
          MOVE      SP70,WBSELTYP
          MOVE      SP70,WBSEFDEP
          MOVE      SP70,WBSENURS
          MOVE      SP70,WBSECDAT
          MOVE      SP70,WBSECTIM
          MOVE      SP70,WBSECUID
          MOVE      SP70,WBSEUDAT
          MOVE      SP70,WBSEUTIM
          MOVE      SP70,WBSEUUID
          MOVE      SP70,WBSEBEDV
          MOVE      SP70,WBSEGPAC
          MOVE      SP70,WBSEHHOS
          MOVE      SP70,WBSEOPDU
          MOVE      SP70,WBSEUTLH
          MOVE      SP70,WBSEUTLC
          MOVE      SP70,WBSESPAR
.
CLSEC999  RETURN
.------------------------------------------------------------
.         CLSTEVAR  Clear Server Security Variables
.------------------------------------------------------------
CLSTEVAR  MOVE      SP70,WBSTUID
          MOVE      SP70,WBSTPRG
          MOVE      ZERO,WBSTLEV
          MOVE      SP70,WBSTUR1
          MOVE      SP70,WBSTUR2
          MOVE      SP70,WBSTUD1
          MOVE      SP70,WBSTUD2
          MOVE      SP70,WBSTUY1
          MOVE      SP70,WBSTUY2
.
CLSTE999  RETURN
.------------------------------------------------------------
. Ward selection
.------------------------------------------------------------
WSEL0000  PACK      KEY29,SP70
          IF        IBCNMHOS = 1
            PACK      KEY29,SP3,WBSEHOSP,SP70
          ENDIF
          CALL      RDSWARD7
WSEL0100  CALL      RDKWARD7
          BRANCH    OVRCD,WSEL9999
.
.                         if we have a bed number we have passed all the ward
.                         master records, so exit
          MATCH     SP70,WBED
          GOTO      WSEL9999 IF NOT EQUAL
.
          COMPARE   WACTIVE,ZERO                 *List only active wards
          GOTO      WSEL0100 IF NOT EQUAL
.
          IF        IBCNMHOS = 1
            MATCH      SP3,WBSEHOSP
            IF        !@EQUAL
              MATCH     WBSEHOSP,PTWDHOSN
              GOTO      WSEL9999 IF NOT EQUAL
            ENDIF
          ENDIF
.
.                       write the select option.
          WRITE     HTMLFILE;"<option value=#"",WWARD,"#"";
          MATCH     DFLTWARD,WWARD
          IF        @EQUAL
            WRITE     HTMLFILE;" selected";
          ENDIF
          WRITE     HTMLFILE;">",WBDESC;
.
          IF        IBCNMHOS = 1
            MATCH      SP3,WBSEHOSP
            IF        @EQUAL
              WRITE     HTMLFILE;" - ",PTWDHOSN;
            ENDIF
          ENDIF
.
          WRITE     HTMLFILE;"</option>"
          GOTO      WSEL0100
.
WSEL9999  RETURN
.
.------------------------------------------------------------
. Department selection
.------------------------------------------------------------
DSEL0000  PACK      KEY9,SP20
          PACK      KEY6,SP20
.
          CALL      RSIBDPT1
DSEL1000  CALL      RKIBDPT1
          BRANCH    OVRCD,DSEL9999
.
          MATCH     WBSEDEPT,IBDPDEPT
          IF        @EQUAL
            WRITE     HTMLFILE;"<option value=",IBDPDEPT," selected>":
                               IBDPDESC,"(",IBDPDEPT,")</option>";
          ELSE
            WRITE     HTMLFILE;"<option value=",IBDPDEPT,">":
                               IBDPDESC,"(",IBDPDEPT,")</option>";
          ENDIF
.
          GOTO      DSEL1000
.
DSEL9999  RETURN
.
.------------------------------------------------------------
. Department selection for hospital
.------------------------------------------------------------
DSELH000  PACK      KEY6,SP70                * selection list for hospital
          CALL      RSIBDPT1
DSELH100  CALL      RKIBDPT1
          BRANCH    OVRCD,DSELH999
          MATCH     SP70,IBDPDEPT
          GOTO      DSELH100 IF EQUAL
          MATCH     SP3,WBSEHOSP
          IF        !@EQUAL
            MATCH     WBSEHOSP,IBDPHOSP
            GOTO      DSELH100 IF NOT EQUAL
          ENDIF
          PACK      KEY8,QUOTE,IBDPDEPT,QUOTE
          MATCH     WBSEDEPT,IBDPDEPT
          IF        @EQUAL
            WRITE     HTMLFILE;"<option value=",KEY8," selected>":
                               IBDPDESC,"</option>"
          ELSE
            WRITE     HTMLFILE;"<option value=",KEY8,">":
                               IBDPDESC,"</option>"
          ENDIF
          GOTO      DSELH100
.
DSELH999  RETURN
+
.------------------------------------------------------------
.         PRGSEL00  Program ID Selection List
.------------------------------------------------------------
PRGSEL00  PACK      KEY8,SP70                * selection list
          CALL      RSWBSP1
PRGSEL10  CALL      RKWBSP1
          BRANCH    OVRCD,PRGSEL99
.
          MATCH     SP70,WBSPPRG
          GOTO      PRGSEL10 IF EQUAL
.
          PACK      KEY13,WBSPPRG,SP70
          CALL      RSWBTP1
          CALL      RKWBTP1
          BRANCH    OVRCD,PRGSEL99
.
          MATCH     SP70,WBTPPRG
          GOTO      PRGSEL10 IF EQUAL
.
          MATCH     "3",WBTPMTY
          GOTO      PRGSEL10 IF EQUAL
.
          PACK      KEY10,QUOTE,WBSPPRG,QUOTE
          WRITE     HTMLFILE;"<option value=",KEY10,">",WBSPNAM:
                             " (",WBSPPRG,")</option>"
          GOTO      PRGSEL10
.
PRGSEL99  RETURN
.------------------------------------------------------------
.         RPTSEL00  Report ID Selection List
.------------------------------------------------------------
RPTSEL00  PACK      KEY8,SP70         * report selection list
          CALL      RSWBSP1
RPTSEL10  CALL      RKWBSP1
          BRANCH    OVRCD,RPTSEL99
.
          MATCH     SP70,WBSPPRG
          GOTO      RPTSEL10 IF EQUAL
.
          PACK      KEY13,WBSPPRG,SP70                       
          CALL      RSWBTP1
          CALL      RKWBTP1
          BRANCH    OVRCD,RPTSEL99
.
          MATCH     SP70,WBTPPRG   
          GOTO      RPTSEL10 IF EQUAL
.     
          MATCH     "3",WBTPMTY
          GOTO      RPTSEL10 IF NOT EQUAL
.     
          PACK      KEY10,QUOTE,WBSPPRG,QUOTE
          WRITE     HTMLFILE;"<option value=",KEY10,">",WBSPNAM:
                             " (",WBSPPRG,")</option>"
          GOTO      RPTSEL10
.
RPTSEL99  RETURN
.------------------------------------------------------------
.  Location Site code
.  Parameter : 0=Description, 1=Code, 2=Selection List, 3=Seln for hosp
.------------------------------------------------------------
LOCSIT00  UNPACK    DIM127,D1,KEY1,DIM127
          MOVE      ZERO,F1
          MOVE      KEY1,F1
          BRANCH    F1,LOCSIT10,LOCSIT20,LOCSIT30
.
          PACK      KEY3,WBSEESC,SP70       * description
          CALL      RDEMSIT1
          IF        OVRCD=1
            MOVE      SP70,EMSTDESC
          ENDIF
.
          WRITE     HTMLFILE;EMSTDESC;
          GOTO      LOCSIT99
.
LOCSIT10  WRITE     HTMLFILE;WBSEESC;       * code
          GOTO      LOCSIT99
.
LOCSIT20  PACK      KEY3,SP70                * selection list
          CALL      RSEMSIT1
LOCSIT25  CALL      RKEMSIT1
          BRANCH    OVRCD,LOCSIT99
          MATCH     SP70,EMSTSCOD
          GOTO      LOCSIT25 IF EQUAL
          PACK      KEY6,QUOTE,EMSTSCOD,EMSTACTV,QUOTE
          MATCH     WBSEESC,EMSTSCOD
          IF        @EQUAL
            WRITE     HTMLFILE;"<option value=",KEY6," selected>":
                               EMSTDESC,"</option>"
          ELSE
            WRITE     HTMLFILE;"<option value=",KEY6,">",EMSTDESC,"</option>"
          ENDIF
          GOTO      LOCSIT25
.
LOCSIT30  PACK      KEY3,SP70                * selection list for hospital
          CALL      RSEMSIT1
LOCSIT35  CALL      RKEMSIT1
          BRANCH    OVRCD,LOCSIT99
          MATCH     SP70,EMSTSCOD
          GOTO      LOCSIT35 IF EQUAL
          MATCH     SP3,WBSEHOSP
          IF        !@EQUAL
            MATCH     WBSEHOSP,EMSTHSNO
            GOTO      LOCSIT35 IF NOT EQUAL
          ENDIF
          PACK      KEY6,QUOTE,EMSTSCOD,EMSTACTV,QUOTE
          MATCH     WBSEESC,EMSTSCOD
          IF        @EQUAL
            WRITE     HTMLFILE;"<option value=",KEY6," selected>":
                               EMSTDESC,"</option>"
          ELSE
            WRITE     HTMLFILE;"<option value=",KEY6,">",EMSTDESC,"</option>"
          ENDIF
          GOTO      LOCSIT35
.
LOCSIT99  RETURN
.---------------------------------------------------------------
.  Outpatient Site code
.  Parameter : 0=Description, 1=Code, 2=Selection List
.---------------------------------------------------------------
OUTSIT00  UNPACK    DIM127,D1,KEY1,DIM127
          MOVE      ZERO,F1
          MOVE      KEY1,F1
          BRANCH    F1,OUTSIT10,OUTSIT20
.
          PACK      KEY6,WBSESIT,SP70         * description
          CALL      RDSITA1
          IF        OVRCD=1
            MOVE      SP70,OSTDESC
          ENDIF
.
          WRITE     HTMLFILE;OSTDESC
          GOTO      OUTSIT99
.
OUTSIT10  WRITE     HTMLFILE;WBSESIT;         * code
          GOTO      OUTSIT99
.
OUTSIT20  PACK      KEY6,SP70                 * selection list
          CALL      RDSSITA1
OUTSIT21  CALL      RDKSITA1
          BRANCH    OVRCD,OUTSIT99
          MATCH     SP70,OSTSITE
          GOTO      OUTSIT21 IF EQUAL
          PACK      KEY10,QUOTE,OSTSITE,QUOTE
          MATCH     WBSESIT,OSTSITE
          IF        @EQUAL
            WRITE     HTMLFILE;"<option value=",KEY10," selected>":
                               OSTDESC,"</option>"
          ELSE
            WRITE     HTMLFILE;"<option value=",KEY10,">",OSTDESC,"</option>"
          ENDIF
          GOTO      OUTSIT21
.
OUTSIT99  RETURN
.------------------------------------------------------------
.  Report Groups Master
.  Parameter : 0=Description, 1=Code, 2=Selection List
.------------------------------------------------------------
REPGRP00  UNPACK    DIM127,D1,KEY1,DIM127
          MOVE      ZERO,F1
          MOVE      KEY1,F1
          BRANCH    F1,REPGRP10,REPGRP20
.
          PACK      KEY5,WBRUGRID,SP70         * description
          CALL      RDWBRGM1
          IF        OVRCD=1
            MOVE      SP70,WBRGDESC
          ENDIF
.
          WRITE     HTMLFILE;WBRGDESC
          GOTO      OUTSIT99
.
REPGRP10  WRITE     HTMLFILE;WBRUGRID         * code
          GOTO      REPGRP99
.
REPGRP20  PACK      KEY5,SP70                 * selection list
          CALL      RDWBRGM1
REPGRP30  CALL      RKWBRGM1
          BRANCH    OVRCD,REPGRP99
          PACK      KEY10,QUOTE,WBRGGRID,QUOTE
          MATCH     WBRUGRID,WBRGGRID
          IF        @EQUAL
            WRITE     HTMLFILE;"<option value=",KEY10," selected>":
                               WBRGDESC,"</option>"
          ELSE
            WRITE     HTMLFILE;"<option value=",KEY10,">",WBRGDESC,"</option>"
          ENDIF
          GOTO      REPGRP30
.
REPGRP99  RETURN
.
.-------------------------------------------------
. Allocate a passcode and write record to ihapasaf
.-------------------------------------------------
ALLP0000  MOVE    SECPASSC,SECODE
          MOVE    SP70,SECNUMB
          MOVE    WBSENAM,SECUSER
          MOVE    SP70,SECACCT
          MOVE    SP70,SECNUMB1
          MOVE    SP70,SECNUMB2
          MOVE    ZERO,SECDIRCT
          MOVE    SP70,SECMENU  
          MOVE    SP70,SECPRINT  
          MOVE    SP70,SECDEPT  
          MOVE    SP70,SECMNNUM  
          MOVE    SP70,SECSPARE  
.
          PACK    KEY4,SECODE
          CALL    WRPASS1
.
ALLP9999  RETURN
.**********************************************************************
. Get next bank rec unique id. 
. 4 character passcodes with a single leading alpha character.
.**********************************************************************
GNID0000  MOVE      ZERO,EXIT
          MOVE      SP70,SECPASSC
          PACK      KEY4,ZEND
          CALL      RDSPASS1
          CALL      RDPPASS1
          BRANCH    OVRCD,GNID1150
.
          UNPACK    SECODE,ANS,KEY3
          MATCH     "a",ANS
          GOTO      GNID1150 IF LESS
          MOVE      ZERO,F3
          MOVE      KEY3,F3
.
GNID1100  COMPARE   "999",F3          * at end of group ?
          GOTO      GNID1110 IF NOT EQUAL
.
          MATCH     "Z",ANS
          GOTO      GNID9000 IF EQUAL
.
          REP       REPUNIQ,ANS
          MOVE      ZERO,F3
.
GNID1110  ADD       ONE,F3
          MOVE      F3,D3
          REP       " 0",D3
          PACK      KEY4,ANS,D3,SP70
          CALL      RDPASS1
          BRANCH    OVRCD,GNID9500
          GOTO      GNID1100
.
.---- no records !! ----
.
GNID1150  MOVE      ONE,F3
          MOVE      "a",ANS
          MOVE      F3,D3
          REP       " 0",D3
          PACK      KEY4,ANS,D3,SP70
          GOTO      GNID9500
.
. If all 4 characters leading single alpha passscodes have been
. used start generate new passcodes with 2 leading alpha characters.
.
GNID9000  CALL      GNIX0000          * Passcoded after 52000 
          IF        EXIT=0
            GOTO      GNID9500  
          ENDIF
.
          MOVE      ONE,EXIT          * Passcode allocation full
          GOTO      GNID9999
.
GNID9500  MOVE      KEY4,SECPASSC
GNID9999  RETURN
.
.----------------------------------------------------------------------
. GNIX0000  - 4 character passcodes with a two leading alpha character.
. RETURNS: SECPASSC
. 
.----------------------------------------------------------------------
GNIX0000  MOVE      ZERO,EXIT
          MOVE      SP70,SECPASSC
.
          MOVE      "aa00",KEY4             * Start at aa00
          CALL      RDPASS1
          BRANCH    OVRCD,GNIX1150          * No aa00 so write record
.
          UNPACK    SECODE,ANS,KEY1,KEY2
          UNPACK    SECODE,DIM2
          MOVE      ZERO,F2
          MOVE      KEY2,F2
          GOTO      GNIX1110                * Loop forward from aa00
.
GNIX1100  COMPARE   "99",F2                 * at end of numeric group ?
          GOTO      GNIX1110 IF NOT EQUAL
.
          MATCH     "ZZ",DIM2               * ZZ99 passcode allocation full     
          GOTO      GNIX9000 IF EQUAL
.
          MATCH     "Z",KEY1                * End of seconds alpha number
          IF        @EQUAL
            REP       REPUNIQ,ANS           * Increase first alpha and start
            MOVE      "a",KEY1              * second alpha character with an a
          ELSE
            REP       REPUNIQ,KEY1          * Increase second alpha character
          ENDIF
.
          MOVE      ZERO,F2
          GOTO      GNIX1120                * Start at 00 of next combination
.
GNIX1110  ADD       ONE,F2
GNIX1120  MOVE      F2,D2
          REP       " 0",D2
          PACK      KEY4,ANS,KEY1,D2,SP70
          CALL      RDPASS1
          BRANCH    OVRCD,GNIX9500          * Passcode free so use it
.
          PACK      DIM2,ANS,KEY1,SP70      * Current prefix
          GOTO      GNIX1100                * Loop forward to find free passcode
.
.---- no aa00 records !! ----
.
GNIX1150  MOVE      ZERO,F2                 * Write aa00 record
          MOVE      "a",ANS
          MOVE      "a",KEY1
          MOVE      F2,D2
          REP       " 0",D2
          PACK      KEY4,ANS,KEY1,D2,SP70
          GOTO      GNIX9500
.
GNIX9000  MOVE      ONE,EXIT          * Passcode allocation full
          GOTO      GNIX9999
.
GNIX9500  MOVE      ZERO,EXIT
          MOVE      KEY4,SECPASSC
.
GNIX9999  RETURN
.
.------------------------------------------------------------
.         RESSEC00  Reset the password for a user id 
.------------------------------------------------------------
RESSEC00  PACK      KEY10,WBSEC001,SP70
          CALL      RDWBSE1
          BRANCH    OVRCD,RESSEC90
.
RESSEC50  CALL      IBACLOCK
          PACK      WBSEEXP,CCC,CYY,CMM,CDD     * Set password expiry date
          REP       " 0",WBSEEXP
.
          MOVE      USERID,WBSEUUID
          PACK      WBSEUDAT,CC,YY,MM,DD
          REP       " 0",WBSEUDAT
          MOVE      CTIMEIS,WBSEUTIM
.
          CALL      UPWBSE1
.
          MOVE      "A",UPDTTYPE                 * Add pwd (replaces existing)
          MOVE      WBSELOGN,USERNAME
          MOVE      "password",NEWPASSW
          MOVE      "password",VERPASSW
          CALL      PASS0000
.
          GOTO      RESSEC99
.
RESSEC90  MOVE      "Security ID not on file",WEBTITLE
          CALL      WEBERR00
          MOVE      ONE,EXIT
          GOTO      RESSEC99
.
RESSEC99  RETURN
.
.------------------------------------------------------------
. Hospital Selection (with default home location)
.------------------------------------------------------------
HSED0000  PACK      KEY3,SP70
          CALL      RSPTHSP1
HSED0100  CALL      RKPTHSP1
          BRANCH    OVRCD,HSED9999
.         
          MOVE      PTHSNAME,KEY50
          PACK      KEY9,QUOTE,PTHSHOSP,PTHSHLOC,QUOTE
          MATCH     DIM3,PTHSHOSP
          IF        @EQUAL
            WRITE     HTMLFILE;"<option value=",KEY9," selected>":
                               KEY50,"</option>"
          ELSE      
            WRITE     HTMLFILE;"<option value=",KEY9,">",KEY50,"</option>"
          ENDIF
          GOTO      HSED0100
.
HSED9999  RETURN
.------------------------------------------------------------
. Table of Hospital Specific HCP Codes
.------------------------------------------------------------
HHCP0000  COMPARE   ONE,IBCNMHOS
          GOTO      HHCP9999 IF NOT EQUAL
.
          CALL      HHED0000      * Output Table Heading
.
          PACK      KEY3,SP70
          CALL      RSPTHSP1
HHCP1000  CALL      RKPTHSP1
          BRANCH    OVRCD,HHCP9999
.
          WRITE     HTMLFILE;"<tr><td>",PTHSNAME,"</td>":
                             "<td align=center>":
                             "<input type=checkbox name=lhosparr";
.
          PACK      WBSEC001,WBSEC001,SP70
          PACK      KEY13,WBSEC001,PTHSHOSP,SP70
          CALL      RDMLSEC1
          IF        OVRCD=0
            WRITE     HTMLFILE;" checked ";
          ENDIF
.
          WRITE     HTMLFILE;" value='",PTHSHOSP,"'>":
                             "</td></tr>"
.
          GOTO      HHCP1000
.
HHCP9999  RETURN
.
.------------------------------------------------------------------------------
. Table of O/P Site Codes for user WBSEC001. %WEBSEC01.03.075
.------------------------------------------------------------------------------
SHCP0000  CALL      SCHD0000      * Output Table Heading
.
          PACK      KEY6,SP70
          CALL      RDSSITA1 
SHCP1000  CALL      RDKSITA1
          BRANCH    OVRCD,SHCP9999
.
          WRITE     HTMLFILE;"<tr><td>",OSTDESC,"</td>":
                             "<td align=center>":
                             "<input type=checkbox name=lsitparr";
.
          PACK      WBSEC001,WBSEC001,SP70
          PACK      KEY16,WBSEC001,OSTSITE,SP70
          CALL      RDMLSIT1
          IF        OVRCD=0
            WRITE     HTMLFILE;" checked ";
          ENDIF
.
          WRITE     HTMLFILE;" value='",OSTSITE,"'>":
                             "</td></tr>"
.
          GOTO      SHCP1000
.
SHCP9999  RETURN
.
.------------------------------------------------------------------------------
. Hospital Specific HCP Codes (TABLE HEADING)
.------------------------------------------------------------------------------
HHED0000  WRITE     HTMLFILE;"<tr>":
                             "<td class=HeadingCell width=60%>Hospital</td>":
                             "<td class=HeadingCell align=center width=40%>":
                             "Link</td>":
                             "</tr>"
.
HHED9999  RETURN
.
.------------------------------------------------------------------------------
. O/P Site Codes (TABLE HEADING)
.------------------------------------------------------------------------------
SCHD0000  WRITE     HTMLFILE;"<tr>":
                             "<td class=HeadingCell width=60%>O/P Site</td>":
                             "<td class=HeadingCell align=center width=40%>":
                             "Link</td>":
                             "</tr>"
.
SCHD9999  RETURN
.
.------------------------------------------------------------------------------
. Update HCP Hospital Access Details
.------------------------------------------------------------------------------
LHOS0000  COMPARE   ONE,IBCNMHOS
          GOTO      LHOS9999 IF NOT EQUAL
.
          PACK      WBSEC001,WBSEC001,SP70
.
          PACK      KEY13,WBSEC001,SP70
          CALL      RDMLSEC1
          BRANCH    OVRCD,LHOS0500
          CALL      DEMLSEC1
.
LHOS0500  PACK      KEY13,WBSEC001,SP70
          CALL      RSMLSEC1
LHOS1000  CALL      RKMLSEC1                * Delete all linked codes
          BRANCH    OVRCD,LHOS3000
.
          MATCH     WBSEC001,MLSCUSID
          GOTO      LHOS3000 IF NOT EQUAL
.
          PACK      KEY13,MLSCUSID,MLSCHOSP,SP70
          CALL      DEMLSEC1
.
          GOTO      LHOS1000
.
LHOS3000  MOVE      ZERO,ARRCNT
.
LHOS3100  ADD       ONE,ARRCNT                   * Write hospital links
          IF        ARRCNT>LHOSPCNT
            GOTO      LHOS8000
          ENDIF
.
          MATCH     SP70,LHOSPARR[ARRCNT]
          GOTO      LHOS3100 IF EQUAL
.
          PACK      MLSCHOSP,LHOSPARR[ARRCNT],SP70
          PACK      MLSCUSID,WBSEC001,SP70
          MOVE      SP70,MLSCSPAR
.
          PACK      KEY13,MLSCUSID,MLSCHOSP,SP70
          CALL      RAMLSEC1
          IF        OVRCD=1
            CALL     WRMLSEC1
          ENDIF
.
          GOTO      LHOS3100
.
LHOS8000  MOVE      ZERO,EXIT
          GOTO      LHOS9999
.
LHOS9999  RETURN
.
.------------------------------------------------------------------------------
. Update O/P Site Access Details (NOT 'All Outpatient Access')
.------------------------------------------------------------------------------
LSIT0000  PACK      WBSEC001,WBSEC001,SP70
.
          PACK      KEY16,WBSEC001,SP70
          CALL      RDMLSIT1
          BRANCH    OVRCD,LSIT0500
          CALL      DEMLSIT1
.
LSIT0500  PACK      KEY16,WBSEC001,SP70
          CALL      RSMLSIT1
LSIT1000  CALL      RKMLSIT1                        * Delete all linked codes
          BRANCH    OVRCD,LSIT2000
.
          MATCH     WBSEC001,MLSTUSID
          GOTO      LSIT2000 IF NOT EQUAL
.
          PACK      KEY16,MLSTUSID,MLSTSITE,SP70
          CALL      DEMLSIT1
.
          GOTO      LSIT1000
.
LSIT2000  MOVE      ZERO,ARRCNT
.
LSIT2100  ADD       ONE,ARRCNT                      * Write O/P Site links
          IF        ARRCNT>LSITECNT
            GOTO      LSIT8000
          ENDIF
.
          MATCH     SP70,LSITPARR[ARRCNT]
          GOTO      LSIT2100 IF EQUAL
.
          PACK      MLSTSITE,LSITPARR[ARRCNT],SP70
          PACK      MLSTUSID,WBSEC001,SP70
          MOVE      SP70,MLSTSPAR
.
          PACK      KEY16,MLSTUSID,MLSTSITE,SP70
          CALL      RAMLSIT1
          IF        OVRCD=1
            CALL      WRMLSIT1
          ENDIF
.
          GOTO      LSIT2100
.
LSIT8000  MOVE      ZERO,EXIT
          GOTO      LSIT9999
.
LSIT9999  RETURN
.
.-----------------------------------------------------------------------
. Set Site Access Security Records
. If WBSEC061=1 then All Site Access set. Will delete all records from
. Multi Site Security File (MLTSITFD). A new record will be writen
. with the user ID and a blank site ID
.-----------------------------------------------------------------------
ASIT0000  PACK      WBSEC001,WBSEC001,SP70
          MATCH     Z70,WBSEC061
          GOTO      ASIT9999 IF EQUAL
          MATCH     "1",WBSEC061
          GOTO      ASIT1000 IF EQUAL
.
          PACK      KEY16,WBSEC001,SP70    
          CALL      RDMLSIT1
          BRANCH    OVRCD,ASIT9999
.
          CALL      DEMLSIT1
.
          GOTO      ASIT9999
.
ASIT1000  PACK      KEY16,WBSEC001,SP70
          CALL      RSMLSIT1
          CALL      RKMLSIT1
          BRANCH    OVRCD,ASIT2000
.
          MATCH     WBSEC001,MLSTUSID
          GOTO      ASIT2000 IF NOT EQUAL
.
          PACK      KEY16,MLSTUSID,MLSTSITE,SP70
          CALL      DEMLSIT1
          GOTO      ASIT1000
.
ASIT2000  PACK      KEY16,WBSEC001,SP70
          CALL      RDMLSIT1
          BRANCH    OVRCD,ASIT3000
.
          GOTO      ASIT9999
.
ASIT3000  MOVE      WBSEC001,MLSTUSID
          PACK      MLSTSITE,SP70
          MOVE      SP70,MLSTSPAR
.
          PACK      KEY16,MLSTUSID,MLSTSITE,SP70
          CALL      WRMLSIT1
.
ASIT9999  RETURN
.
.------------------------------------------------------------
. Group Security Maintenance
.------------------------------------------------------------
GRPM0000  RESET     UPDTTYPE
          MATCH     SP1,UPDTTYPE
          GOTO      GRPM5000 IF EQUAL
.
          MATCH     "A",UPDTTYPE    * Add formaction
          GOTO      GRPM1000 IF EQUAL
.
          MATCH     "U",UPDTTYPE    * Update formaction
          GOTO      GRPM2000 IF EQUAL
.
          MATCH     "D",UPDTTYPE    * Delete formaction
          GOTO      GRPM3000 IF EQUAL
.
          GOTO      GRPM9000
.
.         ************ ADD FORMACTION ***********
.
GRPM1000  PACK      KEY10,WBGRP001,SP70
          CALL      RDWBGRP1
          COMPARE   ZERO,OVRCD
          GOTO      GRPM9100 IF EQUAL
.
          CALL      CLWBGR00                     * Clear file vars	   
          CALL      SAVGRP00                     * Move cgi to file variables
.
          PACK      KEY8,CCC,CYY,CMM,CDD
          REP       " 0",KEY8
          MOVE      KEY8,WBGRCDAT                * System date
          CLOCK     TIME,WBGRCTIM                * System time (Var chgd HPS)
          MOVE      USERID,WBGRCUID              * web user id
.
          MOVE      SP70,WBGRUDAT
          MOVE      SP70,WBGRUTIM
          MOVE      SP70,WBGRUUID
.
          PACK      KEY10,WBGRGRPC,SP70
          CALL      WRWBGRP1                     * Writes the data
.
          MOVE      ZERO,EXIT
          GOTO      GRPM9999
.
.         ************ UPDATE FORMACTION **********
.
GRPM2000  PACK      KEY10,WBGRP001,SP70
          CALL      RDWBGRP1
          BRANCH    OVRCD,GRPM9100
.
          CALL      SAVGRP00                     * Moves cgi to file variables
.
          PACK      KEY8,CCC,CYY,CMM,CDD
          REP       " 0",KEY8
          MOVE      KEY8,WBGRUDAT                * System date
          CLOCK     TIME,WBGRUTIM                * System time  (Var chgd HPS)
          MOVE      USERID,WBGRUUID              * web user id
          CALL      UPWBGRP1                     * Updates the data
.
          MOVE      ZERO,EXIT
          GOTO      GRPM9999
.
.         ************ DELETE FORMACTION **********
.
GRPM3000  PACK      KEY10,WBGRP001,SP70
          CALL      RDWBGRP1
          BRANCH    OVRCD,GRPM9100
.
          CALL      DEWBGRP1
.
          MOVE      ZERO,EXIT
          GOTO      GRPM9999
.
.         ************ DISPLAY FORMACTION **********
.
GRPM5000  PACK      KEY10,WBGRP001,SP70
          CALL      RDWBGRP1                      * Read department table
          IF        OVRCD=1
            CALL      CLWBGR00                    * Clear all the file variables
          ENDIF
.
          CLEAR     WEBTITLE
          MOVE      "Security Group Maintenance",WEBTITLE
          RESET     WEBTITLE
.
          CALL      WEBHED00   * Create Output File and Write HTML Page Header
          BRANCH    EXIT,GRPM9999
.
          CALL      WEBBOD00   * Process Web Body
          CALL      WEBEND00   * Process End of HTML File
          MOVE      ONE,EXIT
          GOTO      GRPM9999
.
GRPM9000  MOVE      "Invalid Update Type.",WEBTITLE
          CALL      WEBERR00
          MOVE      ONE,EXIT
          GOTO      GRPM9999
.
GRPM9100  MOVE      "Security Group Code Exists",WEBTITLE
          CALL      WEBERR00
          MOVE      ONE,EXIT
          GOTO      GRPM9999
.
GRPM9200  MOVE      "Security Group Code Does Not Exist",WEBTITLE
          CALL      WEBERR00
          MOVE      ONE,EXIT
          GOTO      GRPM9999
.
GRPM9999  RETURN
.
.------------------------------------------------------------
. Clear File Vars Group Security
.------------------------------------------------------------
CLWBGR00  MOVE      SP70,WBGRGRPC
          MOVE      SP70,WBGRDESC
          MOVE      SP70,WBGRSURL 
          MOVE      SP70,WBGRACTV
          MOVE      SP70,WBGRCDAT
          MOVE      SP70,WBGRCTIM
          MOVE      SP70,WBGRCUID
          MOVE      SP70,WBGRUDAT
          MOVE      SP70,WBGRUTIM
          MOVE      SP70,WBGRUUID
          MOVE      SP70,WBGRSPAR
.
CLWBGR99  RETURN
.
.-------------------------------------------------------------------------------
.   Set Parameters for Option 14: Web security groups
.-------------------------------------------------------------------------------
WBGRP000  MOVE      ZERO,EXIT
          UNPACK    QRYNAME,KEY5,KEY3
          MOVE      KEY3,F3
          BRANCH    F3,WBGRP001,WBGRP002,WBGRP003,WBGRP004
.
          MOVE      ONE,EXIT
          GOTO      WBGRP999
.
WBGRP001  PACK      WBGRP001,QRYDATA,SP70
          GOTO      WBGRP999
.
WBGRP002  MOVE      QRYDATA,WBGRP002
          GOTO      WBGRP999
.
WBGRP003  MOVE      QRYDATA,WBGRP003
          GOTO      WBGRP999
.
WBGRP004  MOVE      QRYDATA,WBGRP004
          GOTO      WBGRP999
.
WBGRP999  RETURN
.
.------------------------------------------------------------
. WBGR0000 - Web Security Groups
.------------------------------------------------------------
WBGR0000  BRANCH    FLDITMNO,WBGR0100,WBGR0200,WBGR0300,WBGR0400,WBGR0500:
                             WBGR0600,WBGR0700,WBGR0800,WBGR0900,WBGR1000:
                             WBGR1100,WBGR1200,WBGR1300
.
          WRITE     HTMLFILE;"Invalid Tag";
          GOTO      WBGR9999
.
WBGR0100  WRITE     HTMLFILE;WBGRGRPC;  
          GOTO      WBGR9999
.
WBGR0200  WRITE     HTMLFILE;WBGRDESC;
          GOTO      WBGR9999
.
WBGR0300  WRITE     HTMLFILE;WBGRSURL;
          GOTO      WBGR9999
.
WBGR0400  WRITE     HTMLFILE;WBGRACTV;
          GOTO      WBGR9999
.
WBGR0500  MATCH     WBGRCDAT,SP70
          GOTO      WBGR9999 IF EQUAL
.
          UNPACK    WBGRCDAT,CCENT,CYEAR,CMON,CDAY
          MOVE      CMON,F2
          LOAD      MTHNAM3,F2,JAN,FEB,MAR,APR,MAY,JUN,JUL,AUG,SEP,OCT,NOV,DEC
          WRITE     HTMLFILE;CDAY,SP1,MTHNAM3,SP1,CCENT,CYEAR;
          GOTO      WBGR9999
.
WBGR0600  MATCH     WBGRCTIM,SP70
          GOTO      WBGR9999 IF EQUAL
.
          WRITE     HTMLFILE;WBGRCTIM;
          GOTO      WBGR9999
.
WBGR0700  MATCH     SP70,WBGRCUID
          GOTO      WBGR9999 IF EQUAL
.
          PACK      KEY10,WBGRCUID,SP70
          CALL      RDWBSE1
          IF        OVRCD=1
            MOVE      WBGRCUID,WBSENAM
          ENDIF
          WRITE     HTMLFILE;WBSENAM;
          GOTO      WBGR9999
.
WBGR0800  MATCH     WBGRUDAT,SP70
          GOTO      WBGR9999 IF EQUAL
.
          UNPACK    WBGRUDAT,CCENT,CYEAR,CMON,CDAY
          MOVE      CMON,F2
          LOAD      MTHNAM3,F2,JAN,FEB,MAR,APR,MAY,JUN,JUL,AUG,SEP,OCT,NOV,DEC
          WRITE     HTMLFILE;CDAY,SP1,MTHNAM3,SP1,CCENT,CYEAR;
          GOTO      WBGR9999
.
WBGR0900  MATCH     WBGRUTIM,SP70
          GOTO      WBGR9999 IF EQUAL
.
          WRITE     HTMLFILE;WBGRUTIM;
          GOTO      WBGR9999
.
WBGR1000  MATCH     SP70,WBGRUUID
          GOTO      WBGR9999 IF EQUAL
.
          PACK      KEY10,WBGRUUID,SP70
          CALL      RDWBSE1
          IF        OVRCD=1
            MOVE      WBGRUUID,WBSENAM
          ENDIF
          WRITE     HTMLFILE;WBSENAM;
          GOTO      WBGR9999
.
WBGR1100  CALL      GTAB0000
          GOTO      WBGR9999
.
WBGR1200  CALL      NEXT0000
          GOTO      WBGR9999
.
WBGR1300  CALL      PREV0000
          GOTO      WBGR9999
.
WBGR9999  RETURN
.------------------------------------------------------------
. Move CGI to File Vars Group Security
.------------------------------------------------------------
SAVGRP00  MATCH     Z70,WBGRP001
          IF        !@EQUAL
            MOVE      WBGRP001,WBGRGRPC
          ENDIF
.
          MATCH     Z70,WBGRP002
          IF        !@EQUAL
            MOVE      WBGRP002,WBGRDESC
          ENDIF
.
          MATCH     Z70,WBGRP003
          IF        !@EQUAL
            MOVE      WBGRP003,WBGRSURL
          ENDIF
.
          MATCH     Z70,WBGRP004
          IF        !@EQUAL
            MOVE      WBGRP004,WBGRACTV
          ENDIF
.
SAVGRP99  RETURN
.
.------------------------------------------------------------
. Option 14: Security Group List
.------------------------------------------------------------
GTAB0000  UNPACK    DIM127,D1,LINKPRG,DIM127
          UNPACK    DIM127,D1,LINKREP,DIM127
          UNPACK    DIM127,D1,LINKTEM,DIM127
.
          CALL      GHED0000                * Output Table Heading
.
          IF        NORECORD=0
            MOVE      PTCNNRTD,NORECORD     * Set Default No Records to Display
          ENDIF
          MOVE      ZERO,RECNUMB
          MOVE      ZERO,DISNUMB
.
          PACK      KEY10,STARTKEY,SP70
          CALL      RDWBGRP1
          IF        OVRCD=0
            GOTO      GTAB1100
          ENDIF
.
GTAB1000  CALL      RKWBGRP1
          BRANCH    OVRCD,GTAB9000
.
GTAB1100  ADD       ONE,RECNUMB
          IF        STARTNUM>=RECNUMB
            GOTO      GTAB1000
          ENDIF
.
          CALL      GROW0000                * Security Group Rows
          ADD       ONE,DISNUMB
.
          COMPARE   NORECORD,DISNUMB
          GOTO      GTAB1000 IF NOT EQUAL
          GOTO      GTAB9999
.
GTAB9000  CALL      NOMORE00         * Display No More Records Message
.
GTAB9999  RETURN
.------------------------------------------------------------
. Security Group (TABLE HEADING)
.------------------------------------------------------------
GHED0000  WRITE     HTMLFILE;"<tr>":
                             "<td class=HeadingCell width=10%>Code</td>":
                             "<td class=HeadingCell>Description</td>":
                             "<td class=HeadingCell>URL</td>":
                             "<td class=HeadingCell width=10%>Active</td>":
                             "</tr>"
.
GHED9999  RETURN
.------------------------------------------------------------
. Security Group (TABLE ROW)
.------------------------------------------------------------
GROW0000  MOVE      "Yes",KEY3
          MATCH     "1",WBGRACTV
          IF        @EQUAL
            MOVE      "No ",KEY3
          ENDIF
.
           WRITE     HTMLFILE;"<tr><td nowrap><A HREF='javascript:ShowDetail14":
                             "(#"",LINKPRG,"#.pbl":
                             "?reportno=",LINKREP:
                             "&template=",LINKTEM:
                             "&wbgrp001=",WBGRGRPC,"#")'>":
                             "<img src=../images/MaintenanceIcon.gif hspace=4":
                             " border=0 align=absmiddle></a>":
                             WBGRGRPC,"</td>":
                             "<td>",WBGRDESC,"</td>":
                             "<td>",WBGRSURL,"</td>":
                             "<td>",KEY3,"</td>":
                             "</tr>"
.
GROW9999 RETURN
.
.-----------------------------------------------------------------------
. Set Group Security Records
. If WBSEC037=1 then All Security Groups set! Will delete all records from
. the Group Security File (WEBSGPFD). A new record will be writen
. with the user ID and a blank Security Group Code.
. If WBSEC037 not 1 then it will delete the All Security Groups Record
.-----------------------------------------------------------------------
GRPSEC00  PACK      WBSEC001,WBSEC001,SP70
.
          MATCH     Z70,WBSEC037
          GOTO      GRPSEC99 IF EQUAL
.
          MATCH     "1",WBSEC037
          GOTO      GRPSEC10 IF EQUAL

          PACK      KEY20,WBSEC001,SP70    * All security group access?
          CALL      RDWBSGP1
          BRANCH    OVRCD,GRPSEC99
.
          CALL      DEWBSGP1
.
          GOTO      GRPSEC99
.
GRPSEC10  PACK      KEY20,WBSEC001,SP70    * Security group file
          CALL      RSWBSGP1
          CALL      RKWBSGP1
          BRANCH    OVRCD,GRPSEC20
.
          MATCH     WBSEC001,WBSGUSID       * User ID the same
          GOTO      GRPSEC20 IF NOT EQUAL
.
          PACK      KEY20,WBSGUSID,WBSGGRPC,SP70
          CALL      DEWBSGP1
          GOTO      GRPSEC10
.
GRPSEC20  PACK      KEY20,WBSEC001,SP70   * All security group record
          CALL      RDWBSGP1
          BRANCH    OVRCD,GRPSEC30
.
          GOTO      GRPSEC99
.
GRPSEC30  MOVE      WBSEC001,WBSGUSID     * Set User ID
          PACK      WBSGGRPC,SP70         * Blank means all security groups
          MOVE      SP70,WBSGSPAR         * Access
.
          PACK      KEY20,WBSGUSID,WBSGGRPC,SP70
          CALL      WRWBSGP1              * Writes away the data
.
GRPSEC99  RETURN
.
.------------------------------------------------------------
. Table of users security group codes
.------------------------------------------------------------
UGRP0000  CALL      UGHD0000      * Output Table Heading
.
          PACK      KEY60,SP70
          CALL      RSWBGRP2
UGRP1000  CALL      RKWBGRP2
          BRANCH    OVRCD,UGRP9999
.
          MATCH     "1",WBGRACTV            * Inctive
          GOTO      UGRP1000 IF EQUAL
.
          WRITE     HTMLFILE;"<tr><td>",WBGRDESC,"</td>":
                             "<td>",WBGRSURL,"</td>":
                             "<td align=center>":
                             "<input type=checkbox name=grouparr";
.
          PACK      WBSEC001,WBSEC001,SP70
          PACK      KEY20,WBSEC001,WBGRGRPC,SP70
          CALL      RDWBSGP1
          IF        OVRCD=0
            WRITE     HTMLFILE;" checked ";
          ENDIF
.
          WRITE     HTMLFILE;" value='",WBGRGRPC,"'>":
                             "</td></tr>"
.
          GOTO      UGRP1000
.
UGRP9999  RETURN
.
.------------------------------------------------------------
. User security groups list (TABLE HEADING)
.------------------------------------------------------------
UGHD0000  WRITE     HTMLFILE;"<tr>":
                             "<td class=HeadingCell>Group</td>":
                             "<td class=HeadingCell>URL</td>":
                             "<td class=HeadingCell align=center width=10%>":
                             "Link</td>":
                             "</tr>"
.
UGHD9999  RETURN
.
.------------------------------------------------------------
. Update group security access details for WBSEC001
.------------------------------------------------------------
LGRP0000  PACK      WBSEC001,WBSEC001,SP70
.
          PACK      KEY20,WBSEC001,SP70
          CALL      RDWBSGP1
          BRANCH    OVRCD,LGRP0500
          CALL      DEWBSGP1
.
LGRP0500  PACK      KEY20,WBSEC001,SP70
          CALL      RSWBSGP1
LGRP1000  CALL      RKWBSGP1                * Delete all linked codes
          BRANCH    OVRCD,LGRP3000
.
          MATCH     WBSEC001,WBSGUSID
          GOTO      LGRP3000 IF NOT EQUAL
.
          PACK      KEY20,WBSGUSID,WBSGGRPC,SP70
          CALL      DEWBSGP1
.
          GOTO      LGRP1000
.
LGRP3000  MOVE      ZERO,ARRCNT
.
LGRP3100  ADD       ONE,ARRCNT                   * Write hospital links
          IF        ARRCNT>GROUPCNT
            GOTO      LGRP8000
          ENDIF
.
          MATCH     SP70,GROUPARR[ARRCNT]
          GOTO      LGRP3100 IF EQUAL
.
          PACK      WBSGUSID,WBSEC001,SP70
          PACK      WBSGGRPC,GROUPARR[ARRCNT],SP70
          MOVE      SP70,WBSGSPAR
.
          PACK      KEY20,WBSGUSID,WBSGGRPC,SP70
          CALL      RAWBSGP1
          IF        OVRCD=1
            CALL     WRWBSGP1
          ENDIF
.
          GOTO      LGRP3100
.
LGRP8000  MOVE      ZERO,EXIT
          GOTO      LGRP9999
.
LGRP9999  RETURN
.
.------------------------------------------------------------
.  Delete group security access for WBSEC001
.------------------------------------------------------------
DLGRP000  PACK      KEY20,WBSEC001,SP70
          CALL      RDWBSGP1
          BRANCH    OVRCD,DLGRP050
.
          CALL      DEWBSGP1
.
DLGRP050  PACK      KEY20,WBSEC001,SP70
          CALL      RSWBSGP1
DLGRP100  CALL      RKWBSGP1
          BRANCH    OVRCD,DLGRP999
.
          MATCH     WBSEC001,WBSGUSID
          GOTO      DLGRP999 IF NOT EQUAL
.
          PACK      KEY20,WBSGUSID,WBSGGRPC,SP70
          CALL      DEWBSGP1
          GOTO      DLGRP000
.
DLGRP999  RETURN
.
.------------------------------------------------------------
.  Copy Hospital Access from WBSEC001 to CPSEC001
.------------------------------------------------------------
CPGRP000  PACK      WBSEC001,WBSEC001,SP70
          PACK      CPSEC001,CPSEC001,SP70
          PACK      KEY20,WBSEC001,SP70
          CALL      RDWBSGP1
          BRANCH    OVRCD,CPGRP050
          GOTO      CPGRP200
.  
CPGRP050  PACK      KEY20,WBSEC001,SP70
          CALL      RSWBSGP1
CPGRP100  CALL      RKWBSGP1
          BRANCH    OVRCD,CPGRP999
          MATCH     WBSEC001,WBSGUSID
          GOTO      CPGRP999 IF NOT EQUAL
.
CPGRP200  MOVE      CPSEC001,WBSGUSID
          PACK      KEY20,WBSGUSID,WBSGGRPC,SP70
          CALL      RAWBSGP1
          BRANCH    OVRCD,CPGRP300
          GOTO      CPGRP100
.
CPGRP300  CALL      WRWBSGP1
          PACK      KEY20,WBSEC001,WBSGGRPC,SP70
          CALL      RDWBSGP1
          GOTO      CPGRP100
.
CPGRP999  RETURN
.
.------------------------------------------------------------
. Option 15: Template Security Maintenance
.------------------------------------------------------------
TEMS0000  RESET     UPDTTYPE
          MATCH     SP1,UPDTTYPE
          GOTO      TEMS4000 IF EQUAL
.
          MATCH     "A",UPDTTYPE            * Add formaction
          GOTO      TEMS1000 IF EQUAL
.
          MATCH     "U",UPDTTYPE            * Update formaction
          GOTO      TEMS2000 IF EQUAL
.
          GOTO      TEMS9000
.
TEMS1000  CALL      UPDT0000                * Update template security level
.
          MOVE      ZERO,EXIT
          GOTO      TEMS9999
.
TEMS2000  CALL      UPDL0000                * Update security id server level
.
          MOVE      ZERO,EXIT
          GOTO      TEMS9999
.
TEMS4000  CLEAR     WEBTITLE
          MOVE      "Template Security Maintenance",WEBTITLE
          RESET     WEBTITLE
.
          CALL      WEBHED00   * Create Output File and Write HTML Page Header
          BRANCH    EXIT,SERPRG99
          CALL      WEBBOD00   * Process Web Body
          CALL      WEBEND00   * Process End of HTML File
          MOVE      ONE,EXIT
          GOTO      TEMS9999
.
TEMS9000  MOVE      "Invalid Form Action.",WEBTITLE
          CALL      WEBERR00
          MOVE      ONE,EXIT
          GOTO      TEMS9999
.
TEMS9999  RETURN
.
.------------------------------------------------------------
. ERRW0000 - Web Server Errors
.------------------------------------------------------------
TTAG0000  BRANCH    FLDITMNO,TTAG0100,TTAG0200,TTAG0300,TTAG0400,TTAG0500:
                             TTAG0600,TTAG0700,TTAG0800,TTAG0900,TTAG1000:
                             TTAG1100,TTAG1200,TTAG1300,TTAG1400,TTAG1500:
                             TTAG1600
.
          WRITE     HTMLFILE;"Invalid Tag";
          GOTO      TTAG9999
.
TTAG0100  CALL      SSEL0000                * Server ID selection list
          GOTO      TTAG9999
.
TTAG0200  CALL      RSEL0000                * Report selection list
          GOTO      TTAG9999
.
TTAG0300  CALL      TSEL0000                * Template selection List
          GOTO      TTAG9999
.
TTAG0400  CALL      TTAB0000                * List templates
          GOTO      TTAG9999
.
TTAG0500  WRITE     HTMLFILE;SECLEVEL;
          GOTO      TTAG9999
.
TTAG0600  CALL      STAB0000                * User id server security
          GOTO      TTAG9999
.
TTAG0700  WRITE     HTMLFILE;FILTACTV;      * Active/Inactive filter
          GOTO      TTAG9999
.
TTAG0800  CALL      HFIL0000                * Hospital filter
          GOTO      TTAG9999
.
TTAG0900  UNPACK    DIM127,D1,KEY1,DIM127
          MOVE      ZERO,F1
          MOVE      KEY1,F1
          BRANCH    F1,TTAG0910
.
          PACK      KEY10,FILTUSID,SP70
          CALL      RDWBSE1
          BRANCH    OVRCD,TTAG9999
.
          WRITE     HTMLFILE;WBSENAM;
          GOTO      TTAG9999
.
TTAG0910  WRITE     HTMLFILE;FILTUSID;      * User id filter
          GOTO      TTAG9999
.
TTAG1000  MOVE      FILTOCCG,CODE           * Occupational group filter
          MOVE      "w0",CATEGORY
          CALL      CODITM00
          GOTO      TTAG9999
.
TTAG1100  MOVE      FILTCLOC,CODE           * Clinic location type
          MOVE      "CT",CATEGORY
          CALL      CODITM00
          GOTO      TTAG9999
.
TTAG1200  WRITE     HTMLFILE;FILTCLID;      * Clinic ID
          GOTO      TTAG9999
.
TTAG1300  CALL      WRDS0000                * Ward filter
          GOTO      TTAG9999
.
TTAG1400  CALL      ESSL0000                * Emergency site code filter
          GOTO      TTAG9999
.
TTAG1500  CALL      OSEL0000                * OP Site   
          GOTO      TTAG9999
.
TTAG1600  WRITE     HTMLFILE;KEYWORDS;      * Keywords  
          GOTO      TTAG9999
.
TTAG9999  RETURN
.
.------------------------------------------------------------
. Server ID Selection List
.------------------------------------------------------------
SSEL0000  PACK      KEY8,SP70  
          CALL      RSWBSP1
SSEL1000  CALL      RKWBSP1
          BRANCH    OVRCD,SSEL9999
.
          PACK      KEY10,QUOTE,WBSPPRG,QUOTE
.
          MATCH     FILTSERV,WBSPPRG
          IF        @EQUAL
            WRITE     HTMLFILE;"<option value=",KEY10," selected>",WBSPNAM:
                               " (",WBSPPRG,")</option>"
          ELSE
            WRITE     HTMLFILE;"<option value=",KEY10,">",WBSPNAM:
                               " (",WBSPPRG,")</option>"
          ENDIF
          GOTO      SSEL1000
.
SSEL9999  RETURN
.
.------------------------------------------------------------
. Server Report Selection List
.------------------------------------------------------------
RSEL0000  PACK      KEY10,FILTSERV,SP70
          CALL      RSWBSO1
RSEL1000  CALL      RKWBSO1
          BRANCH    OVRCD,RSEL9999
.
          MATCH     FILTSERV,WBSOPRG
          GOTO      RSEL9999 IF NOT EQUAL
.
          PACK      KEY4,QUOTE,WBSOOPT,QUOTE
.
          MATCH     FILTREPT,WBSOOPT
          IF        @EQUAL
            WRITE     HTMLFILE;"<option value=",KEY4," selected>",WBSOOPT:
                               " (",WBSODES,")</option>"
          ELSE
            WRITE     HTMLFILE;"<option value=",KEY4,">",WBSOOPT:
                               " (",WBSODES,")</option>"
          ENDIF
          GOTO      RSEL1000
.
RSEL9999  RETURN
.
.------------------------------------------------------------
. Template Selection List
.------------------------------------------------------------
TSEL0000  PACK      KEY13,FILTSERV,FILTREPT,SP70
          CALL      RSWBTP1
TSEL1000  CALL      RKWBTP1
          BRANCH    OVRCD,TSEL9999
.
          MATCH     FILTSERV,WBTPPRG
          GOTO      TSEL9999 IF NOT EQUAL
.
          MATCH     FILTREPT,WBTPOPT
          GOTO      TSEL9999 IF NOT EQUAL
.
          PACK      KEY5,QUOTE,WBTPTPL,QUOTE
.
          MATCH     FILTTEMP,WBTPTPL
          IF        @EQUAL
            WRITE     HTMLFILE;"<option value=",KEY5," selected>",WBTPTPL:
                               " (",WBTPDES,")</option>"
          ELSE
            WRITE     HTMLFILE;"<option value=",KEY5,">",WBTPTPL:
                               " (",WBTPDES,")</option>"
          ENDIF
          GOTO      TSEL1000
.
TSEL9999  RETURN
.
.------------------------------------------------------------
. Template Security  List
.------------------------------------------------------------
TTAB0000  CALL      THED0000                * Output Table Heading
.
          PACK      KEY13,FILTSERV,FILTREPT,FILTTEMP,SP70
          CALL      RDWBTP1
          IF        OVRCD<>1
            GOTO      TTAB2000
          ENDIF
TTAB1000  CALL      RKWBTP1
          BRANCH    OVRCD,TTAB9999
.
          MATCH     FILTSERV,WBTPPRG        * Check Program ID
          GOTO      TTAB9999 IF NOT EQUAL
.
          MATCH     SP70,FILTREPT
          IF        !@EQUAL
            MATCH     FILTREPT,WBTPOPT        * Check Server Option
            GOTO      TTAB9999 IF NOT EQUAL
          ENDIF
.
          MATCH     SP70,FILTTEMP
          IF        !@EQUAL
            MATCH     FILTTEMP,WBTPTPL      * Check template
            GOTO      TTAB9999 IF NOT EQUAL
          ENDIF
.
TTAB2000  CALL      TROW0000                * Template Security Table Row
.
          MATCH     SP70,FILTTEMP           * Displaying all tenmplates
          GOTO      TTAB1000 IF EQUAL
.
TTAB9999  RETURN
.------------------------------------------------------------
. Template Security (TABLE HEADING)
.------------------------------------------------------------
THED0000  WRITE     HTMLFILE;"<tr>":
                             "<td class=HeadingCell>Report Option</td>":
                             "<td class=HeadingCell>Template No</td>":
                             "<td class=HeadingCell>Template Description</td>":
                             "<td class=HeadingCell>File Name</td>":
                             "<td class=HeadingCell>Security Level</td>":
                             "<td class=HeadingCell>Mark All":
                             "<input type=checkbox name=selectall":
                             " onclick='SelectAll15(this);'>":
                             "</td></tr>"
.
THED9999  RETURN
.------------------------------------------------------------
. Template Security (TABLE ROW)
.------------------------------------------------------------
TROW0000  MATCH     SP70,WBTPLEV
          IF        @EQUAL
            MOVE      "&nbsp;",KEY6
          ELSE
            MOVE      WBTPLEV,KEY6
          ENDIF
.
          PACK      KEY13,WBTPPRG,WBTPOPT,WBTPTPL,SP70
.
          WRITE     HTMLFILE;"<tr>":
                             "<td align=center width=10%>",WBTPOPT,"</td>":
                             "<td  align=center width=10%>",WBTPTPL,"</td>":
                             "<td>",WBTPDES,"</td><td>",WBTPFIL,"</td>":
                             "<td>",KEY6,"</td>":
                             "<td><input type=checkbox name=markedky":
                             " value='",KEY13,"'>":
                             "</td></tr>"
.
TROW9999 RETURN
.
.------------------------------------------------------------
. Set slot template key Array   
.------------------------------------------------------------
STMPKY00  COMPARE   "250",MARKINDX
          GOTO      STMPKY99 IF EQUAL
.
          ADD       ONE,MARKINDX
          PACK      MARKEDKY[MARKINDX],QRYDATA,SP70
          GOTO      STMPKY99
.
STMPKY99 RETURN
.
.*******************************************************************************
. Update the selected templates security levels            
.*******************************************************************************
UPDT0000  MOVE      ZERO,ARRCOUNT      * Loop through each template to update 
.
UPDT1000  COMPARE   "250",ARRCOUNT
          GOTO      UPDT9999 IF EQUAL
.
          ADD       ONE,ARRCOUNT
          IF        ARRCOUNT>MARKINDX
            GOTO      UPDT9999
          ENDIF
.
          PACK      KEY13,MARKEDKY[ARRCOUNT]
          CALL      RDWBTP1
          BRANCH    OVRCD,UPDT1000
.
          MOVE      SECLEVEL,WBTPLEV        * Update security level
.
          CALL      UPWBTP1
.
          GOTO      UPDT1000
.
UPDT9999  RETURN
.
.------------------------------------------------------------
. Security ID Server Security List
.------------------------------------------------------------
STAB0000  CALL      SHED0000                     * Output Table Heading
.         
          MATCH     SP70,FILTSERV                * Server filter
          GOTO      STAB9999 IF EQUAL
.
          MATCH     SP70,KEYWORDS                * Keywords
          IF        !@EQUAL & !@EOS
            CALL      GETWRD00       * This routine Splits the KEYWORDS field
.                                    * into KEYWRD01 to KEYWRD10
          ENDIF
.
          PACK      KEY10,SP70
          CALL      RSWBSE1
STAB1000  CALL      RKWBSE1
          BRANCH    OVRCD,STAB9999
.
          MATCH     "1",FILTACTV                 * Active
          IF        @EQUAL
            MATCH     "1",WBSEACT
            GOTO      STAB1000 IF NOT EQUAL
          ENDIF
.
          MATCH     "0",FILTACTV                 * Inactive
          IF        @EQUAL
            MATCH     "1",WBSEACT
            GOTO      STAB1000 IF EQUAL
          ENDIF
.
          MATCH     SP70,FILTUSID                * User Id 
          IF        !@EQUAL
            MATCH     WBSEUID,FILTUSID
            GOTO      STAB1000 IF NOT EQUAL
          ENDIF
.
          MATCH     SP70,FILTOCCG                * Occupational Group
          IF        !@EQUAL
            MATCH     WBSEOCG,FILTOCCG
            GOTO      STAB1000 IF NOT EQUAL
          ENDIF
.
          MATCH     SP70,FILTCLOC                * Clinic location type
          IF        !@EQUAL
            MATCH     WBSELTYP,FILTCLOC
            GOTO      STAB1000 IF NOT EQUAL
          ENDIF
.
          MATCH     SP70,FILTCLID                * Clinic ID
          IF        !@EQUAL
            MATCH     WBSECLI,FILTCLID
            GOTO      STAB1000 IF NOT EQUAL
          ENDIF
.
          MATCH     SP70,FILTWARD                * Ward
          IF        !@EQUAL
            MATCH     WBSEWRD,FILTWARD
            GOTO      STAB1000 IF NOT EQUAL
          ENDIF
.
          MATCH     SP70,FILTOSIT                * OP Site 
          IF        !@EQUAL
            MATCH     WBSESIT,FILTOSIT
            GOTO      STAB1000 IF NOT EQUAL
          ENDIF
.
          MATCH     SP70,FILTESIT                * EMR Site 
          IF        !@EQUAL
            MATCH     WBSEESC,FILTESIT
            GOTO      STAB1000 IF NOT EQUAL
          ENDIF
.
          MATCH     SP70,KEYWORDS                * Keywords
          IF        !@EQUAL & !@EOS
            CALL      STABKC00
            BRANCH    EXIT,STAB1000
          ENDIF
.
          COMPARE   "1",IBCNMHOS                      * Multi Hospital
          GOTO      STAB5000 IF NOT EQUAL
.
          MATCH     SP70,FILTHOSP                     * All
          GOTO      STAB5000 IF EQUAL
.
          MATCH     Z70,FILTHOSP
          IF        @EQUAL
            PACK      KEY13,WBSEUID,SP70              * All Hospital Access
            CALL      RDMLSEC1
            BRANCH    OVRCD,STAB1000
          ELSE
            PACK      KEY13,WBSEUID,FILTHOSP,SP70     * Access to Hospital
            CALL      RDMLSEC1
            BRANCH    OVRCD,STAB1000

          ENDIF
.
STAB5000  CALL      SROW0000      * Display Security ID Row
          GOTO      STAB1000
.
STAB9999  RETURN
.------------------------------------------------------------
. Security ID Server Security (TABLE HEADING)
.------------------------------------------------------------
SHED0000  WRITE     HTMLFILE;"<tr>":
                             "<td class=HeadingCell>Security ID</td>":
                             "<td class=HeadingCell>Name</td>":
                             "<td class=HeadingCell>Active</td>":
                             "<td class=HeadingCell>Login URL</td>":
                             "<td class=HeadingCell>Department (Free Format)":
                             "</td>":
                             "<td class=HeadingCell>Department</td>":
                             "<td class=HeadingCell>Security Level</td>":
                             "<td class=HeadingCell>Mark All":
                             "<input type=checkbox name=selectall":
                             " onclick='SelectAll15(this);'>":
                             "</td></tr>"
.
SHED9999  RETURN
.------------------------------------------------------------
. Template Security (TABLE ROW)
.------------------------------------------------------------
SROW0000  MOVE      WBSENAM,NAME
          MATCH     SP70,NAME
          IF        @EQUAL
            MOVE      "&nbsp;",NAME
          ENDIF
.
          MOVE      "No",KEY3
          MATCH     "1",WBSEACT
          IF        @EQUAL
            MOVE      "Yes",KEY3
          ENDIF
.
          PACK      SECMDEPT,SP70,SP70
          MATCH     SP70,WBSEDEPT
          IF        !@EQUAL
            PACK      KEY6,WBSEDEPT,SP70   * Department
            CALL      RDIBDPT1
            IF        OVRCD=1
              MOVE      WBSEDEPT,SECMDEPT
            ELSE
              MOVE      IBDPDESC,SECMDEPT
            ENDIF
          ENDIF
.
          PACK      KEY18,WBSEUID,FILTSERV,SP70
          CALL      RDWBST1
          IF        OVRCD=1
            MOVE      ZERO,WBSTLEV
          ENDIF
.
          WRITE     HTMLFILE;"<tr><td>",WBSEUID,"</td>":
                             "<td>",NAME,"</td>":
                             "<td>",KEY3,"</td>":
                             "<td>",WBSEDIR,"&nbsp;</td>":
                             "<td>",WBSEFDEP,"&nbsp;</td>":
                             "<td>",SECMDEPT,"&nbsp;</td>":
                             "<td>",WBSTLEV,"&nbsp;</td>":
                             "<td><input type=checkbox name=markedky":
                             " value='",KEY18,"'>":
                             "</td></tr>"
.
          GOTO      SROW9999
.
SROW9999 RETURN
.
.------------------------------------------------------------
. Update the selected security id's server security level
.------------------------------------------------------------
UPDL0000  MOVE      ZERO,ARRCOUNT      * Loop through each template to update
.
UPDL1000  COMPARE   "250",ARRCOUNT
          GOTO      UPDL9999 IF EQUAL
.
          ADD       ONE,ARRCOUNT
          IF        ARRCOUNT>MARKINDX
            GOTO      UPDL9999
          ENDIF
.
          PACK      KEY18,MARKEDKY[ARRCOUNT]
          CALL      RDWBST1
          BRANCH    OVRCD,UPDL2000
.
          MATCH     SP70,SECLEVEL
          IF        @EQUAL
            CALL      DEWBST1               * Delete zero security level 
            GOTO      UPDL1000              * record
          ENDIF
.
          MOVE      SECLEVEL,WBSTLEV        * Update security level
.
          CALL      UPWBST1
          GOTO      UPDL1000
.
UPDL2000  MATCH     SP70,SECLEVEL           * Don't write zero security level
          GOTO      UPDL1000 IF EQUAL
.
          UNPACK    MARKEDKY[ARRCOUNT],WBSTUID,WBSTPRG
          MOVE      SECLEVEL,WBSTLEV
          MOVE      SP70,WBSTUR1
          MOVE      SP70,WBSTUR2
          MOVE      SP70,WBSTUD1
          MOVE      SP70,WBSTUD2
          MOVE      SP70,WBSTUY1
          MOVE      SP70,WBSTUY2
          MOVE      SP70,WBSTSPA
.
          CALL      WRWBST1
          GOTO      UPDL1000
.
UPDL9999  RETURN
.
.------------------------------------------------------------
. Emergency Site Code selection list
.------------------------------------------------------------
ESSL0000  PACK      KEY3,SP70                * selection list
          CALL      RSEMSIT1
ESSL1000  CALL      RKEMSIT1
          BRANCH    OVRCD,ESSL9999
.
          PACK      KEY5,QUOTE,EMSTSCOD,QUOTE
.
          MATCH     EMSTSCOD,FILTESIT
          IF        @EQUAL
            WRITE     HTMLFILE;"<option value=",KEY5," selected>":
                               EMSTDESC,"</option>"
          ELSE
            WRITE     HTMLFILE;"<option value=",KEY5,">",EMSTDESC,"</option>"
          ENDIF
          GOTO      ESSL1000
.
ESSL9999  RETURN
.
.------------------------------------------------------------
. Ward Selection List
.------------------------------------------------------------
WRDS0000  PACK      KEY29,SP70
          CALL      RDSWARD7
WRDS1000  CALL      RDKWARD7
          BRANCH    OVRCD,WRDS9999
.
          MATCH     SP70,WBED
          GOTO      WRDS9999 IF NOT EQUAL
.
          COMPARE   WACTIVE,ZERO                 *List only active wards
          GOTO      WRDS1000 IF NOT EQUAL
.
          MOVE      WBDESC,KEY20
          PACK      KEY5,QUOTE,WWARD,QUOTE
.
.                       write the select option.
          WRITE     HTMLFILE;"<option value=#"",WWARD,"#"";
          MATCH     FILTWARD,WWARD
          IF        @EQUAL
            WRITE     HTMLFILE;" selected";
          ENDIF
          WRITE     HTMLFILE;">",WBDESC;
.
          IF        IBCNMHOS = 1
            WRITE     HTMLFILE;" - ",PTWDHOSN;
          ENDIF
.
          WRITE     HTMLFILE;"</option>"
          GOTO      WRDS1000
.
WRDS9999  RETURN
.
.------------------------------------------------------------
. OP Site Selection List
.------------------------------------------------------------
OSEL0000  PACK      KEY6,SP70                 * selection list
          CALL      RDSSITA1
OSEL1000  CALL      RDKSITA1
          BRANCH    OVRCD,OSEL9999
.
          PACK      KEY10,QUOTE,OSTSITE,QUOTE
          MATCH     FILTOSIT,OSTSITE
          IF        @EQUAL
            WRITE     HTMLFILE;"<option value=",KEY10," selected>":
                               OSTDESC,"</option>"
          ELSE
            WRITE     HTMLFILE;"<option value=",KEY10,">",OSTDESC,"</option>"
          ENDIF
.
          GOTO      OSEL1000
.
OSEL9999  RETURN
.
.------------------------------------------------------------
. Check for Matching Words
.------------------------------------------------------------
STABKC00  MOVE      ZERO,F2
          MOVE      ZERO,EXIT
          PACK      SAVKEY10,WBSEUID,SP70
.
STABKC10  COMPARE   KEYWRDNO,F2           * Loop through each Key Word in Search
          GOTO      STABKC99 IF EQUAL     * Exit OK
.
          ADD       ONE,F2
          LOAD      KEYWRDXX,F2,KEYWRD01,KEYWRD02,KEYWRD03,KEYWRD04,KEYWRD05:
                             KEYWRD06,KEYWRD07,KEYWRD08,KEYWRD09,KEYWRD10
          PACK      KEY90,WBSEUID,KEYWRDXX,SP70
          CALL      RDWBSKI1              * Check for Exact Match
          COMPARE   ZERO,OVRCD            * Ok so Continue Loop
          GOTO      STABKC10 IF EQUAL
.
          CALL      RKWBSKI1              * Not Exact so Read Next Record
          BRANCH    OVRCD,STABKC90        * No Match So Exit No Match
.
          PACK      KEY10,WBSKUSID,SP70
          MATCH     SAVKEY10,KEY10          * Match Key Fields
          GOTO      STABKC90 IF NOT EQUAL * No Match So Exit
.
          STRIP     KEYWRDXX
          MATCH     WBSKKWRD,KEYWRDXX       * Check Key Word
          GOTO      STABKC90 IF NOT EQUAL * No Match So Exit
          GOTO      STABKC10              * Check Next Search Word
.
STABKC90  MOVE      ONE,EXIT
.
STABKC99  RETURN
+
.------------------------------------------------------------
. Alert Security Levels for User
.------------------------------------------------------------
ASLT0000  UNPACK    DIM127,D1,KEY2,DIM127
          MOVE      ZERO,F2
          MOVE      KEY2,F2
.
          MOVE      ZERO,SECCOUNT
          MOVE      SP70,SECCOUND
.
          LOAD      ALERTLEV,F2,WBSEVH1L,WBSEAH1L,WBSEVH2L,WBSEAH2L:
                                WBSEVH3L,WBSEAH3L,WBSEVH4L,WBSEAH4L:
                                WBSEVH5L,WBSEAH5L,WBSEVH6L,WBSEAH6L:
                                WBSEVH7L,WBSEAH7L,WBSEVH8L,WBSEAH8L:
                                WBSEVH9L,WBSEAH9L
.
ASLT1000  ADD       ONE,SECCOUNT
          MOVE      SECCOUNT,SECCOUND
          MATCH     SECCOUND,ALERTLEV
          IF        @EQUAL
            WRITE     HTMLFILE;"<option value=#"",SECCOUNT,"#" selected>":
                               SECCOUNT,"</option>"
          ELSE
            WRITE     HTMLFILE;"<option value=#"",SECCOUNT,"#">",SECCOUNT:
                               "</option>"
          ENDIF
          COMPARE   NINE,SECCOUNT
          GOTO      ASLT1000 IF NOT EQUAL
          GOTO      ASLT9999
.
ASLT9999  RETURN
.
.------------------------------------------------------------
.         ALERTS00  Update Alert Level Security for a user id 
.------------------------------------------------------------
ALERTS00  PACK      KEY10,WBSEC001,SP70
          CALL      RDWBSE1
          BRANCH    OVRCD,ALERTS90
.         
ALERTS50  CALL      MVASEC00                * move alert security cgis
.
          CALL      IBACLOCK
          MOVE      USERID,WBSEUUID
          PACK      WBSEUDAT,CC,YY,MM,DD
          REP       " 0",WBSEUDAT
          MOVE      CTIMEIS,WBSEUTIM
.         
          CALL      UPWBSE1
.         
          GOTO      ALERTS99
.
ALERTS90  MOVE      "Security ID not on file",WEBTITLE
          CALL      WEBERR00
          MOVE      ONE,EXIT
          GOTO      ALERTS99
.
ALERTS99  RETURN
.
.------------------------------------------------------------
.         MVASEC00  move alert security cgis
.------------------------------------------------------------
MVASEC00  MATCH     Z70,WBSEC039
          IF        !@EQUAL
            MOVE      WBSEC039,WBSEVH1L
          ENDIF
.
          MATCH     Z70,WBSEC040
          IF        !@EQUAL
            MOVE      WBSEC040,WBSEAH1L
          ENDIF
.
          MATCH     Z70,WBSEC041
          IF        !@EQUAL
            MOVE      WBSEC041,WBSEVH2L
          ENDIF
.
          MATCH     Z70,WBSEC042
          IF        !@EQUAL
            MOVE      WBSEC042,WBSEAH2L
          ENDIF
.
          MATCH     Z70,WBSEC043
          IF        !@EQUAL
            MOVE      WBSEC043,WBSEVH3L
          ENDIF
.
          MATCH     Z70,WBSEC044
          IF        !@EQUAL
            MOVE      WBSEC044,WBSEAH3L
          ENDIF
.
          MATCH     Z70,WBSEC045
          IF        !@EQUAL
            MOVE      WBSEC045,WBSEVH4L
          ENDIF
.
          MATCH     Z70,WBSEC046
          IF        !@EQUAL
            MOVE      WBSEC046,WBSEAH4L
          ENDIF
.
          MATCH     Z70,WBSEC047
          IF        !@EQUAL
            MOVE      WBSEC047,WBSEVH5L
          ENDIF
.
          MATCH     Z70,WBSEC048
          IF        !@EQUAL
            MOVE      WBSEC048,WBSEAH5L
          ENDIF
.
          MATCH     Z70,WBSEC049
          IF        !@EQUAL
            MOVE      WBSEC049,WBSEVH6L
          ENDIF
.
          MATCH     Z70,WBSEC050
          IF        !@EQUAL
            MOVE      WBSEC050,WBSEAH6L
          ENDIF
.
          MATCH     Z70,WBSEC051
          IF        !@EQUAL
            MOVE      WBSEC051,WBSEVH7L
          ENDIF
.
          MATCH     Z70,WBSEC052
          IF        !@EQUAL
            MOVE      WBSEC052,WBSEAH7L
          ENDIF
.
          MATCH     Z70,WBSEC053
          IF        !@EQUAL
            MOVE      WBSEC053,WBSEVH8L
          ENDIF
.
          MATCH     Z70,WBSEC054
          IF        !@EQUAL
            MOVE      WBSEC054,WBSEAH8L
          ENDIF
.
          MATCH     Z70,WBSEC055
          IF        !@EQUAL
            MOVE      WBSEC055,WBSEVH9L
          ENDIF
.
          MATCH     Z70,WBSEC056
          IF        !@EQUAL
            MOVE      WBSEC056,WBSEAH9L
          ENDIF
.
MVASEC99  RETURN
.
.------------------------------------------------------------
.
          INC       IBAWEBCD
          INC       CLWEBSEC
          INC       NAMSTRCD
          INC       PATDOCTM
          INC       PATDOCCD
          INC       WEBSKIPR
.
          INC       APSMASIO/INC
          INC       EMRLOCIO/INC
          INC       EMRSITIO/INC
          INC       IBADPTIO/INC
          INC       PATDRGIO/INC
          INC       MRTLOCIO/INC
          INC       OUTSITIO/INC
          INC       OUTCLIIO/INC
          INC       PATDO1IO/INC
          INC       PATHSPIO/INC
          INC       PMSHCPIO/INC
          INC       PMSHCGIO/INC
          INC       PATIN1IO/INC
          INC       PATWR1IO/INC
          INC       OPRNURIO/INC
.
          INC       WEBGRPIO/INC     * Web Security Groups
          INC       WEBHSPIO/INC     * WEB Hospital Login Details
          INC       WEBSGPIO/INC     * User Security Groups
          INC       WEBSKIIO/INC     * User keywords
          INC       WEBSPGIO/INC     * Web Server Program Details
          INC       WEBSOPIO/INC     * Web Server Options
          INC       WEBRTMIO/INC     * Report Template Master IO
          INC       WEBRGMIO/INC     * Report Groups Master IO
          INC       WEBRDTIO/INC     * Report Group Details IO
          INC       WEBRURIO/INC     * Web User Report Groups IO
          INC       WEBPASIO/INC     * Password History
          INC       MLTSECIO/INC     * Hospital Security
          INC       MLTSITIO/INC     * O/P Site Security
          INC       IBACUSIO/INC     * Category Security User IDs
.
          INC       PRIALSIO/INC     * Private Practice All User Access
          INC       PRISECIO/INC     * Private Practice User Access
.
          INC       PATCOMN3
          INC       WEBDATCD
          INC       DAYOFWEK
          INC       PMSHCPTM
          INC       PMSHCGTM
.
