.******************************************************************************
.*                                                                            *
.*                        P R O G R A M   S U M M A R Y                       *
.*                        -------------   -------------                       *
.*                                                                            *
.*      PROGRAM NAME:   IBARSH11                                              *
.*                                                                            *
.*      FUNCTION:       BULK PATIENT INVOICES FOR WEB ONLY.                   *
.*                                                                            *
.*                      This is a schedule program for Bulk Invoice Selection *
.*                      and printing for Web. It is used in conjunction with  *
.*                      PATWEB79.PBL.  It uses selection criterias in         *
.*                      patbliaf to write bulk invoices to patbiiaf & print.  *
.*                                                                            *
.*                      Based on IBABIL20.PBL                                 *
.*                                                                            *
.*                                                                            *
.*      MODIFICATIONS:                                                        *
.*----------------------------------------------------------------------------*
.*        V12.00.07 10/10/2025  J.Tan          TSK 0946593                    *
.*                  Recompiled for PATCATBI-Sort Casepayment Theatre fee items*
.*        V12.00.06 30/09/2025  Thanh T        TSK 0937505                    *
.*                  Recompiled for PATINVHL changes                           *
.*        V12.00.05 17/07/2025  J.Tan          TSK 0961277                    *
.*                  Recompiled for PATCATBI-Chk if Accom.included in Pat.inv. *
.*                  22/07/2025  J.Tan          TSK 0963587                    *
.*                  Recompiled for PINCATBI-Chk if pat.is disch.& invoiced    *
.*        V12.00.04 25/06/2025  J.Tan          TSK 0961589                    *
.*                  Recompiled for PATCATBI-Fixed inv.rebate with zero MV hour*
.*                  01/07/2025  J.Tan          TSK 0960457                    *
.*                  Recompiled for PATCATBI-print inv.on first date of Findate*
.*        V12.00.03 23/06/2025  J.Tan           TSK 0961623                   *
.*                  Recompiled for PATINVS - added DDRGCODE for GETDRG        *
.*        V12.00.02 20/05/2025  Ebon Clements  TSK 0955096                    *
.*                  Set AADMNO to ZEROVISN - SDLLS000                         *
.*        V12.00.01 20/05/2025  Ebon Clements  TSK 0955096                    *
.*                  Alphanueric visit number changes                          *
.*        V11.05.01 14/02/2025 J.Tan           TSK 0946490                    *
.*                  Recompiled for PATCATBI - Changes for MV CWO Payment Model*
.*        V11.04.02 07/11/2024 Thanh T           TSK 0946085                  *
.*                  Recompiled for RCPCONFD changes                           *
.*        V11.04.10 25/10/2024 J.Tan             TSK 0951578                  *
.*                  Recompiled for ABFPTINV-Added Min.to roundup ICU Hrs(ABF) *
.*        V11.04.09 04/10/2024  J.Tan          TSK 0951441                    *
.*                  Recompiled for PATCATBI - Charging AddOn for NoPayDay     *
.*        V11.04.08 23/09/2024  J.Tan          TSK 0949848                    *
.*                  Recompiled for ABFPTINV - DRG List used in for COVID Adj. *
.*        V11.04.07 20/09/2024 J.Tan           TSK 0950577                    *
.*                  Recompiled for PATIPERH - Fixed Hold Invoice audit issue  *
.*        V11.04.06 11/09/2024  J.Tan          TSK 0947315                    *
.*                  Recompiled for ABFPTINV - fixed Total Unqualified         *
.*        V11.04.05 01/08/2024  J.Tan          TSK 0947804                    *
.*                  Recompiled for ABFMHINV - Changes for Disc.after 1/7/2023 *
.*        V11.04.04 17/07/2024  J.Tan          TSK 0947315                    *
.*                  Recompiled for ABFPTINV (LOS ICU adjusted & Newborn)      *
.*        V11.04.03 15/03/2024  J.Tan          TSK 0910994                    *
.*                  Recompiled for CMXMATRX                                   *
.*        V11.04.02 29/01/2024  Jacob Jackson  TSK 0919335                    *
.*                  Add HF History includes                                   *
.*        V11.04.01 29/01/2024  Jacob Jackson  TSK 0919335                    *
.*                  Add new local variable and recompile for GETTFEES         *
.*        V11.03.07 17/11/2023  J.Tan          TSK 0940089                    *
.*                  Recompiled for ABFPTINV - checking for blank Disc.DRG     *
.*        V11.03.06 13/11/2023  J.Tan          TSK 0939019                    *
.*                  Recompiled for ABFPTINV - HAC ICD10 Edition 12            *
.*        V11.03.05 08/11/2023  Nikitha B     TSK 0927699c                    *
.*                  Read CAPPRVNO and PTCNHABN for Hospital Approval          *
.*                  and ABN number.                                           *
.*        V11.03.04 04/10/2023  Nikitha B     TSK 0927699                     *
.*                  Recomplied for PATINVHL, PATINVTL - Stationary variables  *
.*        V11.03.03 29/08/2023  J.Tan          TSK 0916870                    *
.*                  Recompiled for ABFPTINV - Claim code Multiple NEP value   *
.*        V11.03.02 15/06/2023  Bella Turco    TSK 0931756                    *
.*                  Recompiled for PRTINVBD                                   *
.*        V11.03.01 15/06/2023  J.Tan          TSK 0923703                    *
.*                  Recompiled for ABF new calculations                       *
.*        V11.02.02 10/10/2022  Peter Vela           0925622                  *
.*                  Recompiled for PATINVS - Removed old Eclipse IHC from     *
.*                  Inpatient Invoicing                                       *
.*                  10/10/2022  J.Tan            TSK 0908346                  *
.*                  Mod checking Clinical Doc.for printing inv.(CHKCLDCP)     *
.*        V11.02.01 09/02/2022  Thanh T          TSK 0905641                  *
.*                  Recompiled as OUTMA1FD changes                            *
.*        V11.01.15 08/11/2021 J.Tan           TSK 0880410                    *
.*                  Recompiled for PATRECAL/PATIPERH - added Hospital & System*
.*        V11.01.14 17/11/2021  J.Tan          TSK 0913621                    *
.*                  Recompiled for ABFPTINV - Mod for Multiple NEP Values     *
.*        V11.01.13 29/09/2021  J.Tan          TSK 0901515                    *
.*                  Recompiled for CMXMATRX - Added Primary Proc.to Matrix    *
.*        V11.01.12 14/09/2021  J.Tan          TSK 0906222                    *
.*                  Recompiled for ABFPTINV - Mod for Multiple NEP Values     *
.*        V11.01.11 14/09/2021  Davin           TSK 0911277                   *
.*                  Recompiled for PRTINVBD                                   *
.*        V11.01.10 10/09/2021  Davin           TSK 0911277                   *
.*                  Recompiled for PATINVTL - Changed field 20 length to 12.2 *
.*        V11.01.09 31/08/2021  J.Tan           TSK 0910799                   *
.*                  Recompiled for PRTINVBD - printing Referring ADF          *
.*        V11.01.08 25/08/2021  J.Tan           TSK 0903454                   *
.*                  Recompiled for PATCATBI - Claim code to LS/Daily CACCFEE=4*
.*                  24/08/2021  Davin           TSK 0897318                   *
.*                  Recompiled for PATINVTL - added field 57(Adjustment Total)*
.*        V11.01.07 03/08/2021  J.Tan           TSK 0909724                   *
.*                  Recompiled for PRTINVBD - SJOG invoice                    *
.*        V11.01.06 07/07/2021  J.Tan          TSK 0908588                    *
.*                  Recompiled for PATCATBI - Exclude Unqualified days for C/P*
.*        V11.01.05 16/06/2021  Peter Vela     TSK 0907637                    *
.*                  Recompiled for PATINVS                                    *
.*        V11.01.04 28/04/2021  Thanh T        TSK 0895165                    *
.*                  Recompiled for OPRARDFD changes                           *
.*                  01/04/2021  Peter Vela      TSK 0902857                   *
.*                  Recompiled for WEBIHCFD - Added Index 8                   *
.*                  07/04/2021  Tracey Nguyen   TSK 0901515                   *
.*                  Recompiled for PMSCMTFD - Added new fields                *
.*                  a) 1 File type for ICD procedure (PMCCIPF)                *
.*                  b) 3 new CMBS Field Type (PMCCFTS4/PMCCFT5C/PMCCFT6C)     *
.*                  c) 3 new CMBS Codes From (PMCCPC4F,PMCCSC5F,PMCCTC6F)     *
.*                  d) 3 new CMBS Codes To   (PMCCPC4T/PMCCSC5T,PMCCTC6T)     *
.*                  27/04/2021  J.Tan           TSK 0863287                   *
.*                  Mod for Patient Invoice new functionality                 *
.*        V11.01.03 23/03/2021  Peter Vela      TSK 0902857                   *
.*                  Recompiled for PATINVS - WebServices IHCW                 *
.*        V11.01.02 10/03/2021  Tracey Nguyen   TSK 0901515                   *
.*                  Recompiled for PMSCMTFD - Added Primary ICD Procedure 1-5 *
.*                  (PMCCICP1-5)                                              *
.*        V11.01.01 22/02/2021  Tracey Nguyen  TSK 0888639                    *
.*                  Recompiled for PATMMBFD changes                           *
.*                  22/02/2021  Peter Vela      TSK 0902857                   *
.*                  Recompiled for PATINVS - WebServices IHCW                 *
.*----------------------------------------------------------------------------*
.*        V11.00.13 19/01/2021  J.Tan          TSK 0883075                    *
.*                  Recompiled for PRTINVBD - mod to print ADF addr.on invoice*
.*        V11.00.12 10/11/2020  J.Tan           TSK 0899562                   *
.*                  Recompiled for CMXMATRX - setup date for reading MBS item *
.*        V11.00.11 14/10/2020  J.Tan          TSK 0894879                    *
.*                  Recompiled for PRTINVBD - Print 30 item desc.for RCH Inv. *
.*        V11.00.10 29/09/2020  J.Tan          TSK 0896829                    *
.*                  Recompiled for CMXMATRX - use National(PTPGNDRG)DRG       *
.*        V11.00.09 22/09/2020  J.Tan           TSK 0895330                   *
.*                  Recompiled for CMXMATRX - reposition read of Matrix table *
.*        V11.00.08 20/07/2020  J.Tan           TSK 0892319                   *
.*                  Recompiled for ABFPTINV - Additional NEP and Psych.Adjus. *
.*        V11.00.07 14/07/2020  J.Tan          TSK 0892902                    *
.*                  Recompiled for PATCATBI - Mod to initialise CASMXKEY      *
.*        V11.00.06 01/07/2020  J.Tan           TSK 0892765                   *
.*                  Recompiled for PATCATBI-Low outlier exc. unqualified days *
.*                  05/07/2020  J.Tan           TSK 0892746                   *
.*                  Recompiled for ABFPTINV - CALCAGE as at Admission date    *
.*        V11.00.05 29/06/2020  J.Tan           TSK 0893767                   *
.*                  Recompiled for ABFPTINV - Changed CALCFLAG to 01/01/2021  *
.*        V11.00.04 20/04/2020 J.Tan           TSK 0890733                    *
.*                  Recompiled for ABFPTINV - ABF new 2020 calculation        *
.*        V11.00.03 07/05/2020  J.Tan            TSK 0891341                  *
.*                  Recompiled for ABFOTINV - added TRAP to write pmsabfaf    *
.*        V11.00.02 08/04/2020 J.Tan           TSK 0868813                    *
.*                  Recompiled for PATINVHL                                   *
.*                  15/04/2020 Thanh T         TSK 0879163                    *
.*                  Added SEXDSP00                                            *
.*----------------------------------------------------------------------------*
.*        V11.00.01 12/03/2020  J.Tan          TSK 0838262                    *
.*                  Added Effective from and to date to MBS Item file         *
.*        V10.15.01 07/09/2019  J.Tan            TSK 0882545                  *
.*                  Mod to clear Disc.record                                  *
.*        V10.14.02 09/09/2019  J.Tan           TSK 0857392                   *
.*                  Recompiled for ABF invoice                                *
.*        V10.14.01 05/08/2019  J.Tan           TSK 0857392                   *
.*                  Recompiled for ABF Invoices                               *
.*        V10.12.03 18/07/2018  J.Tan          TSK 0859911                    *
.*                  Recompiled for PATCATBI - Fixed No Payday Add on charge   *
.*        V10.12.02 18/06/2018  Ebon Clements  TSK 0846868                    *
.*                  Recompiled for PATINVS - Eclipse exclude claim type       *
.*        V10.12.01 28/02/2018  J.Tan          TSK 0852351                    *
.*                  Recompiled for PATINVHL-fields 226 227(Program Code/Desc) *
.*        V10.11.04 07/09/2017  J.Tan         TSK 0837479                     *
.*                  Recompiled for CMXMATRX - OPCNCONS(Consumption type items)*
.*        V10.11.03 25/08/2017  Thanh T.     TSK 0821710                      *
.*                  Removed PATCMNTS                                          *
.*        V10.11.02 10/08/2017  Peter Vela    TSK 0837619                     *
.*                  Recompiled for PATINVS                                    *
.*        V10.11.01 27/07/2017  J.Tan         TSK 0842559                     *
.*                  Recompiled for PATCATBI - CHKACCM0 to check for inv.number*
.*----------------------------------------------------------------------------*
.*        V10.10.02 13/06/2017  J.Tan          TSK 0839991                    *
.*                  Recompiled for PATDBTYP (PATCMSTP)                        *
.*        V10.10.01 25/01/2017  J.Tan          TSK 0832407                    *
.*                  Recompiled for PATCATBI- multi bed trans on sameday for MV*
.*                  04/04/2017  J.Tan         TSK 0297904                     *
.*                  Recompiled for PATCMSTP - Non-Accumulative inlier ICU/CCU *
.*        V10.08.07 06/10/2016  J.Tan         TSK 0826824                     *
.*                  Recompiled for CALCMVHR - MV Hours                        *
.*        V10.08.06 26/08/2016  Don Nguyen    TSK 0312570                     *
.*                  Recompiled for CMXMATRX - Added check for PTCNDGED=1      *
.*                  Added PMSEDGFD/IO and GETEFDRG                            *
.*        V10.08.05 17/08/2016  J.Tan         TSK 0808745                     *
.*                  Recompiled for PATCATBI - for NPDAYFLG=1                  *
.*        V10.08.04 20/07/2016  J.Tan         TSK 0819914                     *
.*                  Recompiled for PATCATBI - Non ICU MV Hours                *
.*        V10.08.03 15/07/2016  J.Tan         TSK 0819914                     *
.*                  Recompiled for PATCATBI - Calculating non ICU MV hours    *
.*        V10.08.02 20/06/2016  J.Tan         TSK 0820816                     *
.*                  Recompiled for PATCATBI - Fixed No payday for Daycase     *
.*        V10.08.01 02/06/2016  J.Tan         TSK 0816651                     *
.*                  Recompiled for PATCATBI-Continuous Bill.to chk for Matrix *
.*        V10.07.03 04/03/2016  J.Tan         CAR 290448                      *
.*                  Recompiled for PATCATBI - Mods for Addon with No Pay DAy  *
.*        V10.07.02 16/02/2016  J.Tan         CAR 0310703                     *
.*                  Recompiled for PATRECAL - checking tobe invoiced amount   *
.*        V10.07.01 18/11/2015  J.Tan         CAR 303942                      *
.*                  Added new payment types                                   *
.*        V10.06.07 11/09/2015  J.Tan         CAR 317216                      *
.*                  Added SINVT000 and SINVH0000                              *
.*        V10.06.06 14/08/2015  J.Tan          CAR 320073                     *
.*                  Recompiled for PATCATAI-reprint invoice for unreleased csh*
.*        V10.06.05 07/08/2015  Davin         CAR 317002                      *
.*                  Recompiled for PRTINVBD - Print pmexname for ADF MO       *
.*        V10.06.04 14/07/2015  Peter Vela     CAR 319413                     *
.*                  Recompiled for PRBILCMN - Validate for deleted VISMDT     *
.*                  record                                                    *
.*        V10.06.03 23/06/2015  J.Tan          CAR 318039                     *
.*                  Recompiled for PRBILCMN -printing billing comments for EMR*
.*        V10.06.02 15/05/2015  Davin         CAR 310155                      *
.*                  Recompiled for PATGBCRN - added MOD10V05 for BPAY         *
.*        V10.06.01 02/04/2015  Ania P         CAR 313236                     *
.*                  Recompiled for PRTINVBD                                   *
.*        V10.05.05 10/02/2015 J.Tan           CAR 311717                     *
.*                  Recompiled for PATINVHL                                   *
.*        V10.05.04 12/01/2014  Peter Vela     CAR 310738                     *
.*                  Recompiled for PRTINVBD                                   *
.*        V10.05.03 10/12/2014 Peter Vela      CAR 309840                     *
.*                  Recompiled for PATINVS                                    *
.*        V10.05.02 28/10/2014 J.Tan           CAR 304455                     *
.*                  Recompiled for PATINVHL -fixed Doctor Name and Provider no*
.*        V10.05.01 06/10/2014  Ebon Clements  CAR 268970                     *
.*                  Change to use OUTCLIFD index 1 instead of index 2         *
.*        V10.04.05 11/06/2014 Sandra Barcham  CAR 301639                     *
.*                  Moved call to TFILENAM to INIT0000                        *
.*        V10.04.04 16/04/2014  J.Tan          CAR 261630                     *
.*                  Removed pataub patauf pataui pataum patauc audit files    *
.*        V10.04.03 15/04/2014  J.Tan          CAR 261630                     *
.*                  PATCATBI - Removed port number from temp file name        *
.*        V10.04.02 26/02/2014  J.Tan          CAR 275810                     *
.*                  Recompiled for PRTINVBD - to print Defence Force details  *
.*        V10.04.01 20/01/2014  J.Tan          CAR 273713                     *
.*                  Recompiled for PRTINVBD -Print payment types of a receipt *
.*        V10.03.12 09/12/2013  Ania P         CAR 294740                     *
.*                  Recompiled for PATINVHL                                   *
.*        V10.03.11 07/11/2013  J.Tan          CAR 283618                     *
.*                  Recompiled for PATCATBI - mods for Ind.Services Billing   *
.*        V10.03.10 02/10/2013  J.Tan          CAR 291588                     *
.*                  Recompiled for PATCATBI - fixed stepdown return from leave*
.*        V10.03.09 12/09/2013  Peter Vela     CAR 271911                     *
.*                  Recompiled for PATINVTL                                   *
.*        V10.03.08 05/08/2013  J.Tan          CAR 288060                     *
.*                  Recompiled for CMXMATRX - fixed Primary/Secondary/Tertiary*
.*        V10.03.07 20/06/2013  Davin         CAR 287161                      *
.*                  Recompiled for PATGBCRN - right justify ptcnhbpi          *
.*        V10.03.06 17/04/2013  Don Nguyen     CAR 282342                     *
.*                  Recompiled for PATINVHL, PATINVTL                         *
.*        V10.03.05 10/04/2013  J.Tan          CAR 283743                     *
.*                  Recompiled for PATCATBI -  reset PTTRESPD for New Stepdown*
.*        V10.03.04 09/04/2013  Don Nguyen     CAR 282342                     *
.*                  Recompiled for PATGBCRN, PATINVHL, PATINVTL               *
.*        V10.03.03 05/03/2013  Patrick Adair  CAR 281898                     *
.*                  Recompiled for PATCATBI PATCATAI                          *
.*        V10.03.02 04/12/2012  J.Tan          CAR 271474                     *
.*                  Recompiled for CMXMATRX - using index 5 of pmscmtaf       *
.*        V10.03.01 18/07/2012  Don Nguyen     CAR 264561                     *
.*                  Recompiled for PATGBCRN                                   *
.*        V10.02.01 04/04/2011  Jill Parkinson CAR 239574                     *
.*                  Removed open of ibaprntf                                  *
.*        V10.01.04 28/02/2011  Peter Vela    CAR 233034                      *
.*                  Recompiled for PATINVS                                    *
.*        V10.01.03 24/02/2011  Peter Vela    CAR 233034                      *
.*                  Removed PATBF2FD and PATBF2IO                             *
.*        V10.01.02 13/01/2011  Mike Laming   CAR 233084                      *
.*                  Added include CLPATINV for PATINVS & Recompiled           *
.*        V10.01.01 21/12/2010  Mike Laming   CAR 233046                      *
.*                  Recompiled for PABXBILL - Mods to Misc.Charges PATMCHFD   *
.*        V10.00.07 17/08/2010 J.Tan         CAR 227873                       *
.*                  Recompiled for CMXMATRX- getting the grouper version      *
.*        V10.00.06 11/08/2010 J.Tan         CAR 227873                       *
.*                  Recompiled for CMXMATRX-searching for next matrix rules   *
.*        V10.00.05 30/07/2010 J.Tan          CAR 227319                      *
.*                  Recompiled for PATCATBI - Mechanical ventilation          *
.*        V10.00.04 14/07/2010  J.Tan         CAR 226158                      *
.*                  Recompiled for STEPDOWN - bed fees update                 *
.*        V10.00.03 16/07/2010 J.Tan         CAR 226322                       *
.*                  Recompiled for CMXMATRX - search for next rule if Contract*
.*                  is not valid                                              *
.*        V10.00.02 12/07/2010  J.Tan         CAR 225932                      *
.*                  Recompiled for PATCATBI - set TDATE to IDATET for per-diem*
.*        V10.00.01 07/06/2010  Mike Laming   CAR 212864                      *
.*                  Recompiled for PATCATBI - mods at GCDE6500                *
.*        V9.12.08  11/03/2010  J.Tan         CAR 216044                      *
.*                  Recompiled for STEPDOWN - TAC claim to incl.Leave         *
.*        V9.12.07  16/02/2010  Peter Vela    CAR 215485                      *
.*                  Recompiled for PATCATBI - Ignore Leave if less than 1 day *
.*        V9.12.06  05/02/2010  Peter Vela    CAR 215485                      *
.*                  Recompiled for PATCATBI - Ignore Leave if less than 1 day *
.*        V9.12.05  04/12/2009  Peter Vela    CAR 202333                      *
.*                  Recompiled for PATINVHL - Changed variable 88 to          * 
.*                  surname only                                              *
.*        V9.12.04  09/10/2009  J.Tan         CAR 203934                      *
.*                  Recompiled for PATCATBI - display ICD10 Sugg.Class on Inv.*
.*        V9.12.03  15/09/2009  J.Tan         CAR 204390                      *
.*                  Mods to old bed fees                                      *
.*        V9.12.02  24/07/2009  J.Tan         CAR 201132 & 202168             *
.*                  Recompiled for CMXMATRX - checking for zero MBS amount    *
.*        V9.12.01  15/05/2009  WeeLee Koo       CAR 196722                   *
.*                  Recompiled for PATINVS                                    *
.*        V9.11.05  15/04/2009  Steve Armstrong  CAR 194544                   *
.*                  Recompiled for PATINVS                                    *
.*        V9.11.04  23/03/2009  Davin             CAR 178015                  *
.*                  Recompiled for PATINVHL - Changed BPAY CRN to use inv. no.*
.*        V9.11.03  22/12/2008  Steve Armstrong   CAR 183976                  *
.*                  Recompiled for changes to PATINVS.                        *
.*        V9.11.02  20/11/2008  Steve Armstrong   CAR 181373                  *
.*                  Recompiled for changes to PATCATBI.                       *
.*        V9.11.01  14/10/2008  Peter Vela    CAR 159227                      *
.*                  Recompiled for PATINVHL - Added Emergency Invoice         *
.*                  Arrival Date and Time                                     *
.******************************************************************************
.*        V9.09.12  20/02/2008 Peter Vela     CAR 161535                      *
.*                  Recompiled for PATCATBI                                   *
.*        V9.09.11  27/12/2007 Peter Vela     CAR 155907                      *
.*                  Recompiled for PATINVTL                                   *
.*        V9.09.10  16/11/2007 Peter Vela     CAR 110766                      *
.*                  Recompiled for PATINVHL                                   *
.*        V9.09.09  12/11/2007  Peter Vela CAR 151199                         *
.*                  Added new Emergency Cancellation status                   *
.*        V9.09.08  24/08/2007  Peter Vela CAR 146143                         *
.*                  Recompiled for PATCATBI                                   *
.*        V9.09.07  20/08/2007 J.Tan          CAR 144656                      *
.*                  Recompiled for PATCATBI - for Multiple Procedures Billing *
.*        V9.09.06  10/08/2007 Peter Vela     CAR 146143                      *
.*                  Recompiled for PATCATAI                                   *
.*        V9.09.05  25/07/2007 Peter Vela     CAR 144787                      *
.*                  Recompiled for PATCATAI                                   *
.*        V9.09.04  03/07/2007 Peter Vela     CAR 142173                      *
.*                  Recompiled for PATCATAI                                   *
.*        V9.09.03  29/06/2007 Peter Vela     CAR 142173                      *
.*                  Recompiled for PATCATAI                                   *
.*        V9.09.02  26/06/2007 Peter Vela     CAR 142173                      *
.*                  Recompiled for PATCATAI                                   *
.*        V9.09.01  14/06/2007 J.Tan          CAR 142173                      *
.*                  Recompiled for PATCATAI - Emergency events                *
.******************************************************************************
.*        V9.08.13  19/02/2007 Peter Vela     CAR 135241                      *
.*                  Recompiled for PATCATBI - St. John of God invoice layout  *
.*        V9.08.12  26/02/2007  J.Tan         CAR 120014                      *
.*                  Recompiled for NZPCATBI - NZ exploding misc.item          *
.*        V9.08.11  22/02/2007 Mike Laming   CAR 119436                       *
.*                  Add PMSOSDTM (PROC FLAGDEBT) for Outstanding Debt Alert ind.
.*        V9.08.10  02/02/2007  Ebon Clements CAR 120001                      *
.*                  Added nz private billing files                            *
.*        V9.08.09  07/02/2007  Jill Habasque CAR 121168                      *
.*                  Added call to RAPMBII1 before writing                     *
.*        V9.08.08  18/12/2006  J.Tan            CAR 126039                   *
.*                  Recompiled for GETALTID                                   *
.*        V9.08.07  13/12/2006  J.Tan             CAR 127625                  *
.*                  Mods to JH HRN                                            *
.*        V9.08.06  27/11/2006  Steve Armstrong   CAR 126039                  *
.*                  Recompiled for changes to SGCHKDIG                        *
.*        V9.08.05  17/11/2006  Peter Vela    CAR 124538                      *
.*                  Recompiled for PATCATBI                                   *
.*                  Added display of PATITMFD.PTITTCER                        *
.*                  Type of Certificate Type B Type C                         *
.*        V9.08.04  16/11/2006  Steve Armstrong   CAR 124160                  *
.*                  Recompiled for PATINVHL (Singapore HRN)                   *
.*                  Recompiled for PATINVTL (Singapore HRN)                   *
.*        V9.08.03  14/11/2006  Peter Vela    CAR 124547                      *
.*                  Added reads of PTCNDEES PTCNDDES                          *
.*        V9.08.02  16/10/2006  J.Tan         CAR 121629                      *
.*                  Recompiled for PATINVS                                    *
.*        V9.08.01  29/09/2006  Peter Vela    CAR 120319                      *
.*                  Recompiled for PATINVHL                                   *
.******************************************************************************
.*        V9.07.06  25/09/2006  Peter Vela    CAR 118940                      *
.*                  Recompiled for PATCATBI                                   *
.*        V9.07.05  20/09/2006 J.Tan         CAR 119336                       *
.*                  Added claim code to Suggested classification file         *
.*        V9.07.04  12/09/2006  Jill Habasque CAR 109852                      *
.*                  Added procedure GETALTID                                  *
.*        V9.07.03  02/08/2006  Peter Vela    CAR 113658                      *
.*                  Recompiled for PATINV21 - Fixed Date and Cash Payment     *
.*                  display                                                   *
.*        V9.07.02  25/07/2006  Peter Vela    CAR 113658                      *
.*                  Recompiled for PATCATAI - Fixed "Journal Total" display   *
.*        V9.07.01  13/07/2006  Mike Laming       CAR 111521                  *
.*                  Change all Bed Fee & Theatre Fee work areas to FORM 8.2   *
.******************************************************************************
.*        V9.06.02  16/05/2006  Peter Vela    CAR 104103                      *
.*                  Recompiled for PATCATBI - PTCNINVL=12                     *
.*        V9.06.01  24/04/2006  J.Tan         CAR 102287                      *
.*                  Recompiled for PATINVHL - Added fields for multi hosp det.*
.******************************************************************************
.*        V9.05.02  29/03/2006  Peter Vela    CAR 95780                       *
.*                  Recompiled for PATINVHL - Added emg mobile contact numbers*
.*        V9.05.01  27/03/2006  Peter Vela    CAR 61299                       *
.*                  Increased field no size from DIM3 to DIM5                 *
.******************************************************************************
.*        V9.04.13  17/11/2005  Peter Vela    CAR 84547                       *
.*                  Recompiled for PATINVXX subroutines - Removed CLOSE PATFN1A1
.*        V9.04.12  02/11/2005  Peter Vela        CAR 81394                   *
.*                  Recompiled for PATCATBI                                   *
.*        V9.04.11  04/08/2005  J.Tan        CAR 62750                        *
.*                  Mods not to use the redefined amount variables            *
.*        V9.04.10  04/08/2005  J.Tan        CAR 62750                        *
.*                  Mods not to use the redefined amount variables            *
.*                  31/08/2005  J.Tan         CAR 74153                       *
.*                  Recompiled for CMXMATRX - checking for exclusive          *
.*        V9.04.09  14/07/2005  Peter Vela    CAR 62172                       *
.*                  Recompiled for PATINVTL                                   *
.*        V9.04.08  16/06/2005  Mike Laming   CAR 61746                       *
.*                  Recompiled for CLPATDTR - add clear PTDTTIME & PTDTCRST   *
.*        V9.04.07  01/03/2005  Peter Vela    CAR 57547                       *
.*                  Recompiled for PATVADFD and PATVADIO                      *
.*        V9.04.06  17/02/2005  Mike Laming   CAR 56030
.*                  Re-compile for PATINV25 - fix screen painted tail printing
.*        V9.04.05  29/11/2004  Mike Laming   CAR 54534                       *
.*                  Re-comple for PATCMSTP - fix Addit.Charge Description     *
.*        V9.04.04  06/10/2004  J.Tan   CAR 53798                             *
.*                  Removed PATMSCDS                                          *
.*        V9.04.03  04/10/2004  Peter Vela CAR 52906                          *
.*                  Recompiled for PATCATAI                                   *
.*                  22/09/2004  Lina Vo  CAR 53660                            *
.*                  Recompile for PATINVS                                     *
.*        V9.04.02  06/09/2004  J.Tan    CAR 53073                            *
.*                  Mods to keyin hospital id for multi hospital              *
.*        V9.04.01  27/08/2004  J.Tan    CAR 52835                            *
.*                  Recompiled for PATCATBI - multi hospital                  *
.******************************************************************************
.*        V9.03.11  03/08/2004  Davin    CAR 52036                            *
.*                  Added option 5 - print by Claim Type                      *
.*        V9.03.10  22/06/2004  Lina Vo  CAR 50811                            *
.*                  Removed use of RCPDEPFD & IO - now obselete.              *
.*        V9.03.09  09/06/2004  J.Tan    CAR 50035                            *
.*                  Re-compile for PATCATBI - Mechanical ventilation          *
.*        V9.03.08  22/04/2004  Mike Laming   CAR 46224                       *
.*                  Re-compile for PATCATBI & PATINVS - Theatre DTR sequences *
.*        V9.03.07  06/04/2004  Peter Vela    CAR 48227                       *
.*                  Added VARGBCRN and PATGBCRN - BPAY Reference Number       *
.*        V9.03.06  16/03/2004  Steve Armstrong  HosClaims Phase 1 (48280)    *
.*                  Recompiled for PATINVS                                    *
.*        V9.03.05  23/02/2004  Mike Laming   CAR 47440                       *
.*                  Re-compile for PATCATBI - initialise TPATAMTP             *
.*        V9.03.04  12/02/2004  Henry Son        CAR 47385                    *
.*                  Added PTCNMBSF for checking if we allow more than         *
.*                  Six MBS Items.                                            *
.*           V9.03.03  03/02/2004  J.Tan  CAR 45047                           *
.*                     Recompiled for PATCATAI - Non-banked Cash              *
.*           V9.03.02  19/12/2003  J.Tan  CAR 44093                           *
.*                     Replaced patcashf with comdepaf file                   *
.*           V9.03.01 11/11/2003 J.Tan    CAR  44160                          *
.*                    Mods for Credit note                                    *
.*           V9.03.00 30/09/2003 Lina Vo        CAR 36520                     *
.*                    Created New.                                            *
.******************************************************************************
.
          INC       STD001FD
          INC       STDHLPDF
          INC       STDKWSDF
          INC       RSHWEBDF
          INC       CHKDIGVR/INC
          INC       PATCOMM/INC
          INC       TFILEVAR/INC                 * Generate Temp File Name
          INC       WEBERRFD/INC                 * Web Server Error Logging
.
          INC       CHKCLDCD/INC
          INC       PMSABFFD/INC
          INC       PMSPWAFD/INC
          INC       PMSTLEFD/INC
          INC       PMSBIIFD/INC          * Bulk invoice print list
          INC       PABXVARS/INC
          INC       AAEDE1FD/INC
          INC       AAEDTRFD/INC
          INC       AAECONFD/INC
          INC       BOKRC1FD/INC
          INC       COMDEPFD/INC
          INC       EMRCONFD/INC
          INC       EMRHISFD/INC
          INC       EMRVISFD/INC
          INC       IBACONFD/INC
          INC       IBAPRNFD/INC
          INC       IBAPOLFD/INC
          INC       IBAGSTFD/INC
          INC       IBAGEDFD/INC
          INC       IBATMDFD/INC
          INC       IBATMHFD/INC
          INC       IBAPDFFD/INC
          INC       MLTCFNFD/INC
          INC       NZPEXTFD/INC
          INC       NZPRDTFD/INC
          INC       NZPBFEFD/INC
          INC       NZPCFNFD/INC
          INC       NZPCMTFD/INC
          INC       NZPFIGFD/INC
          INC       NZPFINFD/INC
          INC       NZPIBRFD/INC
          INC       NZPMCHFD/INC
          INC       NZPMXCFD/INC
          INC       NZPPFEFD/INC
          INC       NZPRBRFD/INC
          INC       NZPRFNFD/INC
          INC       NZPPICFD/INC
          INC       NZPSPRFD/INC
          INC       NZPTFEFD/INC
          INC       NZPIVBFD/INC
          INC       NZPRVBFD/INC
          INC       OPRARDFD/INC
          INC       OPRDEAFD/INC
          INC       OPRSESFD/INC
          INC       PATICDFD/INC
.
          INC       OUTBB1FD/INC
          INC       OUTBOAFD/INC
          INC       OUTCLIFD/INC
          INC       OUTDTRFD/INC
          INC       OUTPREFD/INC
          INC       OUTSITFD/INC
.
          INC       PATONHFD/INC
          INC       PATELGFD/INC
          INC       PATCURFD/INC
          INC       PATCFAFD/INC
          INC       PMSCIDFD/INC
          INC       PMSCCDFD/INC
          INC       PATSGCFD/INC
          INC       PATMMBFD/INC
          INC       PATECHFD/INC
          INC       PATEDTFD/INC
          INC       PATEDSFD/INC
          INC       PATIPRFD/INC
          INC       PATJRNFD/INC
          INC       PATFX1FD/INC
          INC       PATREMFD/INC
          INC       OPRDECFD/INC
          INC       OPRSRGFD/INC
          INC       PATECDFD/INC
.
          INC       PATINMFD/INC
          INC       PATRATFD/INC
          INC       PATCRAFD/INC
          INC       PATALWFD/INC       * Allowances file
          INC       PATBFEFD/INC
          INC       PATCALAG/INC
          INC       PATCODFD/INC
          INC       PATCONFD/INC
          INC       PATDHEAD/INC
          INC       PATDINVS/INC
          INC       PATDO1FD/INC
          INC       PATDSCFD/INC
          INC       PATDRGFD/INC
          INC       PATDTRFD/INC
          INC       PATFACFD/INC
          INC       PATFEEFD/INC
          INC       PATFINFD/INC
          INC       PATFIGFD/INC
          INC       PATFN1FD/INC
          INC       PATFN2FD/INC
          INC       PATGSRFD/INC
          INC       PATGTUFD/INC
          INC       PATICUFD/INC
          INC       PATINLFD/INC
          INC       PATIN1FD/INC
          INC       PATINVFD/INC
          INC       PATIPEFD/INC
          INC       PATIRNFD/INC
          INC       NZPIRNFD/INC
          INC       PATITMFD/INC       * Item file
          INC       PATMA1FD/INC
          INC       PMSHATFD/INC
          INC       PMSHCPFD/INC
          INC       PMSEVTFD/INC
          INC       PMSPX2FD/INC
          INC       PATMCHFD/INC
          INC       PATMI1FD/INC
          INC       NHIMASFD/INC       * for PATSRCH
          INC       PATPGRFD/INC
          INC       PATPR1FD/INC
          INC       PATRCAUD/INC
          INC       PATRE1FD/INC
          INC       PATRFNFD/INC
          INC       PATRFGFD/INC
          INC       PATTFEFD/INC
          INC       PATTRDAT/INC
          INC       PATTRNFD/INC
          INC       PATVENFD/INC
          INC       PATVISFD/INC
          INC       PATWC1FD/INC
          INC       PATWMAFD/INC
          INC       PATWR1FD/INC
          INC       PATWVEFD/INC
          INC       PMSEXTFD/INC
.
          INC       PATCMXFD/INC         * casemix files
          INC       PATAFEFD/INC
          INC       PATASDFD/INC
          INC       PATCTFFD/INC
          INC       PATDGWFD/INC
          INC       PATECOFD/INC
          INC       PATFMOFD/INC
          INC       PATIBLFD/INC
          INC       PATIOVFD/INC
          INC       PATHSPFD/INC
          INC       PATHDFFD/INC
          INC       PATHLFFD/INC
          INC       PATLDFFD/INC
          INC       PATLSDFD/INC
          INC       PMSFCIFD/INC
          INC       PATCMTFD/INC
          INC       PMSCNOFD/INC
          INC       PMSSGAFD/INC
          INC       PMSMTIFD/INC
          INC       PMSMPRFD/INC
          INC       PATOVBFD/INC
          INC       PATRBLFD/INC
          INC       PATSRBFD/INC
          INC       PMSBLIFD/INC          * Bulk invoice selection
          INC       PMSSINFD/INC
          INC       PMSCMTFD/INC
          INC       PMSECTFD/INC
          INC       PMSVX1FD/INC
          INC       PMSPRGFD/INC
.
          INC       RCPCONFD/INC
          INC       RCPBNKFD/INC
          INC       RCPBDTFD/INC
          INC       RCPDTEFD/INC
          INC       RCPCRSFD/INC
          INC       VISPAYFD/INC
          INC       PMSPYRFD/INC
          INC       PMSPBRFD/INC
          INC       PMSIDEFD/INC
          INC       PMSIVBFD/INC
.
          INC       PATDNRFD/INC
          INC       PATSDNFD/INC
          INC       PATSMWFD/INC
          INC       PATNIDFD/INC
          INC       PATALRFD/INC
          INC       SCRPSTFD/INC
          INC       VARGBCRN/INC           * I-48227
          INC       WEBCONFD/INC
          INC       WEBSCHFD/INC
          INC       WEBIHCFD/INC
          INC       PMSEDGFD/INC       * Effective DRG Date
          INC       PATDDHFD/INC
.
+
.
.******************************************************************************
          INC       NZHISIFD/INC       * for NZIBSRCH
          INC       PATHTRFD/INC
.
ADMISSNO  DIM       8
AADMNOX   DIM       8
ADJULCC   FORM      2
AGEMASK1  DIM       9
AGEMASK2  DIM       9
AGEMASK3  DIM       9
AGEMASK4  DIM       9
XDESC     DIM       30
BFAMT     FORM      8.2                                               *C-111521
..BFAMT2    FORM      5.2
.
CSTRTYR   DIM       8
CDYSDAYS  FORM      6                       * CALCDAYS number of days
CDYSFDTE  DIM       8                       * CALCDAYS from date
CDYSTDTE  DIM       8                       * CALCDAYS to date
CDYSYEAR  FORM      2                       * CALCDAYS year
CDJULCC   FORM      2
CHGFLAG   FORM      1
CALDAYS   FORM      3
CERTINDC  FORM      1
CHOICE    FORM      2
CMDLINE   DIM       80
CURRDATE  DIM       8
CN        INIT      "CN"
CATCR     INIT      "cr"
CODE      DIM       2
CODEA     INIT      "A "
CODEBT    INIT      "BT"
CODECL    INIT      "CL"
CODEDP    INIT      "DP"
CODEFA    INIT      "FA"
CODEPY    INIT      "Py"
CURPAGE   FORM      2                  * used by comments maintenance
CURSESS   DIM       18
.
DDRGCODE  DIM       4
DOWNCASE  INIT      "AaBbCcDdEeFfGgHhIiJjKkLlMmNnOoPpQqRrSsTtUuVvWwXxYyZz"
DAYSDIFF  FORM      2
DIM1A     DIM       1
DIM2A     DIM       2
DIM4      DIM       4
DIM5A     DIM       5
DIM9      DIM       9
DIM12     DIM       12
DIM12A    DIM       12
DIM14     DIM       14
DIM14A    DIM       14
DIM18     DIM       18
DIM18A    DIM       18
DIM24A    DIM       24
DIM30     DIM       30
DIMC01    DIM       8
DIMC02    DIM       8
DIMC03    DIM       8
DIMC04    DIM       8
DIMC05    DIM       8
DIMC06    DIM       8
DIMC07    DIM       8
DIMC08    DIM       8
DIMC09    DIM       8
DIMC10    DIM       8
DIMC11    DIM       8
DIMC12    DIM       8
DIMC13    DIM       8
DIMC14    DIM       8
DOCTCODE  DIM       6
DNAME     DIM       20
DOCFNAME  DIM       50
.
ENDSEC    FORM      5
EFTADMIN  DIM       8
EFTATYPE  DIM       3
EFTTIME   DIM       8
EFTDATE   DIM       8
.
FADM      FORM      6
FHDUDT1   DIM       8
FHDUDT2   DIM       8
FIRST     FORM      "0"
FNAME3    DIM       8
FNAMET    DIM       8
FOUND     FORM      1
FSES      DIM       2
FORM3A    FORM      3
FORM5     FORM      5
FORM10    FORM      10
FMTGNAME  DIM       35
FMTTITLE  DIM       10
FMTSNAME  DIM       35
FRSTGNAM  DIM       40
FULLGNAM  DIM       80
.
HOSPID    DIM       3
HDUDAY1   FORM      3                  * High Dependency
HDUDAY2   FORM      3
HDUFLG    FORM      "0"
HFHIFUND  FORM      2
.
IF8DATE   DIM       8                 * Invoice From Date (CCYYMMDD)
IT8DATE   DIM       8                 * Invoice To Date (CCYYMMDD)
IF10DATE  DIM       10                * Invoice From Date (DD/MM/CCYY)
IT10DATE  DIM       10                * Invoice To Date (DD/MM/CCYY)
IWARD     DIM       3
IDTYP     DIM       20
ITEMCD    FORM      1
JYEAR     FORM      2
.
KEY13A    DIM       13
KEYFLAG   FORM      1
.
LASTREC   FORM      "0"
LINECNT   FORM      2
LNO       FORM      2
LWCHG     FORM      6.2                * Labour Ward Fee
LWCODE    INIT      "LW"
LWDT      DIM       8
.
MAXSEPDY  FORM      "35"
MENUTYPE  DIM       2
MBSLOP    FORM      2
MBSFLAG   FORM      1
MBS1      DIM       9
MBS2      DIM       9
MBS3      DIM       9
MBSDT1    DIM       8
MBSDT2    DIM       8
MBSDT3    DIM       8
MBSCH1    DIM       9
MBSCH2    DIM       9
MBSCH3    DIM       9
MBSNUM    FORM      "0"
MULTAMT   FORM      6.2
MULTNUM   FORM      2
MINFLD    FORM      2
MAXSCRN   FORM      2
MODE1     DIM       1
NMPNUMB   DIM       2                  * required by PATSRCH
.
ONAME     DIM       30
OPCNCONS  DIM       1
OPERCODE  DIM       4
OTCHG1    FORM      6.2
OTCHG2    FORM      6.2
OTCODE    INIT      "OT"
OTCNOTIH  DIM       6
OTCNOTIT  DIM       6
OTDESC1   DIM       15
OTDESC2   DIM       15
OTDT1     DIM       8                  * Other Items
OTDT2     DIM       8
OTFLG     FORM      "0"
OPNFLAG   FORM      "0"                * used in stepdown
.
PCENFLG   FORM      1
PAGECNT   FORM      3
PSTROL    FILE      ASCII, FIXED=256
PREVTRID  DIM       24
.
REGIST8   DIM       2
REPLY     FORM      1
REPORTNO  FORM      2
RACLINDC  DIM       1
.
SAVKEY12  DIM       12
SCDJULDY  FORM      4
SCDJULYR  FORM      2
SCDJULCC  FORM      2
SAVBEND   FORM      3
SAVALLW   FORM      6.2
SAVCENT   DIM       2
SAVDISC   FORM      6.2
SAVEXTRA  FORM      6.2
SCNDGNAM  DIM       40
SMCHARGE  DIM       9
SMITMTYP  FORM      1
SMMSCGRP  DIM       3
SAVFLAG   FORM      1
SAVDAT    DIM       8
SAVDAY    DIM       2
SAVITEM   DIM       4
SAVMAMT   FORM      6.2
SAVMON    DIM       2
SAVTYP    FORM      1
SAVYEAR   DIM       2
SELECTID  DIM       4
SERVDOCT  DIM       10
SDATE     DIM       8
SEC       FORM      5
SELFLG    FORM      "0"
SKEY28    DIM       28
SP12      INIT      "            "
SP14      INIT      "              "
SP22      INIT      "                      "
SP27      INIT      "                           "
SPECCODE  FORM      1
SPLING    FORM      2
SURGFLG   FORM      "0"
.
TFFSAMNT  FORM      12.2
TAMTT     FORM      6.2
TAMTP     FORM      6.2
TEMPAMT   FORM      6.2
THCFLG    FORM      2
TFEEIND   FORM      1
THDUDT1   DIM       8
THDUDT2   DIM       8
THEACHG   FORM      6.2                * Theatre Fee
THEADTE   DIM       8
THFUND    FORM      6.2
TOTBAL    FORM      6.2
.
UNIQUE    FORM      8
UNIQUEX   DIM       8
USERID    DIM       10
.
VAR       DIM       127
.
WBSEUID   DIM       10                 * WEB User ID                        
WARNINGL  DIM       20
WDATE1    DIM       8
WDATE2    DIM       8
WORK      FILE      ASCII, FIXED=256
.
XXADM     DIM       8
XXCENT    DIM       2
XXDAY     DIM       2
XXMON     DIM       2
XXMULT    FORM      2
XXNAM     DIM       22
XXYEAR    DIM       2
...XAMT      FORM      4.2
XMBS      FORM      5
...XAMTX     DIM       7
XMBSX     DIM       5
.
Z15       INIT      "zzzzzzzzzzzzzzz"
Z30       INIT      "zzzzzzzzzzzzzzzzzzzzzzzzzzzzzz"
ZERO4     INIT      "0000"
ZTWO      FORM      "00"
.
.         variable from r6.09
.
SAVADM    DIM       8
EXPCHCNT  FORM      2
.
.         Web Variables (only the include files use these variables)
.
DAYFORMT  DIM       4
NJAN      INIT      "January"
NFEB      INIT      "February"
NMAR      INIT      "March"
NAPR      INIT      "April"
NMAY      INIT      "May"
NJUN      INIT      "June"
NJUL      INIT      "July"
NAUG      INIT      "August"
NSEP      INIT      "September"
NOCT      INIT      "October"
NNOV      INIT      "November"
NDEC      INIT      "December"
.
HTMLFILE  FIFO      ASCII, FIXED=250
MTHNAM3   DIM       3
MTHNAM3A  DIM       3
.
CFPAYCOD  DIM       3        * 3M Codefinder PAY Code
.
.
.         end web variables
.
PRGID     INIT      "IBARSH11"
PRGNAM    INIT      "Print Bulk Patient Invoices"
VERSION   INIT      "V12.01.00"
+
.**************************************************************************
.*                              MAINLINE                                  *
.*                            Controlling Logic                           *
.**************************************************************************
ML0000    CALL      INIT0000               * initialization and open files
          BRANCH    EXIT,ML9999
.
ML0100    CALL      OPTN0000               * get select or print option
          BRANCH    EXIT,ML9999
.
          CALL      SELN0000               * get selection id
          BRANCH    EXIT,ML0100
.
          IF        IBCNMHOS=1
            CALL      KHOS0000             * Keyin hospital id
          ENDIF
.
ML0200    MOVE      PMBLTYPE,FORM1
          BRANCH    FORM1,ML1000,ML2000,ML3000,ML4000,ML5000
          GOTO      ML0100
.
.         All patient where last invoice was sent more than N days
.
ML1000    BRANCH    OPTION,ML1100,ML1200
          GOTO      ML0100
.
ML1100    CALL      SDAYS000              
          GOTO      ML9999
.
ML1200    CALL      PDAYS000
          GOTO      ML9999
.
.         All Discharged patients since a keyed-in Date
.
ML2000    BRANCH    OPTION,ML2100,ML2200
          GOTO      ML0100
.
ML2100    CALL      SDATE000
          GOTO      ML9999
.
ML2200    CALL      PDATE000
          GOTO      ML9999
.
.         All Discharged patients owing at least X dollars
.
ML3000    BRANCH    OPTION,ML3100,ML3200
          GOTO      ML0100
.
ML3100    CALL      SDLLS000
          GOTO      ML9999
.
ML3200    CALL      PDLLS000
          GOTO      ML9999
.
.         All Patients Discharged from a given Ward       
.
ML4000    BRANCH    OPTION,ML4100,ML4200
          GOTO      ML0100
.
ML4100    CALL      SWARD000
          GOTO      ML9999
.
ML4200    CALL      PWARD000
          GOTO      ML9999
.
.         All Patients Discharged with a given Claim Type
.
ML5000    BRANCH    OPTION,ML5100,ML5200
          GOTO      ML0100
.
ML5100    CALL      SCLTP000
          GOTO      ML9999
.
ML5200    CALL      PCLTP000
          GOTO      ML9999
.
ML9999    CHAIN     PGM                    * chain back to program
+
.*************************************************************************
.*                             INIT0000                                  *
.*                 Display screen header and open files                  *
.*************************************************************************
.
INIT0000  CALL      DISPHEAD
          CALL      IBACLOCK
          PACK      CURRDATE,CCC,CYY,CMM,CDD
          REP       " 0",CURRDATE
.
          DISPLAY   *P56:24,"Opening patcodes";
          OPEN      PATCODE1,"patcodes"
.
          DISPLAY   *P64:24,"patdo1af";
          OPEN      PATDO1A1,"patdo1af"
.
          DISPLAY   *P64:24,"patdschf";
          OPEN      PATDSCH1,"patdschf"
          OPEN      PATDSCH2,"patdschf"
.
          DISPLAY   *P64:24,"patdtraf";
          OPEN      PATDTRA1,"patdtraf"
.
.         DISPLAY   *P64:24,"patinmaf";
.         OPEN      PATINMA1,"patinmaf"
.
          DISPLAY   *P64:24,"patfinsf";
          OPEN      PATFINS1,"patfinsf"
.
          DISPLAY   *P64:24,"patfigaf";
          OPEN      PATFIGA1,"patfigaf"
.
          DISPLAY   *P64:24,"patgsrnf";
          OPEN      PATGSRN2,"patgsrnf"
          OPEN      PATGSRN3,"patgsrnf"
          OPEN      PATGSRN4,"patgsrnf"
.
          DISPLAY   *P64:24,"patgtuaf";
          OPEN      PATGTUA1,"patgtuaf"
.
          DISPLAY   *P64:24,"patirnge";
          OPEN      PATIRNG1,"patirnge"
.
          DISPLAY   *P64:24,"patma1af";
          OPEN      PATMA1A1,"patma1af"
          DISPLAY   *P64:24,"patmx1af";
          OPEN      PATMX1A1,"patmx1af"
.
          DISPLAY   *P64:24,"pmspx2af";
          OPEN      PMSPX2A1,"pmspx2af"
.
          DISPLAY   *P64:24,"patmi1af";
          OPEN      PATMI1A1,"patmi1af"
          OPEN      PATMI1A2,"patmi1af"
.
          DISPLAY   *P64:24,"patpramf";
          OPEN      PATPR1A1,"patpr1af"
          OPEN      PATPX1A1,"patpx1af"
.
          DISPLAY   *P64:24,"pattranf";
          OPEN      PATTRAN1,"pattranf"
          OPEN      PATTRAN2,"pattranf"
.
          DISPLAY   *P64:24,"patvisaf";
          OPEN      PATVISA1,"patvisaf"
          OPEN      PATVISA2,"patvisaf"
.
          DISPLAY   *P64:24,"patwr1af";
          OPEN      PATWR1A1,"patwr1af"
.
          DISPLAY   *P64:24,"pmsbliaf";
          OPEN      PMSBLIA1,"pmsbliaf"
          DISPLAY   *P64:24,"pmsbiiaf";
          OPEN      PMSBIIA1,"pmsbiiaf"
.
          DISPLAY   *P64:24,"pmsvx1af";
          OPEN      PMSVX1A1,"pmsvx1af"
.
          DISPLAY   *P64:24,"pmsmtiaf";
          OPEN      PMSMTIA1,"pmsmtiaf"
.
          DISPLAY   *P64:24,"oprardaf";
          OPEN      OPRARDA1,"oprardaf"
.
          DISPLAY   *P64:24,"nzpbfeaf";
          OPEN      NZPBFEA1,"nzpbfeaf"
.
          DISPLAY   *P64:24,"nzpcfnaf"
          OPEN      NZPCFNA1,"nzpcfnaf"
.
          DISPLAY   *P64:24,"nzpcmtaf"
          OPEN      NZPCMTA1,"nzpcmtaf"
          OPEN      NZPCMTA2,"nzpcmtaf"
          OPEN      NZPCMTA3,"nzpcmtaf"
.
          DISPLAY   *P64:24,"nzpfigaf"
          OPEN      NZPFIGA1,"nzpfigaf"
          OPEN      NZPFIGA2,"nzpfigaf"
.
          DISPLAY   *P64:24,"nzpfinaf"
          OPEN      NZPFINA1,"nzpfinaf"
          OPEN      NZPFINA2,"nzpfinaf"
.
          DISPLAY   *P64:24,"nzpibraf"
          OPEN      NZPIBRA1,"nzpibraf"
.
          DISPLAY   *P64:24,"nzpmchaf"
          OPEN      NZPMCHA1,"nzpmchaf"
          OPEN      NZPMCHA2,"nzpmchaf"
.
          DISPLAY   *P64:24,"nzppicaf"
          OPEN      NZPPICA1,"nzppicaf"
          OPEN      NZPPICA2,"nzppicaf"
.
          DISPLAY   *P64:24,"nzprbraf"
          OPEN      NZPRBRA1,"nzprbraf"
.
          DISPLAY   *P64:24,"nzprfnaf"
          OPEN      NZPRFNA1,"nzprfnaf"
          OPEN      NZPRFNA2,"nzprfnaf"
.
          DISPLAY   *P64:24,"nzppfeaf"
          OPEN      NZPPFEA1,"nzppfeaf"
.
          DISPLAY   *P64:24,"nzpspraf"
          OPEN      NZPSPRA1,"nzpspraf"
          OPEN      NZPSPRA2,"nzpspraf"
.
          DISPLAY   *P64:24,"nzptfeaf"
          OPEN      NZPTFEA1,"nzptfeaf"
          OPEN      NZPTFEA2,"nzptfeaf"
.
          DISPLAY   *P64:24,"oprdetaf"
          OPEN      OPRDETA1,"oprdetaf"
.
          DISPLAY   *P64:24,"oprdetaf"
          OPEN      OPRDETA2,"oprdetaf"
.
          DISPLAY   *P64:24,"oprsesaf"
          OPEN      OPRSESA1,"oprsesaf"
.
          OPEN      MLTCFNA1,"mltcfnaf"
          OPEN      MLTCFNA2,"mltcfnaf"
.
          DISPLAY   *P64:24,"controlf";
          OPEN      CONTROLF,"controlf"
.
          OPEN      PATFN1A1,"patfn1af"
          OPEN      PATMCHG1,"patmchgf"
.
.         Read in parameters
.
          READ      CONTROLF,ZERO;*43,IBCNMHOS:
                                  *85,IBCNUGST
          READ      CONTROLF,TEN;*32,PTCNUBRD,*66,CINVLAY,*79,CAPPRVNO:
                                 *73,DD,MM,YY,*94,CAGECOFF:
                                 *104,PTCNMBSF,*166,CMEMB:             *C-47385
                                *188,CCHKRAT,*192,CACCFEE:
                                *217,CAUDQ
          READ      CONTROLF,TEN3;CHADD1,CHADD2,CHPOST,CHPADD1,CHPADD2,CHPPOST:
                                  CHTELEB,*154,CUSEMBS,*163,BEDTYP:
                             *211,CINV1ST,*245,CHOSTYP
          READ      CONTROLF,TEN4;CNOCLMS,CINMES1,CINMES2:
                             *228,CINVFF,*245,CMAXINV
          READ      CONTROLF,TEN5;*247,CSTDOWN
          READ      CONTROLF,TEN8;*206,CFINAN
          READ      CONTROLF,TEN9;*212,CFEETYP,*216,CINVRIP
          READ      CONTROLF,TWENTY;*193,PTCNDCLM:
                                    *198,PTCNPIOP,PTCNBCUT,PTCNBDOM:
                                    *211,PTCNCNDY,*239,PTCNMXCH
          READ      CONTROLF,TWENTY1;*44,PTCNIDES:
                                    *51,PTCNINVL,*60,PTCNCCRR,PTCNCLOR:
                                    *120,PTCNADDC,*136,PTCNMITM,*138,PTCNNHII:
                                    *174,PTCNDONR,*178,PTCNMPTR:
                                    *190,PTCNPCON,*200,PTCNICRA,*235,PTCNDPL8:
                                    *237,PTCNPAOF
          READ      CONTROLF,THIRTY;*132,HSTANDM,HINVDES
          READ      CONTROLF,TWENTY;*164,PTRESDAY
          READ      CONTROLF,FIFTY9;*1,CDLSTEP,*23,CFUTINV,*25,CFUTCOM:
                                   *66,CGSTPERC,*74,CGSTITEM
          READ      CONTROLF,SEVENTY9;*248,PTCNIPEN
          READ      CONTROLF,SEVENTY7;*214,PTCNBTNM
          READ      CONTROLF,SEVENTY9;*68,PTCNMFEE,PTCNJFEE
          READ      CONTROLF,EIGHTY;*248,PTCNPEFR
          READ      CONTROLF,EIGHTY8;*233,PTCNADES
          READ      CONTROLF,NINTY8;*127,PTCNPMIS,*136,PTCNPAIH,*142,PTCNPAIT:
                                    *148,PTCNINVB
          READ      CONTROLF,HUND03;*220,PTCNDEES,*221,PTCNDDES
          READ      CONTROLF,HUND05;*130,PTCNAUAT:    * auto update adm.type
                                         PTCNWSPC:    * Warning for sub-seq item
                                    *177,PTCNTFEE:    * Using theatre fees
                                    *190,PTSGCOPT     * Using suggested class.
          READ      CONTROLF,HUND30;*1,PTCNHABN
.
.
...  used in PATCATBI CRMV0000
          CALL      TFILENAM                * Get temp file name
          MOVE      TFILNAME,FNAMEX
.
...  used in PATCATBI PTMP0000
          CALL      TFILENAM                * Get temp file name
          MOVE      TFILNAME,FNAMEZ
.
...  used in PATCATBI PT2P0000
          CALL      TFILENAM                * Get temp file name
          MOVE      TFILNAME,FNAMEY
.
...  used in PABXBILL
          CALL      TFILENAM                * Get temp file name
          MOVE      TFILNAME,PBXFNAME
          CALL      TFILENAM                * Get temp file name
          MOVE      TFILNAME,PBXFNAM2
.
          MATCH     SP3,PTCNDCLM
          GOTO      INIT0200 IF NOT EQUAL
          MOVE      "0  ",PTCNDCLM
.
INIT0200  MOVE      ZERO,DISPROG            * Not the discharge program
          MOVE      ZERO,BEQPROG            * Not the billing enquiry program
          MOVE      ZERO,PEQPROG            * Not the patient enquiry program
.
          MATCH     "IBARSH",PGM
          GOTO      INIT0210 IF EQUAL
.
          CALL      SELPRINT
          MOVE      CPRTFLG,SPLING          * Save the spooling flag
.
INIT0210  
.
.         Check for the Rate Change Audit file if the system parameter is
.         switched on (0)
.
          BRANCH    CAUDQ,INIT4000
.
          OPEN      PATRCAUD,"patrcaud"
          CALL      RDSRCA
          CLOSE     PATRCAUD
.
          COMPARE   ZERO,OVRCD
          GOTO      INIT4000 IF EQUAL
.
          DISPLAY   *P1:24,*EL,*B:
                    "Sector ZERO in Rate Change Audit File is Not Set up.  ";
          CALL      HITENTER
          MOVE      ONE,EXIT
          GOTO      INIT9999
.
.         Check if the Medical records MBS file need to be copied
.
INIT4000  BRANCH    CUSEMBS,INIT4100,INIT4100
          GOTO      INIT9999
.
INIT4100  OPEN      PATMMBS1,"patmmbsf"
.
INIT9999  RETURN
+
.**********************************************************************
.*                            OPTN0000                                *
.*                  Main Option Screen for Web                        *
.**********************************************************************
.
OPTN0000  DISPLAY   *P1:3,*EF:
                    *P1:4,*V2LON,"0",*HOFF," = Exit":
                    *P1:5,*V2LON,"1",*HOFF," = Select Invoices":
                    *P1:6,*V2LON,"2",*HOFF," = Print Bulk Invoices":
                    *P1:9,"Select Option : ";
.
OPTN1000  KEYIN     *P17:9,*DV,UNDLN1,*P17:9,*V2LON,OPTION;
.
          COMPARE   ZERO,OPTION
          GOTO      OPTN9000 IF EQUAL
.
          BRANCH    OPTION,OPTN2000,OPTN2000
.
          BEEP
          GOTO      OPTN1000
.
OPTN2000  MOVE      ZERO,EXIT
          GOTO      OPTN9999
.
OPTN9000  MOVE      ONE,EXIT
.
OPTN9999  RETURN
.
.**********************************************************************
.*                            SELN0000                                *
.*                 Get Selection ID for printing                      *
.**********************************************************************
.
SELN0000  DISPLAY   *P1:3,*EF:
                    *P1:9,*V2LON,"Enter Selection ID :"
.
SELN1000  KEYIN     *P22:9,*DV,UNDLN1,*P22:9,*V2LON,SELECTID;
.
          MATCH     SP70,SELECTID
          GOTO      SELN9000 IF EQUAL
.
          PACK      KEY4,SELECTID,SP70
          CALL      RDPMBLI1
          IF        OVRCD=0
            IF        OPTION=1
              CALL      DELO0000              * Delete old invoices
            ENDIF
            GOTO      SELN2000
          ENDIF
.
          BEEP
          GOTO      SELN1000
.
SELN2000  MOVE      ZERO,EXIT
          GOTO      SELN9999
.
SELN9000  MOVE      ONE,EXIT
.
SELN9999  RETURN
+
.**********************************************************************
.*                            DELO0000                                *
.*  Remove all selected patients from selection file for web          *
.**********************************************************************
DELO0000  PACK      KEY12,SELECTID,SP70
          CALL      RSPMBII1
          CALL      RKPMBII1
          BRANCH    OVRCD,DELO9999
.
          MATCH     SELECTID,PMBISEID
          GOTO      DELO9999 IF NOT EQUAL
.
          PACK      KEY12,PMBISEID,PMBIVISN,SP70
          CALL      DEPMBII1
          GOTO      DELO0000
.
DELO9999  RETURN
+
.**********************************************************************
.*                            SDAYS000                                *
.*                         Selections for                             *
.*        All patients where last invoice was sent more than N days   *
.**********************************************************************
.
SDAYS000  DISPLAY   *P51:2,*V2LON,"- Last Invoice    n Days ",*P1:3,*EF;
.
SDAYS100  MOVE      CDD,DD
          MOVE      CMM,MM
          MOVE      CYY,YY
          MOVE      CCC,CC
          CALL      DMYCON
          MOVE      JULDAY,SCDJULDY
          MOVE      JULYR,SCDJULYR
          MOVE      JULCC,SCDJULCC
.
SDAYS200  MOVE      SP8,DDATE
          MOVE      ONE,DISFLG
          PACK      KEY9,TWO,SP8
          CALL      RDSMISS2
.
SDAYS210  CALL      RDKMISS2
          BRANCH    OVRCD,SDAYS999
.
          MOVE      SCDJULDY,CDJULDAY
          MOVE      SCDJULYR,CDJULYR
          MOVE      SCDJULCC,CDJULCC
          BRANCH    ASTAT,SDAYS210:          * Pre-admission
                          SDAYS300:          * Current Admission
                          SDAYS800:          * Discharged
                          SDAYS300:          * On-leave     
                          SDAYS900           * Cancelled    
.
.    DETERMINE THE NUMBER OF DAYS THAT THIS PATIENT HAS BEEN ADMITTED.
.    IF IT MORE THAN THE KEYED IN NUMBER OF DAYS
.    THEN PRINT AN INVOICE FOR THEM.
.
.   ,DO THIS , USE THE FOLLOWING STEPS :
.                 1. CONVERT THE LAST INVOICED DATE,JULIAN
.                 2. CONVERT THE CURRENT DATE,JULIAN
.                 3. SUBTRACT THE LAST INVOICED DATE FROM THE CURRENT DATE
.                 4. COMPARE THE RESULT,THE KEYED IN NUMBER OF DAYS
.
SDAYS300  DISPLAY   *P1:24,*EL,*P50:24,"Scanning : ",*V2LON,AADMNO;
          MOVE      AURNO,KEY8
          CALL      RDMAST1
          BRANCH    OVRCD,SDAYS210
.
          CALL      CKRNGE00
          BRANCH    OVRCD,SDAYS210
.
          MOVE      AADMNO,KEY8
          CALL      CLPATDSC             * Clear Disc.record
          MOVE      ZERO,DISFLG
          CALL      RDDSCH1
          COMPARE   ZERO,OVRCD
          GOTO      SDAYS400 IF EQUAL
          MOVE      ONE,DISFLG
.
SDAYS400  UNPACK    ALACDTE INTO XCENT,XYEAR,XMON,XDAY
.
          MOVE      XDAY,DD
          MOVE      XMON,MM
          MOVE      XYEAR,YY
          MOVE      XCENT,CC
          CALL      DMYCON
          MOVE      JULDAY,ADJULDAY
          MOVE      JULYR,ADJULYR
          MOVE      JULCC,ADJULCC
.
SDAYS500  COMPARE   CDJULCC,ADJULCC      * Current date and invoice date same?
          GOTO      SDAYS510 IF EQUAL      * Same, compare year
          GOTO      SDAYS520 IF LESS       * Less than current, Goto DAYS5200
          GOTO      SDAYS210                * Otherwise, go to next record

SDAYS510  COMPARE   CDJULYR,ADJULYR      * If year same, 
          GOTO      SDAYS600 IF EQUAL       * go on to day calculations
          GOTO      SDAYS520 IF LESS
          GOTO      SDAYS210                * If ADJULYR > CDJULYR

SDAYS520  ADD       "365",CDJULDAY      
          SUB       ONE FROM CDJULYR
            IF        CDJULYR < ZERO      
              MOVE      "99",CDJULYR     * If less than 00, becomes last year
              SUB        ONE,CDJULCC     * of previous century
            ENDIF
          GOTO      SDAYS500
.
SDAYS600  MOVE      CDJULDAY,WRKDAY
          SUB       ADJULDAY FROM WRKDAY
.
          COMPARE   PMBLDAYS,WRKDAY
          GOTO      SDAYS210 IF LESS
.
          IF        IBCNMHOS=1
            CALL      CHKHOS00           * Check hospital id
            BRANCH    EXIT,SDAYS210
          ENDIF
.
          CALL      SAVELN00             * write invoice to temporary list
          GOTO      SDAYS210
.
SDAYS800  PACK      KEY9,FOUR,SP8
          CALL      RDSMISS2
          GOTO      SDAYS210
.
SDAYS900  DISPLAY   *P1:24,*EL,*V2LON,"***  Generation Completed  ***";
          GOTO      SDAYS999
.
SDAYS999  RETURN
.
.**********************************************************************
.*                            PDAYS000                                *
.*                         Bulk printing for                          *
.*        All patients where last invoice was sent more than N days   *
.**********************************************************************
.
PDAYS000  DISPLAY   *P51:2,*V2LON,"- Last Invoice    n Days ",*P1:3,*EF;
.
          MATCH     "IBARSH",PGM
          GOTO      PDAYS200 IF EQUAL
.
          CALL      OPNPRINT
          MOVE      THREE,CPRTFLG   * Allow all receipts to be spooled together
.
PDAYS200  PACK      KEY12,SELECTID,SP70
          CALL      RSPMBII1
PDAYS210  CALL      RKPMBII1                  * read invoice from temporary list
          BRANCH    OVRCD,PDAYS900
.
          MATCH     SELECTID,PMBISEID
          GOTO      PDAYS900 IF NOT EQUAL
.
          MATCH     "1",PMBISTAT              * Exclude invoice
          GOTO      PDAYS210 IF EQUAL
.
          MATCH     "1",PMBIPRNT              * Printed invoice
          GOTO      PDAYS210 IF EQUAL
.
          MOVE      ONE,DISFLG
          PACK      KEY8,PMBIVISN,SP8
          CALL      RDMISS1
          BRANCH    OVRCD,PDAYS210
.
          DISPLAY   *P1:24,*EL,*P50:24,"Scanning : ",*V2LON,AADMNO;
          MOVE      AURNO,KEY8
          CALL      RDMAST1
          BRANCH    OVRCD,PDAYS210
.
          MOVE      AADMNO,KEY8
          CALL      CLPATDSC             * Clear Disc.record
          MOVE      ZERO,DISFLG
          CALL      RDDSCH1
          COMPARE   ZERO,OVRCD
          GOTO      PDAYS400 IF EQUAL
          MOVE      ONE,DISFLG
.
PDAYS400  CALL      PRNTLN00                    * print invoice
          GOTO      PDAYS210
.
PDAYS900  DISPLAY   *P1:24,*EL,*V2LON,"***  Generation Completed  ***";
          MATCH     "IBARSH",PGM
          IF  !@EQUAL
                MOVE      SPLING,CPRTFLG       * Restore the original setting
                CALL      CLSPRINT
          ENDIF
.
PDAYS999  RETURN
+
.**********************************************************************
.*                            SDATE000                                *
.*                         Selections for                             *
.*          All Discharged patients since a keyed-in Date             *
.**********************************************************************
.
SDATE000  DISPLAY   *P51:2,*V2LON,"- Discharged from ",*P1:3,*EF,*HOFF; 
.
          UNPACK    PMBLSTDT,XCENT,XYEAR,XMON,XDAY
          DISPLAY   *P63:2,*EL,*V2LON,XDAY,"/",XMON,"/",XYEAR;
.
SDATE100  PACK      KEY16,PMBLSTDT,SP8
          CALL      RDSDSCH2
.
SDATE110  CALL      RDKDSCH2
          BRANCH    OVRCD,SDATE900
.
          MATCH     DDATE,PMBLENDT
          GOTO      SDATE900 IF LESS
.
          UNPACK    DDATE WITH XCENT,XYEAR,XMON,XDAY
          DISPLAY   *P1:24,*EL,*P50:24,"Scanning : ":
                    *V2LON,DADMNO,SP1,XDAY,SLASH,XMON,SLASH,XCENT,XYEAR;
.
          MOVE      DADMNO,KEY8
          CALL      RDMISS1
          BRANCH    OVRCD,SDATE110
.
          MOVE      AURNO,KEY8
          CALL      RDMAST1
          BRANCH    OVRCD,SDATE110
.
          CALL      CKRNGE00
          BRANCH    OVRCD,SDATE110
.
          IF        IBCNMHOS=1
            CALL      CHKHOS00           * Check hospital id
            BRANCH    EXIT,SDATE110
          ENDIF
.
          MOVE      ZERO,DISFLG
          CALL      SAVELN00             * write invoice to temporary list
          GOTO      SDATE110
.
SDATE900  DISPLAY   *P1:24,*EL,*V2LON:
                    "***  Generation Completed  ***";
.
SDATE999  RETURN                
.
.**********************************************************************
.*                            PDATE000                                *
.*                         Bulk printing for                          *
.*      All Discharged patients since a keyed-in Date                 *
.**********************************************************************
.
PDATE000  DISPLAY   *P51:2,*V2LON,"- Discharged from ",*P1:3,*EF,*HOFF;
.
          UNPACK    PMBLSTDT,XCENT,XYEAR,XMON,XDAY
          DISPLAY   *P63:2,*EL,*V2LON,XDAY,"/",XMON,"/",XYEAR;
.
          MATCH     "IBARSH",PGM
          GOTO      PDATE100 IF EQUAL
.
          CALL      OPNPRINT
          MOVE      THREE,CPRTFLG   * Allow all receipts to be spooled together
.
PDATE100  PACK      KEY12,SELECTID,SP70
          CALL      RSPMBII1
PDATE110  CALL      RKPMBII1
          BRANCH    OVRCD,PDATE900
.
          MATCH     SELECTID,PMBISEID
          GOTO      PDATE900 IF NOT EQUAL
.
          MATCH     "1",PMBISTAT              * Exclude invoice
          GOTO      PDATE110 IF EQUAL
.
          MATCH     "1",PMBIPRNT              * Printed invoice
          GOTO      PDATE110 IF EQUAL
.
          PACK      KEY8,PMBIVISN,SP8
          CALL      RDDSCH1
          BRANCH    OVRCD,PDATE900
.
          UNPACK    DDATE WITH XCENT,XYEAR,XMON,XDAY
.
          DISPLAY   *P1:24,*EL,*P50:24,"Scanning : ":
                    *V2LON,DADMNO,SP1,XDAY,SLASH,XMON,SLASH,XCENT,XYEAR;
.
          MOVE      DADMNO,KEY8
          CALL      RDMISS1
          BRANCH    OVRCD,PDATE110
.
          MOVE      AURNO,KEY8
          CALL      RDMAST1
          BRANCH    OVRCD,PDATE110
.
          MOVE      ZERO,DISFLG
          CALL      PRNTLN00
          GOTO      PDATE110
.
PDATE900  DISPLAY   *P1:24,*EL,*V2LON:
                    "***  Generation Completed  ***";
          MATCH     "IBARSH",PGM
          IF    !@EQUAL
                   MOVE      SPLING,CPRTFLG       * Restore the original setting
                   CALL      CLSPRINT
          ENDIF
.
PDATE999  RETURN                
.
.**********************************************************************
.*                            SDLLS000                                *
.*                         Selections for                             *
.*          All Discharged patients owing at least X dollars          *
.**********************************************************************
.
SDLLS000  DISPLAY   *P51:2,*V2LON,"- Discharge owing at least X ",*P1:3,*EF;
.
          DISPLAY   *P71:2,*V2LON,"$",PMBLMAMT,SP1;
          MOVE      ZEROVISN,AADMNO
.
          MOVE      ZERO,IPASS
          MOVE      AADMNO,KEY8
          OPEN      PATIPEN1,"patipenf"
          CALL      RDSIPEN1
SDLLS110  CALL      RDKIPEN1
          BRANCH    OVRCD OF SDLLS900
          DISPLAY   *P1:24,*EL,*P50:24,"Scanning : ",*V2LON,IPADMNO;
.
          MOVE      IPADMNO,AADMNO
          MOVE      IPADMNO,KEY8
          CALL      RDMISS1
          BRANCH    OVRCD,SDLLS110
.
          COMPARE   ASTAT,THREE                 * Discharged only
          GOTO      SDLLS110 IF NOT EQUAL
.
          MOVE      AURNO,KEY8
          CALL      RDMAST1
          BRANCH    OVRCD,SDLLS110
.
          CALL      CKRNGE00
          BRANCH    OVRCD,SDLLS110
.
          CALL      CLPATDSC             * Clear Disc.record
          MOVE      AADMNO,KEY8
          CALL      RDDSCH1
          MOVE      OVRCD,DISFLG
.
.         If we are using the board charging file, and we are
.         defaulting the board from the postcode, and we are not
.         inputing the board, then recalculate the charges, just in
.         case the postcode has been changed
.
          IF        CFEETYP = 4 & PTCNBDOM = 1 & PTCNUBRD <> 1
            PROC      PATRECAL             * recalculate bed charges
            CALL      UPMISS1
          ENDIF
.
.        Calculate the amount to be invoiced
.
          MOVE      ONE,PROGFLAG
          CALL      CALCTBI
          SUB       CSAMT FROM NETTOT
          DISPLAY   *P69:24,*V2LON,"$",NETTOT;
.
.        Check for nothing to be printed - delete from PATIPEFD if discharged
.
          COMPARE   THREE,ASTAT                 * Discharged
          GOTO      SDLLS200 IF NOT EQUAL
.
          MOVE      AADMNO,KEY8
          COMPARE   ZERO,NETTOT
          CALL      DEIPEN1 IF EQUAL
.
.        Check for an outstanding debt
.
          BRANCH    DISFLG,SDLLS110
.
SDLLS200  COMPARE   PMBLMAMT,NETTOT
          GOTO      SDLLS110 IF LESS
.
          IF        IBCNMHOS=1
            CALL      CHKHOS00           * Check hospital id
            BRANCH    EXIT,SDLLS110
          ENDIF
.
          CALL      SAVELN00
          GOTO      SDLLS110
.
SDLLS900  DISPLAY   *P1:24,*EL,*V2LON:
                    "***  Generation Completed  ***";
          CLOSE     PATIPEN1
.
SDLLS999  RETURN
.
.**********************************************************************
.*                            PDLLS000                                *
.*                         Bulk printint for                          *
.*          All Discharged patients owing at least X dollars          *
.**********************************************************************
.
PDLLS000  DISPLAY   *P51:2,*V2LON,"- Discharge owing at least X ",*P1:3,*EF;
.
          DISPLAY   *P71:2,*V2LON,"$",PMBLMAMT,SP1;
          OPEN      PATIPEN1,"patipenf"
.
          MATCH     "IBARSH",PGM
          GOTO      PDLLS100 IF EQUAL
.
          CALL      OPNPRINT
          MOVE      THREE,CPRTFLG   * Allow all receipts to be spooled together
.
PDLLS100  PACK      KEY12,SELECTID,SP70
          CALL      RSPMBII1
PDLLS110  CALL      RKPMBII1
          BRANCH    OVRCD OF PDLLS900
.
          MATCH     SELECTID,PMBISEID
          GOTO      PDLLS900 IF NOT EQUAL
.
          MATCH     "1",PMBISTAT              * Exclude invoice
          GOTO      PDLLS110 IF EQUAL
.
          MATCH     "1",PMBIPRNT              * Printed invoice
          GOTO      PDLLS110 IF EQUAL
.
          MOVE      PMBIVISN,AADMNO
.
          MOVE      ZERO,IPASS
          MOVE      AADMNO,KEY8
          CALL      RDIPEN1
          BRANCH    OVRCD OF PDLLS900
          DISPLAY   *P1:24,*EL,*P50:24,"Scanning : ",*V2LON,IPADMNO;
.
          MOVE      IPADMNO,AADMNO
          MOVE      IPADMNO,KEY8
          CALL      RDMISS1
          BRANCH    OVRCD OF PDLLS110
.
          COMPARE   ASTAT,THREE                 * Discharged
          GOTO      PDLLS110 IF NOT EQUAL
.
          MOVE      AURNO,KEY8
          CALL      RDMAST1
          BRANCH    OVRCD OF PDLLS110
.
          CALL      CLPATDSC             * Clear Disc.record
          MOVE      AADMNO,KEY8
          CALL      RDDSCH1
          MOVE      OVRCD,DISFLG
.
.         If we are using the board charging file, and we are
.         defaulting the board from the postcode, and we are not
.         inputing the board, then recalculate the charges, just in
.         case the postcode has been changed
.
          IF        CFEETYP = 4 & PTCNBDOM = 1 & PTCNUBRD <> 1
            PROC      PATRECAL             * recalculate bed charges
            CALL      UPMISS1
          ENDIF
.
.        Calculate the amount to be invoiced
.
          MOVE      ONE,PROGFLAG
          CALL      CALCTBI
          SUB       CSAMT FROM NETTOT
          DISPLAY   *P69:24,*V2LON,"$",NETTOT;
.
.        Check for nothing to be printed - delete from PATIPEFD if discharged
.
          COMPARE   THREE,ASTAT                 * Discharged
          GOTO      PDLLS200 IF NOT EQUAL
.
          MOVE      AADMNO,KEY8
          COMPARE   ZERO,NETTOT
          CALL      DEIPEN1 IF EQUAL
.
.        Check for an outstanding debt
.
          BRANCH    DISFLG,PDLLS110
.
PDLLS200  COMPARE   PMBLMAMT,NETTOT
          GOTO      PDLLS110 IF LESS
.
          CALL      PRNTLN00
          GOTO      SDLLS110
.
PDLLS900  DISPLAY   *P1:24,*EL,*V2LON:
                    "***  Generation Completed  ***";
          MATCH     "IBARSH",PGM
          IF   !@EQUAL
                 MOVE      SPLING,CPRTFLG       * Restore the original setting
                 CALL      CLSPRINT
          ENDIF
          CLOSE     PATIPEN1
.
PDLLS999  RETURN
.
.**********************************************************************
.*                            SWARD000                                *
.*                         Selections for                             *
.*          All Patients Discharged from a given Ward                 *
.**********************************************************************
.
SWARD000  DISPLAY   *P51:2,*V2LON,"- Discharge from Ward ",*P1:3,*EF,*HOFF;
.
          UNPACK    PMBLSTDT,XCENT,XYEAR,XMON,XDAY
          DISPLAY   *P66:2,*EL,*V2LON,PMBLWARD," - ",XDAY,"/",XMON,"/",XYEAR;
.
SWARD100  PACK      KEY16,PMBLSTDT,SP8
          CALL      RDSDSCH2
.
SWARD110  CALL      RDKDSCH2
          BRANCH    OVRCD OF SWARD900
.
          MATCH     DDATE,PMBLENDT
          GOTO      SWARD900 IF LESS
.
          UNPACK    DDATE WITH XCENT,XYEAR,XMON,XDAY
          DISPLAY   *P1:24,*EL,*P50:24,"Scanning : ":
                    *V2LON,DADMNO,SP1,XDAY,SLASH,XMON,SLASH,XCENT,XYEAR;
.
          MOVE      DADMNO,KEY8
          CALL      RDMISS1
          BRANCH    OVRCD,SWARD110
.
          MOVE      AURNO,KEY8
          CALL      RDMAST1
          BRANCH    OVRCD,SWARD110
.
          CALL      CKRNGE00
          BRANCH    OVRCD,SWARD110
.
          PACK      KEY30,DADMNO,Z30
          CALL      RDSTRAN2
          CALL      RDPTRAN2
          BRANCH    OVRCD,SWARD110
.
          MATCH     TADMN,AADMNO
          GOTO      SWARD110 IF NOT EQUAL
.
          MATCH     TWARD,PMBLWARD
          GOTO      SWARD110 IF NOT EQUAL
.
          IF        IBCNMHOS=1
            CALL      CHKHOS00           * Check hospital id
            BRANCH    EXIT,SWARD110
          ENDIF
.
          MOVE      ZERO,DISFLG
          CALL      SAVELN00
          GOTO      SWARD110
.
SWARD900  DISPLAY   *P1:24,*EL,*V2LON:
                    "***  Generation Completed  ***";
.
SWARD999  RETURN
.
.**********************************************************************
.*                            PWARD000                                *
.*                         Bulk printing for                          *
.*          All Patients Discharged from a given Ward                 *
.**********************************************************************
.
PWARD000  DISPLAY   *P51:2,*V2LON,"- Discharge from Ward ",*P1:3,*EF,*HOFF;
.
          UNPACK    PMBLSTDT,XCENT,XYEAR,XMON,XDAY
          DISPLAY   *P66:2,*EL,*V2LON,PMBLWARD," - ",XDAY,"/",XMON,"/",XYEAR;
.
          MATCH     "IBARSH",PGM
          GOTO      PWARD100 IF EQUAL
.
          CALL      OPNPRINT
          MOVE      THREE,CPRTFLG   * Allow all receipts to be spooled together
.
PWARD100  PACK      KEY12,SELECTID,SP70
          CALL      RSPMBII1
PWARD110  CALL      RKPMBII1
          BRANCH    OVRCD OF PWARD900
.
          MATCH     SELECTID,PMBISEID
          GOTO      PWARD900 IF NOT EQUAL
. 
          MATCH     "1",PMBISTAT              * exclude invoice
          GOTO      PWARD110 IF EQUAL
.
          MATCH     "1",PMBIPRNT              * printed invoice
          GOTO      PWARD110 IF EQUAL
.
          PACK      KEY8,PMBIVISN,SP8
          CALL      RDDSCH1
          BRANCH    OVRCD OF PWARD110
.
          UNPACK    DDATE WITH XCENT,XYEAR,XMON,XDAY
          DISPLAY   *P1:24,*EL,*P50:24,"Scanning : ":
                    *V2LON,DADMNO,SP1,XDAY,SLASH,XMON,SLASH,XCENT,XYEAR;
.
          MOVE      DADMNO,KEY8
          CALL      RDMISS1
          BRANCH    OVRCD,PWARD110
.
          MOVE      AURNO,KEY8
          CALL      RDMAST1
          BRANCH    OVRCD,PWARD110
.
          PACK      KEY30,DADMNO,Z30
          CALL      RDSTRAN2
          CALL      RDPTRAN2
          BRANCH    OVRCD,PWARD110
.
          MATCH     TADMN,AADMNO
          GOTO      PWARD110 IF NOT EQUAL
.
          MOVE      ZERO,DISFLG
          CALL      PRNTLN00
          GOTO      PWARD110
.
PWARD900  DISPLAY   *P1:24,*EL,*V2LON:
                    "***  Generation Completed  ***";
          MATCH     "IBARSH",PGM
          IF   !@EQUAL 
                 MOVE      SPLING,CPRTFLG       * Restore the original setting
                 CALL      CLSPRINT
          ENDIF
.
PWARD999  RETURN
.
.**********************************************************************
.*                            SCLTP000                                *
.*                         Selections for                             *
.*          All Patients Discharged with a given Claim Type           *
.**********************************************************************
.
SCLTP000  DISPLAY   *P51:2,*V2LON,"- Discharge for Claim ",*P1:3,*EF,*HOFF;
.
          UNPACK    PMBLSTDT,XCENT,XYEAR,XMON,XDAY
          DISPLAY   *P66:2,*EL,*V2LON,PMBLWARD," - ",XDAY,"/",XMON,"/",XYEAR;
.
SCLTP100  PACK      KEY16,PMBLSTDT,SP8
          CALL      RDSDSCH2
.
SCLTP110  CALL      RDKDSCH2
          BRANCH    OVRCD OF SCLTP900
.
          MATCH     DDATE,PMBLENDT
          GOTO      SCLTP900 IF LESS
.
          UNPACK    DDATE WITH XCENT,XYEAR,XMON,XDAY
          DISPLAY   *P1:24,*EL,*P50:24,"Scanning : ":
                    *V2LON,DADMNO,SP1,XDAY,SLASH,XMON,SLASH,XCENT,XYEAR;
.
          MOVE      DADMNO,KEY8
          CALL      RDMISS1
          BRANCH    OVRCD,SCLTP110
.
          MATCH     ACLAIM,PMBLWARD
          GOTO      SCLTP110 IF NOT EQUAL
.
          MOVE      AURNO,KEY8
          CALL      RDMAST1
          BRANCH    OVRCD,SCLTP110
.
          CALL      CKRNGE00
          BRANCH    OVRCD,SCLTP110
.
          PACK      KEY30,DADMNO,Z30
          CALL      RDSTRAN2
          CALL      RDPTRAN2
          BRANCH    OVRCD,SCLTP110
.
          MATCH     TADMN,AADMNO
          GOTO      SCLTP110 IF NOT EQUAL
.
          IF        IBCNMHOS=1
            CALL      CHKHOS00           * Check hospital id
            BRANCH    EXIT,SCLTP110
          ENDIF
.
          MOVE      ZERO,DISFLG
          CALL      SAVELN00
          GOTO      SCLTP110
.
SCLTP900  DISPLAY   *P1:24,*EL,*V2LON:
                    "***  Generation Completed  ***";
.
SCLTP999  RETURN
.
.**********************************************************************
.*                            PCLTP000                                *
.*                         Bulk printing for                          *
.*          All Patients Discharged with a given Claim Type           *
.**********************************************************************
.
PCLTP000  DISPLAY   *P51:2,*V2LON,"- Discharge for Claim ",*P1:3,*EF,*HOFF;
.
          UNPACK    PMBLSTDT,XCENT,XYEAR,XMON,XDAY
          DISPLAY   *P66:2,*EL,*V2LON,PMBLWARD," - ",XDAY,"/",XMON,"/",XYEAR;
.
          MATCH     "IBARSH",PGM
          GOTO      PCLTP100 IF EQUAL
.
          CALL      OPNPRINT
          MOVE      THREE,CPRTFLG   * Allow all receipts to be spooled together
.
PCLTP100  PACK      KEY12,SELECTID,SP70
          CALL      RSPMBII1
PCLTP110  CALL      RKPMBII1
          BRANCH    OVRCD OF PCLTP900
.
          MATCH     SELECTID,PMBISEID
          GOTO      PCLTP900 IF NOT EQUAL
.
          MATCH     "1",PMBISTAT              * exclude invoice
          GOTO      PCLTP110 IF EQUAL
.
          MATCH     "1",PMBIPRNT              * printed invoice
          GOTO      PCLTP110 IF EQUAL
.
          PACK      KEY8,PMBIVISN,SP8
          CALL      RDDSCH1
          BRANCH    OVRCD OF PCLTP110
.
          UNPACK    DDATE WITH XCENT,XYEAR,XMON,XDAY
          DISPLAY   *P1:24,*EL,*P50:24,"Scanning : ":
                    *V2LON,DADMNO,SP1,XDAY,SLASH,XMON,SLASH,XCENT,XYEAR;
.
          MOVE      DADMNO,KEY8
          CALL      RDMISS1
          BRANCH    OVRCD,PCLTP110
.
          MOVE      AURNO,KEY8
          CALL      RDMAST1
          BRANCH    OVRCD,PCLTP110
.
          PACK      KEY30,DADMNO,Z30
          CALL      RDSTRAN2
          CALL      RDPTRAN2
          BRANCH    OVRCD,PCLTP110
.
          MATCH     TADMN,AADMNO
          GOTO      PCLTP110 IF NOT EQUAL
.
          MOVE      ZERO,DISFLG
          CALL      PRNTLN00
          GOTO      PCLTP110
.
PCLTP900  DISPLAY   *P1:24,*EL,*V2LON:
                    "***  Generation Completed  ***";
          MATCH     "IBARSH",PGM
          IF   !@EQUAL
                 MOVE      SPLING,CPRTFLG       * Restore the original setting
                 CALL      CLSPRINT
          ENDIF
.
PCLTP999  RETURN
.
.**********************************************************************
.         Check hospital id
.**********************************************************************
CHKHOS00  MOVE      ZERO,EXIT
          MATCH     SP10,PMBLHOSP
          IF        !@EQUAL
            MOVE      AADMNO,KEY8
            CALL      RDPMVX11
            BRANCH    OVRCD,CHKHOS90
            MATCH     PMVXMHOS,PMBLHOSP
            GOTO      CHKHOS90 IF NOT EQUAL
          ENDIF
          GOTO      CHKHOS99
.
CHKHOS90  MOVE      ONE,EXIT
CHKHOS99  RETURN
.
.**********************************************************************
.*                            SAVELN00                                *
.*                   Write Bulk invoice to patbiiaf                   *
.**********************************************************************
.
SAVELN00  DISPLAY   *P1:4,*EF;
          MOVE      AADMNO,KEY8
          CALL      RDVISA1
          BRANCH    OVRCD,SAVELN99
.
.         Cannot print casepayment invoice until discharged
.
          MATCH     "Y",PTMICMXP
          IF        @EQUAL
            COMPARE   THREE,ASTAT
            GOTO      SAVELN99 IF NOT EQUAL
          ENDIF
.
.        Calculate the amount of the invoice and determine if two invoices
.        are required (already done if we are in Option 3). If we are using
.        board charging, also allow for the possibility that the board
.        charges may need to be recalculated for a change in postcode.
.
          MOVE      ONE,PROGFLAG             * work out amount to be invoiced
          MATCH     "3",PMBLTYPE
          IF        !@EQUAL          
            IF        CFEETYP = 4 & PTCNBDOM = 1 & PTCNUBRD <> 1
              PROC      PATRECAL             * recalculate bed charges
              CALL      UPMISS1
            ENDIF
            CALL      CALCTBI
          ENDIF
.
SAVELN10  UNPACK    PBDATE WITH CCENT,CYEAR,CMON,CDAY
          CALL      PACDATE
          MOVE      CPDATE,B8DATE
          MOVE      CPCDATE,B10DATE
.
          UNPACK    ADATE,CCENT,CYEAR,CMON,CDAY
          CALL      PACDATE
          MOVE      CPDATE,A8DATE
          MOVE      CPCDATE,A10DATE
.
          MATCH     SP8,DDATE
          GOTO      SAVELN20 IF EQUAL
.
          UNPACK    DDATE,CCENT,CYEAR,CMON,CDAY
          CALL      PACDATE
          MOVE      CPDATE,D8DATE
          MOVE      CPCDATE,D10DATE
.
SAVELN20  
.**       MOVE      THREE,PROGFLAG              * print next invoice
.**       CALL      CALCTBI                     * Work out invoice date range
.
          COMPARE   TOTDAYS,CMAXINV             * check in PRNTINV0
          GOTO      SAVELN99 IF LESS            * skip Invoice for too many days
.
          COMPARE   ZERO,GROSSTOT
          GOTO      SAVELN99 IF EQUAL
.
          CALL      DISPFORM
          DISPLAY   *P1:8,"U/R Number       : ":
                    *P1:9,"Admission Number : ":
                    *P1:10,"Patient Name     : ":
                    *P1:11,"Address          : ":
                    *P1:12,"                 : ":
                    *P1:13,"                 : ":
                    *P1:14,"                 : ":
                    *P1:15,"Admission Date   : ":
                    *P1:16,"Discharge Date   : ":
                    *P1:18,"Invoicing from   : ":
                    *P1:19,"          to     : ":
                    *P1:21,"Invoice Amount   : ":
                    *P20:8,*V2LON,AURNO:
                    *P20:9,AADMNO:
                    *P20:10,PSNAME," ",PGNAME:
                    *P20:11,PADD1,*P20:12,PADD2:
                    *P20:13,PSUBRB:
                    *P20:14,PADD4," ",PPOST:
                    *P20:15,A10DATE:
                    *P20:16,D10DATE:
                    *P20:18,IF10DATE:
                    *P20:19,IT10DATE:
                    *P20:21,"$",NETTOT;
.
          MOVE      SELECTID,PMBISEID
          MOVE      AADMNO,PMBIVISN
          MOVE      AURNO,PMBIURNO
          MOVE      ADATE,PMBIADDT
          MOVE      DDATE,PMBIDSDT
          MOVE      IF8DATE,PMBIIFDT
          MOVE      IT8DATE,PMBIITDT
          MOVE      NETTOT,PMBIIAMT
          MOVE      PMVXPICD,PMBIPDRG
.
          MOVE      ZERO,PMBICFLG
          MATCH     ACODDTE,SP8
          IF        !@EQUAL
            MOVE      ONE,PMBICFLG
          ENDIF
.          
          MOVE      ZERO,PMBIPRNT
.
          MOVE      ZERO,PMBISTAT
          PACK      KEY12,SELECTID,AADMNO,SP70
          CALL      RAPMBII1
          IF        OVRCD=1
            CALL      WRPMBII1
          ENDIF
.
SAVELN99  RETURN
.
.**********************************************************************
.*                            PRNTLN00                                *
.*          Subroutine to ask the operator for a name range           *
.**********************************************************************
.
PRNTLN00  DISPLAY   *P1:4,*EF;
          MOVE      AADMNO,KEY8
          CALL      RDVISA1
          BRANCH    OVRCD,PRNTLN99
.
          MOVE      AADMNO,KEY8
          CALL      RDPMVX11
          BRANCH    OVRCD,PRNTLN99
.
.         Cannot print casepayment invoice until discharged
.
          MATCH     "Y",PTMICMXP
          IF        @EQUAL
            COMPARE   THREE,ASTAT
            GOTO      PRNTLN99 IF NOT EQUAL
          ENDIF
.
.         Check clinical document if invoice can be raised ?
.
          CALL      CHKDCI00
          BRANCH    EXIT,PRNTLN99
.
.        Calculate the amount of the invoice and determine if two invoices
.        are required (already done if we are in Option 3). If we are using
.        board charging, also allow for the possibility that the board
.        charges may need to be recalculated for a change in postcode.
.
          MOVE      ONE,PROGFLAG
          MATCH     "3",PMBLTYPE
          IF        !@EQUAL          
            IF        CFEETYP = 4 & PTCNBDOM = 1 & PTCNUBRD <> 1
              PROC      PATRECAL             * recalculate bed charges
              CALL      UPMISS1
            ENDIF
            CALL      CALCTBI
          ENDIF
.
PRNTLN10  UNPACK    PBDATE WITH CCENT,CYEAR,CMON,CDAY
          CALL      PACDATE
          MOVE      CPDATE,B8DATE
          MOVE      CPCDATE,B10DATE
.
          UNPACK    ADATE,CCENT,CYEAR,CMON,CDAY
          CALL      PACDATE
          MOVE      CPDATE,A8DATE
          MOVE      CPCDATE,A10DATE
.
          MATCH     SP8,DDATE
          GOTO      PRNTLN20 IF EQUAL
.
          MOVE      DDATE,CCENT,CYEAR,CMON,CDAY
          CALL      PACDATE
          MOVE      CPDATE,D8DATE
          MOVE      CPCDATE,D10DATE
.
PRNTLN20  
.**       MOVE      THREE,PROGFLAG
.**       CALL      CALCTBI                        * Work out invoice date range
          CALL      DISPFORM
          DISPLAY   *P1:8,"U/R Number       : ":
                    *P1:9,"Admission Number : ":
                    *P1:10,"Patient Name     : ":
                    *P1:11,"Address          : ":
                    *P1:12,"                 : ":
                    *P1:13,"                 : ":
                    *P1:14,"                 : ":
                    *P1:15,"Admission Date   : ":
                    *P1:16,"Discharge Date   : ":
                    *P1:18,"Invoicing from   : ":
                    *P1:19,"          to     : ":
                    *P1:21,"Invoice Amount   : ":
                    *P20:8,*V2LON,AURNO:
                    *P20:9,AADMNO:
                    *P20:10,PSNAME," ",PGNAME:
                    *P20:11,PADD1,*P20:12,PADD2:
                    *P20:13,PSUBRB:
                    *P20:14,PADD4," ",PPOST:
                    *P20:15,A10DATE:
                    *P20:16,D10DATE:
                    *P20:18,IF10DATE:
                    *P20:19,IT10DATE:
                    *P20:21,"$",NETTOT;
.
          COMPARE   ZERO,GROSSTOT
          GOTO      PRNTLN99 IF EQUAL

          COMPARE   TOTDAYS,CMAXINV            * check in PRNTINV0
          GOTO      PRNTLN99 IF LESS           * skip Invoice for too many days
.
          MOVE      ONE,WEBFLAG
          CALL      PRNTINV0                   * print invoice
.
          PACK      KEY12,SELECTID,AADMNO,SP70
          MOVE      ONE,PMBIPRNT
          CALL      UPPMBII1
.
PRNTLN99  RETURN
+
.------------------------------------------------------------------------------
. Check Claim Type/Clinical Document Mapping table to determine if the
. Invoice can be raised for Inpatient
.------------------------------------------------------------------------------
CHKDCI00  MOVE      AURNO,INDMURNO
          MOVE      AADMNO,INDMADNO
.
          MOVE      SP70,INDMHOSP
          IF        IBCNMHOS=1
            MOVE      PMVXMHOS,INDMHOSP
          ENDIF
          MOVE      ACLAIM,INDMCLAM
          MOVE      "I",INDMSYST
          MOVE      ACARE,INDMCTYP
          MOVE      PMVXIDUS,INDMILOS
.
          PROC      CHKCLDCP
CHKDCI99  RETURN
+
.**********************************************************************
.*                            GTRNGE00                                *
.*          Subroutine to ask the operator for a name range           *
.**********************************************************************
.
GTRNGE00  DISPLAY   *P1:7,*EL,*P1:9,*EL:
                    *P1:7,"Enter Starting Name : ",PMBLSTNM:
                    *P1:9,"Enter Ending   Name : ",PMBLENNM;
.
GTRNGE99  RETURN
+
.**********************************************************************
.*                            CKRNGE00                                *
.* Subroutine to check that the patient is in the required name range *
.**********************************************************************
.
CKRNGE00  MOVE      ZERO,OVRCD
          MATCH     PMBLSTNM,PSNAME
          GOTO      OVERCOND IF LESS
.
          MATCH     PSNAME,PMBLENNM
          GOTO      OVERCOND IF LESS
.
CKRNGE99  RETURN
+
.****************************************************************************
.*                             DISPFORM                                     *
.****************************************************************************
.
DISPFORM    MOVE     SP8,IF8DATE 
            PACK     IF8DATE,FCENT,FYEAR,FMON,FDAY
            REP      " 0",IF8DATE
            UNPACK   IF8DATE,CCENT,CYEAR,CMON,CDAY
            CALL     PACDATE
            MOVE     CPCDATE,IF10DATE
.
            MOVE     SP8,IT8DATE 
            PACK     IT8DATE,TCENT,TYEAR,TMON,TDAY
            REP      " 0",IT8DATE
            UNPACK   IT8DATE,CCENT,CYEAR,CMON,CDAY
            CALL     PACDATE
            MOVE     CPCDATE,IT10DATE
.
            RETURN
+
.
.       Display the top screen after the question mark option
.
DISPB     DISPLAY   *P1:4,*EF,"U/R Number: ",*V2LON,PURNO,*HOFF:
                    *P20:4,"   Name : ",*V2LON,PNAME,*HOFF:
                    *P1:5,"Admission : ",*V2LON,AADMNO,*HOFF;
.
.       This is a dummy routine                                          
.
AGECHK              
ADDWRN00
DATAB              
GETSVAR           
WEBERR00
OPEN0000
DOCNM000
ISUG0000
CLOS0000  RETURN
+
.==============================================================================
.         Keyin hospital ID
.==============================================================================
KHOS0000  MOVE       SP10,PTHSHOSP
          MOVE       SP10,HOSPID
          DISPLAY    *P1:20,*EL,"Hospital Id : ";
          MOVE       TEN5,ECOL
          MOVE       "20",EVERT
          MOVE       SP3,CKYIDEF3
          MOVE       ZERO,CKYIMAND           * Not Mandatory
          OPEN       PATHSPA1,"pathspaf"
.
          CALL       PATHSPKY
          BRANCH     EXIT,KHOS2000,KHOS9999
          MOVE       PTHSHOSP,HOSPID
          GOTO       KHOS3000
.
KHOS2000  MOVE       "All Hospitals",PTHSNAME
          MOVE       SP10,HOSPID
.
KHOS3000  DISPLAY    *P23:23,*V2LON,PTHSNAME;
KHOS9999  RETURN
+
.------------------------------------------------------------
. Procedure to get Doctor Code from Outpatient Clinic ID
. COPTION - 1 Return DOCTCODE
.           2 Output Location
.           3 (N/A)
.           4 Output Menu Type
.           5 Output Unit
.------------------------------------------------------------
          DEFPROC  OUTDET00
.
          INC      OUTPREFD/INC
          INC      OUTCLIFD/INC
          INC      OUTBOAFD/INC
          INC      OUTMA1FD/INC
          INC      OUTBB1FD/INC
.
KEYBOA    DIM      28
KEYCLI    DIM      20
TESTSITE  DIM      6
TESTCLIN  DIM      6
.
          MOVE     SP70,DOCTCODE
          COMPARE  ZERO,PVITYPE
          GOTO     OUTDET50 IF EQUAL
.
          PACK     KEY6,PVISITE,SP70
          CALL     RDSITA1
          BRANCH   OVRCD,OUTDET95
.
          PACK     KEYCLI,PVISITE,PVIDOCT,PVIDATE,SP70
          BRANCH   COPTION,OUTDET60
.
          PACK     KEY8,OSTFILE,FILBOKA1 * Determine Location from Masterfile
          TRAP     OVERCOND IF IO
          OPEN     OUTBOKA1,KEY8         * Master
          TRAPCLR  IO
          BRANCH   OVRCD,OUTDET95
.
          PACK     KEYBOA,PVISITE,PVIDOCT,PVIDATE,SP70
          PACK     KEY28,PVISITE,PVIDOCT,PVIDATE,SP70
          PACK     KEY20,PVISITE,PVIDOCT,PVIDATE,SP70
          CALL     RDSBOKA1
OUTDET10  CALL     RDKBOKA1
          BRANCH   OVRCD,OUTDET95
          PACK     KEYBOA,OBASITE,OBACLIN,OBADATE,OBASTRT,OBASLOT,SP70
          MATCH    KEY20,KEYBOA
          GOTO     OUTDET95 IF NOT EQUAL
          MATCH    OBAOUTNO,PVIBILL         * Set up billing number
          GOTO     OUTDET10 IF NOT EQUAL
          GOTO     OUTDET80
.
OUTDET50  MOVE     ZERO,OVRCD
          TRAP     OVERCOND IF IO
          OPEN     OUTPREA1,"outpreaf"   * Pre Attendance File
          TRAPCLR  IO
          BRANCH   OVRCD,OUTDET95
          MOVE     ADMISSNO,KEY8
          CALL     RDPREA1               * Check for Pre-Attendance
          BRANCH   OVRCD,OUTDET95
.
          PACK     KEY6,OPRSITE,SP70
          CALL     RDSITA1
          BRANCH   OVRCD,OUTDET95
.
          PACK     KEYCLI,OPRSITE,OPRCLIN,OPRDATE,SP70
          PACK     KEYBOA,OPRSITE,OPRCLIN,OPRDATE,OPRSTRT,OPRSLOT
.
          BRANCH   COPTION,OUTDET60,OUTDET70,OUTDET70,OUTDET70
.
OUTDET60  MOVE     ZERO,OVRCD
          PACK     KEY8,OSTFILE,FILCLIA1 * Determine Doctor from Clinic ID
          TRAP     OVERCOND IF IO
          OPEN     OUTCLIA1,KEY8         * Clinic Details
          TRAPCLR  IO
          BRANCH   OVRCD,OUTDET95
.
          PACK      KEY20,KEYCLI,SP70
          CALL      RDCLIA1
          IF        OVRCD=1
            PACK      KEY20,KEYCLI,Z70
            CALL      RDSCLIA1          * Read Clinic Record
            CALL      RDPCLIA1          * Read Clinic Record
            BRANCH    OVRCD,OUTDET95
.
            UNPACK    KEYCLI,TESTSITE,TESTCLIN
.
            MATCH     TESTSITE,OCASITE
            GOTO      OUTDET95 IF NOT EQUAL
.
            MATCH     TESTCLIN,OCACLIN
            GOTO      OUTDET95 IF NOT EQUAL
          ENDIF
.
          MOVE     OCADOCT,DOCTCODE
          MATCH    SP70,DOCTCODE
          IF       @EQUAL
            MOVE     OCACCONS,DOCTCODE
          ENDIF
          MOVE     ZERO,EXIT
          GOTO     OUTDET99
.
OUTDET70  PACK     KEY8,OSTFILE,FILBOKA1 * Determine Location from Masterfile
          TRAP     OVERCOND IF IO
          OPEN     OUTBOKA1,KEY8         * Master
          TRAPCLR  IO
          BRANCH   OVRCD,OUTDET95
.
          MOVE     KEYBOA,KEY28
          CALL     RDBOKA1
          BRANCH   OVRCD,OUTDET95
.
OUTDET80  IF       COPTION=4
            PACK     MENUTYPE,TWO,OBASTAT * Outpatient Booking
            MOVE     ZERO,EXIT
            GOTO     OUTDET99
          ENDIF
.
          IF       COPTION=5
            PACK     CFNAME,OSTFILE,FILBB1A1
            CALL     OPOTBB11
            MOVE     ADMISSNO,KEY8
            CALL     RDBOKB1
            IF       OVRCD=0
              MATCH    SP6,OTBBDEPT
              GOTO     OUTDET95 IF EQUAL
              MOVE     OTBBDEPT,CODE       * Unit code
              MOVE     ZERO,EXIT
            ENDIF
            GOTO     OUTDET99
          ENDIF
.
          MOVE     ZERO,OVRCD
          PACK     KEY8,OSTFILE,FILMA1A1  * Determine Location from Masterfile
          TRAP     OVERCOND IF IO
          OPEN     OUTMA1A1,KEY8          * Master
          TRAPCLR  IO
          BRANCH   OVRCD,OUTDET95
.
          PACK     KEY18,OBASITE,OBACLIN,OBADAY,OBASTRT
          CALL     RDMASA1
          BRANCH   OVRCD,OUTDET95
.
          WRITE    HTMLFILE;OTMACLOC;
          MOVE     ZERO,EXIT
          GOTO     OUTDET99
.
OUTDET95  MOVE     ONE,EXIT
          GOTO     OUTDET99
.
          INC       OUTCLIIO/INC
          INC      OUTPREIO/INC
          INC       OUTBOAIO/INC
          INC       OUTMA1IO/INC
          INC       IBAOVRIO/INC
          INC       OUTBB1IO/INC
.
OUTDET99  ENDPROC
.------------------------------------------------------------
. Procedure to get Emergency Details
.   COPTION = 1 Return Consultant DOCTCODE
.             2 Output Location
.             3 Output Triage Status
.             4 Output Menu Type
.------------------------------------------------------------
          DEFPROC  EMRCHK00
.
          INC      EMRVISFD/INC
          INC      EMRLOCFD/INC
.
EMRCHK10  MOVE     ZERO,OVRCD
          TRAP     OVERCOND IF IO
          OPEN     EMRVISA1,"emrvisaf"
          TRAPCLR  IO
          BRANCH   OVRCD,EMRCHK90
.
          MOVE     ADMISSNO,KEY8
          CALL     RDEMVIS1
          BRANCH   OVRCD,EMRCHK90
.
          COMPARE  FOUR,EMVISTAT
          GOTO     EMRCHK90 IF EQUAL
.
          MOVE     EMVIDOCT,DOCTCODE
          IF       COPTION=4
            PACK     MENUTYPE,ONE,EMVISTAT
            GOTO     EMRCHK99
          ENDIF
          IF       COPTION=2
            IF       EMVISTAT=1
              OPEN     EMRLOCA1,"emrlocaf"
              MOVE     "Other Departments",EMLODESC
              MOVE     EMVILOCN,KEY3
              CALL     RDEMLOC1
              WRITE    HTMLFILE;"Emergency - ",EMLODESC;
            ELSE
              WRITE    HTMLFILE;"Discharged";
            ENDIF
          ENDIF
          IF       COPTION=3
            WRITE    HTMLFILE;EMVITRIG;
          ENDIF
          GOTO     EMRCHK99
.
EMRCHK90  MOVE     PVIDOCT,DOCTCODE
          IF       COPTION=2
            WRITE    HTMLFILE;"Emergency";
          ENDIF
          GOTO     EMRCHK99
.
          INC      EMRVISIO/INC
          INC      EMRLOCIO/INC
          INC       IBAOVRIO/INC
.
EMRCHK99  ENDPROC
.*****************************************************************************
.*  GETALTID
.*  Procedure to get an alternate ID
.*  Exit=0  No alternate ID
.*       1  Alternate ID's exist
.*****************************************************************************
          DEFPROC   GETALIDS
.
          INC       PMSAIDFD/INC
.
          MOVE      ZERO,EXIT
          PACK      KEY20,SP70
          OPEN      PMSAIDA1,"pmsaidaf"
.
          PACK      KEY31,PURNO,SP70
          CALL      RSPMAID1           * Read alternate id Table
GETALI10  CALL      RKPMAID1
          BRANCH    OVRCD,GETALI99
.
          MATCH     PURNO,PMAIURNO     * Check same UR
          GOTO      GETALI99 IF NOT EQUAL
.
          MATCH     "1",PMAIDISU
          GOTO      GETALI10 IF NOT EQUAL
.
          PACK      KEY20,PMAIALID,SP70
          MOVE      ONE,EXIT
          GOTO      GETALI99
.
          INC       PMSAIDIO/INC
          INC       IBAOVRIO/INC
.
GETALI99  CLOSE     PMSAIDA1
.
          ENDPROC
.**********************************************************************
.         Update Default Printer File for User
.**********************************************************************
UPDFPT00  MOVE      REPORTNO,F2
          MOVE      F2,KEY2
          REP       " 0",KEY2
          PACK      KEY20,PRGID,KEY2,WBSEUID,SP70
          UNPACK    KEY20,IBPDPID,IBPDREP,IBPDUID
          MOVE      SELPRINT,IBPDPRT
          MOVE      SP70,IBPDSPA
          CALL      RAIBPD1
          IF        OVRCD=0
            CALL      UPIBPD1
          ELSE
            CALL      WRIBPD1
          ENDIF
UPDFPT99  RETURN
.
.
PRTIPROV  RETURN
.==============================================================================
.
.****************************************************************************
.  SINVH000 - Set up invoice header for stationery templating
.****************************************************************************
SINVH000  OPEN      IBATMHA1,"ibatmhaf"
          OPEN      IBATDET1,"ibatmdaf"
.
          MOVE      PTCNPAIH,KEY6
          CALL      RDIBTH1                   * read header detail file
          BRANCH    OVRCD,SINVH900
.
          PACK      KEY12,PTCNPAIH,SP6        * position on details file
          CALL      RSIBDET1
          CALL      RKIBDET1
          BRANCH    OVRCD,SINVH900
.
          MATCH     PTCNPAIH,IBDTSCOD         * match stationery codes
          GOTO      SINVH950 IF EQUAL
.
.------ stationery code not on file ------
.
SINVH900  DISPLAY   *P1:24,*EL,*B:
                    "User Defined Stationery Code not on File. ";
          CALL      HITENTER
          MOVE      ONE,EXIT
          GOTO      SINVH999
.
SINVH950  MOVE      ZERO,EXIT
SINVH999  RETURN
+
.****************************************************************************
.  SINVT000 - Set up invoice tail for stationery templating
.****************************************************************************
SINVT000  OPEN      IBATMHA1,"ibatmhaf"
          OPEN      IBATDET1,"ibatmdaf"
.
          READ      CONTROLF,NINTY8;*136,PTCNPAIH,*142,PTCNPAIT
          MOVE      PTCNPAIT,KEY6
          CALL      RDIBTH1                   * read header detail file
          BRANCH    OVRCD,SINVT900
.
          PACK      KEY12,PTCNPAIT,SP6        * position on details file
          CALL      RSIBDET1
          CALL      RKIBDET1
          BRANCH    OVRCD,SINVT900
.
          MATCH     PTCNPAIT,IBDTSCOD         * match stationery codes
          GOTO      SINVT950 IF EQUAL
.
.------ stationery code not on file ------
.
SINVT900  DISPLAY   *P1:24,*EL,*B:
                    "User Defined Stationery Code not on File. ";
          CALL      HITENTER
          MOVE      ONE,EXIT
          GOTO      SINVT999
.
SINVT950  MOVE      ZERO,EXIT
SINVT999  RETURN
+
.******************************************************************************
.
          INC       STD001IO
          INC       STDHLPCD
          INC       STDKWSCD
          INC       CALCAGE
          INC       CLNZPPIC
          INC       PATINVS
          INC       PATINVHL                * templated invoice header
          INC       PATINVTL                * templated invoice tail
          INC       CALCDAYS
          INC       CLPATMAS           * for PATSRCH
          INC       CLPATINV
          INC       CLPMSABF
          INC       CHKCMXPT
          INC       CMXMATRX
          INC       IBAPRINT
          INC       IBAGSTKY
          INC       IBAGKIKY
          INC       NHOSPDAY
          INC       NZHISIIO           * for NZIBSRCH
          INC       NZIBSRCH           * for PATSRCH
          INC       PATCALFN
          INC       PATCATAI
          INC       PATCATBI
          INC       PATCOMN1
          INC       PATCOMN3
          INC       PRTINVBD
          INC       CMGETTHR
          INC       PATGNCMX
          INC       PATMCHRD
          INC       GETBFEES
          INC       GETTFEES
          INC       GETCNEFF
.
          INC       PATRECAL
          INC       PATSNDX
          INC       PATSNX2
          INC       PATTRRAT
          INC       STEPDOWN
          INC       PATCMSTP
          INC       PATHSPKY
          INC       CINVPEND
          INC       SEXDSP00
          INC       CHKCLDCP
.
          INC       PATITMRD
          INC       PATALWDS
          INC       PATCODDS
          INC       PATITMDS
          INC       PATWRDDS
          INC       PATIVMES
          INC       PABXBILL
          INC       CLPATDTR
          INC       CLPATDSC
          INC       CHNADMTP                * Change the admission type
          INC       PATGBCRN           * I-48227
          INC       CLPMSIDE
          INC       TFILENAM              * Generate Temp File Name
.
          INC       WEBERRIO/INC          * Web Server Error Logging
          INC       PMSABFIO/INC
          INC       PMSPWAIO/INC
          INC       PMSTLEIO/INC
          INC       PMSBIIIO/INC          * Bulk invoice print list
          INC       AAEDE1IO/INC
          INC       AAEDTRIO/INC
          INC       BOKRC1IO/INC
          INC       COMDEPIO/INC
          INC       EMRHISIO/INC
          INC       EMRVISIO/INC
          INC       IBAPDFIO/INC
          INC       IBAPRNIO/INC
          INC       IBAPOLIO/INC
          INC       IBAGSTIO/INC
          INC       IBAGEDIO/INC
          INC       IBATMDIO/INC
          INC       IBATMHIO/INC
.
          INC       MLTCFNIO/INC
          INC       NZPEXTIO/INC
          INC       NZPRDTIO/INC
          INC       NZPBFEIO/INC
          INC       NZPCFNIO/INC
          INC       NZPCMTIO/INC
          INC       NZPFIGIO/INC
          INC       NZPIBRIO/INC
          INC       NZPMCHIO/INC
          INC       NZPMXCIO/INC
          INC       NZPPFEIO/INC
          INC       NZPPICIO/INC
          INC       NZPRBRIO/INC
          INC       NZPRFNIO/INC
          INC       NZPFINIO/INC
          INC       NZPSPRIO/INC
          INC       NZPTFEIO/INC
          INC       NZPIVBIO/INC
          INC       NZPRVBIO/INC
          INC       OPRDEAIO/INC
          INC       OPRSESIO/INC
          INC       OUTBB1IO/INC
          INC       OUTBOAIO/INC
          INC       OUTCLIIO/INC
          INC       OUTDTRIO/INC
          INC       OUTPREIO/INC
          INC       OUTSITIO/INC
          INC       OPRARDIO/INC
.
          INC       PATINMIO/INC
          INC       PATCRAIO/INC
          INC       PATCMXIO/INC
          INC       PATDRGIO/INC
          INC       PATEDSIO/INC
          INC       PATJRNIO/INC
          INC       PATFEEIO/INC
          INC       PATFX1IO/INC
          INC       PATINLIO/INC
          INC       PATALWIO/INC
          INC       PATBFEIO/INC
          INC       PATCODIO/INC
          INC       PATDO1IO/INC
          INC       PATDSCIO/INC
          INC       PATDTRIO/INC
          INC       PATFACIO/INC
          INC       PATFINIO/INC
          INC       PATFIGIO/INC
          INC       PATFN1IO/INC
          INC       PATFN2IO/INC
          INC       PATGSRIO/INC
          INC       PATGTUIO/INC
          INC       PATICUIO/INC
          INC       PATIN1IO/INC
          INC       PATINVIO/INC
          INC       PATIPEIO/INC
          INC       PATIRNIO/INC
          INC       NZPIRNIO/INC
          INC       PATITMIO/INC
          INC       PATMA1IO/INC
          INC       PMSPX2IO/INC
          INC       PATMCHIO/INC
          INC       PATMI1IO/INC
          INC       PATPR1IO/INC
          INC       PATRCAIO/INC
          INC       PATRE1IO/INC
          INC       PATTFEIO/INC
          INC       PATTRNIO/INC
          INC       PATVENIO/INC
          INC       PATVISIO/INC
          INC       PATWC1IO/INC
          INC       PATWMAIO/INC
          INC       PATWR1IO/INC
          INC       PATWVEIO/INC
          INC       NHIMASIO/INC       * for PATSRCH
          INC       PATDNRIO/INC
          INC       PATSDNIO/INC
          INC       PATSMWIO/INC
          INC       PATNIDIO/INC
          INC       PATALRIO/INC
.
          INC       PATONHIO/INC
          INC       PATELGIO/INC
          INC       PATCURIO/INC
          INC       PATCFAIO/INC
          INC       PMSCIDIO/INC
          INC       PMSCCDIO/INC
          INC       PATSGCIO/INC
          INC       PATMMBIO/INC
          INC       PATECHIO/INC
          INC       PATEDTIO/INC
          INC       OPRDECIO/INC
          INC       OPRSRGIO/INC
          INC       PATECDIO/INC
.
          INC       PATRATIO/INC
          INC       PATICDIO/INC  
          INC       PATAFEIO/INC       * for casemix
          INC       PATASDIO/INC
          INC       PATCTFIO/INC
          INC       PATDGWIO/INC
          INC       PATECOIO/INC
          INC       PATFMOIO/INC
          INC       PATIBLIO/INC
          INC       PATIOVIO/INC
          INC       PATHSPIO/INC
          INC       PATHDFIO/INC
          INC       PATHLFIO/INC
          INC       PATHTRIO/INC
          INC       PATIPRIO/INC
          INC       PATLDFIO/INC
          INC       PATLSDIO/INC
          INC       PMSMTIIO/INC
          INC       PMSFCIIO/INC
          INC       PATCMTIO/INC
          INC       PMSCNOIO/INC
          INC       PATPGRIO/INC
          INC       PATOVBIO/INC
          INC       PATREMIO/INC
          INC       PATRBLIO/INC
          INC       PATRFNIO/INC
          INC       PATRFGIO/INC
          INC       PATSRBIO/INC
          INC       PMSHATIO/INC
          INC       PMSHCPIO/INC
          INC       PMSEVTIO/INC
          INC       PMSBLIIO/INC          * Bulk invoice selection
          INC       PMSSINIO/INC
          INC       PMSSGAIO/INC
          INC       PMSCMTIO/INC
          INC       PMSECTIO/INC
          INC       PMSMPRIO/INC
          INC       PMSVX1IO/INC
          INC       PMSPRGIO/INC
          INC       VISPAYIO/INC
          INC       PMSPYRIO/INC
          INC       PMSPBRIO/INC
          INC       PMSIDEIO/INC
          INC       PMSIVBIO/INC
          INC       PMSEXTIO/INC
          INC       WEBIHCIO/INC
.
          INC       RCPBNKIO/INC
          INC       RCPBDTIO/INC
          INC       RCPDTEIO/INC
          INC       RCPCRSIO/INC
          INC       WEBSCHIO/INC
          INC       PMSEDGIO/INC       * Effective DRG Date
          INC       PATDDHIO/INC
          INC       RSHWEBCD
          INC       CHKSUGCL
          INC       KYPTBANK                 * Banking has started message
          INC       PATSTRYR
          INC       PATCKEXC
          INC       GETALTID
          INC       PMSOSDTM              * Outstanding Debt alert routine
          INC       VALCMXFN
          INC       GETEFDRG
+
