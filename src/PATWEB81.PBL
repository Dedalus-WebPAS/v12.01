.*******************************************************************************
. Program        : PATWEB81
.
. Function       : Patient Events
.
. Modifications  :
.*******************************************************************************
.V12.00.01 13/05/2025  Ebon Clements   TSK 0955096
.          Added alpanumeric visit number generation - NXTA0000 - GENANVIS
.V11.05.02 20.12.2024 DA Sarkies      TSK 0954547
.          Commented out <cat> tags to prevent browser incompatibility
.V11.05.01 26/11/2024  Ebon Clements  TSK 0954547
.          Added <cat-c> start and end tag to category=XX tag
.V11.02.03 19/05/2022 J.Tan           TSK 0837128
.           Recompiled for PRFAINSR - to use Cat CL indic 24
.V11.02.02 28/04/2022 J.Tan           TSK 0837128
.          Mod Default PRFA based on Claim type (PRFAINSR)
.V11.02.01 10/02/2022  Thanh T        TSK 0905641
.          Recompiled as OUTMA1FD (PATMASTM) changes
.V11.00.01 09/12/2020  Thanh T        TSK 0872840
.          Added PMSCCDFD/PMSCCDIO as PMSPX2TM changes
.V11.00.02 22/04/2020  Ebon Clements    TSK 0850105 
.          Clear PMCUTSTA and PMCUTLOC before write to pmscuraf
.V11.00.01 02/04/2020  J.Tan             TSK 0868813
.          Changed PKNAME to DIM80
.V10.14.01 04/07/2019  Nicole Torrisi TSK 0862107
.          Added HOSPFLAG for enquiry view         
.*******************************************************************************
.V10.11.03 30/07/2017  Thanh T.       TSK 0821710
.          Audit admission/outpatient/UR comments. changed PATMASTM/PMSPX2TM.
.V10.11.02 26/07/2017  Thanh T.       TSK 0821710
.          Recompiled PASMISTM
.V10.11.01 14/07/2017  Thanh T.       TSK 0821710
.          Audit Amission/outpatient visit comments. PATMISTM changed.
.*******************************************************************************
.V10.10.01 29/06/2017  Richa Phogat   TSK 0841179
.          Removed code setting FMTSNAME from CLSTAB00. It is done in PATLN000
.V10.08.01 18/11/2016  Peter Vela     TSK 0827671
.          Added single space after Parent of <Initial>.
.          before write to patre1af
.V10.04.02 07/04/2014  Peter Vela      CAR 286258
.          Recompiled for PATMASTM
.V10.04.01 31.03.2014  B.G.Ackland  CAR 299363
.          Replace META Tag Redirect with Javascript in Common RDIREC00
.          Routine
.*******************************************************************************
.V10.03.07 19/08/2013  Ebon Clements   CAR 281767
.          Removed discharge date test from redirect test - VRED0000 
.V10.03.06 24/05/2013  Ebon Clements   CAR 281767
.          Added redirect to AH referral after discharging an event - VRED0000
.V10.03.05 19/03/2013  Jill Parkinson CAR 282814
.          Recompiled for PATMASTM - Disability alert DSAL0000 change
.V10.03.04 25/02/2013 Ania P           CAR 281021
.          Removed unnecessary modification of constants.
.V10.03.03 16/01/2012  Sandra Barcham  CAR 256563
.          Recompiled for PATMASTM
.V10.03.02 01/12/2011  Mike Laming     CAR 250985
.          Added MultiDatabase to DEAPOL00 (DEATHPOL), added variables etc to
.          this for DEATHPOL.PBL
.V10.03.01 15/11/2011  Mike Laming     CAR 240184
.          Changes to IBAPOSTF Post Code table - added State to Keys
.V10.02.04 11/10/2011  Mark Coupland   CAR 252429
.          Recompiled for PMSPX2TM and PATMASTM
.V10.02.03 13/09/2011 Jill Parkinson   CAR 248652
.          Recompiled for PMSPX2TM - Added read of pmsvx1af in GETCURIP
.V10.02.02 22/06/2011  Steve Armstrong CAR 240722
.          Mods to cater for changes to PATLOCFD.
.               - LSNAME & LGNAME extended to 40 chars.
.               - PTLCGNM2 added.
.          Mods to cater for changes to PMSCURFD:
.               - PMCUSURN & PMCUGNAM extended to 40 chars.
.               - PMCUGNM2 added.
.V10.02.01  23/06/2011  Peter McMullen    CAR 240725
.           Change ward selection list to sort by name, not code
.*******************************************************************************
.V10.01.01  19/11/2010  Steve Armstrong   CAR 234061
.           Recompiled for changes to PMSNUTFD.
.           Changed CALL's to PMSNUTIO.
.*****************************************************************************
.V10.00.01  08/04/2010  Davin         CAR 219426
.           Changed event type description from 12 to 20 chars (eventdis)
.*******************************************************************************
. V9.12.02  02/09/2009  Ebon Clements CAR 205142
.           Added new tags for PMEVCTYP,PMEVCLID and PMEVSITE
. V9.12.01  26/06/2009  Peter Vela    CAR 199733
.           Added default vaules to inpatient and outpatient booking events
.           PATEVT00 PEVT0000
. V9.11.01  29/04/2009  Jill Habasque CAR 193525
.           Mods for booked events - uses booking number as event number
. V9.10.01  10/09/2008  Peter Vela    CAR 177468
.           Recompiled for PMSNUTTM
. V9.09.03  30/10/2007  J.Tan         CAR 150350
.           Fixed to initialise CLAIMTYP
. V9.09.02  17/10/2007  J.Tan         CAR 150350
.           Mods emergency event to write PRFA record
. V9.09.01  28/05/2007  Peter Vela    CAR 142173
.           Added Emergency event EVTT0000
. V9.08.01  31/01/2007  Peter Vela    CAR 127930
.           Recompled for MRTCONFD
. V9.07.01  06/09/2006  Jill Habasque CAR 109852
.           Mods to check PTCNDAUR before outputting UR           
. V9.06.01  08/05/2006  Ebon Clements CAR 104070
.           Added multi hospital edit checks to patient events
. V9.05.02  03/04/2006  Ebon Clements CAR 78527
.           Added hospital to current patients
. V9.05.01  09/03/2006  Ebon Clements CAR 78533
.           Mods for PATCODTM - Hospital specific category codes
. V9.05.B01 30/01/2006  Ebon Clements CAR 93186
.           Mods for REDIRECT length change. Recompiled for IBAWEBDF
. V9.04.07  10/10/2005  Ebon Clements CAR 79195
.           Added new tag for outpatient visit types - PEVT3000
.           29/09/2005  Peter Vela    CAR 75636
.           Fixed tag for Clinic Type PEVT1200
.           Fixed tag for Clinic Type selection field PEVT2300
. V9.04.06  26/09/2005  Ebon Clements CAR 56868
.           Recompiled for web user id in DEATHPOL
. V9.04.05  29/04/2005  Peter Vela       CAR 55214
.           Recompiled for MRTCONFD
. V9.04.04  01/03/2005  Peter Vela    CAR 57547
.           Recompiled for PATVADFD and PATVADIO
. V9.04.03  13/01/2005 Guomin Fu  CAR 55191
.           Added call of ADDVIS00 from MRTVISCD to do linking events to MR 
.           the same as how it is done in PATWEB89          
. V9.04.02  08/10/2004 Jill Habasque CAR 53819
.           Added update of pmvxmhos
. V9.04.01  21/09/2004 Jill Habasque CAR 53553
.           Added check for multi hospital in ward selection list
. V9.03.05  07/06/2004 Peter Vela CAR 49016
.           2004 Statutory Changes - recompiled for PMSPX2TM
. V9.03.04  26/03/2004 Peter Vela    CAR 13038
.           Recompiled for PATDOCCD - Doctor Name format Parameter
. V9.03.03  18/12/2003 Peter Vela    CAR 43134
.           Recompiled for MRTCONFD
. V9.03.02  11/12/2003 Peter Vela    CAR 40355
.           Recompiled for PATNAMCD
.           15/12/2003 Ebon Clements CAR 45481
.           Mods for PMSCURFD file change - added outpatient site
. V9.03.01  26/05/2003 Lina Vo       CAR 37504
.           Write SLA/ASGC code from ibapostf to visit extension table for 
.           patient events.           
.           Fixed Change & Delete events to also update & delete from visit
.           extension file.
.******************************************************************************
. V9.02.35  14/03/2003 Tracey Nguyen SRF 34880
.           Call PATFLD00 to display the correct colour for the patient folder.
.           Note: A call to PATFLD00 returns KEY3 which contains the folder
.                 colour code.
.           11/03/2003 J.Tan
.           Recompiled for PATMISTM - admitting point
. V9.02.34  07/02/2003 Tonii CAR 35992
.           Recompiled for PATMISTM - inactive codes in patfundf
. V9.02.33  27.01.2003 Ebon Clements SRF 33639
.           Changed CLSTAB00 to display patient events in ward/bed/admission
.           number order.
. V9.02.32  08/01/2003  Peter Vela    SRF 23145
.           Recompiled for PATMASTM - added menutype for Current Event Patient
. V9.02.31  05/12/2002  Lina Vo       SRF 22709
.           Added OPNOUT00 in INIT0000                            
. V9.02.30  09/11/2002  Ebon Clements SRF 23307
.           Added a clear of patlocaf variables before the write
. V9.02.29  09/10/2002  Peter Vela    SRF 17693
.           Recompiled for PATMISTM - Admitting Point
. V9.02.28  26/09/2002  Ebon Clements SRF 17418
.           Added an option to delete inpatient and outpatient events 
. V9.02.27  23/07/2002  J.Tan
.           Recompiled for PATMISTM - added patasfaf file
. V9.02.26  06/07/2002  Jill Habasque SRF 19273           
.           Added given name and UR to current patients       
. V9.02.25  29/06/2002  Ebon Clements SRF 19105            
.           Recompiled for sigpipe trap   
. V9.02.24  24/06/2002  Tonii SVHM Transition II Extract 7
.           Changed format of read and write of cciex7af (****)
. V9.02.23  31/05/2002  Ebon Clements 18229
.           Added trap if sigpipe
. V9.02.22  14/05/2002  J.Tan
.           Recompiled for PATMISTM - added casemix code
. V9.02.21  02/05/2002 Jill Habasque 
.           Added pmsnutaf fields                                
. V9.02.20  26/04/2002 Jill Habasque 3607               
.           Added check for PMEVDDTE in WRCPAT00                 
. V9.02.19  24/04/2002 Ebon Clements                    
.           Added a clear of DOCFNAME in the event list PEVTDS00
. V9.02.18  10/04/2002 Tonii  SVHM Transition II
.           Fixed I*D error when writing to cciex7af table
. V9.02.17  05/04/2002 Ebon Clements 
.           Added update of PVIDATE when the event is updated
.           05/04/2002 Tonii  SVHM Transition II
.           Made to write status of 9 for OP events not 2           
. V9.02.16  02/04/2002 Tonii  SVHM Transition II
.           Made sure the cciex7af table is written to when an event is updated
. V9.02.15  22/03/2002 Jill Habasque 3464
.           Fixed current patient write
.           22/03/2002 Tonii  SVHM Transition II
.           Added write to extract 7 table when an event is entered
. V9.02.14  14/03/2002 Jill Habasque 3342
.           Added output of condicon for current event list
. V9.02.13  12/03/2002 Jill Habasque 3400
.           Added DEADST00 - Check if discharged deceased
. V9.02.12  06/03/2002 Jill Habasque 3139
.           Added VISPHONE (output of visitors, phone calls and ambulatory stat)
. V9.02.11  16/01/2002 Jill Habasque
.           Changed event to use category EV                 
. V9.02.10  24/12/2001 Jill Habasque
.           Fixed display of Category A and S selection lists
. V9.02.09  21/12/2001 Jill Habasque
.           Added write to current patient table
. V9.02.08  12/12/2001 Jill Habasque
.           Added move of PPOST to PMVXPOST
. V9.02.07  04/12/2001 Katie Nelson/Harvinder   SRF 648628(nz)
.           Recompiled for NHI tags added to PATMASTM
. V9.02.06  29.11.2001 Raghunandan Surve - HPS 
.           Changed to read events backwards
. V9.02.05  28.11.2001 Raghunandan Surve - HPS 
.           Changed to display Clinic ID and description
. V9.02.04  22.11.2001  Glenn Saunders                                  
.           Fix patient condition and diet boxes to be in line with Ward Bed.
. V9.02.03  21.11.2001  Jill Habasque                                   
.           Added Ward and Bed for inpatient events
. V9.02.02  20.11.2001  B.G.Ackland                                     
.           Remove pi's from Program
. V9.02.01  17.10.2001 Raghu Surve 
.           Added Clinic Type for Outpatients Register Event screen-HPS
. V9.01.04  19.08.2001 Jill Habasque
.           Modified to write type "9" to patvisaf.  
.           Added write to pmsvx1af.
.           Fixed visit date to be store on patvisaf.
. V9.01.03  17.08.2001 Jagath HPS
.           Modified patvadaf to patdadaf
. V9.01.02  16.08.2001 J.Tan
.           Recompiled for PATMASTM
. V9.00.01  14.08.2001 J.Tan
.           Recompiled for PATMASTM
. V9.00.003 13.08.2001 HPS
.           Modified for Location filtering
. V9.00.002 12.08.2001 HPS
.            Modified for Current Event List
. V9.00.001 03.08.2001 HPS-ODC 
.           Modified for Current Event List
. V9.00.B06 13.07.2001 Sandra Barcham
.           Replace GP with HCP
. V9.00.B05 25.06.2001 HPS
.           Modified for event display
. V9.00.B04 21.06.2001 B.G.Ackland
.           Made changes to event display
. V9.00.B03 14.06.2001 B.G.Ackland
.           Recompile for Changes to PATMASTM
. V9.00.B02 12/06/2001 Ebon Clements 
.           Fix cgi UPDTTYPE match in PATEVT00               
.           Fix Date output for HTML tag               
. V9.00.B01 20/05/2001 HPS 
.           Created Program 
.*******************************************************************************.*                              Include Files                                  *
.*******************************************************************************
          INC       IBAWEBDF
.
          INC       ALLCONFD/INC
          INC       ALLREFFD/INC
          INC       MULTVISV/INC        * PATDPATH variables          *I-250985
          INC       PATDPTHV/INC        * PATDPATH variables          *I-250985
.
          INC       APSMASFD/INC            * Control file    
          INC       IBAPOSFD/INC
          INC       BOKRC1FD/INC
          INC       BOKRX1FD/INC
          INC       MRTCONFD/INC
          INC       MRTMASFD/INC
          INC       MRTVISFD/INC
          INC       OUTBOAFD/INC
          INC       OUTCLIFD/INC
          INC       OUTCTYFD/INC
          INC       OUTPREFD/INC
          INC       OUTSITFD/INC
          INC       PATALRFD/INC                   
          INC       PATCALAG/INC
.
          INC       PMSCCDFD/INC   * Concession Card Details
          INC       PMSUCHFD/INC
          INC       PMSUCDFD/INC
          INC       PATMASTD/INC
          INC       PATCONFD/INC
          INC       PATDHEAD/INC          
          INC       PATDTHFD/INC          
          INC       PATDO1FD/INC        
          INC       AAEDTRFD/INC        
          INC       PATFN1FD/INC
          INC       PATHOSFD/INC                                      *I-250985
          INC       PATIN1FD/INC
          INC       PATMA1FD/INC
          INC       PATMI1FD/INC
          INC       PATPR1FD/INC
          INC       PATASFFD/INC
          INC       PATVISFD/INC          
          INC       PMSVX1FD/INC          
          INC       PMSCURFD/INC          
          INC       PATWR1FD/INC
          INC       PMSEVTFD/INC
          INC       PMSHCGFD/INC
          INC       PMSHCPFD/INC
          INC       PMSPX2FD/INC
          INC       PMSMTIFD/INC
          INC       PATCMCFD/INC
          INC       PATDGWFD/INC 
          INC       PATITMFD/INC
          INC       PATLOCFD/INC                      
          INC       PATRE1FD/INC
          INC       PATVADFD/INC            * Added by HPS-ODC(03.08.01) Ends 
          INC       PATDADFD/INC
          INC       PATHSPFD/INC
.
          INC       CCICONFD/INC
          INC       CCIEX7FD/INC
.
          INC       PMSHCGTD/INC
          INC       PMSHCPTD/INC
          INC       PMSPX2TD/INC                       
          INC       PMSNUTFD/INC            * V9.02.04
          INC       PMSNUTTD/INC            * V9.02.04
          INC       NHIMASFD/INC
          INC       NHIETHFD/INC
          INC       WEBDATDF
.                              
.*******************************************************************************
.*                          CGI Parameters                                     *
.*******************************************************************************
NEXTPAGE  DIM       1                       * Nextpage parameter CGI parameter
UPDTTYPE  DIM       1                       * Update Type
EVNTTYPE  DIM       3                       * Event Type
PSEVT001  DIM       3                       * Event Type (Cat EV)
PSEVT002  DIM       8                       * Admission/Attend. Date(ccyymmdd)
PSEVT003  DIM       8                       * Admission/Attend. Time (hh:mm:ss)
PSEVT004  DIM       10                      * Attending Consultant (pmshcpaf)
PSEVT005  DIM       60                      * Presenting Problem
PSEVT006  DIM       3                       * Unit (Cat AC)
PSEVT007  DIM       20                      * Staff Phone Number
PSEVT008  DIM       3                       * Patient Location (Cat LO)
PSEVT009  DIM       8                       * Discharge/Depart Date (ccyymmdd)
PSEVT010  DIM       8                       * Discharge/Depart Time (hh:mm:ss)
PSEVT011  DIM       8                       * Visit Num
PSEVT012  DIM       6                       * Site (outsitaf)
PSEVT013  DIM       6                       * Clinic Type (outctyaf)
PSEVT014  DIM       6                       * Clinic Id (outcliaf)
PSEVT015  DIM       3                       * Claim Code (Cat CL)
PSEVT016  DIM       3                       * Appointment Type (Cat CV)
PSEVT017  DIM       1                       * Attendance Status
PSEVT018  DIM       3                       * Admit Type (Cat A)
PSEVT019  DIM       3                       * Booking Type (Cat S)
PSEVT020  DIM       10                      * Referred By (pmshcpaf)
PSEVT021  DIM       3                       * Discharge/Depart Status (Cat DD)
PSEVT022  DIM       3                       * Patient Ward
PSEVT023  DIM       3                       * Patient Bed
LOCATION  DIM       3                       * Patient Location 
.
.*******************************************************************************
.*                          Program Variables                                  *
.*******************************************************************************
BOOKEDFL  FORM      1
CATZG     INIT      "zG"
CFILEPRE  DIM       3                       * site prefix
CONDICON  DIM       1
CLAIMTYP  DIM       1
CMDLINE   DIM       80                                                *I-250985
ENDATE    DIM       11                      * Date Variable
DIDATE    DIM       11                      * Date Variable
VISVALUE  FORM      1                       * Visit Number 
DIMTWO    DIM       2                       * Dummy Variable
DIM8      DIM       8
VISITNO   DIM       8                       * Visit Number
EVENTDIS  DIM       20                      * Event Discription 
FORM3     FORM      3         
FORM8     FORM      8         
DOCTCODE  DIM       10                      * Doctor Code
DTCODE    DIM       10                      * Doctor Code
DTNAME    DIM       25                      * Doctor Name
HOSPCODE  DIM       4                                                 *I-250985
HOSPFLAG  FORM      1
HOSPITAL  DIM       25                                                *I-250985
IMGSRC    DIM       20
TODAY     DIM       8
.
.                                           * Added by HPS-ODC(03.08.01)Starts 
PATLINK   DIM       127                     * Link To Update Patient Info
DIETLINK  DIM       127                     * Link To Patient Diet Info
CONLINK   DIM       127                     * Link To Condition Patient Info  
PLOCAT    DIM       20                      * Patient Location
EVTYPE    DIM       20                      * Event Type
UNIT      DIM       20                      * Unit 
CLCODE    DIM       20                      * Claim Code
APPTYPE   DIM       20                      * Appointment Type
ADMTYPE   DIM       20                      * Admission Type
BOKTYPE   DIM       20                      * Booking Type
PATDIET   DIM       20                      * Patient Diet 
CONDESC   DIM       20                      * Patient Condition Description
PATCONVA  DIM       1                       * Patient cond visitors allowed ?
PATCONPA  DIM       1                       * Patient cond phone calls allowed ?
PATCONAM  DIM       3                       * Patient cond ambulatory status
DISPDATE  DIM       13                      * Variable for Pat. Condition Date
ADMNO     DIM       8                       * Admissno Number
MBSDESC   DIM       40
WARDCODE  DIM       3
VISPHONE  DIM       32
LBRACKT   INIT      "["
RBRACKT   INIT      "]"
.                                           * Added by HPS-ODC(03.08.01)Ends   
CODEAM    INIT      "AM"                    * Category for Ambulatory status
.
.*******************************************************************************
.*                             Save Variables                                  *
.*******************************************************************************
SVEVADTE  DIM       8          * Admit Date
SVEVATIM  DIM       8          * Admit Time
SVEVUNIT  DIM       4          * Admit Department
SVEVCLID  DIM       6          * Clinic Type
SVEVBTYP  DIM       4          * Referral source
SVEVDDTE	 DIM       8          * Discharge Date
SVEVDTIM  DIM       8          * Discharge Time
SVEVCCOD  DIM       5          * Primary payor
SVEVACON  DIM       10         * Admit MD
SVEVREFB  DIM       10         * Referring MD
.
TMBKEVIN  DIM       1
TMADMTYP  DIM       3
TMREFSRC  DIM       3
TMEXPWRD  DIM       3
TMEXPBED  DIM       3
TMCONSUL  DIM       6
TMUNTDEP  DIM       3
TMCLMTYP  DIM       3
.
.******************************************************************************
PRGID     INIT      "PATWEB81"
VERSION   INIT      "V12.01.00"
PRGNAM    INIT      "Patient Events Server"
.******************************************************************************
          CALL      WEBINT00                * Initialise FIFO     
          CALL      INIT0000                * Open Files
.
MAIN1000  CALL      WEBRED00                * Read FIFO WEBPID and USERID
. 
          COMPARE   "999",REPORTNO          * ReadSvrProcess onreport Option999
          GOTO      MAIN9999 IF EQUAL    
          BRANCH    REPORTNO,MAIN1100,MAIN1200
          PACK      WEBTITLE,PRGID,SP1,VERSION,SP1,PRGNAM,SP70
          MOVE      "Invalid Option",WEBTITLE
          CALL      WEBERR00                * Create Output&Write HTMLFileHeader
          GOTO      MAIN1000
.
MAIN1100  CALL      PATEVT00                * For Register Event         
          BRANCH    EXIT,MAIN1000
          MOVE      "Update Complete",WEBTITLE
          CALL      NXTPAG00
          GOTO      MAIN1000 
.
MAIN1200  CALL      CURPER00
          CALL      CALCDT00
          CALL      PATLIS00                * For Current Event List     
          GOTO      MAIN1000 
.
MAIN9999  MOVE      "SEVER SHUTDOWN COMPLETE",WEBTITLE
          CALL      WEBERR00
          STOP
.*******************************************************************************
.*                  Output Next Page Based on CGI Parameter nextpage           *
.*******************************************************************************
NXTPAG00  MOVE      ZERO,F1
          MOVE      NEXTPAGE,F1
          BRANCH    F1,NXTPAG10,NXTPAG20,NXTPAG30,NXTPAG40
.
          CALL      WINCLS00
          GOTO      NXTPAG99
.
NXTPAG10  CALL      RDIREC00                * Redirect Parent Conten Page
          GOTO      NXTPAG99
.
NXTPAG20  CALL      GOBACK00                * Go Back 1 Html page
          GOTO      NXTPAG99
.
NXTPAG30  CALL      DAH20000                * Go Back 2 html pages 
          GOTO      NXTPAG99
.
NXTPAG40  CALL      PREDIR00                * Parent redirect
          GOTO      NXTPAG99
.
NXTPAG99  RETURN
.*******************************************************************************
.*                            Goes back One page                               *
.*******************************************************************************
GOBACK00  CALL      OPENHTML
          BRANCH    EXIT,GOBACK99
          WRITE     HTMLFILE;"<script type=#"text/javascript#"> {":
                             "    alert(#"",WEBTITLE,"#");":
                             "    self.close();":
                             "    opener.history.go(-1);": 
                             "}":
                             "</script>";
          CALL      CLOSHTML
GOBACK99  RETURN
.
.------------------------------------------------------------------------------
.  Redirect Parent URL
.------------------------------------------------------------------------------
PREDIR00  CALL      OPENHTML
          BRANCH    EXIT,PREDIR90
.
          WRITE     HTMLFILE;"<script type=#"text/javascript#"> {":
                             " parent.location.href=#"",REDIRECT,"#";":
                             "}":
                             "</script>"
          CALL      CLOSHTML
          GOTO      PREDIR99
.
PREDIR90  DISPLAY   "*** Fifo Not Found ***"
.
PREDIR99  RETURN
.
.*******************************************************************************
.*                       Open Files and Initialise variables                   *
.*******************************************************************************
INIT0000  CALL      INTMAS00
          OPEN      ALLREFA2,"allrefaf"
          OPEN      IBAPOST1,"ibapostf"
          OPEN      BOKRC1A1,"bokrc1af"
          OPEN      BOKRX1A1,"bokrx1af"
          OPEN      PATDTHA1,"patdthaf"
          OPEN      PATMA1A1,"patma1af"
          OPEN      PMSPX2A1,"pmspx2af"
          OPEN      PATVISA1,"patvisaf"
          OPEN      PMSVX1A1,"pmsvx1af"
          OPEN      PMSCURA1,"pmscuraf"
          OPEN      MRTVISA1,"mrtvisaf"
          OPEN      MRTMASA3,"mrtmasaf"
          OPEN      MRTMASA2,"mrtmasaf"
          OPEN      PMSEVTA1,"pmsevtaf"
          OPEN      PMSEVTA5,"pmsevtaf"
          OPEN      PATCODE1,"patcodes"
          OPEN      PATCODE2,"patcodes"
          OPEN      PATVISA2,"patvisaf"
          OPEN      PATWR1A7,"patwr1af"
          OPEN      PMSEVTA2,"pmsevtaf" 
          OPEN      PMSEVTA3,"pmsevtaf" 
.                                           * Added by HPS-ODC(03.08.01)Starts 
          OPEN      PMSHCPA1,"pmshcpaf"
          OPEN      PATLOCA1,"patlocaf"
          OPEN      PATRE1A1,"patre1af"           
          OPEN      PATVADA1,"patvadaf"
          OPEN      PATVADA2,"patvadaf"
          OPEN      PATDADA1,"patdadaf"
          OPEN      PATITEM1,"patitemn"
          OPEN      PATITEM2,"patitemn"
          OPEN      PATITEM3,"patitemn"
          OPEN      PATHSPA1,"pathspaf"
          OPEN      PATIN1A1,"patin1af"
                                            * Added by HPS-ODC(03.08.01)Ends
          OPEN      PMSNUTA1,"pmsnutaf"     * new nutrition file v9.02.04
.
          MOVE      "out",CFILEPRE
          CALL      OPNOUT00
.
.*******************************************************************************
.                    Read the Control File Variables                           *
.*******************************************************************************
          OPEN      CONTROLF,"controlf"
          READ      CONTROLF,SIXTY;*84,MRCNHLOC,MRCNRCTY,MRCNVOLM
          READ      CONTROLF,SEVENTY1;*200,CCCNSVHM
          MOVE      " 1",DIMTWO
          MOVE      SP70,DTNAME
          READ      CONTROLF,ZERO;*43,IBCNMHOS
          READ      CONTROLF,TEN3;*188,CMABINS,*194,CVETINS
          READ      CONTROLF,TWENTY;*52,PTPCLRES
          READ      CONTROLF,TWENTY1;*237,PTCNPAOF,*238,PTCNAGEC
          READ      CONTROLF,EIGHTY;*250,PTCNHDPS
          READ      CONTROLF,HUND05;*210,PTCNLCLM
          READ      CONTROLF,HUND06;*225,ALCNDEVP
.
          IF        IBCNMHOS=1
            OPEN      MLTCODA1,"mltcodaf"
            OPEN      MLTCODA2,"mltcodaf"
          ENDIF
.
INIT9999  RETURN
.*******************************************************************************
.                    Open outpatient files                                     *
.*******************************************************************************
OPNOUT00  PACK      CFNAME,CFILEPRE,FILCTYA1
          OPEN      OUTCTYA1,CFNAME    
.
          PACK      CFNAME,CFILEPRE,FILCTYA2
          OPEN      OUTCTYA2,CFNAME
.
          PACK      CFNAME,CFILEPRE,FILCLIA1
          OPEN      OUTCLIA1,CFNAME    
.
          PACK      CFNAME,CFILEPRE,FILBOKA1
          OPEN      OUTBOKA1,CFNAME    
.
OPNOUT99  RETURN
.*******************************************************************************
.                           Clear Parameters                                   *
.*******************************************************************************
CLRPAR00  MOVE      ZERO,REPORTNO
          MOVE      SP70,TEMPLATE
          MOVE      SP70,UPDTTYPE
          MOVE      SP70,NEXTPAGE
          PACK      REDIRECT,SP70,SP70,SP70,SP70
          MOVE      SP70,EVNTTYPE
          MOVE      ZERO,BOOKEDFL
          MOVE      ZERO,HOSPFLAG
.
          MOVE      SP70,PSEVT001
          MOVE      SP70,PSEVT002
          MOVE      SP70,PSEVT003
          MOVE      SP70,PSEVT004
          MOVE      SP70,PSEVT005
          MOVE      SP70,PSEVT006
          MOVE      SP70,PSEVT007
          MOVE      SP70,PSEVT008
          MOVE      SP70,PSEVT009
          MOVE      SP70,PSEVT010
          MOVE      SP70,PSEVT011
          MOVE      SP70,PSEVT012
          MOVE      SP70,PSEVT013
          MOVE      SP70,PSEVT014
          MOVE      SP70,PSEVT015
          MOVE      SP70,PSEVT016
          MOVE      SP70,PSEVT017
          MOVE      SP70,PSEVT018
          MOVE      SP70,PSEVT019
          MOVE      SP70,PSEVT020
          MOVE      SP70,PSEVT021
          MOVE      SP70,PSEVT022
          MOVE      SP70,PSEVT023
          MOVE      SP70,ADMISSNO
          MOVE      SP70,LOCATION           * Added by HPS-ODC(03.08.01)      
          MOVE      SP70,WARDCODE
          MOVE      SP70,PATCONVA           * Added v9.02.04
          MOVE      SP70,PATCONPA
          MOVE      SP70,PATCONAM
          MOVE      ZERO,VIEWTYPE
          MOVE      SP70,FRSTDATE
          MOVE      SP70,LASTDATE
          MOVE      SP70,VYEARMTH
          CALL      CLPNUT00                * Clear Nutrition CGIs v9.02.04
.
CLRPAR99  RETURN
.*******************************************************************************
.*                           Set Parameters                                    *
.*******************************************************************************
SETPAR00  MATCH     "reportno=",QRYNAME
          IF        @EQUAL
            MOVE      QRYDATA,REPORTNO
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "template=",QRYNAME
          IF        @EQUAL
            MOVE      QRYDATA,TEMPLATE
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "updttype=",QRYNAME
          IF        @EQUAL
            MOVE      QRYDATA,UPDTTYPE
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "urnumber=",QRYNAME
          IF        @EQUAL
            MOVE      QRYDATA,URNUMBER
            REP       "+ ",URNUMBER
            MOVE      URNUMBER,PURNO
            GOTO      SETPAR99
          ENDIF
.                    
          MATCH     "nextpage=",QRYNAME
          IF        @EQUAL
            MOVE      QRYDATA,NEXTPAGE
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "bookedfl=",QRYNAME
          IF        @EQUAL
            MOVE      QRYDATA,BOOKEDFL
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "hospflag=",QRYNAME
          IF        @EQUAL
            MOVE      QRYDATA,HOSPFLAG
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "wardcode=",QRYNAME
          IF        @EQUAL
            MOVE      QRYDATA,WARDCODE
            PACK      WARDCODE,WARDCODE,SP70
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "redirect=",QRYNAME
          IF        @EQUAL
            MOVE      QRYDATA,REDIRECT
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "evnttype=",QRYNAME
          IF        @EQUAL
            MOVE      QRYDATA,EVNTTYPE
            GOTO      SETPAR99
          ENDIF
.          
          MATCH     "psevt",QRYNAME
          IF        @EQUAL
           CALL       PVNT0000
           GOTO       SETPAR99
          ENDIF
.          
          MATCH     "admissno=",QRYNAME
          IF        @EQUAL
            MOVE      QRYDATA,ADMISSNO
            GOTO      SETPAR99
          ENDIF
.                                           * Added by HPS-ODC(03.08.01)Starts
           MATCH     "location=",QRYNAME            
          IF        @EQUAL          
            MOVE      QRYDATA,LOCATION
            GOTO      SETPAR99
          ENDIF
.                                           * Added by HPS-ODC(03.08.01)Ends 
          MATCH     "pmnut",QRYNAME
          IF        @EQUAL
            CALL      SPNUT000
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "patconva=",QRYNAME
          IF        @EQUAL
            MOVE      QRYDATA,PATCONVA
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "patconpa=",QRYNAME
          IF        @EQUAL
            MOVE      QRYDATA,PATCONPA
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "patconam=",QRYNAME
          IF        @EQUAL
            MOVE      QRYDATA,PATCONAM
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "viewtype=",QRYNAME
          IF        @EQUAL
            MOVE      QRYDATA,VIEWTYPE
          ENDIF
.
          MATCH     "frstdate=",QRYNAME
          IF        @EQUAL
            MOVE      QRYDATA,FRSTDATE
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "lastdate=",QRYNAME
          IF        @EQUAL
            MOVE      QRYDATA,LASTDATE
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "vyearmth=",QRYNAME
          IF        @EQUAL
            MOVE      QRYDATA,VYEARMTH
            GOTO      SETPAR99
          ENDIF
.
SETPAR99  RETURN
.*******************************************************************************
.*            Save Cgi Parameters For Register Patient Events                  *
.*******************************************************************************
PVNT0000  MOVE      ZERO,EXIT
          MATCH     SP70,QRYDATA
          GOTO      PVNT9999 IF EQUAL
          GOTO      PVNT9999 IF EOS
          UNPACK    QRYNAME,KEY5,KEY3
          MOVE      KEY3,F3
          BRANCH    F3,PVNT0100,PVNT0200,PVNT0300,PVNT0400,PVNT0500:
                       PVNT0600,PVNT0700,PVNT0800,PVNT0900,PVNT1000:
                       PVNT1100,PVNT1200,PVNT1300,PVNT1400,PVNT1500:
                       PVNT1600,PVNT1700,PVNT1800,PVNT1900,PVNT2000:
                       PVNT2100,PVNT2200,PVNT2300
.
          GOTO      PVNT9999
. 
PVNT0100  MOVE      QRYDATA,PSEVT001        * Event Type
          GOTO      PVNT9999
.
PVNT0200  MATCH     SP70,QRYDATA            * Admission/Addentance Date
          GOTO      PVNT9999 IF EQUAL
          GOTO      PVNT9999 IF EOS
          UNPACK    QRYDATA,CDAY,D1,MTHNAM3,D1,CCENT,CYEAR
          CALL      SETMTH00
          PACK      PSEVT002,CCENT,CYEAR,CMON,CDAY
          REP       " 0",PSEVT002
          GOTO      PVNT9999
.
PVNT0300  MOVE      QRYDATA,PSEVT003        * Admission/Addentance Time  
          GOTO      PVNT9999        
.
PVNT0400  MOVE      QRYDATA,PSEVT004        * Attending HCP
          GOTO      PVNT9999
.
PVNT0500  MOVE      QRYDATA,PSEVT005        * Presenting Problem
          GOTO      PVNT9999
.
PVNT0600  MOVE      QRYDATA,PSEVT006        * Unit
          GOTO      PVNT9999
.
PVNT0700  MOVE      QRYDATA,PSEVT007        * Staff Phone Number 
          GOTO      PVNT9999
.
PVNT0800  MOVE      QRYDATA,PSEVT008        * Patient Location 
          GOTO      PVNT9999
.
PVNT0900  MATCH     SP70,QRYDATA            * Discharge/Departure Date 
          GOTO      PVNT9999 IF EQUAL
          GOTO      PVNT9999 IF EOS
.
          UNPACK    QRYDATA,CDAY,D1,MTHNAM3,D1,CCENT,CYEAR
          CALL      SETMTH00                
          PACK      PSEVT009,CCENT,CYEAR,CMON,CDAY
          REP       " 0",PSEVT009
          GOTO      PVNT9999
.
PVNT1000  MOVE      QRYDATA,PSEVT010        * Discharge/Departure Time 
          GOTO      PVNT9999
.
PVNT1100  MOVE      QRYDATA,PSEVT011        * Visit Number        
          GOTO      PVNT9999                
.
PVNT1200  MOVE      QRYDATA,PSEVT012        * Site
          GOTO      PVNT9999 
.
PVNT1300  MOVE      QRYDATA,PSEVT013        * Clinic Type 
          GOTO      PVNT9999
.
PVNT1400  MOVE      QRYDATA,PSEVT014        * Clinic ID
          GOTO      PVNT9999
.
PVNT1500  MOVE      QRYDATA,PSEVT015        * Claim Code
          GOTO      PVNT9999
.
PVNT1600  MOVE      QRYDATA,PSEVT016        * Appointment Type 
          GOTO      PVNT9999
.         
PVNT1700  MOVE      QRYDATA,PSEVT017        * Attendance Status 
          GOTO      PVNT9999
.          
PVNT1800  MOVE      QRYDATA,PSEVT018        * Admit Type     
          GOTO      PVNT9999 
.          
PVNT1900  MOVE      QRYDATA,PSEVT019        * Visit Number     
          GOTO      PVNT9999
.          
PVNT2000  MOVE      QRYDATA,PSEVT020        * Referred By 
          GOTO      PVNT9999
.
PVNT2100  MOVE      QRYDATA,PSEVT021        * Discharge/Departure Status  
          GOTO      PVNT9999
.
PVNT2200  MOVE      QRYDATA,PSEVT022        * Patient Ward
          GOTO      PVNT9999
.
PVNT2300  MOVE      QRYDATA,PSEVT023        * Patient Bed
          GOTO      PVNT9999
.
PVNT9999  RETURN
.*******************************************************************************
.*                  Main Action Routine For Register Event Table               *
.*******************************************************************************
PATEVT00  MATCH     SP70,UPDTTYPE
          GOTO      PATEVT60 IF EQUAL
.
          PACK      KEY8,URNUMBER,SP70
          CALL      RDMAST1
          BRANCH    OVRCD,PATEVT91
.
          PACK      KEY8,URNUMBER,SP70
          CALL      RDPMPX21
          BRANCH    OVRCD,PATEVT91
.
          MATCH     "A",UPDTTYPE            * Add                     
          GOTO      PATEVT10 IF EQUAL
.
          MATCH     "U",UPDTTYPE            * Update
          GOTO      PATEVT20 IF EQUAL         
.
          MATCH     "D",UPDTTYPE            * Delete
          GOTO      PATEVT40 IF EQUAL         
.
          GOTO      PATEVT95
.*******************************************************************************
.                    Add Formaction For Register Event Table                   *
.*******************************************************************************
PATEVT10  IF        IBCNMHOS=1
            MATCH    SP70,WBSEHOSP          * Check for user hospital id
            GOTO     PATEVT98 IF EQUAL
          ENDIF
.
          CALL      CLPMSVX1                * Clear visit extension file
          CALL      CLREVT00                * Clear event file
          IF        BOOKEDFL<>1
            CALL      NXTA0000                * Generate Next Admission Number 
          ENDIF
          CALL      VSVAL000                * Write Into Patient Visit File
          CALL      EVTSAV00                * Save Cgi variables
.          
          PACK      KEY8,ADMISSNO,SP70   
          CALL      RAPMEVT1
          IF        OVRCD=1
            CALL      WRPMEVT1                * Write away record Event file 
          ENDIF
.
          IF        BOOKEDFL=1
            PACK      KEY8,ADMISSNO,SP70
            CALL      RDBKREC1
            IF        OVRCD=0
              MOVE      "3",BKRESTAT
              CALL      UPBKREC1
            ENDIF
          ENDIF
.
          PACK      KEY8,ADMISSNO
          MOVE      ADMISSNO,DPVIBILL
          MOVE      URNUMBER,PVIURNO
          MOVE      SP70,PVIDOCT
          MOVE      SP70,PVISITE
          MOVE      SP70,PVIRESI
          MOVE      PPOST,PMVXPOST
          MOVE      "9",PVITYPE
          MOVE      DIMTWO,PVISYST
          MOVE      PMEVADTE,PVIDATE
          CALL      RAPTVIS1
          IF        OVRCD=1
            CALL      WRPTVIS1
          ENDIF
.
          MOVE      PPOST,D8
          SQUEEZE   D8
          MOVE      D8,F4
          MOVE      F4,D4
          REP       " 0",D4
          PACK      PPOST,D4,SP10
          PACK      KEY56,PPOST,PSUBRB,SP10,PADD4,SP70                *C-240184
          CALL      RDIBPOS1
          IF        OVRCD=0
            MOVE      IBPOASGC,PMVXASGC
          ELSE                                                        *I-240184
            PACK      KEY56,PPOST,PSUBRB,SP70
            CALL      RSIBPOS1
            CALL      RKIBPOS1 
            BRANCH    OVRCD,PATEVT11
            MATCH     PPOST,IBPOPCOD
            IF        @EQUAL
              MATCH     PSUBRB,IBPOSUBR
              IF        @EQUAL
                MOVE      IBPOASGC,PMVXASGC
              ENDIF
            ENDIF
          ENDIF
.
PATEVT11  MATCH     SP70,PMEVPWRD
          IF        !@EQUAL
            PACK      KEY6,PMEVPWRD,SP70
            CALL      RDWARD1
            IF        OVRCD<>1
              PACK      PMVXMHOS,PTWDHOSN,SP70
            ENDIF 
          ENDIF 
.
          IF        IBCNMHOS=1
            MATCH     SP70,PMVXMHOS
            IF        @EQUAL
              MOVE      WBSEHOSP,PMVXMHOS
            ENDIF
          ENDIF
.
          MOVE      PMEVADTE,PMVXVSDT
          MOVE      ADMISSNO,PMVXVISN
          PACK      KEY8,PMVXVISN
          CALL      RAPMVX11
          IF        OVRCD=1
            CALL      WRPMVX11
          ENDIF
.
          CALL      WRCPAT00                * Write the current patient record
.
          MOVE      PTMASNAM,LSNAME
          MOVE      PMPXFNAM,LGNAME
          MOVE      PMPXSNAM,PTLCGNM2
          MOVE      ADMISSNO,LADMNO
          MOVE      URNUMBER,LURNO
          MOVE      SP70,LPCONDC
          MOVE      SP70,LPCONDD
          MOVE      SP70,LPCDATE
          MOVE      SP70,LPCTIME
          MOVE      SP70,LPCONAM
.
          CALL      DEADST00                * Check for deceased indicators
.
          PACK      KEY88,LSNAME,LGNAME,LADMNO,SP70,SP70
          CALL      RDALOCA1
          IF        OVRCD=0
            GOTO      PATEVT93
          ELSE
            CALL      WRLOCA1               * Write Record into Location File
          ENDIF
.                                           * Added by HPS-ODC(03.08.01)Ends
.
.... D-55191
....      PACK      KEY17,URNUMBER,MRCNHLOC,MRCNRCTY,MRCNVOLM,SP70
....      CALL      RDMRMAS3                * Read from MRTMASAF (History Key)
.
....      PACK      KEY8,ADMISSNO
....      MOVE      ADMISSNO,MRVSVSNO
....      MOVE      MRMAKEY,MRVSMKEY
....      CALL      WRMRVS1                 * Write Into MRTVISAF
.... End D
          CALL      ADDVIS00                * I-55191
.
.-------- SVHM Transition II Extract 7, write a record to the CCIEX7AF table 
. 
          IF        PVITYPE = 9 
            MATCH     " 1",PVISYST
            IF        @EQUAL
              IF        CCCNSVHM = 1
                OPEN      CCIEX7A1,"cciex7af"
                MOVE      ANST,CLEXSTAT
                MOVE      PVITYPE,CLEXTYPE
                MOVE      ADMISSNO,CLEXVISN
.                       
                PACK      KEY11,CLEXSTAT,CLEXTYPE,CLEXVISN,SP10
                CALL      RDCLEX71
                IF        OVRCD = 1
.                       
. No record with status "T" has been written to cciexaf table, write one
.                       
                  CALL      WRCLEX71
                ENDIF
              ENDIF
            ENDIF
            CLOSE     CCIEX7A1
          ENDIF
.
          CALL      LCLM0000          * Get previous claim details if any
          CALL      FPRA0000          * Write a record to PRFA file
. 
          CALL      VRED0000          * Check for VINAH referral redirect
.
          MOVE      ZERO,EXIT
          GOTO      PATEVT99
.*******************************************************************************
.*                 Update Formaction For Register Event Table                  *
.*******************************************************************************
PATEVT20  REP       "+ ",ADMISSNO
          PACK      KEY8,ADMISSNO,SP70
          CALL      RDPMEVT1
          BRANCH    OVRCD,PATEVT90 
.
          CALL      SAVE0000             * Save original event details
          CALL      EVTSAV00
          CALL      UPPMEVT1
.
          PACK      KEY8,ADMISSNO,SP70
          CALL      RDPTVIS1
          BRANCH    OVRCD,PATEVT30
.
          MOVE      PMEVADTE,PVIDATE     * Update Visit Date from event file
          CALL      UPPTVIS1
.
          PACK      KEY8,ADMISSNO,SP70
          CALL      RDPMVX11
          BRANCH    OVRCD,PATEVT30
.
          MOVE      PPOST,D8
          SQUEEZE   D8
          MOVE      D8,F4
          MOVE      F4,D4
          REP       " 0",D4
          PACK      PPOST,D4,SP10
          PACK      KEY56,PPOST,PSUBRB,SP10,PADD4,SP70                *C-240184
          CALL      RDIBPOS1
          IF        OVRCD=0
            MOVE      IBPOASGC,PMVXASGC
          ELSE                                                        *I-240184
            PACK      KEY56,PPOST,PSUBRB,SP70
            CALL      RSIBPOS1
            CALL      RKIBPOS1
            BRANCH    OVRCD,PATEVT21
            MATCH     PPOST,IBPOPCOD
            IF        @EQUAL
              MATCH     PSUBRB,IBPOSUBR
              IF        @EQUAL
                MOVE      IBPOASGC,PMVXASGC
              ENDIF
            ENDIF
          ENDIF
.
PATEVT21  MOVE      PPOST,PMVXPOST
          MOVE      PMEVADTE,PMVXVSDT    * Update Visit Date from event file
          CALL      UPPMVX11
.
PATEVT30  IF        PVITYPE = 9 
            MATCH     " 1",PVISYST
            IF        @EQUAL
              IF        CCCNSVHM = 1
                OPEN      CCIEX7A1,"cciex7af"
                CALL      TRNSII00  
                CLOSE     CCIEX7A1
              ENDIF
            ENDIF
          ENDIF
.
          CALL      DEADST00                * Check for deceased indicators
.
          CALL      LCLM0000          * Get previous claim details if any
          CALL      FPRA0000          * Write a record to PRFA file
.
          CALL      VRED0000          * Check for VINAH referral redirect
.
          MOVE      ZERO,EXIT
          GOTO      PATEVT99 
.
.*******************************************************************************
.*                 Delete Formaction For Register Event Table                  *
.*******************************************************************************
PATEVT40  REP       "+ ",ADMISSNO
          PACK      KEY8,ADMISSNO,SP70
          CALL      RDPMEVT1
          BRANCH    OVRCD,PATEVT90
.
          PACK      KEY5,ANSE,ANSV,PMEVEVNT,SP70
          CALL      RDCODE1
          BRANCH    OVRCD,PATEVT97
.
.         If this is emergency event, check if item had been entered
.
          MATCH     ANSE,TCINDC1            * Can't delete an emergency event
          IF        @EQUAL
            CALL      CHKIT000              * Check aaedtr and pmsmtiaf file
            BRANCH    EXIT,PATEVT96
          ENDIF
.
          CALL      REVDST00                * Check for deceased indicators
          CALL      DEPMEVT1
.
          PACK      KEY8,ADMISSNO,SP70
          CALL      RDPMCUR1
          BRANCH    OVRCD,PATEVT42
.
          CALL      DEPMCUR1
.
PATEVT42  PACK      KEY8,ADMISSNO,SP70
          CALL      RDPTVIS1
          BRANCH    OVRCD,PATEVT44
.
          IF        PVITYPE = 9
            MATCH     " 1",PVISYST
            IF        @EQUAL
              IF        CCCNSVHM = 1
                OPEN      CCIEX7A1,"cciex7af"
                PACK      KEY11,ANST,NINE,ADMISSNO,SP10
                CALL      RDCLEX71
                IF        OVRCD = 0
                  CALL      DECLEX71
                ENDIF
.
                PACK      KEY11,ANSE,NINE,ADMISSNO,SP10
                CALL      RDCLEX71
                IF        OVRCD = 0
                  CALL      DECLEX71
                ENDIF
                CLOSE     CCIEX7A1
              ENDIF
            ENDIF
          ENDIF
.
          CALL      DEPTVIS1
.
PATEVT44  PACK      KEY8,ADMISSNO,SP70
          CALL      RDPMVX11
          BRANCH    OVRCD,PATEVT45
.
          CALL      DEPMVX11
.
PATEVT45  CALL      RDRESP1
          IF        OVRCD=0
            CALL      DERESP1
          ENDIF
.
          MOVE      ZERO,EXIT
          GOTO      PATEVT99
.
.*******************************************************************************
.         Display Formaction For Register Event Table                          *
.*******************************************************************************
PATEVT60  PACK      KEY8,ADMISSNO,SP70
          CALL      RDPMEVT1 
          IF        OVRCD=1
            CALL      CLREVT00              * Clears  all the file variables
            MOVE      SP70,LSNAME 
            MOVE      SP70,LGNAME  
            MOVE      SP70,PTLCGNM2  
            MOVE      SP70,DLADMNO 
            MOVE      SP70,LURNO   
            MOVE      SP70,LPCONDC 
            MOVE      SP70,LPCONDD 
            MOVE      SP70,LPCDATE 
            MOVE      SP70,LPCTIME 
            MOVE      SP70,LPCONAM 
          ENDIF
          MOVE      ZERO,OVRCD
.
          PACK      KEY8,URNUMBER,SP70
          CALL      RDMAST1
          BRANCH    OVRCD,PATEVT91
.
          MOVE      PURNO,KEY8
          CALL      RDPMPX21
          IF        OVRCD=1
            CALL      CLPMSPX2
          ENDIF
.
          MOVE      SP70,TMBKEVIN
          MOVE      SP70,TMADMTYP
          MOVE      SP70,TMREFSRC
          MOVE      SP70,TMEXPWRD
          MOVE      SP70,TMEXPBED
          MOVE      SP70,TMCONSUL
          MOVE      SP70,TMUNTDEP
          MOVE      SP70,TMCLMTYP
          PACK      KEY8,ADMISSNO,SP70
          CALL      RDBKREC1
          IF        OVRCD=0
            MOVE      ONE,TMBKEVIN
            MOVE      BKREATYP,TMADMTYP
            MOVE      BKREWARD,TMEXPWRD
            MOVE      BKREEBED,TMEXPBED
            MOVE      BKREADOC,TMCONSUL
            MOVE      BKREDEPT,TMUNTDEP
            MOVE      BKRECLMT,TMCLMTYP
.
            PACK      KEY8,ADMISSNO,SP70
            CALL      RDBKRX11
            IF        OVRCD=0
              MOVE      BKRXASRC,TMREFSRC
            ENDIF
.
          ENDIF
.
          MOVE      "Patient Events",WEBTITLE
          CALL      WEBHED00      *Create Output File & Write HTML Page Header
          BRANCH    EXIT,PATEVT99
          CALL      WEBBOD00                * Process Web Body (calls PROFLD00)
          CALL      WEBEND00                * Process End of HTML File
.
          MOVE      ONE,EXIT
          GOTO      PATEVT99
.
PATEVT90  MOVE      "Event Does Not Exist",WEBTITLE
          CALL      WEBERR00
          MOVE      ONE,EXIT
          GOTO      PATEVT99
.
PATEVT91  MOVE      "U/R Does Not Exist",WEBTITLE
          CALL      WEBERR00
          MOVE      ONE,EXIT
          GOTO      PATEVT99
.
PATEVT93  MOVE      "Record Already Exists",WEBTITLE
          CALL      WEBERR00
          MOVE      ONE,EXIT
          GOTO      PATEVT99
.
PATEVT95  MOVE      "Invalid Form Action.",WEBTITLE
          CALL      WEBERR00
          MOVE      ONE,EXIT
          GOTO      PATEVT99
.
PATEVT96  MOVE      "Can not delete an Emergency Event, Items entered.",WEBTITLE
          CALL      WEBERR00
          MOVE      ONE,EXIT
          GOTO      PATEVT99
.
PATEVT97  MOVE      "Invalid Event Type.",WEBTITLE
          CALL      WEBERR00
          MOVE      ONE,EXIT
          GOTO      PATEVT99
.
PATEVT98  CLEAR     WEBTITLE
          APPEND    "Please select a hospital ID before processing ",WEBTITLE
          APPEND    "events.",WEBTITLE
          CALL      WEBERR00
          MOVE      ONE,EXIT
          GOTO      PATEVT99
.
PATEVT99  RETURN
.
.*******************************************************************************
.         Check if any item entered for the patient
.*******************************************************************************
CHKIT000  MOVE      ZERO,EXIT
          OPEN      AAEDTRE1,"aaedtref"
          OPEN      PMSMTIA1,"pmsmtiaf"
          PACK      KEY22,ADMISSNO,SP70
          CALL      RDSDTRE1
CHKIT100  CALL      RDKDTRE1
          BRANCH    OVRCD,CHKIT999
.
          MATCH     ADMISSNO,DATNUMB
          GOTO      CHKIT900 IF EQUAL      * found item invoiced already
.
          PACK      KEY14,ADMISSNO,SP70
          CALL      RSPMMTI1
CHKIT200  CALL      RKPMMTI1
          BRANCH    OVRCD,CHKIT999
.
          MATCH     ADMISSNO,PMMIVISN
          GOTO      CHKIT999 IF NOT EQUAL
.
CHKIT900  MOVE      ONE,EXIT
CHKIT999  RETURN
+
.------------------------------------------------------------
. LCLM0000 - Get default claim details from previous visit
.------------------------------------------------------------
.
LCLM0000  MOVE      SP70,CLAIMTYP
          MATCH     SP3,PMEVCCOD
          GOTO      LCLM9999 IF EQUAL       * no claim code
.
          MATCH     ANSN,PTCNLCLM
          GOTO      LCLM9999 IF EQUAL       * no default required
.
          MATCH     ANSI,PTCNLCLM           * Inpatient only?
          GOTO      LCLM9999 IF EQUAL
.
.         Set the claim type indicator if this is a claim
.
          PACK      KEY5,ANSC,ANSL,PMEVCCOD,SP70
          CALL      RDCODE1
          BRANCH    OVRCD,LCLM9999
.
.         Check the indicators for a W, M, or V (these are the claims)
.
          MOVE      ZERO,FORM2
LCLM3000  ADD       ONE,FORM2
          COMPARE   SIX,FORM2
          GOTO      LCLM9999 IF NOT LESS
.
          LOAD      ANS,FORM2,TCINDC1,TCINDC2,TCINDC3,TCINDC4,TCINDC5
          CMATCH    "W",ANS
          GOTO      LCLM4000 IF EQUAL
          CMATCH    "M",ANS
          GOTO      LCLM5000 IF EQUAL
          CMATCH    "V",ANS
          GOTO      LCLM6000 IF EQUAL
          GOTO      LCLM3000
.
LCLM4000  MOVE      "W",CLAIMTYP     * workers comp.claim
          GOTO      LCLM9999
.
LCLM5000  MOVE      "M",CLAIMTYP     * Motors accident claim
          GOTO      LCLM9999
.
LCLM6000  MOVE      "V",CLAIMTYP     * veteran affair
          GOTO      LCLM9999
.
LCLM9999  RETURN
+
.------------------------------------------------------------
.  Fixed Person responsible for account
. Note:- copied from PATWEB98 (routine FPRA0000) to be applied
.        whenever Admission Claim Type is altered
.------------------------------------------------------------
FPRA0000  CALL      CLPRA000               * clear person responsible vars
          MOVE      ZERO,RESPFLAG
          MOVE      ADMISSNO,KEY8
          CALL      RDRESP1
          MOVE      OVRCD,RESPFLAG
          MOVE      ADMISSNO,PKADMN
.
          MOVE      PMEVCCOD,KEY3           * Claim code
          CALL      PRFAINSR               * Check Claim insurance details
          IF        OVRCD=0
            GOTO      FPRA9000
          ENDIF
.
.         PTPCLRES - 0 use insurance company, 1 use patient details
.                    2 use prfa details, 3 use TAC, MAB or DVA details
.
          BRANCH    PTPCLRES,FPRA3000,FPRA9999
.
          CMATCH    "M",CLAIMTYP
          GOTO      FPRA1000 IF EQUAL       * TAC
          CMATCH    "V",CLAIMTYP
          GOTO      FPRA2000 IF EQUAL       * Veteran affair
          CMATCH    "W",CLAIMTYP
          GOTO      FPRA3000 IF NOT EQUAL   * W/C
.
          GOTO      FPRA9000
.
.        Set TAC claim details
.
FPRA1000  MOVE      CMABINS,KEY6
          CALL      RDINSR1
          COMPARE   ZERO,OVRCD
          GOTO      FPRA9999 IF NOT EQUAL
.
          PACK      PKNAME,INAME,SP70,SP10
          MOVE      IADD1,PKADD1
          MOVE      IADD2,PKADD2
          MOVE      IADD3,PKSUBR
          MOVE      IADD4,PKADD4
          MOVE      IPOST,PKPOST
          MOVE      ITELEB,PKTELEB
          MOVE      "T.A.C.    ",PKRELP
          MOVE      SP20,PKTELEP
          MOVE      ADMISSNO,PKADMN
          GOTO      FPRA9000
.
.         Set up Veteran affairs claim details
.
FPRA2000  MOVE      CVETINS,KEY6
          CALL      RDINSR1
          COMPARE   ZERO,OVRCD
          GOTO      FPRA9999 IF NOT EQUAL
.
          PACK      PKNAME,INAME,SP70,SP10
          MOVE      IADD1,PKADD1
          MOVE      IADD2,PKADD2
          MOVE      IADD3,PKSUBR
          MOVE      IPOST,PKPOST
          MOVE      IADD4,PKADD4
          MOVE      ITELEB,PKTELEB
          MOVE      "Vet.Affair",PKRELP
          MOVE      SP20,PKTELEP
          MOVE      ADMISSNO,PKADMN
          GOTO      FPRA9000
.
FPRA3000  MOVE      URNUMBER,KEY8
          CALL      RDMAST1
          BRANCH    OVRCD,FPRA9999
.
          COMPARE   ONE,PTCNPAOF              * Using 'Parent of' option?
          GOTO      FPRA3100 IF NOT EQUAL     * no
.
          COMPARE   PSAGE,PTCNAGEC            * Child?
          GOTO      FPRA3100 IF LESS          * No
.
.-------- Setup 'Parent of' as Person Responsible for Account
.-------- This is done by storing a "@" (defined as ATCHAR) as
.-------- the first character of PKNAME, and defaulting PKRELP
.-------- to "PARENT".  Any letters, statements, invoices, etc
.-------- should print 'Parent of' in replace of "@".
.
          MOVE      SP1,ANS
          MOVE      PGNAME,ANS
          PACK      PKNAME,SP70
.         PACK      PKNAME,ATCHAR,SP1,ANS,DOT,PSNAME
.
          CLEAR     PKNAME
          APPEND    "Parent of ",PKNAME
          APPEND    ANS,PKNAME
          APPEND    DOT,PKNAME
          APPEND    SP1,PKNAME
          APPEND    PTMASNAM,PKNAME
          APPEND    SP70,PKNAME
          RESET     PKNAME
          MOVE      "Parent    ",PKRELP
          GOTO      FPRA3200
.
.-------- Use self as P.R.A.
FPRA3100  MOVE      SP1,ANS
          MOVE      PGNAME,ANS
          PACK      PKNAME,PTITL,SP1,ANS,DOT,PTMASNAM,SP70
          MOVE      SP70,PKRELP
.         MOVE      "SELF      ",PKRELP
.
FPRA3200  PACK      PKADD1,PADD1,SP30,SP20
          PACK      PKADD2,PADD2,SP30,SP20
          PACK      PKSUBR,PSUBRB,SP20,SP30
          PACK      PKADD4,PADD4,SP30,SP10
          PACK      PKPOST,PPOST,SP10,SP20
          PACK      PKTELEP,PTELEP,SP20
          PACK      PKTELEB,PTELEB,SP20
          MOVE      ADMISSNO,PKADMN
.
FPRA9000  IF        RESPFLAG=1
            MOVE      ADMISSNO,KEY8
            CALL      WRRESP1
          ELSE
            CALL      UPRESP1
          ENDIF
FPRA9999  RETURN
+
.------------------------------------------------------------
.         Clear person responsible for account variables
.------------------------------------------------------------
CLPRA000  PACK       PKNAME,SP70,SP10    * PERSON RESP FOR A/C NAME
          MOVE       SP70,PKADD1    *      P.R.A ADDRESS LINE 1
          MOVE       SP70,PKADD2    *      P.R.A ADDRESS LINE 2
          MOVE       SP70,PKSUBR    *      P.R.A SUBURB
          MOVE       SP70,PKADD4    *      P.R.A ADDRESS LINE 2
          MOVE       SP70,PKPOST    *      P.R.A POSTCODE
          MOVE       SP70,PKTELEP   *      P.R.A PRIVATE TELEPHONE
          MOVE       SP70,PKTELEB   *      P.R.A BUSINESS TELEPHONE
          MOVE       SP70,PKRELP    *      P.R.A RELATIONSHIP
          RETURN
+
.------------------------------------------------------------
. Check for discharged deceased
.------------------------------------------------------------
DEADST00  MATCH     SP3,PMEVDSTT                 * discharge dest. blank ?
          GOTO      DEADST99 IF EQUAL            * yes - ignore
.
          PACK      KEY5,ANSD,ANSD,PMEVDSTT
          CALL      RDCODE1                      * dis. dest. code on file ?
          BRANCH    OVRCD,DEADST99               * no
.
          MATCH     ANSD,TCINDC1                 * deceased indicator set ?
          GOTO      DEADST99 IF NOT EQUAL        * no
.
DEADST95  PACK      KEY8,URNUMBER,SP70
          CALL      RDMAST1
          BRANCH    OVRCD,DEADST99
.
          MOVE      ONE,PCEASE              * set as deceased
          MOVE      PMEVDDTE,PDECDTE           * set deceased date
          MOVE      ZERO,PAUTOPY
          CALL      UPMAST1
          CALL      DEAPOL00
.
DEADST99  RETURN
.
.------------------------------------------------------------
. Check for reverse of discharged deceased if the event is deleted
.------------------------------------------------------------
REVDST00  MATCH     SP3,PMEVDSTT                 * discharge dest. blank ?
          GOTO      REVDST99 IF EQUAL            * yes - ignore
.
          PACK      KEY5,ANSD,ANSD,PMEVDSTT,SP70
          CALL      RDCODE1                      * dis. dest. code on file ?
          BRANCH    OVRCD,REVDST99               * no
.
          MATCH     ANSD,TCINDC1                 * deceased indicator set ?
          GOTO      REVDST99 IF NOT EQUAL        * no
.
REVDST95  PACK      KEY8,URNUMBER,SP70
          CALL      RDMAST1
          BRANCH    OVRCD,REVDST99
.
          MOVE      ZERO,PCEASE                  * reverse deceased
          MOVE      SP70,PDECDTE                 * clear deceased date
          MOVE      ZERO,PAUTOPY
          CALL      UPMAST1
.
REVDST99  RETURN
.------------------------------------------------------------
. Write to the current patient list
.------------------------------------------------------------
WRCPAT00  CALL      CALRAN00
.
          PACK      KEY5,ANSE,ANSV,PMEVEVNT
          CALL      RDCODE1
          IF        OVRCD<>1
            MATCH     ANSI,TCINDC1          * outpatients are only written today
            IF        !@EQUAL
              MATCH     PMEVADTE,TODAY
              IF        @EQUAL
                GOTO       WRCPAT10 
              ELSE
                GOTO       WRCPAT99 
              ENDIF
            ENDIF
          ENDIF
.
          MATCH     SP70,PMEVDDTE            * current patient (ie not disch)
          GOTO      WRCPAT10 IF EQUAL
.
          MATCH     STRTDATE,PMEVADTE        * before start date
          GOTO      WRCPAT99 IF LESS
.
          MATCH     PMEVADTE,LASTDATE        * after end date
          GOTO      WRCPAT99 IF LESS
.
WRCPAT10  MOVE      PMEVVISN,PMCUVISN
          MOVE      PMEVADTE,PMCUDATE
          MOVE      PTMASNAM,PMCUSURN
          MOVE      PMPXFNAM,PMCUGNAM
          MOVE      PMPXSNAM,PMCUGNM2
          MOVE      PURNO,PMCUURNO
          MOVE      "8",PMCUSYST
          MOVE      SP70,PMCULOCN
          MOVE      SP70,PMCUOSIT
          MOVE      PMVXMHOS,PMCUHOSP
          MOVE      SP70,PMCUTSTA
          MOVE      SP70,PMCUTLOC
.
          PACK      KEY8,PMCUVISN,SP70
          CALL      RAPMCUR1
          IF        OVRCD=1
            CALL      WRPMCUR1
          ENDIF
.
WRCPAT99  RETURN
+
.------------------------------------------------------------
. Calculate the date range for current patient records
.------------------------------------------------------------
CALRAN00  READ      CONTROLF,HUND01;*49,CWEBSDAY  * no of days for search
          MOVE      SP70,STRTDATE
          MOVE      SP70,LASTDATE
.
. ---  calculate starting date ---
.
          CALL      IBACLOCK
          PACK      TODAY,CC,YY,MM,DD
          REP       " 0",TODAY
          CALL      DMYCON
          SUB       CWEBSDAY,JULDAY
          MOVE      JULDAY,JWKDAY
          MOVE      JULYR,JWKYER
          MOVE      JULCC,JWKCC
          CALL      JULCON
          PACK      STRTDATE,CC,YY,MM,DD
          REP       " 0",STRTDATE
.
. ---  calculate last date ---
.
          CALL      IBACLOCK
          CALL      DMYCON
          ADD       CWEBSDAY,JULDAY
          MOVE      JULDAY,JWKDAY
          MOVE      JULYR,JWKYER
          MOVE      JULCC,JWKCC
          CALL      JULCON
          PACK      LASTDATE,CC,YY,MM,DD
          REP       " 0",LASTDATE
.
CALRAN99  RETURN
+
.*******************************************************************************
.*                         Setting Event values
.*******************************************************************************
VSVAL000  MOVE      PSEVT001,EVNTTYPE
.
.         MATCH     "001",EVNTTYPE
.         IF        @EQUAL
.           ASSIGN    THREE,VISVALUE
.         ENDIF
.
.         MATCH     "002",EVNTTYPE
.         IF        @EQUAL
.           ASSIGN    TWO,VISVALUE
.         ENDIF
.
VSVAL999  RETURN
.*******************************************************************************
.*                          Clear the Event Variables                          *
.*******************************************************************************
CLREVT00  MOVE      SP70,PMEVEVNT  
          MOVE      SP70,PMEVADTE  
          MOVE      SP70,PMEVATIM   
          MOVE      SP70,PMEVACON   
          MOVE      SP70,PMEVPPRB   
          MOVE      SP70,PMEVUNIT   
          MOVE      SP70,PMEVSPHN   
          MOVE      SP70,PMEVPLOC   
          MOVE      SP70,PMEVDDTE   
          MOVE      SP70,PMEVDTIM   
          MOVE      SP70,PMEVVISN   
          MOVE      SP70,PMEVSITE  
          MOVE      SP70,PMEVCTYP   
          MOVE      SP70,PMEVCLID   
          MOVE      SP70,PMEVCCOD   
          MOVE      SP70,PMEVATYP   
          MOVE      SP70,PMEVASTT   
          MOVE      SP70,PMEVADMT   
          MOVE      SP70,PMEVBTYP   
          MOVE      SP70,PMEVREFB   
          MOVE      SP70,PMEVDSTT   
          MOVE      SP70,PMEVSPAR 
.
CLREVT99  RETURN
.
.*******************************************************************************
.*                    Write to CCLEX7A1 table if neccessary                    *
.*******************************************************************************
TRNSII00  PACK      KEY8,ADMISSNO,SP70
          CALL      RDPMEVT1
          BRANCH    OVRCD,TRNSII99
.
          MATCH     PMEVADTE,SVEVADTE
          GOTO      TRNSII80 IF NOT EQUAL
.
          MATCH     PMEVATIM,SVEVATIM
          GOTO      TRNSII80 IF NOT EQUAL
.
          MATCH     PMEVUNIT,SVEVUNIT
          GOTO      TRNSII80 IF NOT EQUAL
.
          MATCH     PMEVCLID,SVEVCLID
          GOTO      TRNSII80 IF NOT EQUAL
.
          MATCH     PMEVBTYP,SVEVBTYP
          GOTO      TRNSII80 IF NOT EQUAL
.
          MATCH     PMEVDDTE,SVEVDDTE
          GOTO      TRNSII80 IF NOT EQUAL
.
          MATCH     PMEVDTIM,SVEVDTIM
          GOTO      TRNSII80 IF NOT EQUAL
.
          MATCH     PMEVCCOD,SVEVCCOD
          GOTO      TRNSII80 IF NOT EQUAL
.
          MATCH     PMEVACON,SVEVACON
          GOTO      TRNSII80 IF NOT EQUAL
.
          MATCH     PMEVREFB,SVEVREFB
          GOTO      TRNSII80 IF NOT EQUAL
.
          GOTO      TRNSII99
.
TRNSII80  MOVE      ANST,CLEXSTAT
          MOVE      NINE,CLEXTYPE
          MOVE      ADMISSNO,CLEXVISN
          PACK      KEY11,CLEXSTAT,CLEXTYPE,CLEXVISN
          CALL      RDCLEX71
          IF        OVRCD = 1
            CALL      WRCLEX71
          ENDIF 
.
TRNSII99  RETURN
.*******************************************************************************
.*                    Save Event Details for SVHM Transition II update         *
.*******************************************************************************
SAVE0000  MOVE      PMEVADTE,SVEVADTE
          MOVE      PMEVATIM,SVEVATIM
          MOVE      PMEVUNIT,SVEVUNIT
          MOVE      PMEVCLID,SVEVCLID
          MOVE      PMEVBTYP,SVEVBTYP
          MOVE      PMEVDDTE,SVEVDDTE
          MOVE      PMEVDTIM,SVEVDTIM
          MOVE      PMEVCCOD,SVEVCCOD
          MOVE      PMEVACON,SVEVACON
          MOVE      PMEVREFB,SVEVREFB
SAVE9999  RETURN
.*******************************************************************************
.*                    Move CGI variables to File Variables                     *
.*******************************************************************************
EVTSAV00  MOVE      EVNTTYPE,PMEVEVNT       * Event Type (Cat EV)
          MOVE      PSEVT002,PMEVADTE       * Admission/Attend. Date (ccyymmdd
          MOVE      PSEVT003,PMEVATIM       * Admission/Attend. Time (hh:mm:ss
          MOVE      PSEVT004,PMEVACON       * Attending Consultant (pmshcpaf)
          MOVE      PSEVT005,PMEVPPRB       * Presenting Problem
          MOVE      PSEVT006,PMEVUNIT       * Unit (Cat AC)
          MOVE      PSEVT007,PMEVSPHN       * Staff Phone Number
          MOVE      PSEVT008,PMEVPLOC       * Patient Location (Cat LO)
          MOVE      PSEVT009,PMEVDDTE       * Discharge/Depart Date (ccyymmdd)
          MOVE      PSEVT010,PMEVDTIM       * Discharge/Depart Time (hh:mm:ss)
          MOVE      ADMISSNO,PMEVVISN       * Visit Number
          MOVE      PSEVT012,PMEVSITE       * Site (outsitaf)
          MOVE      PSEVT013,PMEVCTYP       * Clinic Type (outctyaf)
          MOVE      PSEVT014,PMEVCLID       * Clinic Id (outcliaf)
          MOVE      PSEVT015,PMEVCCOD       * Claim Code (Cat CL)
          MOVE      PSEVT016,PMEVATYP       * Appointment Type (Cat CV)
          MOVE      PSEVT017,PMEVASTT       * Attendance Status
          MOVE      PSEVT018,PMEVADMT       * Admit Type (Cat A)
          MOVE      PSEVT019,PMEVBTYP       * Booking Type (Cat S)
          MOVE      PSEVT020,PMEVREFB       * Referred By (pmshcpaf)
          MOVE      PSEVT021,PMEVDSTT       * Discharge/Depart Status (Cat DD)
          MOVE      PSEVT022,PMEVPWRD       * Patient Ward
          MOVE      PSEVT023,PMEVPBED       * Patient Bed
          MOVE      SP70,PMEVSPAR           * Spare Variable
.          
EVTSAV99  RETURN
.*******************************************************************************
.*                     Generating The Visit Number                             *
.*******************************************************************************
NXTA0000  READ      CONTROLF,HUND30;*75,PTCNUANV      * Using AN Visit Numbers
.
          MATCH     "1",PTCNUANV
          IF        @EQUAL
            CALL      GANV0000                * Get next AN visit number
            MOVE      PTCNNXTV,AADMNO
          ELSE
            MOVE      " 10",PRXCODE   * System Lock Sector 10
            CALL      GETSLK00        * Get System Lock of Sector 10
            READ      CONTROLF,TEN;*1,FORM8V
            ADD       ONE,FORM8V
            WRITAB    CONTROLF,TEN;*1,FORM8V
            CALL      RELSLK00        * Release System Lock of Sector 10
            SUB       ONE,FORM8V
            MOVE      FORM8V,AADMNO
          ENDIF
.                                            * Added by HPS-ODC(03.08.01)Starts
.                                            *check whether new Visit Number 
.                                             already exists or not
          MOVE      AADMNO,PVIBILL           
          MOVE      PVIBILL,KEY8
          CALL      RDAVISA1
          COMPARE   ZERO,OVRCD
          GOTO      NXTA0000 IF EQUAL       * Get the next Admission Number
.
          CALL      RDAMISS1
          COMPARE   ZERO,OVRCD
          GOTO      NXTA0000 IF EQUAL       * Get the next Admission Number
.                                           * Added by HPS-ODC(03.08.01)Ends
          MOVE      AADMNO,ADMISSNO
.
NXTA9999  RETURN
.*******************************************************************************
.*                  Main Action Routine For Current Event List Table           *
.*                                          * Added by HPS-ODC(03.08.01)       *
.*******************************************************************************
PATLIS00  PACK      URNUMBER,URNUMBER,SP70 
          MATCH     SP70,URNUMBER
          GOTO      PATLIS10 IF EQUAL
          PACK      KEY8,URNUMBER,SP70
          CALL      RDMAST1
          BRANCH    OVRCD,PATLIS99
          MOVE      PURNO,KEY8
          CALL      RDPMPX21
          IF        OVRCD=1
            CALL      CLPMSPX2
          ENDIF
.
          PACK      ADMISSNO,ADMISSNO,SP70
          MATCH     SP70,ADMISSNO
          GOTO      PATLIS10 IF EQUAL
          PACK      KEY88,PTMASNAM,PMPXFNAM,ADMISSNO,SP70,SP70
          CALL      RDLOCA1
          BRANCH    OVRCD,PATLIS99
.         
          CALL      CLPMSNUT                      * clear nutrition variables
          PACK      KEY8,CCC,CYY,CMM,CDD          * read nutrition file
          REP       " 0",KEY8
          PACK      KEY16,ADMISSNO,LASTDATE,SP8   * set key to read nutrition
          CALL      RDPMNUT1                      * if no rec found, vals blank
          IF        OVRCD=1
            CALL      CLPMSNUT                      * clear nutrition variables
          ENDIF
.                                                 * out already (CLPMSNUT)
.
          MOVE      ADMISSNO,PMVXVISN             * Find Visit extension record
          PACK      KEY8,PMVXVISN,SP70
          CALL      RDPMVX11
          IF        OVRCD=1
            MOVE      SP70,PMVXVALW
            MOVE      SP70,PMVXPALW
          ENDIF
.
PATLIS10  MOVE      "Current Events",WEBTITLE
          CALL      WEBHED00      *Create Output File & Write HTML Page Header
          BRANCH    EXIT,PATLIS99
          CALL      WEBBOD00                * Process Web Body (calls PROFLD00)
          CALL      WEBEND00                * Process End of HTML File
.
          MOVE      ONE,EXIT
          GOTO      PATLIS99
.
PATLIS99  RETURN
.*******************************************************************************
.*                      Process Fields in Body of HTML Template                *
.*******************************************************************************
PROFLD00  BRANCH    REPORTNO,PROFLD10,PROFLD20      
          GOTO      PROFLD99                * Added by HPS-ODC(03.08.01)

PROFLD10  BRANCH    FLDSETNO,PROFLD11,PROFLD12
          GOTO      PROFLD99
.
PROFLD11  CALL      MASF0000                * Patient System Events
          GOTO      PROFLD99
.                                          
PROFLD12  CALL      PEVT0000                * Patient details
          GOTO      PROFLD99
.                                           * Added by HPS-ODC(03.08.01)Starts 
.
PROFLD20  BRANCH    FLDSETNO,PROFLD21,PROFLD22,PROFLD23,PROFLD24
          GOTO      PROFLD99                         
.
PROFLD21  CALL      EVLT0000                * Current Event List  
          GOTO      PROFLD99                      
.
PROFLD22  CALL      MASF0000
          GOTO      PROFLD99
.
PROFLD23  CALL      PNUT0000
          GOTO      PROFLD99
.
PROFLD24  CALL      PRDT0000     * Get Program specific Diet information
          GOTO      PROFLD99
.
PROFLD99  RETURN
.------------------------------------------------------------
. Diet and Nutrition program specific items
.------------------------------------------------------------
PRDT0000  BRANCH    FLDITMNO,PRDT0100,PRDT0200,PRDT0300,PRDT0400,PRDT0500
          GOTO      PRDT9999
.
PRDT0100  CALL      NEXT0000                   * Get next date
          GOTO      PRDT9999
.
PRDT0200  CALL      PREV0000                   * Get previous date
          GOTO      PRDT9999
.
PRDT0300  CALL      SELV0000                   * Display current date box
          GOTO      PRDT9999
.
PRDT0400  WRITE     HTMLFILE;VIEWTYPE;         * output viewtype
          GOTO      PRDT9999
.
PRDT0500  WRITE     HTMLFILE;LASTDATE;         * output selected date
          GOTO      PRDT9999
.
PRDT9999  RETURN
.------------------------------------------------------------
. Next Day, Week, Month
.------------------------------------------------------------
NEXT0000  MOVE      TEMPLATE,F3
          MOVE      F3,KEY3
          REP       " 0",KEY3
.
          MOVE      REPORTNO,F2
          MOVE      F2,KEY2
          REP       " 0",KEY2
          REP       " +",URNUMBER
          REP       " +",ADMISSNO
.
          WRITE     HTMLFILE;"patweb81.pbl":
                             "?reportno=",KEY2:
                             "&template=",KEY3:
                             "&urnumber=",URNUMBER:
                             "&admissno=",ADMISSNO:
                             "&frstdate=",NXTFDATE:
                             "&viewtype=",VIEWTYPE:
                             "&lastdate=",NXTLDATE;
.
          REP       "+ ",URNUMBER
          REP       "+ ",ADMISSNO
.
NEXT9999  RETURN
.------------------------------------------------------------
. Previous Day, Week, Month
.------------------------------------------------------------
PREV0000  MOVE      TEMPLATE,F3
          MOVE      F3,KEY3
          REP       " 0",KEY3
.
          MOVE      REPORTNO,F2
          MOVE      F2,KEY2
          REP       " 0",KEY2
          REP       " +",URNUMBER
          REP       " +",ADMISSNO
.
          WRITE     HTMLFILE;"patweb81.pbl":
                             "?reportno=",KEY2:
                             "&template=",KEY3:
                             "&urnumber=",URNUMBER:
                             "&admissno=",ADMISSNO:
                             "&frstdate=",PREFDATE:
                             "&viewtype=",VIEWTYPE:
                             "&lastdate=",PRELDATE;
.
          REP       "+ ",URNUMBER
          REP       "+ ",ADMISSNO
.
PREV9999  RETURN
.*******************************************************************************
.*                  Output Routine For Register Patient Events                 *
.*******************************************************************************
PEVT0000  BRANCH    FLDITMNO,PEVT0100,PEVT0200,PEVT0300,PEVT0400:
                             PEVT0500,PEVT0600,PEVT0700,PEVT0800:
                             PEVT0900,PEVT1000,PEVT1100,PEVT1200:
                             PEVT1300,PEVT1400,PEVT1500,PEVT1600:
                             PEVT1700,PEVT1800,PEVT1900,PEVT2000:
                             PEVT2100,PEVT2200,PEVT2300,PEVT2400:
                             PEVT2500,PEVT2600,PEVT2700,PEVT2800:
                             PEVT2900,PEVT3000,PEVT3100,PEVT3200:
                             PEVT3300,PEVT3400,PEVT3500,PEVT3600:
                             PEVT3700,PEVT3800,PEVT3900,PEVT4000:
                             PEVT4100,PEVT4200,PEVT4300,PEVT4400:
                             PEVT4500
.
          GOTO      PEVT9999
.
PEVT0100  UNPACK    PMEVADTE,CCENT,CYEAR,CMON,CDAY    
          MOVE      CMON,F2                 * Admission Date 
          LOAD      MTHNAM3,F2,JAN,FEB,MAR,APR,MAY,JUN,JUL,AUG,SEP,OCT,NOV,DEC
          WRITE     HTMLFILE;CDAY,SP1,MTHNAM3,SP1,CCENT,CYEAR;
          GOTO      PEVT9999
.
PEVT0200  WRITE     HTMLFILE;PMEVATIM;
          GOTO      PEVT9999
.
PEVT0300  WRITE     HTMLFILE;PMEVACON;
          GOTO      PEVT9999
.
PEVT0400  WRITE     HTMLFILE;PMEVPPRB;
          GOTO      PEVT9999
.
PEVT0500  MOVE      "AC",CATEGORY
          MOVE      PMEVUNIT,CODE
          CALL      CODITM00
          GOTO      PEVT9999
.
PEVT0600  WRITE     HTMLFILE;PMEVSPHN;
          GOTO      PEVT9999
.
PEVT0700  MOVE      "LO",CATEGORY
          MOVE      PMEVPLOC,CODE
          CALL      CODITM00
          GOTO      PEVT9999
.
PEVT0800  MATCH     SP70,PMEVDDTE
          GOTO      PEVT9999 IF EQUAL 
.
          UNPACK    PMEVDDTE,CCENT,CYEAR,CMON,CDAY   
          MOVE      CMON,F2                 * Discharge Date 
          LOAD      MTHNAM3,F2,JAN,FEB,MAR,APR,MAY,JUN,JUL,AUG,SEP,OCT,NOV,DEC
          WRITE     HTMLFILE;CDAY,SP1,MTHNAM3,SP1,CCENT,CYEAR;
          GOTO      PEVT9999
.
PEVT0900  WRITE     HTMLFILE;PMEVDTIM;
          GOTO      PEVT9999
.
PEVT1000  WRITE     HTMLFILE;ADMISSNO;
          GOTO      PEVT9999
.
PEVT1100  MATCH     SP6,PMEVSITE
          GOTO      PEVT9999 IF EQUAL 
          PACK      KEY6,PMEVSITE,SP70
          CALL      RDSITA1
          BRANCH    OVRCD,PEVT9999
          WRITE     HTMLFILE;OSTDESC;
          GOTO      PEVT9999
. 
.PEVT1200  MATCH     SP6,PMEVCTYP
.          GOTO      PEVT9999 IF EQUAL
.          PACK      KEY6,PMEVCTYP,SP70
.          CALL      RDSCTYA1
.          CALL      RDKCTYA1
.          BRANCH    OVRCD,PEVT9999
.          WRITE     HTMLFILE;OCTCTYP;
.          GOTO      PEVT9999           
.
PEVT1200  MATCH     SP70,PMEVCTYP
          GOTO      PEVT9999  IF EQUAL
          PACK      KEY12,WBSESIT,PMEVCTYP,SP70
          CALL      RDCTYA1
          BRANCH    OVRCD,PEVT9999
          WRITE     HTMLFILE;OCTCTYP;
          GOTO      PEVT9999
.
PEVT1300  UNPACK    DIM127,D1,KEY1,DIM127
          MOVE      ZERO,F1
          MOVE      KEY1,F1
          MATCH     SP6,PMEVCLID
          GOTO      PEVT9999 IF EQUAL
          PACK      KEY20,PMEVCLID,SP70
          CALL      RDSCLIA1
PEVT1305  CALL      RDKCLIA1 
          BRANCH    OVRCD,PEVT9999
          MATCH     PMEVCLID,OCACLIN
          GOTO      PEVT1305 IF NOT EQUAL 
          BRANCH    F1,PEVT1310
          WRITE     HTMLFILE;OCACLIN;
          GOTO      PEVT9999
PEVT1310  WRITE     HTMLFILE;OCADESC;
          GOTO      PEVT9999
.           
PEVT1400  MOVE      "CL",CATEGORY
          MOVE      PMEVCCOD,CODE
          CALL      CODITM00
          GOTO      PEVT9999
.
PEVT1500  MOVE      "CV",CATEGORY
          MOVE      PMEVATYP,CODE
          CALL      CODITM00
          GOTO      PEVT9999
.
PEVT1600  MATCH     SP6,PMEVASTT
          GOTO      PEVT9999 IF EQUAL
          PACK      KEY20,PMEVASTT,SP70
          CALL      RDSBOKA1
          CALL      RDKBOKA1
          BRANCH    OVRCD,PEVT9999
          MATCH     "0",DOBASTAT
          IF        @EQUAL
            WRITE     HTMLFILE;"NOT BOOKED";
            GOTO      PEVT9999
          ENDIF
.
          MATCH     "1",DOBASTAT
          IF        @EQUAL
            WRITE     HTMLFILE;"BOOKED";
            GOTO      PEVT9999
          ENDIF
.
          MATCH     "2",DOBASTAT
          IF        @EQUAL
            WRITE     HTMLFILE;"NOT USED";
            GOTO      PEVT9999
          ENDIF
.
          MATCH     "3",DOBASTAT
          IF        @EQUAL
            WRITE     HTMLFILE;"EXTENDED SLOT";
            GOTO      PEVT9999
          ENDIF
.
          MATCH     "4",DOBASTAT
          IF        @EQUAL
            WRITE     HTMLFILE;"ATTENDED";
            GOTO      PEVT9999
          ENDIF
.
          MATCH     "5",DOBASTAT
          IF        @EQUAL
            WRITE     HTMLFILE;"NO ATTENDANCE";
            GOTO      PEVT9999
          ENDIF
.
          GOTO      PEVT9999
.
PEVT1700  MOVE      "A ",CATEGORY
          MOVE      PMEVADMT,CODE
          CALL      CODITM00
          GOTO      PEVT9999
.
PEVT1800  MOVE      "S ",CATEGORY
          MOVE      PMEVBTYP,CODE
          CALL      CODITM00
          GOTO      PEVT9999
.
PEVT1900  UNPACK    DIM127,D1,KEY1,DIM127   * Added by HPS-ODC(03.08.01)Starts
          MOVE      ZERO,F1
          MOVE      KEY1,F1
          BRANCH    F1,PEVT1910
          MOVE      PMEVREFB,DTCODE
          CALL      DNAME000
          GOTO      PEVT9999
.
PEVT1910  WRITE     HTMLFILE;PMEVREFB;
          GOTO      PEVT9999
.                                           * Added by HPS-ODC(03.08.01)Ends
PEVT2000  MOVE      "DD",CATEGORY
          MOVE      PMEVDSTT,CODE
          CALL      CODITM00
          GOTO      PEVT9999
.
PEVT2100  CALL      PEVTDS00                * Register Event Table Output
          GOTO      PEVT9999
.
PEVT2200  MOVE      PMEVACON,DTCODE
          CALL      DNAME000
          GOTO      PEVT9999
.
.PEVT2300  MATCH     SP6,PMEVCTYP
.          PACK      KEY6,PMEVCTYP,SP70
.          CALL      RDSCTYA1
.PEVT2301  CALL      RDKCTYA1
.          BRANCH    OVRCD,PEVT9999
.          MATCH     OCTSITE,WBSESIT     * Must be in the Same Site
.          GOTO      PEVT2301 IF NOT EQUAL
.          MATCH     "1",OCTACT
.          GOTO      PEVT2301 IF EQUAL
.          MATCH     PMEVCTYP,OCTCTYP
.          IF        @EQUAL
.            WRITE     HTMLFILE;"<option value=#"",OCTCTYP,"#" selected>":
.                               OCTDESC,"</option>"
.          ELSE
.            WRITE     HTMLFILE;"<option value=#"",OCTCTYP,"#">":
.                             OCTDESC,"</option>"
.          ENDIF
.          GOTO      PEVT2301
.
PEVT2300  PACK      KEY42,WBSESIT,SP70
          CALL      RDSCTYA2
PEVT2301  CALL      RDKCTYA2
          BRANCH    OVRCD,PEVT9999
          MATCH     OCTSITE,WBSESIT     * Must be in the Same Site
          GOTO      PEVT2301 IF NOT EQUAL
          MATCH     "1",OCTACT
          GOTO      PEVT2301 IF EQUAL
          MATCH     PMEVCTYP,OCTCTYP
          IF        @EQUAL
            WRITE     HTMLFILE;"<option value=#"",OCTCTYP,"#" selected>":
                               OCTDESC,"</option>"
          ELSE
            WRITE     HTMLFILE;"<option value=#"",OCTCTYP,"#">":
                               OCTDESC,"</option>"
          ENDIF
          GOTO      PEVT2301
.
PEVT2400  MOVE      PMEVPWRD,WARDCODE
          CALL      WSEL0000
          GOTO      PEVT9999
.
PEVT2500  WRITE     HTMLFILE;PMEVPBED;
          GOTO      PEVT9999
.
PEVT2600  MOVE      SP70,WARDCODE
          CALL      WSEL0000
          GOTO      PEVT9999
.
PEVT2700  WRITE     HTMLFILE;EVNTTYPE;
          GOTO      PEVT9999
.
PEVT2800  WRITE     HTMLFILE;PMEVASTT;
          GOTO      PEVT9999
.
PEVT2900  WRITE     HTMLFILE;PMEVEVNT;
          GOTO      PEVT9999
.
PEVT3000  MOVE      PMEVATYP,CODE
          CALL      VTYSEL00
          GOTO      PEVT9999
.
PEVT3100  WRITE     HTMLFILE;TMBKEVIN;
          GOTO      PEVT9999
.
PEVT3200  WRITE     HTMLFILE;TMADMTYP;
          GOTO      PEVT9999
.
PEVT3300  WRITE     HTMLFILE;TMREFSRC;
          GOTO      PEVT9999
.
PEVT3400  WRITE     HTMLFILE;TMEXPWRD;
          GOTO      PEVT9999
.
PEVT3500  WRITE     HTMLFILE;TMEXPBED;
          GOTO      PEVT9999
.
PEVT3600  WRITE     HTMLFILE;TMCONSUL;
          GOTO      PEVT9999
.
PEVT3700  WRITE     HTMLFILE;TMUNTDEP;
          GOTO      PEVT9999
.
PEVT3800  WRITE     HTMLFILE;TMCLMTYP;
          GOTO      PEVT9999
.
PEVT3900  WRITE     HTMLFILE;PMEVCTYP;
          GOTO      PEVT9999
.
PEVT4000  WRITE     HTMLFILE;PMEVCLID;
          GOTO      PEVT9999
.
PEVT4100  WRITE     HTMLFILE;PMEVSITE;
          GOTO      PEVT9999
.
PEVT4200  COMPARE   ONE,IBCNMHOS
          GOTO      PEVT9999 IF NOT EQUAL
.
          MOVE      " Unknown",DIM8
          PACK      PTHSNAME,PMVXMHOS,DIM8,SP70
          PACK      KEY3,PMVXMHOS,SP10
          CALL      RDPTHSP1
.
          WRITE     HTMLFILE;PTHSNAME;
          GOTO      PEVT9999
.
PEVT4300  WRITE     HTMLFILE;HOSPFLAG;
          GOTO      PEVT9999
.
PEVT4400  PACK      KEY6,PMEVPWRD,SP70
          CALL      RDWARD1
          IF        OVRCD=1
            MOVE      PMEVPWRD,WBDESC
          ENDIF
          WRITE     HTMLFILE;WBDESC;
.
          PACK      KEY6,PMEVPWRD,PMEVPBED,SP70
          CALL      RDWARD1
          IF        OVRCD=1
            MOVE      PMEVPBED,WBDESC
          ENDIF
          WRITE     HTMLFILE;SLASH,WBDESC;
          GOTO      PEVT9999
.
PEVT4500  WRITE     HTMLFILE;PMEVPBED;
          GOTO      PEVT9999
.
PEVT9999  RETURN
.------------------------------------------------------------
.               Routine for Ward selection
.------------------------------------------------------------
WSEL0000  PACK      KEY29,SP70                                                                                                                     
          IF        IBCNMHOS = 1                                                                                                                   
            PACK      KEY29,SP3,WBSEHOSP,SP70                                                                                                      
          ENDIF                                                                                                                                    
          CALL      RDSWARD7                                                                                                                       
WSEL0100  CALL      RDKWARD7                                                                                                                       
          BRANCH    OVRCD,WSEL9999                                                                                                                 
.                                                                                                                                                  
.                         if we have a bed number we have passed all the ward                                                                      
.                         master records, so exit                                                                                                           
          MATCH     SP70,WBED                                                                                                                      
          GOTO      WSEL9999 IF NOT EQUAL                                                                                                          
.                                                                                                                                                  
          COMPARE   WACTIVE,ZERO                 *List only active wards                                                                           
          GOTO      WSEL0100 IF NOT EQUAL                                                                                                          
.                                                                                                                                                  
          IF        IBCNMHOS = 1                                                                                                                   
            MATCH      SP3,WBSEHOSP                                                                                                                
            IF        !@EQUAL                                                                                                                      
              MATCH     WBSEHOSP,PTWDHOSN                                                                                                          
              GOTO      WSEL9999 IF NOT EQUAL                                                                                                      
            ENDIF                                                                                                                                  
          ENDIF                                                                                                                                    
.                                                                                                                                                  
.                       write the select option.                                                                                                   
          WRITE     HTMLFILE;"<option value=#"",WWARD,"#"";                                                                                        
          MATCH     WARDCODE,WWARD
          IF        @EQUAL                                                                                                                         
            WRITE     HTMLFILE;" selected";                                                                                                        
          ENDIF                                                                                                                                    
          WRITE     HTMLFILE;">",WBDESC;
.
          IF        IBCNMHOS = 1
            MATCH      SP3,WBSEHOSP
            IF        @EQUAL
              WRITE     HTMLFILE;" - ",PTWDHOSN;
            ENDIF
          ENDIF
.
          WRITE     HTMLFILE;"</option>"
          GOTO      WSEL0100                                                                                                                       
.                                                                                                                                                  
WSEL9999  RETURN
.
.*******************************************************************************
.*                Display Routines For Register Event Table                    *
.*******************************************************************************
PEVTDS00  PACK      KEY24,URNUMBER,Z70     * Key For Patient Visit File     
          CALL      RSPTVIS2                * Positional Read
PEVTDS10  CALL      RPPTVIS2                * Sequential Read
          BRANCH    OVRCD,PEVTDS99
          MATCH     URNUMBER,PVIURNO
          GOTO      PEVTDS99 IF NOT EQUAL
          MOVE      PVITYPE,KEY1
.       
          MATCH     SP8,DPVIBILL            * Clear Variables if vno is Blank
          CALL      CLREVT00 IF EQUAL
.
          MOVE      DPVIBILL,VISITNO
          PACK      KEY8,DPVIBILL,SP70      * Key For Event File
          CALL      RDPMEVT1
          BRANCH    OVRCD,PEVTDS10
.          
          CALL      EVTT0000                * Setting Event Name
          CALL      DATEFM00                * Date Formating
          CALL      LOCDIS00                * Location Description
.
          MOVE      SP70,DOCFNAME
          MOVE      PMEVACON,DTCODE
          PACK      KEY10,DTCODE,SP70
          CALL      RDPMHCP1
          BRANCH    OVRCD,PEVTDS20
.
          MOVE      PMHCTITL,FMTTITLE
          MOVE      PMHCGNAM,FMTGNAME
          MOVE      PMHCSNAM,FMTSNAME
          CALL      DOCNM000
.
PEVTDS20  CALL      EVTROW00                * Displaying the Table Row
          GOTO      PEVTDS10                
.
PEVTDS99  RETURN
.*******************************************************************************
.*                    Setting Event Name for Display                           *
.*******************************************************************************
EVTT0000  MOVE      SP70,EVENTDIS        
          MOVE      "EV",CATEGORY
          MOVE      PMEVEVNT,CODE
          CALL      GETCOD00
          MOVE      TDESC,EVENTDIS
          MATCH     ANSI,TCINDC1
          IF        @EQUAL
            MOVE      "003",LINKTEM
          ENDIF
.
          MATCH     ANSO,TCINDC1
          IF        @EQUAL
            MOVE      "005",LINKTEM
          ENDIF
.
          MATCH     ANSE,TCINDC1
          IF        @EQUAL
            MOVE      "007",LINKTEM
          ENDIF
.
.         MATCH     "3",KEY1
.         IF        @EQUAL
.           MOVE      "003",LINKTEM
.           MOVE      "  Inpatient",EVENTDIS
.         ENDIF
.
.         MATCH     "2",KEY1
.         IF        @EQUAL
.           MOVE      "005",LINKTEM
.           MOVE      "  Outpatient",EVENTDIS
.         ENDIF
.
EVTT9999  RETURN
.*******************************************************************************
.                           Display Of Event Row
.*******************************************************************************
EVTROW00  WRITE     HTMLFILE;"<tr>":
                    "<td nowrap>":
                    "<a HREF ='javascript:EventLink(#"",PVIURNO,"#",#"":
                    PMEVVISN,"#",#"",LINKTEM,"#")'>":                    
                    "<img src=../images/AppointmentIcon.gif hspace=4":
                    " border=0 align=absmiddle></a>":
                    EVENTDIS,"</td>":
	                   "<td>",PMEVVISN,"</td>":
                    "<td>",ENDATE,"</td>":
	                   "<td>",DIDATE,"</td>":
	                   "<td>&nbsp",TDESC,"</td>":
	                   "<td>&nbsp",DOCFNAME,"</td>":
	                   "<td>&nbsp",PMEVPWRD,"</td>":
	                   "<td>&nbsp",PMEVPBED,"</td>":
                    "</tr>"
EVTROW99  RETURN
.*******************************************************************************
.*                     Generating The Location Description                     *
.*******************************************************************************
LOCDIS00  MOVE      "LO",CATEGORY
          MOVE      PMEVPLOC,CODE
          CALL      GETCOD00
.
LOCDIS99  RETURN
.*******************************************************************************
.*                     Generating The Doctor Names                             *
.*******************************************************************************
DNAME000  PACK      KEY10,DTCODE,SP70
          CALL      RDPMHCP1
          BRANCH    OVRCD,DNAME999
          MOVE      PMHCTITL,FMTTITLE
          MOVE      PMHCGNAM,FMTGNAME
          MOVE      PMHCSNAM,FMTSNAME
          CALL      DOCNM000
          WRITE     HTMLFILE;DOCFNAME;
.                
DNAME999 RETURN
.*******************************************************************************
.*                      Routine for Date Formating                             *
.*******************************************************************************
DATEFM00  MOVE      SP70,ENDATE
          MATCH     SP70,PMEVADTE
          GOTO      DATEFM50 IF EQUAL
          UNPACK    PMEVADTE,CCENT,CYEAR,CMON,CDAY
          MOVE      CMON,F2
          LOAD      MTHNAM3,F2,JAN,FEB,MAR,APR,MAY,JUN,JUL,AUG,SEP,OCT,NOV,DEC
          PACK      ENDATE,CDAY,SP1,MTHNAM3,SP1,CCENT,CYEAR
.
DATEFM50  MOVE      SP70,DIDATE
          MATCH     SP70,PMEVDDTE
          GOTO      DATEFM90 IF EQUAL 
          UNPACK    PMEVDDTE,CCENT,CYEAR,CMON,CDAY
          MOVE      CMON,F2
          LOAD      MTHNAM3,F2,JAN,FEB,MAR,APR,MAY,JUN,JUL,AUG,SEP,OCT,NOV,DEC
          PACK      DIDATE,CDAY,SP1,MTHNAM3,SP1,CCENT,CYEAR
.
DATEFM90  MATCH     SP70,ENDATE
          IF        @EQUAL
            MOVE     "&nbsp;",ENDATE
          ENDIF
.
          MATCH     SP70,DIDATE
          IF        @EQUAL
            MOVE     "&nbsp;",DIDATE
          ENDIF
 
DATEFM99  RETURN
.*******************************************************************************
.*                          Current Event List                                 *
.*                                          * Added by HPS-ODC(03.08.01)       *
.*******************************************************************************
EVLT0000  BRANCH    FLDITMNO,EVLT0100,EVLT0200,EVLT0300,EVLT0400,EVLT0500:
                             EVLT0600,EVLT0700,EVLT0800
          GOTO      EVLT9999            
.
EVLT0100  MOVE      "LO",CATEGORY           * To Populate Location Drop-Down    
          MOVE      LOCATION,CODE
          CALL      CODITM00
          GOTO      EVLT9999   
.
EVLT0200  CALL      CLSTAB00                * Current Event List Table Output  
          GOTO      EVLT9999
.
EVLT0300  MOVE      "CO",CATEGORY           * To Populate Condition Drop-Down
          MOVE      LPCONDC,CODE
          CALL      CODSEL00 
          GOTO      EVLT9999 
.
EVLT0400  WRITE     HTMLFILE;LPCONDD;       * Patient Condition Comments  
          GOTO      EVLT9999
.
EVLT0500  CALL      WSEL0000                * Ward Selection list         
          GOTO      EVLT9999
.
EVLT0600  CALL      VISFLG00
          GOTO      EVLT9999
.
EVLT0700  MOVE      CODEAM,CATEGORY
          MOVE      LPCONAM,CODE
          CALL      CODSEL00
          GOTO      EVLT9999
.
EVLT0800  PACK      KEY16,LPCDATE,LPCTIME,SP10 * move t/stamp into parm
          CALL      TSTMP000                   * reformat t/stamp
          WRITE     HTMLFILE;KEY20;            * Output last update datetime
          GOTO      EVLT9999
.
EVLT9999  RETURN  
.------------------------------------------------------------
. Get Visit Extension file flags.
.------------------------------------------------------------
VISFLG00  UNPACK    DIM127,D1,KEY1,DIM127
          MATCH     SP1,KEY1  
          GOTO      VISFLG99 IF EQUAL
          MOVE      KEY1,F1          
.
          BRANCH    F1,VISFLG01,VISFLG02
.
VISFLG01  WRITE     HTMLFILE;PMVXVALW;
          GOTO      VISFLG99
.
VISFLG02  WRITE     HTMLFILE;PMVXPALW;
          GOTO      VISFLG99
.
VISFLG99  RETURN
.*******************************************************************************
.*                  Output Routine For Current Event List Table                *
.*                                          * Added by HPS-ODC                 *
.*******************************************************************************
CLSTAB00  PACK      WARDCODE,WARDCODE,SP70
          MATCH     SP70,WARDCODE
          GOTO      CLSTAB99 IF EQUAL
.
          PACK      KEY14,WARDCODE,SP70
          CALL      RSPMEVT5                * Reading From Event File  
CLSTAB10  CALL      RKPMEVT5
          BRANCH    OVRCD,CLSTAB99
          MATCH     SP70,WARDCODE
          IF        !@EQUAL
            MATCH     WARDCODE,PMEVPWRD     * Matching with Location  
            GOTO      CLSTAB99 IF NOT EQUAL
          ENDIF
          MATCH     SP70,PMEVDDTE           * To Read the Undischarged Patient
          GOTO      CLSTAB10 IF NOT EQUAL
.
          PACK      KEY8,PMEVVISN,SP70
          CALL      RDVISA1                 * Reading From Patient Visit Table
          BRANCH    OVRCD,CLSTAB10         
.          
          CALL      RDPMVX11                * Read visit extension
          BRANCH    OVRCD,CLSTAB10
.
          PACK      KEY8,PVIURNO,SP70
          CALL      RDMAST1                 * Reading From Patient Master File
          BRANCH    OVRCD,CLSTAB10 
.
          MOVE      PURNO,KEY8
          CALL      RDPMPX21
          IF        OVRCD=1
            CALL      CLPMSPX2
          ENDIF
.
          MOVE      "DC",CATEGORY           * Patient Diet 
          MOVE      PDIET,CODE
          CALL      GETCOD00
          MOVE      TDESC,PATDIET
. 
          CALL      PATLN000                * Calling for Patient Name 
.          
          MOVE      PMEVVISN,ADMNO
          CALL      GETCON00                * Reading for Patient Condition 
. 
          MATCH     SP70,CONDESC            * Patient Condition Description 
          IF        !@EQUAL
            UNPACK    LPCDATE,CCENT,CYEAR,CMON,CDAY
            PACK      DISPDATE,LBRACK,CDAY,SLASH,CMON,SP1,LPCTIME,RBRACK
          ELSE
            CLEAR     DISPDATE
          ENDIF
.
          MOVE      "LO",CATEGORY           * Reading For Patient Location
          MOVE      PMEVPLOC,CODE
          CALL      GETCOD00
          MOVE      TDESC,PLOCAT
.         
          MOVE      "EV",CATEGORY           * Reading For Event Type
          MOVE      PMEVEVNT,CODE
          CALL      GETCOD00
          MOVE      TDESC,EVTYPE        
. 
          PACK      KEY10,PMEVACON,SP70
          CALL      RDPMHCP1                * Reading From HCP Table 
.             
          MOVE      "AC",CATEGORY
          MOVE      PMEVUNIT,CODE           * Reading For Unit 
          CALL      GETCOD00
          MOVE      TDESC,UNIT 
.
          PACK      KEY6,PMEVPWRD,PMEVPBED,SP70
          CALL      RDWARD1                 * Reading For Patient Ward
.          
          MOVE      "CL",CATEGORY
          MOVE      PMEVCCOD,CODE           * Reading For Claim Code
          CALL      GETCOD00
          MOVE      TDESC,CLCODE
.
          MOVE      "CV",CATEGORY
          MOVE      PMEVATYP,CODE           * Reading For Appointment Type 
          CALL      GETCOD00
          MOVE      TDESC,APPTYPE
.
          MOVE      "A ",CATEGORY
          MOVE      PMEVADMT,CODE           * Reading For Admission Type 
          CALL      GETCOD00
          MOVE      TDESC,ADMTYPE
.
          MOVE      "S ",CATEGORY
          MOVE      PMEVBTYP,CODE           * Reading For Booking Type 
          CALL      GETCOD00
          MOVE      TDESC,BOKTYPE
.
          MOVE      SP70,VISPHONE
          CLEAR     VISPHONE
.
          MOVE      ANSR,DIM1
          MATCH     "1",PMVXVALW
          IF        @EQUAL
            MOVE ANSV,DIM1
          ENDIF
          APPEND    LBRACKT,VISPHONE
          APPEND    DIM1,VISPHONE
          APPEND    COMMA,VISPHONE
.
          MOVE      ANSN,DIM1
          MATCH     "1",PMVXPALW
          IF        @EQUAL
            MOVE ANSP,DIM1
          ENDIF
          APPEND    DIM1,VISPHONE
          APPEND    RBRACKT,VISPHONE
          MATCH     SP70,LPCONAM
          IF        !@EQUAL
            PACK      KEY5,ANSA,ANSM,LPCONAM
            CALL      RDCODE1
            IF        OVRCD<>1
              APPEND    SP1,VISPHONE
              APPEND    TDESC,VISPHONE
            ENDIF
          ENDIF
.
          CLEAR     PATLINK                 * Link for Patient Folder
          APPEND    "javascript: PatientLink('",PATLINK
          APPEND    PVIURNO,PATLINK
          APPEND    "','",PATLINK
          APPEND    DPVIBILL,PATLINK
          APPEND    "','",PATLINK
          APPEND    "')",PATLINK  
          RESET     PATLINK
. 
          CLEAR     DIETLINK                * Link for Patient Diet
          APPEND    "javascript: UpdateDiet('",DIETLINK
          APPEND    PVIURNO,DIETLINK
          APPEND    "','",DIETLINK
          APPEND    DPVIBILL,DIETLINK
          APPEND    "','",DIETLINK
          APPEND    "')",DIETLINK                    
          RESET     DIETLINK
.
          CLEAR     CONLINK                 * Link for Patient Condition
          APPEND    "javascript:UpdatePatient('",CONLINK
          APPEND    PVIURNO,CONLINK
          APPEND    "','",CONLINK
          APPEND    DPVIBILL,CONLINK
          APPEND    "','",CONLINK
          APPEND    "')",CONLINK  
          RESET     CONLINK
.                                      
          CALL      PATFLD00                *Returns KEY3 for folder colour code
          READ      CONTROLF,HUND10;*249,PTCNDAUR
          MATCH     "1",PTCNDAUR
          IF        @EQUAL
            PACK      KEY20,SP70
            PROC      GETALIDS
          ENDIF
.
CLSTAB30  WRITE     HTMLFILE;"t.addRow(#"",PATLINK,"#",":
                             "#"",DIETLINK,"#",":
                             "#"",CONLINK,"#",":
                             "#"",FORMATNM,"#",":
                             "#"",PMEVVISN,"#",";
          MATCH     "1",PTCNDAUR
          IF        @EQUAL
            MATCH     SP70,KEY20
            IF        !@EQUAL
              WRITE     HTMLFILE;"#"",KEY20,"#",";
            ELSE
              WRITE     HTMLFILE;"#"",PVIURNO,"#",";
            ENDIF
          ELSE
            WRITE     HTMLFILE;"#"",PVIURNO,"#",";
          ENDIF
          WRITE     HTMLFILE;"#"",PLOCAT,"#",":
                             "#"",EVTYPE,"#",":
                             "#"",PMEVADTE,"#",":
                             "#"",PMEVATIM,"#",":
                             "#"",PMHCGNAM,"#",":
                             "#"",PMEVPPRB,"#",":
                             "#"",PMEVUNIT,"#",":
                             "#"",PMEVSPHN,"#",":
                             "#"",PMEVPBED,"#",":
                             "#"",PMEVSITE,"#",":
                             "#"",PMEVCTYP,"#",":
                             "#"",PMEVCLID,"#",":
                             "#"",CLCODE,"#",":
                             "#"",APPTYPE,"#",":
                             "#"",PMEVASTT,"#",":
                             "#"",ADMTYPE,"#",":
                             "#"",BOKTYPE,"#",":
                             "#"",PATDIET,SP1,ACOMM1,"#",":
                             "#"",CONDESC,DISPDATE,SP1,LPCONDD,SP1,VISPHONE:
                             "#",":
                             "#"",PMEVREFB,"#",":
                             "#"",IMGSRC,"#",":              
                             "#"",PMEVPWRD,"#",":              
                             "#"",CONDICON,"#",":              
                             "#"",KEY3,"#");"              
.         
          GOTO      CLSTAB10     
.
CLSTAB99  RETURN
.*******************************************************************************
.*                Routine For Display of Patient Condtion                      *
.*                                          * Added by HPS-ODC(03.08.01)       *
.*******************************************************************************
GETCON00  MOVE      SP70,LPCONDD
          MOVE      SP70,CONDESC
          MOVE      SP70,DISPDATE
          PACK      KEY88,PTMASNAM,PMPXFNAM,ADMNO,SP70,SP70
          CALL      RDLOCA1
          IF        OVRCD=1
            CALL      CLRLOC00
          ENDIF
          MOVE      "CO",CATEGORY
          MATCH     SP70,LPCONDC
          GOTO      GETCON15 IF EQUAL
          PACK      KEY5,CATEGORY,LPCONDC
          CALL      RDCODE1
          BRANCH    OVRCD,GETCON15
          MOVE      TDESC,CONDESC
          MATCH     SP70,TCINDC1
          IF        @EQUAL
            MOVE      ZERO,TCINDC1
          ENDIF
          GOTO      GETCON20
.
GETCON10  MOVE      SP70,LPCONDD
GETCON15  MOVE      SP70,CONDESC
          MOVE      ZERO,TCINDC1
.
GETCON20  CLEAR     IMGSRC
          APPEND    "ConditionIcon_",IMGSRC
          IF        PCEASE=1
            APPEND    "D",IMGSRC
            MOVE      "Deceased",CONDESC
            MOVE      "D",CONDICON
          ELSE
            APPEND    TCINDC1,IMGSRC
            MOVE      TCINDC1,CONDICON
          ENDIF
          APPEND    ".gif",IMGSRC
          RESET     IMGSRC
.
GETCON99  RETURN
.*******************************************************************************
.*               Clear File Variables of Location File                         *
.*******************************************************************************
CLRLOC00  MOVE      SP70,LSNAME 
          MOVE      SP70,LGNAME 
          MOVE      SP70,PTLCGNM2  
          MOVE      SP70,DLADMNO
          MOVE      SP70,LURNO  
          MOVE      SP70,LPCONDC
          MOVE      SP70,LPCONDD
          MOVE      SP70,LPCDATE
          MOVE      SP70,LPCTIME
          MOVE      SP70,LPCONAM
          MOVE      SP70,LOCSPAR
.
CLRLOC99  RETURN
.
.------------------------------------------------------------
. Visit Type Selection Options
. Category CV - Indictor 6 ="U"navailable slot type
.------------------------------------------------------------
VTYSEL00  MOVE      "CV",CATEGORY
          MOVE      SP70,TDESC
          PACK      KEY5,CATEGORY,SP70
          CALL      RDCODE1
          IF        OVRCD=1
            MOVE      CATEGORY,TCODE
            MOVE      "Invalid Category",TDESC
          ENDIF
          REP       " _",TCODE
          REP       " _",THCSCOD
          WRITE     HTMLFILE;"<!--<cat-c category=#"",TCODE,"#" name=#"",TDESC:
                             "#" map=#"",THCSCOD,"#"></cat-c>-->"
.
          PACK      PTCDKEY2,CATEGORY,SP70
          CALL      RDSCODE2
VTYSEL10  CALL      RDKCODE2
          BRANCH    OVRCD,VTYSEL99
.
          MATCH     CATEGORY,TCODE
          GOTO      VTYSEL99 IF NOT EQUAL
.
          MATCH     SP70,ACODE
          GOTO      VTYSEL10 IF EQUAL
.
          MATCH     CODE,ACODE              * Default code
          GOTO      VTYSEL20 IF EQUAL
.
          MATCH     "I",PTCOACTV            * Skip Inactive
          GOTO      VTYSEL10 IF EQUAL
.
          MATCH     "U",TCINDC6             * Skip Unavailable
          GOTO      VTYSEL10 IF EQUAL
.
VTYSEL20  PACK      KEY15,TCINDC1,TCINDC2,TCINDC3,TCINDC4,TCINDC5:
                          TCINDC6,TCINDC7,TCINDC8,TCINDC9,TCINDC10:
                          TCINDC11,THCSCOD
          PACK      KEY20,QUOTE,ACODE,KEY15,QUOTE
          MATCH     CODE,ACODE
          IF        @EQUAL
            WRITE     HTMLFILE;"<option value=",KEY20," selected>":
                               TDESC,"</option>"
          ELSE
            WRITE     HTMLFILE;"<option value=",KEY20,">",TDESC,"</option>"
          ENDIF
.
          GOTO      VTYSEL10
.
VTYSEL99  RETURN
.
.-----------------------------------------------------------------------------.
. Redirect discharged event to VINAH referral if required
.-----------------------------------------------------------------------------.
VRED0000  COMPARE   THREE,PTCNHDPS               * Victoria only
          GOTO      VRED9999 IF NOT EQUAL
.
......    MATCH     SP70,PMEVDDTE                * Check if discharged
......    GOTO      VRED9999 IF EQUAL
.
          MATCH     SP70,PMEVCTYP                * Check for a clinic type
          GOTO      VRED9999 IF EQUAL
.
          PACK      KEY16,URNUMBER,Z70
          CALL      RSALREF2
VRED1000  CALL      RPALREF2                     * read referrals
          BRANCH    OVRCD,VRED9000
.
          MATCH     URNUMBER,ALREURNO
          GOTO      VRED9000 IF NOT EQUAL
.
          MATCH     "1",ALREUYN4                 * Internel referrals only
          GOTO      VRED1000 IF EQUAL
.
          MOVE      "012",D3
          SCAN      ALRESTAT,D3                  * Waiting, active or closed
          GOTO      VRED1000 IF NOT EQUAL        * referrals only
.
          MATCH     ALRERDAT,PMEVADTE            * Check event is after referral
          GOTO      VRED1000 IF LESS             * date
.
          MATCH     "2",ALRESTAT
          IF        @EQUAL
            MATCH     PMEVDDTE,ALREDCLO          * Check dishcarge is before
            GOTO      VRED1000 IF LESS           * closed date
          ENDIF
.
          MATCH     PMEVCTYP,ALRECTYP            * Same clinic type
          GOTO      VRED1000 IF NOT EQUAL
.
          IF        IBCNMHOS=1
            PACK      KEY8,ALREVISN,SP70
            CALL      RDPMVX11
            BRANCH    OVRCD,VRED1000
.
            MATCH     WBSEHOSP,PMVXMHOS          * My hospital
            GOTO      VRED1000 IF NOT EQUAL
          ENDIF
.
          PACK      KEY5,ANSC,ANSG,ALREDEPT,SP70
          CALL      RDCODE1
          BRANCH    OVRCD,VRED1000
.
          MATCH     SP70,TCINDC8                  * Check if VINAH
          GOTO      VRED8000 IF NOT EQUAL
.
          MATCH     "1",ALCNDEVP                  * Check if using event
          GOTO      VRED1000 IF NOT EQUAL         * program
.
          PACK      KEY5,CATZG,ALREEVPR,SP70
          CALL      RDCODE1
          BRANCH    OVRCD,VRED1000
.
          MATCH     SP70,TCINDC8                  * Check if VINAH
          GOTO      VRED1000 IF EQUAL
.
VRED8000  REP       " +",URNUMBER                 * Redirect to referral
          REP       " +",ALREVISN
          CLEAR     REDIRECT
          APPEND    "allweb02.pbl?reportno=02&template=002",REDIRECT
          APPEND    "&urnumber=",REDIRECT
          APPEND    URNUMBER,REDIRECT
          APPEND    "&admissno=",REDIRECT
          APPEND    ALREVISN,REDIRECT
          RESET     REDIRECT
.
          MATCH     "A",UPDTTYPE            * Add
          IF        @EQUAL
            MOVE      FOUR,NEXTPAGE
          ELSE
            MOVE      ONE,NEXTPAGE
          ENDIF
.
          REP       "+ ",URNUMBER
          REP       "+ ",ALREVISN
          GOTO      VRED9999
.
VRED9000  REP       " +",URNUMBER                * redirect to referral list
          REP       " +",ADMISSNO
          CLEAR     REDIRECT
          APPEND    "allweb02.pbl?reportno=02&template=001",REDIRECT
          APPEND    "&urnumber=",REDIRECT
          APPEND    URNUMBER,REDIRECT
          APPEND    "&admissno=",REDIRECT
          APPEND    ADMISSNO,REDIRECT
          RESET     REDIRECT
.
          MATCH     "A",UPDTTYPE            * Add
          IF        @EQUAL
            MOVE      FOUR,NEXTPAGE
          ELSE
            MOVE      ONE,NEXTPAGE
          ENDIF
.
          REP       "+ ",URNUMBER
          REP       "+ ",ADMISSNO
          GOTO      VRED9999
.
VRED9999  RETURN
.
.*******************************************************************************
.*                          Include I/O Files                                  *
.*******************************************************************************
          INC       IBAWEBCD
          INC       DEATHPOL
          INC       PATNAMCD                * Added by HPS-ODC(03.08.01)       
          INC       NAMSTRCD 
          INC       PATDOCTM
          INC       PATDOCCD
          INC       PATDPATH                                          *I-250985
          INC       PATMASTM
          INC       CLMRTMAS
          INC       CLPMSPX2
          INC       PMSPX2TM
          INC       PMSHCGTM
          INC       PMSHCPTM
          INC       PATMSXTM
          INC       CALCAGE
          INC       MRTVISCD                * I-55191
          INC       PRFAINSR                * Claim insurance details
.
          INC       ALLREFIO/INC
          INC       APSMASIO/INC
          INC       BOKRC1IO/INC
          INC       BOKRX1IO/INC
          INC       IBAPOSIO/INC
          INC       PMSEVTIO/INC
          INC       PATMI1IO/INC
          INC       PATVISIO/INC
          INC       PMSVX1IO/INC          
          INC       PMSCURIO/INC          
          INC       MRTVISIO/INC
          INC       MRTMASIO/INC
          INC       PATMA1IO/INC
          INC       PMSHCGIO/INC
          INC       PMSHCPIO/INC
          INC       PATHOSIO/INC                                      *I-250985
          INC       PMSPX2IO/INC
          INC       PMSMTIIO/INC
          INC       PATALRIO/INC            
          INC       PATDTHIO/INC
          INC       PATDO1IO/INC
          INC       AAEDTRIO/INC        
          INC       OUTSITIO/INC
          INC       PATWR1IO/INC
.
          INC       PMSCCDIO/INC   * Concession Card Details
          INC       PMSUCHIO/INC
          INC       PMSUCDIO/INC
          INC       PATPR1IO/INC
          INC       PATASFIO/INC
          INC       PATFN1IO/INC
          INC       PATIN1IO/INC
          INC       OUTCTYIO/INC
          INC       OUTCLIIO/INC
          INC       OUTBOAIO/INC
.
          INC       CCIEX7IO/INC
.                                           * Added by HPS-ODC(03.08.01)Starts
          INC       PATCMCIO/INC
          INC       PATDGWIO/INC 
          inC       PATITMIO/INC
          INC       PATLOCIO/INC            
          INC       PATRE1IO/INC 
          INC       PATVADIO/INC
          INC       PATDADIO/INC
          INC       PATHSPIO/INC
          INC       NHIMASIO/INC
          INC       NHIETHIO/INC
.                                           * Added by HPS-ODC(03.08.01)Ends
          INC       PMSNUTIO/INC            * v9.02.04
          INC       PMSNUTTM                * v9.02.04
          INC       CLPMSNUT                * v9.02.04
          INC       CLPMSVX1
          INC       CLNHIMAS                * Clear nhimasaf file variables
          INC       CLPATRE1
          INC       GENANVIS
          INC       WEBDATCD
          INC       DAYOFWEK
.
.*******************************************************************************
