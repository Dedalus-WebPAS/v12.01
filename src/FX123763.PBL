.*****************************************************************************
.*    Program      : FX123763                                                *
.*    Description  : Populate patqrdaf from patrdeaf (set episode count to 1)*
.*    Author       : Davin                                                   *
.*    Date         : 28/02/2007                                              *
.*    Modifications:                                                         *
.*****************************************************************************
.
          INC       STD001FD
          INC       PATRDEFD/INC
          INC       PATQRDFD/INC
.
RECNUM    FORM      8
.
PRGNAM    INIT      "Copy patrdeaf to patqrdaf"
PRGID     INIT      "FX123763"
VERSION   INIT      "V12.01.00"
.
. Start of Program
.
MAIN0000  CALL      INIT0000                      * init and open files
          BRANCH    EXIT,MAIN9999                 * init failure
.
          CALL      CONTQST                       * Ok to continue ?
          BRANCH    CEXIT,MAIN1000,MAIN0000,MAIN9999 * Yes, no, cancel
.
. Loop thru patrde and write records ro patqrd with counter = 1
.
MAIN1000  CALL      READ0000                      * read old records and write
.
MAIN9999  CHAIN     PGM
+
.********************************************************************
.*                          INIT0000                                *
.*  Display heading and check that the files needed exist&open them *
.********************************************************************
INIT0000  CALL      DISPHEAD
.
          OPEN      PATRDEA1,"patrdeaf"
          OPEN      PATQRDA1,"patqrdaf"
          MOVE      ZERO,RECNUM
INIT9999  RETURN
+
.**********************************************************************
.*                               READ0000                             *
.*             loop thru old file and write each record               *
.**********************************************************************
READ0000  DISPLAY   *P1:20,*EL,"Records Written  : ";
.
          PACK      KEY10,SP70
          CALL      RSPTRDE1
READ1000  CALL      RKPTRDE1                      * loop thru patrde
          BRANCH    OVRCD,READ6000                * finish
.
          PACK      KEY12,PTRDADMN,PTRDEPNO,SP1,ONE
          CALL      RAPTQRD1
          IF        OVRCD=1
            MOVE      PTRDADMN,PTQRADMN
            MOVE      PTRDEPNO,PTQREPNO
            MOVE      ONE,PTQRCNTR
            MOVE      PTRDBISA,PTQRBISA
            MOVE      PTRDBISD,PTQRBISD
            MOVE      PTRDCLSP,PTQRCLSP
            MOVE      PTRDODTE,PTQRODTE
            MOVE      PTRDARTR,PTQRARTR
            MOVE      PTRDUSRF,PTQRUSRF
            MOVE      PTRDPCSA,PTQRPCSA
            MOVE      PTRDPCSD,PTQRPCSD
            MOVE      PTRDRGAA,PTQRRGAA
            MOVE      PTRDRGAD,PTQRRGAD
            MOVE      PTRDSRPC,PTQRSRPC
            MOVE      PTRDFIMA,PTQRFIMA
            MOVE      PTRDFIMD,PTQRFIMD
            MOVE      PTRDDIAG,PTQRDIAG
            MOVE      PTRDCOM1,PTQRCOM1
            MOVE      PTRDCOM2,PTQRCOM2
            MOVE      PTRDFADT,PTQRFADT
            MOVE      PTRDFDDT,PTQRFDDT
            MOVE      PTRDSPAR,PTQRSPAR
.
            PACK      KEY12,PTQRADMN,PTQREPNO,PTQRCNTR
            CALL      WRPTQRD1              * write record to patqrd
            ADD       ONE,RECNUM            * update record counter
          ENDIF
.
          IF        (RECNUM%500) = 0
            DISPLAY   *P19:20,*V2LON,RECNUM,PTRDADMN
          ENDIF
.
          GOTO      READ1000                      * check next code record
.
READ6000  CLOSE     PATRDEA1                      * close files
          CLOSE     PATQRDA1
.
          CALL      IBACLOCK
          CLOCK     TIME,CTIMEIS
          DISPLAY   *P1:20,*EL,"Records Written  : ",RECNUM
          DISPLAY   *P1:22,"Ended  : ",CDATE,SP1,CTIMEIS
          DISPLAY   *P1:24,*EL;
          CALL      HITENTER
.
READ9999  RETURN
.
+
.**********************************************************************
.
          INC       PATRDEIO/INC
          INC       PATQRDIO/INC
          INC       STD001IO
