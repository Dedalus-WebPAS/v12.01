.---------------------------------------------------------------------- 
. Program       : IHIWEB04 
.
. Function      : NIHC IHI Server 4 - AJAX Server for MyHRViewer / 
.                                     Patient Summary JWT Token
.                                     Auth Generation
.
. Modifications :
.----------------------------------------------------------------------
. V11.04.06 15/07/2024  Peter Vela       TSK 0939978
.           Allow status 27 in VALSIH20
. V11.04.05 19/06/2024  Peter Vela       TSK 0939978
.           Modified configurable hours validation in VALSIH20
.           The last successful IHI Lookup must be inside the configurable hours
.           Also added check for exceptions in pmsiheaf
. V11.04.04 05.06.2024  DA Sarkies       TSK 0939978
.           Added instruction to IHI error message  
. V11.04.03 14/05/2024  Peter Vela       TSK 0939978
.           Added delete tempfiles at JWT generation
. V11.04.02 09/04/2024  Peter Vela       TSK 0939978
.           Added remote script to check if there is a successful IHI Lookup 
.           within X hours (PTCNIHIV)
. V11.04.01 15/02/2024  Peter Vela       TSK 0939978
.           Added remote script for MyHR Episode Upload Auth Token Generation
.           10/01/2024  Peter Vela       TSK 0939978
.           Recompiled for PMSNDBFD - Added Episode and Upload URLs
. V11.03.01 23/09/2023  Peter Vela       TSK 0935874
.           Created NIHC IHI Server 4 - Dedicated AJAX Server for NIHC 
.                                       MyHRViewer Auth Generation
.------------------------------------------------------------
          INC       IBAWEBDF    
.
          INC       TMPALIFD/INC
          INC       NZHISIFD/INC
.
          INC       OBSDIATD
          INC       FHRDATDF
          INC       ACCDIAFD/INC                 * AE Diagnosis
          INC       ARCVX1FD/INC                 * archive visit table
          INC       EMRECTFD/INC
          INC       EMRECAFD/INC
          INC       EMRIBHFD/INC
          INC       EMRICDFD/INC                 * AE Diagnosis Codes
          INC       HICEMSFD/INC
          INC       OUTEADFD/INC
          INC       OUTEAHFD/INC
          INC       OUTECAFD/INC
          INC       OUTECTFD/INC
          INC       OUTERHFD/INC
          INC       OUTERDFD/INC
          INC       OUTIBHFD/INC
          INC       PRIALSFD/INC
          INC       PRIECTFD/INC
          INC       PRIECAFD/INC
          INC       PRIEAHFD/INC
          INC       PRIEADFD/INC
          INC       PRIESHFD/INC
          INC       PRIESDFD/INC
          INC       PMSETRFD/INC
          INC       PRIIBHFD/INC
          INC       PRIHDBFD/INC                 * holding header file
          INC       PRIPRAFD/INC
          INC       PRIHREFD/INC                 * referral file
          INC       PRIDTRFD/INC
          INC       PRICONFD/INC
          INC       PRIHRETD/INC
          INC       APSMASFD/INC
          INC       BOKRC1FD/INC
          INC       BOKRX1FD/INC
          INC       BOKDIAFD/INC
          INC       EMRCONFD/INC
          INC       EMRUNKFD/INC
          INC       EMRVISFD/INC
          INC       IBADLABS/INC
          INC       OPLBVARS/INC
          INC       PATALRFD/INC
          INC       PATCALAG/INC
          INC       PATCONFD/INC
          INC       PMSCDNFD/INC
          INC       PMSECOFD/INC
          INC       PMSIHEFD/INC
          INC       PMSNPLFD/INC
          INC       MEHCONFD/INC
          INC       MEHLEGFD/INC
          INC       MLTSECFD/INC
          INC       PMSUCHFD/INC
          INC       PMSUCDFD/INC
          INC       PATMASTD/INC
          INC       VISMDTFD/INC
          INC       VISMTXFD/INC
          INC       PATCFAFD/INC
          INC       PATCHCFD/INC
..        INC       PATCURFD/INC
          INC       PATDHEAD/INC
          INC       PATDGWFD/INC
          INC       PATDO1FD/INC
          INC       PATDSCFD/INC
          INC       PATFLTFD/INC
          INC       PATFX1FD/INC
          INC       PATPEIFD/INC
          INC       PATUNAFD/INC
          INC       PATMESFD/INC
          INC       PMSCTCFD/INC
          INC       PMSOVRFD/INC
          INC       PMSOVVFD/INC
          INC       PMSHCGFD/INC
          INC       PMSHCPFD/INC
          INC       PMSTLEFD/INC            * Patient Titles table
          INC       PATGSRFD/INC
          INC       PATFACFD/INC
          INC       PATICDFD/INC
          INC       PATICOFD/INC
          INC       PATICUFD/INC
          INC       PATITMFD/INC
          INC       PATIN1FD/INC
          INC       PATINVFD/INC
          INC       PATMI1FD/INC
          INC       PATMA1FD/INC
...          INC       HL7BMTFD/INC
          INC       PATMMBFD/INC
          INC       PATNIDFD/INC
          INC       PATONLFD/INC
          INC       PATPA1FD/INC
          INC       PATPR1FD/INC
          INC       PATRE1FD/INC
          INC       PATRE1TD/INC            * Person Responsible for Acct Cgi's
          INC       PATRGMFD/INC
          INC       PATPGRFD/INC
          INC       PATTRNFD/INC
          INC       PATVADFD/INC
          INC       PATVISFD/INC
          INC       NZPSPRFD/INC
          INC       MEHLERFD/INC
          INC       MEHVI1FD/INC
          INC       PATWC1FD/INC
          INC       PATCLMTD/INC   * Claim cgi variables
          INC       PMSBRQFD/INC
          INC       PMSCCDFD/INC   * Concession Card Details
          INC       PMSWX1FD/INC
          INC       ACCCMTFD/INC   * ACC (nz) Comments File
          INC       ACCLODFD/INC   * ACC Claim Lodgements
          INC       PMSWORFD/INC
          INC       PMSWORTD/INC
          INC       PATWR1FD/INC
          INC       PATWVEFD/INC
          INC       PATEORFD/INC
          INC       PATFN1FD/INC
          INC       PATWMAFD/INC
          INC       PMSEVTFD/INC
          INC       MRTAUCFD/INC
          INC       MRTLOCFD/INC
          INC       MRTMASFD/INC
          INC       MRTHISFD/INC
          INC       MRTSTFFD/INC
          INC       MRTPDSFD/INC
          INC       MRTVISFD/INC
          INC       OUTCONFD/INC
          INC       OUTSITFD/INC
          INC       OUTCLIFD/INC
          INC       OUTBOAFD/INC
          INC       OUTCANFD/INC
          INC       OUTRF1FD/INC
          INC       OUTRSHFD/INC
          INC       OUTBB1FD/INC
          INC       OUTMA1FD/INC
          INC       OUTHEDFD/INC
          INC       OUTCTYFD/INC
          INC       OUTSESFD/INC
.
          INC       PATECDFD/INC
          INC       PATECOFD/INC
          INC       RESLNKFD/INC
          INC       PMSCLTFD/INC
          INC       PMSCLTTD/INC
          INC       PMSPX2FD/INC
          INC       PMSPX2TD/INC
          INC       NZPSPRTD/INC
          INC       SAVPX2FD/INC
..          INC       WATSUSFD/INC
          INC       PATW11FD/INC                                       *I-43498
          INC       PATW12FD/INC            * WIES12                   *I-51504
          INC       PTW12BFD/INC            * WIES12B
          INC       PATW13FD/INC            * WIES13
          INC       PATW14FD/INC            * WIES14                  *I-145161
          INC       PATW15FD/INC            * WIES15
          INC       PATW16FD/INC            * WIES16
          INC       PATW17FD/INC            * WIES17
.
.    ****** HPS BLR INCLUDE  STARTS HERE    **********
.
          INC       PATASFFD/INC
          INC       PATSFAFD/INC
          INC       PATDADFD/INC
          INC       PMSVX1FD/INC
          INC       OPRDEAFD/INC
          INC       AAEDI1FD/INC
          INC       AAEDE1FD/INC
          INC       PATHSPFD/INC
          INC       OUTDIAFD/INC
          INC       WATTR1FD/INC
          INC       WATTX1FD/INC
          INC       ALLCONFD/INC
          INC       ALLREFFD/INC
          INC       ALLRLNFD/INC
          INC       ALLENCFD/INC
          INC       ALLDEPFD/INC
.
.   ****** HPS BLR CODE ENDS HERE           **********
.
          INC       PRISECFD/INC
          INC       PRIINVFD/INC
          INC       PMSAIDFD/INC
          INC       PMSHCLFD/INC
          INC       PMSHCGTD/INC
          INC       PMSHCPTD/INC
          INC       PMSRESFD/INC
          INC       PMSNDBFD/INC
          INC       PMSNDBTD/INC
          INC       WEBDATDF
          INC       PMSNUTFD/INC
          INC       PMSNUTTD/INC
          INC       NHIDNRFD/INC
          INC       NHIMASFD/INC
          INC       NHIETHFD/INC
          INC       PATCMCFD/INC
          INC       OBSRESFD/INC
          INC       OBSPHYFD/INC
          INC       OBSCALFD/INC
          INC       OBSDITFD/INC
          INC       OBSMEDFD/INC
          INC       OBSPINFD/INC
          INC       OBSCNCFD/INC
          INC       OBSCNAFD/INC
          INC       OBSCNBFD/INC
          INC       OBSDIAFD/INC
          INC       OBSPROFD/INC
          INC       OBSBHIFD/INC
          INC       OBSBPHFD/INC
          INC       OBSREAFD/INC
          INC       OBSLABFD/INC
          INC       TFILEVAR/INC
          INC       VARGBCRN/INC            * I-48227
          INC       VISPAYFD/INC
          INC       ALLCASFD/INC
          INC       PMSEDGFD/INC       * Effective DRG Dates
          INC       PATMISTD/INC
          INC       WEBB2BFD/INC
          INC       WEBB2BTD/INC
          INC       WEBOPVFD/INC
          INC       WEBOVVFD/INC
          INC       WEBOECFD/INC
          INC       WEBOEMFD/INC
          INC       WEBPARFD/INC
.
ACCPORDN  DIM       20
AAEVFLAG  FORM      1                       * AAE visit flag 0=No 1=Yes
ALLHFLAG  FORM      1       * 'All' hospital flag
BATCHNUM  DIM       8
COLRFLAG  DIM       15
CMDLINE   DIM       500
DESCDPST  DIM       20
EXPCDATE  DIM       8                       * expc discharge date in CCYYMMDD
VALDTYPE  FORM      1
VALDCODE  DIM       70
VALDHOSP  DIM       3
VALDUSER  DIM       10
VALDROLE  DIM       50
VALDTAUD  DIM       50
VALDURNO  DIM       8
VALDVISN  DIM       8
EVNTFLAG  FORM      1
EMREVENT  FORM      1
EXPCTDSC  DIM       20
ASESDESC  DIM       7
ASESDES1  INIT      "Accept."
ASESDES2  INIT      "Reject."
ASESDES3  INIT      "Warning"
ASESDES4  INIT      "Compl. "
MEDSDESC  DIM       70
MEDSDES1  INIT      "Patient identification amended"
MEDSDES2  INIT      "Patient Medicare Issue number changed"
MEDSDES3  INIT      "Patient Medicare Number changed"
MEDSDES4  INIT      "Patient card used will expire shortly"
MEDSDES5  INIT      "Patient card expired. Future services may be rejected"
MEDSDES6  INIT      "Old Medicare issue number for patient. Future services may be rejected"
PRCSDESC  DIM       25
PRCSDES1  INIT      "RECEIVED"
PRCSDES2  INIT      "MEDICARE_UNVERIFIED"
PRCSDES3  INIT      "MEDICARE_VERIFIED"
PRCSDES4  INIT      "HEALTH_FUND_UNVERIFIED"
PRCSDES5  INIT      "HEALTH_FUND_VERIFIED"
PRCSDES6  INIT      "MEDICARE_ASSESSING"
PRCSDES7  INIT      "HEALTH_FUND_ASSESSING"
PRCSDES8  INIT      "MEDICARE_REJECTED"
PRCSDES9  INIT      "HEALTH_FUND_REJECTED"
PRCSDE10  INIT      "REQUEST_DELETE"
PRCSDE11  INIT      "COMPLETE"
SFACDESC  DIM       7
SFACDES1  INIT      "Accept."
SFACDES2  INIT      "Reject."
SFACDES3  INIT      "Warning"
ARCFLAG   FORM      1
OVRFLAG   FORM      1
OVVFLAG   FORM      1
AUDITDTE  DIM       12
BEDTDESC  DIM       15
BLNKFLAG  FORM      1
CPPURNO   DIM       8
DISPDATE  DIM       11
NZHISMOD  FORM      1         * NZHIS change mode indicator
FILNHIAF  FILE      ASCII, FIXED=256       * tmp save file for forking
FILTDEPT  DIM       3
DEFTFLAG  FORM      1
TOTALALI  FORM      3
NEXTPAGE  DIM       1                       * Nextpage parameter CGI parameter
UPDTTYPE  DIM       1                       * Update Type
UPDATETY  FORM      1
UPDATTYP  DIM       1
URCOMFLG  FORM      1
UROUTPUT  DIM       20[50]
UROUTEND  FORM      3
PATALTID  DIM       20
PMSALTID  DIM       20
PMSOVRKY  DIM       26
PMSOVVKY  DIM       26
PRODDIND  DIM       1
NIHCDIND  DIM       1
.
ATCHAR    INIT    "@"
ACCIDATE  DIM       11                      * Accident Date
PDCDATE   DIM       11                      * Patient Declaration Date
DECDATE   DIM       11                      * ACC Decline Date 
ACDNTFLG  FORM      1
BTSCHOSP  DIM       3
..NRCDAYS   FORM      5
..LSTDAYS   FORM      5
WARNFLAG  FORM      1
WIESFILE  DIM       8
WARDBED   DIM       7
COUNT     FORM      3
TACCOUNT     FORM      3
WCOCOUNT     FORM      3
CLAIMSTA  DIM       2
DEFAULTA  DIM       1    * default to all on visit list by type 0=no 1=yes
DIM3      DIM       3
DIM5      DIM       5
DIM7      DIM       7
DIM8      DIM       8
DIM10     DIM       10
DIM11     DIM       11
DIM16     DIM       16
DIM18     DIM       18
DIM20     DIM       20
DIM22     DIM       22
DIM24     DIM       24
DIM27     DIM       27
DIM30     DIM       30
DIM50     DIM       50
DIM100    DIM       100
DIM100A   DIM       100
DIM100B   DIM       100
DIM100C   DIM       100
DIM100D   DIM       100
DIM100E   DIM       100
DIM100F   DIM       100
DIM100G   DIM       100
DIM100H   DIM       100
DIM100I   DIM       100
DIM100J   DIM       100
DIM100K   DIM       100
DISWARD   DIM       3
DISUNIT   DIM       3
DISBED    DIM       3
DISPUSER  DIM       30
DISPDATT  DIM       25
DISPFLAG  FORM      1 
DRG041    INIT      "041"
DRG042    INIT      "042"
DRG050    INIT      "050"
DRG051    INIT      "051"
DRG052    INIT      "052"                                             *I-137125
DRG060    INIT      "060"                                             *I-197814
.
EXDTBLNK  FORM      1
ECOTFUND  DIM       6
ECOTTYPE  DIM       1
ECOTTRID  DIM       24
ECCLFBID  DIM       3
ECCLARID  DIM       20
ECCLCLID  DIM       6 
ECCLRPTC  DIM       3
ECCLITMN  DIM       5
ECCLSRVC  DIM       3
ECCLRKEY  DIM       24                    *Report Retrieve Key
.
FORM6     FORM      6
FORM6P2   FORM      6.2
FORM6P2A  FORM      6.2
FORM7P2C  FORM      7.2
FORM7P2O  FORM      7.2
FILTFDAT  DIM       8
FILTTDAT  DIM       8
FILTURNO  DIM       8
FILTADMN  DIM       8
.
HOSPCODE  DIM       3
HOUR      FORM      2
HOURDIM   DIM       2
HTMLLNK2  DIM       127
.
LASTWBED  DIM       6
LASTDOCT  DIM       6
LASTTYPE  DIM       3
LOOPCNTR  FORM      1
.
MIN       DIM       2
MINTIME   FORM      2
MINUTES   FORM      3
NMPNUMB   DIM       20
.
TIME      FORM      3
.
CLAIMFLG  FORM      1
CLMUPDFL  FORM      1
CODERNAM  DIM       35                       * Coder Name
CODEDFLG  FORM      1
CLNOT001  DIM       3                        * Type of Note
CLNOTEID  DIM       4                        * Clinical Note ID
CATct     INIT      "ct"
CATCL     INIT      "CL"
CATD1     INIT      "D1"
CATD2     INIT      "D2"
CATD3     INIT      "D3"
CATD4     INIT      "D4"
CATD5     INIT      "D5"
CATU6     INIT      "U6"
CATU7     INIT      "U7"
CATUC1    INIT      "wa"                    * Category User Def Code 1
CATUC2    INIT      "wb"                    * Category User Def Code 2
CATUC3    INIT      "wc"                    * Category User Def Code 3
CATUC4    INIT      "wd"                    * Category User Def Code 4
CATUC5    INIT      "we"                    * Category User Def Code 5
CATUC6    INIT      "wf"                    * Category User Def Code 6
CATUC7    INIT      "wg"                    * Category User Def Code 7
CATUC8    INIT      "wh"                    * Category User Def Code 8
CATLVI    INIT      "vi"                    * category vi Discharge Prep Status
HYPHEN    INIT      "-"
NOTESKEY  DIM       12                      * Noteskey
.DIM2A     DIM       2                       * Time in Hours
DIM2B     DIM       2                       * Time in Minutes
LINKTYP   DIM       1                       * 0=Desc 1=Code 2=Select List
CATHLV    INIT      "w2"                    * Category Highlight Level
SEVRDESC  DIM      20
SELECTIO  DIM       1                       * Select IO Template No.
SDOCFNAM  DIM       50
SHOWCDMI  DIM       1                       * Show Event Level CDM Icons
TXTLEN    FORM      3                       * Text Length
VISITNUM  DIM       4                       * Visit Number
VISCMFLG  FORM      1
FILENAMA  DIM       8                       * FileName of OBCAxxxx
FILENAMB  DIM       8                       * FileName of OBCBxxxx
OBCA      INIT      "obca"
OBCB      INIT      "obcb"
FAOPEN    DIM       8                       * OBCA File that is Open
FBOPEN    DIM       8                       * OBCB File that is Open
WBSEC008  DIM       3                        * Occupational Group
ALRTFLTR  DIM       2
CASEKEYS  DIM       28
CTYPDESC  DIM       25
CCRDTYPE  DIM       20
CCRDNUMB  DIM       20
CCRDEXDT  DIM       12
DELFLAG   FORM      1
EXCLWAIT  FORM      1
EXCLCLOS  FORM      1
FAILCNT   FORM      1
FILTFLAG  FORM      1
FILTHOSP  DIM       3
FILTVTYP  FORM      2
INFORMGP  DIM       1
OUTCDESC  DIM       25
UNKNFLAG  FORM      1                                                  *I-51223
VISTRCOD  DIM       20
VISTDESC  DIM       25
VTYPDESC  DIM       25
VISTDATE  DIM       11
VISTFLAG  FORM      1
VISTTIME  DIM       10
CODDFLAG  FORM      1
DISCFLAG  FORM      1
DDRGCODE  DIM       4
DMDCCODE  DIM       4
DRGVER    DIM       3
PUBLFLAG  FORM      1
HDPEQUIV  DIM       2
HISTDATE  DIM       8
HISTTIME  DIM       5
HISTREQB  DIM       35
HISTLOCN  DIM       30
DESCSNAG  DIM       20
DESCHOME  DIM       30
DESCCLOC  DIM       30
DESCDOCM  DIM       30
DTYPDESC  DIM       25
HWDSOUR   DIM       3                          * S37/P137 - WATCONFD
DISPSUR   DIM       8                          * Display Saved U/R Number
DISPMUR   DIM       8                          * Display Merged U/R Number
.
CHARCR    INIT      0x0D
ERRFLAG   FORM      1
EMRFLAG   FORM      1
INVNUMBR  DIM       8
HOSPNAME  DIM       50
LENPTR    FORM      2
CODEFA    INIT      "FA"
IPEVENT   INIT      "EV-IP"
OPEVENT   INIT      "EV-OP"
EMEVENT   INIT      "EV-EM"
SAVDATE   DIM       8
SAVTIME   DIM       8
SAVCHDT   DIM       8
SAVCHTM   DIM       8
SAVCHUD   DIM       4
SAVCLMNO  DIM       20
SAVETRID  DIM       24
SAVPSNAM  DIM       20
SHOWMAP   FORM      1
SHOWSJOG  FORM      1
SUPERECL  FORM      1         * Eclipse Supervisor flag (1=yes/0=no)
VIEWINDI  FORM      1
PATLINK   DIM       127                     * Link to the next patient info
UPDLINK   DIM       400
CODTYP    FORM      2
DISNAM70  DIM       70
NAME70    DIM       70
STARTNOT  FORM      4
ZEROTWO   INIT      "02"
FORM3     FORM      3
FORM8     FORM      8
FORM8A    FORM      8
CATDESC   DIM       25
CODDESC   DIM       25
CODESTAT  FORM      1
EPISODNO  FORM      2                       * Episode No
EPSCD001  FORM      2                       * Episode No (CGI Parameter)
EPSSLIST  FORM      1[99]                   * Episode Select List
.
FINFLAG   FORM      1
NMDSLIST  DIM       1                       * Show Update Medical Record        
RECCNT    FORM      3
DRECCNT   DIM       3
CHECKCNT  FORM      1
VISCOUNT  FORM      5
NOURSELC  DIM       1
OUTVISTT  DIM       1
OUTPSITE  DIM       6                       
OUTADMIS  DIM       8
OUTORDER  DIM       1                       * 0 = bookings the visit
.                                           * 1 = visits then bookings
REFTDESC  DIM       20
SHOWFRMT  DIM       1                       * Display format for visit list     
.                                           * 0 = Standars 1 = kids
SAVADMNO  DIM       8
STARTKEY  DIM       50
SHOWMEDL  DIM       1                       * Show Update Medical Record        
.                                           * 0 = No 1 = Yes
SRCHVIEW  FORM      1                       * Show format for visit search
.                                           * 1 = Allied Health Visit Search
TIMEZONE  DIM       6
.
.         HPS BLR Comment Ends Here
MAVBATCH  DIM       8
MAVINVCE  DIM       8
MAVMODUL  DIM       1
MBSDESC   DIM       40
MOVEDESC  DIM       25
MRGEFLAG  FORM      1
MOVEADM   INIT      "Admission "
MOVECHG   INIT      "Change    "
MOVEDIS   INIT      "Discharged"
MOVELVE   INIT      "On Leave  "
MOVERET   INIT      "Return    "
MEH01     INIT      "MEHWEB01"
.
ALIASIND  DIM       1
ADMISSF8  FORM      8
ATYPDESC  DIM       25
BEDTRKEY  DIM       30
BTYPDESC  DIM       25
WARDNAME  DIM       25
TODAY     DIM       8
TRANDATE  DIM       12
ADMNDATE  DIM       12
DISCDATE  DIM       12
DATOFBIR  DIM       11
.
DLINKPRG  DIM       8
DLINKREP  DIM       2
DLINKTEM  DIM       3
.
EMPLNAME  DIM       30
EMPLADD1  DIM       35
EMPLADD2  DIM       35
EMPLADD3  DIM       35
EMPLADD4  DIM       35
.
LINKNUM   DIM       2
EPISODE   DIM       2
DOCTCODE  DIM       6
DSCHFLAG  FORM      1
PMVXFLAG  FORM      1
PMSVX044  DIM       3     * Coder Snags
PRIDISCD  DIM       9     * Primary Disease Code - I CAR 18122
PDIADESC  DIM       70    * Primary Disease Code Description - I CAR 18122
PRIOPRCD  DIM       9     * Primary Operation Code
POPRDESC  DIM       70    * Primary Operation Code Description
.PTVIS067  DIM       50    * Diet Comment - I SRF 22685
BRECFLAG  FORM      1
BOOKFLAG  FORM      1     * Book Referral Letter Flag
.
DOWNLD01  FORM      1
DOWNLD02  FORM      1
DOWNLD03  FORM      1
DOWNLD04  FORM      1
DOWNLD05  FORM      1
DOWNLD06  FORM      1
DOWNLD07  FORM      1
DOWNLD08  FORM      1
.
KEY1A     DIM       1
KEY4A     DIM       4
.DIM4      DIM       4
DIM6      DIM       6
DIM9      DIM       9
DRGFLAG   FORM      1
HLFDCLTY  DIM       1
HLTHFUND  DIM       6
TEMPINVN  DIM       8         * Invoice Number
TEMPBATN  DIM       8         * Batch Number
TEMPADMN  DIM       8         * Admission Number
TEMPURNO  DIM       8         * U/R Number
TEMPHFND  DIM       6         * Health Fund
TEMPPBAT  DIM       8         * Previous Batch Number
TEMPHOSP  DIM       3         * Hospital Code
TEMPMODL  DIM       1
TTYPEARG  DIM       2
TOTOUTS   FORM      12.2
TOTPAID   FORM      12.2
SLOTNUMB  DIM       3
SAVEURNO  DIM       8
SRCHTYPE  FORM      1
PROCSTAT  DIM       1
NEXTVKEY  DIM       26
PREVVKEY  DIM       26
SKEY31    DIM       31
PREVFLAG  FORM      1  
SAVKEY26  DIM       26
SAVKEY44  DIM       44
INPATVIS  INIT      " 3"
OUTPVIS   INIT      " 2"
EMERGVIS  INIT      " 1"
ALLIVIS   INIT      "10"
EVENVIS   INIT      " 9"
SITEDONE  FORM      1
SUMOUTS   FORM      12.2
SUMPAID   FORM      12.2
SUMINV    FORM      12.2
SUMJR     FORM      12.2
SHOWFLAG  FORM      1
.
UNIQNUMB  DIM       8
.PRHRE001  DIM       6
.PRHRE002  DIM       10
.PRHRE003  DIM       3
.
CFILEPRE  DIM       3
WAITSTAT  FORM      1
STATDESC  DIM       20
STATCODE  DIM       1
CLAIMCOD  DIM       6
CLAIMTYP  DIM       1
UNITCODE  DIM       6
UNITDESC  DIM       20
PRIODESC  DIM       25
SRCRDESC  DIM       25
PRIOSTAT  DIM       25
PRIOOVER  DIM       8
OVERSTAT  DIM       1
RSUBINDI  FORM      1
.
PATPA001  DIM       8     * Patient U/R Number
PATPA002  DIM       8     * Date this add was changed (CCYYMMDD)
.PATPA003  DIM       35    * Previous Address Line 1
.PATPA004  DIM       35    * Previous Address Line 2
.PATPA005  DIM       35    * Previous Suburb
.PATPA006  DIM       35    * Previous Address Line 4
.PATPA007  DIM       8     * Previous Postcode
.PATPA008  DIM       20    * Previous Private Telephone
.PATPA009  DIM       20    * Previous Business Telephone
.PATPA010  DIM       3     * District of Residence
.PATPA011  DIM       20    * Previous Mobile Phone Number
.PATPA012  DIM       10    * Web User ID
.
SMPOLIC    DIM      20   * POLICE STAT. ACCT REPORTED TO
SMACDAT    DIM       8   * DATE OF ACCIDENT (YYMMDD)
SMSNAME    DIM      30   * SOLICITOR NAME
SMSTELE    DIM      12   * SOLICITOR TELEPHONE
SMCREGO    DIM      36   * CAR REGO NUMBERS INVOLVED
SMACLOC    DIM      40   * ACCIDENT LOCATION
SMDPINDI   FORM      1   * 1= DRIVER, 2= PASSENGER
SMENGAGE   DIM      20   * WHILE ENG IN-FREE FORMAT ENTRY
SMPINJUR   DIM      30   * PATIENT INJURED WHEN
SMMDTRAN   DIM      10   * MODE OF TRANSPORT
SMMECHSE   DIM      30   * MECHANISM OF SEVERIST INJURY
SMREGNSE   DIM      20   * REGION OF SEVERIST INJURY
SMOTHDE1   DIM      30   * OTHER DRIVER DETAILS LINE 1
SMOTHDE2   DIM      30   * "     "      "     LINE 2
SMOTHDE3   DIM      30   * "     "      "     LINE 3
SPTWMTAC   FORM      1   * TAC CLAIM FORM COMPLETED ?
SPTWMTYP   DIM       3   * Role in Accident (CAT RA)
.
SUPERLEV  DIM       1
SWCENAME  DIM      30    * EMPLOYER NAME
SWCEADD1  DIM      35    * EMPLOYER ADDRESS LINE 1
SWCEADD2  DIM      35    * EMPLOYER ADDRESS LINE 2
SWCEADD3  DIM      35    * EMPLOYER ADDRESS LINE 3
SWCEADD4  DIM      35    * EMPLOYER ADDRESS LINE 4
SWCEPOST  DIM       8    * EMPLOYER POSTCODE
SWCETELE  DIM      20    * EMPLOYER TELEPHONE
SWCACDAT  DIM       8    * DATE OF ACCIDENT (YYMMDD)
SWCACCPT  FORM      1    * ACCEPTED BY INSURANCE COMPANY
SWCICODE  DIM       6    * INSURANCE COMPANY CODE
SWCCLMNO  DIM      20    * INSURANCE CLAIM NUMBER 
SWCCOMN1  DIM      40    * COMMENTS
SWCCOMN2  DIM      40    * COMMENTS
SPMWXALO  DIM      50    * Accident Location                  
SPMWXCIN  DIM      3     * Cause of Injury (Cat IK)           
SPMWXICO  DIM      3     * Injury Code (Cat IJ)               
SPMWXCNA  DIM      40    * Contact Name                       
.
COMMTYPE  DIM       3    * Comment Type
COMMLINO  DIM       3    * Comment Line No
COMMCONT  FORM      3    * Comment Count
SAVDATA1  DIM       65 
SAVDATA2  DIM       100 
.
TYPEDESC  DIM       20
TYPOFREQ  FORM      2             * Eclipse type of request
.
NULL      EQU      000
.
.
PTMMB001  DIM        9             * MBS Code
PTMMB002  FORM       8             * Admission Number
PTMMB003  FORM       2             * Record number for admission
PTMMB004  DIM        8             * Operation Date
PTMMB005  DIM        5             * Operation Start Time
PTMMB006  DIM        5             * Operaton End Time
PTMMB007  DIM       70             * Free Format description
DIM40     DIM       40
.
DASH      INIT      "-"
PFFUND    DIM       1     * Program Funding Source
CBOOK     FORM      1     
HBWAIT    FORM      1 
.
CFPAYCOD  DIM       3        * 3M Codefinder PAY Code
.
.
WAITST01  INIT      "Unscheduled  "
WAITST02  INIT      "Scheduled    "
WAITST03  INIT      "Pre-Admitted "
WAITST04  INIT      "Admitted     "
WAITST05  INIT      "Discharged   "
WAITST06  INIT      "Removed      "
WAITST07  INIT      "Performed    "
WAITST08  INIT      "Not Performed"
ENDDAT    DIM       8
ENDDTIME  DIM       5
TACRECKY  DIM       8[50]
WCORECKY  DIM       8[50]
ERRORCNT  FORM      3                 * Count of Errors
ERRORLST  DIM       90[50]            * Error Array
.
.   ****** MEDICARE WEBSERVICES PRODA MANAGEMENT VARIABLES ***********
.
WBSPROID  DIM       60                * Product ID
WBSJKSLO  DIM       60                * JKS/Certificate File Location
WBSPRORG  DIM       60                * PRODA Organisation ID
WBSDVNAM  DIM       60                * Device Name
WBSCLIID  DIM       60                * Client ID
WBSACTAU  DIM       60                * Access Token Audience
WBSACTVC  DIM       60                * Activation Code
WBSDACUR  DIM       60                * Device Activation URL
WBSDAUUR  DIM       60                * Device Authentication URL
WBSRDKUR  DIM       60                * Refresh Device Key URL
WBSWSCLI  DIM       60                * WebServices Claiming Client Id
WBSLOCAT  DIM       60                * Location Id
WBSNOTEM  DIM       60                * Notification Email
WBSOPVWU  DIM       150               * OPVW URL
WBSOVVWU  DIM       150               * OVVW URL
WBSOECWU  DIM       150               * OECW URL
WBSIMWAG  DIM       150               * IMCW AG URL
WBSIMWSC  DIM       150               * IMCW SC URL
WBSIMWMO  DIM       150               * IMCW MO URL
WBSIMWMB  DIM       150               * IMCW MB URL
WBSSTSWU  DIM       150               * STSW URL
WBSMRTVU  DIM       150               * IMCW RTVW URL
WBSERTVU  DIM       150               * ERAW RTVW URL
WBSGPRWU  DIM       150               * GPRW URL
WBSPMWAG  DIM       150               * IMCW AG URL Speciality
WBSPMWSC  DIM       150               * IMCW SC URL Speciality
WBSPMWMO  DIM       150               * IMCW MO URL Speciality
WBSPMWMB  DIM       150               * IMCW MB URL Speciality
WBPAMWAG  DIM       150               * IMCW AG URL Pathology
WBPAMWSC  DIM       150               * IMCW SC URL Pathology
WBPAMWMO  DIM       150               * IMCW MO URL Pathology
WBPAMWMB  DIM       150               * IMCW MB URL Pathology
WBSIHCPR  DIM       150               * IHCW PR URL
WBSIHCPU  DIM       150               * IHCW PU URL
WBSHRTVU  DIM       150               * IHCW RTVW URL
WBSPCIGU  DIM       150               * PCIW Gen URL
WBSSDDWU  DIM       150               * SDDW Gen URL
WBSBBSGU  DIM       150               * BBSW Gen URL
WBSBBSSU  DIM       150               * BBSW Spe URL
WBSPCISU  DIM       150               * PCIW Spe URL
WBSBPRWU  DIM       150               * BPRW URL
WBSBPYWU  DIM       150               * BPYW URL
WBSOEMWU  DIM       150               * OECW-ECM URL
.
WBSPILAB  DIM       17                * Product ID Label
WBSJKLAB  DIM       20                * JKS File Location Label
WBSPOLAB  DIM       18                * Proda Org Id Label
WBSDNLAB  DIM       18                * Device Name Label
WBSCILAB  DIM       16                * Client ID Label
WBSATLAB  DIM       27                * Access Token Audience Label
WBSACLAB  DIM       22                * Activation Code Label
WBSDALAB  DIM       27                * Device Activation URL Label
WBSDULAB  DIM       31                * Device Authentication URL Label
WBSRDLAB  DIM       27                * Refresh Device Key URL Label
WBSWSLAB  DIM       27                * WebServices Claiming Client Id Label
WBSLOLAB  DIM       18                * Location Id Label
WBSNOLAB  DIM       25                * Notification Email Label
WBSOPLAB  DIM       18                * OPVW URL Label
WBSOVLAB  DIM       15                * OVVW URL Label
WBSOELAB  DIM       18                * OECW URL Label
WBSIMAGL  DIM       17                * IMCWAG URL Label
WBSIMSCL  DIM       17                * IMCWSC URL Label
WBSIMMOL  DIM       17                * IMCWMO URL Label
WBSIMMBL  DIM       17                * IMCWMB URL Label
WBSSTSWL  DIM       15                * STSW URL Label
WBSMRTVL  DIM       19                * IMCW RTVW URL Label
WBSERTVL  DIM       19                * ERAW RTVW URL Label
WBSGPRWL  DIM       15                * GPRW URL Label
WBSPMAGL  DIM       21                * IMCWAG URL Label Speciality
WBSPMSCL  DIM       21                * IMCWSC URL Label Speciality
WBSPMMOL  DIM       21                * IMCWMO URL Label Speciality
WBSPMMBL  DIM       21                * IMCWMB URL Label Speciality
WBPAMAGL  DIM       21                * IMCWAG URL Label Pathology
WBPAMSCL  DIM       21                * IMCWSC URL Label Pathology
WBPAMMOL  DIM       21                * IMCWMO URL Label Pathology
WBPAMMBL  DIM       21                * IMCWMB URL Label Pathology
WBSIHPRL  DIM       22                * IHCWPR URL Label
WBSIHPUL  DIM       21                * IHCWPU URL Label
WBSHRTVL  DIM       19                * IHCW RTVW URL Label
WBSPCIGL  DIM       18                * PCIW General Label
WBSSDDWL  DIM       15                * SDDW Label
WBSBBSGL  DIM       18                * BBSW Gen Label
WBSBBSSL  DIM       18                * BBSW Spe Label
WBSPCISL  DIM       18                * PCIW Specialist Label
WBSBPRWL  DIM       15                * BPRW Label
WBSBPYWL  DIM       15                * BPYW Label
WBSOEMWL  DIM       18                * OECW-ECM URL Label
.
WBSRV001  DIM       60                * Product ID
WBSRV002  DIM       60                * JKS/Certificate File Location
WBSRV003  DIM       60                * PRODA Organisation ID
WBSRV004  DIM       60                * Device Name
WBSRV005  DIM       60                * Client ID
WBSRV006  DIM       60                * Access Token Audience
WBSRV007  DIM       60                * Activation Code
WBSRV008  DIM       60                * Device Activation URL
WBSRV009  DIM       60                * Device Authentication URL
WBSRV010  DIM       60                * Refresh Device Key URL
WBSRV011  DIM       60                * WebServices Claiming Client Id
WBSRV012  DIM       60                * Location Id
WBSRV013  DIM       60                * Notification Email
WBSRV014  DIM       150               * OPVW URL
WBSRV015  DIM       150               * OVVW URL
WBSRV016  DIM       150               * OECW URL
WBSRV017  DIM       150               * IMCWAG URL
WBSRV018  DIM       150               * IMCWSC URL
WBSRV019  DIM       150               * IMCWMO URL
WBSRV020  DIM       150               * IMCWMB URL
WBSRV021  DIM       150               * STSW URL
WBSRV022  DIM       150               * IMCWRTVW URL
WBSRV023  DIM       150               * ERAWRTVW URL
WBSRV024  DIM       150               * GPRW URL
WBSRV025  DIM       150               * IMCWAG URL Specilaity
WBSRV026  DIM       150               * IMCWSC URL Specilaity
WBSRV027  DIM       150               * IMCWMO URL Specilaity
WBSRV028  DIM       150               * IMCWMB URL Specilaity
WBSRV029  DIM       150               * IMCWAG URL Pathology
WBSRV030  DIM       150               * IMCWSC URL Pathology
WBSRV031  DIM       150               * IMCWMO URL Pathology
WBSRV032  DIM       150               * IMCWMB URL Pathology
WBSRV033  DIM       150               * IHCWPR URL
WBSRV034  DIM       150               * IHCWPU URL
WBSRV035  DIM       150               * IHCWRTVW URL
WBSRV036  DIM       150               * PCIW General URL
WBSRV037  DIM       150               * SDDW URL
WBSRV038  DIM       150               * BBSW Gen URL
WBSRV039  DIM       150               * BBSW Spe URL
WBSRV040  DIM       150               * PCIW Specialist URL
WBSRV041  DIM       150               * BPRW URL
WBSRV042  DIM       150               * BPYW URL
WBSRV043  DIM       150               * OECW-ECM URL
.
WBSPROPF  FILE      ASCII,FIXED=256
WBSACTVF  FILE      ASCII,FIXED=256
WBSTOKNF  FILE      ASCII,FIXED=256
WBSACTOF  FILE      ASCII,FIXED=256
WBSTOKOF  FILE      ASCII,FIXED=256
WBSACTHS  FILE      ASCII,FIXED=256
WBSTOKHS  FILE      ASCII,FIXED=256
PRODAIND  DIM       1
PRDAPATH  DIM       120
ACTVPATH  DIM       120
TOKNPATH  DIM       120
ACTOPATH  DIM       120
TOKOPATH  DIM       120
ACTHPATH  DIM       120
TOKHPATH  DIM       120
PRDAFILE  INIT      "webPAS_PRODA.properties"
ACTVFILE  INIT      "webPAS_PRODA_ActivateDevice_curl_response"
TOKNFILE  INIT      "webPAS_PRODA_GetAccessToken_curl_response"
ACTOFILE  INIT      "webPAS_PRODA_ActivateDevice_curl_errors"
TOKOFILE  INIT      "webPAS_PRODA_GetAccessToken_curl_errors"
ACTHFILE  INIT      "webPAS_PRODA_ActivateDevice_curl_response_history"
TOKHFILE  INIT      "webPAS_PRODA_GetAccessToken_curl_response_history"
.
WEBOPVKY  DIM       26
WEBOVVKY  DIM       26
WEBOECKY  DIM       11
.
PROPFLNM  DIM       35
PROPFILE  FILE      ASCII,FIXED=256
PROPLITR  INIT      ".properties"
PROPLINE  DIM       150
.
OPVWFLNM  DIM       33
OPVWFILE  FILE      ASCII,FIXED=256
OPVWLITR  INIT      "_opvw_pvm"
OPVWLINE  DIM       150
.
OPVRFLNM  DIM       38
OPVRFILE  FILE      ASCII,FIXED=500
OPVRLITR  INIT      "_opvw_response"
OPVRLINE  DIM       300
.
OPVEFLNM  DIM       36
OPVEFILE  FILE      ASCII,FIXED=500
OPVELITR  INIT      "_opvw_errors"
OPVELINE  DIM       150
.
OVVWFLNM  DIM       33
OVVWFILE  FILE      ASCII,FIXED=256
OVVWLITR  INIT      "_ovvw"
OVVWLINE  DIM       150
.
OVVRFLNM  DIM       38
OVVRFILE  FILE      ASCII,FIXED=500
OVVRLITR  INIT      "_ovvw_response"
OVVRLINE  DIM       300
.
OVVEFLNM  DIM       36
OVVEFILE  FILE      ASCII,FIXED=500
OVVELITR  INIT      "_ovvw_errors"
OVVELINE  DIM       150
.
OECWFLNM  DIM       33
OECWFILE  FILE      ASCII,FIXED=256
OECWLITR  INIT      "_oecw"
OECWLINE  DIM       150
.
OECRFLNM  DIM       38
OECRFILE  FILE      ASCII,FIXED=500
OECRLITR  INIT      "_oecw_response"
OECRLINE  DIM       550
.
OECEFLNM  DIM       36
OECEFILE  FILE      ASCII,FIXED=500
OECELITR  INIT      "_oecw_errors"
OECELINE  DIM       150
.
IMCWFLNM  DIM       33
IMCWFILE  FILE      ASCII,FIXED=256
IMCWLITR  INIT      "_imcw"
IMCWLINE  DIM       150
.
IMCRFLNM  DIM       38
IMCRFILE  FILE      ASCII,FIXED=500
IMCRLITR  INIT      "_imcw_response"
IMCRLINE  DIM       150
.
IMCEFLNM  DIM       36
IMCEFILE  FILE      ASCII,FIXED=500
IMCELITR  INIT      "_imcw_errors"
IMCELINE  DIM       150
.
OEMWFLNM  DIM       32
OEMWFILE  FILE      ASCII,FIXED=256
OEMWLITR  INIT      "_oecwecm"
OEMWLINE  DIM       150
.
OEMRFLNM  DIM       41
OEMRFILE  FILE      ASCII,FIXED=500
OEMRLITR  INIT      "_oecwecm_response"
OEMRLINE  DIM       550
.
OEMEFLNM  DIM       39
OEMEFILE  FILE      ASCII,FIXED=500
OEMELITR  INIT      "_oecwecm_errors"
OEMELINE  DIM       150
.
.   ****** HPS BLR DECLARATION STARTS HERE    ***********
.
.         HPS BLR Code Starts Here
VISADIAG  DIM       12                *Diagnosis Code
ADIADESC  DIM       25
DDIADESC  DIM       25
VISTLOC   DIM       7
VISHOSID  INIT      "01"
SECOPT    DIM       1
VISTDAY   DIM       5
PVISYSN   FORM      2
VISTCOMH  INIT      "COM"
VISTEMER  INIT      "EMG"
VISTOUTP  INIT      "OP"
VISTINPT  INIT      "IP"
VISTALLH  INIT      "RF"
VISTEVNT  INIT      "EV"
VISTTYPE  DIM       5
VSTATUS   DIM       35
VIEWFLAG  FORM      1
VOLNDESC  DIM       16
.
EMGSTAT1  INIT      "Current"
.
INPSTAT1  INIT      "Pre-adm"
INPSTAT2  INIT      "Current IP"
INPSTAT3  INIT      "Discharged"
INPSTA3A  INIT      "Disc-"
INPSTA3B  INIT      "Cancelled"
INPSTAT4  INIT      "Leave"
INPSTAT5  INIT      "Cancel"
.
ALLSTAT0  INIT      "Waiting"
ALLSTAT1  INIT      "Active"
ALLSTAT2  INIT      "Closed"
ALLSTAT3  INIT      "Inactive"
ALLSTAT4  INIT      "Cancelled"
ALLSTAT5  INIT      "Rejected"
.
WLSTAT1   INIT      "Unscheduled"
WLSTAT2   INIT      "Scheduled"
WLSTAT3   INIT      "Pre-Admitted"
WLSTAT4   INIT      "Admitted"
WLSTAT5   INIT      "Discharged"
WLSTAT6   INIT      "Removed from W/L"
WLSTAT7   INIT      "Performed"
WLSTAT8   INIT      "Not Performed"
WLSTAT9   INIT      "Cancelled Booking"
.
OEVSTA0   INIT      "Outpatient-ATTENDED"
OEVSTA1   INIT      "Outpatient-NO ATTENDANCE"
OEVSTA2   INIT      "Outpatient-CANCELLED"
OBRACKET  INIT      "("
CBRACKET  INIT      ")"
.
STATUS00  INIT      "Waiting    "
STATUS01  INIT      "Ext. Error "
STATUS02  INIT      "Extracted  "
STATUS03  INIT      "SA Error   "
STATUS04  INIT      "Received   "
STATUS05  INIT      "Medicare Unverified "
STATUS06  INIT      "Medicare Verified   "
STATUS07  INIT      "Health Fund Unverified"
STATUS08  INIT      "Health Fund Verified  "
STATUS09  INIT      "Medicare Assessing    "
STATUS10  INIT      "Health Fund Assessing "
STATUS11  INIT      "Medicare Rejected     "
STATUS12  INIT      "Health Fund Rejected  "
STATUS13  INIT      "Requested Delete      "
STATUS14  INIT      "Assessing Complete    "
STATUS15  INIT      "MC - Rejected  - Reported"
STATUS16  INIT      "HF - Rejected  - Reported"
STATUS17  INIT      "Complete - Reported"
STATUS18  INIT      "Remittance Reported"
STATUS19  INIT      "Closed"
.
STATSF00  INIT      "Waiting    "
STATSF01  INIT      "Ext. Error "
STATSF02  INIT      "Extracted  "
STATSF03  INIT      "SA Error   "
STATSF04  INIT      "Received   "
STATSF05  INIT      "Closed     "
.
.------ Eclipse Bulk Billing transaction statuses OUTECTFD.DOTECFLG *T0859743
STATBB01  INIT      "Error PAS validation"
STATBB02  INIT      "Extracted           "
STATBB03  INIT      "Error SA validation "
STATBB04  INIT      "Received            "
STATBB05  INIT      "Complete - Reported "
STATBB06  INIT      "Reported            "
STATBB07  INIT      "Closed              "
.-----------------------------------------------------------------------------
.
TYPEDES1  INIT      "Status Request      "
TYPEDES2  INIT      "Status Req. Response"
TYPEDES3  INIT      "Report Request      "
TYPEDES4  INIT      "Report Req. Response"
TYPEDES5  INIT      "Viewed              "
TYPEDES6  INIT      "Data Error          "
TYPEDES7  INIT      "Trans. Error        "
.
TYPEDSF1  INIT      "Viewed              "
TYPEDSF2  INIT      "Data Error          "
TYPEDSF3  INIT      "Trans. Error        "
.
.------- Eclipse Bulk Billing - Type OUTECAFD.OTEATYPE               *T0859743
TYPEDBB1  INIT      "Report Request      "
TYPEDBB2  INIT      "Report Request Resp "
TYPEDBB3  INIT      "Viewed              "
TYPEDBB4  INIT      "Data Error Response "
TYPEDBB5  INIT      "Trans. Error Resp   "
.-----------------------------------------------------------------------------
.
SUBMITED  INIT      "Submitted"
SENT      INIT      "Sent"
RECEIPTD  INIT      "Receipted"
FAILED    INIT      "Failed"
SLSH      INIT      "/"
TILDA30   INIT      "~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~"
.
.-----------------------------------------------------------------------------
.
.   ****** NIHC DASHBOARD VARIABLES ***********
.
NHCJKSLO  DIM       100               * JKS/Certificate File Location
NHCDVNAM  DIM       100               * Device Name
NHCNIHCU  DIM       200               * NIHC URL
NHCNICCU  DIM       200               * NIHC Clear URL
NHCALGOR  DIM       100               * Certificate Algorithm
NHCHOSPC  DIM       100               * Hospital Code
NHCURPTH  DIM       200               * NIHC Path URL
NHCSUPTH  DIM       200               * NIHC Patient Summary Page URL
NHCVWPTH  DIM       200               * NIHC MyHR Viewer URL
.
NHCJKLAB  DIM       20                * JKS File Location Label
NHCDNLAB  DIM       18                * Device Name Label
NHCNILAB  DIM       18                * NIHC URL Label
NHCNCLAB  DIM       23                * NIHC Clear URL Label
NHCALLAB  DIM       21                * Certificate Algorithm Label
NHCHOLAB  DIM       20                * Hospital Code Label
NHCURLAB  DIM       19                * NIHC Path URL
NHCSULAB  DIM       22                * NIHC Patient Summary Page URL
NHCVWLAB  DIM       23                * NIHC MyHR Viewer URL
.
NHCIH001  DIM       100               * JKS/Certificate File Location
NHCIH002  DIM       100               * Device Name
NHCIH003  DIM       200               * NIHC URL
NHCIH004  DIM       200               * NIHC Clear URL
NHCIH005  DIM       100               * Certificate Algorithm
NHCIH006  DIM       100               * Hospital Code
NHCIH007  DIM       200               * NIHC Path URL
NHCIH008  DIM       200               * NIHC Patient Summary Page URL
NHCIH009  DIM       200               * NIHC MyHR Viewer URL
.
NHCPROPF  FILE      ASCII,FIXED=256
NIHCPATH  DIM       120
NHCIFILE  INIT      "webPAS_NIHCIHI.properties"
.
NHCPUBKF  FILE      ASCII,FIXED=256
NHCPPATH  DIM       120
NHCPFILE  INIT      "webPAS_NIHCIHI_publickey.properties"
.
NHCJWTOF  FILE      ASCII,FIXED=256
NHCJPATH  DIM       120
NHCJFILE  INIT      "webPAS_NIHCIHIViewSumm_jwt.properties"
.
NHCMWTOF  FILE      ASCII,FIXED=256
NHCMPATH  DIM       120
NHCMFILE  INIT      "webPAS_NIHCIHIMyHRUp_jwt.properties"
.
NHCIHIND  DIM       1
.
.------------------------------------------------------------------------
PRGID     INIT      "IHIWEB04"
VERSION   INIT      "V12.01.00"
PRGNAM    INIT      "NIHC Server 4"
.------------------------------------------------------------------------
          CALL      WEBINT00       * Initialise Fifo Etc.
          CALL      INIT0000       * Open Files
.
MAIN1000  CALL      WEBRED00       * Read Fifo WEBPID and USERID
.
.          IF        PTCNNHII=1
.            CALL      CONNECT      * Basic Patient Details
.          ENDIF
.
          CALL      OUTFIL00       * Check Correct Site Files Are Open
          BRANCH    EXIT,MAIN1000
.
          COMPARE   "999",REPORTNO * End Server Process on Report Option 999
          GOTO      MAIN9999 IF EQUAL
.
          BRANCH    REPORTNO,MAIN1100
.
          PACK      WEBTITLE,PRGID,SP1,VERSION,SP1,PRGNAM,SP70
          MOVE      "INVALID OPTION ECLWEB02",WEBTITLE
          CALL      WEBERR00   * Create Output File and Write HTML Page Header
          GOTO      MAIN1000
.
MAIN1100  CALL      REMOTE00        * Various Remote Scripting Functions
          GOTO      MAIN1000
.
MAIN9999  MOVE      "SERVER SHUTDOWN COMPLETE",WEBTITLE
          CALL      WEBERR00
          STOP
.------------------------------------------------------------
. Output Next Page Based on CGI Parameter nextpage
.------------------------------------------------------------
NXTPAG00  MOVE      ZERO,F1
          MOVE      NEXTPAGE,F1
          BRANCH    F1,NXTPAG10,NXTPAG20,NXTPAG30,NXTPAG40,NXTPAG50:
                       NXTPAG60
.
          CALL      WINCLS00
          GOTO      NXTPAG99
.
NXTPAG10  CALL      RDIREC00
          GOTO      NXTPAG99
.
NXTPAG20  CALL      GOBACK00      * Go Back 1 Html page
          GOTO      NXTPAG99
.
NXTPAG30  CALL      DAH20000      * Go Back 2 html pages
          GOTO      NXTPAG99
.
NXTPAG40  CALL      GOBACK00
          GOTO      NXTPAG99
.
NXTPAG50  CALL      PREDIR00
          GOTO      NXTPAG99
.
NXTPAG60  CALL      RELOAD00
          GOTO      NXTPAG99
.
NXTPAG99  RETURN
.------------------------------------------------------------------------------
.  Redirect Parent URL
.------------------------------------------------------------------------------
PREDIR00  CALL      OPENHTML
          BRANCH    EXIT,PREDIR90
.
          WRITE     HTMLFILE;"<script type=#"text/javascript#"> {":
.                             " alert(#"",WEBTITLE,"#");":
                             " parent.location.href=#"",REDIRECT,"#";":
                             "}":
                             "</script>"
          CALL      CLOSHTML
          GOTO      PREDIR99
.
PREDIR90  DISPLAY   "*** Fifo Not Found ***"
.
PREDIR99  RETURN
.
.-------------------------------------------------------------------------------
.  Goes back 1 page
.-------------------------------------------------------------------------------
GOBACK00  CALL      OPENHTML
          BRANCH    EXIT,GOBACK99
          WRITE     HTMLFILE;"<script type=#"text/javascript#"> {":
                             "    alert(#"",WEBTITLE,"#");":
                             "    self.close();":
                             "    opener.history.go(-1);":
                             "}":
                             "</script>"
          CALL      CLOSHTML
GOBACK99  RETURN
.------------------------------------------------------------
. Open Files and Initialize Variables
.------------------------------------------------------------
INIT0000  CALL      INTMAS00   * Open Files Required for PATMASTM
          OPEN      ACCDIAA1,"accdiaaf"
          OPEN      AAEDE1A1,"aaede1af"
          OPEN      AAEDI1A1,"aaedi1af"
          OPEN      EMRICDA1,"emricdaf"
          OPEN      HICEMSA1,"hicemsaf"
          OPEN      IBAPRTA1,"ibaprtaf"        * For Printer Selection
          OPEN      IBACODE1,"ibacodef"        * For Printer Selection
          OPEN      IHAPASS1,"ihapassf"        * For Printer Selection
          OPEN      IBAPDFA1,"ibapdfaf"        * For default printer selection
          OPEN      IBATMHA1,"ibatmhaf"
          OPEN      MRTAUCA2,"mrtaucaf"
          OPEN      MRTMASA1,"mrtmasaf"
          OPEN      MRTMASA2,"mrtmasaf"
          OPEN      MRTHISA1,"mrthisaf"
          OPEN      MRTSTFA1,"mrtstfaf"
          OPEN      MRTLOCA1,"mrtlocaf"
          OPEN      MRTPDSA1,"mrtpdsaf"
          OPEN      MRTVISA1,"mrtvisaf"
          OPEN      PATDGWA1,"patdgwaf"
          OPEN      PATCODE1,"patcodes"
          OPEN      PATCODE2,"patcodes"
          OPEN      PATDADA1,"patdadaf" 
          OPEN      PATCHCO1,"patchcof"
          OPEN      PATFACT1,"patfactf"
          OPEN      PATINVR1,"patinvrf"
          OPEN      PATINVR3,"patinvrf"
          OPEN      PATINVR5,"patinvrf"
          OPEN      PATIN1A1,"patin1af"
          OPEN      PATUNAA1,"patunaaf"
          OPEN      PMSAIDA2,"pmsaidaf"
          OPEN      PMSCCDA1,"pmsccdaf"
          OPEN      PMSCTCA1,"pmsctcaf"
          OPEN      PMSCLTA1,"pmscltaf"
.
          OPEN      PMSHCPA1,"pmshcpaf"
          OPEN      PMSHCGA1,"pmshcgaf"
          OPEN      PMSEVTA1,"pmsevtaf"
          OPEN      PMSTLEA1,"pmstleaf"          * open Patient Titles table
          OPEN      PMSTLEA2,"pmstleaf"          *
          OPEN      PATPA1A1,"patpa1af"
          OPEN      PATPGRA1,"patpgraf" 
          OPEN      PATGSRN1,"patgsrnf" 
          OPEN      PATICDO1,"paticdof"
          OPEN      PATICUA1,"paticuaf"
          OPEN      PATI10O1,"pati10of"
          OPEN      PATICDD1,"paticddf"
          OPEN      PATI10D1,"pati10df"
          OPEN      PATFLET2,"patfltrf"
          OPEN      PATMESG1,"patmesgf"
          OPEN      PMSCDNA1,"pmscdnaf"
.
          MOVE      ZERO,ARCFLAG
          MOVE      ZERO,OVRCD
          TRAP      OVERCOND IF IO
          OPEN      ARCVX1A1,"arcvx1af"
          TRAPCLR   IO
          IF        OVRCD=0
            MOVE      ONE,ARCFLAG
          ENDIF
.
          OPEN      PMSVX1A1,"pmsvx1af" 
          OPEN      PATRE1A1,"patre1af"
          OPEN      PATRGMA1,"patrgmaf"
          OPEN      BOKDIAA1,"bokdiaaf"
          OPEN      BOKRC1A1,"bokrc1af"
          OPEN      BOKRX1A1,"bokrx1af"
          OPEN      BOKRC1A6,"bokrc1af"
          OPEN      WATTR1A1,"wattr1af"
          OPEN      WATTX1A1,"wattx1af"
          OPEN      WEBSECA3,"websecaf"
          OPEN      PATEORA1,"pateoraf"
          OPEN      PATFN1A1,"patfn1af"
          OPEN      VISPAYA1,"vispayaf"
.
          OPEN      PATDSCH1,"patdschf"
          OPEN      PATPEIO1,"patpeiaf"
          OPEN      PATTRAN2,"pattranf"
          OPEN      PATVADA1,"patvadaf"
          OPEN      PATVISA1,"patvisaf"
          OPEN      PATVISA2,"patvisaf"
          OPEN      PATVISA4,"patvisaf"
          OPEN      NZPSPRA1,"nzpspraf"
          OPEN      MEHVI1A1,"mehvi1af"
          OPEN      MEHVI1A4,"mehvi1af"           * I SRF 22727
          OPEN      MEHLEGA1,"mehlegaf"           * I SRF 22727
          OPEN      PATMMBS1,"patmmbsf"
          OPEN      PATMMBS2,"patmmbsf"
          OPEN      PATITEM1,"patitemn"
          OPEN      PMSPX2A1,"pmspx2af"
          OPEN      PATHSPA1,"pathspaf"
.
          OPEN      ALLREFA1,"allrefaf"
          OPEN      ALLRLNA2,"allrlnaf"
          OPEN      ALLDEPA1,"alldepaf"
          OPEN      ALLENCA1,"allencaf"
          OPEN      PATDADA1,"patdadaf"
          OPEN      PATNIDA2,"patnidaf"
          OPEN      PATASFA1,"patasfaf"
          OPEN      PATSFAA1,"patsfaaf"
          OPEN      PATWVET1,"patwvetf"
          OPEN      PATWMAB1,"patwmabf"
          OPEN      PATWMAB2,"patwmabf"
          OPEN      PATWMAB3,"patwmabf"
          OPEN      PATWC1A1,"patwc1af"
          OPEN      PATWC1A2,"patwc1af"
          OPEN      PATWC1A3,"patwc1af"
          OPEN      PMSWX1A1,"pmswx1af"
          OPEN      ACCCMTA1,"acccmtaf"
          OPEN      PMSRESA1,"pmsresaf"
          OPEN      PMSWORA1,"pmsworaf"
          OPEN      PATW11A1,"patw11af"                                *I-43498
          OPEN      PATW12A1,"patw12af"                                *I-51504
          OPEN      PATW12B1,"patw12bf"
          OPEN      PATW13A1,"patw13af"
          OPEN      PATW14A1,"patw14af"                               *I-145161
          OPEN      PATW15A1,"patw15af"
          OPEN      PATW16A1,"patw16af"
          OPEN      PATW17A1,"patw17af"
.
          MOVE      ZERO,OVRCD
          TRAP      OVERCOND IF IO
          OPEN      EMRUNKA1,"emrunkaf"
          OPEN      EMRVISA1,"emrvisaf"
          TRAPCLR   IO
          MOVE      OVRCD,EMRFLAG
.
          OPEN      PATECDA1,"patecdaf"
          OPEN      PATECOA1,"patecoaf"
          OPEN      PATECDA2,"patecdaf"
          OPEN      PATECOA2,"patecoaf"
.
          CALL      OPICD1                      * Open ICD Disease files
          CALL      OPICO1                      * Open ICD Operation files
.
          OPEN      MLTSECA1,"mltsecaf"
          OPEN      VISMDTA1,"vismdtaf"
          OPEN      VISMTXA1,"vismtxaf"
          OPEN      PMSNUTA1,"pmsnutaf"         * new nutrition file v9.02.17
          OPEN      OBSPINA1,"obspinaf"
          OPEN      OBSCNAA1,"obscnaaf"
          OPEN      OBSCNBA1,"obscnbaf"
          OPEN      OBSCNCA1,"obscncaf"
          OPEN      OBSCNCA2,"obscncaf"
          OPEN      OBSDIAA1,"obsdiaaf"
          OPEN      OBSBPHA1,"obsbphaf"
          OPEN      OBSPROA1,"obsproaf"
          OPEN      OBSREAA1,"obsreaaf"
          OPEN      OBSBHIA1,"obsbhiaf"
          OPEN      OBSLABA1,"obslabaf"
          OPEN      OBSMEDA1,"obsmedaf"
          OPEN      OBSRESA1,"obsresaf"
          OPEN      OBSPHYA1,"obsphyaf"
          OPEN      OBSDITA1,"obsditaf"
          OPEN      OBSCALA1,"obscalaf"
          OPEN      OBSCALA1,"obscalaf"
          OPEN      PATMI1A8,"patmi1af"
          OPEN      IBASPOL1,"ibaspolf"         * For spool file       
          OPEN      CONTROLF,"controlf"         * For spool file       
          READ      CONTROLF,ZERO;*43,IBCNMHOS,*85,IBCNUGST
          READ      CONTROLF,TEN;*250,CAUDA1
          READ      CONTROLF,HUND12;*101,PTCNUFFR
          READ      CONTROLF,HUND10;*240,PTCNUALT
          READ      CONTROLF,HUND16;*214,PTCNDCDM
          READ      CONTROLF,HUND06;*203,ALCNMDES
          READ      CONTROLF,HUND30;*12,PTCNIHIV
          READ      CONTROLF,FIFTY9;*193,PTCNRQCF
          READ      CONTROLF,HUND06;*217,ALCNCLNF
          COMPARE   ONE,PTCNRQCF       * Using Free Format Requester
          IF        !@EQUAL
            OPEN      MRTSTFA1,"mrtstfaf"
          ENDIF
.
          IF        CAUDA1<>1
            OPEN      PATAUDAL,"pataudal"
            OPEN      PATAUDA2,"pataudal"
          ENDIF
.
          IF        IBCNMHOS=1
            OPEN      MLTCODA1,"mltcodaf"
            OPEN      MLTCODA2,"mltcodaf"
          ENDIF
           
.
.  Katie - have a look into what this if statement is doing 01/02/200 - Comments at Taranaki
.
..          READ      CONTROLF,TWENTY;*164,PTCNUPCM
..          IF        PTCNUPCM=1
..            OPEN      PATCMNT1,"patxcmaf"     * new extra comments file
..          ELSE
.
..            OPEN      PATCMNT1,"patcmntf"
.
..          ENDIF
...........

          READ      CONTROLF,EIGHTY;*250,PTCNHDPS
          READ      CONTROLF,TEN;*126,CLABPG,CLABPRT,*235,CMDISP
          READ      CONTROLF,TEN3;*188,CMABINS,CVETINS
          READ      CONTROLF,TWENTY;*223,PTCNLNFF,*224,PTCNCHFF
          READ      CONTROLF,THIRTY7;*137,HWDSOUR
          READ      CONTROLF,FIFTY9;*35,CTYPLAB,*220,PTCNUADT
          READ      CONTROLF,EIGHTY;*249,PTCNEDTE
          READ      CONTROLF,EIGHTY8;*59,PTCNI10D
          READ      CONTROLF,EIGHTY9;*180,EMCNLDAT
          READ      CONTROLF,TWENTY1;*138,PTCNNHII
          READ      CONTROLF,TWENTY1;*45,PTCNDRSM 
          READ      CONTROLF,SIXTY9;*43,MHCNAUDA,*69,MHCNUSE,*82,MHCNDVIS
          READ      CONTROLF,HUND09;*177,PTCNNHTM
          READ      CONTROLF,TWENTY;*52,PTPCLRES
          READ      CONTROLF,TWENTY1;*237,PTCNPAOF,*238,PTCNAGEC
          READ      CONTROLF,THIRTY3;*200,PRCNRDOC
          READ      CONTROLF,HUND05;*158,PTCNDGPV,*211,PTCNBPAY: *I-43526I-48227
                                    *217,PTCNGDV4,*227,PTCNGDV5       *C-105244
          READ      CONTROLF,HUND09;*151,PTCNGDV3                      *I-51504
          READ      CONTROLF,HUND12;*96,PTCNH7AC,*239,PTCNGDV6        *C-163918
          READ      CONTROLF,HUND10;*61,PTCNGDV7:                     *I-219246
                                    *69,PTCNGDV8:                     *I-284420
                                    *77,PTCNGDV9:                     *I-311669
                                    *85,PTCNGDVX                      *I-0833093
          READ      CONTROLF,HUND17;*220,PTCNGDX1
          READ      CONTROLF,HUND20;*158,PTCNUNET
          READ      CONTROLF,HUND24;*111,PTCNUIMC,*222,PTCNUESF
          READ      CONTROLF,HUND27;*122,PTCNUEBB                     *T0859743
          READ      CONTROLF,HUND29;*1,PTCNWSDR,*61,PTCNWSIN,*71,PTCNOECW
.
          OPEN      OUTSITA1,"outsitaf"     * Open the site file
          OPEN      OUTSITA3,"outsitaf"     * Open the site file
          MOVE      "out",CFILEPRE          * Save Current File Prefix
          CALL      OPNOUT00                * Open Outpatient Files 
          OPEN      OUTRF1A1,"outrf1af"
          IF        PTCNNHII=1
            OPEN      PATMWSA1,"patmwsaf"
          ENDIF
.
          OPEN      ALLCASA1,"allcasaf"
.
          OPEN      PRISECA1,"prisecaf"
          OPEN      PRIALSA1,"prialsaf"
          OPEN      PRIPRAC1,"pripracf"
          OPEN      PRIHDBT2,"prihdbtf"
          OPEN      PRIHREF1,"prihreff"
          OPEN      PRIDTRA1,"pridtraf"
          OPEN      PRIINVO1,"priinvof"
.
. **** WebServices ****
.
          OPEN      WEBB2BA1,"webb2baf"
          OPEN      WEBB2BA2,"webb2baf"
          OPEN      WEBB2BA3,"webb2baf"
.
          OPEN      WEBOPVA1,"webopvaf"
          OPEN      WEBOPVA2,"webopvaf"
          OPEN      WEBOPVA3,"webopvaf"
          OPEN      WEBOPVA4,"webopvaf"
.
          OPEN      WEBOVVA1,"webovvaf"
          OPEN      WEBOVVA2,"webovvaf"
          OPEN      WEBOVVA3,"webovvaf"
          OPEN      WEBOVVA4,"webovvaf"
.
          OPEN      WEBOECA1,"weboecaf"
          OPEN      WEBOECA2,"weboecaf"
          OPEN      WEBOECA3,"weboecaf"
          OPEN      WEBOECA4,"weboecaf"
          OPEN      WEBOECA5,"weboecaf"
          OPEN      WEBOECA6,"weboecaf"
.
          OPEN      WEBOEMA1,"weboemaf"
          OPEN      WEBOEMA2,"weboemaf"
          OPEN      WEBOEMA3,"weboemaf"
          OPEN      WEBOEMA4,"weboemaf"
          OPEN      WEBOEMA5,"weboemaf"
          OPEN      WEBOEMA6,"weboemaf"
.
          OPEN      WEBPARA1,"webparaf"
.
. **** NIHC IHI ****
.
          OPEN      PMSIHEA1,"pmsiheaf"
          OPEN      PMSNDBA1,"pmsndbaf"
          OPEN      PMSNDBA2,"pmsndbaf"
          OPEN      PMSNPLA1,"pmsnplaf"
.
INIT9999  RETURN
.*******************************************************************************
. OUTFIL00 - Check if the user id has an outpatienty site. If they do open
.            the correct outpatient files according to the site. If they do not
.            have a site make sure the default prefix of out is is used to 
.            open the files.
.*******************************************************************************
OUTFIL00  MATCH     SP70,WBSESIT             * Does the user have a site
          GOTO      OUTFIL50 IF NOT EQUAL
.
OUTFIL10  MATCH     "out",CFILEPRE           * Is out currently open
          IF        !@EQUAL
            MOVE      "out",OSTFILE          * open default prefix of out
            MOVE      OSTFILE,CFILEPRE       * Save Current File Prefix
            CALL      OPNOUT00               * Open out Outpatient Files
          ENDIF
.
          MOVE      ZERO,EXIT
          GOTO      OUTFIL99
.
OUTFIL50  MOVE      WBSESIT,KEY6
          CALL      RDSITA1
          BRANCH    OVRCD,OUTFIL90           * error invalid site code
.
          MATCH     OSTFILE,CFILEPRE         * Save Current File Prefix
          IF        !@EQUAL
            MOVE      OSTFILE,CFILEPRE       * Save Current File Prefix
            CALL      OPNOUT00               * Open prefixed Outpatient Files
          ENDIF
.
          MOVE      ZERO,EXIT
          GOTO      OUTFIL99
.
OUTFIL90  MOVE      "Outpatient Site Invalid",WEBTITLE
          CALL      WEBERR00
          MOVE      ONE,EXIT
.
OUTFIL99  RETURN
.------------------------------------------------------------
. Open Outpatient Files
.------------------------------------------------------------
OPNOUT00  PACK      CFNAME,CFILEPRE,FILBOKA3  * Get the name of the BOKA3 file
          CLOSE     OUTBOKA3
          OPEN      OUTBOKA3,CFNAME           * Open the file
          CLOSE     OUTBOKA2
          OPEN      OUTBOKA2,CFNAME           * Open the file
.
          PACK      CFNAME,CFILEPRE,FILRSHA1
          CLOSE     OUTRSHA1
          OPEN      OUTRSHA1,CFNAME
.
          PACK      CFNAME,CFILEPRE,FILCANA2
          CLOSE     OUTCANA2
          OPEN      OUTCANA2,CFNAME
.
          PACK      CFNAME,CFILEPRE,FILBB1A1  * Get the name of the BOKA3 file
          CLOSE     OUTBB1A1
          OPEN      OUTBB1A1,CFNAME     
.
          PACK      CFNAME,CFILEPRE,FILSESA1  * Get the name of the SESA1 file
          CLOSE     OUTSESA1
          OPEN      OUTSESA1,CFNAME           * Open the file
.
          PACK      CFNAME,CFILEPRE,FILCTYA1  * Get the name of the CTYA1 file
          CLOSE     OUTCTYA1
          OPEN      OUTCTYA1,CFNAME           * Open the file
.
          PACK      CFNAME,CFILEPRE,FILMA1A1
          CLOSE     OUTMA1A1
          OPEN      OUTMA1A1,CFNAME
.
          PACK      CFNAME,CFILEPRE,FILHEDA1
          CLOSE     OUTHEDA1
          OPEN      OUTHEDA1,CFNAME
.
          PACK      CFNAME,CFILEPRE,FILDIAG1
          CLOSE     OUTDIAG1
          OPEN      OUTDIAG1,CFNAME    
.
OPNOUT99  RETURN
.------------------------------------------------------------
. Clear Parameters
.------------------------------------------------------------
CLRPAR00  MOVE      ZERO,REPORTNO
          MOVE      SP70,TEMPLATE
          MOVE      SP70,URNUMBER
          MOVE      SP70,PATALTID
          MOVE      SP70,PMSALTID
          MOVE      SP70,UPDTTYPE
          MOVE      SP70,PRODDIND
          MOVE      SP70,NIHCDIND
          MOVE      ZERO,EPSCD001
          MOVE      SP70,SAVEURNO
          MOVE      SP70,ADMISSNO
          MOVE      ZERO,STARTNOT
          MOVE      SP70,NEXTPAGE
          MOVE      SP70,NOURSELC
          PACK      REDIRECT,SP70,SP70,SP70,SP70
          MOVE      ZERO,MRGEFLAG
          MOVE      ZERO,SRCHTYPE
          MOVE      ZERO,DOWNLD01
          MOVE      ZERO,DOWNLD02
          MOVE      ZERO,DOWNLD03
          MOVE      ZERO,DOWNLD04
          MOVE      ZERO,DOWNLD05
          MOVE      ZERO,DOWNLD06
          MOVE      ZERO,DOWNLD07
          MOVE      ZERO,DOWNLD08
          MOVE      SP70,PATPA001
          MOVE      SP70,PATPA002
          MOVE      SP70,PMSVX044      * Coder Snags
          MOVE      ZERO,CODEDFLG
          MOVE      ZERO,VIEWTYPE
          MOVE      SP70,FRSTDATE
          MOVE      SP70,LASTDATE
          MOVE      SP70,FILTFDAT
          MOVE      SP70,FILTTDAT
          MOVE      SP70,VYEARMTH
          MOVE      ZERO,CHECKCNT
          MOVE      SP70,CLNOT001
          MOVE      SP70,WBSEC008
          MOVE      SP70,ALRTFLTR
          MOVE      ZERO,BOOKFLAG
.          MOVE      Z70,PTVIS067       * I SRF 22685
          MOVE      SP70,ECOTFUND
          MOVE      SP70,ECOTTYPE
          MOVE      SP70,ECOTTRID
          MOVE      ZERO,FILTVTYP
          MOVE      ZERO,FILTFLAG
          MOVE      SP70,FILTHOSP
          MOVE      ZERO,STARTNUM
          MOVE      SP70,MAVBATCH
          MOVE      SP70,MAVINVCE
          MOVE      SP70,MAVMODUL
          MOVE      ZERO,NORECORD
          MOVE      SP70,NEXTVKEY
          MOVE      SP70,PREVVKEY
          MOVE      ZERO,PREVFLAG
          MOVE      ZERO,UPDATETY
          MOVE      SP70,UPDATTYP
          MOVE      ZERO,EMREVENT
          MOVE      SP70,SUPERLEV
.
          MOVE     SP70,PTCLM001
          MOVE     SP70,PTCLM002
          MOVE     SP70,PTCLM003
          MOVE     SP70,PTCLM004
          MOVE     SP70,PTCLM005
          MOVE     SP70,PTCLM006
          MOVE     SP70,PTCLM007
          MOVE     SP70,PTCLM008
          MOVE     SP70,PTCLM010
          MOVE     SP70,PTCLM011
          MOVE     SP70,PTCLM012
          MOVE     SP70,PTCLM013
          MOVE     SP70,PTCLM014
          MOVE     SP70,PTCLM015
          MOVE     SP70,PTCLM016
          MOVE     SP70,PTCLM017
          MOVE     SP70,PTCLM018
          MOVE     SP70,PTCLM019
          MOVE     SP70,PTCLM020
          MOVE     SP70,PTCLM021
          MOVE     SP70,PTCLM022
          MOVE     SP70,PTCLM023
          MOVE     SP70,PTCLM024
          MOVE     SP70,PTCLM025
          MOVE     SP70,PTCLM026
          MOVE     SP70,PTCLM027
          MOVE     SP70,PTCLM028
          MOVE     SP70,PTCLM029
          MOVE     SP70,PTCLM030
          MOVE     SP70,PTCLM031
          MOVE     SP70,PTCLM032
          MOVE     SP70,PTCLM033
          MOVE     SP70,PTCLM034
          MOVE     SP70,PTCLM035
          MOVE     SP70,PTCLM036
          MOVE     SP70,PTCLM037
          MOVE     SP70,PTCLM038
          MOVE     SP70,PTCLM039
          MOVE     SP70,PTCLM040
          MOVE     SP70,PTCLM041
          MOVE     SP70,PTCLM042
          MOVE     SP70,PTCLM043
          MOVE     SP70,PTCLM044
          MOVE     SP70,PTCLM045
          MOVE     SP70,FILTDEPT
          MOVE     ZERO,DEFTFLAG
          MOVE     SP70,PMSOVRKY
          MOVE     SP70,PMSOVVKY
.
          CALL      CLPTPRA0                * clear P.R.A cgi variables
.
          MOVE      ONE,TACCOUNT
          WHILE     TACCOUNT <= 50
            MOVE      SP70,TACRECKY[TACCOUNT]
            ADD       ONE,TACCOUNT
          DO
.
          MOVE      ONE,WCOCOUNT
          WHILE     WCOCOUNT <= 50
            MOVE      SP70,WCORECKY[WCOCOUNT]
            ADD       ONE,WCOCOUNT
          DO
.
          MOVE      ZERO,TACCOUNT
          MOVE      ZERO,WCOCOUNT
          MOVE      ZERO,ERRORCNT
          MOVE      ZERO,SRCHVIEW
.
          PACK      WLINE1A,SP30,SP30            
          PACK      WLINE2A,SP30,SP30 
          PACK      WLINE3A,SP30,SP30            
          PACK      WLINE4A,SP30,SP30
          PACK      WLINE5A,SP30,SP30
          PACK      WLINE6A,SP30,SP30
          PACK      WLINE7A,SP30,SP30
          PACK      WLINE8A,SP30,SP30
.
.---end *I-903005 ---
.
          MOVE      SP70,PTMMB001
          MOVE      ZERO,PTMMB002
          MOVE      ZERO,PTMMB003
          MOVE      SP70,PTMMB004
          MOVE      SP70,PTMMB005
          MOVE      SP70,PTMMB006
          MOVE      SP70,PTMMB007
.
          MOVE      SP70,UNIQNUMB
.          MOVE      SP70,PRHRE001
.          MOVE      SP70,PRHRE002
.          MOVE      SP70,PRHRE003
          CALL      CPPRHR00
.
          MOVE      ZERO,EXDTBLNK
          MOVE      ZERO,ALLHFLAG
          MOVE      SP70,FILTURNO
          MOVE      SP70,HLFDCLTY
          MOVE      SP70,HLTHFUND
          MOVE      ZERO,EXCLWAIT
          MOVE      SP70,FILTADMN
          MOVE      SP70,BATCHNUM
          MOVE      ZERO,VALDTYPE
          MOVE      SP70,VALDCODE
          MOVE      SP70,VALDHOSP
          MOVE      SP70,VALDUSER
          MOVE      SP70,VALDROLE
          MOVE      SP70,VALDTAUD
          MOVE      SP70,VALDURNO
          MOVE      SP70,VALDVISN
          MOVE      SP70,CLAIMSTA
          MOVE      SP70,INVNUMBR
          MOVE      SP70,PROCSTAT
          MOVE      ZERO,EXCLCLOS
          MOVE      SP70,HOSPCODE
          MOVE      SP70,BTSCHOSP
          MOVE      SP70,ECCLFBID
          MOVE      SP70,ECCLARID
          MOVE      SP70,ECCLCLID
          MOVE      SP70,ECCLRPTC
          MOVE      SP70,ECCLITMN
          MOVE      SP70,ECCLSRVC
          MOVE      SP70,ECCLRKEY
.
          CALL      CLPMCL00
.
          MOVE      SP70,WBSRV001
          MOVE      SP70,WBSRV002
          MOVE      SP70,WBSRV003
          MOVE      SP70,WBSRV004
          MOVE      SP70,WBSRV005
          MOVE      SP70,WBSRV006
          MOVE      SP70,WBSRV007
          MOVE      SP70,WBSRV008
          MOVE      SP70,WBSRV009
          MOVE      SP70,WBSRV010
          MOVE      SP70,WBSRV011
          MOVE      SP70,WBSRV012
          MOVE      SP70,WBSRV013
          MOVE      SP70,WBSRV014
          MOVE      SP70,WBSRV015
          MOVE      SP70,WBSRV016
          MOVE      SP70,WBSRV017
          MOVE      SP70,WBSRV018
          MOVE      SP70,WBSRV019
          MOVE      SP70,WBSRV020
          MOVE      SP70,WBSRV021
          MOVE      SP70,WBSRV022
          MOVE      SP70,WBSRV023
          MOVE      SP70,WBSRV024
          MOVE      SP70,WBSRV025
          MOVE      SP70,WBSRV026
          MOVE      SP70,WBSRV027
          MOVE      SP70,WBSRV028
          MOVE      SP70,WBSRV029
          MOVE      SP70,WBSRV030
          MOVE      SP70,WBSRV031
          MOVE      SP70,WBSRV032
          MOVE      SP70,WBSRV033
          MOVE      SP70,WBSRV034
          MOVE      SP70,WBSRV035
          MOVE      SP70,WBSRV036
          MOVE      SP70,WBSRV037
          MOVE      SP70,WBSRV038
          MOVE      SP70,WBSRV039
          MOVE      SP70,WBSRV040
          MOVE      SP70,WBSRV041
          MOVE      SP70,WBSRV042
          MOVE      SP70,WBSRV043
.
          CALL      CPWEB200
.
          MOVE      SP70,WEBOPVKY
          MOVE      SP70,WEBOVVKY
          MOVE      SP70,WEBOECKY
.
          MOVE      SP70,NHCIH001
          MOVE      SP70,NHCIH002
          PACK      NHCIH003,SP70,SP70,SP70
          PACK      NHCIH004,SP70,SP70,SP70
          MOVE      SP70,NHCIH005
          MOVE      SP70,NHCIH006
          PACK      NHCIH007,SP70,SP70,SP70
          PACK      NHCIH008,SP70,SP70,SP70
          PACK      NHCIH009,SP70,SP70,SP70
.
          CALL      CPPMND00
.
CLRPAR99  RETURN
.------------------------------------------------------------
. Set Parameters
.------------------------------------------------------------
SETPAR00  MATCH     "reportno=",QRYNAME
          IF        @EQUAL
            MOVE      QRYDATA,REPORTNO
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "template=",QRYNAME
          IF        @EQUAL
            MOVE      QRYDATA,TEMPLATE
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "urnumber=",QRYNAME
          IF        @EQUAL
            MOVE      QRYDATA,URNUMBER
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "nourselc=",QRYNAME
          IF        @EQUAL
            MOVE      QRYDATA,NOURSELC
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "updatety=",QRYNAME
          IF        @EQUAL
            SQUEEZE   QRYDATA
            MOVE      QRYDATA,UPDATETY
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "updattyp=",QRYNAME
          IF        @EQUAL
            MOVE      QRYDATA,UPDATTYP
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "pataltid=",QRYNAME
          IF        @EQUAL
            MOVE      QRYDATA,PATALTID
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "pmsaltid=",QRYNAME
          IF        @EQUAL
            PACK      PMSALTID,QRYDATA,SP70
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "claimtyp=",QRYNAME
          IF        @EQUAL
            MOVE      QRYDATA,CLAIMTYP
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "admissno=",QRYNAME
          IF        @EQUAL
            MOVE      QRYDATA,ADMISSNO
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "pmnut",QRYNAME
          IF        @EQUAL
            CALL      SPNUT000
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "startnot=",QRYNAME
          IF        @EQUAL
            SQUEEZE   QRYDATA
            MOVE      QRYDATA,STARTNOT
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "redirect=",QRYNAME
          IF        @EQUAL
            SQUEEZE   QRYDATA
            MOVE      QRYDATA,REDIRECT
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "nextpage=",QRYNAME
          IF        @EQUAL
            SQUEEZE   QRYDATA
            MOVE      QRYDATA,NEXTPAGE
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "bookflag=",QRYNAME
          IF        @EQUAL
            MOVE      QRYDATA,BOOKFLAG
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "updttype=",QRYNAME
          IF        @EQUAL
            MOVE      QRYDATA,UPDTTYPE
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "proddind=",QRYNAME
          IF        @EQUAL
            MOVE      QRYDATA,PRODDIND
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "nihcdind=",QRYNAME
          IF        @EQUAL
            MOVE      QRYDATA,NIHCDIND
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "epscd001=",QRYNAME
          IF        @EQUAL
            MOVE      QRYDATA,EPSCD001
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "srchtype=",QRYNAME
          IF        @EQUAL
            SQUEEZE   QRYDATA
            MOVE      QRYDATA,SRCHTYPE
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "srchview=",QRYNAME
          IF        @EQUAL
            MOVE      QRYDATA,SRCHVIEW
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "pmsvx044=",QRYNAME
          IF        @EQUAL
            MOVE      QRYDATA,PMSVX044
            PACK      PMSVX044,PMSVX044,SP70
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "codedflg=",QRYNAME
          IF        @EQUAL
            MOVE      QRYDATA,CODEDFLG
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "viewtype=",QRYNAME
          IF        @EQUAL
            MOVE      QRYDATA,VIEWTYPE
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "frstdate=",QRYNAME
          IF        @EQUAL
            MOVE      QRYDATA,FRSTDATE
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "lastdate=",QRYNAME
          IF        @EQUAL
            MOVE      QRYDATA,LASTDATE
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "lfstdate=",QRYNAME
          IF        @EQUAL
            MOVE      "00000000",FRSTDATE
            MATCH     SP20,QRYDATA
            IF        !@EOS
              UNPACK    QRYDATA,CDAY,KEY1,MTHNAM3,KEY1,CCENT,CYEAR
              CALL      SETMTH00
              PACK      FRSTDATE,CCENT,CYEAR,CMON,CDAY
              REP       " 0",FRSTDATE
            ENDIF
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "llstdate=",QRYNAME
          IF        @EQUAL
            MOVE      "99999999",LASTDATE
            MATCH     SP20,QRYDATA
            IF        !@EOS
              UNPACK    QRYDATA,CDAY,KEY1,MTHNAM3,KEY1,CCENT,CYEAR
              CALL      SETMTH00
              PACK      LASTDATE,CCENT,CYEAR,CMON,CDAY
              REP       " 0",LASTDATE
            ENDIF
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "vyearmth=",QRYNAME
          IF        @EQUAL
            MOVE      QRYDATA,VYEARMTH
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "clnot001",QRYNAME
          IF        @EQUAL
            MOVE      QRYDATA,CLNOT001
            PACK      CLNOT001,CLNOT001,SP70
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "wbsec008",QRYNAME
          IF        @EQUAL
            MOVE      QRYDATA,WBSEC008
            PACK      WBSEC008,WBSEC008,SP70
            GOTO      SETPAR99
          ENDIF
.
.          MATCH     "ptvis067=",QRYNAME            * I SRF 22685
.          IF        @EQUAL
.            MOVE      QRYDATA,PTVIS067             * Populate CGI parameter
.            GOTO      SETPAR99                     * with diet comment
.          ENDIF
.                                                  * end I SRF 22685
          MATCH     "filtvtyp=",QRYNAME
          IF        @EQUAL
            MOVE      QRYDATA,FILTVTYP
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "filtflag=",QRYNAME
          IF        @EQUAL
            MOVE      QRYDATA,FILTFLAG
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "filthosp=",QRYNAME
          IF        @EQUAL
            MOVE      QRYDATA,FILTHOSP
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "alrtfltr=",QRYNAME
          IF        @EQUAL
            MOVE       QRYDATA,ALRTFLTR
            GOTO       SETPAR99
          ENDIF
.
          MATCH     "startnum=",QRYNAME
          IF        @EQUAL
            MOVE      QRYDATA,STARTNUM
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "norecord=",QRYNAME
          IF        @EQUAL
            MOVE      QRYDATA,NORECORD
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "nextvkey=",QRYNAME
          IF        @EQUAL
            MOVE      QRYDATA,NEXTVKEY
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "prevvkey=",QRYNAME
          IF        @EQUAL
            MOVE      QRYDATA,PREVVKEY
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "prevflag=",QRYNAME
          IF        @EQUAL
            MOVE      QRYDATA,PREVFLAG
            GOTO      SETPAR99
          ENDIF
.
          MATCH      "updtacno",QRYNAME
          IF         @EQUAL
            COMPARE   "99",TACCOUNT
            GOTO      SETPAR99 IF EQUAL
            ADD       ONE,TACCOUNT
            PACK      TACRECKY[TACCOUNT],QRYDATA,SP70
            GOTO      SETPAR99
          ENDIF
.
          MATCH      "updwcono",QRYNAME
          IF         @EQUAL
            COMPARE   "99",WCOCOUNT
            GOTO      SETPAR99 IF EQUAL
            ADD       ONE,WCOCOUNT
            PACK      WCORECKY[WCOCOUNT],QRYDATA,SP70
            GOTO      SETPAR99
          ENDIF
.
. *I-903005 ---- start
.
          MATCH     "selprint=",QRYNAME
          IF        @EQUAL
            SQUEEZE   QRYDATA
            MOVE      QRYDATA,SELPRINT
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "schdcopy=",QRYNAME
          IF        @EQUAL
            SQUEEZE   QRYDATA
            MOVE      QRYDATA,NOLABEL
            GOTO      SETPAR99
          ENDIF
.
. *I-903005 ---- end
.
          CALL       SPPRA000          * Set parameters for PRFA
.
          MATCH     "ptmmb",QRYNAME
          IF        @EQUAL
            CALL      STMMB000
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "filtfdat=",QRYNAME
          IF        @EQUAL
            UNPACK    QRYDATA,CDAY,KEY1,MTHNAM3,KEY1,CCENT,CYEAR
            CALL      SETMTH00                *Set CMON from MTHNAM3
            PACK      FILTFDAT,CCENT,CYEAR,CMON,CDAY
          ENDIF
.
          MATCH     "filttdat=",QRYNAME
          IF        @EQUAL
            UNPACK    QRYDATA,CDAY,KEY1,MTHNAM3,KEY1,CCENT,CYEAR
            CALL      SETMTH00                *Set CMON from MTHNAM3
            PACK      FILTTDAT,CCENT,CYEAR,CMON,CDAY
          ENDIF
.
          MATCH     "superlev=",QRYNAME
          IF        @EQUAL
            PACK      SUPERLEV,QRYDATA,SP70
          ENDIF
.
          MATCH     "filtdept=",QRYNAME
          IF        @EQUAL
            PACK      FILTDEPT,QRYDATA,SP70
          ENDIF
.
          MATCH     "deftflag=",QRYNAME
          IF        @EQUAL
            MOVE      QRYDATA,DEFTFLAG
          ENDIF
.
          MATCH     "pmsovrky=",QRYNAME
          IF        @EQUAL
            PACK      PMSOVRKY,QRYDATA,SP70
          ENDIF
.
          MATCH     "pmsovvky=",QRYNAME
          IF        @EQUAL
            PACK      PMSOVVKY,QRYDATA,SP70
          ENDIF
.
          MATCH     "uniqnumb=",QRYNAME
          IF        @EQUAL
            MOVE      QRYDATA,UNIQNUMB
            GOTO      SETPAR99
          ENDIF
.
.          MATCH     "prhre001=",QRYNAME
.          IF        @EQUAL
.            MOVE      QRYDATA,PRHRE001
.            GOTO      SETPAR99
.          ENDIF
.
.          MATCH     "prhre002=",QRYNAME
.          IF        @EQUAL
.            MOVE      QRYDATA,PRHRE002
.            GOTO      SETPAR99
.          ENDIF
.
.          MATCH     "prhre003=",QRYNAME
.          IF        @EQUAL
.            MOVE      QRYDATA,PRHRE003
.            GOTO      SETPAR99
.          ENDIF
.
          MATCH     "prhre",QRYNAME
          IF        @EQUAL
            CALL      SPPRHR00
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "mavbatch=",QRYNAME
          IF        @EQUAL
            MOVE      QRYDATA,MAVBATCH
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "mavinvce=",QRYNAME
          IF        @EQUAL
            MOVE      QRYDATA,MAVINVCE
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "mavmodul=",QRYNAME
          IF        @EQUAL
            MOVE      QRYDATA,MAVMODUL
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "exdtblnk=",QRYNAME
          IF        @EQUAL
            MOVE      QRYDATA,EXDTBLNK
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "allhflag=",QRYNAME
          IF        @EQUAL
            MOVE      QRYDATA,ALLHFLAG
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "filturno=",QRYNAME
          IF        @EQUAL
            MOVE      QRYDATA,FILTURNO
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "ecotfund=",QRYNAME
          IF        @EQUAL
            MOVE      QRYDATA,ECOTFUND
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "ecottype=",QRYNAME
          IF        @EQUAL
            MOVE      QRYDATA,ECOTTYPE
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "ecottrid=",QRYNAME
          IF        @EQUAL
            MOVE      QRYDATA,ECOTTRID
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "hlfdclty=",QRYNAME
          IF        @EQUAL
            MOVE      QRYDATA,HLFDCLTY
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "hlthfund=",QRYNAME
          IF        @EQUAL
            MOVE      QRYDATA,HLTHFUND
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "exclwait=",QRYNAME
          IF        @EQUAL
            MOVE      QRYDATA,EXCLWAIT
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "filtadmn=",QRYNAME
          IF        @EQUAL
            MOVE      QRYDATA,FILTADMN
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "batchnum=",QRYNAME
          IF        @EQUAL
            MOVE      QRYDATA,BATCHNUM
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "claimsta=",QRYNAME
          IF        @EQUAL
            MOVE      QRYDATA,CLAIMSTA
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "invnumbr=",QRYNAME
          IF        @EQUAL
            MOVE      QRYDATA,INVNUMBR
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "procstat=",QRYNAME
          IF        @EQUAL
            MOVE      QRYDATA,PROCSTAT
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "exclclos=",QRYNAME
          IF        @EQUAL
            MOVE      QRYDATA,EXCLCLOS
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "hospcode=",QRYNAME
          IF        @EQUAL
            MOVE      QRYDATA,HOSPCODE
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "btschosp=",QRYNAME
          IF        @EQUAL
            MOVE      QRYDATA,BTSCHOSP
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "valdtype=",QRYNAME
          IF        @EQUAL
            MOVE      QRYDATA,VALDTYPE
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "valdcode=",QRYNAME
          IF        @EQUAL
            MOVE      QRYDATA,VALDCODE
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "valdhosp=",QRYNAME
          IF        @EQUAL
            MOVE      QRYDATA,VALDHOSP
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "valduser=",QRYNAME
          IF        @EQUAL
            MOVE      QRYDATA,VALDUSER
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "valdrole=",QRYNAME
          IF        @EQUAL
            MOVE      QRYDATA,VALDROLE
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "valdtaud=",QRYNAME
          IF        @EQUAL
            MOVE      QRYDATA,VALDTAUD
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "valdurno=",QRYNAME
          IF        @EQUAL
            MOVE      QRYDATA,VALDURNO
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "valdvisn=",QRYNAME
          IF        @EQUAL
            MOVE      QRYDATA,VALDVISN
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "ecclfbid=",QRYNAME
          IF        @EQUAL
            MOVE      QRYDATA,ECCLFBID
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "ecclarid=",QRYNAME
          IF        @EQUAL
            MOVE      QRYDATA,ECCLARID
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "ecclclid=",QRYNAME
          IF        @EQUAL
            MOVE      QRYDATA,ECCLCLID
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "ecclrptc=",QRYNAME
          IF        @EQUAL
            MOVE      QRYDATA,ECCLRPTC
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "ecclitmn=",QRYNAME
          IF        @EQUAL
            MOVE      QRYDATA,ECCLITMN
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "ecclsrvc=",QRYNAME
          IF        @EQUAL
            MOVE      QRYDATA,ECCLSRVC
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "ecclrkey=",QRYNAME
          IF        @EQUAL
            MOVE      QRYDATA,ECCLRKEY
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "pmclt",QRYNAME
          IF        @EQUAL
            CALL      SPMCL000
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "web2b",QRYNAME
          IF        @EQUAL
            CALL      SPWEB000
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "wbsrv",QRYNAME
          IF        @EQUAL
            CALL      SWBSR000
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "webopvky=",QRYNAME
          IF        @EQUAL
            MOVE      QRYDATA,WEBOPVKY
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "webovvky=",QRYNAME
          IF        @EQUAL
            MOVE      QRYDATA,WEBOVVKY
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "weboecky=",QRYNAME
          IF        @EQUAL
            MOVE      QRYDATA,WEBOECKY
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "pmndb",QRYNAME
          IF        @EQUAL
            CALL      SPPMN000
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "nhcih",QRYNAME
          IF        @EQUAL
            CALL      SNHCI000
            GOTO      SETPAR99
          ENDIF
.
SETPAR99  RETURN
+
.------------------------------------------------------------
.   Set Parameters for Medical Records MBS
.------------------------------------------------------------
STMMB000  MOVE      ZERO,EXIT
          UNPACK    QRYNAME,KEY5,KEY3
          MOVE      KEY3,F3
          BRANCH    F3,STMMB010,STMMB020,STMMB030,STMMB040,STMMB050:
                       STMMB060,STMMB070
.
          MOVE      ONE,EXIT
          GOTO      STMMB999

STMMB010  PACK      PTMMB001,QRYDATA,SP70
          GOTO      STMMB999
.
STMMB020  MOVE      QRYDATA,PTMMB002
          GOTO      STMMB999
.
STMMB030  MOVE      QRYDATA,PTMMB003
          GOTO      STMMB999
.
STMMB040  UNPACK    QRYDATA,CDAY,KEY1,MTHNAM3,KEY1,CCENT,CYEAR
          CALL      SETMTH00                *Set CMON from MTHNAM3
          PACK      PTMMB004,CCENT,CYEAR,CMON,CDAY
          GOTO      STMMB999
.
STMMB050  PACK      PTMMB005,QRYDATA,SP70
          GOTO      STMMB999
.
STMMB060  PACK      PTMMB006,QRYDATA,SP70
          GOTO      STMMB999
.
STMMB070  PACK      PTMMB007,QRYDATA,SP70
          GOTO      STMMB999
.
STMMB999  RETURN
+
.---------------------------------------------------------------------------
. Patient Details from master file to display in table c
.   Requires ADMISSNO & URNUMBER to be set.
.   URNUMBER can be blank if a Valid Admission Record is Expected.
.---------------------------------------------------------------------------
GETPAT00  MOVE      ADMISSNO,KEY8
          CALL      RDMISS1
          IF        OVRCD=0
            MOVE      AURNO,URNUMBER
          ENDIF
          MOVE      OVRCD,MISSFLAG
.
          MATCH     "       0",URNUMBER
          IF        @EQUAL
            MOVE      ADMISSNO,KEY8
            CALL      RDPRAM1
            BRANCH    OVRCD,GETPAT95
          ELSE
            PACK      KEY8,URNUMBER
            CALL      RDMAST1
            BRANCH    OVRCD,GETPAT95
            PACK      KEY8,URNUMBER
            CALL      RDPMPX21
            BRANCH    OVRCD,GETPAT95
          ENDIF
.
          CALL      PATINT00                * Format Patient Name with Initial
.
          IF        PCEASE=1
            MOVE      PDECDTE,AGEDATE            * Date of Death
          ELSE
            PACK      AGEDATE,CCC,CYY,CMM,CDD    * Today's date
          ENDIF
          REP       " 0",AGEDATE
          CALL      CALCAGE
.
          MOVE      SP70,DOCFNAME
          PACK      KEY6,ADOCTA
          CALL      RDDOCT1
          IF        OVRCD=0
            MOVE      DTITL,FMTTITLE            * I CAR 13038
            MOVE      DGNAME,FMTGNAME
            MOVE      DSNAME,FMTSNAME
            CALL      DOCNM000                  * end I CAR 13038
            PACK      SDOCFNAM,DOCFNAME
...         CALL      SDOCNM00
          ENDIF
.
GETPAT10  MOVE      SP70,DESCDPST
.
          PACK      KEY8,ADMISSNO,SP70
          CALL      RDPMWOR1
          IF        OVRCD=1
            CALL      CLPMWO00
          ENDIF
.
          MATCH     SP70,PMWODPST
          IF        !@EQUAL
            PACK      KEY5,CATLVI,PMWODPST,SP70
            CALL      RDCODE1
            IF        OVRCD=1
              MOVE      PMWODPST,TDESC
            ENDIF
            MOVE     TDESC,DESCDPST
          ENDIF
.
          COMPARE   "999",ASTAY
          IF        @EQUAL
            PACK      EXPCTDSC,HYPHEN,SP70
            GOTO      GETPAT20
          ENDIF
.
          MATCH     SP70,PMWOEDAT
          IF        !@EQUAL
            UNPACK    PMWOEDAT,CCENT,CYEAR,CMON,CDAY
            MOVE      CMON,F2
            LOAD      MTHNAM3,F2,JAN,FEB,MAR,APR,MAY,JUN,JUL,AUG,SEP,OCT,NOV,DEC
            PACK      EXPCTDSC,CDAY,SP1,MTHNAM3,SP1,CCENT,CYEAR,SP1,PMWOEDTM
            MATCH     SP70,PMWOEDTM
            IF        @EQUAL
              PACK      FHRENDDT,CCENT,CYEAR,FHRDASH,CMON,FHRDASH,CDAY
            ELSE
              PACK      FHRENDDT,CCENT,CYEAR,FHRDASH,CMON,FHRDASH,CDAY,ANST,PMWOEDTM,TIMEZONE,SP70
            ENDIF
            GOTO      GETPAT20
          ENDIF
.
          MOVE      CCC,CCENT
          UNPACK    ADATE,CCENT,CYEAR,CMON,CDAY
          MOVE      ASTAY,ADJDAYS
          CALL      ADJDAT00
          MOVE      CMON,F2
          LOAD      MTHNAM3,F2,JAN,FEB,MAR,APR,MAY,JUN,JUL,AUG,SEP,OCT,NOV,DEC
          PACK      EXPCTDSC,CDAY,SP1,MTHNAM3,SP1,CCENT,CYEAR
          PACK      FHRENDDT,CCENT,CYEAR,FHRDASH,CMON,FHRDASH,CDAY
.
. Find if expected disch date is =,<, or > current date and set bgcolor flag
.
GETPAT20  MOVE      SP70,COLRFLAG
          PACK      EXPCDATE,CCENT,CYEAR,CMON,CDAY
          CALL      IBACLOCK
          PACK      CURRDATE,CCC,CYY,CMM,CDD
          REP       " 0",CURRDATE
          MATCH     CURRDATE,EXPCDATE
          IF        @EQUAL
            MOVE      "CurrDischDate",COLRFLAG        * Set bgcolor to Current
          ENDIF
          IF        @LESS
            MOVE      "PastDischDate",COLRFLAG          * set bgcolor to past
          ENDIF
.
          PACK      KEY3,SP70
          PACK      KEY8,URNUMBER
          CALL      RDPMPX21
          BRANCH    OVRCD,GETPAT95

          MOVE      AADMNO,PMVXVISN            * Find Visit extension record
          PACK      KEY8,PMVXVISN,SP70
          CALL      RDPMVX11
          IF        OVRCD=1
            MOVE      SP70,PMVXVALW
            MOVE      SP70,PMVXPALW
            MOVE      SP70,PMVXUDF2
            MOVE      SP70,PMVXPOWD
            MOVE      SP70,PMVXPOBD
          ENDIF
.
          GOTO      GETPAT99
.
GETPAT95  MOVE      "Invalid Record",PSNAME
          MOVE      SP70,PGNAME
          MOVE      SP70,PTITL
          CALL      PATNAM00
.
GETPAT99  RETURN
.------------------------------------------------------------
. Get Concession Card Details if they exist
.------------------------------------------------------------
GETCCD00  UNPACK    SP70,CCRDTYPE,CCRDNUMB,CCRDEXDT
          PACK      KEY19,URNUMBER,SP70
          CALL      RSPMCCD1
          CALL      RKPMCCD1
          BRANCH    OVRCD,GETCCD99
.
          MATCH     URNUMBER,PMCDURNO
          GOTO      GETCCD99 IF NOT EQUAL
.
          MOVE      PMCDCNUM,CCRDNUMB            * card number
.
          PACK      KEY5,CATct,PMCDCTYP,SP70
          CALL      RDCODE1
          IF        OVRCD<>1
            MOVE      TDESC,CCRDTYPE             * card type
          ENDIF
.
          PACK      CCRDEXDT,PMCDEXDT,SP70       * card expiry date
.
GETCCD99  RETURN
.
.------------------------------------------------------------
. Get Alternate ID
.------------------------------------------------------------
GETALT00  
          PACK      KEY30,PATALTID,SP70
          CALL      RSPTNID2
          CALL      RKPTNID2
          BRANCH    OVRCD,GETALT90          * no record on file
          MATCH     PATALTID,PTNINMPI
          GOTO      GETALT90 IF NOT EQUAL   * different National UR
          MOVE      PTNILNUM,URNUMBER
          MOVE      ZERO,EXIT
          GOTO      GETALT99
GETALT90  MOVE      "Can't find patient master details",WEBTITLE
          CALL      WEBERR00
          MOVE      ONE,EXIT
GETALT99  RETURN
.
.------------------------------------------------------------
. Get Alternate ID from PMSAIDFD
.------------------------------------------------------------
GETAID00  COMPARE   ONE,PTCNUALT            * Using Alternate ID
          GOTO      GETAID99 IF NOT EQUAL
.
          MATCH     SP70,URNUMBER           * Exit if there is a urnumber
          GOTO      GETAID99 IF NOT EQUAL
.
          PACK      KEY31,PMSALTID,SP70
          CALL      RSPMAID2
          CALL      RKPMAID2
          BRANCH    OVRCD,GETAID90          * no record on file
.
          MATCH     PMSALTID,PMAIALID
          GOTO      GETAID90 IF NOT EQUAL   * different alternate ID
.
          MOVE      PMAIURNO,URNUMBER
          MOVE      ZERO,EXIT
          GOTO      GETAID99
.
GETAID90  MOVE      "Can't find patient master details",WEBTITLE
          CALL      WEBERR00
          MOVE      ONE,EXIT
.
GETAID99  RETURN
+
.------------------------------------------------------------
. Alert that this is a merged U/R
.------------------------------------------------------------
MRGALT00  MATCH     SP70,URNUMBER
          GOTO      MRGALT99 IF EQUAL
.
          MATCH     SP70,SAVEURNO
          GOTO      MRGALT99 IF EQUAL
.
          MOVE      SAVEURNO,DISPSUR
          SQUEEZE   DISPSUR
          MOVE      URNUMBER,DISPMUR
          SQUEEZE   DISPMUR 
.
          WRITE     HTMLFILE;"<script type=#"text/javascript#"> {":
                             " alert('U/R Number ",DISPSUR," is merged with ":
                             DISPMUR," \n Using ",DISPMUR,"');":
                             "}":
                             "</script>"
          GOTO      MRGALT99
.
MRGALT99  RETURN
.------------------------------------------------------------
. Get Name from Visit Based Tables
.------------------------------------------------------------
FINVIS00  MOVE      ADMISSNO,KEY8
          CALL      RDVISA1
          BRANCH    OVRCD,FINVIS80
.
          BRANCH    PVITYPE,FINVIS10,FINVIS20,FINVIS20
          MOVE      ONE,EXIT
          GOTO      FINVIS99
.
FINVIS10  BRANCH    EMRFLAG,FINVIS90
          MOVE      PVIBILL,KEY8
          CALL      RDEMUNK1
          BRANCH    OVRCD,FINVIS90
          MOVE      SP70,PTITL
          MOVE      EMUNSNAM,PSNAME
          MOVE      EMUNGNAM,PGNAME
          MOVE      EMUNBDAT,PBDATE
          MOVE      EMUNSEX,PSEX
          MOVE      EMUNAGE,PSAGE
          MATCH     SP70,PSNAME
          IF        @EQUAL
            MOVE     EMUNDET1,PSNAME
          ENDIF
          MATCH     SP70,PGNAME
          IF        @EQUAL
            MOVE     EMUNDET2,PGNAME
          ENDIF
          MOVE      ZERO,EXIT
          GOTO      FINVIS99
.
FINVIS20  MOVE      PVIBILL,KEY8
          CALL      RDPRAM1
          BRANCH    OVRCD,FINVIS90
          MOVE      ZERO,EXIT
          GOTO      FINVIS99
.
FINVIS30  MOVE      PVIBILL,KEY8
          CALL      RDPRAM1
          BRANCH    OVRCD,FINVIS90
          MOVE      ZERO,EXIT
          GOTO      FINVIS99
.
FINVIS80  MOVE      ADMISSNO,KEY8
          CALL      RDPRAM1
          BRANCH    OVRCD,FINVIS85
          MOVE      URNUMBER,PURNO
          MOVE      ZERO,EXIT
          GOTO      FINVIS99
.
FINVIS85  BRANCH    EMRFLAG,FINVIS90
          MOVE      ADMISSNO,KEY8
          CALL      RDEMUNK1
          BRANCH    OVRCD,FINVIS90
          MOVE      SP70,PTITL
          MOVE      EMUNSNAM,PSNAME
          MOVE      EMUNGNAM,PGNAME
          MOVE      EMUNBDAT,PBDATE
          MOVE      EMUNSEX,PSEX
          MOVE      EMUNAGE,PSAGE
          MATCH     SP70,PSNAME
          IF        @EQUAL
            MOVE     EMUNDET1,PSNAME
          ENDIF
          MATCH     SP70,PGNAME
          IF        @EQUAL
            MOVE     EMUNDET2,PGNAME
          ENDIF
          MOVE      ZERO,EXIT
          GOTO      FINVIS99
.
FINVIS90  MOVE      ONE,EXIT
.
FINVIS99  RETURN
+
.------------------------------------------------------------
. Process Fields in Body of HTML Template
.------------------------------------------------------------
PROFLD00  BRANCH    REPORTNO,PROFLD10,PROFLD99,PROFLD30,PROFLD40,PROFLD50:
                             PROFLD60
                             
          GOTO      PROFLD99
.
PROFLD10  BRANCH    FLDSETNO,PROFLD11,PROFLD12,PROFLD13,PROFLD14,PROFLD15:
                             PROFLD16,PROFLD17,PROFLD18,PROFLD19,PROFL191
          GOTO      PROFLD99
.
.         ********* PROFLD19 ADDED BY HPS BLR
.
PROFLD11  CALL      MASF0000
          GOTO      PROFLD99
.
PROFLD12  CALL      MISF0000
          GOTO      PROFLD99
.
PROFLD13  CALL      DSCF0000
          GOTO      PROFLD99
.
PROFLD14  CALL      TABL0000     * Table Displays
          GOTO      PROFLD99
.
PROFLD15  CALL      BREC0000     * Patient Bookings Details
          GOTO      PROFLD99
.
PROFLD16  CALL      MSXF0000     * Master Extension Details
          GOTO      PROFLD99
.
PROFLD17  CALL      DRGS0000     * DRG Information 
          GOTO      PROFLD99
.
PROFLD18  CALL      PMIX0000     * Master Extension Details Two
          GOTO      PROFLD99
.
PROFLD19  CALL      ECLP0000
          GOTO      PROFLD99
.
PROFL191  CALL      VISF0000
          GOTO      PROFLD99
.
PROFLD30  BRANCH    FLDSETNO,PROFLD31,PROFLD32
.
PROFLD31  CALL      NITG0000
          GOTO      PROFLD99
.
PROFLD32  CALL      PMND0000
          GOTO      PROFLD99
.
PROFLD40  BRANCH    FLDSETNO,PROFLD41,PROFLD42,PROFLD43,PROFLD44,PROFLD45:
                             PROFLD46,PROFLD47,PROFLD48,PROFLD49,PROFL491
          GOTO      PROFLD99
.
PROFLD41  CALL      MASF0000
          GOTO      PROFLD99
.
PROFLD42  CALL      MISF0000
          GOTO      PROFLD99
.
PROFLD43  CALL      DSCF0000
          GOTO      PROFLD99
.
PROFLD44  CALL      TABL0000     * Table Displays
          GOTO      PROFLD99
.
PROFLD45  CALL      BREC0000     * Patient Bookings Details
          GOTO      PROFLD99
.
PROFLD46  CALL      MSXF0000     * Master Extension Details
          GOTO      PROFLD99
.
PROFLD47  CALL      DRGS0000     * DRG Information
          GOTO      PROFLD99
.
PROFLD48  CALL      PMIX0000     * Master Extension Details Two
          GOTO      PROFLD99
.
PROFLD49  CALL      ECLP0000
          GOTO      PROFLD99
.
PROFL491  CALL      VISF0000
          GOTO      PROFLD99
.
PROFLD50  BRANCH    FLDSETNO,PROFLD51,PROFLD52,PROFLD53,PROFLD54,PROFLD55:
                             PROFLD56,PROFLD57,PROFLD58,PROFLD59,PROFL591
          GOTO      PROFLD99
.
PROFLD51  CALL      MASF0000
          GOTO      PROFLD99
.
PROFLD52  CALL      MISF0000
          GOTO      PROFLD99
.
PROFLD53  CALL      DSCF0000
          GOTO      PROFLD99
.
PROFLD54  CALL      TABL0000     * Table Displays
          GOTO      PROFLD99
.
PROFLD55  CALL      BREC0000     * Patient Bookings Details
          GOTO      PROFLD99
.
PROFLD56  CALL      MSXF0000     * Master Extension Details
          GOTO      PROFLD99
.
PROFLD57  CALL      DRGS0000     * DRG Information
          GOTO      PROFLD99
.
PROFLD58  CALL      PMIX0000     * Master Extension Details Two
          GOTO      PROFLD99
.
PROFLD59  CALL      ECLP0000
          GOTO      PROFLD99
.
PROFL591  CALL      VISF0000
          GOTO      PROFLD99
.
PROFLD60  BRANCH    FLDSETNO,PROFLD61,PROFLD62,PROFLD63,PROFLD64,PROFLD65:
                             PROFLD66,PROFLD67,PROFLD68,PROFLD69,PROFL691
          GOTO      PROFLD99
.
PROFLD61  CALL      MASF0000
          GOTO      PROFLD99
.
PROFLD62  CALL      MISF0000
          GOTO      PROFLD99
.
PROFLD63  CALL      DSCF0000
          GOTO      PROFLD99
.
PROFLD64  CALL      TABL0000     * Table Displays
          GOTO      PROFLD99
.
PROFLD65  CALL      BREC0000     * Patient Bookings Details
          GOTO      PROFLD99
.
PROFLD66  CALL      MSXF0000     * Master Extension Details
          GOTO      PROFLD99
.
PROFLD67  CALL      DRGS0000     * DRG Information
          GOTO      PROFLD99
.
PROFLD68  CALL      PMIX0000     * Master Extension Details Two
          GOTO      PROFLD99
.
PROFLD69  CALL      ECLP0000
          GOTO      PROFLD99
.
PROFL691  CALL      VISF0000
          GOTO      PROFLD99
.
PROFLD99  RETURN
+
.---------------------------------------------------------------------
. WebServices Tags 
.---------------------------------------------------------------------
ECLP0000  BRANCH    FLDITMNO,ECLP0010,ECLP0020,ECLP0030,ECLP0040,ECLP0050:
                             ECLP0060,ECLP0070,ECLP0080,ECLP0090,ECLP0100:
                             ECLP0110,ECLP0120,ECLP0130,ECLP0140,ECLP0150:
                             ECLP0160,ECLP0170,ECLP0180,ECLP0190,ECLP0200:
                             ECLP0210,ECLP0220,ECLP0230,ECLP0240,ECLP0250:
                             ECLP0260,ECLP0270,ECLP0280,ECLP0290,ECLP0300:
                             ECLP0310,ECLP0320,ECLP0330,ECLP0340,ECLP0350:
                             ECLP0360,ECLP0370,ECLP0380,ECLP0390,ECLP0400:
                             ECLP0410,ECLP0420,ECLP0430,ECLP0440,ECLP0450:
                             ECLP0460,ECLP0470,ECLP0480,ECLP0490,ECLP0500:
                             ECLP0510,ECLP0520,ECLP0530,ECLP0540,ECLP0550:
                             ECLP0560,ECLP0570,ECLP0580,ECLP0590,ECLP0600:
                             ECLP0610,ECLP0620
        
.
          GOTO      ECLP9999
.
ECLP0010  MOVE      ONE,FORM1
          CALL      WEBOPV00
          GOTO      ECLP9999
.
ECLP0020  MOVE      TWO,FORM1
          CALL      WEBOPV00
          GOTO      ECLP9999
.
ECLP0030  MOVE      THREE,FORM1
          CALL      WEBOPV00
          GOTO      ECLP9999
.
ECLP0040  MOVE      FOUR,FORM1
          CALL      WEBOPV00
          GOTO      ECLP9999
.
ECLP0050  MOVE      FIVE,FORM1
          CALL      WEBOPV00
          GOTO      ECLP9999
.
ECLP0060  MOVE      SIX,FORM1
          CALL      WEBOPV00
          GOTO      ECLP9999
.
ECLP0070  MOVE      SEVEN,FORM1
          CALL      WEBOPV00
          GOTO      ECLP9999
.
ECLP0080  MOVE      EIGHT,FORM1
          CALL      WEBOPV00
          GOTO      ECLP9999
.
ECLP0090  MATCH     SP70,WBB2DPTH
          IF        @EQUAL | @EOS
            WRITE     HTMLFILE;"WebServices B2B Device directory not found.";
            GOTO      ECLP9999
          ENDIF
.
          MATCH     SP70,WBOPTRID
          IF        @EQUAL | @EOS
            WRITE     HTMLFILE;"Header properties file not found.";
            GOTO      ECLP9999
          ENDIF
.
          CLEAR     CMDLINE
          APPEND    WBB2DPTH,CMDLINE
          RESET     CMDLINE
          STRIP     CMDLINE
          ENDSET    CMDLINE
          APPEND    "/webPAS_claims/opvw/",CMDLINE
          RESET     CMDLINE
          STRIP     CMDLINE
          ENDSET    CMDLINE
          APPEND    WBOPTRID,CMDLINE
          APPEND    PROPLITR,CMDLINE
          RESET     CMDLINE 
.
          WRITE     HTMLFILE;CMDLINE;
          GOTO      ECLP9999
.
ECLP0100  CALL      OPVHED00
          GOTO      ECLP9999
.
ECLP0110  MATCH     SP70,WBB2DPTH
          IF        @EQUAL | @EOS
            WRITE     HTMLFILE;"WebServices B2B Device directory not found.";
            GOTO      ECLP9999
          ENDIF
.
          MATCH     SP70,WBOPTRID
          IF        @EQUAL | @EOS
            WRITE     HTMLFILE;"JSON Request file not found.";
            GOTO      ECLP9999
          ENDIF
.
          CLEAR     CMDLINE
          APPEND    WBB2DPTH,CMDLINE
          RESET     CMDLINE
          STRIP     CMDLINE
          ENDSET    CMDLINE
          APPEND    "/webPAS_claims/opvw/",CMDLINE
          RESET     CMDLINE
          STRIP     CMDLINE
          ENDSET    CMDLINE
          APPEND    WBOPTRID,CMDLINE
          APPEND    OPVWLITR,CMDLINE
          RESET     CMDLINE
.
          WRITE     HTMLFILE;CMDLINE;
          GOTO      ECLP9999
.
ECLP0120  CALL      OPVJSN00
          GOTO      ECLP9999
.
ECLP0130  MATCH     SP70,WBB2DPTH
          IF        @EQUAL | @EOS
            WRITE     HTMLFILE;"WebServices B2B Device directory not found.";
            GOTO      ECLP9999
          ENDIF
.
          MATCH     SP70,WBOPTRID
          IF        @EQUAL | @EOS
            WRITE     HTMLFILE;"JSON Response file not found.";
            GOTO      ECLP9999
          ENDIF
.
          CLEAR     CMDLINE
          APPEND    WBB2DPTH,CMDLINE
          RESET     CMDLINE
          STRIP     CMDLINE
          ENDSET    CMDLINE
          APPEND    "/webPAS_claims/opvw/",CMDLINE
          RESET     CMDLINE
          STRIP     CMDLINE
          ENDSET    CMDLINE
          APPEND    WBOPTRID,CMDLINE
          APPEND    OPVRLITR,CMDLINE
          RESET     CMDLINE
.
          WRITE     HTMLFILE;CMDLINE;
          GOTO      ECLP9999
.
ECLP0140  CALL      OPVRSP00
          GOTO      ECLP9999
.
ECLP0150  MATCH     SP70,WBB2DPTH
          IF        @EQUAL | @EOS
            WRITE     HTMLFILE;"WebServices B2B Device directory not found.";
            GOTO      ECLP9999
          ENDIF
.
          MATCH     SP70,WBOPTRID
          IF        @EQUAL | @EOS
            WRITE     HTMLFILE;"Transmission log file not found.";
            GOTO      ECLP9999
          ENDIF
.
          CLEAR     CMDLINE
          APPEND    WBB2DPTH,CMDLINE
          RESET     CMDLINE
          STRIP     CMDLINE
          ENDSET    CMDLINE
          APPEND    "/webPAS_claims/opvw/",CMDLINE
          RESET     CMDLINE
          STRIP     CMDLINE
          ENDSET    CMDLINE
          APPEND    WBOPTRID,CMDLINE
          APPEND    OPVELITR,CMDLINE
          RESET     CMDLINE
.
          WRITE     HTMLFILE;CMDLINE;
          GOTO      ECLP9999
.
ECLP0160  CALL      OPVERR00
          GOTO      ECLP9999
.
ECLP0170  MOVE      ONE,FORM2
          CALL      WEBOVV00
          GOTO      ECLP9999
.
ECLP0180  MOVE      TWO,FORM2
          CALL      WEBOVV00
          GOTO      ECLP9999
.
ECLP0190  MOVE      THREE,FORM2
          CALL      WEBOVV00
          GOTO      ECLP9999
.
ECLP0200  MOVE      FOUR,FORM2
          CALL      WEBOVV00
          GOTO      ECLP9999
.
ECLP0210  MOVE      FIVE,FORM2
          CALL      WEBOVV00
          GOTO      ECLP9999
.
ECLP0220  MOVE      SIX,FORM2
          CALL      WEBOVV00
          GOTO      ECLP9999
.
ECLP0230  MOVE      SEVEN,FORM2
          CALL      WEBOVV00
          GOTO      ECLP9999
.
ECLP0240  MOVE      EIGHT,FORM2
          CALL      WEBOVV00
          GOTO      ECLP9999
.
ECLP0250  MOVE      NINE,FORM2
          CALL      WEBOVV00
          GOTO      ECLP9999
.
ECLP0260  MOVE      TEN,FORM2
          CALL      WEBOVV00
          GOTO      ECLP9999
.
ECLP0270  MOVE      TEN1,FORM2
          CALL      WEBOVV00
          GOTO      ECLP9999
.
ECLP0280  MATCH     SP70,WBB2DPTH
          IF        @EQUAL | @EOS
            WRITE     HTMLFILE;"WebServices B2B Device directory not found.";
            GOTO      ECLP9999
          ENDIF
.
          MATCH     SP70,WBOVTRID
          IF        @EQUAL | @EOS
            WRITE     HTMLFILE;"Header properties file not found.";
            GOTO      ECLP9999
          ENDIF
.
          CLEAR     CMDLINE
          APPEND    WBB2DPTH,CMDLINE
          RESET     CMDLINE
          STRIP     CMDLINE
          ENDSET    CMDLINE
          APPEND    "/webPAS_claims/opvw/",CMDLINE
          RESET     CMDLINE
          STRIP     CMDLINE
          ENDSET    CMDLINE
          APPEND    WBOVTRID,CMDLINE
          APPEND    PROPLITR,CMDLINE
          RESET     CMDLINE
.
          WRITE     HTMLFILE;CMDLINE;
          GOTO      ECLP9999
.
ECLP0290  CALL      OVVHED00
          GOTO      ECLP9999
.
ECLP0300  MATCH     SP70,WBB2DPTH
          IF        @EQUAL | @EOS
            WRITE     HTMLFILE;"WebServices B2B Device directory not found.";
            GOTO      ECLP9999
          ENDIF
.
          MATCH     SP70,WBOVTRID
          IF        @EQUAL | @EOS
            WRITE     HTMLFILE;"JSON Request file not found.";
            GOTO      ECLP9999
          ENDIF
.
          CLEAR     CMDLINE
          APPEND    WBB2DPTH,CMDLINE
          RESET     CMDLINE
          STRIP     CMDLINE
          ENDSET    CMDLINE
          APPEND    "/webPAS_claims/opvw/",CMDLINE
          RESET     CMDLINE
          STRIP     CMDLINE
          ENDSET    CMDLINE
          APPEND    WBOVTRID,CMDLINE
          APPEND    OVVWLITR,CMDLINE
          RESET     CMDLINE
.
          WRITE     HTMLFILE;CMDLINE;
          GOTO      ECLP9999
.
ECLP0310  CALL      OVVJSN00
          GOTO      ECLP9999
.
ECLP0320  MATCH     SP70,WBB2DPTH
          IF        @EQUAL | @EOS
            WRITE     HTMLFILE;"WebServices B2B Device directory not found.";
            GOTO      ECLP9999
          ENDIF
.
          MATCH     SP70,WBOVTRID
          IF        @EQUAL | @EOS
            WRITE     HTMLFILE;"JSON Response file not found.";
            GOTO      ECLP9999
          ENDIF
.
          CLEAR     CMDLINE
          APPEND    WBB2DPTH,CMDLINE
          RESET     CMDLINE
          STRIP     CMDLINE
          ENDSET    CMDLINE
          APPEND    "/webPAS_claims/opvw/",CMDLINE
          RESET     CMDLINE
          STRIP     CMDLINE
          ENDSET    CMDLINE
          APPEND    WBOVTRID,CMDLINE
          APPEND    OVVRLITR,CMDLINE
          RESET     CMDLINE
.
          WRITE     HTMLFILE;CMDLINE;
          GOTO      ECLP9999
.
ECLP0330  CALL      OVVRSP00
          GOTO      ECLP9999
.
ECLP0340  MATCH     SP70,WBB2DPTH
          IF        @EQUAL | @EOS
            WRITE     HTMLFILE;"WebServices B2B Device directory not found.";
            GOTO      ECLP9999
          ENDIF
.
          MATCH     SP70,WBOVTRID
          IF        @EQUAL | @EOS
            WRITE     HTMLFILE;"Transmission log file not found.";
            GOTO      ECLP9999
          ENDIF
.
          CLEAR     CMDLINE
          APPEND    WBB2DPTH,CMDLINE
          RESET     CMDLINE
          STRIP     CMDLINE
          ENDSET    CMDLINE
          APPEND    "/webPAS_claims/opvw/",CMDLINE
          RESET     CMDLINE
          STRIP     CMDLINE
          ENDSET    CMDLINE
          APPEND    WBOVTRID,CMDLINE
          APPEND    OVVELITR,CMDLINE
          RESET     CMDLINE
.
          WRITE     HTMLFILE;CMDLINE;
          GOTO      ECLP9999
.
ECLP0350  CALL      OVVERR00
          GOTO      ECLP9999
.
ECLP0360  
.          MOVE      ONE,FORM2
.          CALL      WEBOEC00
          GOTO      ECLP9999
.
ECLP0370  
.          MOVE      TWO,FORM2
.          CALL      WEBOEC00
          GOTO      ECLP9999
.
ECLP0380  
.          MOVE      THREE,FORM2
.          CALL      WEBOEC00
          GOTO      ECLP9999
.
ECLP0390  
.          MOVE      FOUR,FORM2
.          CALL      WEBOEC00
          GOTO      ECLP9999
.
ECLP0400  
.          MOVE      FIVE,FORM2
.          CALL      WEBOEC00
          GOTO      ECLP9999
.
ECLP0410  
.          MOVE      SIX,FORM2
.          CALL      WEBOEC00
          GOTO      ECLP9999
.
ECLP0420  
.          MOVE      SEVEN,FORM2
.          CALL      WEBOEC00
          GOTO      ECLP9999
.
ECLP0430  
.          MOVE      EIGHT,FORM2
.          CALL      WEBOEC00
          GOTO      ECLP9999
.
ECLP0440  
.          MOVE      NINE,FORM2
.          CALL      WEBOEC00
          GOTO      ECLP9999
.
ECLP0450  
.          MOVE      TEN,FORM2
.          CALL      WEBOEC00
          GOTO      ECLP9999
.
ECLP0460  
.          MOVE      TEN1,FORM2
.          CALL      WEBOEC00
          GOTO      ECLP9999
.
ECLP0470  MATCH     SP70,WBB2DPTH
          IF        @EQUAL | @EOS
            WRITE     HTMLFILE;"WebServices B2B Device directory not found.";
            GOTO      ECLP9999
          ENDIF
.
          MATCH     SP70,WBOCTRID
          IF        @EQUAL | @EOS
            WRITE     HTMLFILE;"Header properties file not found.";
            GOTO      ECLP9999
          ENDIF
.
          CLEAR     CMDLINE
          APPEND    WBB2DPTH,CMDLINE
          RESET     CMDLINE
          STRIP     CMDLINE
          ENDSET    CMDLINE
          APPEND    "/webPAS_claims/oecw/",CMDLINE
          RESET     CMDLINE
          STRIP     CMDLINE
          ENDSET    CMDLINE
          APPEND    WBOCTRID,CMDLINE
          APPEND    PROPLITR,CMDLINE
          RESET     CMDLINE
.
          WRITE     HTMLFILE;CMDLINE;
          GOTO      ECLP9999
.
ECLP0480  CALL      OECHED00
          GOTO      ECLP9999
.
ECLP0490  MATCH     SP70,WBB2DPTH
          IF        @EQUAL | @EOS
            WRITE     HTMLFILE;"WebServices B2B Device directory not found.";
            GOTO      ECLP9999
          ENDIF
.
          MATCH     SP70,WBOCTRID
          IF        @EQUAL | @EOS
            WRITE     HTMLFILE;"JSON Request file not found.";
            GOTO      ECLP9999
          ENDIF
.
          CLEAR     CMDLINE
          APPEND    WBB2DPTH,CMDLINE
          RESET     CMDLINE
          STRIP     CMDLINE
          ENDSET    CMDLINE
          APPEND    "/webPAS_claims/oecw/",CMDLINE
          RESET     CMDLINE
          STRIP     CMDLINE
          ENDSET    CMDLINE
          APPEND    WBOCTRID,CMDLINE
          APPEND    OECWLITR,CMDLINE
          RESET     CMDLINE
.
          WRITE     HTMLFILE;CMDLINE;
          GOTO      ECLP9999
.
ECLP0500  CALL      OECJSN00
          GOTO      ECLP9999
.
ECLP0510  MATCH     SP70,WBB2DPTH
          IF        @EQUAL | @EOS
            WRITE     HTMLFILE;"WebServices B2B Device directory not found.";
            GOTO      ECLP9999
          ENDIF
.
          MATCH     SP70,WBOCTRID
          IF        @EQUAL | @EOS
            WRITE     HTMLFILE;"JSON Response file not found.";
            GOTO      ECLP9999
          ENDIF
.
          CLEAR     CMDLINE
          APPEND    WBB2DPTH,CMDLINE
          RESET     CMDLINE
          STRIP     CMDLINE
          ENDSET    CMDLINE
          APPEND    "/webPAS_claims/oecw/",CMDLINE
          RESET     CMDLINE
          STRIP     CMDLINE
          ENDSET    CMDLINE
          APPEND    WBOCTRID,CMDLINE
          APPEND    OECRLITR,CMDLINE
          RESET     CMDLINE
.
          WRITE     HTMLFILE;CMDLINE;
          GOTO      ECLP9999
.
ECLP0520  CALL      OECRSP00
          GOTO      ECLP9999
.
ECLP0530  MATCH     SP70,WBB2DPTH
          IF        @EQUAL | @EOS
            WRITE     HTMLFILE;"WebServices B2B Device directory not found.";
            GOTO      ECLP9999
          ENDIF
.
          MATCH     SP70,WBOCTRID
          IF        @EQUAL | @EOS
            WRITE     HTMLFILE;"Transmission log file not found.";
            GOTO      ECLP9999
          ENDIF
.
          CLEAR     CMDLINE
          APPEND    WBB2DPTH,CMDLINE
          RESET     CMDLINE
          STRIP     CMDLINE
          ENDSET    CMDLINE
          APPEND    "/webPAS_claims/oecw/",CMDLINE
          RESET     CMDLINE
          STRIP     CMDLINE
          ENDSET    CMDLINE
          APPEND    WBOCTRID,CMDLINE
          APPEND    OECELITR,CMDLINE
          RESET     CMDLINE
.
          WRITE     HTMLFILE;CMDLINE;
          GOTO      ECLP9999
.
ECLP0540  CALL      OECERR00
          GOTO      ECLP9999
.
.
.
ECLP0550  MATCH     SP70,WBB2DPTH
          IF        @EQUAL | @EOS
            WRITE     HTMLFILE;"WebServices B2B Device directory not found.";
            GOTO      ECLP9999
          ENDIF
.
          MATCH     SP70,WBOETRID
          IF        @EQUAL | @EOS
            WRITE     HTMLFILE;"Header properties file not found.";
            GOTO      ECLP9999
          ENDIF
.
          CLEAR     CMDLINE
          APPEND    WBB2DPTH,CMDLINE
          RESET     CMDLINE
          STRIP     CMDLINE
          ENDSET    CMDLINE
          APPEND    "/webPAS_claims/oecwecm/",CMDLINE
          RESET     CMDLINE
          STRIP     CMDLINE
          ENDSET    CMDLINE
          APPEND    WBOETRID,CMDLINE
          APPEND    PROPLITR,CMDLINE
          RESET     CMDLINE
.
          WRITE     HTMLFILE;CMDLINE;
          GOTO      ECLP9999
.
ECLP0560  CALL      OEMHED00
          GOTO      ECLP9999
.
ECLP0570  MATCH     SP70,WBB2DPTH
          IF        @EQUAL | @EOS
            WRITE     HTMLFILE;"WebServices B2B Device directory not found.";
            GOTO      ECLP9999
          ENDIF
.
          MATCH     SP70,WBOETRID
          IF        @EQUAL | @EOS
            WRITE     HTMLFILE;"JSON Request file not found.";
            GOTO      ECLP9999
          ENDIF
.
          CLEAR     CMDLINE
          APPEND    WBB2DPTH,CMDLINE
          RESET     CMDLINE
          STRIP     CMDLINE
          ENDSET    CMDLINE
          APPEND    "/webPAS_claims/oecwecm/",CMDLINE
          RESET     CMDLINE
          STRIP     CMDLINE
          ENDSET    CMDLINE
          APPEND    WBOETRID,CMDLINE
          APPEND    OEMWLITR,CMDLINE
          RESET     CMDLINE
.
          WRITE     HTMLFILE;CMDLINE;
          GOTO      ECLP9999
.
ECLP0580  CALL      OEMJSN00
          GOTO      ECLP9999
.
ECLP0590  MATCH     SP70,WBB2DPTH
          IF        @EQUAL | @EOS
            WRITE     HTMLFILE;"WebServices B2B Device directory not found.";
            GOTO      ECLP9999
          ENDIF
.
          MATCH     SP70,WBOETRID
          IF        @EQUAL | @EOS
            WRITE     HTMLFILE;"JSON Response file not found.";
            GOTO      ECLP9999
          ENDIF
.
          CLEAR     CMDLINE
          APPEND    WBB2DPTH,CMDLINE
          RESET     CMDLINE
          STRIP     CMDLINE
          ENDSET    CMDLINE
          APPEND    "/webPAS_claims/oecwecm/",CMDLINE
          RESET     CMDLINE
          STRIP     CMDLINE
          ENDSET    CMDLINE
          APPEND    WBOETRID,CMDLINE
          APPEND    OEMRLITR,CMDLINE
          RESET     CMDLINE
.
          WRITE     HTMLFILE;CMDLINE;
          GOTO      ECLP9999
.
ECLP0600  CALL      OEMRSP00
          GOTO      ECLP9999
.
ECLP0610  MATCH     SP70,WBB2DPTH
          IF        @EQUAL | @EOS
            WRITE     HTMLFILE;"WebServices B2B Device directory not found.";
            GOTO      ECLP9999
          ENDIF
.
          MATCH     SP70,WBOETRID
          IF        @EQUAL | @EOS
            WRITE     HTMLFILE;"Transmission log file not found.";
            GOTO      ECLP9999
          ENDIF
.
          CLEAR     CMDLINE
          APPEND    WBB2DPTH,CMDLINE
          RESET     CMDLINE
          STRIP     CMDLINE
          ENDSET    CMDLINE
          APPEND    "/webPAS_claims/oecwecm/",CMDLINE
          RESET     CMDLINE
          STRIP     CMDLINE
          ENDSET    CMDLINE
          APPEND    WBOETRID,CMDLINE
          APPEND    OEMELITR,CMDLINE
          RESET     CMDLINE
.
          WRITE     HTMLFILE;CMDLINE;
          GOTO      ECLP9999
.
ECLP0620  CALL      OEMERR00
          GOTO      ECLP9999
.
ECLP9999  RETURN
+
.------------------------------------------------------------
. Table Outputs (Visit, Transfers, etc)
.------------------------------------------------------------
TABL0000  BRANCH    FLDITMNO,TABL0100,TABL0200
          GOTO      TABL9999
.
TABL0100  CALL      OPVTAB00
          GOTO      TABL9999
.
TABL0200  CALL      OVVTAB00
          GOTO      TABL9999
.
TABL9999  RETURN
.-----------------------------------------------------------
. Option 1 - DRG Information and Medical Record Options
. First up read DRG File if OVRCD set flag and continue
. This is done here as not to disrupt the Main Routine
.-----------------------------------------------------------
DRGS0000  MOVE      SP70,KEY3
          CALL      GTDRG000       * Get Grouper Version - returns it in KEY3
          COMPARE   ZERO,EPSCD001
          IF        @EQUAL
            MOVE      ONE,EPSCD001   * Set to default to 1 if blank
          ENDIF
          PACK      KEY13,ADMISSNO,EPSCD001,KEY3,SP70 
          CALL      RDPTPGR1   * Read Grouper Details
          IF        OVRCD=1
            PACK      KEY10,ADMISSNO,EPSCD001
            PACK      KEY13,KEY10,SP70 
            CALL      RSPTPGR1   * Read Grouper Details
            CALL      RKPTPGR1
            IF        OVRCD=0
              PACK      DIM10,PTPGADMN,PTPGEPNO
              MATCH     KEY10,DIM10
              GOTO      DRGS0010 IF EQUAL
            ENDIF
            CALL      CLRGRP00
          ENDIF
.
.  Now start normal branch on flditmno section
.
DRGS0010  BRANCH    FLDITMNO,DRGS0100,DRGS0200,DRGS0300,DRGS0400,DRGS0500:
                             DRGS0600,DRGS0700,DRGS0800,DRGS0900,DRGS1000:
                             DRGS1100,DRGS1200,DRGS1300,DRGS1400,DRGS1500:
                             DRGS1600,DRGS1700,DRGS1800,DRGS1900,DRGS2000:
                             DRGS2100,DRGS2200,DRGS2300,DRGS2400,DRGS2500:
                             DRGS2600,DRGS2700,DRGS2800,DRGS2900,DRGS3000:
                             DRGS3100,DRGS3200,DRGS3300,DRGS3400
          GOTO      DRGS9999
.
DRGS0100  CALL      SELEPS00           * Selection List of Episodes
          GOTO      DRGS9999
.
DRGS0200                               * EMPTY!!!!!!!! 
          GOTO      DRGS9999
.
DRGS0300  MATCH     SP70,ACODDTE
          IF        @EQUAL
            WRITE     HTMLFILE;"0";    * Coding Incomplete
          ELSE
            WRITE     HTMLFILE;"1";    * Coding Complete
          ENDIF
          GOTO      DRGS9999
.
DRGS0400  CALL      SHWMAP00   * Set URL Routine           
          GOTO      DRGS9999
.
DRGS0500  WRITE     HTMLFILE;DPTPGADM;  * Admissno No            
          GOTO      DRGS9999
.
DRGS0600  WRITE     HTMLFILE;DPTPGEPN;  * Episode No                    
          GOTO      DRGS9999
.
DRGS0700  WRITE     HTMLFILE;PTPGGPVR;  * Grouper Version               
          GOTO      DRGS9999
.
DRGS0800  MOVE      PTPGNDRG,DDRGCODE   * National DRG                  
          CALL      DISDRG00            * DRG Details
          GOTO      DRGS9999
.
DRGS0900  WRITE     HTMLFILE;PTPGNMDC;  * National MDC                  
          GOTO      DRGS9999
.
DRGS1000  WRITE     HTMLFILE;PTPGNWGT;  * National Weight               
          GOTO      DRGS9999
.
DRGS1100  WRITE     HTMLFILE;PTPGNALS;  * National average LOS              
          GOTO      DRGS9999
.
DRGS1200  MOVE      PTPGSDRG,DDRGCODE   * State DRG                     
          CALL      DISDRG00            * DRG Details
          GOTO      DRGS9999
.
DRGS1300  WRITE     HTMLFILE;PTPGSMDC;  * State MDC                     
          GOTO      DRGS9999
.
DRGS1400  WRITE     HTMLFILE;PTPGSWGT;  * State Weight               
          GOTO      DRGS9999
.
DRGS1500  WRITE     HTMLFILE;PTPGSALS;  * State average LOS               
          GOTO      DRGS9999
.
DRGS1600  MOVE      PTPGLDRG,DDRGCODE   * Local DRG                     
          CALL      DISDRG00            * DRG Details
          GOTO      DRGS9999
.
DRGS1700  WRITE     HTMLFILE;PTPGLMDC;  * Local MDC                     
          GOTO      DRGS9999
.
DRGS1800  WRITE     HTMLFILE;PTPGLWGT;  * Local Weight               
          GOTO      DRGS9999
.
DRGS1900  WRITE     HTMLFILE;PTPGLALS;  * Local average LOS             
          GOTO      DRGS9999
.
DRGS2000  WRITE     HTMLFILE;PTPGPCCL;  * Patient CC class level        
          GOTO      DRGS9999
.
DRGS2100  WRITE     HTMLFILE;PTPGWFIX;  * WIES value fixed              
          GOTO      DRGS9999
.
DRGS2200  WRITE     HTMLFILE;PTPGWVAR;  * WIES value variable           
          GOTO      DRGS9999
.
DRGS2300  WRITE     HTMLFILE;PTPGWTOL;  * WIES value total              
          GOTO      DRGS9999
.
DRGS2400  WRITE     HTMLFILE;PTPGWWTU;  * WIES weight used              
          GOTO      DRGS9999
.
DRGS2500  WRITE     HTMLFILE;PTPGWWTD;  * WIES weight description       
          GOTO      DRGS9999
.
DRGS2600  CALL      WRDDIS00      * Output Discharge Ward Description   
          GOTO      DRGS9999
.
DRGS2700  WRITE     HTMLFILE;PTPGNDRG;  * National DRG
          GOTO      DRGS9999
.
DRGS2800  WRITE     HTMLFILE;PTPGSDRG;  * State DRG
          GOTO      DRGS9999
.
DRGS2900  WRITE     HTMLFILE;PTPGLDRG;  * Local DRG
          GOTO      DRGS9999
.
DRGS3000  MOVE      PTPGNDRG,DDRGCODE   * National DRG
          CALL      WIESVL00            * Display Wies Information
          GOTO      DRGS9999
.
DRGS3100  MOVE      PTPGSDRG,DDRGCODE   * State DRG
          CALL      WIESVL00            * Display Wies Information
          GOTO      DRGS9999
.
DRGS3200  MOVE      PTPGLDRG,DDRGCODE   * Local DRG
          CALL      WIESVL00            * Display Wies Information
          GOTO      DRGS9999
.
DRGS3300  CALL      CODUSR00            * Output Coder User ID
          GOTO      DRGS9999
.
DRGS3400  CALL      CODDAT00            * Output Coding Date and Time
          GOTO      DRGS9999
.
DRGS9999  RETURN
.------------------------------------------------------------
. Codding Date & Time      
. 0.Date 1.Time  
.------------------------------------------------------------
CODDAT00  UNPACK    DIM127,DIM1,KEY1,DIM127
          MOVE      KEY1,F1
          MOVE      ZERO,ECDFLAG   * Diagnosis Episode Flag
.
          PACK      KEY13,ADMISSNO,EPSCD001,Z70
          CALL      RSPTECD1
          CALL      RPPTECD1
          IF        OVRCD=1
            MOVE      ONE,ECDFLAG
            GOTO      CODDAT10
          ENDIF
.
          MATCH     ADMISSNO,DPTEDADM
          IF        !@EQUAL
            MOVE      ONE,ECDFLAG
            GOTO      CODDAT10
          ENDIF
.
.         Check episode operation coding
.
CODDAT10  PACK      KEY13,ADMISSNO,EPSCD001,Z70                       *C-240107
          CALL      RSPTECO1
          CALL      RPPTECO1
          IF        OVRCD=1
            IF        ECDFLAG=1  
              GOTO      CODDAT40
            ENDIF
          ENDIF
.
          MATCH     ADMISSNO,DPTEOADM
          IF        !@EQUAL
            IF        ECDFLAG=1  
              GOTO      CODDAT40
            ENDIF
          ENDIF
.
CODDAT20  MATCH     PTEDDTCD,PTEODTCD
          IF        @EQUAL
            MATCH     PTEDTIME,PTEOTIME
            IF        @LESS          
              MOVE      PTEDDTCD,F8       * Set Disease Date
              MOVE      PTEDTIME,KEY5     * Set Disease Time
              GOTO      CODDAT21
            ELSE
              MOVE      PTEODTCD,F8       * Set Procedure Date
              MOVE      PTEOTIME,KEY5     * Set Procedure Time
              GOTO      CODDAT21
            ENDIF
          ENDIF
.
          MATCH     PTEDDTCD,PTEODTCD
          IF        @LESS          
            MOVE      PTEDDTCD,F8       * Set Disease Date
            MOVE      PTEDTIME,KEY5     * Set Disease Time
          ELSE         
            MOVE      PTEODTCD,F8       * Set Procedure Date
            MOVE      PTEOTIME,KEY5     * Set Procedure Time
          ENDIF
.
CODDAT21  COMPARE   ZERO,F8       * Check if F8 has anything init?
          GOTO      CODDAT40 IF EQUAL  
.
          MOVE      F8,KEY8      * Set Date as Dim variable
.
          BRANCH    F1,CODDAT30
.
          REP       " 0",KEY8    
          UNPACK    KEY8,CCENT,CYEAR,CMON,CDAY
          MOVE      CMON,F2
          LOAD      MTHNAM3,F2,JAN,FEB,MAR,APR,MAY,JUN,JUL,AUG,SEP,OCT,NOV,DEC
          WRITE     HTMLFILE;CDAY,SP1,MTHNAM3,SP1,CCENT,CYEAR;
          GOTO      CODDAT99
.
CODDAT30  WRITE     HTMLFILE;KEY5;
          GOTO      CODDAT99

.       if operation/disease coding record doesn't exist, use current date/time
.
CODDAT40  BRANCH    F1,CODDAT50
          MOVE      CMM,F2
          LOAD      MTHNAM3,F2,JAN,FEB,MAR,APR,MAY,JUN,JUL,AUG,SEP,OCT,NOV,DEC
          PACK      KEY4,CCC,CYY
          REP       " 0",KEY4
          MOVE      CDD,KEY2
          REP       " 0",KEY2
          WRITE     HTMLFILE;KEY2,SP1,MTHNAM3,SP1,KEY4;
          GOTO      CODDAT99
.
CODDAT50  WRITE     HTMLFILE;CTIMEIS;
          GOTO      CODDAT99
.
CODDAT99  RETURN
.*************************************************************************
.  Out put Coder ID:  0.Desc 1.Code
.*************************************************************************
CODUSR00  UNPACK    DIM127,DIM1,KEY1,DIM127
          MOVE      KEY1,F1
.
          MOVE      ONE,PTEDEPNO
          MOVE      ONE,PTEDCNT
          PACK      KEY13,ADMISSNO,PTEDEPNO,PTEDCNT,SP70              *C-240107
          CALL      RDPTECD1
          BRANCH    OVRCD,CODUSR20
.
          MATCH     SP70,PTEDUSID         * Web user id
          GOTO      CODUSR05 IF NOT EQUAL 
.         
          MATCH     SP70,PTEDOPER         * user passcode
          GOTO      CODUSR20 IF EQUAL     
.         
          PACK      KEY14,PTEDOPER,SP70
          CALL      RSWBSE3
          CALL      RKWBSE3
          BRANCH    OVRCD,CODUSR20
.         
          MATCH     PTEDOPER,WBSEPCD
          GOTO      CODUSR20 IF NOT EQUAL
.         
          MOVE      WBSEUID,PTEDUSID
.
CODUSR05  PACK      KEY10,PTEDUSID,SP70   * Read Security File
          CALL      RDWBSE1
          BRANCH    OVRCD,CODUSR20
.
          BRANCH    F1,CODUSR10
.
          WRITE     HTMLFILE;WBSENAM;
          GOTO      CODUSR99
.
CODUSR10  WRITE     HTMLFILE;WBSEUID;
          GOTO      CODUSR99
.
.         Check episode operation coding
.
CODUSR20  CALL      RDPTECO1
          BRANCH    OVRCD,CODUSR40
.
          MATCH     SP70,PTEOUSID         * Web user id
          GOTO      CODUSR25 IF NOT EQUAL
.
          MATCH     SP70,PTEOOPER         * user passcode
          GOTO      CODUSR40 IF EQUAL
.         
          PACK      KEY14,PTEOOPER,SP70
          CALL      RSWBSE3
          CALL      RKWBSE3
          BRANCH    OVRCD,CODUSR40
.         
          MATCH     PTEOOPER,WBSEPCD
          GOTO      CODUSR40 IF NOT EQUAL
.
          MOVE      WBSEUID,PTEOUSID
.
CODUSR25  PACK      KEY10,PTEOUSID,SP70  * Read Security File
          CALL      RDWBSE1
          BRANCH    OVRCD,CODUSR40
.
          BRANCH    F1,CODUSR30
.
          WRITE     HTMLFILE;WBSENAM;
          GOTO      CODUSR99
.
CODUSR30  WRITE     HTMLFILE;WBSEUID;
          GOTO      CODUSR99
.
.   if operation/disease coding record doesn't exist, use current Web User 
.
CODUSR40  PACK      KEY10,USERID,SP70
          CALL      RDWBSE1
          BRANCH    F1,CODUSR50
          WRITE     HTMLFILE;WBSENAM;
          GOTO      CODUSR99
.
CODUSR50  WRITE     HTMLFILE;WBSEUID;
          GOTO      CODUSR99
.
CODUSR99  RETURN
.--------------------------------------------------------------------
...         **** WIES Details by discharge date ****
...
...       If using 6.0 Grouper then:
...          If Discharge date >= 2010/07/01 use WIES17
...          If Discharge date >= 2009/07/01 use WIES16
...          If Discharge date >= 2008/07/01 use WIES15
...       If using 5.2 Grouper then:
...          If Discharge date >= 2008/07/01 use WIES15
...          If Discharge date >= 2007/07/01 use WIES14
...       If using 5.1 Grouper then:
...          If Discharge date >= 2006/07/01 use WIES13.
...       If using 5.0 Grouper then:
...          If Discharge date >= 2004/07/01 use WIES12.
...          else If Discharge date >= ICD10v4 Cutover use WIES12
...                                    ( go-live earlier than 2004/07/01)
...            else use WIES11.
...
...       If using 4.2 Grouper then:
...            use WIES11.
...
...       Anything other use WIES12
...
... 0.LOS, 1.Low Trim, 2.High Trim, 3.Description, 4.Multiday Weight
... 5.Same Day Weight
... INPUT PARAMETER : DDRGCODE
.------------------------------------------------------------
WIESVL00  UNPACK    DIM127,DIM1,KEY1,DIM127   
          MOVE      ZERO,VIEWFLAG 
          MOVE      KEY1,VIEWFLAG
.
          PACK      KEY8,ADMISSNO,SP70  * Patient must be discharged!
          CALL      RDDSCH1
          BRANCH    OVRCD,WIESVL90
.
.
          MATCH     SP70,DDRGCODE
          IF        @EQUAL
            WRITE     HTMLFILE;"&nbsp;";
            GOTO      WIESVL99
          ENDIF
.
.******************************************** start of addition       *I-197814
.         * Check DRG version. For 6.0      support WIES 17,16,15,14,13,12,11,10
.
          MATCH     DRG060,PTCNDGPV         * 6.0 DRG
          IF        @EQUAL
            MATCH     "20100701",DDATE      * 10/11 Fin year
            IF        !@LESS
              GOTO      WIESVL30            * using WIES17 (6.0 DRG)
            ENDIF
            MATCH     "20090701",DDATE      * 09/10 Fin year
            IF        !@LESS
              GOTO      WIESVL20            * using WIES16 (6.0 DRG)
            ENDIF
            MATCH     "20080701",DDATE      * 08/09 Fin year
            IF        !@LESS
              GOTO      WIESVL10            * using WIES15 (6.0 DRG)
            ENDIF
            MATCH     "20070701",DDATE      * 07/08 Fin year
            IF        !@LESS
              GOTO      WIESVL80            * using WIES14 (6.0 DRG)
            ENDIF
            MATCH     "20060701",DDATE      * 06/07 Fin year
            IF        !@LESS
              GOTO      WIESVL70            * using WIES13 (6.0 DRG)
            ENDIF
            MATCH     "20040701",DDATE      * 04/05 Fin year
            IF        !@LESS
              GOTO      WIESVL60            * using WIES12 (6.0 DRG)
            ENDIF
            MATCH     PTCNGDV5,DDATE        * 05/06 ICD10 Ed.5
            IF        !@LESS
              GOTO      WIESVL60            * using WIES12 (6.0 DRG)
            ENDIF
.
            MATCH     PTCNGDV4,DDATE        * 04/05 ICD10 Ed.4 cutover early
            IF        !@LESS
              GOTO      WIESVL60            * using WIES12 (6.0 DRG)
            ENDIF
            GOTO      WIESVL50              * default to WIES11 (6.0 DRG)
          ENDIF
.********************************************   end of addition       *I-197814
.
.******************************************** start of addition       *I-137125
.         * Check DRG version. For 5.2      support WIES 15,14,13,12,11,10   
.
          MATCH     DRG052,PTCNDGPV         * 5.2 DRG
          IF        @EQUAL
            MATCH     "20080701",DDATE      * 08/09 Fin year
            IF        !@LESS
              GOTO      WIESVL10            * using WIES15 (5.2 DRG)
            ENDIF
            MATCH     "20070701",DDATE      * 07/08 Fin year          *I-145161
            IF        !@LESS
              GOTO      WIESVL80            * using WIES14 (5.2 DRG)
            ENDIF
            MATCH     "20060701",DDATE      * 06/07 Fin year
            IF        !@LESS
              GOTO      WIESVL70            * using WIES13 (5.2 DRG)
            ENDIF
            MATCH     "20040701",DDATE      * 04/05 Fin year
            IF        !@LESS
              GOTO      WIESVL60            * using WIES12 (5.2 DRG)
            ENDIF
            MATCH     PTCNGDV5,DDATE        * 05/06 ICD10 Ed.5
            IF        !@LESS
              GOTO      WIESVL60            * using WIES12 (5.2 DRG)
            ENDIF
.
            MATCH     PTCNGDV4,DDATE        * 04/05 ICD10 Ed.4 cutover early
            IF        !@LESS
              GOTO      WIESVL60            * using WIES12 (5.2 DRG)
            ENDIF
            GOTO      WIESVL50              * default to WIES11 (5.2 DRG)
          ENDIF
.********************************************   end of addition       *I-137125
.
.******************************************** start of addition       *I-105244
.         * Check DRG version. For 5.1 only support WIES 13,12,11,10    *I-51504
.
          MATCH     DRG051,PTCNDGPV         * 5.1 DRG
          IF        @EQUAL
            MATCH     "20060701",DDATE      * 06/07 Fin year
            IF        !@LESS
              GOTO      WIESVL70            * using WIES13 (5.1 DRG)
            ENDIF
            MATCH     "20040701",DDATE      * 04/05 Fin year
            IF        !@LESS
              GOTO      WIESVL60            * using WIES12 (5.1 DRG)
            ENDIF
            MATCH     PTCNGDV5,DDATE        * 05/06 ICD10 Ed.5          
            IF        !@LESS
              GOTO      WIESVL60            * using WIES12 (5.1 DRG)
            ENDIF
.
            MATCH     PTCNGDV4,DDATE        * 04/05 ICD10 Ed.4 cutover early
            IF        !@LESS
              GOTO      WIESVL60            * using WIES12 (5.1 DRG)
            ENDIF
            GOTO      WIESVL50              * default to WIES11 (5.1 DRG)
          ENDIF
.********************************************   end of addition       *I-105244
.
.         * Check DRG version. For 5.0 only support WIES 12,11,10      *I-51504
          MATCH     DRG050,PTCNDGPV         * 5.0 DRG
          IF        @EQUAL
            MATCH     "20040701",DDATE      * 04/05 Fin year
            IF        !@LESS
              GOTO      WIESVL60            * using WIES12 (5.0 DRG)
            ENDIF
            MATCH     PTCNGDV4,DDATE        * 04/05 ICD10 cutover early
            IF        !@LESS
              GOTO      WIESVL60            * using WIES12 (5.0 DRG)
            ENDIF
            GOTO      WIESVL50              * default to WIES11 (5.0 DRG)
          ENDIF
.
.         * Check DRG version. For 4.2 only support WIES 11,10.9       *I-51504
          MATCH     DRG042,PTCNDGPV         * 4.2 DRG
          IF        @EQUAL
            MATCH     "20030701",DDATE      * 03/04 Fin year
            IF        !@LESS
              GOTO      WIESVL50            * using WIES11 (4.2 DRG)
            ENDIF
          ENDIF
.
          GOTO      WIESVL60                * default to WIES 12
.
.     ***** WIES 15 *****
.         
WIESVL10  PACK      KEY4,DDRGCODE,SP70
          MOVE      "patw15af",WIESFILE 
          CALL      RDPT151
          BRANCH    OVRCD,WIESVL92
.
          BRANCH    VIEWFLAG,WIESVL11,WIESVL12,WIESVL13,WIESVL14,WIESVL15
.
          WRITE     HTMLFILE;PT15ILOS;  * LOS
          GOTO      WIESVL99
.
WIESVL11  WRITE     HTMLFILE;PT15LIBP;  * Low Inliner Boundary Point(days)
          GOTO      WIESVL99
.
WIESVL12  WRITE     HTMLFILE;PT15HIBP;  * High Inliner Boundary Point(days)
          GOTO      WIESVL99
.
WIESVL13  WRITE     HTMLFILE;PT15DRGD;  * DRG Description
          GOTO      WIESVL99
.
WIESVL14  WRITE     HTMLFILE;PT15TIMW;  * Total Inlier Multiday Weight
          GOTO      WIESVL99
.
WIESVL15  WRITE     HTMLFILE;PT15TSDW;  * Total Same Day Weight
          GOTO      WIESVL99
.
.     ***** WIES 16 *****
.
WIESVL20  PACK      KEY4,DDRGCODE,SP70
          MOVE      "patw16af",WIESFILE
          CALL      RDPT161
          BRANCH    OVRCD,WIESVL92
.
          BRANCH    VIEWFLAG,WIESVL21,WIESVL22,WIESVL23,WIESVL24,WIESVL25
.
          WRITE     HTMLFILE;PT16ILOS;  * LOS
          GOTO      WIESVL99
.
WIESVL21  WRITE     HTMLFILE;PT16LIBP;  * Low Inliner Boundary Point(days)
          GOTO      WIESVL99
.
WIESVL22  WRITE     HTMLFILE;PT16HIBP;  * High Inliner Boundary Point(days)
          GOTO      WIESVL99
.
WIESVL23  WRITE     HTMLFILE;PT16DRGD;  * DRG Description
          GOTO      WIESVL99
.
WIESVL24  WRITE     HTMLFILE;PT16TIMW;  * Total Inlier Multiday Weight
          GOTO      WIESVL99
.
WIESVL25  WRITE     HTMLFILE;PT16TSDW;  * Total Same Day Weight
          GOTO      WIESVL99
.
.     ***** WIES 17 *****
.
WIESVL30  PACK      KEY4,DDRGCODE,SP70
          MOVE      "patw17af",WIESFILE
          CALL      RDPT171
          BRANCH    OVRCD,WIESVL92
.
          BRANCH    VIEWFLAG,WIESVL31,WIESVL32,WIESVL33,WIESVL34,WIESVL35
.
          WRITE     HTMLFILE;PT17ILOS;  * LOS
          GOTO      WIESVL99
.
WIESVL31  WRITE     HTMLFILE;PT17LIBP;  * Low Inliner Boundary Point(days)
          GOTO      WIESVL99
.
WIESVL32  WRITE     HTMLFILE;PT17HIBP;  * High Inliner Boundary Point(days)
          GOTO      WIESVL99
.
WIESVL33  WRITE     HTMLFILE;PT17DRGD;  * DRG Description
          GOTO      WIESVL99
.
WIESVL34  WRITE     HTMLFILE;PT17TIMW;  * Total Inlier Multiday Weight
          GOTO      WIESVL99
.
WIESVL35  WRITE     HTMLFILE;PT17TSDW;  * Total Same Day Weight
          GOTO      WIESVL99
.
.     ***** WIES 11 *****                                              *I-43498
.
WIESVL50  PACK      KEY4,DDRGCODE,SP70
          MOVE      "patw11af",WIESFILE
          CALL      RDPT111
          BRANCH    OVRCD,WIESVL92
.
          BRANCH    VIEWFLAG,WIESVL51,WIESVL52,WIESVL53
.
          WRITE     HTMLFILE;PT11ILOS;  * LOS
          GOTO      WIESVL99
.
WIESVL51  WRITE     HTMLFILE;PT11LIBP;  * Low Inliner Boundary Point(days)
          GOTO      WIESVL99
.
WIESVL52  WRITE     HTMLFILE;PT11HIBP;  * High Inliner Boundary Point(days)
          GOTO      WIESVL99
.
WIESVL53  WRITE     HTMLFILE;PT11DRGD;  * DRG Description
          GOTO      WIESVL99
.
.     ***** WIES 12 *****                                              *I-51504
.
WIESVL60  PACK      KEY4,DDRGCODE,SP70
          MATCH     "20050701",DDATE
          IF        !@LESS
            MOVE      "patw12bf",WIESFILE
            CALL      RDPT12B1
            BRANCH    OVRCD,WIESVL92
          ELSE
            MOVE      "patw12af",WIESFILE
            CALL      RDPT121
            BRANCH    OVRCD,WIESVL92
          ENDIF
.
          BRANCH    VIEWFLAG,WIESVL61,WIESVL62,WIESVL63,WIESVL64,WIESVL65
.
          WRITE     HTMLFILE;PT12ILOS;  * LOS
          GOTO      WIESVL99
.
WIESVL61  WRITE     HTMLFILE;PT12LIBP;  * Low Inliner Boundary Point(days)
          GOTO      WIESVL99
.
WIESVL62  WRITE     HTMLFILE;PT12HIBP;  * High Inliner Boundary Point(days)
          GOTO      WIESVL99
.
WIESVL63  WRITE     HTMLFILE;PT12DRGD;  * DRG Description
          GOTO      WIESVL99
.
WIESVL64  WRITE     HTMLFILE;PT12TIMW;  * Total Inlier Multiday Weight
          GOTO      WIESVL99
.
WIESVL65  WRITE     HTMLFILE;PT12TSDW;  * Total Same Day Weight
          GOTO      WIESVL99
.
.     ***** WIES 13 *****
.
WIESVL70  PACK      KEY4,DDRGCODE,SP70
          MOVE      "patw13af",WIESFILE
          CALL      RDPT131
          BRANCH    OVRCD,WIESVL92
.
          BRANCH    VIEWFLAG,WIESVL71,WIESVL72,WIESVL73,WIESVL74,WIESVL75
.
          WRITE     HTMLFILE;PT13ILOS;  * LOS
          GOTO      WIESVL99
.
WIESVL71  WRITE     HTMLFILE;PT13LIBP;  * Low Inliner Boundary Point(days)
          GOTO      WIESVL99
.
WIESVL72  WRITE     HTMLFILE;PT13HIBP;  * High Inliner Boundary Point(days)
          GOTO      WIESVL99
.
WIESVL73  WRITE     HTMLFILE;PT13DRGD;  * DRG Description
          GOTO      WIESVL99
.
WIESVL74  WRITE     HTMLFILE;PT13TIMW;  * Total Inlier Multiday Weight
          GOTO      WIESVL99
.
WIESVL75  WRITE     HTMLFILE;PT13TSDW;  * Total Same Day Weight
          GOTO      WIESVL99
.
.     ***** WIES 14 *****                                             *I-145161
.
WIESVL80  PACK      KEY4,DDRGCODE,SP70
          MOVE      "patw14af",WIESFILE
          CALL      RDPT141
          BRANCH    OVRCD,WIESVL92
.
          BRANCH    VIEWFLAG,WIESVL81,WIESVL82,WIESVL83,WIESVL84,WIESVL85
.
          WRITE     HTMLFILE;PT14ILOS;  * LOS
          GOTO      WIESVL99
.
WIESVL81  WRITE     HTMLFILE;PT14LIBP;  * Low Inliner Boundary Point(days)
          GOTO      WIESVL99
.
WIESVL82  WRITE     HTMLFILE;PT14HIBP;  * High Inliner Boundary Point(days)
          GOTO      WIESVL99
.
WIESVL83  WRITE     HTMLFILE;PT14DRGD;  * DRG Description
          GOTO      WIESVL99
.
WIESVL84  WRITE     HTMLFILE;PT14TIMW;  * Total Inlier Multiday Weight
          GOTO      WIESVL99
.
WIESVL85  WRITE     HTMLFILE;PT14TSDW;  * Total Same Day Weight
          GOTO      WIESVL99
.
WIESVL90  WRITE     HTMLFILE;"Patient is not Discharged!";
          GOTO      WIESVL99
.
WIESVL91  WRITE     HTMLFILE;"Discharge Date out of WIES Range!";
          GOTO      WIESVL99
.
WIESVL92  MOVE      "DRG Code not found on ",DIM22
          PACK      DIM30,DIM22,WIESFILE
          WRITE     HTMLFILE;DIM30;
          GOTO      WIESVL99
.
.
WIESVL99  RETURN
.-------------------------------------------------------------------------------
.                        ****** CLRGRP00 ******
.-------------------------------------------------------------------------------
CLRGRP00  MOVE      SP70,DPTPGADM   * Admission no
          MOVE      SP70,DPTPGEPN   * Episode no
          MOVE      SP70,PTPGGPVR   * Grouper version
          MOVE      SP70,PTPGNDRG   * National DRG
          MOVE      SP70,PTPGNMDC   * National MDC
          MOVE      ZERO,PTPGNWGT   * National weight
          MOVE      ZERO,PTPGNALS   * National average LOS
          MOVE      SP70,PTPGSDRG   * State DRG
          MOVE      SP70,PTPGSMDC   * State MDC
          MOVE      ZERO,PTPGSWGT   * State weight
          MOVE      ZERO,PTPGSALS   * State average LOS
          MOVE      SP70,PTPGLDRG   * Local DRG
          MOVE      SP70,PTPGLMDC   * Local MDC
          MOVE      ZERO,PTPGLWGT   * Local weight
          MOVE      ZERO,PTPGLALS   * Local average LOS
          MOVE      SP70,PTPGPCCL   * Patient CC class level
          MOVE      ZERO,PTPGWFIX   * WIES value fixed
          MOVE      ZERO,PTPGWVAR   * WIES value variable
          MOVE      ZERO,PTPGWTOL   * WIES value total
          MOVE      ZERO,PTPGWWTU   * WIES weight used
          MOVE      SP70,PTPGWWTD   * WIES weight description
          MOVE      SP70,PTPGSPAR   * Spare variable
.
CLRGRP99  RETURN
.**********************************************************************
.                 ****** WRDDIS00 ******
. Output Ward description
.**********************************************************************
WRDDIS00  PACK      KEY6,PTDSDWRD,SP70
          CALL      RDWARD1
          BRANCH    OVRCD,WRDDIS90
.
          WRITE     HTMLFILE;WBDESC;    * description
          GOTO      WRDDIS99
.
WRDDIS90  WRITE     HTMLFILE;"Invalid Ward Code";
WRDDIS99  RETURN
.----------------------------------------------------------------
.                      SHWMAP00
.  Set url with its associated Episode No.
.----------------------------------------------------------------
SHWMAP00  REP       " +",URNUMBER
          REP       " +",ADMISSNO
          MOVE      EPSCD001,EPISODE
          REP       " +",EPISODE 
          UNPACK    DIM127,D1,KEY8,DIM127
          UNPACK    DIM127,D1,KEY2,DIM127
          UNPACK    DIM127,D1,FLDPARA,DIM127
          WRITE     HTMLFILE;KEY8,".pbl?reportno=",KEY2:
                                 "&template=",FLDPARA:
                                 "&urnumber=",URNUMBER:
                                 "&admissno=",ADMISSNO:
                                 "&epscd001=",EPISODE;
          REP       "+ ",URNUMBER
          REP       "+ ",ADMISSNO
.
SHWMAP99  RETURN
.----------------------------------------------------------------
.  Outputs a selection list of Episode numbers for a given Admission
.                   ******** SELEPS00 ********
.----------------------------------------------------------------
SELEPS00  MOVE      ZERO,F2
          REPEAT
            ADD       ONE,F2
            MOVE      ZERO,EPSSLIST[F2]
          UNTIL     F2 = 99
.
          MOVE      " 1",DIM2               * Check Disease Coding file
          PACK      KEY13,ADMISSNO,DIM2,SP70
          CALL      RSPTECD1
SELEPS10  CALL      RKPTECD1
          BRANCH    OVRCD,SELEPS20
.
          MATCH     ADMISSNO,DPTEDADM       * Check for Admission No
          GOTO      SELEPS20 IF NOT EQUAL
.
          MATCH     SP70,PTEDCODE
          IF        !@EQUAL
            MOVE      ONE,EPSSLIST[PTEDEPNO]
          ENDIF
          GOTO      SELEPS10
.
.
SELEPS20  MOVE      " 1",DIM2               * Check Oper Coding File  *C-240107
          PACK      KEY13,ADMISSNO,DIM2,SP70
          CALL      RSPTECO1
SELEPS30  CALL      RKPTECO1
          BRANCH    OVRCD,SELEPS50
.
          MATCH     ADMISSNO,DPTEOADM    * Check for Admission No
          GOTO      SELEPS50 IF NOT EQUAL
.
          MATCH     SP70,PTEOCODE
          IF        !@EQUAL
            MOVE      ONE,EPSSLIST[PTEOEPNO]
          ENDIF
          GOTO      SELEPS30
.
.
SELEPS50  MOVE      ZERO,F2
          REPEAT
            ADD       ONE,F2
            IF        EPSSLIST[F2] = 1
              MOVE      F2,KEY2
              IF        F2 = EPSCD001
                WRITE     HTMLFILE;"<option value=#"",KEY2,"#" selected>":
                                    KEY2,"</option>"
              ELSE
                WRITE     HTMLFILE;"<option value=#"",KEY2,"#">":
                                    KEY2,"</option>"
              ENDIF
            ENDIF
          UNTIL     F2 = 99
.
SELEPS99  RETURN
.------------------------------------------------------------
.                     DRG Details
.      0.Description, 1.Code, 2.Low Trim, 3.High Trim
.      INPUT PARAMETER : DDRGCODE - DRG Code 
.------------------------------------------------------------
DISDRG00  UNPACK    DIM127,DIM1,KEY1,DIM127
          MOVE      KEY1,F1
.
          MATCH     SP70,DDRGCODE
          IF        @EQUAL
            WRITE     HTMLFILE;"&nbsp;";
            GOTO      DISDRG99
          ENDIF
.
          MOVE      DDRGCODE,KEY4
          MOVE      "999",KEY3
          PACK      KEY7,KEY4,KEY3,SP10   * last DRG version          *I-137125
          CALL      RSPTDGW1
          CALL      RPPTDGW1
          BRANCH    OVRCD,DISDRG90
          MATCH     PTDWDRGC,KEY4           * same DRG code ?         *I-137125
          GOTO      DISDRG90 IF NOT EQUAL                             *I-137125
.
          BRANCH    F1,DISDRG10,DISDRG20,DISDRG30
          WRITE     HTMLFILE;PTDWDESC; * Description
          GOTO      DISDRG99
.
DISDRG10  WRITE     HTMLFILE;PTDWDRGC;  * Code
          GOTO      DISDRG99
.
DISDRG20  WRITE     HTMLFILE;PTDWLOWT;  * Low Trim
          GOTO      DISDRG99
.
DISDRG30  WRITE     HTMLFILE;PTDWHIGH;  * High Trim
          GOTO      DISDRG99
.
DISDRG90  IF        F1 = ZERO
            WRITE     HTMLFILE;"DRG description not found";
          ENDIF
          IF        F1 = ONE
            WRITE     HTMLFILE;"DRG code not found";
          ENDIF
          IF        F1 > ONE
            WRITE     HTMLFILE;"DRG weightings record not found";
          ENDIF    
          GOTO      DISDRG99
.
DISDRG99  RETURN
.
.-----------------------------------------------------------------
. Find the Current visit details when doing a patient search by ur
.-----------------------------------------------------------------
FNDCUR00  BRANCH    PCEASE,FNDCUR90
.
          PACK      KEY24,URNUMBER,Z70
          CALL      RDSVISA2
FNDCUR10  CALL      RDPVISA2
          BRANCH    OVRCD,FNDCUR90
.         
          MATCH     URNUMBER,PVIURNO
          GOTO      FNDCUR90 IF NOT EQUAL
.         
          BRANCH    PVITYPE,FNDCUR40,FNDCUR50,FNDCUR50
.
          GOTO      FNDCUR10
.
FNDCUR40  PACK      KEY8,PVIBILL,SP70
          CALL      RDEMVIS1
          BRANCH    OVRCD,FNDCUR10
.
          COMPARE   FOUR,EMVISTAT                * Cancelled visit
          GOTO      FNDCUR10 IF EQUAL
.
          MOVE      PVIBILL,ADMISSNO
          GOTO      FNDCUR99
.
FNDCUR50  MOVE      PVIBILL,ADMISSNO
          GOTO      FNDCUR99

FNDCUR90  MOVE      SP70,ADMISSNO
.
FNDCUR99  RETURN
+
.******************************************************************************
.*  Get NZ Procedure details if required                                      *
.******************************************************************************
GETNZP00  COMPARE   FIVE,CFEETYP            * NZ Private only
          GOTO      GETNZP90 IF NOT EQUAL
.
          CALL      CLNZSP00
          PACK      KEY11,ADMISSNO,SP70
          CALL      RSNZSPR1
GETNZP10  CALL      RKNZSPR1
          BRANCH    OVRCD,GETNZP90
.
          MATCH     ADMISSNO,NZSPADMN
          GOTO      GETNZP90 IF NOT EQUAL
.
          COMPARE   "1",NZSPPRIM
          GOTO      GETNZP10 IF NOT EQUAL
          GOTO      GETNZP999
.
GETNZP90  CALL      CLNZSP00
.
GETNZP99  RETURN
+
.**********************************************************************
.  Clear PDS DATA
.**********************************************************************
CLRPDS00  MOVE      SP70,MRPDSTAT
          RETURN
.         
.**********************************************************************
.  Clear ICU DATA   
.**********************************************************************
CLRICU00  MOVE      ZERO,PTICUINT
          MOVE      ZERO,PTICUMEC
          MOVE      ZERO,PTICUCCU
          MOVE      SP70,PTICAMBN
          MOVE      ZERO,PTICCPAP
          MOVE      ZERO,PTICHNCU
.
CLRICU99  RETURN
+
.******************************************************************************
MVPMAR00  PACK      PMVXVISN,ARVXVISN,SP70
          PACK      PMVXVSDT,ARVXVSDT,SP70
          PACK      PMVXDOCA,ARVXDOCA,SP70
          PACK      PMVXDOCT,ARVXDOCT,SP70
          PACK      PMVXCSNR,ARVXCSNR,SP70
          PACK      PMVXPOST,ARVXPOST,SP70
          PACK      PMVXPIND,ARVXPIND,SP70
          PACK      PMVXVLOC,ARVXVLOC,SP70
          PACK      PMVXCFSG,ARVXCFSG,SP70
          PACK      PMVXINGP,ARVXINGP,SP70
          PACK      PMVXCPTH,ARVXCPTH,SP70
          PACK      PMVXHCP1,ARVXHCP1,SP70
          PACK      PMVXHCP2,ARVXHCP2,SP70
          PACK      PMVXHCP3,ARVXHCP3,SP70
          PACK      PMVXHCP4,ARVXHCP4,SP70
          PACK      PMVXRHC1,ARVXRHC1,SP70
          PACK      PMVXRH1G,ARVXRH1G,SP70
          PACK      PMVXRH1C,ARVXRH1G,SP70
          PACK      PMVXRHC2,ARVXRHC2,SP70
          PACK      PMVXRH2G,ARVXRH2G,SP70
          PACK      PMVXRH2C,ARVXRH2C,SP70
          PACK      PMVXRHC3,ARVXRHC2,SP70
          PACK      PMVXRH3G,ARVXRH3G,SP70
          PACK      PMVXRH3C,ARVXRH3C,SP70
          PACK      PMVXRHC4,ARVXRHC4,SP70
          PACK      PMVXRH4G,ARVXRH4G,SP70
          PACK      PMVXRH4C,ARVXRH4C,SP70
          PACK      PMVXABRG,ARVXABRG,SP70
          PACK      PMVXCADM,ARVXCADM,SP70
          PACK      PMVXIRAD,ARVXIRAD,SP70
          PACK      PMVXIDUS,ARVXIDUS,SP70
          PACK      PMVXCRAV,ARVXCRAV,SP70
          PACK      PMVXRCCT,ARVXRCCT,SP70
          PACK      PMVXAPWD,ARVXAPWD,SP70
          PACK      PMVXAPBD,ARVXAPBD,SP70
          PACK      PMVXPOWD,ARVXPOWD,SP70
          PACK      PMVXPOBD,ARVXPOBD,SP70
          PACK      PMVXPSTY,ARVXPSTY,SP70
          PACK      PMVXVALW,ARVXVALW,SP70
          PACK      PMVXPALW,ARVXPALW,SP70
          PACK      PMVXINDC,ARVXINDC,SP70
          PACK      PMVXMDAV,ARVXMDAV,SP70
          PACK      PMVXFRMS,ARVXFRMS,SP70
          PACK      PMVXCSNG,ARVXCSNG,SP70
          MOVE      PMVXPWGT,ARVXPWGT
          MOVE      PMVXPHGT,ARVXPHGT
          PACK      PMVXDHWR,ARVXDHWR,SP70
          PACK      PMVXEDC1,ARVXEDC1,SP70
          PACK      PMVXEDC2,ARVXEDC2,SP70
          PACK      PMVXEDC3,ARVXEDC3,SP70
          PACK      PMVXHOME,ARVXHOME,SP70
          PACK      PMVXUDF1,ARVXUDF1,SP70
          PACK      PMVXUDF2,ARVXUDF2,SP70
          PACK      PMVXUDF3,ARVXUDF3,SP70
          PACK      PMVXUDF4,ARVXUDF4,SP70
          PACK      PMVXUDT1,ARVXUDT1,SP70
          PACK      PMVXUDT2,ARVXUDT2,SP70
          PACK      PMVXUDT3,ARVXUDT3,SP70
          PACK      PMVXUDT4,ARVXUDT4,SP70
          PACK      PMVXUDT5,ARVXUDT5,SP70
          PACK      PMVXUDT6,ARVXUDT6,SP70
          PACK      PMVXCDTE,ARVXCDTE,SP70
          PACK      PMVXCTIM,ARVXCTIM,SP70
          PACK      PMVXWEBC,ARVXWEBC,SP70
          PACK      PMVXLUPD,ARVXLUPD,SP70
          PACK      PMVXLUPT,ARVXLUPT,SP70
          PACK      PMVXWEBU,ARVXWEBU,SP70
          PACK      PMVXMHLS,ARVXMHLS,SP70
          PACK      PMVXPICD,ARVXPICD,SP70
          PACK      PMVXRMOR,ARVXRMOR,SP70
          PACK      PMVXASUT,ARVXASUT,SP70
          PACK      PMVXELPS,ARVXELPS,SP70
          PACK      PMVXEMPL,ARVXEMPL,SP70
          PACK      PMVXFINP,ARVXFINP,SP70
          PACK      PMVXOCCP,ARVXOCCP,SP70
          PACK      PMVXPALC,ARVXPALC,SP70
          PACK      PMVXPPAL,ARVXPPAL,SP70
          PACK      PMVXPPPT,ARVXPPPT,SP70
          PACK      PMVXPSOS,ARVXPSOS,SP70
          PACK      PMVXPYSP,ARVXPYSP,SP70
          PACK      PMVXQLDB,ARVXQLDB,SP70
          PACK      PMVXREAD,ARVXREAD,SP70
          PACK      PMVXUDIN,ARVXUDIN,SP70
          PACK      PMVXUREA,ARVXUREA,SP70
          PACK      PMVXUSAC,ARVXUSAC,SP70
          PACK      PMVXUVTH,ARVXUVTH,SP70
          PACK      PMVXINTR,ARVXINTR,SP70
          PACK      PMVXLNG1,ARVXLNG1,SP70
          PACK      PMVXASGC,ARVXASGC,SP70
          PACK      PMVXMHOS,ARVXMHOS,SP70
          PACK      PMVXDSPD,ARVXDSPD,SP70
          PACK      PMVXDSIF,ARVXDSIF,SP70
          PACK      PMVXPRMI,ARVXPRMI,SP70
          PACK      PMVXPRAI,ARVXPRAI,SP70
          PACK      PMVXPRES,ARVXPRES,SP70
          PACK      PMVXUITR,ARVXUITR,SP70
          PACK      PMVXRPOA,ARVXRPOA,SP70
          PACK      PMVXRCN1,ARVXRCN1,SP70
          PACK      PMVXRCN2,ARVXRCN2,SP70
          PACK      PMVXRHFU,ARVXRHFU,SP70
          PACK      PMVXRDVA,ARVXRDVA,SP70
          PACK      PMVXRSLO,ARVXRSLO,SP70
          PACK      PMVXMLOC,ARVXMLOC,SP70
          PACK      PMVXPACC,ARVXPACC,SP70
          PACK      PMVXEDU1,ARVXEDU1,SP70
          PACK      PMVXEDU2,ARVXEDU2,SP70
          PACK      PMVXEDU3,ARVXEDU3,SP70
          PACK      PMVXPRGM,ARVXPRGM,SP70
          PACK      PMVXCONF,ARVXCONF,SP70
          PACK      PMVXEOCL,ARVXEOCL,SP70
          PACK      PMVXSLOC,ARVXSLOC,SP70
          PACK      PMVXSCLI,ARVXSCLI,SP70
          PACK      PMVXSTRA,ARVXSTRA,SP70
          PACK      PMVXQASN,ARVXQASN,SP70
          PACK      PMVXATCP,ARVXATCP,SP70
          PACK      PMVXATIM,ARVXATIM,SP70
          PACK      PMVXITIM,ARVXITIM,SP70
          PACK      PMVXHFGN,ARVXHFGN,SP70
          PACK      PMVXHFSN,ARVXHFSN,SP70
          PACK      PMVXFUPI,ARVXFUPI,SP70
          PACK      PMVXPOEC,ARVXPOEC,SP70
          PACK      PMVXSPAR,ARVXSPAR,SP70
.
          RETURN
+
CLPATHSP  PACK      PTHSHOSP,SP70
          PACK      PTHSNAME,SP70
          PACK      PTHSADD1,SP70
          PACK      PTHSADD2,SP70
          PACK      PTHSADD3,SP70
          PACK      PTHSADD4,SP70
          PACK      PTHSPCOD,SP70
          PACK      PTHSTELE,SP70
          PACK      PTHSFAXN,SP70
          PACK      PTHSUNIT,SP70
          PACK      PTHSHDPC,SP70
          PACK      PTHSMRPR,SP70
          PACK      PTHSPACT,SP70
          PACK      PTHSHSNO,SP70
          PACK      PTHSPMBS,SP70
          PACK      PTHSTFEE,SP70
          PACK      PTHSHLOC,SP70
          PACK      PTHSRCTY,SP70
          PACK      PTHSVOLM,SP70
          PACK      PTHSSTAT,SP70
          PACK      PTHSDCLM,SP70
          PACK      PTHSAPPR,SP70
          PACK      PTHSUFMS,SP70
          PACK      PTHSABNN,SP70
          PACK      PTHSHSID,SP70
          PACK      PTHSHCEN,SP70
          PACK      PTHSPTIN,SP70
          PACK      PTHSSPID,SP70
          PACK      PTHSEDIP,SP70
          PACK      PTHSORID,SP70
.
          RETURN
+
.*******************************************************************************
.                         Goes back 1 page
.*******************************************************************************
RELOAD00  CALL      OPENHTML
          BRANCH    EXIT,RELOAD99
          WRITE     HTMLFILE;"<script type=#"text/javascript#"> {":
.                            "    alert(#"",WEBTITLE,"#");":
                             "    history.go(-1);":
.                            "    location.reload();":
                             "}":
                             "</script>"
          CALL      CLOSHTML
RELOAD99  RETURN
.
.--------------------------------------------------------------------------
. Remote Scripting
.               1. Generate MyHRViewer / Patient Summary Token
.               2. Generate MyHR Upload JWT Auth Token
.               3. Check if there is a successful IHI Lookup within X hours (PTCNIHIV)
.--------------------------------------------------------------------------
REMOTE00  BRANCH    VALDTYPE,REMOTE01,REMOTE02,REMOTE03
          GOTO      REMOTE90
.
REMOTE01  CALL      VALTKN00
          GOTO      REMOTE99
.
REMOTE02  CALL      VALETK00
          GOTO      REMOTE99
.
REMOTE03  CALL      VALSIH00
          GOTO      REMOTE99
.
REMOTE90  CALL      XMLHED00
          WRITE     HTMLFILE;"<RETURN_VALUE TYPE=ERROR>":
                             "Invalid Validation Type":
                             "</RETURN_VALUE>"
          CALL      XMLEND00
          GOTO      REMOTE99
.
REMOTE99  RETURN
+
.------------------------------------------------------------
. NIHC Dashboard Management
.------------------------------------------------------------
NIHC0000  MATCH     "3",PTCNUNET
          GOTO      NIHC9200 IF NOT EQUAL
.
          RESET     UPDTTYPE
          MATCH     SP70,UPDTTYPE
          GOTO      NIHC6000 IF EQUAL
.
          MATCH     "A",UPDTTYPE    
          GOTO      NIHC1000 IF EQUAL
.
          MATCH     "U",UPDTTYPE   
          GOTO      NIHC2000 IF EQUAL
.
          MATCH     "D",UPDTTYPE
          GOTO      NIHC3000 IF EQUAL
.
          MATCH     "P",UPDTTYPE
          GOTO      NIHC4000 IF EQUAL          
.
          MATCH     "V",UPDTTYPE
          GOTO      NIHC5000 IF EQUAL
.
          GOTO      NIHC9000
.
.         ************ ADD FORMACTION ***********
.
NIHC1000  CALL      CLPMSNDB
          CALL      MVPMND00
.
          PACK      KEY53,PMNDB001,PMNDB005,SP70
          CALL      RAPMNDB1
          IF        OVRCD=0
            GOTO      NIHC9100
          ELSE
.
            CALL      IBACLOCK
            PACK      KEY8,CCC,CYY,CMM,CDD
            REP       " 0",KEY8
            MOVE      KEY8,PMNBCDAT                * System date
            CLOCK     TIME,PMNBCTIM                * System time
            MOVE      USERID,PMNBCUID              * web user id
            MOVE      SP70,PMNBUDAT
            MOVE      SP70,PMNBUTIM
            MOVE      SP70,PMNBUUID
.
            CALL      WRPMNDB1
          ENDIF
.
          MOVE      ZERO,EXIT
          GOTO      NIHC9999
.
.         ************ UPDATE FORMACTION ***********
.
NIHC2000  PACK      KEY53,PMNDB001,PMNDB005,SP70
          CALL      RDPMNDB1
          BRANCH    OVRCD,NIHC9300
.
          CALL      MVPMND00
.
          PACK      KEY8,CCC,CYY,CMM,CDD
          REP       " 0",KEY8
          MOVE      KEY8,PMNBUDAT              
          CLOCK     TIME,PMNBUTIM              
          MOVE      USERID,PMNBUUID            
.
          CALL      UPPMNDB1                   
.
          MOVE      ZERO,EXIT
          GOTO      NIHC9999
.
.         ************ DELETE FORMACTION ***********
.
NIHC3000  PACK      KEY53,PMNDB001,PMNDB005,SP70
          CALL      RDPMNDB1
          BRANCH    OVRCD,NIHC9300
.
          CALL      DEPMNDB1
.
          MOVE      ZERO,EXIT
          GOTO      NIHC9999
.
.         ************ NIHC PROPERTIES UPDATE FORMACTION ***********
.
NIHC4000  PACK      KEY53,PMNDB001,PMNDB005,SP70
          CALL      RDPMNDB1
          BRANCH    OVRCD,NIHC9300
.
          MATCH     SP70,PMNBDPTH
          GOTO      NIHC9400 IF EQUAL
          GOTO      NIHC9400 IF EOS
.
          CALL      PROPN000
.
          MATCH     "1",NHCIHIND
          GOTO      NIHC9500 IF EQUAL
          MATCH     "2",NHCIHIND
          GOTO      NIHC9510 IF EQUAL
          MATCH     "3",NHCIHIND
          GOTO      NIHC9520 IF EQUAL
.
          OPEN      NHCPROPF,NIHCPATH
          OPEN      NHCPUBKF,NHCPPATH
          OPEN      NHCJWTOF,NHCJPATH
.
          CALL      CLNCIH00
          CALL      MVNCIH00
.
          CALL      WRNCIH00
.
          MOVE      ZERO,EXIT
          GOTO      NIHC9999
.
.         ************ GENERATE CERTIFICATE FORMACTION ***********
.
NIHC5000  PACK      KEY53,PMNDB001,PMNDB005,SP70
          CALL      RDPMNDB1
          BRANCH    OVRCD,NIHC9300
.
          MATCH     SP70,PMNBDPTH
          GOTO      NIHC9400 IF EQUAL
          GOTO      NIHC9400 IF EOS
.
          CALL      PROPN000
.
          MATCH     "1",NHCIHIND
          GOTO      NIHC9500 IF EQUAL
          MATCH     "2",NHCIHIND
          GOTO      NIHC9510 IF EQUAL
          MATCH     "3",NHCIHIND
          GOTO      NIHC9520 IF EQUAL
.
          OPEN      NHCPROPF,NIHCPATH
          OPEN      NHCPUBKF,NHCPPATH
          OPEN      NHCJWTOF,NHCJPATH
.
          CLEAR     CMDLINE
          APPEND    PMNBDPTH,CMDLINE
          RESET     CMDLINE
          STRIP     CMDLINE
          ENDSET    CMDLINE
          APPEND    "/webPAS_NIHCIHI_run CreateCertificate ",CMDLINE
          APPEND    PMNBDPTH,CMDLINE
          RESET     CMDLINE
          STRIP     CMDLINE
          ENDSET    CMDLINE
          APPEND    "/",CMDLINE
          RESET     CMDLINE
.
          EXECUTE   CMDLINE,TASKID
.
          MOVE      ZERO,EXIT
          GOTO      NIHC9999
.
.         ************ DISPLAY FORMACTION **********
.
NIHC6000  PACK      KEY53,PMNDB001,PMNDB005,SP70
          CALL      RDPMNDB1
          IF        OVRCD=1
            CALL      CLPMSNDB
          ENDIF
.
          MATCH     "D",NIHCDIND
          IF        @EQUAL
            MATCH     SP70,PMNBDPTH
            GOTO      NIHC9400 IF EQUAL
            GOTO      NIHC9400 IF EOS 
.
            CALL      PROPN000
.
            MATCH     "1",NHCIHIND
            GOTO      NIHC9500 IF EQUAL
            MATCH     "2",NHCIHIND
            GOTO      NIHC9510 IF EQUAL
            MATCH     "3",NHCIHIND
            GOTO      NIHC9520 IF EQUAL
.
            OPEN      NHCPROPF,NIHCPATH
            OPEN      NHCPUBKF,NHCPPATH
            OPEN      NHCJWTOF,NHCJPATH
.
            CALL      RDNCIH00
.
          ENDIF
.
          CLEAR     WEBTITLE
          MOVE      "NIHC Dashboard Management",WEBTITLE
          RESET     WEBTITLE
.
          CALL      WEBHED00
          BRANCH    EXIT,NIHC9999
.
          CALL      WEBBOD00
.
          CALL      WEBEND00
.
          MOVE      ONE,EXIT
          GOTO      NIHC9999
.
NIHC9000  MOVE      "Invalid Form Action.",WEBTITLE
          CALL      WEBERR00
          MOVE      ONE,EXIT
          GOTO      NIHC9999
.
NIHC9100  MOVE      "B2B Device already exists.",WEBTITLE
          CALL      WEBERR00
          MOVE      ONE,EXIT
          GOTO      NIHC9999
.
NIHC9200  MOVE      "Not Using NIHC IHI Interface.",WEBTITLE
          CALL      WEBERR00
          MOVE      ONE,EXIT
          GOTO      NIHC9999
.
NIHC9300  MOVE      "Invalid pmsndbaf record.",WEBTITLE
          CALL      WEBERR00
          MOVE      ONE,EXIT
          GOTO      NIHC9999
.
NIHC9400  MOVE      "NIHC IHI Device Directory Path must be filled",WEBTITLE
          CALL      WEBERR00
          MOVE      ONE,EXIT
          GOTO      NIHC9999
.
NIHC9500  CLEAR     WEBTITLE
          APPEND    "Error opening ",WEBTITLE
          APPEND    NIHCPATH,WEBTITLE
          RESET     WEBTITLE
.
          CALL      WEBERR00
          MOVE      ONE,EXIT
          GOTO      NIHC9999
.
NIHC9510  CLEAR     WEBTITLE
          APPEND    "Error opening ",WEBTITLE
          APPEND    NHCPPATH,WEBTITLE
          RESET     WEBTITLE
.
          CALL      WEBERR00
          MOVE      ONE,EXIT
          GOTO      NIHC9999
.
NIHC9520  CLEAR     WEBTITLE
          APPEND    "Error opening ",WEBTITLE
          APPEND    NHCJPATH,WEBTITLE
          RESET     WEBTITLE
.
          CALL      WEBERR00
          MOVE      ONE,EXIT
          GOTO      NIHC9999
.
NIHC9530  CLEAR     WEBTITLE
          APPEND    "Error opening ",WEBTITLE
          APPEND    ACTOPATH,WEBTITLE
          RESET     WEBTITLE
.
          CALL      WEBERR00
          MOVE      ONE,EXIT
          GOTO      NIHC9999
.
NIHC9540  CLEAR     WEBTITLE
          APPEND    "Error opening ",WEBTITLE
          APPEND    TOKOPATH,WEBTITLE
          RESET     WEBTITLE
.
          CALL      WEBERR00
          MOVE      ONE,EXIT
          GOTO      NIHC9999
.
NIHC9550  CLEAR     WEBTITLE
          APPEND    "Error opening ",WEBTITLE
          APPEND    ACTHPATH,WEBTITLE
          RESET     WEBTITLE
.
          CALL      WEBERR00
          MOVE      ONE,EXIT
          GOTO      NIHC9999
.
NIHC9999  CLOSE      NHCPROPF
          CLOSE      NHCPUBKF
          CLOSE      NHCJWTOF
.
          RETURN
+
.------------------------------------------------------------
.  NIHC Dashboard Tags
.------------------------------------------------------------
NITG0000  BRANCH    FLDITMNO,NITG0100,NITG0200,NITG0300,NITG0400,NITG0500:
                             NITG0600,NITG0700,NITG0800,NITG0900,NITG1000:
                             NITG1100,NITG1200,NITG1300,NITG1400,NITG1500:
                             NITG1600,NITG1700,NITG1800,NITG1900,NITG2000:
                             NITG2100,NITG2200,NITG2300,NITG2400,NITG2500:
                             NITG2600,NITG2700,NITG2800,NITG2900,NITG3000:
                             NITG3100,NITG3200,NITG3300,NITG3400,NITG3500:
                             NITG3600,NITG3700,NITG3800,NITG3900,NITG4000:
                             NITG4100,NITG4200,NITG4300,NITG4400,NITG4500:
                             NITG4600,NITG4700,NITG4800,NITG4900,NITG5000:
                             NITG5100,NITG5200,NITG5300,NITG5400,NITG5500:
                             NITG5600,NITG5700,NITG5800,NITG5900,NITG6000:
                             NITG6100
.
          GOTO      NITG9999
.
NITG0100  CALL      PMNDTB00
          GOTO      NITG9999
.
NITG0200  CALL      HOSPID00
          GOTO      NITG9999
.
NITG0300  WRITE     HTMLFILE;NHCJKSLO;
          GOTO      NITG9999
.
NITG0400  WRITE     HTMLFILE;NHCDVNAM;
          GOTO      NITG9999
.
NITG0500  WRITE     HTMLFILE;NHCNIHCU;
          GOTO      NITG9999
.
NITG0600  WRITE     HTMLFILE;NHCNICCU;
          GOTO      NITG9999
.
NITG0700  WRITE     HTMLFILE;NHCALGOR;
          GOTO      NITG9999
.
NITG0800  WRITE     HTMLFILE;NHCHOSPC;
          GOTO      NITG9999
.
NITG0900  
          GOTO      NITG9999
.
NITG1000  CALL      NHCCER00
          GOTO      NITG9999
.
NITG1100  CALL      NHCJWT00
          GOTO      NITG9999
.
NITG1200  
          GOTO      NITG9999
.
NITG1300  
          GOTO      NITG9999
.
NITG1400  
          GOTO      NITG9999
.
NITG1500  
          GOTO      NITG9999
.
NITG1600  
          GOTO      NITG9999
.
NITG1700  WRITE     HTMLFILE;NIHCPATH;
          GOTO      NITG9999
.
NITG1800  WRITE     HTMLFILE;NHCPPATH;
          GOTO      NITG9999
.
NITG1900  WRITE     HTMLFILE;NHCJPATH;
          GOTO      NITG9999
.
NITG2000  
          GOTO      NITG9999
.
NITG2100  
          GOTO      NITG9999
.
NITG2200  
          GOTO      NITG9999
.
NITG2300  
          GOTO      NITG9999
.
NITG2400  
          GOTO      NITG9999
.
NITG2500  
          GOTO      NITG9999
.
NITG2600  
          GOTO      NITG9999
.
NITG2700  
          GOTO      NITG9999
.
NITG2800  
          GOTO      NITG9999
.
NITG2900  
          GOTO      NITG9999
.
NITG3000  
          GOTO      NITG9999
.
NITG3100  
          GOTO      NITG9999
.
NITG3200  
          GOTO      NITG9999
.
NITG3300  
          GOTO      NITG9999
.
NITG3400  
          GOTO      NITG9999
.
NITG3500  
          GOTO      NITG9999
.
NITG3600  
          GOTO      NITG9999
.
NITG3700  
          GOTO      NITG9999
.
NITG3800  
          GOTO      NITG9999
.
NITG3900  
          GOTO      NITG9999
.
NITG4000  
          GOTO      NITG9999
.
NITG4100  
          GOTO      NITG9999
.
NITG4200  
          GOTO      NITG9999
.
NITG4300  
          GOTO      NITG9999
.
NITG4400  
          GOTO      NITG9999
.
NITG4500  
          GOTO      NITG9999
.
NITG4600  
          GOTO      NITG9999
.
NITG4700  
          GOTO      NITG9999
.
NITG4800  
          GOTO      NITG9999
.
NITG4900  
          GOTO      NITG9999
.
NITG5000  
          GOTO      NITG9999
.
NITG5100  
          GOTO      NITG9999
.
NITG5200  
          GOTO      NITG9999
.
NITG5300  
          GOTO      NITG9999
.
NITG5400  
          GOTO      NITG9999
.
NITG5500  
          GOTO      NITG9999
.
NITG5600  
          GOTO      NITG9999
.
NITG5700  
          GOTO      NITG9999
.
NITG5800  
          GOTO      NITG9999
.
NITG5900  WRITE     HTMLFILE;NHCURPTH;
          GOTO      NITG9999
.
NITG6000  WRITE     HTMLFILE;NHCSUPTH;
          GOTO      NITG9999
.
NITG6100  WRITE     HTMLFILE;NHCVWPTH;
          GOTO      NITG9999
.
NITG9999  RETURN
+
.------------------------------------------------------------
.  NIHC Dashboard Table
.------------------------------------------------------------
PMNDTB00  PACK      KEY53,SP70
          CALL      RSPMNDB1
PMNDTB10  CALL      RKPMNDB1
          BRANCH    OVRCD,PMNDTB99
.     
          MOVE      SP70,HOSPNAME
          IF        IBCNMHOS=ONE
            PACK      KEY3,PMNBHOSP,SP70
            CALL      RDPTHSP1            * read Hospital name for visit
            IF        OVRCD=1
              MOVE      PMNBHOSP,HOSPNAME
            ELSE
              MOVE      PTHSNAME,HOSPNAME
            ENDIF
          ENDIF
.           
          MOVE      PMNBDNAM,DIM50
          MOVE      PMNBHOSP,DIM3
.
          REP       " +",DIM50
          REP       " +",DIM3
.
          WRITE     HTMLFILE;"t.addRow(#"","<img src='../images/MaintenanceIcon.gif'":
                             " class=ListIcon onclick=UpdateB2BDevice('":
                             DIM50,"','",DIM3,"');>":
                             "<img src='../images/DocumentIcon.gif'":
                             " class=ListIcon onclick=updateNIHC('":
                             DIM50,"','",DIM3,"');>":
                             "&nbsp;",PMNBDNAM,"#",":
                             "#"",PMNBDDSC,"#",":
                             "#"",PMNBGDAT,"#",":
                             "#"",PMNBHOSP,"#",":
                             "#"",PMNBEDAT,"#",":
                             "#"",HOSPNAME,"#");";
.
          GOTO      PMNDTB10

PMNDTB99  RETURN
+
.------------------------------------------------------------
. Hospital ID
.------------------------------------------------------------
HOSPID00  PACK      KEY3,SP10
          CALL      RSPTHSP1
HOSPID10  CALL      RKPTHSP1
          BRANCH    OVRCD,HOSPID90
.
          PACK      KEY5,QUOTE,PTHSHOSP,QUOTE
          BRANCH    IBCNMHOS,HOSPID20
          WRITE     HTMLFILE;"<option value=",KEY5,">":
                             PTHSNAME,"</option>"
          GOTO      HOSPID10
.
.         Mult-Hospital
.
HOSPID20  MATCH     WBSEHOSP,PTHSHOSP
          IF        @EQUAL
            WRITE     HTMLFILE;"<option value=",KEY5," selected>":
                               PTHSNAME,"</option>"
          ELSE
            WRITE     HTMLFILE;"<option value=",KEY5,">":
                               PTHSNAME,"</option>"
          ENDIF
          GOTO      HOSPID10
.
HOSPID90 
HOSPID99  RETURN
+
.------------------------------------------------------------
.  Open NIHC Text Files
.------------------------------------------------------------
PROPN000  CLEAR     NIHCPATH
          APPEND    PMNBDPTH,NIHCPATH
          RESET     NIHCPATH
          STRIP     NIHCPATH
          ENDSET    NIHCPATH
          APPEND    SLASH,NIHCPATH
          APPEND    NHCIFILE,NIHCPATH
          RESET     NIHCPATH
.
          MOVE      ZERO,NHCIHIND
          MOVE      ZERO,OVRCD
          TRAP      OVERCOND IF IO
          OPEN      NHCPROPF,NIHCPATH
          TRAPCLR   IO
          IF        OVRCD=1
            MOVE      ONE,NHCIHIND
            GOTO      PROPN500
          ENDIF
          CLOSE     NHCPROPF
.
          CLEAR     NHCPPATH
          APPEND    PMNBDPTH,NHCPPATH
          RESET     NHCPPATH
          STRIP     NHCPPATH
          ENDSET    NHCPPATH
          APPEND    SLASH,NHCPPATH
          APPEND    NHCPFILE,NHCPPATH
          RESET     NHCPPATH
.
          MOVE      ZERO,OVRCD
          TRAP      OVERCOND IF IO
          OPEN      NHCPUBKF,NHCPPATH
          TRAPCLR   IO
          IF        OVRCD=1
            MOVE      TWO,NHCIHIND
            GOTO      PROPN500
          ENDIF
          CLOSE     NHCPUBKF
.
          CLEAR     NHCJPATH
          APPEND    PMNBDPTH,NHCJPATH
          RESET     NHCJPATH
          STRIP     NHCJPATH
          ENDSET    NHCJPATH
          APPEND    SLASH,NHCJPATH
          APPEND    NHCJFILE,NHCJPATH
          RESET     NHCJPATH
.
          MOVE      ZERO,OVRCD
          TRAP      OVERCOND IF IO
          OPEN      NHCJWTOF,NHCJPATH
          TRAPCLR   IO
          IF        OVRCD=1
            MOVE      THREE,NHCIHIND
            GOTO      PROPN500
          ENDIF
          CLOSE     NHCJWTOF
.
PROPN500
.
PROPN999  RETURN
+
.------------------------------------------------------------
. Read WebServices PRODA properties file
.------------------------------------------------------------
RDNCIH00  READ      NHCPROPF,SEQ;NHCJKLAB,NHCJKSLO
          READ      NHCPROPF,SEQ;NHCDNLAB,NHCDVNAM
          READ      NHCPROPF,SEQ;NHCNILAB,NHCNIHCU
          READ      NHCPROPF,SEQ;NHCNCLAB,NHCNICCU
          READ      NHCPROPF,SEQ;NHCALLAB,NHCALGOR
          READ      NHCPROPF,SEQ;NHCHOLAB,NHCHOSPC
          READ      NHCPROPF,SEQ;NHCURLAB,NHCURPTH
          READ      NHCPROPF,SEQ;NHCSULAB,NHCSUPTH
          READ      NHCPROPF,SEQ;NHCVWLAB,NHCVWPTH
.
RDNCIH99  RETURN
+
.------------------------------------------------------------
.  Move spaces to WebServices variables
.------------------------------------------------------------
CLNCIH00  PACK      NHCJKSLO,SP70,SP70
          PACK      NHCDVNAM,SP70,SP70
          PACK      NHCNIHCU,SP70,SP70,SP70
          PACK      NHCNICCU,SP70,SP70,SP70
          PACK      NHCALGOR,SP70,SP70
          PACK      NHCHOSPC,SP70,SP70
          PACK      NHCURPTH,SP70,SP70,SP70
          PACK      NHCSUPTH,SP70,SP70,SP70
          PACK      NHCVWPTH,SP70,SP70,SP70
.
CLNCIH99  RETURN
+
.------------------------------------------------------------
.  Move WebServices cgi variables to text file variables
.------------------------------------------------------------
MVNCIH00  MOVE      NHCIH001,NHCJKSLO
          MOVE      NHCIH002,NHCDVNAM
          MOVE      NHCIH003,NHCNIHCU
          MOVE      NHCIH004,NHCNICCU
          MOVE      NHCIH005,NHCALGOR
          MOVE      NHCIH006,NHCHOSPC
          MOVE      NHCIH007,NHCURPTH
          MOVE      NHCIH008,NHCSUPTH
          MOVE      NHCIH009,NHCVWPTH
.
MVNCIH99  RETURN
+
.------------------------------------------------------------
. Write WebServices PRODA properties file
.------------------------------------------------------------
WRNCIH00  STRIP     NHCJKSLO
          STRIP     NHCDVNAM
          STRIP     NHCNIHCU
          STRIP     NHCNICCU
          STRIP     NHCALGOR
          STRIP     NHCHOSPC    
          STRIP     NHCURPTH
          STRIP     NHCSUPTH
          STRIP     NHCVWPTH
.
          WRITE     NHCPROPF,SEQ;NHCJKLAB,NHCJKSLO
          WRITE     NHCPROPF,SEQ;NHCDNLAB,NHCDVNAM
          WRITE     NHCPROPF,SEQ;NHCNILAB,NHCNIHCU
          WRITE     NHCPROPF,SEQ;NHCNCLAB,NHCNICCU
          WRITE     NHCPROPF,SEQ;NHCALLAB,NHCALGOR
          WRITE     NHCPROPF,SEQ;NHCHOLAB,NHCHOSPC
          WRITE     NHCPROPF,SEQ;NHCURLAB,NHCURPTH
          WRITE     NHCPROPF,SEQ;NHCSULAB,NHCSUPTH
          WRITE     NHCPROPF,SEQ;NHCVWLAB,NHCVWPTH
.
WRNCIH99  RETURN
+
.------------------------------------------------------------
.  Display NIHC Certificate Public Key Generated
.------------------------------------------------------------
NHCCER00  OPEN      NHCPUBKF,NHCPPATH
.
NHCCER10  READ      NHCPUBKF,SEQ;DIM100,DIM100A,DIM100B,DIM100C,DIM100D:
                                 DIM100E,DIM100F,DIM100G,DIM100H,DIM100I
          GOTO      NHCCER99 IF OVER
.
          SCAN      "webpas.publickey",DIM100
          IF        !@EQUAL
            WRITE     HTMLFILE;DIM100
          ELSE
            WRITE     HTMLFILE;DIM100,DIM100A,DIM100B,DIM100C,DIM100D:
                               DIM100E,DIM100F,DIM100G,DIM100H,DIM100I
          ENDIF
.
          GOTO      NHCCER10
.
NHCCER99  CLOSE     NHCPUBKF
          RETURN
+

.------------------------------------------------------------
.  Display Activate Device Response History from Medicarwe PRODA
.------------------------------------------------------------
PRDACH00  OPEN      WBSACTHS,ACTHPATH
.
PRDACH10  PACK      VAR,SP70,SP70
          READ      WBSACTHS,SEQ;VAR
          GOTO      PRDACH99 IF OVER
.
          WRITE     HTMLFILE;VAR
.
          GOTO      PRDACH10
.
PRDACH99  CLOSE     WBSACTHS
          RETURN
+
.------------------------------------------------------------
.  Display Activate Device Standard Out from Medicare PRODA
.------------------------------------------------------------
PRDACO00  OPEN      WBSACTOF,ACTOPATH
.
PRDACO10  READ      WBSACTOF,SEQ;DIM100,DIM100A
          GOTO      PRDACO99 IF OVER
.
          WRITE     HTMLFILE;DIM100,DIM100A
.
          GOTO      PRDACO10
.
PRDACO99  CLOSE     WBSACTOF
          RETURN
+
.------------------------------------------------------------
.  Display Get Access Token Standard Out from Medicare PRODA
.------------------------------------------------------------
PRDTKO00  OPEN      WBSTOKOF,TOKOPATH
.
PRDTKO10  READ      WBSTOKOF,SEQ;DIM100,DIM100A
          GOTO      PRDTKO99 IF OVER
.
          WRITE     HTMLFILE;DIM100,DIM100A
.
          GOTO      PRDTKO10
.
PRDTKO99  CLOSE     WBSTOKOF
          RETURN
+
.------------------------------------------------------------
.  Display latest generated NIHC JWT
.------------------------------------------------------------
NHCJWT00  OPEN      NHCJWTOF,NHCJPATH
.
NHCJWT10  READ      NHCJWTOF,SEQ;DIM100,DIM100A,DIM100B,DIM100C,DIM100D:
                                 DIM100E,DIM100F,DIM100G,DIM100H,DIM100I
          GOTO      NHCJWT99 IF OVER
.
          SCAN      "webpas.jwt",DIM100
          IF        !@EQUAL
            WRITE     HTMLFILE;DIM100
          ELSE
            WRITE     HTMLFILE;DIM100,DIM100A,DIM100B,DIM100C,DIM100D:
                               DIM100E,DIM100F,DIM100G,DIM100H,DIM100I
          ENDIF
.
          GOTO      NHCJWT10
.
NHCJWT99  CLOSE     NHCJWTOF
          RETURN
+
.------------------------------------------------------------
.  Display Access Token Response History from Medicare PRODA
.------------------------------------------------------------
PRDTKH00  
.          OPEN      WBSTOKHS,TOKHPATH
.
.PRDTKH10  READ      WBSTOKHS,SEQ;VAR
.          GOTO      PRDTKH99 IF OVER
.
.          SCAN      "access_token",VAR
.          GOTO      PRDTKH50 IF EQUAL
.
.          WRITE     HTMLFILE;VAR
.
.          GOTO      PRDTKH10
.
PRDTKH50
.         CLOSE     WBSTOKHS
          OPEN      WBSTOKHS,TOKHPATH
.
PRDTKH60  READ      WBSTOKHS,SEQ;DIM100,DIM100A,DIM100B,DIM100C,DIM100D:
                                 DIM100E,DIM100F,DIM100G,DIM100H,DIM100I
          GOTO      PRDTKH99 IF OVER
.
          WRITE     HTMLFILE;DIM100,DIM100A,DIM100B,DIM100C,DIM100D:
                             DIM100E,DIM100F,DIM100G,DIM100H,DIM100I
.
          GOTO      PRDTKH60
.
PRDTKH99  CLOSE     WBSTOKHS
          RETURN
+
.------------------------------------------------------------
.   Set Parameters for WebServices PRODA variables
.------------------------------------------------------------
SWBSR000  MOVE      ZERO,EXIT
          UNPACK    QRYNAME,KEY5,KEY3
          MOVE      KEY3,F3
          BRANCH    F3,SWBSR010,SWBSR020,SWBSR030,SWBSR040,SWBSR050:
                       SWBSR060,SWBSR070,SWBSR080,SWBSR090,SWBSR100:
                       SWBSR110,SWBSR120,SWBSR130,SWBSR140,SWBSR150:
                       SWBSR160,SWBSR170,SWBSR180,SWBSR190,SWBSR200:
                       SWBSR210,SWBSR220,SWBSR230,SWBSR240,SWBSR250:
                       SWBSR260,SWBSR270,SWBSR280,SWBSR290,SWBSR300:
                       SWBSR310,SWBSR320,SWBSR330,SWBSR340,SWBSR350:
                       SWBSR360,SWBSR370,SWBSR380,SWBSR390,SWBSR400:
                       SWBSR410,SWBSR420,SWBSR430
.
          MOVE      ONE,EXIT
          GOTO      SWBSR999

SWBSR010  PACK      WBSRV001,QRYDATA,SP70
          GOTO      SWBSR999
.
SWBSR020  PACK      WBSRV002,QRYDATA,SP70
          GOTO      SWBSR999
.
SWBSR030  PACK      WBSRV003,QRYDATA,SP70
          GOTO      SWBSR999
.
SWBSR040  PACK      WBSRV004,QRYDATA,SP70
          GOTO      SWBSR999
.
SWBSR050  PACK      WBSRV005,QRYDATA,SP70
          GOTO      SWBSR999
.
SWBSR060  PACK      WBSRV006,QRYDATA,SP70
          GOTO      SWBSR999
.
SWBSR070  PACK      WBSRV007,QRYDATA,SP70
          GOTO      SWBSR999
.
SWBSR080  PACK      WBSRV008,QRYDATA,SP70
          GOTO      SWBSR999
.
SWBSR090  PACK      WBSRV009,QRYDATA,SP70
          GOTO      SWBSR999
.
SWBSR100  PACK      WBSRV010,QRYDATA,SP70
          GOTO      SWBSR999
.
SWBSR110  PACK      WBSRV011,QRYDATA,SP70
          GOTO      SWBSR999
.
SWBSR120  PACK      WBSRV012,QRYDATA,SP70
          GOTO      SWBSR999
.
SWBSR130  PACK      WBSRV013,QRYDATA,SP70
          GOTO      SWBSR999
.
SWBSR140  PACK      WBSRV014,QRYDATA,SP70
          GOTO      SWBSR999
.
SWBSR150  PACK      WBSRV015,QRYDATA,SP70
          GOTO      SWBSR999
.
SWBSR160  PACK      WBSRV016,QRYDATA,SP70
          GOTO      SWBSR999
.
SWBSR170  PACK      WBSRV017,QRYDATA,SP70
          GOTO      SWBSR999
.
SWBSR180  PACK      WBSRV018,QRYDATA,SP70
          GOTO      SWBSR999
.
SWBSR190  PACK      WBSRV019,QRYDATA,SP70
          GOTO      SWBSR999
.
SWBSR200  PACK      WBSRV020,QRYDATA,SP70
          GOTO      SWBSR999
.
SWBSR210  PACK      WBSRV021,QRYDATA,SP70
          GOTO      SWBSR999
.
SWBSR220  PACK      WBSRV022,QRYDATA,SP70
          GOTO      SWBSR999
.
SWBSR230  PACK      WBSRV023,QRYDATA,SP70
          GOTO      SWBSR999
.
SWBSR240  PACK      WBSRV024,QRYDATA,SP70
          GOTO      SWBSR999
.
SWBSR250  PACK      WBSRV025,QRYDATA,SP70
          GOTO      SWBSR999
.
SWBSR260  PACK      WBSRV026,QRYDATA,SP70
          GOTO      SWBSR999
.
SWBSR270  PACK      WBSRV027,QRYDATA,SP70
          GOTO      SWBSR999
.
SWBSR280  PACK      WBSRV028,QRYDATA,SP70
          GOTO      SWBSR999
.
SWBSR290  PACK      WBSRV029,QRYDATA,SP70
          GOTO      SWBSR999
.
SWBSR300  PACK      WBSRV030,QRYDATA,SP70
          GOTO      SWBSR999
.
SWBSR310  PACK      WBSRV031,QRYDATA,SP70
          GOTO      SWBSR999
.
SWBSR320  PACK      WBSRV032,QRYDATA,SP70
          GOTO      SWBSR999
.
SWBSR330  PACK      WBSRV033,QRYDATA,SP70
          GOTO      SWBSR999
.
SWBSR340  PACK      WBSRV034,QRYDATA,SP70
          GOTO      SWBSR999
.
SWBSR350  PACK      WBSRV035,QRYDATA,SP70
          GOTO      SWBSR999
.
SWBSR360  PACK      WBSRV036,QRYDATA,SP70
          GOTO      SWBSR999
.
SWBSR370  PACK      WBSRV037,QRYDATA,SP70
          GOTO      SWBSR999
.
SWBSR380  PACK      WBSRV038,QRYDATA,SP70
          GOTO      SWBSR999
.
SWBSR390  PACK      WBSRV039,QRYDATA,SP70
          GOTO      SWBSR999
.
SWBSR400  PACK      WBSRV040,QRYDATA,SP70
          GOTO      SWBSR999
.
SWBSR410  PACK      WBSRV041,QRYDATA,SP70
          GOTO      SWBSR999
.
SWBSR420  PACK      WBSRV042,QRYDATA,SP70
          GOTO      SWBSR999
.
SWBSR430  PACK      WBSRV043,QRYDATA,SP70
          GOTO      SWBSR999
.
SWBSR999  RETURN
+
.------------------------------------------------------------
. Medicare WebServices OPVW - PVM Management
.------------------------------------------------------------
OPVW0000  MATCH     "1",PTCNWSIN
          GOTO      OPVW9100 IF NOT EQUAL
.
          CALL      GETPAT00
.
          RESET     UPDTTYPE
          MATCH     SP70,UPDTTYPE
          GOTO      OPVW6000 IF EQUAL
.
          MATCH     "A",UPDTTYPE
          GOTO      OPVW1000 IF EQUAL
.
          GOTO      OPVW9000
.
.         ************ ADD FORMACTION ***********
.
OPVW1000  CALL      CLWEBOPV 
          CALL      SETOPV00
.
          PACK      KEY26,WBOPURNO,WBOPDATE,WBOPTIME,WBOPCNTR,SP70
          CALL      RAWBOPV1
          IF        OVRCD=0
            GOTO      OPVW9999
          ENDIF
.
          CALL      WRWBOPV1
.
          MOVE      ZERO,EXIT
          GOTO      OPVW9999
.
.         ************ DISPLAY FORMACTION **********
.
OPVW6000  MATCH     SP70,WEBOPVKY
          IF        !@EQUAL & !@EOS
            PACK      KEY26,WEBOPVKY,SP70
            CALL      RDWBOPV1
            BRANCH    OVRCD,OPVW9200
.
            PACK      KEY71,WBOPHOSP,SP70          * Read B2B Device Table
            CALL      RSWBB2B3
            CALL      RKWBB2B3
            IF        OVRCD=1
              MOVE      SP70,WBB2DPTH
            ELSE
              MATCH     WBOPHOSP,WBB2HOSP
              IF        !@EQUAL
                MOVE      SP70,WBB2DPTH
              ENDIF
            ENDIF
          ENDIF
.
          CLEAR     WEBTITLE
          MOVE      "Medicare WebServices OPVW - PVM Management",WEBTITLE
          RESET     WEBTITLE
.
          CALL      WEBHED00
          BRANCH    EXIT,OPVW9999
.
          CALL      WEBBOD00
.
          CALL      WEBEND00
.
          MOVE      ONE,EXIT
          GOTO      OPVW9999
.
.         ************ ERROR MESSAGES **********
.
OPVW9000  MOVE      "Invalid Form Action.",WEBTITLE
          CALL      WEBERR00
          MOVE      ONE,EXIT
          GOTO      OPVW9999
.
OPVW9100  MOVE      "Not Using Medicare WebServices.",WEBTITLE
          CALL      WEBERR00
          MOVE      ONE,EXIT
          GOTO      OPVW9999
.
OPVW9200  MOVE      "Webopvaf record not found.",WEBTITLE
          CALL      WEBERR00
          MOVE      ONE,EXIT
          GOTO      OPVW9999
.
OPVW9999  RETURN
+
.------------------------------------------------------------
. Medicare WebServices OPVW - PVM Set webopvaf variables
.------------------------------------------------------------
SETOPV00  MOVE      URNUMBER,WBOPURNO
          CALL      IBACLOCK
          PACK      WBOPDATE,CCC,CYY,CMM,CDD
          REP       " 0",WBOPDATE
          CLOCK     TIME,CTIMEIS
          MOVE      CTIMEIS,WBOPTIME
          MOVE      ONE,WBOPCNTR
.
          MOVE      SP70,WBOPHOSP
          IF        IBCNMHOS=ONE
            MOVE      WBSEHOSP,WBOPHOSP
          ENDIF
.
          MOVE      SP70,WBOPTRID
          MOVE      SP70,WBOPFNAM
          MOVE      SP70,WBOPMEDN
          MOVE      SP70,WBOPMEDR
          MOVE      SP70,WBOPSTAT
          MOVE      "Waiting",WBOPEROR
          PACK      WBOPEROR,WBOPEROR,SP70,SP70,SP70,SP70,SP70,SP70,SP70,SP70
          MOVE      SP70,WBOPRESP
          MOVE      SP70,WBOPMSID
.
SETOPV99  RETURN
+
.------------------------------------------------------------
. Output WebServices OPV PVM Table Details
.------------------------------------------------------------
OPVTAB00  PACK      KEY26,URNUMBER,SP70
          CALL      RSWBOPV1
OPVTAB10  CALL      RKWBOPV1
          BRANCH    OVRCD,OPVTAB99
.
          MATCH     URNUMBER,WBOPURNO
          GOTO      OPVTAB99 IF NOT EQUAL
.
          PACK      DISPDATE,SP70
          MATCH     SP70,WBOPDATE
          IF        !@EQUAL
            UNPACK    WBOPDATE,CCENT,CYEAR,CMON,CDAY
            MOVE      CMON,F2
            LOAD      MTHNAM3,F2,JAN,FEB,MAR,APR,MAY,JUN,JUL,AUG,SEP,OCT,NOV,DEC
            PACK      DISPDATE,CDAY,SP1,MTHNAM3,SP1,CCENT,CYEAR
          ENDIF
.
          CLEAR     HTMLLINK
          APPEND    "javascript:displayOPV('",HTMLLINK
          APPEND    WBOPURNO,HTMLLINK
          APPEND    WBOPDATE,HTMLLINK
          APPEND    WBOPTIME,HTMLLINK
          APPEND    DWBOPCNT,HTMLLINK
          APPEND    "')",HTMLLINK
          RESET     HTMLLINK
.
          PACK      SAVKEY26,WBOPURNO,WBOPDATE,WBOPTIME,DWBOPCNT,SP70
          MOVE      WBOPTRID,SAVETRID
.
          PACK      KEY26,URNUMBER,Z70
          CALL      RSWBOPV1
          CALL      RPWBOPV1
          BRANCH    OVRCD,OPVTAB50
.
          MATCH     URNUMBER,WBOPURNO
          GOTO      OPVTAB50 IF NOT EQUAL
.
          MATCH     "0   ",WBOPSTAT
          GOTO      OPVTAB30 IF EQUAL
.
          MATCH     "8005",WBOPSTAT
          GOTO      OPVTAB30 IF EQUAL
.
          MATCH     "8016",WBOPSTAT
          GOTO      OPVTAB30 IF EQUAL
.
          MATCH     "8017",WBOPSTAT
          GOTO      OPVTAB30 IF EQUAL
.
          MATCH     "9650",WBOPSTAT
          GOTO      OPVTAB30 IF EQUAL
.
          GOTO      OPVTAB50
.
OPVTAB30  MATCH     WBOPTRID,SAVETRID
          GOTO      OPVTAB50 IF NOT EQUAL
.
          PACK      DIM40,PGNAME,SP70
          REP       UPPLOW,DIM40
          PACK      WBOPFNAM,WBOPFNAM,SP70
          MATCH     SP70,WBOPFNAM
          GOTO      OPVTAB31 IF EQUAL
          REP       UPPLOW,WBOPFNAM
          MATCH     DIM40,WBOPFNAM
          GOTO      OPVTAB40 IF NOT EQUAL
.
OPVTAB31  PACK      PMEDI,PMEDI,SP70
          PACK      WBOPMEDN,WBOPMEDN,SP70
          MATCH     SP70,WBOPMEDN
          GOTO      OPVTAB32 IF EQUAL
          MATCH     PMEDI,WBOPMEDN
          GOTO      OPVTAB40 IF NOT EQUAL
.
OPVTAB32  PACK      PTMXMCCD,PTMXMCCD,SP70
          PACK      DIM2,WBOPMEDR,SP70
          RJUSTIFY  DIM2
          MATCH     SP70,WBOPMEDR
          GOTO      OPVTAB33 IF EQUAL
          MATCH     PTMXMCCD,DIM2
          GOTO      OPVTAB40 IF NOT EQUAL
.
OPVTAB33  MATCH     "9650",WBOPSTAT
          GOTO      OPVTAB40 IF EQUAL
.
          GOTO      OPVTAB50
.
OPVTAB40  MOVE      SAVKEY26,KEY26
          CALL      RDWBOPV1
.
          WRITE     HTMLFILE;"t.addRow(#"",HTMLLINK,"#",":
                        "#"",WBOPDATE,WBOPTIME,"#",":
                        "#"",WBOPSTAT,"#",":
                        "#"",WBOPEROR,"#",":
                        "#"<font color=red>",WBOPTRID,"</font>#",":
                        "#"",SP1,"#")"
.
          GOTO      OPVTAB10
.
OPVTAB50  MOVE      SAVKEY26,KEY26
          CALL      RDWBOPV1
.
          WRITE     HTMLFILE;"t.addRow(#"",HTMLLINK,"#",":
                                      "#"",WBOPDATE,WBOPTIME,"#",":
                                      "#"",WBOPSTAT,"#",":
                                      "#"",WBOPEROR,"#",":
                                      "#"",WBOPTRID,"#",":
                                      "#"",SP1,"#")"
.
          GOTO      OPVTAB10
.
OPVTAB99  RETURN
+
.---------------------------------------------------------------
. Output WebServices OPVW PVM Tag Details       Parameter: FORM1
.---------------------------------------------------------------
WEBOPV00  PACK      KEY26,WEBOPVKY,SP70
          CALL      RDWBOPV1
          BRANCH    OVRCD,WEBOPV99
.
          BRANCH    FORM1,WEBOPV10,WEBOPV20,WEBOPV30,WEBOPV40,WEBOPV50:
                          WEBOPV60,WEBOPV70,WEBOPV80
.
          GOTO      WEBOPV99
.
WEBOPV10  PACK      DISPDATE,SP70
          MATCH     SP70,WBOPDATE
          IF        !@EQUAL
            UNPACK    WBOPDATE,CCENT,CYEAR,CMON,CDAY
            MOVE      CMON,F2
            LOAD      MTHNAM3,F2,JAN,FEB,MAR,APR,MAY,JUN,JUL,AUG,SEP,OCT,NOV,DEC
            PACK      DISPDATE,CDAY,SP1,MTHNAM3,SP1,CCENT,CYEAR
          ENDIF
          WRITE     HTMLFILE;DISPDATE;
          GOTO      WEBOPV99
.
WEBOPV20  WRITE     HTMLFILE;WBOPTIME;
          GOTO      WEBOPV99
.
WEBOPV30  WRITE     HTMLFILE;WBOPTRID;
          GOTO      WEBOPV99
.
WEBOPV40  WRITE     HTMLFILE;WBOPFNAM;
          GOTO      WEBOPV99
.
WEBOPV50  WRITE     HTMLFILE;WBOPMEDN;
          GOTO      WEBOPV99
.
WEBOPV60  WRITE     HTMLFILE;WBOPMEDR;
          GOTO      WEBOPV99
.
WEBOPV70  WRITE     HTMLFILE;WBOPSTAT;
          GOTO      WEBOPV99
.
WEBOPV80  WRITE     HTMLFILE;WBOPEROR;
          GOTO      WEBOPV99
.
WEBOPV99  RETURN
+
.---------------------------------------------------------------
. OPVW - PVM <tran id>.properties tag
.---------------------------------------------------------------
OPVHED00  MATCH     SP70,WBB2DPTH
          IF        @EQUAL | @EOS
            WRITE     HTMLFILE;"WebServices B2B Device directory not found.";
            GOTO      OPVHED99
          ENDIF
.
          MATCH    SP70,WBOPTRID
          GOTO     OPVHED99 IF EQUAL
          GOTO     OPVHED99 IF EOS
.
          CLEAR     CMDLINE
          APPEND    WBB2DPTH,CMDLINE
          RESET     CMDLINE
          STRIP     CMDLINE
          ENDSET    CMDLINE
          APPEND    "/webPAS_claims/opvw/",CMDLINE
          RESET     CMDLINE
          STRIP     CMDLINE
          ENDSET    CMDLINE
          APPEND    WBOPTRID,CMDLINE
          APPEND    PROPLITR,CMDLINE
          RESET     CMDLINE
.
          MOVE      ZERO,OVRCD
          TRAP      OVERCOND IF IO
          OPEN      PROPFILE,CMDLINE
          TRAPCLR   IO
          IF        OVRCD=1
            WRITE     HTMLFILE;"Can't&nbsp;read: ",CMDLINE;
            GOTO      OPVHED99
          ENDIF 
.
OPVHED10  READ      PROPFILE,SEQ;PROPLINE
          GOTO      OPVHED99 IF OVER
.
          WRITE     HTMLFILE;PROPLINE
.
          GOTO      OPVHED10
.
OPVHED99  CLOSE     PROPFILE
.
          RETURN
+
.---------------------------------------------------------------
. OPVW - PVM <tran id>_opvw_pvm  tag
.---------------------------------------------------------------
OPVJSN00  MATCH     SP70,WBB2DPTH
          IF        @EQUAL | @EOS
            WRITE     HTMLFILE;"WebServices B2B Device directory not found.";
            GOTO      OPVJSN99
          ENDIF
.
          MATCH    SP70,WBOPTRID
          GOTO     OPVJSN99 IF EQUAL
          GOTO     OPVJSN99 IF EOS
.
          CLEAR     CMDLINE
          APPEND    WBB2DPTH,CMDLINE
          RESET     CMDLINE
          STRIP     CMDLINE
          ENDSET    CMDLINE
          APPEND    "/webPAS_claims/opvw/",CMDLINE
          RESET     CMDLINE
          STRIP     CMDLINE
          ENDSET    CMDLINE
          APPEND    WBOPTRID,CMDLINE
          APPEND    OPVWLITR,CMDLINE
          RESET     CMDLINE
.
          MOVE      ZERO,OVRCD
          TRAP      OVERCOND IF IO
          OPEN      OPVWFILE,CMDLINE
          TRAPCLR   IO
          IF        OVRCD=1
            WRITE     HTMLFILE;"Can't&nbsp;read: ",CMDLINE;
            GOTO      OPVJSN99
          ENDIF
.
OPVJSN10  READ      OPVWFILE,SEQ;OPVWLINE
          GOTO      OPVJSN99 IF OVER
.
          WRITE     HTMLFILE;OPVWLINE
.
          GOTO      OPVJSN10
.
OPVJSN99  CLOSE     OPVWFILE
.
          RETURN
+
.---------------------------------------------------------------
. OPVW - PVM <tran id>_opvw_response  tag
.---------------------------------------------------------------
OPVRSP00  MATCH     SP70,WBB2DPTH
          IF        @EQUAL | @EOS
            WRITE     HTMLFILE;"WebServices B2B Device directory not found.";
            GOTO      OPVRSP99
          ENDIF
.
          MATCH    SP70,WBOPTRID
          GOTO     OPVRSP99 IF EQUAL
          GOTO     OPVRSP99 IF EOS
.
          CLEAR     CMDLINE
          APPEND    WBB2DPTH,CMDLINE
          RESET     CMDLINE
          STRIP     CMDLINE
          ENDSET    CMDLINE
          APPEND    "/webPAS_claims/opvw/",CMDLINE
          RESET     CMDLINE
          STRIP     CMDLINE
          ENDSET    CMDLINE
          APPEND    WBOPTRID,CMDLINE
          APPEND    OPVRLITR,CMDLINE
          RESET     CMDLINE
.
          MOVE      ZERO,OVRCD
          TRAP      OVERCOND IF IO
          OPEN      OPVRFILE,CMDLINE
          TRAPCLR   IO
          IF        OVRCD=1
            WRITE     HTMLFILE;"Can't&nbsp;read: ",CMDLINE;
            GOTO      OPVRSP99
          ENDIF
.
OPVRSP10  READ      OPVRFILE,SEQ;OPVRLINE
          GOTO      OPVRSP99 IF OVER
.
          WRITE     HTMLFILE;OPVRLINE
.
          GOTO      OPVRSP10
.
OPVRSP99  CLOSE     OPVRFILE
.
          RETURN
+
.---------------------------------------------------------------
. OPVW - PVM <tran id>_opvw_errors  tag
.---------------------------------------------------------------
OPVERR00  MATCH     SP70,WBB2DPTH
          IF        @EQUAL | @EOS
            WRITE     HTMLFILE;"WebServices B2B Device directory not found.";
            GOTO      OPVERR99
          ENDIF
.
          MATCH    SP70,WBOPTRID
          GOTO     OPVERR99 IF EQUAL
          GOTO     OPVERR99 IF EOS
.
          CLEAR     CMDLINE
          APPEND    WBB2DPTH,CMDLINE
          RESET     CMDLINE
          STRIP     CMDLINE
          ENDSET    CMDLINE
          APPEND    "/webPAS_claims/opvw/",CMDLINE
          RESET     CMDLINE
          STRIP     CMDLINE
          ENDSET    CMDLINE
          APPEND    WBOPTRID,CMDLINE
          APPEND    OPVELITR,CMDLINE
          RESET     CMDLINE
.
          MOVE      ZERO,OVRCD
          TRAP      OVERCOND IF IO
          OPEN      OPVEFILE,CMDLINE
          TRAPCLR   IO
          IF        OVRCD=1
            WRITE     HTMLFILE;"Can't&nbsp;read: ",CMDLINE;
            GOTO      OPVERR99
          ENDIF
.
OPVERR10  READ      OPVEFILE,SEQ;OPVELINE
          GOTO      OPVERR99 IF OVER
.
          WRITE     HTMLFILE;OPVELINE
.
          GOTO      OPVERR10
.
OPVERR99  CLOSE     OPVEFILE
.
          RETURN
+
.------------------------------------------------------------
. Medicare WebServices OVVW - PVV/PVP Management
.------------------------------------------------------------
OVVW0000  MATCH     "1",PTCNWSIN
          GOTO      OVVW9100 IF NOT EQUAL
.
          CALL      GETPAT00
.
          RESET     UPDTTYPE
          MATCH     SP70,UPDTTYPE
          GOTO      OVVW6000 IF EQUAL
.
          MATCH     "A",UPDTTYPE
          GOTO      OVVW1000 IF EQUAL
.
          GOTO      OVVW9000
.
.         ************ ADD FORMACTION ***********
.
OVVW1000  CALL      CLWEBOVV
          CALL      SETOVV00
.
          PACK      KEY26,WBOVURNO,WBOVDATE,WBOVTIME,WBOVCNTR,SP70
          CALL      RAWBOVV1
          IF        OVRCD=0
            GOTO      OVVW9999
          ENDIF
.
          CALL      WRWBOVV1
.
          MOVE      ZERO,EXIT
          GOTO      OVVW9999
.
.         ************ DISPLAY FORMACTION **********
.
OVVW6000  MATCH     SP70,WEBOVVKY
          IF        !@EQUAL & !@EOS
            PACK      KEY26,WEBOVVKY,SP70
            CALL      RDWBOVV1
            BRANCH    OVRCD,OVVW9200
.
            PACK      KEY71,WBOVHOSP,SP70          * Read B2B Device Table
            CALL      RSWBB2B3
            CALL      RKWBB2B3
            IF        OVRCD=1
              MOVE      SP70,WBB2DPTH
            ELSE
              MATCH     WBOVHOSP,WBB2HOSP
              IF        !@EQUAL
                MOVE      SP70,WBB2DPTH
              ENDIF
            ENDIF
          ENDIF
.
          CLEAR     WEBTITLE
          MOVE      "Medicare WebServices OVVW - PVV/PVP Management",WEBTITLE
          RESET     WEBTITLE
.
          CALL      WEBHED00
          BRANCH    EXIT,OVVW9999
.
          CALL      WEBBOD00
.
          CALL      WEBEND00
.
          MOVE      ONE,EXIT
          GOTO      OVVW9999
.
.         ************ ERROR MESSAGES **********
.
OVVW9000  MOVE      "Invalid Form Action.",WEBTITLE
          CALL      WEBERR00
          MOVE      ONE,EXIT
          GOTO      OVVW9999
.
OVVW9100  MOVE      "Not Using Medicare WebServices.",WEBTITLE
          CALL      WEBERR00
          MOVE      ONE,EXIT
          GOTO      OVVW9999
.
OVVW9200  MOVE      "Webovvaf record not found.",WEBTITLE
          CALL      WEBERR00
          MOVE      ONE,EXIT
          GOTO      OVVW9999
.
OVVW9999  RETURN
+
.------------------------------------------------------------
. Medicare WebServices OVVW - PVV/PVP Set webovvaf variables
.------------------------------------------------------------
SETOVV00  MOVE      URNUMBER,WBOVURNO
          CALL      IBACLOCK
          PACK      WBOVDATE,CCC,CYY,CMM,CDD
          REP       " 0",WBOVDATE
          CLOCK     TIME,CTIMEIS
          MOVE      CTIMEIS,WBOVTIME
          MOVE      ONE,WBOVCNTR
.
          MOVE      SP70,WBOVHOSP
          IF        IBCNMHOS=ONE
            MOVE      WBSEHOSP,WBOVHOSP
          ENDIF
.
          MOVE      SP70,WBOVTRID
          MOVE      SP70,WBOVSNAM
          MOVE      SP70,WBOVFNAM
          MOVE      SP70,WBOVVETN
          MOVE      SP70,WBOVPRDT
          MOVE      SP70,WBOVSTAT
          MOVE      "Waiting",WBOVEROR
          PACK      WBOVEROR,WBOVEROR,SP70,SP70,SP70,SP70,SP70,SP70,SP70,SP70
          MOVE      SP70,WBOVVENC
          MOVE      SP70,WBOVRESP
          MOVE      SP70,WBOVMSID
.
SETOVV99  RETURN
+
.------------------------------------------------------------
. Output WebServices OVV PVV/PVP Table Details
.------------------------------------------------------------
OVVTAB00  PACK      KEY26,URNUMBER,SP70
          CALL      RSWBOVV1
OVVTAB10  CALL      RKWBOVV1
          BRANCH    OVRCD,OVVTAB99
.
          MATCH     URNUMBER,WBOVURNO
          GOTO      OVVTAB99 IF NOT EQUAL
.
          PACK      DISPDATE,SP70
          MATCH     SP70,WBOVDATE
          IF        !@EQUAL
            UNPACK    WBOVDATE,CCENT,CYEAR,CMON,CDAY
            MOVE      CMON,F2
            LOAD      MTHNAM3,F2,JAN,FEB,MAR,APR,MAY,JUN,JUL,AUG,SEP,OCT,NOV,DEC
            PACK      DISPDATE,CDAY,SP1,MTHNAM3,SP1,CCENT,CYEAR
          ENDIF
.
          CLEAR     HTMLLINK
          APPEND    "javascript:displayOVV('",HTMLLINK
          APPEND    WBOVURNO,HTMLLINK
          APPEND    WBOVDATE,HTMLLINK
          APPEND    WBOVTIME,HTMLLINK
          APPEND    DWBOVCNT,HTMLLINK
          APPEND    "')",HTMLLINK
          RESET     HTMLLINK
.
          PACK      SAVKEY26,WBOVURNO,WBOVDATE,WBOVTIME,DWBOVCNT,SP70
          MOVE      WBOVTRID,SAVETRID
.
          PACK      KEY26,URNUMBER,Z70
          CALL      RSWBOVV1
          CALL      RPWBOVV1
          BRANCH    OVRCD,OVVTAB50
.
          MATCH     URNUMBER,WBOVURNO
          GOTO      OVVTAB50 IF NOT EQUAL
.
          MATCH     "0   ",WBOVSTAT
          GOTO      OVVTAB30 IF EQUAL
.
          MATCH     "8005",WBOVSTAT
          GOTO      OVVTAB30 IF EQUAL
.
          MATCH     "8016",WBOVSTAT
          GOTO      OVVTAB30 IF EQUAL
.
          MATCH     "8017",WBOVSTAT
          GOTO      OVVTAB30 IF EQUAL
.
          MATCH     "9650",WBOVSTAT
          GOTO      OVVTAB30 IF EQUAL
.
          GOTO      OVVTAB50
.
OVVTAB30  MATCH     WBOVTRID,SAVETRID
          GOTO      OVVTAB50 IF NOT EQUAL
.
          PACK      DIM40,PGNAME,SP70
          REP       UPPLOW,DIM40
          PACK      WBOVFNAM,WBOVFNAM,SP70
          MATCH     SP70,WBOVFNAM
          GOTO      OVVTAB31 IF EQUAL
          REP       UPPLOW,WBOVFNAM
          MATCH     DIM40,WBOVFNAM
          GOTO      OVVTAB40 IF NOT EQUAL
.
OVVTAB31  PACK      DIM40,PSNAME,SP70
          REP       UPPLOW,DIM40
          PACK      WBOVSNAM,WBOVSNAM,SP70
          MATCH     SP70,WBOVSNAM
          GOTO      OVVTAB32 IF EQUAL
          REP       UPPLOW,WBOVSNAM
          MATCH     DIM40,WBOVSNAM
          GOTO      OVVTAB40 IF NOT EQUAL 
.
OVVTAB32  MOVE      THREE,DIM1              * Get DVA Card Number
          CALL      GCCARD00
.
          PACK      PMCDCNUM,PMCDCNUM,SP70
          PACK      DIM10,WBOVVETN,SP70
          LJUSTIFY  DIM10
          MATCH     SP70,WBOVVETN
          GOTO      OVVTAB33 IF EQUAL
          MATCH     PMCDCNUM,DIM10
          GOTO      OVVTAB40 IF NOT EQUAL
.
OVVTAB33  MATCH     "9650",WBOVSTAT
          GOTO      OVVTAB40 IF EQUAL
.
          GOTO      OVVTAB50
.
OVVTAB40  MOVE      SAVKEY26,KEY26
          CALL      RDWBOVV1
.
          WRITE     HTMLFILE;"t.addRow(#"",HTMLLINK,"#",":
                        "#"",WBOVDATE,WBOVTIME,"#",":
                        "#"",WBOVSTAT,"#",":
                        "#"",WBOVEROR,"#",":
                        "#"<font color=red>",WBOVTRID,"</font>#",":
                        "#"",SP1,"#")"
.
          GOTO      OVVTAB10
.
OVVTAB50  MOVE      SAVKEY26,KEY26
          CALL      RDWBOVV1
.
          WRITE     HTMLFILE;"t.addRow(#"",HTMLLINK,"#",":
                                      "#"",WBOVDATE,WBOVTIME,"#",":
                                      "#"",WBOVSTAT,"#",":
                                      "#"",WBOVEROR,"#",":
                                      "#"",WBOVTRID,"#",":
                                      "#"",SP1,"#")"
.
          GOTO      OVVTAB10
.
OVVTAB99  RETURN
+
.---------------------------------------------------------------
. Output WebServices OPVW PVM Tag Details       Parameter: FORM1
.---------------------------------------------------------------
WEBOVV00  PACK      KEY26,WEBOVVKY,SP70
          CALL      RDWBOVV1
          BRANCH    OVRCD,WEBOVV99
.
          BRANCH    FORM2,WEBOVV10,WEBOVV20,WEBOVV30,WEBOVV40,WEBOVV50:
                          WEBOVV60,WEBOVV70,WEBOVV80,WEBOVV90,WEBOVV91:
                          WEBOVV92
.
          GOTO      WEBOVV99
.
WEBOVV10  PACK      DISPDATE,SP70
          MATCH     SP70,WBOVDATE
          IF        !@EQUAL
            UNPACK    WBOVDATE,CCENT,CYEAR,CMON,CDAY
            MOVE      CMON,F2
            LOAD      MTHNAM3,F2,JAN,FEB,MAR,APR,MAY,JUN,JUL,AUG,SEP,OCT,NOV,DEC
            PACK      DISPDATE,CDAY,SP1,MTHNAM3,SP1,CCENT,CYEAR
          ENDIF
          WRITE     HTMLFILE;DISPDATE;
          GOTO      WEBOVV99
.
WEBOVV20  WRITE     HTMLFILE;WBOVTIME;
          GOTO      WEBOVV99
.
WEBOVV30  WRITE     HTMLFILE;WBOVTRID;
          GOTO      WEBOVV99
.
WEBOVV40  WRITE     HTMLFILE;WBOVSNAM;
          GOTO      WEBOVV99
.
WEBOVV50  WRITE     HTMLFILE;WBOVFNAM;
          GOTO      WEBOVV99
.
WEBOVV60  WRITE     HTMLFILE;WBOVVETN;
          GOTO      WEBOVV99
.
WEBOVV70  PACK      DISPDATE,SP70
          MATCH     SP70,WBOVPRDT
          IF        !@EQUAL
            UNPACK    WBOVPRDT,CCENT,CYEAR,CMON,CDAY
            MOVE      CMON,F2
            LOAD      MTHNAM3,F2,JAN,FEB,MAR,APR,MAY,JUN,JUL,AUG,SEP,OCT,NOV,DEC
            PACK      DISPDATE,CDAY,SP1,MTHNAM3,SP1,CCENT,CYEAR
          ENDIF
          WRITE     HTMLFILE;DISPDATE;
          GOTO      WEBOVV99
.
WEBOVV80  WRITE     HTMLFILE;WBOVSTAT;
          GOTO      WEBOVV99
.
WEBOVV90  WRITE     HTMLFILE;WBOVEROR;
          GOTO      WEBOVV99
.
WEBOVV91  WRITE     HTMLFILE;WBOVVENC;
          GOTO      WEBOVV99
.
WEBOVV92  MOVE      "Unknown                                 ",DIM40
.
          MATCH     "PTEC",WBOVVENC
          IF        @EQUAL
            MOVE      "Gold Card                               ",DIM40
          ENDIF
.
          MATCH     "STEC",WBOVVENC
          IF        @EQUAL
            MOVE      "White Card                              ",DIM40
          ENDIF
.
          MATCH     "RPBC",WBOVVENC
          IF        @EQUAL
            MOVE      "Orange Card                             ",DIM40
          ENDIF
.
          MATCH     "PCC ",WBOVVENC
          IF        @EQUAL
            MOVE      "Pensioner Concession Card               ",DIM40
          ENDIF
.
          MATCH     "CSHC",WBOVVENC
          IF        @EQUAL
            MOVE      "Commonwealth Seniors Healthcare Card    ",DIM40
          ENDIF
.
          MATCH     "NIL ",WBOVVENC
          IF        @EQUAL
            MOVE      "Card type cannot be determined          ",DIM40
          ENDIF
.
          WRITE     HTMLFILE;DIM40;
          GOTO      WEBOVV99
.
WEBOVV99  RETURN
+
.---------------------------------------------------------------
. OVV - PVV/PVP <tran id>.properties tag
.---------------------------------------------------------------
OVVHED00  MATCH     SP70,WBB2DPTH
          IF        @EQUAL | @EOS
            WRITE     HTMLFILE;"WebServices B2B Device directory not found.";
            GOTO      OVVHED99
          ENDIF
.
          MATCH    SP70,WBOVTRID
          GOTO     OVVHED99 IF EQUAL
          GOTO     OVVHED99 IF EOS
.
          CLEAR     CMDLINE
          APPEND    WBB2DPTH,CMDLINE
          RESET     CMDLINE
          STRIP     CMDLINE
          ENDSET    CMDLINE
          APPEND    "/webPAS_claims/ovvw/",CMDLINE
          RESET     CMDLINE
          STRIP     CMDLINE
          ENDSET    CMDLINE
          APPEND    WBOVTRID,CMDLINE
          APPEND    PROPLITR,CMDLINE
          RESET     CMDLINE
.
          MOVE      ZERO,OVRCD
          TRAP      OVERCOND IF IO
          OPEN      PROPFILE,CMDLINE
          TRAPCLR   IO
          IF        OVRCD=1
            WRITE     HTMLFILE;"Can't&nbsp;read: ",CMDLINE;
            GOTO      OVVHED99
          ENDIF
.
OVVHED10  READ      PROPFILE,SEQ;PROPLINE
          GOTO      OVVHED99 IF OVER
.
          WRITE     HTMLFILE;PROPLINE
.
          GOTO      OVVHED10
.
OVVHED99  CLOSE     PROPFILE
.
          RETURN
+
.---------------------------------------------------------------
. OVVW - PVP/PVV <tran id>_ovvw tag
.---------------------------------------------------------------
OVVJSN00  MATCH     SP70,WBB2DPTH
          IF        @EQUAL | @EOS
            WRITE     HTMLFILE;"WebServices B2B Device directory not found.";
            GOTO      OVVJSN99
          ENDIF
.
          MATCH    SP70,WBOVTRID
          GOTO     OVVJSN99 IF EQUAL
          GOTO     OVVJSN99 IF EOS
.
          CLEAR     CMDLINE
          APPEND    WBB2DPTH,CMDLINE
          RESET     CMDLINE
          STRIP     CMDLINE
          ENDSET    CMDLINE
          APPEND    "/webPAS_claims/ovvw/",CMDLINE
          RESET     CMDLINE
          STRIP     CMDLINE
          ENDSET    CMDLINE
          APPEND    WBOVTRID,CMDLINE
          APPEND    OVVWLITR,CMDLINE
          RESET     CMDLINE
.
          MOVE      ZERO,OVRCD
          TRAP      OVERCOND IF IO
          OPEN      OVVWFILE,CMDLINE
          TRAPCLR   IO
          IF        OVRCD=1
            WRITE     HTMLFILE;"Can't&nbsp;read: ",CMDLINE;
            GOTO      OVVJSN99
          ENDIF
.
OVVJSN10  READ      OVVWFILE,SEQ;OVVWLINE
          GOTO      OVVJSN99 IF OVER
.
          WRITE     HTMLFILE;OVVWLINE
.
          GOTO      OVVJSN10
.
OVVJSN99  CLOSE     OVVWFILE
.
          RETURN
+
.---------------------------------------------------------------
. OVVW - PVV/PVP <tran id>_ovvw_response  tag
.---------------------------------------------------------------
OVVRSP00  MATCH     SP70,WBB2DPTH
          IF        @EQUAL | @EOS
            WRITE     HTMLFILE;"WebServices B2B Device directory not found.";
            GOTO      OVVRSP99
          ENDIF
.
          MATCH    SP70,WBOVTRID
          GOTO     OVVRSP99 IF EQUAL
          GOTO     OVVRSP99 IF EOS
.
          CLEAR     CMDLINE
          APPEND    WBB2DPTH,CMDLINE
          RESET     CMDLINE
          STRIP     CMDLINE
          ENDSET    CMDLINE
          APPEND    "/webPAS_claims/ovvw/",CMDLINE
          RESET     CMDLINE
          STRIP     CMDLINE
          ENDSET    CMDLINE
          APPEND    WBOVTRID,CMDLINE
          APPEND    OVVRLITR,CMDLINE
          RESET     CMDLINE
.
          MOVE      ZERO,OVRCD
          TRAP      OVERCOND IF IO
          OPEN      OVVRFILE,CMDLINE
          TRAPCLR   IO
          IF        OVRCD=1
            WRITE     HTMLFILE;"Can't&nbsp;read: ",CMDLINE;
            GOTO      OVVRSP99
          ENDIF
.
OVVRSP10  READ      OVVRFILE,SEQ;OVVRLINE
          GOTO      OVVRSP99 IF OVER
.
          WRITE     HTMLFILE;OVVRLINE
.
          GOTO      OVVRSP10
.
OVVRSP99  CLOSE     OVVRFILE
.
          RETURN
+
.---------------------------------------------------------------
. OVVW - PVV/PVP <tran id>_ovvw_errors  tag
.---------------------------------------------------------------
OVVERR00  MATCH     SP70,WBB2DPTH
          IF        @EQUAL | @EOS
            WRITE     HTMLFILE;"WebServices B2B Device directory not found.";
            GOTO      OVVERR99
          ENDIF
.
          MATCH    SP70,WBOVTRID
          GOTO     OVVERR99 IF EQUAL
          GOTO     OVVERR99 IF EOS
.
          CLEAR     CMDLINE
          APPEND    WBB2DPTH,CMDLINE
          RESET     CMDLINE
          STRIP     CMDLINE
          ENDSET    CMDLINE
          APPEND    "/webPAS_claims/ovvw/",CMDLINE
          RESET     CMDLINE
          STRIP     CMDLINE
          ENDSET    CMDLINE
          APPEND    WBOVTRID,CMDLINE
          APPEND    OVVELITR,CMDLINE
          RESET     CMDLINE
.
          MOVE      ZERO,OVRCD
          TRAP      OVERCOND IF IO
          OPEN      OVVEFILE,CMDLINE
          TRAPCLR   IO
          IF        OVRCD=1
            WRITE     HTMLFILE;"Can't&nbsp;read: ",CMDLINE;
            GOTO      OVVERR99
          ENDIF
.
OVVERR10  READ      OVVEFILE,SEQ;OVVELINE
          GOTO      OVVERR99 IF OVER
.
          WRITE     HTMLFILE;OVVELINE
.
          GOTO      OVVERR10
.
OVVERR99  CLOSE     OVVEFILE
.
          RETURN
+
.------------------------------------------------------------
. Medicare WebServices OECW - ECF Management
.------------------------------------------------------------
OECW0000  MATCH     "1",PTCNWSIN
          GOTO      OECW9100 IF NOT EQUAL
.
          RESET     UPDTTYPE
          MATCH     SP70,UPDTTYPE
          GOTO      OECW6000 IF EQUAL
.
          GOTO      OECW9000
.
.         ************ DISPLAY FORMACTION **********
.
OECW6000  MATCH     SP70,WEBOECKY
          IF        !@EQUAL & !@EOS
            PACK      KEY11,WEBOECKY,SP70
            CALL      RDWBOEC1
            BRANCH    OVRCD,OECW9200
.
            PACK      KEY71,WBOCHOSP,SP70          * Read B2B Device Table
            CALL      RSWBB2B3
            CALL      RKWBB2B3
            IF        OVRCD=1
              MOVE      SP70,WBB2DPTH
            ELSE
              MATCH     WBOCHOSP,WBB2HOSP
              IF        !@EQUAL
                MOVE      SP70,WBB2DPTH
              ENDIF
            ENDIF
          ELSE
            GOTO    OECW9200
          ENDIF
.
          CLEAR     WEBTITLE
          MOVE      "Medicare WebServices OECW - ECF Management",WEBTITLE
          RESET     WEBTITLE
.
          CALL      WEBHED00
          BRANCH    EXIT,OECW9999
.
          CALL      WEBBOD00
.
          CALL      WEBEND00
.
          MOVE      ONE,EXIT
          GOTO      OECW9999
.
.         ************ ERROR MESSAGES **********
.
OECW9000  MOVE      "Invalid Form Action.",WEBTITLE
          CALL      WEBERR00
          MOVE      ONE,EXIT
          GOTO      OECW9999
.
OECW9100  MOVE      "Not Using Medicare WebServices.",WEBTITLE
          CALL      WEBERR00
          MOVE      ONE,EXIT
          GOTO      OECW9999
.
OECW9200  MOVE      "Weboecaf record not found.",WEBTITLE
          CALL      WEBERR00
          MOVE      ONE,EXIT
          GOTO      OECW9999
.
OECW9999  RETURN
+
.---------------------------------------------------------------
. OEC - ECF <tran id>.properties tag
.---------------------------------------------------------------
OECHED00  MATCH     SP70,WBB2DPTH
          IF        @EQUAL | @EOS
            WRITE     HTMLFILE;"WebServices B2B Device directory not found.";
            GOTO      OECHED99
          ENDIF
.
          MATCH    SP70,WBOCTRID
          GOTO     OECHED99 IF EQUAL
          GOTO     OECHED99 IF EOS
.
          CLEAR     CMDLINE
          APPEND    WBB2DPTH,CMDLINE
          RESET     CMDLINE
          STRIP     CMDLINE
          ENDSET    CMDLINE
          APPEND    "/webPAS_claims/oecw/",CMDLINE
          RESET     CMDLINE
          STRIP     CMDLINE
          ENDSET    CMDLINE
          APPEND    WBOCTRID,CMDLINE
          APPEND    PROPLITR,CMDLINE
          RESET     CMDLINE
.
          MOVE      ZERO,OVRCD
          TRAP      OVERCOND IF IO
          OPEN      PROPFILE,CMDLINE
          TRAPCLR   IO
          IF        OVRCD=1
            WRITE     HTMLFILE;"Can't&nbsp;read: ",CMDLINE;
            GOTO      OECHED99
          ENDIF
.
OECHED10  READ      PROPFILE,SEQ;PROPLINE
          GOTO      OECHED99 IF OVER
.
          WRITE     HTMLFILE;PROPLINE
.
          GOTO      OECHED10
.
OECHED99  CLOSE     PROPFILE
.
          RETURN
+
.---------------------------------------------------------------
. OECW - ECF <tran id>_oecw tag
.---------------------------------------------------------------
OECJSN00  MATCH     SP70,WBB2DPTH
          IF        @EQUAL | @EOS
            WRITE     HTMLFILE;"WebServices B2B Device directory not found.";
            GOTO      OECJSN99
          ENDIF
.
          MATCH    SP70,WBOCTRID
          GOTO     OECJSN99 IF EQUAL
          GOTO     OECJSN99 IF EOS
.
          CLEAR     CMDLINE
          APPEND    WBB2DPTH,CMDLINE
          RESET     CMDLINE
          STRIP     CMDLINE
          ENDSET    CMDLINE
          APPEND    "/webPAS_claims/oecw/",CMDLINE
          RESET     CMDLINE
          STRIP     CMDLINE
          ENDSET    CMDLINE
          APPEND    WBOCTRID,CMDLINE
          APPEND    OECWLITR,CMDLINE
          RESET     CMDLINE
.
          MOVE      ZERO,OVRCD
          TRAP      OVERCOND IF IO
          OPEN      OECWFILE,CMDLINE
          TRAPCLR   IO
          IF        OVRCD=1
            WRITE     HTMLFILE;"Can't&nbsp;read: ",CMDLINE;
            GOTO      OECJSN99
          ENDIF
.
OECJSN10  READ      OECWFILE,SEQ;OECWLINE
          GOTO      OECJSN99 IF OVER
.
          WRITE     HTMLFILE;OECWLINE
.
          GOTO      OECJSN10
.
OECJSN99  CLOSE     OECWFILE
.
          RETURN
+
.---------------------------------------------------------------
. OECW - ECF <tran id>_oecw_response  tag
.---------------------------------------------------------------
OECRSP00  MATCH     SP70,WBB2DPTH
          IF        @EQUAL | @EOS
            WRITE     HTMLFILE;"WebServices B2B Device directory not found.";
            GOTO      OECRSP99
          ENDIF
.
          MATCH    SP70,WBOCTRID
          GOTO     OECRSP99 IF EQUAL
          GOTO     OECRSP99 IF EOS
.
          CLEAR     CMDLINE
          APPEND    WBB2DPTH,CMDLINE
          RESET     CMDLINE
          STRIP     CMDLINE
          ENDSET    CMDLINE
          APPEND    "/webPAS_claims/oecw/",CMDLINE
          RESET     CMDLINE
          STRIP     CMDLINE
          ENDSET    CMDLINE
          APPEND    WBOCTRID,CMDLINE
          APPEND    OECRLITR,CMDLINE
          RESET     CMDLINE
.
          MOVE      ZERO,OVRCD
          TRAP      OVERCOND IF IO
          OPEN      OECRFILE,CMDLINE
          TRAPCLR   IO
          IF        OVRCD=1
            WRITE     HTMLFILE;"Can't&nbsp;read: ",CMDLINE;
            GOTO      OECRSP99
          ENDIF
.
OECRSP10  READ      OECRFILE,SEQ;OECRLINE
          GOTO      OECRSP99 IF OVER
.
          WRITE     HTMLFILE;OECRLINE
.
          GOTO      OECRSP10
.
OECRSP99  CLOSE     OECRFILE
.
          RETURN
+
.---------------------------------------------------------------
. OECW - ECF <tran id>_oecw_errors  tag
.---------------------------------------------------------------
OECERR00  MATCH     SP70,WBB2DPTH
          IF        @EQUAL | @EOS
            WRITE     HTMLFILE;"WebServices B2B Device directory not found.";
            GOTO      OECERR99
          ENDIF
.
          MATCH    SP70,WBOCTRID
          GOTO     OECERR99 IF EQUAL
          GOTO     OECERR99 IF EOS
.
          CLEAR     CMDLINE
          APPEND    WBB2DPTH,CMDLINE
          RESET     CMDLINE
          STRIP     CMDLINE
          ENDSET    CMDLINE
          APPEND    "/webPAS_claims/oecw/",CMDLINE
          RESET     CMDLINE
          STRIP     CMDLINE
          ENDSET    CMDLINE
          APPEND    WBOCTRID,CMDLINE
          APPEND    OECELITR,CMDLINE
          RESET     CMDLINE
.
          MOVE      ZERO,OVRCD
          TRAP      OVERCOND IF IO
          OPEN      OECEFILE,CMDLINE
          TRAPCLR   IO
          IF        OVRCD=1
            WRITE     HTMLFILE;"Can't&nbsp;read: ",CMDLINE;
            GOTO      OECERR99
          ENDIF
.
OECERR10  READ      OECEFILE,SEQ;OECELINE
          GOTO      OECERR99 IF OVER
.
          WRITE     HTMLFILE;OECELINE
.
          GOTO      OECERR10
.
OECERR99  CLOSE     OECEFILE
.
          RETURN
+
.------------------------------------------------------------
. Generate MyHRViewer / Patient Summary JWT Auth Token
.------------------------------------------------------------
VALTKN00  CALL      XMLHED00
          BRANCH    EXIT,VALTKN99
.
VALTKN10  MATCH     "3",PTCNUNET
          GOTO      VALTKN90 IF NOT EQUAL
.
          PACK      KEY53,VALDHOSP,SP70          * Read B2B Device Table
          CALL      RSPMNDB2
          CALL      RKPMNDB2
          BRANCH    OVRCD,VALTKN91
.
          IF        IBCNMHOS=ONE
            MATCH     VALDHOSP,PMNBHOSP
            GOTO      VALTKN91 IF NOT EQUAL
          ENDIF
.
          MATCH     SP70,PMNBDPTH
          GOTO      VALTKN92 IF EQUAL
          GOTO      VALTKN92 IF EOS
.
.         Call Java Client to build MyHRViewer JWT Auth Token
.         ----------------------------------------------------         
.
          CLEAR     CMDLINE
          APPEND    PMNBDPTH,CMDLINE
          RESET     CMDLINE
          STRIP     CMDLINE
          ENDSET    CMDLINE
          APPEND    "/webPAS_NIHCIHI_run GetAccessTokenViewSumm ",CMDLINE
          APPEND    PMNBDPTH,CMDLINE
          RESET     CMDLINE
          STRIP     CMDLINE
          ENDSET    CMDLINE
          APPEND    "/",CMDLINE
          APPEND    SP1,CMDLINE
          APPEND    VALDUSER,CMDLINE
          RESET     CMDLINE
          STRIP     CMDLINE
          ENDSET    CMDLINE
          APPEND    SP1,CMDLINE
          APPEND    VALDROLE,CMDLINE
          RESET     CMDLINE
          STRIP     CMDLINE
          ENDSET    CMDLINE
          APPEND    SP1,CMDLINE
          APPEND    VALDTAUD,CMDLINE
          RESET     CMDLINE
          STRIP     CMDLINE
          ENDSET    CMDLINE
          APPEND    SP1,CMDLINE
          APPEND    VALDURNO,CMDLINE
          RESET     CMDLINE
.
          EXECUTE   CMDLINE,TASKID
.
          MATCH     "1",TASKID
          GOTO      VALTKN93 IF EQUAL
.
.         Open resulting MyHRViewer JWT Auth Token File in webPAS temp dir
.         -----------------------------------------------------------------
.
          CLEAR     NHCJPATH
.          APPEND    PMNBDPTH,NHCJPATH
.          RESET     NHCJPATH
.          STRIP     NHCJPATH
.          ENDSET    NHCJPATH
.          APPEND    SLASH,NHCJPATH
          APPEND    NHCJFILE,NHCJPATH
          RESET     NHCJPATH
.
          MOVE      ZERO,OVRCD
          TRAP      OVERCOND IF IO
          OPEN      NHCJWTOF,NHCJPATH
          TRAPCLR   IO
          IF        OVRCD=1
            GOTO      VALTKN94
          ENDIF
          CLOSE     NHCJWTOF
.
          OPEN      NHCJWTOF,NHCJPATH
.
VALTKN50  READ      NHCJWTOF,SEQ;DIM100,DIM100A,DIM100B,DIM100C,DIM100D:
                                 DIM100E,DIM100F,DIM100G,DIM100H,DIM100I
          GOTO      VALTKN98 IF OVER
.
          SCAN      "webpas.jwt",DIM100
          IF        @EQUAL
            WRITE     HTMLFILE;"<RETURN_VALUE TYPE=SIMPLE>";
            WRITE     HTMLFILE;DIM100,DIM100A,DIM100B,DIM100C,DIM100D:
                               DIM100E,DIM100F,DIM100G,DIM100H,DIM100I;
            WRITE     HTMLFILE;"</RETURN_VALUE>"
          ENDIF
.
          GOTO      VALTKN50
.
VALTKN90  WRITE     HTMLFILE;"<RETURN_VALUE TYPE=ERROR>":
                             "PTCNUNET - not set to 'Yes, With IHI Only (HPI-I and HPI-O recording)'":
                             "</RETURN_VALUE>"
          GOTO      VALTKN98
.
VALTKN91  WRITE     HTMLFILE;"<RETURN_VALUE TYPE=ERROR>":
                             "pmsndbaf record not found":
                             "</RETURN_VALUE>"
          GOTO      VALTKN98
.
VALTKN92  WRITE     HTMLFILE;"<RETURN_VALUE TYPE=ERROR>":
                             "pmsndbaf device path is blank":
                             "</RETURN_VALUE>"
          GOTO      VALTKN98
.
VALTKN93  WRITE     HTMLFILE;"<RETURN_VALUE TYPE=ERROR>":
                             "GetAccessTokenViewSumm command failed":
                             "</RETURN_VALUE>"
          GOTO      VALTKN98
.
VALTKN94  WRITE     HTMLFILE;"<RETURN_VALUE TYPE=ERROR>":
                             "Error opening MyHRViewer JWT Auth Token File: ":
                             NHCJPATH,"</RETURN_VALUE>"
          GOTO      VALTKN98
.
VALTKN98  CALL      XMLEND00
          CLOSE     NHCJWTOF,DELETE
VALTKN99  RETURN
+
.------------------------------------------------------------
. Medicare WebServices OECW - ECM Management
.------------------------------------------------------------
OEMW0000  MATCH     "1",PTCNWSIN
          GOTO      OEMW9100 IF NOT EQUAL
.
          RESET     UPDTTYPE
          MATCH     SP70,UPDTTYPE
          GOTO      OEMW6000 IF EQUAL
.
          GOTO      OEMW9000
.
.         ************ DISPLAY FORMACTION **********
.
OEMW6000  MATCH     SP70,WEBOECKY
          IF        !@EQUAL & !@EOS
            PACK      KEY11,WEBOECKY,SP70
            CALL      RDWBOEM1
            BRANCH    OVRCD,OEMW9200
.
            PACK      KEY71,WBOEHOSP,SP70          * Read B2B Device Table
            CALL      RSWBB2B3
            CALL      RKWBB2B3
            IF        OVRCD=1
              MOVE      SP70,WBB2DPTH
            ELSE
              MATCH     WBOEHOSP,WBB2HOSP
              IF        !@EQUAL
                MOVE      SP70,WBB2DPTH
              ENDIF
            ENDIF
          ELSE
            GOTO    OEMW9200
          ENDIF
.
          CLEAR     WEBTITLE
          MOVE      "Medicare WebServices OEMW - ECM Management",WEBTITLE
          RESET     WEBTITLE
.
          CALL      WEBHED00
          BRANCH    EXIT,OEMW9999
.
          CALL      WEBBOD00
.
          CALL      WEBEND00
.
          MOVE      ONE,EXIT
          GOTO      OEMW9999
.
.         ************ ERROR MESSAGES **********
.
OEMW9000  MOVE      "Invalid Form Action.",WEBTITLE
          CALL      WEBERR00
          MOVE      ONE,EXIT
          GOTO      OEMW9999
.
OEMW9100  MOVE      "Not Using Medicare WebServices.",WEBTITLE
          CALL      WEBERR00
          MOVE      ONE,EXIT
          GOTO      OEMW9999
.
OEMW9200  MOVE      "Weboemaf record not found.",WEBTITLE
          CALL      WEBERR00
          MOVE      ONE,EXIT
          GOTO      OEMW9999
.
OEMW9999  RETURN
+
.---------------------------------------------------------------
. OEC - ECM <tran id>.properties tag
.---------------------------------------------------------------
OEMHED00  MATCH     SP70,WBB2DPTH
          IF        @EQUAL | @EOS
            WRITE     HTMLFILE;"WebServices B2B Device directory not found.";
            GOTO      OEMHED99
          ENDIF
.
          MATCH    SP70,WBOETRID
          GOTO     OEMHED99 IF EQUAL
          GOTO     OEMHED99 IF EOS
.
          CLEAR     CMDLINE
          APPEND    WBB2DPTH,CMDLINE
          RESET     CMDLINE
          STRIP     CMDLINE
          ENDSET    CMDLINE
          APPEND    "/webPAS_claims/oecwecm/",CMDLINE
          RESET     CMDLINE
          STRIP     CMDLINE
          ENDSET    CMDLINE
          APPEND    WBOETRID,CMDLINE
          APPEND    PROPLITR,CMDLINE
          RESET     CMDLINE
.
          MOVE      ZERO,OVRCD
          TRAP      OVERCOND IF IO
          OPEN      PROPFILE,CMDLINE
          TRAPCLR   IO
          IF        OVRCD=1
            WRITE     HTMLFILE;"Can't&nbsp;read: ",CMDLINE;
            GOTO      OEMHED99
          ENDIF
.
OEMHED10  READ      PROPFILE,SEQ;PROPLINE
          GOTO      OEMHED99 IF OVER
.
          WRITE     HTMLFILE;PROPLINE
.
          GOTO      OEMHED10
.
OEMHED99  CLOSE     PROPFILE
.
          RETURN
+
.---------------------------------------------------------------
. OECW - ECM <tran id>_oecwecm tag
.---------------------------------------------------------------
OEMJSN00  MATCH     SP70,WBB2DPTH
          IF        @EQUAL | @EOS
            WRITE     HTMLFILE;"WebServices B2B Device directory not found.";
            GOTO      OEMJSN99
          ENDIF
.
          MATCH    SP70,WBOETRID
          GOTO     OEMJSN99 IF EQUAL
          GOTO     OEMJSN99 IF EOS
.
          CLEAR     CMDLINE
          APPEND    WBB2DPTH,CMDLINE
          RESET     CMDLINE
          STRIP     CMDLINE
          ENDSET    CMDLINE
          APPEND    "/webPAS_claims/oecwecm/",CMDLINE
          RESET     CMDLINE
          STRIP     CMDLINE
          ENDSET    CMDLINE
          APPEND    WBOETRID,CMDLINE
          APPEND    OEMWLITR,CMDLINE
          RESET     CMDLINE
.
          MOVE      ZERO,OVRCD
          TRAP      OVERCOND IF IO
          OPEN      OEMWFILE,CMDLINE
          TRAPCLR   IO
          IF        OVRCD=1
            WRITE     HTMLFILE;"Can't&nbsp;read: ",CMDLINE;
            GOTO      OEMJSN99
          ENDIF
.
OEMJSN10  READ      OEMWFILE,SEQ;OEMWLINE
          GOTO      OEMJSN99 IF OVER
.
          WRITE     HTMLFILE;OEMWLINE
.
          GOTO      OEMJSN10
.
OEMJSN99  CLOSE     OEMWFILE
.
          RETURN
+
.---------------------------------------------------------------
. OECW - ECM <tran id>_oecwecm_response  tag
.---------------------------------------------------------------
OEMRSP00  MATCH     SP70,WBB2DPTH
          IF        @EQUAL | @EOS
            WRITE     HTMLFILE;"WebServices B2B Device directory not found.";
            GOTO      OEMRSP99
          ENDIF
.
          MATCH    SP70,WBOETRID
          GOTO     OEMRSP99 IF EQUAL
          GOTO     OEMRSP99 IF EOS
.
          CLEAR     CMDLINE
          APPEND    WBB2DPTH,CMDLINE
          RESET     CMDLINE
          STRIP     CMDLINE
          ENDSET    CMDLINE
          APPEND    "/webPAS_claims/oecwecm/",CMDLINE
          RESET     CMDLINE
          STRIP     CMDLINE
          ENDSET    CMDLINE
          APPEND    WBOETRID,CMDLINE
          APPEND    OEMRLITR,CMDLINE
          RESET     CMDLINE
.
          MOVE      ZERO,OVRCD
          TRAP      OVERCOND IF IO
          OPEN      OEMRFILE,CMDLINE
          TRAPCLR   IO
          IF        OVRCD=1
            WRITE     HTMLFILE;"Can't&nbsp;read: ",CMDLINE;
            GOTO      OEMRSP99
          ENDIF
.
OEMRSP10  READ      OEMRFILE,SEQ;OEMRLINE
          GOTO      OEMRSP99 IF OVER
.
          WRITE     HTMLFILE;OEMRLINE
.
          GOTO      OEMRSP10
.
OEMRSP99  CLOSE     OEMRFILE
.
          RETURN
+
.---------------------------------------------------------------
. OECW - ECM <tran id>_oecwecm_errors  tag
.---------------------------------------------------------------
OEMERR00  MATCH     SP70,WBB2DPTH
          IF        @EQUAL | @EOS
            WRITE     HTMLFILE;"WebServices B2B Device directory not found.";
            GOTO      OEMERR99
          ENDIF
.
          MATCH    SP70,WBOETRID
          GOTO     OEMERR99 IF EQUAL
          GOTO     OEMERR99 IF EOS
.
          CLEAR     CMDLINE
          APPEND    WBB2DPTH,CMDLINE
          RESET     CMDLINE
          STRIP     CMDLINE
          ENDSET    CMDLINE
          APPEND    "/webPAS_claims/oecwecm/",CMDLINE
          RESET     CMDLINE
          STRIP     CMDLINE
          ENDSET    CMDLINE
          APPEND    WBOETRID,CMDLINE
          APPEND    OEMELITR,CMDLINE
          RESET     CMDLINE
.
          MOVE      ZERO,OVRCD
          TRAP      OVERCOND IF IO
          OPEN      OEMEFILE,CMDLINE
          TRAPCLR   IO
          IF        OVRCD=1
            WRITE     HTMLFILE;"Can't&nbsp;read: ",CMDLINE;
            GOTO      OEMERR99
          ENDIF
.
OEMERR10  READ      OEMEFILE,SEQ;OEMELINE
          GOTO      OEMERR99 IF OVER
.
          WRITE     HTMLFILE;OEMELINE
.
          GOTO      OEMERR10
.
OEMERR99  CLOSE     OEMEFILE
.
          RETURN
+
.------------------------------------------------------------------------
. Format Patient Name with Second Name Initial
.------------------------------------------------------------------------
PATINT00  CLEAR     DISPNAME
          MOVE      PSNAME,SAVPSNAM
.
..        REP       "' ",PSNAME
          REP       "#" ",PSNAME
..        REP       "' ",PGNAME
          REP       "#" ",PGNAME
          MOVE      SP70,PATFNAME
          REP       UPPLOW,PSNAME
          APPEND    "<b>",DISPNAME
          APPEND    PSNAME,DISPNAME
          APPEND    "</b>",DISPNAME
          PACK      NAME35,PTITL,SP70
          CALL      NAMSTR00
.
          MOVELPTR  PGNAME,LENPTR
          MOVE      ONE,COUNT
PATINT10  BUMP      PGNAME
          GOTO      PATINT80 IF EOS
          ADD       ONE,COUNT
          MATCH     SP1,PGNAME
          GOTO      PATINT10 IF NOT EQUAL
          BUMP      PGNAME
          ADD       ONE,COUNT
PATINT80  RESET     PGNAME
          SETLPTR   PGNAME,COUNT
          PACK      NAME35,PGNAME,SP70
          CALL      NAMSTR00
          RESET     PGNAME,LENPTR
.
          APPEND    SP70,DISPNAME
          RESET     DISPNAME
          MOVE      DISPNAME,PATFNAME
          STRIP     PATFNAME
.
          MOVE      SAVPSNAM,PSNAME         * Original value with quotes etc
.
PATINT90  RESET     PGNAME
.
PATINT99  RETURN
+
.------------------------------------------------------------
.   Set Parameters for NIHC IHI Dashboard variables
.------------------------------------------------------------
SNHCI000  MOVE      ZERO,EXIT
          UNPACK    QRYNAME,KEY5,KEY3
          MOVE      KEY3,F3
          BRANCH    F3,SNHCI010,SNHCI020,SNHCI030,SNHCI040,SNHCI050:
                       SNHCI060,SNHCI070,SNHCI080,SNHCI090
.
          MOVE      ONE,EXIT
          GOTO      SNHCI999

SNHCI010  PACK      NHCIH001,QRYDATA,SP70
          GOTO      SNHCI999
.
SNHCI020  PACK      NHCIH002,QRYDATA,SP70
          GOTO      SNHCI999
.
SNHCI030  PACK      NHCIH003,QRYDATA,SP70
          GOTO      SNHCI999
.
SNHCI040  PACK      NHCIH004,QRYDATA,SP70
          GOTO      SNHCI999
.
SNHCI050  PACK      NHCIH005,QRYDATA,SP70
          GOTO      SNHCI999
.
SNHCI060  PACK      NHCIH006,QRYDATA,SP70
          GOTO      SNHCI999
.
SNHCI070  PACK      NHCIH007,QRYDATA,SP70
          GOTO      SNHCI999
.
SNHCI080  PACK      NHCIH008,QRYDATA,SP70
          GOTO      SNHCI999
.
SNHCI090  PACK      NHCIH009,QRYDATA,SP70
          GOTO      SNHCI999
.
SNHCI999  RETURN
+
.------------------------------------------------------------
. Generate MyHR Upload JWT Auth Token
.------------------------------------------------------------
VALETK00  CALL      XMLHED00
          BRANCH    EXIT,VALETK99
.
VALETK10  MATCH     "3",PTCNUNET
          GOTO      VALETK90 IF NOT EQUAL
.
          PACK      KEY53,VALDHOSP,SP70          * Read B2B Device Table
          CALL      RSPMNDB2
          CALL      RKPMNDB2
          BRANCH    OVRCD,VALETK91
.
          IF        IBCNMHOS=ONE
            MATCH     VALDHOSP,PMNBHOSP
            GOTO      VALETK91 IF NOT EQUAL
          ENDIF
.
          MATCH     SP70,PMNBDPTH
          GOTO      VALETK92 IF EQUAL
          GOTO      VALETK92 IF EOS
.
.         Call Java Client to build MyHR Upload JWT Auth Token
.         ----------------------------------------------------
. 
          CLEAR     CMDLINE
          APPEND    PMNBDPTH,CMDLINE
          RESET     CMDLINE
          STRIP     CMDLINE
          ENDSET    CMDLINE
          APPEND    "/webPAS_NIHCIHI_run GetAccessTokenMyHRUp ",CMDLINE
          APPEND    PMNBDPTH,CMDLINE
          RESET     CMDLINE
          STRIP     CMDLINE
          ENDSET    CMDLINE
          APPEND    "/",CMDLINE
          APPEND    SP1,CMDLINE
          APPEND    VALDUSER,CMDLINE
          RESET     CMDLINE
          STRIP     CMDLINE
          ENDSET    CMDLINE
          APPEND    SP1,CMDLINE
          APPEND    VALDROLE,CMDLINE
          RESET     CMDLINE
          STRIP     CMDLINE
          ENDSET    CMDLINE
          APPEND    SP1,CMDLINE
          APPEND    VALDTAUD,CMDLINE
          RESET     CMDLINE
          STRIP     CMDLINE
          ENDSET    CMDLINE
          APPEND    SP1,CMDLINE
          APPEND    VALDURNO,CMDLINE
          RESET     CMDLINE
          STRIP     CMDLINE
          ENDSET    CMDLINE
          APPEND    SP1,CMDLINE
          APPEND    VALDVISN,CMDLINE
.
          RESET     CMDLINE
.
          EXECUTE   CMDLINE,TASKID
.
          MATCH     "1",TASKID
          GOTO      VALETK93 IF EQUAL
.
.         Open resulting MyHR Upload JWT Auth Token File in webPAS temp dir
.         -----------------------------------------------------------------
.
          CLEAR     NHCMPATH
.          APPEND    PMNBDPTH,NHCMPATH
.          RESET     NHCMPATH
.          STRIP     NHCMPATH
.          ENDSET    NHCMPATH
.          APPEND    SLASH,NHCMPATH
          APPEND    NHCMFILE,NHCMPATH
          RESET     NHCMPATH
.
          MOVE      ZERO,OVRCD
          TRAP      OVERCOND IF IO
          OPEN      NHCMWTOF,NHCMPATH
          TRAPCLR   IO
          IF        OVRCD=1
            GOTO      VALETK94
          ENDIF
          CLOSE     NHCMWTOF
.
          OPEN      NHCMWTOF,NHCMPATH
.
VALETK50  READ      NHCMWTOF,SEQ;DIM100,DIM100A,DIM100B,DIM100C,DIM100D:
                                 DIM100E,DIM100F,DIM100G,DIM100H,DIM100I
          GOTO      VALETK98 IF OVER
.
          SCAN      "webpas.jwt",DIM100
          IF        @EQUAL
            WRITE     HTMLFILE;"<RETURN_VALUE TYPE=SIMPLE>";
            WRITE     HTMLFILE;DIM100,DIM100A,DIM100B,DIM100C,DIM100D:
                               DIM100E,DIM100F,DIM100G,DIM100H,DIM100I;
            WRITE     HTMLFILE;"</RETURN_VALUE>"
          ENDIF
.
          GOTO      VALETK50
.
VALETK90  WRITE     HTMLFILE;"<RETURN_VALUE TYPE=ERROR>":
                             "PTCNUNET - not set to 'Yes, With IHI Only (HPI-I and HPI-O recording)'":
                             "</RETURN_VALUE>"
          GOTO      VALETK98
.
VALETK91  WRITE     HTMLFILE;"<RETURN_VALUE TYPE=ERROR>":
                             "pmsndbaf record not found":
                             "</RETURN_VALUE>"
          GOTO      VALETK98
.
VALETK92  WRITE     HTMLFILE;"<RETURN_VALUE TYPE=ERROR>":
                             "pmsndbaf device path is blank":
                             "</RETURN_VALUE>"
          GOTO      VALETK98
.
VALETK93  WRITE     HTMLFILE;"<RETURN_VALUE TYPE=ERROR>":
                             "GetAccessTokenMyHRUp command failed":
                             "</RETURN_VALUE>"
          GOTO      VALETK98
.
VALETK94  WRITE     HTMLFILE;"<RETURN_VALUE TYPE=ERROR>":
                             "Error opening MyHR Upload JWT Auth Token File: ":
                             NHCMPATH,"</RETURN_VALUE>"
          GOTO      VALETK98
.
VALETK98  CALL      XMLEND00
          CLOSE     NHCMWTOF,DELETE
VALETK99  RETURN
+
.--------------------------------------------------------------------
. Check if there is a successful IHI Lookup within X hours (PTCNIHIV)
.--------------------------------------------------------------------
VALSIH00  CALL      XMLHED00
          BRANCH    EXIT,VALSIH99
.
VALSIH10  MATCH     "3",PTCNUNET
          GOTO      VALSIH90 IF NOT EQUAL
.
          MATCH     SP70,VALDURNO
          GOTO      VALSIH91 IF EQUAL
          GOTO      VALSIH91 IF EOS
.
          MATCH     SP70,PTCNIHIV
          GOTO      VALSIH89 IF EQUAL
          GOTO      VALSIH89 IF EOS
.
          RJUSTIFY  PTCNIHIV
          TYPE      PTCNIHIV
          GOTO      VALSIH89 IF NOT EQUAL
.
          MOVE      ZERO,FORM3
          MOVE      PTCNIHIV,FORM3
.
          COMPARE   ZERO,FORM3
          GOTO      VALSIH89 IF EQUAL
.
          PACK      KEY28,VALDURNO,Z70
          CALL      RSPMNPL1
VALSIH20  CALL      RPPMNPL1
          BRANCH    OVRCD,VALSIH97
.
          MATCH     VALDURNO,PMNPURNO
          GOTO      VALSIH97 IF NOT EQUAL
.
          MATCH     "07",PMNPRTYP
          GOTO      VALSIH20 IF NOT EQUAL
.
          MATCH     "2",PMNPRSTA
          GOTO      VALSIH20 IF NOT EQUAL
.
          MATCH     "Successful",PMNPEROR
.          GOTO      VALSIH96 IF NOT EQUAL
          IF        !@EQUAL
            MATCH     "27",PMNPEROR
            GOTO      VALSIH40 IF EQUAL
            GOTO      VALSIH96
          ENDIF

.
          PACK      KEY72,PMNPURNO,Z70
          CALL      RSPMIHE1
VALSIH30  CALL      RPPMIHE1
          BRANCH    OVRCD,VALSIH40
.
          MATCH     PMIEURNO,PMNPURNO
          GOTO      VALSIH40 IF NOT EQUAL.
. 
          MOVE      PMIEMESI,DIM24
          MATCH     DIM24,PMNPUNIQ
          GOTO      VALSIH95 IF EQUAL
.
          GOTO      VALSIH30
.
VALSIH40  MATCH     SP70,PMNPRDAT
          GOTO      VALSIH97 IF EQUAL
          GOTO      VALSIH97 IF EOS
.
          MOVE      PMNPRDAT,FIRSTDAT
          UNPACK    PMNPRTIM,HOURDIM,D1,MIN
          PACK      FIRSTIME,HOURDIM,MIN
          REP       " 0",FIRSTDAT
          REP       " 0",FIRSTIME
.
          CALL      IBACLOCK
          PACK      LASTDATE,CCC,CYY,CMM,CDD
          REP       " 0",LASTDATE
          UNPACK    CTIMEIS,HOURDIM,D1,MIN
          PACK      LASTTIME,HOURDIM,MIN
          REP       " 0",LASTTIME
          CALL      TIMEDIFF
.
          MOVE      ZERO,FORM6
          MOVE      PTCNIHIV,FORM3
.
          ASSIGN    FORM3*SIXTY,FORM6
.
          COMPARE   CALCTIME,FORM6
          GOTO      VALSIH97 IF LESS
.
VALSIH89  WRITE     HTMLFILE;"<RETURN_VALUE TYPE=SIMPLE>";
          WRITE     HTMLFILE;ONE;
          WRITE     HTMLFILE;"</RETURN_VALUE>"
.
          GOTO      VALSIH98
          
VALSIH90  WRITE     HTMLFILE;"<RETURN_VALUE TYPE=ERROR>":
                             "PTCNUNET - not set to 'Yes, With IHI Only (HPI-I and HPI-O recording)'":
                             "</RETURN_VALUE>"
          GOTO      VALSIH98
.
VALSIH91  WRITE     HTMLFILE;"<RETURN_VALUE TYPE=ERROR>":
                             "UR Number arguement is invalid":
                             "</RETURN_VALUE>"
          GOTO      VALSIH98
.
VALSIH95  MOVE      PMIEDESC,DIM100
          WRITE     HTMLFILE;"<RETURN_VALUE TYPE=ERROR>":
                             "The Last Get IHI Lookup has an Exception. Please re-validate.               ":
                             DIM100:
                             "</RETURN_VALUE>"
          GOTO      VALSIH98
.
VALSIH96  MOVE      PMNPEROR,DIM100
          WRITE     HTMLFILE;"<RETURN_VALUE TYPE=ERROR>":
                             "The Last Get IHI Lookup was not Successful. Please re-validate.             ":
                             DIM100:                    
                             "</RETURN_VALUE>"
          GOTO      VALSIH98
.
VALSIH97  WRITE     HTMLFILE;"<RETURN_VALUE TYPE=ERROR>":
                             "Patient IHI exceeds minimum validation time and":
                             " requires to be re-validated. Press OK to return":
                             "</RETURN_VALUE>"
          GOTO      VALSIH98
.
VALSIH98  CALL      XMLEND00
VALSIH99  RETURN
+
.
.*****************************************************************************
          INC       ACCDIAIO/INC
          INC       APSMASIO/INC
          INC       ARCVX1IO/INC
          INC       BOKDIAIO/INC
          INC       BOKRC1IO/INC
          INC       BOKRX1IO/INC
          INC       EMRICDIO/INC
          INC       EMRUNKIO/INC
          INC       EMRVISIO/INC
          INC       EMRECTIO/INC
          INC       EMRECAIO/INC
          INC       EMRIBHIO/INC
          INC       HICEMSIO/INC
          INC       MLTSECIO/INC
          INC       OUTEADIO/INC
          INC       OUTEAHIO/INC
          INC       OUTECAIO/INC
          INC       OUTECTIO/INC
          INC       OUTERHIO/INC
          INC       OUTERDIO/INC
          INC       OUTIBHIO/INC
          INC       PMSUCHIO/INC
          INC       PMSUCDIO/INC
          INC       PATDGWIO/INC
          INC       PATCHCIO/INC
          INC       VISMDTIO/INC
          INC       VISMTXIO/INC
          INC       PATDO1IO/INC
          INC       PATFACIO/INC
          INC       PATDSCIO/INC
          INC       PATFLTIO/INC
          INC       PATPEIIO/INC
          INC       PATIN1IO/INC
          INC       PATITMIO/INC
          INC       PATMA1IO/INC
          INC       PATMMBIO/INC
          INC       PATPA1IO/INC
          INC       PATPR1IO/INC
          INC       PATMI1IO/INC
          INC       PATRE1IO/INC
          INC       PATRGMIO/INC
          INC       PATTRNIO/INC
          INC       PATVISIO/INC
          INC       NZPSPRIO/INC
          INC       MEHVI1IO/INC
          INC       MEHLEGIO/INC
          INC       PATWR1IO/INC
          INC       PATWC1IO/INC
          INC       PMSCLTIO/INC
          INC       PMSWX1IO/INC
          INC       ACCCMTIO/INC   * ACC Comments File
          INC       ACCLODIO/INC   * ACC Claim Lodgements
          INC       PMSTLEIO/INC            * Patient Titles table
          INC       PMSWORIO/INC
          INC       PATWVEIO/INC
          INC       PMSEVTIO/INC
          INC       PATEORIO/INC
          INC       PATFN1IO/INC
          INC       OUTBOAIO/INC
          INC       OUTCANIO/INC
          INC       OUTRSHIO/INC
          INC       OUTBB1IO/INC
          INC       OUTMA1IO/INC
          INC       OUTHEDIO/INC
          INC       OUTSITIO/INC
          INC       OUTSESIO/INC
          INC       OUTCLIIO/INC
          INC       OUTCTYIO/INC
          INC       MRTAUCIO/INC
          INC       MRTLOCIO/INC
          INC       MRTMASIO/INC
          INC       MRTHISIO/INC
          INC       MRTSTFIO/INC
          INC       MRTPDSIO/INC
          INC       MRTVISIO/INC 
          INC       PATECOIO/INC
          INC       PATECDIO/INC
          INC       PATGSRIO/INC
          INC       PATICDIO/INC
          INC       PATICOIO/INC
          INC       PATICUIO/INC
          INC       PATINVIO/INC
          INC       PATNIDIO/INC
          INC       PATALRIO/INC
          INC       PATPGRIO/INC
          INC       PATVADIO/INC
          INC       RESLNKIO/INC
          INC       PATW11IO/INC                                       *I-43498
          INC       PATW12IO/INC            * WIES12                   *I-51504
          INC       PTW12BIO/INC            * WIES12B
          INC       PATW13IO/INC            * WIES13
          INC       PATW14IO/INC            * WIES14                  *I-145161
          INC       PATW15IO/INC            * WIES15
          INC       PATW16IO/INC            * WIES16
          INC       PATW17IO/INC            * WIES17
          INC       PATWMAIO/INC
          INC       PMSCDNIO/INC
          INC       PMSCTCIO/INC
          INC       PMSOVRIO/INC
          INC       PMSOVVIO/INC
          INC       PMSIHEIO/INC
          INC       PMSNDBIO/INC
          INC       PMSNPLIO/INC
.
..          INC       PMSHCGIO/INC
..          INC       PMSHCPIO/INC
.
          INC       PMSPX2IO/INC
..          INC       WATSUSIO/INC
          INC       BOKRECTM
          INC       CLPMSVX1
          INC       DGCLICAC
          INC       DGCLICEC
          INC       DGCLICOB
          INC       GCCARD00
          INC       NZPSPRTM
          INC       PATDOCTM
..          INC       PATDOCCD
          INC       PATNAMCD
          INC       PMIGTNID
          INC       PMSHCGTM
          INC       PMSHCPTM
          INC       PMSWORTM
          INC       PATMASTM
          INC       CLPMSPX2
          INC       CLPMSRES
          INC       PMSPX2TM
          INC       PATMSXTM
          INC       PATMISTM
          INC       PATCLMTM
          INC       PATRE1TM                * Person Responsible for Account
          INC       PATVISTM
          INC       PATDSCTM
          INC       PRIHRETM
          INC       PMSCLTTM
          INC       OBSCNATM
          INC       OBSDIATM
          INC       PMSNDBTM
          INC       NAMSTRCD
          INC       IBAWEBCD
          INC       GETDRG
          INC       CALCAGE
          INC       OBSCNAPR
          INC       CLPATMAS
          INC       CLPATMIS
          INC       CLPATDSC
          INC       CLPATDOC
          INC       CLPATVIS
          INC       CLOUTERH
          INC       CLOUTERD
          INC       CLWEBB2B
          INC       CLPMSNDB
          INC       CLPMSNPL
          INC       DAYOFWEK
          INC       DGCLICUP
          INC       PMSCDNDS
          INC       WEBB2BTM
.
          INC       PATASFIO/INC
          INC       PATSFAIO/INC
          INC       PATDADIO/INC
          INC       PMSAIDIO/INC
          INC       PMSCCDIO/INC   * Concession Card Details
          INC       PMSVX1IO/INC
          INC       AAEDI1IO/INC
          INC       AAEDE1IO/INC
          INC       PATHSPIO/INC
          INC       OUTDIAIO/INC
          INC       OUTRF1IO/INC
          INC       ALLREFIO/INC
          INC       ALLRLNIO/INC
          INC       ALLENCIO/INC
          INC       WATTR1IO/INC
          INC       WATTX1IO/INC
          INC       ALLDEPIO/INC
          INC       OPRDEAIO/INC
          INC       PATCMCIO/INC
          INC       PATCFAIO/INC
          INC       PATUNAIO/INC
          INC       PATMESIO/INC
          INC       PATFX1IO/INC
          INC       PRIPRAIO/INC
          INC       PRISECIO/INC
          INC       PRIALSIO/INC
          INC       PRIECTIO/INC
          INC       PRIECAIO/INC
          INC       PRIEAHIO/INC
          INC       PRIEADIO/INC
          INC       PRIESHIO/INC
          INC       PRIESDIO/INC
          INC       PRIINVIO/INC
          INC       PMSECOIO/INC
          INC       PMSETRIO/INC
          INC       PRIIBHIO/INC
          INC       PRIHDBIO/INC                 * holding header file
          INC       PRIHREIO/INC                 * holding referral file
          INC       PRIDTRIO/INC
.
.        ******* HPS BLR INCLUDE ENDS HERE          ************
.
          INC       WEBDATCD
          INC       CLPMSNUT
          INC       CLPMSCLT
          INC       PATFFLAB
          INC       PMSNUTIO/INC
          INC       PMSRESIO/INC
          INC       PMSNUTTM     
          INC       NHIMASIO/INC
          INC       NHIETHIO/INC
          INC       CLNHIMAS
          INC       OBSRESIO/INC
          INC       OBSPHYIO/INC
          INC       OBSCALIO/INC
          INC       OBSDITIO/INC
          INC       OBSMEDIO/INC
          INC       OBSPINIO/INC
          INC       OBSCNCIO/INC
          INC       OBSCNAIO/INC
          INC       OBSCNBIO/INC
          INC       OBSDIAIO/INC
          INC       OBSBPHIO/INC
          INC       OBSBHIIO/INC
          INC       OBSLABIO/INC
          INC       OBSPROIO/INC
          INC       OBSREAIO/INC
          INC       VISPAYIO/INC
          INC       ALLCASIO/INC
          INC       WEBB2BIO/INC
          INC       WEBPARIO/INC
          INC       WEBOPVIO/INC
          INC       WEBOVVIO/INC
          INC       WEBOECIO/INC
          INC       WEBOEMIO/INC
.
          INC       TMPALIIO/INC
          INC       PMSEDGIO/INC       * Effective DRG Dates
          INC       NZHISWIO
          INC       AAEMASTM
          INC       CLOUTHED
          INC       CLWEBOPV
          INC       CLWEBOVV
          INC       CLWEBOEC
          INC       CLWEBOEM
          INC       GETEFDRG
.
