. *----------------------------------------------------------------------
. * Include Name  :   COMPARTM.PBL
. *
. * Function      :   CGI variables functions for COMPARFD - comparaf.dat
. *
. * V12.00.01 07/11/2025  Ebon Clements  TSK 0968096
. *                       Added Type 8 - Selection list
. * V11.01.01 09/03/2021  Peter Vela     TSK 0900574
. *                       Added Type 7 - Days Of Week
. * V11.00.00 17/11/2020  Ebon Clements  TSK 0876663
. *                       Created Include
. *----------------------------------------------------------------------
.------------------------------------------------------------------------
.   Clear Parameters for comparaf
.------------------------------------------------------------------------
CPCMPA00  MOVE      Z70,CMPAR001
          MOVE      Z70,CMPAR002
          MOVE      Z70,CMPAR003
          MOVE      Z70,CMPAR004
          MOVE      Z70,CMPAR005
          MOVE      Z70,CMPAR006

CPCMPA99  RETURN
.------------------------------------------------------------
. Display tags for comparaf
.------------------------------------------------------------
CMPA0000  BRANCH    FLDITMNO,CMPA0100,CMPA0200,CMPA0300,CMPA0400,CMPA0500:
                             CMPA0600,CMPA0700,CMPA0800,CMPA0900,CMPA1000:
                             CMPA1100,CMPA1200
          WRITE     HTMLFILE;"Invalid IBA Tag";
          GOTO      CMPA9999
.
CMPA0100  UNPACK    DIM127,D1,KEY1,DIM127
          MOVE      ZERO,F1
          MOVE      KEY1,F1
          BRANCH    F1,CMPA0110,CMPA0115  * 0=Desc 1=Code 
.
          PACK      KEY3,CMPAHOSP,SP70
          CALL      RDPTHSP1
          BRANCH    OVRCD,CMPA9999
.
          WRITE     HTMLFILE;PTHSNAME;
          GOTO      CMPA9999
.
CMPA0110  WRITE     HTMLFILE;CMPAHOSP;
          GOTO      CMPA9999
.
CMPA0115  MATCH     SP70,CMPAHOSP
          IF        @EQUAL
            WRITE     HTMLFILE;"Default";
            GOTO      CMPA9999
          ENDIF
.
          PACK      KEY3,CMPAHOSP,SP70
          CALL      RDPTHSP1
          BRANCH    OVRCD,CMPA9999
.
          WRITE     HTMLFILE;PTHSNAME;
          GOTO      CMPA9999
.
CMPA0200  WRITE     HTMLFILE;CMPAPARM;
          GOTO      CMPA9999
.
CMPA0300  WRITE     HTMLFILE;CMPADESC;
          GOTO      CMPA9999
.
CMPA0400  UNPACK    DIM127,D1,KEY1,DIM127
          MOVE      ZERO,F1
          MOVE      KEY1,F1
          BRANCH    F1,CMPA0410           * 0=value 1=Description
.
          MATCH     "  0",CMPATYPE               * Text
          IF        @EQUAL
            WRITE     HTMLFILE;CMPAVALU;
            GOTO      CMPA9999
          ENDIF
.
          MATCH     "  1",CMPATYPE                * Date
          IF        @EQUAL
            MATCH     SP70,CMPAVALU
            IF        !@EQUAL
              UNPACK    CMPAVALU,CCENT,CYEAR,CMON,CDAY
              MOVE      CMON,F2
              LOAD      MTHNAM3,F2,JAN,FEB,MAR,APR,MAY,JUN,JUL,AUG,SEP,OCT:
                                   NOV,DEC
              WRITE     HTMLFILE;CDAY,SP1,MTHNAM3,SP1,CCENT,CYEAR;
            ENDIF
            GOTO      CMPA9999
          ENDIF
.
          MATCH     "  2",CMPATYPE                * Time
          IF        @EQUAL
            WRITE     HTMLFILE;CMPAVALU;
            GOTO      CMPA9999
          ENDIF
.
          MATCH     "  3",CMPATYPE                * HCP 
          IF        @EQUAL
            WRITE     HTMLFILE;CMPAVALU;
            GOTO      CMPA9999
          ENDIF
.
          MATCH     "  4",CMPATYPE                * Category Code
          IF        @EQUAL
            WRITE     HTMLFILE;CMPAVALU;
            GOTO      CMPA9999
          ENDIF
.
          MATCH     "  5",CMPATYPE                * Yes/No
          IF        @EQUAL
            WRITE     HTMLFILE;CMPAVALU;
            GOTO      CMPA9999
          ENDIF
.
          MATCH     "  6",CMPATYPE                * Numeric
          IF        @EQUAL
            WRITE     HTMLFILE;CMPAVALU;
            GOTO      CMPA9999
          ENDIF
.
          MATCH     "  7",CMPATYPE                * Days Of Week
          IF        @EQUAL
            WRITE     HTMLFILE;CMPAVALU;
            GOTO      CMPA9999
          ENDIF
.
          MATCH     "  8",CMPATYPE                * Selection list value
          IF        @EQUAL
            WRITE     HTMLFILE;CMPAVALU;
            GOTO      CMPA9999
          ENDIF
.
          GOTO      CMPA9999
.
CMPA0410  MATCH     "  0",CMPATYPE               * Text
          IF        @EQUAL
            WRITE     HTMLFILE;CMPAVALU;
            GOTO      CMPA9999
          ENDIF
.
          MATCH     "  1",CMPATYPE                * Date
          IF        @EQUAL
            MATCH     SP70,CMPAVALU
            IF        !@EQUAL
              UNPACK    CMPAVALU,CCENT,CYEAR,CMON,CDAY
              MOVE      CMON,F2
              LOAD      MTHNAM3,F2,JAN,FEB,MAR,APR,MAY,JUN,JUL,AUG,SEP,OCT:
                                   NOV,DEC
              WRITE     HTMLFILE;CDAY,SP1,MTHNAM3,SP1,CCENT,CYEAR;
            ENDIF
            GOTO      CMPA9999
          ENDIF
.
          MATCH     "  2",CMPATYPE                * Time
          IF        @EQUAL
            WRITE     HTMLFILE;CMPAVALU;
            GOTO      CMPA9999
          ENDIF
.
          MATCH     "  3",CMPATYPE                * HCP
          IF        @EQUAL
            MATCH    SP70,CMPAVALU
            IF       !@EQUAL
              PACK      KEY10,CMPAVALU,SP70
              CALL      RDPMHCP1
              IF        OVRCD=1
                WRITE     HTMLFILE;CMPAVALU;
              ELSE
                MOVE      PMHCTITL,FMTTITLE
                MOVE      PMHCGNAM,FMTGNAME
                MOVE      PMHCSNAM,FMTSNAME
                CALL      DOCNM000
                WRITE     HTMLFILE;DOCFNAME;
              ENDIF
            ENDIF

          ENDIF
.
          MATCH     "  4",CMPATYPE                * Category Code
          IF        @EQUAL
            MATCH    SP70,CMPAVALU
            IF       !@EQUAL
              UNPACK    CMPAVALU,D2,D3
              MATCH     SP70,D3
              IF        !@EQUAL
                PACK      KEY5,CMPAVALU,SP70
                CALL      RDCODE1
                IF        OVRCD=1
                  MOVE      CMPAVALU,TDESC
                ENDIF
                WRITE     HTMLFILE;TDESC;
              ENDIF
            ENDIF

            GOTO      CMPA9999
          ENDIF
.
          MATCH     "  5",CMPATYPE                * Yes/No
          IF        @EQUAL
            MATCH    "0",CMPAVALU
            IF       @EQUAL
              WRITE     HTMLFILE;"No";
            ENDIF
            MATCH    "1",CMPAVALU
            IF       @EQUAL
              WRITE     HTMLFILE;"Yes";
            ENDIF

            GOTO      CMPA9999
          ENDIF
.
          MATCH     "  6",CMPATYPE                * Numeric
          IF        @EQUAL
            WRITE     HTMLFILE;CMPAVALU;
            GOTO      CMPA9999
          ENDIF
.
          MATCH     "  7",CMPATYPE                * Days Of Week
          IF        @EQUAL
            WRITE     HTMLFILE;CMPAVALU;
            GOTO      CMPA9999
          ENDIF
.
          GOTO      CMPA9999
.
CMPA0500  UNPACK    DIM127,D1,KEY1,DIM127
          MOVE      ZERO,F1
          MOVE      KEY1,F1
          BRANCH    F1,CMPA0510           * 0=Desc 1=Code
.
          MOVE      CMPTY000,KEY50
          MOVE      ZERO,F3
          MOVE      CMPATYPE,D3
          SQUEEZE   D3
          MOVE      D3,F3
          LOAD      KEY50,F3,CMPTY001,CMPTY002,CMPTY003,CMPTY004,CMPTY005:
                          CMPTY006
.
          WRITE     HTMLFILE;KEY50;
          GOTO      CMPA9999
.
CMPA0510  WRITE     HTMLFILE;CMPATYPE;
          GOTO      CMPA9999
.
CMPA0600  WRITE     HTMLFILE;CMPAACTV;
          GOTO      CMPA9999
.
CMPA0700  MATCH     SP70,CMPACDAT
          GOTO      CMPA9999 IF EQUAL
.
          UNPACK    CMPACDAT,CCENT,CYEAR,CMON,CDAY
          MOVE      CMON,F2
          LOAD      MTHNAM3,F2,JAN,FEB,MAR,APR,MAY,JUN,JUL,AUG,SEP,OCT,NOV,DEC
          WRITE     HTMLFILE;CDAY,SP1,MTHNAM3,SP1,CCENT,CYEAR;
          GOTO      CMPA9999
.
CMPA0800  WRITE     HTMLFILE;CMPACTIM;
          GOTO      CMPA9999
.
CMPA0900  MATCH     SP70,CMPACUID
          GOTO      CMPA9999 IF EQUAL
.
          PACK      KEY10,CMPACUID,SP70
          CALL      RDWBSE1
          IF        OVRCD=1
            MOVE      CMPACUID,WBSENAM
          ENDIF
          WRITE     HTMLFILE;WBSENAM;
          GOTO      CMPA9999
.
CMPA1000  MATCH     SP70,CMPAUDAT
          GOTO      CMPA9999 IF EQUAL
.
          UNPACK    CMPAUDAT,CCENT,CYEAR,CMON,CDAY
          MOVE      CMON,F2
          LOAD      MTHNAM3,F2,JAN,FEB,MAR,APR,MAY,JUN,JUL,AUG,SEP,OCT,NOV,DEC
          WRITE     HTMLFILE;CDAY,SP1,MTHNAM3,SP1,CCENT,CYEAR;
          GOTO      CMPA9999
.
CMPA1100  WRITE     HTMLFILE;CMPAUTIM;
          GOTO      CMPA9999
.
CMPA1200  MATCH     SP70,CMPAUUID
          GOTO      CMPA9999 IF EQUAL
.
          PACK      KEY10,CMPAUUID,SP70
          CALL      RDWBSE1
          IF        OVRCD=1
            MOVE      CMPAUUID,WBSENAM
          ENDIF
          WRITE     HTMLFILE;WBSENAM;
          GOTO      CMPA9999
.
CMPA9999  RETURN
.
.------------------------------------------------------------
. Set parameters for comparaf
.------------------------------------------------------------
SCMPA000  MOVE      ZERO,EXIT
          UNPACK    QRYNAME,KEY5,KEY3
          MOVE      KEY3,F3
          BRANCH    F3,SCMPA001,SCMPA002,SCMPA003,SCMPA004,SCMPA005:
                       SCMPA006
.
          MOVE      ONE,EXIT
          GOTO      SCMPA999 
.
SCMPA001  SQUEEZE   QRYDATA
          MOVE      QRYDATA,CMPAR001
          PACK      CMPAR001,CMPAR001,SP70
          GOTO      SCMPA999
.
SCMPA002  SQUEEZE   QRYDATA
          MOVE      QRYDATA,CMPAR002
          PACK      CMPAR002,CMPAR002,SP70
          GOTO      SCMPA999
.
SCMPA003  PACK      CMPAR003,QRYDATA,SP70
          GOTO      SCMPA999
.
SCMPA004  PACK      CMPAR004,QRYDATA,SP70
          GOTO      SCMPA999
.
SCMPA005  PACK      CMPAR005,QRYDATA,SP70
          GOTO      SCMPA999
.
SCMPA006  PACK      CMPAR006,QRYDATA,SP70
          GOTO      SCMPA999
.
SCMPA999  RETURN
.
.------------------------------------------------------------
. Update comparaf file variables
.------------------------------------------------------------
MVCMPA00  MATCH     CMPAR001,Z70
          IF        !@EQUAL
            MOVE      CMPAR001,CMPAHOSP
          ENDIF
.
          MATCH     CMPAR002,Z70
          IF        !@EQUAL
            MOVE      CMPAR002,CMPAPARM
          ENDIF
.
          MATCH     CMPAR003,Z70
          IF        !@EQUAL
            MOVE      CMPAR003,CMPADESC
          ENDIF
.
          MATCH     CMPAR004,Z70
          IF        !@EQUAL
            MOVE      CMPAR004,CMPAVALU
          ENDIF
.
          MATCH     CMPAR005,Z70
          IF        !@EQUAL
            MOVE      ZERO,F3
            SQUEEZE   CMPAR005
            MOVE      CMPAR005,F3
            MOVE      F3,CMPATYPE
          ENDIF
.
          MATCH     CMPAR006,Z70
          IF        !@EQUAL
            MOVE      CMPAR006,CMPAACTV
          ENDIF
.
MVCMPA99  RETURN
