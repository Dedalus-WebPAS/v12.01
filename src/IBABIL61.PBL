. *****************************************************************************
. *              P R O G R A M  S U M M A R Y                                 *
. *              -------------  -------------                                 *
. *                                                                           *
. *     PROGRAM NAME:     IBABIL61                                            *
. *                                                                           *
. *     FUNCTION:         Checking Invoice Pending file for all Current Adms. *
. *                                                                           *
. *     DATE WRITTEN:     09/05/2013                                          *
. *                                                                           *
. *     MODIFICATIONS:                                                        *
. *                                                                           *
. *---------------------------------------------------------------------------*
. * V11.05.01 24/02/2025  J.Tan            TSK 0946490                        *
. *           Recompiled for PATCATBI - Added PMSHATFD/IO                     *
. * V11.04.08 25/10/2024 J.Tan             TSK 0951578                        *
. *           Recompiled for ABFPTINV-Added Min.to roundup ICU Hrs(ABF)       *
. * V11.04.07 23/09/2024  J.Tan          TSK 0949848                          *
. *           Recompiled for ABFPTINV - DRG List used in for COVID Adjustor   *
. * V11.04.06 11/09/2024  J.Tan          TSK 0947315                          *
. *          Recompiled for ABFPTINV - fixed Total Unqualified                *
. * V11.04.05 01/08/2024  J.Tan          TSK 0947804                          *
. *           Recompiled for ABFMHINV - Changes for Discharges after 1/7/2023 *
. * V11.04.04 17/07/2024  J.Tan          TSK 0947315                          *
. *           Recompiled for ABFPTINV (LOS ICU adjusted & Newborn)            *
. * V11.04.03 15/03/2024  J.Tan          TSK 0910994                          *
. *           Recompiled for CMXMATRX                                         *
. * V11.04.02 29/01/2024  Jacob Jackson  TSK 0919335                          *
. *           Add HF History includes                                         *
. * V11.04.01 29/01/2024  Jacob Jackson  TSK 0919335                          *
. *           Add new local variable and recompile for GETTFEES               *
. * V11.03.05 17/11/2023  J.Tan          TSK 0940089                          *
. *           Recompiled for ABFPTINV - checking for blank Disc.DRG           *
. * V11.03.04 13/11/2023  J.Tan          TSK 0939019                          *
. *           Recompiled for ABFPTINV - HAC ICD10 Edition 12                  *
. * V11.03.03 04/10/2023  J.Tan          TASK 0938230                         *
. *           Recompiled for ABFAECCL - Emergency ABF                         *
. * V11.03.02 29/08/2023  J.Tan          TSK 0916870                          *
. *           Recompiled for ABFPTINV - Claim code Cat CL Multiple NEP value  *
. * V11.03.01 15/06/2023  J.Tan          TSK 0923703                          *
. *           Recompiled for ABF new calculations                             *
. * V11.02.02 29/06/2022 J.Tan           TSK 0920712                          *
. *           Recompiled for ABFAECCL - I*D on emrvcdaf file                  *
. * V11.02.01 03/03/2022  J.Tan           TSK 0902652                         *
. *           Recompiled for OUTCATBI/AAECATBI - Pat.Invoice new functionality*
. * V11.01.09 17/11/2021  J.Tan          TSK 0913621                          *
. *           Recompiled for ABFPTINV - Mod for Multiple NEP Values           *
. * V11.01.08 28/10/2021 J.Tan           TSK 0913056                          *
. *           Recompiled for ABFAECCL-ADMFLAG and CCAR0000(Clinical Care)     *
. * V11.01.07 13/10/2021 J.Tan           TSK 0905305                          *
. *           Recompiled for ABFAECCL - Adjustment type 068 & 069             *
. * V11.01.06 29/09/2021  J.Tan          TSK 0901515                          *
. *           Recompiled for CMXMATRX - Added Primary Proc.to Matrix          *
. * V11.01.05 14/09/2021  J.Tan          TSK 0906222                          *
. *           Recompiled for ABFPTINV - Mod for Multiple NEP Values           *
. * V11.01.04 09/08/2021  J.Tan           TSK 0905305                         *
. *           Recompiled for AAECATBI - AE Care class (ABFAECCL)              *
. * V11.01.03 07/07/2021  J.Tan           TSK 0908588                         *
. *           Recompiled for PATCATBI-Exclude Unqualified days for Casepayment*
. * V11.01.02 28/04/2021  Thanh T         TSK 0895165                         *
. *           Recompiled for OPRARDFD changes                                 *
. *           07/04/2021  Tracey Nguyen   TSK 0901515                         *
. *           Recompiled for PMSCMTFD - Added new fields                      *
. *           a) 1 File type for ICD procedure (PMCCIPF)                      *
. *           b) 3 new CMBS Field Type (PMCCFTS4/PMCCFT5C/PMCCFT6C)           *
. *           c) 3 new CMBS Codes From (PMCCPC4F,PMCCSC5F,PMCCTC6F)           *
. *           d) 3 new CMBS Codes To   (PMCCPC4T/PMCCSC5T,PMCCTC6T)           *
. *           27/04/2021  J.Tan           TSK 0863287                         *
. *           Mod for Patient Invoice new functionality                       *
. * V11.01.01 10/03/2021  Tracey Nguyen   TSK 0901515                         *
. *           Recompiled for PMSCMTFD - Added Primary ICD Procedure 1-5       *
. *           (PMCCICP1-5)                                                    *
. *---------------------------------------------------------------------------*
. *        V11.00.05 10/11/2020  J.Tan           TSK 0899562                  *
. *                  Recompiled for CMXMATRX - setup date for reading MBS item*
. *        V11.00.04 29/09/2020  J.Tan          TSK 0896829                   *
. *                  Recompiled for CMXMATRX - use National(PTPGNDRG)DRG      *
. *        V11.00.03 22/09/2020  J.Tan           TSK 0895330                  *
. *                  Recompiled for CMXMATRX - reposition read of Matrix table*
. *        V11.00.02 07/05/2020  J.Tan            TSK 0891341                 *
. *                  Recompiled for ABFOTINV - added TRAP to write pmsabfaf   *
. *        V11.00.01 20/03/2020  J.Tan          TSK 0838262                   *
. *                  Added Effective from and to date to MBS Item file        *
. *        V10.15.01 11/10/2019  Peter Vela       TSK 0882906                 *
. *                  Recompiled for OUTCATBI - Fixed I*C for OUTBB1 ABF       *
. *        V10.14.01 09/09/2019  J.Tan           TSK 0857392                  *
. *                  Recompiled for ABF invoice                               *
. *        V10.13.03 11/01/2019  Peter Vela     TSK 0867807                   *
. *                  Recompiled for OUTCATBI                                  *
. *        V10.13.02 26/10/2018  Thanh T        TSK 0859743                   *
. *                  Added BULKBILL field and removed OUTHEDFD/OUTHEDIO,      *
. *                  OUTSESFD/OUTSESIO for OUTCATBI changes                   *
. *        V10.13.01 25/10/2018  Thanh T        TSK 0859743                   *
. *                  Added OUTHEDFD/OUTHEDIO, OUTSESFD/OUTSESIO for OUTCATBI  *
. *                  changes                                                  *
. *---------------------------------------------------------------------------*
. *        V10.12.01 18/07/2018  J.Tan          TSK 0859911                   *
. *                  Recompiled for PATCATBI - Fixed No Payday Add on charge  *
. *        V10.11.02 08/09/2017  Ebon Clements  TSK 0818097                   *
. *                  Added excluded newborn functionality -  EXNB0000         *
. *        V10.11.01 07/09/2017  J.Tan         TSK 0837479                    *
. *                  Recompiled for CMXMATRX - Consumption type items         *
. *        V10.10.02 13/06/2017  J.Tan          TSK 0839991                   *
. *                  Recompiled for PATDBTYP (PATCMSTP)                       *
. *        V10.10.01 25/01/2017  J.Tan          TSK 0832407                   *
. *                  Recompiled for PATCATBI-multi bed trans on sameday for MV*
. *                  04/04/2017  J.Tan         TSK 0297904                    *
. *                  Recompiled for PATCMSTP - Non-Accumulative inlier ICU/CCU*
. *        V10.08.08 06/10/2016  J.Tan         TSK 0826824                    *
. *                  Recompiled for CALCMVHR - MV Hours                       *
. *        V10.08.07 21/09/2016  J.Tan         TSK 0826370                    *
. *                  Recompiled for CMXMATRX - Chg MCHGARR MCHGAMT array to F3*
. *        V10.08.06 26/08/2016  Don Nguyen    TSK 0312570                    *
. *                  Recompiled for CMXMATRX - Added check for PTCNDGED=1     *
. *                  Added PMSEDGFD/IO and GETEFDRG                           *
. *        V10.08.05 17/08/2016  J.Tan         TSK 0808745                    *
. *                  Recompiled for PATCATBI - for NPDAYFLG=1                 *
. *        V10.08.04 20/07/2016  J.Tan         TSK 0819914                    *
. *                  Recompiled for PATCATBI - Non ICU MV Hours               *
. *        V10.08.03 15/07/2016  J.Tan         TSK 0819914                    *
. *                  Recompiled for PATCATBI - Calculating non ICU MV hours   *
. *        V10.08.02 20/06/2016  J.Tan         TSK 0820816                    *
. *                  Recompiled for PATCATBI - Fixed No payday for Daycase    *
. *        V10.08.01 02/06/2016  J.Tan         TSK 0816651                    *
. *                  Recompiled for PATCATBI-Continuous Bill.to chk for Matrix*
. *        V10.07.02 04/03/2016  J.Tan         CAR 290448                     *
. *                  Recompiled for PATCATBI - Mods for Addon with No Pay DAy *
. *        V10.07.01 18/11/2015  J.Tan         CAR 303942                     *
. *                  Added new payment types                                  *
. *        V10.06.02 15/07/2015  J.Tan          CAR 319342                    *
. *                  Recompiled for CMXMATRX - Chg 'Disc.UDF' to 'Care Class' *
. *        V10.06.01 14/07/2015  Peter Vela     CAR 318700                    *
. *                  Recompiled for PRBILCMN - Validate for deleted VISMDT    *
. *                  record                                                   *
. *        V10.05.01 04/08/2014 J.Tan           CAR 304397                    *
. *                  Mods to check Suggested classification for charging      *
. *        V10.04.05 03/07/2014 J.Tan           CAR 268860                    *
. *                  Recompiled for PATCATBI - ICD10 Suggested Classification *
. *        V10.04.04 19/06/2014 J.Tan           CAR 302452                    *
. *                  Recompiled for PATDINVS - Changed MCHGARR/MCHGAMT        *
. *        V10.04.03 11/06/2014 Sandra Barcham  CAR 301639                    *
. *                  Moved call to TFILENAM to INIT0000                       *
. *        V10.04.02 27/05/2014  J.Tan          CAR 300784                    *
. *                  Recompiled for STEPDOWN -force stepdown prior inv.fromdat*
. *        V10.04.01 15/04/2014  J.Tan          CAR 261630                    *
. *                  PATCATBI - Removed port number from temp file name       *
. *        V10.03.05 13/12/2013  J.Tan          CAR 294609                    *
. *                  Recompiled for CMXMATRX - mods for Default Grouper Vers. *
. *        V10.03.04 07/11/2013  J.Tan          CAR 283618                    *
. *                  Recompiled for PATCATBI - mods for Ind.Services Billing  *
. *        V10.03.03 02/10/2013  J.Tan          CAR 291588                    *
. *                  Recompiled for PATCATBI -fixed stepdown return from leave*
. *        V10.03.02 14/08/2013  J.Tan          CAR 288416                    *
. *                  Recompiled for PATCATBI - fixed Days of Hosps.           *
. *        V10.03.01 05/08/2013  J.Tan          CAR 288060                    *
. *                  Recompiled for CMXMATRX -fixed Primary/Secondary/Tertiary*
. *                                                                           *
. ******************************************************************************
.
          INC       STD001FD
          INC       PATCOMM/INC
          INC       PABXVARS/INC
          INC       IBASEQFD/INC                 * Sequential Numbers File
          INC       TFILEVAR/INC                 * Generate Temp File Name
          INC       WEBERRFD/INC                 * Web Server Error Logging
.
          INC       AAEDE1FD/INC
          INC       AAEDEBFD/INC
          INC       AAEDTRFD/INC
          INC       IBASECFD/INC
          INC       IBAPASFD/INC
          INC       IBAGEDFD/INC
          INC       IBAGSTFD/INC
          INC       IBACONFD/INC
          INC       IBATMDFD/INC
          INC       IBATMHFD/INC
          INC       NHIMASFD/INC
.
          INC       MLTCFNFD/INC
          INC       NZPBFEFD/INC
          INC       NZPCFNFD/INC
          INC       NZPCMTFD/INC
          INC       NZPEXTFD/INC
          INC       NZPRDTFD/INC
          INC       NZPFIGFD/INC
          INC       NZPFINFD/INC
          INC       NZPIBRFD/INC
          INC       NZPMCHFD/INC
          INC       NZPMXCFD/INC
          INC       NZPPFEFD/INC
          INC       NZPRBRFD/INC
          INC       NZPRFNFD/INC
          INC       NZPPICFD/INC
          INC       NZPSPRFD/INC
          INC       NZPTFEFD/INC
          INC       NZPRVBFD/INC
          INC       NZPIVBFD/INC
          INC       OPRARDFD/INC
          INC       OPRDEAFD/INC
          INC       OPRSESFD/INC
.
          INC       OUTBOAFD/INC
          INC       OUTBB1FD/INC
          INC       OUTDTRFD/INC
          INC       OUTSITFD/INC
          INC       PATELGFD/INC
          INC       PATBFEFD/INC
          INC       PATCALAG/INC
          INC       PATCFAFD/INC
          INC       PATCODFD/INC
          INC       PMSCIDFD/INC
          INC       PMSCCDFD/INC
          INC       PATCONFD/INC
          INC       PATCTFFD/INC
          INC       PATDHEAD/INC
          INC       PATDINVS/INC
          INC       PATDGWFD/INC
          INC       PATDO1FD/INC
          INC       PATDRGFD/INC
          INC       PATDSCFD/INC
          INC       PATDTRFD/INC
          INC       PATECDFD/INC
          INC       PATECOFD/INC
          INC       PATFINFD/INC
          INC       PATFMOFD/INC
          INC       PATFX1FD/INC
          INC       PATFN1FD/INC
          INC       PATFN2FD/INC
          INC       PATGTUFD/INC
          INC       PATHSPFD/INC
          INC       PATHTRFD/INC
          INC       EMRHTRFD/INC
          INC       OUTHTRFD/INC
          INC       PATIBLFD/INC
          INC       PATICUFD/INC
          INC       PATIN1FD/INC
          INC       PATINMFD/INC
          INC       PATINVFD/INC
          INC       PATIOVFD/INC
          INC       PATIPEFD/INC
          INC       PATITMFD/INC
          INC       PATMA1FD/INC
          INC       PATMCHFD/INC
          INC       PATMI1FD/INC
          INC       PATOVBFD/INC
          INC       PATPGRFD/INC
          INC       PATRE1FD/INC
          INC       PATRBLFD/INC
          INC       PATRATFD/INC
          INC       PATRCAUD/INC
          INC       PATRFNFD/INC
          INC       PATSELDT/INC
          INC       PATSRBFD/INC
          INC       PATTFEFD/INC
          INC       PATTRNFD/INC
          INC       PATVENFD/INC
          INC       PATVISFD/INC
          INC       PATWC1FD/INC
          INC       PATWMAFD/INC
          INC       PATWR1FD/INC
          INC       PATWVEFD/INC
          INC       PMSEVTFD/INC
          INC       PMSCNOFD/INC
          INC       PMSHATFD/INC
          INC       PMSHCPFD/INC
          INC       PMSSINFD/INC
          INC       PATCMTFD/INC
          INC       PMSCMTFD/INC
          INC       PMSSGAFD/INC
          INC       PMSMTIFD/INC
          INC       PMSMPRFD/INC
          INC       PMSVX1FD/INC
          INC       PRIITMFD/INC
          INC       PATSTAFD/INC
          INC       PATAA1FD/INC
.
          INC       PATCMXFD/INC
          INC       PATAFEFD/INC
          INC       PATASDFD/INC
          INC       PATHDFFD/INC
          INC       PATHLFFD/INC
          INC       PATLDFFD/INC
          INC       PATLSDFD/INC
.
          INC       EMRSITFD/INC
          INC       EMRHISFD/INC
          INC       EMRVISFD/INC
          INC       COMDEPFD/INC
          INC       RCPBNKFD/INC
          INC       RCPDTEFD/INC
          INC       RCPBDTFD/INC
          INC       RCPCONFD/INC
          INC       PMSPBRFD/INC
          INC       PMSIDEFD/INC
          INC       PMSEDGFD/INC       * Effective DRG Dates
          INC       PATDDHFD/INC
.
.               WORK AREA
.
PIPE      INIT      "|"
.
ADMNSTAT  FORM      1
ADAY      DIM       2
AMON      DIM       2
AYER      DIM       2
ACEN      DIM       2
ACCDTE    DIM       8     * accommodation date used in AAECATBI
AECNFTYP  FORM      1
AECNCHRS  FORM      1
ACTION    DIM       1                       * Action for PATAA1FD
ADD       DIM       2                       * Day for PATAA1FD
AMM       DIM       2                       * Month for PATAA1FD
AYY       DIM       2                       * Year for PATAA1FD
ACC       DIM       2                       * Century for PATAA1FD
OPERCODE  DIM       4                       * Operator code for PATAA1FD
.
CSTRTYR   DIM       8
CDYSDAYS  FORM      6                       * CALCDAYS number of days
CDYSFDTE  DIM       8                       * CALCDAYS from date
CDYSTDTE  DIM       8                       * CALCDAYS to date
CDYSYEAR  FORM      2                       * CALCDAYS year
BULKBILL  DIM       1
CODE      DIM       2
CURRDATE  DIM       8
CMDLINE   DIM       80
CMDLIN1   DIM       70
CMDLIN2   DIM       16
CURSESS   DIM       18
CUTDAY    DIM       2
CUTMON    DIM       2
CUTYER    DIM       2
CUTCEN    DIM       2
CALDAYS   FORM      3
CATCR     INIT      "cr"
CODECL    INIT      "CL"
CODEDP    INIT      "DP"
CODEPY    INIT      "Py"
CERTINDC  FORM      1
.
DB        INIT      "DB"
DDDAY     DIM       2
DDMON     DIM       2
DDYER     DIM       2
DDCEN     DIM       2
DIM1A     DIM       1
*DIM3      DIM       3
DIM4      DIM       4
DIM5A     DIM     5
DIM9      DIM       9
DIM11     DIM       11
DIM13     DIM       13
DIM14     DIM     14
DIM18     DIM       18
DIM18A    DIM       18
DIM24A    DIM       24
DIM30     DIM       30
DOCTCODE  DIM       6
DOCFNAME  DIM       50
.
EMCNGINV  DIM       1
EMCNDPOC  DIM       1
EMCNOPOC  DIM       15
EFTDATE   DIM       8         * Effective date (ccyymmdd)
.
FORM3A    FORM      3
FORM5     FORM      5
FIVE9     FORM      "59"
FMTGNAME  DIM       35
FMTTITLE  DIM       10
FMTSNAME  DIM       35
.
HOSPID    DIM       3
HOSPNAME  DIM       50
HINVDES   DIM       30
HESYST    FORM      1
HFHIFUND  FORM      2
.
JYEAR     FORM      2
.
KEY13A    DIM       13
KEYFLAG   FORM      1
.
MBSFLAG   FORM      1
.
PASS      FORM      1
.
OPCNCONS  DIM       1
OPOCFLAG  FORM      1
OPNFLAG   FORM      "0"      * Used in stepdown
OPRDATE   DIM       8
OTCNCFEE  FORM      1
OTCNFTYP  FORM      1
.
STARTDAT  DIM       8
SERVDOCT  DIM       10
SAVAMNT   FORM      12.2
SAVALLW   FORM      12.2
SAVBEND   FORM      3
SAVDISC   FORM      12.2
SAVEXTRA  FORM      12.2
SP12      INIT      "            "
SP14      INIT      "              "
SUROPT    FORM      1
.
TEMPFILE  DIM       8
TFEEIND   FORM      1
THCFLG    FORM      2
THREED    INIT      "3"
TTBILL    FORM      12.2
TTDAYS    FORM      8
TTNETT    FORM      12.2
UNKGST    FORM      1
UPADMTYP  DIM       1
WDATE1    DIM       8
WDATE2    DIM       8
WARNINGL  DIM       20
WBSEUID   DIM       10
ZERO4     INIT      "0000"
ZEROINVC  DIM       1
.
DISCONLY  FORM      1     * discharged only 1=no 0=yes
.
.         Web Variables (only the include files use these variables)
.
DAYFORMT  DIM       4
NJAN      INIT      "January"
NFEB      INIT      "February"
NMAR      INIT      "March"
NAPR      INIT      "April"
NMAY      INIT      "May"
NJUN      INIT      "June"
NJUL      INIT      "July"
NAUG      INIT      "August"
NSEP      INIT      "September"
NOCT      INIT      "October"
NNOV      INIT      "November"
NDEC      INIT      "December"
.
HTMLFILE  FIFO      ASCII, FIXED=250
MTHNAM3   DIM       3
MTHNAM3A  DIM       3
.
CFPAYCOD  DIM       3        * 3M Codefinder PAY Code
.
.
PRGID     INIT      "IBABIL61"
PRGNAM    INIT      "Checking Invoice Pending"
VERSION   INIT      "V12.01.00"
+
.******************************************************************************
.*                              MAIN0000                                      *
.*                  Controlling Logic (Mainline code)                         *
.******************************************************************************
.
MAIN0000  CALL      INIT0000            * Initialisation and open files
.
MAIN1000  CALL      OPTN0000            * Select options
          BRANCH    EXIT,MAIN9999       * EXIT = 1 if 0 chosen in menu
          BRANCH    COPTION,MAIN2000    * Proceed to process
.
          GOTO      MAIN1000            * invalid selection; get again
.
MAIN2000  CALL      KDAT0000
          CALL      CONTQST             * Ok to continue ?
          BRANCH    CEXIT,MAIN5000:     * Yes
                          MAIN2000:     * No; prompt options again
                          MAIN1000      * Cancel
.
MAIN5000  CALL      PROC0000            * Processing
          GOTO      MAIN1000
.
MAIN9999  CHAIN     PGM                 * Chain back to program
+
.******************************************************************************
.*                                INIT0000             Called by: MAIN0000    *
.*                  Display headings and open files                           *
.******************************************************************************
.
INIT0000  CALL      DISPHEAD                      * display heading
          CALL      IBACLOCK
          PACK      CURRDATE,CCC,CYY,CMM,CDD
          REP       " 0",CURRDATE
.
          DISPLAY   *P56:24,"Opening controlf";
          OPEN      CONTROLF,"controlf"
.
          READ      CONTROLF,ZERO;*43,IBCNMHOS,*85,IBCNUGST
          READ      CONTROLF,TEN;*104,PTCNMBSF:                        *C-47385
                                 *217,CAUDQ    * added for V5.01.14 - SRF 105195
          READ      CONTROLF,TEN3;*245,CHOSTYP
          READ      CONTROLF,TEN5;*247,CSTDOWN
          READ      CONTROLF,TEN9;*212,CFEETYP
          READ      CONTROLF,TWENTY;*164,PTRESDAY,*193,PTCNDCLM:
                                    *199,PTCNBCUT,*211,PTCNCNDY
          READ      CONTROLF,TWENTY1;*120,PTCNADDC
          READ      CONTROLF,THIRTY;*200,AECNFTYP
          READ      CONTROLF,THIRTY1;*163,OTCNFTYP,OTCNCFEE
          READ      CONTROLF,FIVE9;*1,CDLSTEP,*5,CREMINV:
                                   *66,CGSTPERC,CGSTITEM
          READ      CONTROLF,SEVENTY7;*214,PTCNBTNM
          READ      CONTROLF,SEVENTY9;*68,PTCNMFEE,PTCNJFEE
          READ      CONTROLF,SEVENTY9;*248,PTCNIPEN
          READ      CONTROLF,EIGHTY8;*162,PTCFEEOF
          READ      CONTROLF,HUND05;*99,PTCNNWCM
          READ      CONTROLF,HUND12;*102,PTCNHITC
.
          DISPLAY   *P64:24,"patmi1af";
          OPEN      PATMI1A1,"patmi1af"
          OPEN      PATMI1A2,"patmi1af"
          OPEN      PATMCHG1,"patmchgf"
.
          DISPLAY   *P64:24,"patma1af";
          OPEN      PATMA1A1,"patma1af"
.
          DISPLAY   *P64:24,"patmx1af";
          OPEN      PATMX1A1,"patmx1af"
.
          DISPLAY   *P64:24,"patcmxaf";
          OPEN      PATCMXA1,"patcmxaf"
.
          DISPLAY   *P64:24,"patcodes";
          OPEN      PATCODE1,"patcodes"
.
          DISPLAY   *P64:24,"patdo1af";
          OPEN      PATDO1A1,"patdo1af"
.
          DISPLAY   *P64:24,"patwr1af";
          OPEN      PATWR1A1,"patwr1af"
.
          DISPLAY   *P64:24,"patdtraf";
          OPEN      PATDTRA1,"patdtraf"
.
          DISPLAY   *P64:24,"pmsmtiaf";
          OPEN      PMSMTIA1,"pmsmtiaf"
          OPEN      PMSMTIA2,"pmsmtiaf"
          OPEN      PMSMTIA4,"pmsmtiaf"
.
          DISPLAY   *P64:24,"pattranf";
          OPEN      PATTRAN2,"pattranf"
.
          DISPLAY   *P64:24,"patdschf";
          OPEN      PATDSCH1,"patdschf"
          OPEN      PATDSCH2,"patdschf"
.
          DISPLAY   *P64:24,"patitemn";
          OPEN      PATITEM1,"patitemn"
.
          DISPLAY   *P64:24,"aaede1af";
          OPEN      AAEDE1A1,"aaede1af"
.
          DISPLAY   *P64:24,"aaedtref";
          OPEN      AAEDTRE1,"aaedtref"
.
          DISPLAY   *P64:24,"outsitaf";
          OPEN      OUTSITA1,"outsitaf"
.
          DISPLAY   *P64:24,"oprardaf";
          OPEN      OPRARDA1,"oprardaf"
.
          DISPLAY   *P64:24,"patvisaf";
          OPEN      PATVISA1,"patvisaf"
.
          DISPLAY   *P64:24,"pmsvx1af";
          OPEN      PMSVX1A1,"pmsvx1af"
.
          DISPLAY   *P64:24,"rcpbdtaf";
          OPEN      RCPBDTA1,"rcpbdtaf"
.
          DISPLAY   *P64:24,"nzpbfeaf";
          OPEN      NZPBFEA1,"nzpbfeaf"
.
          DISPLAY   *P64:24,"nzpcfnaf"
          OPEN      NZPCFNA1,"nzpcfnaf"
.
          DISPLAY   *P64:24,"nzpcmtaf"
          OPEN      NZPCMTA1,"nzpcmtaf"
          OPEN      NZPCMTA2,"nzpcmtaf"
          OPEN      NZPCMTA3,"nzpcmtaf"
.
          DISPLAY   *P64:24,"nzpfigaf"
          OPEN      NZPFIGA1,"nzpfigaf"
          OPEN      NZPFIGA2,"nzpfigaf"
.
          DISPLAY   *P64:24,"nzpfinaf"
          OPEN      NZPFINA1,"nzpfinaf"
          OPEN      NZPFINA2,"nzpfinaf"
.
          DISPLAY   *P64:24,"nzpibraf"
          OPEN      NZPIBRA1,"nzpibraf"
.
          DISPLAY   *P64:24,"nzpmchaf"
          OPEN      NZPMCHA1,"nzpmchaf"
          OPEN      NZPMCHA2,"nzpmchaf"
.
          DISPLAY   *P64:24,"nzppicaf"
          OPEN      NZPPICA1,"nzppicaf"
          OPEN      NZPPICA2,"nzppicaf"
.
          DISPLAY   *P64:24,"nzprbraf"
          OPEN      NZPRBRA1,"nzprbraf"
.
          DISPLAY   *P64:24,"nzprfnaf"
          OPEN      NZPRFNA1,"nzprfnaf"
          OPEN      NZPRFNA2,"nzprfnaf"
.
          DISPLAY   *P64:24,"nzppfeaf"
          OPEN      NZPPFEA1,"nzppfeaf"
.
          DISPLAY   *P64:24,"nzpspraf"
          OPEN      NZPSPRA1,"nzpspraf"
          OPEN      NZPSPRA2,"nzpspraf"
.
          DISPLAY   *P64:24,"nzptfeaf"
          OPEN      NZPTFEA1,"nzptfeaf"
          OPEN      NZPTFEA2,"nzptfeaf"
.
          DISPLAY   *P64:24,"oprdetaf"
          OPEN      OPRDETA1,"oprdetaf"
.
          DISPLAY   *P64:24,"oprdetaf"
          OPEN      OPRDETA2,"oprdetaf"
.
          DISPLAY   *P64:24,"oprsesaf"
          OPEN      OPRSESA1,"oprsesaf"
.
          OPEN      PMSEVTA1,"pmsevtaf"
          OPEN      PATFN1A1,"patfn1af"
          OPEN      PATMCHG1,"patmchgf"
.
          IF        IBCNUGST = TWO
            DISPLAY   *P64:24,"patgtuaf";
            OPEN      PATGTUA1,"patgtuaf"
          ENDIF
.
          DISPLAY   *P64:24,"patipenf";
          OPEN      PATIPEN1,"patipenf"
.
...  used in ABFAECCL
          CALL      TFILENAM                * Get file name calculating Exponent
          MOVE      TFILNAME,FNAMEN
.
...  used in PATCATBI CRMV0000
          CALL      TFILENAM                * Get temp file name
          MOVE      TFILNAME,FNAMEX
.
...  used in PATCATBI PTMP0000
          CALL      TFILENAM                * Get temp file name
          MOVE      TFILNAME,FNAMEZ
.
...  used in PATCATBI PT2P0000
          CALL      TFILENAM                * Get temp file name
          MOVE      TFILNAME,FNAMEY
.
...  used in PABXBILL
          CALL      TFILENAM                * Get temp file name
          MOVE      TFILNAME,PBXFNAME
          CALL      TFILENAM                * Get temp file name
          MOVE      TFILNAME,PBXFNAM2
.
INIT9999  RETURN
.
.******************************************************************************
.*                                OPTN0000             Called by: MAIN0000    *
.*                  Get user options or exit                                  *
.*                                                                            *
.*    Returns:  EXIT    = FALSE (0)  Valid option selected                    *
.*                        TRUE  (1)  Exit option selected                     *
.*              COPTION = 0 Exit                                              *
.*                        1 Run Report                                        *
.******************************************************************************
.
OPTN0000  DISPLAY   *P1:3,*EF,*P1:4,*V2LON,ZERO,*HOFF," = Exit":
                    *P1:5,*V2LON,ONE,*HOFF," = Run Report"
.
OPTN1000  KEYIN     *P1:8,*EL,"Select option : ",*DV,UNDLN1:
                    *P17:8,*V2LON,COPTION
.
          COMPARE   ZERO,COPTION
          GOTO      OPTN9500 IF EQUAL             * exit
.
          BRANCH    COPTION,OPTN9000
.
.         BEEP
.         GOTO      OPTN1000
.
OPTN9000  MOVE      ZERO,EXIT
          GOTO      OPTN9999
.
OPTN9500  MOVE      ONE,EXIT
.
OPTN9999  RETURN
+
.******************************************************************************
.         Processing
.******************************************************************************
PROC0000
          DISPLAY   *P1:24,*EL,*P20:24,"Admission No :":
                    *P55:24,"Scanning :";
.
          CALL      HEAD0000
.
          MOVE      SP70,DDATE
          MOVE      TWO,ADMNSTAT           * Current patients
          CALL      ADMN0000
.
          MOVE      FOUR,ADMNSTAT          * On leave patients
          CALL      ADMN0000
.
.         Discharges
.
          PACK      KEY16 WITH STARTDAT,SP8
          CALL      RDSDSCH2
PROC1000  CALL      RDKDSCH2
          BRANCH    OVRCD OF PROC9999
.
          DISPLAY   *P62:24,DADMNO;
.
          MOVE      DADMNO,KEY8
          CALL      RDMISS1
          BRANCH    OVRCD,PROC1000
.
          CALL      EXNB0000                  * Excluded newborn
          BRANCH    EXIT,PROC1000
.
          CALL      RDVISA1
          BRANCH    OVRCD,PROC1000
.
          MOVE      AURNO,KEY8
          CALL      RDMAST1
          BRANCH    OVRCD OF ADMN1000
.
          MOVE      ZERO,DISFLG
          CALL      CREC0000                 * processing admission
          GOTO      PROC1000
.
PROC9999  RETURN
+
.******************************************************************************
.       Get the current/on leave/discharge patients
.******************************************************************************
ADMN0000  MOVE      SP70,DDATE
          MOVE      ONE,DISFLG
          PACK      KEY9 WITH ADMNSTAT,SP8
          CALL      RDSMISS2
ADMN1000  CALL      RDKMISS2
          BRANCH    OVRCD OF ADMN9999
.
          DISPLAY   *P66:24,AADMNO;
.
          COMPARE   ADMNSTAT,ASTAT
          GOTO      ADMN9999 IF NOT EQUAL
.
          MOVE      AADMNO,KEY8
          CALL      RDMISS1
          BRANCH    OVRCD,ADMN1000
.
          CALL      EXNB0000                  * Excluded newborn
          BRANCH    EXIT,ADMN1000
.
          CALL      RDVISA1
          BRANCH    OVRCD,ADMN1000
.
          MOVE      AURNO,KEY8
          CALL      RDMAST1
          BRANCH    OVRCD OF ADMN1000
.
          CALL      CREC0000                 * processing admission
          GOTO      ADMN1000
.
ADMN9999  RETURN
+
.******************************************************************************
.         Checking if Patient to be invoiced
.******************************************************************************
CREC0000  MOVE      PSNAME,PACSNAME
          MOVE      PGNAME,DIM1
          PACK      PACGNAME,DIM1,SP20
          MOVE      PTITL,PACTITLE
          MOVE      ONE,PACFRMT
          CALL      PACNAME
.
          MOVE      ONE,PROGFLAG
          MOVE      ZERO,TOTDAYS
          CALL      CALCTBI
          MOVE      NETTOT,GROSSTOT
          MOVE      AADMNO,KEY8
.
          COMPARE   ZERO,GROSSTOT
          GOTO      CREC4000 IF NOT EQUAL
.
          CALL      RDIPEN1
          IF        OVRCD=0
             PRINT     *26,AADMNO,*52,PACFNAME
          ENDIF
          GOTO      CREC9999
.
CREC4000  CALL      RDIPEN1
          IF        OVRCD=1
             PRINT    *1,AADMNO,*52,PACFNAME
          ENDIF
.
CREC9999  RETURN
+
.******************************************************************************
.         Header
.******************************************************************************
HEAD0000  CALL      HEAD132
.
          PRINT     *N,"Missing Admission",*26,"Admission":
                    *N,"from Inv pending",*26," No Charge "
.
HEAD9999  RETURN
+
.******************************************************************************
.         Keyin from date
.******************************************************************************
KDAT0000  MOVE      "21",CCOL
          MOVE      "14",CVERT
          DISPLAY   *P1:14,"From Date: "
          MOVE      CCC,CCENT
          UNPACK    SP6,CYEAR,CMON,CDAY
          CALL      KEYDATE                 * Keyin date
          BRANCH    OVRCD,KDAT9999
.
          PACK      STARTDAT,CCENT,CYEAR,CMON,CDAY
          REP       " 0",STARTDAT
.
KDAT9999  RETURN
+
.
.         IO includes
.
          INC       STD001IO
          INC       AAECATBI
          INC       AAEDE1IO/INC
          INC       AAEDTRIO/INC
          INC       CALCAGE
          INC       CLNZPPIC
          INC       EXCLNEWB
          INC       IBAGEDIO/INC
          INC       IBAGSTIO/INC
          INC       IBAPASIO/INC
          INC       IBASECIO/INC
          INC       IBATMDIO/INC
          INC       NHIMASIO/INC
          INC       MLTCFNIO/INC

          INC       NZPBFEIO/INC
          INC       NZPCFNIO/INC
          INC       NZPCMTIO/INC
          INC       NZPEXTIO/INC
          INC       NZPRDTIO/INC
          INC       NZPFIGIO/INC
          INC       NZPIBRIO/INC
          INC       NZPMCHIO/INC
          INC       NZPMXCIO/INC
          INC       NZPPFEIO/INC
          INC       NZPPICIO/INC
          INC       NZPRBRIO/INC
          INC       NZPRFNIO/INC
          INC       NZPFINIO/INC
          INC       NZPSPRIO/INC
          INC       NZPTFEIO/INC
          INC       NZPIVBIO/INC
          INC       NZPRVBIO/INC

          INC       OPRDEAIO/INC
          INC       OPRSESIO/INC
          INC       OUTCATBI
          INC       OUTBOAIO/INC
          INC       OUTBB1IO/INC
          INC       OUTDTRIO/INC
          INC       OUTSITIO/INC
          INC       PATCATBI
          INC       PATCODDS
          INC       CHKCMXPT                * Check if casemix & get epis type
          INC       PATCMSTP
          INC       PATGNCMX
          INC       CMGETTHR
          INC       CMXMATRX
          INC       NHOSPDAY
          INC       CALCDAYS
          INC       PABXBILL
          INC       PATCOMN3
          INC       PATIVMES
          INC       CLPATDTR                * Clear DTR file variables
          INC       PATHSPKY
          INC       PRBILCMN
          INC       PATMCHRD
          INC       PATITMRD
          INC       GETCNEFF
          INC       GETBFEES
          INC       GETTFEES
.
          INC       PATAFEIO/INC       * for casemix
          INC       PATASDIO/INC
          INC       PATCMXIO/INC
          INC       PATHDFIO/INC
          INC       PATHLFIO/INC
          INC       PATLDFIO/INC
          INC       PATLSDIO/INC
.
          INC       PATELGIO/INC
          INC       PATBFEIO/INC
          INC       PATTFEIO/INC       *theatre fee
          INC       PATCODIO/INC
          INC       PMSCIDIO/INC
          INC       PMSCCDIO/INC
          INC       PATCFAIO/INC
          INC       PATCTFIO/INC
          INC       PATDGWIO/INC
          INC       PATDO1IO/INC
          INC       PATDSCIO/INC
          INC       PATDTRIO/INC
          INC       PATDRGIO/INC
          INC       PATECDIO/INC
          INC       PATECOIO/INC
          INC       PATGTUIO/INC
          INC       PATRE1IO/INC
          INC       PATHSPIO/INC
          INC       PATHTRIO/INC
          INC       EMRHTRIO/INC
          INC       OUTHTRIO/INC
          INC       PATFINIO/INC
          INC       PATFMOIO/INC
          INC       PATFX1IO/INC
          INC       PATFN1IO/INC
          INC       PATFN2IO/INC
          INC       PATIBLIO/INC
          INC       PATICUIO/INC
          INC       PATIN1IO/INC
          INC       PATINMIO/INC
          INC       PATINVIO/INC
          INC       PATIOVIO/INC
          INC       PATIPEIO/INC
          INC       PATITMIO/INC
          INC       PATMA1IO/INC
          INC       PATMCHIO/INC
          INC       PATMI1IO/INC
          INC       PATOVBIO/INC
          INC       PATPGRIO/INC
          INC       PATRBLIO/INC
          INC       PATRCAIO/INC
          INC       PATRATIO/INC
          INC       PATSRBIO/INC
          INC       PATTRNIO/INC
          INC       PATVENIO/INC
          INC       PATVISIO/INC
          INC       PATWC1IO/INC
          INC       PATWMAIO/INC
          INC       PATWR1IO/INC
          INC       PATWVEIO/INC
          INC       PMSEVTIO/INC
          INC       PMSCNOIO/INC
          INC       PMSHATIO/INC
          INC       PMSHCPIO/INC
          INC       PMSSINIO/INC
          INC       PATCMTIO/INC
          INC       PMSCMTIO/INC
          INC       PMSSGAIO/INC
          INC       PMSMTIIO/INC
          INC       PMSMPRIO/INC
          INC       PMSVX1IO/INC
          INC       RCPBNKIO/INC
          INC       RCPBDTIO/INC
          INC       OPRARDIO/INC
          INC       PRIITMIO/INC
.
          INC       PATAA1IO/INC
          INC       PATSTAIO/INC
          INC       IBASEQIO/INC            * Sequential Numbers File
          INC       WEBERRIO/INC            * Web Server Error Logging
          INC       EMRSITIO/INC
          INC       EMRHISIO/INC
          INC       EMRVISIO/INC
          INC       COMDEPIO/INC
          INC       RCPDTEIO/INC
          INC       PMSPBRIO/INC
          INC       PMSIDEIO/INC
          INC       PMSEDGIO/INC       * Effective DRG Dates
          INC       PATDDHIO/INC
          INC       CLPMSIDE
          INC       STEPDOWN
          INC       VALCMXFN
          INC       ICDSCLAS
          INC       PATSELFN
          INC       TFILENAM                * Generate Temp File Name
          INC       GETEFDRG
.
SBDY0000
PATSTRYR
ADDWRN00
WRITETRN
GETTHR
PATCALF
TAIL
INITIVAR
PRTEOL
PROCMISC
PRTCLMS
NXTTRAN1
WEBERR00
PRTINVTL
SINVT000
DOCNM000
PEOL0000
IPRH0000
PRLN0000
ENDPRT00
PROACC00
CKTL0000
PRTIPROV
ENDPRT    RETURN
.
