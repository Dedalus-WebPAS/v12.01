.----------------------------------------------------------------------
. Program       : HICWEB01
.
. Function      : HIC Claims Web server 
.
. Modifications : 
.----------------------------------------------------------------------
. V11.04.02 27.06.2024  DA Sarkies     TSK 0948535
.           Recompiled for PATMSXTM    
. V11.04.01 18/12/2023  Thanh T        TSK 0906342
.           Added Clear OTMAPCOD field
. V11.02.01 09/02/2022 Thanh T         TSK 0905641
.           Added Additional HCP Code (1-4) for outma1af
. V11.00.02 09/12/2020  Thanh T        TSK 0872840
.           Added PMSCCDFD/PMSCCDIO as PMSPX2TM changes
. V11.00.01 26/10/2020  Don Nguyen     TSK 0896454
.           Fixed HTML table heading layout for 'Unbatched Claims for Provider' .           list (HDBT0000).
. V10.14.03 09/09/2019  Ebon Clements  Task 0863500
.           Added patient folder colour to claims list - CBTC0000 - BDET0000
. V10.14.02 12/07/2019  Ebon Clements  Task 0877982
.           Changed srchsdoc to a DIM 10
. V10.14.01 13/06/2018  J.Tan          Task 0875795
.           Recompiled HICCLAIM - Provider number for Actual doctor seen
. V10.13.02 05/12/2018  Don Nguyen     TSK 0838558
.           Deleted temp file (VSCTTFIL) after processing.
.           Moved temp file creation (CLRVCM00) to comments processing section
.           (vicmt006) rather than on server startup.
. V10.13.01 30/07/2018  Richa Phogat     TSK 0848506
.           Updated keylength for RSPRDO3, RKPRDO3, RSPRDO1 
.           Changed PP Doctor from DIM6 to DIM10
. V10.11.03 27/11/2017  Thanh Tieu     Task 0821710
.           Recompiled as PATMASTM changed
. V10.11.02 21/09/2017  Thanh T.       TSK 0821710
.           Removed PATCMNFD/IO since it is not used            
. V10.11.01 30/07/2017  Thanh T.       TSK 0821710
.           Audit admission/outpatient/UR comments. changed PATMASTM/PMSPX2TM.
.           02/08/2017  J.Tan          TSK 0837619
.           Mod to use CLPRIHTR - clear prihtraf fields
.----------------------------------------------------------------------
. V10.09.01 27/01/2017  Ebon Clements  TSK 0828785
.           Recompiled for ALLREFTM - OP Site selection list security test
. V10.08.01 18/04/2016  Peter Vela     TSK 0294177
.           Changed read to prihdb to KEY27
. V10.06.04 11/08/2915  Ania P         CAR 319861
.           Recompile for ALLREFTM
. V10.06.03 12/05/2015  Ebon Clements     CAR 303890
.           Added ALLPROFD and open
. V10.06.02 31/03/2015  Peter Vela        CAR 298921
.           Recompiled for HICCLAIM
.           Changed OTBBADCS to PMSHCP functionality
. V10.06.01 12/03/2015  Steve Armstrong   CAR 314108
.           Removed definition of PTCGDATE as PATCGPFD is no longer in
.           use
.----------------------------------------------------------------------
. V10.05.01 21/10/2014  Ebon Clements  CAR 268970
.           Change to use OUTCLIFD index 1 instead of index 2
.----------------------------------------------------------------------
. V10.04.02 07/04/2014  Peter Vela      CAR 286258
.           Recompiled for PATMASTM
. V10.04.01 31.03.2014  B.G.Ackland  CAR 299363
.           Replace META Tag Redirect with Javascript in Common RDIREC00
.           Routine
.----------------------------------------------------------------------
. V10.03.09 02/10/2013  Peter Vela        CAR 291757
.           Recompiled for ALLREFTM
. V10.03.08 30/07/2013  Ebon Clements    CAR 283202
.           Recompiled for PMSPX2TM - Preferred method of contact
. V10.03.07 30/06/2013  Davin             CAR 283202
.           Recompiled for changes to hl7 messaging
. V10.03.06 30/06/2013  Davin             CAR 279183
.           Recompiled for changes to hl7 messaging (allquefd)
. V10.03.05 03/05/2013  Steve Armstrong   CAR 284376
.           Recompiled for changes to DGCLICUP.
. V10.03.04 29/04/2013  Ebon Clements     CAR 261630
.           Removed port number from temp file name
. V10.03.03 03/04/2013  Davin          CAR 270648
.           Recompiled for changes to HL7 messaging includes
. V10.03.02 30/11/2012  Peter Vela      CAR 262297
.           Update pmsvx1af Last Updated User/Data/Time on update of 
.           outbb1af
. V10.03.01 16/01/2012  Sandra Barcham  CAR 256563
.           Recompiled for PATMASTM
.----------------------------------------------------------------------
. V10.02.02 10/07/2011  Ebon Clements     CAR 242070
.           Recompiled for ALLREFTM - Referral hospital
. V10.02.01 22/03/2011  Jill Parkinson    CAR 239574
.           Increased printer variables
. V10.00.01 02/02/2010  Steve Armstrong   CAR 135505
.           Added DGCLII13 trigger
.           Also added HL7TRGID & HL7INCLD setting for all broadcast messages
.----------------------------------------------------------------------
. V9.11.02 15/01/2009   J.Tan          CAR 169230
.          Mods for Resubmit opt.to be avail.after batch being Ack.
. V9.11.01 01/12/2008   J.Tan          CAR 147174
.          Mods displaying clinic for Unbatched claim by batch no
.----------------------------------------------------------------------
. V9.09.02 02/04/2008   J.Tan          CAR 164877
.          Mods reset batch - must be for Status of Extract only
. V9.09.01 12/09/2007   J.Tan          CAR 149651
.          Mods re-submit for Claim not fully paid/Rejec.amt only
.----------------------------------------------------------------------
. V9.08.02 31/01/2007   Peter Vela     CAR 127930
.          Recompiled for MRTMASFD
. V9.08.01 08/12/2006   J.Tan             CAR 123345
.          Fixed Batch amount
.----------------------------------------------------------------------
. V9.07.04 10/08/2006   J.Tan             CAR 115581
.          Fixed initialising hiccitaf for re-subm item
. V9.07.03 04/08/2006   J.Tan             CAR 114258
.          Recompiled for HICCLAIM-init batch no previously batched
. V9.07.02 24/07/2006   J.Tan             CAR 113531
.          Recompiled for HICCLAIM - init adjm amount
. V9.07.01 13/07/2006   J.Tan             CAR 110208
.          Mods to initilise adjustment amount for hiccitaf file
.----------------------------------------------------------------------
. V9.06.01 24/05/2006   J.Tan             CAR 98180
.          Mods My HIC batch to display by batch status
.----------------------------------------------------------------------
. V9.05.05 13/04/2006   J.Tan             CAR 99132
.          Added a new button to place claim on hold
. V9.05.04 13/04/2006   J.Tan             CAR 93982
.          Added new field for Batch No previously batched
. V9.05.03 12/04/2006   J.Tan             CAR 99609
.          Added an option for Re-Extract
. V9.05.02 10/04/2006   J.Tan             CAR 96023
.          Added printing Internal Referral
. V9.05.01 31/03/2006   J.Tan             CAR 98180
.          Mods to default to EFT payment status for My HIC Batch
.----------------------------------------------------------------------
. V9.05.B10 01/03/2006  Ebon Clements     CAR 87422
.          Added tag CLMM3700 and added clinic id default from 
.          user id to LBTC0000
. V9.05.B09 21/02/2006  J.Tan             CAR 96067
.          Added Searh for Medical practice and Service doctor
.          Fixed call stack overflow
. V9.05.B08 20/02/2006  Ebon Clements     CAR 76341
.          Added referral file audit
. V9.05.B07 01/02/2006  J.Tan             CAR 93539
.          Fixed problem changing claim to be On hold 
. V9.05.B06 30/01/2006  Ebon Clements CAR 93186
.          Mods for REDIRECT length change. Recompiled for IBAWEBDF
. V9.05.B05 12/01/2006  J.Tan             CAR 77215
.          Mods to Adjustment/Writeoff
. V9.05.B04 22/12/2005  J.Tan             CAR 77215
.          Fixed icons for Adjustment/Writeoff
. V9.05.B03 19/12/2005  J.Tan             CAR 77215
.          Mods to write off/adjustment
. V9.05.B02 07/12/2005  Davin S           CAR 87257
.          Added 'gp suburb' tag (argp0000) to display hcp/practice
.          suburb from the patient pmi (display on referral page)
. V9.05.B01 01/12/2005  J.Tan             CAR 77215
.          Recompiled for HICCLSRV - user id for batch history
. V9.04.63 30/11/2005   J.Tan             CAR 77215
.          Fixed spelling error EFP to EFT
.          Fixed checking if generated batch no already exists
. V9.04.62 29/11/2005   J.Tan             CAR 77215
.          Fixed outstanding amount
. V9.04.61 29/11/2005   Davin S           CAR 86572
.          Added broadcast PMI update message calls (dgclicup)
. V9.04.60 22/11/2005   J.Tan             CAR 85383
.          Mods to write to History file for first time batching
. V9.04.59 17/11/2005   J.Tan             CAR 77215
.          Mods to batch status 
. V9.04.58 24/10/2005   J.Tan             CAR 77215
.          Mods to filter by Received date for My HIC batch list
. V9.04.57 19/10/2005   J.Tan             CAR 77215
.          Fixed amount for Total adjustments
. V9.04.56 05/10/2005   J.Tan             CAR 77215
.          Fixed displaying error list
. V9.04.55 29/09/2005   J.Tan             CAR 77215
.          Mods checking for payment/reject.from Exception file
.          if batch status is 'Received'
. V9.04.54 22/09/2005   J.Tan             CAR 77215
.          Mods Action to change status to 'Payment Received' if
.          record found in hicefc file
. V9.04.53 14/09/2005   J.Tan             CAR 76105
.          Added button for All Exclude on unbatch claim list 
. V9.04.52 17/08/2005   J.Tan             CAR 76105
.          Recompile for HICPRCLM - mods to consolidation report
. V9.04.51 08/09/2005  Ebon Clements CAR 71363
.          Added default printer update to print batch - PRTBTC00
.          Changed report 4 to use NXTPAG00                       
. V9.04.50 31/08/2005  J.Tan  CAR 72462
.          Mods change header to regenerate voucher number
. V9.04.49 11/08/2005  J.Tan  CAR 71173
.          Mods for Reconciliation spec.
.          Mods Batching to generate voucher number
. V9.04.48 22/08/2005  J.Tan  CAR 71442
.          Mods Batching to update comments
.          Recompiled for HICPRCLM - mods to payee name
. V9.04.47 17/08/2005  J.Tan  CAR 71442
.          Recompiled for HICPRCLM - mods to consolidation report
. V9.04.46 15/08/2005  Davin  CAR 71442
.          Recomplie for HICPRCLM - mods to consolidation report
.          16/08/2005  J.Tan  CAR 71442
.          Mods batching to print DB1 form 
. V9.04.45 10/08/2005  J.Tan  CAR 69062
.          Mods reset batch to clear voucher number
. V9.04.44 10/08/2005  J.Tan  CAR 69062
.          Recompiled for HICCLAIM - checking for blank payee prov.
. V9.04.43 09/08/2005  J.Tan  CAR 71173
.          Added option for actioned
. V9.04.42 09/08/2005  J.Tan  CAR 69062
.          Mods Change Header to update blank payee provider
. V9.04.41 05/08/2005  J.Tan  CAR 69062
.          Recompiled for HICCLAIM -Checking for existing claim no.
. V9.04.40 01/08/2005  J.Tan          CAR 69062
.          Change claim index 7 to include voucher no
. V9.04.39 29/07/2005  J.Tan          CAR 69403
.          Mods after batching not to do the extraction 
. V9.04.38 28/07/2005  J.Tan          CAR 69403
.          Added supervisor function to change payee/service prov.
. V9.04.37 21/07/2005  J.Tan          CAR 67726
.          Change batch date to current when doing Reset batch
. V9.04.36 21/07/2005  Davin          CAR 68623
.          Changed shic0000 routine to spool extract report & pass 
.          selected printer to ibahic03 as a keyin.
.          Retain default printer when creating batch/extract
. V9.04.35 15/07/2005  J.Tan          CAR 67726
.          Reset batch status after checking batch status routine
. V9.04.34 11/07/2005  Davin          CAR 66638
.          Fixed to retain practice as well as usual gp
.          11/07/2005  Davin          CAR 66767
.          Recompiled for HICCLSRV - Fixed extract filename
. V9.04.33 07/07/2005  J.Tan          CAR 64493 
.          Recompiled for HICPRCLM - Fixed printing format prov
. V9.04.32 07/07/2005  J.Tan          CAR 66498
.          Fixed reprint claim if MCI/Payee/Provider has changed
. V9.04.31 06/07/2005  Ebon Clements  CAR 66119
.          Added update of outpatient actual doctor seen
. V9.04.30 01/07/2005  J.Tan
.          Recompiled for HICCLAIM - 85% of claim amount
. V9.04.29 30/06/2005  J.Tan          CAR 64296
.          Allow to keyin amount received manually and set
.          batch status to 'Received ok' manually
. V9.04.28 29/06/2005  Davin          CAR 64993
.          Display total on 'claims list to batch' (cbtc0000)
. V9.04.27 29/06/2005  Davin          CAR 56701
.          Added print of claim form to report 1 (HICCLM00, 
.          updatety=P)
. V9.04.26 28/06/2005  Ebon Clements  CAR 64974
.          Added print of claim form to report 3 UCLM0000  
. V9.04.25 24/06/2005  J.Tan          CAR 56701
.          Mods reseting batch to clear rejected,adjust amount
. V9.04.24 22/06/2005  J.Tan          CAR 64295
.          Mods checking for Referral provider number
. V9.04.23 08/06/2005  J.Tan          CAR 56701
.          Added claim number to prihtraf file
.          10/06/2005  Davin          CAR 62381,56698
.          Added items 12 & 13 to batch list (lbtc0000)
.          Added hic batch error list tag (berr0000)
.          Moved DB1N printing (schedule from ibahic03)
. V9.04.22 07/06/2005  Davin         CAR 62379
.          Fixed to setup batchkey before printing DB1
. V9.04.21 07/06/2005  Davin         CAR 62379
.          Changed 'reason for rejection' tag (clmm1600) to use 
.          new table hicemsfd instead of category HD
. V9.04.20 02/06/2005  Davin         CAR 56698
.          Mods for printing DB1N HIC Claim Form
.                       J.Tan         CAR 56701
.          Recompiled for HICCLMTM - claim status
. V9.04.19 02/06/2005  J.Tan         CAR 56701
.          Mods for printing batch
. V9.04.18 23/05/2005  Ebon Clements CAR 62018
.          Recompiled for ALLRITFD - added provider usage
. V9.04.17 19/05/2005  J.Tan         CAR 56699
.          Added new batch status
. V9.04.16 18/05/2005  Ebon Clements CAR 62018
.          Added provider name tag CLMM2500
.          Added provider name to CLUR0000 claim list by ur
.          16/05/2005  J.Tan         CAR 56699
.          Added option to reset batch
. V9.04.15 11/05/2005  J.Tan         CAR 61381
.          Mods batch status
. V9.04.14 11/05/2005  J.Tan         CAR 61440
.          Added new field adjustment amount to hic files
. V9.04.12 10/05/2005  Ebon Clements       CAR 61466
.          Changed UCLM0000 to update the referral if no
.          claim has been printed
. V9.04.11 10/05/2005  J.Tan               CAR 61440
.          Added resubmitted amount to claims details for batch
. V9.04.10 09/05/2005  J.Tan               CAR 61466
.          Mods batching for attended outpatient only
. V9.04.09 09/05/2005  J.Tan               CAR 61381
.          Highlight red if no referral details
. V9.04.08 05/05/2005  J.Tan               CAR 61381
.          No batching if no medicare and referral details
. V9.04.07 04/05/2005  Ebon Clements       CAR 61122
.          Only update PMPXRHC1 if the referring HCP is a type GP
. V9.04.06 03/05/2005  J.Tan               CAR 61291
.          Mods to display booking time for unbatched claims list
.          Mods to link parameter for referral update
. V9.04.05 02/05/2005  J.Tan               CAR 6112
.          Mods checking for use access to all medprac (prialsaf)
. V9.04.04 22/04/2005  Ebon Clements       CAR 56697
.          Added report 3 update claim details
. V9.04.03 21/04/2005  J.Tan               CAR 56699
.          Added Resubmit
. V9.04.02 18/04/2005  Ebon Clements       CAR 56699
.          Added HICHISFD batch status history
.                       J.Tan
.          Added Claim status
. V9.04.01 11/04/2005  Ebon Clements       CAR 56670
.          Added claim comments
. V9.04.00 24/02/2005  J.Tan  
.          Created Web Server.
.----------------------------------------------------------------------
          INC       IBAWEBDF    
          INC       WEBDATDF
          INC       RSHWEBDF
          INC       ROUNDUP5/INC
          INC       ALLAEFFD/INC
          INC       ALLENCFD/INC
          INC       ALLERCFD/INC
          INC       ALLQUEFD/INC
          INC       APSMASFD/INC
          INC       HL7CISFD/INC
          INC       HL7INBFD/INC
          INC       MLTSECFD/INC
          INC       MLTSITFD/INC
          INC       PATCALAG/INC
          INC       PATDO1FD/INC   * Doctor File
          INC       PATMI1FD/INC
          INC       PATDSCFD/INC
          INC       PATMA1FD/INC
          INC       PATVISFD/INC   * Patients Visits File
          INC       PMSVX1FD/INC   * Visit Extension File
          INC       PATCONFD/INC
          INC       PATALRFD/INC
          INC       OUTSITFD/INC
          INC       OUTMA1FD/INC
          INC       OUTCLIFD/INC       * Clinic Ids
          INC       OUTCTYFD/INC        * Clinic Types
          INC       OUTBITFD/INC
          INC       OUTBOAFD/INC
          INC       OUTBB1FD/INC
          INC       OUTLPCFD/INC 
          INC       PMSUCHFD/INC
          INC       PMSUCDFD/INC
          INC       PATMASTD/INC
          INC       PATHSPFD/INC
          INC       PATPR1FD/INC
          INC       PMSPX2FD/INC
          INC       PATFN1FD/INC
          INC       PATIN1FD/INC
          INC       PATNIDFD/INC
          INC       PATWR1FD/INC
          INC       PATVADFD/INC
          INC       PMSPX2TD/INC
          INC       PATRE1FD/INC
          INC       PATDGWFD/INC
          INC       PRIITMFD/INC
          INC       PRIEXCFD/INC
          INC       PRIDOCFD/INC
          INC       PRISECFD/INC
          INC       PRIALSFD/INC
          INC       PMSHCGTD/INC
          INC       PMSHCGFD/INC
          INC       PMSHCLFD/INC
          INC       PMSHCPFD/INC
          INC       PMSQPTFD/INC
          INC       NHIETHFD/INC
          INC       NHIMASFD/INC
          INC       MRTMASFD/INC
          INC       PMSHCPTD/INC
          INC       PRIPRAFD/INC
          INC       TFILEVAR/INC
.
          INC       VISCMTDF
          INC       VISCMTFD/INC            * visit comments file
.
          INC       BOKRC1FD/INC
          INC       ALLCONFD/INC
          INC       ALLREFFD/INC
          INC       ALLCASFD/INC
          INC       ALLRITFD/INC
          INC       ALLLNKFD/INC
          INC       ALLDIAFD/INC
          INC       ALLPROFD/INC
          INC       ALLPRRFD/INC
          INC       HICCLMFD/INC
          INC       HICCITFD/INC
          INC       HICBTCFD/INC
          INC       HICBCNFD/INC
          INC       HICEMSFD/INC
          INC       HICERRFD/INC
          INC       HICHISFD/INC
          INC       HICRCIFD/INC
          INC       HICEFCFD/INC
.
          INC       PMSCCDFD/INC            * Concession Card Details
          INC       PRIHREFD/INC
          INC       PRIHDBFD/INC
          INC       PRIHTRFD/INC
          INC       ALLREFTD/INC
.
.----------------------------------------------------------------------
EXTRFILE  FILE      ASCII, FIXED=53      * file length is irrelevant as we
.                                          only need to know if it exists
.         Temporary File Definition- for batch items
.         -------------------------
.
.         Filename : hicwebxx.dat          (xx = port id)
.
ITMTEMPB  IFILE SQL, FIXED=40, KEY="U1-8,9-16,17-21,22-27,28-29"
.
.NAME     TYPE    LENGTH     PHYSICAL     START     DESCRIPTION
.----     ----    ------     --------     -----     -----------
.URNUMBER DIM       8           8           1       U/R Number
CLAIMNUM  DIM       8           8           9       Claim Number
ITMNUMBR  DIM       5           5          17       Item Number
SERVDATE  DIM       6           6          22       Date of Service (yymmdd)
DICOUNTR  DIM       2           2          28       Item Counter
VISITNUM  DIM       8           8          30       Visit Number
TITEMCNT  DIM       2           2          38       Item Count

.End of Record                             40
.
.Redefine FORM fields from key
.-----------------------------
ICOUNTER  FORM      2
.
AMBSFLAG  FORM      1
ALRIT001  DIM       2
ALRIT002  DIM       9
ALRIT003  DIM       3
ALRIT004  DIM       2
ALRIT005  DIM       9
ALRIT006  DIM       3
ALRIT007  DIM       2
ALRIT008  DIM       9
ALRIT009  DIM       3
ALRIT010  DIM       2
ALRIT011  DIM       9
ALRIT012  DIM       3
ALRIT013  DIM       2
ALRIT014  DIM       9
ALRIT015  DIM       3
ALRIT016  DIM       20                      * Item 1 provider usage
ALRIT017  DIM       20                      * Item 2 provider usage
ALRIT018  DIM       20                      * Item 3 provider usage
ALRIT019  DIM       20                      * Item 4 provider usage
ALRIT020  DIM       20                      * Item 5 provider usage
ADJREAS   DIM       3
EXPRICON  DIM       1       * ExpiryIconX.gif
BATCHKEY  DIM       33
BTCHDATE  DIM       8
BTCHPNUM  DIM       5
BLNKFLAG  FORM      1
BTCHFLAG  DIM       1
BTCHNUMB  DIM       5
CISMFLAG  FORM      1
GNXBFLAG  FORM      1
CMDLINE   DIM       80
CLAIMCNT  FORM      3
CLMNNUMB  DIM       8
CLMCOUNT  FORM      3
CLAIMPRT  DIM       1       * Print Indicator - Medicare Claim
CLAIMPSL  DIM       6       * Printer Selected - Medicare Claim
CMBSFLAG  FORM      1
BTCERFLG  DIM       1
BTCERLNK  DIM       127
DEPTCODE  DIM       3
MESSAGID  DIM       20
NEXTFLAG  FORM      1
NEWCLAIM  DIM       8
NEWBATCH  DIM       5
DISPSTAT  DIM       20      * Display batch status
DRECCNT   DIM       3
DIM9      DIM       9
BTCHSTAT  DIM       2
IBAMFLAG  FORM      1
REFSTAT   DIM       10
REFPROV   DIM       20
REJREAS   DIM       3
MASUPDFL  FORM      1
NEXTPAGE  DIM       1       * Nextpage parameter CGI parameter
NMPNUMB   DIM       20
PRNTTYPE  FORM      1
REDIREC2  DIM       240
RECCNT    FORM      3
RESUBAMT  FORM      12.2    * Resubmitted amount
SETDFPRG  DIM       8
SETDFRPT  FORM      2
UPDATETY  DIM       1       * Update Type
SAVESTAT  DIM       2       * Save batch status for history
SAVREPTN  FORM      2
SAVKEY28  DIM       28
SAVPRGID  DIM       8
STARTKEY  DIM       10      * Starting Key
SITECODE  DIM       6
SKEY10    DIM       10
SKEY18    DIM       18
SKEY22    DIM       22
SKEY28    DIM       28
SAVCLAIM  DIM       8
SAVEURNO  DIM       8
.
CLMNBTCH  DIM       5       * Batch Number
CFILEPRE  DIM       3       * Current Open File Prefix for Outpatient Files
CURRDATE  DIM       8       * Current Date
CASEKEYS  DIM       28
CLAIMKEY  DIM       8[999]
DOCTCODE  DIM       8
.
EXTRNAME  DIM       127
FORM12P2  FORM      12.2
FOLDERSF  DIM       3                       * Folder Icon Suffix
FORM8P4   FORM      8.4
FORM2A    FORM      2
FORM8     FORM      8 
FORM3     FORM      3 
.
HEADSEC   FORM      5
HCBTC001  DIM       2
HCBTC002  DIM       3
HCBTC003  DIM       10      * Payee provider
HCBTC004  DIM       6       * Medical practice
HCBTC005  DIM       10      * Service provider
HCBTC006  DIM       10      * Sevice doctor
.
HCCLM001  FORM      12.2    * Rejected amount
HCCLM002  DIM       3       * Reason for rejection
.
HCCLM003  FORM      12.2    * Write Off amount
HCCLM004  DIM       3       * Reason for Write Off
.
HCCLM005  DIM       1       * Claim Status
HCCLM006  FORM      12.2    * Adjustment amount
HCCLM007  DIM       3       * Reason for Adjustment
.
HCCLM008  DIM       8       * Received date
HCCLM009  FORM      12.2    * Received amount
.
KEYINDAT  DIM       8
REFRNUMB  DIM       8
RESUB     DIM       1[999]
ITEMKEYS  DIM       18
ITMCOUNT  FORM      2
PRCNRDOC  FORM      1
PSAGETYP  DIM       3
LETTNCOD  FORM      3
STATNCOD  DIM       6       * Stationary Code Coded Field
LOOPFLAG  FORM      1
LINKKEY   FORM      2
MBSDESC   DIM       70
MULTFLG   FORM      1
VCHCOUNT  FORM      2
.
OUTPATH1  INIT      "sent"
OUTPATH2  INIT      "ack"
OUTPATH3  INIT      "nack"
.
OUTBB031  DIM       10       Actual Doctor Seen
.
OTBIT001  DIM       2
OTBIT002  DIM       9
OTBIT003  DIM       3
OTBIT004  DIM       2
OTBIT005  DIM       9
OTBIT006  DIM       3
OTBIT007  DIM       2
OTBIT008  DIM       9
OTBIT009  DIM       3
OTBIT010  DIM       2
OTBIT011  DIM       9
OTBIT012  DIM       3
OTBIT013  DIM       2
OTBIT014  DIM       9
OTBIT015  DIM       3
OTBIT016  DIM       20                      * Item 1 provider usage
OTBIT017  DIM       20                      * Item 2 provider usage
OTBIT018  DIM       20                      * Item 3 provider usage
OTBIT019  DIM       20                      * Item 4 provider usage
OTBIT020  DIM       20                      * Item 5 provider usage
.
PSAGECON  DIM       3
.
PAYEPROV  DIM       10
PATHDESC  DIM       4
PTMAS008  DIM       35                      * Address Line 1 (padd1)
PTMAS009  DIM       35                      * Address Line 2 (padd2)
PTMAS010  DIM       35                      * Address Line 3 (psubrb)
PTMAS011  DIM       35                      * Address Line 4 (padd4)
PTMAS012  DIM       8                       * Postcode (ppost)
PTMAS013  DIM       20                      * Private Telephone (ptelep)
PTMAS023  DIM       10                      * Medicare Number (pmedi)
.
PTMSX045  DIM       2                       * Medicare code
.
RECNUM    FORM      3
SEC1      FORM      "00001"
SRCHBTCH  DIM       5
SRCHPRAC  DIM       6
SRCHSDOC  DIM       10
SRCHPROV  DIM       10
SRCHDATE  DIM       11
SRCHCLTY  DIM       6
SRCHCLID  DIM       6
SRCHSTAT  DIM       2
SHWBATCH  DIM       1
SERVPROV  DIM       10
.
TEMPFILB  DIM       8
TEMPAMNT  FORM      8.2
TEMPTOTV  FORM      8.2
TOTADJMN  FORM      12.2
TOTBAMNT  FORM      12.2
UPMIONLY  FORM      1
UPDATEKY  DIM       22                      * admissno,ccyymmdd,hhmmss
VISTFLAG  FORM      1
VISTDAY   DIM       5
VALDCODE  DIM       70
VALDMPRA  DIM       6
.
ERASE     INIT      "iserase "
HICCLEXT  INIT      "HICCLEXT"
HICCLCON  INIT      "HICCLCON"
ISBUILD   INIT      "isbuild "
OUTCLAIM  INIT      "OUTCLAIM"
INTREFRL  INIT      "INTREFRL"
STATBTCH  INIT      "Batched"
STATEXTR  INIT      "Extracted"
STATSENT  INIT      "Sent"
STATACKW  INIT      "Acknowledged"
STATNACK  INIT      "Nack"
STATRECV  INIT      "Received Ok"
STATRECE  INIT      "Received Err"
STATRECX  INIT      "Received Error"
STATACTN  INIT      "Actioned"
STATPAYM  INIT      "EFT Pay.Rcvd"
STATPAYX  INIT      "EFT Pay.Recvd"
STATDEPV  INIT      "Dep.Verf."
STATDEPX  INIT      "Deposit Verf."
STATCLSE  INIT      "Closed"
STATCOPY  INIT      "Sent Hard Copy"
STATHEAD  INIT      "Change Header"
UKEYB     INIT      " 40 U1-8,9-16,17-21,22-27,28-29"
.
COMFILAF  FILE      ASCII, FIXED=127
.
.QUOTE     INIT      "#""
.----------------------------------------------------------------------
PRGID     INIT      "HICWEB01"
VERSION   INIT      "V12.01.00"
PRGNAM    INIT      "HIC Claims Web Server"
.----------------------------------------------------------------------
.
          CALL      WEBINT00       * Initialise Fifo Etc.
          CALL      INIT0000       * Open Files
.
MAIN1000  CALL      WEBRED00       * Read Fifo WEBPID and USERID
.
          COMPARE   "999",REPORTNO * End Server Process on Report Option 999
          GOTO      MAIN9999 IF EQUAL
.
          CALL      OUTSIT00       * Check Correct Files Are Open & Valid Site
          BRANCH    EXIT,MAIN1000
.
          BRANCH    REPORTNO,MAIN1100,MAIN1200,MAIN1300,MAIN1400,MAIN1500:
                             MAIN1600,MAIN1700
.
          PACK      WEBTITLE,PRGID,SP1,VERSION,SP1,PRGNAM,SP70
          MOVE      "Invalid Option",WEBTITLE
          CALL      WEBERR00   * Create Output File and Write HTML Page Header
          GOTO      MAIN1000
.
MAIN1100  CALL      HICCLM00        * HIC Claim
          BRANCH    EXIT,MAIN1000
          CALL      NXTPAG00
          GOTO      MAIN1000
.
MAIN1200  CALL      CLMLST00        * Claim list
          BRANCH    EXIT,MAIN1000
          CALL      NXTPAG00
          GOTO      MAIN1000
.
MAIN1300  CALL      UCLM0000        * Update Claim/Referral Detalis
          BRANCH    EXIT,MAIN1000
          CALL      NXTPAG00
          GOTO      MAIN1000
.
MAIN1400  CALL      PRTBTC00        * Print batch
          BRANCH    EXIT,MAIN1000
          CALL      NXTPAG00
          GOTO      MAIN1000
.
MAIN1500  CALL      SELDOC00        * Select service doctor for a medical prac.
          GOTO      MAIN1000
.
MAIN1600  CALL      VALDPY00        * Validate Payee provider
          GOTO      MAIN1000
.
MAIN1700  CALL      VALDSV00        * Validate Service provider
          GOTO      MAIN1000
.
MAIN9999  MOVE      "SERVER SHUTDOWN COMPLETE",WEBTITLE
          CALL      WEBERR00
          STOP
.------------------------------------------------------------
. Output Next Page Based on CGI Parameter nextpage
.------------------------------------------------------------
NXTPAG00  MOVE      ZERO,F1
          MOVE      NEXTPAGE,F1
          BRANCH    F1,NXTPAG10,NXTPAG20,NXTPAG30,NXTPAG40
.
          CALL      WINCLS00
          GOTO      NXTPAG99
.
NXTPAG10  CALL      RDIREC00
          GOTO      NXTPAG99
.
NXTPAG20  CALL      GOBACK00      * Go Back 1 Html page
          GOTO      NXTPAG99
.
NXTPAG30  CALL      DAH20000      * Go Back 2 html pages
          GOTO      NXTPAG99
.
NXTPAG40  CALL      PREDIR00      * Redirect Parent
          GOTO      NXTPAG99
.
NXTPAG99  RETURN
.------------------------------------------------------------------------------
.  Redirect Parent URL
.------------------------------------------------------------------------------
PREDIR00  CALL      OPENHTML
          BRANCH    EXIT,PREDIR90
.
          WRITE     HTMLFILE;"<script type=#"text/javascript#"> {":
                             " parent.location.href=#"",REDIRECT,"#";":
                             "}":
                             "</script>"
          CALL      CLOSHTML
          GOTO      PREDIR99
.
PREDIR90  DISPLAY   "*** Fifo Not Found ***"
.
PREDIR99  RETURN
.-------------------------------------------------------------------------------
.  Goes back 1 page
.-------------------------------------------------------------------------------
GOBACK00  CALL      OPENHTML
          BRANCH    EXIT,GOBACK99
          WRITE     HTMLFILE;"<script type=#"text/javascript#"> {":
                             "    alert(#"",WEBTITLE,"#");":
                             "    self.close();":
                             "    opener.history.go(-1);":
                             "}":
                             "</script>"
          CALL      CLOSHTML
GOBACK99  RETURN
.------------------------------------------------------------
. Open Files and Initialize Variables
.------------------------------------------------------------
INIT0000  OPEN      PATVISA1,"patvisaf"
          OPEN      PMSVX1A1,"pmsvx1af"
          OPEN      PATHSPA1,"pathspaf"
          OPEN      PATMA1A1,"patma1af"
          OPEN      PATMX1A1,"patmx1af"
          OPEN      MLTSECA1,"mltsecaf"
          OPEN      MLTSITA1,"mltsitaf"
          OPEN      MRTMASA1,"mrtmasaf"
          OPEN      PATRE1A1,"patre1af"
          OPEN      PATWR1A1,"patwr1af"
          OPEN      PATDSCH1,"patdschf"
          OPEN      PATCODE1,"patcodes"
          OPEN      PATCODE2,"patcodes"
          OPEN      PRIITEM1,"priitemf"
          OPEN      HICCLMA1,"hicclmaf"
          OPEN      HICCLMA2,"hicclmaf"
          OPEN      HICCLMA3,"hicclmaf"
          OPEN      HICCLMA4,"hicclmaf"
          OPEN      HICCLMA5,"hicclmaf"
          OPEN      HICCLMA6,"hicclmaf"
          OPEN      HICCLMA7,"hicclmaf"
          OPEN      HICCITA1,"hiccitaf"
          OPEN      HICCITA2,"hiccitaf"
          OPEN      HICERRA1,"hicerraf"
          OPEN      HICBCNA1,"hicbcnaf"
          OPEN      HICBCNA2,"hicbcnaf"
          OPEN      HICBTCA1,"hicbtcaf"
          OPEN      HICBTCA2,"hicbtcaf"
          OPEN      HICBTCA3,"hicbtcaf"
          OPEN      HICBTCA5,"hicbtcaf"
          OPEN      HICEMSA1,"hicemsaf"
          OPEN      HICEMSA2,"hicemsaf"
          OPEN      HICHISA1,"hichisaf"
          OPEN      HICRCIA1,"hicrciaf"
          OPEN      HICRCIA2,"hicrciaf"
          OPEN      HICEFCA1,"hicefcaf"
          OPEN      OUTSITA1,"outsitaf"
          OPEN      OUTSITA2,"outsitaf"
          OPEN      OUTLPCA1,"outlpcaf"
          OPEN      BOKRC1A1,"bokrc1af"
          OPEN      ALLREFA1,"allrefaf"
          OPEN      ALLPROA1,"allproaf"
          OPEN      ALLPROA2,"allproaf"
          OPEN      ALLPRRA1,"allprraf"
          OPEN      ALLPRRA2,"allprraf"
          OPEN      ALLDIAA1,"alldiaaf"
          OPEN      ALLDIAA2,"alldiaaf"
          OPEN      ALLRITA1,"allritaf"
          OPEN      ALLLNKA2,"alllnkaf"
          OPEN      ALLCASA1,"allcasaf"
          OPEN      PRIPRAC1,"pripracf"
          OPEN      PRIPRAC2,"pripracf"
          OPEN      PRIDOCT1,"pridoctf"
          OPEN      PRISECA1,"prisecaf"
          OPEN      PRISECA2,"prisecaf"
          OPEN      PRIALSA1,"prialsaf"
          OPEN      PATDO1A1,"patdo1af"
          OPEN      CONTROLF,"controlf"
          OPEN      HICBCNA1,"hicbcnaf"
          OPEN      PMSHCPA1,"pmshcpaf"
          OPEN      PATMI1A1,"patmi1af"
          OPEN      VISCMTA1,"viscmtaf"     * Visit Comments Table
          OPEN      PMSCCDA1,"pmsccdaf"
          OPEN      PMSPX2A1,"pmspx2af"
          OPEN      WEBSTEA1,"websteaf"
          OPEN      PMSHCGA1,"pmshcgaf"
          OPEN      PMSHCLA1,"pmshclaf"
.
          OPEN      IBAPRTA1,"ibaprtaf"        * For Printer Selection
          OPEN      IBACODE1,"ibacodef"        * For Printer Selection
          OPEN      IHAPASS1,"ihapassf"        * For Printer Selection
          OPEN      IBAPDFA1,"ibapdfaf"        * For default printer selection
          OPEN      IBASPOL1,"ibaspolf"
.
          READ      CONTROLF,HUND03;*57,PTCNMCLM,*63,PTCNHICO
          READ      CONTROLF,THIRTY3;*200,PRCNRDOC
          READ      CONTROLF,HUND06;*27,ALCNRAUD,*28,ALCNEAUD
.
          MATCH     "1",ALCNRAUD
          IF        @EQUAL
            OPEN      ALLAUDRE,"allaudre"
          ENDIF
.
          CALL      TFILENAM                * Get temp file name
          MOVE      TFILNAME,TEMPFILB
.
INIT9999  RETURN
.
.*******************************************************************************
.                     Check Correct Files are Open for System
.*******************************************************************************
OUTSIT00  MOVE      WBSESIT,KEY6
          CALL      RDSITA1
          BRANCH    OVRCD,OUTSIT90
          MATCH     OSTFILE,CFILEPRE         * Save Current File Prefix
          IF        !@EQUAL
            MOVE      OSTFILE,CFILEPRE       * Save Current File Prefix
            CALL      OPNOUT00               * Open Outpatient Files
          ENDIF
.
          MOVE      ZERO,EXIT
          GOTO      OPNOUT99
.
OUTSIT90  MOVE      "Outpatient Site Invalid",WEBTITLE
          CALL      WEBERR00
          MOVE      ONE,EXIT
OUTSIT99  RETURN
.
.*******************************************************************************
.                    Open Outpatient Files
.*******************************************************************************
OPNOUT00  
          PACK      CFNAME,CFILEPRE,FILCLIA1  * Get the name of the CLIA1 file
          CLOSE     OUTCLIA1
          OPEN      OUTCLIA1,CFNAME           * Open the file
.
          PACK      CFNAME,CFILEPRE,FILCTYA1  * Get the name of the CLIA1 file
          CLOSE     OUTCTYA1
          OPEN      OUTCTYA1,CFNAME           * Open the file
.
          PACK      CFNAME,CFILEPRE,FILBOKA6  * Get the name of the BOKA6 file
          CLOSE     OUTBOKA6
          OPEN      OUTBOKA6,CFNAME           * Open the file
.
          PACK      CFNAME,CFILEPRE,FILBOKA1  * Get the name of the BOKA6 file
          CLOSE     OUTBOKA1
          OPEN      OUTBOKA1,CFNAME           * Open the file
.
          PACK      CFNAME,CFILEPRE,FILBITA1  * Get the name of the BITA1 file
          CLOSE     OUTBITA1
          OPEN      OUTBITA1,CFNAME           * Open the file
.
          PACK      CFNAME,CFILEPRE,FILBITA2  * Get the name of the BITA2 file
          CLOSE     OUTBITA2
          OPEN      OUTBITA2,CFNAME           * Open the file
.
          PACK      CFNAME,CFILEPRE,FILBB1A1  * Get the name of the BB1A1 file
          CLOSE     OUTBB1A1
          OPEN      OUTBB1A1,CFNAME           * Open the file
.
          PACK      CFNAME,CFILEPRE,FILMA1A1
          CLOSE     OUTMA1A1
          CALL      OPOTMA11                * Open the file
          PACK      CFNAME,CFILEPRE,FILMA1A2
          CLOSE     OUTMA1A2
          CALL      OPOTMA12                * Open the file
.
OPNOUT99  RETURN
.
.------------------------------------------------------------
. Clear Parameters
.------------------------------------------------------------
CLRPAR00  MOVE      ZERO,REPORTNO
          MOVE      SP70,TEMPLATE
          MOVE      SP70,NEXTPAGE
          PACK      REDIRECT,SP70,SP70,SP70,SP70
          MOVE      SP70,STARTKEY
          MOVE      SP70,UPDATETY
          MOVE      SP70,URNUMBER
          MOVE      SP70,ADMISSNO
          MOVE      SP70,DEPTCODE
          MOVE      SP70,REFRNUMB
          MOVE      SP70,CLMNNUMB
          MOVE      SP70,BTCHNUMB
          MOVE      SP70,FRSTDATE
          MOVE      SP70,LASTDATE
          MOVE      SP70,VYEARMTH
          MOVE      SP70,SELPRINT
          MOVE      SP70,PAYEPROV
          MOVE      SP70,SERVPROV
          MOVE      SP70,VALDCODE
          MOVE      SP70,VALDMPRA
.
          MOVE      SP70,VIEWTYPE
          MOVE      SP70,CASEKEYS
          MOVE      SP70,ITEMKEYS
          MOVE      SP70,SRCHBTCH
          MOVE      SP70,SRCHPRAC
          MOVE      SP70,SRCHSDOC
          MOVE      SP70,SRCHPROV
          MOVE      SP70,SRCHDATE
          MOVE      SP70,SRCHCLID
          MOVE      SP70,SRCHCLTY
          MOVE      SP70,SRCHSTAT
          MOVE      SP70,BATCHKEY
          MOVE      ZERO,SHWBATCH
          MOVE      ZERO,BTCHFLAG
          MOVE      ZERO,LINKKEY
          MOVE      ZERO,TOTBAMNT
          MOVE      SP70,KEYINDAT
.
          MOVE      SP70,HCBTC001
          MOVE      SP70,HCBTC002
          MOVE      SP70,HCBTC003
          MOVE      SP70,HCBTC004
          MOVE      SP70,HCBTC005
          MOVE      SP70,HCBTC006
.
          MOVE      ZERO,HCCLM001
          MOVE      Z70,HCCLM002
          MOVE      ZERO,HCCLM003
          MOVE      Z70,HCCLM004
          MOVE      Z70,HCCLM005
          MOVE      ZERO,HCCLM006
          MOVE      Z70,HCCLM007
          MOVE      Z70,HCCLM008
          MOVE      ZERO,HCCLM009
          MOVE      Z70,CLAIMPRT
          MOVE      Z70,CLAIMPSL
          MOVE      Z70,STATNCOD
.
          MOVE      ONE,F3
          WHILE     F3 <= 100
            MOVE      "0",RESUB[F3]
            ADD       ONE,F3
          DO
.
          PACK      REDIREC2,SP70,SP70,SP70,SP70
.
          CALL      CPALRE00
.
          MOVE      ZERO,MASUPDFL
          MOVE      Z70,PTMAS008
          MOVE      Z70,PTMAS009
          MOVE      Z70,PTMAS010
          MOVE      Z70,PTMAS011
          MOVE      Z70,PTMAS012
          MOVE      Z70,PTMAS013
          MOVE      Z70,PTMAS023
.
          MOVE      Z70,PMPXI059
          MOVE      Z70,PMPXI060
          MOVE      Z70,PMPXI061
          MOVE      Z70,PTMSX045
.
          MOVE      Z70,ALRIT001
          MOVE      Z70,ALRIT002
          MOVE      Z70,ALRIT003
          MOVE      Z70,ALRIT004
          MOVE      Z70,ALRIT005
          MOVE      Z70,ALRIT006
          MOVE      Z70,ALRIT007
          MOVE      Z70,ALRIT008
          MOVE      Z70,ALRIT009
          MOVE      Z70,ALRIT010
          MOVE      Z70,ALRIT011
          MOVE      Z70,ALRIT012
          MOVE      Z70,ALRIT013
          MOVE      Z70,ALRIT014
          MOVE      Z70,ALRIT015
          MOVE      Z70,ALRIT016
          MOVE      Z70,ALRIT017
          MOVE      Z70,ALRIT018
          MOVE      Z70,ALRIT019
          MOVE      Z70,ALRIT020
.
          MOVE      ZERO,CMBSFLAG
          MOVE      ZERO,AMBSFLAG
          MOVE      ZERO,UPMIONLY
          MOVE      ZERO,GNXBFLAG
.
          CALL      CVPMI000
.
          MOVE      Z70,OTBIT001
          MOVE      Z70,OTBIT002
          MOVE      Z70,OTBIT003
          MOVE      Z70,OTBIT004
          MOVE      Z70,OTBIT005
          MOVE      Z70,OTBIT006
          MOVE      Z70,OTBIT007
          MOVE      Z70,OTBIT008
          MOVE      Z70,OTBIT009
          MOVE      Z70,OTBIT010
          MOVE      Z70,OTBIT011
          MOVE      Z70,OTBIT012
          MOVE      Z70,OTBIT013
          MOVE      Z70,OTBIT014
          MOVE      Z70,OTBIT015
          MOVE      Z70,OTBIT016
          MOVE      Z70,OTBIT017
          MOVE      Z70,OTBIT018
          MOVE      Z70,OTBIT019
          MOVE      Z70,OTBIT020
          MOVE      Z70,OUTBB031
.
CLRPAR99  RETURN
.------------------------------------------------------------
. Set Parameters
.------------------------------------------------------------
SETPAR00  MATCH     "reportno=",QRYNAME
          IF        @EQUAL
            MOVE      QRYDATA,REPORTNO
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "template=",QRYNAME
          IF        @EQUAL
            MOVE      QRYDATA,TEMPLATE
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "updatety=",QRYNAME
          IF        @EQUAL
            MOVE      QRYDATA,UPDATETY
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "clmnnumb=",QRYNAME
          IF        @EQUAL
            MOVE      QRYDATA,CLMNNUMB
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "btchnumb=",QRYNAME
          IF        @EQUAL
            MOVE      QRYDATA,BTCHNUMB
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "urnumber=",QRYNAME
          IF        @EQUAL
            MOVE      QRYDATA,URNUMBER
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "admissno=",QRYNAME
          IF        @EQUAL
            MOVE      QRYDATA,ADMISSNO
            GOTO      SETPAR99
          ENDIF
.  
          MATCH     "selprint=",QRYNAME
          IF        @EQUAL
            MOVE      QRYDATA,SELPRINT
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "totbamnt=",QRYNAME
          IF        @EQUAL
            MOVE      QRYDATA,TOTBAMNT
            GOTO      SETPAR99
          ENDIF
.  
          MATCH     "nextpage=",QRYNAME
          IF        @EQUAL
            MOVE      QRYDATA,NEXTPAGE
            GOTO      SETPAR99
          ENDIF 
.
          MATCH     "frstdate=",QRYNAME
          IF        @EQUAL
            MOVE      QRYDATA,FRSTDATE
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "lastdate=",QRYNAME
          IF        @EQUAL
            MOVE      QRYDATA,LASTDATE
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "vyearmth=",QRYNAME
          IF        @EQUAL
            MOVE      QRYDATA,VYEARMTH
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "redirect=",QRYNAME
          IF        @EQUAL
            MOVE      QRYDATA,REDIRECT
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "viewtype=",QRYNAME
          IF        @EQUAL
            MOVE      QRYDATA,VIEWTYPE
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "itemkeys=",QRYNAME
          IF        @EQUAL
            PACK      ITEMKEYS,QRYDATA,SP70
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "casekeys=",QRYNAME
          IF        @EQUAL
            PACK      CASEKEYS,QRYDATA,SP70
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "srchclty=",QRYNAME
          IF        @EQUAL
            PACK      SRCHCLTY,QRYDATA,SP70
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "srchclid=",QRYNAME
          IF        @EQUAL
            PACK      SRCHCLID,QRYDATA,SP70
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "srchstat=",QRYNAME
          IF        @EQUAL
            PACK      SRCHSTAT,QRYDATA,SP70
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "srchbtch=",QRYNAME
          IF        @EQUAL
            PACK      SRCHBTCH,QRYDATA,SP70
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "srchsdoc=",QRYNAME
          IF        @EQUAL
            PACK      SRCHSDOC,QRYDATA,SP70
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "srchprac=",QRYNAME
          IF        @EQUAL
            PACK      SRCHPRAC,QRYDATA,SP70
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "srchprov=",QRYNAME
          IF        @EQUAL
            PACK      SRCHPROV,QRYDATA,SP70
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "srchdate=",QRYNAME
          IF        @EQUAL
            CALL      SRCHDT00
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "keyindat",QRYNAME
          IF        @EQUAL
            MOVE      QRYDATA,KEYINDAT
            GOTO      SETPAR99
          ENDIF
.
.         MATCH     "checkbox",QRYNAME
.         IF        @EQUAL
.           MOVE      QRYDATA,CHECKBOX
.           GOTO      SETPAR99
.         ENDIF
.
          MATCH     "claimkey",QRYNAME
          IF        @EQUAL
            ADD       ONE,LINKKEY
            PACK      CLAIMKEY[LINKKEY],QRYDATA,SP70
            GOTO      SETPAR99
          ENDIF
.
          MATCH       "shwbatch",QRYNAME
          IF          @EQUAL
            MOVE        QRYDATA,SHWBATCH
            GOTO        SETPAR99
          ENDIF
.
          MATCH       "batchkey",QRYNAME
          IF          @EQUAL
            MOVE        QRYDATA,BATCHKEY
            GOTO        SETPAR99
          ENDIF
.
          MATCH       "btchflag",QRYNAME
          IF          @EQUAL
            MOVE        QRYDATA,BTCHFLAG
            GOTO        SETPAR99
          ENDIF
.
          MATCH       "hcbtc",QRYNAME
          IF          @EQUAL
            CALL        STBTC000
            GOTO        SETPAR999
          ENDIF
.
          MATCH       "hcclm",QRYNAME
          IF          @EQUAL
            CALL        STCLM000
            GOTO        SETPAR999
          ENDIF
.
          MATCH     "redirec2=",QRYNAME
          IF        @EQUAL
            MOVE      QRYDATA,REDIREC2
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "deptcode=",QRYNAME
          IF        @EQUAL
            MOVE      QRYDATA,DEPTCODE
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "refrnumb=",QRYNAME
          IF        @EQUAL
            MOVE      QRYDATA,REFRNUMB
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "upmionly=",QRYNAME
          IF        @EQUAL
            MOVE      QRYDATA,UPMIONLY
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "vicmt006",QRYNAME              * Claim Comments
          IF        @EQUAL
            CALL      CLRVCM00           * Create comments temp file
            CALL      SETVCM00
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "resub",QRYNAME
          IF        @EQUAL
            CALL      STCKEY00
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "alref",QRYNAME
          IF        @EQUAL
            CALL      SPALR000
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "ptmas",QRYNAME
          IF        @EQUAL
            MOVE      ONE,MASUPDFL
            CALL      SPMAS000
            COMPARE   ZERO,EXIT
            GOTO      SETPAR99 IF EQUAL
          ENDIF
.
          MATCH     "ptmsx",QRYNAME
          IF        @EQUAL
            MOVE      ONE,MASUPDFL
            CALL      SPMSX000
            COMPARE   ZERO,EXIT
            GOTO      SETPAR99 IF EQUAL
          ENDIF
.
          MATCH     "pmpmi",QRYNAME
          IF        @EQUAL
            MOVE      ONE,MASUPDFL
            CALL      SVPMI000
            COMPARE   ZERO,EXIT
            GOTO      SETPAR99 IF EQUAL
          ENDIF
.
          MATCH     "alrit",QRYNAME
          IF        @EQUAL
            MOVE      ONE,AMBSFLAG
            CALL      SPRIT000
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "otbit",QRYNAME
          IF        @EQUAL
            MOVE      ONE,CMBSFLAG
            CALL      SPBIT000
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "claimprt=",QRYNAME
          IF        @EQUAL
            MOVE      QRYDATA,CLAIMPRT
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "claimpsl=",QRYNAME
          IF        @EQUAL
            MOVE      QRYDATA,CLAIMPSL
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "statncod=",QRYNAME
          IF        @EQUAL
            MOVE      QRYDATA,STATNCOD
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "outbb031=",QRYNAME
          IF        @EQUAL
            MOVE      QRYDATA,OUTBB031
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "payeprov=",QRYNAME
          IF        @EQUAL
            PACK      PAYEPROV,QRYDATA,SP70
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "servprov=",QRYNAME
          IF        @EQUAL
            PACK      SERVPROV,QRYDATA,SP70
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "valdcode=",QRYNAME
          IF        @EQUAL
            PACK      VALDCODE,QRYDATA,SP70
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "valdmpra=",QRYNAME
          IF        @EQUAL
            MOVE      QRYDATA,VALDMPRA
            GOTO      SETPAR99
          ENDIF
.
SETPAR99  RETURN
.
.------------------------------------------------------------
.         Convert date
.------------------------------------------------------------
SRCHDT00  UNPACK    QRYDATA,CDAY,KEY1,MTHNAM3,KEY1,CCENT,CYEAR
          CALL      SETMTH00                * To Format Month
          PACK      KEYINDAT,CCENT,CYEAR,CMON,CDAY
SRCHDT99  RETURN
.------------------------------------------------------------
. Set parameters to include key for claim
.------------------------------------------------------------
STCKEY00  MOVE      ZERO,EXIT
          MOVE      ZERO,F3
          UNPACK    QRYNAME,KEY5,KEY3
          MOVE      KEY3,F3
          RESET     QRYDATA
          MATCH     SP70,QRYDATA
          GOTO      STCKEY99 IF EQUAL
          UNPACK    QRYDATA,RESUB[F3]
STCKEY99  RETURN
.
.------------------------------------------------------------
. Set parameters to hic batch file
.------------------------------------------------------------
STBTC000  UNPACK    QRYNAME,KEY5,KEY3
          MOVE      KEY3,F3
          BRANCH    F3,STBTC010,STBTC020,STBTC030,STBTC040,STBTC050:
                       STBTC060
          GOTO      STBTC910
.
STBTC010  MOVE      QRYDATA,HCBTC001
          GOTO      STBTC900
.
STBTC020  MATCH     SP70,QRYDATA
          GOTO      STBTC900 IF EQUAL
          MOVE      QRYDATA,HCBTC002
          GOTO      STBTC900
.
STBTC030  MATCH     SP70,QRYDATA
          GOTO      STBTC900 IF EQUAL
          PACK      HCBTC003,QRYDATA,SP70
          GOTO      STBTC900
.
STBTC040  MATCH     SP70,QRYDATA
          GOTO      STBTC900 IF EQUAL
          PACK      HCBTC004,QRYDATA,SP70
          GOTO      STBTC900
.
STBTC050  MATCH     SP70,QRYDATA
          GOTO      STBTC900 IF EQUAL
          PACK      HCBTC005,QRYDATA,SP70
          GOTO      STBTC900
.
STBTC060  MATCH     SP70,QRYDATA
          GOTO      STBTC900 IF EQUAL
          PACK      HCBTC006,QRYDATA,SP70
          GOTO      STBTC900
.
STBTC900  MOVE      ZERO,EXIT
          GOTO      STBTC999
.
STBTC910  MOVE      ONE,EXIT
STBTC999  RETURN
.
.------------------------------------------------------------
. Set parameters to hic claim file
.------------------------------------------------------------
STCLM000  UNPACK    QRYNAME,KEY5,KEY3
          MOVE      KEY3,F3
          BRANCH    F3,STCLM010,STCLM020,STCLM030,STCLM040,STCLM050:
                       STCLM060,STCLM070,STCLM080,STCLM090
          GOTO      STCLM910
.
STCLM010  MOVE      QRYDATA,HCCLM001
          GOTO      STCLM900
.
STCLM020  MOVE      QRYDATA,HCCLM002
          GOTO      STCLM900
.
STCLM030  MOVE      QRYDATA,HCCLM003
          GOTO      STCLM900
.
STCLM040  MOVE      QRYDATA,HCCLM004
          GOTO      STCLM900
.
STCLM050  MOVE      QRYDATA,HCCLM005
          GOTO      STCLM900
.
STCLM060  MOVE      QRYDATA,HCCLM006
          GOTO      STCLM900
.
STCLM070  MOVE      QRYDATA,HCCLM007
          GOTO      STCLM900
.
STCLM080  UNPACK    QRYDATA,CDAY,KEY1,MTHNAM3,KEY1,CCENT,CYEAR
          CALL      SETMTH00
          PACK      HCCLM008,CCENT,CYEAR,CMON,CDAY
          GOTO      STCLM900
.
STCLM090  MOVE      QRYDATA,HCCLM009
          GOTO      STCLM900
.
STCLM900  MOVE      ZERO,EXIT
          GOTO      STCLM999
.
STCLM910  MOVE      ONE,EXIT
STCLM999  RETURN
.
.------------------------------------------------------------
. HIC Claim
.------------------------------------------------------------
HICCLM00  
          RESET     UPDATETY
          MATCH     SP70,UPDATETY
          GOTO      HICCLM80 IF EQUAL
.
          CMATCH    "C",UPDATETY           * Creating Batch
          GOTO      HICCLM10 IF EQUAL
.
          CMATCH    "O",UPDATETY           * Place Claim On Hold
          GOTO      HICCLM14 IF EQUAL
.
          CMATCH    "B",UPDATETY           * Batching claims
          GOTO      HICCLM20 IF EQUAL
.
          CMATCH    "X",UPDATETY           * Extracting batch
          GOTO      HICCLM24 IF EQUAL
.
          CMATCH    "Y",UPDATETY           * Re-Extracting batch
          GOTO      HICCLM24 IF EQUAL
.
          CMATCH    "N",UPDATETY           * Mail form
          GOTO      HICCLM30 IF EQUAL
.
          CMATCH    "V",UPDATETY           * Deposit Verified
          GOTO      HICCLM32 IF EQUAL
.
          CMATCH    "M",UPDATETY           * Reset batch
          GOTO      HICCLM34 IF EQUAL
.
          CMATCH    "K",UPDATETY           * Received Manually ok
          GOTO      HICCLM34 IF EQUAL
.
          CMATCH    "U",UPDATETY           * Updating comemnt Batch
          GOTO      HICCLM37 IF EQUAL
.
          CMATCH    "R",UPDATETY           * Rejected claim
          GOTO      HICCLM40 IF EQUAL
.
          CMATCH    "W",UPDATETY           * Write off claim
          GOTO      HICCLM40 IF EQUAL
.
          CMATCH    "J",UPDATETY           * Adjustment claim
          GOTO      HICCLM40 IF EQUAL
.
          CMATCH    "T",UPDATETY           * Transfer to invoice 
          GOTO      HICCLM50 IF EQUAL
.
          CMATCH    "I",UPDATETY           * Received claim
          GOTO      HICCLM54 IF EQUAL
.
          CMATCH    "S",UPDATETY           * Resubmit claim
          GOTO      HICCLM60 IF EQUAL
.
          CMATCH    "H",UPDATETY           * Change Header
          GOTO      HICCLM62 IF EQUAL
.
          CMATCH    "F",UPDATETY           * Free format claim comments
          GOTO      HICCLM65 IF EQUAL
.
          CMATCH    "L",UPDATETY           * Update Claim Status
          GOTO      HICCLM70 IF EQUAL
.
          CMATCH    "P",UPDATETY           * Print Claim Form (DB4)
          GOTO      HICCLM75 IF EQUAL
.
          CMATCH    "Q",UPDATETY           * Print Internal Referral
          GOTO      HICCLM77 IF EQUAL
.
          CMATCH    "E",UPDATETY           * Actioned
          GOTO      HICCLM28 IF EQUAL
.
          CMATCH    "G",UPDATETY           * Close batch
          GOTO      HICCLM33 IF EQUAL
.
          GOTO      HICCLM95
.
.         Creating batch - to get the total amount of batch
.
HICCLM10  CALL      TOTB0000               * Get total batch amount
          GOTO      HICCLM18
.
HICCLM14  CALL      HOLD0000               * Place claim on hold
          MOVE      ZERO,TOTBAMNT
.
HICCLM18  CLEAR     REDIRECT
          APPEND    "hicweb01.pbl?reportno=01&template=001",REDIRECT
          APPEND    "&totbamnt=",REDIRECT
          APPEND    TOTBAMNT,REDIRECT
          APPEND    "&srchbtch=",REDIRECT
          APPEND    SRCHBTCH,REDIRECT
          IF        TOTBAMNT=0
            APPEND    "&shwbatch=0",REDIRECT
            APPEND    "&btchflag=0",REDIRECT
          ELSE
            APPEND    "&shwbatch=1",REDIRECT
            APPEND    "&btchflag=1",REDIRECT
          ENDIF
          APPEND    "&nextpage=1",REDIRECT
          APPEND    "&srchprov=",REDIRECT
          APPEND    SRCHPROV,REDIRECT
          APPEND    SP70,REDIRECT
          RESET     REDIRECT
.
          MOVE      ZERO,EXIT
          GOTO      HICCLM99
.
.         Batching
.
HICCLM20  CALL      CSTA0000       * write a record to batch file
          CALL      SCLM0000       * set excluded claim with next claim/batch mp
          CALL      GVOU0000       * Generate Voucher number
          CALL      SDB10000       * Print DB1
          MOVE      ZERO,EXIT
          GOTO      HICCLM99
.
.         Extraction
.
HICCLM24  UNPACK    BATCHKEY,SRCHBTCH
          CALL      SHIC0000       * Send extraction to HIC
          MOVE      ZERO,EXIT
          GOTO      HICCLM99
.
.         Actioned
.
HICCLM28  MOVE      BATCHKEY,KEY33
          CALL      RDHCBTC1
          BRANCH    OVRCD,HICCLM39
.
          CALL      UCIT0000                   * Update claim item file
          MOVE      HCBTSTAT,SAVESTAT          * History Status
          MOVE      " 8",HCBTSTAT              * Actioned
          CALL      WRTHIS00                   * History Audit
          GOTO      HICCLM38
.
.         Mail form
.
HICCLM30  MOVE      BATCHKEY,KEY33
          CALL      RDHCBTC1
          BRANCH    OVRCD,HICCLM39
.
          PACK      HCBTHCOP,CCC,CYY,CMM,CDD
          REP       " 0",HCBTHCOP              * Set hardcopy date if sent
          MOVE      "1",HCBTSENT
.
          MOVE      HCBTSTAT,KEY2
          MOVE      SP70,SAVESTAT             * History Status
          MOVE      "11",HCBTSTAT             * Hard copy to Medicare
          CALL      WRTHIS00                  * History Audit
          MOVE      KEY2,HCBTSTAT
          GOTO      HICCLM38
.
.         Deposit Verified (status must be >= 8)
.
HICCLM32  MOVE      BATCHKEY,KEY33
          CALL      RDHCBTC1
          BRANCH    OVRCD,HICCLM39
.
          MATCH     " 8",HCBTSTAT
          GOTO      HICCLM92 IF LESS           * status is not Actined
.
          MOVE      HCBTSTAT,SAVESTAT          * History Status
          MOVE      " 9",HCBTSTAT
          CALL      WRTHIS00                   * History Audit
          GOTO      HICCLM38
.
.         Close Batch
.
HICCLM33  MOVE      BATCHKEY,KEY33
          CALL      RDHCBTC1
          BRANCH    OVRCD,HICCLM39
.
          MATCH     " 9",HCBTSTAT
          GOTO      HICCLM92 IF LESS           * status is Not deposit Verified
.
          MOVE      HCBTSTAT,SAVESTAT          * History Status
          MOVE      "10",HCBTSTAT
          CALL      WRTHIS00                   * History Audit
          GOTO      HICCLM38
.
.         Reset Batch (status must be 1,2,3,4) set batch status to 'Batched'
.         or Received Manually - set batch status to 'Received Ok'
.
HICCLM34  MOVE      BATCHKEY,KEY33
          CALL      RDHCBTC1
          BRANCH    OVRCD,HICCLM39
          MOVE      SP70,KEY1
          UNPACK    HCBTSTAT,D1,KEY1
.
          MOVE      HCBTSTAT,SAVESTAT          * History Status
          CMATCH    "K",UPDATETY               * Received Manually ok
          GOTO      HICCLM35 IF NOT EQUAL
.
          REP       "1X2X3X4X",KEY1
          MATCH     "X",KEY1
          GOTO      HICCLM92 IF NOT EQUAL      * Invalid status 
.
          MOVE      " 5",HCBTSTAT              * set status to 'received ok'
          PACK      HCBTUDAT,CCC,CYY,CMM,CDD
          REP       " 0",HCBTUDAT
          CLOCK     TIME,HCBTUTIM              * time updated
          MOVE      USERID,HCBTUUID            * web user id
          CALL      UPHCBTC1                   * update batch file
.
          CALL      WRTHIS00                   * History Audit
          GOTO      HICCLM39
.
HICCLM35  MATCH     "1",KEY1                   * batch status of Extracted
          GOTO      HICCLM92 IF NOT EQUAL      * Invalid status 
.
          MOVE      " 0",HCBTSTAT
          CALL      WRTHIS00                   * History Audit
.
          CALL      RBAT0000                   * Reset batch 
          GOTO      HICCLM39
.
.         Updating comments
.
HICCLM37  MOVE      BATCHKEY,KEY33
          CALL      RDHCBTC1
          BRANCH    OVRCD,HICCLM39
          MOVE      HCBTC002,HCBTCMNT
.
HICCLM38  PACK      HCBTUDAT,CCC,CYY,CMM,CDD
          REP       " 0",HCBTUDAT
          CLOCK     TIME,HCBTUTIM           * time updated
          MOVE      USERID,HCBTUUID         * web user id
          CALL      CADJ0000                * Calculate total adjustments
          CALL      UPHCBTC1                * update batch file
.
HICCLM39  MOVE      ZERO,EXIT
          GOTO      HICCLM99
.
.         Updating Amount Adjustment
.
HICCLM40  MATCH     SP70,ITEMKEYS
          GOTO      HICCLM99 IF EQUAL
.
          MOVE      BATCHKEY,KEY33
          CALL      RDHCBTC1
          BRANCH    OVRCD,HICCLM92
          MATCH     " 8",HCBTSTAT
          GOTO      HICCLM92 IF LESS          * Status Not Actioned yet
.
          PACK      KEY18,ITEMKEYS
          CALL      RDHCCIT1
          IF        OVRCD=0  
            PACK      KEY8,HCCICLMN,SP70
            CALL      RDHCCLM1
            IF        OVRCD=0
              CALL      UPDCLM00               * move cgi variables
              BRANCH    EXIT,HICCLM91
              CALL      UPHCCIT1               * Update item claim file
              MOVE      USERID,HCCLUUID
              CALL      UPHCCLM1               * Update claim file
              CALL      UPBT0000               * Update status of batch file
            ENDIF
          ENDIF
          MOVE      ZERO,EXIT
          GOTO      HICCLM99
.
.         Transfer to invoice
.
HICCLM50  MATCH     SP70,ITEMKEYS
          GOTO      HICCLM99 IF EQUAL
.
          PACK      KEY18,ITEMKEYS
          CALL      RDHCCIT1
          BRANCH    OVRCD,HICCLM99
.
          MOVE      HCCICLMN,KEY8
          CALL      RDHCCLM1                * claim file
          BRANCH    OVRCD,HICCLM99
.
          CALL      TRIT0000                * Transfer item to PP invoice
          BRANCH    EXIT,HICCLM94
.
          MOVE      HCCICAMT,HCCITRIN       * item amount claimed
          PACK      HCCITRND,CCC,CYY,CMM,CDD
          REP       " 0",HCCITRND           * transfer to invoice date
          CALL      UPHCCIT1
.
          ADD       HCCICAMT,HCCLTRIN       * amount transfer to invoice
          MOVE      USERID,HCCLUUID
          CALL      UPHCCLM1
.
          MOVE      BATCHKEY,KEY33
          CALL      RDHCBTC1                * batch file
          IF        OVRCD=0
            CALL      CADJ0000              * Calculate total adjustments
            ADD       HCCICAMT,HCBTTRIN     * amount transfer to invoice
            PACK      HCBTUDAT,CCC,CYY,CMM,CDD
            REP       " 0",HCBTUDAT
            CLOCK     TIME,HCBTUTIM           * time updated
            MOVE      USERID,HCBTUUID         * web user id
            CALL      UPHCBTC1
          ENDIF
          MOVE      ZERO,EXIT
          GOTO      HICCLM90
.
.         Receive amount 
.
HICCLM54  MATCH     SP70,ITEMKEYS
          GOTO      HICCLM99 IF EQUAL
.
          MOVE      BATCHKEY,KEY33
          CALL      RDHCBTC1
          BRANCH    OVRCD,HICCLM92
.
          MATCH     " 8",HCBTSTAT
          GOTO      HICCLM92 IF LESS         * Status Not Actioned yet
.
          PACK      KEY18,ITEMKEYS
          CALL      RDHCCIT1
          IF        OVRCD=0  
            PACK      KEY8,HCCICLMN,SP70
            CALL      RDHCCLM1
            IF        OVRCD=0
              MOVE      HCCLM008,HCCLRECP   * Update Received date
              SUB       HCCIRCVA,HCBTAMTR   * remove old amt received frm batch
              SUB       HCCIRCVA,HCCLRCVA   * remove old amt received frm claim
.
              ADD       HCCLM009,HCBTAMTR   * amount received (batch file)
              ADD       HCCLM009,HCCLRCVA   * amount received (claim file)
              MOVE      HCCLM009,HCCIRCVA   * Update Received amount (item)
.
              COMPARE   HCCIRCVA,HCCICAMT
              GOTO      HICCLM93 IF LESS    * must be less than item amount
.
              PACK      HCCIUDAT,CCC,CYY,CMM,CDD
              REP       " 0",HCCIUDAT
              CLOCK     TIME,HCCIUTIM
              MOVE      USERID,HCCIUUID
              CALL      UPHCCIT1            * Update item claim file
.
              PACK      HCCLUDAT,CCC,CYY,CMM,CDD
              REP       " 0",HCCLUDAT
              CLOCK     TIME,HCCLUTIM
              MOVE      USERID,HCCLUUID
              CALL      UPHCCLM1            * Update claim file
.
              MOVE      HCBTSTAT,SAVESTAT   * History Status
              MOVE      " 8",HCBTSTAT       * Action - payment manually entered
              PACK      HCBTUDAT,CCC,CYY,CMM,CDD
              REP       " 0",HCBTUDAT
              CLOCK     TIME,HCBTUTIM       * time updated
              MOVE      USERID,HCBTUUID     * web user id
              CALL      UPHCBTC1
              CALL      WRTHIS00            * Histroy Audit
            ENDIF
          ENDIF
.
          GOTO      HICCLM90
.
.         Resubmit
.
HICCLM60  CALL      RSUB0000                * Resubmit individual claim
          BRANCH    EXIT,HICCLM98
          GOTO      HICCLM90
.
.         Change Header
.
HICCLM62  CALL      CHGH0000                * Change header
          UNPACK    BATCHKEY,SRCHBTCH       * old batch
          CALL      GVOU0000                * re-generate Voucher number
          MOVE      CLMNBTCH,SRCHBTCH       * new batch
          CALL      GVOU0000                * re-generate Voucher number
.
          MOVE      BATCHKEY,kEY33          * old batch
          CALL      RDHCBTC1
          IF        OVRCD=0
            MOVE      "12",HCBTSTAT         * Change header
            CALL      WRTHIS00              * History Audit
          ENDIF
.
          MOVE      ZERO,EXIT
          PACK      KEY33,CLMNBTCH,SP70     * New batch
          CALL      RSHCBTC1
          CALL      RKHCBTC1
          BRANCH    OVRCD,HICCLM99
          MATCH     CLMNBTCH,HCBTBTCH       * Same batch no
          GOTO      HICCLM99 IF NOT EQUAL
          MOVE      SP70,SAVESTAT           * History Status
          MOVE      " 0",HCBTSTAT
          CALL      WRTHIS00                * History Audit
.
          GOTO      HICCLM99
.
.         Update Claim Comments
.
HICCLM65  CALL      UPCM0000                * Update Comments
          MOVE      ZERO,EXIT
          GOTO      HICCLM99
.
.         Update Claim Status
.
HICCLM70  MOVE      CLMNNUMB,KEY8
          CALL      RDHCCLM1
          BRANCH    OVRCD,HICCLM99
          PACK      HCCLSTAT,SP1,HCCLM005      * Claim status
          MATCH     " 2",HCCLSTAT
          GOTO      HICCLM72 IF NOT EQUAL      * Not on hold
.
.         Can not change to hold if already been bached
.
          PACK      KEY33,HCCLBTCH,HCCLPSRV,HCCLPMCI,HCCLPYEE
          CALL      RDHCBTC1
          COMPARE   ZERO,OVRCD
          GOTO      HICCLM9A IF EQUAL          * Already been batched
.
HICCLM72  MOVE      USERID,HCCLUUID
          CALL      UPHCCLM1
          GOTO      HICCLM90
.
HICCLM75  CALL      PCLM0000               * Print claim form (DB4)
          MOVE      ZERO,EXIT
          GOTO      HICCLM90
.
HICCLM77  CALL      PINT0000               * Print Internal Referral Form
          MOVE      ZERO,EXIT
          GOTO      HICCLM90
.
HICCLM80  CALL      HICCLSRV               * Check batch status
.
          MOVE      BATCHKEY,KEY33
          CALL      RDHCBTC1
          IF        OVRCD=1
            CALL      CLHICBTC             * clear fields
            PACK      HCBTSTAT,SRCHSTAT
          ELSE
            CALL      GRCV0000       * Amount received/reject.from Exception
          ENDIF
.
          PACK      KEY18,ITEMKEYS,SP70
          CALL      RDHCCIT1
          IF        OVRCD=1
            CALL      CLCIT000             * clear fields
          ELSE
            CALL      CEXC0000             * Check exception file
.           MATCH     SP70,HCCIRDAT
.           IF        !@EQUAL
.             MATCH     "007",TEMPLATE     * rejection screen
.             GOTO      HICCLM97 IF EQUAL  * item been resubmitted
.             MATCH     "008",TEMPLATE     * write off screen
.             GOTO      HICCLM97 IF EQUAL  * item been resubmitted
.           ENDIF
          ENDIF
          CALL      INST0000               * Initialise all status
.
          MOVE      CLMNNUMB,KEY8
          CALL      RDHCCLM1
          IF        OVRCD=1
            CALL      CLHICCLM             * clear fields
          ENDIF
.
HICCLM86  CALL      CURPER00
          CALL      CALCDT00   * Calculate Next and Last Period Dates
.
          CLEAR     WEBTITLE
          MOVE      "My Batch Details",WEBTITLE
          RESET     WEBTITLE
.
          CALL      WEBHED00   * Create Output File and Write HTML Page Header
          BRANCH    EXIT,HICCLM99
          CALL      WEBBOD00   * Process Web Body
          CALL      WEBEND00   * Process End of HTML File
.
          MOVE      ONE,EXIT
          GOTO      HICCLM99
.
HICCLM90  STRIP     REDIRECT
          ENDSET    REDIRECT
          APPEND    REDIREC2,REDIRECT
          RESET     REDIRECT
.
          MOVE      ZERO,EXIT
          GOTO      HICCLM99
.
HICCLM9A  MOVE      "Claim has already been Batched.",WEBTITLE
          CALL      WEBERR00
          MOVE      ONE,EXIT
          GOTO      HICCLM99
.
HICCLM9C  MOVE      "Received amount is greater than the Item amount.",WEBTITLE
          CALL      WEBERR00
          MOVE      ONE,EXIT
          GOTO      HICCLM99
.
HICCLM91  MOVE      "Total Adjustment is greater than the Item amount.",WEBTITLE
          CALL      WEBERR00
          MOVE      ONE,EXIT
          GOTO      HICCLM99
.
HICCLM92  MOVE      "Invalid Current Batch Status.",WEBTITLE
          CALL      WEBERR00
          MOVE      ONE,EXIT
          GOTO      HICCLM99
.
HICCLM93  MOVE      "Amount Received is greater than Item Amount.",WEBTITLE
          CALL      WEBERR00
          MOVE      ONE,EXIT
          GOTO      HICCLM99
.
HICCLM94  
.         MOVE      "No Private Practice Doctor Referral Details.",WEBTITLE
          CLEAR     WEBTITLE
          APPEND    "No Private Practice Doctor Referral Details for ",WEBTITLE
          APPEND    "Medical Practice: ",WEBTITLE
          APPEND    HCCLMPRA,WEBTITLE
          APPEND    SP70,WEBTITLE
          RESET     WEBTITLE
          CALL      WEBERR00
          MOVE      ONE,EXIT
          GOTO      HICCLM99
.
HICCLM95  MOVE      "Invalid Update Type.",WEBTITLE
          CALL      WEBERR00
          MOVE      ONE,EXIT
          GOTO      HICCLM99
.
HICCLM96  MOVE      "Invalid Claim Number.",WEBTITLE
          CALL      WEBERR00
          MOVE      ONE,EXIT
          GOTO      HICCLM99
.
HICCLM97  MOVE      "Item has been Resubmitted.",WEBTITLE
          CALL      WEBERR00
          MOVE      ONE,EXIT
          GOTO      HICCLM99
.
HICCLM98  MOVE      "No Item to be Resubmitted.",WEBTITLE
          CALL      WEBERR00
          MOVE      ONE,EXIT
          GOTO      HICCLM99
.
HICCLM99  RETURN
+
.-----------------------------------------------------------------------
.         Check if any payment record in EFT payment file
.-----------------------------------------------------------------------
CEFC0000  MOVE      ZERO,EXIT
          PACK      KEY13,HCBTBTCH,SP70
          CALL      RSHCEFC1
CEFC1000  CALL      RKHCEFC1
          BRANCH    OVRCD,CEFC9999
          MATCH     HCBTBTCH,HCECBTCH      * Same batch number?
          GOTO      CEFC9999 IF NOT EQUAL
          MOVE      ONE,EXIT               * Found record
CEFC9999  RETURN
+
.-----------------------------------------------------------------------
.         Update claim file from Exception file        
.-----------------------------------------------------------------------
UCIT0000  PACK      KEY15,HCBTBTCH,SP70
          CALL      RSHCCLM7
UCIT1000  CALL      RKHCCLM7
          BRANCH    OVRCD,UCIT9999
          MATCH     HCBTBTCH,HCCLBTCH      * Same batch number?
          GOTO      UCIT9999 IF NOT EQUAL
.
          MOVE      ZERO,TOTBAMNT
          MOVE      ZERO,TOTADJMN
          PACK      KEY18,HCCLCLMN,SP70
          CALL      RSHCCIT1
UCIT2000  CALL      RKHCCIT1
          BRANCH    OVRCD,UCIT3000
          MATCH     HCCLCLMN,HCCICLMN
          GOTO      UCIT3000 IF NOT EQUAL
.
          PACK      KEY18,HCCICLMN,HCCIVISN,HCCITRAN
          CALL      RDHCRCI2
          BRANCH    OVRCD,UCIT2000
.
          MOVE      HCRIBENP,HCCIRCVA     * Paid
          ADD       HCRIBENP,TOTBAMNT
.
          MOVE      HCRIBENR,HCCIREJA     * Rejected
          ADD       HCRIBENR,TOTADJMN
.
          MOVE      HCRIREJD,HCCIREJD     * Rejection date
          MOVE      HCRIREJR,HCCIREJR     * Rejection reason
          CALL      UPHCCIT1
          GOTO      UCIT2000
.
UCIT3000  MOVE      TOTBAMNT,HCCLRCVA
          MOVE      TOTADJMN,HCCLREJA
          PACK      HCCLRECP,CCC,CYY,CMM,CDD
          REP       " 0",HCCLRECP         * Receipt date
          MOVE      USERID,HCCLUUID
          CALL      UPHCCLM7
          GOTO      UCIT1000
.
UCIT9999  RETURN
+
.-----------------------------------------------------------------------
.         Check exception file
.-----------------------------------------------------------------------
CEXC0000  MATCH     SP70,HCBTBTCH
          GOTO      CEXC9999 IF EQUAL      * No batch details
.
.         Batch status of Received (ok or with errors)
.
          MATCH     " 5",HCBTSTAT
          GOTO      CEXC1000 IF EQUAL      * Received ok
          MATCH     " 6",HCBTSTAT
          GOTO      CEXC1000 IF EQUAL      * Received with errors
          MATCH     " 7",HCBTSTAT
          GOTO      CEXC9999 IF NOT EQUAL  * No payment received
.
CEXC1000  MOVE      ZERO,HCCIRCVA          * initialise amount received 
          MOVE      ZERO,HCCIREJA          * initialise amount rejected 
.
          PACK      KEY18,ITEMKEYS,SP70
          CALL      RDHCRCI2
          BRANCH    OVRCD,CEXC9999
.
          MOVE      HCRIBENP,HCCIRCVA      * amount received from exception file
          MOVE      HCRIBENR,HCCIREJA      * amount rejected from exception file
          MOVE      HCRIREJD,HCCIREJD      * Reject date
          MOVE      HCRIREJR,HCCIREJR      * Reason for Reject 
CEXC9999  RETURN
.
.-----------------------------------------------------------------------
. Change batch header for each claim that was ticked
.-----------------------------------------------------------------------
CHGH0000  MOVE      ZERO,GNXBFLAG          * set flag to generate batch no
          MOVE      ONE,F3
CHGH1000  COMPARE   F3,LINKKEY
          GOTO      CHGH9999 IF LESS
.
          MATCH     CLAIMKEY[F3],SP70
          GOTO      CHGH8000 IF EQUAL
.
          PACK      KEY8,CLAIMKEY[F3],SP70
          CALL      RDHCCLM1
          BRANCH    OVRCD,CHGH8000
.
          PACK      KEY33,HCCLBTCH,HCCLPSRV,HCCLPMCI,HCCLPYEE
          CALL      RDHCBTC1
          BRANCH    OVRCD,CHGH8000
.
          PACK      SKEY28,HCCLPMCI,HCCLPYEE,HCCLPSRV
.
.         If new payee prov is blank and medical practice hasn't changed
.
          MATCH     SP70,HCBTC003         * new payee
          GOTO      CHGH1800 IF NOT EQUAL
.
.         MOVE      HCCLPYEE,HCBTC003     * default from claim payee
.         MATCH     SP70,HCBTC003         * new payee
.         GOTO      CHGH1800 IF NOT EQUAL
.
.      If new payee provider is blank,use service provider as the payee provider
.
          MATCH     SP70,HCBTC005         * check if service provider changed
          IF        @EQUAL
            MOVE      HCCLPSRV,HCBTC003   * not changed, use prov from claim
          ELSE
            MOVE      HCBTC005,HCBTC003   * use the new service prov
          ENDIF
.
CHGH1800  MATCH     SP70,HCBTC003
          IF        !@EQUAL
            MOVE      HCBTC003,HCCLPYEE     * new payee provider
          ENDIF
.
          MATCH     SP70,HCBTC004
          IF        !@EQUAL
            MOVE      HCBTC004,HCCLMPRA     * new medical practice
          ENDIF
.
          MATCH     SP70,HCBTC005
          IF        !@EQUAL
            MOVE      HCBTC005,HCCLPSRV     * new service provider
          ENDIF
.
          PACK      KEY28,HCCLPMCI,HCCLPYEE,HCCLPSRV
          MATCH     SKEY28,KEY28
          GOTO      CHGH8000 IF EQUAL       * Provider or MCI has not changed
.
          MOVE      HCCLVISN,KEY8
          CALL      RDBOKB1
          BRANCH    OVRCD,CHGH8000
.
.         Fix batch file for the old number
.
          SUB       HCCLCAMN,HCBTCAMT       * adjust batch amount
          SUB       ONE,HCBTSIZE            * batch size
          CALL      UPHCBTC1
.
.         Fix Batch counter file for the old batch number
.
          PACK      KEY33,SKEY28,HCCLBTCH
          CALL      RDHCBCN1
          IF        OVRCD=0
            SUB       ONE,HCBCBCNT          * Batch counter
            CALL      UPHCBCN1
          ENDIF
.
.         Fix claim file with new provider and batch
.
          MATCH     SP70,HCBTC006
          GOTO      CHGH2000 IF EQUAL       * doctor hasn't changed
.
          MOVE      HCCLVISN,KEY8
          CALL      RDBOKB1
          BRANCH    OVRCD,CHGH2000
          MOVE      HCBTC006,OTBBADCS       * update new actual doctor seen
          CALL      UPBOKB1
.
          PACK      KEY8,OBAOUTNO,SP70
          CALL      RDPMVX11
          IF        OVRCD=0
              CALL      IBACLOCK
              PACK      PMVXLUPD,CCC,CYY,CMM,CDD   
              REP       " 0",PMVXLUPD
              MOVE      CTIMEIS,PMVXLUPT
              MOVE      USERID,PMVXWEBU           
              CALL      UPPMVX11
          ENDIF
.
.         Only generate batch number once
.
CHGH2000  MOVE      ZERO,FORM1
          IF        GNXBFLAG=0
            MOVE      HCCLPMCI,HCCIPMCI
            MOVE      HCCLPYEE,HCCIPYEE
            MOVE      HCCLPSRV,HCCIPSRV
            MOVE      ONE,GNXBFLAG
            CALL      GBCN0000             * Generate next batch number
          ELSE
            ADD       ONE,FORM1            * increment batch count
          ENDIF
.
          PACK      KEY33,HCCLPMCI,HCCLPYEE,HCCLPSRV,CLMNBTCH
          CALL      RDHCBCN1
          IF        OVRCD=0
            ADD       FORM1,HCBCBCNT       * increment batch counter
            MOVE      "1",HCBCSTAT         * Batch completed
            CALL      UPHCBCN1
          ENDIF
.
          MOVE      CLMNBTCH,HCCLBTCH      * New batch number
          MOVE      USERID,HCCLUUID
          CALL      UPHCCLM1               * Update claim file with new batch
.
          CALL      SBTC0000               * Update batch file with new batch no
          CALL      SCIT0000               * Update claim item with new batch no
.
CHGH8000  ADD       ONE,F3
          GOTO      CHGH1000
.
CHGH9999  RETURN
+
.-----------------------------------------------------------------------
. Set new batch record
.-----------------------------------------------------------------------
SBTC0000  PACK      KEY33,HCCLBTCH,HCCLPSRV,HCCLPMCI,HCCLPYEE
          CALL      RDHCBTC1
          BRANCH    OVRCD,SBTC2000
.
          ADD       HCCLCAMN,HCBTCAMT       * add batch total
          ADD       ONE,HCBTSIZE            * add batch size
          PACK      KEY8,CCC,CYY,CMM,CDD
          REP       " 0",KEY8
          MOVE      KEY8,HCBTUDAT           * date updated
          CLOCK     TIME,HCBTUTIM           * time updated
          MOVE      USERID,HCBTUUID         * web user id
          CALL      UPHCBTC1
          GOTO      SBTC9999
.
SBTC2000  MOVE      CLMNBTCH,HCBTBTCH      * New batch number
          UNPACK    KEY33,HCBTBTCH,HCBTPSRV,HCBTPMCI,HCBTPYEE
          MOVE      HCCLMPRA,HCBTMPRA
          MOVE      HCCLSITE,HCBTSITE
          MOVE      HCCLCTYP,HCBTCTYP
          MOVE      HCCLCLID,HCBTCLID
          MOVE      HCCLCAMN,HCBTCAMT       * add batch total
.
          PACK      HCBTDATE,CCC,CYY,CMM,CDD  * Batched date
          REP       " 0",HCBTDATE
          MOVE      ZERO,HCBTAMTR
          MOVE      ZERO,HCBTREJA
          MOVE      ZERO,HCBTWOFF
          MOVE      ZERO,HCBTTRIN
          MOVE      ZERO,HCBTADJM             * total amount of adjustment
          MOVE      ONE,HCBTSIZE              * Size of this batch
          MOVE      " 0",HCBTSTAT             * Status to batched
          MOVE      SP70,HCBTCMNT             * Comments
          MOVE      SP70,HCBTTDAT
          UNPACK    SP70,HCBTHCOP,HCBTFNDR,HCBTDEPD,HCBTSENT
          UNPACK    SP70,HCBTCDAT,HCBTCTIM,HCBTCUID,HCBTUDAT,HCBTUTIM,HCBTUUID
.
          PACK      KEY8,CCC,CYY,CMM,CDD
          REP       " 0",KEY8
          MOVE      KEY8,HCBTCDAT             * date created
          CLOCK     TIME,HCBTCTIM             * time created
          MOVE      USERID,HCBTCUID           * web user id
.
          UNPACK    SP70,HCBTUDAT,HCBTUTIM,HCBTUUID
          MOVE      SP70,HCBTEFNM             * extract filename
          MOVE      SP70,HCBTSPAR
          CALL      WRHCBTC1                * write new record
.
          MOVE      SP70,SAVESTAT           * History Status
          CALL      WRTHIS00                * History Audit
.
SBTC9999  RETURN
+
.-----------------------------------------------------------------------
. Update item claim file with new batch no
.-----------------------------------------------------------------------
SCIT0000  PACK      KEY18,HCCLCLMN,SP70
          CALL      RSHCCIT1
SCIT1000  CALL      RKHCCIT1
          BRANCH    OVRCD,SCIT9999
          MATCH     HCCLCLMN,HCCICLMN
          GOTO      SCIT9999 IF NOT EQUAL
.
          MOVE      HCCLPMCI,HCCIPMCI       * new MCI
          MOVE      HCCLPYEE,HCCIPYEE       * new payee provider
          MOVE      HCCLPSRV,HCCIPSRV       * new service provider
          MOVE      CLMNBTCH,HCCIBTCH       * new batch number
          CALL      UPHCCIT1
          GOTO      SCIT1000
.
SCIT9999  RETURN
+
.-----------------------------------------------------------------------
. Output Select Options for service doctor depending on medical practice
.-----------------------------------------------------------------------
SELDOC00  CALL      XMLHED00
          BRANCH    EXIT,SELDOC99
.
          WRITE     HTMLFILE;"<RETURN_VALUE TYPE=SIMPLE>";
          PACK      SKEY10,SP20
          PACK      KEY22,VALDCODE,SP20
          CALL      RSPRDO1
SELDOC10  CALL      RKPRDO1
          BRANCH    OVRCD,SELDOC90
          MATCH     VALDCODE,PRDOPRAC
          GOTO      SELDOC90 IF NOT EQUAL      * not same medical practice
          BRANCH    PRDOSTAT,SELDOC10          * inactive
.
          MATCH     SP70,PRDODOCT
          GOTO      SELDOC10 IF EQUAL
.
          MATCH     SP70,SKEY10
          GOTO      SELDOC40 IF NOT EQUAL
.
          GOTO      SELDOC60
.
SELDOC40  PACK      KEY10,PRDODOCT,SP70
          MATCH     SKEY10,KEY10
          GOTO      SELDOC10 IF EQUAL
.
SELDOC60  PACK      SKEY10,PRDODOCT,SP70
          MOVE      SP25,KEY25
          PACK      KEY10,PRDODOCT,SP70
          CALL      RDPMHCP1
          BRANCH    OVRCD,SELDOC80
.
          MOVE      "1",PACFRMT
          MOVE      PMHCTITL,PACTITLE
          MOVE      PMHCSNAM,PACSNAME
          MOVE      PMHCGNAM,PACGNAME
          CALL      PACNAME
          MOVE      PACFNAME,KEY25
.
SELDOC80  PACK      KEY14,QUOTE,PRDODOCT,QUOTE
          WRITE     HTMLFILE;PRDODOCT,",",KEY25,"|";
          GOTO      SELDOC10
.
SELDOC90  WRITE     HTMLFILE;"</RETURN_VALUE>"
          GOTO      SELDOC98
.
SELDOC98  CALL      XMLEND00
SELDOC99  RETURN
+
.------------------------------------------------------------
. Validate Payee provider
.------------------------------------------------------------
VALDPY00  CALL      XMLHED00
          BRANCH    EXIT,VALDPY99
.
          PACK      KEY6,VALDMPRA,SP70
          CALL      RDPRPR1
          BRANCH    OVRCD,VALDPY90
.
          MATCH     PRPRPYEE,PAYEPROV
          GOTO      VALDPY90 IF NOT EQUAL
.
          WRITE     HTMLFILE;"<RETURN_VALUE TYPE=SIMPLE>":
                             PRPRDESC,"|",PRPRPYEE:
                             "</RETURN_VALUE>"
          GOTO      VALDPY98
.
VALDPY90  WRITE     HTMLFILE;"<RETURN_VALUE TYPE=ERROR>":
                             "Invalid Payee Provider for Medical Practice - ":
                             VALDMPRA,"</RETURN_VALUE>"
          GOTO      VALDPY98
.
VALDPY98  CALL      XMLEND00
VALDPY99  RETURN
+
.------------------------------------------------------------
. Validate Service provider
.------------------------------------------------------------
VALDSV00  CALL      XMLHED00
          BRANCH    EXIT,VALDSV99
.
          PACK      KEY22,VALDMPRA,SP70
          CALL      RSPRDO1
VALDSV10  CALL      RKPRDO1
          BRANCH    OVRCD,VALDSV90
          MATCH     PRDOPRAC,VALDMPRA       * check medical practice
          GOTO      VALDSV90 IF NOT EQUAL
.
          MATCH     SP70,SERVPROV
          IF        !@EQUAL
            MATCH     PRDOPROV,SERVPROV
            GOTO      VALDSV10 IF NOT EQUAL
          ENDIF
          WRITE     HTMLFILE;"<RETURN_VALUE TYPE=SIMPLE>":
                             PRDODOCT,"|",PRDOPROV:
                             "</RETURN_VALUE>"
          GOTO      VALDSV98
.
VALDSV90  WRITE     HTMLFILE;"<RETURN_VALUE TYPE=ERROR>":
                             "Invalid Service Provider for Medical Practice - ":
                             VALDMPRA,"</RETURN_VALUE>"
          GOTO      VALDSV98
.
VALDSV98  CALL      XMLEND00
VALDSV99  RETURN
+
.------------------------------------------------------------
.         Reset batch
.------------------------------------------------------------
RBAT0000  PACK      KEY8,HCBTBTCH,SP70
          CALL      RSHCERR1
          CALL      RKHCERR1
          BRANCH    OVRCD,RBAT1000
.
.         Delete exception error records
.
          MATCH     HCBTBTCH,HCERBTCH
          GOTO      RBAT1000 IF NOT EQUAL
          PACK      KEY8,HCERBTCH,HCERLCNT
          CALL      DEHCERR1
          GOTO      RBAT0000
.
.         Initialise all received, rejected and adjustment amount
.
RBAT1000  CALL      INTA0000                * Initialise Receive and Reject amt
.
          MOVE      SP70,SAVESTAT           * History Status
          MOVE      " 0",HCBTSTAT
          MOVE      SP70,HCBTTDAT
          UNPACK    SP70,HCBTHCOP,HCBTCMNT,HCBTEFNM,HCBTSENT
          MOVE      ZERO,HCBTAMTR              * Total amount Received
          MOVE      ZERO,HCBTWOFF              * total amount of Write off
          MOVE      ZERO,HCBTREJA              * Total amount Rejected
          MOVE      ZERO,HCBTADJM              * total amount of adjustment
          MOVE      SP70,HCBTFNDR              * Date Funds Received
          PACK      HCBTDATE,CCC,CYY,CMM,CDD   * set batch date to current
          REP       " 0",HCBTDATE
.
          PACK      HCBTUDAT,CCC,CYY,CMM,CDD
          REP       " 0",HCBTUDAT
          CLOCK     TIME,HCBTUTIM           * time updated
          MOVE      USERID,HCBTUUID         * web user id
          CALL      UPHCBTC1                * update batch file
          CALL      WRTHIS00                  * Histroy Audit
.
RBAT9999  RETURN
+
.-------------------------------------------------------------------------
. Initialise all amount of received,rejected and  adjustment for the batch
.-------------------------------------------------------------------------
INTA0000  PACK      KEY15,HCBTBTCH,SP70
          CALL      RSHCCLM7
INTA1000  CALL      RKHCCLM7
          BRANCH    OVRCD,INTA9999
          MATCH     HCCLBTCH,HCBTBTCH         * Same batch number
          GOTO      INTA9999 IF NOT EQUAL
.
          PACK      KEY18,HCCLCLMN,HCCLVISN,SP70
          CALL      RSHCCIT1
INTA2000  CALL      RKHCCIT1
          BRANCH    OVRCD,INTA4000
          MATCH     HCCLCLMN,HCCICLMN   * Same claim number?
          GOTO      INTA4000 IF NOT EQUAL
          MATCH     HCCLVISN,HCCIVISN   * Same visit number?
          GOTO      INTA4000 IF NOT EQUAL
.
          MOVE      ZERO,HCCIRCVA       * received amount
          MOVE      ZERO,HCCIREJA       * rejected amount
          MOVE      ZERO,HCCIWOFF       * write off amount
          MOVE      ZERO,HCCIADJM       * adjustment amount
          UNPACK    SP70,HCCIREJD,HCCIREJR
          CALL      UPHCCIT1
          GOTO      INTA2000
.
INTA4000  MOVE      ZERO,HCCLRCVA       * Received amount
          MOVE      ZERO,HCCLREJA       * rejected amount
          MOVE      ZERO,HCCLWOFF       * write off amount
          MOVE      ZERO,HCCLADJM       * adjustment amount
          UNPACK    SP70,HCCLRECP
          CALL      UPHCCLM7
          GOTO      INTA1000            * get next claim
.
INTA9999  RETURN
+
.-----------------------------------------------------------------------------.
.         Initialise status
.-----------------------------------------------------------------------------.
INST0000  PACK      KEY15,SRCHBTCH,SP70
          CALL      RSHCCLM7
INST1000  CALL      RKHCCLM7
          BRANCH    OVRCD,INST9999
.
          MATCH     SRCHBTCH,HCCLBTCH        * Same Batch number?
          GOTO      INST9999 IF NOT EQUAL
.
          MATCH     "1",BTCHFLAG
          GOTO      INST9999 IF EQUAL        * just get first record for prov
.
          MATCH     "98",HCCLSTAT            * check if Status was on hold
          GOTO      INST2000 IF NOT EQUAL
          MOVE      " 2",HCCLSTAT            * set status back to on hold
          GOTO      INST4000
.
INST2000  MATCH     "99",HCCLSTAT            * check if Status was excluded
          GOTO      INST1000 IF NOT EQUAL
          MOVE      " 0",HCCLSTAT      * set Status back to printed
.
INST4000  CALL      UPHCCLM7
          GOTO      INST1000
.
INST9999  RETURN
+
.------------------------------------------------------------
.         Resubmit individual claim
.------------------------------------------------------------
RSUB0000  MOVE      ZERO,RECNUM
          MOVE      ZERO,FORM12P2
          MOVE      ZERO,EXIT
          MOVE      SP70,BTCHDATE
          MOVE      SP70,BTCHPNUM
          UNPACK    SP70,NEWCLAIM,CLMNBTCH
          MOVE      ZERO,RECCNT
          PACK      KEY18,CLMNNUMB,ADMISSNO,SP70
          CALL      RSHCCIT1
RSUB1000  CALL      RKHCCIT1
          BRANCH    OVRCD,RSUB9000
          MATCH     CLMNNUMB,HCCICLMN    * same claim number?
          GOTO      RSUB9000 IF NOT EQUAL
          MATCH     ADMISSNO,HCCIVISN    * same visit number?
          GOTO      RSUB9000 IF NOT EQUAL
.
          PACK      SKEY18,CLMNNUMB,ADMISSNO,HCCITRAN
          ADD       ONE,RECCNT
          MATCH     SP70,HCCIRDAT
          GOTO      RSUB1000 IF NOT EQUAL      * already been resubmitted
.
          MOVE      ZERO,FORM1
          MOVE      RESUB[RECCNT],FORM1
          COMPARE   "1",FORM1
          GOTO      RSUB1000 IF NOT EQUAL      * not ticked for resubmit
.
.         Only generate a new claim and batch number once
.
          ADD       ONE,RECNUM
          COMPARE   ONE,RECNUM
          GOTO      RSUB1200 IF NOT EQUAL
.
          PACK      KEY33,HCCIBTCH,HCCIPSRV,HCCIPMCI,HCCIPYEE
          CALL      RDHCBTC1
          IF        OVRCD=0
            MOVE      HCBTDATE,BTCHDATE
            MOVE      HCBTBTCH,BTCHPNUM
          ENDIF
.
.         If an item found in outbit that hasn't been been batched,
.         then use the same claim and batch number
.
          CALL      CITM0000
          IF        EXIT=1
            MOVE      HCCLCLMN,NEWCLAIM        * use current claim
            MOVE      HCCLBTCH,CLMNBTCH
          ELSE
            CALL      GCLM0000                 * Generate next claim number
            MOVE      ZERO,GNXBFLAG
            CALL      GBCN0000                 * Generate next batch number
          ENDIF
.
RSUB1200  MOVE      ZERO,HCCIREJA
          MOVE      ZERO,HCCIWOFF
          MOVE      ZERO,HCCIADJM
          PACK      HCCIRDAT,CCC,CYY,CMM,CDD
          REP       " 0",HCCIRDAT              * set resubmit date to current
          CALL      UPHCCIT1
.
.         Write the claim item record back with new claim and batch number
.
          PACK      KEY18,NEWCLAIM,HCCIVISN,HCCITRAN,SP70
          CALL      RAHCCIT1
          IF        OVRCD=1
            MOVE      NEWCLAIM,HCCICLMN
            MOVE      CLMNBTCH,HCCIBTCH        * new batch number
            MOVE      ZERO,HCCIRCVA
            MOVE      ZERO,HCCIREJA
            MOVE      ZERO,HCCIWOFF
            MOVE      ZERO,HCCITRIN
            MOVE      ZERO,HCCIADJM
            UNPACK    SP70,HCCIREJR,HCCIREJD,HCCIRWOF,HCCIWOFD,HCCITRND
            UNPACK    SP70,HCCIRDAT,HCCIADJR,HCCIADJD,HCCIIPOS
            PACK      HCCICDAT,CCC,CYY,CMM,CDD
            REP       " 0",HCCICDAT
            CLOCK     TIME,HCCICTIM
            MOVE      USERID,HCCICUID
            UNPACK    SP70,HCCIUDAT,HCCIUTIM,HCCIUUID
            CALL      WRHCCIT1
            ADD       HCCICAMT,FORM12P2        * accummulate claimed item amnt
          ENDIF
.
.         Update status for outbitaf file to zero
.
          PACK      SKEY22,ADMISSNO,HCCIIFLG,HCCIITMN,HCCISUBN
          PACK      KEY24,SKEY22,HCCITRAN
          CALL      RDOTBIT2
          COMPARE   ZERO,OVRCD
          GOTO      RSUB5000 IF EQUAL
.
.         Loop through the file to find the item with status of 'Batched'
.
          PACK      KEY24,SKEY22,SP70
          CALL      RSOTBIT2
RSUB2000  CALL      RKOTBIT2
          BRANCH    OVRCD,RSUB6000
          PACK      KEY22,OTBIVISN,OTBIIFLG,OTBIITMN,OTBISUBN
          MATCH     KEY22,SKEY22
          GOTO      RSUB6000 IF NOT EQUAL
          MATCH     "1",OTBISTAT
          GOTO      RSUB2000 IF NOT EQUAL
.
RSUB5000  MOVE      "0",OTBISTAT             * set status back to 'Not batched'
          CALL      UPOTBIT2
.
RSUB6000  MOVE      SKEY18,KEY18             * reposition
          CALL      RDHCCIT1
          GOTO      RSUB1000
.
RSUB9000  COMPARE   ZERO,RECNUM
          GOTO      RSUB9200 IF EQUAL        * no item being resubmitted
          CALL      WCLM0000                 * Wrt a rec for new claim number
          MOVE      ZERO,EXIT
          GOTO      RSUB9999
.
RSUB9200  MOVE      ONE,EXIT
RSUB9999  RETURN
+
.------------------------------------------------------------
.         Check if any other item that hasn't been batched
.------------------------------------------------------------
CITM0000  MOVE      ZERO,EXIT
          PACK      KEY16,ADMISSNO,Z70
          CALL      RSHCCLM2
CITM1000  CALL      RPHCCLM2
          BRANCH    OVRCD,CITM9999
          MATCH     ADMISSNO,HCCLVISN        * Same visit no?
          GOTO      CITM9999 IF NOT EQUAL
          MATCH     " 0",HCCLSTAT
          GOTO      CITM1000 IF NOT EQUAL
          MOVE      ONE,EXIT                 * found item not batched
CITM9999  RETURN
+
.------------------------------------------------------------
.   Write a new record for the new claim number  
.------------------------------------------------------------
WCLM0000  PACK      KEY8,CLMNNUMB            * read the old claim number
          CALL      RDHCCLM1
          BRANCH    OVRCD,WCLM9999
.
          MOVE      NEWCLAIM,HCCLCLMN        * new claim number
          MOVE      CLMNBTCH,HCCLBTCH        * new batch number
.
          MOVE      ZERO,HCCLMITM            * default to one item
          IF        RECNUM>1
            MOVE      ONE,HCCLMITM           * Multiple items
          ENDIF
.
          MOVE      " 0",HCCLSTAT            * Status of Printed
          MOVE      BTCHDATE,HCCLPBAT        * Date previously batched
          MOVE      BTCHPNUM,HCCLPNUM        * Batch number previously batched
          MOVE      FORM12P2,HCCLCAMN        * total amount claimed
          MOVE      ZERO,HCCLRCVA
          MOVE      ZERO,HCCLREJA
          MOVE      ZERO,HCCLWOFF
          MOVE      ZERO,HCCLADJM
          MOVE      ZERO,HCCLTRIN
          PACK      HCCLCDAT,CCC,CYY,CMM,CDD
          REP       " 0",HCCLCDAT
          CLOCK     TIME,HCCLCTIM
          MOVE      USERID,HCCLCUID
          MOVE      "00",HCCLVPOS
.
          UNPACK    SP70,HCCLUDAT,HCCLUTIM,HCCLUUID
          PACK      HCCLSPAR,SP70
.
          PACK      KEY8,HCCLCLMN
          CALL      RDHCCLM1
          IF        OVRCD=1
            CALL      WRHCCLM1
          ELSE
            MOVE      ONE,HCCLMITM             * Multiple items
            ADD       FORM12P2,HCCLCAMN        * total amount claimed
            MOVE      USERID,HCCLUUID
            CALL      UPHCCLM1
          ENDIF
.
WCLM9999  RETURN
+
.------------------------------------------------------------
.  Transfer item to invoice
.------------------------------------------------------------
TRIT0000  MOVE      ZERO,EXIT
          OPEN      PRIHREF1,"prihreff"          * Holding Referral file
          OPEN      PRIHDBT1,"prihdbtf"          * Holding Header file
          MOVE      ONE,PRHDSCAN
          PACK      KEY27,URNUMBER,PRHDSCAN,Z70
          CALL      RSPRHD1
TRIT1000  CALL      RPPRHD1
          BRANCH    OVRCD,TRIT9000
          MATCH     PRHDDEBT,URNUMBER       * Same U/R number ?
          GOTO      TRIT9000 IF NOT EQUAL
.
          PACK      KEY27,PRHDUNIQ,Z70
          CALL      RSPRHR1
          CALL      RPPRHR1
          BRANCH    OVRCD,TRIT1000
.
          COMPARE   PRHRUNIQ,PRHDUNIQ
          GOTO      TRIT1000 IF NOT EQUAL   * different unique number
          MATCH     PRHRPRAC,HCCLMPRA       * same medical practice?
          GOTO      TRIT1000 IF NOT EQUAL
.
          CALL      GTRN0000                * Get last trans number
          MOVE      ONE,PRHRPINV            * invoice to be printed
          CALL      UPPRHR1
.
          CALL      WRIT0000                * write item to transaction file
          MOVE      ZERO,EXIT
          GOTO      TRIT9999
.
TRIT9000  MOVE      ONE,EXIT
TRIT9999  RETURN
+
.**********************************************************************
.      Get last transaction number
.**********************************************************************
GTRN0000  MOVE      ZERO,FORM3
          OPEN      PRIHTRA1,"prihtraf"          * Holding Transaction file
          OPEN      PRIHTRA3,"prihtraf"          * Holding Transaction file
          IF        PRCNRDOC = 1
            PACK      KEY62,PRHRUNIQ,PRHRPRAC,PRHRDOCT,PRHRPIND:
                            PRHRREFD,PRHRRDAT,Z70
          ELSE
            PACK      KEY62,PRHRUNIQ,PRHRPRAC,PRHRDOCT,PRHRPIND,Z70
          ENDIF
          CALL      RSPRHT3                      * position in trans. file
          CALL      RPPRHT3                      * read trans. record
          BRANCH    OVRCD,GTRN9000               * end of file
.
          MATCH     DPRHRUNQ,DPRHTUNQ            * same unique identifier ?
          GOTO      GTRN9000 IF NOT EQUAL        * no
.
          MATCH     PRHRPRAC,PRHTPRAC            * same medical practice ?
          GOTO      GTRN9000 IF NOT EQUAL        * no
.
          MATCH     PRHRDOCT,PRHTDOCT            * same service doctor ?
          GOTO      GTRN9000 IF NOT EQUAL        * no
.
          MATCH     PRHRPIND,PRHTPIND            * same patient indicator ?
          GOTO      GTRN9000 IF NOT EQUAL        * no
.
          IF        PRCNRDOC = 1
             MATCH     PRHRREFD,PRHTREFD         * same referring doctor ?
             GOTO      GTRN9000 IF NOT EQUAL     * no
             MATCH     PRHRRDAT,PRHTRDAT         * same referral date?
             GOTO      GTRN9000 IF NOT EQUAL     * no
          ENDIF
          MOVE      PRHTNUMB,FORM3
.
GTRN9000  ADD       ONE,FORM3                  * next available trans no
GTRN9999  RETURN
+
.------------------------------------------------------------
.  Write item to transaction file
.------------------------------------------------------------
WRIT0000  CALL      CLPRIHTR
.
          MOVE      PRHDUNIQ,PRHTUNIQ
          MOVE      PRHRPRAC,PRHTPRAC
          MOVE      PRHRDOCT,PRHTDOCT
          MOVE      PRHRPIND,PRHTPIND
.
          MOVE      HCCIIFLG,PRHTFLAG
          MOVE      HCCIITMN,PRHTITMN
          MOVE      HCCISUBN,PRHTSUBN
          MOVE      FORM3,PRHTNUMB
.
          MOVE      HCCIIDAT,PRHTDATE      * Service date
          MOVE      SP70,PRHTTIME
          MOVE      "1",PRHTSERN
          MOVE      HCCIIDES,PRHTIDES
          MOVE      HCCICAMT,PRHTIAMT
.
          IF        PRCNRDOC = 1
            MOVE      SP70,PRHTREFD
            MOVE      SP70,PRHTRDAT
            MOVE      SP70,PRHTREFT
          ELSE
            MOVE      PRHRREFD,PRHTREFD
            MOVE      PRHRRDAT,PRHTRDAT
            MOVE      SP70,PRHTREFT
          ENDIF
          MOVE      PRHRRFPD,PRHTRFPD
          MOVE      HCCIVISN,PRHTREFN
          PACK      PRHTHICI,HCCICLMN,HCCIVISN,HCCITRAN
.
          PACK      KEY62,PRHTUNIQ,PRHTPRAC,PRHTDOCT,PRHTPIND,PRHTREFD:
                          PRHTRDAT,PRHTFLAG,PRHTITMN,PRHTSUBN,PRHTNUMB
          CALL      WRPRHT1                      * write transaction record
WRIT9999  RETURN
+
.------------------------------------------------------------
.  Update status of batch file
.------------------------------------------------------------
UPBT0000  PACK      KEY33,HCCLBTCH,HCCLPSRV,HCCLPMCI,HCCLPYEE
          CALL      RDHCBTC1
          BRANCH    OVRCD,UPBT9999
          CALL      CADJ0000                  * Calculate total adjustments
          MOVE      HCBTSTAT,SAVESTAT         * History Status
          MOVE      " 8",HCBTSTAT             * Actioned
          PACK      HCBTUDAT,CCC,CYY,CMM,CDD
          REP       " 0",HCBTUDAT
          CLOCK     TIME,HCBTUTIM           * time updated
          MOVE      USERID,HCBTUUID         * web user id
          CALL      UPHCBTC1
          CALL      WRTHIS00                  * Histroy Audit
.
UPBT9999  RETURN
+
.------------------------------------------------------------
. Add up all adjustment for the batch
.------------------------------------------------------------
CADJ0000  MOVE      ZERO,HCBTAMTR
          MOVE      ZERO,HCBTREJA
          MOVE      ZERO,HCBTWOFF
          MOVE      ZERO,HCBTADJM
          MOVE      ZERO,HCBTTRIN
          MOVE      ZERO,HCBTCAMT
          MOVE      ZERO,HCBTSIZE
          PACK      KEY15,HCBTBTCH,SP70
          CALL      RSHCCLM7
CADJ1000  CALL      RKHCCLM7
          BRANCH    OVRCD,CADJ9999
          MATCH     HCCLBTCH,HCBTBTCH         * Same batch number
          GOTO      CADJ9999 IF NOT EQUAL
.
          ADD       HCCLRCVA,HCBTAMTR
          ADD       HCCLREJA,HCBTREJA
          ADD       HCCLWOFF,HCBTWOFF
          ADD       HCCLADJM,HCBTADJM
          ADD       HCCLTRIN,HCBTTRIN
          ADD       HCCLCAMN,HCBTCAMT
          ADD       ONE,HCBTSIZE
          GOTO      CADJ1000
.
CADJ9999  RETURN
+
.------------------------------------------------------------
. List of claims
.------------------------------------------------------------
UPDCLM00  CMATCH    "R",UPDATETY             * Rejected claim?
          GOTO      UPDCLM30 IF NOT EQUAL    * No
.
          PACK      HCCIREJD,CCC,CYY,CMM,CDD
          REP       " 0",HCCIREJD            * Rejection date
.
          SUB       HCCIREJA,HCCLREJA
          ADD       HCCLM001,HCCLREJA        * total rejected amount for claim
.
          MOVE      HCCLM001,HCCIREJA        * Update Rejected amount
.
          MATCH     Z70,HCCLM002
          IF        !@EQUAL
            MOVE      HCCLM002,HCCIREJR      * Reason for Rejection
          ENDIF
          GOTO      UPDCLM80
.
UPDCLM30  CMATCH    "J",UPDATETY             * Adjustment claim ?
          GOTO      UPDCLM40 IF NOT EQUAL
.
          PACK      HCCIADJD,CCC,CYY,CMM,CDD
          REP       " 0",HCCIADJD            * Adjustment off date
.
          SUB       HCCIADJM,HCCLADJM
          ADD       HCCLM006,HCCLADJM        * total Adjustment amount for claim
.
          MOVE      HCCLM006,HCCIADJM        * Update Adjustment amount
          MATCH     Z70,HCCLM007
          IF        !@EQUAL
            MOVE      HCCLM007,HCCIADJR      * Reason for Adjustment
          ENDIF
          GOTO      UPDCLM80
.
UPDCLM40  PACK      HCCIWOFD,CCC,CYY,CMM,CDD
          REP       " 0",HCCIWOFD            * Write off date
.
          SUB       HCCIWOFF,HCCLWOFF
          ADD       HCCLM003,HCCLWOFF        * total write off amount for claim
.
          MOVE      HCCLM003,HCCIWOFF        * Update Write off amount
          MATCH     Z70,HCCLM004
          IF        !@EQUAL
            MOVE      HCCLM004,HCCIRWOF      * Reason for Write off
          ENDIF
          GOTO      UPDCLM80
.
.
.         Check if total adjustment is greater than item amount
.
UPDCLM80  MOVE      HCCIREJA,FORM12P2
          SUB       HCCIWOFF,FORM12P2
          ADD       HCCIADJM,FORM12P2
          COMPARE   FORM12P2,HCCICAMT          
          GOTO      UPDCLM90 IF LESS         * Invalid amount
          MOVE      ZERO,EXIT
          GOTO      UPDCLM99
.
UPDCLM90  MOVE      ONE,EXIT
          GOTO      UPDCLM99
.
UPDCLM99  RETURN
+
.------------------------------------------------------------
. List of claims
.------------------------------------------------------------
CLMLST00  MOVE      URNUMBER,KEY8
          CALL      RDMAST1
          IF        OVRCD=1
            CALL      CLPATMAS
          ENDIF
.
CLMLST90  CLEAR     WEBTITLE
          MOVE      "Claims List",WEBTITLE
          RESET     WEBTITLE
.
          CALL      WEBHED00   * Create Output File and Write HTML Page Header
          BRANCH    EXIT,CLMLST99
          CALL      WEBBOD00   * Process Web Body
          CALL      WEBEND00   * Process End of HTML File
.
          MOVE      ONE,EXIT
          GOTO      CLMLST99
.
CLMLST99  RETURN
.------------------------------------------------------------
. Process Fields 
.------------------------------------------------------------
PROFLD00  BRANCH    REPORTNO,PROFLD10,PROFLD20,PROFLD30
.
          GOTO      PROFLD99 
.
PROFLD10  BRANCH    FLDSETNO,PROFLD11,PROFLD12,PROFLD13,PROFLD14
          GOTO      PROFLD99
.
PROFLD11  CALL      HCCL0000    * Claim 
          GOTO      PROFLD99
.
PROFLD12  CALL      HCBT0000    * Batch
          GOTO      PROFLD99
.
PROFLD13  CALL      CLMM0000    * Claim List
          GOTO      PROFLD99
.
PROFLD14  CALL      BATC0000    * Batch List
          GOTO      PROFLD99
.
PROFLD20  BRANCH    FLDSETNO,PROFLD21,PROFLD22
          GOTO      PROFLD99
.
PROFLD21  CALL      MASF0000
          GOTO      PROFLD99
.
PROFLD22  CALL      CLIS0000    * Claim list
          GOTO      PROFLD99
.
PROFLD30  BRANCH    FLDSETNO,PROFLD31,PROFLD32,PROFLD33,PROFLD34,PROFLD35:
                             PROFLD36
          GOTO      PROFLD99
.
PROFLD31  CALL      MASF0000                * PMI
          GOTO      PROFLD99
.
PROFLD32  CALL      PMIX0000                * PMI ext2
          GOTO      PROFLD99
.
PROFLD33  CALL      ALRE0000                * Referral
          GOTO      PROFLD99
.
PROFLD34  CALL      MSXF0000                * PMI ext
          GOTO      PROFLD99
.
PROFLD35  CALL      HCCL0000                * Claim file
          GOTO      PROFLD99
.
PROFLD36  CALL      GTAG0000                * General tags 
          GOTO      PROFLD99
.
PROFLD99  RETURN
.
.*******************************************************************************
.                          Claim List
.*******************************************************************************
CLMM0000  BRANCH    FLDITMNO,CLMM0100,CLMM0200,CLMM0300,CLMM0400,CLMM0500:
                             CLMM0600,CLMM0700,CLMM0800,CLMM0900,CLMM1000:
                             CLMM1100,CLMM1200,CLMM1300,CLMM1400,CLMM1500:
                             CLMM1600,CLMM1700,CLMM1800,CLMM1900,CLMM2000:
                             CLMM2100,CLMM2200,CLMM2300,CLMM2400,CLMM2500:
                             CLMM2600,CLMM2700,CLMM2800,CLMM2900,CLMM3000:
                             CLMM3100,CLMM3200,CLMM3300,CLMM3400,CLMM3500:
                             CLMM3600,CLMM3700
          GOTO      CLMM9999
.
.         Clinic type
.
CLMM0100  MATCH     SP70,SRCHCLTY
          GOTO      CLMM9999 IF EQUAL
          WRITE     HTMLFILE;SRCHCLTY;
          GOTO      CLMM9999
.
.         Clinic Id
.
CLMM0200  UNPACK    DIM127,D1,KEY1,DIM127
          MOVE      ZERO,F1
          MOVE      KEY1,F1
          MATCH     SP70,SRCHCLID
          GOTO      CLMM9999 IF EQUAL
.
          BRANCH    F1,CLMM0210
.
          PACK      KEY20,WBSESIT,SRCHCLID,Z70
          CALL      RDSCLIA1          * Read Clinic Record
          CALL      RDPCLIA1          * Read Clinic Record
          BRANCH    OVRCD,CLMM0290
.
          WRITE     HTMLFILE;OCADESC;
          GOTO      CLMM0290
.
CLMM0210  WRITE     HTMLFILE;SRCHCLID;
          GOTO      CLMM9999
.
CLMM0290  PACK      KEY20,WBSESIT,SRCHCLID,Z70
          CALL      RDSCLIA1          * Read Clinic Record
          CALL      RDPCLIA1          * Read Clinic Record
          GOTO      CLMM9999
.
CLMM0300  CALL      CBTC0000          * Claim list
          GOTO      CLMM9999
.
CLMM0400  WRITE     HTMLFILE;UPDATETY;  
          GOTO      CLMM9999
.
CLMM0500  WRITE     HTMLFILE;BTCHNUMB;  
          GOTO      CLMM9999
.
CLMM0600  WRITE     HTMLFILE;TOTBAMNT;  
          GOTO      CLMM9999
.
CLMM0700  WRITE     HTMLFILE;ADMISSNO;  
          GOTO      CLMM9999
.
CLMM0800  WRITE     HTMLFILE;SRCHPROV;  
          GOTO      CLMM9999
.
CLMM0900  WRITE     HTMLFILE;SRCHBTCH;  
          GOTO      CLMM9999
.
CLMM1000  WRITE     HTMLFILE;SHWBATCH;  
          GOTO      CLMM9999
.
CLMM1100  WRITE     HTMLFILE;BTCHFLAG;  
          GOTO      CLMM9999
.
CLMM1200  MATCH     KEYINDAT,SP70
          GOTO      CLMM9999 IF EQUAL
.
          UNPACK    KEYINDAT,CCENT,CYEAR,CMON,CDAY
          MOVE      CMON,F2
          LOAD      MTHNAM3,F2,JAN,FEB,MAR,APR,MAY,JUN,JUL,AUG,SEP,OCT,NOV,DEC
          WRITE     HTMLFILE;CDAY,SP1,MTHNAM3,SP1,CCENT,CYEAR;
          GOTO      CLMM9999
.
CLMM1300  WRITE     HTMLFILE;SRCHSTAT;
          GOTO      CLMM9999
.
CLMM1400  WRITE     HTMLFILE;CLMNNUMB;
          GOTO      CLMM9999
.
CLMM1500  CALL      CLIT0000             * List of items claimed
          GOTO      CLMM9999
.
CLMM1600  MOVE      HCCIREJR,CODE        * Reason for Reject 
          CALL      REJSEL00
          GOTO      CLMM9999
.
CLMM1700  MOVE      "HE",CATEGORY
          MOVE      HCCIRWOF,CODE        * Reason for Write off
          CALL      CODITM00
          GOTO      CLMM9999
.
CLMM1800  UNPACK    DIM127,D1,KEY1,DIM127
          MOVE      ZERO,F1
          MOVE      KEY1,F1
          BRANCH    F1,CLMM1810
          WRITE     HTMLFILE;URNUMBER;
          GOTO      CLMM9999
.
CLMM1810  MOVE      "&nbsp;",PATFNAME
          PACK      KEY8,URNUMBER,SP70
          CALL      RDMAST1
          BRANCH    OVRCD,CLMM1820
          CALL      PATNAM00
CLMM1820  WRITE     HTMLFILE;PATFNAME;
          GOTO      CLMM9999
.
CLMM1900  WRITE     HTMLFILE;HCCIREJA;
          GOTO      CLMM9999
.
CLMM2000  COMPARE   ZERO,HCCIWOFF
          GOTO      CLMM9999 IF EQUAL
.
          WRITE     HTMLFILE;HCCIWOFF;
          GOTO      CLMM9999
.
CLMM2100  MOVE      ZERO,FORM12P2
          MOVE      HCCLCAMN,FORM12P2
          SUB       HCCLRCVA,FORM12P2
          COMPARE   ZERO,FORM12P2
          GOTO      CLMM2120 IF EQUAL      * fully paid - no resubmit
.
.        Resubmit option should only be available after batch being Acknowledged
.
          MOVE      ZERO,FORM12P2          * default to 'No' resubmit option
          MOVE      ZERO,F2
          MOVE      HCBTSTAT,F2
          COMPARE   THREE,F2
          GOTO      CLMM2120 IF LESS
          MOVE      ONE,FORM12P2
.
.         MOVE      HCCLREJA,FORM12P2
.         SUB       HCCLWOFF,FORM12P2
.         ADD       HCCLADJM,FORM12P2
.
CLMM2120  WRITE     HTMLFILE;FORM12P2;
          GOTO      CLMM9999
.
CLMM2200  WRITE     HTMLFILE;ADMISSNO;
          GOTO      CLMM9999
.
CLMM2300  COMPARE   ZERO,HCCIADJM
          GOTO      CLMM9999 IF EQUAL
.
          WRITE     HTMLFILE;HCCIADJM;
          GOTO      CLMM9999
.
CLMM2400  MOVE      "HF",CATEGORY
          MOVE      HCCIADJR,CODE        * Reason for Adjustment
          CALL      CODITM00
          GOTO      CLMM9999
.
CLMM2500  CALL      GPRV0000           * Get provider name from batch number
          GOTO      CLMM9999           * for create batch screen           
.
CLMM2600  WRITE     HTMLFILE;CLAIMCNT;      * claim counter set in cbtc0000
          GOTO      CLMM9999
.
CLMM2700  MATCH     HCCLRECP,SP70
          GOTO      CLMM2720 IF EQUAL
          UNPACK    HCCLRECP,CCENT,CYEAR,CMON,CDAY
          MOVE      CMON,F2
          LOAD      MTHNAM3,F2,JAN,FEB,MAR,APR,MAY,JUN,JUL,AUG,SEP,OCT,NOV,DEC
          WRITE     HTMLFILE;CDAY,SP1,MTHNAM3,SP1,CCENT,CYEAR;
          GOTO      CLMM9999
.
CLMM2720  PACK      CDATE,CCC,CYY,CMM,CDD
          REP       " 0",CDATE
          UNPACK    CDATE,CCENT,CYEAR,CMON,CDAY
          MOVE      CMON,F2
          LOAD      MTHNAM3,F2,JAN,FEB,MAR,APR,MAY,JUN,JUL,AUG,SEP,OCT,NOV,DEC
          WRITE     HTMLFILE;CDAY,SP1,MTHNAM3,SP1,CCENT,CYEAR;
          GOTO      CLMM9999
.
CLMM2800  COMPARE   ZERO,HCCIRCVA
          GOTO      CLMM9999 IF EQUAL
.
          WRITE     HTMLFILE;HCCIRCVA;      * Received amount
          GOTO      CLMM9999
.
CLMM2900  PACK      KEY36,SP70
          CALL      RSPRPR2
CLMM2920  CALL      RKPRPR2
          BRANCH    OVRCD,CLMM9999
.
          MATCH     HCBTMPRA,PRPRCODE    * Default Medical practice
          IF        @EQUAL
            WRITE     HTMLFILE;"<option value=#"",PRPRCODE,"#" selected>":
                                 PRPRDESC,"</option>"
          ELSE
            WRITE     HTMLFILE;"<option value=#"",PRPRCODE,"#">":
                                 PRPRDESC,"</option>"
          ENDIF
          GOTO      CLMM2920
.
CLMM3000  CALL      PRDOC000                   * Doctors within Practice
.
CLMM3100  MOVE      SP70,SKEY10
          PACK      KEY6,HCBTMPRA             * check payee from medical prac.
          CALL      RDPRPR1
          BRANCH    OVRCD,CLMM3120
          MOVE      PRPRPYEE,SKEY10           * new payee
.
CLMM3120  WRITE     HTMLFILE;SKEY10;
          GOTO      CLMM9999
.
CLMM3200  REP       " 0",HCCIREJD
          UNPACK    HCCIREJD,CCENT,CYEAR,CMON,CDAY
          MOVE      CMON,F2
          LOAD      MTHNAM3,F2,JAN,FEB,MAR,APR,MAY,JUN,JUL,AUG,SEP,OCT,NOV,DEC
          WRITE     HTMLFILE;CDAY,SP1,MTHNAM3,SP1,CCENT,CYEAR;
          GOTO      CLMM9999
.
CLMM3300  PACK      KEY16,USERID,SP70
          CALL      RSPRSEC2
          CALL      RKPRSEC2
          BRANCH    OVRCD,CLMM9999
          MATCH     USERID,PRSEUSID        * Same user id?
          GOTO      CLMM9999 IF NOT EQUAL  * user access to all practices
. 
          WRITE     HTMLFILE;PRSEPRAC;
          GOTO      CLMM9999
.
CLMM3320  WRITE     HTMLFILE;SP70;
          GOTO      CLMM9999
.
CLMM3400  WRITE     HTMLFILE;SRCHPRAC;
          GOTO      CLMM9999
.
CLMM3500  WRITE     HTMLFILE;SRCHSDOC;
          GOTO      CLMM9999
.
CLMM3600  MOVE      SRCHPRAC,HCBTMPRA 
          CALL      PRDOC000                   * Doctors within Practice
          GOTO      CLMM9999
.
CLMM3700  UNPACK    DIM127,D1,KEY1,DIM127
          MOVE      ZERO,F1
          MOVE      KEY1,F1
.
          MATCH     SP70,SRCHBTCH
          GOTO      CLMM3705 IF NOT EQUAL
.
          MATCH     SP70,SRCHPROV
          GOTO      CLMM3705 IF NOT EQUAL
.
          MATCH     SP70,SRCHCLID
          IF        @EQUAL
            MATCH     SP70,WBSECLI
            IF        !@EQUAL
              MOVE      WBSECLI,SRCHCLID
            ENDIF
          ENDIF
.
          MATCH     SP70,SRCHCLID
          GOTO      CLMM9999 IF EQUAL
.
CLMM3705  BRANCH    F1,CLMM3710
.
          PACK      KEY20,WBSESIT,SRCHCLID,Z70
          CALL      RDSCLIA1          * Read Clinic Record
          CALL      RDPCLIA1          * Read Clinic Record
          BRANCH    OVRCD,CLMM3790
.
          WRITE     HTMLFILE;OCADESC;
          GOTO      CLMM3790
.
CLMM3710  WRITE     HTMLFILE;SRCHCLID;
          GOTO      CLMM9999
.
CLMM3790  PACK      KEY20,WBSESIT,SRCHCLID,Z70
          CALL      RDSCLIA1          * Read Clinic Record
          CALL      RDPCLIA1          * Read Clinic Record
          GOTO      CLMM9999
CLMM9999  RETURN
+
.------------------------------------------------------------
.         List of doctors within a medical practice
.------------------------------------------------------------
PRDOC000  PACK      SKEY10,SP20
          PACK      KEY22,HCBTMPRA,SP20
          CALL      RSPRDO1
PRDOC100  CALL      RKPRDO1
          BRANCH    OVRCD,PRDOC999
          MATCH     HCBTMPRA,PRDOPRAC
          GOTO      PRDOC999 IF NOT EQUAL      * not same medical practice
.
          MATCH     SP70,PRDODOCT
          GOTO      PRDOC100 IF EQUAL
          BRANCH    PRDOSTAT,PRDOC100          * inactive
.
          MATCH     SP70,SKEY10
          GOTO      PRDOC200 IF NOT EQUAL
.
          GOTO      PRDOC400
.
PRDOC200  PACK      KEY10,PRDODOCT,SP70
          MATCH     SKEY10,KEY10
          GOTO      PRDOC100 IF EQUAL
.
PRDOC400  PACK      SKEY10,PRDODOCT,SP70
          MOVE      SP25,KEY25
          PACK      KEY10,PRDODOCT,SP70
          CALL      RDPMHCP1
          BRANCH    OVRCD,PRDOC500
.
          MOVE      "1",PACFRMT
          MOVE      PMHCTITL,PACTITLE
          MOVE      PMHCSNAM,PACSNAME
          MOVE      PMHCGNAM,PACGNAME
          CALL      PACNAME
          MOVE      PACFNAME,KEY25
.
PRDOC500  PACK      KEY14,QUOTE,PRDODOCT,QUOTE
          WRITE     HTMLFILE;"<option value=",KEY14,">":
                    KEY25,"</option>"
          GOTO      PRDOC100
.
PRDOC999  RETURN
.
.------------------------------------------------------------
. Reason for Rejection Selection Options
.------------------------------------------------------------
REJSEL00  UNPACK    DIM127,D1,KEY1,DIM127
          MOVE      ZERO,F1
          MOVE      KEY1,F1
          BRANCH    F1,REJSEL05
          MOVE      CODE,KEY3        * Reason for Reject 
          CALL      RDHCEMS1
          BRANCH    OVRCD,REJSEL99
          WRITE     HTMLFILE;HCEMDESC;
          GOTO      REJSEL99
.
REJSEL05  MOVE      SP70,HCEMDESC
          PACK      KEY73,SP70,SP70
          CALL      RSHCEMS2
REJSEL10  CALL      RKHCEMS2
          BRANCH    OVRCD,REJSEL99
          MATCH     SP70,HCEMCODE
          GOTO      REJSEL10 IF EQUAL
          PACK      KEY5,QUOTE,HCEMCODE,QUOTE
          MATCH     CODE,HCEMCODE
          IF        @EQUAL
            WRITE     HTMLFILE;"<option value=",KEY5," selected>":
                               HCEMDESC," (",HCEMCODE,")","</option>"
          ELSE
            WRITE     HTMLFILE;"<option value=",KEY5,">":
                               HCEMDESC," (",HCEMCODE,")","</option>"
          ENDIF
          GOTO      REJSEL10
REJSEL99  RETURN
+
.------------------------------------------------------------
. List of items claimed
.------------------------------------------------------------
CLIT0000  CALL       CLHD0000
          MOVE       ZERO,RECCNT
          MOVE       CLMNNUMB,KEY8
          CALL       RDHCCLM1
          BRANCH     OVRCD,CLIT9999
.
.         For status of received, get received and rejected amount from
.         Exception file
.
          MOVE       SP70,HCBTSTAT
          MOVE       BATCHKEY,KEY33
          CALL       RDHCBTC1
          BRANCH     OVRCD,CLIT0800
          MATCH      " 5",HCBTSTAT
          GOTO       CLIT0400 IF EQUAL  * Received ok
          MATCH      " 6",HCBTSTAT
          GOTO       CLIT0400 IF EQUAL  * Received with error
          MATCH      " 7",HCBTSTAT
          GOTO       CLIT0800 IF NOT EQUAL  * no payment received
.
CLIT0400  MOVE       ZERO,HCCLRCVA      * paid amount
          MOVE       ZERO,HCCLREJA      * rejected amount
.
CLIT0800  PACK       KEY18,CLMNNUMB,ADMISSNO,SP70
          CALL       RSHCCIT1
CLIT1000  CALL       RKHCCIT1
          BRANCH     OVRCD,CLIT9000
          MATCH      CLMNNUMB,HCCICLMN   * Same claim number?
          GOTO       CLIT9000 IF NOT EQUAL
          MATCH      ADMISSNO,HCCIVISN   * Same visit number?
          GOTO       CLIT9000 IF NOT EQUAL
.
          MOVE       "MBS ",KEY4
          MATCH      " 1",HCCIIFLG
          IF         @EQUAL
            MOVE       "AMA ",KEY4
          ENDIF
          MOVE       "/",KEY1
.
          WRITE      HTMLFILE;"<tr><td>",KEY4,HCCIITMN,KEY1,HCCISUBN,"</td>";
.
          MATCH     SP70,HCCIIDAT
          IF        !@EQUAL
            UNPACK    HCCIIDAT,CCENT,CYEAR,CMON,CDAY
            MOVE      CMON,F2
            LOAD      MTHNAM3,F2,JAN,FEB,MAR,APR,MAY,JUN,JUL,AUG,SEP,OCT,NOV,DEC
            WRITE     HTMLFILE;"<td>&nbsp;",CDAY,SP1,MTHNAM3,SP1,CCENT,CYEAR:
                               "</td>";
          ELSE
            WRITE     HTMLFILE;"<td>&nbsp;</td>";
          ENDIF
.
          WRITE     HTMLFILE;"<td align=right>",HCCICAMT,"</td>";
          PACK      ITEMKEYS,HCCICLMN,HCCIVISN,HCCITRAN
.
          MATCH     " 5",HCBTSTAT
          GOTO      CLIT1030 IF EQUAL      * Received ok
          MATCH     " 6",HCBTSTAT
          GOTO      CLIT1030 IF EQUAL      * Received with errors
          MATCH     " 7",HCBTSTAT
          GOTO      CLIT1040 IF NOT EQUAL  * no payment received
.
.         Get payment and rejection amount from Exception file
.
CLIT1030  MOVE      ZERO,HCCIRCVA
          MOVE      ZERO,HCCIREJA
          PACK      KEY18,HCCICLMN,HCCIVISN,HCCITRAN,SP70
          CALL      RDHCRCI2
          BRANCH    OVRCD,CLIT1040
          MOVE      HCRIBENP,HCCIRCVA      * paid amount
          MOVE      HCRIBENR,HCCIREJA      * rejected amount
.
          ADD       HCRIBENP,HCCLRCVA      * paid amount
          ADD       HCRIBENR,HCCLREJA      * rejected amount
.
.         Can not Receive if batch has not been actioned
.
CLIT1040  WRITE     HTMLFILE;"<td align=right>&nbsp;",HCCIRCVA;
.
          MATCH      " 8",HCBTSTAT
          GOTO       CLIT1100 IF LESS         * not actioned yet
.
          WRITE     HTMLFILE;"<a HREF = 'javascript:Receive":
                             "(#"":
                             ITEMKEYS:
                             "#")'>":
                             "<img src=../images/DietIcon.gif":
                             " class=ListIcon></a></td>";
          GOTO      CLIT1120
.
CLIT1100  WRITE     HTMLFILE;"<img src=../images/DietIconTrans.gif":
                             " class=ListIcon>":
                             "</td>";
.
CLIT1120  WRITE     HTMLFILE;"<td align=right>&nbsp;",HCCIREJA;
.
          MATCH     " 8",HCBTSTAT
          GOTO      CLIT1160 IF LESS         * not actioned yet
.
          COMPARE   ZERO,HCCIREJA
          GOTO      CLIT1160 IF EQUAL        * No rejection
.
          WRITE     HTMLFILE;"<a HREF = 'javascript:Reject":
                             "(#"":
                             ITEMKEYS:
                             "#")'>":
                             "<img src=../images/DietIcon.gif":
                             " class=ListIcon></a></td>";
          GOTO      CLIT1180
.
CLIT1160  WRITE     HTMLFILE;"<img src=../images/DietIconTrans.gif":
                             " class=ListIcon>":
                             "</td>";
.
CLIT1180  WRITE      HTMLFILE;"<td align=right>&nbsp;",HCCIADJM;
.
          MATCH      " 8",HCBTSTAT
          GOTO       CLIT1200 IF LESS         * not actioned yet
.
          WRITE     HTMLFILE;"<a HREF = 'javascript:Adjustment":
                             "(#"":
                             ITEMKEYS:
                             "#")'>":
                             "<img src=../images/DietIcon.gif":
                             " class=ListIcon></a></td>";
          GOTO      CLIT1400
.
CLIT1200  WRITE     HTMLFILE;"<img src=../images/DietIconTrans.gif":
                             " class=ListIcon>":
                             "</td>";
.
CLIT1400  WRITE     HTMLFILE;"<td align=right>",HCCIWOFF;
.
          MATCH      " 8",HCBTSTAT
          GOTO       CLIT1600 IF LESS         * not actioned yet
.
          WRITE     HTMLFILE;"<a HREF = 'javascript:WriteOff":
                             "(#"":
                             ITEMKEYS:
                             "#")'>":
                             "<img src=../images/DietIcon.gif":
                             " class=ListIcon></a></td>";
          GOTO      CLIT1800
.
CLIT1600  WRITE     HTMLFILE;"<img src=../images/DietIconTrans.gif":
                             " class=ListIcon>":
                             "</td>";
.
CLIT1800  MATCH     " 8",HCBTSTAT
          GOTO      CLIT2000 IF LESS         * not actioned yet
.
          MATCH     SP70,HCCITRND
          GOTO      CLIT2000 IF NOT EQUAL
.
          WRITE     HTMLFILE;"<td align=right>":
                             "<a HREF = 'javascript:TranInv":
                             "(#"":
                             ITEMKEYS:
                             "#")'>":
                             "<img src=../images/DietIcon.gif":
                             " class=ListIcon></a></td>";
          GOTO      CLIT4000
.
CLIT2000  WRITE     HTMLFILE;"<td align=right>",HCCITRIN:
                             "<img src=../images/DietIconTrans.gif":
                             " class=ListIcon>":
                             "</td>";
.
CLIT4000  MATCH     SP70,HCCITRND
          IF        !@EQUAL
            UNPACK    HCCITRND,CCENT,CYEAR,CMON,CDAY
            MOVE      CMON,F2
            LOAD      MTHNAM3,F2,JAN,FEB,MAR,APR,MAY,JUN,JUL,AUG,SEP,OCT,NOV,DEC
            WRITE     HTMLFILE;"<td>&nbsp;",CDAY,SP1,MTHNAM3,SP1,CCENT,CYEAR:
                               "</td>";
          ELSE
            WRITE     HTMLFILE;"<td>&nbsp;</td>";
          ENDIF
          GOTO      CLIT6000
.
CLIT5000  WRITE     HTMLFILE;"<td>&nbsp;</td>":
                             "<td>&nbsp;</td>";
.
.         Disabled if it had been re-submitted
.
CLIT6000  ADD       ONE,RECCNT
          MOVE      RECCNT,DRECCNT
          REP       " 0",DRECCNT
.
          MATCH     SP70,HCCIRDAT
          IF        !@EQUAL
            WRITE     HTMLFILE;"<td align=center>":
                               "<input type=checkbox name=resub",DRECCNT:
                               " disabled checked></td>";
          ELSE
            WRITE     HTMLFILE;"<td align=center>":
                               "<input type=checkbox name=resub",DRECCNT:
                               " value=1 </td>";
          ENDIF
.
          WRITE      HTMLFILE;"</tr>";
          GOTO       CLIT1000
.
CLIT9000  WRITE      HTMLFILE;"<tr><td><b>Total:</b></td>":
                              "<td>&nbsp;</td>":
                              "<td align=right><b>",HCCLCAMN,"</b></td>":
                              "<td align=right><b>",HCCLRCVA:
                              "<img src=../images/DietIconTrans.gif":
                              " class=ListIcon>":
                              "</b></td>":
                              "<td align=right><b>",HCCLREJA:
                              "<img src=../images/DietIconTrans.gif":
                              " class=ListIcon>":
                              "</b></td>":
                              "<td align=right><b>",HCCLADJM:
                              "<img src=../images/DietIconTrans.gif":
                              " class=ListIcon>":
                              "</b></td>":
                              "<td align=right><b>",HCCLWOFF:
                              "<img src=../images/DietIconTrans.gif":
                              " class=ListIcon>":
                              "</b></td>";
.
          WRITE      HTMLFILE;"<td align=right>&nbsp;<b>",HCCLTRIN,"</b>":
                              "<img src=../images/DietIconTrans.gif":
                              " class=ListIcon>":
                              "</td>":
                              "<td>&nbsp;</td>":
                              "<td>&nbsp;</td></tr>"
.
CLIT9999  RETURN
+
.------------------------------------------------------------
. List of items claimed heading
.------------------------------------------------------------
CLHD0000  WRITE     HTMLFILE;"<tr valign=bottom>":
                             "<td class=HeadingCell align=left width=10%>":
                             "CMBS Item</td>":
                             "<td class=HeadingCell align=center width=10%>":
                             "Date of Service</td>":
                             "<td class=HeadingCell align=right width=10%>":
                             "Item <b> Amount</td>":
                             "<td class=HeadingCell align=right width=10%>":
                             "Amount <b> Received</td>":
                             "<td class=HeadingCell align=right width=10%>":
                             "Rejection <b> Amount</td>":
                             "<td class=HeadingCell align=right width=10%>":
                             "Adjustment Amount (+)</td>":
                             "<td class=HeadingCell align=right width=10%>":
                             "Write Off Amount (-)</td>":
                             "<td class=HeadingCell align=right width=10%>":
                             "Trans to Inv.</td>":
                             "<td class=HeadingCell align=center width=10%>":
                             "Trans Date</td>":
                             "<td class=HeadingCell align=center width=10%>":
                             "<input type=button class=button value='All'":
                             " onClick='ReSubAll();'><br>":
                             "Resubmit</td></tr>";
CLHD9999  RETURN
+
.*******************************************************************************
.                          Batching
.*******************************************************************************
BATC0000  BRANCH    FLDITMNO,BATC0100,BATC0200,BATC0300,BATC0400,BATC0500:
                             BATC0600,BATC0700,BATC0800,BATC0900,BATC1000:
                             BATC1100,BATC1200,BATC1300,BATC1400,BATC1500:
                             BATC1600,BATC1700,BATC1800,BATC1900,BATC2000:
                             BATC2100,BATC2200
          GOTO      BATC9999
.
BATC0100  CALL      NEXT0000
          GOTO      BATC9999
.
BATC0200  CALL      PREV0000
          GOTO      BATC9999
.
BATC0300  CALL      CURSTD00
          GOTO      BATC9999
.
BATC0400  CALL      CUREND00
          GOTO      BATC9999
.
BATC0500  CALL      CURYR000
          GOTO      BATC9999
.
BATC0600  CALL      CURMON00
          GOTO      BATC9999
.
BATC0700  CALL      SELV0000
          GOTO      BATC9999
.
BATC0800  CALL      LBTC0000                * My HIC Batch list
          GOTO      BATC9999
.
BATC0900  WRITE     HTMLFILE;TEMPLATE;
          GOTO      BATC9999
.
BATC1000  WRITE     HTMLFILE;REPORTNO;
          GOTO      BATC9999
.
BATC1100  WRITE     HTMLFILE;VIEWTYPE;
          GOTO      BATC9999
.
BATC1200  CALL      BDET0000           * HIC Batch details
          GOTO      BATC9999
.
BATC1300  WRITE     HTMLFILE;BATCHKEY;
          GOTO      BATC9999
.
BATC1400  WRITE     HTMLFILE;ITEMKEYS;
          GOTO      BATC9999
.
BATC1500  CALL      BHIS0000           * Batch history list
          GOTO      BATC9999
.
BATC1600  MOVE      ZERO,FORM1
          PACK      KEY18,WBSEUID,PRGID                * Web user id
          CALL      RDWBST1
          BRANCH    OVRCD,BATC1620
          COMPARE   "99",WBSTLEV
          GOTO      BATC1620 IF NOT EQUAL
          MOVE      ONE,FORM1
BATC1620  WRITE     HTMLFILE;FORM1;
          GOTO      BATC9999
.
.         If batch status is batched but the extraction file is still blank
.         then the extract option/button will be available
.
BATC1700  MOVE      ONE,FORM1                 * default to not available
          MOVE      BATCHKEY,KEY33
          CALL      RDHCBTC1
          IF        OVRCD=0
            MATCH     " 0",HCBTSTAT
            IF        @EQUAL
              MATCH     SP70,HCBTEFNM
              IF        @EQUAL
                MOVE      ZERO,FORM1          * extraction option is available
              ENDIF
            ENDIF
          ENDIF
          WRITE     HTMLFILE;FORM1;
          GOTO      BATC9999
.
BATC1800  CALL      BERR0000                * Batch error list
          GOTO      BATC9999
.
.         If batch status is received 
.         then the actioned option/button will be available
.
BATC1900  MOVE      ONE,FORM1               * default to not available
          MOVE      BATCHKEY,KEY33
          CALL      RDHCBTC1
          BRANCH    OVRCD,BATC1920
          MATCH     " 5",HCBTSTAT
          GOTO      BATC1910 IF EQUAL       * Actioned option available
          MATCH     " 6",HCBTSTAT
          GOTO      BATC1910 IF EQUAL       * Actioned option available
          MATCH     " 7",HCBTSTAT
          GOTO      BATC1920 IF NOT EQUAL
.
BATC1910  MOVE      ZERO,FORM1              * Actioned option is available
.
BATC1920  WRITE     HTMLFILE;FORM1;
          GOTO      BATC9999
.
.         Deposit verified option is only available where status is 8 (Action)
.
BATC2000  MOVE      ONE,FORM1               * default to not available
          MOVE      BATCHKEY,KEY33
          CALL      RDHCBTC1
          BRANCH    OVRCD,BATC2020
          MATCH     " 8",HCBTSTAT
          GOTO      BATC2020 IF NOT EQUAL   * Actioned option not available
.
BATC2010  MOVE      ZERO,FORM1              * Actioned option is available
.
BATC2020  WRITE     HTMLFILE;FORM1;
          GOTO      BATC9999
.
BATC2100  CALL      SELPPS00                * List of medical practice
          GOTO      BATC9999
.
.         If batch status is not batched and the extraction file is not blank
.         then the re-extract option/button will be available
.
BATC2200  MOVE      ONE,FORM1                 * default to not available
          MOVE      BATCHKEY,KEY33
          CALL      RDHCBTC1
          IF        OVRCD=0
            MATCH     " 0",HCBTSTAT
            IF        !@EQUAL
              MATCH     SP70,HCBTEFNM
              IF        !@EQUAL
                MOVE      ZERO,FORM1          * extraction option is available
              ENDIF
            ENDIF
          ENDIF
          WRITE     HTMLFILE;FORM1;
          GOTO      BATC9999
.
BATC9999  RETURN
.
.*******************************************************************************
.                          Claim List 
.*******************************************************************************
CLIS0000  BRANCH    FLDITMNO,CLIS0100,CLIS0200,CLIS0300,CLIS0400
          GOTO      CLIS9999
.
CLIS0100  CALL      CLUR0000              * List of claims UR
          GOTO      CLIS9999
.
CLIS0200  WRITE     HTMLFILE;URNUMBER;
          GOTO      CLIS9999
.
CLIS0300  WRITE     HTMLFILE;ADMISSNO;
          GOTO      CLIS9999
.
CLIS0400  WRITE     HTMLFILE;BATCHKEY;
          GOTO      BTCH9999
.
CLIS9999  RETURN
.------------------------------------------------------------
. Claim List for a U/R number
.------------------------------------------------------------
CLUR0000  PACK      KEY16,URNUMBER,Z70
          CALL      RSHCCLM3
CLUR1000  CALL      RPHCCLM3
          BRANCH    OVRCD,CLUR9999
.
          MATCH     URNUMBER,HCCLURNO       * Same U/R number?
          GOTO      CLUR9999 IF NOT EQUAL
.
          MOVE      SP70,PVIDATE
          MOVE      SP70,ATIME
.
          PACK      KEY36,HCCLVISN,SP70
          CALL      RDSBOKA6
          CALL      RDKBOKA6
          BRANCH    OVRCD,CLUR1500
          MATCH     HCCLVISN,DOBAOUTN
          GOTO      CLUR1500 IF NOT EQUAL
          MOVE      OBADATE,PVIDATE         * Booked status don't have a visit
          MOVE      OBATIME,ATIME
.
CLUR1500  MOVE      HCCLVISN,KEY8
          CALL      RDVISA1
          IF        OVRCD=0 & PVITYPE=3
            CALL      RDMISS1
          ENDIF
.
          PACK      KEY10,HCCLPYEE,SP70
          CALL      RDPMHCP1
          IF        OVRCD=1
            MOVE      "Invalid HCP - ",DOCFNAME
            ENDSET    DOCFNAME
            APPEND    HCCLPYEE,DOCFNAME
            RESET     DOCFNAME
          ELSE
            MOVE      PMHCTITL,FMTTITLE
            MOVE      PMHCGNAM,FMTGNAME
            MOVE      PMHCSNAM,FMTSNAME
            CALL      DOCNM000
          ENDIF
.
.
          PACK      PRPRDESC,SP70
          PACK      KEY6,HCCLMPRA
          CALL      RDPRPR1
.
          MATCH     SP70,PVIDATE
          GOTO      CLUR2000 IF EQUAL
.
          REP       " 0",PVIDATE
          MOVE      SP70,VISTDAY
          UNPACK    PVIDATE,CCENT,CYEAR,CMON,CDAY
          CALL      DAYOFWEK
          LOAD      DAYNAM3,WEEKDAY,MON,TUE,WED,THU,FRI,SAT,SUN
          PACK      VISTDAY,DAYNAM3,SP70
.
          UNPACK    PVIDATE,CCENT,CYEAR,CMON,CDAY
          MOVE      CMON,F2
          LOAD      MTHNAM3,F2,JAN,FEB,MAR,APR,MAY,JUN,JUL,AUG,SEP,OCT,NOV,DEC
.
          WRITE     HTMLFILE;"<tr><td>",VISTDAY,SP1:
                                        CDAY,SP1,MTHNAM3,SP1,CCENT,CYEAR:
                                        " at ",ATIME,"</td>";
          GOTO      CLUR3000
.
CLUR2000  WRITE     HTMLFILE;"<tr><td>&nbsp</td>";
.
CLUR3000  
.         WRITE     HTMLFILE;"<td>",PRPRDESC,"</td>";
.
          PACK      KEY20,HCCLSITE,HCCLCLID,Z70
          CALL      RDSCLIA1
          CALL      RDPCLIA1                *To get Clinic ID Description
          IF        OVRCD=0
            MATCH     HCCLSITE,OCASITE
            IF        !@EQUAL
              MOVE      SP70,OCADESC
              GOTO      CLUR3500
            ENDIF
.
            MATCH     HCCLCLID,OCACLIN
            GOTO      CLUR3500 IF EQUAL
          ENDIF
          MOVE      SP70,OCADESC
.
CLUR3500  WRITE     HTMLFILE;"<td>",OCADESC,"(",HCCLPSRV,")&nbsp;</td>";
.
          MATCH     " 1",HCCLSTAT
          GOTO      CLUR4000 IF NOT EQUAL * Not batched yet
.
          PACK      KEY33,HCCLBTCH,HCCLPSRV,HCCLPMCI,HCCLPYEE
          WRITE     HTMLFILE;"<td><img src=../images/DietIcon.gif ":
                             " class=ListIcon onclick='linkBatch(#"":
                             KEY33,"#")'>":
                             HCCLBTCH,"</td>";
.
.
          GOTO      CLUR5000
.
CLUR4000  WRITE     HTMLFILE;"<td>",HCCLBTCH,"</td>";
.
CLUR5000  WRITE     HTMLFILE;"<td><a HREF = 'javascript:ClaimDetail":
                             "(#"",HCCLURNO,"#",#"":
                             HCCLCLMN,"#",#"":
                             HCCLVISN:
                             "#")'>":
                             "<img src=../images/DietIcon.gif":
                             " class=ListIcon></a>":
                             HCCLCLMN,"</td>";
.
          REP       " 0",HCCLVPOS
          MATCH     "00",HCCLVPOS
          IF        @EQUAL
            WRITE     HTMLFILE;"<td>&nbsp;</td>";
          ELSE
            WRITE     HTMLFILE;"<td><a HREF = 'javascript:ClaimDetail":
                             "(#"",HCCLURNO,"#",#"":
                             HCCLCLMN,"#",#"":
                             HCCLVISN:
                             "#")'>":
                             "<img src=../images/DietIcon.gif":
                             " class=ListIcon></a>&nbsp;",HCCLVPOS,"</td>";
          ENDIF
.
          CALL      GITM0000             * Get first MBS item 
.
          MOVE      SP70,KEY1
          IF        HCCLMITM<>0
            MOVE      "##",KEY1
          ENDIF
.
          WRITE     HTMLFILE;"<td>&nbsp;",KEY1,KEY9,"</td>":
                             "<td align=right>",HCCLCAMN,"</td>":
                             "<td align=right>",HCCLREJA,"</td>":
                             "<td align=right>",HCCLADJM,"</td>":
                             "<td align=right>",HCCLWOFF,"</td>";
.
          MOVE      "Printed ",KEY8
          MATCH     " 1",HCCLSTAT
          IF        @EQUAL
            MOVE      "Batched ",KEY8
          ENDIF
          MATCH     " 2",HCCLSTAT
          IF        @EQUAL
            MOVE      "Hold    ",KEY8
          ENDIF
          MATCH     " 3",HCCLSTAT
          IF        @EQUAL
            MOVE      "Resubmit",KEY8
          ENDIF
.
          WRITE     HTMLFILE;"<td>&nbsp;",KEY8,"</td>":
                             "<td>",HCCLVISN,"</td></tr>"
          GOTO      CLUR1000
CLUR9999  RETURN
.
.------------------------------------------------------------
. Get first MBS item
.------------------------------------------------------------
GITM0000  MOVE      SP70,REJREAS
          MOVE      SP70,ADJREAS
          MOVE      SP70,KEY9
          MOVE      ZERO,RESUBAMT
          PACK      KEY18,HCCLCLMN,HCCLVISN,SP70
          CALL      RSHCCIT1
GITM1000  CALL      RKHCCIT1
          BRANCH    OVRCD,GITM9999
          MATCH     HCCICLMN,HCCLCLMN        * same claim number ?
          GOTO      GITM9999 IF NOT EQUAL
          MATCH     HCCIVISN,HCCLVISN        * same visit number ?
          GOTO      GITM9999 IF NOT EQUAL
.
          MATCH     SP70,REJREAS
          IF        @EQUAL
            MOVE      HCCIREJR,REJREAS       * save reason for rejection
          ENDIF
.
          MATCH     SP70,ADJREAS
          IF        @EQUAL
            MOVE      HCCIADJR,ADJREAS
          ENDIF
.
          MATCH     SP70,KEY9
          IF        @EQUAL
            MOVE      HCCIITMN,KEY9          * save the first item
          ENDIF
.
          MATCH     SP70,HCCIRDAT
          IF        !@EQUAL
            ADD       HCCICAMT,RESUBAMT          * accummulate resubmit amount
          ENDIF
          GOTO      GITM1000
.
GITM9999  RETURN
+
.------------------------------------------------------------
. Table of Claim List
.------------------------------------------------------------
CBTC0000  MOVE      ZERO,CLAIMCNT
          UNPACK    DIM127,D1,LINKPRG,DIM127
          UNPACK    DIM127,D1,LINKREP,DIM127
          UNPACK    DIM127,D1,LINKTEM,DIM127
          MOVE      ZERO,RECCNT
          MOVE      ZERO,LOOPFLAG
          MOVE      ZERO,TOTBAMNT
.
.         Clinic ID, Service provider or Batch No must be entered
.
.
          CALL      HDBT0000          * Display heading
.
          MATCH     SP70,SRCHBTCH
          GOTO      CBTC0400 IF NOT EQUAL
.
          MATCH     SP70,SRCHPROV
          GOTO      CBTC0100 IF NOT EQUAL
          MATCH     SP70,SRCHCLID
          GOTO      CBTC0200 IF NOT EQUAL
          MATCH     SP70,SRCHCLTY
          GOTO      CBTC0300 IF NOT EQUAL
          GOTO      CBTC9999
.
.         By service provider 
.
CBTC0100  MOVE      ONE,LOOPFLAG
          PACK      KEY26,SRCHPROV,KEYINDAT,SP70
          CALL      RSHCCLM4
CBTC0110  CALL      RKHCCLM4
          BRANCH    OVRCD,CBTC9999
.
          MATCH     SRCHPROV,HCCLPSRV      * Same Service provider?
          GOTO      CBTC9999 IF NOT EQUAL
.
          MATCH     SP70,KEYINDAT
          IF        !@EQUAL 
            MATCH     HCCLDATE,KEYINDAT    * check date
            GOTO      CBTC9999 IF LESS
          ENDIF
.
          MATCH     SP70,SRCHCLTY
          IF        !@EQUAL
            MATCH     HCCLCTYP,SRCHCLTY    * Same clinic type?
            GOTO      CBTC0110 IF NOT EQUAL
          ENDIF
.
          MATCH     SP70,SRCHCLID
          IF        !@EQUAL
            MATCH     HCCLCLID,SRCHCLID    * Same clinic id?
            GOTO      CBTC0110 IF NOT EQUAL
          ENDIF
.
          MATCH     SP70,SRCHPRAC
          IF        !@EQUAL
            MATCH     SRCHPRAC,HCCLMPRA
            GOTO      CBTC0110 IF NOT EQUAL
          ENDIF
.
          MATCH     " 0",HCCLSTAT          * Printed?
          GOTO      CBTC2000 IF EQUAL
          MATCH     " 2",HCCLSTAT          * Hold?
          GOTO      CBTC0110 IF NOT EQUAL 
          GOTO      CBTC2000
.
.         By clinic id
.
CBTC0200  MOVE      TWO,LOOPFLAG
          PACK      KEY28,WBSESIT,SRCHCLID,KEYINDAT,SP70
          CALL      RSHCCLM6
CBTC0210  CALL      RKHCCLM6
          BRANCH    OVRCD,CBTC9999
          MATCH     WBSESIT,HCCLSITE       * Same site?
          GOTO      CBTC9999 IF NOT EQUAL
.
          MATCH     SRCHCLID,HCCLCLID        * Same clinic id?
          GOTO      CBTC9999 IF NOT EQUAL
.
          MATCH     SP70,KEYINDAT
          IF        !@EQUAL 
            MATCH     HCCLDATE,KEYINDAT    * check date
            GOTO      CBTC9999 IF LESS
          ENDIF
.
          MATCH     SP70,SRCHPROV
          IF        !@EQUAL
            MATCH     HCCLPSRV,SRCHPROV    * Same provider?
            GOTO      CBTC0210 IF NOT EQUAL
          ENDIF
.
          MATCH     SP70,SRCHPRAC
          IF        !@EQUAL
            MATCH     SRCHPRAC,HCCLMPRA
            GOTO      CBTC0210 IF NOT EQUAL
          ENDIF
.
          MATCH     SP70,SRCHCLTY
          IF        !@EQUAL
            MATCH     HCCLCTYP,SRCHCLTY    * Same clinic type?
            GOTO      CBTC0210 IF NOT EQUAL
          ENDIF
.
          MATCH     " 0",HCCLSTAT          * Printed?
          GOTO      CBTC2000 IF EQUAL
          MATCH     " 2",HCCLSTAT          * Hold?
          GOTO      CBTC0210 IF NOT EQUAL 
          GOTO      CBTC2000
.
.         By Clinic Type
.
CBTC0300  MOVE      THREE,LOOPFLAG
          PACK      KEY28,WBSESIT,SRCHCLTY,KEYINDAT,SP70
          CALL      RSHCCLM5
CBTC0310  CALL      RKHCCLM5
          BRANCH    OVRCD,CBTC9999
          MATCH     WBSESIT,HCCLSITE       * Same site?
          GOTO      CBTC9999 IF NOT EQUAL
.
          MATCH     SRCHCLTY,HCCLCTYP        * Same clinic type?
          GOTO      CBTC9999 IF NOT EQUAL
.
          MATCH     SP70,KEYINDAT
          IF        !@EQUAL 
            MATCH     HCCLDATE,KEYINDAT    * check date
            GOTO      CBTC9999 IF LESS
          ENDIF
.
          MATCH     SP70,SRCHPROV
          IF        !@EQUAL
            MATCH     HCCLPSRV,SRCHPROV    * Same provider?
            GOTO      CBTC0310 IF NOT EQUAL
          ENDIF
.
          MATCH     SP70,SRCHPRAC
          IF        !@EQUAL
            MATCH     SRCHPRAC,HCCLMPRA
            GOTO      CBTC0310 IF NOT EQUAL
          ENDIF
.
          MATCH     SP70,SRCHCLID
          IF        !@EQUAL
            MATCH     HCCLCLID,SRCHCLID    * Same clinic id?
            GOTO      CBTC0310 IF NOT EQUAL
          ENDIF
.
          MATCH     " 0",HCCLSTAT          * Printed?
          GOTO      CBTC2000 IF EQUAL
          MATCH     " 2",HCCLSTAT          * Hold?
          GOTO      CBTC0310 IF NOT EQUAL 
          GOTO      CBTC2000
.
.         By batch number
.
CBTC0400  MOVE      FOUR,LOOPFLAG
          PACK      KEY15,SRCHBTCH,SP70
          CALL      RSHCCLM7
CBTC0410  CALL      RKHCCLM7
          BRANCH    OVRCD,CBTC9999
          MATCH     SRCHBTCH,HCCLBTCH        * Same Batch number?
          GOTO      CBTC9999 IF NOT EQUAL
.
          MATCH     " 0",HCCLSTAT          * Printed?
          GOTO      CBTC2000 IF EQUAL
          MATCH     " 2",HCCLSTAT          * Hold?
          GOTO      CBTC0410 IF NOT EQUAL 
          GOTO      CBTC2000
.
.         Check with the Medical practice security access
.
CBTC2000  PACK      KEY10,USERID
          CALL      RDPRALS1               * user access to all practice
          IF        OVRCD=1
            PACK      KEY16,HCCLMPRA,USERID,SP70
            CALL      RDPRSEC1
            BRANCH    OVRCD,CBTC8000       * no access
          ENDIF
.
          MOVE      "&nbsp;",PATFNAME
          PACK      KEY8,HCCLURNO,SP70
          CALL      RDMAST1
          BRANCH    OVRCD,CBTC8000
          CALL      RDPMPX21
          BRANCH    OVRCD,CBTC8000
          ADD       ONE,RECCNT
.
.         Display all claims for the batch
.
          CALL      PATNAM00
          CALL      PATFLD00                * Use standard Patient Folder sub
          MOVE      KEY3,FOLDERSF           * and store suffix
.
          MOVE      SP70,PVIDATE
          MOVE      SP70,ATIME
.
          MOVE      SP70,DOBASTAT
          PACK      KEY36,HCCLVISN,SP70
          CALL      RDSBOKA6
          CALL      RDKBOKA6
          BRANCH    OVRCD,CBTC2200
          MATCH     HCCLVISN,DOBAOUTN     * same outpatient number?
          GOTO      CBTC2200 IF NOT EQUAL
          MOVE      OBADATE,PVIDATE       * outpatient booking 
          MOVE      OBATIME,ATIME
        
          MOVE      HCCLVISN,KEY8
          CALL      RDVISA1
          BRANCH    OVRCD,CBTC2200
          IF        PVITYPE=3
            CALL      RDMISS1
          ENDIF
.
.         Read link file to get the referral number
.
CBTC2200  MOVE      SP10,ALLNVISN
          MOVE      SP10,ALRERDEP
          PACK      KEY16,HCCLVISN,SP70
          CALL      RSALLNK2
          CALL      RKALLNK2
          BRANCH    OVRCD,CBTC2400
          MATCH     HCCLVISN,ALLNLNKV
          GOTO      CBTC2400 IF NOT EQUAL
.
          PACK      KEY8,ALLNVISN,SP70      * Patient Referral Details
          CALL      RDALREF1
          BRANCH    OVRCD,CBTC2400
.
          WRITE     HTMLFILE;"<tr><td><a HREF = 'javascript:Referral":
                             "(#"",ALREURNO,"#",#"":
                             ALREVISN,"#",#"":
                             ALREDEPT,"#",#"":
                             HCCLVISN,"#",#"":
                             HCCLCLMN:
                             "#")'>":
                             "<img src=../images/PatientFolder",FOLDERSF,".gif":
                             " class=ListIcon></a>";
.
          CALL      CPRV0000          * Check referral provider number
          IF        EXIT=1
            MOVE      "98",HCCLSTAT
          ENDIF
          GOTO      CBTC2600
.
CBTC2400  WRITE     HTMLFILE;"<tr><td>";
          MOVE      "99",HCCLSTAT           * no referral details
.
CBTC2600  WRITE     HTMLFILE;PATFNAME,"</td>":
                             "<td>",HCCLURNO,"</td>":
                             "<td>",HCCLVISN,"</td>":
                             "<td>",HCCLBTCH,"</td>":
                             "<td>&nbsp;",PMEDI,"</td>";
.
          ADD       ONE,CLAIMCNT      * keep count for total display
.
          MATCH     SP70,PVIDATE
          IF        !@EQUAL
            UNPACK    PVIDATE,CCENT,CYEAR,CMON,CDAY
            MOVE      CMON,F2
            LOAD      MTHNAM3,F2,JAN,FEB,MAR,APR,MAY,JUN,JUL,AUG,SEP,OCT,NOV,DEC
            WRITE     HTMLFILE;"<td>&nbsp;",CDAY,SP1,MTHNAM3,SP1,CCENT,CYEAR:
                               " at ",ATIME,"</td>";
          ELSE
            WRITE     HTMLFILE;"<td>&nbsp</td>";
          ENDIF
.
          CALL      GITM0000
.
          MOVE      SP70,KEY1
          IF        HCCLMITM<>0
            MOVE      "##",KEY1
          ENDIF
          WRITE     HTMLFILE;"<td>&nbsp;",KEY1,KEY9,"</td>":
                             "<td align=right>",HCCLCAMN,"</td>";
.
.
.         Status 0 = Not claim,1 = Batched
.
          MOVE      SP70,KEY11
.
.         Can not batch if no referral details
.
          MATCH     "99",HCCLSTAT
          IF        @EQUAL
            MOVE      "No Referral",KEY11
            GOTO      CBTC3000
          ENDIF
.
.         Can not batch if no medicare details
.
          MATCH     SP70,PMEDI              * no medicare number
          GOTO      CBTC2800 IF EQUAL
          MATCH     SP70,PTMXMCCD           * no medicare ref number
          GOTO      CBTC2800 IF EQUAL
          MATCH     SP70,PMPXMEDC           * no medicare expiry date
          GOTO      CBTC2900 IF NOT EQUAL
.
CBTC2800  MOVE      "No Medicare",KEY11
          GOTO      CBTC3000
.
.         Can not batch if not attended
.
CBTC2900  MATCH     "4",DOBASTAT
          IF        !@EQUAL
            MOVE      "No Attended",KEY11
            GOTO      CBTC3000
          ENDIF
.
          MATCH     "98",HCCLSTAT
          IF        @EQUAL
            MOVE      "No Prov No.",KEY11
            GOTO      CBTC3000
          ENDIF
.
          MOVE      "Printed",KEY11
          MATCH     " 0",HCCLSTAT
          IF        !@EQUAL
            MOVE      "Hold",KEY11
            GOTO      CBTC3000
          ENDIF
.
          MATCH     SP70,SRCHBTCH
          GOTO      CBTC5000 IF NOT EQUAL
.
CBTC3000  WRITE     HTMLFILE;"<td align=center>":
                             "<input type=checkbox name=claimkey ":
                             "disabled></td>";
          GOTO      CBTC6000
.
CBTC5000  WRITE     HTMLFILE;"<td align=center>":
                             "<input type=checkbox name=claimkey ":
                             "value=#"",HCCLCLMN,"#"></td>";
.
CBTC6000  MATCH     "Printed",KEY11
          IF        @EQUAL
            WRITE     HTMLFILE;"<td><a HREF = 'javascript:OnHold":
                             "(#"",HCCLCLMN:
                             "#")'>":
                             "<img src=../images/DietIcon.gif":
                             " class=ListIcon></a>",KEY11,"</td>";
          ELSE
            WRITE     HTMLFILE;"<td>&nbsp;",KEY11,"</td>";
          ENDIF
.
          MOVE      ZERO,F2
          MOVE      SP70,MTHNAM3
          UNPACK    HCCLPBAT,CCENT,CYEAR,CMON,CDAY
          MOVE      CMON,F2
          LOAD      MTHNAM3,F2,JAN,FEB,MAR,APR,MAY,JUN,JUL,AUG,SEP,OCT,NOV,DEC
          MATCH     SP70,HCCLPNUM
          IF        @EQUAL
            WRITE     HTMLFILE;"<td>&nbsp;":
                             CDAY,SP1,MTHNAM3,SP1,CCENT,CYEAR,"</td>";
          ELSE
            WRITE     HTMLFILE;"<td>&nbsp;",HCCLPNUM,"<br>":
                               CDAY,SP1,MTHNAM3,SP1,CCENT,CYEAR,"</td>";
          ENDIF
.
          CALL      SETX0000                * Set Expiry Icon
          WRITE     HTMLFILE;"<td align=center>":
                             "<img src=../images/ExpiryIcon",EXPRICON,".gif>":
                             "</td></tr>";
          GOTO      CBTC8000
.
CBTC8000  BRANCH    LOOPFLAG,CBTC0110,CBTC0210,CBTC0310,CBTC0410
CBTC9999  RETURN
+
.-----------------------------------------------------------------------------.
.         Get the referring provider from either the referring HCP/Practice
.         (if not blank), or the free format referring HCP field.
.-----------------------------------------------------------------------------.
CPRV0000  MOVE      ZERO,EXIT
          MATCH     SP10,ALRERHCP            * referring HCP blank ?
          GOTO      CPRV8000 IF EQUAL
.
          MATCH     SP10,ALRERHCR            * no - ref. HCP Practice blank?
          GOTO      CPRV7000 IF EQUAL
.
          PACK      KEY20,ALRERHCP,ALRERHCR  * no
          CALL      RDPMHCL1                 * HCP link record found ?
          BRANCH    OVRCD,CPRV9000           * no - error
.
          MATCH     SP10,PMHLPRV1
          GOTO      CPRV9999 IF NOT EQUAL
          MATCH     SP10,PMHLPRV2
          GOTO      CPRV9999 IF NOT EQUAL
          MATCH     SP10,PMHLPRV3
          GOTO      CPRV9999 IF NOT EQUAL
          MATCH     SP10,PMHLPRV4
          GOTO      CPRV9999 IF NOT EQUAL
          MATCH     SP10,PMHLPRV5
          GOTO      CPRV9999 IF NOT EQUAL
          GOTO      CPRV9000
          
.         Check provider number of the HCP
.
CPRV7000  PACK      KEY10,ALRERHCP,SP70
          CALL      RDPMHCP1
          BRANCH    OVRCD,CPRV9000
          MATCH     SP10,PMHCPRV1            * HCP Provider number
          GOTO      CPRV9000 IF EQUAL
          GOTO      CPRV9999
.
CPRV8000  MATCH     SP70,ALREHCPP
          GOTO      CPRV9999 IF NOT EQUAL
.
CPRV9000  MOVE      ONE,EXIT
CPRV9999  RETURN
.-----------------------------------------------------------------------------.
.         My HIC Batches list
.-----------------------------------------------------------------------------.
LBTC0000  MOVE      ZERO,LOOPFLAG
          UNPACK    DIM127,D1,LINKPRG,DIM127
          UNPACK    DIM127,D1,LINKREP,DIM127
          UNPACK    DIM127,D1,LINKTEM,DIM127
.
          MATCH     SP70,SRCHSTAT
          IF        @EQUAL
            MOVE      " 7",SRCHSTAT           * default to EFT payment status
          ENDIF
          PACK      BTCHSTAT,SRCHSTAT
.
          MATCH     SP70,SRCHBTCH
          GOTO      LBTC0300 IF NOT EQUAL
.
          MATCH     SP70,SRCHCLID
          GOTO      LBTC0200 IF NOT EQUAL
.
          MATCH     SP70,SRCHPROV
          IF        @EQUAL
            MATCH     SP70,WBSECLI
            IF        !@EQUAL
              MOVE      WBSECLI,SRCHCLID
              GOTO      LBTC0200
            ENDIF
            GOTO      LBTC0400
          ENDIF
.
.         By Provider number
.
          MOVE      ONE,LOOPFLAG
          MATCH     SP70,SRCHPROV
          IF        @EQUAL
            PACK      KEY43,SRCHPROV,SP70
          ELSE
            PACK      KEY43,SRCHPROV,BTCHSTAT,SP70
          ENDIF
.
          CALL      RSHCBTC2
LBTC0110  CALL      RKHCBTC2
          BRANCH    OVRCD,LBTC9999
.
          MATCH     SP70,SRCHPROV
          IF        !@EQUAL
            MATCH     SRCHPROV,HCBTPSRV       * same provider number?
            GOTO      LBTC9999 IF NOT EQUAL
          ENDIF
.
.         Replace Batch status "Received with errors" with "Received ok."
.
          MATCH     SP70,BTCHSTAT
          IF        !@EQUAL
            MOVE      HCBTSTAT,KEY2
            UNPACK    KEY2,ANS,KEY1
            REP       "65",KEY1
            PACK      KEY2,ANS,KEY1
            MATCH     KEY2,BTCHSTAT
            GOTO      LBTC9999 IF NOT EQUAL
          ENDIF
.
          MATCH     SP70,SRCHCLID
          IF        !@EQUAL
            MATCH     HCBTCLID,SRCHCLID        * Same clinic id?
            GOTO      LBTC0110 IF NOT EQUAL
          ENDIF
          GOTO      LBTC0800
.
.         By Clinic ID
.
LBTC0200  MOVE      TWO,LOOPFLAG
          MATCH     SP70,BTCHSTAT
          IF        @EQUAL
            PACK      KEY55,WBSESIT,SRCHCLID,SP70
          ELSE
            PACK      KEY55,WBSESIT,SRCHCLID,BTCHSTAT,SP70
          ENDIF
          CALL      RSHCBTC3
LBTC0210  CALL      RKHCBTC3
          BRANCH    OVRCD,LBTC9999
.
          MATCH     WBSESIT,HCBTSITE         * Same site?
          GOTO      LBTC9999 IF NOT EQUAL
          MATCH     HCBTCLID,SRCHCLID        * Same clinic id?
          GOTO      LBTC9999 IF NOT EQUAL
.
          MATCH     SP70,BTCHSTAT
          IF        !@EQUAL
            MOVE      HCBTSTAT,KEY2
            UNPACK    KEY2,ANS,KEY1
            REP       "65",KEY1
            PACK      KEY2,ANS,KEY1
            MATCH     KEY2,BTCHSTAT
            GOTO      LBTC9999 IF NOT EQUAL
          ENDIF
.
          MATCH     SP70,SRCHPROV
          IF        !@EQUAL
            MATCH     SRCHPROV,HCBTPSRV       * same provider number?
            GOTO      LBTC0210 IF NOT EQUAL
          ENDIF
          GOTO      LBTC0800
.
.         By Batch number
.
LBTC0300  MOVE      THREE,LOOPFLAG
          PACK      KEY33,SRCHBTCH,SP70
          CALL      RSHCBTC1
LBTC0310  CALL      RKHCBTC1
          BRANCH    OVRCD,LBTC9999
.
          MATCH     SRCHBTCH,HCBTBTCH    * Same batch number?
          GOTO      LBTC9999 IF NOT EQUAL
.
.         MATCH     SP70,BTCHSTAT
.         IF        !@EQUAL
.           MATCH     BTCHSTAT,HCBTSTAT
.           GOTO      LBTC9000 IF NOT EQUAL
.         ENDIF
.
          GOTO      LBTC2000
.
.         By batch status
.
LBTC0400  PACK      KEY35,BTCHSTAT,SP70
          CALL      RSHCBTC5
LBTC0410  CALL      RKHCBTC5
          BRANCH    OVRCD,LBTC9999
.
          MOVE      HCBTSTAT,KEY2
          UNPACK    KEY2,ANS,KEY1
          REP       "65",KEY1
          PACK      KEY2,ANS,KEY1
          MATCH     KEY2,BTCHSTAT
          GOTO      LBTC9999 IF NOT EQUAL
.
LBTC0800  MATCH     SP70,HCBTFNDR
          IF        !@EQUAL
            MATCH     FRSTDATE,HCBTFNDR
            GOTO      LBTC9000 IF LESS
            MATCH     HCBTFNDR,LASTDATE
            GOTO      LBTC9000 IF LESS
          ENDIF
.
          MATCH     SP70,SRCHCLTY
          IF        !@EQUAL
            MATCH     HCBTCTYP,SRCHCLTY     * Same clinic type?
            GOTO      LBTC9000 IF NOT EQUAL
          ENDIF
.
          MATCH     SP70,SRCHPRAC
          IF        !@EQUAL
            MATCH     HCBTMPRA,SRCHPRAC        * Same Batch no?
            GOTO      LBTC9000 IF NOT EQUAL
          ENDIF
.
.         Check with the Medical practice security access
.
LBTC2000  CALL      GRCV0000               * Get amount paid from Exceptionfile
.
LBTC2400  PACK      KEY10,USERID
          CALL      RDPRALS1               * user access to all practice
          IF        OVRCD=1
            PACK      KEY16,HCBTMPRA,USERID,SP70
            CALL      RDPRSEC1
            BRANCH    OVRCD,LBTC9000       * no access
          ENDIF
.
          PACK      KEY33,HCBTBTCH,HCBTPSRV,HCBTPMCI,HCBTPYEE
          REP       " +",KEY33
.
          CLEAR     HTMLLINK
          APPEND    LINKPRG,HTMLLINK
          APPEND    ".pbl?reportno=",HTMLLINK
          APPEND    LINKREP,HTMLLINK
          APPEND    "&template=",HTMLLINK
          APPEND    LINKTEM,HTMLLINK
          APPEND    "&batchkey=",HTMLLINK
          APPEND    KEY33,HTMLLINK
          APPEND    "&srchbtch=",HTMLLINK
          APPEND    HCBTBTCH,HTMLLINK
          RESET     HTMLLINK
.
          MOVE      HCBTCAMT,TOTBAMNT
          SUB       HCBTAMTR,TOTBAMNT       * Outstanding amount
          ADD       HCBTADJM,TOTBAMNT            * - adjustment
          SUB       HCBTWOFF,TOTBAMNT            * - written off
.
          MOVE      HCBTADJM,TOTADJMN       * amount adjustment
          SUB       HCBTWOFF,TOTADJMN       * amount write off
.
          MOVE      "IE",CATEGORY
          MOVE      HCBTCMNT,CODE
          CALL      GETCOD00
.
          MOVE      STATBTCH,KEY12
          MOVE      ZERO,FORM2
          MOVE      HCBTSTAT,FORM2
          LOAD      KEY12,FORM2,STATEXTR,STATSENT,STATACKW,STATNACK,STATRECV:
                                STATRECE,STATPAYM,STATACTN,STATDEPV,STATCLSE
.
          MOVE      ZERO,BTCERFLG
          MOVE      SP70,BTCERLNK
          PACK      KEY8,HCBTBTCH,SP70
          CALL      RSHCERR1
          CALL      RKHCERR1
          BRANCH    OVRCD,LBTC3000
.
          MATCH     HCBTBTCH,HCERBTCH
          GOTO      LBTC3000 IF NOT EQUAL
.
          MOVE      ONE,BTCERFLG
          CLEAR     BTCERLNK
          APPEND    "javascript:HICErrList('",BTCERLNK
          APPEND    KEY33,BTCERLNK
          APPEND    "')",BTCERLNK
          RESET     BTCERLNK
.
LBTC3000  WRITE     HTMLFILE;"t.addRow(#"",HTMLLINK,"#",":
                             "#"",HCBTBTCH,"#",":                   1
                             "#"",HCBTCAMT,"#",":                   2
                             "#"",HCBTDATE,"#",":                   3
                             "#"",HCBTHCOP,"#",":                   4
                             "#"",HCBTFNDR,"#",":                   5
                             "#"",HCBTAMTR,"#",":                   6
                             "#"",HCBTDEPD,"#",":                   7
                             "#"",TOTBAMNT,"#",":                   8
                             "#"",TOTADJMN,"#",":                   9
                             "#"",KEY12,"#",":                      10
                             "#"",TDESC,"#",":                     *11
                             "#"",BTCERFLG,"#",":                  *12
                             "#"",BTCERLNK,"#");"                  *13
.
LBTC9000  BRANCH    LOOPFLAG,LBTC0110,LBTC0210,LBTC0310
          GOTO      LBTC0410
LBTC9999  RETURN
+
.*******************************************************************************
.            Get amount Received Exception table
.*******************************************************************************
GRCV0000  MATCH     " 5",HCBTSTAT
          GOTO      GRCV0100 IF EQUAL
          MATCH     " 6",HCBTSTAT
          GOTO      GRCV0100 IF EQUAL
          MATCH     " 7",HCBTSTAT
          GOTO      GRCV9999 IF NOT EQUAL     * not received yet
.
GRCV0100  MOVE      ZERO,HCBTAMTR
          MOVE      ZERO,HCBTREJA
          PACK      KEY26,HCBTBTCH,SP70
          CALL      RSHCRCI1
GRCV1000  CALL      RKHCRCI1
          BRANCH    OVRCD,GRCV9999
.
          MATCH     HCBTBTCH,HCRIBTCH      * Same batch number?
          GOTO      GRCV9999 IF NOT EQUAL
.
          ADD       HCRIBENP,HCBTAMTR      * total payment amount
          ADD       HCRIBENR,HCBTREJA      * total rejected amount
          GOTO      GRCV1000
.
GRCV9999  RETURN
.
.-----------------------------------------------------------------------------.
.         Batch details
.-----------------------------------------------------------------------------.
BDET0000  UNPACK    DIM127,D1,KEY1,DIM127
          MOVE      ZERO,F1
          MOVE      KEY1,F1
.
          CALL      BDHD0000               * Heading
.
          UNPACK    BATCHKEY,BTCHNUMB
          PACK      KEY15,BTCHNUMB,SP70
          CALL      RSHCCLM7
BDET1000  CALL      RKHCCLM7
          BRANCH    OVRCD,BDET9999
          MATCH     BTCHNUMB,HCCLBTCH        * Same Batch number?
          GOTO      BDET9999 IF NOT EQUAL
.
          MOVE      "&nbsp;",PATFNAME
          PACK      KEY8,HCCLURNO,SP70
          CALL      RDMAST1
          BRANCH    OVRCD,BDET1000
.
          CALL      RDPMPX21
          BRANCH    OVRCD,BDET1000
.
.         Display all claims for the batch
.
          CALL      PATNAM00
          CALL      PATFLD00                * Use standard Patient Folder sub
          MOVE      KEY3,FOLDERSF           * and store suffix
.
          MOVE      SP70,PVIDATE
          MOVE      SP70,ATIME
          PACK      KEY36,HCCLVISN,SP70
          CALL      RDSBOKA6
          CALL      RDKBOKA6
          BRANCH    OVRCD,BDET2000
          MATCH     HCCLVISN,DOBAOUTN     * same outpatient number?
          GOTO      BDET2000 IF NOT EQUAL
          MOVE      OBADATE,PVIDATE       * outpatient booking
          MOVE      OBATIME,ATIME
.
          MOVE      HCCLVISN,KEY8
          CALL      RDVISA1
          BRANCH    OVRCD,BDET2000
          IF        PVITYPE=3
            CALL      RDMISS1
          ENDIF
.
.         Read link file to get the referral number
.
BDET2000  MOVE      SP10,ALLNVISN
          MOVE      SP10,ALRERDEP
          PACK      KEY16,HCCLVISN,SP70
          CALL      RSALLNK2
          CALL      RKALLNK2
          BRANCH    OVRCD,BDET1000
          MATCH     HCCLVISN,ALLNLNKV
          GOTO      BDET1000 IF NOT EQUAL   * missing referral 
.
          PACK      KEY8,ALLNVISN,SP70      * Patient Referral Details
          CALL      RDALREF1
          BRANCH    OVRCD,BDET1000
.
          WRITE     HTMLFILE;"<tr><td><a HREF = 'javascript:Referral":
                             "(#"",ALREURNO,"#",#"":
                             ALREVISN,"#",#"":
                             ALREDEPT,"#",#"":
                             HCCLVISN,"#",#"":
                             HCCLCLMN:
                             "#")'>":
                             "<img src=../images/PatientFolder",FOLDERSF,".gif":
                             " class=ListIcon></a>";
.
          BRANCH    F1,BDET3000
.
          WRITE     HTMLFILE;PATFNAME,"</td>":
                             "<td>",HCCLURNO,"</td>":
                             "<td>",HCCLVISN,"</td>":
                             "<td>&nbsp;",PMEDI,"</td>";
.
          MATCH     SP70,PVIDATE
          IF        !@EQUAL
            UNPACK    PVIDATE,CCENT,CYEAR,CMON,CDAY
            MOVE      CMON,F2
            LOAD      MTHNAM3,F2,JAN,FEB,MAR,APR,MAY,JUN,JUL,AUG,SEP,OCT,NOV,DEC
            WRITE     HTMLFILE;"<td>&nbsp;",CDAY,SP1,MTHNAM3,SP1,CCENT,CYEAR:
                               " at ",ATIME,"</td>";
          ELSE
            WRITE     HTMLFILE;"<td>&nbsp</td>";
          ENDIF
.
          WRITE     HTMLFILE;"<td><a HREF = 'javascript:ClaimDetail":
                             "(#"",HCCLURNO,"#",#"":
                             HCCLCLMN,"#",#"":
                             HCCLVISN:
                             "#")'>":
                             "<img src=../images/DietIcon.gif":
                             " class=ListIcon></a>",HCCLCLMN,"</td>";
.
          REP       " 0",HCCLVPOS
          MATCH     "00",HCCLVPOS
          IF        @EQUAL
            WRITE     HTMLFILE;"<td>&nbsp;</td>";
          ELSE
            WRITE     HTMLFILE;"<td><a HREF = 'javascript:ClaimDetail":
                             "(#"",HCCLURNO,"#",#"":
                             HCCLCLMN,"#",#"":
                             HCCLVISN:
                             "#")'>":
                             "<img src=../images/DietIcon.gif":
                             " class=ListIcon></a>&nbsp;",HCCLVPOS,"</td>";
          ENDIF
.
          CALL      GITM0000      * get item 
.
          MOVE      SP70,KEY1
          IF        HCCLMITM<>0
            MOVE      "##",KEY1
          ENDIF
          MOVE      ZERO,FORM12P2
          MOVE      HCCLADJM,FORM12P2
          SUB       HCCLWOFF,FORM12P2
.
          PACK      KEY33,HCCLBTCH,SP70
          CALL      RSHCBTC1
          CALL      RKHCBTC1
          BRANCH    OVRCD,BDET2400
          MATCH     HCCLBTCH,HCBTBTCH       * Same batch no?
          GOTO      BDET2400 IF NOT EQUAL
          MATCH     " 5",HCBTSTAT
          GOTO      BDET2200 IF EQUAL       * Received ok
          MATCH     " 6",HCBTSTAT
          GOTO      BDET2200 IF EQUAL       * Received with errors
          MATCH     " 7",HCBTSTAT
          GOTO      BDET2400 IF NOT EQUAL
.
BDET2200  CALL      GAMT0000                * Get rejection amout from Exception
.
BDET2400  WRITE     HTMLFILE;"<td>&nbsp;",KEY1,KEY9,"</td>":
                             "<td align=right>",HCCLCAMN,"</td>":
                             "<td align=right>",HCCLREJA,"</td>":
                             "<td align=right>",FORM12P2,"</td>":
                             "<td align=right>",RESUBAMT,"</td>";
.
          MOVE      SP70,TDESC
          MATCH     SP3,ADJREAS
          IF        !@EQUAL
            PACK      KEY5,ANSH,ANSF,ADJREAS
            CALL      RDCODE1
          ENDIF
.
          WRITE     HTMLFILE;"<td>&nbsp;",TDESC,"</td></tr>";
          GOTO      BDET1000
.
BDET3000  WRITE     HTMLFILE;PATFNAME,"</td>":
                             "<td>",HCCLURNO,"</td>":
                             "<td>",HCCLVISN,"</td>"
.
          MATCH     SP70,PVIDATE
          IF        !@EQUAL
            UNPACK    PVIDATE,CCENT,CYEAR,CMON,CDAY
            MOVE      CMON,F2
            LOAD      MTHNAM3,F2,JAN,FEB,MAR,APR,MAY,JUN,JUL,AUG,SEP,OCT,NOV,DEC
            WRITE     HTMLFILE;"<td>&nbsp;",CDAY,SP1,MTHNAM3,SP1,CCENT,CYEAR:
                               " at ",ATIME,"</td>";
          ELSE
            WRITE     HTMLFILE;"<td>&nbsp</td>";
          ENDIF
.
          PACK      KEY20,HCCLSITE,HCCLCLID,Z70
          CALL      RDSCLIA1
          CALL      RDPCLIA1                *To get Clinic ID Description
          IF        OVRCD=0
            MATCH     HCCLSITE,OCASITE
            IF        !@EQUAL
              MOVE      SP70,OCADESC
              GOTO      BDET4000
            ENDIF
.
            MATCH     HCCLCLID,OCACLIN
            GOTO      BDET4000 IF EQUAL
          ENDIF
          MOVE      SP70,OCADESC
.
BDET4000  WRITE     HTMLFILE;"<td>",OCADESC,"</td>";
.
          WRITE     HTMLFILE;"<td align=center>",HCCLCLMN,"</td>":
                             "<td align=center>&nbsp;",HCCLVPOS,"</td>";
.
          CALL      GITM0000      * get item
.
          MOVE      SP70,KEY1
          IF        HCCLMITM<>0
            MOVE      "##",KEY1
          ENDIF
          WRITE     HTMLFILE;"<td>&nbsp;",KEY1,KEY9,"</td>";
.
          WRITE     HTMLFILE;"<td align=center>":
                             "<input type=checkbox name=claimkey ":
                             "value=#"",HCCLCLMN,"#"></td>";

          GOTO      BDET1000
.
BDET9999  RETURN
.
.-----------------------------------------------------------------------------.
.         Bath details heading
.-----------------------------------------------------------------------------.
BDHD0000  BRANCH    F1,BDHD1000
          WRITE     HTMLFILE;"<tr valign=bottom>":
                             "<td class=HeadingCell align=left width=17%>":
                             "Patient Name</td>":
                             "<td class=HeadingCell align=left width=6%>":
                             "U/R No</td>":
                             "<td class=HeadingCell align=left width=6%>":
                             "Visit No</td>":
                             "<td class=HeadingCell align=left width=7%>":
                             "Medicare #</td>":
                             "<td class=HeadingCell align=left width=8%>":
                             "Visit Date/Time</td>":
                             "<td class=HeadingCell align=left width=7%>":
                             "Claim ##</td>":
                             "<td class=HeadingCell align=left width=6%>":
                             "Voucher ##</td>":
                             "<td class=HeadingCell align=left width=7%>":
                             "CMBS Item</td>":
                             "<td class=HeadingCell align=right width=7%>":
                             "Amount <br> Claimed</td>":
                             "<td class=HeadingCell align=right width=7%>":
                             "Amount <br> Rejected</td>":
                             "<td class=HeadingCell align=right width=7%>":
                             "Amount <br> Adjust.&<br>Write Off</td>":
                             "<td class=HeadingCell align=right width=7%>":
                             "Amount <br> Resubmitted</td>":
                             "<td class=HeadingCell width=8%>":
                             "Reason for<br> Adjustment</td></tr>"
          GOTO      BDHD9999
.
BDHD1000  WRITE     HTMLFILE;"<tr valign=bottom>":
                             "<td class=HeadingCell align=left width=20%>":
                             "Patient Name</td>":
                             "<td class=HeadingCell align=left width=10%>":
                             "U/R No</td>":
                             "<td class=HeadingCell align=left width=10%>":
                             "Visit No</td>":
                             "<td class=HeadingCell align=left width=15%>":
                             "Visit Date/Time</td>":
                             "<td class=HeadingCell align=left width=10%>":
                             "Clinic Id</td>":
                             "<td class=HeadingCell align=center width=8%>":
                             "Claim ##</td>":
                             "<td class=HeadingCell align=center width=8%>":
                             "Voucher ##</td>":
                             "<td class=HeadingCell align=left width=10%>":
                             "CMBS Item</td>":
                             "<td class=HeadingCell align=left width=9%>":
                             "Change Header</td>";
BDHD9999  RETURN
+
.*******************************************************************************
.            Get amount paid and rejected from Exception table
.*******************************************************************************
GAMT0000  MOVE      ZERO,HCCLREJA
          PACK      KEY18,HCCLCLMN,HCCLVISN,SP70
          CALL      RSHCRCI2
GAMT1000  CALL      RKHCRCI2
          BRANCH    OVRCD,GAMT9999
.
          MATCH     HCCLCLMN,HCRICLMN      * Same claim number?
          GOTO      GAMT9999 IF NOT EQUAL
          MATCH     HCCLVISN,HCRIVISN      * Same visit number?
          GOTO      GAMT9999 IF NOT EQUAL
.
          ADD       HCRIBENR,HCCLREJA      * total rejected amount
          GOTO      GAMT1000
.
GAMT9999  RETURN
.
.-----------------------------------------------------------------------------.
. Set table highlight/expiry colours
. EXPRICON - 0 = Red, 1 = Green, 2 = Orange, 3 = Poo
.-----------------------------------------------------------------------------.
SETX0000  MOVE      ONE,EXPRICON            * set col=green
.
          MATCH     "99",HCCLSTAT           * no referral details
          IF        @EQUAL
            MOVE      ZERO,EXPRICON
            GOTO      SETX9999
          ENDIF
.
          MATCH     "98",HCCLSTAT           * no referral provider number
          IF        @EQUAL
            MOVE      ZERO,EXPRICON
            GOTO      SETX9999
          ENDIF
.
          MATCH     SP70,ALRERTYP           * If no referral type, col=red
          IF        @EQUAL
            MOVE      ZERO,EXPRICON
            GOTO      SETX9999
          ENDIF
.
          MATCH     SP70,PMEDI              * If no medicare number, col=red
          IF        @EQUAL
            MOVE      ZERO,EXPRICON
            GOTO      SETX9999
          ENDIF
.
          MATCH     SP70,PTMXMCCD           * If no medicare ref number, col=red
          IF        @EQUAL
            MOVE      ZERO,EXPRICON
            GOTO      SETX9999
          ENDIF
.
          MATCH     SP70,PMPXMEDC           * If no medicare expiry date,col=red
          IF        @EQUAL
            MOVE      ZERO,EXPRICON
            GOTO      SETX9999
          ENDIF     
.
. Check referral expiry date
.
          MATCH     SP70,ALREREXP           * No referral expiry date
          GOTO      SETX9999 IF EQUAL
.
          MATCH     ALREREXP,OBADATE        * If expiry<=Clinic date, col=red
          IF        !@LESS
            MOVE      ZERO,EXPRICON
            GOTO      SETX9999
          ENDIF
.
          PACK      KEY5,ANSR,ANSI,ALRERTYP,SP70
          CALL      RDCODE1
          BRANCH    OVRCD,SETX9999
.
          MATCH     SP70,THCSCOD            * No days for expiry warning
          GOTO      SETX9999 IF EQUAL
.
          MOVE      ZERO,F4
          SQUEEZE   THCSCOD
          MOVE      THCSCOD,F4              * After expiry warning days
          DAYSEP    OBADATE,ALREREXP,F8
          IF        F8<=F4
            MOVE     TWO,EXPRICON
          ENDIF
          GOTO      SETX9999
.
. Check for unexpected claim code
.
SETX5000  MATCH     "2",TCINDC9             * public?
          GOTO      SETX6000 IF EQUAL
.
          MATCH     "1",TCINDC1             * international?
          GOTO      SETX6000 IF EQUAL
.
          MOVE      ZERO,FORM2
SETX5500  ADD       ONE,FORM2
          COMPARE   SIX,FORM2               * wcomp, tac or dva?
          GOTO      SETX9999 IF NOT LESS
.
          LOAD      ANS USING FORM2 OF TCINDC1,TCINDC2,TCINDC3,TCINDC4,TCINDC5
          CMATCH    "W",ANS
          GOTO      SETX6000 IF EQUAL
          CMATCH    "M",ANS
          GOTO      SETX6000 IF EQUAL
          CMATCH    "V",ANS
          GOTO      SETX6000 IF EQUAL
          GOTO      SETX5500
.
SETX6000  MOVE      THREE,EXPRICON          * unexpected claim code
.
SETX9999  RETURN
+
.------------------------------------------------------------
. Display heading for unbatched claim
.------------------------------------------------------------
HDBT0000  WRITE     HTMLFILE;"<tr><td class=HeadingCell align=center":
                             " colspan=12>Unbatched Claims";
.
          MATCH     SP70,SRCHBTCH
          GOTO      HDBT4000 IF NOT EQUAL        * batch number not entered
          PACK      OCADESC,SP70
          MOVE      SRCHPROV,HCCLPSRV
.
          MATCH     SP70,SRCHCLID
          GOTO      HDBT1000 IF EQUAL
.
.         Search by clinic id
.
          PACK      KEY28,WBSESIT,SRCHCLID,SP70
          CALL      RSHCCLM6
          CALL      RKHCCLM6
          BRANCH    OVRCD,HDBT7000
          MATCH     WBSESIT,HCCLSITE
          GOTO      HDBT7000 IF NOT EQUAL
          MATCH     SRCHCLID,HCCLCLID
          GOTO      HDBT7000 IF NOT EQUAL
          GOTO      HDBT5000
.
.         Search by clinic type
.
HDBT1000  MATCH     SP70,SRCHCLTY
          GOTO      HDBT2000 IF EQUAL
.
          PACK      KEY28,WBSESIT,SRCHCLTY,SP70
          CALL      RSHCCLM5
          CALL      RKHCCLM5
          BRANCH    OVRCD,HDBT7000
          MATCH     WBSESIT,HCCLSITE
          GOTO      HDBT7000 IF NOT EQUAL
          MATCH     SRCHCLTY,HCCLCTYP
          GOTO      HDBT7000 IF NOT EQUAL
          GOTO      HDBT5000
.
HDBT2000  MATCH     SP70,SRCHPROV
          GOTO      HDBT8000 IF EQUAL
.
.         Search by provider number
.
          PACK      KEY26,SRCHPROV,SP70
          CALL      RSHCCLM4
          CALL      RKHCCLM4
          BRANCH    OVRCD,HDBT7000
          MATCH     SRCHPROV,HCCLPSRV        * Same provider
          GOTO      HDBT7000 IF NOT EQUAL
          GOTO      HDBT5000
.
.         By batch number
.
HDBT4000  PACK      KEY15,SRCHBTCH,SP70
          CALL      RSHCCLM7
          CALL      RKHCCLM7
          BRANCH    OVRCD,HDBT7000
.
          MATCH     SRCHBTCH,HCCLBTCH        * Same Batch number?
          GOTO      HDBT7000 IF NOT EQUAL
.
          OPEN      PRIDOCT3,"pridoctf"
          PACK      KEY32,HCCLPSRV,SP70
          CALL      RSPRDO3
          CALL      RKPRDO3
          IF        OVRCD=0
            MATCH     HCCLPSRV,PRDOPROV     * Same provider?
            GOTO      HDBT5000 IF NOT EQUAL
            PACK      KEY10,PRDODOCT,SP70
            CALL      RDPMHCP1
            IF        OVRCD=0
              MOVE      "1",PACFRMT
              MOVE      PMHCTITL,PACTITLE
              MOVE      PMHCSNAM,PACSNAME
              MOVE      PMHCGNAM,PACGNAME
              CALL      PACNAME
              MOVE      PACFNAME,OCADESC
              GOTO      HDBT7000
            ENDIF
          ENDIF
.
HDBT5000  PACK      KEY20,HCCLSITE,HCCLCLID,Z70
          CALL      RDSCLIA1
          CALL      RDPCLIA1                *To get Clinic ID Description
          IF        OVRCD=0
            MATCH     HCCLSITE,OCASITE
            IF        !@EQUAL
              MOVE      SP70,OCADESC
              GOTO      HDBT7000
            ENDIF
.
            MATCH     HCCLCLID,OCACLIN
            GOTO      HDBT7000 IF EQUAL
          ENDIF
          MOVE      SP70,OCADESC
.
HDBT7000  WRITE     HTMLFILE;" for Provider - ",OCADESC,"(",HCCLPSRV,")";
.
HDBT8000  WRITE     HTMLFILE;"</td></tr>":
                             "<tr valign=bottom>":
                             "<td class=HeadingCell align=left width=20%>":
                             "Patient Name</td>":
                             "<td class=HeadingCell align=left width=7%>":
                             "U/R No</td>":
                             "<td class=HeadingCell align=left width=7%>":
                             "Visit No</td>":
                             "<td class=HeadingCell align=left width=7%>":
                             "Batch No</td>":
                             "<td class=HeadingCell align=left width=7%>":
                             "Medicare #</td>":
                             "<td class=HeadingCell align=left width=8%>":
                             "Visit Date/Time</td>":
                             "<td class=HeadingCell align=left width=7%>":
                             "CMBS Item</td>":
                             "<td class=HeadingCell align=right width=7%>":
                             "Amount</td>":
                             "<td class=HeadingCell align=center width=7%>":
                             "<input type=button class=button value='All'":
                             " name=allbutt id=allbutt":
                             " onClick='ExcldAll();'><br>":
                             "Exclude</td>":
                             "<td class=HeadingCell align=left width=9%>":
                             "Claim Status</td>":
                             "<td class=HeadingCell align=left width=7%>":
                             "Prev.Batched</td>":
                             "<td class=HeadingCell align=left width=7%>":
                             "Expiry Ind.</td></tr>"
.
HDBT9999  RETURN
+
.-----------------------------------------------------------------------------.
.         Get total amount of batch
.-----------------------------------------------------------------------------.
TOTB0000  MOVE      ZERO,TOTBAMNT
          MOVE      ONE,F3
TOTB1000  IF        F3<=LINKKEY
            MATCH     CLAIMKEY[F3],SP70
            IF        !@EQUAL
              PACK      KEY8,CLAIMKEY[F3],SP70
              CALL      RDHCCLM1
              IF        OVRCD=0
                MOVE      "99",HCCLSTAT      * set status to 9 'Exclude claim'
                MOVE      USERID,HCCLUUID
                CALL      UPHCCLM1
              ENDIF
            ENDIF
            ADD       ONE,F3
            GOTO      TOTB1000
          ENDIF
.
          MOVE      SP70,SRCHPROV
          PACK      KEY15,SRCHBTCH,SP70
          CALL      RSHCCLM7
TOTB2000  CALL      RKHCCLM7
          BRANCH    OVRCD,TOTB9999
          MATCH     SRCHBTCH,HCCLBTCH        * Same Batch number?
          GOTO      TOTB9999 IF NOT EQUAL
          MATCH     " 2",HCCLSTAT
          GOTO      TOTB8200 IF EQUAL        * On hold
          MATCH     " 0",HCCLSTAT
          GOTO      TOTB2000 IF NOT EQUAL
.
          PACK      KEY8,HCCLURNO,SP70
          CALL      RDMAST1
          BRANCH    OVRCD,TOTB8000       * missing master record
          CALL      RDPMPX21
          BRANCH    OVRCD,TOTB8000       * missing master record
.
.         Check if attended
.
          PACK      KEY36,HCCLVISN,SP70
          CALL      RDSBOKA6
          CALL      RDKBOKA6
          BRANCH    OVRCD,TOTB8000
          MATCH     HCCLVISN,DOBAOUTN
          GOTO      TOTB8000 IF NOT EQUAL
          MATCH     "4",DOBASTAT
          GOTO      TOTB8000 IF NOT EQUAL  * Not attended
.
          MATCH     SP70,PMEDI
          GOTO      TOTB8000 IF EQUAL      * No medicare details
          MATCH     SP70,PTMXMCCD          * no medicare ref number
          GOTO      TOTB8000 IF EQUAL
          MATCH     SP70,PMPXMEDC          * no medicare expiry date
          GOTO      TOTB8000 IF EQUAL
.
          PACK      KEY16,HCCLVISN,SP70
          CALL      RSALLNK2
          CALL      RKALLNK2
          BRANCH    OVRCD,TOTB8000
          MATCH     HCCLVISN,ALLNLNKV
          GOTO      TOTB8000 IF NOT EQUAL* missing ref link
.
          PACK      KEY8,ALLNVISN,SP70   * Patient Referral Details
          CALL      RDALREF1
          BRANCH    OVRCD,TOTB8000       * no ref record
          CALL      CPRV0000             * Check referral provider number
          BRANCH    EXIT,TOTB8000        * no referral provider number
.
          ADD       HCCLCAMN,TOTBAMNT    * total batch amount
          MOVE      HCCLPSRV,SRCHPROV
          GOTO      TOTB2000
.
.         Can not batch if no medicare details and no referral ref 
.
TOTB8000  MOVE      "99",HCCLSTAT        * set status to 99 'Exclude claim'
          GOTO      TOTB8400
.
TOTB8200  MOVE      "98",HCCLSTAT        * set status to 98 'Excl on hold claim'
.
TOTB8400  CALL      UPHCCLM7
          GOTO      TOTB2000             * no batching if no medicare detail
.
TOTB9999  RETURN
+
.***************************************************************************
.*                              HOLD0000                                   *
.*              Place claim on hold                                        *
.***************************************************************************
HOLD0000  MOVE      CLMNNUMB,KEY8
          CALL      RDHCCLM1
          BRANCH    OVRCD,HOLD9999
          MOVE      " 2",HCCLSTAT       * Place on hold
          MOVE      USERID,HCCLUUID
          CALL      UPHCCLM1
HOLD9999  RETURN
+
.***************************************************************************
.*                              GBCN0000                                   *
.*              Get next Batch number                                      *
.***************************************************************************
GBCN0000  MOVE      HCCIPMCI,HCBCPMCI
          MOVE      HCCIPYEE,HCBCPYEE
          MOVE      HCCIPSRV,HCBCPSRV
          MOVE      ZERO,NEXTFLAG
          BRANCH    GNXBFLAG,GBCN3000           * Get next batch no
.
.         Check if there is available batch number can be used
.
          PACK      KEY28,HCBCPMCI,HCBCPYEE,HCBCPSRV
          PACK      KEY33,HCBCPMCI,HCBCPYEE,HCBCPSRV,Z70
          CALL      RSHCBCN1
          CALL      RPHCBCN1
          BRANCH    OVRCD,GBCN3000
.
          PACK      SKEY28,HCBCPMCI,HCBCPYEE,HCBCPSRV
          MATCH     KEY28,SKEY28
          GOTO      GBCN3000 IF NOT EQUAL
.
GBCN2000  MATCH     "1",HCBCSTAT
          GOTO      GBCN3000 IF EQUAL          * Completed
          COMPARE   PTCNMCLM,HCBCBCNT
          GOTO      GBCN3000 IF NOT LESS       * reach maximum claims perbatch
.
          MOVE      HCBCBTCH,CLMNBTCH
          ADD       ONE,HCBCBCNT            
          COMPARE   HCBCBCNT,PTCNMCLM
          GOTO      GBCN2100 IF NOT EQUAL
          MOVE      "1",HCBCSTAT               * Claim number reached max
.
GBCN2100  PACK      KEY8,CCC,CYY,CMM,CDD
          REP       " 0",KEY8
          MOVE      KEY8,HCBCUDAT              * date updated
          CLOCK     TIME,HCBCUTIM              * time updated
          MOVE      USERID,HCBCUUID            * web user id
          CALL      UPHCBCN1                   * Update batch status
          GOTO      GBCN9999
.
GBCN3000  BRANCH    NEXTFLAG,GBCN5000          * generate next batch number
          READ      CONTROLF,HUND03;*52,PTCNBTCH
          MATCH     SP70,PTCNBTCH
          GOTO      GBCN4000 IF EQUAL
          MATCH     "00000000",PTCNBTCH
          GOTO      GBCN4200 IF NOT EQUAL
.
GBCN4000  MOVE      "A0001",PTCNBTCH
.
GBCN4200  CALL      CBCN0000             * Check if batch number had been used
          BRANCH    EXIT,GBCN5000        * yes, get next batch number
.
          MOVE      HCCIPMCI,HCBCPMCI
          MOVE      HCCIPYEE,HCBCPYEE
          MOVE      HCCIPSRV,HCBCPSRV
          REP       " 0",PTCNBTCH
          MOVE      PTCNBTCH,CLMNBTCH       * save claim number
.
          PACK      KEY33,HCBCPMCI,HCBCPYEE,HCBCPSRV,CLMNBTCH
          CALL      RDHCBCN1
          IF        OVRCD=0
            MOVE      ONE,NEXTFLAG
            GOTO      GBCN2000
          ENDIF
.
          MOVE      ZERO,NEXTFLAG
          UNPACK    KEY33,HCBCPMCI,HCBCPYEE,HCBCPSRV
          MOVE      PTCNBTCH,HCBCBTCH
          MOVE      ONE,HCBCBCNT            * set claim counter to one
          MOVE      "0",HCBCSTAT            * current batch stat
          UNPACK    SP70,HCBCUDAT,HCBCUTIM,HCBCUUID,HCBCCDAT,HCBCCTIM,HCBCCUID
          PACK      KEY8,CCC,CYY,CMM,CDD
          REP       " 0",KEY8
          MOVE      KEY8,HCBCCDAT             * date created
          CLOCK     TIME,HCBCCTIM             * time created
          MOVE      USERID,HCBCCUID           * web user id
          MOVE      SP70,HCBCSPAR
          CALL      WRHCBCN1
.
.         Generate the next Batch number - 1 Alpha 4 Numeric
.
GBCN5000  UNPACK    PTCNBTCH,KEY1,KEY4
          TYPE      KEY4
          GOTO      GBCN7000 IF EQUAL
          MOVE      "0000",KEY4
.
GBCN7000  MOVE      ZERO,FORM4
          MOVE      KEY4,FORM4
.
          COMPARE   "9999",FORM4
          GOTO      GBCN8000 IF NOT EQUAL
.
          MATCH     "Z",KEY1
          IF        !@EQUAL
            REP       "ABBCCDDEEFFGGHHIIJJKKLLMMNNOOPPQQRRSSTTUUVVWWXXYYZ",KEY1
            MOVE      "0000",FORM4
            GOTO      GBCN8000
          ELSE
            MOVE      "A0001",PTCNBTCH       * back to start again
            GOTO      GBCN9000
          ENDIF
.
GBCN8000  ADD       ONE,FORM4
          MOVE      FORM4,KEY4
          REP       " 0",KEY4
          PACK      PTCNBTCH,KEY1,KEY4
.
GBCN9000  BRANCH    NEXTFLAG,GBCN4200
          WRITAB    CONTROLF,HUND03;*52,PTCNBTCH
.
GBCN9999  RETURN
+
.------------------------------------------------------------
.         Check if batch number had been used
.------------------------------------------------------------
CBCN0000  MOVE      ZERO,EXIT
          PACK      KEY33,PTCNBTCH,SP70
          CALL      RSHCBCN2
          CALL      RKHCBCN2
          BRANCH    OVRCD,CBCN9999
          MATCH     PTCNBTCH,HCBCBTCH
          GOTO      CBCN9999 IF NOT EQUAL
          MOVE      ONE,NEXTFLAG            * get next batch flag
CBCN9000  MOVE      ONE,EXIT
CBCN9999  RETURN
+
.------------------------------------------------------------
. Update excluded claim with the next batch number
.------------------------------------------------------------
HCIT0000  PACK      KEY18,HCCLCLMN,HCCLVISN,SP70
          CALL      RSHCCIT1
HCIT1000  CALL      RKHCCIT1
          BRANCH    OVRCD,HCIT9999
.
          MATCH     HCCLCLMN,HCCICLMN      * Same claim number?
          GOTO      HCIT9999 IF NOT EQUAL
          MATCH     HCCLVISN,HCCIVISN      * Same visit number?
          GOTO      HCIT9999 IF NOT EQUAL
.
          MOVE      CLMNBTCH,HCCIBTCH      * new batch number
          CALL      UPHCCIT1
          GOTO      HCIT1000
.
HCIT9999  RETURN
+
.------------------------------------------------------------
. Update claim status claims file 
.------------------------------------------------------------
CSTA0000  MOVE      ZERO,FORM3
          MOVE      ZERO,HCBTCAMT
          UNPACK    SP70,KEY34,KEY18
          PACK      KEY15,SRCHBTCH,SP70
          CALL      RSHCCLM7
CSTA1000  CALL      RKHCCLM7
          BRANCH    OVRCD,CSTA4000
.
          MATCH     HCCLBTCH,SRCHBTCH
          GOTO      CSTA4000 IF NOT EQUAL
          MATCH     " 0",HCCLSTAT
          GOTO      CSTA1000 IF NOT EQUAL      * batched already
.
.         for all claims that were selected, will be set '1' batched
.
          PACK      KEY34,HCCLPMCI,HCCLPYEE,HCCLPSRV,HCCLMPRA
          PACK      KEY18,HCCLSITE,HCCLCTYP,HCCLCLID
          ADD       ONE,FORM3
          ADD       HCCLCAMN,HCBTCAMT
          MOVE      " 1",HCCLSTAT              * set status to batched
          MOVE      USERID,HCCLUUID
          CALL      UPHCCLM7
.
          CALL      UPDBIT00                   * Update outpatient items file
          GOTO      CSTA1000
.
.         Write record to batch file
.
CSTA4000  MOVE      SRCHBTCH,HCBTBTCH
          UNPACK    KEY34,HCBTPMCI,HCBTPYEE,HCBTPSRV,HCBTMPRA
.
          PACK      KEY33,HCBTBTCH,HCBTPSRV,HCBTPMCI,HCBTPYEE
          CALL      RDHCBTC1
          COMPARE   ZERO,OVRCD
          GOTO      CSTA5000 IF EQUAL
.
          MOVE      SRCHBTCH,HCBTBTCH
          UNPACK    KEY34,HCBTPMCI,HCBTPYEE,HCBTPSRV,HCBTMPRA
          UNPACK    KEY18,HCBTSITE,HCBTCTYP,HCBTCLID
          PACK      HCBTDATE,CCC,CYY,CMM,CDD  * Batched date
          REP       " 0",HCBTDATE
          MOVE      ZERO,HCBTAMTR
          MOVE      ZERO,HCBTREJA
          MOVE      ZERO,HCBTWOFF
          MOVE      ZERO,HCBTTRIN
          MOVE      ZERO,HCBTADJM             * total amount of adjustment
          MOVE      FORM3,HCBTSIZE            * Size of this batch
          MOVE      " 0",HCBTSTAT             * Status to batched
          MOVE      HCBTC002,HCBTCMNT         * Comments
          MOVE      SP70,HCBTTDAT
          UNPACK    SP70,HCBTHCOP,HCBTFNDR,HCBTDEPD,HCBTSENT
          UNPACK    SP70,HCBTCDAT,HCBTCTIM,HCBTCUID,HCBTUDAT,HCBTUTIM,HCBTUUID
.
          PACK      KEY8,CCC,CYY,CMM,CDD
          REP       " 0",KEY8
          MOVE      KEY8,HCBTCDAT             * date created
          CLOCK     TIME,HCBTCTIM             * time created
          MOVE      USERID,HCBTCUID           * web user id
.
          UNPACK    SP70,HCBTUDAT,HCBTUTIM,HCBTUUID
          MOVE      SP70,HCBTEFNM             * extract filename
          MOVE      SP70,HCBTSPAR
          CALL      WRHCBTC1
          GOTO      CSTA6000
.
CSTA5000  PACK      KEY8,CCC,CYY,CMM,CDD
          REP       " 0",KEY8
          MOVE      KEY8,HCBTUDAT           * date updated
          CLOCK     TIME,HCBTUTIM           * time updated
          MOVE      USERID,HCBTUUID         * web user id
          CALL      UPHCBTC1
.
.         Write to history file
.
CSTA6000  MOVE      SP70,SAVESTAT           * History Status
          MOVE      " 0",HCBTSTAT           * Batched
          CALL      WRTHIS00                * History Audit
.
          PACK      BATCHKEY,HCBTBTCH,HCBTPSRV,HCBTPMCI,HCBTPYEE
.
.         Fix the batch size
.
          MOVE      HCBTPMCI,HCBCPMCI
          MOVE      HCBTPYEE,HCBCPYEE
          MOVE      HCBTPSRV,HCBCPSRV
          PACK      KEY33,HCBCPMCI,HCBCPYEE,HCBCPSRV,HCBTBTCH
          CALL      RDHCBCN1
          BRANCH    OVRCD,CSTA9999
.
          MOVE      FORM3,HCBCBCNT            * Size of this batch
          MOVE      "1",HCBCSTAT              * completed
          CALL      UPHCBCN1
.
CSTA9999  RETURN
.
.-----------------------------------------------------------------------------.
.         Update status of outpatient item file to 1 - Batched
.-----------------------------------------------------------------------------.
UPDBIT00  PACK      KEY10,HCCLVISN,SP70
          CALL      RSOTBIT1
UPDBIT10  CALL      RKOTBIT1
          BRANCH    OVRCD,UPDBIT99
          MATCH     OTBIVISN,HCCLVISN
          GOTO      UPDBIT99 IF NOT EQUAL    * not item to print
          MOVE      "1",OTBISTAT             * Batched
          CALL      UPOTBIT1
          GOTO      UPDBIT10
UPDBIT99  RETURN
+
.-----------------------------------------------------------------------------.
.         Set the ticked box claims (excluded claim) to next batch number
.         claim with status of '99' (excluded) will be set back to ' 0'
.-----------------------------------------------------------------------------.
SCLM0000  PACK      KEY15,SRCHBTCH,SP70
          CALL      RSHCCLM7
SCLM1000  CALL      RKHCCLM7
          BRANCH    OVRCD,SCLM9999
          MATCH     SRCHBTCH,HCCLBTCH      * same batch number
          GOTO      SCLM9999 IF NOT EQUAL
.
          MATCH     "98",HCCLSTAT          * Excluded on hold claim ?
          GOTO      SCLM2000 IF EQUAL      * Yes
          MATCH     "99",HCCLSTAT          * Excluded ?
          GOTO      SCLM1000 IF NOT EQUAL  * No
.
.         Set all Printed Claim with next batch number
.
SCLM2000  MOVE      HCCLPMCI,HCCIPMCI
          MOVE      HCCLPYEE,HCCIPYEE
          MOVE      HCCLPSRV,HCCIPSRV
.
          MOVE      ZERO,GNXBFLAG
          CALL      GBCN0000               * Generate next batch number
          MOVE      CLMNBTCH,HCCLBTCH      * New batch number
          MATCH     "98",HCCLSTAT
          IF        @EQUAL
            MOVE      " 2",HCCLSTAT        * Set status to 2 - On hold
          ELSE
            MOVE      " 0",HCCLSTAT        * Set status to 0 - printed
          ENDIF
          CALL      UPHCCLM7
          CALL      HCIT0000               * Upd batch no to claim item file
          GOTO      SCLM0000
.
SCLM9999  RETURN
+
.*******************************************************************************
.   Generate voucher number 
.*******************************************************************************
GVOU0000  CALL      CREA0000                * create item temp file
          CALL      ICLR0000                * clear temp file
          CALL      ECLM0000                * Generate claims for the batch
          CALL      FITM0000                * get and format batch items
          CALL      ICLR0000                * clear temp file
          CALL      KILL0000                * remove existing file
.
GVOU9999  RETURN
+
.*****************************************************************************
.*                            ECLM0000             Called by: GBAT0000       *
.*                   Get claim details for the a batch                       *
.*****************************************************************************
.         Loop through and process the patient records for this batch
.
ECLM0000  PACK      KEY15,SRCHBTCH,SP20
          CALL      RSHCCLM7                     * position in table
ECLM0500  CALL      RKHCCLM7                     * read next record
          BRANCH    OVRCD,ECLM9999               * eof - finished
.
          MATCH     SRCHBTCH,HCCLBTCH            * same batch number still ?
          GOTO      ECLM9999 IF NOT EQUAL        * no - finished
.
          MOVE      HCCLURNO,URNUMBER
          MOVE      HCCLCLMN,CLAIMNUM
          CALL      LITM0000                     * get item details for claim
.
          GOTO      ECLM0500                     * get next claim record
.
ECLM9999  RETURN
+
.*****************************************************************************
.*                            LITM0000             Called by: ECLM0000       *
.*            Format the item details                                        *
.*****************************************************************************
LITM0000  PACK      KEY18,HCCLCLMN,HCCLVISN,SP20
          CALL      RSHCCIT1                     * position in table
LITM0500  CALL      RKHCCIT1                     * read next record
          BRANCH    OVRCD,LITM9999               * eof - finished
.
          MATCH     HCCLCLMN,HCCICLMN            * same claim still ?
          GOTO      LITM9999 IF NOT EQUAL        * no - finished
.
          MATCH     HCCLVISN,HCCIVISN            * same visit still ?
          GOTO      LITM9999 IF NOT EQUAL        * no - finished
.
.         A valid item for this claim has been found, so format item details
.
          MOVE      HCCIITMN,DIM9
          STRIP     DIM9
          MOVELPTR  DIM9,FORM1                   * get length of item number
          BRANCH    FORM1,LITM1000:              * 1 character long
                          LITM2000:              * 2 characters long
                          LITM3000:              * 3 characters long
                          LITM4000:              * 4 characters long
                          LITM5000               * 5 characters long
.
LITM1000  PACK      ITMNUMBR,SP4,DIM9            * 00009 format
          GOTO      LITM6000
.
LITM2000  PACK      ITMNUMBR,SP3,DIM9            * 00099 format
          GOTO      LITM6000
.
LITM3000  PACK      ITMNUMBR,SP2,DIM9            * 00999 format
          GOTO      LITM6000
.
LITM4000  PACK      ITMNUMBR,SP1,DIM9            * 09999 format
          GOTO      LITM6000
.
LITM5000  MOVE      DIM9,ITMNUMBR                * 99999 format
.
LITM6000  REP       " 0",ITMNUMBR                * update with leading zeroes
.
          UNPACK    HCCIIDAT,CCENT,CYEAR,CMON,CDAY  * load & format service date
          PACK      SERVDATE,CDAY,CMON,CYEAR
          REP       " 0",SERVDATE
.
.         Write item record to temp file B.  The same item may occur more than
.         once on the same day, so set the counter to the next number
.         required.
.
          MOVE      ZERO,ITMCOUNT                * initialise item counter
          REPEAT
            ADD       ONE,ITMCOUNT                * increment item counter
            PACK      KEY29,URNUMBER,CLAIMNUM,ITMNUMBR,SERVDATE,ITMCOUNT
            CALL      RATEMPB
          UNTIL     OVRCD = 1
          MOVE      ITMCOUNT,ICOUNTER
          MOVE      HCCICLMN,CLAIMNUM
          MOVE      HCCIVISN,VISITNUM
          MOVE      HCCITRAN,TITEMCNT
          CALL      WRTEMPB
.
          GOTO      LITM0500                     * get next item
.
LITM9999  RETURN
+
.*****************************************************************************
.*                            FITM0000             Called by: FCLM0000       *
.*        Get the voucher records and format the data.                       *
.*        Each voucher can have a maximum of 5 items, so we need to process  *
.*        by patient & claim.                                                *
.* Returns:   ERRFLAG  0 = Ok to continue                                    *
.*                     1 = Error occurred                                    *
.*****************************************************************************
FITM0000  MOVE      SP8,SAVEURNO                 * initialise saved U/R number
          MOVE      SP8,SAVCLAIM                 * initialise saved claim number
          MOVE      ZERO,VCHCOUNT                * re-initalise voucher count
.
          MOVE      SP30,KEY29
          CALL      RSTEMPB                      * position on batch
FITM0500  CALL      RKTEMPB                      * read next record
          BRANCH    OVRCD,FITM9999               * eof - finished items
.
.         An item has been found, so check if the patient and the claim
.         are still the same.  If not, we need to write a new voucher record
.         before writing the item.
.
          MATCH     SAVEURNO,URNUMBER            * same U/R still ?
          IF        @EQUAL
            MATCH     SAVCLAIM,CLAIMNUM          * yes - same claim still ?
            GOTO      FITM0500 IF EQUAL          * yes
          ENDIF
.
.         Either the U/R and/or the claim have changed, so we need to set up
.         for a new voucher
.
          ADD       ONE,VCHCOUNT                 * increment voucher count
          MOVE      URNUMBER,SAVEURNO            * save new U/R number
          MOVE      CLAIMNUM,SAVCLAIM            * save claim number
.
.         Record the voucher's position in the extract file
.
          MOVE      CLAIMNUM,KEY8
          CALL      RDHCCLM1                   * claim record found ?
          BRANCH    OVRCD,FITM0500
.
          MOVE      VCHCOUNT,HCCLVPOS          * voucher position
          REP       " 0",HCCLVPOS
          CALL      UPHCCLM1
          GOTO      FITM0500
.
FITM9999  RETURN
+
.*******************************************************************************
.   Schedule DB1N Print be run via Program Scheduler
.*******************************************************************************
SDB10000  MOVE      "IBAHIC06",SCHDPGID
          MOVE      "DB1N HIC Claim Form",SCHDDESC
          PACK      SCHDDATE,CCC,CYY,CMM,CDD
          REP       " 0",SCHDDATE
          CLOCK     TIME,SCHDTIME
          PACK      SCHDPRNT,ANSS,SP70             * Spool File
          MATCH     SP70,SELPRINT
          IF        !@EQUAL
            MOVE      SELPRINT,SCHDPRNT      * printer code
          ENDIF
          MOVE      HICCLEXT,SETDFPRG
          MOVE      "1",SETDFRPT
          CALL      SETDEF00                 * save default printer
.
.         Write Keyin parameters for Extract
.
          MOVE      BATCHKEY,KEYSTARR[1]     * Batch Key
          MOVE      "Y",KEYSTARR[2]
          MOVE      SP1,KEYSTARR[3]
          MOVE      THREE,KEYSTCNT           * Number of Keyins
.
          CALL      SCHPRO00   * Schedule Extract
.
SDB19999  RETURN
+
.*******************************************************************************
.                          Send extraction file to HIC
.   Schedule Extract to be run via Program Scheduler
.*******************************************************************************
SHIC0000  MOVE      "IBAHIC03",SCHDPGID
          MOVE      "HIC Claim Extraction",SCHDDESC
          PACK      SCHDDATE,CCC,CYY,CMM,CDD
          REP       " 0",SCHDDATE
          CLOCK     TIME,SCHDTIME
          PACK      SCHDPRNT,ANSS,SP70             * initialise to spool
          MATCH     SP70,SELPRINT
          IF        !@EQUAL
            MOVE      SELPRINT,SCHDPRNT      * printer code
          ENDIF
          MOVE      HICCLEXT,SETDFPRG
          MOVE      "1",SETDFRPT
          CALL      SETDEF00                 * save default printer
.
          PACK      SCHDPRNT,ANSS,SP70       * Always spool extract report
.
.         Write Keyin parameters for Extract
.
          CMATCH    "Y",UPDATETY             * Re-Extracting batch?
          IF        @EQUAL
            MOVE      THREE,KEYSTARR[1]      * Option
            MOVE      "T",KEYSTARR[6]        * flag for test
          ELSE
            MOVE      ONE,KEYSTARR[1]        * Option
            MOVE      "L",KEYSTARR[6]        * live
          ENDIF
.
          MOVE      SRCHBTCH,KEYSTARR[2]     * Batch number
          MOVE      "Y",KEYSTARR[3]
          MOVE      USERID,KEYSTARR[4]
          MOVE      SELPRINT,KEYSTARR[5]     * printer for DB1N form (ibahic06)
.
          MOVE      SP1,KEYSTARR[7]
          MOVE      SP1,KEYSTARR[8]
          MOVE      EIGHT,KEYSTCNT           * Number of Keyins
.
          CALL      SCHPRO00   * Schedule Extract
.
SHIC9999  RETURN
+
.*******************************************************************************
.                          Next Day, Week, Month
.*******************************************************************************
NEXT0000  MOVE      TEMPLATE,F3
          MOVE      F3,KEY3
          REP       " 0",KEY3
          REP       " +",SRCHBTCH
          REP       " +",SRCHPRAC
          REP       " +",SRCHSDOC
          REP       " +",SRCHPROV
          REP       " +",SRCHCLID
          REP       " +",SRCHCLTY
          REP       " +",SRCHSTAT
.
          MOVE      REPORTNO,F2
          MOVE      F2,KEY2
          REP       " 0",KEY2
          WRITE     HTMLFILE;"hicweb01.pbl":
                             "?reportno=",KEY2:
                             "&template=",KEY3:
                             "&frstdate=",NXTFDATE:
                             "&lastdate=",NXTLDATE:
                             "&viewtype=",VIEWTYPE:
                             "&srchbtch=",SRCHBTCH:
                             "&srchprac=",SRCHPRAC:
                             "&srchsdoc=",SRCHSDOC:
                             "&srchprov=",SRCHPROV:
                             "&srchclid=",SRCHCLID:
                             "&srchclty=",SRCHCLTY:
                             "&srchstat=",SRCHSTAT;
          REP       "+ ",SRCHBTCH
          REP       "+ ",SRCHPRAC
          REP       "+ ",SRCHSDOC
          REP       "+ ",SRCHPROV
          REP       "+ ",SRCHCLID
          REP       "+ ",SRCHCLTY
          REP       "+ ",SRCHSTAT
.
NEXT9999  RETURN
.*******************************************************************************
.                          Previous Day, Week, Month
.*******************************************************************************
PREV0000  MOVE      TEMPLATE,F3
          MOVE      F3,KEY3
          REP       " 0",KEY3
          REP       " +",SRCHBTCH
          REP       " +",SRCHPRAC
          REP       " +",SRCHSDOC
          REP       " +",SRCHPROV
          REP       " +",SRCHCLID
          REP       " +",SRCHCLTY
          REP       " +",SRCHSTAT
.
          MOVE      REPORTNO,F2
          MOVE      F2,KEY2
          REP       " 0",KEY2
          WRITE     HTMLFILE;"hicweb01.pbl":
                             "?reportno=",KEY2:
                             "&template=",KEY3:
                             "&frstdate=",PREFDATE:
                             "&lastdate=",PRELDATE:
                             "&viewtype=",VIEWTYPE:
                             "&srchbtch=",SRCHBTCH:
                             "&srchprac=",SRCHPRAC:
                             "&srchsdoc=",SRCHSDOC:
                             "&srchprov=",SRCHPROV:
                             "&srchclid=",SRCHCLID:
                             "&srchclty=",SRCHCLTY:
                             "&srchstat=",SRCHSTAT;
          REP       "+ ",SRCHBTCH
          REP       "+ ",SRCHPRAC
          REP       "+ ",SRCHSDOC
          REP       "+ ",SRCHPROV
          REP       "+ ",SRCHCLID
          REP       "+ ",SRCHCLTY
          REP       "+ ",SRCHSTAT
.
PREV9999  RETURN
.
.*******************************************************************************
. Update Comments or delete if first line is blank  
.*******************************************************************************
UPCM0000  MOVE      ZERO,EXIT
          PACK      UPDATEKY,ADMISSNO,SP70    * used by UPVCM000
          CALL      UPVCM000
.
          MOVE      "006",KEY3
.
          PACK      KEY14,ADMISSNO,KEY3,SP70
          CALL      RSVSCMT1
UPCM1000  CALL      RKVSCMT1
          BRANCH    OVRCD,UPCM9999
.
          MATCH     ADMISSNO,VSCTVIST
          GOTO      UPCM9999 IF NOT EQUAL
.
          MATCH     KEY3,VSCTTYPE
          GOTO      UPCM9999 IF NOT EQUAL
.
          MATCH     SP70,VSCTDATA
          GOTO      UPCM9999 IF NOT EQUAL
.
          PACK      KEY14,VSCTVIST,VSCTTYPE,VSCTLINE,SP70
          CALL      DEVSCMT1
.
UPCM9999  CLOSE     VSCTTFIL,DELETE    * Delete temp file created by CLRVCM00
          RETURN
+
.------------------------------------------------------------
CLCIT000  MOVE      SP70,HCCICLMN  * Claim Number
          MOVE      SP70,HCCIVISN  * Visit Number
          MOVE      SP70,HCCITRAN  * Item count
          MOVE      SP70,HCCIPMCI  * MCI (3 Alpha 5 Numeric)
          MOVE      SP70,HCCIPYEE  * Payee Provider Number
          MOVE      SP70,HCCIPSRV  * Service Provider Number
          MOVE      SP70,HCCIBTCH  * Batch Number (1 Alpha 4 Numeric)
          MOVE      SP70,HCCIIFLG  * Item Flag 0=MBS 1=AMA
          MOVE      SP70,HCCIITMN  * MBS Item Number
          MOVE      SP70,HCCISUBN  * MBS Subitem Number
          MOVE      SP70,HCCIIDAT  * Service Date
          MOVE      ZERO,HCCICAMT  * Item Amount
          MOVE      ZERO,HCCIREJA  * Amount Rejected
          MOVE      ZERO,HCCIWOFF  * Amount 'Write off'
          MOVE      ZERO,HCCITRIN  * Amount 'Transfer to Invoice'
          MOVE      SP70,HCCIREJR  * Reason for Rejection Catg HD
          MOVE      SP70,HCCIREJD  * Rejection Date (ccyymmdd)
          MOVE      SP70,HCCIRWOF  * Reason for 'Write Off' catg HE
          MOVE      SP70,HCCIWOFD  * Write Off Date (ccyymmdd)
          MOVE      SP70,HCCITRND  * Transfer to Invoice Date (ccyymmdd)
          MOVE      SP70,HCCICDAT  * Date Record Created (ccyymmdd)
          MOVE      SP70,HCCICTIM  * Time Record Created (hh:mm:ss)
          MOVE      SP70,HCCICUID  * WEB User ID Created (websecaf)
          MOVE      SP70,HCCIUDAT  * Date Record Updated (ccyymmdd)
          MOVE      SP70,HCCIUTIM  * Time Record Updated (hh:mm:ss)
          MOVE      SP70,HCCIUUID  * WEB User Id Updated (websecaf)
          MOVE      SP70,HCCISPAR  * Spare Variable
CLCIT999  RETURN
.
.------------------------------------------------------------
. Write record to batch history audit file
.------------------------------------------------------------
WRTHIS00  MATCH     SAVESTAT,HCBTSTAT            * Exit if no status change
          GOTO      WRTHIS99 IF EQUAL 
.
          MOVE      HCBTBTCH,HCHSBTCH            * Batch Number
          MOVE      HCBTPMCI,HCHSPMCI            * MCI
          MOVE      HCBTPYEE,HCHSPYEE            * Payee Provider No
          MOVE      HCBTPSRV,HCHSPSRV            * Service Provider No
.
          PACK      HCHSTDAT,CCC,CYY,CMM,CDD     * Transaction Date
          REP       " 0",HCHSTDAT
          CLOCK     TIME,HCHSTTIM                * Transaction Time
.
          MOVE      WBSEUID,HCHSTUID             * Web user id
          MOVE      HCBTSTAT,HCHSSTAT
          MOVE      SP70,HCHSSPAR                * Spare
.
WRTHIS10  PACK      KEY49,HCHSBTCH,HCHSPSRV,HCHSPMCI,HCHSPYEE,HCHSTDAT:
                          HCHSTTIM,SP70
          CALL      RAHCHIS1
          BRANCH    OVRCD,WRTHIS20
          CLOCK     TIME,HCHSTTIM
          GOTO      WRTHIS10
.
WRTHIS20  CALL      WRHCHIS1                   * Write History Record
.
WRTHIS99  RETURN
.
.------------------------------------------------------------
. Batch history listing
.------------------------------------------------------------
BHIS0000  PACK      KEY33,BATCHKEY,SP70
          CALL      RDHCBTC1
          BRANCH    OVRCD,BHIS9999
.
          PACK      KEY49,BATCHKEY,Z70
          CALL      RSHCHIS1
BHIS1000  CALL      RPHCHIS1
          BRANCH    OVRCD,BHIS9999
.
          MATCH     HCBTBTCH,HCHSBTCH            * Batch Number
          GOTO      BHIS9999 IF NOT EQUAL
.
          MATCH     HCBTPSRV,HCHSPSRV            * Service Provider No
          GOTO      BHIS9999 IF NOT EQUAL
.
          MATCH     HCBTPMCI,HCHSPMCI            * MCI
          GOTO      BHIS9999 IF NOT EQUAL
.
          MATCH     HCBTPYEE,HCHSPYEE            * Payee Provider No
          GOTO      BHIS9999 IF NOT EQUAL
.
          PACK      KEY10,HCHSTUID,SP70
          CALL      RDWBSE1
          IF        OVRCD=1
            MOVE      "Invalid User Id",WBSENAM
            MATCH     "HIC",HCHSTUID
            IF        @EQUAL
              MOVE      "HIC            ",WBSENAM
            ENDIF
          ENDIF
. 
          MOVE      STATBTCH,DISPSTAT
          MOVE      ZERO,FORM2
          MOVE      HCHSSTAT,FORM2
          LOAD      DISPSTAT,FORM2,STATEXTR,STATSENT,STATACKW,STATNACK,STATRECV:
                                STATRECX,STATPAYX,STATACTN,STATDEPX,STATCLSE:
                                STATCOPY,STATHEAD
.
BHIS4000  UNPACK    HCHSTDAT,CCENT,CYEAR,CMON,CDAY
          MOVE      CMON,F2
          LOAD      MTHNAM3,F2,JAN,FEB,MAR,APR,MAY,JUN,JUL,AUG,SEP,OCT,NOV,DEC
          WRITE     HTMLFILE;"<tr><td>&nbsp;":
                               CDAY,SP1,MTHNAM3,SP1,CCENT,CYEAR:
                             " at ",HCHSTTIM,"</td>";
.
          WRITE     HTMLFILE;"<td>&nbsp;",DISPSTAT,"</td>":
                             "<td>&nbsp;",WBSENAM,"</td></tr>"
.
          GOTO      BHIS1000
.
BHIS9999  RETURN
.
.------------------------------------------------------------
. Batch error list
.------------------------------------------------------------
BERR0000  PACK      KEY33,BATCHKEY,SP70
          CALL      RDHCBTC1
          BRANCH    OVRCD,BERR9999
.
          PACK      KEY8,HCBTBTCH,SP70
          CALL      RSHCERR1
BERR1000  CALL      RKHCERR1
          BRANCH    OVRCD,BERR9999
.
          MATCH     HCBTBTCH,HCERBTCH
          GOTO      BERR9999 IF NOT EQUAL
.
          WRITE     HTMLFILE;"<tr><td>",HCERLCNT,"</td>":
                                 "<td>",HCERPMCI,"</td>":
                                 "<td>",HCERPYEE,"</td>":
                                 "<td>",HCERPSRV,"</td>":
                                 "<td>&nbsp;",HCERCLMN,"</td>":
                                 "<td>&nbsp;",HCERVPOS,"</td>":
                                 "<td>&nbsp;",HCERMEDI,"</td>":
                                 "<td>&nbsp;",HCERFNAM,"</td>":
                                 "<td>&nbsp;",HCERSURN,"</td>":
                                 "<td>&nbsp;",HCERITMN,"</td>":
                                 "<td>&nbsp;",HCERIDAT,"</td>":
                                 "<td>",HCERBASS,"</td>":
                                 "<td>",HCERBPAD,"</td>":
                                 "<td>&nbsp;",HCERECOD,"</td>":
                                 "<td>&nbsp;",HCERDESC,"</td></tr>"
.
          GOTO      BERR1000
.
BERR9999  RETURN
.
.------------------------------------------------------------
. Private Practice Medical Practice - with security checks
.------------------------------------------------------------
SELPPS00  MOVE      ZERO,FORM1
          PACK      KEY10,WBSEUID,SP70
          CALL      RDPRALS1
          BRANCH    OVRCD,SELPPS05
          MOVE      ONE,FORM1       * User has access to all practices
          WRITE     HTMLFILE;"<option></option>"
.
SELPPS05  PACK      KEY36,SP70
          CALL      RSPRPR2
SELPPS10  CALL      RKPRPR2
          BRANCH    OVRCD,SELPPS99
.
          IF        FORM1=0
            PACK      KEY16,PRPRCODE,WBSEUID,SP70
            CALL      RDPRSEC1
            BRANCH    OVRCD,SELPPS10
          ENDIF
.
          PACK      KEY25,PRPRDESC,SP30
          PACK      KEY8,QUOTE,PRPRCODE,QUOTE
.
          WRITE     HTMLFILE;"<option value=",KEY8,">":
                    KEY25,"</option>"
.
          GOTO      SELPPS10
.
SELPPS99  RETURN
.
.------------------------------------------------------------
. Update referral and claim details
.------------------------------------------------------------
UCLM0000  RESET     UPDATETY
          MATCH     SP70,UPDATETY
          GOTO      UCLM9000 IF EQUAL
.
          MATCH     "U",UPDATETY           * Update claim
          GOTO      UCLM1000 IF EQUAL
.
          GOTO      UCLM9100
.
UCLM1000  CALL      UMAS0000               * Update pmi details 
          BRANCH    EXIT,UCLM9999
.
          CALL      UPCM0000               * Update Comments
.
          BRANCH    UPMIONLY,UCLM1100      * Update pmi only 
.
          CALL      UREF0000               * Update referral
          BRANCH    EXIT,UCLM9999
.
          CALL      UBOK0000               * Update outpatient items 
          BRANCH    EXIT,UCLM9999          * CASEKEYS set in this function
.
          COMPARE   " 2",UPMIONLY          * Don't update claim as one has not
          GOTO      UCLM1100 IF EQUAL      * been printed
.
          CALL      HICCLAIM               * writes record to hicclmaf
          BRANCH    EXIT,UCLM9400,UCLM9500
.
UCLM1100  CALL      PCLM0000               * Print claim form
          BRANCH    EXIT,UCLM9400,UCLM9500
.
          MOVE      ZERO,EXIT
          GOTO      UCLM9999
.
UCLM9000  PACK      KEY8,URNUMBER,SP70
          CALL      RDMAST1
          BRANCH    OVRCD,UCLM9200
.
          PACK      KEY8,URNUMBER,SP70
          CALL      RDPMPX21
          BRANCH    OVRCD,UCLM9200
.
          PACK      KEY8,REFRNUMB,SP70
          CALL      RDALREF1
          BRANCH    OVRCD,UCLM9300
.
          PACK      KEY8,CLMNNUMB,SP70
          CALL      RDHCCLM1
          IF        OVRCD=1
            CALL      CLHICCLM             * clear fields
          ENDIF
.
          PACK      KEY36,ADMISSNO,SP70
          CALL      RDSBOKA6               * outpatient booking
          CALL      RDKBOKA6
          IF        OVRCD=1
            CALL      CLOUTBOA
          ELSE
            MATCH     ADMISSNO,DOBAOUTN
            IF        !@EQUAL
              CALL      CLOUTBOA
            ENDIF
          ENDIF
.
          PACK      KEY8,ADMISSNO,SP70
          CALL      RDBOKB1
          IF        OVRCD=1
            CALL      CLOUTBB1
          ENDIF
.
          PACK      KEY18,OBASITE,OBACLIN,OBADAY,OBASTRT,SP70
          CALL      RDMASA1
          IF        OVRCD=1
            CALL      CLRMAS00    * Clear all the file variables
          ENDIF
.
          CLEAR     WEBTITLE
          MOVE      "Update Claim",WEBTITLE
          RESET     WEBTITLE
.
          CALL      WEBHED00   * Create Output File and Write HTML Page Header
          BRANCH    EXIT,CLMLST99
          CALL      WEBBOD00   * Process Web Body
          CALL      WEBEND00   * Process End of HTML File
.
          MOVE      ONE,EXIT
          GOTO      UCLM9999
.
UCLM9100  MOVE      "Invalid Update Type.",WEBTITLE
          CALL      WEBERR00
          MOVE      ONE,EXIT
          GOTO      UCLM9999
.
UCLM9200  MOVE      "Invalid U/R Number.",WEBTITLE
          CALL      WEBERR00
          MOVE      ONE,EXIT
          GOTO      UCLM9999
.
UCLM9300  MOVE      "Invalid Referral Number.",WEBTITLE
          CALL      WEBERR00
          MOVE      ONE,EXIT
          GOTO      UCLM9999
.
UCLM9400  MOVE      "Invalid batch status - Claim already batched.",WEBTITLE
          CALL      WEBERR00
          MOVE      ONE,EXIT
          GOTO      UCLM9999
.
UCLM9500  MOVE      "No claim items to print.",WEBTITLE
          CALL      WEBERR00
          MOVE      ONE,EXIT
          GOTO      UCLM9999
.
UCLM9999  RETURN
.
.***************************************************************************
.*                              PRTBTC00                                   *
.*                      Print batch report                                 *
.***************************************************************************
PRTBTC00  CALL      OPNPRINT
          PACK      SCHDPRNT,ANSS,SP70          * Spool File
          MATCH     SP70,SELPRINT
          IF        !@EQUAL
            MOVE      SELPRINT,SCHDPRNT      * printer code
          ELSE
            MOVE      SCHDPRNT,SELPRINT
          ENDIF
.
          MOVE      HICCLCON,SETDFPRG
          MOVE      "1",SETDFRPT
          CALL      SETDEF00
.
          CALL      HICPRCLM         * print batch report
          CALL      CLSPRINT
.
          MOVE      ZERO,EXIT
.
PRTBTC99  RETURN
+
.***************************************************************************
.*                              GCLM0000                                   *
.*              Get next claim number                                      *
.***************************************************************************
GCLM0000  MOVE      ZERO,FORM8
          READ      CONTROLF,HUND03;*44,PTCNCLMN
          MATCH     SP70,PTCNCLMN
          GOTO      GCLM1000 IF EQUAL
          MATCH     "00000000",PTCNCLMN
          GOTO      GCLM1000 IF EQUAL
.
          MOVE      PTCNCLMN,FORM8
          COMPARE   ZERO,FORM8
          GOTO      GCLM2000 IF NOT EQUAL
.
GCLM1000  MOVE      "1",FORM8
          MOVE      FORM8,PTCNCLMN
.
GCLM2000  MOVE      PTCNCLMN,FORM8
          MOVE      FORM8,NEWCLAIM       * save claim number
          MOVE      FORM8,KEY8
          CALL      RDHCCLM1
          IF        OVRCD=0
            ADD       ONE,FORM8          * try next claim number
            MOVE      FORM8,PTCNCLMN
            GOTO      GCLM2000
          ENDIF
.
          ADD       ONE,FORM8
          MOVE      FORM8,PTCNCLMN
          WRITAB    CONTROLF,HUND03;*44,PTCNCLMN
.
GCLM9999  RETURN
.
.
.------------------------------------------------------------
. SPMAS000 - Set Parameters for Master Details
. Returns:    EXIT   0
.                    1
.------------------------------------------------------------
.
SPMAS000  UNPACK    QRYNAME,KEY5,KEY3
          MOVE      KEY3,F3
          BRANCH    F3,SPMAS910,SPMAS910,SPMAS910,SPMAS910,SPMAS910:
                       SPMAS910,SPMAS910,SPMAS080,SPMAS090,SPMAS100:
                       SPMAS110,SPMAS120,SPMAS130,SPMAS910,SPMAS910:
                       SPMAS910,SPMAS910,SPMAS910,SPMAS910,SPMAS910:
                       SPMAS910,SPMAS910,SPMAS230
.
          GOTO      SPMAS910

SPMAS080  MOVE      QRYDATA,PTMAS008
          GOTO      SPMAS900
.
SPMAS090  MOVE      QRYDATA,PTMAS009
          GOTO      SPMAS900
.
SPMAS100  MOVE      QRYDATA,PTMAS010
          GOTO      SPMAS900
.
SPMAS110  MOVE      QRYDATA,PTMAS011
          GOTO      SPMAS900
.
SPMAS120  MOVE      QRYDATA,PTMAS012
          GOTO      SPMAS900
.
SPMAS130  MOVE      QRYDATA,PTMAS013
          GOTO      SPMAS900
.
SPMAS230  MOVE      QRYDATA,PTMAS023
          GOTO      SPMAS900
.
SPMAS900  MOVE      ONE,MASUPDFL
          MOVE      ZERO,EXIT
          GOTO      SPMAS999
.
SPMAS910  MOVE      ONE,EXIT
SPMAS999  RETURN
.
.------------------------------------------------------------
. SPMSX000 - Set Parameters for Master Extension Details
. Returns:    EXIT   0
.                    1
.------------------------------------------------------------
.
SPMSX000  UNPACK    QRYNAME,KEY5,KEY3
          MOVE      KEY3,F3
          BRANCH    F3,SPMSX910,SPMSX910,SPMSX910,SPMSX910,SPMSX910:
                       SPMSX910,SPMSX910,SPMSX910,SPMSX910,SPMSX910:
                       SPMSX910,SPMSX910,SPMSX910,SPMSX910,SPMSX910:
                       SPMSX910,SPMSX910,SPMSX910,SPMSX910,SPMSX910:
                       SPMSX910,SPMSX910,SPMSX910,SPMSX910,SPMSX910:
                       SPMSX910,SPMSX910,SPMSX910,SPMSX910,SPMSX910:
                       SPMSX910,SPMSX910,SPMSX910,SPMSX910,SPMSX910:
                       SPMSX910,SPMSX910,SPMSX910,SPMSX910,SPMSX910:
                       SPMSX910,SPMSX910,SPMSX910,SPMSX910,SPMSX450
.
          GOTO      SPMSX910
.
SPMSX450  MOVE      QRYDATA,PTMSX045
          GOTO      SPMSX900
.
SPMSX900  MOVE      ONE,MASUPDFL
          MOVE      ZERO,EXIT
          GOTO      SPMSX999
.
SPMSX910  MOVE      ONE,EXIT
SPMSX999  RETURN
.
.------------------------------------------------------------
. Update pmi details 
.------------------------------------------------------------
UMAS0000  PACK      KEY8,URNUMBER,SP70
          CALL      RDMAST1
          BRANCH    OVRCD,UMAS9100
.         
          PACK      KEY8,URNUMBER,SP70
          CALL      RDPMPX21
          BRANCH    OVRCD,UMAS9100
.
          COMPARE   ONE,MASUPDFL
          GOTO      UMAS8000 IF NOT EQUAL
.
          CALL      MVPMI000         * move cgi variables
          CALL      UPMAST1          * update pmi file
.
          CALL      UPPMPX21         * update extension file
.
          CALL      PMIGTNID              * get national id for dgate write
          MOVE      NMPNUMB,PTNINMPI
          MOVE      ONE,HL7TRGID
          MOVE      SP8,HL7INCLD
          PROC      DGCLICUP              * broadcast PMI update message
.
UMAS8000  MOVE      ZERO,EXIT
          GOTO      UMAS9999
.
UMAS9100  MOVE      "Invalid U/R Number",WEBTITLE
          CALL      WEBERR00
          MOVE      ONE,EXIT
.
UMAS9999  RETURN
.
.------------------------------------------------------------
. Update referral details
.------------------------------------------------------------
UREF0000  PACK      KEY8,REFRNUMB,SP70
          CALL      RDALREF1
          BRANCH    OVRCD,UCLM9300
.
          MOVE      TWO,AUDTTYPE            * before history record
          CALL      WAALRE00
.
          CALL      MVALRE00
.
          CALL      UPALREF1
.
          CALL      PMIGTNID                * get national id for dgate write
          MOVE      NMPNUMB,PTNINMPI
          MOVE      TWO,HL7TRGID
          MOVE      SP8,HL7INCLD
          CALL      DGCLII13                * broadcast Update Ref. (REF^I13)
.
          MOVE      THREE,AUDTTYPE          * after history record
          CALL      WAALRE00
.
          CALL      ACMB0000                * Check for any CMBS item with
.                                           * allied health cgi names
UREF8000  MOVE      ZERO,EXIT
          GOTO      UREF9999
.
UREF9100  MOVE      "Invalid Referral Number",WEBTITLE
          CALL      WEBERR00
          MOVE      ONE,EXIT
.
UREF9999  RETURN
.
.------------------------------------------------------------
. Update outpatient booking item details
.------------------------------------------------------------
UBOK0000  CALL      CMBS0000                * Check for CMBS items
.
          PACK      KEY8,ADMISSNO,SP70
          CALL      RDBOKB1
          BRANCH    OVRCD,UBOK7000
.
          CALL      MOVBB000                * Move outbb1af cgi to file
.
          CALL      UPBOKB1
.
          PACK      KEY8,OBAOUTNO,SP70
          CALL      RDPMVX11
            IF        OVRCD=0
              CALL      IBACLOCK
              PACK      PMVXLUPD,CCC,CYY,CMM,CDD
              REP       " 0",PMVXLUPD
              MOVE      CTIMEIS,PMVXLUPT
              MOVE      USERID,PMVXWEBU
              CALL      UPPMVX11
          ENDIF
.
UBOK7000  PACK      CASEKEYS,OBASITE,OBACLIN,OBADATE,OBASTRT,OBASLOT,SP70
.
UBOK8000  MOVE      ZERO,EXIT
          GOTO      UBOK9999
.
UBOK9100  MOVE      "Invalid outpatient booking number",WEBTITLE
          CALL      WEBERR00
          MOVE      ONE,EXIT
.
UBOK9999  RETURN
.
.------------------------------------------------------------
. Check for CMBS items
.------------------------------------------------------------
ACMB0000  COMPARE   ONE,AMBSFLAG
          GOTO      ACMB9999 IF NOT EQUAL
.
          PACK      KEY10,REFRNUMB,SP10
          CALL      RSALRIT1
          CALL      RKALRIT1
          BRANCH    OVRCD,ACMB1000
          MATCH     REFRNUMB,ALRTVISN
          GOTO      ACMB1000 IF NOT EQUAL    * Different visit number
.
          PACK      KEY10,ALRTVISN,ALRTITMC
          CALL      DEALRIT1
          GOTO      ACMB0000
.
ACMB1000  MOVE      ZERO,F2
          MOVE      ZERO,FORM2
          MOVE      REFRNUMB,ALRTVISN         * Visit number
.
ACMB1200  COMPARE   FIVE,F2
          GOTO      ACMB9999 IF EQUAL         * reach maximum of 5 MBS items
          ADD       ONE,F2
          LOAD      ALRTIFLG,F2,ALRIT001,ALRIT004,ALRIT007,ALRIT010,ALRIT013
.
          MATCH     Z70,ALRTIFLG
          GOTO      ACMB1200 IF EQUAL
.
          MATCH     SP70,ALRTIFLG
          GOTO      ACMB1200 IF EQUAL
.
          LOAD      ALRTITMN,F2,ALRIT002,ALRIT005,ALRIT008,ALRIT011,ALRIT014
          LOAD      ALRTSUBN,F2,ALRIT003,ALRIT006,ALRIT009,ALRIT012,ALRIT015
          LOAD      ALRTPUSE,F2,ALRIT016,ALRIT017,ALRIT018,ALRIT019,ALRIT020
.
          MATCH     SP70,ALRTITMN
          GOTO      ACMB1200 IF EQUAL
.
          MATCH     Z70,ALRTITMN
          GOTO      ACMB1200 IF EQUAL
.
          ADD       ONE,FORM2
          MOVE      FORM2,ALRTITMC
.
          PACK      KEY10,ALRTVISN,ALRTITMC
          CALL      RAALRIT1
          IF        OVRCD=1
            PACK      ALRTCDAT,CCC,CYY,CMM,CDD
            REP       " 0",ALRTCDAT             * date created
            CLOCK     TIME,ALRTCTIM             * time created
            MOVE      USERID,ALRTCUID           * web user id
            UNPACK    SP70,ALRTUDAT,ALRTUTIM,ALRTUUID
            CALL      WRALRIT1
          ELSE
            PACK      ALRTUDAT,CCC,CYY,CMM,CDD
            REP       " 0",ALRTUDAT             * date updated
            CLOCK     TIME,ALRTUTIM             * time updated
            MOVE      USERID,ALRTUUID           * web user id
            CALL      UPALRIT1
          ENDIF
          GOTO      ACMB1200
.
ACMB9999  RETURN
.
.------------------------------------------------------------
. Update outpatient booking CMBS items
.------------------------------------------------------------
CMBS0000  COMPARE   ONE,CMBSFLAG             * check if any cmbs items updated
          GOTO      CMBS9999 IF NOT EQUAL
.
          PACK      KEY36,ADMISSNO,SP70
          CALL      RDSBOKA6
          CALL      RDKBOKA6
          BRANCH    OVRCD,CMBS9999
.
          MATCH     ADMISSNO,DOBAOUTN
          GOTO      CMBS9999 IF NOT EQUAL
.
CMBS0500  PACK      KEY10,OBAOUTNO,SP10
          CALL      RSOTBIT1
          CALL      RKOTBIT1
          BRANCH    OVRCD,CMBS1000
          MATCH     DOBAOUTN,OTBIVISN
          GOTO      CMBS1000 IF NOT EQUAL    * Different visit number
.
          PACK      KEY10,OTBIVISN,OTBIITMC
          CALL      DEOTBIT1
          GOTO      CMBS0500
.
CMBS1000  MOVE      ZERO,F2
          MOVE      ZERO,FORM2
          MOVE      OBAOUTNO,OTBIVISN         * Visit number
.
CMBS1200  COMPARE   FIVE,F2
          GOTO      CMBS9999 IF EQUAL         * reach maximum of 5 MBS items
          ADD       ONE,F2
          LOAD      OTBIIFLG,F2,OTBIT001,OTBIT004,OTBIT007,OTBIT010,OTBIT013
.
          MATCH     Z70,OTBIIFLG
          GOTO      CMBS1200 IF EQUAL
.
          MATCH     SP70,OTBIIFLG
          GOTO      CMBS1200 IF EQUAL
.
          LOAD      OTBIITMN,F2,OTBIT002,OTBIT005,OTBIT008,OTBIT011,OTBIT014
          LOAD      OTBISUBN,F2,OTBIT003,OTBIT006,OTBIT009,OTBIT012,OTBIT015
          LOAD      OTBIPUSE,F2,OTBIT016,OTBIT017,OTBIT018,OTBIT019,OTBIT020
.
          MATCH     SP70,OTBIITMN
          GOTO      CMBS1200 IF EQUAL
.
          MATCH     Z70,OTBIITMN
          GOTO      CMBS1200 IF EQUAL
.
          ADD       ONE,FORM2
          MOVE      FORM2,OTBIITMC
.
          MOVE      OBADATE,OTBIDATE
          MOVE      OBAURNO,OTBIURNO
          MOVE      "0",OTBISTAT
          UNPACK    SP70,OTBICDAT,OTBICTIM,OTBICUID
          UNPACK    SP70,OTBIUDAT,OTBIUTIM,OTBIUUID
.
          PACK      KEY8,CCC,CYY,CMM,CDD
          REP       " 0",KEY8
          PACK      KEY10,OTBIVISN,OTBIITMC
          CALL      RAOTBIT1
          IF        OVRCD=1
            MOVE      KEY8,OTBICDAT             * date created
            CLOCK     TIME,OTBICTIM             * time created
            MOVE      USERID,OTBICUID           * web user id
            CALL      WROTBIT1
          ELSE
            MOVE      KEY8,OTBIUDAT             * date updated
            CLOCK     TIME,OTBIUTIM             * time updated
            MOVE      USERID,OTBIUUID           * web user id
            CALL      UPOTBIT1
          ENDIF
          GOTO      CMBS1200
.
CMBS9999  RETURN
.
.------------------------------------------------------------
. MVPMI000 - Move pmi cgi variables
.------------------------------------------------------------
MVPMI000  MATCH     PTMAS008,Z70
          IF        !@EQUAL
            MOVE      PTMAS008,PADD1
          ENDIF
.
          MATCH     PTMAS009,Z70
          IF        !@EQUAL
            MOVE      PTMAS009,PADD2
          ENDIF
.
          MATCH     PTMAS010,Z70
          IF        !@EQUAL
            MOVE      PTMAS010,PSUBRB
          ENDIF
.
          MATCH     PTMAS011,Z70
          IF        !@EQUAL
            MOVE      PTMAS011,PADD4
          ENDIF
.
          MATCH     PTMAS012,Z70
          IF        !@EQUAL
            MOVE      PTMAS012,PPOST
          ENDIF
.
          MATCH     PTMAS013,Z70
          IF        !@EQUAL
            MOVE      PTMAS013,PTELEP
          ENDIF
.
          MATCH     PTMAS023,Z70
          IF        !@EQUAL
            MOVE      PTMAS023,PMEDI
          ENDIF
.
          MATCH     Z70,PMPXI059
          IF        !@EQUAL
            PACK      KEY10,PMPXI059,SP70
            CALL      RDPMHCP1
            IF        OVRCD=0
              IF        (PMHCHCST = 3)|(PMHCHCST = 4)
                MOVE      PMPXI059,PMPXRHC1
                MOVE      PMPXI060,PMPXRH1G
                MOVE      PMPXI061,PMPXR1GC
              ENDIF 
              IF        (PMHCHCST = 5)|(PMHCHCST = 6)
                MOVE      PMPXI059,PMPXRHC1
                MOVE      PMPXI060,PMPXRH1G
                MOVE      PMPXI061,PMPXR1GC
              ENDIF
            ENDIF
          ENDIF
.
          MATCH     Z70,PTMSX045
          IF        !@EQUAL
            MOVE      PTMSX045,PTMXMCCD
          ENDIF
.
.         cgi variables for pmspx2af file
.
          MATCH     PMPXI023,Z70
          IF        !@EQUAL
            MOVE      PMPXI023,PMPXMSNA
          ENDIF

          MATCH     PMPXI024,Z70
          IF        !@EQUAL
            MOVE      PMPXI024,PMPXMGNA
          ENDIF
.
          MATCH     PMPXI032,Z70
          IF        !@EQUAL
            MOVE      PMPXI032,PMPXMBNO
          ENDIF
.
          MATCH     PMPXI033,Z70
          IF        !@EQUAL
            MOVE      PMPXI033,PMPXMMNO
          ENDIF
.
          MATCH     PMPXI039,Z70
          IF        !@EQUAL
            MOVE      PMPXI039,PMPXFSNA
          ENDIF
.
          MATCH     PMPXI040,Z70
          IF        !@EQUAL
            MOVE      PMPXI040,PMPXFGNA
          ENDIF
.
          MATCH     PMPXI016,Z70
          IF        !@EQUAL
            MOVE      PMPXI016,PMPXMEDC
          ENDIF
.
          MATCH     PMPXI048,Z70
          IF        !@EQUAL
            MOVE      PMPXI048,PMPXFBNO
          ENDIF
.
          MATCH     PMPXI049,Z70
          IF        !@EQUAL
            MOVE      PMPXI049,PMPXFMNO
          ENDIF
.
          MATCH     PMPXI076,Z70
          IF        !@EQUAL
            MOVE      PMPXI076,PMPXCONP
          ENDIF
.
MVPMI999  RETURN
.
.
.-----------------------------------------------------------------------------.
.         Set parameters for alrit
.-----------------------------------------------------------------------------.
SPRIT000  MOVE      ZERO,EXIT
          UNPACK    QRYNAME,KEY5,KEY3
          MOVE      KEY3,F3
          BRANCH    F3,SPRIT010,SPRIT020,SPRIT030,SPRIT040,SPRIT050:
                       SPRIT060,SPRIT070,SPRIT080,SPRIT090,SPRIT100:
                       SPRIT110,SPRIT120,SPRIT130,SPRIT140,SPRIT150:
                       SPRIT160,SPRIT170,SPRIT180,SPRIT190,SPRIT200 
.
          MOVE      ONE,EXIT
          GOTO      SPRIT999
.
SPRIT010  MATCH     "MBS",QRYDATA
          IF        @EQUAL
            MOVE      " 0",ALRIT001
          ENDIF
.
          MATCH     "AMA",QRYDATA
          IF        @EQUAL
            MOVE      " 1",ALRIT001
          ENDIF
.
          GOTO      SPRIT999
.
SPRIT020  PACK      ALRIT002,QRYDATA,SP70
          GOTO      SPRIT999
.
SPRIT030  MOVE      QRYDATA,ALRIT003
          GOTO      SPRIT999
.
SPRIT040  MATCH     "MBS",QRYDATA
          IF        @EQUAL
            MOVE      " 0",ALRIT004
          ENDIF
.
          MATCH     "AMA",QRYDATA
          IF        @EQUAL
            MOVE      " 1",ALRIT004
          ENDIF
.
          GOTO      SPRIT999
.
SPRIT050  PACK      ALRIT005,QRYDATA,SP70
          GOTO      SPRIT999
.
SPRIT060  MOVE      QRYDATA,ALRIT006
          GOTO      SPRIT999
.
SPRIT070  MATCH     "MBS",QRYDATA
          IF        @EQUAL
            MOVE      " 0",ALRIT007
          ENDIF
.
          MATCH     "AMA",QRYDATA
          IF        @EQUAL
            MOVE      " 1",ALRIT007
          ENDIF
.
          GOTO      SPRIT999
.
SPRIT080  PACK      ALRIT008,QRYDATA,SP70
          GOTO      SPRIT999
.
SPRIT090  MOVE      QRYDATA,ALRIT009
          GOTO      SPRIT999
.
SPRIT100  MATCH     "MBS",QRYDATA
          IF        @EQUAL
            MOVE      " 0",ALRIT010
          ENDIF
.
          MATCH     "AMA",QRYDATA
          IF        @EQUAL
            MOVE      " 1",ALRIT010
          ENDIF
.
          GOTO      SPRIT999
.
SPRIT110  PACK      ALRIT011,QRYDATA,SP70
          GOTO      SPRIT999
.
SPRIT120  MOVE      QRYDATA,ALRIT012
          GOTO      SPRIT999
.
SPRIT130  MATCH     "MBS",QRYDATA
          IF        @EQUAL
            MOVE      " 0",ALRIT013
          ENDIF
.
          MATCH     "AMA",QRYDATA
          IF        @EQUAL
            MOVE      " 1",ALRIT013
          ENDIF
.
          GOTO      SPRIT999
.
SPRIT140  PACK      ALRIT014,QRYDATA,SP70
          GOTO      SPRIT999
.
SPRIT150  MOVE      QRYDATA,ALRIT015
          GOTO      SPRIT999
.
SPRIT160  MOVE      QRYDATA,ALRIT016
          GOTO      SPRIT999
.
SPRIT170  MOVE      QRYDATA,ALRIT017
          GOTO      SPRIT999
.
SPRIT180  MOVE      QRYDATA,ALRIT018
          GOTO      SPRIT999
.
SPRIT190  MOVE      QRYDATA,ALRIT019
          GOTO      SPRIT999
.
SPRIT200  MOVE      QRYDATA,ALRIT020
          GOTO      SPRIT999
.
SPRIT999  RETURN
.
.-----------------------------------------------------------------------------.
.         Set parameters for otbit
.-----------------------------------------------------------------------------.
SPBIT000  MOVE      ZERO,EXIT
          UNPACK    QRYNAME,KEY5,KEY3
          MOVE      KEY3,F3
          BRANCH    F3,SPBIT010,SPBIT020,SPBIT030,SPBIT040,SPBIT050:
                       SPBIT060,SPBIT070,SPBIT080,SPBIT090,SPBIT100:
                       SPBIT110,SPBIT120,SPBIT130,SPBIT140,SPBIT150:
                       SPBIT160,SPBIT170,SPBIT180,SPBIT190,SPBIT200 
.
          MOVE      ONE,EXIT
          GOTO      SPBIT999
.
SPBIT010  MATCH     "MBS",QRYDATA
          IF        @EQUAL
            MOVE      " 0",OTBIT001
          ENDIF
.
          MATCH     "AMA",QRYDATA
          IF        @EQUAL
            MOVE      " 1",OTBIT001
          ENDIF
.
          GOTO      SPBIT999
.
SPBIT020  PACK      OTBIT002,QRYDATA,SP70
          GOTO      SPBIT999
.
SPBIT030  MOVE      QRYDATA,OTBIT003
          GOTO      SPBIT999
.
SPBIT040  MATCH     "MBS",QRYDATA
          IF        @EQUAL
            MOVE      " 0",OTBIT004
          ENDIF
.
          MATCH     "AMA",QRYDATA
          IF        @EQUAL
            MOVE      " 1",OTBIT004
          ENDIF
.
          GOTO      SPBIT999
.
SPBIT050  PACK      OTBIT005,QRYDATA,SP70
          GOTO      SPBIT999
.
SPBIT060  MOVE      QRYDATA,OTBIT006
          GOTO      SPBIT999
.
SPBIT070  MATCH     "MBS",QRYDATA
          IF        @EQUAL
            MOVE      " 0",OTBIT007
          ENDIF
.
          MATCH     "AMA",QRYDATA
          IF        @EQUAL
            MOVE      " 1",OTBIT007
          ENDIF
.
          GOTO      SPBIT999
.
SPBIT080  PACK      OTBIT008,QRYDATA,SP70
          GOTO      SPBIT999
.
SPBIT090  MOVE      QRYDATA,OTBIT009
          GOTO      SPBIT999
.
SPBIT100  MATCH     "MBS",QRYDATA
          IF        @EQUAL
            MOVE      " 0",OTBIT010
          ENDIF
.
          MATCH     "AMA",QRYDATA
          IF        @EQUAL
            MOVE      " 1",OTBIT010
          ENDIF
.
          GOTO      SPBIT999
.
SPBIT110  PACK      OTBIT011,QRYDATA,SP70
          GOTO      SPBIT999
.
SPBIT120  MOVE      QRYDATA,OTBIT012
          GOTO      SPBIT999
.
SPBIT130  MATCH     "MBS",QRYDATA
          IF        @EQUAL
            MOVE      " 0",OTBIT013
          ENDIF
.
          MATCH     "AMA",QRYDATA
          IF        @EQUAL
            MOVE      " 1",OTBIT013
          ENDIF
.
          GOTO      SPBIT999
.
SPBIT140  PACK      OTBIT014,QRYDATA,SP70
          GOTO      SPBIT999
.
SPBIT150  MOVE      QRYDATA,OTBIT015
          GOTO      SPBIT999
.
SPBIT160  MOVE      QRYDATA,OTBIT016
          GOTO      SPBIT999
.
SPBIT170  MOVE      QRYDATA,OTBIT017
          GOTO      SPBIT999
.
SPBIT180  MOVE      QRYDATA,OTBIT018
          GOTO      SPBIT999
.
SPBIT190  MOVE      QRYDATA,OTBIT019
          GOTO      SPBIT999
.
SPBIT200  MOVE      QRYDATA,OTBIT020
          GOTO      SPBIT999
.
SPBIT999  RETURN
.
.
.*******************************************************************************
.                          General tags
.*******************************************************************************
GTAG0000  BRANCH    FLDITMNO,GTAG0100,GTAG0200,GTAG0300,GTAG0400,GTAG0500:
                             GTAG0600,GTAG0700,GTAG0800,GTAG0900
          GOTO      GTAG9999
.
GTAG0100  MATCH     SP70,OBADATE
          GOTO      GTAG9999 IF EQUAL
.
          COMPARE   FOUR,OBASTAT         * Only display visit date of attended
          GOTO      GTAG9999 IF NOT EQUAL
.
          UNPACK    OBADATE,CCENT,CYEAR,CMON,CDAY
          MOVE      CMON,F2
          LOAD      MTHNAM3,F2,JAN,FEB,MAR,APR,MAY,JUN,JUL,AUG,SEP,OCT,NOV,DEC
          WRITE     HTMLFILE;CDAY,SP1,MTHNAM3,SP1,CCENT,CYEAR;
          GOTO      GTAG9999
.
GTAG0200  UNPACK    DIM127,D1,KEY2,DIM127
          PACK      KEY10,ADMISSNO,KEY2,SP70
          CALL      RDOTBIT1
          BRANCH    OVRCD,GTAG0220
.
          MATCH     " 0",OTBIIFLG
          IF        @EQUAL
            WRITE     HTMLFILE;"MBS";
            GOTO      GTAG9999
          ENDIF
.
          MATCH     " 1",OTBIIFLG
          IF        @EQUAL
            WRITE     HTMLFILE;"AMA";
            GOTO      GTAG9999
          ENDIF
          GOTO      GTAG9999
.
.
.         default to "MBS" item type
.
GTAG0220  WRITE     HTMLFILE;"MBS";
          GOTO      GTAG9999
.
GTAG0300  UNPACK    DIM127,D1,KEY2,DIM127
          PACK      KEY10,ADMISSNO,KEY2,SP70
          CALL      RDOTBIT1
          BRANCH    OVRCD,GTAG9999
.
          WRITE     HTMLFILE;OTBIITMN;
          GOTO      GTAG9999
.
GTAG0400  UNPACK    DIM127,D1,KEY2,DIM127
          PACK      KEY10,ADMISSNO,KEY2,SP70
          CALL      RDOTBIT1
          BRANCH    OVRCD,GTAG9999
.
          WRITE     HTMLFILE;OTBISUBN;
          GOTO      GTAG9999
.
GTAG0500  UNPACK    DIM127,D1,KEY2,DIM127
          UNPACK    DIM127,D1,ANS,DIM127
          MOVE      ZERO,F1
          MOVE      ANS,F1
.
          PACK      KEY10,OBAOUTNO,KEY2,SP70
          CALL      RDOTBIT1
          BRANCH    OVRCD,GTAG9999
.
          MOVE      OTBIIFLG,FORM2
          PACK      KEY22,OTBIIFLG,OTBIITMN,OTBISUBN,Z70 * Get current record
          CALL      RSPRIT1
GTAG0510  CALL      RPPRIT1
          BRANCH    OVRCD,GTAG9999
.
          COMPARE   FORM2,PRITFLAG           * Item Type
          GOTO      GTAG9999 IF NOT EQUAL
.
          MATCH     OTBIITMN,PRITITMN        * AMA/MBS Item
          GOTO      GTAG9999 IF NOT EQUAL
.
          MATCH     OTBISUBN,PRITSUBN        * Sub Item
          GOTO      GTAG9999 IF NOT EQUAL
.
          MATCH     SP70,OBADATE
          IF        !@EQUAL
            MATCH     PRITDAT1,OBADATE
            GOTO      GTAG0510 IF LESS
          ENDIF
.
          BRANCH    F1,GTAG0520
          WRITE     HTMLFILE;PRITDESC;       * AMA/MBS Description
          GOTO      GTAG9999
.
GTAG0520  WRITE     HTMLFILE;PRITSFEE;       * AMA/MBS schedule fee
          GOTO      GTAG9999
.
GTAG0600  UNPACK    DIM127,D1,KEY2,DIM127
          PACK      KEY10,ADMISSNO,KEY2,SP70
          CALL      RDOTBIT1
          BRANCH    OVRCD,GTAG9999
.
          WRITE     HTMLFILE;OTBIPUSE;      * Provider usage
          GOTO      GTAG9999
.
GTAG0700  WRITE     HTMLFILE;OTMAMPRC;       * Medical practice
          GOTO      GTAG9999
.
GTAG0800  MOVE      OTBBADCS,GENPCODE        * Actual doctor seen
          CALL      HCPDET00 
          GOTO      GTAG9999
.
GTAG0900  CALL      ARGP0000                * Usual GP suburb
          GOTO      GTAG9999
.
GTAG9999  RETURN
.
.-----------------------------------------------------------------------------.
.         Usual GP suburb
.-----------------------------------------------------------------------------.
ARGP0000  MATCH     SP70,PMPXRH1G
          GOTO      ARGP5000 IF EQUAL
.
          MATCH     SP70,PMPXR1GC
          IF        @EQUAL
            PACK      PMPXR1GC,SP1,ONE
          ENDIF
.
          PACK      KEY12,PMPXRH1G,PMPXR1GC,SP70
          CALL      RDPMHCG1                     * use practice if one exists
          BRANCH    OVRCD,ARGP5000
.
          WRITE     HTMLFILE;PMHGADD3;
          GOTO      ARGP9999
.
ARGP5000  MATCH     SP70,PMPXRHC1
          GOTO      ARGP9999 IF EQUAL
.
          PACK      KEY10,PMPXRHC1,SP70
          CALL      RDPMHCP1                * use hcp suburb if no practice
          BRANCH    OVRCD,ARGP9999
.
          WRITE     HTMLFILE;PMHCADR3;
.
ARGP9999  RETURN
.
.*******************************************************************************
. Get provider name for create batch screen
. WARNING : .
. The claim file will be re read and should not be used if a prior read of
. the claim file is required
.*******************************************************************************
GPRV0000  MATCH     SP70,SRCHBTCH
          GOTO      GPRV9999 IF EQUAL
.
          MOVE      SP70,OCADESC
.
GPRV4000  PACK      KEY15,SRCHBTCH,SP70
          CALL      RSHCCLM7
          CALL      RKHCCLM7
          BRANCH    OVRCD,GPRV7000
.
          MATCH     SRCHBTCH,HCCLBTCH        * Same Batch number?
          GOTO      GPRV7000 IF NOT EQUAL
.
GPRV5000  PACK      KEY20,HCCLSITE,HCCLCLID,Z70
          CALL      RDSCLIA1
          CALL      RDPCLIA1                *To get Clinic ID Description
          IF        OVRCD=0
            MATCH     HCCLSITE,OCASITE
            IF        !@EQUAL
              MOVE      SP70,OCADESC
              GOTO      GPRV7000
            ENDIF
.
            MATCH     HCCLCLID,OCACLIN
            GOTO      GPRV7000 IF EQUAL
          ENDIF
          MOVE      SP70,OCADESC
.
GPRV7000  WRITE     HTMLFILE;OCADESC,"(",HCCLPSRV,")";
.
GPRV9999  RETURN
.
.*******************************************************************************
. Print claim form if requested
.*******************************************************************************
PCLM0000  MATCH     "1",CLAIMPRT                * Print Process for MedClaims
          GOTO      PCLM9999 IF NOT EQUAL
.
          COMPARE   " 2",UPMIONLY
          IF        @EQUAL
            CALL      HICCLAIM               * writes record to hicclmaf as a
            BRANCH    EXIT,PCLM9999,PCLM9999 * claim has never been printed 
          ENDIF                              * before
.
          PACK      KEY36,ADMISSNO,SP70
          CALL      RDSBOKA6               * outpatient booking
          CALL      RDKBOKA6
          IF        OVRCD=1
            CALL      CLOUTBOA
          ELSE
            MATCH     ADMISSNO,DOBAOUTN
            IF        !@EQUAL
              CALL      CLOUTBOA
            ENDIF
          ENDIF
.
          MOVE      CLAIMPSL,SCHDPRNT
          MOVE      ONE,SCHDCOPY
          MOVE      "HICCLM",STATNCOD
          MOVE      ZERO,LETTNCOD
          MOVE      ONE,PRNTTYPE
.
          MOVE      OUTCLAIM,SETDFPRG
          MOVE      "3",SETDFRPT
          CALL      SETDEF00
          CALL      PRNTUD00
.
PCLM9999  RETURN
.
.*******************************************************************************
. Print Internal Referral 
.*******************************************************************************
PINT0000  PACK      KEY36,ADMISSNO,SP70
          CALL      RDSBOKA6               * outpatient booking
          CALL      RDKBOKA6
          IF        OVRCD=1
            CALL      CLOUTBOA
          ELSE
            MATCH     ADMISSNO,DOBAOUTN
            IF        !@EQUAL
              CALL      CLOUTBOA
            ENDIF
          ENDIF
.
          MOVE      CLAIMPSL,SCHDPRNT
          MOVE      ONE,SCHDCOPY
          MOVE      "INTREF",STATNCOD
          MOVE      ZERO,LETTNCOD
          MOVE      ONE,PRNTTYPE
.
          MOVE      INTREFRL,SETDFPRG
          MOVE      "1",SETDFRPT
          CALL      SETDEF00
          CALL      PRNTUD00
PINT9999  RETURN
.
.*******************************************************************************
.              Update Labels and Forms Printing Control Table
.*******************************************************************************
PRNTUD00  PACK      KEY5,Z70
          CALL      RSOTLPC1
          CALL      RPOTLPC1
          IF        OVRCD=1
            MOVE      ZERO,F5
            MOVE      F5,OTLPSCHE
          ENDIF
.
          MOVE      OTLPSCHE,F5
          ADD       ONE,F5
          MOVE      F5,OTLPSCHE
          MOVE      OBAURNO,OTLPURNO
          MOVE      OBAOUTNO,OTLPBOOK
          MOVE      OBASITE,OTLPSITE
          MOVE      OBACLIN,OTLPCLIN
          MOVE      OBADATE,OTLPSDAT
          MOVE      OBASTRT,OTLPSTIM
          MOVE      OBASLOT,OTLPSLOT
.
          MOVE      SCHDPRNT,OTLPPRNT
          MOVE      SCHDCOPY,OTLPCOPY
          MOVE      STATNCOD,OTLPSTAT
          MOVE      LETTNCOD,OTLPLETT
.         MOVE      PRNTTYPE,OTLPLETT
          MOVE      PRNTTYPE,OTLPPTYP
          MOVE      USERID,OTLPWEBU
          PACK      OTLPRDAT,CCC,CYY,CMM,CDD
          REP       " 0",OTLPRDAT
          MOVE      CTIMEIS,OTLPRTIM
.
          MOVE      ZERO,OTLPSERS
.
PRNTUD50  PACK      KEY5,OTLPSCHE
          CALL      RAOTLPC1
          IF        OVRCD=1
            TRAP      WRTRAP IF IO               * Trap to stop I * D when
            CALL      WROTLPC1                   * multiple servers write to the
            TRAPCLR   IO                         * outpatient print file
          ELSE
            GOTO      PRNTUD00
          ENDIF
.
PRNTUD99  RETURN
.
WRTRAP    NORETURN
          ADD         ONE,F5
          MOVE        F5,OTLPSCHE
          GOTO        PRNTUD50
.
.------------------------------------------------------------
. Set Default Printer
.------------------------------------------------------------
SETDEF00  MOVE      PRGID,SAVPRGID
          MOVE      REPORTNO,SAVREPTN
.
          MOVE      SCHDPRNT,SELPRINT
          MOVE      SETDFPRG,PRGID
          MOVE      SETDFRPT,REPORTNO
          CALL      UPDFPT00
.
          MOVE      SAVPRGID,PRGID
          MOVE      SAVREPTN,REPORTNO
          RETURN
.
.-----------------------------------------------------------
. Initialize's file data : Clinic Master File A
.-----------------------------------------------------------
CLRMAS00  MOVE      SP70,OMASITE
          MOVE      SP70,OMACLIN
          MOVE      SP70,OMATYP
          MOVE      SP70,DOMADAY
          MOVE      SP70,OMASTART
          MOVE      SP70,OMAFIN
          MOVE      SP70,OMAEND
          MOVE      SP70,OMACIND
          MOVE      SP70,OMAREG
          MOVE      SP70,OMAKDOC
          MOVE      SP70,OMACOM1
          MOVE      SP70,OMACOM2
          MOVE      ZERO,OMADURN
          MOVE      ZERO,OMANEWSL
          MOVE      ZERO,OMASPCSL
          MOVE      ZERO,OMASTAT
          MOVE      SP70,OMAFREQM
          MOVE      SP70,DOMASEQ
          MOVE      SP70,OMALOCK
          MOVE      ZERO,OMAFREQF
          MOVE      SP70,OMAFREQY
          MOVE      SP70,OMADATE
          MOVE      SP70,OTMAAVIS
          MOVE      SP70,OTMASTVT
          MOVE      SP70,OTMASUPX
          MOVE      SP70,OTMARUSE
          MOVE      SP70,OTMADCMB
          MOVE      SP70,OTMAIXTA
          MOVE      SP70,OTMADEFD
          MOVE      SP70,OTMAUATR
          MOVE      ZERO,OTMADDNA
          MOVE      ZERO,OTMANDRP
          MOVE      ZERO,OTMALPTR
          MOVE      ZERO,OTMALGPD
          MOVE      ZERO,OTMALPTD
          MOVE      ZERO,OTMABKLT
          MOVE      ZERO,OTMARALT
          MOVE      ZERO,OTMARSLT
          MOVE      SP70,OTMACLSE
          MOVE      SP70,OTMAHOSP
          MOVE      SP70,OTMACLOC
          MOVE      SP70,OTMAWDCL
          MOVE      SP70,OTMAWARD
          MOVE      SP70,OTMALTYP
          MOVE      SP70,OTMADFSL
          MOVE      SP70,OTMADFGN
          MOVE      SP70,OTMAGRPS
          MOVE      SP70,DOTMASOV
          MOVE      SP70,DOTMANOO
          MOVE      SP70,DOTMASLF
          MOVE      SP70,DOTMASLR
          MOVE      SP70,OTMASBKL
          MOVE      SP70,OTMASAPL
          MOVE      SP70,OTMASPMM
          MOVE      SP70,OTMASGPM
          MOVE      SP70,DOTMALPP
          MOVE      SP70,DOTMASRL
          MOVE      SP70,DOTMANCO
          MOVE      SP70,OTMALOCN
          MOVE      SP70,OTMADTCO
          MOVE      SP70,OTMADTCC
          MOVE      SP70,OTMAINS1
          MOVE      SP70,OTMAINS2
          MOVE      SP70,OTMAINS3
          MOVE      SP70,OTMALSER
          MOVE      SP70,OTMAUMCI
          MOVE      SP70,OTMAPROV
          MOVE      SP70,OTMAMBST
          MOVE      SP70,OTMAROOM
          MOVE      SP70,OTMALEDG
          MOVE      SP70,OTMACCTR
          MOVE      SP70,OTMAMPRC
          MOVE      SP70,OTMAMBSA
          MOVE      SP70,OTMALDNA
          MOVE      SP70,OTMAADEP
          MOVE      SP70,OTMACENC
          MOVE      SP70,OTMACCAR
          MOVE      SP70,OTMACTRN
          MOVE      SP70,OTMADPSL
          MOVE      SP70,OTMACPMI
          MOVE      SP70,OTMACPAG
          MOVE      SP70,OTMACTEL
          MOVE      SP70,OTMANMDS
          MOVE      SP70,OTMACART
          MOVE      SP70,OTMASRVD
          MOVE      SP70,OTMACLHR
          MOVE      SP70,OTMAMLTD
          MOVE      SP70,OTMAXPUL
          MOVE      SP70,OTMAMREF
          MOVE      SP70,OTMATCOD
          MOVE      SP70,OTMAHCLI
          MOVE      SP70,OTMAHCAI
          MOVE      SP70,OTMAAOPN
          MOVE      SP70,OTMAAOFR
          MOVE      SP70,OTMAAOWM
          MOVE      SP70,OTMAAOWA
          MOVE      SP70,OTMAHCP1
          MOVE      SP70,OTMAHCP2
          MOVE      SP70,OTMAHCP3
          MOVE      SP70,OTMAHCP4
          MOVE      SP70,OTMAPCOD
          MOVE      SP70,OTMASPAR
.
CLRMAS99  RETURN
.
.*****************************************************************************
.*                              CREA0000               Called by: GVOU0000   *
.*             create a new temporary file                                   *
.*****************************************************************************
CREA0000  CALL      KILL0000                     * remove existing file
.
          CLEAR     CMDLINE
          PACK      CMDLINE,ISBUILD,TEMPFILB,UKEYB
          EXECUTE   CMDLINE,TASKID               * create temporary index file
.
          OPEN      ITMTEMPB,TEMPFILB            * open temp index file
.
CREA9999  RETURN
.
.****************************************************************************
.*                              KILL0000               Called by: CREA0000  *
.*               close and erase the temporary file                         *
.****************************************************************************
KILL0000  CLOSE     ITMTEMPB                     * close file
          CLEAR     CMDLINE
          PACK      CMDLINE,ERASE,TEMPFILB       * set file erase command
          EXECUTE   CMDLINE,TASKID               * erase temp file
.
KILL9999 RETURN
.
.****************************************************************************
.*                           ICLR0000              Called by: GVOU0000      *
.*                 Delete voucher temp file records                         *
.****************************************************************************
ICLR0000  MOVE      SP30,KEY29
          CALL      RSTEMPB                      * position at start of file
          CALL      RKTEMPB                      * read next record
          BRANCH    OVRCD,ICLR9999               * eof - finished
.
          PACK      KEY29,URNUMBER,CLAIMNUM,ITMNUMBR,SERVDATE,ICOUNTER
          CALL      DETEMPB                      * delete record
          GOTO      ICLR0000                     * get next record
.
ICLR9999  RETURN
+
.*******************************************************************************
.                         Move in Bok B Details
.*******************************************************************************
MOVBB000  MATCH     Z70,OUTBB031
          IF        !@EQUAL
            MOVE      OUTBB031,OTBBADCS
          ENDIF
.
MOVBB999  RETURN
.
.*******************************************************************************
.         Temp file B routines (items)
.*******************************************************************************
RATEMPB   MOVE      ZERO,OVRCD
          READ      ITMTEMPB,KEY29;ANS
          GOTO      OVERCOND IF OVER
          RETURN
.
RSTEMPB   READ      ITMTEMPB,KEY29;;
          RETURN
.
RDTEMPB   MOVE      ZERO,OVRCD
          READ      ITMTEMPB,KEY29;URNUMBER,CLAIMNUM,ITMNUMBR,SERVDATE:
                                   DICOUNTR,VISITNUM,TITEMCNT
          GOTO      OVERCOND IF OVER
          MOVE      DICOUNTR,ICOUNTER
          RETURN
.
RKTEMPB   MOVE      ZERO,OVRCD
          READKS    ITMTEMPB;URNUMBER,CLAIMNUM,ITMNUMBR,SERVDATE,DICOUNTR:
                                      VISITNUM,TITEMCNT
          GOTO      OVERCOND IF OVER
          MOVE      DICOUNTR,ICOUNTER
          RETURN
.
WRTEMPB   MOVE      ICOUNTER,DICOUNTR
          WRITE     ITMTEMPB,KEY29;URNUMBER,CLAIMNUM,ITMNUMBR,SERVDATE:
                                   DICOUNTR,VISITNUM,TITEMCNT
          RETURN
.
DETEMPB   DELETE    ITMTEMPB,KEY29
          RETURN
.
          INC       IBAWEBCD
          INC       WEBDATCD
          INC       RSHWEBCD
          INC       ROUNDUP5
          INC       CLPRIHTR
.
          INC       ALLQUEIO/INC
          INC       APSMASIO/INC
          INC       HL7CISIO/INC
          INC       HL7INBIO/INC
          INC       MLTSECIO/INC
          INC       MLTSITIO/INC
          INC       PATDO1IO/INC   * Doctor File
          INC       PATMI1IO/INC
          INC       PATDSCIO/INC
          INC       PATMA1IO/INC
          INC       PATVISIO/INC   * Patients Visits File
          INC       PMSVX1IO/INC   * Visit Extension File
          INC       PATALRIO/INC
          INC       OUTMA1IO/INC
          INC       OUTSITIO/INC
          INC       OUTCLIIO/INC       * Clinic Ids
          INC       OUTCTYIO/INC       * Clinic Types
          INC       OUTBITIO/INC
          INC       OUTBOAIO/INC
          INC       OUTBB1IO/INC
          INC       OUTLPCIO/INC
          INC       PMSPX2IO/INC
          INC       PMSUCHIO/INC
          INC       PMSUCDIO/INC
          INC       PATFN1IO/INC
          INC       PATHSPIO/INC
          INC       PATIN1IO/INC
          INC       PATNIDIO/INC
          INC       PATWR1IO/INC
          INC       PATVADIO/INC
          INC       PATRE1IO/INC
          INC       PRIITMIO/INC
          INC       PRISECIO/INC
          INC       PRIALSIO/INC
          INC       PMSHCGIO/INC
          INC       PMSHCLIO/INC
          INC       PMSHCPIO/INC
          INC       PMSQPTIO/INC
          INC       NHIETHIO/INC
          INC       NHIMASIO/INC
          INC       MRTMASIO/INC
          INC       PRIPRAIO/INC
          INC       VISCMTIO/INC            * visit comments file
.
          INC       BOKRC1IO/INC
          INC       ALLREFIO/INC
          INC       ALLLNKIO/INC
          INC       HICCLMIO/INC
          INC       HICCITIO/INC
          INC       HICBTCIO/INC
          INC       HICBCNIO/INC
          INC       HICEMSIO/INC
          INC       HICERRIO/INC
          INC       HICHISIO/INC
          INC       HICRCIIO/INC
          INC       HICEFCIO/INC
.
          INC       PMSCCDIO/INC            * Concession Card Details
          INC       PRIHREIO/INC
          INC       PRIHDBIO/INC
          INC       PRIHTRIO/INC
          INC       PRIEXCIO/INC
          INC       PRIDOCIO/INC
          INC       ALLRITIO/INC
          INC       ALLDIAIO/INC
          INC       ALLPROIO/INC
          INC       ALLPRRIO/INC
          INC       ALLCASIO/INC
.
          INC       HICPRCLM
          INC       HICCLSRV
          INC       BRHLCOMN
          INC       CLPATMAS
          INC       CALCAGE
          INC       DGCLII13
          INC       HICCLMTM
          INC       HICBTCTM
          INC       PATMASTM
          INC       PATMSXTM
          INC       PMSPX2TM
          INC       CLNHIMAS
          INC       CLPMSPX2
          INC       DGCLICUP
          INC       PMIGTNID
          INC       PATDOCTM
          INC       PMSHCGTM
          INC       PMSHCPTM
          INC       PATDOCCD
          INC       TFILENAM
          INC       NAMSTRCD
          INC       DAYOFWEK
          INC       VISCMTCD
          INC       ALLREFTM
          INC       CLOUTBOA
          INC       CLOUTBB1
          INC       HICCLAIM
