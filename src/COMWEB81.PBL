.------------------------------------------------------------------------------
. Program       : COMWEB81
.
. Function      : Common XML Remote Scripting Code Validation Service
.
. Modifications : 
.------------------------------------------------------------------------------
.V12.00.04  18.11.2025  DA Sarkies     TSK 0920925
.           Added further validations to VLDIHC00 to confirm Health Fund matches
.           and Claim Type is DVA and matches
.V12.00.03  17.11.2025  DA Sarkies     TSK 0920925
.           Added validation in VLDIHC00 to confirm whether invoice added to
.           webservices
.V12.00.02  21/10/2025  Thanh T        TSK 0963147
.           Added option 75 (MAIN8500) to return patdo1af details
.V12.00.01  23.06.2025  DA Sarkies     TSK 0947257
.           Added repote script to set MVA indicator blanck if MVA cancelled
.V11.05.09  18.11.2025  DA Sarkies     TSK 0920925
.           Added further validations to VLDIHC00 to confirm Health Fund matches
.           and Claim Type is DVA and matches
.V11.05.08  17.11.2025  DA Sarkies     TSK 0920925
.           Added validation in VLDIHC00 to confirm whether invoice added to
.           webservices
.V11.05.07  20/10/2025  Thanh T        TSK 0963147
.           Added option 75 (MAIN8500) to return patdo1af details
.V11.05.06  23.06.2025  DA Sarkies     TSK 0947257
.           Added repote script to set MVA indicator blanck if MVA cancelled
.V11.05.05  27/03/2025  Ebon Clements  TSK 0884838
.           Validate any tran record for the date/time - VIBDMV00
.V11.05.04  12/03/2025  Thanh T        TSK 0949724
.           Added MAIN8300/OWTPRO00 
.V11.05.03  29/01/2025  Thanh T        TSK 0884838
.           Added VSINAD00
.V11.05.02  16/01/2025  Thanh T        TSK 0884838
.           Added VIBDMV00 and VCDINV00
.V11.05.01  16/12/2024  J.Tan           TSK 0945920
.           Mod to get the default Occupational Group for a Future Action
.V11.04.09  16/09/2024  Alina Bhari    TSK 0949502
.           Updated the hospital staff member name in bulk eligibility check 
.           screen - VALELG20                                                
.V11.04.08  25/07/2024  Thanh T        TSK 0944001
.           Added option 68 (MAIN7800) to return websteaf details
.V11.04.07  11/07/2024  Nikitha B      TSK 0945117
.           Added a check in CMPAR100 to skip if hospital parameter is inactive
.           and display default from common sys parameter.
.V11.04.06  18/06/2024  Bella Turco    TSK 0938902
.           Added option 67 (MAIN7700) to return Doctor Level cat DL Ind1 
.V11.04.05  05/03/2024  Thanh T        TSK 0923560
.           Changed VALNZM00 to get the latest data
.V11.04.04  28/02/2024  Thanh T        TSK 0923560
.           Added option 66 (MAIN7600) to return opreqpaf details
.V11.04.03  02/02/2024  Thanh T        TSK 0923560
.           Added option 64 (MAIN7400) to return oprtryaf details
.                 option 65 (MAIN7500) to return nzpmchaf details
.V11.04.02  15/01/2024  Thanh T        TSK 0903618
.           Added option 63 (MAIN7300) to return allcctaf details
.V11.04.01  07/12/2023  Thanh T        TSK 0914053
.           Added option 62 (MAIN7200) to return outbb1af details
.V11.03.13  09/11/2023 Peter Vela     TSK 0935874
.           Added single hospital / multi hospital validation in
.           before WRPMNPL1 for NIHC IHI Lookup
.           10/11/2023  Thanh T        TSK 0929804
.           Added option 61 (MAIN7100) to return patcodaf details
.V11.03.12  09/10/2023  Thanh T        TSK 0935874
.           Added option 60 (MAIN7000/WPMPNL00) to Write a record to the
.           pmsnplaf Table
.V11.03.11  09/10/2023  Thanh T        TSK 0935874
.           Added option 60 (MAIN7000/WPMPNL00) to Write a record to the
.           pmsnplaf Table
.V11.03.10  13/09/2023  Thanh T        TSK 0914053
.           Added option 59 (MAIN6900) to return outcanaf details
.V11.03.09  01/09/2023  Bella Turco    TSK 0932804
.           Added required GOTOs to correctly loop through table in URVIST00
.V11.03.08  25/08/2023  Bella Turco    TSK 0932804
.           Added option 58 (URVIST00) to check UR number visit statuses
.V11.03.07  18/08/2023  Thanh T        TSK 0923938
.           Added option 57 (VUNIXF00) to check if unit file exists
.V11.03.06  02/08/2023  Thanh T        TSK 0865577
.           Added option 56 (MAIN6600) to return patcanaf details
.V11.03.05  12/07/2023  Sunny          TSK 0929763
.           Added VALNRN00 - to check National Reg Num already exits for a HCP
.V11.03.04  10/03/2023  Peter Vela         0929194
.           Added Webservices ERAW Unlock to Partial functionality
.           Option 54
.V11.03.03  09/03/2023  Thanh T        TSK 0865479
.           Added option 53 (MAIN6300) to return general patvisaf details
.V11.03.02  16/01/2023  Peter Vela         0910319
.           Fixed VALDDT92 goto in VALEMH00, VALED600
.           Removed VALDCODE from PACK KEY32 in VALED600, fixed loop
.V11.03.01  25/11/2022  Thanh T        TSK 0906740
.           Added MAIN6200/EXPTCH00 to return expected patient comment details  
.V11.02.11  24/10/2022  Peter Vela         0910319
.           Added VALCCO00 - Validate Cabrini Emr Billing Sheet complexity
.           codes
.           Added VALED200 - Validate ed billing doctor type existence of record
.           and indicator value
.           Added VALED300 - Validate ed billing doctor type existence of item
.           records in pmsmtiaf
.           Added VALED400 - Validate ed billing doctor history no dr charge
.           records for other doctors in pmsmtiaf
.           Added VALED500 - Validate / update ed billing doctor history file 
.           no charge
.           Added VALED600 - Validate if last allocate doctor record is already
.           existing in emrhisaf
.           Added VALED700 - Validate / update ed billing doctor history file
.           dr billing complete
.V11.02.10  26/08/2022  Alina Bhari        0922835
.           Showed the latest active Postal Address in updating demographic  
.           screen - GNPADD10                                                
.V11.02.09  19.08.2022  Peter Vela         0884414
.           Moved webelfaf into webservices validation section to prevent I*I
.V11.02.08  15.07.2022  Ebon Clements      0921895
.           Only check AH department hospital if multi hospital - SELDEP00
.V11.02.07  12.07.2022  Peter Vela         0884414
.           Added VALOEB00 Update webelfaf for Bulk OECW Theatre Booking 
.           Added VALOCB00 Update bokrx1af OECW Consent for Theatre Booking
.V11.02.06  01.04.2022  DA Sarkies     TSK 0918429
.           Removed the line where variable was being placed into SP70
.V11.02.05  11/03/2022  Thanh T        TSK 0903754
.           Added ADMURL00 to return an U/R for a given visit number  
.V11.02.04  11/03/2022  Thanh T        TSK 0903754
.           Added ADMURL00 to return an U/R for a given visit number  
.V11.02.03  01/03/2022  Thanh T        TSK 0903754
.           Added SELDEP00 to return a list of referral departments for
.           a hospital
.V11.02.02  11/02/2022  Peter Vela        TSK 0910268
.           Added validation for Dr No Charge / Dr Billing Complete
.           VALDNC00 emrweb0602014.html/cab
.V11.02.01  13/12/2021  J.Tan             TSK 0309320
.           Added Selection register for a visit type (SELREG00)
.V11.01.10  27.10.2021  Peter Vela     Task 0902857
.           Added WebServices functionality for VALPCP00
.V11.01.09  18/10/2021  Sunny          TSK 0904403
.           Fixed VALHCX00 
.V11.01.08  11/10/2021  Sunny          TSK 0904403
.           Added VALHCX00 - A check to ensure the GP and/or Practice code 
.           recorded against a patient are still valid
.V11.01.07  28/09/2021  Thanh T        TSK 0903847
.           Added MAIN470/VAPATR00 to return a flag to determine if a
.           patatraf exist for urnumber/admissno/attribute type  
.V11.01.06  09.09.2021  DA Sarkies    Task 0905305
.           Changed GVSCDS00 to check if ECC is being passed through and if so
.           Sends through three values, otherwise sends back two.
.V11.01.05  23/07/2021  Jill Parkison Task 0906724
.           Fixed selecting of billing default record
.V11.01.04  29/04/2021  Thanh T        TSK 0299439
.           Changed LSTMPR00 for Medical practice list for a doctor code and
.           user id
.V11.01.03  31/03/2021  Thanh T        TSK 0900995
.           Added MAIN4600/VALNDS00 to validate NDIS number
.V11.01.02  29/03/2021  Thanh T        TSK 0299439
.           Added MAIN4500/LSTMPR00 for Medical practice list for a doctor
.           code and user id 
.V11.01.01  10/03/2021  Peter Vela     TSK 0900574
.           Added VALCR500 - Validate Cat R5 for Emergency FACEM and Non 
.           FACEM Doctors.
.           Added VALDDT00 - Validate Service Doctor Emergency History 
.           Date/Time
.           Added VALEMH00 - Validate latest Doctor Billing Complete status
.V11.00.13  10/12/2020  Ebon Clements  TSK 0900461
.           Added open of MLTCODFD
.V11.00.12  07/12/2020  Tracey Nguyen  TSK 0888079
.           Get hospital id for booking - VBDEF000
.V11.00.11  02/12/2020  Tracey Nguyen  TSK 0888079
.           Added read to IBCNMHOS in INIT0000 and updated VBDEF000 for multi 
.           hospital processing
.V11.00.10  27/11/2020  Tracey Nguyen  TSK 0888079
.           Added TRAP IO on patbdeaf file in VBDEF000
.V11.00.09  25/11/2020  Ebon Clements  TSK 0876663
.           Added report 31 - Common system parameters from comparaf
.           11/11/2020  Tracey Nguyen  TSK 0888079
.           1)Added remote script to validate Value Set Id and Code against 
.           pmsvscaf in Report 29 - MAIN3900, GVSCDS00
.           2)Added remote script to validate Billing Default against 
.           patbdeaf in Report 30 - MAIN4000, VBDEF000
.V11.00.08  06/10/2020  Ebon Clements  TSK 0890602
.           Added check for alternative visit Id/Type  - Report 28 - ALTVIS00
.V11.00.07  02/10/2020  Thanh T        TSK 0881752
.           Changed DPTATA00 to not show error message when the row does
.           exist for deleting  
.V11.00.06  30/09/2020  Thanh T        TSK 0881752
.           Changed to correct the name of the user who locked the nursing
.           diagnosis  
.V11.00.05  31/08/2020  Thanh T        TSK 0881752
.           Added PATATR00 for maintaining patient attribute locking for
.           type = 109  
.V11.00.04  24/08/2020  Tracey Ngyen   TSK 0893679
.           Added GNPADD00 report 26 to get the postal address contact from
.           new contact table pmscexaf
.V11.00.03  07/08/2020  Peter Vela     TSK 0884414
.           Added remote script for eligibility check complete
.           Added remote script for updating presenting illness
.           and mbs code for pre admissions
.           Added remote script for updating OEC Consent pmsvx1
.V11.00.02  13/07/2020  Ebon Clements  TSK 0870994
.           Added current IP and discharges to statistical adm - STAVIS00
.V11.00.01  26/06/2020  Ebon Clements  TSK 0870994
.           Added report 22 get details for statistical admission
.V10.15.03  18/02/2020  Peter Vela     TSK 0888264
.           Ported GTCATL00 from COMWEB80 and changed to use patcodes
.           second index
.V10.15.02  12/11/2019  Peter Vela     TSK 0879283
.           Added remote script for Eclipse OEC capability no error messages
.V10.15.01  10/10/2019  Peter Vela     TSK 0857392
.           Added validation for ABF to prevent runtime error
.V10.14.04  01/10/2019  Peter Vela     TSK 0852291
.           Added bed validation to VALBRQ00
.V10.14.03  10/09/2019  Peter Vela     TSK 0852291
.           Added validation for Bed Request update
.V10.14.02  03/09/2019  Thanh T        TSK 0834846
.           Added remote script for MAIN2800/VALICA00 to validate 
.           Diagnosis code against emricdaf        
.V10.14.01  10/05/2019  Peter Vela     TSK 0857392
.           Added remote script for EMRPWD
.V10.13.02  21/08/2018  Peter Vela     TSK 0852438
.           Added sub item number input to VALPRT00
.V10.13.01  07/08/2018  Peter Vela     TSK 0852438
.           Added remote script for mbs item validation in priitemf
.           Added remote script to validate ama/mbs item against pmsmtiaf
.           aaedtraf
.           26/07/2018  J.Tan            TSK 0848506
.           Changed PP Doctor from DIM6 to DIM10
.V10.12.05  20/06/2018  Peter Vela     TSK 0852438
.           Added remote script for ED Doctor Billing Type (Category R5)
.           Added remote script for 75% fee MBS Consultation Billing
.           Added remote script to validate misc item against pmsmtiaf aaedtraf
.           Added remote script to validate if charge code exists in patmchgf
.           Added remote script to validate pri prac mbs item HX013/V
.           Added remote script to validate sub item RV in priitemf
.V10.12.04  04/06/2018  J.Tan          TSK 0857802
.           Added remote script to check admission bed fees setup
.V10.12.03  21/03/2018  Peter Vela     TSK 0843363
.           Added remote script for PATQMH variables hea
.V10.12.02  05/03/2018  Tracey Nguyen  TSK 0825792
.           Added remote script to validate Active doctors and active outside
.           doctors attached to a nurse type in VALDRN00
.V10.12.01  15.01.2018  J.Tan          TSK 0848146
.           Added remote script to generate the From date of Fees Invoiced
.V10.11.02  22/09/2017  Peter Vela     TSK 0308822
.           Added remote script for current inpatient visit and pre admission
.           visits
.           Added remote script to check for booking in bokrc1af
.V10.11.01  11/09/2017  Peter Vela     TSK 0837619
.           Added IMC Linked Visit Number
.V10.10.01  12/05/2017  Peter Vela     TSK 0837531
.           Created Program
.----------------------------------------------------------------------
          INC       IBAWEBDF    
          INC       WEBDATDF
.
          INC       AAEDTRFD/INC
          INC       ALLCCTFD/INC
          INC       ALLDEPFD/INC
          INC       IBAALVFD/INC
          INC       BOKRC1FD/INC
          INC       OUTBOAFD/INC
          INC       OUTBB1FD/INC
          INC       BOKRX1FD/INC
          INC       COMPARFD/INC
          INC       EMRPWDFD/INC
          INC       EMRICDFD/INC
          INC       EMRHISFD/INC
          INC       EMRVISFD/INC
          INC       EMRECHFD/INC
          INC       EMRECLFD/INC
          INC       MLTHCPFD/INC
.
          INC       OUTCVTFD/INC
          INC       OUTSITFD/INC
          INC       OUTCANFD/INC
.
          INC       PATCONFD/INC
          INC       PATDSCFD/INC
          INC       PATBDEFD/INC
          INC       PATBFEFD/INC
          INC       PATELGFD/INC
          INC       NZPBFEFD/INC
          INC       PATFN1FD/INC
          INC       PATHSPFD/INC
          INC       PMSCIDFD/INC
          INC       PATDO1FD/INC
          INC       PATCANFD/INC
          INC       PATCFAFD/INC
          INC       PATFX1FD/INC
          INC       PATMCHFD/INC
          INC       PATMI1FD/INC
          INC       PATQMHFD/INC
          INC       PATWR1FD/INC
          INC       PATPCPFD/INC
          INC       PATATRFD/INC
.
          INC       PATINVFD/INC
          INC       PATTRNFD/INC
          INC       PATVISFD/INC
          INC       RCPREGFD/INC
.
          INC       PMSBDCFD/INC
          INC       PMSBRQFD/INC
          INC       PMSCCDFD/INC
          INC       PMSCEXFD/INC
          INC       PMSEXTFD/INC
          INC       PMSELFFD/INC
          INC       WEBELFFD/INC
          INC       WEBERHFD/INC
          INC       PMSHCPFD/INC
          INC       PMSHCGFD/INC
          INC       PMSHCLFD/INC
          INC       PMSMTIFD/INC
          INC       PMSNPLFD/INC            * NIHC IHI Polling
          INC       PMSVSCFD/INC
          INC       PMSVX1FD/INC
          INC       PRIHDBFD/INC
          INC       PRIHREFD/INC
          INC       PRIHTRFD/INC
          INC       PRIITMFD/INC
.
          INC       PRIPRAFD/INC
          INC       PRISECFD/INC                 * Access to Indiv Med Prac
          INC       PRIALSFD/INC                 * Access to All Med Prac
          INC       PRIDOCFD/INC
.
          INC       MRTMASFD/INC
          INC       MRTVISFD/INC
          INC       OPRTRAFD/INC
          INC       NZPMCHFD/INC            * NZP Misc Item File
          INC       OPREQPFD/INC
          INC       WATPROFD/INC
.
          INC       WEBPCPFD/INC
          INC       WEBIHCFD/INC
.
.Variables
.
ADMNUMBR  DIM       8
ADMTHOSP  FORM      1
ASRCIND3  DIM       3
BKFLAG    FORM      1
CFILEPRE  DIM       3
CHKDIGIT  DIM       1                            * check digit
CHKPRDTO  FORM      6                            * check digit product total
CHKPRDCT  FORM      6                            * check digit product
CHKREMAN  FORM      2                            * check digit remainder
CHRCOUNT  FORM      1
CLAIMNUM  DIM       7                      * Claim Number
CURRENTA  FORM      1
CONTRCID  DIM       6
DISPUSNM  DIM       30
.
DIM1A     DIM       1
DIM2A     DIM       2
DIM2B     DIM       2
DIM3      DIM       3
DIM3A     DIM       3
DIM7      DIM       7
DIM9      DIM       9
DIM10     DIM       10
DIM20     DIM       20
DIM11     DIM       11
DIM16     DIM       16
DIM18     DIM       18
DIM18A    DIM       18
DIM20A    DIM       20
FORM5     FORM      5
FORM10    FORM      10
FORM61    FORM      6
FUNDTYPE  FORM      1
DIMV2     DIM       2
COMMTYPE  DIM       3                      * Comment Type
COMMLINO  DIM       3    * Comment Line No
SAVDATA1  DIM       200
SAVDATA2  DIM       200
SAVKEY20  DIM       20
SAVKEY50  DIM       50
COMMCONT  FORM      3  
FORM31    FORM      3
.
CEFFDATE  DIM       8
EFFDATE1  DIM       8
EFFDATE2  DIM       8
CHRDESC1  DIM       90
CHRDESC2  DIM       90
CHCKDLX1  DIM       1
CNTRCEFR  FORM      1
DIM8      DIM       8
.
CALDAYS   FORM      8
CATAHDP   DIM       1
CATBTHDP  DIM       4
CATCCHDP  DIM       2
CATCGI12  DIM       1
CATDDI01  DIM       1
CATDDI05  DIM       1
CATCLHDP  DIM       4
CATKDHDP  DIM       4
CATMIND1  DIM       1
CMDLINE   DIM       80
CMPCNT    FORM      1
CODETYPE  DIM       1       * Type of code, O - operation
.                                           D - disease
COD1CNT   FORM      2
COD9CNT   FORM      2
COUNTER   FORM      2
COUNTFL   FORM      1
CONTPROC  DIM       9
CPROCNUM  FORM      3
CPROCODE  DIM       9
CURRCASE  FORM      3
CURRDATE  DIM       8
CURRTIME  DIM       8
CURSESS   DIM       19       * Current session (Date/Time/Clinic)
.
DATEFROM  DIM       12
DATETO    DIM       12
DATESTR   DIM       12
DAYCOL    FORM      4
DDRGCODE  DIM       4
DEFFLAG   FORM      1
DIGCOUNT  FORM      1
DIM4      DIM       4
DIM26A    DIM       26
DIM30     DIM       30
DIM32     DIM       32
KEY34A    DIM       34
DIM34     DIM       34
DISECODE  DIM       5
DISCOUNT  FORM      2       * Diagnosis Code Counter
DISPDATE  DIM       11                                  
DISPDAT2  DIM       11                                  
DISTYPE   DIM       1       * Disease type
DOCTHOSP  FORM      1
DMDCCODE  DIM       4
DRGCODE   DIM       3                       * DRG code
DRGOUTFN  DIM       12
DRGVER    DIM       3
DSSCODE   DIM       9       * Disease/operation code
DURATION  FORM      4
.
EMRBFLAG  FORM      1       * flag to indicate EMR bed type
EOSFLAG   FORM      1             * end of string flag
.                                     0 = not end of string
.                                     1 = end of string
ENCDSP    DIM       1
ENCODERF  DIM       1
ENCOUTFN  DIM       12
ENDDATE1  DATE      8
EPSCD001  FORM      2       * Episode No
EXPDURA   FORM      5       * Expected duration : Recalculate durations
EXPSTART  DIM       5       * Expected start time : Use to Recalculate starts
.
FILENAM1  DIM       8
FILENAM2  DIM       8
FNPERIOD  DIM       6
FORM8     FORM      8
.
HOSPNAME  DIM       50
ICDCODE   DIM       9       * Disease/operation code
ICD10DAT  DIM       8
IND3DIM1  DIM       1
INVALDAT  FORM      1                       * outside date range flag
INVALDFL  FORM      1
.
INVOICEN  FORM      12
JOURITEM  DIM       3
JOURPATT  FORM      12.2
JTYPE     DIM       1
.
INSIWARD  DIM       3
INSIBED   DIM       3
INSIDATE  DIM       8
INSITIME  DIM       8
INSIDTTM  DIM       16
INURNUMB  DIM       8
LEAVDATE  DIM       8
LEAVTIME  DIM       8
LEAVDTTM  DIM       16
RETNDTTM  DIM       16
CHCKDATE  DIM       8
CHCKTIME  DIM       8
CHCKDTTM  DIM       16
ADMNDTTM  DIM       16
DSCHDTTM  DIM       16
LEAVFOND  FORM      1
TDAYDATE  DIM       8
TDAYTIME  DIM       8
TDAYDTTM  DIM       16
.
KEY21A    DIM       21
KEY26A    DIM       26
KEY3A     DIM       3
KEY10A    DIM       10
KEY8A     DIM       8
.

.
LASTDIAG  FORM      3       * Last Item of Diagnosis array
LASTPROC  FORM      3       * Last Item of Procedure array
LEAVTYPE  DIM       35
LOADNAME  DIM       8
LOADCNT   FORM      3
LOOPFLAG  FORM      2
LINKVTYP  FORM      1
.
MAXCOUNT  FORM      1
MEDIPRAC  DIM       6
MDCCODE   DIM       3                       * MDC code
MULTHOSP  DIM       3
.
NMPNUMB   DIM       20
NOOFCODE  FORM      2
NUMBPERD  FORM      2
NXTALPHA  FORM      1
.
OPERCLIN  DIM       10
OPERTYPE  DIM       1       * Operation type
OPERDATE  DIM       8       * Operation date (CCYYMMDD)
OPERSTME  DIM       5       * Operation start time
OPERETME  DIM       5       * Operation finish time
OPRCODE   DIM       9       * Operation code

ORDQTY    FORM      12.2
.
PERIODFR  DIM       6       * From period
PERIODTO  DIM       6       * To period
PRDSTAT   DIM       1
PREAFLAG  FORM      1
ACCDECDT  DIM       11      * ACC Decline Date
ACCDCDTE  DIM       11      * Patient Declaration Date
ACCIDATE  DIM       11      * Accident Date
STRTALTD  DIM       11      * Start Date of Alternative Work
FLLINCSD  DIM       11      * Full incapacity Start Date
RCCNORUH  DIM       1
RETURNFM  FORM      1
RTNWDATE  DIM       11      * Return to Normal Work Date
PRDFRDTE  DIM       11
PRDTODTE  DIM       11
PRDCNUMB  DIM       2
PRDCYEAR  DIM       4
PROCADAT  DIM       8
PROCCODE  DIM       7
PROCCLMC  DIM       3
PROCCNTR  DIM       6
PROCHOSP  DIM       3
PROCWARD  DIM       3
PROCSURG  DIM      10
PRACTICE  DIM       6
PSAGECON  DIM       3
PSAGETYP  DIM       3
.
URVISTD1  DIM       1
URVISTD2  DIM       1
URVISTD3  DIM       1
URVISTD4  DIM       1
URVISTD5  DIM       1
URVISTD6  DIM       1
.
RECEIPTN  DIM      12
RTDAYS    FORM      4
.
SAVADMNO  DIM       8
SVEOCLIN  DIM       10
SAVPCNTR  DIM       6
SKEY12    DIM      12
SKEY20    DIM      20
SUPPLIER  DIM       5
SUPPUNIT  DIM       15
.

.TEMPDATE  DIM       6
TRANDATE  DIM       8
TRANTIME  DIM       8
TYPOFCOD  DIM       2
.
MPROCCOD  DIM       9[500]
TAGCODE   DIM       4       * Tag Code                                 *I-????
.
UPDTTYPE  DIM       1
USNGICD9  FORM      1
.
VALCLAIM  DIM       3
VALATYPE  DIM       3
VALPTWRD  DIM       3
VALPTBED  DIM       3
.

VALDNRNO  DIM       20
VALDDOCT  DIM       10
VALDADMN  DIM       8
VALDCTYP  DIM       6
VALDDVCL  FORM      1
VALDSITE  DIM       6
VALDCODE  DIM       70
VALDCOD2  DIM       70
VALDCOD3  DIM       70
VALDCOD4  DIM       70
VALDCOD5  DIM       70
VALDCLMT  DIM       3
VALDDCTR  DIM       10
VALDHLFN  DIM       6                       * Health Fund Code
VALDECCP  DIM       3
VALDCEFF  DIM       8
VALDFILE  DIM       200
VALDFUND  DIM       6
VALDHFTB  DIM       8                       * Health Fund table
VALDTABL  DIM       3
VALDPERD  DIM       2
VALDYEAR  DIM       4
VALDTYPE  DIM       70
VALDSURN  DIM       30
VALDGIVE  DIM       30
VALDGIV1  DIM       30
VALDGIV2  DIM       30
VALDDOBE  DIM       8
VALDDATE  DIM       8
VALDTIME  DIM       8
VALDHOSP  DIM       3
VALDWARD  DIM       3
VALDABED  DIM       3
VALDBTCH  DIM       8
VALDURNO  DIM       8
VALDVISN  DIM       8
VALDINVN  DIM       8
VALDJTYP  DIM       3
VALDINDC  DIM       1
VISTTYPE  DIM       3
VISFOUND  FORM      1
.
UNITFILE  FILE      ASCII, FIXED=100
.
WARCHECK  DIM       3
WARCODE   DIM       3
WDATE1    DIM       8
WDATE2    DIM       8
WARNMESG  DIM       50
WARNMES2  DIM       50
WARNMES3  DIM       50
WARNMES4  DIM       60
WLFLAG    FORM      1
CLNKARAY  DIM       3[9]
SNETARAY  INIT      "13791379"
WSININDC  DIM       1
.
ALPHABET  INIT      "ABCDEFGHIJKLMNOPQRSTUVWXYZ"
CATaz     INIT      "az"
CATU1     INIT      "U1"
CATU2     INIT      "U2"
CATU3     INIT      "U3"
CATU4     INIT      "U4"
CATU5     INIT      "U5"
CATU6     INIT      "U6"
CATU7     INIT      "U7"
CATVI     INIT      "VI"
CATct     INIT      "ct"
CATrm     INIT      "rm"
CODED     INIT      "D "
CODEDD    INIT      "DD"
CODEJ     INIT      "J "
CPNZNXTC  INIT      "ABBCCDDEEFFGGHHJJKKLLMMNNPPQQRRSSTTUUVVWWXXYYZZA"
CBB       INIT      ")"
OBB       INIT      "("
DVACHAR1  INIT      "QNVTSW"
DRGINP    INIT      "drginp"
ENCINP    INIT      "encinp"
ENCERR01  INIT      "Backup at Key Word Prompt               "
ENCERR02  INIT      "Abort at Key Word Prompt                "
ENCERR03  INIT      "No Entry at Key Word Prompt             "
ENCERR04  INIT      "Next at Key Word Prompt                 "
ENCERR05  INIT      "Invalid File Format                     "
ENCERR06  INIT      "Bad Command or Command Unauthorised     "
ENCERR07  INIT      "Error Opening Interface Input File      "
ENCERR08  INIT      "Error Opening Interface Output File     "
ENCERR09  INIT      "Output File Already Exists              "
ENCERR10  INIT      "Invalid DRG / Fiscal Year               "
ENCERR12  INIT      "Invalid Codes Passed to Application     "
ENCERR34  INIT      "Not Authorised                          "
ENCERR37  INIT      "Invalid or No Age in Input File         "
ENCERR38  INIT      "Invalid or No Gender in Input File      "
ENCERR39  INIT      "Invalid or Not Integrated in Input File "
ENCERR40  INIT      "Invalid or No State in Input File       "
ENCERR41  INIT      "Invalid or No Payor in Input File       "
ENCERR42  INIT      "Invalid Discharge Date in Input File    "
ESC       INIT      27                      * ESC char
.
WARCD101  INIT      " "
WARCD102  INIT      "A"
WARCD103  INIT      "N"
WARCD104  INIT      "P"
WARCD105  INIT      "Q"
WARCD106  INIT      "X"
WARCD201  INIT      "BW"
WARCD202  INIT      "CN"
WARCD203  INIT      "GW"
WARCD204  INIT      "IV"
WARCD205  INIT      "KM"
WARCD206  INIT      "NF"
WARCD207  INIT      "NG"
WARCD208  INIT      "NK"
WARCD209  INIT      "NX"
WARCD210  INIT      "PK"
WARCD211  INIT      "PX"
WARCD212  INIT      "RD"
WARCD213  INIT      "SA"
WARCD214  INIT      "SL"
WARCD215  INIT      "SM"
WARCD216  INIT      "SR"
WARCD217  INIT      "SS"
WARCD301  INIT      "AGX"
WARCD302  INIT      "BUR"
WARCD303  INIT      "CGW"
WARCD304  INIT      "CNK"
WARCD305  INIT      "CNX"
WARCD306  INIT      "CNS"
WARCD307  INIT      "FIJ"
WARCD308  INIT      "GHA"
WARCD309  INIT      "HKS"
WARCD310  INIT      "HKX"
WARCD311  INIT      "IND"
WARCD312  INIT      "KYA"
WARCD313  INIT      "MAL"
WARCD314  INIT      "MAU"
WARCD315  INIT      "MLS"
WARCD316  INIT      "MTX"
WARCD317  INIT      "MWI"
WARCD318  INIT      "NGR"
WARCD319  INIT      "NRD"
WARCD320  INIT      "NSM"
WARCD321  INIT      "NSS"
WARCD322  INIT      "NSW"
WARCD323  INIT      "PAD"
WARCD324  INIT      "PAM"
WARCD325  INIT      "PCA"
WARCD326  INIT      "PCR"
WARCD327  INIT      "PCV"
WARCD328  INIT      "PMS"
WARCD329  INIT      "PSM"
WARCD330  INIT      "PSW"
WARCD331  INIT      "PWO"
WARCD332  INIT      "RDX"
WARCD333  INIT      "SAX"
WARCD334  INIT      "SUD"
WARCD335  INIT      "SWP"
WARCD336  INIT      "TZA"
.
ENCFILEF  FILE      ASCII,FIXED=256
ENCOUTAF  FILE      ASCII,FIXED=256
LOADFILE  FILE      ASCII,FIXED=200
TEMP1     FILE      ASCII,FIXED=660
.------------------------------------------------------------
PRGID     INIT      "COMWEB81"
VERSION   INIT      "V12.01.00"
PRGNAM    INIT      "Common XML Remote Code Validation Service"
.------------------------------------------------------------
.
          CALL      WEBINT00                * Initialise Fifo Etc.
          CALL      INIT0000                * Open Files
.
MAIN1000  CALL      XMLRED00       * Read Fifo WEBPID and USERID
.
          CALL      OUTFIL00                * Check Correct Site Files Are Open
          BRANCH    EXIT,MAIN1000
.
          PACK      CURRDATE,CCC,CYY,CMM,CDD
          REP       " 0",CURRDATE
.
MAIN1020  BRANCH    REPORTNO,MAIN1100,MAIN1200,MAIN1300,MAIN1400,MAIN1500: 
                             MAIN1600,MAIN1700,MAIN1800,MAIN1900,MAIN2000: *10
                             MAIN2100,MAIN2200,MAIN2300,MAIN2400,MAIN2500: 
                             MAIN2600,MAIN2700,MAIN2800,MAIN2900,MAIN3000: *20 
                             MAIN3100,MAIN3200,MAIN3300,MAIN3400,MAIN3500:
                             MAIN3600,MAIN3700,MAIN3800,MAIN3900,MAIN4000: *30
                             MAIN4100,MAIN4200,MAIN4300,MAIN4400,MAIN4500:
                             MAIN4600,MAIN4700,MAIN4800,MAIN4900,MAIN5000: *40
                             MAIN5100,MAIN5200,MAIN5300,MAIN5400,MAIN5500:
                             MAIN5600,MAIN5700,MAIN5800,MAIN5900,MAIN6000: *50
                             MAIN6100,MAIN6200,MAIN6300,MAIN6400,MAIN6500: 
                             MAIN6600,MAIN6700,MAIN6800,MAIN6900,MAIN7000: *60 
                             MAIN7100,MAIN7200,MAIN7300,MAIN7400,MAIN7500:
                             MAIN7600,MAIN7700,MAIN7800,MAIN7900,MAIN8000: *70
                             MAIN8100,MAIN8200,MAIN8300,MAIN8400,MAIN8500:
                             MAIN8600
.
          PACK      WEBTITLE,PRGID,SP1,VERSION,SP1,PRGNAM,SP70
          MOVE      "INVALID OPTION",WEBTITLE
          CALL      WEBERR00   * Create Output File and Write HTML Page Header
          GOTO      MAIN1000
.
MAIN1100  CALL      VALBCL00           * Validate Bed Closure
          GOTO      MAIN1000
.
MAIN1200  CALL      VALLNV00           * Validate Linked Visit Number IMC
          GOTO      MAIN1000
.
MAIN1300  CALL      VALVIS00           * Validate for inpatient visits
          GOTO      MAIN1000
.
MAIN1400  CALL      VALBOK00           * Validate for existing booking
          GOTO      MAIN1000
.
MAIN1500  CALL      GENFDT00           * Generate From date for Fees Invoice
          GOTO      MAIN1000
.
MAIN1600  CALL      VALDRN00         * Vald (DRSTAT=0)|(DRSTAT=2&PMHCHCST=14/15)
          GOTO      MAIN1000         * for DoctorSearchFrame5
.
MAIN1700  CALL      VALQMH00
          GOTO      MAIN1000
.
MAIN1800  CALL      VALBFE00         * Validate Bed fees
          GOTO      MAIN1000
.
MAIN1900  CALL      VALEDB00         * Validate ED Doctor Billing Type
          GOTO      MAIN1000
.
MAIN2000  CALL      VALM7500         * Validate 75% fee for MBS Consul Billing
          GOTO      MAIN1000
.
MAIN2100  CALL      VALMSC00         * Validate Misc Item against patmtiaf and
          GOTO      MAIN1000           aaedtraf
.
MAIN2200  CALL      VALMIT00         * Validate charge code exists in patmchgf
          GOTO      MAIN1000
.
MAIN2300  CALL      VALH1300         * Validate pri prac item HX013/V
          GOTO      MAIN1000
.
MAIN2400  CALL      VALDRV00         * Validate sub item RV
          GOTO      MAIN1000
.
MAIN2500  CALL      VALPRT00         * Validate pri item
          GOTO      MAIN1000
.
MAIN2600  CALL      VALPRO00        * Validate ama/mbs Item against patmtiaf and
          GOTO      MAIN1000        * aaedtraf
.
MAIN2700  CALL      VALPWD00        * Validate URG Code in EMRPWD
          GOTO      MAIN1000
.
MAIN2800  CALL      VALICA00        * Validate Diagnosis Code emricdaf
          GOTO      MAIN1000
.
MAIN2900  CALL      VALBRQ00        * Validate Bed Request Update
          GOTO      MAIN1000
.
MAIN3000  CALL      VALPCP00        * Validate Eclipse Participant/Capability
          GOTO      MAIN1000        * no error messages
.
MAIN3100  CALL      GTCATL00        * Gets a list of patcodes based on valdcod
          GOTO      MAIN1000
.
MAIN3200  CALL      STAVIS00        * Gets visit details to be used for a   
          GOTO      MAIN1000        * statistical admission
.
MAIN3300  CALL      VALELG00
          GOTO      MAIN1000
.
MAIN3400  CALL      VALOEC00
          GOTO      MAIN1000   
.
MAIN3500  CALL      VALOCC00
          GOTO      MAIN1000
.
MAIN3600  CALL      GNPADD00        * Get Postal/Mailing contact from pmscexaf
          GOTO      MAIN1000
.
MAIN3700  CALL      PATATR00
          GOTO      MAIN1000
.
MAIN3800  CALL      ALTVIS00        * Check for alternate visit id
          GOTO      MAIN1000
.
MAIN3900  CALL      GVSCDS00        * Validate Value Set Id and Code - pmsvstaf
          GOTO      MAIN1000
.
MAIN4000  CALL      VBDEF000        * Validate Billing Defaults - patbdeaf
          GOTO      MAIN1000
.
MAIN4100  CALL      CMPAR000        * Common System Parameters - comparaf  
          GOTO      MAIN1000
.
MAIN4200  CALL      VALCR500
          GOTO      MAIN1000
.
MAIN4300  CALL      VALDDT00
          GOTO      MAIN1000
.
MAIN4400  CALL      VALEMH00
          GOTO      MAIN1000
.
MAIN4500  CALL      LSTMPR00
          GOTO      MAIN1000
.
MAIN4600  CALL      VALNDS00           * Validate NDIS Number
          GOTO      MAIN1000
.
MAIN4700  CALL      VAPATR00           * Validate Patient Attribute
          GOTO      MAIN1000
.
MAIN4800  CALL      VALHCX00           * Validate HCP, Practice Code & Link
          GOTO      MAIN1000           
.
MAIN4900  CALL      SELREG00           * select RCP Registers for a visit type
          GOTO      MAIN1000           
.
MAIN5000  CALL      VALDNC00
          GOTO      MAIN1000
.
MAIN5100  CALL      SELDEP00           * Output a department code list for
.                                      * a given hospital id

          GOTO      MAIN1000
.
MAIN5200  CALL      ADMURL00           * Return a U/R for a given visit number 
          GOTO      MAIN1000
.
MAIN5300  CALL      VALOEB00
          GOTO      MAIN1000
.
MAIN5400  CALL      VALOCB00
          GOTO      MAIN1000
.
MAIN5500  CALL      VALCCO00           * Validate Cabrini Emr Billing Sheet
.                                      * Complexity Codes
          GOTO      MAIN1000
.
MAIN5600  CALL      VALED200           * Validate ED Doctor Billing Type
.                                      * Existence of billing type and cat ind
          GOTO      MAIN1000
.
MAIN5700  CALL      VALED300           * Validate ED Doctor Billing Type
.                                      * Existence of item records in pmsmtiaf
          GOTO      MAIN1000
.
MAIN5800  CALL      VALED400           * Validate ED Doctor Billing Type
.                                      * No Dr Charge
          GOTO      MAIN1000
.
MAIN5900  CALL      VALED500           * Validate / Update ED Doctor Billing
.                                      * History No Dr Charge
          GOTO      MAIN1000
.
MAIN6000  CALL      VALED600           * Validate if last allocate doctor 
.                                      * record is already existing in emrhisaf
          GOTO      MAIN1000
.
MAIN6100  CALL      VALED700           * Validate / Update ED Doctor Billing
.                                      * History Dr Billing Complete
          GOTO      MAIN1000
.
MAIN6200  CALL      EXPTCH00
          GOTO      MAIN1000
.
MAIN6300  CALL      OPTVIS00           * Output patvisaf fields for a visit no.
          GOTO      MAIN1000
.
MAIN6400  CALL      UERA0000           * Medicare Eclipse Webservices
                                       * ERAW Unlock to Partial
          GOTO      MAIN1000
.
MAIN6500  CALL      VALNRN00           * Validate National registration number
          GOTO      MAIN1000
.
MAIN6600  CALL      VCANCD00           * Validate patcanaf table for a code
          GOTO      MAIN1000
.
MAIN6700  CALL      VUNIXF00           * Validate if unit file exists
          GOTO      MAIN1000
.
MAIN6800  CALL      URVIST00           * Check status of UR number visits
          GOTO      MAIN1000
.
MAIN6900  CALL      OOTCAN00           * Output outcanaf fields for a visit no.
          GOTO      MAIN1000
.
MAIN7000  CALL      WPMPNL00           * Write record to NIHC IHI Polling Table
          GOTO      MAIN1000
.
MAIN7100  CALL      OPATCD00           * Output patcodaf fields for a cat and code
          GOTO      MAIN1000
.
MAIN7200  CALL      OOTBB100           * Output outbb1af fields for visit no.
          GOTO      MAIN1000
.
MAIN7300  CALL      OALCCT00           * Output allcctaf fields for Department/
.                                      * Type/Contract Code  
          GOTO      MAIN1000
.
MAIN7400  CALL      OOPTRA00           * Output oprtryaf for tray code/hosp 
          GOTO      MAIN1000
.
MAIN7500  CALL      VALNZM00           * Output nzpmchaf details
          GOTO      MAIN1000
.
MAIN7600  CALL      OOPEQP00           * Output opreqpaf for equipment code/hosp
          GOTO      MAIN1000
.
MAIN7700  CALL      CHCKDL00           * Return Doctor Level Ind1 (cat DL)
          GOTO      MAIN1000
.
MAIN7800  CALL      OWBSTE00           * Output websteaf for WEB User Server
.                                      * Security Table
          GOTO      MAIN1000
.
MAIN7900  CALL      OCCGRP00      * Default Occupational group for Future Action
          GOTO      MAIN1000
.
MAIN8000  CALL      VIBDMV00      * Validate Supervisor Insert Bed Movement
          GOTO      MAIN1000
.
MAIN8100  CALL      VCDINV00      * Validate Patient Credit Invoice
          GOTO      MAIN1000
.
MAIN8200  CALL      VSINAD00      * Validate Supervisor Insert Admission
          GOTO      MAIN1000
.
MAIN8300  CALL      OWTPRO00      * Output watproaf details
          GOTO      MAIN1000
.
MAIN8400  CALL      CANMVA00      * Cancell ICWA MVA
          GOTO      MAIN1000
.
MAIN8500  CALL      OPTDOC00      * Output patdo1af for a doctor codes
          GOTO      MAIN1000
.
MAIN8600  CALL      VLDIHC00      * Output for validation webservices invoice
          GOTO      MAIN1000
.
.-------------------------------------------------------------------------------
. Open Files and Initialize Variables
.-------------------------------------------------------------------------------
INIT0000  OPEN      CONTROLF,"controlf"
.
          OPEN      IBAALVA1,"ibaalvaf"
          OPEN      BOKRC1A1,"bokrc1af"
          OPEN      BOKRC1A6,"bokrc1af"
          OPEN      BOKRX1A1,"bokrx1af"
          OPEN      OUTBOKA3,"outbokaf"
          OPEN      OUTBB1A1,"outbb1af"
.
          OPEN      AAEDTRE1,"aaedtref"
          OPEN      ALLCCTA1,"allcctaf"
          OPEN      ALLDEPA2,"alldepaf"
          OPEN      EMRICDA1,"emricdaf"
          OPEN      EMRHISA1,"emrhisaf"
          OPEN      EMRHISA2,"emrhisaf"
          OPEN      EMRVISA1,"emrvisaf"
          OPEN      EMRECHA1,"emrechaf"
          OPEN      EMRECLA1,"emreclaf"
          OPEN      EMRVISA3,"emrvisaf"
.
          OPEN      OUTSITA1,"outsitaf"
          OPEN      PATCODE1,"patcodes"
          OPEN      PATCODE2,"patcodes"
          OPEN      PATCANA1,"patcanaf"
          OPEN      PATDO1A1,"patdo1af"
          OPEN      PATDSCH1,"patdschf"
          OPEN      PATFX1A1,"patfx1af"
          OPEN      PATMCHG1,"patmchgf"
          OPEN      PATMCHG4,"patmchgf"
          OPEN      PATMI1A1,"patmi1af"
          OPEN      PATMI1A2,"patmi1af"
          OPEN      PATMI1A3,"patmi1af"
          OPEN      PATMI1A8,"patmi1af"
          OPEN      PATQMHA1,"patqmhaf"
          OPEN      PATPCPA1,"patpcpaf"
          OPEN      PATATRA1,"patatraf"
          OPEN      PATATRA3,"patatraf"
.
          OPEN      PATINVR3,"patinvrf"
          OPEN      PATTRAN1,"pattranf"
          OPEN      PATTRAN2,"pattranf"
          OPEN      PATVISA1,"patvisaf"
          OPEN      RCPREGA1,"rcpregaf"
.
          OPEN      PMSBDCA1,"pmsbdcaf"
          OPEN      PMSBRQA1,"pmsbrqaf"
          OPEN      PMSBRQA2,"pmsbrqaf"
          OPEN      PMSCCDA1,"pmsccdaf"
          OPEN      PMSCCDA3,"pmsccdaf"
          OPEN      PMSCEXA1,"pmscexaf"
          OPEN      PMSELFA1,"pmselfaf"
          OPEN      PMSELFA2,"pmselfaf"
          OPEN      PMSELFA3,"pmselfaf"
          OPEN      PMSELFA4,"pmselfaf"
          OPEN      PMSEXTA1,"pmsextaf"
          OPEN      PMSHCPA1,"pmshcpaf"
          OPEN      PMSHCGA1,"pmshcgaf"
          OPEN      PMSHCLA1,"pmshclaf"
          OPEN      PMSHCPA4,"pmshcpaf"
          OPEN      PMSHCPA7,"pmshcpaf"
          OPEN      PMSMTIA1,"pmsmtiaf"
          OPEN      PMSMTIA2,"pmsmtiaf"
          OPEN      PMSVSCA1,"pmsvscaf"
          OPEN      PMSVX1A1,"pmsvx1af"
          OPEN      PRIHDBT1,"prihdbtf"
          OPEN      PRIHDBT2,"prihdbtf"
          OPEN      PRIHREF1,"prihreff"
          OPEN      PRIHREF2,"prihreff"
          OPEN      PRIHTRA1,"prihtraf"
          OPEN      PRIITEM1,"priitemf"
.
          OPEN      PRIALSA1,"prialsaf"
          OPEN      PRIPRAC1,"pripracf"
          OPEN      PRISECA2,"prisecaf"
          OPEN      PRIDOCT1,"pridoctf"
          OPEN      PRIDOCT2,"pridoctf"
.
          OPEN      PATBFEE1,"patbfeef"
          OPEN      PATELGA1,"patelgaf"
          OPEN      PATFN1A1,"patfn1af"
.
          OPEN      PATWR1A1,"patwr1af"
          OPEN      WEBSECA1,"websecaf"
.
          OPEN      MRTMASA2,"mrtmasaf"
          OPEN      MRTVISA1,"mrtvisaf" 
          OPEN      OPRTRYA1,"oprtryaf" 
          OPEN      NZPMCHA3,"nzpmchaf"
          OPEN      OPREQPA1,"opreqpaf" 
          OPEN      WEBSTEA1,"websteaf"
          OPEN      WEBIHCA2,"webihcaf"
          OPEN      WATPROA1,"watproaf" 
.
          READ      CONTROLF,ZERO;*43,IBCNMHOS

          IF        IBCNMHOS=1
            OPEN      MLTHCPA1,"mlthcpaf"
            OPEN      MLTCODA1,"mltcodaf"
            OPEN      MLTCODA2,"mltcodaf"
          ENDIF
.
          READ      CONTROLF,TEN9;*212,CFEETYP
          READ      CONTROLF,TWENTY;*50,PTCNADBF,*193,PTCNDCLM
          READ      CONTROLF,THIRTY6;*221,RCCNORUH
          READ      CONTROLF,EIGHTY8;*102,CFEEDT,*162,PTCFEEOF:
                                     *194,PTCFEEAE,PTCFEEOP
.
          READ      CONTROLF,HUND10;*246,PTCNMHCP
          READ      CONTROLF,HUND17;*249,PTCNBDEF
          READ      CONTROLF,HUND18;*138,PTCNNEWC
          READ      CONTROLF,HUND20;*158,PTCNUNET
          READ      CONTROLF,HUND28;*105,PTCNUABF
          READ      CONTROLF,HUND29;*61,PTCNWSIN
.
          MATCH     "1",PTCNUABF
          IF        @EQUAL
            OPEN      EMRPWDA2,"emrpwdaf"
          ENDIF
.
          OPEN      OUTSITA1,"outsitaf"
          MOVE      "out",CFILEPRE
          CALL      OPNOUT00
.
          MOVE      ONE,WSININDC
          MATCH     "1",PTCNWSIN
          IF         @EQUAL
.
            MOVE      ZERO,OVRCD
            TRAP      OVERCOND IF IO
            OPEN      WEBPCPA1,"webpcpaf"
            TRAPCLR   IO
            IF        OVRCD=1
              MOVE      ZERO,WSININDC
            ENDIF
.
            MOVE      ZERO,OVRCD
            TRAP      OVERCOND IF IO
            OPEN      WEBELFA5,"webelfaf"
            TRAPCLR   IO
            IF        OVRCD=1
              MOVE      ZERO,WSININDC
            ENDIF
.
          ENDIF
.
            MOVE      ZERO,OVRCD
            TRAP      OVERCOND IF IO
            OPEN      WEBERHA1,"weberhaf"
            TRAPCLR   IO
            IF        OVRCD=1
              MOVE      ZERO,WSININDC
            ENDIF
.
          MATCH     "3",PTCNUNET
          IF        @EQUAL
            OPEN      PMSNPLA1,"pmsnplaf" 
          ENDIF
.
INIT9999  RETURN
.
. Note Following Labels Not Used in Service
.
PROFLD00  RETURN 
.------------------------------------------------------------
. Clear Parameters
.------------------------------------------------------------
CLRPAR00  MOVE      SP70,VALDCODE 
          MOVE      SP70,VALDDCTR
          MOVE      SP70,VALDCOD2
          MOVE      SP70,VALDCOD3
          MOVE      SP70,VALDCOD4
          MOVE      SP70,VALDCOD5
          MOVE      SP70,VALDADMN
          MOVE      SP70,VALDNRNO
          MOVE      SP70,VALDDOCT
          MOVE      SP70,VALDCLMT
          MOVE      SP70,VALDFILE
          MOVE      SP70,VALDFUND
          MOVE      SP70,VALDHLFN
          MOVE      SP70,VAlDECCP
          MOVE      SP70,VALDTYPE
          MOVE      SP70,VALDTABL
          MOVE      SP70,VALDPERD
          MOVE      SP70,VALDYEAR
          MOVE      SP70,PRDCYEAR
          MOVE      SP70,PRDCNUMB
          MOVE      SP70,VALDSURN
          MOVE      SP70,VALDGIV1
          MOVE      SP70,VALDGIV2
          MOVE      SP70,VALDDOBE
          MOVE      SP70,VALDDATE
          MOVE      SP70,VALDTIME
          MOVE      SP70,VALDHOSP
          MOVE      ZERO,DURATION
          MOVE      ZERO,NUMBDAYS
          MOVE      ZERO,CURRCASE
          MOVE      SP70,ADMISSNO
          MOVE      SP70,SUPPLIER
          MOVE      SP70,SUPPUNIT
          MOVE      SP70,CPROCODE
          MOVE      SP70,PROCCLMC
          MOVE      SP70,CONTPROC
          MOVE      SP70,PROCCNTR
          MOVE      SP70,PROCSURG
          MOVE      SP70,PROCADAT
          MOVE      SP70,TRANDATE
          MOVE      SP70,TRANTIME
          MOVE      SP70,PROCHOSP
          MOVE      SP70,PROCWARD
          MOVE      SP70,FRSTDATE
          MOVE      SP70,LASTDATE
          MOVE      SP70,VYEARMTH
          MOVE      SP70,RECEIPTN
          MOVE      ZERO,RETURNFM
          MOVE      SP70,VALDWARD
          MOVE      SP70,VALDABED
          MOVE      SP70,PERIODFR
          MOVE      SP70,PERIODTO
          MOVE      ZERO,INVOICEN
          MOVE      SP70,JOURITEM
          MOVE      ZERO,JOURPATT
          MOVE      ZERO,USNGICD9
          MOVE      SP70,ICD10DAT
          MOVE      SP70,VALDBTCH
          MOVE      SP70,VALDURNO
          MOVE      SP70,VALDVISN
          MOVE      SP70,VALDINVN
          MOVE      SP70,VALDJTYP
          MOVE      SP1,VALDINDC
          MOVE      SP70,MEDIPRAC
          MOVE      ZERO,DOCTHOSP
          MOVE      SP70,MULTHOSP
.
          MOVE      SP70,VALDSITE
          MOVE      SP70,VALDCTYP
          MOVE      SP70,VALDCEFF
          MOVE      ZERO,FUNDTYPE
.
CLRPAR99  RETURN
.------------------------------------------------------------
. Set Parameters
.------------------------------------------------------------
SETPAR00  MATCH     "valdcode=",QRYNAME
          IF        @EQUAL
            MOVE      QRYDATA,VALDCODE
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "valdcod2=",QRYNAME
          IF        @EQUAL
            MOVE      QRYDATA,VALDCOD2
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "valdcod3=",QRYNAME
          IF        @EQUAL
            MOVE      QRYDATA,VALDCOD3
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "valdcod4=",QRYNAME
          IF        @EQUAL
            MOVE      QRYDATA,VALDCOD4
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "valdcod5=",QRYNAME
          IF        @EQUAL
            MOVE      QRYDATA,VALDCOD5
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "valddctr=",QRYNAME
          IF        @EQUAL
            MOVE      QRYDATA,VALDDCTR
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "valdclmt=",QRYNAME
          IF        @EQUAL
            PACK      VALDCLMT,QRYDATA,SP70
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "valdfile=",QRYNAME
          IF        @EQUAL
            MOVE      QRYDATA,VALDFILE
            PACK      VALDFILE,VALDFILE,SP70,SP70,SP70
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "valdfund=",QRYNAME
          IF        @EQUAL
            MOVE      QRYDATA,VALDFUND
            PACK      VALDFUND,VALDFUND,SP70
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "valdhlfn=",QRYNAME
          IF        @EQUAL
            MOVE      QRYDATA,VALDHLFN
            PACK      VALDHLFN,VALDHLFN,SP70
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "valdhftb=",QRYNAME
          IF        @EQUAL
            MOVE      QRYDATA,VALDHFTB
            PACK      VALDHFTB,VALDHFTB,SP70
            GOTO      SETPAR99
          ENDIF
.

          MATCH     "valdeccp=",QRYNAME
          IF        @EQUAL
            MOVE      QRYDATA,VALDECCP
            PACK      VALDECCP,VALDECCP,SP70
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "valdtabl=",QRYNAME
          IF        @EQUAL
            MOVE      QRYDATA,VALDTABL
            PACK      VALDTABL,VALDTABL,SP70
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "valdtype=",QRYNAME
          IF        @EQUAL
            MOVE      QRYDATA,VALDTYPE
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "valdperd=",QRYNAME
          IF        @EQUAL
            MOVE      QRYDATA,VALDPERD
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "valdyear=",QRYNAME
          IF        @EQUAL
            MOVE      QRYDATA,VALDYEAR
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "prdcyear=",QRYNAME
          IF        @EQUAL
            MOVE      QRYDATA,PRDCYEAR
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "prdcnumb=",QRYNAME
          IF        @EQUAL
            MOVE      QRYDATA,PRDCNUMB
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "valdsurn=",QRYNAME
          IF        @EQUAL
            MOVE      QRYDATA,VALDSURN
            PACK      VALDSURN,VALDSURN,SP70
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "valdgive=",QRYNAME
          IF        @EQUAL
            MOVE      QRYDATA,VALDGIVE
            PACK      VALDGIVE,VALDGIVE,SP70
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "valdgiv1=",QRYNAME
          IF        @EQUAL
            MOVE      QRYDATA,VALDGIV1
            PACK      VALDGIV1,VALDGIV1,SP70
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "valdgiv2=",QRYNAME
          IF        @EQUAL
            MOVE      QRYDATA,VALDGIV2
            PACK      VALDGIV2,VALDGIV2,SP70
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "valddobe=",QRYNAME
          IF        @EQUAL
            UNPACK    QRYDATA,CDAY,KEY1,MTHNAM3,KEY1,CCENT,CYEAR
            CALL      SETMTH00            * Set CMON from MTHNAM3
            PACK      VALDDOBE,CCENT,CYEAR,CMON,CDAY
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "valddate=",QRYNAME
          IF        @EQUAL
            UNPACK    QRYDATA,CDAY,KEY1,MTHNAM3,KEY1,CCENT,CYEAR
            CALL      SETMTH00            * Set CMON from MTHNAM3
            PACK      VALDDATE,CCENT,CYEAR,CMON,CDAY
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "valdtime=",QRYNAME
          IF        @EQUAL
            MOVE      QRYDATA,VALDTIME
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "valdhosp=",QRYNAME
          IF        @EQUAL
            PACK      VALDHOSP,QRYDATA,SP70
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "numbdays=",QRYNAME
          IF        @EQUAL
            MOVE      QRYDATA,NUMBDAYS
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "duration=",QRYNAME
          IF        @EQUAL
            MOVE      QRYDATA,DURATION
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "currcase=",QRYNAME
          IF        @EQUAL
            MOVE      QRYDATA,CURRCASE
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "admissno=",QRYNAME
          IF        @EQUAL
            MOVE      QRYDATA,ADMISSNO
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "supplier=",QRYNAME
          IF        @EQUAL
            PACK      SUPPLIER,QRYDATA,SP70
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "suppunit=",QRYNAME
          IF        @EQUAL
            PACK      SUPPUNIT,QRYDATA,SP70
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "cprocode=",QRYNAME
          IF        @EQUAL
            PACK      CPROCODE,QRYDATA,SP70
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "procclmc=",QRYNAME
          IF        @EQUAL
            PACK      PROCCLMC,QRYDATA,SP70
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "prochosp=",QRYNAME
          IF        @EQUAL
            PACK      PROCHOSP,QRYDATA,SP70
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "procward=",QRYNAME
          IF        @EQUAL
            PACK      PROCWARD,QRYDATA,SP70
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "contproc=",QRYNAME
          IF        @EQUAL
            PACK      CONTPROC,QRYDATA,SP70
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "proccntr=",QRYNAME
          IF        @EQUAL
            PACK      PROCCNTR,QRYDATA,SP70
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "procsurg=",QRYNAME
          IF        @EQUAL
            PACK      PROCSURG,QRYDATA,SP70
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "procadat=",QRYNAME
          IF        @EQUAL
            UNPACK    QRYDATA,CDAY,KEY1,MTHNAM3,KEY1,CCENT,CYEAR
            CALL      SETMTH00            * Set CMON from MTHNAM3
            PACK      PROCADAT,CCENT,CYEAR,CMON,CDAY
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "frstdate=",QRYNAME
          IF        @EQUAL
            MOVE      QRYDATA,FRSTDATE
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "frstdate=",QRYNAME
          IF        @EQUAL
            MOVE      QRYDATA,FRSTDATE
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "vyearmth=",QRYNAME
          IF        @EQUAL
            MOVE      QRYDATA,VYEARMTH
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "receiptn=",QRYNAME
          IF        @EQUAL
            MOVE      QRYDATA,RECEIPTN
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "returnfm=",QRYNAME
          IF        @EQUAL
            MOVE      QRYDATA,RETURNFM
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "trandate=",QRYNAME
          IF        @EQUAL
            UNPACK    QRYDATA,CDAY,KEY1,MTHNAM3,KEY1,CCENT,CYEAR
            CALL      SETMTH00            * Set CMON from MTHNAM3
            PACK      TRANDATE,CCENT,CYEAR,CMON,CDAY
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "trantime=",QRYNAME
          IF        @EQUAL
            MOVE      QRYDATA,TRANTIME
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "valdward=",QRYNAME
          IF        @EQUAL
            MOVE      QRYDATA,VALDWARD
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "valdabed=",QRYNAME
          IF        @EQUAL
            MOVE      QRYDATA,VALDABED
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "periodfr=",QRYNAME
          IF        @EQUAL
            PACK      PERIODFR,QRYDATA,SP70
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "periodto=",QRYNAME
          IF        @EQUAL
            PACK      PERIODTO,QRYDATA,SP70
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "invoicen=",QRYNAME
          IF        @EQUAL
            SQUEEZE   QRYDATA
            MOVE      QRYDATA,INVOICEN
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "jouritem=",QRYNAME
          IF        @EQUAL
            MOVE      QRYDATA,JOURITEM
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "jourpatt=",QRYNAME
          IF        @EQUAL
            SQUEEZE   QRYDATA
            MOVE      QRYDATA,JOURPATT
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "usngicd9=",QRYNAME
          IF        @EQUAL
            MOVE      QRYDATA,USNGICD9
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "icd10dat=",QRYNAME
          IF        @EQUAL
            MATCH     SP70,QRYDATA
            GOTO      SETPAR99 IF EQUAL
            GOTO      SETPAR99 IF EOS
.
            UNPACK    QRYDATA,CDAY,KEY1,MTHNAM3,KEY1,CCENT,CYEAR
            CALL      SETMTH00              * Set CMON from MTHNAM3
            PACK      ICD10DAT,CCENT,CYEAR,CMON,CDAY,SP70
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "valdbtch=",QRYNAME
          IF        @EQUAL
            MOVE      QRYDATA,VALDBTCH
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "valdurno=",QRYNAME
          IF        @EQUAL
            MOVE      QRYDATA,VALDURNO
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "valdvisn=",QRYNAME
          IF        @EQUAL
            MOVE      QRYDATA,VALDVISN
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "valdinvn=",QRYNAME
          IF        @EQUAL
            MOVE      QRYDATA,VALDINVN
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "valdjtyp=",QRYNAME
          IF        @EQUAL
            MOVE      QRYDATA,VALDJTYP
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "valdindc=",QRYNAME
          IF        @EQUAL
            MOVE      QRYDATA,VALDINDC
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "mediprac=",QRYNAME
          IF        @EQUAL
            MOVE      QRYDATA,MEDIPRAC
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "urnumber=",QRYNAME
          IF        @EQUAL
            MOVE      QRYDATA,URNUMBER
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "docthosp=",QRYNAME
          IF        @EQUAL
            MOVE      QRYDATA,DOCTHOSP
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "multhosp=",QRYNAME
          IF        @EQUAL
            PACK      MULTHOSP,QRYDATA,SP10
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "valclaim=",QRYNAME
          IF        @EQUAL
            PACK      VALCLAIM,QRYDATA,SP10
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "valatype=",QRYNAME
          IF        @EQUAL
            PACK      VALATYPE,QRYDATA,SP10
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "valptwrd=",QRYNAME
          IF        @EQUAL
            PACK      VALPTWRD,QRYDATA,SP10
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "valptbed=",QRYNAME
          IF        @EQUAL
            PACK      VALPTBED,QRYDATA,SP10
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "valdadmn=",QRYNAME
          IF        @EQUAL
            MOVE      QRYDATA,VALDADMN
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "valdsite=",QRYNAME
          IF        @EQUAL
            PACK      VALDSITE,QRYDATA,SP70
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "valdctyp=",QRYNAME
          IF        @EQUAL
            PACK      VALDCTYP,QRYDATA,SP70
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "valdnrno=",QRYNAME
          IF        @EQUAL
            MOVE      QRYDATA,VALDNRNO     
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "valddoct=",QRYNAME
          IF        @EQUAL
            MOVE      QRYDATA,VALDDOCT
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "valdceff=",QRYNAME
          IF        @EQUAL
            PACK      VALDCEFF,QRYDATA,SP70
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "fundtype=",QRYNAME
          IF        @EQUAL
            MOVE      QRYDATA,FUNDTYPE
            GOTO      SETPAR99
          ENDIF
.
SETPAR99  RETURN
.
.------------------------------------------------------------
. Validate Bed Closure
.------------------------------------------------------------
VALBCL00  CALL      XMLHED00
          BRANCH    EXIT,VALBCL99
.
VALBCL05  PACK      KEY3,VALDCODE,SP70
          PACK      KEY3A,VALDCOD2,SP70
.
          MATCH     SP70,KEY3A
          GOTO      VALBCL98 IF EQUAL
.
.         PACK      KEY22,KEY3,KEY3A,VALDDATE,VALDTIME,SP70
.         CALL      RDPMBDC1
.         IF        OVRCD=0
.           GOTO      VALBCL90
.         ENDIF
.
          PACK      KEY22,KEY3,KEY3A,SP70
          CALL      RSPMBDC1
VALBCL10  CALL      RKPMBDC1
          BRANCH    OVRCD,VALBCL60
.
          MATCH     KEY3,PMBCWARD
          GOTO      VALBCL60 IF NOT EQUAL
.
          MATCH     KEY3A,PMBCBED
          GOTO      VALBCL60 IF NOT EQUAL
.
          MATCH     PMBCFRDT,VALDDATE
          GOTO      VALBCL10 IF LESS
.
          IF        @EQUAL
            MATCH     PMBCFRTM,VALDTIME
            GOTO      VALBCL10 IF LESS
          ENDIF
.
          MATCH     PMBCTODT,VALDDATE
          GOTO      VALBCL90 IF LESS
.
          IF        @EQUAL
            MATCH     PMBCTOTM,VALDTIME
            GOTO      VALBCL90 IF LESS
          ENDIF
.
          GOTO      VALBCL10
.
VALBCL60  WRITE     HTMLFILE;"<RETURN_VALUE TYPE=SIMPLE>":
                             ONE:
                             "</RETURN_VALUE>"
          GOTO      VALBCL98
.
VALBCL90  WRITE     HTMLFILE;"<RETURN_VALUE TYPE=ERROR>":
                             "Statistical Admission Bed is Closed.":
                             "</RETURN_VALUE>"
          GOTO      VALBCL98
.
VALBCL98  CALL      XMLEND00
VALBCL99  RETURN
+
.------------------------------------------------------------
. Validate Linked Visit Number IMC
.------------------------------------------------------------
VALLNV00  CALL      XMLHED00
          BRANCH    EXIT,VALLNV99
.
VALLNV05  MATCH     SP70,VALDCODE
          GOTO      VALLNV98 IF EQUAL
.
          PACK      KEY8,VALDCOD2,SP70
          PACK      KEY6,VALDCOD3,SP70
          PACK      KEY10A,VALDCOD4,SP70
          PACK      KEY3,VALDCOD5,SP70
.
          PACK      KEY8,VALDCOD2,SP70
          CALL      RDPRHD2
          BRANCH    OVRCD,VALLNV90
.
          PACK      KEY27,PRHDUNIQ,KEY6,KEY10A,KEY3,SP70
          CALL      RDPRHR1
          BRANCH    OVRCD,VALLNV91
.
          PACK      KEY62,PRHRUNIQ,PRHRPRAC,PRHRDOCT,PRHRPIND,PRHRREFD,PRHRRDAT:
                          SP1,TWO,SP9,SP3,SP1,SP1,ONE,SP70
          CALL      RDPRHT1
          BRANCH    OVRCD,VALLNV20
.
          MOVE      VALDCODE,PRHTLVIS
.
          CALL      UPPRHT1
.
          GOTO      VALLNV60
.
VALLNV20  CALL      CLPRIHTR
.
          MOVE      PRHRUNIQ,PRHTUNIQ
          MOVE      PRHRPRAC,PRHTPRAC
          MOVE      PRHRDOCT,PRHTDOCT
          MOVE      PRHRPIND,PRHTPIND
          MOVE      PRHRREFD,PRHTREFD
          MOVE      TWO,PRHTFLAG
          MOVE      SP70,PRHTITMN
          MOVE      SP70,PRHTSUBN
          MOVE      ONE,PRHTNUMB
          MOVE      PRHRRDAT,PRHTRDAT
.
          MOVE      VALDCODE,PRHTLVIS
.
          CALL      WRPRHT1
.
VALLNV60  WRITE     HTMLFILE;"<RETURN_VALUE TYPE=SIMPLE>":
                             ONE:
                             "</RETURN_VALUE>"
          GOTO      VALLNV98
.
VALLNV90  WRITE     HTMLFILE;"<RETURN_VALUE TYPE=ERROR>":
                           "Holding Header Table record for Debtors not found.":
                           "</RETURN_VALUE>"
          GOTO      VALLNV98
.
VALLNV91  WRITE     HTMLFILE;"<RETURN_VALUE TYPE=ERROR>":
                           "Holding Table for Doctor Referrals record not found.":
                           "</RETURN_VALUE>"
          GOTO      VALLNV98
.
VALLNV98  CALL      XMLEND00
VALLNV99  RETURN
+
.------------------------------------------------------------
. Validate Current Inpatient Visits
.------------------------------------------------------------
VALVIS00  CALL      XMLHED00
          BRANCH    EXIT,VALVIS99
.
          MOVE      ZERO,VISFOUND
.
. --- check for preadmissions ---
.
          PACK      KEY17,URNUMBER,ONE,Z70
          CALL      RSPTMI18
VALVIS10  CALL      RPPTMI18
          BRANCH    OVRCD,VALVIS15
.
          MATCH     URNUMBER,AURNO
          IF        !@EQUAL
            CALL      CLPATMIS
            GOTO      VALVIS15
          ENDIF
.
          COMPARE   ONE,ASTAT
          GOTO      VALVIS15 IF NOT EQUAL
.
          CALL      IBACLOCK
          PACK      KEY8,CCC,CYY,CMM,CDD
          REP       " 0",KEY8
.
          MATCH     KEY8,ADATE
          GOTO      VALVIS10 IF LESS
.
          ADD       ONE,VISFOUND
          COMPARE   TWO,VISFOUND
          GOTO      VALVIS50 IF EQUAL
          GOTO      VALVIS10
.
. --- check for current admissions ---
.
VALVIS15  PACK      KEY17,URNUMBER,TWO,SP70
          CALL      RSPTMI18
          CALL      RKPTMI18
          BRANCH    OVRCD,VALVIS20
.
          MATCH     URNUMBER,AURNO
          IF        !@EQUAL
            CALL      CLPATMIS
            GOTO      VALVIS20
          ENDIF
.
          COMPARE   TWO,ASTAT
          GOTO      VALVIS20 IF NOT EQUAL
.
          ADD       ONE,VISFOUND
          COMPARE   TWO,VISFOUND
          GOTO      VALVIS50 IF EQUAL
.
. --- check for on leave admissions before session date ---
.
VALVIS20  PACK      KEY17,URNUMBER,FOUR,SP70
          CALL      RSPTMI18
          CALL      RKPTMI18
          BRANCH    OVRCD,VALVIS50
.
          MATCH     URNUMBER,AURNO
          IF        !@EQUAL
            CALL      CLPATMIS
            GOTO      VALVIS50
          ENDIF
.
          COMPARE   FOUR,ASTAT
          GOTO      VALVIS50 IF NOT EQUAL
.
          ADD       ONE,VISFOUND
          COMPARE   TWO,VISFOUND
          GOTO      VALVIS50 IF EQUAL
.
.. --- check for discharged admissions within session date ---
..
.VALVIS25  PACK      KEY17,URNUMBER,THREE,Z70
.          CALL      RSPTMI18
.VALVIS30  CALL      RPPTMI18
.          BRANCH    OVRCD,VALVIS50
..
.          MATCH     URNUMBER,AURNO
.          IF        !@EQUAL
.            CALL      CLPATMIS
.            GOTO      VALVIS50
.          ENDIF
..
.          COMPARE   THREE,ASTAT
.          GOTO      VALVIS50 IF NOT EQUAL
..
.          MATCH     ADATE,OPSEDATE
.          GOTO      VALVIS30 IF LESS
..
.          PACK      KEY8,AADMNO,SP70
.          CALL      RDDSCH1
.          BRANCH    OVRCD,VALVIS30
..
.          MATCH     OPSEDATE,DDATE
.          GOTO      VALVIS50 IF LESS
..
.          ADD       ONE,VISFOUND
.          COMPARE   TWO,VISFOUND
.          GOTO      VALVIS50 IF EQUAL
.
VALVIS50  WRITE     HTMLFILE;"<RETURN_VALUE TYPE=SIMPLE>":
                             VISFOUND:
                             "</RETURN_VALUE>"
          GOTO      VALVIS98
.
VALVIS98  CALL      XMLEND00
VALVIS99  RETURN
.
.------------------------------------------------------------
. Validate Existing Booking
.------------------------------------------------------------
VALBOK00  CALL      XMLHED00
          BRANCH    EXIT,VALBOK99
.
          PACK      KEY8,ADMISSNO,SP70
          CALL      RDBKREC1
          BRANCH    OVRCD,VALBOK60
.
          MOVE      SP70,DIM10
          MOVE      SP70,DIM20
.
          MATCH     SP70,BKREADAT
          IF        !@EQUAL
            UNPACK    BKREADAT,CCENT,CYEAR,CMON,CDAY
            PACK      DIM10,CDAY,SLASH,CMON,SLASH,CCENT,CYEAR,SP70
          ENDIF
.
          MATCH     SP70,BKRETYPE
          IF        !@EQUAL
            PACK      KEY5,ANSB,ANSK,BKRETYPE,SP70
            CALL      RDCODE1
            IF        OVRCD=0
              MOVE      TDESC,DIM20
            ENDIF
          ENDIF
.
VALBOK50  WRITE     HTMLFILE;"<RETURN_VALUE TYPE=ERROR>":
    "WARNING: Booking Type '",DIM20,"' for '",DIM10:
    "' already exists. Creating a new Booking Visit.":
                             "</RETURN_VALUE>"
          GOTO      VALBOK98
.
VALBOK60  WRITE     HTMLFILE;"<RETURN_VALUE TYPE=SIMPLE>":
                             ONE:
                             "</RETURN_VALUE>"
          GOTO      VALBOK98
.
VALBOK98  CALL      XMLEND00
VALBOK99  RETURN
+
.------------------------------------------------------------
.           Generate From date for Fees Invoice
.------------------------------------------------------------
GENFDT00  CALL      XMLHED00
          BRANCH    EXIT,GENFDT99
.
          MATCH     SP70,VALDINDC
          GOTO      VALLNV98 IF EQUAL
.
          MOVE      CFEEDT,KEY8         * default to Inpatient
          MATCH     "1",VALDINDC
          IF        @EQUAL
            MOVE      PTCFEEAE,KEY8     * Emergency
          ENDIF
.
          MATCH     "2",VALDINDC
          IF        @EQUAL
            MOVE      PTCFEEOP,KEY8     * Outpatient
          ENDIF
.
          MATCH     "4",VALDINDC
          IF        @EQUAL
            MOVE      PTCFEEOF,KEY8     * Other Financial
          ENDIF
.
          UNPACK    KEY8,CCENT,CYEAR,CMON,CDAY
          REP       " 0",CYEAR
          MOVE      CMON,F2
          LOAD      MTHNAM3,F2,JAN,FEB,MAR,APR,MAY,JUN,JUL,AUG,SEP,OCT,NOV,DEC
.
          PACK      DISPDATE,CDAY,SP1,MTHNAM3,SP1,CCENT,CYEAR
.
          WRITE     HTMLFILE;"<RETURN_VALUE TYPE=SIMPLE>":
                             DISPDATE:
                             "</RETURN_VALUE>"
.
GENFDT98  CALL      XMLEND00
GENFDT99  RETURN
+
.------------------------------------------------------------
. Validate Doctor with status active (patdo1af.DRSTAT=0) OR 
. status active outside (patdo1af.DRSTAT=2) and linked to HCP 
. type Nurse (pmshcpaf.PMHCHCST=14/15)
.------------------------------------------------------------
VALDRN00  CALL      XMLHED00
          BRANCH    EXIT,VALDRN99
.
          IF        IBCNMHOS=1
            PACK      KEY10,USERID,SP70
            CALL      RDWBSE1
            BRANCH    OVRCD,VALDRN96
          ENDIF
.
          IF        DOCTHOSP=1
            MOVE      MULTHOSP,WBSEHOSP      * validate dr for specific hospital
          ENDIF
.
          PACK      KEY6,VALDCODE,SP70
          CALL      RDDOCT1
          BRANCH    OVRCD,VALDRN90
.
          COMPARE   ZERO,DRSTAT              * Active?
          GOTO      VALDRN40 IF EQUAL        * Yes, check multi hospital 
.
.                             1        2
          BRANCH    DRSTAT,VALDRN91,VALDRN20 
          GOTO      VALDRN90                 * Send error message for all other
.
.      DRSTAT=2 - Active Outside check if Doctor is linked to an HCP nurse type
VALDRN20  MOVE      ZERO,COUNTER             * Initialize counter
          PACK      KEY16,DCODE,SP70         * Position cursor to read from
          CALL      RSPMHCP4                   * dcode on pmshcpaf table
VALDRN21  CALL      RKPMHCP4                 * Read next pmshcpaf record
          BRANCH    OVRCD,VALDRN92           * End of file, send error message
.
          MATCH     DCODE,PMHCLDOC           * Same doctor code?
          GOTO      VALDRN22 IF EQUAL        * Yes, check nurse type
.
          COMPARE   ZERO,COUNTER             * Is is this the first record?
          GOTO      VALDRN92 IF NOT EQUAL    * No, send error message
.                                            * Yes, first record then
          CALL      RPPMHCP4                   * Read previous record
          MATCH     PMHCLDOC,DCODE             * Same doctor code?
          GOTO      VALDRN22 IF EQUAL          * Yes, check nurse type
          GOTO      VALDRN92 IF NOT EQUAL      * No, send error message
.
VALDRN22  IF        PMHCHCST = 14 | PMHCHCST = 15
            GOTO      VALDRN50               * Nurse type,display doct name 
          ELSE
            ADD       ONE,COUNTER            * Not Nurse type, increment counter
            GOTO      VALDRN21               * Read next pmshcpaf record
          ENDIF
.
VALDRN40  IF        IBCNMHOS=1
            MATCH    "1",PTDOHOSS
            IF       @EQUAL
              PACK     KEY13,WBSEHOSP,DCODE,SP70
              CALL     RDMLHCP1
              BRANCH   OVRCD,VALDRN97
              MATCH    "1",MLHCACTV
              GOTO     VALDRN97 IF EQUAL    * only active hospitals
            ELSE
              MATCH    "1",PTCNMHCP         * Only show matching hospitals
              GOTO     VALDRN97 IF EQUAL
            ENDIF
          ENDIF
.
VALDRN50  CALL      DOCNAM00
.
VALDRN80  WRITE     HTMLFILE;"<RETURN_VALUE TYPE=SIMPLE>":
                              DOCFNAME,"|",DRTYPE:
                             "</RETURN_VALUE>"
          GOTO      VALDRN98
.
VALDRN90  WRITE     HTMLFILE;"<RETURN_VALUE TYPE=ERROR>":
                             "Invalid Doctor Code - ":
                              KEY6,"</RETURN_VALUE>"
          GOTO      VALDRN98
.
VALDRN91  WRITE     HTMLFILE;"<RETURN_VALUE TYPE=ERROR>":
                             "Inactive Doctor Code - ":
                              KEY6,"</RETURN_VALUE>"
          GOTO      VALDRN98
.
VALDRN92  WRITE     HTMLFILE;"<RETURN_VALUE TYPE=ERROR>":
                             "Doctor is not linked to an HCP Nurse Type - ":
                             "Invalid Doctor Code - ":
                              KEY6,"</RETURN_VALUE>"
          GOTO      VALDRN98

VALDRN96  WRITE     HTMLFILE;"<RETURN_VALUE TYPE=ERROR>":
                             "Invalid User Id - ":
                              USERID,"</RETURN_VALUE>"
          GOTO      VALDRN98
.
VALDRN97  WRITE     HTMLFILE;"<RETURN_VALUE TYPE=ERROR>":
                             "Invalid Hospital for Doctor Code - ":
                              KEY6,"</RETURN_VALUE>"
          GOTO      VALDRN98
.
VALDRN98  CALL      XMLEND00
.
VALDRN99  RETURN
+
.------------------------------------------------------------
. Format Doctor Name in Title Text
.------------------------------------------------------------
DOCNAM00  CLEAR     DISPNAME
          MOVE      DTITL,FMTTITLE
          MOVE      DGNAME,FMTGNAME
          MOVE      DSNAME,FMTSNAME
          STRIP     FMTTITLE
          STRIP     FMTGNAME
          STRIP     FMTSNAME
          CALL      DOCNM000
          RETURN
.------------------------------------------------------------
. Validate PATQMH
.------------------------------------------------------------
VALQMH00  CALL      XMLHED00
          BRANCH    EXIT,VALQMH99
.
          PACK      KEY8,ADMISSNO,SP70
          CALL      RDMISS1
          BRANCH    OVRCD,VALQMH60
.
          PACK      KEY8,ADMISSNO,SP70
          CALL      RDPTQMH1
          IF        OVRCD=ONE
            MOVE      SP70,DPTQMADM
            MOVE      SP70,PTQMTOUA
            MOVE      SP70,PTQMEMPS
            MOVE      SP70,PTQMPSNS
            MOVE      SP70,PTQMPRMS
            MOVE      SP70,PTQMRTFC
            MOVE      SP70,PTQMMLSI
            MOVE      SP70,PTQMPSNT
          ENDIF
.
VALQMH50  WRITE     HTMLFILE;"<RETURN_VALUE TYPE=SIMPLE>":
                            ADOCTA,"|",DPTQMADM,"|",PTQMTOUA,"|",PTQMEMPS,"|":
                            PTQMPSNS,"|",PTQMPRMS,"|",PTQMRTFC,"|",PTQMMLSI,"|":
                            PTQMPSNT:
                             "</RETURN_VALUE>"
          GOTO      VALQMH98
.
VALQMH60  WRITE     HTMLFILE;"<RETURN_VALUE TYPE=SIMPLE>":
                             "No Data":
                             "</RETURN_VALUE>"
          GOTO      VALQMH98
.
VALQMH98  CALL      XMLEND00
VALQMH99  RETURN
+
.------------------------------------------------------------
. validate bed fees
.------------------------------------------------------------
VALBFE00  CALL      XMLHED00
          BRANCH    EXIT,VALBFE99
.
          COMPARE   ZERO,CFEETYP
          GOTO      VALBFE99 IF NOT EQUAL     * Not using bed fees
.
          PACK      KEY8,ADMISSNO,SP70
          CALL      RDMISS1
          BRANCH    EXIT,VALBFE90
.
          CALL      CBFE0000
          BRANCH    EXIT,VALBFE90
.
          WRITE     HTMLFILE;"<RETURN_VALUE TYPE=SIMPLE>":
                             BFPAT,"|",BFHF,"|",BFDESC:
                             "</RETURN_VALUE>"
          GOTO      VALBFE98
.
VALBFE90  WRITE     HTMLFILE;"<RETURN_VALUE TYPE=ERROR>":
                             "Bed Fees not set up - ",PMVXMHOS,"-",VALCLAIM:
                             "-",AFUNDH,"-",AFNDTB,"-",VALATYPE,"-",WEFRBT:
                             "</RETURN_VALUE>"
          GOTO      VALBFE98
.
VALBFE98  CALL      XMLEND00
VALBFE99  RETURN
+
.------------------------------------------------------------
. Check bed fees
.------------------------------------------------------------
CBFE0000  MOVE      ZERO,EXIT
          MOVE      SP70,PTHFBCAT
          PACK      KEY14 WITH AFUNDH,AFNDTB,SP10
          MATCH     SP70,KEY14
          IF        !@EQUAL
            CALL      RDFUND1
            BRANCH    OVRCD,CBFE9000
          ENDIF
.
          PACK      KEY6,VALPTWRD,VALPTBED
          CALL      RDWARD1
          BRANCH    OVRCD,CBFE9000
.
          PACK      KEY9,VALCLAIM,AFUNDH,SP70
          CALL      GETCNEFF               * Get Contract Effective From
          BRANCH    EXIT,CBFE9000
.
          MOVE      ZERO,FORM2
          PACK      KEY18 WITH VALCLAIM,AFUNDH,PTHFBCAT,VALATYPE,WEFRBT
.
CBFE1000  PACK      KEY27 WITH KEY18,SP70
          CALL      RDSBFEE1
CBFE1200  CALL      RDKBFEE1
          BRANCH    OVRCD OF CBFE3000
.
          PACK      DIM18A WITH BFCLM,BFHFUND,PTBFHTYP,BFATYPE,BFBTYPE,SP70
          MATCH     KEY18,DIM18A
          GOTO      CBFE3000 IF NOT EQUAL
.
          MOVE      ADATE,CEFFDATE        * Use admission date
          MOVE      PTBFCNID,KEY6         * Contract ID
          CALL      VALCONTR              * Validate the Contract ID
          BRANCH    EXIT,CBFE1200
          MOVE      PTBFCNID,CONTRCID     * Contract ID
          GOTO      CBFE4000
.
CBFE3000  ADD       ONE,FORM2
          BRANCH    FORM2 OF CBFE3200,CBFE3400
          GOTO      CBFE9000
.
CBFE3200  PACK      KEY18 WITH VALCLAIM,SP6,SP3,VALATYPE,WEFRBT
          GOTO      CBFE1000
.
CBFE3400  IF        IBCNMHOS=1
            OPEN      PMSVX1A1,"pmsvx1af"
            OPEN      PATHSPA1,"pathspaf"
.
            MOVE      SP10,PMVXMHOS
            MOVE      AADMNO,KEY8
            CALL      RDPMVX11
            MOVE      PMVXMHOS,KEY3
            CALL      RDPTHSP1
            IF        OVRCD=0
              MOVE      PTHSDCLM,PTCNDCLM     * default claim code charging
            ENDIF
          ENDIF
.
          PACK      KEY18 WITH PTCNDCLM,SP6,SP3,VALATYPE,WEFRBT
.
          BRANCH    PTCNADBF,CBFE1000         * No Automatic use of defaults
          GOTO      CBFE9000
.
CBFE4000  COMPARE   ZERO,BFENDDY
          GOTO      CBFE1200 IF EQUAL
.
          MOVE      ZERO,EXIT
          GOTO      CBFE9999
.
CBFE9000  MOVE      ONE,EXIT
CBFE9999  RETURN
+
.------------------------------------------------------------
. validate ed billing doctor type description / indicator
.------------------------------------------------------------
VALEDB00  CALL      XMLHED00
          BRANCH    EXIT,VALEDB99
.
          MATCH     SP70,VALDCODE
          GOTO      VALEDB98 IF EQUAL
          GOTO      VALEDB98 IF EOS
.
          PACK      KEY10,VALDCODE,SP70
          CALL      RDPMHCP1
          BRANCH    EXIT,VALEDB98
.
          MATCH     SP70,PMHCUDF1
          GOTO      VALEDB98 IF EQUAL
          GOTO      VALEDB98 IF EOS
.
          PACK      KEY5,ANSR,FIVE,PMHCUDF1,SP70
          CALL      RDCODE1
          BRANCH    OVRCD,VALEDB98
.
          WRITE     HTMLFILE;"<RETURN_VALUE TYPE=SIMPLE>":
                             PTCDLDES,"|",TCINDC1:
                             "</RETURN_VALUE>"
          GOTO      VALEDB98
.
VALEDB98  CALL      XMLEND00
VALEDB99  RETURN
+
.------------------------------------------------------------
. validate 75% fee for MBS Consultation Billing
.------------------------------------------------------------
VALM7500  CALL      XMLHED00
          BRANCH    EXIT,VALM7599
.
          PACK      VALDCODE,VALDCODE,SP70
          PACK      VALDDATE,VALDDATE,SP70
          UNPACK    VALDCODE,KEY9
.
          PACK      KEY22,SP1,ZERO,KEY9,SP70
VALM7505  CALL      RSPRIT1
VALM7510  CALL      RKPRIT1
          BRANCH    OVRCD,VALM7598
.
          COMPARE   ZERO,PRITFLAG
          GOTO      VALM7598 IF NOT EQUAL
.
          MATCH     KEY9,PRITITMN
          GOTO      VALM7598 IF NOT EQUAL
.
          MATCH     SP70,PRITSUBN
          GOTO      VALM7598 IF NOT EQUAL
.
          MATCH     PRITDAT1,VALDDATE
          GOTO      VALM7510 IF LESS
.
          COMPARE   ZERO,PRITSF75
          GOTO      VALM7510 IF EQUAL
.
          WRITE     HTMLFILE;"<RETURN_VALUE TYPE=SIMPLE>":
                             ONE:
                             "</RETURN_VALUE>"
          GOTO      VALM7598
.
VALM7598  CALL      XMLEND00
VALM7599  RETURN
.------------------------------------------------------------
. validate misc item against pmsmtiaf aaedtraf
.------------------------------------------------------------
VALMSC00  CALL      XMLHED00
          BRANCH    EXIT,VALMSC99
.
          PACK      VALDCODE,VALDCODE,SP70
          PACK      VALDCOD2,VALDCOD2,SP70
          MOVE      SP70,KEY10
.
          MATCH     SP70,VALDCODE 
          GOTO      VALMSC98 IF EQUAL
.
          MATCH     SP70,VALDCOD2
          GOTO      VALMSC98 IF EQUAL
.
          MOVE      VALDCODE,KEY8
          MOVE      VALDCOD2,KEY9
.
          PACK      KEY15,KEY8,THREE,SP70
          CALL      RSPMMTI2
VALMSC10  CALL      RKPMMTI2
          BRANCH    OVRCD,VALMSC50
.
          MATCH     KEY8,PMMIVISN
          GOTO      VALMSC50 IF NOT EQUAL
.
          MATCH     "3",PMMIRTYP  
          GOTO      VALMSC50 IF NOT EQUAL
.
          MATCH     KEY9,PMMIITEM
          GOTO      VALMSC10 IF NOT EQUAL
.
          MOVE      PMMIEDAD,KEY10
.
          GOTO      VALMSC97
.
VALMSC50  PACK      KEY22,KEY8,SP70
          CALL      RDSDTRE1
VALMSC60  CALL      RDKDTRE1
          BRANCH    OVRCD,VALMSC98
.
          MATCH     KEY8,DATNUMB
          GOTO      VALMSC98 IF NOT EQUAL
.
          COMPARE   ONE,ATRECTYP
          GOTO      VALMSC60 IF NOT EQUAL
.
          MATCH     KEY9,ATITEMNO
          GOTO      VALMSC60 IF NOT EQUAL
.
          MOVE      ATDTEDAD,KEY10
.
VALMSC97  WRITE     HTMLFILE;"<RETURN_VALUE TYPE=SIMPLE>":
                             ONE,"|",KEY10:
                             "</RETURN_VALUE>"
          GOTO      VALMSC98
.
VALMSC98  CALL      XMLEND00
VALMSC99  RETURN
+
.------------------------------------------------------------
. validate charge code exists in patmchgf
.------------------------------------------------------------
.VALMIT00  CALL      XMLHED00
.          BRANCH    EXIT,VALMIT99
..
.          PACK      KEY9,VALDCODE,SP70
..
.          PACK      KEY29,KEY9,Z70
.          CALL      RDSMCHG4
.          CALL      RDPMCHG4
.          BRANCH    OVRCD,VALMIT98
..
.          MATCH     KEY9,MCHARGE
.          GOTO      VALMIT98 IF NOT EQUAL
..
.          MATCH     "1",PTMCACTV
..          GOTO      VALMIT98 IF EQUAL
..
.          WRITE     HTMLFILE;"<RETURN_VALUE TYPE=SIMPLE>":
.                             ONE:
.                             "</RETURN_VALUE>"
.          GOTO      VALMIT98
..
.VALMIT98  CALL      XMLEND00
..
.VALMIT99  RETURN
+
.------------------------------------------------------------
. Validate Misc Charge Item Code
.------------------------------------------------------------
VALMIT00  CALL      XMLHED00
          BRANCH    EXIT,VALMIT99
          MOVE      ZERO,F1
.
VALMIT01  MOVE      ZERO,INVALDFL
          PACK      KEY9,VALDCODE,SP70
.
.         Check for miscellaneous item code
.
          PACK      KEY29,VALDCLMT,VALDFUND,VALDTABL,KEY9,CURRDATE,SP10
          CALL      PATMCHRD                * read Misc.Charges file
          COMPARE   ZERO,EXIT
          GOTO      VALMIT80 IF EQUAL       * it's valid
.
          MOVE      WKMCINAC,INVALDFL       * inactive
          MOVE      WKMCXXDT,INVALDAT       * date range error
.
.         No record with health fund details - try a blank health fund
.
          PACK      KEY29,VALDCLMT,SP6,SP3,KEY9,CURRDATE,SP10
          CALL      PATMCHRD                * read Misc.Charges file
          COMPARE   ZERO,EXIT
          GOTO      VALMIT80 IF EQUAL       * it's valid
.
          MOVE      WKMCINAC,INVALDFL       * inactive
          MOVE      WKMCXXDT,INVALDAT       * date range error
.
.
.         No record with blank fund details. Last chance, try default claim.
.
VALMIT02  IF        IBCNMHOS=1
            MATCH     SP10,MULTHOSP
            IF        @EQUAL
              PACK      KEY3,WBSEHOSP,SP70
              CALL      RSPTHSP1
              CALL      RKPTHSP1
              BRANCH    OVRCD,VALMIT92
            ELSE
              PACK      KEY3,MULTHOSP
              CALL      RDPTHSP1
              BRANCH    OVRCD,VALMIT92
            ENDIF
            PACK      KEY29,PTHSDCLM,SP6,SP3,KEY9,CURRDATE,SP10
          ELSE
            PACK      KEY29,PTCNDCLM,SP6,SP3,KEY9,CURRDATE,SP10
          ENDIF
.
VALMIT03  CALL      PATMCHRD                * read Misc.Charges file
          COMPARE   ZERO,EXIT
          GOTO      VALMIT80 IF EQUAL       * it's valid
.
          MOVE      WKMCINAC,INVALDFL       * inactive
          MOVE      WKMCXXDT,INVALDAT       * date range error
.
.                          read forward (for some reason)
.
VALMIT05  IF        IBCNMHOS=1
            PACK      KEY29,PTHSDCLM,SP6,SP3,KEY9,CURRDATE,SP10
          ELSE
            PACK      KEY29,PTCNDCLM,SP6,SP3,KEY9,CURRDATE,SP10
          ENDIF
          CALL      RDMCHG1
          IF        OVRCD=0
            MATCH     "1",PTMCACTV               * Inactive ?
            GOTO      VALMIT80 IF NOT EQUAL      * No
            MOVE      ONE,INVALDFL
          ENDIF
.
          UNPACK    KEY29,KEY21,KEY8

          CALL      RDKMCHG1                     * read forward (beware)
          BRANCH    OVRCD,VALMIT50
          PACK      KEY21A,MCLMCOD,MHFUND,PTMCHFTT,MCHARGE
          MATCH     KEY21,KEY21A
          IF        @EQUAL
            MOVE      ONE,INVALDFL
            GOTO      VALMIT80
          ENDIF
          GOTO      VALMIT90
.
.         read thru all hospitals in multi hospitals table
.
VALMIT50  IF        IBCNMHOS=1
            MATCH     SP10,MULTHOSP
            IF        @EQUAL
              CALL      RKPTHSP1
              IF        OVRCD=0
                PACK      KEY29,PTHSDCLM,SP6,SP3,KEY9,CURRDATE,SP10
                GOTO      VALMIT03
              ENDIF
            ENDIF
          ENDIF
.
          BRANCH    INVALDFL,VALMIT91
          BRANCH    INVALDAT,VALMIT94
          GOTO      VALMIT90
.
.                   set up HTLM data
.
VALMIT80  WRITE     HTMLFILE;"<RETURN_VALUE TYPE=SIMPLE>":
                             ONE:
                             "</RETURN_VALUE>"
          GOTO      VALMIT98
.
VALMIT90  
.         WRITE     HTMLFILE;"<RETURN_VALUE TYPE=ERROR>":
.                            "Invalid Misc Charge Code - ":
.                             VALDCODE,"</RETURN_VALUE>"
          GOTO      VALMIT98
.
VALMIT91  
.         WRITE     HTMLFILE;"<RETURN_VALUE TYPE=ERROR>":
.                            "Inactive Misc Charge Code - ":
.                             VALDCODE,"</RETURN_VALUE>"
          GOTO      VALMIT98
.
VALMIT92  
.         WRITE     HTMLFILE;"<RETURN_VALUE TYPE=ERROR>":
.                            "Multi Hospital Default Claim Code not setup ":
.                            "</RETURN_VALUE>"
          GOTO      VALMIT98
.
VALMIT93  
.         WRITE     HTMLFILE;"<RETURN_VALUE TYPE=ERROR>":
.                            "Invalid Doctor Misc Charge Code - ":
.                            "</RETURN_VALUE>"
          GOTO      VALMIT98
.
VALMIT94  
.         WRITE     HTMLFILE;"<RETURN_VALUE TYPE=ERROR>":
.                            "Misc Charge Code outside Date range - ":
.                            "</RETURN_VALUE>"
          GOTO      VALMIT98
.
VALMIT98  CALL      XMLEND00
.
VALMIT99  RETURN
.
.------------------------------------------------------------
. validate pri prac item HX013/V
.------------------------------------------------------------
VALH1300  CALL      XMLHED00
          BRANCH    EXIT,VALH1399
.
          PACK      VALDCODE,VALDCODE,SP70
          PACK      VALDDATE,VALDDATE,SP70
          UNPACK    VALDCODE,KEY9
.
          PACK      KEY22,SP1,ZERO,KEY9,ANSV,SP70
VALH1305  CALL      RSPRIT1
VALH1310  CALL      RKPRIT1
          BRANCH    OVRCD,VALH1398
.
          COMPARE   ZERO,PRITFLAG
          GOTO      VALH1398 IF NOT EQUAL
.
          MATCH     KEY9,PRITITMN
          GOTO      VALH1398 IF NOT EQUAL
.
          MATCH     "V",PRITSUBN
          GOTO      VALH1398 IF NOT EQUAL
.
          MATCH     PRITDAT1,VALDDATE
          GOTO      VALH1310 IF LESS
.
          WRITE     HTMLFILE;"<RETURN_VALUE TYPE=SIMPLE>":
                             ONE:
                             "</RETURN_VALUE>"
          GOTO      VALH1398
.
VALH1398  CALL      XMLEND00
VALH1399  RETURN
+
.------------------------------------------------------------
. validate RV sub item code in priitemf
.------------------------------------------------------------
VALDRV00  CALL      XMLHED00
          BRANCH    EXIT,VALDRV99
.
          PACK      VALDCODE,VALDCODE,SP70
          PACK      VALDDATE,VALDDATE,SP70
          UNPACK    VALDCODE,KEY9
.
          PACK      KEY22,SP1,ZERO,KEY9,ANSR,ANSV,SP1,SP70
VALDRV05  CALL      RSPRIT1
VALDRV10  CALL      RKPRIT1
          BRANCH    OVRCD,VALDRV98
.
          COMPARE   ZERO,PRITFLAG
          GOTO      VALDRV98 IF NOT EQUAL
.
          MATCH     KEY9,PRITITMN
          GOTO      VALDRV98 IF NOT EQUAL
.
          MATCH     "RV ",PRITSUBN
          GOTO      VALDRV98 IF NOT EQUAL
.
          MATCH     PRITDAT1,VALDDATE
          GOTO      VALDRV10 IF LESS
.
          WRITE     HTMLFILE;"<RETURN_VALUE TYPE=SIMPLE>":
                             ONE:
                             "</RETURN_VALUE>"
          GOTO      VALDRV98
.
VALDRV98  CALL      XMLEND00
VALDRV99  RETURN
+
.------------------------------------------------------------
. validate pri item
.------------------------------------------------------------
VALPRT00  CALL      XMLHED00
          BRANCH    EXIT,VALPRT99
.
VALPRT01  PACK      VALDCODE,VALDCODE,SP70
          PACK      VALDDATE,VALDDATE,SP70
          PACK      VALDCOD2,VALDCOD2,SP70
          PACK      VALDCOD3,VALDCOD3,SP70
.
          UNPACK    VALDCODE,KEY9
          UNPACK    VALDCOD3,KEY3
.
          MATCH     SP70,VALDCOD2
          GOTO      VALPRT78 IF EQUAL
.
          MOVE      SP1,KEY1
          PACK      KEY5,ANSC,ANSL,VALDCOD2,SP70
          CALL      RDCODE1
          BRANCH    OVRCD,VALPRT78
.
.         Check the indicators for a W, M, or V (these are the claims)
.
          MOVE      ZERO,FORM2
VALPRT10  ADD       ONE,FORM2
          COMPARE   SIX,FORM2
          GOTO      VALPRT78 IF NOT LESS
.
          LOAD      ANS USING FORM2 OF TCINDC1,TCINDC2,TCINDC3,TCINDC4,TCINDC5
.
          CMATCH    "W",ANS
          GOTO      VALPRT20 IF EQUAL
.
          CMATCH    "M",ANS
          GOTO      VALPRT20 IF EQUAL
.
          CMATCH    "V",ANS
          GOTO      VALPRT20 IF EQUAL
.
          GOTO      VALPRT10
.
VALPRT20  MOVE      ANS,KEY1
.
.
VALPRT50  PACK      KEY3,KEY1,SP70
          PACK      KEY22,SP1,ZERO,KEY9,KEY3,SP70
          CALL      RSPRIT1
VALPRT60  CALL      RKPRIT1
          BRANCH    OVRCD,VALPRT75
.
          COMPARE   ZERO,PRITFLAG               * same item type ?
          GOTO      VALPRT75 IF NOT EQUAL        * no
.
          MATCH     SP70,KEY3
          GOTO      VALPRT75 IF EQUAL
.
          UNPACK    KEY3,KEY1
          CMATCH    KEY1,PRITSUBN
          GOTO      VALPRT75 IF NOT EQUAL
.
          MATCH     PRITDAT1,VALDDATE
          GOTO      VALPRT60 IF LESS
.
          MATCH     SP8,PRITDAT2            * test for a Cease Date   *I-230710
          IF        !@EQUAL
            MATCH     VALDDATE,PRITDAT2
            GOTO      VALPRT60 IF LESS      * read next if past Cease date
          ENDIF
.
          MOVE      PRITSUBN,KEY3
          GOTO      VALPRT78
.
VALPRT75  MOVE      VALDCOD3,KEY3
.
.
VALPRT78  PACK      KEY22,SP1,ZERO,KEY9,KEY3,Z70
          CALL      RSPRIT1
VALPRT80  CALL      RPPRIT1
          BRANCH    OVRCD,VALPRT95
.
          COMPARE   ZERO,PRITFLAG               * same item type ?
          GOTO      VALPRT95 IF NOT EQUAL        * no
.
          MATCH     KEY9,PRITITMN               * same item number ?
          GOTO      VALPRT95 IF NOT EQUAL        * no
.
          MATCH     SP70,KEY3
          IF        !@EQUAL
            MATCH     KEY3,PRITSUBN              * same subitem number ?
            GOTO      VALPRT95 IF NOT EQUAL      * no
          ENDIF
.
          MATCH     PRITDAT1,VALDDATE            * item date > service date ?
          GOTO      VALPRT80 IF LESS             * yes
.
          MATCH     SP8,PRITDAT2            * test for a Cease Date   *I-230710
          IF        !@EQUAL
            MATCH     VALDDATE,PRITDAT2
            GOTO      VALPRT80 IF LESS      * read next if past Cease date
          ENDIF                                                * end  *I-230710
.
VALPRT90  WRITE     HTMLFILE;"<RETURN_VALUE TYPE=SIMPLE>":
                             ONE:
                             "</RETURN_VALUE>"
          GOTO      VALPRT98
.
VALPRT95  WRITE     HTMLFILE;"<RETURN_VALUE TYPE=SIMPLE>":
                             ZERO:
                             "</RETURN_VALUE>"
          GOTO      VALPRT98
.
VALPRT98  CALL      XMLEND00
.
VALPRT99  RETURN
.
.------------------------------------------------------------
. validate ama/mbs item against pmsmtiaf aaedtraf
.------------------------------------------------------------
VALPRO00  CALL      XMLHED00
          BRANCH    EXIT,VALPRO99
.
VALPRO01  PACK      VALDCODE,VALDCODE,SP70
          PACK      VALDCOD2,VALDCOD2,SP70
          MOVE      SP70,KEY10
.
          MATCH     SP70,VALDCODE
          GOTO      VALPRO98 IF EQUAL
.
          MATCH     SP70,VALDCOD2
          GOTO      VALPRO98 IF EQUAL
.
          MOVE      VALDCODE,KEY8
          MOVE      VALDCOD2,KEY9
.
          PACK      KEY15,KEY8,EIGHT,SP70
          CALL      RSPMMTI2
VALPRO10  CALL      RKPMMTI2
          BRANCH    OVRCD,VALPRO50
.
          MATCH     KEY8,PMMIVISN
          GOTO      VALPRO50 IF NOT EQUAL
.
          MATCH     "8",PMMIRTYP
          GOTO      VALPRO50 IF NOT EQUAL
.
          MATCH     KEY9,PMMIITEM
          GOTO      VALPRO10 IF NOT EQUAL
.
          MOVE      PMMIEDAD,KEY10
.
          GOTO      VALPRO97
.
VALPRO50  PACK      KEY22,KEY8,SP70
          CALL      RDSDTRE1
VALPRO60  CALL      RDKDTRE1
          BRANCH    OVRCD,VALPRO98
.
          MATCH     KEY8,DATNUMB
          GOTO      VALPRO98 IF NOT EQUAL
.
          COMPARE   FIVE,ATRECTYP
          GOTO      VALPRO60 IF NOT EQUAL
.
          MATCH     KEY9,ATITEMNO
          GOTO      VALPRO60 IF NOT EQUAL
.
          MOVE      ATDTEDAD,KEY10
.
VALPRO97  WRITE     HTMLFILE;"<RETURN_VALUE TYPE=SIMPLE>":
                             ONE,"|",KEY10:
                             "</RETURN_VALUE>"
          GOTO      VALPRO98
.
VALPRO98  CALL      XMLEND00
VALPRO99  RETURN
+
.------------------------------------------------------------
. validate URG Code in EMRPWD
.------------------------------------------------------------
VALPWD00  CALL      XMLHED00
          BRANCH    EXIT,VALPWD99
.
VALPWD10  MATCH     "1",PTCNUABF
          GOTO      VALPWD98 IF NOT EQUAL
.
          PACK      VALDCODE,VALDCODE,SP70
          UNPACK    VALDCODE,KEY6
.
          PACK      KEY12,KEY6,Z70
          CALL      RSEMPWD2
          CALL      RPEMPWD2
          BRANCH    OVRCD,VALPWD98
.
          MATCH     KEY6,EMPWURGV
          GOTO      VALPWD94 IF NOT EQUAL
.
          WRITE     HTMLFILE;"<RETURN_VALUE TYPE=SIMPLE>":
                             EMPWURGD:
                             "</RETURN_VALUE>"
          GOTO      VALPWD98
.
VALPWD94  WRITE     HTMLFILE;"<RETURN_VALUE TYPE=ERROR>":
                             "Invalid URG Code.":
                             "</RETURN_VALUE>"
          GOTO      VALMIT98
.
VALPWD98  CALL      XMLEND00
VALPWD99  RETURN
.
.------------------------------------------------------------
. Validate National registration number in pmshcpaf.pmhcmpgn
.------------------------------------------------------------
VALNRN00  CALL      XMLHED00
          BRANCH    EXIT,VALNRN99
.
VALNRN10  PACK      VALDNRNO,VALDNRNO,SP70
          PACK      KEY30,VALDNRNO,SP70
          CALL      RSPMHCP7
VALNRN15  CALL      RKPMHCP7
          BRANCH    OVRCD,VALNRN98
.
          MATCH     VALDDOCT,PMHCHCPC
          GOTO      VALNRN15 IF EQUAL          
.
          MATCH     VALDNRNO,PMHCMPGN
          GOTO      VALNRN98 IF NOT EQUAL
.
          WRITE     HTMLFILE;"<RETURN_VALUE TYPE=SIMPLE>":
                             PMHCHCPC:
                             "</RETURN_VALUE>"
.
VALNRN98  CALL      XMLEND00
VALNRN99  RETURN
.
.------------------------------------------------------------
. Validate Diagnosis code against emricdaf
.------------------------------------------------------------
VALICA00  CALL      XMLHED00
          BRANCH    EXIT,VALICA99
.
VALICA20  MOVE      VALDCODE,KEY9
          CALL      RDEMICD1
          BRANCH    OVRCD,VALICA90
.
          WRITE     HTMLFILE;"<RETURN_VALUE TYPE=SIMPLE>":
                             EMICDESC:
                             "</RETURN_VALUE>"
          GOTO      VALICA98
.
VALICA90  WRITE     HTMLFILE;"<RETURN_VALUE TYPE=ERROR>":
                             "Invalid Diagnosis Code - ":
                             KEY9,"</RETURN_VALUE>"
          GOTO      VALICA98
.
VALICA98  CALL      XMLEND00
VALICA99  RETURN
+
.------------------------------------------------------------
. Validate Bed Request Update
.------------------------------------------------------------
VALBRQ00  CALL      XMLHED00
          BRANCH    EXIT,VALBRQ99
.
VALBRQ05
.
          PACK      KEY25,VALDCODE,SP70
          CALL      RSPMBRQ2
VALBRQ10  CALL      RKPMBRQ2
          BRANCH    OVRCD,VALBRQ91
.
          MOVE      VALDCODE,DIM8
          MATCH     DIM8,PMBRVISN
          GOTO      VALBRQ92 IF NOT EQUAL
.
          MATCH     " ",PMBRRSTA
          GOTO      VALBRQ20 IF EQUAL
.
          MATCH     "1",PMBRRSTA
          GOTO      VALBRQ20 IF EQUAL
.
          MATCH     "2",PMBRRSTA
          GOTO      VALBRQ20 IF EQUAL
.
          GOTO      VALBRQ10
.
VALBRQ20  
.         PACK      KEY8,VALDCODE,SP70
.         CALL      RDPTMIS1
.         BRANCH    OVRCD,VALBRQ93
.
          MATCH     SP70,VALDCOD2
          IF        !@EQUAL
            PACK      KEY6,VALDCOD2,SP70
            CALL      RDWARD1
            IF        OVRCD=0
.
              IF        WINPUT=0
                MATCH     SP70,VALDCOD3
                GOTO      VALBRQ90 IF EQUAL
                GOTO      VALBRQ90 IF EOS
              ENDIF
.
              MATCH     SP70,WRTYPE
              IF        !@EQUAL
                MOVE      "RT",CATEGORY
                MOVE      WRTYPE,CODE
                CALL      GETCOD00
                MATCH     "N",TCINDC6
                GOTO      VALBRQ10 IF EQUAL
                MATCH     "R",TCINDC6
                GOTO      VALBRQ80 IF EQUAL
              ENDIF
            ENDIF
          ENDIF
.
          GOTO      VALBRQ10
.
VALBRQ80  MOVE      SP70,DIM10
.
          MATCH     SP70,PMBRREQD
          IF        !@EQUAL & !@EOS
            UNPACK     PMBRREQD,CCENT,CYEAR,CMON,CDAY
            PACK       DIM10,CDAY,SLASH,CMON,SLASH,CCENT,CYEAR
          ENDIF 
.
          MATCH     SP70,PMBRTYPE
          IF        !@EQUAL & !@EOS
            MOVE      "RT",CATEGORY
            MOVE      PMBRTYPE,CODE
            CALL      GETCOD00
          ENDIF
.
          WRITE     HTMLFILE;"<RETURN_VALUE TYPE=SIMPLE>":
                              ONE,"|",DIM10,"|",PMBRREQT,"|",TDESC,"|":
                             "</RETURN_VALUE>"
          GOTO      VALBRQ98
.
VALBRQ90  WRITE     HTMLFILE;"<RETURN_VALUE TYPE=SIMPLE>":
                              ZERO,"|":
                             "</RETURN_VALUE>"
          GOTO      VALBRQ98
.
VALBRQ91  WRITE     HTMLFILE;"<RETURN_VALUE TYPE=SIMPLE>":
                              "PMSBRQ read incorrect","|",KEY25,"|",PMBRVISN,PMBRRSTA,PMBRREQD,PMBRREQT,OVRCD,"|":
                             "</RETURN_VALUE>"
          GOTO      VALBRQ98
.
VALBRQ92  WRITE     HTMLFILE;"<RETURN_VALUE TYPE=SIMPLE>":
                              "Visit Number not equal","|":
                             "</RETURN_VALUE>"
          GOTO      VALBRQ98
.
VALBRQ93  WRITE     HTMLFILE;"<RETURN_VALUE TYPE=SIMPLE>":
                              "PATMI1 read incorrect","|":
                             "</RETURN_VALUE>"
          GOTO      VALBRQ98
.
VALBRQ98  CALL      XMLEND00
VALBRQ99  RETURN
+
.------------------------------------------------------------
. Validate Eclipse Participant Code and Capability
.------------------------------------------------------------
VALPCP00  CALL      XMLHED00
          BRANCH    EXIT,VALPCP99
.
          MATCH     "1",PTCNWSIN
          GOTO      VALPCP53 IF EQUAL
.
VALPCP10  PACK      KEY6,VALDHLFN,SP70
          CALL      RDPTFX11
          BRANCH    OVRCD,VALPCP50
.
          MATCH     SP70,PTFXECLP
          GOTO      VALPCP50 IF EQUAL
          GOTO      VALPCP50 IF EOS
.
          MOVE      SP70,KEY3
          MOVE      PTFXECLP,KEY3
          PACK      KEY9,KEY3,VALDECCP,SP70
          CALL      RSPTPCP1
          CALL      RKPTPCP1
          BRANCH    OVRCD,VALPCP50
.
          MATCH     KEY3,PTPPCODE
          GOTO      VALPCP50 IF NOT EQUAL
.
          MATCH     VALDECCP,PTPPCPID
          GOTO      VALPCP50 IF NOT EQUAL
.
          GOTO      VALPCP60
.
VALPCP50  
.         PACK      KEY14,VALDHLFN,ZERO,ZERO,ZERO,ZERO,SP70
.         CALL      RDFUND1
.         BRANCH    OVRCD,VALPCP97
.
.         MATCH     SP70,PTHFHGRP
.         GOTO      VALPCP95 IF EQUAL
.         GOTO      VALPCP95 IF EOS
.
.         MOVE      SP70,KEY3
.         MOVE      PTHFHGRP,KEY3
.         PACK      KEY9,KEY3,VALDECCP,SP70
.         CALL      RSPTPCP1
.         CALL      RKPTPCP1
.         BRANCH    OVRCD,VALPCP96
.
.         MATCH     KEY3,PTPPCODE
.         GOTO      VALPCP95 IF NOT EQUAL
.
.         MATCH     VALDECCP,PTPPCPID
.         GOTO      VALPCP96 IF NOT EQUAL
.
          GOTO      VALPCP98
.
VALPCP53  MATCH     "1",WSININDC
          GOTO      VALPCP95 IF NOT EQUAL
.
          PACK      KEY6,VALDHLFN,SP70
          CALL      RDPTFX11
          BRANCH    OVRCD,VALPCP55
.
          MATCH     SP70,PTFXECLP
          GOTO      VALPCP55 IF EQUAL
          GOTO      VALPCP55 IF EOS
.
          MOVE      SP70,KEY3
          MOVE      PTFXECLP,KEY3
          PACK      KEY9,KEY3,VALDECCP,SP70
          CALL      RSWBPCP1
          CALL      RKWBPCP1
          BRANCH    OVRCD,VALPCP55
.
          MATCH     KEY3,WBPCCODE
          GOTO      VALPCP55 IF NOT EQUAL
.
          MATCH     VALDECCP,WBPCCPID
          GOTO      VALPCP55 IF NOT EQUAL
.
          GOTO      VALPCP60
.
VALPCP55
.
          GOTO      VALPCP98
.
VALPCP60  WRITE     HTMLFILE;"<RETURN_VALUE TYPE=SIMPLE>":
                             ONE:
                             "</RETURN_VALUE>"
.
          GOTO      VALPCP98
.
VALPCP95  
.         WRITE     HTMLFILE;"<RETURN_VALUE TYPE=ERROR>":
.                            "Invalid Participant for Eclipse - ":
.                            PTHFHGRP,"</RETURN_VALUE>"
          GOTO      VALPCP98
.
VALPCP96  
.         WRITE     HTMLFILE;"<RETURN_VALUE TYPE=ERROR>":
.                            "Invalid Capability - ":
.                            VALDECCP," for Participant - ",PTHFHGRP:
.                            " for Health Fund - ",VALDHLFN,"</RETURN_VALUE>"
          GOTO      VALPCP98
.
VALPCP97  
.         WRITE     HTMLFILE;"<RETURN_VALUE TYPE=ERROR>":
.                            "Invalid Health Fund for Eclipse - ":
.                            VALDHLFN,"</RETURN_VALUE>"
          GOTO      VALPCP98
.
VALPCP98  CALL      XMLEND00
.
VALPCP99  RETURN
.
.------------------------------------------------------------------------------
. gets a list of patcodes based on valdcode
.------------------------------------------------------------------------------
.
GTCATL00  CALL      XMLHED00
          BRANCH    EXIT,GTCATL99
.
          MOVE      ZERO,LINKVTYP           * Display all visit types (Cat CV)
.
          MATCH     SP70,VALDSITE           * Outpatients cat CV only
          GOTO      GTCATL05 IF EQUAL
.
          MATCH     SP70,VALDCTYP           * Outpatients cat CV only
          GOTO      GTCATL05 IF EQUAL
.
          PACK      KEY15,VALDSITE,VALDCTYP,SP70
          CALL      RSOTCVT1
          CALL      RKOTCVT1                * Check the clinic type for
          BRANCH    OVRCD,GTCATL05          * linked visit types
.
          MATCH     VALDSITE,OCVTSITE       * Same Site
          GOTO      GTCATL05 IF NOT EQUAL
.
          MATCH     VALDCTYP,OCVTCTYP       * Same Clinic Type
          GOTO      GTCATL05 IF NOT EQUAL
.
          MOVE      ONE,LINKVTYP            * Only display linked visit types
.
GTCATL05  IF        IBCNMHOS=1
            PACK      KEY10,USERID,SP70
            CALL      RDWBSE1
            BRANCH    OVRCD,GTCATL90
          ENDIF
.
          WRITE     HTMLFILE;"<RETURN_VALUE TYPE=SIMPLE>";
          WRITE     HTMLFILE;"["
.
          PACK      PTCDKEY2,VALDCODE,SP70
          CALL      RDSCODE2
GTCATL10  CALL      RDKCODE2
          BRANCH    OVRCD,GTCATL98
.
          MATCH     TCODE,VALDCODE
          GOTO      GTCATL98 IF NOT EQUAL
.
          MATCH     "I",PTCOACTV
          GOTO      GTCATL10 IF EQUAL
.
          IF        LINKVTYP=1
            PACK      KEY15,VALDSITE,VALDCTYP,ACODE,SP70
            CALL      RDOTCVT1          * Only display linked visit types
            BRANCH    OVRCD,GTCATL10
          ENDIF
.
          IF        IBCNMHOS=1
            MATCH    "1",PTCDHOSS
            IF       @EQUAL
              MATCH    SP70,ACODE
              IF       !@EQUAL
                PACK     KEY8,WBSEHOSP,TCODE,ACODE,SP70
                CALL     RDMLCOD1
                BRANCH   OVRCD,GTCATL10
              ENDIF
            ENDIF
          ENDIF
.
          PACK      KEY11,TCINDC1,TCINDC2,TCINDC3,TCINDC4,TCINDC5:
                          TCINDC6,TCINDC7,TCINDC8,TCINDC9,TCINDC10:
                          TCINDC11
.
          WRITE     HTMLFILE;"{tdesc:#"",TDESC,"#",":
                             "acode:#"",ACODE,"#",":
                             "indicators:#"",KEY11,"#",":
                             "thcsod:#"",THCSCOD,"#",":
                             "tcform6:#"",TCFORM6,"#"},"
.
          GOTO      GTCATL10
.
GTCATL90  WRITE     HTMLFILE;"{error:":
                             "#"Invalid User Id - ":
                             USERID,"#"}"
          GOTO      GTCATL98
.
GTCATL98  WRITE     HTMLFILE;"]</RETURN_VALUE>"
          CALL      XMLEND00
.
GTCATL99  RETURN
+
.*****************************************************************************
. OUTFIL00 - Check if the user id has an outpatienty site. If they do open
.            the correct outpatient files according to the site. If they do not
.            have a site make sure the default prefix of out is is used to
.            open the files.
.*****************************************************************************

OUTFIL00  PACK      KEY10,USERID,SP70
          CALL      RDWBSE1
          BRANCH    OVRCD,OUTFIL10
          MATCH     SP70,WBSESIT             * Does the user have a site
          GOTO      OUTFIL50 IF NOT EQUAL
.
OUTFIL10  MATCH     "out",CFILEPRE           * Is out currently open
          IF        !@EQUAL
            MOVE      "out",OSTFILE          * open default prefix of out
            MOVE      OSTFILE,CFILEPRE       * Save Current File Prefix
            CALL      OPNOUT00               * Open out Outpatient Files
          ENDIF
.
          MOVE      ZERO,EXIT
          GOTO      OUTFIL99
.
OUTFIL50  MOVE      WBSESIT,KEY6
          CALL      RDSITA1
          BRANCH    OVRCD,OUTFIL90           * error invalid site code
.
          MATCH     OSTFILE,CFILEPRE         * Save Current File Prefix
          IF        !@EQUAL
            MOVE      OSTFILE,CFILEPRE       * Save Current File Prefix
            CALL      OPNOUT00               * Open prefixed Outpatient Files
          ENDIF
.
          MOVE      ZERO,EXIT
          GOTO      OUTFIL99
.
OUTFIL90  MOVE      "Outpatient Site Invalid",WEBTITLE
          CALL      WEBERR00
          MOVE      ONE,EXIT
.
OUTFIL99  RETURN
.
.------------------------------------------------------------
. Open Outpatient Files
.------------------------------------------------------------
OPNOUT00  PACK      CFNAME,CFILEPRE,FILCVTA1  * Get the name of the CVTA1 file
          CLOSE     OUTCVTA1
          OPEN      OUTCVTA1,CFNAME           * Open the file
.
OPNOUT99  RETURN
+
.------------------------------------------------------------
. Get visit details to be used for a statistic admission
.------------------------------------------------------------
STAVIS00  CALL      XMLHED00
          BRANCH    EXIT,STAVIS99
.
          MATCH     "PRE",VALDTYPE          * Pre Admission
          GOTO      STAVIS10 IF EQUAL
.
          MATCH     "BOK",VALDTYPE          * Booking 
          GOTO      STAVIS20 IF EQUAL
.
          MATCH     "CUR",VALDTYPE          * Current IP
          GOTO      STAVIS10 IF EQUAL
.
          MATCH     "DIS",VALDTYPE          * Discharged IP
          GOTO      STAVIS10 IF EQUAL
.
          GOTO      STAVIS90
.
STAVIS10  PACK      KEY8,ADMISSNO,SP70
          CALL      RDMISS1
          BRANCH    OVRCD,STAVIS91
.
          PACK      KEY8,ADMISSNO,SP70
          CALL      RDPMVX11
          BRANCH    OVRCD,STAVIS91
.
          PACK      KEY8,ADMISSNO,SP70
          CALL      RDDSCH1
          IF        OVRCD<>1
            CALL      CLPATDSC
          ENDIF
.
          MOVE      SP70,ASRCIND3
          MATCH     SP70,ASRCE              * Admission source ind 3
          IF        !@EQUAL
            PACK      KEY5,ANSS,SP1,ASRCE,SP70
            CALL      RDCODE1
            IF        OVRCD<>1
              MOVE      TCINDC3,ASRCIND3  
            ENDIF
          ENDIF
.
          WRITE     HTMLFILE;"<RETURN_VALUE TYPE=SIMPLE>":
                             AADMNO,"|",AURNO,"|",ASTAT,"|":          * 2
                             ADATE,"|",ATIME,"|",AWARD,"|":           * 5
                             ABED,"|",ADOCTR,"|",ADOCTA,"|":          * 8 
                             ADOCTL,"|",ASRCE,"|",ATYPE,"|":          * 11
                             ACLSS,"|",ACARE,"|",AFUNDH,"|":          * 14
                             AFNDTB,"|",AFNDMM,"|",AELIG,"|":         * 17 
                             AVISIT,"|",AALERG,"|",AILLN,"|":         * 20
                             ADIAG1,"|",ADIAG2,"|",ADOCTT,"|":        * 23
                             ACLSSFT,"|",AMBS,"|",ACLAIM,"|":         * 26
                             ADIET,"|",APLOCCR,"|",ASTAY,"|":         * 29
                             ADYHOSP,"|",ACOMM1,"|",ACOMM2,"|":       * 32
                             APLUR,"|",PTMIPDRG,"|",PTMIXWRD,"|":     * 35
                             PTMIPCMX,"|",PTMICMXP,"|",PTMIEBED,"|":  * 38
                             PMVXDOCA,"|",PMVXDOCT,"|",PMVXCSNR,"|":  * 41
                             PMVXPIND,"|",PMVXVLOC,"|",PMVXCFSG,"|":  * 44
                             PMVXINGP,"|",PMVXCPTH,"|",PMVXRHC1,"|":  * 47
                             PMVXRH1G,"|",PMVXRH1C,"|",PMVXABRG,"|":  * 50
                             PMVXCADM,"|",PMVXIRAD,"|",PMVXIDUS,"|":  * 53
                             PMVXCRAV,"|",PMVXRCCT,"|",PMVXAPWD,"|":  * 56
                             PMVXPOWD,"|",PMVXPOBD,"|",PMVXPSTY,"|":  * 59
                             PMVXVALW,"|",PMVXPALW,"|",PMVXINDC,"|":  * 62
                             PMVXMDAV,"|",PMVXMHLS,"|",PMVXPICD,"|":  * 65
                             PMVXRMOR,"|",PMVXASUT,"|",PMVXELPS,"|":  * 68
                             PMVXEMPL,"|",PMVXFINP,"|",PMVXOCCP,"|":  * 71
                             PMVXPALC,"|",PMVXPPAL,"|",PMVXPPPT,"|":  * 74
                             PMVXPSOS,"|",PMVXPYSP,"|",PMVXQLDB,"|":  * 77
                             PMVXREAD,"|",PMVXUDIN,"|",PMVXUREA,"|":  * 80
                             PMVXUSAC,"|",PMVXUVTH,"|",PMVXINTR,"|":  * 83
                             PMVXLNG1,"|",PMVXMHOS,"|",PMVXPRMI,"|":  * 86
                             PMVXPRAI,"|",PMVXPRES,"|",PMVXUITR,"|":  * 89
                             PMVXMLOC,"|",PMVXPACC,"|",PMVXEDU1,"|":  * 92
                             PMVXPRGM,"|",PMVXCONF,"|",PMVXEOCL,"|":  * 95
                             PMVXSLOC,"|",PMVXSCLI,"|",PMVXSTRA,"|":  * 98 
                             PMVXQASN,"|",PMVXHFGN,"|",PMVXHFSN,"|":  * 101
                             PMVXFUPI,"|",PMVXPOEC,"|",PMVXPGID,"|":  * 104
                             PMVXPILC,"|",PMVXFVIO,"|",PMVXFNDM,"|":  * 107
                             PMVXUDF6,"|",PMVXUDF7,"|",PMVXUD10,"|":  * 110
                             PMVXUD11,"|",PMVXUD12,"|",PMVXUD13,"|":  * 113
                             PMVXUD14,"|",PMVXUD15,"|",PMVXTEAM,"|":  * 116
                             PMVXNWHC,"|",PMVXEDDT,"|",PMVXPHLD,"|":  * 119
                             PMVXPLOC,"|",PMVXDFLG,"|",PMVXFSRC,"|":  * 122
                             PMVXCONM,"|",PMVXCPDD,"|",PMVXCNID,"|":  * 125
                             PMVXCNDT,"|",PMVXCASE,"|",PMVXEAFL,"|":  * 128
                             PMVXADMP,"|",PMVXCONO,"|",PMVXMEDH,"|":  * 131
                             ASRCIND3,"|",PTMILSDN,"|",PTMIOGNO,"|":  * 134
                             PTDSLSDN,"|":
                             "</RETURN_VALUE>"
          GOTO      STAVIS98
.
STAVIS20  PACK      KEY8,ADMISSNO,SP70
          CALL      RDBKREC1
          BRANCH    OVRCD,STAVIS91
.
          PACK      KEY8,ADMISSNO,SP70
          CALL      RDBKRX11
          BRANCH    OVRCD,STAVIS91
.
          WRITE     HTMLFILE;"<RETURN_VALUE TYPE=SIMPLE>":        
                             BKREBOOK,"|",BKREURNO,"|",BKRESTAT,"|": * 2
                             BKREADOC,"|",BKRESDOC,"|",BKREEDAT,"|": * 5
                             BKREATIM,"|",BKREPDAT,"|",BKREPTIM,"|": * 8
                             BKREADAT,"|",BKRETYPE,"|",BKREACCM,"|": * 11
                             BKREPROC,"|",BKRECNT,"|",BKREWARD,"|":  * 14
                             BKREEBED,"|",BKRECLSS,"|",BKREATYP,"|": * 17
                             BKREDEPT,"|",BKRETDOC,"|",BKRECLMT,"|": * 20
                             BKRERFGP,"|",BKREGPPC,"|",BKRERESI,"|": * 23
                             BKREEATY,"|",BKREGPPT,"|",BKREDOFR,"|": * 26
                             BKREELOS,"|",BKRXPOWD,"|",BKRXADWD,"|": * 29
                             BKRXUDF5,"|",BKRXUFF1,"|",BKRXUFF2,"|": * 32
                             BKRXUFF3,"|",BKRXUFF4,"|",BKRXASRC,"|": * 35
                             BKRXPOBD,"|",BKRXDIET,"|",BKRXTRAN,"|": * 38
                             BKRXATRN:
                             "</RETURN_VALUE>"
          GOTO      STAVIS98
.
STAVIS90  WRITE     HTMLFILE;"<RETURN_VALUE TYPE=ERROR>":
                             "Invalid search type - ",VALDTYPE:
                             "</RETURN_VALUE>"
          GOTO      STAVIS98
.
STAVIS91  WRITE     HTMLFILE;"<RETURN_VALUE TYPE=ERROR>":
                             "Invalid visit number - ",ADMISSNO:
                             "</RETURN_VALUE>"
          GOTO      STAVIS98
.
STAVIS98  CALL      XMLEND00
STAVIS99  RETURN
+
.------------------------------------------------------------
. Update patelgaf Hospital Check
.------------------------------------------------------------
VALELG00  CALL      XMLHED00
          BRANCH    EXIT,VALELG99
.
VALELG20  MOVE      VALDCODE,KEY8
          CALL      RDPTELG1
          BRANCH    OVRCD,VALELG90
.
          MOVE      VALDCOD2,PTELCMPL
.
          MATCH     SP70,VALDCOD3
          IF        !@EQUAL
            MOVE      VALDCOD3,PTELHSTM 
          ENDIF
.
          CALL      UPPTELG1
.
          WRITE     HTMLFILE;"<RETURN_VALUE TYPE=SIMPLE>":
                             ONE:
                             "</RETURN_VALUE>"
          GOTO      VALELG98
.
VALELG90  WRITE     HTMLFILE;"<RETURN_VALUE TYPE=ERROR>":
                             "Admission not in patelgaf - ":
                             KEY8,"</RETURN_VALUE>"
          GOTO      VALELG98
.
VALELG98  CALL      XMLEND00
VALELG99  RETURN
+
.------------------------------------------------------------
. Update presenting illness and mbs code for pre admissions
.------------------------------------------------------------
VALOEC00  CALL      XMLHED00
          BRANCH    EXIT,VALOEC99
.
VALOEC20  PACK      KEY8,VALDADMN,SP70
          CALL      RDPTMIS1
          BRANCH    OVRCD,VALOEC90
.
          COMPARE   ONE,ASTAT
          GOTO      VALOEC91 IF NOT EQUAL
.
          MOVE      VALDCOD2,AMBS
.
          CALL      UPPTMIS1
.
.
          PACK      KEY8,VALDADMN,SP70
          CALL      RDPMVX11
          BRANCH    OVRCD,VALOEC92
.
          MOVE      VALDCODE,PMVXPILC
.
          CALL      UPPMVX11
.
.          PACK      KEY16,AURNO,SP70
.          CALL      RSPMELF2
.VALOEC30  CALL      RKPMELF2
.          BRANCH    OVRCD,VALOEC80
..
.          MATCH     AURNO,PMEFURNO
.          GOTO      VALOEC80 IF NOT EQUAL
..
.          MATCH     VALDADMN,PMEFVISN
.          GOTO      VALOEC30 IF NOT EQUAL
..
.          MOVE      VALDCOD3,DIM3
..
.          MATCH     DIM3,PMEFCNTR
.          GOTO      VALOEC30 IF NOT EQUAL
..
.          MOVE      VALDCODE,PMEFPRIC
.          MOVE      VALDCOD2,PMEFPRIM
..
.          CALL      UPPMELF2
.
VALOEC80  WRITE     HTMLFILE;"<RETURN_VALUE TYPE=SIMPLE>":
                             ONE:
                             "</RETURN_VALUE>"
          GOTO      VALOEC98
.
VALOEC90  WRITE     HTMLFILE;"<RETURN_VALUE TYPE=ERROR>":
                             "Admission record not found.":
                             "</RETURN_VALUE>"
          GOTO      VALOEC98
.
VALOEC91  WRITE     HTMLFILE;"<RETURN_VALUE TYPE=ERROR>":
                             "Visit must be a pre admission..":
                             "</RETURN_VALUE>"
          GOTO      VALOEC98
.
VALOEC92  WRITE     HTMLFILE;"<RETURN_VALUE TYPE=ERROR>":
                             "Visit Extension record not found.":
                             "</RETURN_VALUE>"
          GOTO      VALOEC98
.
VALOEC98  CALL      XMLEND00
VALOEC99  RETURN
+
.------------------------------------------------------------
. Update OEC Consent in pmsvx1
.------------------------------------------------------------
VALOCC00  CALL      XMLHED00
          BRANCH    EXIT,VALOCC99
.
VALOCC20  PACK      KEY8,VALDADMN,SP70
          CALL      RDPMVX11
          BRANCH    OVRCD,VALOCC92
.
          MOVE      VALDCODE,PMVXPOEC
.
          CALL      UPPMVX11
.
          WRITE     HTMLFILE;"<RETURN_VALUE TYPE=SIMPLE>":
                             ONE:
                             "</RETURN_VALUE>"
          GOTO      VALOCC98
.
VALOCC92  WRITE     HTMLFILE;"<RETURN_VALUE TYPE=ERROR>":
                             "Visit Extension record not found.":
                             "</RETURN_VALUE>"
          GOTO      VALOCC98
.
VALOCC98  CALL      XMLEND00
VALOCC99  RETURN
+
.------------------------------------------------------------------------------
. Gets a postal address contact from new contact table pmscexaf
.------------------------------------------------------------------------------
GNPADD00  CALL      XMLHED00
          BRANCH    EXIT,GNPADD99
.
          MATCH     "1",PTCNNEWC
          GOTO      GNPADD98 IF NOT EQUAL
.
          PACK      KEY14,URNUMBER,Z70 
          CALL      RSPMCEX1
GNPADD10  CALL      RPPMCEX1
          BRANCH    OVRCD,GNPADD90
.
          MATCH     URNUMBER,PMCEURNO       * Same urnumber?
          GOTO      GNPADD90 IF NOT EQUAL   * No, exit
.
          MOVE      "tc",CATEGORY
          MOVE      PMCETYPE,CODE
          CALL      GETCOD00
.
          MATCH     "I",PTCOACTV            * Ignore inactive
          GOTO      GNPADD10 IF EQUAL
.
          MATCH     "2",TCINDC1             * Postal Address?
          GOTO      GNPADD10 IF NOT EQUAL   * No, ignore
.
          MATCH     "1",PMCEACTV            * Check if inacive in pmscexaf 
          GOTO      GNPADD10 IF EQUAL
.
          WRITE     HTMLFILE;"<RETURN_VALUE TYPE=SIMPLE>":
                              ONE,"|",PMCEADD1,"|",PMCEADD2,"|",PMCEADD3:
                              "|",PMCEADD4,"|",PMCEPOST:
                             "</RETURN_VALUE>"
          GOTO      GNPADD98
.
GNPADD90  WRITE     HTMLFILE;"<RETURN_VALUE TYPE=SIMPLE>":
                              ZERO,"|":
                             "</RETURN_VALUE>"
          GOTO      GNPADD98
.
GNPADD98  CALL      XMLEND00
GNPADD99  RETURN
.
.------------------------------------------------------------
. Validate/Insert patient attribute for type = 109  
.------------------------------------------------------------
PATATR00  CALL      XMLHED00
          BRANCH    EXIT,PATATR99
.
PATATR10  MATCH     "V",VALDTYPE           * validate for update 
          GOTO      PATATR20 IF EQUAL
.
          MATCH     "I",VALDTYPE           * Insert new row
          GOTO      PATATR30 IF EQUAL
.
          MATCH     "D",VALDTYPE           * Delete row for type = 109
          GOTO      PATATR40 IF EQUAL
.
          MATCH     "A",VALDTYPE           * Delete row for a key
          GOTO      PATATR50 IF EQUAL
.
          GOTO      PATATR91 
.
PATATR20  CALL      VPTATR00 
          GOTO      PATATR98
.
PATATR30  CALL      IPTATR00 
          GOTO      PATATR98
.
PATATR40  CALL      DPTATR00
          GOTO      PATATR98
.
PATATR50  CALL      DPTATA00
          GOTO      PATATR98
.
PATATR91  WRITE     HTMLFILE;"<RETURN_VALUE TYPE=ERROR>":
                             "Invalid type - ",VALDTYPE:
                             "</RETURN_VALUE>"
          GOTO      PATATR98
.
PATATR98  CALL      XMLEND00
.
PATATR99  RETURN
.
.------------------------------------------------------------
. Validate Locking patient attribute for type = 109
.------------------------------------------------------------
VPTATR00  MOVE      "109",KEY3
          PACK      KEY35,VALDURNO,VALDADMN,KEY3,SP70
          CALL      RSPTATR3
          CALL      RKPTATR3
          BRANCH    OVRCD,VPTATR90
.
          MATCH     VALDURNO,PTARURNO
          GOTO      VPTATR90 IF NOT EQUAL
.
          MATCH     VALDADMN,PTARVISN
          GOTO      VPTATR90 IF NOT EQUAL
.
          MATCH     KEY3,PTARTYPE
          GOTO      VPTATR90 IF NOT EQUAL
.
          PACK      KEY10,PTARCUSR
          CALL      RDWBSE1
          IF        OVRCD = 1
            MOVE      KEY10,WBSENAM
          ENDIF
.
          UNPACK    PTARDATE,CCENT,CYEAR,CMON,CDAY
          REP       " 0",CYEAR
          MOVE      CMON,F2
          LOAD      MTHNAM3,F2,JAN,FEB,MAR,APR,MAY,JUN,JUL,AUG,SEP,OCT,NOV,DEC
.
          PACK      DISPDATE,CDAY,SP1,MTHNAM3,SP1,CCENT,CYEAR
.
          WRITE     HTMLFILE;"<RETURN_VALUE TYPE=SIMPLE>":
                              ONE,"|",WBSENAM:
                              "|",DISPDATE," at ",PTARTIME:
                             "</RETURN_VALUE>"
          GOTO      VPTATR99

.
VPTATR90  WRITE     HTMLFILE;"<RETURN_VALUE TYPE=SIMPLE>":
                              ZERO,"|":
                             "</RETURN_VALUE>"
          GOTO      VPTATR99
.
VPTATR99  RETURN
.
.------------------------------------------------------------
. Insert Locking patient attribute for type = 109
.------------------------------------------------------------
IPTATR00  CALL      CLPATATR
          MOVE      VALDURNO,PTARURNO
          MOVE      VALDADMN,PTARVISN
.
          CLOCK     TIME,CURRTIME
.
          MOVE      CURRDATE,PTARDATE
          MOVE      CURRTIME,PTARTIME
          MOVE      "109",PTARTYPE
          MOVE      CURRDATE,PTARCDTE
          MOVE      CURRTIME,PTARCTME
          MOVE      CURRDATE,PTARUDTE
          MOVE      CURRTIME,PTARUTME
          MOVE      USERID,PTARCUSR
.
          PACK      KEY35,PTARURNO,PTARDATE,PTARTIME,PTARTYPE,PTARVISN,SP70
.
          CALL      WRPTATR1            
          BRANCH    OVRCD,IPTATR91
.
IPTATR90  WRITE     HTMLFILE;"<RETURN_VALUE TYPE=SIMPLE>":
                             ZERO,"|",PTARURNO,"/":
                             PTARDATE,"/",PTARTIME,"/":
                             PTARTYPE,"/",PTARVISN,"/":
                             "</RETURN_VALUE>"
          GOTO      IPTATR99
.
IPTATR91  WRITE     HTMLFILE;"<RETURN_VALUE TYPE=ERROR>":
                             "Cannot Insert patatraf row":
                             "</RETURN_VALUE>"
          GOTO      IPTATR99 
.
IPTATR99  RETURN
.
.------------------------------------------------------------
. Delete Locking patient attribute for type = 109
.------------------------------------------------------------
DPTATR00  MOVE      "109",KEY3
          PACK      KEY35,VALDURNO,VALDADMN,KEY3,SP70
          CALL      RSPTATR3
          CALL      RKPTATR3
          BRANCH    OVRCD,DPTATR90
.
          MATCH     VALDURNO,PTARURNO
          GOTO      DPTATR90 IF NOT EQUAL
.
          MATCH     VALDADMN,PTARVISN
          GOTO      DPTATR90 IF NOT EQUAL
.
          MATCH     KEY3,PTARTYPE
          GOTO      DPTATR90 IF NOT EQUAL
.
          PACK      KEY35,PTARURNO,PTARDATE,PTARTIME,PTARTYPE,PTARVISN,SP70
          CALL      DEPTATR1
          BRANCH    OVRCD,DPTATR91
.
DPTATR90  WRITE     HTMLFILE;"<RETURN_VALUE TYPE=SIMPLE>":
                             ZERO,"|",PTARURNO,"/":
                             PTARDATE,"/",PTARTIME,"/":
                             PTARTYPE,"/",PTARVISN,"/":
                             "</RETURN_VALUE>"
          GOTO      DPTATR99
.
DPTATR91  WRITE     HTMLFILE;"<RETURN_VALUE TYPE=ERROR>":
                             "Cannot Delete patatraf row":
                             "</RETURN_VALUE>"
          GOTO      DPTATR99
.
DPTATR99  RETURN
.
.------------------------------------------------------------
. Delete Locking patient attribute for a given key
.------------------------------------------------------------
DPTATA00  PACK      KEY35,VALDURNO,VALDDATE,VALDTIME,VALDJTYP,VALDADMN,SP70
          CALL      RDPTATR1
          BRANCH    OVRCD,DPTATA90
.
          CALL      DEPTATR1
.
DPTATA90  WRITE     HTMLFILE;"<RETURN_VALUE TYPE=SIMPLE>":
                             ZERO,"|",VALDURNO,"/":
                             VALDDATE,"/",VALDTIME,"/":
                             VALDJTYP,"/",VALDADMN,"/":
                             "</RETURN_VALUE>"
          GOTO      DPTATA99
.
DPTATA99  RETURN
.
.---------------------------------------------------------------
. Validate HCP, Practice and Linked HCP 
.---------------------------------------------------------------
VALHCX00  CALL      XMLHED00
          BRANCH    EXIT,VALHCX99
.
          CALL      CLPMSHCP
          CALL      CLPMSHCG
          CALL      CLPMSHCL
.
          PACK      VALDCODE,VALDCODE,SP70
          PACK      VALDDCTR,VALDDCTR,SP70
.
          MATCH     SP70,VALDDCTR                     * check if GP empty
          GOTO      VALHCX60 IF EQUAL
.
          PACK      KEY10,VALDDCTR,SP70
          CALL      RDPMHCP1
          BRANCH    OVRCD,VALHCX90        
.     
          MATCH     "0",PMHCSTTS              * active gp ?
          GOTO      VALHCX90 IF NOT EQUAL
.
          MATCH     SP70,PMHCEDAT
          IF        !@EQUAL
            MATCH     CURRDATE,PMHCEDAT       * end date check ?
            IF        @LESS
              GOTO      VALHCX91       
            ENDIF                           
          ENDIF
.
VALHCX60  MATCH     SP70,VALDCODE                     * check if practice empty
          GOTO      VALHCX80 IF EQUAL
.     
          PACK      KEY12,VALDCODE,SP70
          CALL      RSPMHCG1
          CALL      RKPMHCG1
          BRANCH    OVRCD,VALHCX92
.
          MATCH     PMHGPRAC,VALDCODE                 * valid practice ?
          GOTO      VALHCX92 IF NOT EQUAL
.
          MATCH     "0",PMHGSTTS                      * active practice ?
          GOTO      VALHCX92 IF NOT EQUAL
.				      
          MATCH     SP70,PMHGDSDT
          IF        !@EQUAL
            MATCH     CURRDATE,PMHGDSDT               * dissolve date check ?
            IF        @LESS
              GOTO      VALHCX93       
            ENDIF                           
          ENDIF
.
          MATCH     SP70,VALDDCTR                     * check gp 
          GOTO      VALHCX80 IF EQUAL
.
          PACK      KEY20,VALDDCTR,VALDCODE,SP70
          CALL      RDPMHCL1
          BRANCH    OVRCD,VALHCX94
.
.         MATCH     PMHLHCPC,VALDDCTR               * valid linked hcp ?
.         GOTO      VALHCX94 IF NOT EQUAL
.
          MATCH     "0",PMHLSTAT                    * active linked hcp ?
          GOTO      VALHCX94 IF NOT EQUAL
.
          MATCH     SP70,PMHLLPDT
          IF        !@EQUAL
            MATCH     CURRDATE,PMHLLPDT             * date left practice check ?
            IF        @LESS
              GOTO      VALHCX95       
            ENDIF                           
          ENDIF
.
VALHCX80  WRITE     HTMLFILE;"<RETURN_VALUE TYPE=SIMPLE>":  
                             "0":
                             "</RETURN_VALUE>"
          GOTO      VALHCX98
.
VALHCX90  WRITE     HTMLFILE;"<RETURN_VALUE TYPE=SIMPLE>":  
                             "1":
                             "</RETURN_VALUE>"
          GOTO      VALHCX98
.
VALHCX91  WRITE     HTMLFILE;"<RETURN_VALUE TYPE=SIMPLE>":   
                             "2":
                             "</RETURN_VALUE>"
          GOTO      VALHCX98
.
VALHCX92  WRITE     HTMLFILE;"<RETURN_VALUE TYPE=SIMPLE>":   
                             "3":
                             "</RETURN_VALUE>"
          GOTO      VALHCX98
.
VALHCX93  WRITE     HTMLFILE;"<RETURN_VALUE TYPE=SIMPLE>":   
                             "4":
                             "</RETURN_VALUE>"
          GOTO      VALHCX98
.
VALHCX94  WRITE     HTMLFILE;"<RETURN_VALUE TYPE=SIMPLE>":  
                             "5":
                             "</RETURN_VALUE>"
          GOTO      VALHCX98
.
VALHCX95  WRITE     HTMLFILE;"<RETURN_VALUE TYPE=SIMPLE>":  
                             "6":
                             "</RETURN_VALUE>"
          GOTO      VALHCX98
.
VALHCX98  CALL      XMLEND00
.
VALHCX99  RETURN
.
.------------------------------------------------------------
. Validate patient attribute for urnumber/admissno/type
.------------------------------------------------------------
VAPATR00  CALL      XMLHED00
          BRANCH    EXIT,VPTATR99
.
VAPATR10  PACK      KEY35,VALDURNO,VALDADMN,VALDJTYP,SP70
          CALL      RSPTATR3
          CALL      RKPTATR3
          BRANCH    OVRCD,VAPATR90
.
          MATCH     VALDURNO,PTARURNO
          GOTO      VAPATR90 IF NOT EQUAL
.
          MATCH     VALDADMN,PTARVISN
          GOTO      VAPATR90 IF NOT EQUAL
.
          MATCH     VALDJTYP,PTARTYPE
          GOTO      VAPATR90 IF NOT EQUAL
.
          WRITE     HTMLFILE;"<RETURN_VALUE TYPE=SIMPLE>":
                              ONE,"|":
                             "</RETURN_VALUE>"
          GOTO      VAPATR98

.
VAPATR90  WRITE     HTMLFILE;"<RETURN_VALUE TYPE=SIMPLE>":
                              ZERO,"|":
                             "</RETURN_VALUE>"
          GOTO      VAPATR98
.
VAPATR98  CALL      XMLEND00
.
VAPATR99  RETURN
.
.------------------------------------------------------------
. Check if this visit number has an Alternate Visit Id/Type
.------------------------------------------------------------
ALTVIS00  CALL      XMLHED00
          BRANCH    EXIT,ALTVIS99
.
          PACK      KEY8,ADMISSNO,SP70
          CALL      RDIBALV1
          IF        OVRCD=1
            MOVE      SP70,IBAVAVIS         * Alternate Visit ID
            MOVE      SP70,IBAVTYPE         * Record Type
          ENDIF
.
          WRITE     HTMLFILE;"<RETURN_VALUE TYPE=SIMPLE>":
                              IBAVTYPE,"|",IBAVAVIS,"|":
                             "</RETURN_VALUE>"
          GOTO      ALTVIS98
.
ALTVIS98  CALL      XMLEND00
.
ALTVIS99  RETURN
+
.------------------------------------------------------------------------------
. Validate Value Set Id and Code against pmsvscaf
.------------------------------------------------------------------------------
GVSCDS00  CALL      XMLHED00
          BRANCH    EXIT,GVSCDS99
.
          MOVE      VALDCODE,DIM3
          MOVE      VALDCOD2,DIM30      
          PACK      KEY33,DIM3,DIM30,SP70
          CALL      RDPMVSC1
          BRANCH    OVRCD,GVSCDS90
.
          MATCH     "ECC",VALDCODE
          IF        @EQUAL
            WRITE     HTMLFILE;"<RETURN_VALUE TYPE=SIMPLE>":
                               PMVCCODE,"|",PMVCPTRM,"|",PMVCFNAM: 
                               "</RETURN_VALUE>" 
.
          ELSE
            WRITE     HTMLFILE;"<RETURN_VALUE TYPE=SIMPLE>":
                               PMVCCODE,"|",PMVCPTRM:
                               "</RETURN_VALUE>"
          ENDIF
.
          GOTO      GVSCDS98
.
GVSCDS90  WRITE     HTMLFILE;"<RETURN_VALUE TYPE=ERROR>":
                             "Invalid Code - ":
                              DIM30,"</RETURN_VALUE>"
          GOTO      GVSCDS98
.
GVSCDS98  CALL      XMLEND00
GVSCDS99  RETURN
+
.------------------------------------------------------------------------------
. Validate  Hospital, Claim Code,Health Fund, HF level and reason for admission
.           and the start date against patbdeaf
.------------------------------------------------------------------------------
VBDEF000  CALL      XMLHED00
          BRANCH    EXIT,VBDEF999
.
          MATCH     "1",PTCNBDEF
          GOTO      VBDEF980 IF NOT EQUAL
.
          MOVE      ZERO,OVRCD
          TRAP      OVERCOND IF IO
          OPEN      PATBDEA1,"patbdeaf"
          TRAPCLR   IO
          BRANCH    OVRCD,VBDEF910
.
          PACK      DIM30,VALDCODE,SP70
.
          MATCH     SP70,VALDADMN               * Visit number not available
          GOTO      VBDEF100 IF EQUAL         
          GOTO      VBDEF100 IF EOS           
.
          PACK      KEY8,VALDADMN,SP70          * Read pmsvx1af to get hosp
          CALL      RDPMVX11
          BRANCH    OVRCD,VBDEF100              * Visit must be a booking
.
          PACK      KEY58,PMVXMHOS,VALCLAIM,VALDFUND,VALDHFTB,DIM30:
                          VALDDATE,SP70
          GOTO      VBDEF200
.
VBDEF100  COMPARE   ZERO,IBCNMHOS                * Not multi hospital
          GOTO      VBDEF150 IF EQUAL
.
          PACK      KEY10,USERID,SP70
          CALL      RDWBSE1                      * Read user id
          BRANCH    OVRCD,VBDEF150
.
          MATCH     SP70,WBSEHOSP                * Users hospital blank
          GOTO      VBDEF150 IF EQUAL
.
          PACK      KEY58,WBSEHOSP,VALCLAIM,VALDFUND,VALDHFTB,DIM30:
                          VALDDATE,SP70
          GOTO      VBDEF200
.
VBDEF150  PACK      KEY58,SP3,VALCLAIM,VALDFUND,VALDHFTB,DIM30:
                          VALDDATE,SP70
          GOTO      VBDEF200
.
VBDEF200  MOVE      KEY58,SAVKEY50
          CALL      RDPTBDE1              * Direct read on patbdeaf
          BRANCH    OVRCD,VBDEF300        
          GOTO      VBDEF800                       
.
VBDEF300  PACK      KEY58,SAVKEY50,SP70
          CALL      RPPTBDE1              * Read previous record on patbdeaf  
          BRANCH    OVRCD,VBDEF900
.
          PACK      KEY50,PTBEHOSP,PTBECLMC,PTBEHFND,PTBEHFTB,PTBEVSID,SP70
          MATCH     KEY50,SAVKEY50
          GOTO      VBDEF900 IF NOT EQUAL
.
          MATCH     PTBESDTE,VALDDATE     * Effective Start Date => Adm date?
          GOTO      VBDEF900 IF LESS      * Yes 
.
          MATCH     SP8,PTBEEDTE
          IF        !@EQUAL
            MATCH     VALDDATE,PTBEEDTE   * Adm date => Effective To Date?
            GOTO      VBDEF900 IF LESS    * Yes 
          ENDIF
.
          GOTO      VBDEF800              * Match found
.
.-------- Match found - output data
VBDEF800  MOVE      SP70,PTCDLDES
          MATCH     SP70,PTBEALER
          IF        !@EQUAL
            PACK      KEY5,CATaz,PTBEALER,SP70
            CALL      RDCODE1
          ENDIF
.
          WRITE     HTMLFILE;"<RETURN_VALUE TYPE=SIMPLE>":
                             PTBEADMN,"|",PTBECPAY,"|",PTBECSMX,"|":  *2
                             PTBEDRGC,"|",PTBEDRGV,"|",PTBEPRGM,"|":  *5
                             PTBETLOS,"|",PTBECARE,"|",PTBEPILL,"|":  *8
                             PTBEMBSI,"|",PTBEILOS,"|",PTCDLDES:      *11
                             "</RETURN_VALUE>"
          GOTO      VBDEF980
.
.-------  Match NOT found - output error
VBDEF900  WRITE     HTMLFILE;"<RETURN_VALUE TYPE=ERROR>":
                             "Billing Default record not found":
                             "</RETURN_VALUE>"
          GOTO      VBDEF980
.
.-------  File NOT found - output error
VBDEF910  WRITE     HTMLFILE;"<RETURN_VALUE TYPE=ERROR>":
                             "Billing Default file not found":
                             "</RETURN_VALUE>"
          GOTO      VBDEF980
.
VBDEF980  CALL      XMLEND00
VBDEF999  RETURN
.
.------------------------------------------------------------
. Get a common system parameter value from comparaf
.------------------------------------------------------------
CMPAR000  CALL      XMLHED00
          BRANCH    EXIT,CMPAR999
.
CMPAR100  CALL      CLCOMPAR                     * Clear file vars
.
          MOVE      ZERO,OVRCD
          TRAP      OVERCOND IF IO
          OPEN      COMPARA1,"comparaf"          * File create during live
          TRAPCLR   IO                           * V11.00 release
          BRANCH    OVRCD,CMPAR500

          PACK      KEY11,VALDHOSP,VALDCODE,SP70
          CALL      RDCMPAR1                     * Check hospital value
          IF        OVRCD=1
            MATCH     SP70,VALDHOSP
            IF        !@EQUAL
              PACK      KEY11,SP3,VALDCODE,SP70  * Check default no hospital
              CALL      RDCMPAR1
              IF        OVRCD=1
                CALL      CLCOMPAR               * Clear file vars
              ELSE
                MATCH     "0",CMPAACTV           * check for active ones
                IF        !@EQUAL
                  CALL      CLCOMPAR               * Clear file vars
                ENDIF
              ENDIF
            ENDIF
          ELSE
            MATCH      "0",CMPAACTV             * check for active ones
            GOTO       CMPAR500 IF EQUAL
.
            MATCH     SP70,VALDHOSP
            IF        !@EQUAL
              PACK      KEY11,SP3,VALDCODE,SP70  * Check default no hospital
              CALL      RDCMPAR1
              IF        OVRCD=1
                CALL      CLCOMPAR               * Clear file vars
              ELSE
                MATCH     "0",CMPAACTV           * check for active ones
                IF        !@EQUAL
                  CALL      CLCOMPAR               * Clear file vars
                ENDIF
              ENDIF
            ENDIF
          ENDIF
.
CMPAR500  WRITE     HTMLFILE;"<RETURN_VALUE TYPE=SIMPLE>":
                              CMPAVALU,"|":
                             "</RETURN_VALUE>"
.
          CALL      XMLEND00
.
CMPAR999  RETURN
.
.------------------------------------------------------------
. Validate Category R5 FACEM / Non FACEM Emergency Doctors
.------------------------------------------------------------
VALCR500  CALL      XMLHED00
          BRANCH    EXIT,VALCR599
.
VALCR520  MATCH     SP70,VALDCODE
          GOTO      VALCR592 IF EQUAL
.
          PACK      KEY10,VALDCODE,SP70
          CALL      RDPMHCP1
          BRANCH    OVRCD,VALCR592
.
          MATCH     SP70,PMHCUDF1
          GOTO      VALCR592 IF EQUAL
.
          PACK      KEY5,ANSR,FIVE,PMHCUDF1
          CALL      RDCODE1
          BRANCH    OVRCD,VALCR592
.
          WRITE     HTMLFILE;"<RETURN_VALUE TYPE=SIMPLE>":
                             TCINDC1:
                             "</RETURN_VALUE>"
          GOTO      VALCR598
.
VALCR592  WRITE     HTMLFILE;"<RETURN_VALUE TYPE=SIMPLE>":
                             SP1:
                             "</RETURN_VALUE>"
          GOTO      VALCR598
.
VALCR598  CALL      XMLEND00
VALCR599  RETURN
+
.------------------------------------------------------------
. Validate Service Doctor Emr History Date/Time
.------------------------------------------------------------
VALDDT00  CALL      XMLHED00
          BRANCH    EXIT,VALDDT99
.
VALDDT20  MATCH     SP70,VALDADMN
          GOTO      VALDDT92 IF EQUAL
.
          MATCH     SP70,VALDCODE
          GOTO      VALDDT92 IF EQUAL 
.
          PACK      KEY32,VALDADMN,VALDCODE,SP70 
          CALL      RSEMHIS2
VALDDT30  CALL      RKEMHIS2
          BRANCH    OVRCD,VALDDT92
.
          MATCH     VALDADMN,EMHIVIS
          GOTO      VALDDT92 IF NOT EQUAL
.
          MOVE      VALDCODE,DIM10
          MATCH     DIM10,EMHIDOC
          GOTO      VALDDT92 IF NOT EQUAL
.
          MATCH     "ALDOC",EMHIUPT
          GOTO      VALDDT30 IF NOT EQUAL
.
          MATCH     SP70,EMHIDSD
          GOTO      VALDDT30 IF EQUAL
.
          MATCH     SP70,EMHIDST
          GOTO      VALDDT30 IF EQUAL
.
          UNPACK    EMHIDSD,CCENT,CYEAR,CMON,CDAY
          REP       " 0",CYEAR
          MOVE      CMON,F2
          LOAD      MTHNAM3,F2,JAN,FEB,MAR,APR,MAY,JUN,JUL,AUG,SEP,OCT,NOV,DEC
          PACK      DISPDATE,CDAY,SP1,MTHNAM3,SP1,CCENT,CYEAR 
.
          UNPACK    EMHIDST,DIM2,DIM2A,DIM2B
.
          WRITE     HTMLFILE;"<RETURN_VALUE TYPE=SIMPLE>":
                             DISPDATE,"|",DIM2,":",DIM2A,":",DIM2B:
                             "</RETURN_VALUE>"
          GOTO      VALDDT98
.
VALDDT92  WRITE     HTMLFILE;"<RETURN_VALUE TYPE=SIMPLE>":
                             SP1:
                             "</RETURN_VALUE>"
          GOTO      VALDDT98
.
VALDDT98  CALL      XMLEND00
VALDDT99  RETURN
+
.------------------------------------------------------------
. Validate Service Doctor Emr History Dr Billing Complete Status
.------------------------------------------------------------
VALEMH00  CALL      XMLHED00
          BRANCH    EXIT,VALEMH99
.
VALEMH20  MATCH     SP70,VALDADMN
          GOTO      VALEMH92 IF EQUAL
.
          MATCH     SP70,VALDCODE
          GOTO      VALEMH92 IF EQUAL
.
          PACK      KEY32,VALDADMN,VALDCODE,Z70
          CALL      RSEMHIS2
VALEMH30  CALL      RPEMHIS2
          BRANCH    OVRCD,VALEMH92
.
          MATCH     VALDADMN,EMHIVIS
          GOTO      VALEMH92 IF NOT EQUAL
.
          MOVE      VALDCODE,DIM10
          MATCH     DIM10,EMHIDOC
          GOTO      VALEMH92 IF NOT EQUAl
.
          MATCH     "ALDOC",EMHIUPT
          GOTO      VALEMH30 IF NOT EQUAL
.
          WRITE     HTMLFILE;"<RETURN_VALUE TYPE=SIMPLE>":
                             EMHIDRBC:
                             "</RETURN_VALUE>"
          GOTO      VALEMH98
.
VALEMH92  WRITE     HTMLFILE;"<RETURN_VALUE TYPE=SIMPLE>":
                             SP1:
                             "</RETURN_VALUE>"
          GOTO      VALEMH98
.
VALEMH98  CALL      XMLEND00
VALEMH99  RETURN
.
.-------------------------------------------------------------------------
. Outputs a selection list of Medical practice for the doctor code/user id
. and a defaulted practice
.-------------------------------------------------------------------------
LSTMPR00  CALL      XMLHED00
          BRANCH    EXIT,LSTMPR99
.
          WRITE     HTMLFILE;"<RETURN_VALUE TYPE=SIMPLE>";
          MOVE      ZERO,F1
          PACK      VALDCODE,VALDCODE,SP70
          PACK      VALDCOD2,VALDCOD2,SP70
          PACK      PRACTICE,SP70
.
          MATCH     SP70,VALDCODE
          IF        @EQUAL
            PACK      KEY22,SP70
            CALL      RSPRDO1
          ELSE
            PACK      KEY22,VALDCODE,SP70
            CALL      RSPRDO2
          ENDIF
.
LSTMPR20  MATCH     SP70,VALDCODE
          GOTO      LSTMPR25 IF NOT EQUAL
          CALL      RKPRDO1
          BRANCH    OVRCD,LSTMPR80
.
          GOTO      LSTMPR30
.
LSTMPR25  CALL      RKPRDO2
          BRANCH    OVRCD,LSTMPR80
.
          MATCH     VALDCODE,PRDODOCT
          GOTO      LSTMPR80 IF NOT EQUAL
.
LSTMPR30  MATCH     SP70,PRACTICE
          IF        !@EQUAL
            MATCH     PRACTICE,PRDOPRAC     * Only want One Med Prac Record!
            GOTO      LSTMPR20 IF EQUAL
          ENDIF
.
          MOVE      PRDOPRAC,PRACTICE
          MOVE      VALDCOD2,KEY10           * All medical practice access
          CALL      RDPRALS1               
          BRANCH    OVRCD,LSTMPR40
          GOTO      LSTMPR50
.
LSTMPR40  MOVE      VALDCOD2,KEY10
          PACK      KEY16,KEY10,PRDOPRAC,SP70
          CALL      RDPRSEC2
          BRANCH    OVRCD,LSTMPR20
.
LSTMPR50  MOVE      PRDOPRAC,KEY6
          CALL      RDPRPR1
          IF        OVRCD=1
            MOVE      "Unknown Practice",PRPRDESC
          ENDIF
.
          CLEAR     KEY40
          APPEND    "(",KEY40
          APPEND    PRDOPRAC,KEY40
          APPEND    ") ",KEY40
          APPEND    PRPRDESC,KEY40
          RESET     KEY40
.
          WRITE     HTMLFILE;PRDOPRAC,",",KEY40,"|";
.
          GOTO      LSTMPR20
.
LSTMPR80  WRITE     HTMLFILE;"</RETURN_VALUE>"
          GOTO      LSTMPR98
.
LSTMPR98  CALL      XMLEND00
LSTMPR99  RETURN
.
.------------------------------------------------------------
. Validate NDIS Number from pmsccdaf table
.------------------------------------------------------------
VALNDS00  CALL      XMLHED00
          BRANCH    EXIT,VALNDS99
.
VALNDS10  PACK      KEY3,VALDTYPE,SP70
          PACK      KEY20,VALDCODE,SP70
          MOVE      SP70,KEY8
.
          PACK      KEY39,KEY3,KEY20,SP70
          CALL      RSPMCCD3
VALNDS20  CALL      RKPMCCD3
          BRANCH    OVRCD,VALNDS60
.
          MATCH     KEY3,PMCDCTYP
          GOTO      VALNDS60 IF NOT EQUAL
.
          MATCH     KEY20,PMCDCNUM
          GOTO      VALNDS60 IF NOT EQUAL
. 
          MATCH     SP70,VALDCOD2
          GOTO      VALNDS90 IF EQUAL
.
          MATCH     VALDCOD2,PMCDURNO
          GOTO      VALNDS90 IF NOT EQUAL   
.
          GOTO      VALNDS20
.
VALNDS60  WRITE     HTMLFILE;"<RETURN_VALUE TYPE=SIMPLE>":
                             ZERO:
                             "</RETURN_VALUE>"
          GOTO      VALNDS98
.
VALNDS90  MOVE      PMCDURNO,KEY8
          SQUEEZE   KEY8  
          WRITE     HTMLFILE;"<RETURN_VALUE TYPE=SIMPLE>":
                             ONE,"|NDIS Number Exists for U/R ":
                             KEY8:
                             "</RETURN_VALUE>"
          GOTO      VALNDS98
.
VALNDS98  CALL      XMLEND00
VALNDS99  RETURN
+
.------------------------------------------------------------
. Select RCP Registers for a visit type
.------------------------------------------------------------
SELREG00  CALL      XMLHED00
          BRANCH    EXIT,SELREG99
.
          WRITE     HTMLFILE;"<RETURN_VALUE TYPE=SIMPLE>";
          PACK      KEY3,SP70
          CALL      RDSREGA1
SELREG10  CALL      RDKREGA1
          BRANCH    OVRCD,SELREG50
.
          MATCH     "1",REGACTIV
          GOTO      SELREG10 IF EQUAL
.
          IF        IBCNMHOS=1
            MATCH     "1",RCCNORUH
            IF        @EQUAL
              MATCH     WBSEHOSP,REGHOSP
              GOTO      SELREG10 IF NOT EQUAL
            ENDIF
          ENDIF
.
          MATCH     "1",VALDCODE             * EMR
          IF        @EQUAL
            COMPARE   "90",REGIBACD
            GOTO      SELREG20 IF EQUAL
          ENDIF
.
          MATCH     "2",VALDCODE             * Outpat
          IF        @EQUAL
            COMPARE   "91",REGIBACD
            GOTO      SELREG20 IF EQUAL
          ENDIF
.
          MATCH     "3",VALDCODE             * Inpat
          IF        @EQUAL
            COMPARE   "97",REGIBACD
            GOTO      SELREG20 IF EQUAL
          ENDIF
.
          MATCH     "4",VALDCODE             * PP
          IF        @EQUAL
            COMPARE   "96",REGIBACD
            GOTO      SELREG20 IF EQUAL
          ENDIF
          GOTO      SELREG10
.
SELREG20  CLEAR     KEY45
          APPEND    "(",KEY45
          APPEND    REGCODE,KEY45
          APPEND    ") ",KEY45
          APPEND    REGDESC,KEY45
          RESET     KEY45
          WRITE     HTMLFILE;REGCODE,",",KEY45,"|";
          GOTO      SELREG10
.
SELREG50  WRITE     HTMLFILE;"</RETURN_VALUE>"
          GOTO      SELREG98
.
SELREG98  CALL      XMLEND00
SELREG99  RETURN
.
.------------------------------------------------------------
. Output a department code option list for hospital id
.------------------------------------------------------------
SELDEP00  CALL      XMLHED00
          BRANCH    EXIT,SELDEP99
.
          WRITE     HTMLFILE;"<RETURN_VALUE TYPE=SIMPLE>";
.
          PACK      VALDCOD2,VALDCOD2,SP70 
.
          IF        IBCNMHOS=1
            PACK      DIM3,VALDCODE,SP70
          ELSE
            PACK      DIM3,SP70
          ENDIF
.
          PACK      KEY6,DIM3,SP70
          CALL      RSALDEP2
SELDEP10  CALL      RKALDEP2   
          BRANCH    OVRCD,SELDEP80
.
          IF        IBCNMHOS=1
            MATCH     DIM3,ALDEHOSP         * Only check departments hospital
            GOTO      SELDEP80 IF NOT EQUAL * if multi hospital is on
          ENDIF
.
          MATCH     "1",ALDEACTV	
          GOTO      SELDEP10 IF EQUAL       * Skip Inactive	  
.	
          MATCH     "0",ALDESECU	
          GOTO      SELDEP40 IF EQUAL	
.	
          MATCH     "2",ALDESECU
          IF        @EQUAL
            MATCH     VALDCOD2,ALDEDEPT
            GOTO      SELDEP40 IF EQUAL
            GOTO      SELDEP10
          ENDIF
.
          GOTO      SELDEP10 
.
SELDEP40  PACK      KEY5,ANSC,ANSG,ALDEDEPT,SP70
          CALL      RDCODE1
          IF        OVRCD = 1
            MOVE      ALDEDEPT,TDESC  	  
          ENDIF	      
.
          WRITE     HTMLFILE;ALDEDEPT,",",TDESC,"|";
          GOTO      SELDEP10
.
SELDEP80  WRITE     HTMLFILE;"</RETURN_VALUE>"
.
SELDEP98  CALL      XMLEND00
SELDEP99  RETURN
+
.------------------------------------------------------------
. Validate Dr No Charge / Dr Billing Complete
.------------------------------------------------------------
VALDNC00  CALL      XMLHED00
          BRANCH    EXIT,VALDNC99
.
VALDNC10  PACK      VALDADMN,VALDADMN,SP70
          PACK      VALDDCTR,VALDDCTR,SP70
.
          MATCH     SP70,VALDADMN
          GOTO      VALDNC92 IF EQUAL
          GOTO      VALDNC92 IF EOS
.
          MATCH     SP70,VALDDCTR
          GOTO      VALDNC92 IF EQUAL
          GOTO      VALDNC92 IF EOS
.
          PACK      KEY8,VALDADMN,SP70
          CALL      RDEMVIS1                 * Check for emergency visit
          BRANCH    OVRCD,VALDNC92
.
          PACK      KEY32,VALDADMN,VALDDCTR,Z70
          CALL      RSEMHIS2
VALDNC50  CALL      RPEMHIS2
          BRANCH    OVRCD,VALDNC92
.
          MATCH     VALDADMN,EMHIVIS
          GOTO      VALDNC92 IF NOT EQUAL
.
          MATCH     VALDDCTR,EMHIDOC
          GOTO      VALDNC92 IF NOT EQUAL
.
          MATCH     "ALDOC",EMHIUPT          
          GOTO      VALDNC50 IF NOT EQUAL
.
          MATCH     "1",EMHIDRBC
          GOTO      VALDNC50 IF NOT EQUAL 
.
          WRITE     HTMLFILE;"<RETURN_VALUE TYPE=SIMPLE>":
                             ONE:
                             "</RETURN_VALUE>"
          GOTO      VALDNC98
.
VALDNC92  WRITE     HTMLFILE;"<RETURN_VALUE TYPE=SIMPLE>":
                             SP1:
                             "</RETURN_VALUE>"
          GOTO      VALDNC98
.
VALDNC98  CALL      XMLEND00
VALDNC99  RETURN
.
.------------------------------------------------------------
. Return a U/R number for a given visit number
.------------------------------------------------------------
ADMURL00  CALL      XMLHED00
          BRANCH    EXIT,ADMURL99
.
ADMURL05  MATCH     SP70,VALDCODE
          GOTO      ADMURL98 IF EQUAL
.
          MOVE      VALDCODE,KEY8
          RJUSTIFY  KEY8
          CALL      RDMRVS1
          BRANCH    OVRCD,ADMURL91
.
          PACK      KEY10,MRVSMKEY,SP70
          CALL      RDMRMAS2
          BRANCH    OVRCD,ADMURL92
.
          WRITE     HTMLFILE;"<RETURN_VALUE TYPE=SIMPLE>":
                             MRMAURNO:
                             "</RETURN_VALUE>"
          GOTO      ADMURL98 
.
ADMURL91  WRITE     HTMLFILE;"<RETURN_VALUE TYPE=ERROR>":
                             "Missing Medical Record Visit Link Record":
                             "</RETURN_VALUE>"
          GOTO      ADMURL98
.
ADMURL92  WRITE     HTMLFILE;"<RETURN_VALUE TYPE=ERROR>":
                             "Missing Medical Record Master Record":
                             "</RETURN_VALUE>"
          GOTO      ADMURL98
.
ADMURL98  CALL      XMLEND00
ADMURL99  RETURN
.
.------------------------------------------------------------
. Update presenting illness and mbs code for theatre bookings
.------------------------------------------------------------
.
VALOEB00  CALL      XMLHED00
          BRANCH    EXIT,VALOEB99
.
          MATCH     "1",PTCNWSIN
          GOTO      VALOEB90 IF NOT EQUAL
.
          MATCH     "1",WSININDC
          GOTO      VALOEB90 IF NOT EQUAL 
.
VALOEB20  PACK      KEY19,VALDADMN,SP70
          CALL      RSWBELF5
VALOEB30  CALL      RKWBELF5
          BRANCH    OVRCD,VALOEB90
.
          MATCH     VALDADMN,WBEFVISN
          GOTO      VALOEB30 IF NOT EQUAL
.
          MOVE      VALDCOD3,DIM3
.
          MATCH     DIM3,WBEFCNTR
          GOTO      VALOEB30 IF NOT EQUAL
.
          MOVE      VALDCODE,WBEFPRIC
          MOVE      VALDCOD2,WBEFPRIM
.
          CALL      UPWBELF5
.
VALOEB80  WRITE     HTMLFILE;"<RETURN_VALUE TYPE=SIMPLE>":
                             ONE:
                             "</RETURN_VALUE>"
          GOTO      VALOEB98
.
VALOEB90  WRITE     HTMLFILE;"<RETURN_VALUE TYPE=ERROR>":
                             "webelfaf record not found.":
                             "</RETURN_VALUE>"
          GOTO      VALOEB98
.
VALOEB98  CALL      XMLEND00
VALOEB99  RETURN
+
.------------------------------------------------------------
. Update OEC Consent in bokrx1
.------------------------------------------------------------
VALOCB00  CALL      XMLHED00
          BRANCH    EXIT,VALOCB99
.
VALOCB20  PACK      KEY8,VALDADMN,SP70
          CALL      RDBKRX11 
          BRANCH    OVRCD,VALOCB92
.
          MOVE      VALDCODE,BKRXPOEC
.
          CALL      UPBKRX11
.
          WRITE     HTMLFILE;"<RETURN_VALUE TYPE=SIMPLE>":
                             ONE:
                             "</RETURN_VALUE>"
          GOTO      VALOCB98
.
VALOCB92  WRITE     HTMLFILE;"<RETURN_VALUE TYPE=ERROR>":
                             "Booking Extension record not found.":
                             "</RETURN_VALUE>"
          GOTO      VALOCB98
.
VALOCB98  CALL      XMLEND00
VALOCB99  RETURN
+
.------------------------------------------------------------
. Validate Cabrini Emr Billing Sheet Complexity Codes
.------------------------------------------------------------
VALCCO00  CALL      XMLHED00
          BRANCH    EXIT,VALCCO99
.
          PACK      KEY15,VALDADMN,EIGHT,SP70
          CALL      RSPMMTI2
VALCCO10  CALL      RKPMMTI2
          BRANCH    OVRCD,VALCCO98
.
          MATCH     VALDADMN,PMMIVISN
          GOTO      VALCCO98 IF NOT EQUAL
.
          MATCH     "8",PMMIRTYP
          GOTO      VALCCO98 IF NOT EQUAL
.
          MATCH     VALDCODE,PMMIEDAD
          GOTO      VALCCO10 IF NOT EQUAL
.
          MATCH     "5004     ",PMMIITEM 
          GOTO      VALCCO80 IF NOT EQUAL
.
          MATCH     "5013     ",PMMIITEM
          GOTO      VALCCO80 IF NOT EQUAL
.
          MATCH     "5017     ",PMMIITEM
          GOTO      VALCCO80 IF NOT EQUAL
.
          MATCH     "5001     ",PMMIITEM
          GOTO      VALCCO80 IF NOT EQUAL
.
          MATCH     "5012     ",PMMIITEM
          GOTO      VALCCO80 IF NOT EQUAL
.
          MATCH     "5016     ",PMMIITEM
          GOTO      VALCCO80 IF NOT EQUAL
.
          MATCH     "5011     ",PMMIITEM
          GOTO      VALCCO80 IF NOT EQUAL
.
          MATCH     "5014     ",PMMIITEM
          GOTO      VALCCO80 IF NOT EQUAL
.
          MATCH     "5019     ",PMMIITEM
          GOTO      VALCCO80 IF NOT EQUAL
.
          MATCH     "5022     ",PMMIITEM
          GOTO      VALCCO80 IF NOT EQUAL
.
          MATCH     "5031     ",PMMIITEM
          GOTO      VALCCO80 IF NOT EQUAL
.
          MATCH     "5035     ",PMMIITEM
          GOTO      VALCCO80 IF NOT EQUAL
.
          MATCH     "5021     ",PMMIITEM
          GOTO      VALCCO80 IF NOT EQUAL
.
          MATCH     "5030     ",PMMIITEM
          GOTO      VALCCO80 IF NOT EQUAL
.
          MATCH     "5033     ",PMMIITEM
          GOTO      VALCCO80 IF NOT EQUAL
.
          MATCH     "5027     ",PMMIITEM
          GOTO      VALCCO80 IF NOT EQUAL
.
          MATCH     "5032     ",PMMIITEM
          GOTO      VALCCO80 IF NOT EQUAL
.
          MATCH     "5036     ",PMMIITEM
          GOTO      VALCCO80 IF NOT EQUAL
.
          GOTO      VALCCO10
.
VALCCO80  WRITE     HTMLFILE;"<RETURN_VALUE TYPE=SIMPLE>":
                             ONE:
                             "</RETURN_VALUE>"
          GOTO      VALCCO98
.
VALCCO98  CALL      XMLEND00
VALCCO99  RETURN
+
.------------------------------------------------------------------------
. Validate ed billing doctor type existence of record and indicator value
.------------------------------------------------------------------------
VALED200  CALL      XMLHED00
          BRANCH    EXIT,VALED299
.
          MATCH     SP70,VALDCODE
          GOTO      VALED298 IF EQUAL
          GOTO      VALED298 IF EOS
.
          PACK      KEY10,VALDCODE,SP70
          CALL      RDPMHCP1
          BRANCH    EXIT,VALED290
.
          MATCH     SP70,PMHCUDF1
          GOTO      VALED290 IF EQUAL
          GOTO      VALED290 IF EOS
.
          PACK      KEY5,ANSR,FIVE,PMHCUDF1,SP70
          CALL      RDCODE1
          BRANCH    OVRCD,VALED290
.
          MATCH     SP70,TCINDC1
          GOTO      VALED290 IF EQUAL
          GOTO      VALED290 IF EOS
.
          WRITE     HTMLFILE;"<RETURN_VALUE TYPE=SIMPLE>":
                             ONE:
                             "</RETURN_VALUE>"
          GOTO      VALED298
.
VALED290  WRITE     HTMLFILE;"<RETURN_VALUE TYPE=SIMPLE>":
                             ZERO:
                             "</RETURN_VALUE>"
          GOTO      VALED298
.
VALED298  CALL      XMLEND00
VALED299  RETURN
+
.------------------------------------------------------------------------
. Validate ed billing doctor type existence of ed billing item in pmsmtiaf
.------------------------------------------------------------------------
VALED300  CALL      XMLHED00
          BRANCH    EXIT,VALED399
.
          MATCH     SP70,VALDADMN
          GOTO      VALED398 IF EQUAL
          GOTO      VALED398 IF EOS
.
          MATCH     SP70,VALDCODE
          GOTO      VALED398 IF EQUAL
          GOTO      VALED398 IF EOS          
.
          PACK      KEY15,VALDADMN,EIGHT,SP70
          CALL      RSPMMTI2
VALED310  CALL      RKPMMTI2
          BRANCH    OVRCD,VALED390
.
          MATCH     VALDADMN,PMMIVISN
          GOTO      VALED390 IF NOT EQUAL
.
          MATCH     "8",PMMIRTYP
          GOTO      VALED390 IF NOT EQUAL
.
          MATCH     VALDCODE,PMMIEDAD   
          GOTO      VALED380 IF EQUAL
.
          GOTO      VALED310
.
VALED380  WRITE     HTMLFILE;"<RETURN_VALUE TYPE=SIMPLE>":
                             ONE:
                             "</RETURN_VALUE>"
          GOTO      VALED398
.
VALED390  WRITE     HTMLFILE;"<RETURN_VALUE TYPE=SIMPLE>":
                             ZERO:
                             "</RETURN_VALUE>"
          GOTO      VALED398
.
VALED398  CALL      XMLEND00
VALED399  RETURN
+
.------------------------------------------------------------
. Validate Service Doctor Emr History No Dr Charge
.------------------------------------------------------------
VALED400  CALL      XMLHED00
          BRANCH    EXIT,VALED499
.
VALED420  MATCH     SP70,VALDADMN
          GOTO      VALED492 IF EQUAL
.
          MATCH     SP70,VALDCODE
          GOTO      VALED492 IF EQUAL
.
          PACK      KEY32,VALDADMN,VALDCODE,SP70
          CALL      RSEMHIS2
VALED430  CALL      RKEMHIS2
          BRANCH    OVRCD,VALED492
.
          MATCH     VALDADMN,EMHIVIS
          GOTO      VALED492 IF NOT EQUAL
.
          MOVE      VALDCODE,DIM10
          MATCH     DIM10,EMHIDOC
          GOTO      VALED492 IF NOT EQUAL
.
          MATCH     "ALDOC",EMHIUPT
          GOTO      VALED430 IF NOT EQUAL
.
          MATCH     "2",EMHIDRBC
          GOTO      VALED480 IF EQUAL
.
          GOTO      VALED430
.
VALED480  WRITE     HTMLFILE;"<RETURN_VALUE TYPE=SIMPLE>":
                             ONE:
                             "</RETURN_VALUE>"
          GOTO      VALED498
.
VALED492  WRITE     HTMLFILE;"<RETURN_VALUE TYPE=SIMPLE>":
                             ZERO:
                             "</RETURN_VALUE>"
          GOTO      VALED498
.
VALED498  CALL      XMLEND00
VALED499  RETURN
+
.------------------------------------------------------------
. Validate / Update Service Doctor Emr History No Dr Charge
.------------------------------------------------------------
VALED500  CALL      XMLHED00
          BRANCH    EXIT,VALED599
.
VALED520  MATCH     SP70,VALDADMN
          GOTO      VALED598 IF EQUAL
.
          MATCH     SP70,VALDCODE
          GOTO      VALED598 IF EQUAL
.
          PACK      KEY32,VALDADMN,VALDCODE,SP70
          CALL      RSEMHIS2
VALED530  CALL      RKEMHIS2
          BRANCH    OVRCD,VALED592
.
          MATCH     VALDADMN,EMHIVIS
          GOTO      VALED592 IF NOT EQUAL
.
          MOVE      VALDCODE,DIM10
          MATCH     DIM10,EMHIDOC
          GOTO      VALED592 IF NOT EQUAL
.
          MATCH     "ALDOC",EMHIUPT
          GOTO      VALED530 IF NOT EQUAL
.
          MOVE      "2",EMHIDRBC
          CALL      UPEMHIS2
.
          GOTO      VALED530
.
VALED592  PROC      EMRDRCHR               * Update Dr Billing complete
.
          WRITE     HTMLFILE;"<RETURN_VALUE TYPE=SIMPLE>":
                             ONE:
                             "</RETURN_VALUE>"
          GOTO      VALED598
.
VALED598  CALL      XMLEND00
VALED599  RETURN
+
.------------------------------------------------------------------------
. Validate if last allocate doctor record is already existing in emrhisaf
.------------------------------------------------------------------------
VALED600  CALL      XMLHED00
          BRANCH    EXIT,VALED699
.
VALED620  MATCH     SP70,VALDADMN
          GOTO      VALED692 IF EQUAL
.
          MATCH     SP70,VALDCODE
          GOTO      VALED692 IF EQUAL
.
.         PACK      KEY32,VALDADMN,VALDCODE,Z70
          PACK      KEY22,VALDADMN,Z70
          CALL      RSEMHIS1
VALED630  CALL      RPEMHIS1
          BRANCH    OVRCD,VALED692
.
          MATCH     VALDADMN,EMHIVIS
          GOTO      VALED692 IF NOT EQUAL
.
          MATCH     "ALDOC",EMHIUPT
          GOTO      VALED630 IF NOT EQUAL
.
          MOVE      VALDCODE,DIM10
          MATCH     DIM10,EMHIDOC
          GOTO      VALED692 IF NOT EQUAl
.
          WRITE     HTMLFILE;"<RETURN_VALUE TYPE=SIMPLE>":
                             ONE:
                             "</RETURN_VALUE>"
          GOTO      VALED698
.
VALED692  WRITE     HTMLFILE;"<RETURN_VALUE TYPE=SIMPLE>":
                             SP1:
                             "</RETURN_VALUE>"
          GOTO      VALED698
.
VALED698  CALL      XMLEND00
VALED699  RETURN
+
.-----------------------------------------------------------------
. Validate / Update Service Doctor Emr History Dr Billing Complete
.-----------------------------------------------------------------
VALED700  CALL      XMLHED00
          BRANCH    EXIT,VALED799
.
VALED720  MATCH     SP70,VALDADMN
          GOTO      VALED798 IF EQUAL
.
          MATCH     SP70,VALDCODE
          GOTO      VALED798 IF EQUAL
.
.         MATCH     SP70,VALDCOD2
.         GOTO      VALED798 IF EQUAL
.
          PACK      KEY32,VALDADMN,VALDCODE,SP70
          CALL      RSEMHIS2
VALED730  CALL      RKEMHIS2
          BRANCH    OVRCD,VALED792
.
          MATCH     VALDADMN,EMHIVIS
          GOTO      VALED792 IF NOT EQUAL
.
          MOVE      VALDCODE,DIM10
          MATCH     DIM10,EMHIDOC
          GOTO      VALED792 IF NOT EQUAL
.
          MATCH     "ALDOC",EMHIUPT
          GOTO      VALED730 IF NOT EQUAL
.
          MOVE      VALDCOD2,EMHIDRBC
          CALL      UPEMHIS2
.
          GOTO      VALED730
.
VALED792  PROC      EMRDRCHR               * Update Dr Billing complete
.
          WRITE     HTMLFILE;"<RETURN_VALUE TYPE=SIMPLE>":
                             ONE:
                             "</RETURN_VALUE>"
          GOTO      VALED798
.
VALED798  CALL      XMLEND00
VALED799  RETURN
.
.------------------------------------------------------------
. Output expected patient comment details
.------------------------------------------------------------
EXPTCH00  CALL      XMLHED00
          BRANCH    EXIT,SELDEP99
.
          WRITE     HTMLFILE;"<RETURN_VALUE TYPE=SIMPLE>";
.
          PACK      VALDCODE,VALDCODE,SP70
          PACK      VALDCOD2,VALDCOD2,SP70
.
          MOVE      ZERO,F1
.
          MOVE      VALDCODE,DIM10
          MOVE      VALDCOD2,DIM3
          PACK      KEY19,DIM10,DIM3,Z70
          CALL      RSEMECH1
EXPTCH10  CALL      RPEMECH1
          BRANCH    OVRCD,EXPTCH80
.
          MATCH     DIM10,EMEHUNIQ
          GOTO      EXPTCH80 IF NOT EQUAL
.
          MATCH     DIM3,EMEHTYPE
          GOTO      EXPTCH80 IF NOT EQUAL
.
          MATCH     "1",EMEHDELT            * is comment deleted
          GOTO      EXPTCH10 IF EQUAL
.
. Retrieve comment header
.
          MATCH     EMEHCDAT,SP70
          IF        @EQUAL
            MOVE     SP70,DISPDATE
            GOTO     EXPTCH20
          ENDIF
.
          UNPACK    EMEHCDAT,CCENT,CYEAR,CMON,CDAY
          MOVE      CMON,F2
          LOAD      MTHNAM3,F2,JAN,FEB,MAR,APR,MAY,JUN:
                               JUL,AUG,SEP,OCT,NOV,DEC
          PACK      DISPDATE,CDAY,SP1,MTHNAM3,SP1,CCENT,CYEAR
.
EXPTCH20  PACK      KEY10,EMEHCUID,SP70
          CALL      RDWBSE1
          IF        OVRCD = 0
            MOVE      WBSENAM,DISPUSNM
          ELSE
            MOVE      EMEHCUID,DISPUSNM
          ENDIF
          STRIP     DISPUSNM
.
EXPTCH30  PACK      KEY22,SP70
          MATCH     EMEHOCCG,SP70
          IF        !@EQUAL
            MOVE      "w0",KEY2
            PACK      KEY5,KEY2,EMEHOCCG,SP70
            CALL      RDCODE1
            IF        OVRCD=1
              PACK      KEY22,EMEHOCCG,SP70
            ELSE
              PACK      KEY22,TDESC,SP70
            ENDIF
          ENDIF
.
          ADD       ONE,F1
.
          PACK      EMELCMNT,DISPDATE,SP1,EMEHCTIM,SP1,DISPUSNM,SP1,KEY22,SP70
          STRIP     EMELCMNT
          MOVELPTR  EMELCMNT,LENGTH
.
          COMPARE   LENGTH,ZERO
          IF        @EQUAL
            MOVE      ONE,LENGTH
          ENDIF
.
          SFORMAT   VAR,LENGTH
          MOVE      EMELCMNT,VAR
          WRITE     HTMLFILE;VAR
          SFORMAT   VAR,100
.
          CALL      EXPTCL00
.
          GOTO      EXPTCH10
.
EXPTCH80  WRITE     HTMLFILE;"</RETURN_VALUE>"
.
EXPTCH98  CALL      XMLEND00
.
EXPTCH99  RETURN
.
.---------------------------------------------------------------------
. Retrieve comment text details
.---------------------------------------------------------------------
.
EXPTCL00  PACK      KEY22,EMEHUNIQ,EMEHTYPE,EMEHNOTE,SP70
          CALL      RSEMECL1
EXPTCL20  CALL      RKEMECL1
          BRANCH    OVRCD,EXPTCL99
.
          MATCH     EMEHUNIQ,EMELUNIQ
          GOTO      EXPTCL99 IF NOT EQUAL
.
          MATCH     EMEHTYPE,EMELTYPE
          GOTO      EXPTCL99 IF NOT EQUAL
.
          MATCH     EMEHNOTE,EMELNOTE
          GOTO      EXPTCL99 IF NOT EQUAL
.
          STRIP     EMELCMNT
          MOVELPTR  EMELCMNT,LENGTH
.
          COMPARE   LENGTH,ZERO
          IF        @EQUAL
            MOVE      ONE,LENGTH
          ENDIF
.
          SFORMAT   VAR,LENGTH
          MOVE      EMELCMNT,VAR
          WRITE     HTMLFILE;VAR
          SFORMAT   VAR,100
.
          GOTO      EXPTCL20
.
EXPTCL99  RETURN
.
.------------------------------------------------------------
. Output all field from patvisaf for a given visit number
.------------------------------------------------------------
OPTVIS00  CALL      XMLHED00
          BRANCH    EXIT,OPTVIS99
.
          WRITE     HTMLFILE;"<RETURN_VALUE TYPE=SIMPLE>";
.
          PACK      KEY8,VALDCODE,SP70
OPTVIS20  CALL      RDVISA1
          BRANCH    OVRCD,OPTVIS90
.
          WRITE     HTMLFILE;PVIURNO,"|":            *  0  
                             PVIDATE,"|":            *  1
                             PVITYPE,"|":            *  2  
                             PVIDOCT,"|":            *  3
                             PVISTAT,"|":            *  4
                             PVITRAN,"|":            *  5
                             PVILOCK,"|":            *  6
                             PVISITE,"|":            *  7
                             PVIRESI,"|":            *  8
                             PVIUNQE,"|":            *  9
                             PVISYST,"|":            * 10
                             PTVITYPE,"|";           * 11
.
OPTVIS90  WRITE     HTMLFILE;"</RETURN_VALUE>"
          CALL      XMLEND00
.
OPTVIS99  RETURN
+
.-----------------------------------------------------------------
. Medicare Eclipse Webservices ERAW Unlock to Partial
.-----------------------------------------------------------------
UERA0000  CALL      XMLHED00
          BRANCH    EXIT,UERA9999
.
          MATCH     "1",WSININDC
          GOTO      UERA9600 IF NOT EQUAL
.
          MATCH     SP70,VALDCODE
          GOTO      UERA9800 IF EQUAL
.
          PACK      KEY61,VALDCODE,SP70
          CALL      RDWBERH1
          BRANCH    OVRCD,UERA9500
.
          MOVE      "1",WBEISTAT
          CALL      UPWBERH1
.
          WRITE     HTMLFILE;"<RETURN_VALUE TYPE=SIMPLE>":
                             ONE:
                             "</RETURN_VALUE>"
          GOTO      UERA9800
.
UERA9500  WRITE     HTMLFILE;"<RETURN_VALUE TYPE=ERROR>":
                             "Medicare Eclipse Webservices Remittance Record Not Found.":
                             "</RETURN_VALUE>"
          GOTO      UERA9800
.
UERA9600  WRITE     HTMLFILE;"<RETURN_VALUE TYPE=ERROR>":
                             "Medicare Eclipse Webservices not configured.":
                             "</RETURN_VALUE>"
          GOTO      UERA9800
.
UERA9800  CALL      XMLEND00
UERA9999  RETURN
.
.------------------------------------------------------------
. Validate cancer code from patcanaf table
.------------------------------------------------------------
VCANCD00  CALL      XMLHED00
          BRANCH    EXIT,VCANCD99
.
VCANCD10  PACK      KEY9,VALDCODE,SP70
          CALL      RDPTCAN1
          BRANCH    OVRCD,VCANCD90
.
VCANCD60  WRITE     HTMLFILE;"<RETURN_VALUE TYPE=SIMPLE>":
                             ZERO: 
                             "</RETURN_VALUE>"
          GOTO      VCANCD98
.
VCANCD90  SQUEEZE   KEY9
          WRITE     HTMLFILE;"<RETURN_VALUE TYPE=SIMPLE>":
                             ONE,"|",KEY9:
                             "</RETURN_VALUE>"
          GOTO      VCANCD98
.
VCANCD98  CALL      XMLEND00
VCANCD99  RETURN
.
.------------------------------------------------------------
. Validate if unit file exists
.------------------------------------------------------------
VUNIXF00  CALL      XMLHED00
          BRANCH    EXIT,VUNIXF99
.
VUNIXF10  STRIP     VALDFILE
          MOVE      ZERO,OVRCD
          TRAP      OVERCOND IF IO
          OPEN      UNITFILE,VALDFILE
          TRAPCLR   IO
          BRANCH    OVRCD,VUNIXF90
.
VUNIXF60  WRITE     HTMLFILE;"<RETURN_VALUE TYPE=SIMPLE>":
                             ZERO:
                             "</RETURN_VALUE>"
          GOTO      VUNIXF98
.
VUNIXF90  WRITE     HTMLFILE;"<RETURN_VALUE TYPE=SIMPLE>":
                             ONE,"|",VALDFILE:
                             "</RETURN_VALUE>"
          GOTO      VUNIXF98
.
VUNIXF98  CALL      XMLEND00
VUNIXF99  RETURN
+
.
.------------------------------------------------------------
. Check status of UR number visits
.------------------------------------------------------------
URVIST00  CALL      XMLHED00
          BRANCH    EXIT,URVIST99
.
          MOVE      ZERO,URVISTD1
          MOVE      ZERO,URVISTD2
          MOVE      ZERO,URVISTD3
          MOVE      ZERO,URVISTD4
          MOVE      ZERO,URVISTD5
          MOVE      ZERO,URVISTD6
.
          PACK      KEY16,URNUMBER,SP70     * check for current Emerg Visit
          CALL      RSEMVIS3
URVIST05  CALL      RKEMVIS3
          BRANCH    OVRCD,URVIST10
          MATCH     URNUMBER,EMVIURNO
          GOTO      URVIST10 IF NOT EQUAL
          MATCH     "1",DEMVISTA
          IF        @EQUAL
            MOVE      ONE,URVISTD1
          ENDIF
          GOTO      URVIST05
. 
URVIST10  PACK      KEY17,URNUMBER,SP70 
          CALL      RSPTMI18
URVIST15  CALL      RKPTMI18
          BRANCH    OVRCD,URVIST20
          MATCH     URNUMBER,AURNO
          GOTO      URVIST20 IF NOT EQUAL
          MATCH     "2",DASTAT
          IF        @EQUAL
            MOVE      ONE,URVISTD2          * check for current Inpatient
            GOTO      URVIST15
          ENDIF
          MATCH     "4",DASTAT              * check for curr Inpatient On Leave
          IF        @EQUAL
            MOVE      ONE,URVISTD3
            GOTO      URVIST15
          ENDIF
          MATCH     "1",DASTAT    * if pre-admission & adm date today or future
          IF        @EQUAL
            MATCH   CURRDATE,ADATE  
            IF        !@LESS
              MOVE      ONE,URVISTD4
              GOTO      URVIST15
            ENDIF
          ENDIF
          GOTO      URVIST15
.
URVIST20  PACK      KEY9,URNUMBER,SP70
          CALL      RSBKREC6
URVIST25  CALL      RKBKREC6
          BRANCH    OVRCD,URVIST30
          MATCH     URNUMBER,BKREURNO
          GOTO      URVIST30 IF NOT EQUAL 
          COMPARE   ZERO,BKRESTAT   * if there is booking today or in future  
          IF        @EQUAL
            MATCH   CURRDATE,BKREEDAT
            IF        !@LESS
              MOVE      ONE,URVISTD5
              GOTO      URVIST25
            ENDIF
          ENDIF
          GOTO      URVIST25
.  
URVIST30  PACK      KEY36,URNUMBER,SP70
          CALL      RDSBOKA3
URVIST35  CALL      RDKBOKA3
          BRANCH    OVRCD,URVIST97
          MATCH     URNUMBER,OBAURNO
          GOTO      URVIST97 IF NOT EQUAL
          MATCH     "1",DOBASTAT   * if outpatient appt today or in future 
          IF        @EQUAL
            MATCH   CURRDATE,OBADATE
            IF        !@LESS
              MOVE      ONE,URVISTD6
              GOTO      URVIST35
            ENDIF
          ENDIF
          GOTO      URVIST35
.
URVIST97  WRITE     HTMLFILE;"<RETURN_VALUE TYPE=SIMPLE>":
                             URVISTD1,"|",URVISTD2,"|",URVISTD3,"|",URVISTD4:
                             "|",URVISTD5,"|",URVISTD6:
                             "</RETURN_VALUE>"
          GOTO      URVIST98
.
URVIST98  CALL      XMLEND00
URVIST99  RETURN
.
.------------------------------------------------------------
. Output all fields from outcanaf for a given visit number
.------------------------------------------------------------
OOTCAN00  CALL      XMLHED00
          BRANCH    EXIT,OOTCAN99
.
          WRITE     HTMLFILE;"<RETURN_VALUE TYPE=SIMPLE>";
.
          MOVE      SP70,KEY6
          CALL      RDSSITA1                     * position at start of file
OOTCAN20  CALL      RDKSITA1                     * read next record
          BRANCH    OVRCD,OOTCAN90               * eof - finished
.
          MATCH     SP70,OSTFILE                 * file prefix blank ?
          GOTO      OOTCAN20 IF EQUAL            * yes - ignore record
.
.         Open site specific outcanaf
.
          PACK      CFNAME,OSTFILE,FILCANA1
          MOVE      ZERO,OVRCD
          TRAP      OVERCOND IF IO
          OPEN      OUTCANA1,CFNAME
          TRAPCLR   IO
          BRANCH    OVRCD,OOTCAN20
.
          PACK      KEY8,VALDCODE,SP70
OOTCAN50  CALL      RDOTCAN1
          BRANCH    OVRCD,OOTCAN90
.
          WRITE     HTMLFILE;OPCNSITE,"|":            *  0
                             OPCNCLIN,"|":            *  1
                             OPCNDATE,"|":            *  2
                             OPCNSTRT,"|":            *  3  
                             DOPCNSLO,"|":            *  4
                             OPCNTIME,"|":            *  5
                             DOPCNOUT,"|":            *  6
                             OPCNURNO,"|":            *  7
                             OPCNREAS,"|":            *  8
                             OPCNRDTE,"|":            *  9
                             OPCNRTIM,"|":            * 10
                             OPCNSRCR,"|":            * 11
                             OPCNCOMP,"|":            * 12              
                             OPCNCLAS,"|":            * 13
                             OPCNINS,"|":             * 14
                             OPCNCAT,"|":             * 15
                             OPCNPRTY,"|":            * 16
                             OPCNOPER,"|":            * 17
                             OPCNTRAN,"|":            * 18
                             OPCNVTYP,"|":            * 19
                             OPCNRLRR,"|":            * 20
                             OPCNCTYP,"|":            * 21
                             OPCNNMDS,"|":            * 22
                             OPCNSRVC,"|":            * 23
                             OPCNCART,"|":            * 24
                             OPCNREFN,"|":            * 25
                             OPCNTCOD,"|":            * 26
                             OPCNBKDT,"|";            * 27
.
OOTCAN90  WRITE     HTMLFILE;"</RETURN_VALUE>"
          CALL      XMLEND00
.
OOTCAN99  RETURN
+
.------------------------------------------------------------------------------
. Write a record to the NIHC IHI Polling Table
.------------------------------------------------------------------------------
WPMPNL00  CALL      XMLHED00
          BRANCH    EXIT,WPMPNL99
.
WPMPNL10  MATCH     SP70,VALDTYPE
          GOTO      WPMPNL91 IF EQUAL
.
          MATCH     SP70,VALDCODE
          GOTO      WPMPNL92 IF EQUAL
OTCAN00
.
          CALL      SETPNL00
.
          PACK      KEY28,PMNPURNO,PMNPRDAT,PMNPRTIM,PMNPCNTR,SP70
          CALL      RAPMNPL1
          IF        OVRCD=0
            GOTO      WPMPNL93
          ENDIF
.
          CALL      WRPMNPL1
.
          WRITE     HTMLFILE;"<RETURN_VALUE TYPE=SIMPLE>":
                              ONE:
                             "</RETURN_VALUE>"
.
          GOTO      WPMPNL98
.
WPMPNL91  WRITE     HTMLFILE;"<RETURN_VALUE TYPE=ERROR>":
                             "Invalid Request Type.":
                             "</RETURN_VALUE>"
          GOTO      WPMPNL98
.
WPMPNL92  WRITE     HTMLFILE;"<RETURN_VALUE TYPE=ERROR>":
                             "Invalid U/R Number.":
                             "</RETURN_VALUE>"
          GOTO      WPMPNL98
.
WPMPNL93  WRITE     HTMLFILE;"<RETURN_VALUE TYPE=ERROR>":
                             "NIHC IHI Polling already existed.":
                             "</RETURN_VALUE>"
          GOTO      WPMPNL98
.
WPMPNL98  CALL      XMLEND00
WPMPNL99  RETURN
.
.------------------------------------------------------------
. Output all fields from patcodaf for a category and code
.------------------------------------------------------------
OPATCD00  CALL      XMLHED00
          BRANCH    EXIT,OPATCD99
.
          WRITE     HTMLFILE;"<RETURN_VALUE TYPE=SIMPLE>";
.
OPATCD10  PACK      VALDCTYP,VALDCTYP,SP70
          PACK      VALDCODE,VALDCODE,SP70 
          MOVE      VALDCTYP,KEY2
          MOVE      VALDCODE,KEY3
          PACK      KEY5,KEY2,KEY3,SP70
OPATCD20  CALL      RDCODE1
          BRANCH    OVRCD,OPATCD90
.
          WRITE     HTMLFILE;TCODE,"|":               *  0
                             ACODE,"|":               *  1  
                             TDESC,"|":               *  2 
                             THCSCOD,"|":             *  3
                             TCFORM6,"|":             *  4
                             TCINDC1,"|":             *  5
                             TCINDC2,"|":             *  6
                             TCINDC3,"|":             *  7
                             TCINDC4,"|":             *  8
                             TCINDC5,"|":             *  9
                             PTCOACTV,"|":            * 10
                             TCINDC6,"|":             * 11
                             TCINDC7,"|":             * 12
                             TCINDC8,"|":             * 13 
                             TCINDC9,"|":             * 14 
                             TCINDC10,"|":            * 15
                             TCINDC11,"|":            * 16
                             PTCDGRPV,"|":            * 17
                             PTCDDEFT,"|":            * 18 
                             PTCDNHCP,"|":            * 19
                             PTCDHOSS,"|":            * 20
                             PTCDLDES,"|":            * 21
                             PTCDDFIC,"|":            * 22
                             TCINDC12,"|":            * 23
                             TCINDC13,"|":            * 24           
                             TCINDC14,"|":            * 25
                             TCINDC15,"|":            * 26
                             TCINDC16,"|":            * 27
                             TCINDC17,"|":            * 28
                             TCINDC18,"|":            * 29
                             TCINDC19,"|":            * 30
                             TCINDC20,"|":            * 31
                             TCINDC21,"|":            * 32
                             PTCDFELC,"|":            * 33
                             PTCDUDF2,"|":            * 34
                             PTCDUDF3,"|":            * 35
                             PTCDUDF4,"|":            * 36
                             PTCDCRSC,"|":            * 37 
                             PTCDASC1,"|":            * 38 
                             PTCDASC2,"|":            * 39
                             PTCDASC3,"|":            * 40
                             PTCDASC4,"|":            * 41 
                             PTCDASC5,"|":            * 42
                             TCINDC22,"|":            * 43
                             TCINDC23,"|":            * 44
                             TCINDC24,"|":            * 45
                             TCINDC25,"|":            * 46
                             TCINDC26,"|":            * 47
                             TCINDC27,"|":            * 48
                             TCINDC28,"|":            * 49
                             TCINDC29,"|":            * 50
                             TCINDC30,"|":            * 51
                             TCINDC31,"|":            * 52
                             TCINDC32,"|":            * 53
                             TCINDC33,"|":            * 54 
                             TCINDC34,"|":            * 55 
                             TCINDC35,"|":            * 56
                             TCINDC36,"|":            * 57
                             TCINDC37,"|":            * 58 
                             TCINDC38,"|":            * 59
                             TCINDC39,"|":            * 60
                             TCINDC40,"|":            * 61
                             TCINDC41,"|":            * 62
                             PTCDUDF5,"|":            * 63
                             PTCDUDF6,"|":            * 64
                             PTCDUDF7,"|":            * 65
                             PTCDUDF8,"|":            * 66   
                             PTCDUDF9,"|":            * 67
                             PTCDUD10,"|":            * 68
                             PTCDUD11,"|":            * 69
                             PTCDUD12,"|":            * 70
                             PTCDUD13,"|":            * 71
                             PTCDUD14,"|":            * 72
                             PTCDASC6,"|":            * 73
                             PTCDASC7,"|":            * 74 
                             PTCDASC8,"|":            * 75
                             PTCDASC9,"|":            * 76
                             PTCDAS10,"|":            * 77
                             PTCDAS11,"|":            * 78
                             PTCDAS12,"|":            * 79
                             PTCDAS13,"|":            * 80
                             PTCDAS14,"|":            * 81
                             PTCDAS15,"|";            * 82
.
OPATCD90  WRITE     HTMLFILE;"</RETURN_VALUE>"
          CALL      XMLEND00
.
OPATCD99  RETURN
+
.------------------------------------------------------------
. Set pmsnplaf variables
.------------------------------------------------------------
SETPNL00  CALL      CLPMSNPL
          MOVE      VALDCODE,PMNPURNO
          CALL      IBACLOCK
          PACK      PMNPRDAT,CCC,CYY,CMM,CDD
          REP       " 0",PMNPRDAT
          CLOCK     TIME,CTIMEIS
          MOVE      CTIMEIS,PMNPRTIM
          MOVE      "   1",PMNPCNTR
.
          IF        IBCNMHOS=ONE
            MOVE      WBSEHOSP,PMNPHOSP
          ELSE
            OPEN      PATHSPA1,"pathspaf"
.
            PACK      KEY3,SP70
            CALL      RSPTHSP1
            CALL      RKPTHSP1
            IF        OVRCD=0
              MOVE      PTHSHOSP,PMNPHOSP
            ENDIF
          ENDIF
.
          MOVE      VALDTYPE,PMNPRTYP
          MOVE      USERID,PMNPRUID
          MOVE      "0",PMNPRSTA
          MOVE      PMNPRDAT,PMNPCDAT
          MOVE      PMNPRTIM,PMNPCTIM
          MOVE      PMNPRUID,PMNPCUID
.
SETPNL99  RETURN
.
.------------------------------------------------------------
. Output all fields from outbb1af for a visit no.
.------------------------------------------------------------
OOTBB100  CALL      XMLHED00
          BRANCH    EXIT,OOTBB199
.
          WRITE     HTMLFILE;"<RETURN_VALUE TYPE=SIMPLE>";
.
OOTBB110  PACK      VALDCODE,VALDCODE,SP70
          MOVE      VALDCODE,KEY8
OOTBB120  CALL      RDBOKB1
          BRANCH    OVRCD,OOTBB190
.
          WRITE     HTMLFILE;DOBAOUTN,"|":            *  0
                             OBASRCR,"|":             *  1
                             OBACOMP,"|":             *  2
                             OBACLASS,"|":            *  3
                             OBAINS,"|":              *  4
                             OBAATTN,"|":             *  5
                             OBADOCT,"|":             *  6
                             OBACOMM,"|":             *  7
                             OTBBFUND,"|":            *  8
                             OTBBTBLE,"|":            *  9
                             DOTBBPVI,"|":            * 10
                             OTBBCLAL,"|":            * 11
                             OTBBSPAR,"|":            * 12
                             OBADATE,"|":             * 13
                             OBACAT,"|":              * 14
                             OBAPRTY,"|":             * 15
                             OBARSCHD,"|":            * 16
                             OBBPORT,"|":             * 17
                             OBBBOOK,"|":             * 18
                             OBBCTYP,"|":             * 19
                             OBOUSR1,"|":             * 20
                             OBOUSR2,"|":             * 21
                             OBOUSR3,"|":             * 22
                             OBOUSR4,"|":             * 23
                             OBALADMN,"|":            * 24
                             OTBBDEPT,"|":            * 25
                             OTBBTRAN,"|":            * 26
                             OTBBLNGI,"|":            * 27
                             OTBBTMFS,"|":            * 28
                             OTBBTMBO,"|":            * 29
                             OTBBGPFA,"|":            * 30
                             OTBBECRA,"|":            * 31
                             OTBBRFGP,"|":            * 32
                             OTBBGPPC,"|":            * 33
                             OTBBADCS,"|":            * 34
                             OTBBCITM,"|":            * 35
                             OTBBASTM,"|":            * 36
                             OTBBDPTM,"|":            * 37
                             OTBBOUTC,"|":            * 38
                             OTBBSNDL,"|":            * 39
                             OTBBGPPT,"|":            * 40
                             OTBBDOFR,"|":            * 41
                             OTBBOPER,"|":            * 42
                             OBOUSR5,"|":             * 43
                             OBOUSR6,"|":             * 44
                             OBOUSR7,"|":             * 45
                             OBOUSR8,"|":             * 46
                             OTBBRANK,"|":            * 47
                             OTBBSPCA,"|":            * 48
                             OTBBCIND,"|":            * 49
                             OTBBFLUP,"|":            * 50
                             OTBBSCAR,"|":            * 51
                             OTBBGLDT,"|":            * 52
                             OTBBSNGL,"|":            * 53
                             OTBBNMDS,"|":            * 54
                             OTBBCART,"|":            * 55
                             OTBBSRVD,"|":            * 56
                             OTBBCLHR,"|":            * 57
                             OTBBCONT,"|":            * 58
                             OTBBTCOD,"|":            * 59
                             OTBBPURC,"|":            * 60
                             OTBBBKOV,"|":            * 61
                             OTBBBKPR,"|":            * 62
                             OTBBBKPM,"|":            * 63
                             OTBBBKBA,"|":            * 64
                             OTBBRDAT,"|":            * 65
                             OTBBHCP1,"|":            * 66
                             OTBBHCP2,"|":            * 67
                             OTBBHCP3,"|":            * 68
                             OTBBHCP4,"|":            * 69
                             OTBBSPR1,"|"             * 70
.
OOTBB190  WRITE     HTMLFILE;"</RETURN_VALUE>"
          CALL      XMLEND00
.
OOTBB199  RETURN
.
.------------------------------------------------------------
. Output all fields from allcctaf for a Dept/type/contract
.------------------------------------------------------------
OALCCT00  CALL      XMLHED00
          BRANCH    EXIT,OALCCT99
.
          WRITE     HTMLFILE;"<RETURN_VALUE TYPE=SIMPLE>";
.
OALCCT10  PACK      VALDTYPE,VALDTYPE,SP70
          PACK      VALDCODE,VALDCODE,SP70
          PACK      VALDCOD2,VALDCOD2,SP70
          MOVE      VALDTYPE,KEY3
          MOVE      VALDCODE,KEY2
          MOVE      VALDCOD2,DIM3
.
          PACK      KEY8,KEY3,KEY2,DIM3,SP70  
OALCCT20  CALL      RDALCCT1
          BRANCH    OVRCD,OALCCT90
.
          WRITE     HTMLFILE;ALCCDEPT,"|":            *  0
                             ALCCCONT,"|":            *  1
                             ALCCCDAT,"|":            *  2
                             ALCCCTIM,"|":            *  3
                             ALCCCUID,"|":            *  4
                             ALCCUDAT,"|":            *  5
                             ALCCUTIM,"|":            *  6
                             ALCCUUID,"|":            *  7
                             ALCCTYPE,"|"             *  8
.
OALCCT90  WRITE     HTMLFILE;"</RETURN_VALUE>"
          CALL      XMLEND00
.
OALCCT99  RETURN
.
.------------------------------------------------------------
. Output all fields from oprtryaf for a code/hospital id
.------------------------------------------------------------
OOPTRA00  CALL      XMLHED00
          BRANCH    EXIT,OOPTRA99
.
          WRITE     HTMLFILE;"<RETURN_VALUE TYPE=SIMPLE>";
.
OOPTRA10  PACK      VALDCODE,VALDCODE,SP70
          PACK      VALDTYPE,VALDTYPE,SP70
          MOVE      VALDCODE,KEY15
          MOVE      VALDTYPE,KEY3
.
          PACK      KEY18,KEY15,KEY3,SP70
OOPTRA20  CALL      RDOPTRA1
          BRANCH    OVRCD,OOPTRA90
.
          WRITE     HTMLFILE;OPTHCODE,"|":            *  0
                             OPTHDESC,"|":            *  1
                             OPTHHOSP,"|"             *  2
.
OOPTRA90  WRITE     HTMLFILE;"</RETURN_VALUE>"
          CALL      XMLEND00
.
OOPTRA99  RETURN
.
.-----------------------------------------------------------------------
. Validate NZP Misc Charge Item Code with hospital Code 
.-----------------------------------------------------------------------
VALNZM00  CALL      XMLHED00
          BRANCH    EXIT,VALNZM99
.
          PACK      VALDCODE,VALDCODE,SP70
          PACK      VALDHOSP,VALDHOSP,SP70
          PACK      DIM3,VALDHOSP,SP70
.
          PACK      VALDCEFF,VALDCEFF,SP70
          MATCH     SP70,VALDCEFF
          IF        @EQUAL
            PACK      VALDCEFF,CCC,CYY,CMM,CDD
            REP       " 0",VALDCEFF
          ENDIF
.
          MOVE      SP70,EFFDATE1                 * Eff date for hospital
          PACK      CHRDESC1,SP70,SP70            * Desc for hospital
          MOVE      SP70,EFFDATE2                 * Eff date for blank hospital
          PACK      CHRDESC2,SP70,SP70            * Desc for blank hospital
.
VALNZM10  PACK      MCHARGE,VALDCODE,SP70
          PACK      KEY37,MCHARGE,SP70
          CALL      RSNZMCH3
VALNZM20  CALL      RKNZMCH3
          BRANCH    OVRCD,VALNZM60
.
          MATCH     MCHARGE,NZMCMCHG
          GOTO      VALNZM60 IF NOT EQUAL         * does charge code exist?
. 
          MATCH     "1",NZMCACFL                  * Inactive?
          GOTO      VALNZM20 IF EQUAL             * Yes
.
          MATCH     NZMCEFDT,VALDCEFF             * eff date => serv. date ?
          GOTO      VALNZM20 IF LESS              * yes
.
          BRANCH    IBCNMHOS,VALNZM40
.
. Single hospital
.
          MATCH     SP70,NZMCHOSP
          IF        @EQUAL
            MATCH     EFFDATE1,NZMCEFDT           * Effective date start
            GOTO      VALNZM20 IF LESS
            MOVE      NZMCDESC,CHRDESC1           * Charge Code Description
            MOVE      NZMCEFDT,EFFDATE1
            GOTO      VALNZM20
          ENDIF
.
          GOTO      VALNZM20
.
. Multi hospital
.
VALNZM40  MATCH     DIM3,NZMCHOSP                 * Match hospital
          IF        @EQUAL 
            MATCH     EFFDATE1,NZMCEFDT           * Effective date start
            GOTO      VALNZM20 IF LESS
            MOVE      NZMCDESC,CHRDESC1           * Charge Code Description
            MOVE      NZMCEFDT,EFFDATE1
            GOTO      VALNZM20
          ENDIF
.
          MATCH     SP70,NZMCHOSP
          IF        @EQUAL
            MATCH     EFFDATE2,NZMCEFDT           * Effective date start
            GOTO      VALNZM20 IF LESS
            MOVE      NZMCDESC,CHRDESC2           * Charge Code Description
            MOVE      NZMCEFDT,EFFDATE2
            GOTO      VALNZM20
          ENDIF
.
          GOTO      VALNZM20
.
VALNZM60  MATCH     SP70,EFFDATE1
          GOTO      VALNZM70 IF NOT EQUAL
.
          MATCH     SP70,EFFDATE2
          GOTO      VALNZM71 IF NOT EQUAL
.
          GOTO      VALNZM90
.
VALNZM70  WRITE     HTMLFILE;"<RETURN_VALUE TYPE=SIMPLE>":
                             CHRDESC1:
                             "</RETURN_VALUE>"
          GOTO      VALNZM98
.
VALNZM71  WRITE     HTMLFILE;"<RETURN_VALUE TYPE=SIMPLE>":
                             CHRDESC2:
                             "</RETURN_VALUE>"
          GOTO      VALNZM98

.
VALNZM90  WRITE     HTMLFILE;"<RETURN_VALUE TYPE=ERROR>":
                             "Invalid Misc Charge Code - ":
                              VALDCODE,"</RETURN_VALUE>"
.
VALNZM98  CALL      XMLEND00
VALNZM99  RETURN
.
.------------------------------------------------------------
. Output all fields from opreqpaf for a code/hospital id
.------------------------------------------------------------
OOPEQP00  CALL      XMLHED00
          BRANCH    EXIT,OOPEQP99
.
          WRITE     HTMLFILE;"<RETURN_VALUE TYPE=SIMPLE>";
.
OOPEQP10  PACK      VALDCODE,VALDCODE,SP70
          PACK      VALDTYPE,VALDTYPE,SP70
          MOVE      VALDCODE,KEY15
          MOVE      VALDTYPE,KEY3
.
          PACK      KEY18,KEY15,KEY3,SP70
OOPEQP20  CALL      RDOPEQP1
          BRANCH    OVRCD,OOPEQP90
.
          WRITE     HTMLFILE;OPEQCODE,"|":            *  0
                             OPEQDESC,"|":            *  1
                             OPEQTYPE,"|":            *  2
                             OPEQUNIQ,"|":            *  3
                             OPEQTEAM,"|":            *  4
                             OPEQSTAT,"|":            *  5
                             OPEQDTSC,"|":            *  6
                             OPEQUSLO,"|":            *  7
                             OPEQCULO,"|":            *  8
                             OPEQDE1U,"|":            *  9
                             OPEQMNOU,"|":            * 10
                             OPEQEEDT,"|":            * 11
                             OPEQNOUR,"|":            * 12
                             OPEQLSDT,"|":            * 13
                             OPEQULST,"|":            * 14
                             OPEQLMDT,"|":            * 15
                             OPEQULMT,"|":            * 16
                             OPEQSRNO,"|":            * 17
                             OPEQSPNO,"|":            * 18
                             OPEQSPDT,"|":            * 19
                             OPEQNOTE,"|":            * 20
                             OPEQUDT1,"|":            * 21
                             OPEQUDT2,"|":            * 22
                             OPEQUDF1,"|":            * 23
                             OPEQUDF2,"|":            * 24
                             OPEQDTE1,"|":            * 25
                             OPEQDTE2,"|":            * 26
                             OPEQTME1,"|":            * 27
                             OPEQTME2,"|":            * 28
                             OPEQACTV,"|":            * 29
                             OPEQHOSP,"|"             * 30
.
OOPEQP90  WRITE     HTMLFILE;"</RETURN_VALUE>"
          CALL      XMLEND00
.
OOPEQP99  RETURN
+
.
.------------------------------------------------------------
. Return Doctor Level (cat DL)                           
.------------------------------------------------------------
CHCKDL00  CALL      XMLHED00
          BRANCH    EXIT,CHCKDL99
.
          PACK      VALDDOCT,VALDDOCT,SP70
          MOVE      VALDDOCT,DIM10
.
          PACK      KEY10,DIM10,SP70
          CALL      RDPMHCP1
          BRANCH    OVRCD,CHCKDL97
.
          PACK      KEY5,ANSD,ANSL,PMHCOSLV,SP70
          CALL      RDCODE1
          BRANCH    OVRCD,CHCKDL97
.
CHCKDL97  WRITE     HTMLFILE;"<RETURN_VALUE TYPE=SIMPLE>",TCINDC1:
                             "</RETURN_VALUE>"
          GOTO      CHCKDL98
.
CHCKDL98  CALL      XMLEND00
.
CHCKDL99  RETURN
.
.---------------------------------------------------------------------------
. Output all fields from  websteaf for a user id/Server program
.---------------------------------------------------------------------------
OWBSTE00  CALL      XMLHED00
          BRANCH    EXIT,OWBSTE99
.
          WRITE     HTMLFILE;"<RETURN_VALUE TYPE=SIMPLE>";
.
OWBSTE10  PACK      VALDCODE,VALDCODE,SP70
          PACK      VALDTYPE,VALDTYPE,SP70
          MOVE      VALDCODE,KEY10
          MOVE      VALDTYPE,KEY8
.
          PACK      KEY18,KEY10,KEY8,SP70
OWBSTE20  CALL      RDWBST1
          BRANCH    OVRCD,OWBSTE90
.
          WRITE     HTMLFILE;WBSTUID,"|":             *  0
                             WBSTPRG,"|":             *  1
                             WBSTLEV,"|":             *  2
                             WBSTUR1,"|":             *  3
                             WBSTUR2,"|":             *  4
                             WBSTUD1,"|":             *  5
                             WBSTUD2,"|":             *  6
                             WBSTUY1,"|":             *  7
                             WBSTUY2,"|"              *  8
.
OWBSTE90  WRITE     HTMLFILE;"</RETURN_VALUE>"
          CALL      XMLEND00
.
OWBSTE99  RETURN
+
.kkkk
.---------------------------------------------------------------------------
. Default Occupational Group for a Future Action type
.---------------------------------------------------------------------------
OCCGRP00  CALL      XMLHED00
          BRANCH    EXIT,OCCGRP99
.
          WRITE     HTMLFILE;"<RETURN_VALUE TYPE=SIMPLE>";
.
          PACK      VALDTYPE,VALDTYPE,SP70
          MOVE      VALDTYPE,KEY3
.
          MOVE      "FA",KEY2            * Future Action
          PACK      KEY5,KEY2,KEY3
          CALL      RDCODE1
          BRANCH    OVRCD,OCCGRP90
.
          UNPACK    PTCDASC1,KEY6        * save Associated Number 1
          MATCH     SP70,KEY6
          GOTO      OCCGRP90 IF EQUAL
.
          MOVE      "w0",KEY2            * Occupational Group
          PACK      KEY5,KEY2,SP70
          CALL      RDSCODE1
OCCGRP10  CALL      RDKCODE1
          BRANCH    OVRCD,OCCGRP90
.
          MATCH     KEY2,TCODE
          GOTO      OCCGRP90 IF NOT EQUAL
          MATCH     KEY6,PTCDASC1
          GOTO      OCCGRP10 IF NOT EQUAL
.
          WRITE     HTMLFILE;ACODE,"|":             *  0
                             TDESC,"|"              *  1
.
OCCGRP90  WRITE     HTMLFILE;"</RETURN_VALUE>"
          CALL      XMLEND00

OCCGRP99  RETURN
.
.---------------------------------------------------------------------------
. Validate Supervisor Insert Bed Movement
. Return
. 0 - OK
. 1 - Already exist in pattranf
. 2 - Not in patmi1af
. 3 - Patient must be discharged, current or on-leave
. 4 - Change date/time must be greater admission date/time
. 5 - Change date/time must be within admission date/and discharge
.     date/time period
. 6 - Change date cannot be before invoice accommodation date 
. 7 - Patient is on-leave on date/time of movement
.---------------------------------------------------------------------------
VIBDMV00  CALL      XMLHED00
          BRANCH    EXIT,VIBDMV99
.
VIBDMV10  PACK      INSIWARD,VALDCODE,SP70
          PACK      INSIBED,VALDCOD2,SP70
          PACK      INSIDATE,VALDCOD3,SP70
          PACK      INSITIME,VALDCOD4,SP70
          PACK      INSIDTTM,INSIDATE,INSITIME,SP70
          PACK      ADMNUMBR,VALDCOD5,SP70
.
. Check already exist in pattranf
.
          PACK      KEY30,INSIWARD,INSIBED,INSIDATE,INSITIME,ADMNUMBR,SP70 
          CALL      RDTRAN1
          IF        OVRCD = 0
            GOTO      VIBDMV81
          ENDIF    
.
. Check already exist in pattranf for date and time
.
          PACK      KEY30,ADMNUMBR,INSIDATE,INSITIME,SP70 
          CALL      RDSTRAN2
          CALL      RDKTRAN2
          BRANCH    OVRCD,VIBDMV15
.
          MATCH     ADMNUMBR,DTADMN
          GOTO      VIBDMV15 IF NOT EQUAL
.
          MATCH     INSIDATE,TDATE
          GOTO      VIBDMV15 IF NOT EQUAL
.
          MATCH     INSITIME,TTIME
          GOTO      VIBDMV81 IF EQUAL
.
VIBDMV15  PACK      KEY8,ADMNUMBR,SP70
          CALL      RDMISS1
          BRANCH    OVRCD,VIBDMV82
.
. Check admission status
.
          MATCH     "2",DASTAT
          GOTO      VIBDMV20 IF EQUAL
.
          MATCH     "3",DASTAT
          GOTO      VIBDMV22 IF EQUAL
.
          MATCH     "4",DASTAT
          GOTO      VIBDMV40 IF EQUAL
.
          GOTO      VIBDMV83
.
. Check admission data/time. DASTAT=2
. 
VIBDMV20  PACK      CHCKDTTM,ADATE,ATIME,SP70
          MATCH     INSIDTTM,CHCKDTTM
          GOTO      VIBDMV84 IF NOT LESS
.
          GOTO      VIBDMV26 
.
. Check discharge data/time
.
VIBDMV22  PACK      CHCKDTTM,ADATE,ATIME,SP70
          MATCH     CHCKDTTM,INSIDTTM
          GOTO      VIBDMV85 IF LESS       
.
VIBDMV24  PACK      KEY8,ADMNUMBR,SP70
          CALL      RDDSCH1 
          BRANCH    OVRCD,VIBDMV85
.
          PACK      CHCKDTTM,DDATE,DTIME,SP70
          MATCH     INSIDTTM,CHCKDTTM
          GOTO      VIBDMV85 IF LESS
.
. check invoice accommodation period
.
VIBDMV26  IF        AINVPRT = 0
            GOTO      VIBDMV40
          ENDIF
.
          MATCH     ALACDTE,INSIDATE
          GOTO      VIBDMV86 IF LESS  
.
. Check leave/return range
. 
VIBDMV40  MOVE      SP70,LEAVDTTM
          MOVE      SP70,RETNDTTM
          MOVE      ZERO,LEAVFOND
.
          PACK      KEY30,ADMNUMBR,SP70
          CALL      RDSTRAN2
VIBDMV42  CALL      RDKTRAN2
          BRANCH    OVRCD,VIBDMV48
.
          MATCH     DTADMN,ADMNUMBR
          GOTO      VIBDMV48 IF NOT EQUAL
.
. try to find 'L' first and the the matching 'R'
.            
          IF        LEAVFOND = 0
            MATCH     ANSL,TMOVE
            GOTO      VIBDMV42 IF NOT EQUAL
.
. 'L' found, if leave date/time after change date, no more checking
.
            PACK      CHCKDTTM,TDATE,TTIME,SP70
            MATCH     CHCKDTTM,INSIDTTM
            GOTO      VIBDMV48 IF LESS
.
. 'L' found, try to find the match 'R'
.            
            MOVE      1,LEAVFOND
            MOVE      CHCKDTTM,LEAVDTTM 
            GOTO      VIBDMV42
          ELSE
            MATCH     ANSR,TMOVE 
            GOTO      VIBDMV42 IF NOT EQUAL
.
. 'R' found, if return date/time before change date, reset and find the next
. 'L' 
.
            PACK      CHCKDTTM,TDATE,TTIME,SP70
            MATCH     INSIDTTM,CHCKDTTM
            IF        @LESS
              MOVE      SP70,LEAVDTTM
              MOVE      SP70,RETNDTTM
              MOVE      ZERO,LEAVFOND
              GOTO      VIBDMV42
            ELSE
              MOVE      CHCKDTTM,RETNDTTM
              GOTO      VIBDMV48
            ENDIF  
          ENDIF
.
VIBDMV48  IF        LEAVFOND = 0
            GOTO      VIBDMV70
          ENDIF
.
          GOTO      VIBDMV87           
.
.
VIBDMV70  WRITE     HTMLFILE;"<RETURN_VALUE TYPE=SIMPLE>":
                             ZERO:
                             "</RETURN_VALUE>"
          GOTO      VIBDMV98
.
. Already exist in pattranf
.
VIBDMV81  SQUEEZE   KEY30
          WRITE     HTMLFILE;"<RETURN_VALUE TYPE=SIMPLE>":
                             ONE,"|",KEY30:
                             "</RETURN_VALUE>"
          GOTO      VIBDMV98
.
. Not in patmi1af
.
VIBDMV82  SQUEEZE   KEY8
          WRITE     HTMLFILE;"<RETURN_VALUE TYPE=SIMPLE>":
                             TWO,"|",KEY8:
                             "</RETURN_VALUE>"
          GOTO      VIBDMV98
.
. Patient must be discharged, current or on-leave
.
VIBDMV83  SQUEEZE   KEY8
          WRITE     HTMLFILE;"<RETURN_VALUE TYPE=SIMPLE>":
                             THREE,"|",KEY8:
                             "</RETURN_VALUE>"
          GOTO      VIBDMV98
.
. For admission patient, Change date/time must be greater admission
. date/time
.
VIBDMV84  SQUEEZE   KEY8
          WRITE     HTMLFILE;"<RETURN_VALUE TYPE=SIMPLE>":
                             FOUR,"|",KEY8:
                             "</RETURN_VALUE>"
          GOTO      VIBDMV98
.
. For dicharge patient, Change date/time must be within admission
. date/and discharge date/time period
.
VIBDMV85  WRITE     HTMLFILE;"<RETURN_VALUE TYPE=SIMPLE>":
                             FIVE,"|":
                             "</RETURN_VALUE>"
          GOTO      VIBDMV98
.
. Change date cannot be before invoice accommodation date 
.
VIBDMV86  WRITE     HTMLFILE;"<RETURN_VALUE TYPE=SIMPLE>":
                             SIX,"|",ALACDTE:
                             "</RETURN_VALUE>"
          GOTO      VIBDMV98
.
. Patient is on leave on date/time of movement
.
VIBDMV87  UNPACK    LEAVDTTM,LEAVDATE,LEAVTIME
          WRITE     HTMLFILE;"<RETURN_VALUE TYPE=SIMPLE>":
                             SEVEN,"|",LEAVDATE,"|",LEAVTIME:
                             "</RETURN_VALUE>"
          GOTO      VIBDMV98
.
.
VIBDMV98  CALL      XMLEND00
VIBDMV99  RETURN
.
.---------------------------------------------------------------------------
. Validate Patient Credit Invoice
. Return
. 0 - OK
. 1 - Patient has credit invoice
.---------------------------------------------------------------------------
VCDINV00  CALL      XMLHED00
          BRANCH    EXIT,VCDINV99
.
VCDINV10  PACK      ADMNUMBR,VALDCODE,SP70
          PACK      KEY8,ADMNUMBR,SP70
          CALL      RDMISS1
          BRANCH    OVRCD,VCDINV60
.
          IF        AINVPRT = 0
            GOTO      VCDINV60 
          ENDIF
.
          MATCH     "2",DASTAT
          GOTO      VCDINV20 IF EQUAL
.
          MATCH     "4",DASTAT
          GOTO      VCDINV20 IF EQUAL
.
          MATCH     "3",DASTAT
          GOTO      VCDINV30 IF EQUAL
.
          GOTO      VCDINV60
.
. Check last accom date. DASTAT=2 or 4
. 
VCDINV20  CALL      IBACLOCK
          PACK      TDAYDATE,CCC,CYY,CMM,CDD
          REP       " 0",TDAYDATE
. 
          MATCH     ALACDTE,TDAYDATE
          GOTO      VCDINV90 IF EQUAL 
.
          GOTO      VCDINV60
.
. Check last accom date. DASTAT=3
. 
.
VCDINV30  PACK      KEY8,ADMNUMBR,SP70
          CALL      RDDSCH1 
          BRANCH    OVRCD,VCDINV60
.
          MATCH     ALACDTE,DDATE
          GOTO      VCDINV90 IF EQUAL
.
          GOTO      VCDINV60
.
.
VCDINV60  WRITE     HTMLFILE;"<RETURN_VALUE TYPE=SIMPLE>":
                             ZERO:
                             "</RETURN_VALUE>"
          GOTO      VCDINV98
.
VCDINV90  WRITE     HTMLFILE;"<RETURN_VALUE TYPE=SIMPLE>":
                             ONE,"|":
                             "</RETURN_VALUE>"
          GOTO      VCDINV98
.
.
VCDINV98  CALL      XMLEND00
VCDINV99  RETURN
.
.---------------------------------------------------------------------------
. Validate Supervisor Insert Admission
. Return
. 0 - OK
. 1 - Patient Already in Hospital
. 2 - Admission Date/Time Cannot Overlap Discharge Date/Time
. 3 - Admission Date/Time Cannot be in future
.---------------------------------------------------------------------------
VSINAD00  CALL      XMLHED00
          BRANCH    EXIT,VSINAD99
.
VSINAD10  PACK      INURNUMB,VALDCODE,SP70
          PACK      INSIDATE,VALDCOD2,SP70
          PACK      INSITIME,VALDCOD3,SP70
          PACK      INSIDTTM,INSIDATE,INSITIME,SP70
.
          CALL      IBACLOCK
          PACK      TDAYDATE,CCC,CYY,CMM,CDD
          REP       " 0",TDAYDATE
          CLOCK     TIME,TDAYTIME
          PACK      TDAYDTTM,TDAYDATE,TDAYTIME,SP70
.
          MATCH     INSIDTTM,TDAYDTTM
          GOTO      VSINAD92 IF LESS  
.
          PACK      KEY17,INURNUMB,TWO,SP70
          CALL      RSPTMI18
VSINAD20  CALL      RKPTMI18
          BRANCH    OVRCD,VSINAD80          * no current admission
.
          MATCH     AURNO,INURNUMB          * same U/R Number?
          GOTO      VSINAD80 IF NOT EQUAL   * No
.
          MATCH    "2",DASTAT
          GOTO      VSINAD90 IF EQUAL
.
          MATCH    "4",DASTAT
          GOTO      VSINAD90 IF EQUAL
.
          MATCH    "3",DASTAT
          GOTO      VSINAD20 IF NOT EQUAL
.
. Discharged. Check admission date/time
.
          PACK      ADMNDTTM,ADATE,ATIME,SP70
.
. Check discharge data/time
.
VSINAD30  PACK      KEY8,DAADMNO,SP70
          CALL      RDDSCH1
          BRANCH    OVRCD,VSINAD20
.
          PACK      DSCHDTTM,DDATE,DTIME,SP70
. 
          MATCH     ADMNDTTM,INSIDTTM
          GOTO      VSINAD91 IF EQUAL
          GOTO      VSINAD20 IF LESS
. 
          MATCH     DSCHDTTM,INSIDTTM
          GOTO      VSINAD91 IF EQUAL
          GOTO      VSINAD91 IF LESS
.
          GOTO      VSINAD20
.
VSINAD80  WRITE     HTMLFILE;"<RETURN_VALUE TYPE=SIMPLE>":
                             ZERO:
                             "</RETURN_VALUE>"
          GOTO      VSINAD98
.
. Patient Already in Hospital
.
VSINAD90 WRITE     HTMLFILE;"<RETURN_VALUE TYPE=SIMPLE>":
                             ONE,"|",DAADMNO:
                             "</RETURN_VALUE>"
          GOTO      VSINAD98
.
. Admission Date/Time Cannot Overlap Discharge Date/Time 
.
VSINAD91  WRITE     HTMLFILE;"<RETURN_VALUE TYPE=SIMPLE>":
                             TWO,"|",ADATE,"|",ATIME:
                             "|",DDATE,"|",DTIME:
                             "</RETURN_VALUE>"
          GOTO      VSINAD98
.
VSINAD92  WRITE     HTMLFILE;"<RETURN_VALUE TYPE=SIMPLE>":
                             THREE,"|":
                             "</RETURN_VALUE>"
          GOTO      VSINAD98
.
VSINAD98  CALL      XMLEND00
VSINAD99  RETURN
.
.---------------------------------------------------------------------------
. Output all fields from watproaf for procedure code
.---------------------------------------------------------------------------
OWTPRO00  CALL      XMLHED00
          BRANCH    EXIT,OWTPRO99
.
          WRITE     HTMLFILE;"<RETURN_VALUE TYPE=SIMPLE>";
.
OWTPRO10  PACK      VALDCODE,VALDCODE,SP70
.
          PACK      KEY9,VALDCODE,SP70
OWTPRO20  CALL      RDPROA1
          BRANCH    OVRCD,OWTPRO90
.
          WRITE     HTMLFILE;WPCODE,"|":               *  0
                             WPDESC,"|":               *  1
                             WPTIME,"|":               *  2
                             WPESTLS,"|":              *  3
                             WPGRP,"|":                *  4
                             WPRHAT,"|":               *  5
                             WPCHET,"|":               *  6
                             WTWPHDPE,"|":             *  7
                             WTWPDRGC,"|":             *  8
                             WTWPACTV,"|"              *  9
.
OWTPRO90  WRITE     HTMLFILE;"</RETURN_VALUE>"
          CALL      XMLEND00
.
OWTPRO99  RETURN
.
.---------------------------------------------------------------------------
. Cancel record of MVA on cancelling MVA Screen
.---------------------------------------------------------------------------
CANMVA00  CALL      XMLHED00
          BRANCH    EXIT,CANMVA99
.
          PACK      KEY11,VALDADMN,SP70
          CALL      RSPMEXT1
          CALL      RKPMEXT1
          BRANCH    OVRCD,CANMVA90
.
          MATCH     VALDADMN,PMEXVISN
          GOTO      CANMVA90 IF NOT EQUAL
.
          MOVE      "0",PMEXUYN1
          MOVE      SP70,PMEXCAT2
          CALL      UPPMEXT1
.
CANMVA90  WRITE     HTMLFILE;"<RETURN_VALUE TYPE=SIMPLE>";
          WRITE     HTMLFILE;"</RETURN_VALUE>"
          CALL      XMLEND00
.
CANMVA99  RETURN
.
.------------------------------------------------------------
. Output all fields from pardo1af for a doctor code
.------------------------------------------------------------
OPTDOC00  CALL      XMLHED00
          BRANCH    EXIT,OPTDOC99
.
          WRITE     HTMLFILE;"<RETURN_VALUE TYPE=SIMPLE>";
.
OPTDOC10  PACK      VALDCODE,VALDCODE,SP70
.
          PACK      KEY6,VALDCODE,SP70
OPTDOC20  CALL      RDDOCT1
          BRANCH    OVRCD,OPTDOC90
.
          MOVE      DTITL,FMTTITLE
          MOVE      DGNAME,FMTGNAME
          MOVE      DSNAME,FMTSNAME
          STRIP     FMTTITLE
          STRIP     FMTGNAME
          STRIP     FMTSNAME
          CALL      DOCNM000
.
          WRITE     HTMLFILE;DCODE,"|":             *  0
                             DTITL,"|":             *  1
                             DGNAME,"|":            *  2
                             DSNAME,"|":            *  3
                             DRTYPE,"|":            *  4
                             DRNAME,"|":            *  5
                             DSADD1,"|":            *  6
                             DSADD2,"|":            *  7
                             DSADD3,"|":            *  8
                             DSADD4,"|":            *  9
                             DSPOST,"|":            *  10
                             PTDOSEML,"|":          *  11
                             DTELES,"|":            *  12
                             DTELEP,"|":            *  13
                             DPAGER,"|":            *  14
                             DASSOC1,"|":           *  15
                             DASSOC2,"|":           *  16
                             DASSOC3,"|":           *  17
                             DASSOC4,"|":           *  18
                             DASSOC5,"|":           *  19
                             DPROV,"|":             *  20
                             DTELEH,"|":            *  21
                             DHADD1,"|":            *  22
                             DHADD2,"|":            *  23
                             DHADD3,"|":            *  24
                             DHADD4,"|":            *  25
                             DHPOST,"|":            *  26
                             PTDOHEML,"|":          *  27
                             DAFIRST,"|":           *  28
                             DALAST,"|":            *  29
                             DAYEARS,"|":           *  30
                             DACCRED,"|":           *  31
                             DRTYPE2,"|":           *  32
                             DRTYPE3,"|":           *  33
                             DRTYPE4,"|":           *  34
                             DRTYPE5,"|":           *  35
                             DFSPARE,"|":           *  36
                             DBIRTH,"|":            *  37
                             DHCSCOD,"|":           *  38
                             DALEVEL,"|":           *  39
                             DRSTAT,"|":            *  40
                             PTDOFAXN,"|":          *  41
                             PTDOHFAX,"|":          *  42
                             PTDOMOBL,"|":          *  43
                             PTDOGLCC,"|":          *  44
                             PTDOWHDP,"|":          *  45
                             PTDOMREG,"|":          *  46
                             PTDONHSN,"|":          *  47
                             DLUPDDTE,"|":          *  48
                             DLUPDTME,"|":          *  49
                             PTDOUDF1,"|":          *  50
                             PTDOUDF2,"|":          *  51
                             PTDOUDF3,"|":          *  52
                             PTDOUDF4,"|":          *  53
                             PTDOUDF5,"|":          *  54
                             PTDOINSC,"|":          *  55
                             PTDOINSN,"|":          *  56
                             PTDOINSF,"|":          *  57
                             PTDOINST,"|":          *  58
                             PTDOREGN,"|":          *  59
                             PTDOREGF,"|":          *  60
                             PTDOREGT,"|":          *  61
                             PTDOVISA,"|":          *  62
                             PTDOCOMT,"|":          *  63
                             PTDOPREF,"|":          *  64
                             PTDOABNN,"|":          *  65
                             PTDODINA,"|":          *  66
                             PTDODACT,"|":          *  67
                             PTDODACO,"|":          *  68
                             PTDOPRO2,"|":          *  69
                             PTDOPRO3,"|":          *  70
                             PTDOPRO4,"|":          *  71
                             PTDOPRO5,"|":          *  72
                             PTDOSDAT,"|":          *  73
                             PTDOEDAT,"|":          *  74
                             PTDOAUPD,"|":          *  75
                             PTDOHOSS,"|":          *  76
                             PTDOEXML,"|":          *  77
                             PTDODEAC,"|":          *  78
                             PTDOAHC1,"|":          *  79
                             PTDOAHC2,"|":          *  80
                             PTDOAHC3,"|":          *  81
.
                             DOCFNAME,"|"           *  82
.
OPTDOC90  WRITE     HTMLFILE;"</RETURN_VALUE>"
          CALL      XMLEND00
.
OPTDOC99  RETURN
.
.------------------------------------------------------------
. Validate existance of invoice in webihcaf
.------------------------------------------------------------
VLDIHC00  CALL      XMLHED00
          BRANCH    EXIT,VLDIHC90
.
          PACK      KEY8,ADMISSNO,SP70
          CALL      RDMISS1
          IF        OVRCD=1
            WRITE     HTMLFILE;"<RETURN_VALUE TYPE=ERROR>":
                               "Visit number ",ADMISSNO," not on file. ":
                               "</RETURN_VALUE>"
            GOTO      VLDIHC90
          ELSE IF
            PACK      KEY8,ADMISSNO,SP70
            CALL      RDPMVX11
            IF        OVRCD=1
              WRITE     HTMLFILE;"<RETURN_VALUE TYPE=ERROR>":
                                 "Visit extension ",ADMISSNO," not on file. ":
                                 "</RETURN_VALUE>"
              GOTO      VLDIHC90
            ENDIF
          ENDIF
.
          IF        FUNDTYPE=1
            PACK      KEY5,ANSC,ANSL,VALDHLFN
            CALL      RDCODE1
            IF        OVRCD=1
              WRITE     HTMLFILE;"<RETURN_VALUE TYPE=ERROR>":
                                 "Claim Code ",VALDHLFN," not on file. ":
                                 "</RETURN_VALUE>"
              GOTO      VLDIHC90
            ENDIF
            MOVE      VALDHLFN,DIM3
            MATCH     DIM3,ACLAIM
            IF        !@EQUAL
              WRITE     HTMLFILE;"<RETURN_VALUE TYPE=ERROR>":
                                 "Claim Code does not match.":
                                 "</RETURN_VALUE>"
              GOTO      VLDIHC90
            ENDIF
            MOVE      ZERO,VALDDVCL
            MOVE      ZERO,FORM1
            WHILE     FORM1<5
              ADD       ONE,FORM1
              LOAD      ANS,FORM1,TCINDC1,TCINDC2,TCINDC3,TCINDC4,TCINDC5
              MATCH     ANSV,ANS
              IF        @EQUAL
                MOVE      ONE,VALDDVCL
              ENDIF
            DO
            IF        FORM1=0
              WRITE     HTMLFILE;"<RETURN_VALUE TYPE=ERROR>":
                                 "Only DVA claims are valid claim types.":
                                 "</RETURN_VALUE>"
              GOTO      VLDIHC90
            ENDIF
          ENDIF
.
          IF        FUNDTYPE=0
            PACK      KEY5,ANSC,ANSL,ACLAIM
            CALL      RDCODE1
            IF        OVRCD=1
              WRITE     HTMLFILE;"<RETURN_VALUE TYPE=ERROR>":
                                 "Health Fund Code ",ACLAIM," not on file. ":
                                 "</RETURN_VALUE>"
              GOTO      VLDIHC90
            ENDIF
            MOVE      ZERO,FORM1
            WHILE     FORM1 < 5
              ADD       ONE,FORM1
              LOAD      ANS,FORM1,TCINDC1,TCINDC2,TCINDC3,TCINDC4,TCINDC5
              MATCH     ANSV,ANS
              IF        @EQUAL
                WRITE     HTMLFILE;"<RETURN_VALUE TYPE=ERROR>":
                                   "Process DVC claims by claim code.":
                                   "</RETURN_VALUE>"
                GOTO      VLDIHC90
              ENDIF
            DO
            MATCH     VALDHLFN,AFUNDH
            IF        !@EQUAL
              WRITE     HTMLFILE;"<RETURN_VALUE TYPE=ERROR>":
                                 "Health Fund doesn't match.":
                                 "</RETURN_VALUE>"
              GOTO      VLDIHC90
            ENDIF
          ENDIF
.
          PACK      KEY16,VALDCODE,SP70
          CALL      RDWBIHC2
          BRANCH    OVRCD,VLDIHC89
.
          WRITE     HTMLFILE;"<RETURN_VALUE TYPE=ERROR>":
                             "Invoice Number Already Exists. ":
                             "</RETURN_VALUE>"
          GOTO      VLDIHC90
.
VLDIHC89  WRITE     HTMLFILE;"<RETURN_VALUE TYPE=SIMPLE></RETURN_VALUE>";
.
VLDIHC90  CALL      XMLEND00
VLDIHC99  RETURN
+
*******************************************************************************
.
          INC       IBAWEBCD
          INC       WEBDATCD
          INC       DAYOFWEK
          INC       CLCOMPAR
          INC       CLPRIHTR
          INC       CLPATDSC
          INC       CLPATMIS
          INC       CLPMSHCP
          INC       CLPMSHCG
          INC       CLPMSHCL
          INC       CLPMSNPL
          INC       VALCONTR
          INC       GETCNEFF
.
          INC       AAEDTRIO/INC
          INC       ALLCCTIO/INC
          INC       ALLDEPIO/INC
          INC       IBAALVIO/INC
          INC       BOKRC1IO/INC
          INC       OUTBOAIO/INC
          INC       OUTBB1IO/INC
          INC       BOKRX1IO/INC
          INC       COMPARIO/INC
          INC       EMRPWDIO/INC
          INC       EMRICDIO/INC
          INC       EMRHISIO/INC
          INC       EMRVISIO/INC
          INC       EMRECHIO/INC
          INC       EMRECLIO/INC

          INC       MLTHCPIO/INC
.
          INC       OUTCVTIO/INC
          INC       OUTSITIO/INC
          INC       OUTCANIO/INC
.
          INC       PATCANIO/INC
          INC       PATCFAIO/INC
          INC       PATDSCIO/INC
          INC       PATFX1IO/INC
          INC       PATDO1IO/INC
          INC       PATMCHIO/INC
          INC       PATMI1IO/INC
          INC       PATBDEIO/INC
          INC       PATBFEIO/INC
          INC       PATELGIO/INC
          INC       PATPCPIO/INC
          INC       PATATRIO/INC
          INC       PATINVIO/INC
          INC       PATTRNIO/INC
          INC       PATVISIO/INC
          INC       RCPREGIO/INC
          INC       CLPATATR
          INC       NZPBFEIO/INC
          INC       PATFN1IO/INC
          INC       PATHSPIO/INC
          INC       PMSCIDIO/INC
          INC       PMSMTIIO/INC
          INC       PMSNPLIO/INC
.
          INC       PATQMHIO/INC
          INC       PATWR1IO/INC
          INC       PMSBDCIO/INC
          INC       PMSBRQIO/INC
          INC       PMSCCDIO/INC
          INC       PMSCEXIO/INC
          INC       PMSELFIO/INC
          INC       PMSEXTIO/INC
          INC       PMSHCPIO/INC
          INC       PMSHCGIO/INC
          INC       PMSHCLIO/INC
          INC       PMSVSCIO/INC
          INC       PMSVX1IO/INC
          INC       PRIHDBIO/INC
          INC       PRIHREIO/INC
          INC       PRIHTRIO/INC
          INC       PRIITMIO/INC
.
          INC       PRIPRAIO/INC
          INC       PRISECIO/INC                 * Access to Indiv Med Prac
          INC       PRIALSIO/INC                 * Access to All Med Prac
          INC       PRIDOCIO/INC
.
          INC       MRTMASIO/INC
          INC       MRTVISIO/INC 
          INC       OPRTRAIO/INC 
          INC       NZPMCHIO/INC            * NZP Misc Item File
          INC       OPREQPIO/INC 
.
          INC       WEBELFIO/INC
          INC       WEBERHIO/INC
          INC       WEBPCPIO/INC
          INC       WEBIHCIO/INC
          INC       WATPROIO/INC
.         
          INC       NAMSTRCD
          INC       PATDOCCD
          INC       PATMCHRD
          INC       EMRDRCHR
.
 
