.----------------------------------------------------------------------
. Program       : PATWEB18
.
. Function      : ABF Tables Maintenance
.
. Modifications :
.----------------------------------------------------------------------
. V12.00.01 27/05/2025 J.Tan            TSK 0961141
.           Fixed checking Care Type filter for ABF Sub -Acute PW Maintenance
. V11.03.04 03/07/2023 J.Tan            TSK 0923703
.           Fixed Next and Previous page for ABF Admitted MH Price Weights
. V11.03.03 24.05.2023 DA Sarkies       TSK 0923703
.           Added code for maintainance program of ABF Admitted MH Price Weights
. V11.03.02 27/02/2023 Alina Bhari      TSK 0929788
.           Displayed the long description in HAC Group column
. V11.03.01 24/01/2023 PJ Le Febour     TSK 0928588
.           to accommodate the new size for Type of Visit 
.           amended KEY10 to be KEY15 
. V11.02.06 20/09/2022 J.Tan            TSK 0906597
.           Mod for Referral and Sub-Acute ABF/NWAU 
. V11.02.05 01/09/2022 Bella Turco      TSK 0906597
.           Added in a REP to replace "+" with " " for PMSAW004 CGI           
. V11.02.04 23/08/2022 Bella Turco      TSK 0906597
.           Opened indexes PMSSAWA3 to use to search by Care Type in Sub-Acute
. V11.01.03 03/08/2022 Bella Turco      TSK 0906597
.           Created new report no 8 for ABF Sub-Acute Patients PW
. V11.01.02 11/11/2021 J.Tan      TSK 0913621
.           Recompiled for PMSNEPTM - removed Events visit type from Selection
. V11.01.01 08/09/2021 J.Tan      TSK 0906222
.           Added Multiple NEP Values
. V10.14.05 03/10/2019  J.Tan           TSK 0857392
.           Recompiled for OUTPWOTM - Tier 2 code description
. V10.14.04 13/09/2019  Richa Phogat    TSK 0857392
.           Fixed code for ABF Emergency URG Classification Table by adding 
.           EFFENDDT for Previous and Next button search
. V10.14.03 09/09/2019  Richa Phogat    TSK 0881202
.           Updated NXTPW000 by correcting typo error for OTPWO001/OTPWO002
. V10.14.02 09/09/2019  J.Tan           TSK 0857392
.           Recompiled for ABF invoice
. V10.14.01 20/09/2019 J.Tan         TSK 0857392
.           Mod to use TDESC for code description instead of long description
. V10.14.00 01/04/2019 J.Tan         TSK 0857392
.           Created new server for ABF tables
.           08/04/2019 Richa Phogat  TSK 0857392
.           Added code for ABF Non Admitted Price Weights List
.           10/04/2019 Richa Phogat  TSK 0857392
.           Added code for ABF EMR Dept Price Weights List
.           11/04/2019 Richa Phogat  TSK 0857392
.           Added Code for ABF Radiotherapy/Dialysis Codes table 
.           16/04/2019 Richa Phogat  TSK 0857392
.           Added Code for ABF HAC Adjustment Table
.           30/04/2019 Richa Phogat  TSK 0857392
.           Added Code for ABF Emergency URG Classification Table 
.           30/04/2019 Richa Phogat  TSK 0857392
.           Added condition under PMSHAD20 to add a record to Audit file only 
.           when some changes are done to previous record
.----------------------------------------------------------------------
          INC       IBAWEBDF
          INC       WEBDATDF
          INC       RSHWEBDF
.
          INC       PMSNEPFD/INC
          INC       PMSNEPTD/INC
          INC       EMRURGFD/INC
          INC       EMRURGTD/INC
          INC       EMRPWDFD/INC
          INC       EMRPWDTD/INC
          INC       OUTPWOFD/INC
          INC       OUTPWOTD/INC
          INC       PATCONFD/INC
          INC       PATICOFD/INC
          INC       PMSAUAFD/INC
          INC       PMSHADTD/INC
          INC       PMSHADFD/INC
          INC       PMSPWATD/INC
          INC       PMSPWAFD/INC
          INC       PMSSAWTD/INC
          INC       PMSSNPFD/INC
          INC       PMSSNPTD/INC
          INC       PMSSAWFD/INC
          INC       PMSRDITD/INC
          INC       PMSRDIFD/INC
          INC       PMSCIDFD/INC
          INC       PMSAMHFD/INC
          INC       PMSAMHTD/INC
.
          INC       TFILEVAR/INC
.
.----------------------------------------------------------------------
. CGI Parameters
.----------------------------------------------------------------------
VALDTYPE  FORM      1         * Validation Type
DRGDESC1  DIM       80        * DRG Description
CARETYPE  DIM       2         * Care Type
SNAPDESC  DIM       80        * AN-SNAP Description
EFENDDAT  DIM       20        * Effective End Date
EPISDESC  DIM       80        * Episode End Status Description
TRIADESC  DIM       80        * Triage Code Description
VISTDESC  DIM       80        * Type of Visit Description
TYPOFCED  DIM       50        * Type of Code Description
CODSYDES  DIM       50        * Coding System Description
ICD10DES  DIM       200     
EFFENDDT  DIM       11        * Effective End Date for next & previous button
DIM11     DIM       11
.
MENUFLAG  DIM       1         * Menu Type (Maintenance/Enquiry)
NEXTPAGE  DIM       1
NOMULNEP  FORM      1
NOPMSSAW  FORM      1
NOPMMANH  FORM      1
UPDTTYPE  DIM       1         * Update Type
STARTKEY  DIM       10        * Starting Key
CURRDATE  DIM       8
OLDPMVAL  DIM       3         * Old 'Value To' from ABF HAC Adjustment table
OLDPMADJ  FORM      10.4      * Old Complexity Adjustment %
CATAA     INIT      "AA"
CATED     INIT      "ED"
CATee     INIT      "ee"
CATHa     INIT      "Ha"
CATNC     INIT      "NC"
.
.----------------------------------------------------------------------
. Program Variables
.----------------------------------------------------------------------
FNAME     DIM       8
COUNT     FORM      2
LOOPCNTR  FORM      8
.
.----------------------------------------------------------------------
PRGID     INIT      "PATWEB18"
VERSION   INIT      "V12.01.00"
PRGNAM    INIT      "ABF Table Maintenance"
.----------------------------------------------------------------------
          CALL      WEBINT00       * Initialise Fifo Etc.
          CALL      INIT0000       * Open Files
.
MAIN1000  CALL      WEBRED00       * Read Fifo WEBPID and USERID
.
          COMPARE   "999",REPORTNO * End Server Process on Report Option 999
          GOTO      MAIN9999 IF EQUAL
.
          BRANCH    REPORTNO,MAIN1100,MAIN1200,MAIN1300,MAIN1400,MAIN1500:
                             MAIN1600,MAIN1700,MAIN1800,MAIN1900
.
          PACK      WEBTITLE,PRGID,SP1,VERSION,SP1,PRGNAM,SP70
          MOVE      "Invalid Option",WEBTITLE
          CALL      WEBERR00   * Create Output File and Write HTML Page Header
          GOTO      MAIN1000
.
MAIN1100  CALL      PMSPWA00        * ABF Admitted Acute price weights
          BRANCH    EXIT,MAIN1000
          MOVE      "Update Complete",WEBTITLE
          CALL      NXTPAG00
          GOTO      MAIN1000
.
MAIN1200  CALL      OUTPWO00        * ABF Non Admitted Price Weights List
          BRANCH    EXIT,MAIN1000
          MOVE      "Update Complete",WEBTITLE
          CALL      NXTPAG00
          GOTO      MAIN1000
.
MAIN1300  CALL      EMRPWD00        * ABF Emergency Dept Price Weights List
          BRANCH    EXIT,MAIN1000
          MOVE      "Update Complete",WEBTITLE
          CALL      NXTPAG00
          GOTO      MAIN1000
.
MAIN1400  CALL      PMSRDI00        * ABF Radiotherapy/Dialysis Codes
          BRANCH    EXIT,MAIN1000
          MOVE      "Update Complete",WEBTITLE
          CALL      NXTPAG00
          GOTO      MAIN1000
.
MAIN1500  CALL      PMSHAD00        * ABF HAC Adjustments Table
          BRANCH    EXIT,MAIN1000
          MOVE      "Update Complete",WEBTITLE
          CALL      NXTPAG00
          GOTO      MAIN1000
.
MAIN1600  CALL      EMRURG00        * ABF Emergency URG Classification Table
          BRANCH    EXIT,MAIN1000
          MOVE      "Update Complete",WEBTITLE
          CALL      NXTPAG00
          GOTO      MAIN1000
.
MAIN1700  CALL      MNEPVL00        * Multiple NEP Values
          BRANCH    EXIT,MAIN1000
          MOVE      "Update Complete",WEBTITLE
          CALL      NXTPAG00
          GOTO      MAIN1000
.
MAIN1800  CALL      PMSSAW00        * ABF Sub-Acute Price Weights
          BRANCH    EXIT,MAIN1000
          MOVE      "Update Complete",WEBTITLE
          CALL      NXTPAG00
          GOTO      MAIN1000
.
MAIN1900  CALL      PMMANH00        * Admitted MH Price Weights
          BRANCH    EXIT,MAIN1000
          MOVE      "Update Complete",WEBTITLE
          CALL      NXTPAG00
          GOTO      MAIN1000
.
MAIN9999  MOVE      "SERVER SHUTDOWN COMPLETE",WEBTITLE
          CALL      WEBERR00
          STOP
.------------------------------------------------------------
. Output Next Page Based on CGI Parameter nextpage
.------------------------------------------------------------
NXTPAG00  MOVE      ZERO,F1
          MOVE      NEXTPAGE,F1
.
          BRANCH    F1,NXTPAG10,NXTPAG20,NXTPAG30,NXTPAG40
.
          CALL      WINCLS00
          GOTO      NXTPAG99
.
NXTPAG10  CALL      RDIREC00
          GOTO      NXTPAG99
.
NXTPAG20  CALL      GOBACK00      * Go Back 1 Html page
          GOTO      NXTPAG99
.
NXTPAG30  CALL      DAH20000      * Go Back 2 html pages
          GOTO      NXTPAG99
.
NXTPAG40  CALL      PREDIR00      * Redirect Parent
          GOTO      NXTPAG99
.
NXTPAG99  RETURN
.
.------------------------------------------------------------------------------
.  Redirect Parent URL
.------------------------------------------------------------------------------
PREDIR00  CALL      OPENHTML
          BRANCH    EXIT,PREDIR90
.
          WRITE     HTMLFILE;"<script type=#"text/javascript#"> {":
                             " parent.location.href=#"",REDIRECT,"#";":
                             "}":
                             "</script>"
          CALL      CLOSHTML
          GOTO      PREDIR99
.
PREDIR90  DISPLAY   "*** Fifo Not Found ***"
.
PREDIR99  RETURN
.
.------------------------------------------------------------------------------
.  Goes back x number of pages
.------------------------------------------------------------------------------
GOBACK00  CALL      OPENHTML
          BRANCH    EXIT,GOBACK99
          MOVE      NEXTPAGE,F1
          SUB       TWO,F1
          WRITE     HTMLFILE;"<script type=#"text/javascript#"> {":
                             "    alert(#"",WEBTITLE,"#");":
.                            "    self.close();":
                             "    window.history.go(-",F1,");":
                             "}":
                             "</script>"
          CALL      CLOSHTML
GOBACK99  RETURN
.------------------------------------------------------------
. Open Files and Initialize Variables
.------------------------------------------------------------
INIT0000  OPEN      CONTROLF,"controlf"
.
          OPEN      EMRPWDA1,"emrpwdaf"
          OPEN      EMRPWDA2,"emrpwdaf"
          OPEN      EMRURGA1,"emrurgaf"
          OPEN      EMRURGA2,"emrurgaf"
          OPEN      EMRURGA3,"emrurgaf"
          OPEN      EMRURGA4,"emrurgaf"
          OPEN      EMRURGA5,"emrurgaf"
          OPEN      OUTPWOA1,"outpwoaf"
          OPEN      OUTPWOA2,"outpwoaf"
          OPEN      PATCODE1,"patcodes"
          OPEN      PATCODE2,"patcodes"
          OPEN      PMSAUAA1,"pmsauaaf"
          OPEN      PMSAUAA2,"pmsauaaf"
          OPEN      PMSHADA1,"pmshadaf"
          OPEN      PMSHADA2,"pmshadaf"
          OPEN      PMSPWAA1,"pmspwaaf"
          OPEN      PMSSNPA1,"pmssnpaf"
          OPEN      PMSPWAA2,"pmspwaaf"
          OPEN      PMSRDIA1,"pmsrdiaf"
          OPEN      PMSRDIA2,"pmsrdiaf"
          OPEN      PMSRDIA3,"pmsrdiaf"
          OPEN      PMSRDIA4,"pmsrdiaf"
          CALL      OPICO1
.
          OPEN      PMSCIDA1,"pmscidaf"
.
          MOVE      ZERO,NOPMSSAW            * ABF Sub-Acute PW flag
          MOVE      ZERO,OVRCD               * assume file exists
          TRAP      OVERCOND IF IO           * trap for error opening file
          OPEN      PMSSAWA1,"pmssawaf"
          TRAPCLR   IO
          IF        OVRCD=1
            MOVE      ONE,NOPMSSAW
          ELSE
            OPEN      PMSSAWA2,"pmssawaf"
            OPEN      PMSSAWA3,"pmssawaf"
          ENDIF
.
          MOVE      ZERO,NOPMMANH            * ABF Admitted MH Price Weights
          MOVE      ZERO,OVRCD               * assume file exists
          TRAP      OVERCOND IF IO           * trap for error opening file
          OPEN      PMSAMHA1,"pmsamhaf"
          TRAPCLR   IO
          IF        OVRCD=1
            MOVE      ONE,NOPMMANH
          ELSE
            OPEN      PMSAMHA2,"pmsamhaf"
          ENDIF
.
          MOVE      ZERO,NOMULNEP            * Multiple NEP values flag
          MOVE      ZERO,OVRCD               * assume file exists
          TRAP      OVERCOND IF IO           * trap for error openning file
          OPEN      PMSNEPA1,"pmsnepaf"
          TRAPCLR   IO
          IF        OVRCD=1
            MOVE      ONE,NOMULNEP
          ELSE
            OPEN      PMSNEPA2,"pmsnepaf"
          ENDIF
.
INIT9999  RETURN
+
.------------------------------------------------------------
. Clear Parameters
.------------------------------------------------------------
CLRPAR00  MOVE      ZERO,REPORTNO
          MOVE      SP70,TEMPLATE
          MOVE      SP70,NEXTPAGE
          PACK      REDIRECT,SP70,SP70,SP70,SP70
          MOVE      SP70,UPDTTYPE
.
          MOVE      ZERO,NORECORD
          MOVE      ZERO,STARTNUM
          MOVE      SP70,STARTKEY
          MOVE      ZERO,VALDTYPE
          MOVE      SP70,DRGDESC1
          MOVE      SP70,SNAPDESC
          MOVE      SP70,CARETYPE
          MOVE      SP70,EFENDDAT
          MOVE      SP70,EPISDESC
          MOVE      SP70,TRIADESC
          MOVE      SP70,VISTDESC
          MOVE      SP70,TYPOFCED
          MOVE      SP70,CODSYDES
          MOVE      SP70,ICD10DES
          MOVE      SP70,MENUFLAG
          MOVE      SP70,OLDPMVAL
          MOVE      ZERO,OLDPMADJ
          MOVE      SP70,EFFENDDT
.
          CALL      CLRHAD00                * HAC Adjustments table
          CALL      CLRPWA00                * NZ private bed fee
          CALL      CLRSAW00                * ABF Sub-Acute PW List (Parameters)
          CALL      CLCSAW00                * ABF Sub-Acute PW List (CGIs)
          CALL      CLSANH00                * ABF Admitted MH  PW List (Param)
          CALL      CLRANH00                * ABF Admitted MH  PW List (CGIs)
          CALL      CLRPWD00                * EMR Dept PW List
          CALL      CLRPWO00                * ABF Non-Admitted PW list
          CALL      CLRURG00                * ABF EMR URG Classification table
          CALL      CLRRDI00                * ABF Radiotherapy/Dialysis codes
          CALL      CLRNEP00                * Multiple NEP Values
.
CLRPAR99  RETURN
+
.------------------------------------------------------------
. Set Parameters
.------------------------------------------------------------
SETPAR00  MATCH     "reportno=",QRYNAME
          IF        @EQUAL
            MOVE      QRYDATA,REPORTNO
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "template=",QRYNAME
          IF        @EQUAL
            MOVE      QRYDATA,TEMPLATE
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "updttype=",QRYNAME
          IF        @EQUAL
            MOVE      QRYDATA,UPDTTYPE
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "nextpage=",QRYNAME
          IF        @EQUAL
            MOVE      QRYDATA,NEXTPAGE
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "redirect=",QRYNAME
          IF        @EQUAL
            MOVE      QRYDATA,REDIRECT
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "menuflag=",QRYNAME
          IF        @EQUAL
            MOVE      QRYDATA,MENUFLAG
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "startkey=",QRYNAME
          IF        @EQUAL
            MOVE      QRYDATA,STARTKEY
            PACK      STARTKEY,STARTKEY,SP70
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "norecord=",QRYNAME
          IF        @EQUAL
            MOVE      QRYDATA,NORECORD
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "startnum=",QRYNAME
          IF        @EQUAL
            MOVE      QRYDATA,STARTNUM
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "erpwd",QRYNAME
          IF        @EQUAL
            CALL      SPPWD000
            COMPARE   ZERO,EXIT
            GOTO      SETPAR99 IF EQUAL
          ENDIF
.
          MATCH     "erurg",QRYNAME
          IF        @EQUAL
            CALL      SPURG000
            COMPARE   ZERO,EXIT
            GOTO      SETPAR99 IF EQUAL
          ENDIF
.
          MATCH     "otpwo",QRYNAME
          IF        @EQUAL
            CALL      SPOPW000
            COMPARE   ZERO,EXIT
            GOTO      SETPAR99 IF EQUAL
          ENDIF
.
          MATCH     "pmhad",QRYNAME
          IF        @EQUAL
            CALL      SPPHD000
            COMPARE   ZERO,EXIT
            GOTO      SETPAR99 IF EQUAL
          ENDIF
.
          MATCH     "pmpwa",QRYNAME
          IF        @EQUAL
            CALL      SPPPW000
            COMPARE   ZERO,EXIT
            GOTO      SETPAR99 IF EQUAL
          ENDIF
.
          MATCH     "pmsaw",QRYNAME
          IF        @EQUAL
            CALL      SPPSA000
            COMPARE   ZERO,EXIT
            GOTO      SETPAR99 IF EQUAL
          ENDIF
.

          MATCH     "pmrdi",QRYNAME
          IF        @EQUAL
            CALL      SPPRD000
            COMPARE   ZERO,EXIT
            GOTO      SETPAR99 IF EQUAL
          ENDIF
.
          MATCH     "pmnep",QRYNAME
          IF        @EQUAL
            CALL     SPPNE000
            COMPARE   ZERO,EXIT
            GOTO      SETPAR99 IF EQUAL
          ENDIF
.
          MATCH     "pmamh",QRYNAME
          IF        @EQUAL
            CALL      SPMAN000
            COMPARE   ZERO,EXIT
            GOTO      SETPAR99 IF EQUAL
          ENDIF
.
          MATCH     "valdtype=",QRYNAME
          IF        @EQUAL
            MOVE      QRYDATA,VALDTYPE
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "drgdesc1=",QRYNAME
          IF        @EQUAL
            MOVE      QRYDATA,DRGDESC1
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "snapdesc=",QRYNAME
          IF        @EQUAL
            MOVE      QRYDATA,SNAPDESC
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "caretype=",QRYNAME
          IF        @EQUAL
            MOVE      QRYDATA,CARETYPE
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "effenddt=",QRYNAME
          IF        @EQUAL
            MOVE      QRYDATA,EFFENDDT
            UNPACK    QRYDATA,CDAY,KEY1,MTHNAM3,KEY1,CCENT,CYEAR
            CALL      SETMTH00              * Set CMON from MTHNAM3
            PACK      ERURG001,CCENT,CYEAR,CMON,CDAY
            GOTO      SETPAR99
          ENDIF
.
SETPAR99  RETURN
+
.------------------------------------------------------------------------------
. ABF Admitted Acute price weights : Display,Add,Update,Delete
.------------------------------------------------------------------------------
PMSPWA00  RESET     UPDTTYPE
          MATCH     SP70,UPDTTYPE           * Display formaction
          GOTO      PMSPWA80 IF EQUAL
.
          MATCH     "A",UPDTTYPE            * Add formaction
          GOTO      PMSPWA10 IF EQUAL
.
          MATCH     "U",UPDTTYPE            * Update formaction
          GOTO      PMSPWA20 IF EQUAL
.
          MATCH     "D",UPDTTYPE            * Delete formaction
          GOTO      PMSPWA30 IF EQUAL
.
          GOTO      PMSPWA93
.
.   **********  ADD FORMACTION  **********
.
PMSPWA10  CALL      CLPMSPWA
.
          PACK      KEY10,PMPWA001,PMPWA002,SP70
          CALL      RDPMPWA1
          COMPARE   ZERO,OVRCD
          GOTO      PMSPWA92 IF EQUAL
.
          CALL      MVPMPW00
.
          MOVE      USERID,PMPWCUID
          CALL      IBACLOCK
          PACK      PMPWCDAT,CCC,CYY,CMM,CDD
          REP       " 0",PMPWCDAT
          MOVE      CTIMEIS,PMPWCTIM
.
          PACK      KEY10,PMPWCNTR,PMPWDRGC,SP70
          CALL      WRPMPWA1
          GOTO      PMSPWA98
.
.   **********  UPDATE FORMACTION  **********
.
PMSPWA20  PACK      KEY10,PMPWA001,PMPWA002,SP70
          CALL      RDPMPWA1
          BRANCH    OVRCD,PMSPWA91
.
          MOVE      PMPWA003,PMPWDRGD
          MOVE      PMPWA004,PMPWSDPY
          MOVE      PMPWA005,PMPWBICU
          MOVE      PMPWA006,PMPWALOS
          MOVE      PMPWA007,PMPWLOWB
          MOVE      PMPWA008,PMPWUPPB
          MOVE      PMPWA009,PMPWPSRV
          MOVE      PMPWA010,PMPWPAED
          MOVE      PMPWA011,PMPWSDAY
          MOVE      PMPWA012,PMPWSSOB
          MOVE      PMPWA013,PMPWSSOP
          MOVE      PMPWA014,PMPWINLI
          MOVE      PMPWA015,PMPWLSOP
.
          MOVE      USERID,PMPWUUID
          CALL      IBACLOCK
          PACK      PMPWUDAT,CCC,CYY,CMM,CDD
          REP       " 0",PMPWUDAT
          MOVE      CTIMEIS,PMPWUTIM
.
          CALL      UPPMPWA1
          GOTO      PMSPWA98
.
.   **********  DELETE FORMACTION  **********
.
PMSPWA30  PACK      KEY10,PMPWA001,PMPWA002,SP70
          CALL      RDPMPWA1
          BRANCH    OVRCD,PMSPWA91
.
          CALL      DEPMPWA1
          GOTO      PMSPWA98
.
.   **********  DISPLAY FORMACTION  **********
.
PMSPWA80  MOVE      ZERO,EXIT
          PACK      KEY10,PMPWA001,PMPWA002,SP70
          CALL      RDPMPWA1
          IF        OVRCD=1
            CALL      CLPMSPWA
          ENDIF
.
PMSPWA82  CLEAR     WEBTITLE
          MOVE      "ABF Admitted Acute Patients Price Weights Maintenance",WEBTITLE
          RESET     WEBTITLE
.
          CALL      WEBHED00   * Create Output File and Write HTML Page Header
          BRANCH    EXIT,PMSPWA99
          CALL      WEBBOD00   * Process Web Body
          CALL      WEBEND00   * Process End of HTML File
.
          MOVE      ONE,EXIT
          GOTO      PMSPWA99
.
PMSPWA91  MOVE      "Record does not exist",WEBTITLE
          CALL      WEBERR00
          MOVE      ONE,EXIT
          GOTO      PMSPWA99
.
PMSPWA92  MOVE      "Record already exists",WEBTITLE
          CALL      WEBERR00
          MOVE      ONE,EXIT
          GOTO      PMSPWA99
.
PMSPWA93  MOVE      "Invalid Form Action.",WEBTITLE
          CALL      WEBERR00
          MOVE      ONE,EXIT
          GOTO      PMSPWA99
.
PMSPWA98  MOVE      ZERO,EXIT
PMSPWA99  RETURN
+
.------------------------------------------------------------------------------
. ABF Non Admitting PW List Maintenance: Display,Add,Update,Delete
.------------------------------------------------------------------------------
OUTPWO00  RESET     UPDTTYPE
          MATCH     SP70,UPDTTYPE           * Display formaction
          GOTO      OUTPWO80 IF EQUAL
.
          MATCH     "A",UPDTTYPE            * Add formaction
          GOTO      OUTPWO10 IF EQUAL
.
          MATCH     "U",UPDTTYPE            * Update formaction
          GOTO      OUTPWO20 IF EQUAL
.
          MATCH     "D",UPDTTYPE            * Delete formaction
          GOTO      OUTPWO30 IF EQUAL
.
          GOTO      OUTPWO93
.
.   **********  ADD FORMACTION  **********
.
OUTPWO10  CALL      CLOUTPWO
.
          PACK      KEY9,OTPWO001,OTPWO002,SP70
          CALL      RDOTPWO1
          COMPARE   ZERO,OVRCD
          GOTO      OUTPWO92 IF EQUAL
.
          CALL      MVOTPW00
.
          MOVE      USERID,OTPWCUID
          CALL      IBACLOCK
          PACK      OTPWCDAT,CCC,CYY,CMM,CDD
          REP       " 0",OTPWCDAT
          MOVE      CTIMEIS,OTPWCTIM
.
          PACK      KEY9,OTPWCNTR,OTPWTIER,SP70
          CALL      WROTPWO1
          GOTO      OUTPWO98
.
.   **********  UPDATE FORMACTION  **********
.
OUTPWO20  CALL      CLOUTPWO
.
          PACK      KEY9,OTPWO001,OTPWO002,SP70
          CALL      RDOTPWO1
          BRANCH    OVRCD,OUTPWO91
.
          CALL      MVOTPW00
.
          MOVE      USERID,OTPWUUID
          CALL      IBACLOCK
          PACK      OTPWUDAT,CCC,CYY,CMM,CDD
          REP       " 0",OTPWUDAT
          MOVE      CTIMEIS,OTPWUTIM
.
          CALL      UPOTPWO1
          GOTO      OUTPWO98
.
.   **********  DELETE FORMACTION  **********
.
OUTPWO30  PACK      KEY9,OTPWO001,OTPWO002,SP70
          CALL      RDOTPWO1
          BRANCH    OVRCD,OUTPWO91
.
          CALL      DEOTPWO1
          GOTO      OUTPWO98
.
.   **********  DISPLAY FORMACTION  **********
.
OUTPWO80  MOVE      ZERO,EXIT
          PACK      KEY9,OTPWO001,OTPWO002,SP70
          CALL      RDOTPWO1
          IF        OVRCD=1
            CALL      CLOUTPWO
          ENDIF
.
OUTPWO82  CLEAR     WEBTITLE
          MOVE      "ABF Non Admitted Price Weights Maintenance",WEBTITLE
          RESET     WEBTITLE
.
          CALL      WEBHED00   * Create Output File and Write HTML Page Header
          BRANCH    EXIT,OUTPWO99
          CALL      WEBBOD00   * Process Web Body
          CALL      WEBEND00   * Process End of HTML File
.
          MOVE      ONE,EXIT
          GOTO      OUTPWO99
.
OUTPWO91  MOVE      "Record does not exist",WEBTITLE
          CALL      WEBERR00
          MOVE      ONE,EXIT
          GOTO      OUTPWO99
.
OUTPWO92  MOVE      "Record already exists",WEBTITLE
          CALL      WEBERR00
          MOVE      ONE,EXIT
          GOTO      OUTPWO99
.
OUTPWO93  MOVE      "Invalid Form Action.",WEBTITLE
          CALL      WEBERR00
          MOVE      ONE,EXIT
          GOTO      OUTPWO99
.
OUTPWO98  MOVE      ZERO,EXIT
OUTPWO99  RETURN
+
.------------------------------------------------------------------------------
. ABF Emergency Dept PW List Maintenance: Display,Add,Update,Delete
.------------------------------------------------------------------------------
EMRPWD00  RESET     UPDTTYPE
          MATCH     SP70,UPDTTYPE           * Display formaction
          GOTO      EMRPWD80 IF EQUAL
.
          MATCH     "A",UPDTTYPE            * Add formaction
          GOTO      EMRPWD10 IF EQUAL
.
          MATCH     "U",UPDTTYPE            * Update formaction
          GOTO      EMRPWD20 IF EQUAL
.
          MATCH     "D",UPDTTYPE            * Delete formaction
          GOTO      EMRPWD30 IF EQUAL
.
          GOTO      EMRPWD93
.
.   **********  ADD FORMACTION  **********
.
EMRPWD10  CALL      CLEMRPWD
.
          PACK      KEY12,ERPWD001,ERPWD002,SP70
          CALL      RDEMPWD1
          COMPARE   ZERO,OVRCD
          GOTO      EMRPWD92 IF EQUAL
.
          CALL      MVERPW00
.
          MOVE      USERID,EMPWCUID
          CALL      IBACLOCK
          PACK      EMPWCDAT,CCC,CYY,CMM,CDD
          REP       " 0",EMPWCDAT
          MOVE      CTIMEIS,EMPWCTIM
.
          PACK      KEY12,EMPWCNTR,EMPWURGV,SP70
          CALL      WREMPWD1
          GOTO      EMRPWD98
.
.   **********  UPDATE FORMACTION  **********
.
EMRPWD20  CALL      CLEMRPWD
.
          PACK      KEY12,ERPWD001,ERPWD002,SP70
          CALL      RDEMPWD1
          BRANCH    OVRCD,EMRPWD91
.
          CALL      MVERPW00
.
          MOVE      USERID,EMPWUUID
          CALL      IBACLOCK
          PACK      EMPWUDAT,CCC,CYY,CMM,CDD
          REP       " 0",EMPWUDAT
          MOVE      CTIMEIS,EMPWUTIM
.
          CALL      UPEMPWD1
          GOTO      EMRPWD98
.
.   **********  DELETE FORMACTION  **********
.
EMRPWD30  PACK      KEY12,ERPWD001,ERPWD002,SP70
          CALL      RDEMPWD1
          BRANCH    OVRCD,EMRPWD91
.
          CALL      DEEMPWD1
          GOTO      EMRPWD98
.
.   **********  DISPLAY FORMACTION  **********
.
EMRPWD80  MOVE      ZERO,EXIT
          PACK      KEY12,ERPWD001,ERPWD002,SP70
          CALL      RDEMPWD1
          IF        OVRCD=1
            CALL      CLEMRPWD
          ENDIF
.
EMRPWD82  CLEAR     WEBTITLE
          MOVE      "ABF EMR Department Price Weight Maintenance",WEBTITLE
          RESET     WEBTITLE
.
          CALL      WEBHED00   * Create Output File and Write HTML Page Header
          BRANCH    EXIT,EMRPWD99
          CALL      WEBBOD00   * Process Web Body
          CALL      WEBEND00   * Process End of HTML File
.
          MOVE      ONE,EXIT
          GOTO      EMRPWD99
.
EMRPWD91  MOVE      "Record does not exist",WEBTITLE
          CALL      WEBERR00
          MOVE      ONE,EXIT
          GOTO      EMRPWD99
.
EMRPWD92  MOVE      "Record already exists",WEBTITLE
          CALL      WEBERR00
          MOVE      ONE,EXIT
          GOTO      EMRPWD99
.
EMRPWD93  MOVE      "Invalid Form Action.",WEBTITLE
          CALL      WEBERR00
          MOVE      ONE,EXIT
          GOTO      EMRPWD99
.
EMRPWD98  MOVE      ZERO,EXIT
EMRPWD99  RETURN
+
.------------------------------------------------------------------------------
. ABF Radiotherapy/Dialysis codes Maintenance: Display,Add,Update,Delete
.------------------------------------------------------------------------------
PMSRDI00  RESET     UPDTTYPE
          MATCH     SP70,UPDTTYPE           * Display formaction
          GOTO      PMSRDI80 IF EQUAL
.
          MATCH     "A",UPDTTYPE            * Add formaction
          GOTO      PMSRDI10 IF EQUAL
.
          MATCH     "U",UPDTTYPE            * Update formaction
          GOTO      PMSRDI20 IF EQUAL
.
          MATCH     "D",UPDTTYPE            * Delete formaction
          GOTO      PMSRDI30 IF EQUAL
.
          GOTO      PMSRDI93
.
.   **********  ADD FORMACTION  **********
.
PMSRDI10  CALL      CLPMSRDI
.
          PACK      KEY29,PMRDI001,PMRDI002,PMRDI003,PMRDI004,SP70
          CALL      RDPMRDI1
          COMPARE   ZERO,OVRCD
          GOTO      PMSRDI92 IF EQUAL
.
          CALL      MVPMRD00
.
          MOVE      USERID,PMRICUID
          CALL      IBACLOCK
          PACK      PMRICDAT,CCC,CYY,CMM,CDD
          REP       " 0",PMRICDAT
          MOVE      CTIMEIS,PMRICTIM
.
          PACK      KEY29,PMRICNTR,PMRICTYP,PMRISTYP,PMRIICDC,SP70
          CALL      WRPMRDI1
          GOTO      PMSRDI98
.
.   **********  UPDATE FORMACTION  **********
.
PMSRDI20  CALL      CLPMSRDI
.
          PACK      KEY29,PMRDI001,PMRDI002,PMRDI003,PMRDI004,SP70
          CALL      RDPMRDI1
          BRANCH    OVRCD,PMSRDI91
.
          CALL      MVPMRD00
.
          MOVE      USERID,PMRIUUID
          CALL      IBACLOCK
          PACK      PMRIUDAT,CCC,CYY,CMM,CDD
          REP       " 0",PMRIUDAT
          MOVE      CTIMEIS,PMRIUTIM
.
          CALL      UPPMRDI1
          GOTO      PMSRDI98
.
.   **********  DELETE FORMACTION  **********
.
PMSRDI30  PACK      KEY29,PMRDI001,PMRDI002,PMRDI003,PMRDI004,SP70
          CALL      RDPMRDI1
          BRANCH    OVRCD,PMSRDI91
.
          CALL      DEPMRDI1
          GOTO      PMSRDI98
.
.   **********  DISPLAY FORMACTION  **********
.
PMSRDI80  MOVE      ZERO,EXIT
          PACK      KEY29,PMRDI001,PMRDI002,PMRDI003,PMRDI004,SP70
          CALL      RDPMRDI1
          IF        OVRCD=1
            CALL      CLPMSRDI
          ENDIF
.
PMSRDI82  CLEAR     WEBTITLE
          MOVE      "ABF Radiotherapy/Dialysis codes Maintenance",WEBTITLE
          RESET     WEBTITLE
.
          CALL      WEBHED00   * Create Output File and Write HTML Page Header
          BRANCH    EXIT,PMSRDI99
          CALL      WEBBOD00   * Process Web Body
          CALL      WEBEND00   * Process End of HTML File
.
          MOVE      ONE,EXIT
          GOTO      PMSRDI99
.
PMSRDI91  MOVE      "Record does not exist",WEBTITLE
          CALL      WEBERR00
          MOVE      ONE,EXIT
          GOTO      PMSRDI99
.
PMSRDI92  MOVE      "Record already exists",WEBTITLE
          CALL      WEBERR00
          MOVE      ONE,EXIT
          GOTO      PMSRDI99
.
PMSRDI93  MOVE      "Invalid Form Action.",WEBTITLE
          CALL      WEBERR00
          MOVE      ONE,EXIT
          GOTO      PMSRDI99
.
PMSRDI98  MOVE      ZERO,EXIT
PMSRDI99  RETURN
+
.------------------------------------------------------------------------------
. ABF HAC Adjustments table Maintenance: Display,Add,Update,Delete
.------------------------------------------------------------------------------
PMSHAD00  RESET     UPDTTYPE
          MATCH     SP70,UPDTTYPE           * Display formaction
          GOTO      PMSHAD80 IF EQUAL
.
          MATCH     "A",UPDTTYPE            * Add formaction
          GOTO      PMSHAD10 IF EQUAL
.
          MATCH     "U",UPDTTYPE            * Update formaction
          GOTO      PMSHAD20 IF EQUAL
.
          MATCH     "D",UPDTTYPE            * Delete formaction
          GOTO      PMSHAD30 IF EQUAL
.
          GOTO      PMSHAD93
.
.   **********  ADD FORMACTION  **********
.
PMSHAD10  CALL      CLPMSHAD
.
          PACK      KEY12,PMHAD001,PMHAD002,PMHAD003,SP70
          CALL      RDPMHAD1
          COMPARE   ZERO,OVRCD
          GOTO      PMSHAD92 IF EQUAL
.
          CALL      MVPMHD00
.
          MOVE      USERID,PMHDCUID
          CALL      IBACLOCK
          PACK      PMHDCDAT,CCC,CYY,CMM,CDD
          REP       " 0",PMHDCDAT
          MOVE      CTIMEIS,PMHDCTIM
.
          PACK      KEY12,PMHDCNTR,PMHDHACG,PMHDVALF,SP70
          CALL      WRPMHAD1
.
.         write to Audit file 
          CALL      MVAUA000
          PACK      KEY32,PMAAADAT,PMAAATIM,PMAAATYP,PMAACNTR,PMAAHACG,PMAAVALF,SP70
          CALL      WRPMAUA1                * Write Audit record to PMSAUAFD
          GOTO      PMSHAD98
.
.   **********  UPDATE FORMACTION  **********
.
PMSHAD20  CALL      CLPMSHAD
.
          PACK      KEY12,PMHAD001,PMHAD002,PMHAD003,SP70
          CALL      RDPMHAD1
          BRANCH    OVRCD,PMSHAD91
          MOVE      PMHDVALT,OLDPMVAL
          MOVE      PMHDADJV,OLDPMADJ
          CALL      MVPMHD00
.
          MOVE      USERID,PMHDUUID
          CALL      IBACLOCK
          PACK      PMHDUDAT,CCC,CYY,CMM,CDD
          REP       " 0",PMHDUDAT
          MOVE      CTIMEIS,PMHDUTIM
          CALL      UPPMHAD1
.
.         write to Audit file only if value is changed
          MATCH     PMHDVALT,OLDPMVAL
          IF        @EQUAL
            COMPARE   PMHDADJV,OLDPMADJ
            GOTO      PMSHAD98 IF EQUAL
          ENDIF 
.
          CALL      MVAUA000
          PACK      KEY32,PMAAADAT,PMAAATIM,PMAAATYP,PMAACNTR,PMAAHACG,PMAAVALF,SP70
          CALL      WRPMAUA1                * Write Audit record to PMSAUAFD
          GOTO      PMSHAD98
.
.   **********  DELETE FORMACTION  **********
.
PMSHAD30  PACK      KEY12,PMHAD001,PMHAD002,PMHAD003,SP70
          CALL      RDPMHAD1
          BRANCH    OVRCD,PMSHAD91
          MOVE      PMHDVALT,OLDPMVAL
          MOVE      PMHDADJV,OLDPMADJ
          CALL      DEPMHAD1
.
.         write to Audit file 
          MOVE      USERID,PMHDUUID
          CALL      IBACLOCK
          PACK      PMHDUDAT,CCC,CYY,CMM,CDD
          REP       " 0",PMHDUDAT
          MOVE      CTIMEIS,PMHDUTIM
          CALL      MVAUA000
          PACK      KEY32,PMAAADAT,PMAAATIM,PMAAATYP,PMAACNTR,PMAAHACG,PMAAVALF,SP70
          CALL      WRPMAUA1                * Write Audit record to PMSAUAFD
          GOTO      PMSHAD98
.
.   **********  DISPLAY FORMACTION  **********
.
PMSHAD80  MOVE      ZERO,EXIT
          PACK      KEY12,PMHAD001,PMHAD002,PMHAD003,SP70
          CALL      RDPMHAD1
          IF        OVRCD=1
            CALL      CLPMSHAD
          ENDIF
.
PMSHAD82  CLEAR     WEBTITLE
          MOVE      "ABF HAC Adjustments Maintenance",WEBTITLE
          RESET     WEBTITLE
.
          CALL      WEBHED00   * Create Output File and Write HTML Page Header
          BRANCH    EXIT,PMSHAD99
          CALL      WEBBOD00   * Process Web Body
          CALL      WEBEND00   * Process End of HTML File
.
          MOVE      ONE,EXIT
          GOTO      PMSHAD99
.
PMSHAD91  MOVE      "Record does not exist",WEBTITLE
          CALL      WEBERR00
          MOVE      ONE,EXIT
          GOTO      PMSHAD99
.
PMSHAD92  MOVE      "Record already exists",WEBTITLE
          CALL      WEBERR00
          MOVE      ONE,EXIT
          GOTO      PMSHAD99
.
PMSHAD93  MOVE      "Invalid Form Action.",WEBTITLE
          CALL      WEBERR00
          MOVE      ONE,EXIT
          GOTO      PMSHAD99
.
PMSHAD98  MOVE      ZERO,EXIT
PMSHAD99  RETURN
+
.------------------------------------------------------------------------------
. ABF Emergency URG Classification List Maintenance: Display,Add,Update,Delete
.------------------------------------------------------------------------------
EMRURG00  RESET     UPDTTYPE
          MATCH     SP70,UPDTTYPE           * Display formaction
          GOTO      EMRURG80 IF EQUAL
.
          MATCH     "A",UPDTTYPE            * Add formaction
          GOTO      EMRURG10 IF EQUAL
.
          MATCH     "U",UPDTTYPE            * Update formaction
          GOTO      EMRURG20 IF EQUAL
.
          MATCH     "D",UPDTTYPE            * Delete formaction
          GOTO      EMRURG30 IF EQUAL
.
          GOTO      EMRURG93
.
.   **********  ADD FORMACTION  **********
.
EMRURG10  CALL      CLEMRURG
.
          PACK      KEY47,ERURG001,ERURG002,ERURG003,ERURG004,ERURG005,SP70
          CALL      RDEMURG1
          COMPARE   ZERO,OVRCD
          GOTO      EMRURG92 IF EQUAL
.
          CALL      MVERUR00
.
          MOVE      USERID,EMURCUID
          CALL      IBACLOCK
          PACK      EMURCDAT,CCC,CYY,CMM,CDD
          REP       " 0",EMURCDAT
          MOVE      CTIMEIS,EMURCTIM
.
          PACK      KEY47,EMUREDAT,EMURESTA,EMURTRIA,EMURVTYP,EMURMDBC,SP70
          CALL      WREMURG1
          GOTO      EMRURG98
.
.   **********  UPDATE FORMACTION  **********
.
EMRURG20  CALL      CLEMRURG
.
          PACK      KEY47,ERURG001,ERURG002,ERURG003,ERURG004,ERURG005,SP70
          CALL      RDEMURG1
          BRANCH    OVRCD,EMRURG91
.
          CALL      MVERUR00
.
          MOVE      USERID,EMURUUID
          CALL      IBACLOCK
          PACK      EMURUDAT,CCC,CYY,CMM,CDD
          REP       " 0",EMURUDAT
          MOVE      CTIMEIS,EMURUTIM
.
          CALL      UPEMURG1
          GOTO      EMRURG98
.
.   **********  DELETE FORMACTION  **********
.
EMRURG30  PACK      KEY47,ERURG001,ERURG002,ERURG003,ERURG004,ERURG005,SP70
          CALL      RDEMURG1
          BRANCH    OVRCD,EMRURG91
.
          CALL      DEEMURG1
          GOTO      EMRURG98
.
.   **********  DISPLAY FORMACTION  **********
.
EMRURG80  MOVE      ZERO,EXIT
          PACK      KEY47,ERURG001,ERURG002,ERURG003,ERURG004,ERURG005,SP70
          CALL      RDEMURG1
          IF        OVRCD=1
            CALL      CLEMRURG
          ENDIF
.
EMRURG82  CLEAR     WEBTITLE
          MOVE      "ABF Emergency URG Classification List Maintenance",WEBTITLE
          RESET     WEBTITLE
.
          CALL      WEBHED00   * Create Output File and Write HTML Page Header
          BRANCH    EXIT,EMRURG99
          CALL      WEBBOD00   * Process Web Body
          CALL      WEBEND00   * Process End of HTML File
.
          MOVE      ONE,EXIT
          GOTO      EMRURG99
.
EMRURG91  MOVE      "Record does not exist",WEBTITLE
          CALL      WEBERR00
          MOVE      ONE,EXIT
          GOTO      EMRURG99
.
EMRURG92  MOVE      "Record already exists",WEBTITLE
          CALL      WEBERR00
          MOVE      ONE,EXIT
          GOTO      EMRURG99
.
EMRURG93  MOVE      "Invalid Form Action.",WEBTITLE
          CALL      WEBERR00
          MOVE      ONE,EXIT
          GOTO      EMRURG99
.
EMRURG98  MOVE      ZERO,EXIT
EMRURG99  RETURN
+
.------------------------------------------------------------------------------
. Multiple NEP Values Maintenance: Display,Add,Update,Delete
.------------------------------------------------------------------------------
MNEPVL00  BRANCH    NOMULNEP,MNEPVL93       * file not exists
.
          RESET     UPDTTYPE
          MATCH     SP70,UPDTTYPE           * Display formaction
          GOTO      MNEPVL80 IF EQUAL
.
          MATCH     "A",UPDTTYPE            * Add formaction
          GOTO      MNEPVL10 IF EQUAL
.
          MATCH     "U",UPDTTYPE            * Update formaction
          GOTO      MNEPVL20 IF EQUAL
.
          GOTO      MNEPVL93
.
.   **********  ADD FORMACTION  **********
.
MNEPVL10  CALL      CLPMSNEP
.
          PACK      KEY58,PMNEP001,PMNEP002,PMNEP003,PMNEP004,PMNEP005,SP70
          CALL      RDPMNEP1
          COMPARE   ZERO,OVRCD
          GOTO      MNEPVL92 IF EQUAL
.
          CALL      MVPMNE00
.
          MOVE      USERID,PMNECUID
          CALL      IBACLOCK
          PACK      PMNECDAT,CCC,CYY,CMM,CDD
          REP       " 0",PMNECDAT
          MOVE      CTIMEIS,PMNECTIM
.
          PACK      KEY58,PMNECNTR,PMNEVTYP,PMNECODE,PMNEINDC,PMNEINDV,SP70
          CALL      WRPMNEP1
          GOTO      MNEPVL98
.
.   **********  UPDATE FORMACTION  **********
.
MNEPVL20  PACK      KEY58,PMNEP001,PMNEP002,PMNEP003,PMNEP004,PMNEP005,SP70
          CALL      RDPMNEP1
          BRANCH    OVRCD,MNEPVL91
.
          MOVE      PMNEP004,PMNEINDC
          MOVE      PMNEP005,PMNEINDV
          MOVE      PMNEP006,PMNENEPP
          MATCH     SP70,PMNEP007
          IF        !@EQUAL
            MOVE      PMNEP007,PMNEACTV
          ENDIF
.
          MOVE      USERID,PMNEUUID
          CALL      IBACLOCK
          PACK      PMNEUDAT,CCC,CYY,CMM,CDD
          REP       " 0",PMNEUDAT
          MOVE      CTIMEIS,PMNEUTIM
.
          CALL      UPPMNEP1
          GOTO      MNEPVL98
.
.   **********  DISPLAY FORMACTION  **********
.
MNEPVL80  MOVE      ZERO,EXIT
          PACK      KEY58,PMNEP001,PMNEP002,PMNEP003,PMNEP004,PMNEP005,SP70
          CALL      RDPMNEP1
          IF        OVRCD=1
            CALL      CLPMSNEP
          ENDIF
.
MNEPVL82  CLEAR     WEBTITLE
          MOVE      "Multiple NEP Values Maintenance",WEBTITLE
          RESET     WEBTITLE
.
          CALL      WEBHED00   * Create Output File and Write HTML Page Header
          BRANCH    EXIT,MNEPVL99
          CALL      WEBBOD00   * Process Web Body
          CALL      WEBEND00   * Process End of HTML File
.
          MOVE      ONE,EXIT
          GOTO      MNEPVL99
.
MNEPVL91  MOVE      "Record does not exist",WEBTITLE
          CALL      WEBERR00
          MOVE      ONE,EXIT
          GOTO      MNEPVL99
.
MNEPVL92  MOVE      "Record already exists",WEBTITLE
          CALL      WEBERR00
          MOVE      ONE,EXIT
          GOTO      MNEPVL99
.
MNEPVL93  MOVE      "Invalid Form Action.",WEBTITLE
          CALL      WEBERR00
          MOVE      ONE,EXIT
          GOTO      MNEPVL99
.
MNEPVL98  MOVE      ZERO,EXIT
MNEPVL99  RETURN
+
.------------------------------------------------------------------------------
. ABF Sub-Acute price weights : Display,Add,Update,Delete
.------------------------------------------------------------------------------
PMSSAW00  BRANCH    NOPMSSAW,PMSSAW93       * file not exists
.
          RESET     UPDTTYPE
          MATCH     SP70,UPDTTYPE           * Display formaction
          GOTO      PMSSAW80 IF EQUAL
.
          MATCH     "A",UPDTTYPE            * Add formaction
          GOTO      PMSSAW10 IF EQUAL
.
          MATCH     "U",UPDTTYPE            * Update formaction
          GOTO      PMSSAW20 IF EQUAL
.
          MATCH     "D",UPDTTYPE            * Delete formaction
          GOTO      PMSSAW30 IF EQUAL
.
          GOTO      PMSSAW98
.
.   **********  ADD FORMACTION  **********
.
PMSSAW10  CALL      CLRSAW00
.
          PACK      KEY13,PMSAW001,PMSAW002,PMSAW003,PMSAW004,SP70
          CALL      RDPMSAW1
          COMPARE   ZERO,OVRCD
          GOTO      PMSSAW92 IF EQUAL
.
          CALL      MVPSSA00
.
          MOVE      USERID,PMSACUID
          CALL      IBACLOCK
          PACK      PMSACDAT,CCC,CYY,CMM,CDD
          REP       " 0",PMSACDAT
          MOVE      CTIMEIS,PMSACTIM
.
          PACK      KEY13,PMSACNTR,PMSACLCD,PMSAASVR,PMSACCOD,SP70
          CALL      WRPMSAW1
          GOTO      PMSSAW98
.
.   **********  UPDATE FORMACTION  **********
.
PMSSAW20  PACK      KEY13,PMSAW001,PMSAW002,PMSAW003,PMSAW004,SP70
          CALL      RDPMSAW1
          BRANCH    OVRCD,PMSSAW91
.
          CALL      MVPSSA00
.
          MOVE      USERID,PMSAUUID
          CALL      IBACLOCK
          PACK      PMSAUDAT,CCC,CYY,CMM,CDD
          REP       " 0",PMSAUDAT
          MOVE      CTIMEIS,PMSAUTIM
.
          CALL      UPPMSAW1
          GOTO      PMSSAW98
.
.   **********  DELETE FORMACTION  **********
.
PMSSAW30  PACK      KEY13,PMSAW001,PMSAW002,PMSAW003,PMSAW004,SP70
          CALL      RDPMSAW1
          BRANCH    OVRCD,PMSSAW91
.
          CALL      DEPMSAW1
          GOTO      PMSSAW98
.
.   **********  DISPLAY FORMACTION  **********
.
PMSSAW80  MOVE      ZERO,EXIT
          PACK      KEY13,PMSAW001,PMSAW002,PMSAW003,PMSAW004,SP70
          CALL      RDPMSAW1
          IF        OVRCD=1
            CALL      CLRSAW00
          ENDIF
.
PMSSAW82  CLEAR     WEBTITLE
          MOVE      "ABF Sub-Acute Price Weights Maintenance",WEBTITLE
          RESET     WEBTITLE
.
          CALL      WEBHED00   * Create Output File and Write HTML Page Header
          BRANCH    EXIT,PMSSAW99
          CALL      WEBBOD00   * Process Web Body
          CALL      WEBEND00   * Process End of HTML File
.
          MOVE      ONE,EXIT
          GOTO      PMSSAW99
.
PMSSAW91  MOVE      "Record does not exist",WEBTITLE
          CALL      WEBERR00
          MOVE      ONE,EXIT
          GOTO      PMSSAW99
.
PMSSAW92  MOVE      "Record already exists",WEBTITLE
          CALL      WEBERR00
          MOVE      ONE,EXIT
          GOTO      PMSSAW99
.
PMSSAW93  MOVE      "Invalid Form Action.",WEBTITLE
          CALL      WEBERR00
          MOVE      ONE,EXIT
          GOTO      PMSSAW99
.
PMSSAW98  MOVE      ZERO,EXIT
.
PMSSAW99  RETURN
.
.---------------------------------------------------------------------------
. ABF Admitted MH Price Weights : Display,Add,Update,Delete
.---------------------------------------------------------------------------
PMMANH00  BRANCH    NOPMMANH,PMMANH93       * File not exists 
.
          RESET     UPDTTYPE 
          MATCH     SP70,UPDTTYPE           * Display formaction
          GOTO      PMMANH80 IF EQUAL
.
          MATCH     "A",UPDTTYPE            * Add formaction
          GOTO      PMMANH10 IF EQUAL
.
          MATCH     "U",UPDTTYPE            * Update formaction
          GOTO      PMMANH20 IF EQUAL
.
          MATCH     "D",UPDTTYPE            * Delete formaction
          GOTO      PMMANH30 IF EQUAL
.
          GOTO      PMMANH98
.
.   **********  ADD FORMACTION  **********
.
PMMANH10  CALL      CLRSAW00
.
          PACK      KEY16,PMAMH001,PMAMH002,SP70
          CALL      RDPMAMH1
          COMPARE   ZERO,OVRCD
          GOTO      PMMANH92 IF EQUAL
.
          CALL      MVMANH00
.
          MOVE      USERID,PMMHCUID
          CALL      IBACLOCK
          PACK      PMMHCDAT,CCC,CYY,CMM,CDD
          REP       " 0",PMMHCDAT
          MOVE      CTIMEIS,PMMHCTIM
.
          PACK      KEY16,PMMHCNTR,PMMHAMHC,SP70
          CALL      WRPMAMH1
          GOTO      PMMANH98
.
.   **********  UPDATE FORMACTION  **********
.
PMMANH20  PACK      KEY16,PMAMH001,PMAMH002,SP70
          CALL      RDPMAMH1
          BRANCH    OVRCD,PMMANH91
.
          CALL      MVMANH00
.
          MOVE      USERID,PMMHUUID
          CALL      IBACLOCK
          PACK      PMMHUDAT,CCC,CYY,CMM,CDD
          REP       " 0",PMMHUDAT
          MOVE      CTIMEIS,PMMHUTIM
.
          CALL      UPPMAMH1
          GOTO      PMMANH98
.
.   **********  DELETE FORMACTION  **********
.
PMMANH30  PACK      KEY16,PMAMH001,PMAMH002,SP70
          CALL      RDPMAMH1
          BRANCH    OVRCD,PMMANH91
.
          CALL      DEPMAMH1
          GOTO      PMMANH98
.
.   **********  DISPLAY FORMACTION  **********
.
PMMANH80  MOVE      ZERO,EXIT
          PACK      KEY16,PMAMH001,PMAMH002,SP70
          CALL      RDPMAMH1
          IF        OVRCD=1
            CALL      CLRANH00
          ENDIF
.
PMMANH82  CLEAR     WEBTITLE
          MOVE      "ABF Admitted Mental Health Weight Maintenance",WEBTITLE
          RESET     WEBTITLE
.
          CALL      WEBHED00   * Create Output File and Write HTML Page Header
          BRANCH    EXIT,PMMANH99
          CALL      WEBBOD00   * Process Web Body
          CALL      WEBEND00   * Process End of HTML File
.
          MOVE      ONE,EXIT
          GOTO      PMMANH99
.
PMMANH91  MOVE      "Record does not exist",WEBTITLE
          CALL      WEBERR00
          MOVE      ONE,EXIT
          GOTO      PMMANH99
.
PMMANH92  MOVE      "Record already exists",WEBTITLE
          CALL      WEBERR00
          MOVE      ONE,EXIT
          GOTO      PMMANH99
.
PMMANH93  MOVE      "Invalid Form Action.",WEBTITLE
          CALL      WEBERR00
          MOVE      ONE,EXIT
          GOTO      PMMANH99
.
PMMANH98  MOVE      ZERO,EXIT
.
PMMANH99  RETURN
.
.---------------------------------------------------------------------------
. Process Fields 
.---------------------------------------------------------------------------
PROFLD00  BRANCH    REPORTNO,PROFLD10,PROFLD20,PROFLD30,PROFLD40,PROFLD50:
                             PROFLD60,PROFLD70,PROFLD80,PROFLD90
          GOTO      PROFLD99
.
PROFLD10  BRANCH    FLDSETNO,PROFLD11,PROFLD12
          GOTO      PROFLD99
.
PROFLD11  CALL      PMPW0000          * ABF Admitted Acute Patient PW
          GOTO      PROFLD99
.
PROFLD12  CALL      PPMW0000
          GOTO      PROFLD99
.
PROFLD20  BRANCH    FLDSETNO,PROFLD21,PROFLD22
          GOTO      PROFLD99
.
PROFLD21  CALL      OTPW0000          * ABF Non Admitted Patient PW
          GOTO      PROFLD99
.
PROFLD22  CALL      OPWO0000
          GOTO      PROFLD99
.
PROFLD30  BRANCH    FLDSETNO,PROFLD31,PROFLD32
          GOTO      PROFLD99
.
PROFLD31  CALL      ERPW0000          * ABF EMR Dept PW
          GOTO      PROFLD99
.
PROFLD32  CALL      EPWD0000
          GOTO      PROFLD99
.
PROFLD40  BRANCH    FLDSETNO,PROFLD41,PROFLD42
          GOTO      PROFLD99
.
PROFLD41  CALL      PMRD0000          * ABF Radiotherapy/Dialysis codes
          GOTO      PROFLD99
.
PROFLD42  CALL      PRDI0000
          GOTO      PROFLD99
.
PROFLD50  BRANCH    FLDSETNO,PROFLD51,PROFLD52
          GOTO      PROFLD99
.
PROFLD51  CALL      PMHD0000          * ABF HAC Adjustments table
          GOTO      PROFLD99
.
PROFLD52  CALL      PHAD0000
          GOTO      PROFLD99
.
PROFLD60  BRANCH    FLDSETNO,PROFLD61,PROFLD62
          GOTO      PROFLD99
.
PROFLD61  CALL      ERUR0000          * ABF EMR URG Classification table
          GOTO      PROFLD99
.
PROFLD62  CALL      EURG0000
          GOTO      PROFLD99
.
PROFLD70  BRANCH    FLDSETNO,PROFLD71,PROFLD72
          GOTO      PROFLD99
.
PROFLD71  CALL      PNEP0000          * Multiple NEP Values
          GOTO      PROFLD99
.
PROFLD72  CALL      PPNP0000
          GOTO      PROFLD99
.
PROFLD80  BRANCH    FLDSETNO,PROFLD81,PROFLD82
          GOTO      PROFLD99
.
PROFLD81  CALL      PMSA0000
          GOTO      PROFLD99
.
PROFLD82  CALL      PPSA0000
          GOTO      PROFLD99
.
PROFLD90  BRANCH    FLDSETNO,PROFLD91,PROFLD92
          GOTO      PROFLD99
.
PROFLD91  CALL      PMAN0000
          GOTO      PROFLD99
.
PROFLD92  CALL      PMCC0000
          GOTO      PROFLD99
.
PROFLD99  RETURN
+
.-----------------------------------------------------------------------------
. ABF Admitted acute price weight maintenance output
.-----------------------------------------------------------------------------
PPMW0000  BRANCH    FLDITMNO,PPMW0100,PPMW0200,PPMW0300,PPMW0400,PPMW0500
          GOTO      PPPMW999
.
PPMW0100  CALL      ADMPW000            * Admitted Acute PW table
          GOTO      PPPMW999
.
PPMW0200  CALL      PRVPW000            * Previous screen Admit.Acute PW table
          GOTO      PPPMW999
.
PPMW0300  CALL      NXTPW000            * Next screen Admit.Acute PW table
          GOTO      PPPMW999
.
PPMW0400  UNPACK    DIM127,D1,KEY1,DIM127
          MOVE      KEY1,F1
          BRANCH    F1,PPMW0410
          WRITE     HTMLFILE;PMPWA001;      * Contract ID
          GOTO      PPPMW999
.
PPMW0410  PACK      KEY6,PMPWA001,SP70
          CALL      RDPMCID1
          BRANCH    OVRCD,PPPMW999
.
          WRITE     HTMLFILE;PMCIDESC;
          GOTO      PPPMW999
.
PPMW0500  UNPACK    DIM127,D1,KEY1,DIM127
          MOVE      KEY1,F1
          BRANCH    F1,PPMW0510
          WRITE     HTMLFILE;PMPWA002;      * DRG Code
          GOTO      PPPMW999
.
PPMW0510  WRITE     HTMLFILE;DRGDESC1;
          GOTO      PPPMW999
.
PPPMW999  RETURN
+
.-----------------------------------------------------------------------------
. ABF Non Admitted price weight maintenance output
.-----------------------------------------------------------------------------
OPWO0000  BRANCH    FLDITMNO,OPWO0100,OPWO0200,OPWO0300,OPWO0400,OPWO0500
          GOTO      OPWO9999
.
OPWO0100  CALL      NADPW000            * Non Admitted PW table
          GOTO      OPWO9999
.
OPWO0200  CALL      PRVPW000            * Previous screen Non Admit PW table
          GOTO      OPWO9999
.
OPWO0300  CALL      NXTPW000            * Next screen Non Admit PW table
          GOTO      OPWO9999
.
OPWO0400  UNPACK    DIM127,D1,KEY1,DIM127
          MOVE      KEY1,F1
          BRANCH    F1,OPWO0410
          WRITE     HTMLFILE;OTPWO001;      * Contract ID
          GOTO      OPWO9999
.
OPWO0410  PACK      KEY6,OTPWO001,SP70
          CALL      RDPMCID1
          BRANCH    OVRCD,OPWO9999
.
          WRITE     HTMLFILE;PMCIDESC;
          GOTO      OPWO9999
.
OPWO0500  MOVE      CATNC,CATEGORY          * Tier 2 Clinic V5.0 (Category NC)
          PACK      CODE,OTPWO002,SP70
          CALL      CODITM00
          GOTO      OPWO9999
.
OPWO9999  RETURN
+
.-----------------------------------------------------------------------------
. ABF sub-acute price weight maintenance output
.-----------------------------------------------------------------------------
PPSA0000  BRANCH    FLDITMNO,PPSA0100,PPSA0200,PPSA0300,PPSA0400,PPSA0500
          GOTO      PPSA9999
.
PPSA0100  CALL      SBAPW000            * Sub-Acute PW table
          GOTO      PPSA9999
.
PPSA0200  CALL      PRVPW000            * Previous screen Sub-Acute PW table
          GOTO      PPSA9999
.
PPSA0300  CALL      NXTPW000            * Next screen Sub-Acute PW table
          GOTO      PPSA9999
.
PPSA0400  UNPACK    DIM127,D1,KEY1,DIM127
          MOVE      KEY1,F1
          BRANCH    F1,PPSA0410
          WRITE     HTMLFILE;PMSAW001;      * Contract ID
          GOTO      PPSA9999
.
PPSA0410  PACK      KEY6,PMSAW001,SP70      * Contract ID Description
          CALL      RDPMCID1
          BRANCH    OVRCD,PPSA9999
.
          WRITE     HTMLFILE;PMCIDESC;
          GOTO      PPSA9999
.
PPSA0500  UNPACK    DIM127,D1,KEY1,DIM127
          MOVE      KEY1,F1
          BRANCH    F1,PPSA0510,PPSA0520,PPSA0530
.
          WRITE     HTMLFILE;SNAPDESC;
          GOTO      PPSA9999
.
PPSA0510  WRITE     HTMLFILE;PMSAW002;
          GOTO      PPSA9999
.
PPSA0520  WRITE     HTMLFILE;PMSAW003;
          GOTO      PPSA9999
.
PPSA0530  WRITE     HTMLFILE;PMSAW004;
          GOTO      PPSA9999
.
PPSA9999  RETURN
+
.-----------------------------------------------------------------------------
. ABF Emergency Dept price weight maintenance output
.-----------------------------------------------------------------------------
EPWD0000  BRANCH    FLDITMNO,EPWD0100,EPWD0200,EPWD0300,EPWD0400,EPWD0500
          GOTO      EPWD9999
.
EPWD0100  CALL      EMRPW000            * EMR Dept PW table
          GOTO      EPWD9999
.
EPWD0200  CALL      PRVPW000            * Previous screen EMR Dept PW table
          GOTO      EPWD9999
.
EPWD0300  CALL      NXTPW000            * Next screen EMR Dept PW table
          GOTO      EPWD9999
.
EPWD0400  UNPACK    DIM127,D1,KEY1,DIM127
          MOVE      KEY1,F1
          BRANCH    F1,EPWD0410
          WRITE     HTMLFILE;ERPWD001;      * Contract ID
          GOTO      EPWD9999
.
EPWD0410  PACK      KEY6,ERPWD001,SP70
          CALL      RDPMCID1
          BRANCH    OVRCD,EPWD9999
.
          WRITE     HTMLFILE;PMCIDESC;
          GOTO      EPWD9999
.
EPWD0500  WRITE     HTMLFILE;ERPWD002;     * URG V1.4 Value 
          GOTO      EPWD9999
.
EPWD9999  RETURN
+
.-----------------------------------------------------------------------------
. ABF Radiotherapy/Dialysis codes maintenance output
.-----------------------------------------------------------------------------
PRDI0000  BRANCH    FLDITMNO,PRDI0100,PRDI0200,PRDI0300,PRDI0400,PRDI0500:
                             PRDI0600,PRDI0700,PRDI0800
          GOTO      PRDI9999
.
PRDI0100  CALL      ADRDI000            * Add ABF Radiotherapy/Dialysis codes
          GOTO      PRDI9999
.
PRDI0200  CALL      PRVPW000            * Previous screen ABF RT/Dlys Codes
          GOTO      PRDI9999
.
PRDI0300  CALL      NXTPW000            * Next screen ABF RT/Dlys Codes
          GOTO      PRDI9999
.
PRDI0400  UNPACK    DIM127,D1,KEY1,DIM127
          MOVE      KEY1,F1
          BRANCH    F1,PRDI0410
          WRITE     HTMLFILE;PMRDI001;      * Contract ID
          GOTO      PRDI9999
.
PRDI0410  PACK      KEY6,PMRDI001,SP70
          CALL      RDPMCID1
          BRANCH    OVRCD,PRDI9999
.
          WRITE     HTMLFILE;PMCIDESC;
          GOTO      PRDI9999
.
PRDI0500  WRITE     HTMLFILE;PMRDI002;      * Type of Code
          GOTO      PRDI9999
.
PRDI0600  WRITE     HTMLFILE;PMRDI003;      * Type of Coding System
          GOTO      PRDI9999 
. 
PRDI0700  UNPACK    DIM127,D1,KEY1,DIM127
          MOVE      KEY1,F1
          BRANCH    F1,PRDI0710
          WRITE     HTMLFILE;PMRDI004;      * ICD10 Code
          GOTO      PRDI9999
.
PRDI0710  MATCH     PMRDI004,SP70
          GOTO      PRDI9999 IF EQUAL
          PACK      ICD10DES,SP70,SP70,SP70
          PACK      KEY9,PMRDI004,SP70
          CALL      RDPTICO1                * Read ICD10 Procedure record
          IF        OVRCD=1
            CALL      RD10T9O1              * Read ICD9
            BRANCH    OVRCD,PRDI9999
          ENDIF
          MATCH     SP70,PT0ODSC2
          IF        !@EOS & !@EQUAL
            PACK      ICD10DES,PT0ODSC2
          ELSE
            PACK      ICD10DES,ODESC
          ENDIF

          WRITE     HTMLFILE;ICD10DES;
          GOTO      PRDI9999
.
PRDI0800  CALL      IBACLOCK
          PACK      CURRDATE,CCC,CYY,CMM,CDD
          REP       " 0",CURRDATE
.          
          WRITE     HTMLFILE;CURRDATE;      * Current Date
          GOTO      PRDI9999
.
PRDI9999  RETURN
+
.-----------------------------------------------------------------------------
. ABF HAC Adjustments table maintenance output
.-----------------------------------------------------------------------------
PHAD0000  BRANCH    FLDITMNO,PHAD0100,PHAD0200,PHAD0300,PHAD0400,PHAD0500:
                             PHAD0600,PHAD0700,PHAD0800
          GOTO      PHAD9999
.
PHAD0100  CALL      PMHAD000                * HAC Adjustments table
          GOTO      PHAD9999
.
PHAD0200  CALL      PRVPW000                * Previous screen 
          GOTO      PHAD9999
.
PHAD0300  CALL      NXTPW000                * Next screen 
          GOTO      PHAD9999
.
PHAD0400  UNPACK    DIM127,D1,KEY1,DIM127
          MOVE      KEY1,F1
          BRANCH    F1,PHAD0410
          WRITE     HTMLFILE;PMHAD001;      * Contract ID
          GOTO      PHAD9999
.
PHAD0410  PACK      KEY6,PMHAD001,SP70
          CALL      RDPMCID1
          BRANCH    OVRCD,PHAD9999
.
          WRITE     HTMLFILE;PMCIDESC;
          GOTO      PHAD9999
.
PHAD0500  UNPACK    DIM127,D1,KEY1,DIM127
          MOVE      KEY1,F1
          BRANCH    F1,PHAD0410
          MOVE      CATHa,CATEGORY           * HAC Group 01-16 Cat Ha
          PACK      CODE,PMHAD002,SP70
          CALL      CODITM00
          GOTO      PHAD9999
.
PHAD0510  WRITE     HTMLFILE;PMHAD002;      * HAC Group 01-16 Cat Ha
          GOTO      PHAD9999
.
PHAD0600  WRITE     HTMLFILE;PMHAD003;      * Value From
          GOTO      PHAD9999 
. 
PHAD0700  WRITE     HTMLFILE;PMHAD004;      * Value To
          GOTO      PHAD9999 
. 
PHAD0800  WRITE     HTMLFILE;PMHAD005;      * Complexity Adjusment %
          GOTO      PHAD9999 
. 
PHAD9999  RETURN
+
.-----------------------------------------------------------------------------
. ABF EMR URG Classification maintenance output
.-----------------------------------------------------------------------------
EURG0000  BRANCH    FLDITMNO,EURG0100,EURG0200,EURG0300,EURG0400,EURG0500:
                             EURG0600,EURG0700,EURG0800
          GOTO      EURG9999
.
EURG0100  CALL      EMRUR000            * Add ABF EMR URG Classification List
          GOTO      EURG9999
.
EURG0200  CALL      PRVPW000            * Previous screen ABF EMR URG List 
          GOTO      EURG9999
.
EURG0300  CALL      NXTPW000            * Next screen ABF EMR URG List 
          GOTO      EURG9999
.
EURG0400  MATCH     EFFENDDT,SP70
          IF        @EQUAL
            MATCH     ERURG001,SP70       * Effective End Date
            GOTO      EURG9999 IF EQUAL
            UNPACK    ERURG001,CCENT,CYEAR,CMON,CDAY
            MOVE      CMON,F2
            LOAD      MTHNAM3,F2,JAN,FEB,MAR,APR,MAY,JUN,JUL,AUG,SEP,OCT,NOV,DEC
            WRITE     HTMLFILE;CDAY,SP1,MTHNAM3,SP1,CCENT,CYEAR;
          ELSE
            WRITE     HTMLFILE;EFFENDDT
          ENDIF
          GOTO      EURG9999
.
EURG0500  MOVE      CATED,CATEGORY          * Episode End Status Cat ED
          PACK      CODE,ERURG002,SP70
          CALL      CODITM00
          GOTO      EURG9999
.
EURG0600  MOVE      CATAA,CATEGORY          * Triage Code Cat AA
          PACK      CODE,ERURG003,SP70
          CALL      CODITM00
          GOTO      EURG9999
.
EURG0700  MOVE      CATee,CATEGORY          * Type of Visit Cat ee
          PACK      CODE,ERURG004,SP70
          CALL      CODITM00
          GOTO      EURG9999
.
EURG0800  WRITE     HTMLFILE;ERURG005;      * URG Value
          GOTO      EURG9999
.
EURG9999  RETURN
+
.-----------------------------------------------------------------------------
.   Multiple NEP Values
.-----------------------------------------------------------------------------
PPNP0000  BRANCH    FLDITMNO,PPNP0100,PPNP0200,PPNP0300,PPNP0400,PPNP0500
          GOTO      PPNP9999
.
PPNP0100  CALL      LNEP0000            * Multiple NEP Values List
          GOTO      PPNP9999
.
PPNP0200  CALL      PRVNE000            * Previous screen NEP values List
          GOTO      PPNP9999
.
PPNP0300  CALL      NXTNE000            * Next screen NEP values List
          GOTO      PPNP9999
.
PPNP0400  UNPACK    DIM127,D1,KEY1,DIM127
          MOVE      KEY1,F1
          BRANCH    F1,PPNP0410
          WRITE     HTMLFILE;PMNEP001;      * Contract ID
          GOTO      PPNP9999
.
PPNP0410  PACK      KEY6,PMNEP001,SP70
          CALL      RDPMCID1
          BRANCH    OVRCD,PPNP9999
.
          WRITE     HTMLFILE;PMCIDESC;
          GOTO      PPNP9999
.
PPNP0500  PACK      PMNEP002,PMNEP002,SP70
          MOVE      ZERO,F2
          MATCH     SP70,PMNEP002
          IF        !@EQUAL
            STRIP     PMNEP002
            MOVE      PMNEP002,F2
          ENDIF
          UNPACK    DIM127,D1,KEY1,DIM127
          MOVE      KEY1,F1
          BRANCH    F1,PPNP0510,PPNP0520
          WRITE     HTMLFILE;F2;      * Type of visit
          GOTO      PPNP9999
.
PPNP0510  MOVE      SP70,KEY15
          LOAD      KEY15,F2,VTYPE01,VTYPE02,VTYPE03
          IF        F2=9
            PACK      KEY15,VTYPE04,SP70
          ENDIF
          WRITE     HTMLFILE;KEY15;
          GOTO      PPNP9999
.
PPNP0520  CALL      SVIS0000               * select visit type
          GOTO      PPNP9999
.
PPNP0800  MOVE      CATED,CATEGORY          * Episode End Status Cat ED
          PACK      CODE,ERURG002,SP70
          CALL      CODITM00
          GOTO      PPNP9999
.
PPNP0900  PACK      PMNEP003,PMNEP003,SP70
          UNPACK    DIM127,D1,KEY1,DIM127
          MOVE      KEY1,F1
          BRANCH    F1,PPNP0910
          WRITE     HTMLFILE;PMNEP003;      * Code set
          GOTO      PPNP9999
.
PPNP0910  PACK      PMNEP002,PMNEP002,SP70
          MOVE      ZERO,F2
          MATCH     SP70,PMNEP002
          IF        !@EQUAL
            STRIP     PMNEP002
            MOVE      PMNEP002,F2
          ENDIF
          CALL      SCOD0000               * select Code set
          GOTO      PPNP9999
.
PPNP9999  RETURN
+
.-----------------------------------------------------------------------------
. ABF Admitted MH Price Weight Output  
.-----------------------------------------------------------------------------
PMCC0000  BRANCH    FLDITMNO,PMCC0100,PMCC0200,PMCC0300,PMCC0400,PMCC0500
          GOTO      PMCC9999
.
PMCC0100  CALL      PMCCT000               * ABF Admitted MH Table
          GOTO      PMCC9999
.
PMCC0200  CALL      PRVPW000               * Previous Screen ABF Admitted MH
          GOTO      PMCC9999
.
PMCC0300  CALL      NXTPW000               * Next screen ABF Admitted MH
          GOTO      PMCC9999
.
.kkkk
PMCC0400  UNPACK    DIM127,D1,KEY1,DIM127        * Contract ID
          MOVE      KEY1,F1
          BRANCH    F1,PMCC0410
.
          WRITE     HTMLFILE;PMAMH001;
          GOTO      PMCC9999
.
PMCC0410  PACK      KEY6,PMAMH001,SP70           * Contract ID Description
          CALL      RDPMCID1
          BRANCH    OVRCD,PMCC9999
.
          WRITE     HTMLFILE;PMCIDESC;
          GOTO      PMCC9999
.
PMCC0500  WRITE     HTMLFILE;PMAMH002;           * AMHCC Code
          GOTO      PMCC9999
.
PMCC9999  RETURN
+
.-----------------------------------------------------------------------------
. ABF Admitted acute price weight table
.-----------------------------------------------------------------------------
ADMPW000  UNPACK    DIM127,D1,LINKPRG,DIM127
          UNPACK    DIM127,D1,LINKREP,DIM127
          UNPACK    DIM127,D1,LINKTEM,DIM127
.
          IF        NORECORD=0
            MOVE      "20",NORECORD       * Set Default No Records to Display
          ENDIF
          MOVE      ZERO,RECNUMB
          MOVE      ZERO,DISNUMB
          MOVE      ZERO,LOOPCNTR
.
.         if a Contract ID is entered, use index 1 and position on Contract ID
.
          MOVE      ONE,F1                     * Using index 1
          MATCH     SP70,PMPWA001              * Contract ID
          GOTO      ADMPW200 IF NOT EQUAL      * not blank
          MATCH     SP70,PMPWA002
          GOTO      ADMPW999 IF EQUAL
.
          MOVE      TWO,F1                     * Using index 2
          PACK      KEY10,PMPWA002,SP70
          CALL      RSPMPWA2
ADMPW100  CALL      RKPMPWA2
          BRANCH    OVRCD,ADMPW999
.
          MATCH     SP70,PMPWA002
          IF        !@EQUAL
            MATCH     PMPWA002,PMPWDRGC              * DRG Code
            GOTO      ADMPW999 IF NOT EQUAL
          ENDIF
          GOTO      ADMPW500
.
.         Position on Contract ID
.
ADMPW200  PACK      KEY10,PMPWA001,PMPWA002,SP70
          MATCH     SP70,KEY10
          GOTO      ADMPW300 IF EQUAL
.
          CALL      RDPMPWA1
          COMPARE   ZERO,OVRCD
          GOTO      ADMPW500 IF EQUAL
.
ADMPW300  CALL      RSPMPWA1
ADMPW400  CALL      RKPMPWA1
          BRANCH    OVRCD,ADMPW999
.
          MATCH     SP70,PMPWA001
          IF        !@EQUAL
            MATCH     PMPWA001,PMPWCNTR              * Same contract id
            GOTO      ADMPW999 IF NOT EQUAL
          ENDIF
.
          MATCH     SP70,PMPWA002
          IF        !@EQUAL
            MATCH     PMPWA002,PMPWDRGC              * Same DRG Code
            GOTO      ADMPW400 IF NOT EQUAL
          ENDIF
.
ADMPW500  ADD       ONE,LOOPCNTR
.
.  Write record number in a comment to keep apache listening if no matches
.  are found per 1,000 records
.
          IF        (LOOPCNTR = 1000)
            WRITE     HTMLFILE;"<!--",LOOPCNTR,"-->"
            MOVE      ZERO,LOOPCNTR
          ENDIF
.
ADMPW600  ADD       ONE,RECNUMB
          IF        STARTNUM>=RECNUMB
            GOTO      ADMPW800
          ENDIF
.
          CALL      ADPWRW00
.
          MOVE      ZERO,LOOPCNTR
.
          ADD       ONE,DISNUMB
          COMPARE   NORECORD,DISNUMB
          IF        !@EQUAL
            GOTO      ADMPW800
          ENDIF
          GOTO      ADMPW999
.
ADMPW800  BRANCH    F1,ADMPW400,ADMPW100
.
ADMPW999  RETURN
+
.-----------------------------------------------------------------------------
.         ABF Admitted acute price weight table row
.-----------------------------------------------------------------------------
ADPWRW00  MOVE      "No ",KEY3
          MATCH     "1",PMPWSDPY
          IF        @EQUAL
            MOVE      "Yes",KEY3     * Same-Day Payment list
          ENDIF
.
          MOVE      "No ",D3
          MATCH     "1",PMPWBICU
          IF        @EQUAL
            MOVE      "Yes",D3     * Bundle ICU
          ENDIF
.
          WRITE     HTMLFILE;"<tr><td>",PMPWCNTR,"</td>":
                             "<td nowrap><A HREF='javascript:ShowLink":
                             "(#"",LINKPRG,"#.pbl":
                             "?reportno=",LINKREP:
                             "&template=",LINKTEM:
                             "&pmpwa001=",PMPWCNTR:
                             "&pmpwa002=",PMPWDRGC,"#")'>":
                             "<img src=../images/MaintenanceIcon.gif hspace=4":
                             " border=0 align=absmiddle></a>":
                             PMPWDRGC,"</td>":
                             "<td>",PMPWDRGD,"</td>":
                             "<td>",KEY3,"</td>":
                             "<td>",D3,"</td>":
                             "<td>",PMPWALOS,"</td>":
                             "<td>",PMPWLOWB,"</td>":
                             "<td>",PMPWUPPB,"</td>":
                             "<td>",PMPWPSRV,"</td>":
                             "<td>",PMPWPAED,"</td>":
                             "<td>",PMPWSDAY,"</td>":
                             "<td>",PMPWSSOB,"</td>":
                             "<td>",PMPWSSOP,"</td>":
                             "<td>",PMPWINLI,"</td>":
                             "<td>&nbsp;",PMPWLSOP,"</td>":
                             "</tr>"
.
ADPWRW99  RETURN
+
.-----------------------------------------------------------------------------
. ABF Sub-acute price weight table
.-----------------------------------------------------------------------------
SBAPW000  UNPACK    DIM127,D1,LINKPRG,DIM127
          UNPACK    DIM127,D1,LINKREP,DIM127
          UNPACK    DIM127,D1,LINKTEM,DIM127
.
          IF        NORECORD=0
            MOVE      "20",NORECORD       * Set Default No Records to Display
          ENDIF
          MOVE      ZERO,RECNUMB
          MOVE      ZERO,DISNUMB
          MOVE      ZERO,LOOPCNTR
.
.         if a Contract ID is entered, use index 1 and position on Contract ID
.
          MOVE      ONE,F1                     * Using index 1
          MATCH     SP70,PMSAW001              * Contract ID
          GOTO      SBAPW200 IF NOT EQUAL      * not blank
          MATCH     SP70,PMSAW004
          GOTO      SBAPW150 IF NOT EQUAL      * Using index 3
          MATCH     SP70,PMSAW002
          GOTO      SBAPW999 IF EQUAL
.
          MOVE      TWO,F1                     * Using index 2
          PACK      KEY13,PMSAW002,SP70
          CALL      RSPMSAW2
SBAPW100  CALL      RKPMSAW2
          BRANCH    OVRCD,SBAPW999
.
          MATCH     SP70,PMSAW002
          IF        !@EQUAL
            MATCH     PMSAW002,PMSACLCD              * AN-SNAP Classification 
            GOTO      SBAPW999 IF NOT EQUAL
          ENDIF
.
          MATCH     SP70,PMSAW004
          IF        !@EQUAL
            MATCH     PMSAW004,PMSACCOD              * Care Type
            GOTO      SBAPW100 IF NOT EQUAL
          ENDIF
.
          MATCH     SP70,PMSAW001
          IF        !@EQUAL
            MATCH     PMSAW001,PMSACNTR              * Same contract id
            GOTO      SBAPW100 IF NOT EQUAL
          ENDIF
.
          GOTO      SBAPW500
.
SBAPW150  MOVE      THREE,F1                     * Using index 3
          PACK      KEY13,PMSAW004,PMSAW002,PMSAW003,PMSAW001,SP70
          CALL      RSPMSAW3 
SBAPW155  CALL      RKPMSAW3
          BRANCH    OVRCD,SBAPW999
.
          MATCH     SP70,PMSAW004
          IF        !@EQUAL
            MATCH     PMSAW004,PMSACCOD              * Care Type 
            GOTO      SBAPW999 IF NOT EQUAL
          ENDIF
.
          MATCH     SP70,PMSAW001
          IF        !@EQUAL
            MATCH     PMSAW001,PMSACNTR              * Same contract id
            GOTO      SBAPW155 IF NOT EQUAL
          ENDIF
.
          MATCH     SP70,PMSAW002
          IF        !@EQUAL
            MATCH     PMSAW002,PMSACLCD              * Same AN-SNAP Class
            GOTO      SBAPW155 IF NOT EQUAL
          ENDIF
.
          GOTO      SBAPW500
.
.         Position on Contract ID
.
SBAPW200  PACK      KEY13,PMSAW001,PMSAW002,SP70
          MATCH     SP70,KEY13
          GOTO      SBAPW300 IF EQUAL
.
          CALL      RDPMSAW1
          COMPARE   ZERO,OVRCD
          GOTO      SBAPW500 IF EQUAL
.
SBAPW300  CALL      RSPMSAW1
SBAPW400  CALL      RKPMSAW1
          BRANCH    OVRCD,SBAPW999
.
          MATCH     SP70,PMSAW001
          IF        !@EQUAL
            MATCH     PMSAW001,PMSACNTR              * Same contract id
            GOTO      SBAPW999 IF NOT EQUAL
          ENDIF
.
          MATCH     SP70,PMSAW002
          IF        !@EQUAL
            MATCH     PMSAW002,PMSACLCD              * Same AN-SNAP Class 
            GOTO      SBAPW400 IF NOT EQUAL
          ENDIF
.
          MATCH     SP70,PMSAW004
          IF        !@EQUAL
            MATCH     PMSAW004,PMSACCOD              * Care Type
            GOTO      SBAPW400 IF NOT EQUAL
          ENDIF
.
          MOVE      "No ",KEY3
          MATCH     "1",PMSASDOV
          IF        @EQUAL
            MOVE      "Yes",KEY3     * Same-Day Payment list
          ENDIF
.
SBAPW500  ADD       ONE,LOOPCNTR
.
.  Write record number in a comment to keep apache listening if no matches
.  are found per 1,000 records
.
          IF        (LOOPCNTR = 1000)
            WRITE     HTMLFILE;"<!--",LOOPCNTR,"-->"
            MOVE      ZERO,LOOPCNTR
          ENDIF
.
SBAPW600  ADD       ONE,RECNUMB
          IF        STARTNUM>=RECNUMB
            GOTO      SBAPW800
          ENDIF
.
          CALL      SAPWRW00
.
          MOVE      ZERO,LOOPCNTR
.
          ADD       ONE,DISNUMB
          COMPARE   NORECORD,DISNUMB
          IF        !@EQUAL
            GOTO      SBAPW800
          ENDIF
          GOTO      SBAPW999
.
SBAPW800  BRANCH    F1,SBAPW400,SBAPW100,SBAPW155
.
SBAPW999  RETURN
+
.-----------------------------------------------------------------------------
.         ABF Sub-acute price weight table row
.-----------------------------------------------------------------------------
SAPWRW00  WRITE     HTMLFILE;"<tr>":
                             "<td nowrap><A HREF='javascript:ShowLink":
                             "(#"",LINKPRG,"#.pbl":
                             "?reportno=",LINKREP:
                             "&template=",LINKTEM:
                             "&pmsaw001=",PMSACNTR:
                             "&pmsaw002=",PMSACLCD:
                             "&pmsaw003=",PMSAASVR:
                             "&pmsaw004=",PMSACCOD,"#")'>":
                             "<img src=../images/MaintenanceIcon.gif hspace=4":
                             " border=0 align=absmiddle></a>":
                             PMSACNTR,"</td>":
                             "<td>",PMSACLCD,"</td>":
                             "<td>",PMSAASVR,"</td>":
                             "<td>",PMSACCOD,"</td>":
                             "<td>",PMSAADSC,"</td>":
                             "<td>",PMSAEDSC,"</td>":
                             "<td>",KEY3,"</td>":
                             "<td>",PMSAALOS,"</td>":
                             "<td>",PMSALBIN,"</td>":
                             "<td>",PMSAUBIN,"</td>":
                             "<td>",PMSASDPW,"</td>":
                             "<td>",PMSASSOP,"</td>":
                             "<td>",PMSAINPW,"</td>":
                             "<td>&nbsp;",PMSALSOP,"</td>":
                             "</tr>"
.
SAPWRW99  RETURN
+
.-----------------------------------------------------------------------------
. ABF Non Admitted price weight table
.-----------------------------------------------------------------------------
NADPW000  UNPACK    DIM127,D1,LINKPRG,DIM127
          UNPACK    DIM127,D1,LINKREP,DIM127
          UNPACK    DIM127,D1,LINKTEM,DIM127
.
          IF        NORECORD=0
            MOVE      "20",NORECORD       * Set Default No Records to Display
          ENDIF
          MOVE      ZERO,RECNUMB
          MOVE      ZERO,DISNUMB
          MOVE      ZERO,LOOPCNTR
.
.         if a Contract ID is entered, use index 1 and position on Contract ID
.
          MOVE      ONE,F1                     * Using index 1
          MATCH     SP70,OTPWO001              * Contract ID
          GOTO      NADPW200 IF NOT EQUAL      * not blank
          MATCH     SP70,OTPWO002
          GOTO      NADPW999 IF EQUAL
.
          MOVE      TWO,F1                     * Using index 2
          PACK      KEY9,OTPWO002,SP70
          CALL      RSOTPWO2
NADPW100  CALL      RKOTPWO2
          BRANCH    OVRCD,NADPW999
.
          MATCH     SP70,OTPWO002
          IF        !@EQUAL
            MATCH     OTPWO002,OTPWTIER              * Tier2 Code
            GOTO      NADPW999 IF NOT EQUAL
          ENDIF
          GOTO      NADPW500
.
.         Position on Contract ID
.
NADPW200  PACK      KEY9,OTPWO001,OTPWO002,SP70
          MATCH     SP70,KEY9
          GOTO      NADPW300 IF EQUAL
.
          CALL      RDOTPWO1
          COMPARE   ZERO,OVRCD
          GOTO      NADPW500 IF EQUAL
.
NADPW300  CALL      RSOTPWO1
NADPW400  CALL      RKOTPWO1
          BRANCH    OVRCD,NADPW999
.
          MATCH     SP70,OTPWO001
          IF        !@EQUAL
            MATCH     OTPWO001,OTPWCNTR              * Same contract id
            GOTO      NADPW999 IF NOT EQUAL
          ENDIF
.
          MATCH     SP70,OTPWO002
          IF        !@EQUAL
            MATCH     OTPWO002,OTPWTIER              * Same Tier2 Code
            GOTO      NADPW999 IF NOT EQUAL
          ENDIF
.
NADPW500  ADD       ONE,LOOPCNTR
.
.  Write record number in a comment to keep apache listening if no matches
.  are found per 1,000 records
.
          IF        (LOOPCNTR = 1000)
            WRITE     HTMLFILE;"<!--",LOOPCNTR,"-->"
            MOVE      ZERO,LOOPCNTR
          ENDIF
.
NADPW600  ADD       ONE,RECNUMB
          IF        STARTNUM>=RECNUMB
            GOTO      NADPW800
          ENDIF
.
.  Long Description for Tier2 Code
.
          PACK      TDESC,SP70
          PACK      KEY5,CATNC,OTPWTIER,SP70
          CALL      RDCODE1
.
.  ABF Non Admitted price weight table row
.
          WRITE     HTMLFILE;"<tr><td>",OTPWCNTR,"</td>":
                             "<td nowrap><A HREF='javascript:ShowLink":
                             "(#"",LINKPRG,"#.pbl":
                             "?reportno=",LINKREP:
                             "&template=",LINKTEM:
                             "&otpwo001=",OTPWCNTR:
                             "&otpwo002=",OTPWTIER,"#")'>":
                             "<img src=../images/MaintenanceIcon.gif hspace=4":
                             " border=0 align=absmiddle></a>":
                             OTPWTIER,"</td>":
                             "<td>",TDESC,"</td>":
                             "<td>",OTPWPWEI,"</td>":
                             "</tr>"
.
.
          MOVE      ZERO,LOOPCNTR
.
          ADD       ONE,DISNUMB
          COMPARE   NORECORD,DISNUMB
          IF        !@EQUAL
            GOTO      NADPW800
          ENDIF
          GOTO      NADPW999
.
NADPW800  BRANCH    F1,NADPW400,NADPW100
.
NADPW999  RETURN
+
.-----------------------------------------------------------------------------
. ABF Emergency Dept price weight table
.-----------------------------------------------------------------------------
EMRPW000  UNPACK    DIM127,D1,LINKPRG,DIM127
          UNPACK    DIM127,D1,LINKREP,DIM127
          UNPACK    DIM127,D1,LINKTEM,DIM127
.
          IF        NORECORD=0
            MOVE      "20",NORECORD       * Set Default No Records to Display
          ENDIF
          MOVE      ZERO,RECNUMB
          MOVE      ZERO,DISNUMB
          MOVE      ZERO,LOOPCNTR
.
.         if a Contract ID is entered, use index 1 and position on Contract ID
.
          MOVE      ONE,F1                     * Using index 1
          MATCH     SP70,ERPWD001              * Contract ID
          GOTO      EMRPW200 IF NOT EQUAL      * not blank
          MATCH     SP70,ERPWD002
          GOTO      EMRPW999 IF EQUAL
.
          MOVE      TWO,F1                     * Using index 2
          PACK      KEY12,ERPWD002,SP70
          CALL      RSEMPWD2
EMRPW100  CALL      RKEMPWD2
          BRANCH    OVRCD,EMRPW999
.
          MATCH     SP70,ERPWD002
          IF        !@EQUAL
            MATCH     ERPWD002,EMPWURGV              * URG Code
            GOTO      EMRPW999 IF NOT EQUAL
          ENDIF
          GOTO      EMRPW500
.
.         Position on Contract ID
.
EMRPW200  PACK      KEY12,ERPWD001,ERPWD002,SP70
          MATCH     SP70,KEY12
          GOTO      EMRPW300 IF EQUAL
.
          CALL      RDEMPWD1
          COMPARE   ZERO,OVRCD
          GOTO      EMRPW500 IF EQUAL
.
EMRPW300  CALL      RSEMPWD1
EMRPW400  CALL      RKEMPWD1
          BRANCH    OVRCD,EMRPW999
.
          MATCH     SP70,ERPWD001
          IF        !@EQUAL
            MATCH     ERPWD001,EMPWCNTR              * Same contract id
            GOTO      EMRPW999 IF NOT EQUAL
          ENDIF
.
          MATCH     SP70,ERPWD002
          IF        !@EQUAL
            MATCH     ERPWD002,EMPWURGV              * Same URG Code
            GOTO      EMRPW999 IF NOT EQUAL
          ENDIF
.
EMRPW500  ADD       ONE,LOOPCNTR
.
.  Write record number in a comment to keep apache listening if no matches
.  are found per 1,000 records
.
          IF        (LOOPCNTR = 1000)
            WRITE     HTMLFILE;"<!--",LOOPCNTR,"-->"
            MOVE      ZERO,LOOPCNTR
          ENDIF
.
          ADD       ONE,RECNUMB
          IF        STARTNUM>=RECNUMB
            GOTO      EMRPW800
          ENDIF
.
.  ABF Non Admitted price weight table row
.
          WRITE     HTMLFILE;"<tr><td>",EMPWCNTR,"</td>":
                             "<td nowrap><A HREF='javascript:ShowLink":
                             "(#"",LINKPRG,"#.pbl":
                             "?reportno=",LINKREP:
                             "&template=",LINKTEM:
                             "&erpwd001=",EMPWCNTR:
                             "&erpwd002=",EMPWURGV,"#")'>":
                             "<img src=../images/MaintenanceIcon.gif hspace=4":
                             " border=0 align=absmiddle></a>":
                             EMPWURGV,"</td>":
                             "<td>",EMPWURGD,"</td>":
                             "<td>",EMPWPWEI,"</td>":
                             "</tr>"
.
.
          MOVE      ZERO,LOOPCNTR
.
          ADD       ONE,DISNUMB
          COMPARE   NORECORD,DISNUMB
          IF        !@EQUAL
            GOTO      EMRPW800
          ENDIF
          GOTO      EMRPW999
.
EMRPW800  BRANCH    F1,EMRPW400,EMRPW100
.
EMRPW999  RETURN
+
.-----------------------------------------------------------------------------
. ABF Radiotherapy/Dialysis codes table
.-----------------------------------------------------------------------------
ADRDI000  UNPACK    DIM127,D1,LINKPRG,DIM127
          UNPACK    DIM127,D1,LINKREP,DIM127
          UNPACK    DIM127,D1,LINKTEM,DIM127
.
          IF        NORECORD=0
            MOVE      "20",NORECORD       * Set Default No Records to Display
          ENDIF
          MOVE      ZERO,RECNUMB
          MOVE      ZERO,DISNUMB
          MOVE      ZERO,LOOPCNTR
.
.         if a Contract ID is entered, use index 1 and position on Contract ID
.
          MOVE      ONE,F1                     * Using index 1
          MATCH     SP70,PMRDI001              * Contract ID
          GOTO      ADRDI200 IF NOT EQUAL      * not blank
          MATCH     SP70,PMRDI002              * Type of Code
          GOTO      ADRDI300 IF NOT EQUAL      * not blank
          MATCH     SP70,PMRDI003              * Coding System
          GOTO      ADRDI400 IF NOT EQUAL      * not blank
          MATCH     SP70,PMRDI004              * Procedure Code
          GOTO      ADRDI999 IF EQUAL          * not blank
.
.         Position on ICD10 Code
.
          PACK      KEY29,PMRDI004,SP70
          CALL      RSPMRDI4
ADRDI100  CALL      RKPMRDI4
          BRANCH    OVRCD,ADRDI999
.
          MATCH     SP70,PMRDI004
          IF        !@EQUAL
            MATCH     PMRDI004,PMRIICDC              * ICD10 Code
            GOTO      ADRDI999 IF NOT EQUAL
          ENDIF
          GOTO      ADRDI500
.
.         Position on Contract ID
.
ADRDI200  MOVE      TWO,F1                         * Using index 1
          PACK      KEY29,PMRDI001,SP70
          CALL      RSPMRDI1
ADRDI210  CALL      RKPMRDI1
          BRANCH    OVRCD,ADRDI999
.
          MATCH     SP70,PMRDI001
          IF        !@EQUAL
            MATCH     PMRDI001,PMRICNTR              * Same contract id
            GOTO      ADRDI210 IF NOT EQUAL
          ENDIF
.
          MATCH     SP70,PMRDI002
          IF        !@EQUAL
            MATCH     PMRDI002,PMRICTYP              * Same Type of Code
            GOTO      ADRDI210 IF NOT EQUAL
          ENDIF
.
          MATCH     SP70,PMRDI003
          IF        !@EQUAL
            MATCH     PMRDI003,PMRISTYP              * Same Coding System
            GOTO      ADRDI210 IF NOT EQUAL
          ENDIF
.
          MATCH     SP70,PMRDI004
          IF        !@EQUAL
            MATCH     PMRDI004,PMRIICDC              * Same ICD10 Code  
            GOTO      ADRDI210 IF NOT EQUAL
          ENDIF
.
          GOTO      ADRDI500
.
.         Position on Type of Coding
.
ADRDI300  MOVE      THREE,F1                           * Using index 2
          PACK      KEY29,PMRDI002,SP70
          CALL      RSPMRDI2
ADRDI310  CALL      RKPMRDI2
          BRANCH    OVRCD,ADRDI999
.
          MATCH     SP70,PMRDI002
          IF        !@EQUAL
            MATCH     PMRDI002,PMRICTYP              * Same Type of Code
            GOTO      ADRDI310 IF NOT EQUAL
          ENDIF
.
          MATCH     SP70,PMRDI003
          IF        !@EQUAL
            MATCH     PMRDI003,PMRISTYP              * Same Coding System
            GOTO      ADRDI310 IF NOT EQUAL
          ENDIF
.
          MATCH     SP70,PMRDI004
          IF        !@EQUAL
            MATCH     PMRDI004,PMRIICDC              * Same ICD10 Code  
            GOTO      ADRDI310 IF NOT EQUAL
          ENDIF
.
          GOTO      ADRDI500
.
.         Position on Coding System
.
ADRDI400  MOVE      FOUR,F1                           * Using index 1
          PACK      KEY29,PMRDI003,SP70
          CALL      RSPMRDI3
ADRDI410  CALL      RKPMRDI3
          BRANCH    OVRCD,ADRDI999
.
          MATCH     SP70,PMRDI003
          IF        !@EQUAL
            MATCH     PMRDI003,PMRISTYP              * Same Coding System
            GOTO      ADRDI410 IF NOT EQUAL
          ENDIF
.
          MATCH     SP70,PMRDI004
          IF        !@EQUAL
            MATCH     PMRDI004,PMRIICDC              * Same ICD10 Code
            GOTO      ADRDI410 IF NOT EQUAL
          ENDIF
.
          GOTO      ADRDI500
.
ADRDI500  ADD       ONE,LOOPCNTR
.
.  Write record number in a comment to keep apache listening if no matches
.  are found per 1,000 records
.
          IF        (LOOPCNTR = 1000)
            WRITE     HTMLFILE;"<!--",LOOPCNTR,"-->"
            MOVE      ZERO,LOOPCNTR
          ENDIF
.
ADRDI600  ADD       ONE,RECNUMB
          IF        STARTNUM>=RECNUMB
            GOTO      ADRDI800
          ENDIF
.
.         TYPE OF CODE DESCRIPTION
.
          MATCH     " 1",PMRICTYP
          IF        @EQUAL
            MOVE     "Radiotherapy",TYPOFCED;
          ELSE
            MATCH     " 2",PMRICTYP
            IF        @EQUAL
              MOVE      "Dialysis",TYPOFCED;
            ENDIF
          ENDIF
.
.         CODING SYSTEM
.
          MATCH     "1",PMRISTYP
          IF        @EQUAL
            MOVE      "ICD10",CODSYDES;
          ENDIF
.
.         ICD10 Code Description
.
          PACK      ICD10DES,SP70,SP70,SP70
          PACK      KEY9,PMRIICDC,SP70
          CALL      RDPTICO1            * Read ICD10 Procedure record
          IF        OVRCD=1
            CALL      RD10T9O1                   * Read ICD9
            BRANCH    OVRCD,PSRD0700           
          ENDIF
          MATCH     SP70,PT0ODSC2
          IF        !@EOS & !@EQUAL
            PACK      ICD10DES,PT0ODSC2
          ELSE
            PACK      ICD10DES,ODESC
          ENDIF
.
.  ABF Non Admitted price weight table row
.
PSRD0700  WRITE     HTMLFILE;"<tr><td>",PMRICNTR,"</td>":
                             "<td>",TYPOFCED,"</td>":
                             "<td>",CODSYDES,"</td>":
                             "<td nowrap><A HREF='javascript:ShowLink":
                             "(#"",LINKPRG,"#.pbl":
                             "?reportno=",LINKREP:
                             "&template=",LINKTEM:
                             "&pmrdi001=",PMRICNTR:
                             "&pmrdi002=",PMRICTYP:
                             "&pmrdi003=",PMRISTYP:
                             "&pmrdi004=",PMRIICDC,"#")'>":
                             "<img src=../images/MaintenanceIcon.gif hspace=4":
                             " border=0 align=absmiddle></a>":
                             PMRIICDC,"</td>":
                             "<td>",ICD10DES,"</td>":
                             "</tr>"
.
.
          MOVE      ZERO,LOOPCNTR
.
          ADD       ONE,DISNUMB
          COMPARE   NORECORD,DISNUMB
          IF        !@EQUAL
            GOTO      ADRDI800
          ENDIF
          GOTO      ADRDI999
.
ADRDI800  BRANCH    F1,ADRDI100,ADRDI210,ADRDI310,ADRDI410
.
ADRDI999  RETURN
+
.-----------------------------------------------------------------------------
. ABF HAC Adjustments table
.-----------------------------------------------------------------------------
PMHAD000  UNPACK    DIM127,D1,LINKPRG,DIM127
          UNPACK    DIM127,D1,LINKREP,DIM127
          UNPACK    DIM127,D1,LINKTEM,DIM127
.
          IF        NORECORD=0
            MOVE      "20",NORECORD       * Set Default No Records to Display
          ENDIF
          MOVE      ZERO,RECNUMB
          MOVE      ZERO,DISNUMB
          MOVE      ZERO,LOOPCNTR
.
.         if a Contract ID is entered, use index 1 and position on Contract ID
.
          MOVE      ONE,F1                           * Using index 1
          MATCH     SP70,PMHAD001                    * Contract ID
          GOTO      PMHAD200 IF NOT EQUAL            * not blank
          MATCH     SP70,PMHAD002
          GOTO      PMHAD999 IF EQUAL
.
          MOVE      TWO,F1                           * Using index 2
          PACK      KEY12,PMHAD002,SP70
          CALL      RSPMHAD2 
PMHAD100  CALL      RKPMHAD2
          BRANCH    OVRCD,PMHAD999
.
          MATCH     SP70,PMHAD002
          IF        !@EQUAL
            MATCH     PMHAD002,PMHDHACG              * HAC Group 01-16 Cat Ha
            GOTO      PMHAD999 IF NOT EQUAL
          ENDIF
          GOTO      PMHAD500
.
.         Position on Contract ID
.
PMHAD200  PACK      KEY12,PMHAD001,PMHAD002,SP70
          CALL      RSPMHAD1
PMHAD300  CALL      RKPMHAD1
          BRANCH    OVRCD,PMHAD999
.
          MATCH     SP70,PMHAD001
          IF        !@EQUAL
            MATCH     PMHAD001,PMHDCNTR              * Same contract id
            GOTO      PMHAD999 IF NOT EQUAL
          ENDIF
.
          MATCH     SP70,PMHAD002
          IF        !@EQUAL
            MATCH     PMHAD002,PMHDHACG              * HAC Group 01-16 Cat Ha
            GOTO      PMHAD999 IF NOT EQUAL
          ENDIF
.
PMHAD500  ADD       ONE,LOOPCNTR
.
.  Write record number in a comment to keep apache listening if no matches
.  are found per 1,000 records
.
          IF        (LOOPCNTR = 1000)
            WRITE     HTMLFILE;"<!--",LOOPCNTR,"-->"
            MOVE      ZERO,LOOPCNTR
          ENDIF
.
PMHAD600  ADD       ONE,RECNUMB
          IF        STARTNUM>=RECNUMB
            GOTO      PMHAD800
          ENDIF
.
.  Long Description for HAC Group 01-16 Cat Ha
.
          PACK      TDESC,SP70
          PACK      KEY5,CATHa,PMHDHACG,SP70
          CALL      RDCODE1
.
.  ABF Non Admitted price weight table row
.
          WRITE     HTMLFILE;"<tr><td>",PMHDCNTR,"</td>":
                             "<td nowrap><A HREF='javascript:ShowLink":
                             "(#"",LINKPRG,"#.pbl":
                             "?reportno=",LINKREP:
                             "&template=",LINKTEM:
                             "&pmhad001=",PMHDCNTR:
                             "&pmhad002=",PMHDHACG:
                             "&pmhad003=",PMHDVALF,"#")'>":
                             "<img src=../images/MaintenanceIcon.gif hspace=4":
                             " border=0 align=absmiddle></a>":
                             PTCDLDES,"</td>":
                             "<td>",PMHDVALF,"</td>":
                             "<td>",PMHDVALT,"</td>":
                             "<td>",PMHDADJV,"</td>":
                             "</tr>"
.
.
          MOVE      ZERO,LOOPCNTR
.
          ADD       ONE,DISNUMB
          COMPARE   NORECORD,DISNUMB
          IF        !@EQUAL
            GOTO      PMHAD800
          ENDIF
          GOTO      PMHAD999
.
PMHAD800  BRANCH    F1,PMHAD300,PMHAD100
.
PMHAD999  RETURN
+
.-----------------------------------------------------------------------------
. ABF EMR URG Classification table
.-----------------------------------------------------------------------------
EMRUR000  UNPACK    DIM127,D1,LINKPRG,DIM127
          UNPACK    DIM127,D1,LINKREP,DIM127
          UNPACK    DIM127,D1,LINKTEM,DIM127
.
          IF        NORECORD=0
            MOVE      "20",NORECORD       * Set Default No Records to Display
          ENDIF
          MOVE      ZERO,RECNUMB
          MOVE      ZERO,DISNUMB
          MOVE      ZERO,LOOPCNTR
.
.       if Effective End Date is entered, use index 1 and position on it
.
          MOVE      ONE,F1                           * Using index 1
          MATCH     SP70,ERURG001                    * Effective End Date
          GOTO      EMRUR200 IF NOT EQUAL            
          MATCH     SP70,ERURG002                    * Episode End Status Cat ED
          GOTO      EMRUR300 IF NOT EQUAL
          MATCH     SP70,ERURG003                    * Triage Code Cat AA
          GOTO      EMRUR400 IF NOT EQUAL
          MATCH     SP70,ERURG004                    * Type of Visit Cat ee
          GOTO      EMRUR500 IF NOT EQUAL
          MATCH     SP70,ERURG005                    * MDB Code
          GOTO      EMRUR999 IF EQUAL
.
.         Position on MDB Code
.
          STRIP     ERURG005
          PACK      KEY47,ERURG005,SP70
          CALL      RSEMURG5
EMRUR100  CALL      RKEMURG5
          BRANCH    OVRCD,EMRUR999
.
          MATCH     SP70,ERURG005
          IF        !@EQUAL
            MATCH     ERURG005,EMURMDBC
            GOTO      EMRUR999 IF NOT EQUAL
          ENDIF
          GOTO     EMRUR600
. 
.         Position on Effective End Date
.
EMRUR200  MOVE      TWO,F1                           * Using index 2
          PACK      KEY47,ERURG001,SP70
          CALL      RSEMURG1 
EMRUR210  CALL      RKEMURG1
          BRANCH    OVRCD,EMRUR999
.
          MATCH     SP70,ERURG001
          IF        !@EQUAL
            MATCH     ERURG001,EMUREDAT              * Type of Visit Cat ee  
            GOTO      EMRUR999 IF NOT EQUAL
          ENDIF
.
          MATCH     SP70,ERURG002
          IF        !@EQUAL
            MATCH     ERURG002,EMURESTA              * Episode End Status Cat ED
            GOTO      EMRUR210 IF NOT EQUAL
          ENDIF 
.
          MATCH     SP70,ERURG003
          IF        !@EQUAL
            MATCH     ERURG003,EMURTRIA              * Triage Code Cat AA
            GOTO      EMRUR210 IF NOT EQUAL
          ENDIF
.
          MATCH     SP70,ERURG004
          IF        !@EQUAL
            MATCH     ERURG004,EMURVTYP              * Type of Visit Cat ee
            GOTO      EMRUR210 IF NOT EQUAL
          ENDIF
.
          MATCH     SP70,ERURG005
          IF        !@EQUAL
            STRIP     ERURG005
            MATCH     ERURG005,EMURMDBC              * MDB Code
            GOTO      EMRUR210 IF NOT EQUAL
          ENDIF
          GOTO      EMRUR600
.
.         Position on Episode End Status Cat ED
.
EMRUR300  MOVE      THREE,F1
          PACK      KEY47,ERURG002,SP70
          CALL      RSEMURG2
EMRUR310  CALL      RKEMURG2
          BRANCH    OVRCD,EMRUR999
.
          MATCH     SP70,ERURG002
          IF        !@EQUAL
            MATCH     ERURG002,EMURESTA              * Episode End Status Cat ED
            GOTO      EMRUR999 IF NOT EQUAL
          ENDIF
.
          MATCH     SP70,ERURG003
          IF        !@EQUAL
            MATCH     ERURG003,EMURTRIA              * Triage Code Cat AA
            GOTO      EMRUR310 IF NOT EQUAL
          ENDIF
.
          MATCH     SP70,ERURG004
          IF        !@EQUAL
            MATCH     ERURG004,EMURVTYP              * Type of Visit Cat ee
            GOTO      EMRUR310 IF NOT EQUAL
          ENDIF
.
          MATCH     SP70,ERURG005
          IF        !@EQUAL
            STRIP     ERURG005
            MATCH     ERURG005,EMURMDBC              * MDB Code
            GOTO      EMRUR310 IF NOT EQUAL
          ENDIF
          GOTO      EMRUR600
.
.         Position on Type of Visit Cat ee
.
EMRUR400  MOVE      FOUR,F1
          PACK      KEY47,ERURG003,SP70
          CALL      RSEMURG3
EMRUR410  CALL      RKEMURG3
          BRANCH    OVRCD,EMRUR999
.
          MATCH     SP70,ERURG003
          IF        !@EQUAL
            MATCH     ERURG003,EMURTRIA              * Triage Code Cat AA
            GOTO      EMRUR999 IF NOT EQUAL
          ENDIF
.
          MATCH     SP70,ERURG004
          IF        !@EQUAL
            MATCH     ERURG004,EMURVTYP              * Type of Visit Cat ee
            GOTO      EMRUR410 IF NOT EQUAL
          ENDIF
.
          MATCH     SP70,ERURG005
          IF        !@EQUAL
            STRIP     ERURG005
            MATCH     ERURG005,EMURMDBC              * MDB Code
            GOTO      EMRUR410 IF NOT EQUAL
          ENDIF
          GOTO      EMRUR600
.
.         Position on Episode End Status Cat ED
.
EMRUR500  MOVE      FIVE,F1
          PACK      KEY47,ERURG004,SP70
          CALL      RSEMURG4
EMRUR510  CALL      RKEMURG4
          BRANCH    OVRCD,EMRUR999
.
          MATCH     SP70,ERURG004
          IF        !@EQUAL
            MATCH     ERURG004,EMURVTYP              * Type of Visit Cat ee
            GOTO      EMRUR999 IF NOT EQUAL
          ENDIF
.
          MATCH     SP70,ERURG005
          IF        !@EQUAL
            STRIP     ERURG005
            MATCH     ERURG005,EMURMDBC              * MDB Code
            GOTO      EMRUR510 IF NOT EQUAL
          ENDIF
          GOTO      EMRUR600
.
.
EMRUR600  ADD       ONE,LOOPCNTR
.
.  Write record number in a comment to keep apache listening if no matches
.  are found per 1,000 records
.
          IF        (LOOPCNTR = 1000)
            WRITE     HTMLFILE;"<!--",LOOPCNTR,"-->"
            MOVE      ZERO,LOOPCNTR
          ENDIF
.
EMRUR700  ADD       ONE,RECNUMB
          IF        STARTNUM>=RECNUMB
            GOTO      EMRUR800
          ENDIF
.
.  Change format for Effective End Date
.
          UNPACK    EMUREDAT,CCENT,CYEAR,CMON,CDAY
          MOVE      CMON,F2
          LOAD      MTHNAM3,F2,JAN,FEB,MAR,APR,MAY,JUN,JUL,AUG,SEP,OCT,NOV,DEC
          PACK      EFENDDAT,CDAY,SP1,MTHNAM3,SP1,CCENT,CYEAR
.
.  Long Description for Episode End Status Cat ED
.
          PACK      TDESC,SP70
          PACK      KEY5,CATED,EMURESTA,SP70
          CALL      RDCODE1
          MOVE      TDESC,EPISDESC
.
.  Long Description for Triage Code Cat AA
.
          PACK      TDESC,SP70
          PACK      KEY5,CATAA,EMURTRIA,SP70
          CALL      RDCODE1
          MOVE      TDESC,TRIADESC
.
.  Long Description for Type of Visit Cat ee
.
          PACK      TDESC,SP70
          MATCH     EMURVTYP,SP70
          GOTO      EMRUR710 IF EQUAL
          PACK      KEY5,CATee,EMURVTYP,SP70
          CALL      RDCODE1
EMRUR710  MOVE      TDESC,VISTDESC
.
.  ABF EMR URG Classification table row
.
          WRITE     HTMLFILE;"<tr><td nowrap><A HREF='javascript:ShowLink":
                             "(#"",LINKPRG,"#.pbl":
                             "?reportno=",LINKREP:
                             "&template=",LINKTEM:
                             "&erurg001=",EFENDDAT:
                             "&erurg002=",EMURESTA:
                             "&erurg003=",EMURTRIA:
                             "&erurg004=",EMURVTYP:
                             "&erurg005=",EMURMDBC:
                             "&erurg006=",EMURURGV:
                             "&erurg007=",EMURURGD,"#")'>":
                             "<img src=../images/MaintenanceIcon.gif hspace=4":
                             " border=0 align=absmiddle></a>":
                             EFENDDAT,"</td>":
                             "<td>",EPISDESC,"</td>":
                             "<td>",TRIADESC,"</td>":
                             "<td>",VISTDESC,"</td>":
                             "<td>",EMURMDBC,"</td>":
                             "<td>",EMURURGV,"</td>":
                             "<td>",EMURURGD,"</td>":
                             "</tr>"
.
.
          MOVE      ZERO,LOOPCNTR
.
          ADD       ONE,DISNUMB
          COMPARE   NORECORD,DISNUMB
          IF        !@EQUAL
            GOTO      EMRUR800
          ENDIF
          GOTO      EMRUR999
.
EMRUR800  BRANCH    F1,EMRUR100,EMRUR210,EMRUR310,EMRUR410,EMRUR510
.
EMRUR999  RETURN
+
.-----------------------------------------------------------------------------
. ABF MH price weight table
.-----------------------------------------------------------------------------
PMCCT000  UNPACK    DIM127,D1,LINKPRG,DIM127
          UNPACK    DIM127,D1,LINKREP,DIM127
          UNPACK    DIM127,D1,LINKTEM,DIM127
.
          IF        NORECORD=0
            MOVE      "20",NORECORD       *Set Default No Records to Display
          ENDIF
          MOVE      ZERO,RECNUMB
          MOVE      ZERO,DISNUMB
          MOVE      ZERO,LOOPCNTR
.
.         If a Contract ID is entered, use index 1 and position on Contract ID
.
          MOVE      ONE,F1                       * Using index 1
          MATCH     SP70,PMAMH001                * Contract ID
          GOTO      PMCCT200 IF NOT EQUAL        * not blank
          MATCH     SP70,PMAMH002
          GOTO      PMCCT999 IF EQUAL
.
          MOVE      TWO,F1                       * Using index 2
          PACK      KEY16,PMAMH002,SP70
          CALL      RSPMAMH2
PMCCT100  CALL      RKPMAMH2
          BRANCH    OVRCD,PMCCT999
.
          MATCH     SP70,PMAMH002
          IF        !@EQUAL
            MATCH     PMAMH002,PMMHAMHC          * MHACC Classification
            GOTO      PMCCT999 IF NOT EQUAL
          ENDIF
          GOTO      PMCCT500
.
.         Position on Contract ID
.
PMCCT200  PACK      KEY16,PMAMH001,PMAMH002,SP70
          MATCH     SP70,KEY16
          GOTO      PMCCT300 IF EQUAL
.
          CALL      RDPMAMH1
          COMPARE   ZERO,OVRCD
          GOTO      PMCCT500 IF EQUAL
.
PMCCT300  CALL      RSPMAMH1
PMCCT400  CALL      RKPMAMH1
          BRANCH    OVRCD,PMCCT999
.
          MATCH     SP70,PMAMH001
          IF        !@EQUAL
            MATCH     PMAMH001,PMMHCNTR            * Same contact id
            GOTO      PMCCT999 IF NOT EQUAL
          ENDIF
.
          MATCH     SP70,PMAMH002
          IF        !@EQUAL
            MATCH     PMAMH002,PMMHAMHC            * Same MHACC class
            GOTO      PMCCT400 IF NOT EQUAL
          ENDIF
.
PMCCT500  ADD       ONE,LOOPCNTR
.
.  Write record number in a comment to keep apache listening if no matches
.  are found per 1,000 records
.
          IF        (LOOPCNTR = 1000)
            WRITE     HTMLFILE;"<!--",LOOPCNTR,"-->"
            MOVE      ZERO,LOOPCNTR
          ENDIF
.
PMCCT600  ADD       ONE,RECNUMB
          IF        STARTNUM>=RECNUMB
            GOTO      PMCCT800
          ENDIF
.
          CALL      PMCCRW00
.
          MOVE      ZERO,LOOPCNTR
.
          ADD       ONE,DISNUMB
          COMPARE   NORECORD,DISNUMB
          IF        !@EQUAL
            GOTO      PMCCT800
          ENDIF
          GOTO      PMCCT999
.
PMCCT800  BRANCH    F1,PMCCT400,PMCCT100
.
PMCCT999  RETURN
+
.-----------------------------------------------------------------------------
.         ABF MH price weight table row
.-----------------------------------------------------------------------------
PMCCRW00  WRITE     HTMLFILE;"<tr>":
                             "<td>",PMMHCNTR,"</td>":
                             "<td nowrap><a href='javascript:ShowLink":
                             "(#"",LINKPRG,"#.pbl":
                             "?reportno=",LINKREP:
                             "&template=",LINKTEM:
                             "&pmamh001=",PMMHCNTR:
                             "&pmamh002=",PMMHAMHC,"#")'>":
                             "<img src=../images/MaintenanceIcon.gif hspace=4":
                             " border=0 align=absmiddle></a>":
                             PMMHAMHC,"</td>":
                             "<td>",PMMHAMHD,"</td>":
                             "<td>",PMMHAVPL,"</td>":
                             "<td>",PMMHLOWB,"</td>":
                             "<td>",PMMHUPPB,"</td>":
                             "<td>",PMMHSSOB,"</td>":
                             "<td>",PMMHSSOP,"</td>":
                             "<td>",PMMHINLI,"</td>":
                             "<td>",PMMHLSOP,"</td>":
                             "<td>",PMMHPPSA,"</td>":
                             "</tr>"
.
PMCCRW99  RETURN
+
.-------------------------------------------------------------
. Link to Prev ABF Admitted Acute PW
.-------------------------------------------------------------
PRVPW000  MOVE      NORECORD,KEY2
          REP       " +",KEY2
          ASSIGN    STARTNUM-NORECORD,F3
          IF        F3<0
            MOVE      ZERO,F3
          ENDIF
          MOVE      F3,KEY3
          REP       " +",KEY3
          UNPACK    DIM127,D1,FLDPARA,DIM127
          MOVE      REPORTNO,FORM2
.
          WRITE     HTMLFILE;"patweb18.pbl":
                                 "?reportno=",FORM2:
                                 "&template=",FLDPARA:
                                 "&startnum=",KEY3:
                                 "&norecord=",KEY2;
.
          COMPARE   NINE,REPORTNO
          GOTO      PRVPW100 IF EQUAL      * Admitted MH PW
.
          REP       " +",ERPWD001
          REP       " +",ERPWD002
          REP       "+ ",ERURG001
.
          PACK      DIM11,SP70
          MATCH     SP70,ERURG001
          IF        !@EQUAL & !@EOS
            UNPACK    ERURG001,CCENT,CYEAR,CMON,CDAY
            MOVE      CMON,F2
           LOAD      MTHNAM3,F2,JAN,FEB,MAR,APR,MAY,JUN,JUL,AUG,SEP,OCT,NOV,DEC
            PACK      DIM11,CDAY,SP1,MTHNAM3,SP1,CCENT,CYEAR
          ENDIF 
.
          REP       " +",DIM11
          REP       " +",ERURG002
          REP       " +",ERURG003
          REP       " +",ERURG004
          REP       " +",ERURG005
          REP       " +",OTPWO001
          REP       " +",OTPWO002
          REP       " +",PMHAD001
          REP       " +",PMHAD002
          REP       " +",PMPWA001
          REP       " +",PMPWA002
          REP       " +",PMSAW001
          REP       " +",PMSAW002
          REP       " +",PMSAW004
          REP       " +",PMRDI001
          REP       " +",PMRDI002
          REP       " +",PMRDI003
          REP       " +",PMRDI004
.
          WRITE     HTMLFILE;"&erpwd001=",ERPWD001:
                                 "&erpwd002=",ERPWD002:
                                 "&effenddt=",DIM11:
                                 "&erurg002=",ERURG002:
                                 "&erurg003=",ERURG003:
                                 "&erurg004=",ERURG004:
                                 "&erurg005=",ERURG005:
                                 "&otpwo001=",OTPWO001:
                                 "&otpwo002=",OTPWO002:
                                 "&pmhad001=",PMHAD001:
                                 "&pmhad002=",PMHAD002:
                                 "&pmpwa001=",PMPWA001:
                                 "&pmpwa002=",PMPWA002:
                                 "&pmsaw001=",PMSAW001:
                                 "&pmsaw002=",PMSAW002:
                                 "&pmsaw004=",PMSAW004:
                                 "&pmrdi001=",PMRDI001:
                                 "&pmrdi002=",PMRDI002:
                                 "&pmrdi003=",PMRDI003:
                                 "&pmrdi004=",PMRDI004;
.
          REP       "+ ",PMPWA001
          REP       "+ ",PMPWA002
          REP       "+ ",PMSAW001
          REP       "+ ",PMSAW002
          REP       "+ ",PMSAW004
.
          GOTO      PRVPW900
.
PRVPW100  REP       " +",PMAMH001
          REP       " +",PMAMH002
.
          WRITE     HTMLFILE;"&pmamh001=",PMAMH001:
                                 "&pmamh002=",PMAMH002;
          REP       "+ ",PMAMH002
          REP       "+ ",PMAMH001
.
PRVPW900  MATCH     "1",MENUFLAG
          IF        @EQUAL
            WRITE     HTMLFILE;"&menuflag=1";
          ENDIF
.
PRVPW999  RETURN
+
.-------------------------------------------------------------------------
. Link to Next ABF Admitted Acute PW
.-------------------------------------------------------------------------
NXTPW000  MOVE      NORECORD,KEY2
          REP       " +",KEY2
          ASSIGN    STARTNUM+NORECORD,F3
          MOVE      F3,KEY3
          REP       " +",KEY3
          UNPACK    DIM127,D1,FLDPARA,DIM127
          MOVE      REPORTNO,FORM2
.
          WRITE     HTMLFILE;"patweb18.pbl":
                                 "?reportno=",FORM2:
                                 "&template=",FLDPARA:
                                 "&startnum=",KEY3:
                                 "&norecord=",KEY2;
.
          COMPARE   NINE,REPORTNO
          GOTO      NXTPW100 IF EQUAL      * Admitted MH PW
.
          REP       " +",ERPWD001
          REP       " +",ERPWD002
          REP       "+ ",ERURG001
.
          PACK      DIM11,SP70
          MATCH     SP70,ERURG001
          IF        !@EQUAL & !@EOS
            UNPACK    ERURG001,CCENT,CYEAR,CMON,CDAY
            MOVE      CMON,F2
           LOAD      MTHNAM3,F2,JAN,FEB,MAR,APR,MAY,JUN,JUL,AUG,SEP,OCT,NOV,DEC
            PACK      DIM11,CDAY,SP1,MTHNAM3,SP1,CCENT,CYEAR
          ENDIF 
.
          REP       " +",DIM11
          REP       " +",ERURG002
          REP       " +",ERURG003
          REP       " +",ERURG004
          REP       " +",ERURG005
          REP       " +",PMPWA001
          REP       " +",PMPWA002
          REP       " +",PMSAW001
          REP       " +",PMSAW002
          REP       " +",PMSAW004
          REP       " +",OTPWO001
          REP       " +",OTPWO002
          REP       " +",PMHAD001
          REP       " +",PMHAD002
          REP       " +",PMRDI001
          REP       " +",PMRDI002
          REP       " +",PMRDI003
          REP       " +",PMRDI004
.
          WRITE     HTMLFILE;"&erpwd001=",ERPWD001:
                                 "&erpwd002=",ERPWD002:
                                 "&effenddt=",DIM11:
                                 "&erurg002=",ERURG002:
                                 "&erurg003=",ERURG003:
                                 "&erurg004=",ERURG004:
                                 "&erurg005=",ERURG005:
                                 "&otpwo001=",OTPWO001:
                                 "&otpwo002=",OTPWO002:
                                 "&pmhad001=",PMHAD001:
                                 "&pmhad002=",PMHAD002:
                                 "&pmpwa001=",PMPWA001:
                                 "&pmpwa002=",PMPWA002:
                                 "&pmsaw001=",PMSAW001:
                                 "&pmsaw002=",PMSAW002:
                                 "&pmsaw004=",PMSAW004:
                                 "&pmrdi001=",PMRDI001:
                                 "&pmrdi002=",PMRDI002:
                                 "&pmrdi003=",PMRDI003:
                                 "&pmrdi004=",PMRDI004;
.
          REP       "+ ",PMSAW001
          REP       "+ ",PMSAW002
          REP       "+ ",PMSAW004
.
          GOTO      NXTPW900
.
NXTPW100  REP       " +",PMAMH001
          REP       " +",PMAMH002
.
          WRITE     HTMLFILE;"&pmamh001=",PMAMH001:
                             "&pmamh002=",PMAMH002;
.
          REP       "+ ",PMAMH002
          REP       "+ ",PMAMH001
.
NXTPW900  MATCH     "1",MENUFLAG
          IF        @EQUAL
            WRITE     HTMLFILE;"&menuflag=1";
          ENDIF
.
NXTPW999  RETURN
+
.-----------------------------------------------------------------------------
. Multiple NEP Value List
.-----------------------------------------------------------------------------
LNEP0000  UNPACK    DIM127,D1,LINKPRG,DIM127
          UNPACK    DIM127,D1,LINKREP,DIM127
          UNPACK    DIM127,D1,LINKTEM,DIM127
.
          IF        NORECORD=0
            MOVE      "20",NORECORD       * Set Default No Records to Display
          ENDIF
          MOVE      ZERO,RECNUMB
          MOVE      ZERO,DISNUMB
          MOVE      ZERO,LOOPCNTR
.
          MOVE      ONE,F1
          REP       "0 ",PMNEP002
          MATCH     SP70,PMNEP001              * Contract ID
          GOTO      LNEP2000 IF NOT EQUAL
.
.         Position on Visit type
.
          MOVE      TWO,F1
          PACK      KEY58,PMNEP002,PMNEP001,SP70
          CALL      RDPMNEP2
          COMPARE   ZERO,OVRCD
          GOTO      LNEP5000 IF EQUAL
.
          CALL      RSPMNEP2
LNEP1000  CALL      RKPMNEP2
          BRANCH    OVRCD,LNEP9999
.
          MATCH     SP70,PMNEP002
          IF        !@EQUAL
            MATCH     PMNEP002,PMNEVTYP              * Visit type
            GOTO      LNEP9999 IF NOT EQUAL
          ENDIF
.
          MATCH     SP70,PMNEP001
          IF        !@EQUAL
            MATCH     PMNEP001,PMNECNTR              * COntract ID
            GOTO      LNEP1000 IF NOT EQUAL
          ENDIF
          GOTO      LNEP5000
.
.         Position on Contract id
.
LNEP2000  PACK      KEY58,PMNEP001,PMNEP002,SP70
          CALL      RDPMNEP1
          COMPARE   ZERO,OVRCD
          GOTO      LNEP5000 IF EQUAL
.
          CALL      RSPMNEP1
LNEP4000  CALL      RKPMNEP1
          BRANCH    OVRCD,LNEP9999
.
          MATCH     SP70,PMNEP001
          IF        !@EQUAL
            MATCH     PMNEP001,PMNECNTR              * COntract ID
            GOTO      LNEP9999 IF NOT EQUAL
          ENDIF
.
          MATCH     SP70,PMNEP002
          IF        !@EQUAL
            MATCH     PMNEP002,PMNEVTYP              * Visit type
            GOTO      LNEP4000 IF NOT EQUAL
          ENDIF
.
LNEP5000  ADD       ONE,LOOPCNTR
.
.  Write record number in a comment to keep apache listening if no matches
.  are found per 1,000 records
.
          IF        (LOOPCNTR = 1000)
            WRITE     HTMLFILE;"<!--",LOOPCNTR,"-->"
            MOVE      ZERO,LOOPCNTR
          ENDIF
.
          ADD       ONE,RECNUMB
          IF        STARTNUM>=RECNUMB
            GOTO      LNEP8000
          ENDIF
.
          CALL      NEPVRW00
.
          MOVE      ZERO,LOOPCNTR
.
          ADD       ONE,DISNUMB
          COMPARE   NORECORD,DISNUMB
          IF        !@EQUAL
            GOTO      LNEP8000
          ENDIF
          GOTO      LNEP9999
.
LNEP8000  BRANCH    F1,LNEP4000,LNEP1000
.
LNEP9999  RETURN
+
.-----------------------------------------------------------------------------
.         ABF Admitted acute price weight table row
.-----------------------------------------------------------------------------
NEPVRW00  MOVE      ZERO,FORM2
          MOVE      PMNEVTYP,FORM2
          MOVE      SP70,KEY15
          LOAD      KEY15,FORM2,VTYPE01,VTYPE02,VTYPE03
          IF        FORM2=9
            PACK      KEY15,VTYPE04,SP70     * Events
          ENDIF
.
          WRITE     HTMLFILE;"<tr>":
                             "<td nowrap><A HREF='javascript:ShowLink":
                             "(#"",LINKPRG,"#.pbl":
                             "?reportno=",LINKREP:
                             "&template=",LINKTEM:
                             "&pmnep001=",PMNECNTR:
                             "&pmnep002=",PMNEVTYP:
                             "&pmnep003=",PMNECODE:
                             "&pmnep004=",PMNEINDC:
                             "&pmnep005=",PMNEINDV,"#")'>":
                             "<img src=../images/MaintenanceIcon.gif hspace=4":
                             " border=0 align=absmiddle></a>";
.
          WRITE     HTMLFILE;PMNECNTR,"</td>":
                             "<td>",KEY15,"</td>";
.
          MATCH     "CC",PMNECODE
          IF        @EQUAL
            WRITE     HTMLFILE;"<td>Category CC</td>";
          ELSE
            MATCH     "CL",PMNECODE
            IF        @EQUAL
              WRITE     HTMLFILE;"<td>Category CL</td>";
            ELSE
              WRITE     HTMLFILE;"<td>",PMNECODE,"</td>";
            ENDIF
          ENDIF
.
          WRITE     HTMLFILE;"<td>",PMNEINDC,"</td>":
                             "<td>",PMNEINDV,"</td>":
                             "<td>$",PMNENEPP,"</td>";
.
          MOVE      "Yes",KEY3
          MATCH     "1",PMNEACTV
          IF        @EQUAL
            MOVE      "No ",KEY3
          ENDIF
          WRITE     HTMLFILE;"<td>",KEY3,"</td>":
                             "</tr>"
.
NEPVRW99  RETURN
+
.-----------------------------------------------------------------------------
.        Previous screen NEP values List
.-----------------------------------------------------------------------------
PRVNE000  MOVE      NORECORD,KEY2
          REP       " +",KEY2
          ASSIGN    STARTNUM-NORECORD,F3
          IF        F3<0
            MOVE      ZERO,F3
          ENDIF
          MOVE      F3,KEY3
          REP       " +",KEY3
          UNPACK    DIM127,D1,FLDPARA,DIM127
          MOVE      REPORTNO,FORM2
.
          REP       " +",PMNEP001
          REP       " +",PMNEP002
          REP       " +",PMNEP003
.
          WRITE     HTMLFILE;"patweb18.pbl":
                                 "?reportno=",FORM2:
                                 "&template=",FLDPARA:
                                 "&startnum=",KEY3:
                                 "&norecord=",KEY2:
                                 "&pmnep001=",PMNEP001:
                                 "&pmnep002=",PMNEP002:
                                 "&pmnep003=",PMNEP003;
          MATCH     "1",MENUFLAG
          IF        @EQUAL
            WRITE     HTMLFILE;"&menuflag=1";
          ENDIF
.
          REP       "+ ",PMNEP001
          REP       "+ ",PMNEP002
          REP       "+ ",PMNEP003
.
PRVNE999  RETURN
+
.-----------------------------------------------------------------------------
.         Next screen NEP values List
.-----------------------------------------------------------------------------
NXTNE000  MOVE      NORECORD,KEY2
          REP       " +",KEY2
          ASSIGN    STARTNUM+NORECORD,F3
          MOVE      F3,KEY3
          REP       " +",KEY3
          UNPACK    DIM127,D1,FLDPARA,DIM127
          MOVE      REPORTNO,FORM2
.
          REP       " +",PMNEP001
          REP       " +",PMNEP002
          REP       " +",PMNEP003
.
          WRITE     HTMLFILE;"patweb18.pbl":
                                 "?reportno=",FORM2:
                                 "&template=",FLDPARA:
                                 "&startnum=",KEY3:
                                 "&norecord=",KEY2:
                                 "&pmnep001=",PMNEP001:
                                 "&pmnep002=",PMNEP002:
                                 "&pmnep003=",PMNEP003;
          MATCH     "1",MENUFLAG
          IF        @EQUAL
            WRITE     HTMLFILE;"&menuflag=1";
          ENDIF
.
          REP       "+ ",PMNEP001
          REP       "+ ",PMNEP002
          REP       "+ ",PMNEP003
.
NXTNE999  RETURN
+
.-----------------------------------------------------------------------------
          INC       IBAWEBCD
          INC       WEBDATCD
          INC       DAYOFWEK
.
          INC       CLPMSNEP
          INC       CLEMRURG
          INC       CLEMRPWD
          INC       CLOUTPWO
          INC       CLPMSAUA
          INC       CLPMSHAD
          INC       CLPMSPWA
          INC       CLPMSRDI
          INC       PMSNEPTM
          INC       EMRPWDTM
          INC       EMRURGTM
          INC       OUTPWOTM
          INC       PMSHADTM
          INC       PMSPWATM
          INC       PMSSAWTM
          INC       PMSRDITM
          INC       PMSAMHTM
.
          INC       PMSNEPIO/INC
          INC       EMRPWDIO/INC
          INC       EMRURGIO/INC
          INC       OUTPWOIO/INC
          INC       PATICOIO/INC
          INC       PMSAUAIO/INC
          INC       PMSHADIO/INC
          INC       PMSPWAIO/INC
          INC       PMSSAWIO/INC
          INC       PMSSNPIO/INC
          INC       PMSRDIIO/INC
          INC       PMSAMHIO/INC
          INC       PMSCIDIO/INC
.
          INC       TFILENAM
