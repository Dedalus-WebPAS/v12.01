.**************************************************************************
.* System    :   Common                                                    *
.* Program   :   IBACOM01.PBL                                              *
.* Desc      :   Lookup IHI, HPI-I and HPI-O identifiers                   *
.***************************************************************************
.* Date      :   11/02/2014                                                *
.* Author    :   Ebon Clements                                             *
.* Function  :   This program will schedule IHI, HPI-I and HPI-O requests  *
.* Modifications  :                                                        *
.***************************************************************************
.* V12.00.01 30/05/2025  Jacob Jackson      TSK 0955096                    *
.*           Alphanumeric changes                                          *
.* V11.02.01 07/02/2022  Thanh T            TSK 0896905                    *
.*           Recompiled for ALLDEPFD changes                               *
.* V10.04.00 11/02/2014  Ebon Clements      CAR 291879                     *
.*           Created program                                               *
.***************************************************************************
.
          INC       STD001FD
.
. FILE DESCRIPTION INCLUDES
. -------------------------
          INC       ALLCONFD/INC
          INC       ALLDEPFD/INC
          INC       ALLREFFD/INC
          INC       BOKRC1FD/INC
          INC       EMRSITFD/INC
          INC       EMRVISFD/INC
          INC       IBACONFD/INC
          INC       MLTSECFD/INC
          INC       OUTBOAFD/INC
          INC       OUTCLIFD/INC
          INC       OUTCTYFD/INC
          INC       OUTSESFD/INC
          INC       OUTSITFD/INC
          INC       PATCODFD/INC
          INC       PATHSPFD/INC
          INC       PATMI1FD/INC
          INC       PATTRNFD/INC
          INC       PATWR1FD/INC
          INC       PMSAIDFD/INC
          INC       PMSHCGFD/INC
          INC       PMSHCPFD/INC
          INC       PMSIPLFD/INC
          INC       PMSVX1FD/INC
          INC       WEBSECFD/INC
.
. LOCAL VARIABLE DEFINITION
. -------------------------
ADMDATFR  DIM       8                       * Admission Date From
ADMDATTO  DIM       8                       * Admission Date To
CFILEPRE  DIM       3   * Current Open File Prefix for Outpatient Files
CLINIDFR  DIM       6                       * Clinic id from
CLINIDTO  DIM       6                       * Clinic id to
CLINTYFR  DIM       6                       * Clinic type from
CLINTYTO  DIM       6                       * Clinic type to
DEPTCDFR  DIM       3                       * AH department code from
DEPTCDTO  DIM       3                       * AH department code to
DIM12     DIM       12
DIM20     DIM       20
EDSITCOD  DIM       3                       * ED site code
REFRSTAT  DIM       1                       * Referral status
HCPCODFR  DIM       10                      * HCP Code from
HCPCODTO  DIM       10                      * HCP Code to
HOSPCODE  DIM       3                       * Hospital Id
INCLATTD  DIM       1                       * Include attended OP
INCLCURR  DIM       1                       * Include current inpatients
INCLDISC  DIM       1                       * Include discharged patients
INCLEIHI  DIM       1                       * Include patients with existing IHI
INCLDNAT  DIM       1                       * Include DNA OP
PRACCDFR  DIM       12                      * Practice code from
PRACCDTO  DIM       12                      * Practice code to
SERVTYPE  DIM       1                       * Service type
SITECODE  DIM       6                       * OP site code
WARDCODE  DIM       3                       * Ward code
WEBUSRID  DIM       10                      * Web user id
.
PRGID     INIT      "IBACOM01"
PRGNAM    INIT      "DHS Medicare Identifier lookup"
VERSION   INIT      "V12.01.00"
+
.**************************************************************************
.*                              ML0000                                    *
.*                      Controlling Logic (Mainline code)                 *
.**************************************************************************
.
ML0000    CALL      INIT0000               * initialisation and open files
.
ML0100    CALL      OPTN0000               * select options
          BRANCH    EXIT,ML9999            * EXIT = 1 if 0 chosen in menu
          BRANCH    COPTION,ML1000,ML2000: * proceed with clean up
                            ML3000,ML4000:
                            ML5000,ML6000
.
ML1000    CALL      KDAT0000               * Keyin admission date range
          BRANCH    EXIT,ML0100
.
          CALL      KHOS0000               * Keyin hospital id
          BRANCH    EXIT,ML0100
.
          CALL      KWRD0000               * Keyin ward
          BRANCH    EXIT,ML0100
.
          CALL      KCUR0000               * Keyin include current IP
          BRANCH    EXIT,ML0100
.
          CALL      KDIS0000               * Keyin include discharged IP
          BRANCH    EXIT,ML0100
.
          CALL      KIHI0000               * Keyin include existing IHI 
          BRANCH    EXIT,ML0100
.
          CALL      KUSR0000               * Keyin web user id
          BRANCH    EXIT,ML0100
.
          CALL      CONTQST                * Ok to continue ?
          BRANCH    CEXIT,ML1100:          * yes
                          ML0100:          * no
                          ML0100           * cancel
.
ML1100    CALL      IPAT0000               * Process Inpatients
          CALL      BPAT0000               * Process Booking
          GOTO      ML9999
.
ML2000    CALL      KDAT0000               * Keyin visit date range
          BRANCH    EXIT,ML0100
.
          CALL      KSIT0000               * Keyin site code
          BRANCH    EXIT,ML0100
.
          CALL      KCTY0000               * Keyin clinic type 
.
          CALL      KCID0000               * Keyin clinic id   
.
          CALL      KATT0000               * Keyin include attended OP 
          BRANCH    EXIT,ML0100
.
          CALL      KDNA0000               * Keyin include DNA
          BRANCH    EXIT,ML0100
.
          CALL      KIHI0000               * Keyin include existing IHI 
          BRANCH    EXIT,ML0100
.
          CALL      KUSR0000               * Keyin web user id
          BRANCH    EXIT,ML0100
.
          CALL      CONTQST                * Ok to continue ?
          BRANCH    CEXIT,ML2100:          * yes
                          ML0100:          * no
                          ML0100           * cancel

ML2100    CALL      OPAT0000               * Process Outpatients 
          GOTO      ML9999
.
ML3000    CALL      KDAT0000               * Keyin visit date range
          BRANCH    EXIT,ML0100
.
          CALL      KEST0000               * Keyin emergency site code 
          BRANCH    EXIT,ML0100
.
          CALL      KIHI0000               * Keyin include existing IHI
          BRANCH    EXIT,ML0100
.
          CALL      KUSR0000               * Keyin web user id
          BRANCH    EXIT,ML0100
.
          CALL      CONTQST                * Ok to continue ?
          BRANCH    CEXIT,ML3100:          * yes
                          ML0100:          * no
                          ML0100           * cancel

.
ML3100    CALL      EPAT0000               * Process Emergency
          GOTO      ML9999
.
ML4000    CALL      KDAT0000               * Keyin visit date range
          BRANCH    EXIT,ML0100
.
          CALL      KDEP0000               * Keyin AH site code
          BRANCH    EXIT,ML0100
.
          CALL      KSTA0000               * Keyin AH Status
          BRANCH    EXIT,ML0100
.
          CALL      KIHI0000               * Keyin include existing IHI
          BRANCH    EXIT,ML0100
.
          CALL      KUSR0000               * Keyin web user id
          BRANCH    EXIT,ML0100
.
          CALL      CONTQST                * Ok to continue ?
          BRANCH    CEXIT,ML4100:          * yes
                          ML0100:          * no
                          ML0100           * cancel

.
ML4100    CALL      RPAT0000               * Process Referrals 
          GOTO      ML9999
.
ML5000    CALL      KDAT0000               * Keyin visit date range
          BRANCH    EXIT,ML0100
.
          CALL      KHCP0000               * Keyin HCP range 
          BRANCH    EXIT,ML0100
.
          CALL      KSRV0000               * Keyin service type
          BRANCH    EXIT,ML0100
.
          CALL      KIHI0000               * Keyin include existing IHI
          BRANCH    EXIT,ML0100
.
          CALL      KUSR0000               * Keyin web user id
          BRANCH    EXIT,ML0100
.
          CALL      CONTQST                * Ok to continue ?
          BRANCH    CEXIT,ML5100:          * yes
                          ML0100:          * no
                          ML0100           * cancel

.
ML5100    CALL      RHCP0000               * Process HCP 
          GOTO      ML9999
.
ML6000    CALL      KDAT0000               * Keyin visit date range
          BRANCH    EXIT,ML0100
.
          CALL      KPRA0000               * Keyin practice range
          BRANCH    EXIT,ML0100
.
          CALL      KSRV0000               * Keyin service type
          BRANCH    EXIT,ML0100
.
          CALL      KIHI0000               * Keyin include existing IHI
          BRANCH    EXIT,ML0100
.
          CALL      KUSR0000               * Keyin web user id
          BRANCH    EXIT,ML0100
.
          CALL      CONTQST                * Ok to continue ?
          BRANCH    CEXIT,ML6100:          * yes
                          ML0100:          * no
                          ML0100           * cancel

.
ML6100    CALL      RPRA0000               * Process Practices
          GOTO      ML9999
.

ML9999    CHAIN     PGM                    * chain back to program
+
.****************************************************************************
.*                                INIT0000                                  *
.*                             initialisation                               *
.*  The initialisation routine is used to display headings and open files.  *
.****************************************************************************
.
INIT0000  CALL      DISPHEAD                  * display heading
.
          OPEN      ALLDEPA1,"alldepaf"
          OPEN      ALLREFA3,"allrefaf"
          OPEN      EMRSITA1,"emrsitaf"
          OPEN      BOKRC1A4,"bokrc1af"
          OPEN      EMRVISA6,"emrvisaf"
          OPEN      MLTSECA1,"mltsecaf"
          OPEN      PATCODE1,"patcodes"
          OPEN      PATHSPA1,"pathspaf"
          OPEN      PATMI1A3,"patmi1af"
          OPEN      PATTRAN2,"pattranf"
          OPEN      PATWR1A1,"patwr1af"
          OPEN      PATWR1A3,"patwr1af"
          OPEN      PMSAIDA1,"pmsaidaf"
          OPEN      PMSHCGA1,"pmshcgaf"
          OPEN      PMSHCPA1,"pmshcpaf"
          OPEN      PMSIPLA1,"pmsiplaf"
          OPEN      PMSVX1A1,"pmsvx1af"
          OPEN      WEBSECA1,"websecaf"
.
          OPEN      OUTSITA1,"outsitaf"
          MOVE      "out",CFILEPRE       * Save Current File Prefix
          CALL      OPNOUT00
.
          OPEN      CONTROLF,"controlf"
          READ      CONTROLF,ZERO;*43,IBCNMHOS
.
INIT9999  RETURN
+
.------------------------------------------------------------
. OPEN outpatient files
.------------------------------------------------------------
OPNOUT00  PACK      CFNAME,CFILEPRE,FILSESA2  * Get the name of the SESA2 file
          CLOSE     OUTSESA2
          OPEN      OUTSESA2,CFNAME           * Open the file
.
          PACK      CFNAME,CFILEPRE,FILBOKA1  * Get the name of the BOKA1 file
          CLOSE     OUTBOKA1
          OPEN      OUTBOKA1,CFNAME
.
          PACK      CFNAME,CFILEPRE,FILCLIA1  * Get the name of the CLIA1 file
          CLOSE     OUTCLIA1
          OPEN      OUTCLIA1,CFNAME
.
          PACK      CFNAME,CFILEPRE,FILCTYA1  * Get the name of the CTYA1 file
          CLOSE     OUTCTYA1
          OPEN      OUTCTYA1,CFNAME
.
OPNOUT99  RETURN
+
.****************************************************************************
.*                                OPTN0000                                  *
.*                        get user options or exit                          *
.*                                                                          *
.*    Returns:  EXIT    = FALSE (0)  Run clean up                           *
.*                        TRUE  (1)  Exit option selected                   *
.****************************************************************************
.
OPTN0000  DISPLAY   *P1:3,*EF,*P1:4,*V2LON,ZERO,*HOFF,". Exit":
                    *P1:5,*V2LON,ONE,*HOFF,". Bulk Inpatient IHI Request":
                    *P40:5,*V2LON,SIX,*HOFF,". Bulk Practice HPI-O Request":
                    *P1:6,*V2LON,TWO,*HOFF,". Bulk Outpatient IHI Request":
                    *P1:7,*V2LON,THREE,*HOFF,". Bulk Emergency IHI Request":
                    *P1:8,*V2LON,FOUR,*HOFF,". Bulk Referral IHI Request":
                    *P1:9,*V2LON,FIVE,*HOFF,". Bulk HCP HPI-O Request"
.
OPTN0500  KEYIN     *P1:10,*EL,"Select Option : ",*DV,UNDLN1:
                    *P17:10,*V2LON,COPTION
.
          COMPARE   ZERO,COPTION                 * exit selected ?
          GOTO      OPTN9500 IF EQUAL            * yes
.
          BRANCH    COPTION,OPTN9000,OPTN9000:   * run clean-up
                            OPTN9000,OPTN9000:
                            OPTN9000,OPTN9000
.
          BEEP
          GOTO      OPTN0500
.
OPTN9000  MOVE      ZERO,EXIT
          GOTO      OPTN9999
.
OPTN9500  MOVE      ONE,EXIT
.
OPTN9999  RETURN
+
.*********************************************************************
.* Keyin the admission date range                                    *
.*********************************************************************
KDAT0000  IF        COPTION=6 | COPTION=5
            DISPLAY   *P1:11,"Updated Date From : ",*EL:
                      *P1:12,"Updated Date To : ",*EL;
          ELSE
            DISPLAY   *P1:11,"Admission Date From : ",*EL:
                      *P1:12,"Admission Date To : ",*EL;
          ENDIF
.
KDAT1000  MOVE      "11",CVERT              * row
          MOVE      "23",CCOL               * column
          UNPACK    SP6,CYEAR,CMON,CDAY     * no defaults
          MOVE      CCC,CCENT
.
          CALL      KEYDATE
          BRANCH    OVRCD,KDAT9000          * nothing entered
.
          PACK      ADMDATFR,CCENT,CYEAR,CMON,CDAY
          REP       " 0",ADMDATFR
          CALL      PACDATE
.
KDAT2000  MOVE      "12",CVERT              * row
          MOVE      "23",CCOL               * column
          UNPACK    ADMDATFR,CCENT,CYEAR,CMON,CDAY
.
          CALL      KEYDATE
          BRANCH    OVRCD,KDAT1000          * nothing entered
.
          PACK      ADMDATTO,CCENT,CYEAR,CMON,CDAY
          REP       " 0",ADMDATTO
          CALL      PACDATE
.
          MATCH     ADMDATFR,ADMDATTO
          GOTO      KDAT8000 IF NOT LESS    * date is <= start date
.
          DISPLAY   *P1:24,*B,"To date must be after from date. ",*EL;
          CALL      HITENTER
          GOTO      KDAT2000
.
KDAT8000  MOVE      ZERO,EXIT               * valid dates
          GOTO      KDAT9999
.
KDAT9000  MOVE      ONE,EXIT                * exit selected
.
KDAT9999  RETURN
+
.**************************************************************************
.* Keyin the hospit id                                                    *
.**************************************************************************
KHOS0000  DISPLAY   *P1:13,*EL,"Hospital: ";
.
          MOVE      "13",EVERT
          MOVE      "11",ECOL
          MOVE      SP3,CKYIDEF3
          MOVE      ZERO,CKYIMAND           * Not Mandatory
          OPEN      PATHSPA1,"pathspaf"
.
          CALL      PATHSPKY
          BRANCH    EXIT,KHOS3000,KHOS9000
.
KHOS2000  DISPLAY   *P20:13,*V2LON,PTHSNAME;
          PACK      HOSPCODE,KEY3,SP70
.
          MOVE      ZERO,EXIT
          GOTO      KHOS9999
.
KHOS3000  MOVE      "All Hospitals",PTHSNAME
          DISPLAY   *P20:13,*V2LON,PTHSNAME;
          PACK      HOSPCODE,KEY3,SP70
          MOVE      ZERO,EXIT
          GOTO      KHOS9999
.
KHOS9000  MOVE      ONE,EXIT
          GOTO      KHOS9999
.
KHOS9999  RETURN
+
.**************************************************************************
.* Keyin the ward                                                         *
.**************************************************************************
.
KWRD0000  DISPLAY   *P1:14,"Ward :",*EL
          MOVE      "8",ECOL
          MOVE      "14",EVERT
          MOVE      SP3,CKYIDEF3
          MOVE      ZERO,CKYIMAND
          CALL      PATWRDKY
.
          PACK      WARDCODE,WWARD,SP70
          ENDSET    WARDCODE
.
          BRANCH    EXIT,KWRD2000,KWRD9000
.
          DISPLAY   *P15:14,*EL,WBDESC
          GOTO      KWRD4000
.
KWRD2000  DISPLAY   *P15:14,*EL,*V2LON,"All"
.
KWRD4000  MOVE      ZERO,EXIT
          GOTO      KWRD9999
.
KWRD9000  MOVE      ONE,EXIT
          GOTO      KWRD9999
.
KWRD9999  RETURN
+
.**************************************************************************
.* Include current inpatients                                             *
.**************************************************************************
KCUR0000  KEYIN     *P1:15,*EF:
                    *P1:15,"Include Current Inpatients. ":
                    " (",*V2LON,"Y",*HOFF,"/":
                    *V2LON,"N",*HOFF,") ? ",*V2LON,INCLCURR

          REP       UPPLOW,INCLCURR
          MATCH     ANSY,INCLCURR
          IF        @EQUAL
            GOTO      KCUR8000
          ENDIF
.
          MATCH     ANSN,INCLCURR
          IF        @EQUAL
            GOTO      KCUR8000
          ENDIF
.
          MATCH     SP70,INCLCURR
          GOTO      KCUR9000 IF EQUAL
.
          BEEP
          GOTO      KCUR0000
.
KCUR8000  MOVE      ZERO,EXIT
          GOTO      KCUR9999
.
KCUR9000  MOVE      ONE,EXIT
          GOTO      KCUR9999
.
KCUR9999  RETURN
+
.**************************************************************************
.* Include discharged patients                                            *
.**************************************************************************
KDIS0000  KEYIN     *P1:16,*EF:
                    *P1:16,"Include Discharged Inpatients. ":
                    " (",*V2LON,"Y",*HOFF,"/":
                    *V2LON,"N",*HOFF,") ? ",*V2LON,INCLDISC

          REP       UPPLOW,INCLDISC
          MATCH     ANSY,INCLDISC
          IF        @EQUAL
            GOTO      KDIS8000
          ENDIF
.
          MATCH     ANSN,INCLDISC
          IF        @EQUAL
            GOTO      KDIS8000
          ENDIF
.
          MATCH     SP70,INCLDISC
          GOTO      KDIS9000 IF EQUAL
.
          BEEP
          GOTO      KDIS0000
.
KDIS8000  MOVE      ZERO,EXIT
          GOTO      KDIS9999
.
KDIS9000  MOVE      ONE,EXIT
          GOTO      KDIS9999
.
KDIS9999  RETURN
+
.**************************************************************************
.* Include patients with IHI numbers                                      *
.**************************************************************************
KIHI0000  MOVE      TEN7,CVERT
          IF        COPTION=2
            MOVE      TEN8,CVERT
          ENDIF
.
          KEYIN     *P1:CVERT,*EF:
                    *P1:CVERT,"Include Patients with existing IHI numbers. ":
                    " (",*V2LON,"Y",*HOFF,"/":
                    *V2LON,"N",*HOFF,") ? ",*V2LON,INCLEIHI

          REP       UPPLOW,INCLEIHI
          MATCH     ANSY,INCLEIHI
          IF        @EQUAL
            GOTO      KIHI8000
          ENDIF
.
          MATCH     ANSN,INCLEIHI
          IF        @EQUAL
            GOTO      KIHI8000
          ENDIF
.
          MATCH     SP70,INCLEIHI
          GOTO      KIHI9000 IF EQUAL
.
          BEEP
          GOTO      KIHI0000
.
KIHI8000  MOVE      ZERO,EXIT
          GOTO      KIHI9999
.
KIHI9000  MOVE      ONE,EXIT
          GOTO      KIHI9999
.
KIHI9999  RETURN
+
.**************************************************************************
.* Include web user id                                                    *
.**************************************************************************
KUSR0000  MOVE      SP70,WEBUSRID
          MOVE      TEN8,CVERT
          IF        COPTION=2
            MOVE      TEN9,CVERT
          ENDIF

          KEYIN     *P1:CVERT,*EF:
                    *P1:CVERT,"Web User Id : ",*V2LON,WEBUSRID
.
          PACK      WEBUSRID,WEBUSRID,SP70
          MATCH     SP70,WEBUSRID
          GOTO      KUSR9100 IF EQUAL
.
          PACK      KEY10,WEBUSRID,SP70
          CALL      RDWBSE1
          BRANCH    OVRCD,KUSR9100
.
          MOVE      ZERO,EXIT
          GOTO      KUSR9999
.
KUSR9100  MOVE      ONE,EXIT
.
KUSR9999  RETURN
+
.*********************************************************************
. Keyin OP site code
.*********************************************************************
KSIT0000  KEYIN     *P1:13,*EF:
                    *P1:13,"Site Code : ",*V2LON,SITECODE
.
          PACK      SITECODE,SITECODE,SP70
.
          MATCH     SP70,SITECODE
          GOTO      KSIT9100 IF EQUAL
.
.         Validate the clinic code
.
          PACK      KEY6,SITECODE,SP70
          CALL      RDSITA1
          BRANCH    OVRCD,KSIT7100
.
          MATCH     OSTFILE,CFILEPRE         * Save Current File Prefix
          IF        !@EQUAL
            MOVE      OSTFILE,CFILEPRE       * Save Current File Prefix
            CALL      OPNOUT00               * Open Outpatient Files
          ENDIF
.
          DISPLAY   *P20:13,*V2LON,OSTDESC
          GOTO      KSIT9000
.
KSIT7100  DISPLAY   *P1:24,*B,"Invalid Site Code.",*EL;
          CALL      HITENTER
          GOTO      KSIT0000
.
KSIT9000  MOVE      ZERO,EXIT
          GOTO      KSIT9999
.
KSIT9100  MOVE      ONE,EXIT
KSIT9999  RETURN
+
.*********************************************************************
. Keyin clinic type ranges
.*********************************************************************
KCTY0000  KEYIN     *P1:14,*EF:
                    *P1:14,"From Clinic Type : ",*V2LON,CLINTYFR
.
          PACK      CLINTYFR,CLINTYFR,SP70
.
          MATCH     SP70,CLINTYFR
          IF        @EQUAL
            MOVE      "Start",OCTDESC
            GOTO      KCTY4000
          ENDIF
.
.         Validate the clinic code
.
          PACK      KEY12,SITECODE,CLINTYFR,SP70
          CALL      RDCTYA1
          BRANCH    OVRCD,KCTY7100
.
KCTY4000  MOVE      OCTDESC,DIM20
          DISPLAY   *P27:14,*V2LON,DIM20
.
KCTY5000  KEYIN     *P49:14,*EF:
                    *P49:14,"To : ",*V2LON,CLINTYTO
.
          PACK      CLINTYTO,CLINTYTO,SP70
.
          MATCH     SP70,CLINTYTO
          IF        @EQUAL
            MOVE      Z70,CLINTYTO
            MOVE      "Finish",OCTDESC
            GOTO      KCTY6000
          ENDIF
.
.         Validate the clinic code
.
          PACK      KEY12,SITECODE,CLINTYTO,SP70
          CALL      RDCTYA1
          BRANCH    OVRCD,KCTY8100
.
KCTY6000  MOVE      OCTDESC,DIM20
          DISPLAY   *P60:14,*V2LON,DIM20
.
          MATCH     CLINTYFR,CLINTYTO
          GOTO      KCTY9000 IF NOT LESS    * end >= start so OK
.
          DISPLAY   *P1:24,*B,"End value must be after Start value.  ",*EL;
          CALL      HITENTER
          GOTO      KCTY0000
.
KCTY7100  DISPLAY   *P1:24,*B,"Invalid Clinic Type From.",*EL;
          CALL      HITENTER
          GOTO      KCTY0000
.
KCTY8100  DISPLAY   *P1:24,*B,"Invalid Clinic Type To.",*EL;
          CALL      HITENTER
          GOTO      KCTY5000
.
KCTY9000  MOVE      ZERO,EXIT
          GOTO      KCTY9999
.
KCTY9999  RETURN
+
.*********************************************************************
. Keyin clinic type ranges
.*********************************************************************
KCID0000  KEYIN     *P1:15,*EF:
                    *P1:15,"From Clinic ID : ",*V2LON,CLINIDFR
.
          PACK      CLINIDFR,CLINIDFR,SP70
.
          MATCH     SP70,CLINIDFR
          IF        @EQUAL
            DISPLAY   *P27:15,*V2LON,"Start"
            GOTO      KCID5000
          ENDIF
.
.         Validate the clinic code
.
          PACK      KEY20,SITECODE,CLINIDFR,Z70
          CALL      RDCLIA1
          IF        OVRCD=1
            CALL      RDPCLIA1          * Read Clinic Record
            BRANCH    OVRCD,KCID7100
.
            MATCH     SITECODE,OCASITE
            GOTO      KCID7100 IF NOT EQUAL
.
            MATCH     CLINIDFR,OCACLIN
            GOTO      KCID7100 IF NOT EQUAL
          ENDIF
.
          MOVE      OCADESC,DIM20
          DISPLAY   *P27:15,*V2LON,DIM20
.
KCID5000  KEYIN     *P49:15,*EF:
                    *P49:15,"To : ",*V2LON,CLINIDTO
.
          PACK      CLINIDTO,CLINIDTO,SP70
.
          MATCH     SP70,CLINIDTO
          IF        @EQUAL
            MOVE      Z70,CLINIDTO
            DISPLAY   *P60:15,*V2LON,"Finish"
            GOTO      KCID9000
          ENDIF
.
.         Validate the clinic code
.
          PACK      KEY20,SITECODE,CLINIDTO,Z70
          CALL      RDCLIA1
          IF        OVRCD=1
            CALL      RDPCLIA1          * Read Clinic Record
            BRANCH    OVRCD,KCID8100
.
            MATCH     SITECODE,OCASITE
            GOTO      KCID8100 IF NOT EQUAL
.
            MATCH     CLINIDTO,OCACLIN
            GOTO      KCID8100 IF NOT EQUAL
          ENDIF
.
          MOVE      OCADESC,DIM20
          DISPLAY   *P60:15,*V2LON,DIM20
.
          MATCH     CLINIDFR,CLINIDTO
          GOTO      KCID9999 IF NOT LESS    * end >= start so OK
.
          DISPLAY   *P1:24,*B,"End value must be after Start value.  ",*EL;
          CALL      HITENTER
          GOTO      KCID0000
.
KCID7100  DISPLAY   *P1:24,*B,"Invalid Clinic Id From.",*EL;
          CALL      HITENTER
          GOTO      KCID0000
.
KCID8100  DISPLAY   *P1:24,*B,"Invalid Clinic Id To.",*EL;
          CALL      HITENTER
          GOTO      KCID5000
.
KCID9000  MOVE      ZERO,EXIT
          GOTO      KCID9999
.
KCID9999  RETURN
+
.**************************************************************************
.* Include attended OP                                                    *
.**************************************************************************
KATT0000  KEYIN     *P1:16,*EF:
                    *P1:16,"Include Attended Patients. ":
                    " (",*V2LON,"Y",*HOFF,"/":
                    *V2LON,"N",*HOFF,") ? ",*V2LON,INCLATTD

          REP       UPPLOW,INCLATTD
          MATCH     ANSY,INCLATTD
          IF        @EQUAL
            GOTO      KATT8000
          ENDIF
.
          MATCH     ANSN,INCLATTD
          IF        @EQUAL
            GOTO      KATT8000
          ENDIF
.
          MATCH     SP70,INCLATTD
          GOTO      KATT9000 IF EQUAL
.
          BEEP
          GOTO      KATT0000
.
KATT8000  MOVE      ZERO,EXIT
          GOTO      KATT9999
.
KATT9000  MOVE      ONE,EXIT
          GOTO      KATT9999
.
KATT9999  RETURN
+
.**************************************************************************
.* Include attended OP                                                    *
.**************************************************************************
KDNA0000  KEYIN     *P1:17,*EF:
                    *P1:17,"Include DNA Patients. ":
                    " (",*V2LON,"Y",*HOFF,"/":
                    *V2LON,"N",*HOFF,") ? ",*V2LON,INCLDNAT

          REP       UPPLOW,INCLDNAT
          MATCH     ANSY,INCLDNAT
          IF        @EQUAL
            GOTO      KDNA8000
          ENDIF
.
          MATCH     ANSN,INCLDNAT
          IF        @EQUAL
            GOTO      KDNA8000
          ENDIF
.
          MATCH     SP70,INCLDNAT
          GOTO      KDNA9000 IF EQUAL
.
          BEEP
          GOTO      KDNA0000
.
KDNA8000  MOVE      ZERO,EXIT
          GOTO      KDNA9999
.
KDNA9000  MOVE      ONE,EXIT
          GOTO      KDNA9999
.
KDNA9999  RETURN
+
.**************************************************************************
.*                               IPAT0000                                 *
.**************************************************************************
IPAT0000  PACK      KEY16,ADMDATFR,SP70
          CALL      RDSMISS3
IPAT1000  CALL      RDKMISS3
          BRANCH    OVRCD,IPAT9999
.
          MATCH     ADATE,ADMDATTO          * Exit if adm date after to date
          GOTO      IPAT9999 IF LESS
.
          COMPARE   FIVE,ASTAT              * Ignore cancelled IP adm
          GOTO      IPAT1000 IF EQUAL
.
          PACK      KEY8,AADMNO,SP70
          CALL      RDPMVX11
          BRANCH    OVRCD,IPAT1000
.
          IF        IBCNMHOS=1
            MATCH     SP70,HOSPCODE
            IF        !@EQUAL
              MATCH     HOSPCODE,PMVXMHOS              * hospital check
              GOTO      IPAT1000 IF NOT EQUAL
            ELSE
              PACK      KEY13,WEBUSRID,SP70            * All hospital access
              CALL      RDMLSEC1
              IF        OVRCD=1
                PACK      KEY13,WEBUSRID,PMVXMHOS,SP70   * This hospital access
                CALL      RDMLSEC1
                BRANCH    OVRCD,IPAT1000
              ENDIF
            ENDIF
          ENDIF
.
          MATCH     "N",INCLCURR
          IF        @EQUAL
            COMPARE   TWO,ASTAT                  * Exclude current IP
            GOTO      IPAT1000 IF EQUAL
.
            COMPARE   FOUR,ASTAT                 * Exclude on leave IP
            GOTO      IPAT1000 IF EQUAL
          ENDIF
.
          MATCH     "N",INCLDISC
          IF        @EQUAL
            COMPARE   THREE,ASTAT                * Exclude discharged IP
            GOTO      IPAT1000 IF EQUAL
          ENDIF
.
          MATCH     SP70,WARDCODE                * Ward filter
          GOTO      IPAT4000 IF EQUAL
.
          IF        ASTAT=1
            MATCH     WARDCODE,PTMIXWRD          * Expected ward for pre adm
            GOTO      IPAT1000 IF NOT EQUAL
          ENDIF
.
          PACK      KEY30,AADMNO,Z70
          CALL      RDSTRAN2
          CALL      RDPTRAN2                     * Read last tran record to
          BRANCH    OVRCD,IPAT1000               * get the ward code
.
          MATCH     TADMN,AADMNO
          GOTO      IPAT1000 IF NOT EQUAL
.         
          MATCH     WARDCODE,TWARD
          GOTO      IPAT1000 IF NOT EQUAL
.         
IPAT4000  MATCH     "Y",INCLEIHI           * Include patients with existing IHI
          GOTO      IPAT5000 IF EQUAL
.
          PACK      KEY31,AURNO,SP70
          CALL      RSPMAID1
IPAT4500  CALL      RKPMAID1               * Check U/R for an IHI number
          BRANCH    OVRCD,IPAT5000
.
          MATCH     AURNO,PMAIURNO
          GOTO      IPAT5000 IF NOT EQUAL
.
          PACK      KEY5,ANSA,ANSI,PMAITYPE
          CALL      RDCODE1
          BRANCH    OVRCD,IPAT4500
.
          MATCH     ANSI,TCINDC2           * IHI Number
          GOTO      IPAT4500 IF NOT EQUAL
.
          MATCH     "1",PMAIVSTA           * IHI Verified
          GOTO      IPAT4500 IF NOT EQUAL
.
          MATCH     "1",PMAIASTA           * IHI Active
          GOTO      IPAT1000 IF EQUAL
.
IPAT5000  MOVE      "01",KEY2              * IHI Validation
          PACK      KEY11,WEBUSRID,SP70    * User ID
          PACK      KEY50,AURNO,SP70 
          CALL      WIPL0000               * Write to polling table
.
          GOTO      IPAT1000
.
IPAT9999  RETURN
+
.**************************************************************************
.*                               BPAT0000                                 *
.**************************************************************************
BPAT0000  PACK      KEY16,ADMDATFR,SP70
          CALL      RSBKREC4
BPAT1000  CALL      RKBKREC4
          BRANCH    OVRCD,BPAT9999
.
          MATCH     BKREEDAT,ADMDATTO       * Exit if exp date after to date
          GOTO      BPAT9999 IF LESS
.
          COMPARE   ZERO,BKRESTAT           * Booked only 
          GOTO      BPAT1000 IF NOT EQUAL
.
          PACK      KEY6,BKREWARD,SP70      * Read expected ward
          CALL      RDWARD1
          BRANCH    OVRCD,BPAT1000
.
          IF        IBCNMHOS=1
            MATCH     SP70,HOSPCODE
            IF        !@EQUAL
              MATCH     HOSPCODE,PTWDHOSN              * hospital check
              GOTO      BPAT1000 IF NOT EQUAL
            ELSE
              PACK      KEY13,WEBUSRID,SP70            * All hospital access
              CALL      RDMLSEC1
              IF        OVRCD=1
                PACK      KEY13,WEBUSRID,PTWDHOSN,SP70   * This hospital access
                CALL      RDMLSEC1
                BRANCH    OVRCD,BPAT1000
              ENDIF
            ENDIF
          ENDIF
.
          MATCH     SP70,WARDCODE                * Ward filter
          GOTO      BPAT4000 IF EQUAL
.
          MATCH     WARDCODE,BKREWARD          * Expected ward for booking
          GOTO      BPAT1000 IF NOT EQUAL
.
BPAT4000  MATCH     "Y",INCLEIHI           * Include patients with existing IHI
          GOTO      BPAT5000 IF EQUAL
.
          PACK      KEY31,BKREURNO,SP70
          CALL      RSPMAID1
BPAT4500  CALL      RKPMAID1               * Check U/R for an IHI number
          BRANCH    OVRCD,BPAT5000
.
          MATCH     BKREURNO,PMAIURNO
          GOTO      BPAT5000 IF NOT EQUAL
.
          PACK      KEY5,ANSA,ANSI,PMAITYPE
          CALL      RDCODE1
          BRANCH    OVRCD,BPAT4500
.
          MATCH     ANSI,TCINDC2           * IHI Number
          GOTO      BPAT4500 IF NOT EQUAL
.
          MATCH     "1",PMAIVSTA           * IHI Verified
          GOTO      BPAT4500 IF NOT EQUAL
.
          MATCH     "1",PMAIASTA           * IHI Active
          GOTO      BPAT1000 IF EQUAL
.
BPAT5000  MOVE      "01",KEY2              * IHI Validation
          PACK      KEY11,WEBUSRID,SP70    * User ID
          PACK      KEY50,BKREURNO,SP70
          CALL      WIPL0000               * Write to polling table
.
          GOTO      BPAT1000
.
BPAT9999  RETURN
+
.**************************************************************************
.*                               OPAT0000                                 *
.**************************************************************************
OPAT0000  PACK      KEY6,SITECODE,SP70
          CALL      RDSITA1
          BRANCH    OVRCD,OPAT9999
.
          PACK      KEY25,ADMDATFR,SP70
          CALL      RDSSESA2
OPAT1000  CALL      RDKSESA2
          BRANCH    OVRCD,OPAT9999
.
          MATCH     OSEDATE,ADMDATTO       * Exit if session date after to date
          GOTO      OPAT9999 IF LESS
.
          MATCH     OSESITE,SITECODE       * Skip if different site
          GOTO      OPAT1000 IF NOT EQUAL
.
          PACK      KEY28,OSESITE,OSECLIN,OSEDATE,OSESTRT,SP70
          CALL      RDSBOKA1
OPAT2000  CALL      RDKBOKA1
          BRANCH    OVRCD,OPAT1000
.
          MATCH     OBASITE,OSESITE         * Same site
          GOTO      OPAT1000 IF NOT EQUAL
.
          MATCH     OBACLIN,OSECLIN         * Same clinic
          GOTO      OPAT1000 IF NOT EQUAL
.
          MATCH     OBADATE,OSEDATE         * Same date
          GOTO      OPAT1000 IF NOT EQUAL
.
          MATCH     OBASTRT,OSESTRT         * Same start time
          GOTO      OPAT1000 IF NOT EQUAL
.
          COMPARE   ONE,OBASTAT             * Booked
          GOTO      OPAT4000 IF EQUAL
.
          MATCH     "Y",INCLATTD            * Include Attended
          IF         @EQUAL
            COMPARE    FOUR,OBASTAT         * Attended
            GOTO       OPAT4000 IF EQUAL
          ENDIF        
.
          MATCH     "Y",INCLDNAT            * Include DNA
          IF         @EQUAL
            COMPARE    FIVE,OBASTAT          * DNA 
            GOTO       OPAT4000 IF EQUAL
          ENDIF
.
          GOTO      OPAT2000
.
OPAT4000  MATCH     "Y",INCLEIHI           * Include patients with existing IHI
          GOTO      OPAT5000 IF EQUAL
.
          PACK      KEY31,OBAURNO,SP70
          CALL      RSPMAID1
OPAT4500  CALL      RKPMAID1               * Check U/R for an IHI number
          BRANCH    OVRCD,OPAT5000
.
          MATCH     OBAURNO,PMAIURNO
          GOTO      OPAT5000 IF NOT EQUAL
.
          PACK      KEY5,ANSA,ANSI,PMAITYPE
          CALL      RDCODE1
          BRANCH    OVRCD,OPAT4500
.
          MATCH     ANSI,TCINDC2           * IHI Number
          GOTO      OPAT4500 IF NOT EQUAL
.
          MATCH     "1",PMAIVSTA           * IHI Verified
          GOTO      OPAT4500 IF NOT EQUAL
.
          MATCH     "1",PMAIASTA           * IHI Active
          GOTO      OPAT1000 IF EQUAL
.
OPAT5000  MOVE      "01",KEY2              * IHI Validation
          PACK      KEY11,WEBUSRID,SP70    * User ID
          PACK      KEY50,OBAURNO,SP70
          CALL      WIPL0000               * Write to polling table
.
          GOTO      OPAT1000
.
OPAT9999  RETURN
+
.**************************************************************************
.*                               EPAT0000                                 *
.**************************************************************************
EPAT0000  PACK      KEY27,EDSITCOD,ADMDATFR,SP70
          CALL      RSEMVIS6
EPAT1000  CALL      RKEMVIS6
          BRANCH    OVRCD,EPAT9999
.
          MATCH     EMVISITE,EDSITCOD        * Check ED Site
          GOTO      EPAT9999 IF NOT EQUAL
.
          MATCH     EMVIDATE,ADMDATTO       * Exit if visit date after to date
          GOTO      EPAT9999 IF LESS
.
          COMPARE   FOUR,EMVISTAT           * Skip cancelled
          GOTO      EPAT1000 IF EQUAL
.
          MATCH     "       0",EMVIURNO     * Skip zero U/R
          GOTO      EPAT1000 IF EQUAL
.
EPAT4000  MATCH     "Y",INCLEIHI           * Include patients with existing IHI
          GOTO      EPAT5000 IF EQUAL
.
          PACK      KEY31,EMVIURNO,SP70
          CALL      RSPMAID1
EPAT4500  CALL      RKPMAID1               * Check U/R for an IHI number
          BRANCH    OVRCD,EPAT5000
.
          MATCH     EMVIURNO,PMAIURNO
          GOTO      EPAT5000 IF NOT EQUAL
.
          PACK      KEY5,ANSA,ANSI,PMAITYPE
          CALL      RDCODE1
          BRANCH    OVRCD,EPAT4500
.
          MATCH     ANSI,TCINDC2           * IHI Number
          GOTO      EPAT4500 IF NOT EQUAL
.
          MATCH     "1",PMAIVSTA           * IHI Verified
          GOTO      EPAT4500 IF NOT EQUAL
.
          MATCH     "1",PMAIASTA           * IHI Active
          GOTO      EPAT1000 IF EQUAL
.
EPAT5000  MOVE      "01",KEY2              * IHI Validation
          PACK      KEY11,WEBUSRID,SP70    * User ID
          PACK      KEY50,EMVIURNO,SP70
          CALL      WIPL0000               * Write to polling table
.
          GOTO      EPAT1000
.
EPAT9999  RETURN
.
.*********************************************************************
.         KEST0000
.*********************************************************************
KEST0000  KEYIN     *P1:13,*EF:
                    *P1:13,"ED Site Code : ",*V2LON,EDSITCOD
.
          PACK      EDSITCOD,EDSITCOD,SP70
.
          MATCH     SP70,EDSITCOD
          GOTO      KEST9100 IF EQUAL
.
.         Validate the clinic code
.
          PACK      KEY3,EDSITCOD,SP70
          CALL      RDEMSIT1
          BRANCH    OVRCD,KEST7100
.
          DISPLAY   *P20:13,*V2LON,OSTDESC
          GOTO      KEST9000
.
KEST7100  DISPLAY   *P1:24,*B,"Invalid ED Site Code.",*EL;
          CALL      HITENTER
          GOTO      KEST0000
.
KEST9000  MOVE      ZERO,EXIT
          GOTO      KEST9999
.
KEST9100  MOVE      ONE,EXIT
KEST9999  RETURN
+
.*********************************************************************
.         KDEP0000   
.*********************************************************************
KDEP0000  KEYIN     *P1:13,*EF:
                    *P1:13,"Department From : ",*V2LON,DEPTCDFR
.
          PACK      DEPTCDFR,DEPTCDFR,SP70
.
          MATCH     SP70,DEPTCDFR
          IF        @EQUAL
            MOVE      "Start",TDESC
            GOTO      KDEP4000
          ENDIF
.
.         Validate the department code
.
          PACK      KEY3,DEPTCDFR,SP70
          CALL      RDALDEP1
          BRANCH    OVRCD,KDEP7100
.
          PACK      KEY5,ANSC,ANSG,DEPTCDFR,SP70
          CALL      RDCODE1
          BRANCH    OVRCD,KDEP7100
.
KDEP4000  DISPLAY   *P27:13,*V2LON,TDESC
.
KDEP5000  KEYIN     *P49:13,*EF:
                    *P49:13,"To : ",*V2LON,DEPTCDTO
.
          PACK      DEPTCDTO,DEPTCDTO,SP70
.
          MATCH     SP70,DEPTCDTO
          IF        @EQUAL
            MOVE      Z70,DEPTCDTO
            MOVE      "Finish",TDESC
            GOTO      KDEP6000
          ENDIF
.
.         Validate the department code
.
          PACK      KEY3,DEPTCDTO,SP70
          CALL      RDALDEP1
          BRANCH    OVRCD,KDEP8100
.
          PACK      KEY5,ANSC,ANSG,DEPTCDTO,SP70
          CALL      RDCODE1
          BRANCH    OVRCD,KDEP8100
.
KDEP6000  DISPLAY   *P60:13,*V2LON,TDESC
.
          MATCH     DEPTCDFR,DEPTCDTO
          GOTO      KDEP9000 IF NOT LESS    * end >= start so OK
.
          DISPLAY   *P1:24,*B,"End value must be after Start value.  ",*EL;
          CALL      HITENTER
          GOTO      KDEP0000
.
KDEP7100  DISPLAY   *P1:24,*B,"Invalid Department From.",*EL;
          CALL      HITENTER
          GOTO      KDEP0000
.
KDEP8100  DISPLAY   *P1:24,*B,"Invalid Department To.",*EL;
          CALL      HITENTER
          GOTO      KDEP5000
.
KDEP9000  MOVE      ZERO,EXIT
          GOTO      KDEP9999
.
KDEP9999  RETURN
+
.**************************************************************************
.*                               RPAT0000                                 *
.**************************************************************************
RPAT0000  PACK      KEY17,REFRSTAT,ADMDATFR,SP70
          CALL      RSALREF3
RPAT1000  CALL      RKALREF3
          BRANCH    OVRCD,RPAT9999
.
          MATCH     REFRSTAT,ALRESTAT        * Check status
          GOTO      RPAT9999 IF NOT EQUAL
.
          MATCH     ALRERDAT,ADMDATTO       * Exit if visit date after to date
          GOTO      RPAT9999 IF LESS
.
          MATCH     DEPTCDFR,ALREDEPT        * Check department from
          GOTO      RPAT1000 IF LESS 
.
          MATCH     ALREDEPT,DEPTCDTO        * Check department to
          GOTO      RPAT1000 IF LESS 
.
RPAT4000  MATCH     "Y",INCLEIHI           * Include patients with existing IHI
          GOTO      RPAT5000 IF EQUAL
.
          PACK      KEY31,ALREURNO,SP70
          CALL      RSPMAID1
RPAT4500  CALL      RKPMAID1               * Check U/R for an IHI number
          BRANCH    OVRCD,RPAT5000
.
          MATCH     ALREURNO,PMAIURNO
          GOTO      RPAT5000 IF NOT EQUAL
.
          PACK      KEY5,ANSA,ANSI,PMAITYPE
          CALL      RDCODE1
          BRANCH    OVRCD,RPAT4500
.
          MATCH     ANSI,TCINDC2           * IHI Number
          GOTO      RPAT4500 IF NOT EQUAL
.
          MATCH     "1",PMAIVSTA           * IHI Verified
          GOTO      RPAT4500 IF NOT EQUAL
.
          MATCH     "1",PMAIASTA           * IHI Active
          GOTO      RPAT1000 IF EQUAL
.
RPAT5000  MOVE      "01",KEY2              * IHI Validation
          PACK      KEY11,WEBUSRID,SP70    * User ID
          PACK      KEY50,ALREURNO,SP70
          CALL      WIPL0000               * Write to polling table
.
          GOTO      RPAT1000
.
RPAT9999  RETURN
+
.**************************************************************************
.*        KSTA0000                                                        *
.**************************************************************************
KSTA0000  KEYIN     *P1:14,*EF:
                    *P1:14,"Referral Status. ":
                    *V2LON,"(1,2,3,4,or 5) : ":
                    *HOFF,*V2LON,REFRSTAT
.
          MOVE      ZERO,F1
          MOVE      REFRSTAT,F1
          BRANCH    F1,KSTA8000,KSTA8000,KSTA8000,KSTA8000,KSTA8000

          GOTO      KSTA9000
.
KSTA8000  MOVE      ZERO,EXIT
          GOTO      KSTA9999
.
KSTA9000  MOVE      ONE,EXIT
          GOTO      KSTA9999
.
KSTA9999  RETURN
+
.*********************************************************************
.         KHCP0000
.*********************************************************************
KHCP0000  KEYIN     *P1:13,*EF:
                    *P1:13,"HCP Code From : ",*V2LON,HCPCODFR
.
          PACK      HCPCODFR,HCPCODFR,SP70
.
          MATCH     SP70,HCPCODFR
          IF        @EQUAL
            MOVE      "Start",PMHCSNAM
            GOTO      KHCP4000
          ENDIF
.
.         Validate the HCP code
.
          PACK      KEY10,HCPCODFR,SP70
          CALL      RDPMHCP1
          BRANCH    OVRCD,KHCP7100
.
KHCP4000  DISPLAY   *P27:13,*V2LON,PMHCSNAM
.
KHCP5000  KEYIN     *P49:13,*EF:
                    *P49:13,"To : ",*V2LON,HCPCODTO
.
          PACK      HCPCODTO,HCPCODTO,SP70
.
          MATCH     SP70,HCPCODTO
          IF        @EQUAL
            MOVE      Z70,HCPCODTO
            MOVE      "Finish",PMHCSNAM
            GOTO      KHCP6000
          ENDIF
.
.         Validate the HCP code
.
          PACK      KEY10,HCPCODTO,SP70
          CALL      RDPMHCP1
          BRANCH    OVRCD,KHCP8100
.
KHCP6000  DISPLAY   *P60:13,*V2LON,PMHCSNAM
.
          MATCH     HCPCODFR,HCPCODTO
          GOTO      KHCP9000 IF NOT LESS    * end >= start so OK
.
          DISPLAY   *P1:24,*B,"End value must be after Start value.  ",*EL;
          CALL      HITENTER
          GOTO      KHCP0000
.
KHCP7100  DISPLAY   *P1:24,*B,"Invalid HCP Code From.",*EL;
          CALL      HITENTER
          GOTO      KHCP0000
.
KHCP8100  DISPLAY   *P1:24,*B,"Invalid HCP Code To.",*EL;
          CALL      HITENTER
          GOTO      KHCP5000
.
KHCP9000  MOVE      ZERO,EXIT
          GOTO      KHCP9999
.
KHCP9999  RETURN
+
.**************************************************************************
.*   KSRV0000                                                             *
.**************************************************************************
KSRV0000  MOVE      TEN4,CVERT

          KEYIN     *P1:CVERT,*EF:
                    *P1:CVERT,"Service Type : ",*V2LON,SERVTYPE
.
          PACK      SERVTYPE,SERVTYPE,SP70
.
          MOVE      ZERO,EXIT
          GOTO      KSRV9999
.
KSRV9100  MOVE      ONE,EXIT
.
KSRV9999  RETURN
+
.**************************************************************************
.*                               RHCP0000                                 *
.**************************************************************************
RHCP0000  PACK      KEY10,HCPCODFR,SP70
          CALL      RDPMHCP1
          IF        OVRCD=0
            GOTO      RHCP1100
          ENDIF
RHCP1000  CALL      RKPMHCP1
          BRANCH    OVRCD,RHCP9999
.
RHCP1100  MATCH     PMHCHCPC,HCPCODTO      * Check HCP Code to
          GOTO      RHCP9999 IF LESS
.
          MATCH     ADMDATFR,PMHCLUPD      * Update date from
          GOTO      RHCP1000 IF LESS
.
          MATCH     PMHCLUPD,ADMDATTO      * Update date to
          GOTO      RHCP1000 IF LESS
.
          MATCH     "N",INCLEIHI           * Include HCP with existing HPIO
          IF        @EQUAL               
            MATCH     SP70,PMHCNHTA
            GOTO      RHCP1000 IF NOT EQUAL
          ENDIF
.
          MATCH     SP70,SERVTYPE          * Check service type
          IF        !@EQUAL
....        MATCH     SERVTYPE,PMHCXXXX   
....        GOTO      RHCP1000 IF NOT EQUAL
          ENDIF
.
RHCP5000  MOVE      "02",KEY2              * HPI Validation
          PACK      KEY11,WEBUSRID,SP70    * User ID
          PACK      KEY50,PMHCHCPC,SP70
          CALL      WIPL0000               * Write to polling table
          GOTO      RHCP1000
.
RHCP9999  RETURN
+
.**************************************************************************
.*                               RPRA0000                                 *
.**************************************************************************
RPRA0000  PACK      KEY12,PRACCDFR,SP70
          CALL      RDPMHCG1
          IF        OVRCD=0
            GOTO      RPRA1100
          ENDIF
RPRA1000  CALL      RKPMHCG1
          BRANCH    OVRCD,RPRA9999
.
RPRA1100  PACK      DIM12,PMHGPRAC,PMHGCNTR
          MATCH     DIM12,PRACCDTO      * Check practice Code to
          GOTO      RPRA9999 IF LESS
.
          MATCH     ADMDATFR,PMHGLUPD      * Update date from
          GOTO      RPRA1000 IF LESS
.
          MATCH     PMHGLUPD,ADMDATTO      * Update date to
          GOTO      RPRA1000 IF LESS
.
          MATCH     "N",INCLEIHI           * Include practice with existing HPIO
          IF        @EQUAL
            MATCH     SP70,PMHGHPIO
            GOTO      RPRA1000 IF NOT EQUAL
          ENDIF
.
          MATCH     SP70,SERVTYPE          * Check service type
          IF        !@EQUAL
....        MATCH     SERVTYPE,PMHGXXXX
....        GOTO      RPRA1000 IF NOT EQUAL
          ENDIF
.
RPRA5000  MOVE      "04",KEY2              * Practice
          PACK      KEY11,WEBUSRID,SP70    * User ID
          PACK      KEY50,PMHGPRAC,PMHGCNTR,SP70
          CALL      WIPL0000               * Write to polling table
          GOTO      RPRA1000
.
RPRA9999  RETURN
+
.*********************************************************************
.         KPRA0000
.*********************************************************************
KPRA0000  KEYIN     *P1:13,*EF:
                    *P1:13,"Practice Code From : ",*V2LON,PRACCDFR
.
          PACK      PRACCDFR,PRACCDFR,SP70
.
          MATCH     SP70,PRACCDFR
          IF        @EQUAL
            MOVE      "Start",PMHGPNAM
            GOTO      KPRA4000
          ENDIF
.
.         Validate the practice code
.
          PACK      KEY12,PRACCDFR,SP70
          CALL      RDPMHCG1
          BRANCH    OVRCD,KPRA7100
.
KPRA4000  DISPLAY   *P27:13,*V2LON,PMHGPNAM
.
KPRA5000  KEYIN     *P49:13,*EF:
                    *P49:13,"To : ",*V2LON,PRACCDTO
.
          PACK      PRACCDTO,PRACCDTO,SP70
.
          MATCH     SP70,PRACCDTO
          IF        @EQUAL
            MOVE      Z70,PRACCDTO
            MOVE      "Finish",PMHGPNAM
            GOTO      KPRA6000
          ENDIF
.
.         Validate the practice code
.
          PACK      KEY12,PRACCDTO,SP70
          CALL      RDPMHCG1
          BRANCH    OVRCD,KPRA8100
.
KPRA6000  DISPLAY   *P60:13,*V2LON,PMHGPNAM
.
          MATCH     PRACCDFR,PRACCDTO
          GOTO      KPRA9000 IF NOT LESS    * end >= start so OK
.
          DISPLAY   *P1:24,*B,"End value must be after Start value.  ",*EL;
          CALL      HITENTER
          GOTO      KPRA0000
.
KPRA7100  DISPLAY   *P1:24,*B,"Invalid Practice Code From.",*EL;
          CALL      HITENTER
          GOTO      KPRA0000
.
KPRA8100  DISPLAY   *P1:24,*B,"Invalid Practice Code To.",*EL;
          CALL      HITENTER
          GOTO      KPRA5000
.
KPRA9000  MOVE      ZERO,EXIT
          GOTO      KPRA9999
.
KPRA9999  RETURN
+
. =========================================================================
.         I/O Includes
. =========================================================================
.
          INC       STD001IO
          INC       PATHSPKY
          INC       PATWRDKY
          INC       PMSIPLCD
.
          INC       ALLDEPIO/INC
          INC       ALLREFIO/INC
          INC       BOKRC1IO/INC
          INC       EMRSITIO/INC
          INC       EMRVISIO/INC
          INC       MLTSECIO/INC
          INC       OUTBOAIO/INC
          INC       OUTCLIIO/INC
          INC       OUTCTYIO/INC
          INC       OUTSESIO/INC
          INC       OUTSITIO/INC
          INC       PATCODIO/INC
          INC       PATHSPIO/INC
          INC       PATMI1IO/INC
          INC       PATTRNIO/INC
          INC       PATWR1IO/INC
          INC       PMSAIDIO/INC
          INC       PMSHCGIO/INC
          INC       PMSHCPIO/INC
          INC       PMSIPLIO/INC
          INC       PMSVX1IO/INC
          INC       WEBSECIO/INC
