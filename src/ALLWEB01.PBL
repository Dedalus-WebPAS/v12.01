.----------------------------------------------------------------------
. Program       : ALLWEB01
.
. Function      : Web Server for Allied Health Services for departments
.
. Modification  : 
.-------------------------------------------------------------------------------
. V11.05.01 08/01/2025 Thanh T       TSK 0951525 
.           Added Don't Allow Copying Of Linked Refs field to alldepaf
. V11.04.02 11/01/2024 Thanh T       TSK 0903618
.           Added MAIN3400/SSTYPM00, PROFL230, PROFL240, ALDP0670 and
.           PROFL240        
. V11.04.01 27/11/2023 Thanh T       TSK 0903618
.           Recompiled for ALLCCTFD changes 
. V11.03.07 15/05/2023  Jacob Jackson TSK 0923750
.           Fix issue causing '3000' code to appear if referral date 
.           is before EHC Start Date
. V11.03.06 08/05/2023  Jacob Jackson TSK 0923750
.           Remove EHC code '3000' validation that allows all dates
. V11.03.05 18/04/2023  Jacob Jackson TSK 0923750
.           Add filtering functionality for EHC Start/End Dates and
.           remove existing workarounds
. V11.03.04 21/03/2023  Peter Vela        0923750
.           Added clears for new variables in ALLDIAFD
. V11.03.03 05/01/2023  Bella Turco   TSK 0921957
.           Continued adding PTCNNRTD & NOMORE00 to maintenance lists
. V11.03.02 01/12/2022  Bella Turco   TSK 0921957
.           Added PTCNNRTD & NOMORE00 to RRTAB000 & ACCC0100 routines 
. V11.03.01 22/11/2022  Bella Turco   TSK 0921957
.           Continued adding PTCNNRTD & NOMORE00 to maintenance lists
. V11.02.05 16/08/2022  Ebon Clements  TSK 0923227
.           Added VINAH 17 only edit for diagnosis code 5268 to 5275
.           VALDIA00 ALLDKA00
. V11.02.04 01/08/2022  Bella Turco    TSK 0921957
.           Added NOMORE00 - Display "No more records" at end of list
.           Added PTCNNRTD - Displays number of rows set by parameter value
. V11.02.03 07.03.2022  DA Sarkies    TSK 0896905
.           Added CGI variable ALDEP039 and ALDEDACP for don't copy linked
.           referral
. V11.02.02 07/02/2022  Thanh T       TSK 0896905
.           Changed ALLDEP10 to initialize the ALDEDACP field
. V11.02.01 28/01/2022  Alina Bhari   TSK 0916066
.           Validating Cease Date with the effective date
.           to avoid choosing the inactive CMBS code
. V11.01.04 27/09/2021  Ebon Clements TSK 0911632
.           Allow COVID (3000) main health condition for all VINAH versions
.           VALDIA00, ALLDKA00
. V11.01.03 27/08/2021  Ebon Clements TSK 0908767
.           Fixed VINAH version end date edit - VALDIA00, ALLDKA00
. V11.01.02 27/08/2021  Ebon Clements TSK 0908767
.           Added VINAH version end date edit - VALDIA00, ALLDKA00
. V11.01.01 31/03/2021  Ebon Clements TSK 0902602
.           2021 Vic health department changes       
.           Changed ALDECSEP contact provider to a dim 6
.           Changed ALDIDESC diagnosis description to a DIM 80
. V11.00.04 24/07/2020  Ebon Clements TSK 0893419
.           Added Intervestions exist tag - ALDP0610
.           Added Categories exist tag - ALDP0620
.           Added Assessments exist tag - ALDP0630
. V11.00.03 09/04/2020  Peter Vela    TSK 0889143
.           Check for 999 lines in GLTEXT00 
. V11.00.02 20/03/2020  Peter Vela    TSK 0889143
.           Fixed ALLLET IO calls
. V11.00.01 19/03/2020  Peter Vela    TSK 0889143
.            Recompiled for ALLLETFD
. V10.13.04 27/11/2018  Richa Phogat  TSK 0867086
.           Fixed ALTP0016 to make copy functionality from Allied Health Dept
.           template mapping maintenace work fine
. V10.13.03 24/10/2018  Ebon Clements TSK 0815359
.           Added include IP departments option in DEPSEL10          
. V10.13.02 17/10/2018  Ebon Clements TSK 0815359
.           Allow IP service list to load with a blank department - ALLSER50
. V10.13.01 30/07/2018  Ebon Clements TSK 0815359
.           Added inpatient service department functionality
. V10.12.05 16/05/2018  J.Tan         TSK 0857230
.           Fixed Next and Previous screen on Equipment list
. V10.12.04 08/05/2018  Thanh T.      TSK 0850711
.           Changed EQTSEL00 to use index ALLEQUA7 instead of ALLEQUA3 to
.           fix the loan equipment list taking too long to load issue
. V10.12.03 30/01/2018  Tracey Nguyen TSK 0814204
.           Modified CAROW000/SSTAB000/SSROW000 to set ACTIVDESC for ALCAACTV=2
.          (Active, exclude from PRIMHD - NZ only)
. V10.12.02 23/01/2018  Thanh T.      TSK 0850711
.           Fixed loan equipment list taking too long to load issue
. V10.12.01 19/01/2018  Don Nguyen     TSK 0826935
.           Added VALDMODE into VALCTM00 for a different error message
. V10.11.02 14/11/2017  Don Nguyen     TSK 0816814
.           Added ALDG0020 & ALPR0021 - SNOMED Coding System Mappings Table
.           Recompiled for ALLPROTM.
. V10.11.01 18/10/2017  Peter Vela     TSK 0845492
.           Fixed department validation in EQTSEL00
. V10.10.02 11/05/2017  Don Nguyen     TSK 0826935
.           Fixed date validation in VALCTM00 to not allow the Case Team Member
.           End Date to be the same as Referral Date; to be consistent with the
.           existing error message.
. V10.10.01 28/03/2017  Ebon Clements  TSK 0833052
.           Added using triage status and using priority to ALLDEPFD
. V10.09.01 16/02/2017  Peter Vela     TSK 0833601
.           Added VALMBE00 validate AMA/MBS item with end date
. V10.07.02 16.10.2015  Ebon Clements  CAR 321253
.           Added active/inactive indicator to AH letter maintenance
. V10.07.01 05.10.2015  Ebon Clements  CAR 316634
.           Added Allow only one Waiting/Active Primary Referral
.           to department maintenance - ALLDEP00
. V10.06.02 06.05.2015  Ebon Clements  CAR 303890
.           Added report 22 department procedures
. V10.06.01 25.03.2015  Ebon Clements  CAR 303886
.           Added OP site and clinic type to department maintenance
. V10.05.01 24.07.2014  Patrick Adair  CAR 298078
.           Added new default letter templates to Referral Department
. V10.04.04 06.05.2014  Ania P         CAR 208234
.           Added sections for new contract code tables
. V10.04.03 31.03.2014  B.G.Ackland    CAR 299363
.           Replace META Tag Redirect with Javascript in Common RDIREC00
.           Routine
. V10.04.02 27.03.2014 Ebon Clements   CAR 298164
.           Recompiled for ALLMKIPR - Remove brackets
. V10.04.01 16/01/2014 Ebon Clements   CAR 285465
.           Added HCP Equivalent to ALLDIAFD 
. V10.03.14 19/09/2013 Patrick Adair   CAR 291815
.           changed htef to href in EQROW000
. V10.03.13 12/08/2013 Ebon Clements   CAR 286042
.           Recompiled for ALLPRRFD - Other factors affecting health indicator
. V10.03.12 05/06/2013 Ania P          CAR 285833
.           Added ALDP0054 
. V10.03.11 04/06/2013 Ania P          CAR 285833
.           Added output for ALLDEPFD.ALDEUAHP
. V10.03.10 22/03/2013 Ebon Clements   CAR 278231
.           Restored CODITM00 functionality to department tag - ALTP0001
. V10.03.09 25/02/2013 Ania P          CAR 281021
.           Removed unnecessary modification of constants.
. V10.03.08 02/11/2012  Ania P         CAR 269762
.           Added EQTSEL00 & Equipment Type filter to EQTUP000.
. V10.03.07 31/07/2012  Ebon Clements  CAR 269044
.           Added VINAH extract category code mapping functionality
. V10.03.06 05/07/2012  Peter Vela      CAR 261649
.           Added Type of Record functionality
. V10.03.05 18/06/2012  Peter McMullen  CAR 246750
.           Fix equipment maintenance row  
. V10.03.04 12/06/2012  Ebon Clements CAR 266918
.           Pack ALDEP021 with SP70 to fix write to spare - STDEP021
. V10.03.03 23/05/2012  Don Nguyen    CAR 264682
.           Added other misc tag processing for department details in ALDP0000
. V10.03.02 27/03/2012  Peter Vela    CAR 261277
.           Recompiled for ALLDEPFD
. V10.03.01 23/03/2012  Peter Vela    CAR 261277
.           Added Default Code to Problem Maintenance
. V10.02.01 11/08/2011  Ebon Clements CAR 241933
.           Added details exist tags for department services problems - ALDP0000
. V10.01.02 23/03/2011  Mike Laming   CAR 228416
.           Recompiled for ALLCASFD/IO - added ALCAORID Org.ID
. V10.01.01 09/11/2010  Mike Laming   CAR 230710
.           Add "Cease Date" test for MBS Items in VALITM00
. V10.00.03 18/10/2010  Peter Vela    CAR 178888
.           Mods to EQROW000 for Status & Quantity on Equipment List
. V10.00.02 15/09/2010  Peter Vela    CAR 227779
.           Added Remote Script validation Case Team member end date
. V10.00.01 03/05/2010  Ebon Clements CAR 220289
.           Added program stream to department maintenance
. V9.12.03  13/10/2009  Ebon Clements CAR 207550
.           Added VALPRB00 - Remote script to validate a problem code
. V9.12.02  28/09/2009  Mike Laming   CAR 173274
.           Add Medication Unit, Route & Type to Med. Search at ALLMKA00. Also
.           changed "validation" routine at VALMED00
. V9.12.01  21/05/2009  WeeLee Koo  CAR 197189
.           Fixed report number in NEXTMK00 and PREVMK00
. V9.11.02  23/02/2009  Ebon Clements  CAR 184752
.           Added status filter to department list
. V9.11.01  22/01/2009  Ebon Clements CAR 182024
.           Added equipment type filter to the equipment list
. V9.10.01  02/06/2008  Ebon Clements CAR 169695
.           Added ALDEHOSP, ALDEACTV, ALDESREQ and ALDESPAR to CLRDEP00
. V9.09.09  25/02/2008  Ebon Clements CAR 162038
.           Fixed inactive test in intervention search ALLIKA10
. V9.09.08  25/02/2008  Ebon Clements CAR 162098
.           Added active/inactive test to VALEQU00
. V9.09.07  21/02/2008  Ebon Clements CAR 162005
.           Fixed report number in NEXTIN00 and PREVIN00
. V9.09.06  12/12/2007  Jill Habasque CAR 148791
.           Mods to copy template details from one department to another   
. V9.09.05  03/10/2007  Davin         CAR 151458
.           Mods to MBS validation: changed valitm00 to allow 'MB' as well 
.           as 'M ' in valdtype
. V9.09.04  18/09/2007  Jill Habasque CAR 135514
.           Changed NEXTGR00 and PREVGR00 to use F2 for reportno
. V9.09.03  24/08/2007  Ebon Clements CAR 133923
.           Changed department selection lists to be in alphabetical order
.           10/08/2007  Davin         CAR 135538
.           Added dept specific categories to dept maintenance (updttype=C)
.           Added option 19 - Assessment Types maintenance
. V9.09.02  31/07/2007  Jill Habasque CAR 140983
.           Added ALSRSPEC - Speciality
. V9.09.01  31/05/2007 Peter Vela     CAR SJOG ED Billing
.           Fixed VALDTYPE comparison @ VALITM00
. V9.08.06  19/04/2007  Ebon Clements CAR 118107
.           Added HDP to services file 
. V9.08.05  27/03/2007  Peter Vela    CAR 136699
.           Fixed department validation at DEPSEL00
. V9.08.04  27/03/2007  Jill Habasque  CAR 135532
.           Added report option 18 - Intervention maintenance
. V9.08.03  20/03/2007  Jill Habasque  CAR 135514
.           Added report option 17 - Medication maintenance
. V9.08.02  16/03/2007  Jill Habasque  CAR 135529
.           Added report option 16 - Default letters and labels maintenance
. V9.08.01  08/03/2007  Ebon Clements CAR 135510
.           Added copy function to department diagnosis, problem and services
.           Added diagnosis keyword search
. V9.07.03  01/08/2007  Ebon Clements CAR 113925
.           Added client service event provider to the department file
. V9.07.02  01/08/2007  Ebon Clements CAR 110190
.           Added HDP to diagnosis file
. V9.07.01  01/08/2007  Ebon Clements CAR 110190
.           Added HDP to problem file
. V9.05.01  09/03/2006  Ebon Clements CAR 78533
.           Mods for PATCODTM - Hospital specific category codes
. V9.05.B04 09/02/2006  Ebon Clements CAR 87670
.           Added SRCEQU00 - Equipment id search
. V9.05.B03 30/01/2006  Ebon Clements CAR 93186
.           Mods for REDIRECT length change. Recompiled for IBAWEBDF
. V9.05.B02 09/01/2006  Mike Laming              CAR 76341
.           Added SACS Referral Letters to IT Management          
. V9.05.B01 09/12/2005  Ebon Clements            CAR 76341
.           Added SACS referral required to department maintenance
. V9.04.07  07/09/2005  Ebon Clements            CAR 73702
.           Added active status to department file
. V9.04.06  25/02/2005  Davin                    CAR 56697
.           Added new 'validate mbs' remote script (returns amount)
. V9.04.05  28/01/2005  Lina Vo                  CAR 56406
.           Changed Validate Supplier to also return Supplier Contact
. V9.04.04  07/12/2004  Peter Vela               CAR HEALTHSMARTDEMO
.           Added Serial Number and Supplier code on return from 
.           equipment search
. V9.04.03  18/11/2004  Ebon Clements            CAR 55239
.           Added HCP case team maintenance
. V9.04.02  07/10/2004  Ebon Clements            CAR 54111
.           Fixed size of ALDEP006 should have been DIM 6 not DIM 5
. V9.04.01  31/08/2004  Ebon Clements            CAR 53089
.           Added hospital to department maintenance
. V9.03.08  02/03/2004  Pat Dirito               CAR 43997
.           Recompiled for ALLEQUTM     
.           Added var STATDESC to show Equipment Status when listing equipment.
. V9.03.07  25/02/2004  Lina Vo                  CAR 44153
.           Mods to VALITM00 to include effective date check (VALDEFDT).     
. V9.03.06  19/02/2004  Pat Dirito               CAR 43998
.           Added Equipment Search EQTUP000                                  
. V9.03.05  13/02/2004  Pat Dirito               CAR 44122
.           Fixed Error message in VALITM00                                  
. V9.03.04  16/01/2004  Pat Dirito               CAR 46267
.           Removed Option 8 - AMA/MBS Search. Now done in PRIWEB05          
. V9.03.03  01/12/2003  Sylvek Litewka           CAR 20222
.           Modified reads of ICD10 Disease file to use common IO - RDPTICD1.
. V9.03.02  06/10/2003  Ebon Clements            CAR 43988
.           Phase 2 Equipment Loans Mods
. V9.03.01  14/07/2003  Davin                    CAR 37388
.           Added report option 10 (Predefined Diagnosis Reasons Maintenance)
.-------------------------------------------------------------------------------
.                 V9.02.06  08/02/2002 - J.Tan
.                           Mods to validating MBS routine
.                 V9.02.05  19/12/2001 - Ebon Clements
.                           Added new fields to service type lists
.                 V9.02.04  14/12/2001 - Ebon Clements
.                           Mods for service type maintenance
.                 V9.02.03  26/11/2001 - Ebon Clements
.                           Mods for equipment loans
.                 V9.02.02  23/10/2001 - Ebon Clements
.                           Added remote script to validate an MBS item
.                           from the private practice item file
.                 V9.02.01  08/09/2001 - Ebon Clements
.                           Fixed display of department maintenance          
.----------------------------------------------------------------------
.                 V9.01.02  17/08/2001 - Ebon Clements
.                           Fixed next and prev buttons for dept maintenance
.                 V9.01.01  14/08/2001 - Ebon Clements
.                           Recompiled for ALLBILTM - department selection lisRe.                           compiled for ALLBILTM - department selection list
.----------------------------------------------------------------------
.                 V9.00.01  06/08/2001 - Ebon Clements
.                            Fixed code to maintain field aldeuy1.alldepfd
.                 V9.00.B14 24/07/2001 - HPS
.                            Recompiled  
.                 V9.00.B13 24/07/2001 - HPS
.                            Fixed for the unit cost and deposit 
.		  V9.00.B12 24/07/2001 - HPS
.		             Defect 55 fix.
.	  	  V9.00.B11 23/07/2001 - HPS
.	                     Added label ALDG0015 and ALEQ0036,
.		             Added label GEEQNM00,	
.	                     Changed ALDEPD02 messages
	
.                 V9.00.B10 10/07/2001 - HPS (KSK)
.                            Defect Nos.
.                            ( 2 3 4 5 6 7 8 9 10 11 12 13 14 21 22 23  
.                              26 30 31 32 33 34 37 38 43 45 50 51 52 
.                              53 54 56 57 75 76 100 101 102 104)
                 
.                 V9.00.B09 10/07/2001 - HPS (KSK)
.                            Defect No.33 Spell fix 
.                 V9.00.B08 10/07/2001 - HPS (KSK)
.                            Defect No.10 ICD10DESC fixed 
.                 V9.00.B07 06/07/2001 - HPS
.                            Modification done Equipment maintenance    
.                 V9.00.B04 04/07/2001
.                            Change for spaces in the fields  
.                 V9.00.B02 03/07/2001 - HPS
.                            Corrected the spelling 
.                 V9.00.B01 31/05/2001 - HPS
.                            Created Program  
.----------------------------------------------------------------------
          INC       IBAWEBDF
          INC       PATICDFD/INC
          INC       PATICOFD/INC
          INC       ALLATSFD/INC
          INC       ALLATSTD/INC
          INC       ALLCCTFD/INC
          INC       ALLDLLFD/INC
          INC       ALLSERFD/INC
          INC       ALLDEPFD/INC
          INC       ALLDIAFD/INC
          INC       ALLDKIFD/INC
          INC       ALLDSPFD/INC
          INC       ALLDSPTD/INC
          INC       ALLINCFD/INC
          INC       ALLIKAFD/INC
          INC       ALLPRRFD/INC
          INC       ALLVMPFD/INC
          INC       PRIPRAFD/INC
          INC       ALLRKIFD/INC
          INC       ALLEQUFD/INC
          INC       ALLTMPFD/INC
          INC       ALLBILFD/INC
          INC       ALLBILTD/INC
          INC       ALLLETFD/INC
          INC       ALLPDIFD/INC
          INC       ALLPDITD/INC
          INC       ALLPROFD/INC
          INC       ALLPROTD/INC
          INC       ALLPKIFD/INC
          INC       ALLMEDFD/INC
          INC       ALLMKIFD/INC
          INC       PRIITMFD/INC
          INC       PATCONFD/INC
          INC       APSMASFD/INC
          INC       ALLEQUTD/INC
          INC       OUTSITFD/INC
          INC       PATHSPFD/INC   * Hospital File
          INC       ALLCASFD/INC
          INC       ALLCASTD/INC
          INC       ALLCTMFD/INC
          INC       ALLCTMTD/INC
          INC       PMSHCPFD/INC
          INC       PATDO1FD/INC
          INC       PMSVMTFD/INC
          INC       PMSVMTTD/INC
          INC       PMSVSTFD/INC
          INC       PMSVSTTD/INC
.
.----------------------------------------------------------------------
. CGI Parameters
.----------------------------------------------------------------------
ALVMP001  DIM       2     * Category
ALVMP002  DIM       8     * End Date (CCYYMMDD)
ALVMP003  DIM       3     * Category Code
.
INCLDINP  FORM      1     * Include IP departments
NEXTPAGE  DIM       1     * Next Page
UPDTTYPE  DIM       1     * Update Type
STARTKEY  DIM       10    * Starting key
SERVTYPE  DIM       1     * Parameter for delete and update
SITECODE  DIM       6
ACTVONLY  DIM       1     * Display active teams only
.
CHKVINAH  DIM       1     * VINAH check exit
COPYDEPT  DIM       3     * Copy Department
CURRCODE  DIM       20 
DEPARTMN  DIM       3     * Department code
DEPTCODE  DIM       3     * Department code
DISPACTV  DIM       8     * Active/Inactive Display
RDEPCODE  DIM       3     * Referring Department code
ALSER001  DIM       3     * Service file Department (alldepaf)
ALSER002  DIM       6     * Service file Service Code
ALSER003  DIM       40    * Service file Service Description
ALSER004  DIM       2     * Service file Length of Encounter (Minutes)
ALSER005  DIM       1     * Service file VACS Chargeable Service(0=No,1=Yes)
ALSER006  DIM       1     * Service file Active (0=No,1=Yes)
ALSER007  DIM       8
ALSER008  DIM       8
ALSER009  DIM       10
ALSER010  DIM       8
ALSER011  DIM       8
ALSER012  DIM       10
ALSER013  DIM       1     * Group related service
ALSER014  DIM       1     * Non U/R related service
ALSER015  DIM       4     * HCP                     
ALSER016  DIM       3     * Speciality (Cat s)      
.
ALDEP001  DIM       3     * Department - Clinic Group (Cat CG)
ALDEP002  DIM       1     * Using Referrals (0=No,1=Yes)
ALDEP003  DIM       1     * Security option
ALDEP004  DIM       3     * Using VACS Reporting (0=No,1=Yes) 
ALDEP005  DIM       3     * Billing (0=No,1=Yes) 
ALDEP006  DIM       6     * Medical Practice (pripraaf)
ALDEP007  DIM       25    * User Defined Reference 1 
ALDEP008  DIM       25    * User Defined Reference 2 
ALDEP009  DIM       8     * User Defined Date 1 (CCYYMMDD)
ALDEP010  DIM       8     * User Defined Date 2 (CCYYMMDD)
ALDEP011  DIM       1     * User Defined Y/N (0=No,1=Yes)
ALDEP012  DIM       1     * User Defined Y/N (0=No,1=Yes)
ALDEP013  DIM       3     * User Defined Code 1 (Category UA)
ALDEP014  DIM       3     * User Defined Code 1 (Category UB)
ALDEP015  DIM       3     * Hospital ID (pathspaf)
ALDEP016  DIM       1     * Active 0=Active 1=Inactive
ALDEP017  DIM       1     * SACS referral required (0=No, 1=Yes)
ALDEP018  DIM       6     * Client service event provider
ALDEP019  DIM       3     * Episode/Program Stream (Cat lF)
ALDEP020  DIM       1     * Allow Encounters on Primary Referrals
ALDEP021  DIM       6     * VINAH Episode Campus Code
ALDEP022  DIM       1     * Using External Referrals
ALDEP023  DIM       1     * Using Residental Admission
ALDEP024  DIM       1     * Using Assessments
ALDEP025  DIM       1     * Using Request Appointments
ALDEP026  DIM       1     * Display Last 5 Contacts
ALDEP027  DIM       1     * Display Clinical Documentation
ALDEP028  DIM       1     * Display Referral Action Audit
ALDEP029  DIM       1     * Display Letter History
ALDEP030  DIM       1     * Using Encounter Medications
ALDEP031  DIM       1     * Using Encounter Interventions
ALDEP032  DIM       1     * Using Encounter Supplies
ALDEP033  DIM       1     * Using Additional HCPs
ALDEP034  DIM       6     * Outpatient Site
ALDEP035  DIM       6     * Outpatient Clinic Type
ALDEP036  DIM       1     * Allow only one Waiting/Active Primary Referral
ALDEP037  DIM       1     * Using Triage Status (VINAH)
ALDEP038  DIM       1     * Using Priority (VINAH)
ALDEP039  DIM       1     * Don't allow Copying of Linked Referrals
.
ALPRR001  DIM       3     * deptcode 
ALPRR002  DIM       9     * problem code
ALPRR003  DIM       40    * Problem Description
ALPRR004  DIM       9     * Equivalent ICD10 code
ALPRR005  DIM       1     * Active
ALPRR006  DIM       4     * HDP
ALPRR007  DIM       1     * Default Code Ind
ALPRR008  DIM       1     * Other Factor
.
ALDLL001  DIM       3     * referral letter to pat
ALDLL002  DIM       3     * referral letter to referrer
ALDLL003  DIM       3     * update referral letter to patient
ALDLL004  DIM       3     * update referral letter to referrer
ALDLL005  DIM       3     * referral rejection letter to patient
ALDLL006  DIM       3     * referral rejection letter to referrer
ALDLL007  DIM       2     * AH patient label
ALDLL008  DIM       3     * referral letter to Reg GP if not referrer
ALDLL009  DIM       3     * update referral letter to Reg GP if not referrer
ALDLL010  DIM       3     * referral rejection letter to Reg GP if not referrer
.
ALDIA001  DIM       3     * deptcode 
ALDIA002  DIM       9     * diagnosis code
ALDIA003  DIM       80    * diagnosis description
ALDIA004  DIM       9     * equivalent ICD10 code
ALDIA005  DIM       1     * activity
ALDIA006  DIM       4     * HDP
ALDIA007  DIM       4     * HCP Equivalent
ALDIA008  DIM       8     * Start Date
ALDIA009  DIM       8     * End Date
.
ALINC001  DIM       3     * deptcode 
ALINC002  DIM       9     * intervention code
ALINC003  DIM       50    * intervention description
ALINC004  DIM       1     * 1=inactive
.
ALLEEND   FORM      3
ALLECOMM  DIM       70[999]                Comments
.
ALLET001  DIM       3     * Letter Number
ALLET002  DIM       70    * Line of letter
ALLET003  DIM       2     * Letter bottom margin
ALLET004  DIM       2     * Letter top margin
ALLET005  DIM       3     * Physical paper length (no. of lines)
ALLET006  DIM       2     * Letter left margin
ALLET007  DIM       8     * Mail Merge File Name
ALLET008  DIM       1     * Letter Type, R = Referral Letter
ALLET009  DIM       1     * Active/Inactive
.
ALMED001  DIM       20    * Medication Code
ALMED002  DIM       60    * Description
ALMED003  DIM       1     * 1=InActive 
ALMED004  DIM       3     * Units (Cat UN)
ALMED005  DIM       1     * Generic name 0=No 1=yes
ALMED006  DIM       3     * Medication Route(Cat MR)
ALMED007  DIM       1     * IV Additive (1=Yes)
ALMED008  DIM       7     * Inventory Code
ALMED009  DIM       3     * Medication type (Cat MZ)
.
TEMPLKEY  DIM       1     * Parameter for update and delete template
ALTMP001  DIM       3     * Department Code (alldepaf) 
ALTMP002  DIM       8     * Map from Server
ALTMP003  DIM       2     * Map from Report
ALTMP004  DIM       3     * Map from Template
ALTMP005  DIM       3     * Map to Template
ALTMP006  DIM       30    * Description
.
BILLKEYS  DIM       16    * Parameter for update and delete Billing table
.----------------------------------------------------------------------
. Program Variables
.----------------------------------------------------------------------
.
.
LETTNUMB  FORM      3
LINK2PRT  FORM      1   * Key for Keyword index
.
ACTIDESC  DIM       8   * Active or Inactive Description
NOURDESC  DIM       3   * NON UR Related
GROUDESC  DIM       3   * Group Related 
ACTIDES2  DIM       8   * VACS Chargeable Description
ACTIDES3  DIM       8   * Number of min in unit
. 
CFILEPRE  DIM       3   * Current Open File Prefix for Outpatient Files
ALDEPD01  DIM       3 
ALDEPD02  DIM       60  * Dispaly security string
ALDEPD03  DIM       3
ALDEPD04  DIM       30
ALDEPD05  DIM       3
ALDEPD06  DIM       30
.
ALBILD01  DIM       30
ALBILD02  DIM       30
ALBILD03  DIM       30
ALBILD04  DIM       5
CATgb     INIT      "gb"
CATZX     INIT      "ZX"
CONTCODE  DIM       3   * Contract Code
SERVSUBT  DIM       3   * Service Subtype
DASH      INIT      "-"
DEFTDESC  DIM       3   * Default Problem Description
DIM3      DIM       3
DIM8      DIM       8
DISPCATG  DIM       20
DISPDAT1  DIM       11
DISPDAT2  DIM       11
DOCTCODE  DIM       10
EQTPFILT  DIM       3   * Equipment Type Filter (allweb0101004)
STATDESC  DIM       30
ALBINTIM  DIM       8
FILTACTV  DIM       1
FILTTYPE  DIM       3
FUNCTYPE  FORM      2
FUNCCODE  DIM       20
OTHRDESC  DIM       22  * Other Factor Affecting Health Description
OTHERFAC  DIM       1
VALDTYPE  DIM       2
VALDCODE  DIM       9
VALDMCOD  DIM       20
VALDSUPL  DIM       5
VALDSCOD  DIM       3
VALDEFDT  DIM       8
VALDDATE  DIM       8
VALDTEAM  DIM       10
VALDHCPC  DIM       10
VALDMODE  DIM       1
SACRDESC  DIM       3
SAVKEY9   DIM       9 
SAVKEY12  DIM       12
SAVKEY13  DIM       13
SAVKEY16  DIM       16
SAVKEY20  DIM       20
SAVKEY27  DIM       27
SAVKEY52  DIM       52
SAVKEY62  DIM       62
SAVKEY80  DIM       80
SELLETTR  DIM       3
SERVFLAG  FORM      1
STRIKETG  DIM       39                      * Strike tag
TEAMCODE  DIM       10
TEAMHCPC  DIM       10
EFDTFLAG  FORM      1
SPECCHAR  INIT      "%"
NOEQIDX7  FORM      1
EDATFRMT  DIM       11
SDATFRMT  DIM       11
.----------------------------------------------------------------------
PRGID     INIT      "ALLWEB01"
VERSION   INIT      "V12.01.00"
PRGNAM    INIT      "Health Services"
.----------------------------------------------------------------------
.
          CALL      WEBINT00       * Initialise Fifo Etc.
          CALL      INIT0000       * Open Files
.
MAIN1000  CALL      WEBRED00       * Read Fifo WEBPID and USERID
.
          COMPARE   "999",REPORTNO * End Server Process on Report Option 999
          GOTO      MAIN9999 IF EQUAL
.
MAIN1020  BRANCH    REPORTNO,MAIN1100,MAIN1200,MAIN1300,MAIN1400,MAIN1500:
                             MAIN1600,MAIN1700,MAIN1800,MAIN1900,MAIN2000:
                             MAIN2100,MAIN2200,MAIN2300,MAIN2400,MAIN2500:
                             MAIN2600,MAIN2700,MAIN2800,MAIN2900,MAIN3000:
                             MAIN3100,MAIN3200,MAIN3300,MAIN3400
.
          PACK      WEBTITLE,PRGID,SP1,VERSION,SP1,PRGNAM,SP70
MAIN1040  MOVE      "Invalid Option",WEBTITLE
          CALL      WEBERR00   * Create Output File and Write HTML Page Header
          GOTO      MAIN1000
.
MAIN1100  CALL      ALLDEP00                     * Services for each department
          BRANCH    EXIT,MAIN1000
          MOVE      "Enquiry Complete",WEBTITLE
          CALL      NXTPAG00
          GOTO      MAIN1000
.
MAIN1200  CALL      ALLSER00                     * Services for each department
          BRANCH    EXIT,MAIN1000
          MOVE      "Enquiry Complete",WEBTITLE
          CALL      NXTPAG00
          GOTO      MAIN1000
.
MAIN1300  CALL      ALLPRB00                     * Department problems
          BRANCH    EXIT,MAIN1000
          MOVE      "Enquiry Complete",WEBTITLE
          CALL      NXTPAG00
          GOTO      MAIN1000
.
MAIN1400  CALL      ALLDIG00                     * Department Diagnosis
          BRANCH    EXIT,MAIN1000
          MOVE      "Enquiry Complete",WEBTITLE
          CALL      NXTPAG00
          GOTO      MAIN1000
.
MAIN1500  CALL      ALLEQU00                     * Equipment Maintenance
          BRANCH    EXIT,MAIN1000
          MOVE      "Enquiry Complete",WEBTITLE
          CALL      NXTPAG00
          GOTO      MAIN1000
.
MAIN1600  CALL      ALLTEM00                     * Template Maintenance      
          BRANCH    EXIT,MAIN1000
          MOVE      "Enquiry Complete",WEBTITLE
          CALL      NXTPAG00
          GOTO      MAIN1000
.
MAIN1700  CALL      ALLBIL00                     * Billing Maintenance      
          BRANCH    EXIT,MAIN1000
          MOVE      "Enquiry Complete",WEBTITLE
          CALL      NXTPAG00
          GOTO      MAIN1000
.
MAIN1800  CALL      REMOTE00                     * REMOTE SCRIPTING ROUTINES 
          GOTO      MAIN1000
.
MAIN1900  CALL      VALITM00                     * MBS Item validation      
          GOTO      MAIN1000
.
MAIN2000  CALL      ALLPDI00                     * Predefined Diagnosis
          BRANCH    EXIT,MAIN1000
          MOVE      "Update Complete",WEBTITLE
          CALL      NXTPAG00
          GOTO      MAIN1000
.
MAIN2100  CALL      VALSUP00                     * Supplier/Creditor validation
          GOTO      MAIN1000
.
MAIN2200  CALL      ALLCAS00                     * Case Team Details
          BRANCH    EXIT,MAIN1000
          MOVE      "Enquiry Complete",WEBTITLE
          CALL      NXTPAG00
          GOTO      MAIN1000
.
MAIN2300  CALL      ALLTEA00                     * Case Team Member Details
          BRANCH    EXIT,MAIN1000
          MOVE      "Enquiry Complete",WEBTITLE
          CALL      NXTPAG00
          GOTO      MAIN1000
.
MAIN2400  CALL      VALMBS00                     * MBS validation (return amnt)
          GOTO      MAIN1000
.
MAIN2500  CALL      ALLLET00                     * Referrals Letter Maintenance
          GOTO      MAIN1000
.
MAIN2600  CALL      DEFLET00                     * Default Letter Maintenance
          GOTO      MAIN1000
.
MAIN2700  CALL      ALLMED00                     * Medication Maintenance
          GOTO      MAIN1000
.
MAIN2800  CALL      ALLINC00                     * Intervention Maintenance
          BRANCH    EXIT,MAIN1000
          MOVE      "Enquiry Complete",WEBTITLE
          CALL      NXTPAG00
          GOTO      MAIN1000
.
MAIN2900  CALL      ALLASS00                     * Assessment Types for dept
          BRANCH    EXIT,MAIN1000
          MOVE      "Enquiry Complete",WEBTITLE
          CALL      NXTPAG00
          GOTO      MAIN1000
.
MAIN3000  CALL      ALLVMP00                     * VINAH extract category map
          BRANCH    EXIT,MAIN1000
          MOVE      "Enquiry Complete",WEBTITLE
          CALL      NXTPAG00
          GOTO      MAIN1000
.
MAIN3100  CALL      ALLCCT00                     * Contract Code Maintenance 
          BRANCH    EXIT,MAIN1000
          MOVE      "Enquiry Complete",WEBTITLE
          CALL      NXTPAG00
          GOTO      MAIN1000
.
MAIN3200  CALL      ALLPRO00                     * Department Procedures 
          BRANCH    EXIT,MAIN1000
          MOVE      "Enquiry Complete",WEBTITLE
          CALL      NXTPAG00
          GOTO      MAIN1000
.
MAIN3300  CALL      VALMBE00                     * MBS validation (return amnt)
          GOTO      MAIN1000                     * with end date
.
MAIN3400  CALL      SSTYPM00                     * Service Subtype Maintenance
          BRANCH    EXIT,MAIN1000
          MOVE      "Update Complete",WEBTITLE
          CALL      NXTPAG00
          GOTO      MAIN1000
.
MAIN9999  MOVE      "SERVER SHUTDOWN COMPLETE",WEBTITLE
          CALL      WEBERR00
          STOP
.
.------------------------------------------------------------
. Open Files and Initialize Variables
.------------------------------------------------------------
INIT0000  OPEN      ALLATSA1,"allatsaf"
          OPEN      ALLDLLA1,"alldllaf"
          OPEN      ALLSERA1,"allseraf"
          OPEN      ALLSERA2,"allseraf"
          OPEN      ALLDEPA1,"alldepaf"
          OPEN      ALLDIAA1,"alldiaaf"
          OPEN      ALLDIAA2,"alldiaaf"
          OPEN      ALLDKIA1,"alldkiaf"
          OPEN      ALLDKIA2,"alldkiaf"
          OPEN      ALLDSPA1,"alldspaf"
          OPEN      ALLINCA1,"allincaf"
          OPEN      ALLINCA2,"allincaf"
          OPEN      ALLIKAA1,"allikaaf"
          OPEN      ALLIKAA2,"allikaaf"
          OPEN      ALLPRRA1,"allprraf"
          OPEN      ALLRKIA1,"allrkiaf"
          OPEN      ALLRKIA2,"allrkiaf"
          OPEN      ALLMEDA1,"allmedaf"
          OPEN      ALLMKIA1,"allmkiaf"
          OPEN      ALLMKIA2,"allmkiaf"
          OPEN      ALLVMPA1,"allvmpaf"
          OPEN      PATCODE1,"patcodes"
          OPEN      PATCODE2,"patcodes"
          OPEN      PRIPRAC1,"pripracf"
          OPEN      ALLTMPA1,"alltmpaf"
          OPEN      ALLBILA1,"allbilaf"
          OPEN      ALLEQUA3,"allequaf"
          OPEN      ALLEQUA1,"allequaf"
          OPEN      ALLPDIA1,"allpdiaf"
          OPEN      PRIITEM1,"priitemf"
          OPEN      PRIITEM2,"priitemf"
          OPEN      APSMASA1,"apsmasaf"
          OPEN      PATHSPA1,"pathspaf"     * Hospital File
          OPEN      ALLCASA1,"allcasaf"
          OPEN      ALLCASA2,"allcasaf"
          OPEN      ALLCTMA1,"allctmaf"
          OPEN      ALLCTMA2,"allctmaf"
          OPEN      OUTSITA1,"outsitaf"
          OPEN      OUTSITA2,"outsitaf"
          OPEN      PMSHCPA1,"pmshcpaf"
          OPEN      ALLLETR1,"allletaf"
          OPEN      ALLLETR2,"allletaf"
          OPEN      ALLPKIA1,"allpkiaf"
          OPEN      ALLPKIA2,"allpkiaf"
          OPEN      ALLPROA1,"allproaf"
          OPEN      ALLPROA2,"allproaf"
          OPEN      ALLCCTA1,"allcctaf"
.
          CALL      OPICD1                  * Open ICD Disease files
          CALL      OPICO1                  * Open ICD Operation files
.
          READ      CONTROLF,EIGHTY8;*59,PTCNI10D 
          READ      CONTROLF,ZERO;*43,IBCNMHOS
          READ      CONTROLF,HUND25;*238,PTCNNRTD
.
          MOVE      ZERO,F2
          MOVE      PTCNNRTD,F2
          IF        F2 = 0
            MOVE      "10",PTCNNRTD
          ENDIF
.
          IF        IBCNMHOS=1
            OPEN      MLTCODA1,"mltcodaf"
            OPEN      MLTCODA2,"mltcodaf"
          ENDIF
.
          OPEN      PMSVMTA1,"pmsvmtaf"
          OPEN      PMSVSTA1,"pmsvstaf"
.
          MOVE      ZERO,NOEQIDX7
          MOVE      ZERO,OVRCD
          TRAP      OVERCOND IF IO
          OPEN      ALLEQUA7,"allequaf"
          TRAPCLR   IO
          IF        OVRCD=1
            MOVE      ONE,NOEQIDX7
          ENDIF
.
INIT9999  RETURN
.------------------------------------------------------------
. Clear Parameters
.------------------------------------------------------------
CLRPAR00  MOVE      ZERO,REPORTNO
          MOVE      SP70,TEMPLATE
          MOVE      SP70,NEXTPAGE
          MOVE      SP70,CURRCODE
          PACK      REDIRECT,SP70,SP70,SP70,SP70
          MOVE      SP70,UPDTTYPE
          MOVE      SP70,STARTKEY
          MOVE      ZERO,NORECORD
          MOVE      ZERO,STARTNUM
          MOVE      SP70,SERVTYPE
          MOVE      ZERO,FUNCTYPE
          MOVE      SP70,FUNCCODE
          MOVE      SP70,VALDTYPE
          MOVE      SP70,VALDCODE
          MOVE      SP70,VALDMCOD
          MOVE      SP70,VALDSUPL
          MOVE      SP70,VALDSCOD
          MOVE      SP70,VALDEFDT
          MOVE      SP70,VALDDATE
          MOVE      SP70,VALDTEAM
          MOVE      SP70,VALDHCPC
          MOVE      SP70,VALDMODE
          MOVE      SP70,COPYDEPT
          MOVE      SP70,KEYWORDS
          MOVE      SP70,FILTACTV
          MOVE      SP70,EQTPFILT
          MOVE      SP70,CONTCODE
          MOVE      SP70,SERVSUBT
.
          MOVE      SP70,ALSER001
          MOVE      SP70,ALSER002
          MOVE      SP70,ALSER003
          MOVE      SP70,ALSER004
          MOVE      SP70,ALSER005
          MOVE      SP70,ALSER006
          MOVE      SP70,ALSER007
          MOVE      SP70,ALSER008
          MOVE      SP70,ALSER009
          MOVE      SP70,ALSER010
          MOVE      SP70,ALSER011
          MOVE      SP70,ALSER012
          MOVE      SP70,ALSER013
          MOVE      SP70,ALSER014
          MOVE      SP70,ALSER015
          MOVE      SP70,ALSER016
.
          MOVE      SP70,DEPTCODE
          MOVE      SP70,RDEPCODE
          MOVE      SP70,ALDEP001
          MOVE      SP70,ALDEP002
          MOVE      SP70,ALDEP003
          MOVE      SP70,ALDEP004
          MOVE      SP70,ALDEP005
          MOVE      SP70,ALDEP006
          MOVE      SP70,ALDEP007
          MOVE      SP70,ALDEP008
          MOVE      SP70,ALDEP009
          MOVE      SP70,ALDEP010
          MOVE      SP70,ALDEP011
          MOVE      SP70,ALDEP012
          MOVE      SP70,ALDEP013
          MOVE      SP70,ALDEP014
          MOVE      SP70,ALDEP015
          MOVE      ONE,ALDEP016
          MOVE      ZERO,ALDEP017
          MOVE      SP70,ALDEP018
          MOVE      SP70,ALDEP019
          MOVE      ZERO,ALDEP020
          MOVE      SP70,ALDEP021
          MOVE      ZERO,ALDEP022
          MOVE      ZERO,ALDEP023
          MOVE      ZERO,ALDEP024
          MOVE      ZERO,ALDEP025
          MOVE      ZERO,ALDEP026
          MOVE      ZERO,ALDEP027
          MOVE      ZERO,ALDEP028
          MOVE      ZERO,ALDEP029
          MOVE      ZERO,ALDEP030
          MOVE      ZERO,ALDEP031
          MOVE      ZERO,ALDEP032
          MOVE      ZERO,ALDEP033
          MOVE      Z70,ALDEP034
          MOVE      Z70,ALDEP035
          MOVE      Z70,ALDEP036
          MOVE      ZERO,ALDEP037
          MOVE      ZERO,ALDEP038
          MOVE      Z70,ALDEP039
.
          MOVE      SP70,ALDEP019
          MOVE      SP70,ALDLL001
          MOVE      SP70,ALDLL002
          MOVE      SP70,ALDLL003
          MOVE      SP70,ALDLL004
          MOVE      SP70,ALDLL005
          MOVE      SP70,ALDLL006
          MOVE      SP70,ALDLL007
          MOVE      SP70,ALDLL008
          MOVE      SP70,ALDLL009
          MOVE      SP70,ALDLL010
.
          MOVE      SP70,TEMPLKEY
          MOVE      SP70,ALTMP001
          MOVE      SP70,ALTMP002  
          MOVE      SP70,ALTMP003 
          MOVE      SP70,ALTMP004
          MOVE      SP70,ALTMP005
          MOVE      SP70,ALTMP006
.
          MOVE      SP70,ALPRR001
          MOVE      SP70,ALPRR002
          MOVE      SP70,ALPRR003
          MOVE      SP70,ALPRR004
          MOVE      SP70,ALPRR005
          MOVE      SP70,ALPRR006
          MOVE      SP70,ALPRR007
          MOVE      SP70,ALPRR008
.
          MOVE      SP70,ALDIA001
          MOVE      SP70,ALDIA002
          MOVE      SP70,ALDIA003
          MOVE      SP70,ALDIA004
          MOVE      SP70,ALDIA005
          MOVE      SP70,ALDIA006
          MOVE      SP70,ALDIA007
          MOVE      SP70,ALDIA008
          MOVE      SP70,ALDIA009
.
          MOVE      SP70,ALINC001
          MOVE      SP70,ALINC002
          MOVE      SP70,ALINC003
          MOVE      SP70,ALINC004
.
          MOVE      SP70,BILLKEYS
          MOVE      SP70,ALBIL001
          MOVE      SP70,ALBIL002
          MOVE      SP70,ALBIL003
          MOVE      SP70,ALBIL004
          MOVE      SP70,ALBIL005
          MOVE      SP70,TEAMCODE
          MOVE      SP70,TEAMHCPC
          MOVE      SP70,DOCTCODE
          MOVE      SP70,ACTVONLY
.
          MOVE      Z70,ALLET001
          MOVE      Z70,ALLET002
          MOVE      Z70,ALLET003
          MOVE      Z70,ALLET004
          MOVE      Z70,ALLET005
          MOVE      Z70,ALLET006
          MOVE      Z70,ALLET007
          MOVE      Z70,ALLET008
          MOVE      Z70,ALLET009
.
          MOVE      Z70,ALMED001
          MOVE      Z70,ALMED002
          MOVE      Z70,ALMED003
          MOVE      Z70,ALMED004
          MOVE      Z70,ALMED005
          MOVE      Z70,ALMED006
          MOVE      Z70,ALMED007
          MOVE      Z70,ALMED008
          MOVE      Z70,ALMED009
          MOVE      ZERO,ALLEEND
          MOVE      SP70,FILTTYPE
.
          MOVE      SP70,ALVMP001
          MOVE      SP70,ALVMP002
          MOVE      SP70,ALVMP003
.
          MOVE      SP70,OTHERFAC
          MOVE      SP70,CHKVINAH
.
          CALL      CLALEQ00
          CALL      CPALPD00
          CALL      CLALLEQU
          CALL      CPALCA00
          CALL      CPALCT00
          CALL      CPALDS00
          CALL      CPALAT00
          CALL      CPALPO00
.
CLRPAR99  RETURN
.
.------------------------------------------------------------
. Set Parameters
.------------------------------------------------------------
SETPAR00  MATCH     "reportno=",QRYNAME
          IF        @EQUAL
            MOVE      QRYDATA,REPORTNO
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "template=",QRYNAME
          IF        @EQUAL
            MOVE      QRYDATA,TEMPLATE
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "nextpage=",QRYNAME
          IF        @EQUAL
            MOVE      QRYDATA,NEXTPAGE
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "currcode=",QRYNAME
          IF        @EQUAL
            MOVE      QRYDATA,CURRCODE
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "billkeys=",QRYNAME
          IF        @EQUAL
            MOVE      QRYDATA,BILLKEYS
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "redirect=",QRYNAME
          IF        @EQUAL
            MOVE      QRYDATA,REDIRECT
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "updttype=",QRYNAME
          IF        @EQUAL
            MOVE      QRYDATA,UPDTTYPE
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "startkey=",QRYNAME
          IF        @EQUAL
            MOVE      QRYDATA,STARTKEY
            PACK      STARTKEY,STARTKEY,SP70
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "norecord=",QRYNAME
          IF        @EQUAL
            MOVE      QRYDATA,NORECORD
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "startnum=",QRYNAME
          IF        @EQUAL
            MOVE      QRYDATA,STARTNUM
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "servtype=",QRYNAME
          IF        @EQUAL
            MOVE      QRYDATA,SERVTYPE
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "actvonly=",QRYNAME
          IF        @EQUAL
            MOVE      QRYDATA,ACTVONLY
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "deptcode=",QRYNAME
          IF        @EQUAL
            MOVE      QRYDATA,DEPTCODE
            PACK      DEPTCODE,DEPTCODE,SP70
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "copydept=",QRYNAME
          IF        @EQUAL
            PACK      COPYDEPT,QRYDATA,SP70
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "rdepcode=",QRYNAME
          IF        @EQUAL
            PACK      RDEPCODE,QRYDATA,SP70
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "keywords=",QRYNAME
          IF        @EQUAL
            MOVE      QRYDATA,KEYWORDS
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "aldep",QRYNAME
          IF        @EQUAL
            CALL      STDEP000
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "aldll",QRYNAME
          IF        @EQUAL
            CALL      STDLL000
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "alser",QRYNAME
          IF        @EQUAL
            CALL      STSER000
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "alprr",QRYNAME
          IF        @EQUAL
            CALL      STPRB000
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "alpro",QRYNAME
          IF        @EQUAL
            CALL      SPALP000
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "aldia",QRYNAME
          IF        @EQUAL
            CALL      STDIA000
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "alinc",QRYNAME
          IF        @EQUAL
            CALL      STINC000
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "alequ",QRYNAME
          IF        @EQUAL
            CALL      STEQU000
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "allet",QRYNAME
          IF        @EQUAL
            CALL      STLET000
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "almed",QRYNAME
          IF        @EQUAL
            CALL      STMED000
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "allecomm=",QRYNAME
          IF        @EQUAL
            CALL      GLTEXT00
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "altmp",QRYNAME
          IF        @EQUAL
            CALL      STTEM000
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "albil",QRYNAME
          IF        @EQUAL
            CALL      STBIL000
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "functype=",QRYNAME
          IF        @EQUAL
            MOVE      QRYDATA,FUNCTYPE
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "funccode=",QRYNAME
          IF        @EQUAL
            MOVE      QRYDATA,FUNCCODE
            PACK      FUNCCODE,FUNCCODE,SP70
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "valdtype=",QRYNAME
          IF        @EQUAL
            MOVE      QRYDATA,VALDTYPE
            PACK      VALDTYPE,VALDTYPE,SP70
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "valdcode=",QRYNAME
          IF        @EQUAL
            MOVE      QRYDATA,VALDCODE
            PACK      VALDCODE,VALDCODE,SP70
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "valdmcod=",QRYNAME
          IF        @EQUAL
            MOVE      QRYDATA,VALDMCOD
            PACK      VALDCODE,VALDMCOD,SP70
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "valdsupl=",QRYNAME
          IF        @EQUAL
            MOVE      QRYDATA,VALDSUPL
            PACK      VALDSUPL,VALDSUPL,SP70
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "valdscod=",QRYNAME
          IF        @EQUAL
            MOVE      QRYDATA,VALDSCOD
            PACK      VALDSCOD,VALDSCOD,SP70
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "valdefdt=",QRYNAME
          IF        @EQUAL
            MOVE      QRYDATA,VALDEFDT
            TYPE      VALDEFDT
            IF        @EQUAL
              PACK      VALDEFDT,VALDEFDT,SP70
            ELSE
              UNPACK    QRYDATA,CDAY,KEY1,MTHNAM3,KEY1,CCENT,CYEAR
              CALL      SETMTH00                * To Format Month
              PACK      VALDEFDT,CCENT,CYEAR,CMON,CDAY
            ENDIF
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "alpdi",QRYNAME
          IF        @EQUAL
            CALL      SPALPD00
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "alcas",QRYNAME
          IF        @EQUAL
            CALL      SPALC000
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "alctm",QRYNAME
          IF        @EQUAL
            CALL      SPALT000
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "teamcode=",QRYNAME
          IF        @EQUAL
            MOVE      QRYDATA,TEAMCODE
            PACK      TEAMCODE,TEAMCODE,SP70
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "teamhcpc=",QRYNAME
          IF        @EQUAL
            MOVE      QRYDATA,TEAMHCPC
            PACK      TEAMHCPC,TEAMHCPC,SP70
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "doctcode=",QRYNAME
          IF        @EQUAL
            MOVE      QRYDATA,DOCTCODE
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "filttype=",QRYNAME
          IF        @EQUAL
            PACK      FILTTYPE,QRYDATA,SP70
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "aldsp",QRYNAME
          IF        @EQUAL
            CALL      SPALD000
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "alats",QRYNAME
          IF        @EQUAL
            CALL      SPALAT00
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "filtactv=",QRYNAME
          IF        @EQUAL
            PACK      FILTACTV,QRYDATA,SP70
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "valddate=",QRYNAME
          IF        @EQUAL
            UNPACK    QRYDATA,CDAY,KEY1,MTHNAM3,KEY1,CCENT,CYEAR
            CALL      SETMTH00                *Set CMON from MTHNAM3
            PACK      VALDDATE,CCENT,CYEAR,CMON,CDAY
            REP       " 0",VALDDATE
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "valdteam=",QRYNAME
          IF        @EQUAL
            MOVE      QRYDATA,VALDTEAM
            PACK      VALDTEAM,VALDTEAM,SP70
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "valdhcpc=",QRYNAME
          IF        @EQUAL
            MOVE      QRYDATA,VALDHCPC
            PACK      VALDHCPC,VALDHCPC,SP70
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "valdmode=",QRYNAME
          IF        @EQUAL
            MOVE      QRYDATA,VALDMODE
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "alvmp",QRYNAME
          IF        @EQUAL
            CALL      SPALV000
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "eqtpfilt=",QRYNAME
          IF        @EQUAL
            MOVE      QRYDATA,EQTPFILT
            PACK      EQTPFILT,EQTPFILT,SP70
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "otherfac=",QRYNAME
          IF        @EQUAL
            MOVE      QRYDATA,OTHERFAC
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "contcode=",QRYNAME
          IF        @EQUAL
            MOVE      QRYDATA,CONTCODE
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "servsubt=",QRYNAME
          IF        @EQUAL
            MOVE      QRYDATA,SERVSUBT
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "chkvinah=",QRYNAME
          IF        @EQUAL
            PACK      CHKVINAH,QRYDATA,SP70
            GOTO      SETPAR99
          ENDIF
.
SETPAR99  RETURN
.
.-------------------------------------------------------------------------------
.  Set Parameters for Option 2: Allied Health Services
.-------------------------------------------------------------------------------
STSER000  MOVE      ZERO,EXIT
          UNPACK    QRYNAME,KEY5,KEY3
          MOVE      KEY3,F3
          BRANCH    F3,STSER001,STSER002,STSER003,STSER004,STSER005:
                       STSER006,STSER999,STSER999,STSER999,STSER999:
                       STSER999,STSER999,STSER013,STSER014,STSER015:
                       STSER016
.
          MOVE      ONE,EXIT
          GOTO      STSER999
.
STSER001  MOVE      QRYDATA,ALSER001
          PACK      ALSER001,ALSER001,SP30
          GOTO      STSER999
.
STSER002  MOVE      QRYDATA,ALSER002
          PACK      ALSER002,ALSER002,SP30
          GOTO      STSER999
.
STSER003  MOVE      QRYDATA,ALSER003
          PACK      ALSER003,ALSER003,SP30
          GOTO      STSER999
.
STSER004  MOVE      QRYDATA,ALSER004
          GOTO      STSER999
.
STSER005  MOVE      QRYDATA,ALSER005
          GOTO      STSER999
.
STSER006  MOVE      QRYDATA,ALSER006
          GOTO      STSER999
.
STSER013  MOVE      QRYDATA,ALSER013
          GOTO      STSER999
.
STSER014  MOVE      QRYDATA,ALSER014
          GOTO      STSER999
.
STSER015  MOVE      QRYDATA,ALSER015
          GOTO      STSER999
.
STSER016  MOVE      QRYDATA,ALSER016
          GOTO      STSER999
.
STSER999  RETURN
.-------------------------------------------------------------------------------
.  Set Parameters for Option 1: Allied Health Departments
.-------------------------------------------------------------------------------
STDEP000  MOVE      ZERO,EXIT
          UNPACK    QRYNAME,KEY5,KEY3
          MOVE      KEY3,F3
          BRANCH    F3,STDEP001,STDEP002,STDEP003,STDEP004,STDEP005:
                       STDEP006,STDEP007,STDEP008,STDEP009,STDEP010:
                       STDEP011,STDEP012,STDEP013,STDEP014,STDEP015:
                       STDEP016,STDEP017,STDEP018,STDEP019,STDEP020:
                       STDEP021,STDEP022,STDEP023,STDEP024,STDEP025:
                       STDEP026,STDEP027,STDEP028,STDEP029,STDEP030:
                       STDEP031,STDEP032,STDEP033,STDEP034,STDEP035:
                       STDEP036,STDEP037,STDEP038,STDEP039
.
          MOVE      ONE,EXIT
          GOTO      STDEP999
.
STDEP001  PACK      ALDEP001,QRYDATA,SP30
          PACK      DEPTCODE,QRYDATA,SP30
          GOTO      STDEP999
.
STDEP002  MOVE      QRYDATA,ALDEP002
          GOTO      STDEP999
.
STDEP003  MOVE      QRYDATA,ALDEP003
          GOTO      STDEP999

STDEP004  MOVE      QRYDATA,ALDEP004
          GOTO      STDEP999

STDEP005  MOVE      QRYDATA,ALDEP005
          GOTO      STDEP999

STDEP006  MOVE      QRYDATA,ALDEP006
          GOTO      STDEP999

STDEP007  MOVE      QRYDATA,ALDEP007
          GOTO      STDEP999

STDEP008  MOVE      QRYDATA,ALDEP008
          GOTO      STDEP999

STDEP009  MOVE      QRYDATA,ALDEP009
          GOTO      STDEP999

STDEP010  MOVE      QRYDATA,ALDEP010
          GOTO      STDEP999

STDEP011  MOVE      QRYDATA,ALDEP011
          GOTO      STDEP999

STDEP012  MOVE      QRYDATA,ALDEP012
          GOTO      STDEP999

STDEP013  MOVE      QRYDATA,ALDEP013
          GOTO      STDEP999

STDEP014  MOVE      QRYDATA,ALDEP014
          GOTO      STDEP999
.
STDEP015  MOVE      QRYDATA,ALDEP015
          GOTO      STDEP999
.
STDEP016  MOVE      QRYDATA,ALDEP016 
          GOTO      STDEP999
.
STDEP017  MOVE      QRYDATA,ALDEP017 
          GOTO      STDEP999
.
STDEP018  MOVE      QRYDATA,ALDEP018 
          GOTO      STDEP999
.
STDEP019  MOVE      QRYDATA,ALDEP019 
          GOTO      STDEP999
.
STDEP020  MOVE      QRYDATA,ALDEP020 
          GOTO      STDEP999
.
STDEP021  PACK      ALDEP021,QRYDATA,SP70
          GOTO      STDEP999
.
STDEP022  MOVE      QRYDATA,ALDEP022
          GOTO      STDEP999
.
STDEP023  MOVE      QRYDATA,ALDEP023
          GOTO      STDEP999
.
STDEP024  MOVE      QRYDATA,ALDEP024
          GOTO      STDEP999
.
STDEP025  MOVE      QRYDATA,ALDEP025
          GOTO      STDEP999
.
STDEP026  MOVE      QRYDATA,ALDEP026
          GOTO      STDEP999
.
STDEP027  MOVE      QRYDATA,ALDEP027
          GOTO      STDEP999
.
STDEP028  MOVE      QRYDATA,ALDEP028
          GOTO      STDEP999
.
STDEP029  MOVE      QRYDATA,ALDEP029
          GOTO      STDEP999
.
STDEP030  MOVE      QRYDATA,ALDEP030
          GOTO      STDEP999
.
STDEP031  MOVE      QRYDATA,ALDEP031
          GOTO      STDEP999
.
STDEP032  MOVE      QRYDATA,ALDEP032
          GOTO      STDEP999
.
STDEP033  MOVE      QRYDATA,ALDEP033
          GOTO      STDEP999
.
STDEP034  MOVE      QRYDATA,ALDEP034
          GOTO      STDEP999
.
STDEP035  MOVE      QRYDATA,ALDEP035
          GOTO      STDEP999
.
STDEP036  MOVE      QRYDATA,ALDEP036
          GOTO      STDEP999
.
STDEP037  MOVE      QRYDATA,ALDEP037
          GOTO      STDEP999
.
STDEP038  MOVE      QRYDATA,ALDEP038
          GOTO      STDEP999
.
STDEP039  MOVE      QRYDATA,ALDEP039
          GOTO      STDEP999
.
STDEP999  RETURN
.-------------------------------------------------------------------------------
.  Set Parameters for Option 16: Allied Health Department Default letters
.-------------------------------------------------------------------------------
STDLL000  MOVE      ZERO,EXIT
          UNPACK    QRYNAME,KEY5,KEY3
          MOVE      KEY3,F3
          BRANCH    F3,STDLL001,STDLL002,STDLL003,STDLL004,STDLL005:
                       STDLL006,STDLL007,STDLL008,STDLL009,STDLL010
.         
          MOVE      ONE,EXIT
          GOTO      STDLL999
.         
STDLL001  PACK      ALDLL001,QRYDATA,SP30
          GOTO      STDLL999
.
STDLL002  PACK      ALDLL002,QRYDATA,SP30
          GOTO      STDLL999
.
STDLL003  PACK      ALDLL003,QRYDATA,SP30
          GOTO      STDLL999
.
STDLL004  PACK      ALDLL004,QRYDATA,SP30
          GOTO      STDLL999
.
STDLL005  PACK      ALDLL005,QRYDATA,SP30
          GOTO      STDLL999
.
STDLL006  PACK      ALDLL006,QRYDATA,SP30
          GOTO      STDLL999
.
STDLL007  PACK      ALDLL007,QRYDATA,SP30
          GOTO      STDLL999
.
STDLL008  PACK      ALDLL008,QRYDATA,SP30
          GOTO      STDLL999
.
STDLL009  PACK      ALDLL009,QRYDATA,SP30
          GOTO      STDLL999
.
STDLL010  PACK      ALDLL010,QRYDATA,SP30
          GOTO      STDLL999
.
STDLL999  RETURN
.--------------------------------------------------------------------
.  Set Parameters for Option 4: Allied Health Diagonosis Maintenance
.--------------------------------------------------------------------
STDIA000  MOVE      ZERO,EXIT
          UNPACK    QRYNAME,KEY5,KEY3
          MOVE      KEY3,F3
          BRANCH    F3,STDIA001,STDIA002,STDIA003,STDIA004,STDIA005:
                       STDIA006,STDIA007,STDIA008,STDIA009
.
          MOVE      ONE,EXIT
          GOTO      STDIA999
.
STDIA001  MOVE      QRYDATA,ALDIA001
          PACK      ALDIA001,ALDIA001,SP30
          GOTO      STDIA999  
.
STDIA002  MOVE      QRYDATA,ALDIA002
          GOTO      STDIA999
.
STDIA003  MOVE      QRYDATA,ALDIA003
          GOTO      STDIA999
.
STDIA004  MOVE      QRYDATA,ALDIA004
          GOTO      STDIA999
.
STDIA005  MOVE      QRYDATA,ALDIA005
          GOTO      STDIA999
.
STDIA006  MOVE      QRYDATA,ALDIA006
          GOTO      STDIA999
.
STDIA007  MOVE      QRYDATA,ALDIA007
          GOTO      STDIA999
.
STDIA008  MOVE      QRYDATA,ALDIA008
          GOTO      STDIA999
.
STDIA009  MOVE      QRYDATA,ALDIA009
          GOTO      STDIA999
.
STDIA999  RETURN
.
.--------------------------------------------------------------------
.  Set Parameters for Option 18: Allied Health Interventino Maintenance
.--------------------------------------------------------------------
STINC000  MOVE      ZERO,EXIT
          UNPACK    QRYNAME,KEY5,KEY3
          MOVE      KEY3,F3
          BRANCH    F3,STINC001,STINC002,STINC003,STINC004
.
          MOVE      ONE,EXIT
          GOTO      STINC999
.
STINC001  MOVE      QRYDATA,ALINC001
          PACK      ALINC001,ALINC001,SP30
          GOTO      STINC999
.
STINC002  MOVE      QRYDATA,ALINC002
          GOTO      STINC999
.
STINC003  MOVE      QRYDATA,ALINC003
          GOTO      STINC999
.
STINC004  MOVE      QRYDATA,ALINC004
          GOTO      STINC999
.
STINC999  RETURN
+
.--------------------------------------------------------------------
.  Set Parameters for Option 6: Allied Health Template Maintenance
.--------------------------------------------------------------------
STTEM000  MOVE      ZERO,EXIT
          UNPACK    QRYNAME,KEY5,KEY3
          MOVE      KEY3,F3
          BRANCH    F3,STTEM001,STTEM002,STTEM003,STTEM004,STTEM005:
                       STTEM006
.
          MOVE      ONE,EXIT
          GOTO      STTEM999
.
STTEM001  MOVE      QRYDATA,ALTMP001
          PACK      ALTMP001,ALTMP001,SP70
          GOTO      STTEM999
.
STTEM002  MOVE      QRYDATA,ALTMP002
          PACK      ALTMP002,ALTMP002,SP70
          GOTO      STTEM999 
.
STTEM003  MOVE      QRYDATA,ALTMP003
          PACK      ALTMP003,ALTMP003,SP70
          GOTO      STTEM999 
.
STTEM004  MOVE      QRYDATA,ALTMP004
          PACK      ALTMP004,ALTMP004,SP70
          GOTO      STTEM999 
.
STTEM005  MOVE      QRYDATA,ALTMP005
          GOTO      STTEM999 
.
STTEM006  MOVE      QRYDATA,ALTMP006
          GOTO      STTEM999 
.
STTEM999  RETURN 
.--------------------------------------------------------------------
.  Set Parameters for Option 7: Allied Health Billing Maintenance
.--------------------------------------------------------------------
STBIL000  MOVE      ZERO,EXIT
          UNPACK    QRYNAME,KEY5,KEY3
          MOVE      KEY3,F3
          BRANCH    F3,STBIL001,STBIL002,STBIL003,STBIL004,STBIL005
.
          MOVE      ONE,EXIT
          GOTO      STBIL999
.
STBIL001  MOVE      QRYDATA,ALBIL001
          PACK      ALBIL001,ALBIL001,SP70
          GOTO      STBIL999
.
STBIL002  MOVE      QRYDATA,ALBIL002
          PACK      ALBIL002,ALBIL002,SP70
          GOTO      STBIL999
.
STBIL003  MOVE      QRYDATA,ALBIL003
          PACK      ALBIL003,ALBIL003,SP70
          GOTO      STBIL999
.
STBIL004  MOVE      QRYDATA,ALBIL004
          PACK      ALBIL004,ALBIL004,SP70
          GOTO      STBIL999
.
STBIL005  MOVE      QRYDATA,ALBIL005
          GOTO      STBIL999
.
STBIL999  RETURN 
.------------------------------------------------------------
. Remote Scripting Functions
.   Required  - FUNCCODE
.             - FUNCTYPE
.               1. Validate Equipment Code            
.------------------------------------------------------------
REMOTE00  BRANCH    FUNCTYPE,REMOTE10,REMOTE20,REMOTE30,REMOTE40:
                    REMOTE50,REMOTE60,REMOTE70,REMOTE80
          GOTO      REMOTE90
.
REMOTE10  CALL      VALEQU00     * Validate Equipment Code
          GOTO      REMOTE99
.
REMOTE20  CALL      SRCEQU00     * Search Validate Equipment Code
          GOTO      REMOTE99
.
REMOTE30  CALL      VALDIA00     * Validate a Diagnosis Code      
          GOTO      REMOTE99
.
REMOTE40  CALL      VALMED00     * Validate a Medication Code      
          GOTO      REMOTE99
.
REMOTE50  CALL      VALINC00     * Validate an Intervention Code      
          GOTO      REMOTE99
.
REMOTE60  CALL      VALPRB00     * Validate a Problem Code      
          GOTO      REMOTE99
.
REMOTE70  CALL      VALCTM00     * Validate a Case Team Member
          GOTO      REMOTE99
. 
REMOTE80  CALL      VALPRO00     * Validate a Procedure Code
          GOTO      REMOTE99
.
REMOTE90  CALL      XMLHED00
          WRITE     HTMLFILE;"<RETURN_VALUE TYPE=ERROR>":
                             "Invalid Validation Type":
                             "</RETURN_VALUE>"
          CALL      XMLEND00
          GOTO      REMOTE99
.
REMOTE99  RETURN
.------------------------------------------------------------
. Validate Equipment Code                     
. INPUTS: FUNCCODE - Equipment Code
.------------------------------------------------------------
VALEQU00  CALL      XMLHED00
          BRANCH    EXIT,VALEQU99
.
          PACK      KEY10,FUNCCODE,SP70
          CALL      RDALEQU1
          BRANCH    OVRCD,VALEQU90
.
          MATCH     "1",ALEQACTV      * Active/Inactive
          GOTO      VALEQU90 IF EQUAL
.
          MATCH     "0",ALEQSTAT      * Check Status 
          GOTO      VALEQU91 IF NOT EQUAL
.
          COMPARE   ZERO,ALEQCBAL     * Check Current Balance
          GOTO      VALEQU92 IF EQUAL
.
          MOVE      "CG",CATEGORY     * Get Department Description
          MOVE      ALEQDEPT,CODE
          CALL      GETCOD00
.
          WRITE     HTMLFILE;"<RETURN_VALUE TYPE=SIMPLE>":
         ALEQDESC,"|",ALEQDEPT,"|",TDESC,"|",ALEQCONS,"|",ALEQSERI,"|",ALEQSUPP:
                  "|",ALEQUNIT,"</RETURN_VALUE>"
.
          GOTO      VALEQU98
.
VALEQU90  WRITE     HTMLFILE;"<RETURN_VALUE TYPE=ERROR>":
                             FUNCCODE," - Equipment Code not found. ":
                             "</RETURN_VALUE>"
          GOTO      VALEQU98
.
VALEQU91  WRITE     HTMLFILE;"<RETURN_VALUE TYPE=ERROR>":
                             FUNCCODE," - is not available for loan. ":
                             "</RETURN_VALUE>"
          GOTO      VALEQU98
.
VALEQU92  WRITE     HTMLFILE;"<RETURN_VALUE TYPE=ERROR>":
                             FUNCCODE," - has a current balance of 0. ":
                             "</RETURN_VALUE>"
          GOTO      VALEQU98
.
VALEQU98  CALL      XMLEND00
VALEQU99  RETURN
.
.------------------------------------------------------------
. Validate Equipment Code
. INPUTS: FUNCCODE - Equipment Code
.------------------------------------------------------------
SRCEQU00  CALL      XMLHED00
          BRANCH    EXIT,SRCEQU99
.
          PACK      KEY10,FUNCCODE,SP70
          CALL      RDALEQU1
          BRANCH    OVRCD,SRCEQU90
.
          WRITE     HTMLFILE;"<RETURN_VALUE TYPE=SIMPLE>":
         ALEQDESC,"|",ALEQDEPT,"|",TDESC,"|",ALEQCONS,"|",ALEQSERI,"|",ALEQSUPP:
                  "|",ALEQUNIT,"</RETURN_VALUE>"
.
          GOTO      SRCEQU98
.
SRCEQU90  WRITE     HTMLFILE;"<RETURN_VALUE TYPE=ERROR>":
                             FUNCCODE," - Equipment Code not found. ":
                             "</RETURN_VALUE>"
          GOTO      SRCEQU98
.
SRCEQU98  CALL      XMLEND00
SRCEQU99  RETURN
.
.------------------------------------------------------------
. Validate Diagnosis Code
. INPUTS: DEPTCODE - Department
.         VALDCODE - Diagnosis Code
.         VALDDATE - Episode Start Date. Must be prior to 
.                    HCP code which containts the end year (July 1)
.------------------------------------------------------------
VALDIA00  CALL      XMLHED00
          BRANCH    EXIT,VALDIA99
.
          PACK      KEY12,DEPTCODE,VALDCODE,SP70
          CALL      RDALDIA1
          BRANCH    OVRCD,VALDIA90
.
          MATCH     "1",ALDIACTV      * Check Status
          GOTO      VALDIA91 IF NOT EQUAL
.
          MATCH     "1",CHKVINAH            * If not equal
          GOTO      VALDIA50 IF NOT EQUAL   
.
          MATCH     "00000000",VALDDATE     * VINAH version date
          IF        @EQUAL
            CALL      IBACLOCK
            PACK      VALDDATE,CCC,CYY,CMM,CDD
            REP       " 0",VALDDATE
          ENDIF
.
          MATCH     SP70,VALDDATE
          IF        !@EQUAL & !@EOS
            MATCH     SP70,ALDISDAT
            IF        !@EQUAL & !@EOS
              MATCH     ALDISDAT,VALDDATE
              GOTO      VALDIA92 IF LESS      * Invalid code for VINAH version
            ENDIF
.
            MATCH   SP70,ALDIEDAT
            IF      !@EQUAL & !@EOS
              MATCH     VALDDATE,ALDIEDAT
              GOTO      VALDIA92 IF LESS      * Invalid code for VINAH version
            ENDIF
          ENDIF
.
VALDIA50  WRITE     HTMLFILE;"<RETURN_VALUE TYPE=SIMPLE>":
                    ALDIDESC:
                    "</RETURN_VALUE>"
.
          GOTO      VALDIA98
.
VALDIA90  WRITE     HTMLFILE;"<RETURN_VALUE TYPE=ERROR>":
                             VALDCODE," - Diagnosis Code not found. ":
                             "</RETURN_VALUE>"
          GOTO      VALDIA98
.
VALDIA91  WRITE     HTMLFILE;"<RETURN_VALUE TYPE=ERROR>":
                             VALDCODE," - Diagnosis Code Inactive. ":
                             "</RETURN_VALUE>"
          GOTO      VALDIA98
.
VALDIA92  WRITE     HTMLFILE;"<RETURN_VALUE TYPE=ERROR>":
                             "Invalid Diagnosis code for VINAH Referral Start ":
                             "Date":
                             "</RETURN_VALUE>"
          GOTO      VALDIA98
.
VALDIA93  WRITE     HTMLFILE;"<RETURN_VALUE TYPE=ERROR>":
                             "Invalid Diagnosis code for VINAH Date":
                             "</RETURN_VALUE>"
          GOTO      VALDIA98
.
VALDIA98  CALL      XMLEND00
VALDIA99  RETURN
.
.------------------------------------------------------------
. Validate Problem Code
. INPUTS: DEPTCODE - Department
.         VALDCODE - Problem Code
.------------------------------------------------------------
VALPRB00  CALL      XMLHED00
          BRANCH    EXIT,VALPRB99
.
          PACK      KEY12,DEPTCODE,VALDCODE,SP70
          CALL      RDALPRR1
          BRANCH    OVRCD,VALPRB90
.
          MATCH     "1",ALPRACTV      * Check Status
          GOTO      VALPRB91 IF NOT EQUAL
.
          MATCH     "1",OTHERFAC
          IF        @EQUAL
            MATCH     "1",ALPROTHR          * Skip problem only codes 
            GOTO      VALPRB92 IF EQUAL
          ENDIF
.
          WRITE     HTMLFILE;"<RETURN_VALUE TYPE=SIMPLE>":
                    ALPRDESC:
                    "</RETURN_VALUE>"
.
          GOTO      VALPRB98
.
VALPRB90  WRITE     HTMLFILE;"<RETURN_VALUE TYPE=ERROR>";
          MATCH     "1",OTHERFAC
          IF        @EQUAL
            WRITE     HTMLFILE;VALDCODE," - Other Factor Affecting ":
                               "Health not found"
          ELSE
            WRITE     HTMLFILE;VALDCODE," - Problem Code not found. ";
          ENDIF
.
          WRITE     HTMLFILE;"</RETURN_VALUE>"
          GOTO      VALPRB98
.
VALPRB91  WRITE     HTMLFILE;"<RETURN_VALUE TYPE=ERROR>";
          MATCH     "1",OTHERFAC
          IF        @EQUAL
            WRITE     HTMLFILE;VALDCODE," - Other Factor Affecting ":
                               "Health Inactive. ";
          ELSE
            WRITE     HTMLFILE;VALDCODE," - Problem Code Inactive. ";
          ENDIF
.
          WRITE     HTMLFILE;"</RETURN_VALUE>"
          GOTO      VALPRB98
.
VALPRB92  WRITE     HTMLFILE;"<RETURN_VALUE TYPE=ERROR>":
                             VALDCODE," - Problem Code is not a other ":
                                      "factor affecting health. ":
                             "</RETURN_VALUE>"
          GOTO      VALPRB98
.
VALPRB98  CALL      XMLEND00
VALPRB99  RETURN
.
.------------------------------------------------------------
. Validate Medication Code
. INPUTS:  VALDCODE - Diagnosis Code
.------------------------------------------------------------
VALMED00  CALL      XMLHED00
          BRANCH    EXIT,VALMED99
.
          PACK      KEY20,VALDMCOD,SP70
          CALL      RDALMED1
          BRANCH    OVRCD,VALMED90
.
          MATCH     "1",ALMEACTV      * Check Status
          GOTO      VALMED91 IF EQUAL
.
          WRITE     HTMLFILE;"<RETURN_VALUE TYPE=SIMPLE>":
                    ALMEDESC,"|",ALMEUNIT,"|",ALMEMEDR,"|",ALMEMEDT:
                    "</RETURN_VALUE>"
.
          GOTO      VALMED98
.
VALMED90  WRITE     HTMLFILE;"<RETURN_VALUE TYPE=ERROR>":
                             VALDMCOD," - Medication Code not found. ":
                             "</RETURN_VALUE>"
          GOTO      VALMED98
.
VALMED91  WRITE     HTMLFILE;"<RETURN_VALUE TYPE=ERROR>":
                             VALDMCOD," - Medication Code Inactive. ":
                             "</RETURN_VALUE>"
          GOTO      VALMED98
.
VALMED98  CALL      XMLEND00
VALMED99  RETURN
.------------------------------------------------------------
. Validate Intervention Code
. INPUTS:  VALDCODE - Intervention Code
.------------------------------------------------------------
VALINC00  CALL      XMLHED00
          BRANCH    EXIT,VALINC99
.
          PACK      KEY12,DEPTCODE,VALDCODE,SP70
          CALL      RDALINC1
          BRANCH    OVRCD,VALINC90
.
          MATCH     "1",ALINACTV      * Check Status
          GOTO      VALINC91 IF EQUAL
.
          WRITE     HTMLFILE;"<RETURN_VALUE TYPE=SIMPLE>":
                    ALINDESC:
                    "</RETURN_VALUE>"
.
          GOTO      VALINC98
.
VALINC90  WRITE     HTMLFILE;"<RETURN_VALUE TYPE=ERROR>":
                             VALDCODE," - Intervention Code not found. ":
                             "</RETURN_VALUE>"
          GOTO      VALINC98
.
VALINC91  WRITE     HTMLFILE;"<RETURN_VALUE TYPE=ERROR>":
                             VALDCODE," - Intervention Code Inactive. ":
                             "</RETURN_VALUE>"
          GOTO      VALINC98
.
VALINC98  CALL      XMLEND00
VALINC99  RETURN
.------------------------------------------------------------
. Process Fields
.------------------------------------------------------------
PROFLD00  BRANCH    REPORTNO,PROFLD10,PROFLD20,PROFLD30,PROFLD40,PROFLD50:
                             PROFLD60,PROFLD70,PROFLD80,PROFLD99,PROFL100:
                             PROFLD99,PROFL120,PROFL130,PROFLD99,PROFL150:
                             PROFL160,PROFL170,PROFL180,PROFL190,PROFL200:
                             PROFL210,PROFL220,PROFL230,PROFL240
          GOTO      PROFLD99
.
PROFLD10  BRANCH    FLDSETNO,PROFLD11,PROFLD12
          GOTO      PROFLD99
.
PROFLD11  CALL      ALDP0000                     * Department details
          GOTO      PROFLD99 
.
PROFLD12  CALL      ALDS0000                * Department Specific Parameters
          GOTO      PROFLD99 
.
PROFLD20  BRANCH    FLDSETNO,PROFLD21
          GOTO      PROFLD99
.
PROFLD21  CALL      ALSR0000                     * Service detials 
          GOTO      PROFLD99
.
PROFLD30  BRANCH    FLDSETNO,PROFLD31     
          GOTO      PROFLD99
.
PROFLD31  CALL      ALPR0000                     *  problems details
          GOTO      PROFLD99
.
PROFLD40  BRANCH    FLDSETNO,PROFLD41 
          GOTO      PROFLD99
.
PROFLD41  CALL      ALDG0000                     *  Diagnosis details
          GOTO      PROFLD99
.
PROFLD50  BRANCH    FLDSETNO,PROFLD51
          GOTO      PROFLD99
.
PROFLD51  CALL      ALEQ0000                     * Equipment details 
          GOTO      PROFLD99 
.
PROFLD60  BRANCH    FLDSETNO,PROFLD61
          GOTO      PROFLD99
.
PROFLD61  CALL      ALTP0000                     * Template  Details
          GOTO      PROFLD99
.
PROFLD70  BRANCH    FLDSETNO,PROFLD71,PROFLD72
          GOTO      PROFLD99
.
PROFLD71  CALL      ALBI0000                     * Billing Details 
          GOTO      PROFLD99
.
PROFLD72  CALL      ALBL0000                     * Billing Details 
          GOTO      PROFLD99
.
PROFLD80  BRANCH    FLDSETNO,PROFLD81
          GOTO      PROFLD99
.
PROFLD81  
          GOTO      PROFLD99
.
PROFL100  BRANCH    FLDSETNO,PROFL101
          GOTO      PROFLD99
.
PROFL101  CALL      ALPD0000                     * Predefined Diagnosis details
          GOTO      PROFLD99
.
PROFL120  BRANCH    FLDSETNO,PROFL121,PROFL122
          GOTO      PROFLD99
.
PROFL121  CALL      ALCC0000                     * Case team details maint
          GOTO      PROFLD99
.
PROFL122  CALL      ALCA0000                     * Case team details
          GOTO      PROFLD99
.
PROFL130  BRANCH    FLDSETNO,PROFL131,PROFL132,PROFL133
          GOTO      PROFLD99
.
PROFL131  CALL      ALCC0000                     * Case team details maint
          GOTO      PROFLD99
.
PROFL132  CALL      ALCA0000                     * Case team details
          GOTO      PROFLD99
.
PROFL133  CALL      ALCT0000                     * Case team member details
          GOTO      PROFLD99
.
PROFL150  CALL      LETF0000                     * Letter Details
          GOTO      PROFLD99
.
PROFL160  BRANCH    FLDSETNO,PROFL161
          GOTO      PROFLD99
.
PROFL161  CALL      ALDL0000                     *  default letter details
          GOTO      PROFLD99
.
PROFL170  BRANCH    FLDSETNO,PROFL171            
          GOTO      PROFLD99
.
PROFL171  CALL      ALMD0000                     *  Medication details
          GOTO      PROFLD99
.
PROFL180  BRANCH    FLDSETNO,PROFL181
          GOTO      PROFLD99
.
PROFL181  CALL      ALIN0000                     *  Intervention details
          GOTO      PROFLD99
.
PROFL190  BRANCH    FLDSETNO,PROFL191,PROFL192
          GOTO      PROFLD99
.
PROFL191  CALL      ALAT0000                     *  Assessment Type details
          GOTO      PROFLD99
.
PROFL192  CALL      TABL0000                     * General Tags
          GOTO      PROFLD99
.
PROFL200  BRANCH    FLDSETNO,PROFL201
          GOTO      PROFLD99
.
PROFL201  CALL      ALVM0000                     * VINAH Extract Category Map
          GOTO      PROFLD99
.
PROFL210  CALL      ACCC0000                     * Contract Codes
          GOTO      PROFLD99
.
PROFL220  BRANCH    FLDSETNO,PROFL221,PROFL222
          GOTO      PROFLD99
.
PROFL221  CALL      ALPO0000
          GOTO      PROFLD99
.
PROFL222  CALL      GTAG0000
          GOTO      PROFLD99
.
PROFL230  GOTO      PROFLD99
.
PROFL240  BRANCH    FLDSETNO,PROFL241
          GOTO      PROFLD99
.
PROFL241  CALL      SSTY0000
          GOTO      PROFLD99
.
PROFLD99  RETURN
.
.------------------------------------------------------------
. ALLIED Health - General tags
.------------------------------------------------------------
TABL0000  BRANCH    FLDITMNO,TABL0001,TABL0002
.
          WRITE     HTMLFILE;"Invalid IBA Tag";
          GOTO      TABL9999
.
TABL0001  MOVE      "CG",CATEGORY           * Department Code
          MOVE      DEPARTMN,CODE
          CALL      CODITM00
          GOTO      TABL9999
.
TABL0002  MOVE      ZERO,INCLDINP           * Exclude IP AH Departents
          CALL      DEPSEL00                * Department Selection List
          GOTO      TABL9999
.
TABL9999  RETURN
+
.------------------------------------------------------------
. Output Next Page Based on CGI Parameter nextpage
.------------------------------------------------------------
NXTPAG00  MOVE      ZERO,F1
          MOVE      NEXTPAGE,F1
          BRANCH    F1,NXTPAG10,NXTPAG20,NXTPAG30,NXTPAG40
.
          CALL      WINCLS00
          GOTO      NXTPAG99
.
NXTPAG10  CALL      RDIREC00
          GOTO      NXTPAG99
.
NXTPAG20  CALL      GOBACK00
          GOTO      NXTPAG99
.
NXTPAG30  CALL      GOBACK00
          GOTO      NXTPAG99
.
NXTPAG40  CALL      GOBACK00
          GOTO      NXTPAG99
.
NXTPAG99  RETURN
.
.-------------------------------------------------------------------------------
.  Goes back x number of pages
.-------------------------------------------------------------------------------
GOBACK00  CALL      OPENHTML
          BRANCH    EXIT,GOBACK99
.
          MOVE      NEXTPAGE,F1
          SUB       TWO,F1
          WRITE     HTMLFILE;"<script type=#"text/javascript#"> {":
                             "    alert(#"",WEBTITLE,"#");":
.                            "    self.close();":
                             "    window.history.go(-",F1,");":
                             "}":
                             "</script>"
          CALL      CLOSHTML
GOBACK99  RETURN
.
.-----------------------------------------------------------
. Link to previous Contract Codes
.-----------------------------------------------------------
PRVCCC00  MOVE      NORECORD,KEY2
          REP       " +",KEY2
          ASSIGN    STARTNUM-NORECORD,F3
          IF        F3<0
            MOVE      ZERO,F3
          ENDIF
          MOVE      F3,KEY3
          REP       " +",KEY3
          UNPACK    DIM127,D1,FLDPARA,DIM127
          MOVE      REPORTNO,F2
.
          REPLACE   " +",DEPTCODE
          REPLACE   " +",STARTKEY
.
          WRITE     HTMLFILE;"allweb01.pbl":
                             "?reportno=21":
                             "&template=001":
                             "&startnum=",KEY3:
                             "&norecord=",KEY2:
                             "&deptcode=",DEPTCODE:
                             "&startkey=",STARTKEY,"#"";
.
          REPLACE   "+ ",DEPTCODE
          REPLACE   "+ ",STARTKEY
.
PRVCCC99  RETURN
.-----------------------------------------------------------
. Link to next Contract Codes
.-----------------------------------------------------------
NXTCCC00  MOVE      NORECORD,KEY2
          REP       " +",KEY2
          ASSIGN    STARTNUM+NORECORD,F3
          IF        F3<0
            MOVE      ZERO,F3
          ENDIF
          MOVE      F3,KEY3
          REP       " +",KEY3
          UNPACK    DIM127,D1,FLDPARA,DIM127
          MOVE      REPORTNO,F2
.
          REPLACE   " +",DEPTCODE
          REPLACE   " +",STARTKEY
.
          WRITE     HTMLFILE;"allweb01.pbl":
                             "?reportno=21":
                             "&template=001":
                             "&startnum=",KEY3:
                             "&norecord=",KEY2:
                             "&deptcode=",DEPTCODE:
                             "&startkey=",STARTKEY,"#"";
.
          REPLACE   "+ ",DEPTCODE
          REPLACE   "+ ",STARTKEY
.
NXTCCC99  RETURN
.
.------------------------------------------------------------
. Process Deparment Services 
.------------------------------------------------------------
ALLDEP00  RESET     UPDTTYPE
          MATCH     SP1,UPDTTYPE
          GOTO      ALLDEP50 IF EQUAL
.
          MATCH     "A",UPDTTYPE    * Add formaction
          GOTO      ALLDEP10 IF EQUAL
.
          MATCH     "U",UPDTTYPE    * Update formaction
          GOTO      ALLDEP20 IF EQUAL
.
          MATCH     "D",UPDTTYPE    * Delete formaction
          GOTO      ALLDEP30 IF EQUAL
.
          MATCH     "C",UPDTTYPE    * Update Dept Specific Categories file
          GOTO      ALLDEP40 IF EQUAL
.         
          GOTO      ALLDEP93
.
.         ************ ADD FORMACTION ***********
.
ALLDEP10  CALL      CLRDEP00                     * Clear department file vars
.
          PACK      KEY3,DEPTCODE,SP70
          CALL      RAALDEP1
          COMPARE   ZERO,OVRCD
          GOTO      ALLDEP92 IF EQUAL
          CALL      SAVDEP00                     * Move cgi to file variables
          PACK      KEY8,CCC,CYY,CMM,CDD
          REP       " 0",KEY8
          MOVE      KEY8,ALDECDAT                * System date
          CLOCK     TIME,ALDECTIM                * System time (Var chgd HPS)
          MOVE      USERID,ALDECUID              * web user id
          MOVE      SP70,ALDEUDAT
          MOVE      SP70,ALDEUTIM
          MOVE      SP70,ALDEUUID
.          MOVE      SP70,ALDEDACP
          MOVE      SP70,ALDESPAR
.
          PACK      KEY3,DEPTCODE,SP70
          CALL      WRALDEP1                     * Writes the data
.
          MOVE      ZERO,EXIT
          GOTO      ALLDEP99
.
.         ************ UPDATE FORMACTION **********
.
ALLDEP20  PACK      KEY3,DEPTCODE,SP70
          CALL      RLALDEP1
          BRANCH    OVRCD,ALLDEP91,ALLDEP90
          CALL      SAVDEP00                     * Moves cgi to file variables
          PACK      KEY8,CCC,CYY,CMM,CDD
          REP       " 0",KEY8
          MOVE      KEY8,ALDEUDAT                * System date
          CLOCK     TIME,ALDEUTIM                * System time  (Var chgd HPS)
          MOVE      USERID,ALDEUUID              * web user id
          MOVE      SP70,ALDESPAR
          CALL      UPALDEP1                     * Updates the data
          CALL      UUALDEP1                     * Unlock the data
.
          MOVE      ZERO,EXIT
          GOTO      ALLDEP99
.
.         ************ DELETE FORMACTION **********
.
ALLDEP30  PACK      KEY12,DEPTCODE,SP70     * Read Problems Table
          CALL      RSALPRR1
          CALL      RKALPRR1                      
          BRANCH    OVRCD,ALLDEP31
.
          MATCH     DEPTCODE,ALPRDEPT
          GOTO      ALLDEP31 IF NOT EQUAL
.
          GOTO      ALLDEP95       * Records exist!
.
ALLDEP31  PACK      KEY12,DEPTCODE,SP70     * Diagnosis Table
          CALL      RSALDIA1
          CALL      RKALDIA1
          BRANCH    OVRCD,ALLDEP32
.
          MATCH     DEPTCODE,ALDIDEPT
          GOTO      ALLDEP32 IF NOT EQUAL
.
          GOTO      ALLDEP96       * Records exist!
.
ALLDEP32  PACK      KEY9,DEPARTMN,SP70      * Services Table
          CALL      RSALSER1
          CALL      RKALSER1
          BRANCH    OVRCD,ALLDEP33
.
          MATCH     DEPTCODE,ALSRDEPT
          GOTO      ALLDEP33 IF NOT EQUAL
.
          GOTO      ALLDEP97       * Records exist!
.
ALLDEP33  PACK      KEY16,DEPARTMN,SP70     * Template Table
          CALL      RSALTMP1 
          CALL      RKALTMP1 
          BRANCH    OVRCD,ALLDEP34
.
          MATCH     DEPTCODE,ALTMDEPT
          GOTO      ALLDEP34 IF NOT EQUAL
.
          GOTO      ALLDEP98       * Records exist!
.
ALLDEP34  PACK      KEY3,DEPTCODE,SP70    * Now Delete Department
          CALL      RLALDEP1
          BRANCH    OVRCD,ALLDEP91,ALLDEP90
          CALL      DEALDEP1                     * Deletes the data
.
          PACK      KEY3,DEPTCODE,SP70
          CALL      RDALDSP1
          IF        OVRCD<>1
            CALL      DEALDSP1              * delete dept specific categories
          ENDIF
.
          MOVE      ZERO,EXIT
          GOTO      ALLDEP99
.
.         ************ Update Dept Categories FORMACTION **********
.
ALLDEP40  PACK      KEY3,DEPTCODE,SP70   * UPDATE DEPT SPECIFIC CATEGORIES
          CALL      RDALDSP1
          IF        OVRCD=1
            CALL      CLALDP00
          ENDIF
.         
          CALL      MVALDP00      * Moves input variables to file variables
          MOVE      DEPTCODE,ALDPDEPT
.         
          CALL      RAALDSP1      * Does record exist?
          IF        OVRCD=1
            CALL      WRALDSP1    * No, write record
          ELSE
            CALL      UPALDSP1    * Yes, update record
          ENDIF
.
          MOVE      ZERO,EXIT
          GOTO      ALLDEP99
.
.         ************ DISPLAY FORMACTION **********
.
ALLDEP50  PACK      KEY3,DEPTCODE,SP70
          CALL      RDALDEP1                      * Read department table 
          IF        OVRCD=1
            CALL      CLRDEP00                    * Clear all the file variables
          ENDIF
.
          PACK      KEY3,DEPTCODE,SP70
          CALL      RDALDSP1      * Read Dept Specific Parameters file
          IF        OVRCD=1
            CALL      CLALDP00    * Clear all the file variables
          ENDIF
.
          CLEAR     WEBTITLE
          MOVE      "Department Services Maintenance",WEBTITLE
          RESET     WEBTITLE
.
          CALL      WEBHED00   * Create Output File and Write HTML Page Header
          BRANCH    EXIT,ALLDEP99
          CALL      WEBBOD00   * Process Web Body
          CALL      WEBEND00   * Process End of HTML File
          MOVE      ONE,EXIT
          GOTO      ALLDEP99
.
ALLDEP90  MOVE      "Department Code Locked.",WEBTITLE
          CALL      WEBERR00
          MOVE      ONE,EXIT
          GOTO      ALLDEP99
.
ALLDEP91  MOVE      "Department Code Does Not Exist",WEBTITLE
          CALL      WEBERR00
          MOVE      ONE,EXIT
          GOTO      ALLDEP99
.
ALLDEP92  MOVE      "Department Code Exists",WEBTITLE
          CALL      WEBERR00
P
          MOVE      ONE,EXIT
          GOTO      ALLDEP99
.
ALLDEP93  MOVE      "Invalid Form Action.",WEBTITLE
          CALL      WEBERR00
          MOVE      ONE,EXIT
          GOTO      ALLDEP99
.
ALLDEP94  MOVE      "Invalid Department Code",WEBTITLE
          CALL      WEBERR00
          MOVE      ONE,EXIT
          GOTO      ALLDEP99
.
ALLDEP95  MOVE      "Problem Records still exist please delete first!",WEBTITLE
          CALL      WEBERR00
          MOVE      ONE,EXIT
          GOTO      ALLDEP99
.
ALLDEP96  MOVE      "Diagnosis Records still exist please delete ",WEBTITLE
          ENDSET    WEBTITLE
          APPEND    "first!",WEBTITLE
          CALL      WEBERR00
          MOVE      ONE,EXIT
          GOTO      ALLDEP99
.
ALLDEP97  MOVE      "Service Records still exist please delete first!",WEBTITLE
          CALL      WEBERR00
          MOVE      ONE,EXIT
          GOTO      ALLDEP99
.
ALLDEP98  MOVE      "Template Records still exist please delete first!",WEBTITLE
          CALL      WEBERR00
          MOVE      ONE,EXIT
          GOTO      ALLDEP99
.
ALLDEP99  RETURN
.------------------------------------------------------------
. Process Health  Services
.------------------------------------------------------------
ALLSER00  RESET     UPDTTYPE 
          MATCH     SP1,UPDTTYPE
          GOTO      ALLSER50 IF EQUAL
.
          MATCH     "A",UPDTTYPE    * Add formaction
          GOTO      ALLSER10 IF EQUAL
.
          MATCH     "U",UPDTTYPE    * Update formaction
          GOTO      ALLSER20 IF EQUAL
.
          MATCH     "D",UPDTTYPE    * Delete formaction
          GOTO      ALLSER30 IF EQUAL
.
          MATCH     "C",UPDTTYPE    * Copy formaction
          GOTO      ALLSER40 IF EQUAL
.
          GOTO      ALLSER93
.
.         ************ ADD FORMACTION ***********
.
ALLSER10  PACK      KEY3,DEPTCODE,SP70
          CALL      RDALDEP1                      * Read department table
          BRANCH    OVRCD,ALLSER94
          MOVE      ALDEDEPT,DEPARTMN             * Save Department Variable
.
          PACK      KEY9,DEPARTMN,ALSER002,SP70
          CALL      RAALSER1
          COMPARE   ZERO,OVRCD
          GOTO      ALLSER92 IF EQUAL
          CALL      SAVSRV00                     * Move cgi to file variables
           
          PACK      KEY8,CCC,CYY,CMM,CDD
          REP       " 0",KEY8
          MOVE      KEY8,ALSRCDAT                * System date
          CLOCK     TIME,ALSRCTIM                * System time (Var chgd HPS)
          MOVE      USERID,ALSRCUID              * web user id
          MOVE      SP70,ALSRUDAT
          MOVE      SP70,ALSRUTIM
          MOVE      SP70,ALSRUUID
          PACK      KEY9,DEPARTMN,ALSER002,SP70 
          CALL      WRALSER1                     * Writes the data
.
          MOVE      ZERO,EXIT
          GOTO      ALLSER99
.
.         ************ UPDATE FORMACTION **********
.
ALLSER20  PACK      KEY3,DEPTCODE,SP70
          CALL      RDALDEP1                      * Read department table
          BRANCH    OVRCD,ALLSER94
          MOVE      ALDEDEPT,DEPARTMN             * Save Department Variable
. 
          PACK      KEY9,DEPARTMN,ALSER002,SP70
          CALL      RDALSER1
          BRANCH    OVRCD,ALLSER91
          CALL      SAVSRV00                     * Moves cgi to file variables
          PACK      KEY8,CCC,CYY,CMM,CDD
          REP       " 0",KEY8
          MOVE      KEY8,ALSRUDAT                * System date
          CLOCK     TIME,ALSRUTIM                * System time (Var chgd HPS)
          MOVE      USERID,ALSRUUID              * web user id
          PACK      KEY9,DEPARTMN,ALSER002,SP70
          CALL      UPALSER1                     * Updates the data
.
          MOVE      ZERO,EXIT
          GOTO      ALLSER99
.
.         ************ DELETE FORMACTION **********
.
ALLSER30  PACK      KEY3,DEPTCODE,SP70
          CALL      RDALDEP1                      * Read department table
          BRANCH    OVRCD,ALLSER94
          MOVE      ALDEDEPT,DEPARTMN             * Save Department Variable
. 
          PACK      KEY9,DEPARTMN,ALSER002,SP70
          CALL      RDALSER1
          BRANCH    OVRCD,ALLSER91
          CALL      DEALSER1                     * Deletes the data
.
          MOVE      ZERO,EXIT
          GOTO      ALLSER99
.
.         ************ COPY FORMACTION **********
.
ALLSER40  CALL      CSER0000                      * Copy service
.
          MOVE      ZERO,EXIT
          GOTO      ALLSER99
.
.         ************ DISPLAY FORMACTION **********
.
ALLSER50  MATCH     SP70,DEPTCODE
          IF        @EQUAL
            MATCH     "5",TEMPLATE                * Inpatient AH services
            GOTO      ALLSER55 IF EQUAL
            MATCH     "005",TEMPLATE
            GOTO      ALLSER55 IF EQUAL
          ENDIF
.
          PACK      KEY3,DEPTCODE,SP70
          CALL      RDALDEP1                      * Read department table
          BRANCH    OVRCD,ALLSER94
          MOVE      ALDEDEPT,DEPARTMN             * Save Department Variable
.
          PACK      KEY9,DEPARTMN,ALSER002,SP70
          CALL      RDALSER1                      * Read service
          IF        OVRCD=1
            CALL      CLRSRV00                    * Clear all the file variables
          ENDIF
.
ALLSER55  CLEAR     WEBTITLE
          MOVE      "Department Services Maintenance",WEBTITLE
          RESET     WEBTITLE
.
          CALL      WEBHED00   * Create Output File and Write HTML Page Header
          BRANCH    EXIT,ALLSER99
          CALL      WEBBOD00   * Process Web Body
          CALL      WEBEND00   * Process End of HTML File
          MOVE      ONE,EXIT
          GOTO      ALLSER99
.
ALLSER91  MOVE      "Service Code Does Not Exist",WEBTITLE
          CALL      WEBERR00
          MOVE      ONE,EXIT
          GOTO      ALLSER99
.
ALLSER92  MOVE      "Service Code Exists",WEBTITLE
          CALL      WEBERR00
          MOVE      ONE,EXIT
          GOTO      ALLSER99
.
ALLSER93  MOVE      "Invalid Form Action.",WEBTITLE
          CALL      WEBERR00
          MOVE      ONE,EXIT
          GOTO      ALLSER99
.
ALLSER94  MOVE      "Invalid Department Code",WEBTITLE
          CALL      WEBERR00
          MOVE      ONE,EXIT
          GOTO      ALLSER99
.
ALLSER99  RETURN
.
.------------------------------------------------------------
.   Equipment Services
.------------------------------------------------------------
ALLEQU00  RESET     UPDTTYPE
          MATCH     SP1,UPDTTYPE
          GOTO      ALLEQU40 IF EQUAL
.
          MATCH     "A",UPDTTYPE            * Add formaction
          GOTO      ALLEQU10 IF EQUAL
.
          MATCH     "U",UPDTTYPE            * Update formaction
          GOTO      ALLEQU20 IF EQUAL
.
          MATCH     "D",UPDTTYPE            * Delete formaction
          GOTO      ALLEQU30 IF EQUAL
.
          GOTO      ALLEQU90
.
.         ************ ADD FORMACTION ***********
.
ALLEQU10  PACK      KEY3,DEPTCODE,SP70
          CALL      RDALDEP1                * Read department table
          BRANCH    OVRCD,ALLEQU94
          MOVE      ALDEDEPT,DEPARTMN       * Save Department Variable
.
          PACK      KEY10,ALEQU001,SP70
          CALL      RAALEQU1 
          COMPARE   ZERO,OVRCD
          GOTO      ALLEQU91 IF EQUAL
.
          CALL      MVALEQ00                * get the cgi parameters
.
          CALL      CHKF0000                * Check field edits
          BRANCH    EXIT,ALLEQU99
.
          PACK      KEY8,CCC,CYY,CMM,CDD
          REP       " 0",KEY8 
          MOVE      KEY8,ALEQCDAT
          MOVE      KEY8,ALEQSDAT           * Set status date to today
          CLOCK     TIME,ALEQCTIM
          MOVE      USERID,ALEQCUID
.
          PACK      KEY10,ALEQU001,SP70
          CALL      WRALEQU1 
.
          MOVE      ZERO,EXIT
          GOTO      ALLEQU99
.
.         ************ UPDATE FORMACTION **********
.
ALLEQU20  PACK      KEY3,DEPTCODE,SP70
          CALL      RDALDEP1                * Read department table
          BRANCH    OVRCD,ALLEQU94
          MOVE      ALDEDEPT,DEPARTMN       * Save Department Variable
. 
          PACK      KEY10,ALEQU001,SP70
          CALL      RDALEQU1  
          BRANCH    OVRCD,ALLEQU92          * record does not exist
.
          CALL      MVALEQ00                * get cgi params
.
          CALL      CHKF0000                * Check field edits
          BRANCH    EXIT,ALLEQU99
.
          PACK      KEY8,CCC,CYY,CMM,CDD                                       
          REP       " 0",KEY8
          MOVE      KEY8,ALEQUDAT
          CLOCK     TIME,ALEQUTIM
          MOVE      USERID,ALEQUUID
.
          PACK      KEY10,ALEQU001,SP70
          CALL      UPALEQU1                * update the record
.
          MOVE      ZERO,EXIT
          GOTO      ALLEQU99
.
.         ************ INACTIVATE/DELETE FORMACTION **********
.         The record status will be set to inactive.
.
ALLEQU30  PACK      KEY3,DEPTCODE,SP70
          CALL      RDALDEP1                * Read department table
          BRANCH    OVRCD,ALLEQU94
          MOVE      ALDEDEPT,DEPARTMN       * Save Department Variable
. 
          PACK      KEY10,ALEQU001,SP70
          CALL      RDALEQU1 
          BRANCH    OVRCD,ALLEQU92          * record does not exist
.
          CALL      MVALEQ00                * get cgi params
.
          PACK      KEY8,CCC,CYY,CMM,CDD
          REP       " 0",KEY8
          MOVE      KEY8,ALEQUDAT
          CLOCK     TIME,ALEQUTIM
          MOVE      USERID,ALEQUUID
.
          PACK      KEY10,ALEQU001,SP70
          CALL      UPALEQU1                * update the record
.
          MOVE      ZERO,EXIT
          GOTO      ALLEQU99
.
.         ************ DISPLAY FORMACTION **********
.
ALLEQU40  PACK      KEY3,DEPTCODE,SP70
          CALL      RDALDEP1                      * Read department table
          BRANCH    OVRCD,ALLEQU94
          MOVE      ALDEDEPT,DEPARTMN             * Save Department Variable
.
          PACK      KEY10,ALEQU001,SP70
          CALL      RDALEQU1                      * Read Equipment 
          IF        OVRCD=1
            CALL      CLALLEQU                    * Clear all the file variables
          ENDIF
.
          CLEAR     WEBTITLE
          MOVE      "Department Equipment Maintenance",WEBTITLE
          RESET     WEBTITLE
.
          CALL      WEBHED00   * Create Output File and Write HTML Page Header
          BRANCH    EXIT,ALLEQU99
          CALL      WEBBOD00   * Process Web Body
          CALL      WEBEND00   * Process End of HTML File
          MOVE      ONE,EXIT
          GOTO      ALLEQU99
.
ALLEQU90  MOVE      "Invalid Form Action.",WEBTITLE
          CALL      WEBERR00
          MOVE      ONE,EXIT
          GOTO      ALLEQU99
.
ALLEQU91  MOVE      "Equipment Code Already Exists.",WEBTITLE
          CALL      WEBERR00
          MOVE      ONE,EXIT
          GOTO      ALLEQU99 
.
ALLEQU92  MOVE      "Equipment Code does not Exist.",WEBTITLE
          CALL      WEBERR00
          MOVE      ONE,EXIT
          GOTO      ALLEQU99 
.
ALLEQU94  MOVE      "Invalid Department Code",WEBTITLE
          CALL      WEBERR00
          MOVE      ONE,EXIT
          GOTO      ALLEQU99 
.
ALLEQU99  RETURN
.
.------------------------------------------------------------
.   Check field edits on Add/Update equipment
.------------------------------------------------------------
CHKF0000  MOVE      ZERO,EXIT
.
          MATCH     SP70,ALEQPDAT           * No purchase date but re-cond date 
          IF        @EQUAL
            MATCH    SP70,ALEQRDAT
            GOTO     CHKF9000 IF NOT EQUAL
          ENDIF
.
          MATCH     SP70,ALEQRDAT           * There is no re-cond date
          GOTO      CHKF9999 IF EQUAL
.
          MATCH     ALEQPDAT,ALEQRDAT       * re-cond < purchase date
          GOTO      CHKF9100 IF LESS
. 
          MOVE      ZERO,EXIT
          GOTO      CHKF9999
.
CHKF9000  CLEAR     WEBTITLE
          APPEND    "Purchase date is a required field for ",WEBTITLE
          APPEND    "re-condition date.",WEBTITLE
          RESET     WEBTITLE
          CALL      WEBERR00
          MOVE      ONE,EXIT
          GOTO      CHKF9999
.
CHKF9100  CLEAR     WEBTITLE
          APPEND    "Re-Condition date must be after the ",WEBTITLE
          APPEND    "purchase date.",WEBTITLE
          RESET     WEBTITLE
          CALL      WEBERR00
          MOVE      ONE,EXIT
          GOTO      CHKF9999
.
CHKF9999  RETURN
.
.------------------------------------------------------------
.   Template Services
.------------------------------------------------------------
ALLTEM00  RESET     UPDTTYPE 
          MATCH     SP1,UPDTTYPE
          GOTO      ALLTEM50 IF EQUAL
.
          MATCH     "A",UPDTTYPE    * Add formaction
          GOTO      ALLTEM10 IF EQUAL
.
          MATCH     "U",UPDTTYPE    * Update formaction
          GOTO      ALLTEM20 IF EQUAL
.
          MATCH     "D",UPDTTYPE    * Delete formaction
          GOTO      ALLTEM30 IF EQUAL
.
          MATCH     "C",UPDTTYPE    * Copy formaction
          GOTO      ALLTEM40 IF EQUAL            
.
          GOTO      ALLTEM93
.
.         ************ ADD FORMACTION ***********
.
ALLTEM10  PACK      KEY3,DEPTCODE,SP70
          CALL      RDALDEP1                      * Read department table
          BRANCH    OVRCD,ALLTEM94
          MOVE      ALDEDEPT,DEPARTMN             * Save Department Variable
. 
          PACK      KEY16,DEPARTMN,ALTMP002,ALTMP003,ALTMP004,SP70
          CALL      RAALTMP1
          COMPARE   ZERO,OVRCD
          GOTO      ALLTEM92 IF EQUAL
          CALL      SAVTEM00                     * Move cgi to file variables
           
          PACK      KEY8,CCC,CYY,CMM,CDD
          REP       " 0",KEY8
          MOVE      KEY8,ALTMCDAT                * System date
          CLOCK     TIME,ALTMCTIM                * System time (Var chgd HPS)
          MOVE      USERID,ALTMCUID              * web user id
          MOVE      SP70,ALTMUDAT
          MOVE      SP70,ALTMUTIM
          MOVE      SP70,ALTMUUID
          MOVE      ZERO,ALTMTYRC                * alldepaf record type
          PACK      KEY16,DEPARTMN,ALTMP002,ALTMP003,ALTMP004,SP70 
          CALL      WRALTMP1                     * Writes the data
.
          MOVE      ZERO,EXIT
          GOTO      ALLTEM99
.
.         ************ UPDATE FORMACTION **********
.
ALLTEM20  PACK      KEY3,DEPTCODE,SP70
          CALL      RDALDEP1                      * Read department table
          BRANCH    OVRCD,ALLTEM94
          MOVE      ALDEDEPT,DEPARTMN             * Save Department Variable
. 
          PACK      KEY16,DEPARTMN,ALTMP002,ALTMP003,ALTMP004,SP70 
          CALL      RDALTMP1
          BRANCH    OVRCD,ALLTEM91
          CALL      SAVTEM00                     * Moves cgi to file variables
          PACK      KEY8,CCC,CYY,CMM,CDD
          REP       " 0",KEY8
          MOVE      KEY8,ALTMUDAT                * System date
          CLOCK     TIME,ALTMUTIM                * System time (Var chgd HPS) 
          MOVE      USERID,ALTMUUID              * web user id
          PACK      KEY16,DEPARTMN,ALTMP002,ALTMP003,ALTMP004,SP70
          CALL      UPALTMP1                     * Updates the data
.
          MOVE      ZERO,EXIT
          GOTO      ALLTEM99
.
.         ************ DELETE FORMACTION **********
.
ALLTEM30  PACK      KEY3,DEPTCODE,SP70
          CALL      RDALDEP1                      * Read department table
          BRANCH    OVRCD,ALLTEM94
          MOVE      ALDEDEPT,DEPARTMN             * Save Department Variable
. 
          PACK      KEY16,DEPARTMN,ALTMP002,ALTMP003,ALTMP004,SP70
          CALL      RDALTMP1
          BRANCH    OVRCD,ALLTEM91
          CALL      DEALTMP1                     * Deletes the data
          MOVE      ZERO,EXIT
          GOTO      ALLTEM99
.
.         ************ COPY FORMACTION **********
.         
ALLTEM40  CALL      CTEM0000                      * Copy diagnosis
.         
          MOVE      ZERO,EXIT
          GOTO      ALLDIG99   
.         
.
.         ************ DISPLAY FORMACTION **********
.
ALLTEM50  PACK      KEY3,DEPTCODE,SP70
          CALL      RDALDEP1                      * Read department table
          BRANCH    OVRCD,ALLTEM94
          MOVE      ALDEDEPT,DEPARTMN             * Save Department Variable
. 
          PACK      KEY16,DEPARTMN,ALTMP002,ALTMP003,ALTMP004,SP70 
.          PACK      KEY16,DEPARTMN,SP70 
          CALL      RDALTMP1                      * Read service
          IF        OVRCD=1
            CALL      CLRTEM00                    * Clear all the file variables
          ENDIF
.
          CLEAR     WEBTITLE
          MOVE      "Template Services Maintenance",WEBTITLE
          RESET     WEBTITLE
.
          CALL      WEBHED00   * Create Output File and Write HTML Page Header
          BRANCH    EXIT,ALLTEM99
          CALL      WEBBOD00   * Process Web Body
          CALL      WEBEND00   * Process End of HTML File
          MOVE      ONE,EXIT
          GOTO      ALLTEM99
.
ALLTEM91  MOVE      "Map from Server/Report/Template Does Not Exist",WEBTITLE
          CALL      WEBERR00
          MOVE      ONE,EXIT
          GOTO      ALLTEM99
.
ALLTEM92  MOVE      "Template already mapped to some other Template.",WEBTITLE
          CALL      WEBERR00
          MOVE      ONE,EXIT
          GOTO      ALLTEM99
.
ALLTEM93  MOVE      "Invalid Form Action.",WEBTITLE
          CALL      WEBERR00
          MOVE      ONE,EXIT
          GOTO      ALLTEM99
.
ALLTEM94  MOVE      "Invalid Department Code",WEBTITLE
          CALL      WEBERR00
          MOVE      ONE,EXIT
          GOTO      ALLTEM99
.
ALLTEM99  RETURN
.
.------------------------------------------------------------
. Copy template details to this department
.------------------------------------------------------------
CTEM0000  PACK      KEY16,COPYDEPT,SP70
          CALL      RSALTMP1
CTEM1000  CALL      RKALTMP1
          BRANCH    OVRCD,CTEM9999
.
          MATCH     COPYDEPT,ALTMDEPT
          GOTO      CTEM9999 IF NOT EQUAL
.
          PACK      SAVKEY16,ALTMDEPT,ALTMMPSV,ALTMMPRP,ALTMMPTP,SP70
.
          MOVE      DEPTCODE,ALTMDEPT
.
          PACK      KEY16,ALTMDEPT,ALTMMPSV,ALTMMPRP,ALTMMPTP,SP70
          CALL      RAALTMP1
          IF        OVRCD=1
            CALL      WRALTMP1
          ENDIF
.
          MOVE      SAVKEY16,KEY16
          CALL      RDALTMP1
.
          GOTO      CTEM1000
.
CTEM9999  RETURN
.
.------------------------------------------------------------
. Billing  Services
.------------------------------------------------------------
ALLBIL00  RESET     UPDTTYPE 
          MATCH     SP1,UPDTTYPE
          GOTO      ALLBIL40 IF EQUAL
.
          MATCH     "A",UPDTTYPE    * Add formaction
          GOTO      ALLBIL10 IF EQUAL
.
          MATCH     "U",UPDTTYPE    * Update formaction
          GOTO      ALLBIL20 IF EQUAL
.
          MATCH     "D",UPDTTYPE    * Delete formaction
          GOTO      ALLBIL30 IF EQUAL
.
          GOTO      ALLBIL93
.
.         ************ ADD FORMACTION ***********
.
ALLBIL10  PACK      KEY3,ALBIL001,SP70
          CALL      RDALDEP1                      * Read department table
          BRANCH    OVRCD,ALLBIL94
          MOVE      ALDEDEPT,DEPARTMN             * Save Department Variable
. 
          PACK      KEY16,DEPARTMN,ALBIL002,ALBIL003,ALBIL004,SP70
          CALL      RAALBIL1
          COMPARE   ZERO,OVRCD
          GOTO      ALLBIL92 IF EQUAL
          CALL      SAVBIL00                     * Move cgi to file variables
           
          PACK      KEY8,CCC,CYY,CMM,CDD
          REP       " 0",KEY8
          MOVE      KEY8,ALBICDAT                * System date
          CLOCK     TIME,ALBICTIM                * System time (Var chgd HPS)
          MOVE      USERID,ALBICUIT              * web user id
          MOVE      SP70,ALBIUDAT
          MOVE      SP70,ALBIUTIM
          MOVE      SP70,ALBIUUID
          PACK      KEY16,DEPARTMN,ALBIL002,ALBIL003,ALBIL004,SP70
          CALL      WRALBIL1                     * Writes the data
.
          MOVE      ZERO,EXIT
          GOTO      ALLBIL99
.
.         ************ UPDATE FORMACTION **********
.
ALLBIL20  PACK      KEY3,BILLKEYS,SP70
          CALL      RDALDEP1                      * Read department table
          BRANCH    OVRCD,ALLBIL94
. 
          PACK      KEY16,BILLKEYS,SP70 
          CALL      RDALBIL1
          BRANCH    OVRCD,ALLBIL91
.
          MOVE      ALBIL005,ALBIITEM            * cgi para to file var
          PACK      KEY8,CCC,CYY,CMM,CDD
          REP       " 0",KEY8
          MOVE      KEY8,ALBIUDAT                * date updated
          CLOCK     TIME,ALBIUTIM                * time updated
          MOVE      USERID,ALBIUUID              * web user id updated
          CALL      UPALBIL1                     * Updates the data
.
          MOVE      ZERO,EXIT
          GOTO      ALLBIL99
.
.         ************ DELETE FORMACTION **********
.
ALLBIL30  PACK      KEY16,BILLKEYS,SP70 
          CALL      RDALBIL1
          BRANCH    OVRCD,ALLBIL91
.
          CALL      DEALBIL1                     * Deletes the data
          MOVE      ZERO,EXIT
          GOTO      ALLBIL99
.
.         ************ DISPLAY FORMACTION **********
.
ALLBIL40  PACK      KEY3,BILLKEYS,SP70
          CALL      RDALDEP1                      * Read department table
          MOVE      ALDEDEPT,DEPARTMN             * Save Department Variable
. 
          PACK      KEY16,BILLKEYS,SP70 
          CALL      RDALBIL1                      * Read service
          IF        OVRCD=1
            CALL      CLRBIL00                    * Clear all the file variables
          ENDIF
.
          CLEAR     WEBTITLE
          MOVE      "Billing Maintenance",WEBTITLE
          RESET     WEBTITLE
.
          CALL      WEBHED00   * Create Output File and Write HTML Page Header
          BRANCH    EXIT,ALLBIL99
          CALL      WEBBOD00   * Process Web Body
          CALL      WEBEND00   * Process End of HTML File
          MOVE      ONE,EXIT
          GOTO      ALLBIL99
.
ALLBIL91  MOVE      "Department Code Does Not Exist",WEBTITLE
          CALL      WEBERR00
          MOVE      ONE,EXIT
          GOTO      ALLBIL99
.
ALLBIL92  MOVE      "Department/Compensation/Service type Code Exists",WEBTITLE
          CALL      WEBERR00
          MOVE      ONE,EXIT
          GOTO      ALLBIL99
.
ALLBIL93  MOVE      "Invalid Form Action.",WEBTITLE
          CALL      WEBERR00
          MOVE      ONE,EXIT
          GOTO      ALLBIL99
.
ALLBIL94  MOVE      "Invalid Department Code",WEBTITLE
          CALL      WEBERR00
          MOVE      ONE,EXIT
          GOTO      ALLBIL99
.
ALLBIL99  RETURN
.------------------------------------------------------------
. Allied Health  Services - Option 1
.------------------------------------------------------------
ALSR0000  BRANCH    FLDITMNO,ALSR0100,ALSR0200,ALSR0300,ALSR0400,ALSR0500:
                             ALSR0600,ALSR0700,ALSR0800,ALSR0900,ALSR1000:
                             ALSR1100,ALSR1200,ALSR1300,ALSR1400,ALSR1500:
                             ALSR1600,ALSR1700,ALSR1800,ALSR1900,ALSR2000:
                             ALSR2100,ALSR2200
.
          WRITE     HTMLFILE;"Invalid IBA Tag";
          GOTO      ALSR9999
.
ALSR0100  MOVE      "CG",CATEGORY           * Department Code
          MOVE      DEPARTMN,CODE
          CALL      CODITM00 
          GOTO      ALSR9999
.
ALSR0200  WRITE     HTMLFILE;ALSRSERV;
          GOTO      ALSR9999
.
ALSR0300  WRITE     HTMLFILE;ALSRDESC;
          GOTO      ALSR9999
.
ALSR0400  WRITE     HTMLFILE;ALSRLENG;
          GOTO      ALSR9999
.
ALSR0500  WRITE     HTMLFILE;ALSRVACS;
          GOTO      ALSR9999
.
ALSR0600  WRITE     HTMLFILE;ALSRACTV;
          GOTO      ALSR9999
.
ALSR0700  WRITE     HTMLFILE;ALSRCDAT;
          GOTO      ALSR9999
.
ALSR0800  WRITE     HTMLFILE;ALSRCTIM;
          GOTO      ALSR9999
.
ALSR0900  WRITE     HTMLFILE;ALSRCUID;
          GOTO      ALSR9999
.
ALSR1000  WRITE     HTMLFILE;ALSRUDAT;
          GOTO      ALSR9999
.
ALSR1100  WRITE     HTMLFILE;ALSRUTIM;
          GOTO      ALSR9999
.
ALSR1200  WRITE     HTMLFILE;ALSRUUID;
          GOTO      ALSR9999
.
ALSR1300  CALL      SRTAB000                * Table of Allied Health Services
          GOTO      ALSR9999
.
ALSR1400  CALL      NEXTGS00                * Next set of Services       
          GOTO      ALSR9999
.
ALSR1500  CALL      PREVGS00                * Previous set of Services      
          GOTO      ALSR9999
.
ALSR1600  WRITE     HTMLFILE;ALSRGROU;
          GOTO      ALSR9999
.
ALSR1700  WRITE     HTMLFILE;ALSRNURA;
          GOTO      ALSR9999
.
ALSR1800  MOVE      ZERO,INCLDINP           * Exclude IP AH Departents
          CALL      DEPSEL00                * Department Selection List
          GOTO      ALSR9999
.
ALSR1900  WRITE     HTMLFILE;ALSRMHDP;
          GOTO      ALSR9999
.
ALSR2000  MOVE      "s ",CATEGORY           * Department Code
          MOVE      ALSRSPEC,CODE
          CALL      CODITM00 
          GOTO      ALSR9999
.
ALSR2100  CALL      IDEP0000                * IP Departments
          GOTO      ALSR9999
.
ALSR2200  MOVE      ONE,INCLDINP            * Include IP AH Departents
          CALL      DEPSEL00                * Department Selection List
          GOTO      ALSR9999
.
ALSR9999  RETURN
.
.------------------------------------------------------------
. Allied Health  Services - Option 1 Department Details
.------------------------------------------------------------
ALDP0000  BRANCH    FLDITMNO,ALDP0001,ALDP0002,ALDP0003,ALDP0004,ALDP0005:
                             ALDP0006,ALDP0007,ALDP0008,ALDP0009,ALDP0010:
                             ALDP0011,ALDP0012,ALDP0013,ALDP0014,ALDP0015:
                             ALDP0016,ALDP0017,ALDP0018,ALDP0019,ALDP0020:
                             ALDP0021,ALDP0022,ALDP0023,ALDP0024,ALDP0025:
                             ALDP0026,ALDP0027,ALDP0028,ALDP0029,ALDP0030:
                             ALDP0031,ALDP0032,ALDP0033,ALDP0034,ALDP0035:
                             ALDP0036,ALDP0037,ALDP0038,ALDP0039,ALDP0040:
                             ALDP0041,ALDP0042,ALDP0043,ALDP0044,ALDP0045:
                             ALDP0046,ALDP0047,ALDP0048,ALDP0049,ALDP0050:
                             ALDP0051,ALDP0052,ALDP0053,ALDP0054,ALDP0550:
                             ALDP0560,ALDP0570,ALDP0580,ALDP0590,ALDP0600:
                             ALDP0610,ALDP0620,ALDP0630,ALDP0640,ALDP0650:
                             ALDP0660,ALDP0670
.
          WRITE     HTMLFILE;"Invalid IBA Tag";
          GOTO      ALDP9999
.
ALDP0001  MOVE      "CG",CATEGORY           * Department Code
          MOVE      ALDEDEPT,CODE
          CALL      CODITM00
          GOTO      ALDP9999
.
ALDP0002  WRITE     HTMLFILE;ALDEREFE;      * Using Referrals
          GOTO      ALDP9999
.
ALDP0003  WRITE     HTMLFILE;ALDESECU;       * Security option
          GOTO      ALDP9999
.
ALDP0004  WRITE     HTMLFILE;ALDEVACS;      * VACS Reporting 
          GOTO      ALDP9999
.
ALDP0005  WRITE     HTMLFILE;ALDEBILL;      * Billing 
          GOTO      ALDP9999
.
ALDP0006  CALL      MPRSEL00                * Medical Practice
          GOTO      ALDP9999   
.
ALDP0007  WRITE     HTMLFILE;ALDEUR1;       * User def. Ref. 1 
          GOTO      ALDP9999   
.
ALDP0008  WRITE     HTMLFILE;ALDEUR2;
          GOTO      ALDP9999   
.
ALDP0009  WRITE     HTMLFILE;ALDEUD1;
          GOTO      ALDP9999   
.
ALDP0010  WRITE     HTMLFILE;ALDEUD2;
          GOTO      ALDP9999   
.
ALDP0011  WRITE     HTMLFILE;ALDEUY1;
          GOTO      ALDP9999   
.
ALDP0012  WRITE     HTMLFILE;ALDEUY2;
          GOTO      ALDP9999   
.
ALDP0013  MOVE      "UA",CATEGORY           * User define code1 
          MOVE      ALDEUC1,CODE
          CALL      CODITM00 
          GOTO      ALDP9999   
.
ALDP0014  MOVE      "UB",CATEGORY           * User define code2 
          MOVE      ALDEUC2,CODE                                               
          CALL      CODITM00 
          GOTO      ALDP9999   
.
ALDP0015  WRITE     HTMLFILE;ALDECDAT;
          GOTO      ALDP9999   
.
ALDP0016  WRITE     HTMLFILE;ALDECTIM;
          GOTO      ALDP9999   
.
ALDP0017  WRITE     HTMLFILE;ALDECUID;
          GOTO      ALDP9999   
.
ALDP0018  WRITE     HTMLFILE;ALDEUDAT;
          GOTO      ALDP9999   
.
ALDP0019  WRITE     HTMLFILE;ALDEUTIM;
          GOTO      ALDP9999   
.
ALDP0020  WRITE     HTMLFILE;ALDEUUID;
          GOTO      ALDP9999   
.
ALDP0021  CALL      DPTAB000                * Table of Dep. Codes 
          GOTO      ALDP9999   
.
ALDP0022  CALL      NEXTGR00 
          GOTO      ALDP9999   
.
ALDP0023  CALL      PREVGR00 
          GOTO      ALDP9999   
.
ALDP0024  CALL      EQTUP000                * Equipment Codes with UpdateParent
          GOTO      ALDP9999   
.
ALDP0025  MOVE      ZERO,INCLDINP           * Exclude IP AH Departents
          CALL      DEPSEL00                * Department Selection List
          GOTO      ALDP9999   
.
ALDP0026  CALL      HOSSEL00                * Hospital Code
          GOTO      ALDP9999   
.
ALDP0027  WRITE     HTMLFILE;IBCNMHOS;
          GOTO      ALDP9999   
.
ALDP0028  WRITE     HTMLFILE;ALDEACTV;
          GOTO      ALDP9999   
.
ALDP0029  WRITE     HTMLFILE;ALDESREQ;
          GOTO      ALDP9999   
.
ALDP0030  WRITE     HTMLFILE;ALDECSEP;
          GOTO      ALDP9999   
.
ALDP0031  WRITE     HTMLFILE;FILTACTV;
          GOTO      ALDP9999   
.
ALDP0032  MOVE      "lF",CATEGORY           * Episode/Program stream
          MOVE      ALDEPRGS,CODE
          CALL      CODITM00 
          GOTO      ALDP9999   
.
ALDP0033  WRITE     HTMLFILE;ALDEPENC;      * Allow Encounters on Primary Ref
          GOTO      ALDP9999   
.
ALDP0034  PACK      KEY12,DEPTCODE,SP70
          CALL      RSALPRR1
          CALL      RKALPRR1
          BRANCH    OVRCD,ALDP9999
.
          MATCH     DEPTCODE,ALPRDEPT
          GOTO      ALDP9999 IF NOT EQUAL
.
          WRITE     HTMLFILE;ONE;           * Problems exist for department
          GOTO      ALDP9999   
.
ALDP0035  PACK      KEY12,DEPTCODE,SP70
          CALL      RSALDIA1
          CALL      RKALDIA1
          BRANCH    OVRCD,ALDP9999
.
          MATCH     DEPTCODE,ALDIDEPT
          GOTO      ALDP9999 IF NOT EQUAL
.
          WRITE     HTMLFILE;ONE;           * Diagnosis exist for department  
          GOTO      ALDP9999   
.
ALDP0036  PACK      KEY9,DEPTCODE,SP70
          CALL      RSALSER1
          CALL      RKALSER1
          BRANCH    OVRCD,ALDP9999
.
          MATCH     DEPTCODE,ALSRDEPT
          GOTO      ALDP9999 IF NOT EQUAL
.
          WRITE     HTMLFILE;ONE;           * Service exist for department
          GOTO      ALDP9999   
.
ALDP0037  PACK      KEY13,DEPTCODE,SP70
          CALL      RSALEQU3
          CALL      RKALEQU3
          BRANCH    OVRCD,ALDP9999
.
          MATCH     DEPTCODE,ALEQDEPT
          GOTO      ALDP9999 IF NOT EQUAL
.
          WRITE     HTMLFILE;ONE;           * Equipment exist for department
          GOTO      ALDP9999   
.
ALDP0038  PACK      KEY16,DEPTCODE,SP70
          CALL      RSALTMP1
          CALL      RKALTMP1
          BRANCH    OVRCD,ALDP9999
.
          MATCH     DEPTCODE,ALTMDEPT
          GOTO      ALDP9999 IF NOT EQUAL
.
          WRITE     HTMLFILE;ONE;           * Templates exist for department
          GOTO      ALDP9999   
.
ALDP0039  PACK      KEY3,DEPTCODE,SP70
          CALL      RDALDLL1
          BRANCH    OVRCD,ALDP9999
.
          PACK      KEY20,ALDLRACP,ALDLRACR,ALDLURAP,ALDLURAR,ALDLRPAT:
                          ALDLRREF,ALDLPLAB,SP70
          MATCH     SP70,KEY20
          GOTO      ALDP9999 IF EQUAL
.
          WRITE     HTMLFILE;ONE;           * letters exist for department
          GOTO      ALDP9999   
.
ALDP0040  WRITE     HTMLFILE;ALDEVECC;
          GOTO      ALDP9999
.
ALDP0041  WRITE     HTMLFILE;ALDEUERF;
          GOTO      ALDP9999
.
ALDP0042  WRITE     HTMLFILE;ALDEURAD;
          GOTO      ALDP9999
.
ALDP0043  WRITE     HTMLFILE;ALDEUASS;
          GOTO      ALDP9999
.
ALDP0044  WRITE     HTMLFILE;ALDEURAP;
          GOTO      ALDP9999
.
ALDP0045  WRITE     HTMLFILE;ALDEDLAS;
          GOTO      ALDP9999
.
ALDP0046  WRITE     HTMLFILE;ALDEDCLI;
          GOTO      ALDP9999
.
ALDP0047  WRITE     HTMLFILE;ALDEDRAA;
          GOTO      ALDP9999
.
ALDP0048  WRITE     HTMLFILE;ALDEDLET;
          GOTO      ALDP9999
.
ALDP0049  WRITE     HTMLFILE;ALDEUEME;
          GOTO      ALDP9999
.
ALDP0050  WRITE     HTMLFILE;ALDEUEIN;
          GOTO      ALDP9999
.
ALDP0051  WRITE     HTMLFILE;ALDEUESU;
          GOTO      ALDP9999
.
ALDP0052  PACK      KEY13,DEPTCODE,SP70
          CALL      RSALVMP1
          CALL      RKALVMP1
          BRANCH    OVRCD,ALDP9999
.
          MATCH     DEPTCODE,ALVMDEPT
          GOTO      ALDP9999 IF NOT EQUAL
.
          WRITE     HTMLFILE;ONE;           * VINAH mapping exists    
          GOTO      ALDP9999
.
ALDP0053  CALL      EQTSEL00
          GOTO      ALDP9999
.
ALDP0054  WRITE     HTMLFILE;ALDEUAHP;
          GOTO      ALDP9999
.
ALDP0550  UNPACK    DIM127,D1,KEY1,DIM127    * Outpatient Site
          MOVE      ZERO,F1
          MOVE      KEY1,F1
          BRANCH    F1,ALDP0552,ALDP0554
.
          PACK      KEY6,ALDESITE,SP70
          CALL      RDSITA1                  * Read Site Code File
          BRANCH    OVRCD,ALDP9999
.
          WRITE     HTMLFILE;OSTDESC;        * Descprition
          GOTO      ALDP9999
.
ALDP0552  WRITE     HTMLFILE;ALDESITE;
          GOTO      ALDP9999
.
ALDP0554  MOVE      ALDESITE,SITECODE
          CALL      SLSITE00                 * Options
          GOTO      ALDP9999
.
ALDP0560  WRITE     HTMLFILE;ALDECTYP;
          GOTO      ALDP9999
.
ALDP0570  WRITE     HTMLFILE;ALDEAONE;
          GOTO      ALDP9999
.
ALDP0580  WRITE     HTMLFILE;ALDEUTRS;
          GOTO      ALDP9999
.
ALDP0590  WRITE     HTMLFILE;ALDEUPRT;
          GOTO      ALDP9999
.
ALDP0600  CALL      ADEPSL00                * All department selection list
          GOTO      ALDP9999
.
ALDP0610  PACK      KEY12,DEPTCODE,SP70
          CALL      RSALINC1
          CALL      RKALINC1
          BRANCH    OVRCD,ALDP9999
.
          MATCH     DEPTCODE,ALINDEPT
          GOTO      ALDP9999 IF NOT EQUAL
.
          WRITE     HTMLFILE;ONE;           * Interventions exists
          GOTO      ALDP9999
.
ALDP0620  PACK      KEY3,DEPTCODE,SP70
          CALL      RDALDSP1
          BRANCH    OVRCD,ALDP9999
.
          WRITE     HTMLFILE;ONE;           * Categories exists
          GOTO      ALDP9999
.
ALDP0630  PACK      KEY13,DEPTCODE,SP70
          CALL      RSALATS1
          CALL      RKALATS1
          BRANCH    OVRCD,ALDP9999
.
          MATCH     DEPTCODE,ALATDEPT
          GOTO      ALDP9999 IF NOT EQUAL
.
          WRITE     HTMLFILE;ONE;           * Assessments exists
          GOTO      ALDP9999
.
ALDP0640  PACK      KEY8,DEPTCODE,catgb,SP70
          CALL      RSALCCT1
          CALL      RKALCCT1
          BRANCH    OVRCD,ALDP9999
.
          MATCH     DEPTCODE,ALCCDEPT
          GOTO      ALDP9999 IF NOT EQUAL
.
          MATCH     catgb,ALCCTYPE
          GOTO      ALDP9999 IF NOT EQUAL
.
          WRITE     HTMLFILE;ONE;           * Contracts exists
          GOTO      ALDP9999
.
ALDP0650  PACK      KEY8,DEPTCODE,catgb,SP70
          CALL      RSALCCT1
          CALL      RKALCCT1
          BRANCH    OVRCD,ALDP9999
.
          MATCH     DEPTCODE,ALCCDEPT
          GOTO      ALDP9999 IF NOT EQUAL
.
          MATCH     catgb,ALCCTYPE
          GOTO      ALDP9999 IF NOT EQUAL
.
          WRITE     HTMLFILE;ONE;           * Contracts exists
          GOTO      ALDP9999
.
.         Display value for do not copy linked referrals
ALDP0660  WRITE     HTMLFILE;ALDEDACP;
          GOTO      ALDP9999
.
ALDP0670  PACK      KEY8,DEPTCODE,CATZX,SP70
          CALL      RSALCCT1
ALDP0672  CALL      RKALCCT1
          BRANCH    OVRCD,ALDP9999
.
          MATCH     DEPTCODE,ALCCDEPT
          GOTO      ALDP9999 IF NOT EQUAL
.
          MATCH     CATZX,ALCCTYPE
          GOTO      ALDP9999 IF NOT EQUAL
.
          WRITE     HTMLFILE;ONE;           * Contracts exists
          GOTO      ALDP9999
. 
ALDP9999  RETURN
.------------------------------------------------------------
. ALLIED Health  Services - Option 4 Template Details 
.------------------------------------------------------------
ALDG0000  BRANCH    FLDITMNO,ALDG0001,ALDG0002,ALDG0003,ALDG0004:
                             ALDG0005,ALDG0006,ALDG0007,ALDG0008:
                             ALDG0009,ALDG0010,ALDG0011,ALDG0012:
                             ALDG0013,ALDG0014,ALDG0015,ALDG0016:
                             ALDG0017,ALDG0018,ALDG0019,ALDG0020:
                             ALDG0021,ALDG0022
.
          WRITE     HTMLFILE;"Invalid IBA Tag";
          GOTO      ALDG9999 
.
ALDG0001  MOVE      "CG",CATEGORY           * Department Code
          MOVE      DEPARTMN,CODE
          CALL      CODITM00
          GOTO      ALDG9999 
.
ALDG0002  WRITE     HTMLFILE;ALDIDIAG;     
          GOTO      ALDG9999 
.
ALDG0003  WRITE     HTMLFILE;ALDIDESC;     
          GOTO      ALDG9999
.
ALDG0004  WRITE     HTMLFILE;ALDIICD;     
          GOTO      ALDG9999
.
ALDG0005  WRITE     HTMLFILE;ALDIACTV;     
          GOTO      ALDG9999
.
ALDG0006  WRITE     HTMLFILE;ALDICDAT;     
          GOTO      ALDG9999
.
ALDG0007  WRITE     HTMLFILE;ALDICTIM;     
          GOTO      ALDG9999
.
ALDG0008  WRITE     HTMLFILE;ALDICUID;     
          GOTO      ALDG9999  
.
ALDG0009  WRITE     HTMLFILE;ALDIUDAT;     
          GOTO      ALDG9999 
.
ALDG0010  WRITE     HTMLFILE;ALDIUTIM;     
          GOTO      ALDG9999
.
ALDG0011  WRITE     HTMLFILE;ALDIUUID;     
          GOTO      ALDG9999
.
ALDG0012  CALL      DGTAB000   
          GOTO      ALDG9999
.
ALDG0013  CALL      NEXTGD00 
          GOTO      ALDG9999
.
ALDG0014  CALL      PREVGD00
          GOTO      ALDG9999 
.
ALDG0015  MATCH     SP70,ALDIICD
          IF        !@EQUAL
            PACK      KEY9,ALDIICD,SP70
            CALL      RDPTICD1
            IF        OVRCD=1
              MOVE    SP70,DDESC
            ENDIF
            WRITE     HTMLFILE;DDESC;
          ELSE
            MOVE      SP70,DDESC
            WRITE     HTMLFILE;DDESC;
          ENDIF
          GOTO      ALDG9999
.
ALDG0016  WRITE     HTMLFILE;ALDIMHDP;     
          GOTO      ALDG9999
.
ALDG0017  MOVE      ZERO,INCLDINP           * Exclude IP AH Departents
          CALL      DEPSEL00                * Department Selection List
          GOTO      ALDG9999
.
ALDG0018  CALL      ALLDKA00                * Diagnosis keyword search   
          GOTO      ALDG9999
.
ALDG0019  WRITE     HTMLFILE;ALDIMHCP;     
          GOTO      ALDG9999
.
ALDG0020  PACK      MAPTBIND,ALDIDEPT,ALDIDIAG,SP70
          CALL      VMTTAB00           * Clinical Coding System Mappings Table
          GOTO      ALDG9999
.
ALDG0021  WRITE     HTMLFILE;ALDISDAT;
          GOTO      ALDG9999
.
ALDG0022  WRITE     HTMLFILE;ALDIEDAT;
          GOTO      ALDG9999
.
ALDG9999  RETURN
+
.------------------------------------------------------------
. ALLIED Health  Services - Option 18 Template Details
.------------------------------------------------------------
ALIN0000  BRANCH    FLDITMNO,ALIN0001,ALIN0002,ALIN0003,ALIN0004:
                             ALIN0005,ALIN0006,ALIN0007,ALIN0008:
                             ALIN0009,ALIN0010,ALIN0011,ALIN0012:
                             ALIN0013,ALIN0014,ALIN0015
.
          WRITE     HTMLFILE;"Invalid IBA Tag";
          GOTO      ALIN9999
.
ALIN0001  MOVE      "CG",CATEGORY           * Department Code
          MOVE      DEPARTMN,CODE
          CALL      CODITM00
          GOTO      ALIN9999
.
ALIN0002  WRITE     HTMLFILE;ALINCODE;
          GOTO      ALIN9999
.
ALIN0003  WRITE     HTMLFILE;ALINDESC;
          GOTO      ALIN9999
.
ALIN0004  WRITE     HTMLFILE;ALINACTV;
          GOTO      ALIN9999
.
ALIN0005  WRITE     HTMLFILE;ALINCDAT;
          GOTO      ALIN9999
.
ALIN0006  WRITE     HTMLFILE;ALINCTIM;
          GOTO      ALIN9999
.
ALIN0007  WRITE     HTMLFILE;ALINCUID;
          GOTO      ALIN9999
.
ALIN0008  WRITE     HTMLFILE;ALINUDAT;
          GOTO      ALIN9999
.
ALIN0009  WRITE     HTMLFILE;ALINUTIM;
          GOTO      ALIN9999
.
ALIN0010  WRITE     HTMLFILE;ALINUUID;
          GOTO      ALIN9999
.
ALIN0011  CALL      INTAB000
          GOTO      ALIN9999
.
ALIN0012  CALL      NEXTIN00
          GOTO      ALIN9999
.
ALIN0013  CALL      PREVIN00
          GOTO      ALIN9999
.
ALIN0014  MOVE      ZERO,INCLDINP           * Exclude IP AH Departents
          CALL      DEPSEL00                * Department Selection List
          GOTO      ALIN9999
.
ALIN0015  CALL      ALLIKA00                * Diagnosis keyword search
          GOTO      ALIN9999
.
ALIN9999  RETURN
.------------------------------------------------------------
. ALLIED Health  Services - Option 6 Template Details 
.------------------------------------------------------------
ALTP0000  BRANCH    FLDITMNO,ALTP0001,ALTP0002,ALTP0003,ALTP0004:
                             ALTP0005,ALTP0006,ALTP0007,ALTP0008:
                             ALTP0009,ALTP0010,ALTP0011,ALTP0012:
                             ALTP0013,ALTP0014,ALTP0015,ALTP0016
.
          WRITE     HTMLFILE;"Invalid IBA Tag";
          GOTO      ALTP9999
.
ALTP0001  MOVE      "CG",CATEGORY           * Department Code
          MOVE      DEPARTMN,CODE
          CALL      CODITM00
          GOTO      ALTP9999
.
ALTP0002  WRITE     HTMLFILE;ALTMMPSV;     
          GOTO      ALTP9999  
.
ALTP0003  WRITE     HTMLFILE;ALTMMPRP;     
          GOTO      ALTP9999  
.
ALTP0004  WRITE     HTMLFILE;ALTMMPTP;     
          GOTO      ALTP9999  
.
ALTP0005  WRITE     HTMLFILE;ALTMMPTT;     
          GOTO      ALTP9999  
.
ALTP0006  WRITE     HTMLFILE;ALTMDESC;     
          GOTO      ALTP9999  
.
ALTP0007  WRITE     HTMLFILE;ALTMCDAT;     
          GOTO      ALTP9999  
.
ALTP0008  WRITE     HTMLFILE;ALTMCTIM;     
          GOTO      ALTP9999  
.
ALTP0009  WRITE     HTMLFILE;ALTMCUID;     
          GOTO      ALTP9999  
.
ALTP0010  WRITE     HTMLFILE;ALTMUDAT;     
          GOTO      ALTP9999  
.
ALTP0011  WRITE     HTMLFILE;ALTMUTIM;     
          GOTO      ALTP9999  
.
ALTP0012  WRITE     HTMLFILE;ALTMUUID;     
          GOTO      ALTP9999  
.
ALTP0013  CALL      TMTAB000   
          GOTO      ALTP9999  
.
ALTP0014  CALL      NEXTGT00 
          GOTO      ALTP9999  
.
ALTP0015  CALL      PREVGT00 
          GOTO      ALTP9999  
.
ALTP0016  MOVE      ZERO,INCLDINP           * Exclude IP AH Departents
          CALL      DEPSEL00 
          GOTO      ALTP9999  
.
ALTP9999  RETURN
.------------------------------------------------------------
. Allied Health  Services - Option 7 Billing Details
.------------------------------------------------------------
ALBL0000  BRANCH    FLDITMNO,ALBL0100,ALBL0200,ALBL0300,ALBL0400 
          WRITE     HTMLFILE;"Invalid IBA Tag";  
          GOTO      ALBL9999
.
ALBL0100  CALL      BITAB000  
          GOTO      ALBL9999 
.
ALBL0200  CALL      NEXTGB00
          GOTO      ALBL9999 
.
ALBL0300  CALL      PREVGB00
          GOTO      ALBL9999 
.
ALBL0400  PACK      KEY16,ALBIDEPT,ALBICOMP,ALBISERV,ALBITIME,SP70
          WRITE     HTMLFILE;KEY16;
          GOTO      ALBL9999 
.
ALBL9999  RETURN
.------------------------------------------------------------
. Table of Allied Health Department codes : Report 1
.------------------------------------------------------------
DPTAB000  IF        NORECORD=0
            MOVE      PTCNNRTD,NORECORD      * Set Default No Records to Display
          ENDIF
          MOVE      ZERO,RECNUMB
          MOVE      ZERO,DISNUMB
.
          PACK      KEY3,STARTKEY,SP70
          CALL      RSALDEP1     * Position on Startkey
          CALL      RPALDEP1     * Read one back from position
.
DPTAB100  CALL      RKALDEP1     * Read on first Startkey found
          BRANCH    OVRCD,DPTAB900
.
          MATCH     "1",FILTACTV            * Active Only
          IF        @EQUAL
            MATCH     "1",ALDEACTV
            GOTO      DPTAB100 IF EQUAL
          ENDIF
.
          MATCH     "2",FILTACTV            * Inactive Only
          IF        @EQUAL
            MATCH     "1",ALDEACTV
            GOTO      DPTAB100 IF NOT EQUAL
          ENDIF
.
          ADD       ONE,RECNUMB
          IF        STARTNUM>=RECNUMB
            GOTO      DPTAB100
          ENDIF
.
          CALL      DPROW000                * Display Dep.code Row
          ADD       ONE,DISNUMB
          COMPARE   NORECORD,DISNUMB
          GOTO      DPTAB100 IF NOT EQUAL
          GOTO      DPTAB999
.
DPTAB900  CALL      NOMORE00     * Display No More Records Message
.
DPTAB999  RETURN
.------------------------------------------------------------
.  Allied Health Department codes (TABLE ROW)
.------------------------------------------------------------
DPROW000  MATCH     "0",ALDEREFE
          IF        @EQUAL
            MOVE      "No",ALDEPD01
          ELSE
            MOVE      "Yes",ALDEPD01
          ENDIF
.
          MATCH     "0",ALDESECU
          IF        @EQUAL
            MOVE      "Viewable by All Department",ALDEPD02
          ENDIF
.
          MATCH     "1",ALDESECU
          IF        @EQUAL
            MOVE      "Display on Summary Screen Only",ALDEPD02
          ENDIF
.
          MATCH     "2",ALDESECU
          IF        @EQUAL
            MOVE      "User Department is equal to the Referral Department",ALDEPD02
          ENDIF
.
          MATCH     "0",ALDEVACS
          IF        @EQUAL
            MOVE     "No",ALDEPD03
          ELSE
            MOVE     "Yes",ALDEPD03
          ENDIF
.
          MOVE      "CG",CATEGORY
          MOVE      ALDEDEPT,CODE
          CALL      GETCOD00
          MOVE      TDESC,ALDEPD04
. 
          MATCH     "0",ALDEBILL
          IF        @EQUAL
            MOVE     "No",ALDEPD05
          ELSE
            MOVE     "Yes",ALDEPD05
          ENDIF
.
          MATCH     "1",ALDESREQ
          IF        @EQUAL
            MOVE    "Yes",SACRDESC
          ELSE
            MOVE    "No",SACRDESC
          ENDIF
.
          MATCH     "1",ALDEACTV
          IF        @EQUAL
            MOVE    "INACTIVE  ",ACTIDESC
          ELSE
            MOVE    "ACTIVE",ACTIDESC
          ENDIF
.
.          Read pripraaf table to get description

          PACK      KEY6,ALDEPRAC,SP70
          CALL      RDPRPR1
          IF        OVRCD=1
            MOVE      "&nbsp",PRPRDESC
          ENDIF
          MOVE      PRPRDESC,ALDEPD06
.
          WRITE     HTMLFILE;"<tr><td nowrap>":
                             "<img src=../images/MaintenanceIcon.gif ":
                             "class=ListIcon ":
                             "onclick=#"DepartmentLink('",ALDEDEPT,"');#"> ":
                             ALDEDEPT,"</td>":
                             "<td>",ALDEPD04,"</td>":
                             "<td align=center>",ALDEPD01,"</td>":
                             "<td align=center nowrap>",ALDEPD02,"</td>":
                             "<td align=center>",ALDEPD03,"</td>":
                             "<td align=center>",ALDEPD05,"</td>":
                             "<td align=center>",ALDEPD06,"</td>":
                             "<td align=center>",SACRDESC,"</td>":
                             "<td align=center>",ACTIDESC,"</td>":
                             "</tr>"
.
DPROW999 RETURN   
.
.------------------------------------------------------------
. Table of Allied Health Services : Report 2
.------------------------------------------------------------
SRTAB000  UNPACK    DIM127,D1,LINKPRG,DIM127
          UNPACK    DIM127,D1,LINKREP,DIM127
          UNPACK    DIM127,D1,LINKTEM,DIM127
.
          MATCH     SP70,DEPTCODE
          GOTO      SRTAB999 IF EQUAL
.
          IF        NORECORD=0
            MOVE      PTCNNRTD,NORECORD      * Set Default No Records to Display
          ENDIF
          MOVE      ZERO,RECNUMB
          MOVE      ZERO,DISNUMB
.
          PACK      KEY9,DEPTCODE,STARTKEY,SP70
          CALL      RSALSER1
          CALL      RPALSER1
.
SRTAB100  CALL      RKALSER1
          BRANCH    OVRCD,SRTAB900
.
          MATCH     DEPTCODE,ALSRDEPT
          GOTO      SRTAB900 IF NOT EQUAL
.
          ADD       ONE,RECNUMB
          IF        STARTNUM>=RECNUMB
            GOTO      SRTAB100
          ENDIF
.
          CALL      SRROW000                * Display Row
          ADD       ONE,DISNUMB
          COMPARE   NORECORD,DISNUMB
          GOTO      SRTAB100 IF NOT EQUAL
          GOTO      SRTAB999
.
SRTAB900  CALL      NOMORE00    * Display No More Records Message
.
SRTAB999  RETURN
.------------------------------------------------------------
. Department Service Maintenance Allied Health (TABLE ROW)
.------------------------------------------------------------
SRROW000  MATCH     "1",ALSRACTV
          IF        @EQUAL
            MOVE    "ACTIVE  ",ACTIDESC
          ELSE
            MOVE    "INACTIVE",ACTIDESC
          ENDIF
.
          MATCH     "1",ALSRGROU
          IF        @EQUAL
            MOVE    "YES     ",GROUDESC
          ELSE
            MOVE    "NO      ",GROUDESC
          ENDIF
.
          MATCH     "1",ALSRNURA
          IF        @EQUAL
            MOVE    "YES     ",NOURDESC
          ELSE
            MOVE    "NO      ",NOURDESC
          ENDIF
.
          MATCH     "1",ALSRVACS
          IF        @EQUAL
            MOVE    "YES     ",ACTIDES2
          ELSE
            MOVE    "NO      ",ACTIDES2
          ENDIF
.
          MATCH     SP70,ALSRLENG
          IF        @EQUAL
            MOVE    "&nbsp;",ACTIDES3
          ELSE
            MOVE    ALSRLENG,ACTIDES3
          ENDIF 
.
          
          MATCH     SP70,ACTIDESC
          IF        @EQUAL
            MOVE    "&nbsp;",ACTIDESC
          ENDIF 
.
          WRITE     HTMLFILE;"<tr><td nowrap><A HREF='javascript:ShowDetail":
                             "(#"",LINKPRG,"#.pbl":
                             "?reportno=",LINKREP:
                             "&template=",LINKTEM:
                             "&deptcode=",DEPTCODE:
.                            "&deptcode=",ALSRDEPT:
                             "&alser002=",ALSRSERV,"#")'>":
                             "<img src=../images/MaintenanceIcon.gif hspace=4":
                             " border=0 align=absmiddle></a>":
                             ALSRSERV,"</td>":
                             "<td>",ALSRDESC,"</td>":
                             "<td align=center>",ACTIDES3,"</td>":
                             "<td align=center>",ACTIDES2,"</td>":
                             "<td align=center>",GROUDESC,"</td>":
                             "<td align=center>",NOURDESC,"</td>":
                             "<td align=center>",ALSRMHDP,"&nbsp;</td>":
                             "<td align=center>",ACTIDESC,"</td>":
                             "</tr>"
.
SRROW999 RETURN
.
.------------------------------------------------------------
. Table of Allied Health Services : Report 5
.------------------------------------------------------------
EQTAB000  UNPACK    DIM127,D1,LINKPRG,DIM127
          UNPACK    DIM127,D1,LINKREP,DIM127
          UNPACK    DIM127,D1,LINKTEM,DIM127
.
          IF        NORECORD=0
            MOVE      PTCNNRTD,NORECORD      * Set Default No Records to Display
          ENDIF
          MOVE      ZERO,RECNUMB
          MOVE      ZERO,DISNUMB
.
          PACK      KEY13,DEPTCODE,STARTKEY,SP70
          CALL      RDALEQU3
          COMPARE   ZERO,OVRCD
          GOTO      EQTAB110 IF EQUAL
.
EQTAB100  CALL      RKALEQU3
          BRANCH    OVRCD,EQTAB900
.
EQTAB110  MATCH     DEPTCODE,ALEQDEPT
          GOTO      EQTAB900 IF NOT EQUAL
.
          MATCH     SP70,FILTTYPE
          IF        !@EQUAL
            MATCH     FILTTYPE,ALEQTYPE
            GOTO      EQTAB100 IF NOT EQUAL
          ENDIF
.
          ADD       ONE,RECNUMB
          IF        STARTNUM>=RECNUMB
            GOTO      EQTAB100
          ENDIF
.
          CALL      EQROW000                * Display Row
.
          ADD       ONE,DISNUMB
          COMPARE   NORECORD,DISNUMB
          GOTO      EQTAB100 IF NOT EQUAL
          GOTO      EQTAB999
.
EQTAB900  CALL      NOMORE00     * Display No More Records Message
.
EQTAB999  RETURN
.------------------------------------------------------------
. Department Equipment Maintenance Allied Health (TABLE ROW)
.------------------------------------------------------------
EQROW000  MOVE      SP70,STATDESC
          MOVE       "",STRIKETG
          STRIP      STRIKETG
.
          MATCH     "0",ALEQSTAT
          IF         @EQUAL
            IF        ALEQCBAL > 0
              MOVE    "Available for Loan",STATDESC
            ENDIF
            MATCH   "1",ALEQCONS            * is it a Consumable?
            IF       @EQUAL
              MOVE    "Available",STATDESC
            ENDIF
          ENDIF
.
          MATCH     "1",ALEQSTAT
          IF        @EQUAL
            MOVE    "Currently on Loan",STATDESC
            MATCH   "1",ALEQCONS
            IF      @EQUAL
              MOVE    "Not available",STATDESC
            ENDIF
          ENDIF
.
          MATCH     "2",ALEQSTAT
          IF        @EQUAL
            MOVE    "Inactive/Written Off",STATDESC
          ENDIF
.
          MATCH     "3",ALEQSTAT
          IF        @EQUAL
            MOVE    "Needs Maintenance",STATDESC
          ENDIF
.
          MATCH     "4",ALEQSTAT
          IF        @EQUAL
            MOVE    "Deleted",STATDESC
          ENDIF
.
          MATCH     "1",ALEQACTV
          IF        @EQUAL
            MOVE       " style=#"text-decoration:line-through;#"",STRIKETG
          ENDIF
.
          MATCH     "4",ALEQSTAT
          IF        @EQUAL
            MOVE       " style=#"text-decoration:line-through;#"",STRIKETG
          ENDIF
.
          MOVE      SP70,TDESC
          MATCH     SP70,ALEQTYPE
          IF        !@EQUAL
            PACK      KEY5,ANSQ,ANST,ALEQTYPE
            CALL      RDCODE1
            IF        OVRCD=1
              MOVE      ALEQTYPE,TDESC
            ENDIF
          ENDIF
.
          WRITE     HTMLFILE;*+,"<tr><td",STRIKETG,">":
                             "<a href='javascript:ShowDetail":
                             "(#"",LINKPRG,"#.pbl":
                             "?reportno=",LINKREP:
                             "&template=",LINKTEM:
.                             "&deptcode=",DEPTCODE:
                             "&deptcode=",ALEQDEPT:
                             "&alequ001=",ALEQEQUI,"#")'>":
                             "<img src=../images/MaintenanceIcon.gif hspace=4":
                             " border=0 align=absmiddle></a>":
                             ALEQEQUI,"&nbsp;</td>":
                             "<td",STRIKETG,">",ALEQDESC,"&nbsp;</td>":
                             "<td",STRIKETG,">",TDESC,"&nbsp;</td>":
                             "<td align=center",STRIKETG,">",STATDESC:
                             "&nbsp;</td>":
                             "<td align=center",STRIKETG,">",ALEQCBAL:
                             "&nbsp;</td>":
                             "</tr>"
.
EQROW999  RETURN
.-----------------------------------------------------------------
. Search Allied Health Equipment Codes By Department : Report 5
.-----------------------------------------------------------------
EQTUP000  CALL      EQTHD000                * Heading 
.
          IF        NORECORD=0
            MOVE      "10",NORECORD         * Set Default No Records to Display
          ENDIF
          MOVE      ZERO,RECNUMB
          MOVE      ZERO,DISNUMB
.
          PACK      KEY10,USERID,SP70
          CALL      RDWBSE1
          BRANCH    OVRCD,EQTUP999
.
          MATCH     SP70,DEPTCODE
          IF        @EQUAL
            MATCH     SP70,WBSEDALL
            GOTO      EQTUP999 IF EQUAL 
            MOVE      WBSEDALL,DEPTCODE     * Use user ID's defualt first up!
          ENDIF   
.
          PACK      KEY13,DEPTCODE,SP70
          CALL      RSALEQU3
EQTUP100  CALL      RKALEQU3
          BRANCH    OVRCD,EQTUP999
.
          MATCH     DEPTCODE,ALEQDEPT
          GOTO      EQTUP999 IF NOT EQUAL 
.
          MATCH     "1",ALEQACTV            * Inactive = 1
          GOTO      EQTUP100 IF EQUAL 
.
          MATCH     SP70,EQTPFILT           * Filter by Equipment Type
          IF        !@EQUAL
            MATCH     EQTPFILT,ALEQTYPE
            GOTO      EQTUP100 IF NOT EQUAL
          ENDIF
.
          ADD       ONE,RECNUMB
          IF        STARTNUM>=RECNUMB
            GOTO      EQTUP100
          ENDIF
.
          CALL      EQTRW000                * Display Row
.
          ADD       ONE,DISNUMB
          COMPARE   NORECORD,DISNUMB
          GOTO      EQTUP100 IF NOT EQUAL
.
EQTUP999  RETURN
.------------------------------------------------------------
. Tests (TABLE HEADING)
.------------------------------------------------------------
EQTHD000  WRITE     HTMLFILE;"<tr>":
                               "<td class=HeadingCell width=40%>":
                               "Equipment</td>":
                               "<td class=HeadingCell width=20%>":
                               "Department</td>":
                               "<td class=HeadingCell align=center width=20%>":
                               "Status</td>":
                               "<td class=HeadingCell align=center width=20%>":
                               "Current Balance</td>":
                             "</tr>"
.
EQTHD999  RETURN
.------------------------------------------------------------
. Department Equipment Search Allied Health (TABLE ROW)
.------------------------------------------------------------
EQTRW000  MATCH     "0",ALEQSTAT
          IF        @EQUAL
            MOVE    "Available for Loan",STATDESC 
          ENDIF
.
          MATCH     "1",ALEQSTAT
          IF        @EQUAL
            MOVE    "Currently on Loan",STATDESC 
          ENDIF
.
          MATCH     "2",ALEQSTAT
          IF        @EQUAL
            MOVE    "Inactive/Written Off",STATDESC 
          ENDIF
.
          MATCH     "3",ALEQSTAT
          IF        @EQUAL
            MOVE    "Needs Maintenance",STATDESC  
          ENDIF
.
          MOVE      "CG",CATEGORY     * Get Department Description
          MOVE      ALEQDEPT,CODE
          CALL      GETCOD00
.
          MATCH     SP70,TDESC
          IF        @EQUAL 
            MOVE      "&nbsp;",TDESC
          ENDIF
.
          PACK      KEY45,ALEQEQUI,SP1,DASH,SP1,ALEQDESC
.
          WRITE     HTMLFILE;"<tr><td nowrap>":
                             "<A HREF='javascript:updateParent":
                             "(#"",ALEQEQUI,"#",#"",ALEQDESC,"#",#"":
          TDESC,"#",#"",ALEQCONS,"#",#"",ALEQSERI,"#",#"",ALEQSUPP,"#",#"",ALEQUNIT,"#")'>":
                             "<img src=../images/MaintenanceIcon.gif hspace=4":
                             " border=0 align=absmiddle></a>":
                             KEY45,"</td>":
                             "<td>",TDESC,"&nbsp;</td>":
                             "<td align=center>",STATDESC,"&nbsp;</td>":
                             "<td align=center>",ALEQCBAL,"&nbsp;</td></tr>"
.
EQTRW999  RETURN
.
.------------------------------------------------------------
. Table of Allied Health Template Mainttenance : Report 6 
.------------------------------------------------------------
TMTAB000  UNPACK    DIM127,D1,LINKPRG,DIM127
          UNPACK    DIM127,D1,LINKREP,DIM127
          UNPACK    DIM127,D1,LINKTEM,DIM127
.
          IF        NORECORD=0
            MOVE      PTCNNRTD,NORECORD      * Set Default No Records to Display
          ENDIF
          MOVE      ZERO,RECNUMB
          MOVE      ZERO,DISNUMB
.
.          PACK      KEY16,DEPTCODE,ALTMP002,ALTMP003,ALTMP004,SP70
          PACK      KEY16,DEPTCODE,SP70     * HPS(BLR) Added
          CALL      RSALTMP1
          CALL      RPALTMP1
.
TMTAB100  CALL      RKALTMP1
          BRANCH    OVRCD,DPTAB999
.
          MATCH     DEPTCODE,ALTMDEPT
.          GOTO      TMTAB100 IF NOT EQUAL
          GOTO      TMTAB900 IF NOT EQUAL
.
          ADD       ONE,RECNUMB
          IF        STARTNUM>=RECNUMB
            GOTO      TMTAB100
          ENDIF
.
          MATCH     "1",ALTMTYRC            * Check if emr record type
          GOTO      TMTAB100 IF EQUAL
.
          CALL      TMROW000                * Display Template Row
          ADD       ONE,DISNUMB
          COMPARE   NORECORD,DISNUMB
          GOTO      TMTAB100 IF NOT EQUAL
          GOTO      TMTAB999
.
TMTAB900  CALL      NOMORE00     * Display No More Records Message
.
TMTAB999  RETURN
.------------------------------------------------------------
.  Allied Health Template (TABLE ROW)
.------------------------------------------------------------
TMROW000  MATCH     SP70,ALTMDESC
          IF        @EQUAL
            MOVE      "&nbsp;",ALTMDESC
          ENDIF
. 
          WRITE     HTMLFILE;"<tr><td nowrap><A HREF='javascript:ShowDetail":
                             "(#"",LINKPRG,"#.pbl":
                             "?reportno=",LINKREP:
                             "&template=",LINKTEM:
                             "&deptcode=",ALTMDEPT:
                             "&altmp002=",ALTMMPSV:
                             "&altmp003=",ALTMMPRP:
                             "&altmp004=",ALTMMPTP,"#")'>":
                             "<img src=../images/MaintenanceIcon.gif hspace=4":
                             " border=0 align=absmiddle></a>":
                             ALTMMPSV,"</td>":
                             "<td>",ALTMMPRP,"</td>":
                             "<td align=center>",ALTMMPTP,"</td>":
                             "<td align=center>",ALTMMPTT,"</td>":
                             "<td align=center>",ALTMDESC,"</td>":
                             "</tr>"
.
TMROW999 RETURN   
.------------------------------------------------------------
. Table of Allied Health Billing Maintenance : Report 7
.------------------------------------------------------------
BITAB000  UNPACK    DIM127,D1,LINKPRG,DIM127
          UNPACK    DIM127,D1,LINKREP,DIM127
          UNPACK    DIM127,D1,LINKTEM,DIM127
.
          IF        NORECORD=0
            MOVE      PTCNNRTD,NORECORD      * Set Default No Records to Display
          ENDIF
          MOVE      ZERO,RECNUMB
          MOVE      ZERO,DISNUMB
.
          PACK      KEY16,STARTKEY,SP70
          CALL      RSALBIL1
.
BITAB100  CALL      RKALBIL1
          BRANCH    OVRCD,BITAB900
.
          ADD       ONE,RECNUMB
          IF        STARTNUM>=RECNUMB
            GOTO     BITAB100
          ENDIF
.
          CALL      BIROW000                * Display Dep.code Row
          ADD       ONE,DISNUMB
          COMPARE   NORECORD,DISNUMB
          GOTO      BITAB100 IF NOT EQUAL
          GOTO      BITAB999
.
BITAB900  CALL      NOMORE00      * Display No More Records Message
.
BITAB999  RETURN
.------------------------------------------------------------
.  Allied Health Department codes (TABLE ROW)
.------------------------------------------------------------
BIROW000  MOVE      "CG",CATEGORY
          MOVE      ALBIDEPT,CODE
          CALL      GETCOD00
          MOVE      TDESC,ALBILD01
. 
          MOVE      "CL",CATEGORY
          MOVE      ALBICOMP,CODE
          CALL      GETCOD00
          MOVE      TDESC,ALBILD02
.
          PACK      KEY9,ALBIDEPT,ALBISERV,SP70
          CALL      RDALSER1
          IF        OVRCD=1
            MOVE      "&nbsp",ALSRDESC
          ENDIF
.
          CALL      GETINM00
.
          PACK      KEY16,ALBIDEPT,ALBICOMP,ALBISERV,ALBITIME,SP70
          REP       " +",KEY16
          WRITE     HTMLFILE;"<tr><td nowrap><A HREF='javascript:ShowDetail01":
                             "(#"",LINKPRG,"#.pbl":
                             "?reportno=",LINKREP:
                             "&template=",LINKTEM:
                             "&billkeys=",KEY16,"#")'>":
                             "<img src=../images/MaintenanceIcon.gif hspace=4":
                             " border=0 align=absmiddle></a>":
                             ALBIDEPT,"</td>":
                             "<td>",ALBILD01,"</td>":
                             "<td align=center>",ALBILD02,"</td>":
                             "<td align=center>",ALSRDESC,"</td>":
                             "<td align=center>",ALBITIME,"</td>":
                             "<td align=center>",PRITDESC,"</td>":
                             "</tr>"
.
BIROW999 RETURN   
.-----------------------------------------------------------
. Initialize's file data  (Service type)
.-----------------------------------------------------------
CLRSRV00  MOVE      SP70,ALSRDEPT
          MOVE      SP70,ALSRSERV
          MOVE      SP70,ALSRDESC
          MOVE      SP70,ALSRLENG
          MOVE      SP70,ALSRVACS
          MOVE      SP70,ALSRACTV
          MOVE      SP70,ALSRCDAT
          MOVE      SP70,ALSRCTIM
          MOVE      SP70,ALSRCUID
          MOVE      SP70,ALSRUDAT
          MOVE      SP70,ALSRUTIM
          MOVE      SP70,ALSRUUID
          MOVE      SP70,ALSRMHDP
          MOVE      SP70,ALSRSPEC
          MOVE      SP70,ALSRSPAR
.
CLRSRV99  RETURN
.
.-----------------------------------------------------------
. Initialize's file data  (Department codes) 
.-----------------------------------------------------------
CLRDEP00  MOVE      SP70,ALDEDEPT
          MOVE      SP70,ALDEREFE
          MOVE      SP70,ALDESECU 
          MOVE      SP70,ALDEVACS
          MOVE      SP70,ALDEBILL
          MOVE      SP70,ALDEPRAC
          MOVE      SP70,ALDEUR1
          MOVE      SP70,ALDEUR2
          MOVE      SP70,ALDEUD1
          MOVE      SP70,ALDEUD2
          MOVE      SP70,ALDEUY1
          MOVE      SP70,ALDEUY2
          MOVE      SP70,ALDEUC1
          MOVE      SP70,ALDEUC2
          MOVE      SP70,ALDECDAT
          MOVE      SP70,ALDECTIM
          MOVE      SP70,ALDECUID
          MOVE      SP70,ALDEUDAT
          MOVE      SP70,ALDEUTIM
          MOVE      SP70,ALDEUUID
          MOVE      SP70,ALDEHOSP
          MOVE      SP70,ALDEACTV
          MOVE      SP70,ALDESREQ
          MOVE      SP70,ALDECSEP
          MOVE      SP70,ALDEPRGS
          MOVE      SP70,ALDEPENC
          MOVE      SP70,ALDEVECC
          MOVE      SP70,ALDEUERF
          MOVE      SP70,ALDEURAD
          MOVE      SP70,ALDEUASS
          MOVE      SP70,ALDEURAP
          MOVE      SP70,ALDEDLAS
          MOVE      SP70,ALDEDCLI
          MOVE      SP70,ALDEDRAA
          MOVE      SP70,ALDEDLET
          MOVE      SP70,ALDEUEME
          MOVE      SP70,ALDEUEIN
          MOVE      SP70,ALDEUESU
          MOVE      SP70,ALDEUAHP
          MOVE      SP70,ALDESITE
          MOVE      SP70,ALDECTYP
          MOVE      SP70,ALDEAONE
          MOVE      SP70,ALDEUTRS
          MOVE      SP70,ALDEUPRT
          MOVE      SP70,ALDEDACP
          MOVE      SP70,ALDESPAR
.
CLRDEP99  RETURN
.
.-----------------------------------------------------------
. Initialize's file data  (Department default letters)
.-----------------------------------------------------------
CLRDLL00  MOVE      SP70,ALDLDEPT
          MOVE      SP70,ALDLRACP
          MOVE      SP70,ALDLRACR
          MOVE      SP70,ALDLURAP
          MOVE      SP70,ALDLURAR
          MOVE      SP70,ALDLRPAT
          MOVE      SP70,ALDLRREF
          MOVE      SP70,ALDLPLAB
          MOVE      SP70,ALDLSPAR
.
          RETURN
.-----------------------------------------------------------
.   initializing Problem variables ( reort no 3)
.-----------------------------------------------------------
CLRPRB00  MOVE      SP70,ALPRDEPT           * Department Code (alldepaf)
          MOVE      SP70,ALPRPROB           * Problem Code
          MOVE      SP70,ALPRDESC           * Problem Description
          MOVE      SP70,ALPRICD            * Equivalent ICD10 Code
          MOVE      SP70,ALPRACTV           * Active (0=No,1=Yes)
          MOVE      SP70,ALPRCDAT           * Date Record Created (CCYYMMDD)
          MOVE      SP70,ALPRCTIM           * Time Record Created (HH:MM:SS)
          MOVE      SP70,ALPRCUID           * WEB User ID Created (websecaf)
          MOVE      SP70,ALPRUDAT           * Date Record Updated (CCYYMMDD)
          MOVE      SP70,ALPRUTIM           * Time Record Updated (HH:MM:SS)
          MOVE      SP70,ALPRUUID           * WEB User ID Updated (websecaf)
          MOVE      SP70,ALPRMHDP           * HDP
          MOVE      SP70,ALPRDFCD           * Default
          MOVE      SP70,ALPROTHR           * Other Factor
          MOVE      SP70,ALPRSPAR           * Spare Variable
.
CLRPRB99  RETURN
.-----------------------------------------------------------
. Initialize's file data  (Diagnosis Detail) 
.-----------------------------------------------------------
CLRDIG00  MOVE      SP70,ALDIDEPT           * Department (alldepaf)
          MOVE      SP70,ALDIDIAG           * Diagnosis Code
          MOVE      SP70,ALDIDESC           * Diagnosis Description
          MOVE      SP70,ALDIICD            * Equivalent ICD10 Code
          MOVE      SP70,ALDIACTV           * Active (0=No,1=Yes)
          MOVE      SP70,ALDICDAT           * Date Record Created (CCYYMMDD)
          MOVE      SP70,ALDICTIM           * Time Record Created (HH:MM:SS)
          MOVE      SP70,ALDICUID           * WEB User ID Created (websecaf)
          MOVE      SP70,ALDIUDAT           * Date Record Updated (CCYYMMDD)
          MOVE      SP70,ALDIUTIM           * Time Record Updated (HH:MM:SS)
          MOVE      SP70,ALDIUUID           * WEB User ID Updated (websecaf)
          MOVE      SP70,ALDIMHDP           * HDP
          MOVE      SP70,ALDIMHCP           * HCP Equivalent
          MOVE      SP70,ALDISDAT           * Diagnosis Code Start Date 
          MOVE      SP70,ALDIEDAT           * Diagnosis Code End Date 
          MOVE      SP70,ALDISPAR           * Spare Variable
.
CLRDIG99  RETURN
.-----------------------------------------------------------
. Initialize's file data  (Intervention Detail)
.-----------------------------------------------------------
CLRINC00  MOVE      SP70,ALINDEPT           * Department (alldepaf)
          MOVE      SP70,ALINCODE           * Intervention Code
          MOVE      SP70,ALINDESC           * Intervention Description
          MOVE      SP70,ALINACTV           * Active (0=No,1=Yes)
          MOVE      SP70,ALINCDAT           * Date Record Created (CCYYMMDD)
          MOVE      SP70,ALINCTIM           * Time Record Created (HH:MM:SS)
          MOVE      SP70,ALINCUID           * WEB User ID Created (websecaf)
          MOVE      SP70,ALINUDAT           * Date Record Updated (CCYYMMDD)
          MOVE      SP70,ALINUTIM           * Time Record Updated (HH:MM:SS)
          MOVE      SP70,ALINUUID           * WEB User ID Updated (websecaf)
          MOVE      SP70,ALINSPAR           * Spare Variable
.
CLRINC99  RETURN
.-----------------------------------------------------------
. Initialize's file data  (Billing Detail) 
.-----------------------------------------------------------
CLRBIL00  MOVE      SP70,ALBIDEPT
          MOVE      SP70,ALBICOMP
          MOVE      SP70,ALBISERV
          MOVE      SP70,ALBITIME
          MOVE      SP70,ALBIITEM  
          MOVE      SP70,ALBICDAT  
          MOVE      SP70,ALBICTIM  
          MOVE      SP70,ALBICUIT  
          MOVE      SP70,ALBIUDAT  
          MOVE      SP70,ALBIUTIM  
          MOVE      SP70,ALBIUUID  
.
CLRBIL99  RETURN
.
.-----------------------------------------------------------
. Initialize's file data  (Template Detail) 
.-----------------------------------------------------------
CLRTEM00  MOVE      SP70,ALTMDEPT
          MOVE      SP70,ALTMMPSV
          MOVE      SP70,ALTMMPRP
          MOVE      SP70,ALTMMPTP
          MOVE      SP70,ALTMMPTT
          MOVE      SP70,ALTMDESC
          MOVE      SP70,ALTMCDAT
          MOVE      SP70,ALTMCTIM
          MOVE      SP70,ALTMCUID
          MOVE      SP70,ALTMUDAT
          MOVE      SP70,ALTMUTIM
          MOVE      SP70,ALTMUUID
          MOVE      SP70,ALTMTYRC
.
CLRTEM99  RETURN
.-----------------------------------------------------------
. move cgi variables into file variables services
.-----------------------------------------------------------
SAVSRV00  MOVE      DEPTCODE,ALSRDEPT
          MOVE      ALSER002,ALSRSERV
          MOVE      ALSER003,ALSRDESC
          MOVE      ALSER004,ALSRLENG
.
          MATCH     SP70,ALSER005
          IF        !@EQUAL
            MOVE      ALSER005,ALSRVACS
          ELSE
            MOVE      "0",ALSRVACS
          ENDIF
.         
          MATCH     SP70,ALSER006
          IF        !@EQUAL
            MOVE      ALSER006,ALSRACTV
          ELSE
            MOVE      "0",ALSRACTV
          ENDIF
.
          MOVE      ALSER007,ALSRCDAT
          MOVE      ALSER008,ALSRCTIM
          MOVE      ALSER009,ALSRCUID
          MOVE      ALSER010,ALSRUDAT
          MOVE      ALSER011,ALSRUTIM
          MOVE      ALSER012,ALSRUUID
.
          MATCH     SP70,ALSER013
          IF        !@EQUAL
            MOVE      ALSER013,ALSRGROU
          ELSE
            MOVE      "0",ALSRGROU
          ENDIF
.
          MATCH     SP70,ALSER014
          IF        !@EQUAL
            MOVE      ALSER014,ALSRNURA
          ELSE
            MOVE      "0",ALSRNURA
          ENDIF
.
          MOVE      ALSER015,ALSRMHDP
          MOVE      ALSER016,ALSRSPEC
.
SAVSRV99  RETURN
.
.-----------------------------------------------------------
. move cgi variables into file variables departments
.-----------------------------------------------------------
SAVDEP00  MOVE      DEPTCODE,ALDEDEPT
.
          MATCH     SP70,ALDEP002
          IF        !@EQUAL
            MOVE      ALDEP002,ALDEREFE
          ELSE
            MOVE      "0",ALDEREFE
          ENDIF
.
          MATCH     SP70,ALDEP003
          IF        !@EQUAL
            MOVE      ALDEP003,ALDESECU
          ELSE
            MOVE      ZERO,ALDESECU
          ENDIF
.
          MATCH     SP70,ALDEP004
          IF        !@EQUAL
            MOVE      ALDEP004,ALDEVACS
          ELSE
            MOVE      "0",ALDEVACS
          ENDIF
.
          MATCH     SP70,ALDEP005
          IF        !@EQUAL
            MOVE      ALDEP005,ALDEBILL
          ELSE
            MOVE      "0",ALDEBILL
          ENDIF
.
          MOVE      ALDEP006,ALDEPRAC
          MOVE      ALDEP007,ALDEUR1
          MOVE      ALDEP008,ALDEUR2
          MOVE      ALDEP009,ALDEUD1
          MOVE      ALDEP010,ALDEUD2
.
          MATCH     SP70,ALDEP011
          IF        !@EQUAL
            MOVE      ALDEP011,ALDEUY1
          ELSE
            MOVE      "0",ALDEUY1
          ENDIF
.
          MATCH     SP70,ALDEP012
          IF        !@EQUAL
            MOVE      ALDEP012,ALDEUY2
          ELSE
            MOVE      "0",ALDEUY2
          ENDIF
.
          MOVE      ALDEP013,ALDEUC1
          MOVE      ALDEP014,ALDEUC2
          MOVE      ALDEP015,ALDEHOSP
.
          MOVE      ALDEP016,ALDEACTV
          MOVE      ALDEP017,ALDESREQ
.
          MATCH     SP70,ALDEP018
          IF        !@EQUAL
            MOVE      ALDEP018,ALDECSEP
          ENDIF
.
          MOVE      ALDEP019,ALDEPRGS
          MOVE      ALDEP020,ALDEPENC
.
          MOVE      ALDEP021,ALDEVECC
.
          MOVE      ALDEP022,ALDEUERF
          MOVE      ALDEP023,ALDEURAD
          MOVE      ALDEP024,ALDEUASS
          MOVE      ALDEP025,ALDEURAP
          MOVE      ALDEP026,ALDEDLAS
          MOVE      ALDEP027,ALDEDCLI
          MOVE      ALDEP028,ALDEDRAA
          MOVE      ALDEP029,ALDEDLET
          MOVE      ALDEP030,ALDEUEME
          MOVE      ALDEP031,ALDEUEIN
          MOVE      ALDEP032,ALDEUESU
          MOVE      ALDEP033,ALDEUAHP
.
          MATCH     Z70,ALDEP034
          IF        !@EQUAL
            MOVE      ALDEP034,ALDESITE
          ENDIF
.
          MATCH     Z70,ALDEP035
          IF        !@EQUAL
            MOVE      ALDEP035,ALDECTYP
          ENDIF
.
          MATCH     Z70,ALDEP036
          IF        !@EQUAL
            MOVE      ALDEP036,ALDEAONE
          ENDIF
.
          MATCH     Z70,ALDEP037
          IF        !@EQUAL
            MOVE      ALDEP037,ALDEUTRS
          ENDIF
.
          MATCH     Z70,ALDEP038
          IF        !@EQUAL
            MOVE      ALDEP038,ALDEUPRT
          ENDIF
.
.         Store value for do not copy linked referral
SAVDEP80  MATCH     Z70,ALDEP039
          IF        !@EQUAL
            MOVE      ALDEP039,ALDEDACP
          ENDIF
.
SAVDEP99  RETURN
.
.-----------------------------------------------------------
. move cgi variables into file variables Template 
.-----------------------------------------------------------
SAVTEM00  MOVE      DEPTCODE,ALTMDEPT
.
          MATCH     SP70,ALTMP002
          IF        !@EQUAL
            MOVE      ALTMP002,ALTMMPSV
          ENDIF
.
          MATCH     SP70,ALTMP003
          IF        !@EQUAL
            MOVE      ALTMP003,ALTMMPRP
          ENDIF
.
          MATCH     SP70,ALTMP004
          IF        !@EQUAL
            MOVE      ALTMP004,ALTMMPTP
          ENDIF
.
          MATCH     SP70,ALTMP005
          IF        !@EQUAL
            MOVE      ALTMP005,ALTMMPTT
          ENDIF
.
          MOVE      ALTMP006,ALTMDESC
.
SAVTEM99  RETURN 
.
.-----------------------------------------------------------
. move cgi variables into file variables Template 
.-----------------------------------------------------------
SAVBIL00  MOVE      ALBIL001,ALBIDEPT
          MOVE      ALBIL002,ALBICOMP
          MOVE      ALBIL003,ALBISERV
          MOVE      ALBIL004,ALBITIME
          MOVE      ALBIL005,ALBIITEM
.
SAVBIL99  RETURN
.-----------------------------------------------------------
. Link to Next Group option 1
.-----------------------------------------------------------
NEXTGR00  MOVE      NORECORD,KEY2
          REP       " +",KEY2
          ASSIGN    STARTNUM+NORECORD,F3
          MOVE      F3,KEY3
          REP       " +",KEY3
          UNPACK    DIM127,D1,FLDPARA,DIM127
          MOVE      REPORTNO,F2
.
          REP       " +",FILTACTV
          REP       " +",EQTPFILT
.
          WRITE     HTMLFILE;"allweb01.pbl":
                                 "?reportno=",F2:
                                 "&template=",FLDPARA:
                                 "&startnum=",KEY3:
                                 "&norecord=",KEY2:
                                 "&deptcode=",DEPTCODE:
                                 "&filtactv=",FILTACTV:
                                 "&eqtpfilt=",EQTPFILT;
.
          REP       "+ ",FILTACTV
          REP       "+ ",EQTPFILT
.
NEXTGR99  RETURN
.
.-------------------------------------------------------------
. Link to Prev Group option 1
.-------------------------------------------------------------
PREVGR00  MOVE      NORECORD,KEY2
          REP       " +",KEY2
          ASSIGN    STARTNUM-NORECORD,F3
          IF        F3<0
            MOVE      ZERO,F3
          ENDIF
          MOVE      F3,KEY3
          REP       " +",KEY3
          UNPACK    DIM127,D1,FLDPARA,DIM127
          MOVE      REPORTNO,F2
.
          REP       " +",FILTACTV
          REP       " +",EQTPFILT
.
          WRITE     HTMLFILE;"allweb01.pbl":
                                 "?reportno=",F2:
                                 "&template=",FLDPARA:
                                 "&startnum=",KEY3:
                                 "&norecord=",KEY2:
                                 "&deptcode=",DEPTCODE:
                                 "&filtactv=",FILTACTV:
                                 "&eqtpfilt=",EQTPFILT;
.
          REP       "+ ",FILTACTV
          REP       "+ ",EQTPFILT
.
PREVGR99  RETURN
.
.-----------------------------------------------------------
. Link to Next Group option 2
.-----------------------------------------------------------
NEXTGS00  MOVE      NORECORD,KEY2
          REP       " +",KEY2
          ASSIGN    STARTNUM+NORECORD,F3
          MOVE      F3,KEY3
          REP       " +",KEY3
          UNPACK    DIM127,D1,FLDPARA,DIM127
          MOVE      REPORTNO,F1
.
          REP       " +",DEPTCODE
          REP       " +",ALSER002
.
          WRITE     HTMLFILE;"allweb01.pbl":
                                 "?reportno=",F1:
                                 "&template=",FLDPARA:
                                 "&startnum=",KEY3:
                                 "&norecord=",KEY2:
                                 "&deptcode=",DEPTCODE:
                                 "&alser002=",ALSER002;
.
          REP       "+ ",DEPTCODE
          REP       "+ ",ALSER002       
.
NEXTGS99  RETURN
.
.-------------------------------------------------------------
. Link to Prev Group option 2
.-------------------------------------------------------------
PREVGS00  MOVE      NORECORD,KEY2
          REP       " +",KEY2
          ASSIGN    STARTNUM-NORECORD,F3
          IF        F3<0
            MOVE      ZERO,F3
          ENDIF
          MOVE      F3,KEY3
          REP       " +",KEY3
          UNPACK    DIM127,D1,FLDPARA,DIM127
          MOVE      REPORTNO,F1
.
          REP       " +",ALSER002
          REP       " +",DEPTCODE
.
          WRITE     HTMLFILE;"allweb01.pbl":
                                 "?reportno=",F1:
                                 "&template=",FLDPARA:
                                 "&startnum=",KEY3:
                                 "&norecord=",KEY2:
                                 "&deptcode=",DEPTCODE:
                                 "&alser002=",ALSER002;
.
          REP       "+ ",ALSER002
          REP       "+ ",DEPTCODE       
.
PREVGS99  RETURN
.
.-----------------------------------------------------------
. Link to Next Group option 3
.-----------------------------------------------------------
NEXTGP00  MOVE      NORECORD,KEY2
          REP       " +",KEY2
          ASSIGN    STARTNUM+NORECORD,F3
          MOVE      F3,KEY3
          REP       " +",KEY3
          UNPACK    DIM127,D1,D3,DIM127
          MOVE      REPORTNO,F1
.
          REP       " +",DEPTCODE
          REP       " +",KEYWORDS
          REP       " +",ALPRPROB
          REP       " +",OTHERFAC
.
          WRITE     HTMLFILE;"allweb01.pbl":
                                 "?reportno=",F1:
                                 "&template=",D3:
                                 "&startnum=",KEY3:
                                 "&norecord=",KEY2:
                                 "&deptcode=",DEPTCODE:
                                 "&keywords=",KEYWORDS:
                                 "&alprr002=",ALPRPROB:
                                 "&otherfac=",OTHERFAC;
.
          REP       "+ ",DEPTCODE
          REP       "+ ",KEYWORDS
          REP       "+ ",ALPRPROB       
          REP       "+ ",OTHERFAC       
.
NEXTGP99  RETURN
.
.-------------------------------------------------------------
. Link to Prev Group option 3
.-------------------------------------------------------------
PREVGP00  MOVE      NORECORD,KEY2
          REP       " +",KEY2
          ASSIGN    STARTNUM-NORECORD,F3
          IF        F3<0
            MOVE      ZERO,F3
          ENDIF
          MOVE      F3,KEY3
          REP       " +",KEY3
          UNPACK    DIM127,D1,FLDPARA,DIM127
          MOVE      REPORTNO,F1
.
          REP       " +",ALPRPROB
          REP       " +",KEYWORDS
          REP       " +",DEPTCODE
          REP       " +",OTHERFAC
.
          WRITE     HTMLFILE;"allweb01.pbl":
                                "?reportno=",F1:
                                "&template=",FLDPARA:
                                "&startnum=",KEY3:
                                "&norecord=",KEY2:
                                "&deptcode=",DEPTCODE:
                                "&keywords=",KEYWORDS:
                                "&alprr002=",ALPRPROB:
                                "&otherfac=",OTHERFAC;
.
          REP       "+ ",ALPRPROB
          REP       "+ ",KEYWORDS
          REP       "+ ",DEPTCODE
          REP       "+ ",OTHERFAC
.
PREVGP99  RETURN
.-----------------------------------------------------------
. Link to Next Group option 5
.-----------------------------------------------------------
NEXTGE00  MOVE      NORECORD,KEY2
          REP       " +",KEY2
          ASSIGN    STARTNUM+NORECORD,F3
          MOVE      F3,KEY3
          REP       " +",KEY3
          UNPACK    DIM127,D1,D3,DIM127
          MOVE      REPORTNO,F1
.
          REP       " +",DEPTCODE
          REP       " +",ALEQEQUI
          REP       " +",FILTTYPE
          REP       " +",STARTKEY
.
          WRITE     HTMLFILE;"allweb01.pbl":
                                 "?reportno=",F1:
                                 "&template=",D3:
                                 "&startnum=",KEY3:
                                 "&norecord=",KEY2:
                                 "&deptcode=",DEPTCODE:
                                 "&alequ001=",ALEQEQUI:
                                 "&filttype=",FILTTYPE:
                                 "&startkey=",STARTKEY;
.
          REP       "+ ",DEPTCODE
          REP       "+ ",ALEQEQUI       
          REP       "+ ",FILTTYPE       
          REP       "+ ",STARTKEY
.
NEXTGE99  RETURN
.
.-------------------------------------------------------------
. Link to Prev Group option 4
.-------------------------------------------------------------
PREVGE00  MOVE      NORECORD,KEY2
          REP       " +",KEY2
          ASSIGN    STARTNUM-NORECORD,F3
          IF        F3<0
            MOVE      ZERO,F3
          ENDIF
          MOVE      F3,KEY3
          REP       " +",KEY3
          UNPACK    DIM127,D1,FLDPARA,DIM127
          MOVE      REPORTNO,F1
.
          REP       " +",ALEQEQUI
          REP       " +",DEPTCODE
          REP       " +",FILTTYPE
          REP       " +",STARTKEY
.
          WRITE     HTMLFILE;"allweb01.pbl":
                                "?reportno=",F1:
                                "&template=",FLDPARA:
                                "&startnum=",KEY3:
                                "&norecord=",KEY2:
                                "&deptcode=",DEPTCODE:
                                "&alequ001=",ALEQEQUI:
                                "&filttype=",FILTTYPE:
                                "&startkey=",STARTKEY;
.
          REP       "+ ",ALEQEQUI
          REP       "+ ",DEPTCODE
          REP       "+ ",FILTTYPE
          REP       "+ ",STARTKEY
.
PREVGE99  RETURN
.-----------------------------------------------------------
. Link to Next Group option 4
.-----------------------------------------------------------
NEXTGD00  MOVE      NORECORD,KEY2
          REP       " +",KEY2
          ASSIGN    STARTNUM+NORECORD,F3
          MOVE      F3,KEY3
          REP       " +",KEY3
          UNPACK    DIM127,D1,D3,DIM127
          MOVE      REPORTNO,F1
.
          REP       " +",DEPTCODE
          REP       " +",ALDIDIAG
          REP       " +",KEYWORDS
          REP       " +",CHKVINAH
.
          MOVE      SP70,DISPDAT1
          MATCH     SP70,VALDDATE
          IF        !@EQUAL
            UNPACK    VALDDATE,CCENT,CYEAR,CMON,CDAY
            MOVE      CMON,F2
            LOAD      MTHNAM3,F2,JAN,FEB,MAR,APR,MAY,JUN,JUL,AUG,SEP,OCT,NOV,DEC
            PACK      DISPDAT1,CDAY,SP1,MTHNAM3,SP1,CCENT,CYEAR
          ENDIF
          REP       " +",DISPDAT1
.
          WRITE     HTMLFILE;"allweb01.pbl":
                                 "?reportno=",F1:
                                 "&template=",D3:
                                 "&startnum=",KEY3:
                                 "&norecord=",KEY2:
                                 "&deptcode=",DEPTCODE:
                                 "&keywords=",KEYWORDS:
                                 "&aldia002=",ALDIDIAG:
                                 "&chkvinah=",CHKVINAH:
                                 "&valddate=",DISPDAT1;
.
          REP       "+ ",DEPTCODE
          REP       "+ ",ALDIDIAG       
          REP       "+ ",KEYWORDS
          REP       "+ ",CHKVINAH
.
NEXTGD99  RETURN
.
.-------------------------------------------------------------
. Link to Prev Group option 4
.-------------------------------------------------------------
PREVGD00  MOVE      NORECORD,KEY2
          REP       " +",KEY2
          ASSIGN    STARTNUM-NORECORD,F3
          IF        F3<0
            MOVE      ZERO,F3
          ENDIF
          MOVE      F3,KEY3
          REP       " +",KEY3
          UNPACK    DIM127,D1,FLDPARA,DIM127
          MOVE      REPORTNO,F1
.
          REP       " +",ALDIDIAG
          REP       " +",DEPTCODE
          REP       " +",KEYWORDS
          REP       " +",CHKVINAH
.
          MOVE      SP70,DISPDAT1
          MATCH     SP70,VALDDATE
          IF        !@EQUAL
            UNPACK    VALDDATE,CCENT,CYEAR,CMON,CDAY
            MOVE      CMON,F2
            LOAD      MTHNAM3,F2,JAN,FEB,MAR,APR,MAY,JUN,JUL,AUG,SEP,OCT,NOV,DEC
            PACK      DISPDAT1,CDAY,SP1,MTHNAM3,SP1,CCENT,CYEAR
          ENDIF
          REP       " +",DISPDAT1
.
          WRITE     HTMLFILE;"allweb01.pbl":
                                "?reportno=",F1:
                                "&template=",FLDPARA:
                                "&startnum=",KEY3:
                                "&norecord=",KEY2:
                                "&deptcode=",DEPTCODE:
                                "&keywords=",KEYWORDS:
                                "&aldia002=",ALDIDIAG:
                                "&chkvinah=",CHKVINAH:
                                "&valddate=",DISPDAT1;
.
          REP       "+ ",ALDIDIAG
          REP       "+ ",DEPTCODE
          REP       "+ ",KEYWORDS
          REP       "+ ",CHKVINAH
.
PREVGD99  RETURN
.-----------------------------------------------------------
. Link to Next Group option 6
.-----------------------------------------------------------
NEXTGT00  MOVE      NORECORD,KEY2
          REP       " +",KEY2
          ASSIGN    STARTNUM+NORECORD,F3
          MOVE      F3,KEY3
          REP       " +",KEY3
          UNPACK    DIM127,D1,FLDPARA,DIM127
          MOVE      REPORTNO,F1
.
.          REP       " +",ALTMDEPT          * HPS(BLR) Comment
          REP       " +",DEPTCODE           * HPS(BLR) Added
          REP       " +",ALTMMPSV
          REP       " +",ALTMMPRP
          REP       " +",ALTMMPTP
.
          WRITE     HTMLFILE;"allweb01.pbl":
                                 "?reportno=",F1:
                                 "&template=",FLDPARA:
                                 "&startnum=",KEY3:
                                 "&norecord=",KEY2:
.                                 "&deptcode=",ALTMDEPT:    * HPS(BLR) Comment
                                 "&deptcode=",DEPTCODE:     * HPS(BLR) Added
                                 "&altmp002=",ALTMMPSV:
                                 "&altmp003=",ALTMMPRP:
                                 "&altmp004=",ALTMMPTP;
.
.          REP       "+ ",ALTMDEPT          * HPS(BLR) Comment
          REP       "+ ",DEPTCODE           * HPS(BLR) Added
          REP       "+ ",ALTMMPSV
          REP       "+ ",ALTMMPRP
          REP       "+ ",ALTMMPTP
.
NEXTGT99  RETURN
.
.-------------------------------------------------------------
. Link to Prev Group option 6
.-------------------------------------------------------------
PREVGT00  MOVE      NORECORD,KEY2
          REP       " +",KEY2
          ASSIGN    STARTNUM-NORECORD,F3
          IF        F3<0
            MOVE      ZERO,F3
          ENDIF
          MOVE      F3,KEY3
          REP       " +",KEY3
          UNPACK    DIM127,D1,FLDPARA,DIM127
          MOVE      REPORTNO,F1
.
.          REP       " +",ALTMDEPT          * HPS(BLR) Comment
          REP       " +",DEPTCODE           * HPS(BLR) Added
          REP       " +",ALTMMPSV
          REP       " +",ALTMMPRP
          REP       " +",ALTMMPTP
.
          WRITE     HTMLFILE;"allweb01.pbl":
                                 "?reportno=",F1:
                                 "&template=",FLDPARA:
                                 "&startnum=",KEY3:
                                 "&norecord=",KEY2:
.                                 "&deptcode=",ALTMDEPT:
                                 "&deptcode=",DEPTCODE:
                                 "&altmp002=",ALTMMPSV:
                                 "&altmp003=",ALTMMPRP:
                                 "&altmp004=",ALTMMPTP;
.
.          REP       "+ ",ALTMDEPT          * HPS(BLR) Comment
          REP       "+ ",DEPTCODE           * HPS(BLR) Added
          REP       "+ ",ALTMMPSV
          REP       "+ ",ALTMMPRP
          REP       "+ ",ALTMMPTP
.
PREVGT99  RETURN 
.-----------------------------------------------------------
. Link to Next Group option 7
.-----------------------------------------------------------
NEXTGB00  MOVE      NORECORD,KEY2
          REP       " +",KEY2
          ASSIGN    STARTNUM+NORECORD,F3
          MOVE      F3,KEY3
          REP       " +",KEY3
          UNPACK    DIM127,D1,FLDPARA,DIM127
          MOVE      REPORTNO,F1
.
          REP       " +",ALBIDEPT
          REP       " +",ALBICOMP
          REP       " +",ALBISERV
          REP       " +",ALBIITEM
.
          WRITE     HTMLFILE;"allweb01.pbl":
                                 "?reportno=",F1:
                                 "&template=",FLDPARA:
                                 "&startnum=",KEY3:
                                 "&norecord=",KEY2:
                                 "&albil001=",ALBIDEPT;
.                                "&albil002=",ALBICOMP:
.                                "&albil003=",ALBISERV:
.                                "&albil004=",ALBIITEM;
.
          REP       "+ ",ALBIDEPT
          REP       "+ ",ALBICOMP
          REP       "+ ",ALBISERV
          REP       "+ ",ALBIITEM
.
NEXTGB99  RETURN
.
.-------------------------------------------------------------
. Link to Prev Group option 7
.-------------------------------------------------------------
PREVGB00  MOVE      NORECORD,KEY2
          REP       " +",KEY2
          ASSIGN    STARTNUM-NORECORD,F3
          IF        F3<0
            MOVE      ZERO,F3
          ENDIF
          MOVE      F3,KEY3
          REP       " +",KEY3
          UNPACK    DIM127,D1,FLDPARA,DIM127
          MOVE      REPORTNO,F1
.
          REP       " +",ALBIDEPT
          REP       " +",ALBICOMP
          REP       " +",ALBISERV
          REP       " +",ALBIITEM
.
          WRITE     HTMLFILE;"allweb01.pbl":
                                 "?reportno=",F1:
                                 "&template=",FLDPARA:
                                 "&startnum=",KEY3:
                                 "&norecord=",KEY2:
                                 "&albil001=",ALBIDEPT;
.                                "&albil002=",ALBICOMP:
.                                "&albil003=",ALBISERV:
.                                "&albil004=",ALBIITEM;
.
          REP       "+ ",ALBIDEPT
          REP       "+ ",ALBICOMP
          REP       "+ ",ALBISERV
          REP       "+ ",ALBIITEM
.
PREVGB99  RETURN
.-----------------------------------------------------------
. Link to Next Group option 18
.-----------------------------------------------------------
NEXTIN00  MOVE      NORECORD,KEY2
          REP       " +",KEY2
          ASSIGN    STARTNUM+NORECORD,F3
          MOVE      F3,KEY3
          REP       " +",KEY3
          UNPACK    DIM127,D1,D3,DIM127
          MOVE      REPORTNO,F2
.
          REP       " +",DEPTCODE
          REP       " +",ALINCODE
          REP       " +",KEYWORDS
.
          WRITE     HTMLFILE;"allweb01.pbl":
                                 "?reportno=",F2:
                                 "&template=",D3:
                                 "&startnum=",KEY3:
                                 "&norecord=",KEY2:
                                 "&deptcode=",DEPTCODE:
                                 "&keywords=",KEYWORDS:
                                 "&alinc002=",ALINCODE;
.
          REP       "+ ",DEPTCODE
          REP       "+ ",ALINCODE
          REP       "+ ",KEYWORDS
.
NEXTIN99  RETURN
.
.-------------------------------------------------------------
. Link to Prev Group option 18
.-------------------------------------------------------------
PREVIN00  MOVE      NORECORD,KEY2
          REP       " +",KEY2
          ASSIGN    STARTNUM-NORECORD,F3
          IF        F3<0
            MOVE      ZERO,F3
          ENDIF
          MOVE      F3,KEY3
          REP       " +",KEY3
          UNPACK    DIM127,D1,FLDPARA,DIM127
          MOVE      REPORTNO,F2
.
          REP       " +",ALINCODE
          REP       " +",DEPTCODE
          REP       " +",KEYWORDS
.
          WRITE     HTMLFILE;"allweb01.pbl":
                                "?reportno=",F2:
                                "&template=",FLDPARA:
                                "&startnum=",KEY3:
                                "&norecord=",KEY2:
                                "&deptcode=",DEPTCODE:
                                "&keywords=",KEYWORDS:
                                "&alinc002=",ALINCODE;
.
          REP       "+ ",ALINCODE
          REP       "+ ",DEPTCODE
          REP       "+ ",KEYWORDS
.
PREVIN99  RETURN
.----------------------------------------------------------------
.  Selection list of Departments
.----------------------------------------------------------------
DEPSEL00  MOVE      DEPTCODE,DIM3
.
          MATCH     SP70,DEPTCODE           * Check if CGI Dept Code set?
          IF        @EQUAL
.
            PACK      KEY10,USERID,SP70
            CALL      RDWBSE1
            BRANCH    OVRCD,DEPSEL99
.
            MATCH     SP70,WBSEDALL
            GOTO      DEPSEL05 IF EQUAL
            MOVE      WBSEDALL,DIM3         * Use user ID's defualt first up!
.
          ENDIF
.
DEPSEL05  PACK      PTCDKEY2,ANSC,ANSG,SP70
          CALL      RDSCODE2                      * positional read
DEPSEL10  CALL      RDKCODE2                      * read a record
          BRANCH    OVRCD,DEPSEL99
.
          MATCH     "CG",TCODE 
          GOTO      DEPSEL99 IF NOT EQUAL
.
          PACK      KEY3,ACODE,SP70
          CALL      RDALDEP1                      * Read department table
          BRANCH    OVRCD,DEPSEL10
.
          MATCH     "1",ALDEACTV
          GOTO      DEPSEL10 IF EQUAL
.
          IF        INCLDINP<>1 
            MATCH     ANSI,TCINDC3                 * Exclude IP AH Departents
            GOTO      DEPSEL10 IF EQUAL            * Skip IP departments
          ENDIF
.
DEPSEL20  MATCH     DIM3,ACODE
          IF        @EQUAL
            WRITE     HTMLFILE;"<option value=",ALDEDEPT," selected>":
                          TDESC,"</option>"
          ELSE
            IF        IBCNMHOS=1
              MATCH     SP70,ALDEHOSP
              IF        !@EQUAL
                MATCH     WBSEHOSP,ALDEHOSP
                GOTO      DEPSEL10 IF NOT EQUAL
              ENDIF
            ENDIF
            WRITE     HTMLFILE;"<option value=",ALDEDEPT,">":
                             TDESC,"</option>"
          ENDIF
          GOTO      DEPSEL10
.
DEPSEL99  RETURN
.----------------------------------------------------------------
.  Outputs a selection list of Equipment Types
.----------------------------------------------------------------
EQTSEL00  MOVE      DEPTCODE,KEY3
          MATCH     SP70,DEPTCODE           * Check if CGI Dept Code set?
          IF        @EQUAL
            PACK      KEY10,USERID,SP70
            CALL      RDWBSE1
            BRANCH    OVRCD,EQTSEL99
.
            MATCH     SP70,WBSEDALL
            GOTO      EQTSEL02 IF EQUAL
            MOVE      WBSEDALL,KEY3         * Use user ID's default Dept
          ENDIF
.
EQTSEL02  MATCH     SP70,KEY3
          IF        @EQUAL
            GOTO      EQTSEL99
          ENDIF
.
          COMPARE   ZERO,NOEQIDX7
          IF        @EQUAL
            CALL      EQTYLS00
            GOTO      EQTSEL99
          ENDIF
.
          PACK      KEY5,ANSQ,ANST,SP70
          CALL      RDSCODE1
EQTSEL10  CALL      RDKCODE1
          BRANCH    OVRCD,EQTSEL99
.
          MATCH     "QT",TCODE
          GOTO      EQTSEL99 IF NOT EQUAL
.
          PACK      KEY13,KEY3,SP70
          CALL      RSALEQU3
EQTSEL20  CALL      RKALEQU3
          BRANCH    OVRCD,EQTSEL10
.
          MATCH     KEY3,ALEQDEPT
          GOTO      EQTSEL10 IF NOT EQUAL
.
          MATCH     ACODE,ALEQTYPE
          GOTO      EQTSEL20 IF NOT EQUAL
.
          WRITE     HTMLFILE;"<option value=",ACODE;
.
          MATCH     EQTPFILT,ACODE
          IF        @EQUAL
            WRITE     HTMLFILE;" selected ";
          ENDIF
.
          WRITE     HTMLFILE;">",TDESC,"</option>"
.
          GOTO      EQTSEL10
.
EQTSEL99  RETURN
.
.----------------------------------------------------------------
.  Outputs a selection list of Equipment Types based on ALLEQUA7
.----------------------------------------------------------------
EQTYLS00  PACK      KEY5,ANSQ,ANST,SP70
          CALL      RDSCODE1
EQTYLS10  CALL      RDKCODE1
          BRANCH    OVRCD,EQTYLS99
.
          MATCH     "QT",TCODE
          GOTO      EQTYLS99 IF NOT EQUAL
.
          PACK      KEY16,KEY3,ACODE,SP70
          CALL      RSALEQU7
EQTYLS20  CALL      RKALEQU7
          BRANCH    OVRCD,EQTYLS10
.
          MATCH     KEY3,ALEQDEPT
          GOTO      EQTYLS10 IF NOT EQUAL
.
          MATCH     ACODE,ALEQTYPE
          GOTO      EQTYLS10 IF NOT EQUAL
.
          WRITE     HTMLFILE;"<option value=",ACODE;
.
          MATCH     EQTPFILT,ACODE
          IF        @EQUAL
            WRITE     HTMLFILE;" selected ";
          ENDIF
.
          WRITE     HTMLFILE;">",TDESC,"</option>"
.
          GOTO      EQTYLS10
.
EQTYLS99  RETURN
.
.----------------------------------------------------------------
.  Outputs a selection list of Medical Practices 
.----------------------------------------------------------------
MPRSEL00  PACK      KEY6,SP70
          CALL      RSPRPR1
MPRSEL10  CALL      RKPRPR1
          BRANCH    OVRCD,MPRSEL99
.
          MATCH     ALDEPRAC,PRPRCODE    * Default Medical Records Location
          IF        @EQUAL
            WRITE     HTMLFILE;"<option value=#"",PRPRCODE,"#" selected>":
                                 PRPRDESC,"</option>"
          ELSE
            WRITE     HTMLFILE;"<option value=#"",PRPRCODE,"#">":
                                 PRPRDESC,"</option>"
          ENDIF
.
          GOTO    MPRSEL10
.
MPRSEL99  RETURN
.----------------------------------------------------------------
.   output section of report no 3
.----------------------------------------------------------------
ALPR0000  BRANCH    FLDITMNO,ALPR0001,ALPR0002,ALPR0003,ALPR0004,ALPR0005:
                             ALPR0006,ALPR0007,ALPR0008,ALPR0009,ALPR0010:
                             ALPR0011,ALPR0012,ALPR0013,ALPR0014,ALPR0015:
                             ALPR0016,ALPR0017,ALPR0018,ALPR0019,ALPR0020:
                             ALPR0021
.
          WRITE     HTMLFILE;"Invalid IBA Tag";
          GOTO      ALPR9999
.
ALPR0001  MOVE      "CG",CATEGORY           * Department Code
          MOVE      DEPARTMN,CODE
          CALL      CODITM00 
          GOTO      ALPR9999
.
ALPR0002  WRITE     HTMLFILE;ALPRPROB;       * Problem code
          GOTO      ALPR9999
.
ALPR0003  WRITE     HTMLFILE;ALPRDESC;       * problem desc
          GOTO      ALPR9999
.
ALPR0004  WRITE     HTMLFILE;ALPRICD;
          GOTO      ALPR9999
.
ALPR0005  WRITE     HTMLFILE;ALPRACTV;
          GOTO      ALPR9999
.
ALPR0006  WRITE     HTMLFILE;ALPRCDAT;
          GOTO      ALPR9999
.
ALPR0007  WRITE     HTMLFILE;ALPRCTIM; 
          GOTO      ALPR9999
.
ALPR0008  WRITE     HTMLFILE;ALPRCUID;
          GOTO      ALPR9999
.
ALPR0009  WRITE     HTMLFILE;ALPRUDAT;
          GOTO      ALPR9999
.
ALPR0010  WRITE     HTMLFILE;ALPRUTIM;
          GOTO      ALPR9999
.
ALPR0011  WRITE     HTMLFILE;ALPRUUID;
          GOTO      ALPR9999
.
ALPR0012  CALL      PRTAB000                * Problem table
          GOTO      ALPR9999
.
ALPR0013  CALL      NEXTGP00
          GOTO      ALPR9999
.
ALPR0014  CALL      PREVGP00
          GOTO      ALPR9999
.                                           * HPS CODE Added (KSK) Starts
                                            * Change for ICD10 Description
ALPR0015  MATCH     SP70,ALPRICD
          IF        !@EQUAL  
            PACK      KEY9,ALPRICD,SP70
            CALL      RDPTICD1 
            IF        OVRCD=1
              MOVE    SP70,DDESC
            ENDIF
            WRITE     HTMLFILE;DDESC;
          ELSE
            MOVE      SP70,DDESC
            WRITE     HTMLFILE;DDESC;
          ENDIF
          GOTO      ALPR9999
. 
ALPR0016  WRITE     HTMLFILE;ALPRMHDP;
          GOTO      ALPR9999
.
ALPR0017  MOVE      ZERO,INCLDINP           * Exclude IP AH Departents
          CALL      DEPSEL00                * Department Selection List
          GOTO      ALPR9999
.
ALPR0018  CALL      ALLPKA00                * Problem keyword search
          GOTO      ALPR9999
.
ALPR0019  WRITE     HTMLFILE;ALPRDFCD;
          GOTO      ALPR9999
.
ALPR0020  WRITE     HTMLFILE;ALPROTHR;      * Other Factor/Problem
          GOTO      ALPR9999
.
ALPR0021  PACK      MAPTBIND,ALPRDEPT,ALPRPROB,SP70
          CALL      VMTTAB00           * Clinical Coding System Mappings Table
          GOTO      ALPR9999
.
ALPR9999  RETURN
.
.----------------------------------------------------------------
.   output section of report no 16
.----------------------------------------------------------------
ALDL0000  BRANCH    FLDITMNO,ALDL0010,ALDL0020,ALDL0030,ALDL0040,ALDL0050:
                             ALDL0060,ALDL0070,ALDL0080,ALDL0090,ALDL0100:
                             ALDL0110
.
          WRITE     HTMLFILE;"Invalid IBA Tag";
          GOTO      ALDL9999
.
ALDL0010  MOVE      "CG",CATEGORY           * Department Code
          MOVE      DEPTCODE,CODE
          CALL      CODITM00
          GOTO      ALDL9999
.
ALDL0020  PACK      SELLETTR,ALDLRACP,SP70  * new ack letter to patient
          CALL      LETTY000
          GOTO      ALDL9999
.
ALDL0030  PACK      SELLETTR,ALDLRACR,SP70  * new ack letter to referrer
          CALL      LETTY000
          GOTO      ALDL9999
.
ALDL0040  PACK      SELLETTR,ALDLURAP,SP70  * upd ack letter to patient
          CALL      LETTY000
          GOTO      ALDL9999
.
ALDL0050  PACK      SELLETTR,ALDLURAR,SP70  * upd ack letter to referrer
          CALL      LETTY000
          GOTO      ALDL9999
.
ALDL0060  PACK      SELLETTR,ALDLRPAT,SP70  * rej referral letter to patient 
          CALL      LETTY000
          GOTO      ALDL9999
.
ALDL0070  PACK      SELLETTR,ALDLRREF,SP70  * rej referral letter to referrer 
          CALL      LETTY000
          GOTO      ALDL9999
.
ALDL0080  WRITE     HTMLFILE;ALDLPLAB;      * patient label
          GOTO      ALDL9999
.
ALDL0090  PACK      SELLETTR,ALDLRACG,SP70  * new ack letter to reg GP 
          CALL      LETTY000
          GOTO      ALDL9999
.
ALDL0100  PACK      SELLETTR,ALDLURAG,SP70  * upd ack letter to reg GP 
          CALL      LETTY000
          GOTO      ALDL9999
.
ALDL0110  PACK      SELLETTR,ALDLRRJG,SP70  * rej referral letter to reg GP
          CALL      LETTY000
          GOTO      ALDL9999
.
ALDL9999  RETURN
.------------------------------------------------------------
. Allied Health Medication details
.------------------------------------------------------------
ALMD0000  BRANCH    FLDITMNO,ALMD0010,ALMD0020,ALMD0030,ALMD0040:
                             ALMD0050,ALMD0060,ALMD0070,ALMD0080:
                             ALMD0090,ALMD0100,ALMD0110,ALMD0120:
                             ALMD0130,ALMD0140,ALMD0150,ALMD0160
.
          WRITE     HTMLFILE;"Invalid IBA Tag";
          GOTO      ALMD9999
.
ALMD0010  WRITE     HTMLFILE;ALMECODE;
          GOTO      ALMD9999
.
ALMD0020  WRITE     HTMLFILE;ALMEDESC;
          GOTO      ALMD9999
.
ALMD0030  WRITE     HTMLFILE;ALMEACTV;
          GOTO      ALMD9999
.
ALMD0040  MOVE      "UN",CATEGORY
          MOVE      ALMEUNIT,CODE
          CALL      CODITM00
          GOTO      ALMD9999
.
ALMD0050  WRITE     HTMLFILE;ALMEGENR;
          GOTO      ALMD9999
.
ALMD0060  MOVE      "MR",CATEGORY
          MOVE      ALMEMEDR,CODE
          CALL      CODITM00
          GOTO      ALMD9999
.
ALMD0070  WRITE     HTMLFILE;ALMEIVAD;
          GOTO      ALMD9999
.
ALMD0080  WRITE     HTMLFILE;ALMEINVC;
          GOTO      ALMD9999
.
ALMD0090  MOVE      "MZ",CATEGORY
          MOVE      ALMEMEDT,CODE
          CALL      CODITM00
          GOTO      ALMD9999
.
ALMD0100  CALL      MDTAB000
          GOTO      ALMD9999
.
ALMD0110  CALL      NEXTGR00
          GOTO      ALMD9999
.
ALMD0120  CALL      PREVGR00
          GOTO      ALMD9999
.
ALMD0130  WRITE     HTMLFILE;CURRCODE;
          GOTO      ALMD9999
.
ALMD0140  CALL      ALLMKA00                * Medication keyword search
          GOTO      ALDG9999
.
ALMD0150  CALL      PREVMK00
          GOTO      ALMD9999
.
ALMD0160  CALL      NEXTMK00
          GOTO      ALMD9999
.
ALMD9999  RETURN
.
.******************************************************************************
.                    DISPLAY LIST OF REFERRAL LETTERS
.******************************************************************************
LETTY000  MOVE      ZERO,F3
          PACK      KEY6,F3,SP10
          CALL      RSALLET2
.
LETTY100  CALL      RKALLET2
          BRANCH    OVRCD,LETTY999
          COMPARE   ZERO,ALLTLINO
          GOTO      LETTY999 IF NOT EQUAL
.
          MATCH     SELLETTR,DALLTLTN
          IF        @EQUAL
            WRITE     HTMLFILE;"<option value=#"",DALLTLTN:
                               "#" selected>",ALLTTEXT:
                               "</option>"
          ELSE
            MATCH     "1",ALLTACTV            * Skip inactive
            GOTO      LETTY100 IF EQUAL
.
            WRITE     HTMLFILE;"<option value=#"",DALLTLTN,"#">",ALLTTEXT:
                               "</option>"
          ENDIF
          GOTO      LETTY100
.
LETTY999  RETURN
+
.----------------------------------------------------------------
.    process department problem report 3
.----------------------------------------------------------------
ALLPRB00  RESET     UPDTTYPE
          MATCH     SP70,UPDTTYPE
          GOTO      ALLPRB50 IF EQUAL   * Display
.
          MATCH     "A",UPDTTYPE    * Add a new Problem to the Dept
          GOTO      ALLPRB10 IF EQUAL
.
          MATCH     "U",UPDTTYPE    * Update a problem in the department
          GOTO      ALLPRB20 IF EQUAL
.
          MATCH     "D",UPDTTYPE    * Delete a problem for the department
          GOTO      ALLPRB30 IF EQUAL

          MATCH     "C",UPDTTYPE    * Delete a problem for the department
          GOTO      ALLPRB40 IF EQUAL
.
          GOTO      ALLPRB94

.          ************ ADD FORMACTION ***********

ALLPRB10  PACK      KEY3,DEPTCODE,SP70
          CALL      RDALDEP1                      * Read department table
          BRANCH    OVRCD,ALLPRB93
          MOVE      ALDEDEPT,DEPARTMN             * Save Department Variable
. 
          PACK      KEY12,DEPARTMN,ALPRR002,SP70
          CALL      RDALPRR1
          COMPARE   ZERO,OVRCD
          GOTO      ALLPRB91 IF EQUAL       * if problem code there dips error
          CALL      SAVPRB00                * get the cgi parameters

.                 rest of the vars for the record
          PACK      KEY8,CCC,CYY,CMM,CDD                                       
          REP       " 0",KEY8
          MOVE      KEY8,ALPRCDAT
          CLOCK     TIME,ALPRCTIM           * time record created
          MOVE      USERID,ALPRCUID         * web user created
          MOVE      SP70,ALPRUDAT
          MOVE      SP70,ALPRUTIM
          MOVE      SP70,ALPRUUID
          MOVE      SP70,ALPRSPAR
          CALL      WRALPRR1                * write a record
.
          PROC      ALLAPKUP                * Updates keyword index
.
          MOVE      ZERO,EXIT
          GOTO      ALLPRB99
.
.          ************ UPDATE FORMACTION **********
.
ALLPRB20  PACK      KEY3,DEPTCODE,SP70
          CALL      RDALDEP1                      * Read department table
          BRANCH    OVRCD,ALLPRB93
          MOVE      ALDEDEPT,DEPARTMN             * Save Department Variable
. 
          PACK      KEY12,DEPARTMN,ALPRR002,SP70
          CALL      RDALPRR1
          BRANCH    OVRCD,ALLPRB92          * error if record not found
          CALL      SAVPRB00                * get the cgi parameters
          PACK      KEY8,CCC,CYY,CMM,CDD                                       
          REP       " 0",KEY8
          MOVE      KEY8,ALPRUDAT
          CLOCK     TIME,ALPRUTIM           * time record updated
          MOVE      USERID,ALPRUUID         * web user updated
          CALL      UPALPRR1                * update the record
.
          PROC      ALLAPKUP                * Updates keyword index
.
          MOVE      ZERO,EXIT
          GOTO      ALLPRB99
.
.          ************ DELETE FORMACTION **********
.
ALLPRB30  PACK      KEY3,DEPTCODE,SP70
          CALL      RDALDEP1                      * Read department table
          BRANCH    OVRCD,ALLPRB93
          MOVE      ALDEDEPT,DEPARTMN             * Save Department Variable
. 
          PACK      KEY12,DEPARTMN,ALPRR002,SP70
          CALL      RDALPRR1
          BRANCH    OVRCD,ALLPRB92
.
          CALL      DEALPRR1               * delete the record
.
          PROC      ALLAPKUP                * Updates keyword index
.
          MOVE      "allprraf",MAPTBNAM
          PACK      MAPTBIND,DEPTCODE,ALPRR002,SP70
          CALL      DELCSM00                * Delete Coding System Mappings
.
          MOVE      ZERO,EXIT
          GOTO      ALLPRB99
.
.          ************ COPY FORMACTION **********
.
ALLPRB40  CALL      CPRB0000                     * Copy problem
.
          MOVE      ZERO,EXIT
          GOTO      ALLPRB99
.
.          ************ DISPLAY FORMACTION **********
.
ALLPRB50  PACK      KEY3,DEPTCODE,SP70
          CALL      RDALDEP1                      * Read department table
          BRANCH    OVRCD,ALLPRB90
          MOVE      ALDEDEPT,DEPARTMN             * Save Department Variable
.
          PACK      KEY12,DEPARTMN,ALPRR002,SP70
          CALL      RDALPRR1
          IF        OVRCD=1
            CALL      CLRPRB00                    * Clear all the file variables
          ENDIF
.
          CLEAR     WEBTITLE
          MOVE      "Department Problem Maintenance",WEBTITLE
          RESET     WEBTITLE
.
          CALL      WEBHED00   * Create Output File and Write HTML Page Header
          BRANCH    EXIT,ALLPRB99
          CALL      WEBBOD00   * Process Web Body
          CALL      WEBEND00   * Process End of HTML File
          MOVE      ONE,EXIT
          GOTO      ALLPRB99
.
.         *********** ERROR CONDITIONS ***************
.
ALLPRB90  MOVE      "Department code does not exist.",WEBTITLE
          CALL      WEBERR00
          MOVE      ONE,EXIT
          GOTO      ALLPRB99
.
ALLPRB91  MOVE      "Problem code already exists.",WEBTITLE
          CALL      WEBERR00
          MOVE      ONE,EXIT
          GOTO      ALLPRB99
.
ALLPRB92  MOVE      "Problem code does not exist.",WEBTITLE
          CALL      WEBERR00
          MOVE      ONE,EXIT
          GOTO      ALLPRB99
.
ALLPRB93  MOVE      "Invalid Department Code",WEBTITLE
          CALL      WEBERR00
          MOVE      ONE,EXIT
          GOTO      ALLPRB99
.
ALLPRB94  MOVE      "Invalid Form Action",WEBTITLE
          CALL      WEBERR00
          MOVE      ONE,EXIT
          GOTO      ALLPRB99
.
ALLPRB99  RETURN
.----------------------------------------------------------------
.   get the cgi variables for problem report in the file vars 
.----------------------------------------------------------------
SAVPRB00  MOVE      DEPTCODE,ALPRDEPT
          MOVE      ALPRR002,ALPRPROB
          MOVE      ALPRR003,ALPRDESC
          MOVE      ALPRR004,ALPRICD
.
          MATCH     SP70,ALPRR005
          IF        !@EQUAL
            MOVE      ALPRR005,ALPRACTV
          ELSE
            MOVE      "0",ALPRACTV
          ENDIF
          MOVE      ALPRR006,ALPRMHDP
          MOVE      ALPRR007,ALPRDFCD
          MOVE      ALPRR008,ALPROTHR
.
SAVPRB99  RETURN
.----------------------------------------------------------------
.  Set Parameters for Option 3: Department Problem 
.----------------------------------------------------------------
STPRB000  MOVE      ZERO,EXIT
          UNPACK    QRYNAME,KEY5,KEY3
          MOVE      KEY3,F3
          BRANCH    F3,STPRB001,STPRB002,STPRB003,STPRB004,STPRB005:
                       STPRB006,STPRB007,STPRB008
.
          MOVE      ONE,EXIT
          GOTO      STPRB999
.
STPRB001  MOVE      QRYDATA,ALPRR001
          PACK      ALPRR001,ALPRR001,SP30
          GOTO      STPRB999
.
STPRB002  MOVE      QRYDATA,ALPRR002
          PACK      ALPRR002,ALPRR002,SP70
          GOTO      STPRB999
.
STPRB003  MOVE      QRYDATA,ALPRR003
          GOTO      STPRB999
.
STPRB004  MOVE      QRYDATA,ALPRR004
          GOTO      STPRB999
.
STPRB005  MOVE      QRYDATA,ALPRR005
          GOTO      STPRB999
.
STPRB006  MOVE      QRYDATA,ALPRR006
          GOTO      STPRB999
.
STPRB007  MOVE      QRYDATA,ALPRR007
          GOTO      STPRB999
.
STPRB008  PACK      ALPRR008,QRYDATA,SP70
          GOTO      STPRB999
.
STPRB999  RETURN
.----------------------------------------------------------------
. Table of Problem codes for a department : Report 3
.------------------------------------------------------------
PRTAB000  UNPACK    DIM127,D1,LINKPRG,DIM127
          UNPACK    DIM127,D1,LINKREP,DIM127
          UNPACK    DIM127,D1,LINKTEM,DIM127
.
          IF        NORECORD=0
            MOVE      PTCNNRTD,NORECORD      * Set Default No Records to Display
          ENDIF
          MOVE      ZERO,RECNUMB
          MOVE      ZERO,DISNUMB
.
          PACK      KEY12,DEPTCODE,STARTKEY,SP70     * startkey for Goto Button
          CALL      RSALPRR1                * positional read
          CALL      RPALPRR1
PRTAB100  CALL      RKALPRR1                * read a record
          BRANCH    OVRCD,PRTAB900          * end of file 
.
          MATCH     DEPTCODE,ALPRDEPT       * check the dept 
          GOTO      PRTAB900 IF NOT EQUAL
.
          ADD       ONE,RECNUMB
          IF        STARTNUM>=RECNUMB
            GOTO      PRTAB100
          ENDIF
.
          CALL      PRROW000                * Display Row
          ADD       ONE,DISNUMB
          COMPARE   NORECORD,DISNUMB
          GOTO      PRTAB100 IF NOT EQUAL
          GOTO      PRTAB999
.
PRTAB900  CALL      NOMORE00     * Display No More Records Message
.
PRTAB999  RETURN
.-----------------------------------------------------------------
. Problem Code for each department of Allied Health (TABLE ROW)
.------------------------------------------------------------
PRROW000  MATCH     "1",ALPRACTV
          IF        @EQUAL
            MOVE    "ACTIVE  ",ACTIDESC
          ELSE
            MOVE    "INACTIVE",ACTIDESC
          ENDIF
.
          MATCH     "1",ALPRDFCD
          IF        @EQUAL
            MOVE    DYES,DEFTDESC
          ELSE
            MOVE    DNO,DEFTDESC
          ENDIF
.
          MATCH     "2",ALPROTHR
          IF        @EQUAL
            MOVE    "Other Factor",OTHRDESC
          ELSE
            MATCH     "1",ALPROTHR
            IF        @EQUAL
              MOVE    "Problem",OTHRDESC
            ELSE
              MOVE    "Problem & Other Factor",OTHRDESC
            ENDIF
          ENDIF
.
          WRITE     HTMLFILE;"<tr><td nowrap><A HREF='javascript:ShowDetail":
                             "(#"",LINKPRG,"#.pbl":
                             "?reportno=",LINKREP:
                             "&template=",LINKTEM:
                             "&deptcode=",DEPTCODE:
                             "&alprr002=",ALPRPROB,"#")'>":
                             "<img src=../images/MaintenanceIcon.gif hspace=4":
                             " border=0 align=absmiddle></a>":
                             ALPRPROB,"</td>":
                             "<td>&nbsp",ALPRDESC,"</td>":
                             "<td align=center>&nbsp",ALPRICD,"</td>":
                             "<td align=center>&nbsp",ALPRMHDP,"</td>":
                             "<td align=center>&nbsp",ACTIDESC,"</td>":
                             "<td align=center>&nbsp",DEFTDESC,"</td>":
                             "<td align=center>&nbsp",OTHRDESC,"</td>":
                             "</tr>"
.
PRROW999 RETURN
.
.------------------------------------------------------------
. Process Diagnosis Services 
.------------------------------------------------------------
ALLDIG00  RESET     UPDTTYPE
          MATCH     SP1,UPDTTYPE
          GOTO      ALLDIG50 IF EQUAL
.
          MATCH     "A",UPDTTYPE    * Add formaction
          GOTO      ALLDIG10 IF EQUAL
.
          MATCH     "U",UPDTTYPE    * Update formaction
          GOTO      ALLDIG20 IF EQUAL
.
          MATCH     "D",UPDTTYPE    * Delete formaction
          GOTO      ALLDIG30 IF EQUAL
.
          MATCH     "C",UPDTTYPE    * Copy formaction
          GOTO      ALLDIG40 IF EQUAL
.
          GOTO      ALLDIG93
.
.         ************ ADD FORMACTION ***********
.
ALLDIG10  PACK      KEY3,DEPTCODE,SP70
          CALL      RDALDEP1                      * Read department table
          BRANCH    OVRCD,ALLDIG94
          MOVE      ALDEDEPT,DEPARTMN             * Save Department Variable
.
          PACK      KEY12,DEPARTMN,ALDIA002,SP70
          CALL      RAALDIA1
          COMPARE   ZERO,OVRCD
          GOTO      ALLDIG92 IF EQUAL
          CALL      SAVDIG00                     * Move cgi to file variables
           
          PACK      KEY8,CCC,CYY,CMM,CDD
          REP       " 0",KEY8
          MOVE      KEY8,ALDICDAT                * System date
          CLOCK     TIME,ALDICTIM                * System time (Var chgd HPS)
          MOVE      USERID,ALDICUID              * web user id
          MOVE      SP70,ALDIUDAT
          MOVE      SP70,ALDIUTIM
          MOVE      SP70,ALDIUUID
          CALL      WRALDIA1                     * Writes the data
.
          PROC      ALLADKUP        * Updates keyword index
.
          MOVE      ZERO,EXIT
          GOTO      ALLDIG99
.
.         ************ UPDATE FORMACTION **********
.
ALLDIG20  PACK      KEY3,DEPTCODE,SP70
          CALL      RDALDEP1                      * Read department table
          BRANCH    OVRCD,ALLDIG94
          MOVE      ALDEDEPT,DEPARTMN             * Save Department Variable
. 
          PACK      KEY12,DEPARTMN,ALDIA002,SP70
          CALL      RDALDIA1
          BRANCH    OVRCD,ALLDIG91
          CALL      SAVDIG00                     * Moves cgi to file variables
          PACK      KEY8,CCC,CYY,CMM,CDD
          REP       " 0",KEY8
          MOVE      KEY8,ALDIUDAT                * System Date
          CLOCK     TIME,ALDIUTIM                * System time (Var chgd HPS)
          MOVE      USERID,ALDIUUID              * web user id
          CALL      UPALDIA1                     * Updates the data
. 
          PROC      ALLADKUP        * Updates keyword index
.
          MOVE      ZERO,EXIT
          GOTO      ALLDIG99
.
.         ************ DELETE FORMACTION **********
.
ALLDIG30  PACK      KEY3,DEPTCODE,SP70
          CALL      RDALDEP1                      * Read department table
          BRANCH    OVRCD,ALLDIG94
          MOVE      ALDEDEPT,DEPARTMN             * Save Department Variable
. 
          PACK      KEY12,DEPARTMN,ALDIA002,SP70
          CALL      RDALDIA1
          BRANCH    OVRCD,ALLDIG91
          CALL      DEALDIA1                     * Deletes the data
.
          PROC      ALLADKUP        * Updates keyword index
.
          MOVE      "alldiaaf",MAPTBNAM
          PACK      MAPTBIND,DEPTCODE,ALDIA002,SP70
          CALL      DELCSM00                * Delete Coding System Mappings
.
          MOVE      ZERO,EXIT
          GOTO      ALLDIG99
.         
.         ************ COPY FORMACTION **********
.         
ALLDIG40  CALL      CDIG0000                      * Copy diagnosis
.
          MOVE      ZERO,EXIT
          GOTO      ALLDIG99
.
.         ************ DISPLAY FORMACTION **********
.
ALLDIG50  PACK      KEY3,DEPTCODE,SP70
          CALL      RDALDEP1                      * Read department table
          BRANCH    OVRCD,ALLDIG94
          MOVE      ALDEDEPT,DEPARTMN             * Save Department Variable
.
          PACK      KEY12,DEPARTMN,ALDIA002,SP70
          CALL      RDALDIA1                      * Read service
          IF        OVRCD=1
            CALL      CLRDIG00                    * Clear all the file variables
          ENDIF
.
          CLEAR     WEBTITLE
          MOVE      "Department Services Maintenance",WEBTITLE
          RESET     WEBTITLE
.
          CALL      WEBHED00   * Create Output File and Write HTML Page Header
          BRANCH    EXIT,ALLDIG99
          CALL      WEBBOD00   * Process Web Body
          CALL      WEBEND00   * Process End of HTML File
          MOVE      ONE,EXIT
          GOTO      ALLDIG99
.
ALLDIG91  MOVE      "Diagnosis Code Does Not Exist",WEBTITLE
          CALL      WEBERR00
          MOVE      ONE,EXIT
          GOTO      ALLDIG99
.
ALLDIG92  MOVE      "Diagnosis Code Exists",WEBTITLE
          CALL      WEBERR00
          MOVE      ONE,EXIT
          GOTO      ALLDIG99
.
ALLDIG93  MOVE      "Invalid Form Action.",WEBTITLE
          CALL      WEBERR00
          MOVE      ONE,EXIT
          GOTO      ALLDIG99
.
ALLDIG94  MOVE      "Invalid Department Code",WEBTITLE
          CALL      WEBERR00
          MOVE      ONE,EXIT
          GOTO      ALLDIG99
.
ALLDIG99  RETURN
.
.------------------------------------------------------------
. Copy diagnosis details to this department. 
.------------------------------------------------------------
CDIG0000  PACK      KEY12,COPYDEPT,SP70
          CALL      RSALDIA1
CDIG1000  CALL      RKALDIA1
          BRANCH    OVRCD,CDIG9999
.
          MATCH     COPYDEPT,ALDIDEPT
          GOTO      CDIG9999 IF NOT EQUAL
.
          MATCH     "1",ALDIACTV
          GOTO      CDIG1000 IF NOT EQUAL
.
          PACK      SAVKEY12,ALDIDEPT,ALDIDIAG,SP70
.
          MOVE      DEPTCODE,ALDIDEPT
.
          PACK      KEY12,ALDIDEPT,ALDIDIAG,SP70
          CALL      RAALDIA1
          IF        OVRCD=1
            CALL      WRALDIA1
            PROC      ALLADKUP        * Updates keyword index
          ENDIF
.
          MOVE      SAVKEY12,KEY12
          CALL      RDALDIA1
.
          GOTO      CDIG1000
.
CDIG9999  RETURN
.
.------------------------------------------------------------
. Process Intervention Codes
.------------------------------------------------------------
ALLINC00  RESET     UPDTTYPE
          MATCH     SP1,UPDTTYPE
          GOTO      ALLINC50 IF EQUAL
.
          MATCH     "A",UPDTTYPE    * Add formaction
          GOTO      ALLINC10 IF EQUAL
.
          MATCH     "U",UPDTTYPE    * Update formaction
          GOTO      ALLINC20 IF EQUAL
.
          MATCH     "D",UPDTTYPE    * Delete formaction
          GOTO      ALLINC30 IF EQUAL
.
          MATCH     "C",UPDTTYPE    * Copy formaction
          GOTO      ALLINC40 IF EQUAL
.
          GOTO      ALLINC93
.
.         ************ ADD FORMACTION ***********
.
ALLINC10  PACK      KEY3,DEPTCODE,SP70
          CALL      RDALDEP1                      * Read department table
          BRANCH    OVRCD,ALLINC94
          MOVE      ALDEDEPT,DEPARTMN             * Save Department Variable
.
          PACK      KEY12,DEPARTMN,ALINC002,SP70
          CALL      RAALINC1
          COMPARE   ZERO,OVRCD
          GOTO      ALLINC92 IF EQUAL
          CALL      SAVINC00                     * Move cgi to file variables

          PACK      KEY8,CCC,CYY,CMM,CDD
          REP       " 0",KEY8
          MOVE      KEY8,ALINCDAT                * System date
          CLOCK     TIME,ALINCTIM                * System time (Var chgd HPS)
          MOVE      USERID,ALINCUID              * web user id
          MOVE      SP70,ALINUDAT
          MOVE      SP70,ALINUTIM
          MOVE      SP70,ALINUUID
          CALL      WRALINC1                     * Writes the data
.
          PROC      ALLIKAUP        * Updates keyword index
.
          MOVE      ZERO,EXIT
          GOTO      ALLINC99
.
.         ************ UPDATE FORMACTION **********
.
ALLINC20  PACK      KEY3,DEPTCODE,SP70
          CALL      RDALDEP1                      * Read department table
          BRANCH    OVRCD,ALLINC94
          MOVE      ALDEDEPT,DEPARTMN             * Save Department Variable
.
          PACK      KEY12,DEPARTMN,ALINC002,SP70
          CALL      RDALINC1
          BRANCH    OVRCD,ALLINC91
          CALL      SAVINC00                     * Moves cgi to file variables
          PACK      KEY8,CCC,CYY,CMM,CDD
          REP       " 0",KEY8
          MOVE      KEY8,ALINUDAT                * System Date
          CLOCK     TIME,ALINUTIM                * System time (Var chgd HPS)
          MOVE      USERID,ALINUUID              * web user id
          CALL      UPALINC1                     * Updates the data
.
          PROC      ALLIKAUP        * Updates keyword index
.
          MOVE      ZERO,EXIT
          GOTO      ALLINC99
.
.         ************ DELETE FORMACTION **********
.
ALLINC30  PACK      KEY3,DEPTCODE,SP70
          CALL      RDALDEP1                      * Read department table
          BRANCH    OVRCD,ALLINC94
          MOVE      ALDEDEPT,DEPARTMN             * Save Department Variable
.
          PACK      KEY12,DEPARTMN,ALINC002,SP70
          CALL      RDALINC1
          BRANCH    OVRCD,ALLINC91
          CALL      DEALINC1                     * Deletes the data
.
          PROC      ALLIKAUP        * Updates keyword index
.
          MOVE      ZERO,EXIT
          GOTO      ALLINC99
.
.         ************ COPY FORMACTION **********
.
ALLINC40  CALL      CINC0000                      * Copy intervention
.
          MOVE      ZERO,EXIT
          GOTO      ALLINC99
.
.         ************ DISPLAY FORMACTION **********
.
ALLINC50  PACK      KEY3,DEPTCODE,SP70
          CALL      RDALDEP1                      * Read department table
          BRANCH    OVRCD,ALLINC94
          MOVE      ALDEDEPT,DEPARTMN             * Save Department Variable
.
          PACK      KEY12,DEPARTMN,ALINC002,SP70
          CALL      RDALINC1                      * Read service
          IF        OVRCD=1
            CALL      CLRINC00                    * Clear all the file variables
          ENDIF
.
          CLEAR     WEBTITLE
          MOVE      "Department Intervention Maintenance",WEBTITLE
          RESET     WEBTITLE
.
          CALL      WEBHED00   * Create Output File and Write HTML Page Header
          BRANCH    EXIT,ALLINC99
          CALL      WEBBOD00   * Process Web Body
          CALL      WEBEND00   * Process End of HTML File
          MOVE      ONE,EXIT
          GOTO      ALLINC99
.
ALLINC91  MOVE      "Intervention Code Does Not Exist",WEBTITLE
          CALL      WEBERR00
          MOVE      ONE,EXIT
          GOTO      ALLINC99
.
ALLINC92  MOVE      "Intervention Code Exists",WEBTITLE
          CALL      WEBERR00
          MOVE      ONE,EXIT
          GOTO      ALLINC99
.
ALLINC93  MOVE      "Invalid Form Action.",WEBTITLE
          CALL      WEBERR00
          MOVE      ONE,EXIT
          GOTO      ALLINC99
.
ALLINC94  MOVE      "Invalid Department Code",WEBTITLE
          CALL      WEBERR00
          MOVE      ONE,EXIT
          GOTO      ALLINC99
.
ALLINC99  RETURN
.
.------------------------------------------------------------
. Copy intervention details to this department.
.------------------------------------------------------------
CINC0000  PACK      KEY12,COPYDEPT,SP70
          CALL      RSALINC1
CINC1000  CALL      RKALINC1
          BRANCH    OVRCD,CINC9999
.
          MATCH     COPYDEPT,ALINDEPT
          GOTO      CINC9999 IF NOT EQUAL
.
          MATCH     "1",ALINACTV
          GOTO      CINC1000 IF EQUAL
.
          PACK      SAVKEY12,ALINDEPT,ALINCODE,SP70
.
          MOVE      DEPTCODE,ALINDEPT
.
          PACK      KEY12,ALINDEPT,ALINCODE,SP70
          CALL      RAALINC1
          IF        OVRCD=1
            CALL      WRALINC1
            PROC      ALLIKAUP        * Updates keyword index
          ENDIF
.
          MOVE      SAVKEY12,KEY12
          CALL      RDALINC1
.
          GOTO      CINC1000
.
CINC9999  RETURN
.
.------------------------------------------------------------
. Process Assessment Type Codes
.------------------------------------------------------------
ALLASS00  RESET     UPDTTYPE
          MATCH     SP1,UPDTTYPE
          GOTO      ALLASS50 IF EQUAL
.
          MATCH     "A",UPDTTYPE    * Add formaction
          GOTO      ALLASS10 IF EQUAL
.
          MATCH     "U",UPDTTYPE    * Update formaction
          GOTO      ALLASS20 IF EQUAL
.
          MATCH     "D",UPDTTYPE    * Delete formaction
          GOTO      ALLASS30 IF EQUAL
.
          MATCH     "C",UPDTTYPE    * Copy formaction
          GOTO      ALLASS40 IF EQUAL
.
          GOTO      ALLASS93
.
.         ************ ADD FORMACTION ***********
.
ALLASS10  PACK      KEY3,DEPTCODE,SP70
          CALL      RDALDEP1                      * Read department table
          BRANCH    OVRCD,ALLASS94
          MOVE      ALDEDEPT,DEPARTMN             * Save Department Variable
.
          PACK      KEY13,DEPARTMN,ALATS001,SP70
          CALL      RAALATS1
          COMPARE   ZERO,OVRCD
          GOTO      ALLASS92 IF EQUAL
          CALL      MVALAT00                     * Move cgi to file variables

          PACK      KEY8,CCC,CYY,CMM,CDD
          REP       " 0",KEY8
          MOVE      KEY8,ALATCDAT                * System date
          CLOCK     TIME,ALATCTIM                * System time (Var chgd HPS)
          MOVE      USERID,ALATCUID              * web user id
          MOVE      SP70,ALATUDAT
          MOVE      SP70,ALATUTIM
          MOVE      SP70,ALATUUID
          PACK      KEY13,DEPARTMN,ALATS001,SP70
          CALL      WRALATS1                     * Writes the data
.
          MOVE      ZERO,EXIT
          GOTO      ALLASS99
.
.         ************ UPDATE FORMACTION **********
.
ALLASS20  PACK      KEY3,DEPTCODE,SP70
          CALL      RDALDEP1                      * Read department table
          BRANCH    OVRCD,ALLASS94
          MOVE      ALDEDEPT,DEPARTMN             * Save Department Variable
.
          PACK      KEY13,DEPARTMN,ALATS001,SP70
          CALL      RDALATS1
          BRANCH    OVRCD,ALLASS91
          CALL      MVALAT00                     * Moves cgi to file variables
          PACK      KEY8,CCC,CYY,CMM,CDD
          REP       " 0",KEY8
          MOVE      KEY8,ALATUDAT                * System date
          CLOCK     TIME,ALATUTIM                * System time (Var chgd HPS)
          MOVE      USERID,ALATUUID              * web user id
          PACK      KEY13,DEPARTMN,ALATS001,SP70
          CALL      UPALATS1                     * Updates the data
.
          MOVE      ZERO,EXIT
          GOTO      ALLASS99
.
.         ************ DELETE FORMACTION **********
.
ALLASS30  PACK      KEY3,DEPTCODE,SP70
          CALL      RDALDEP1                      * Read department table
          BRANCH    OVRCD,ALLASS94
          MOVE      ALDEDEPT,DEPARTMN             * Save Department Variable
.
          PACK      KEY13,DEPARTMN,ALATS001,SP70
          CALL      RDALATS1
          BRANCH    OVRCD,ALLASS91
          CALL      DEALATS1                     * Deletes the data
.
          MOVE      ZERO,EXIT
          GOTO      ALLASS99
.
.         ************ COPY FORMACTION **********
.
ALLASS40  CALL      CASS0000                      * Copy assessment
.
          MOVE      ZERO,EXIT
          GOTO      ALLASS99
.
.         ************ DISPLAY FORMACTION **********
.
ALLASS50  PACK      KEY3,DEPTCODE,SP70
          CALL      RDALDEP1                      * Read department table
          BRANCH    OVRCD,ALLASS94
          MOVE      ALDEDEPT,DEPARTMN             * Save Department Variable
.
          PACK      KEY13,DEPARTMN,ALATS001,SP70
          CALL      RDALATS1                      * Read assessment
          IF        OVRCD=1
            CALL      CLALAT00                    * Clear all the file variables
          ENDIF
.
          CLEAR     WEBTITLE
          MOVE      "Department Assessments Maintenance",WEBTITLE
          RESET     WEBTITLE
.
          CALL      WEBHED00   * Create Output File and Write HTML Page Header
          BRANCH    EXIT,ALLASS99
          CALL      WEBBOD00   * Process Web Body
          CALL      WEBEND00   * Process End of HTML File
          MOVE      ONE,EXIT
          GOTO      ALLASS99
.
ALLASS91  MOVE      "Assessment Type Does Not Exist",WEBTITLE
          CALL      WEBERR00
          MOVE      ONE,EXIT
          GOTO      ALLASS99
.
ALLASS92  MOVE      "Assessment Type Exists",WEBTITLE
          CALL      WEBERR00
          MOVE      ONE,EXIT
          GOTO      ALLASS99
.
ALLASS93  MOVE      "Invalid Form Action.",WEBTITLE
          CALL      WEBERR00
          MOVE      ONE,EXIT
          GOTO      ALLASS99
.
ALLASS94  MOVE      "Invalid Department Code",WEBTITLE
          CALL      WEBERR00
          MOVE      ONE,EXIT
          GOTO      ALLASS99
.
ALLASS99  RETURN
+
.------------------------------------------------------------
. Copy assessment details to this department.
.------------------------------------------------------------
CASS0000  PACK      KEY13,COPYDEPT,SP70
          CALL      RSALATS1
CASS1000  CALL      RKALATS1
          BRANCH    OVRCD,CASS9999
.
          MATCH     COPYDEPT,ALATDEPT
          GOTO      CASS9999 IF NOT EQUAL
.
          MATCH     "1",ALATACTV
          GOTO      CASS1000 IF NOT EQUAL
.
          PACK      SAVKEY13,ALATDEPT,ALATTYPE,SP70
.
          MOVE      DEPTCODE,ALATDEPT
.
          PACK      KEY13,ALATDEPT,ALATTYPE,SP70
          CALL      RAALATS1
          IF        OVRCD=1
            CALL      WRALATS1
          ENDIF
.
          MOVE      SAVKEY13,KEY13
          CALL      RDALATS1
.
          GOTO      CASS1000
.
CASS9999  RETURN
+
.------------------------------------------------------------
. Copy service details to this department.
.------------------------------------------------------------
CSER0000  PACK      KEY9,COPYDEPT,SP70
          CALL      RSALSER1
CSER1000  CALL      RKALSER1
          BRANCH    OVRCD,CSER9999
.
          MATCH     COPYDEPT,ALSRDEPT
          GOTO      CSER9999 IF NOT EQUAL
.
          MATCH     "1",ALSRACTV
          GOTO      CSER1000 IF NOT EQUAL
.
          PACK      SAVKEY9,ALSRDEPT,ALSRSERV,SP70
.
          MOVE      DEPTCODE,ALSRDEPT
.
          PACK      KEY9,ALSRDEPT,ALSRSERV,SP70
          CALL      RAALSER1
          IF        OVRCD=1
            CALL      WRALSER1
          ENDIF
.
          MOVE      SAVKEY9,KEY9
          CALL      RDALSER1
.
          GOTO      CSER1000
.
CSER9999  RETURN
.
.------------------------------------------------------------
. Copy problem details to this department.
.------------------------------------------------------------
CPRB0000  PACK      KEY12,COPYDEPT,SP70
          CALL      RSALPRR1
CPRB1000  CALL      RKALPRR1
          BRANCH    OVRCD,CPRB9999
.
          MATCH     COPYDEPT,ALPRDEPT
          GOTO      CPRB9999 IF NOT EQUAL
.
          MATCH     "1",ALPRACTV
          GOTO      CPRB1000 IF NOT EQUAL
.
          PACK      SAVKEY12,ALPRDEPT,ALPRPROB,SP70
.
          MOVE      DEPTCODE,ALPRDEPT
.
          PACK      KEY12,ALPRDEPT,ALPRPROB,SP70
          CALL      RAALPRR1
          IF        OVRCD=1
            CALL      WRALPRR1
            PROC      ALLAPKUP                * Updates keyword index
          ENDIF
.
          MOVE      SAVKEY12,KEY12
          CALL      RDALPRR1
.
          GOTO      CPRB1000
.
CPRB9999  RETURN
.
.---------------------------------------------------------------
.  get the cgi pars into file vars
.---------------------------------------------------------------
SAVDIG00  MOVE      DEPTCODE,ALDIDEPT
          MOVE      ALDIA002,ALDIDIAG
          MOVE      ALDIA003,ALDIDESC
          MOVE      ALDIA004,ALDIICD
.
          MATCH     SP70,ALDIA005
          IF        !@EQUAL
            MOVE      ALDIA005,ALDIACTV
          ELSE
            MOVE      "0",ALDIACTV
          ENDIF
.
          MOVE      ALDIA006,ALDIMHDP
          MOVE      ALDIA007,ALDIMHCP
          MOVE      ALDIA008,ALDISDAT
          MOVE      ALDIA009,ALDIEDAT
.
SAVDIG99  RETURN
.---------------------------------------------------------------
.  get the cgi pars into file vars
.---------------------------------------------------------------
SAVINC00  MOVE      DEPTCODE,ALINDEPT
          MOVE      ALINC002,ALINCODE
          MOVE      ALINC003,ALINDESC
.
          MATCH     SP70,ALINC004
          IF        !@EQUAL
            MOVE      ALINC004,ALINACTV
          ENDIF
.
SAVINC99  RETURN
.------------------------------------------------------------
. Table of Allied Health Diagnosis Maintenance : Report 4
.------------------------------------------------------------
DGTAB000  UNPACK    DIM127,D1,LINKPRG,DIM127
          UNPACK    DIM127,D1,LINKREP,DIM127
          UNPACK    DIM127,D1,LINKTEM,DIM127
.
          IF        NORECORD=0
            MOVE      PTCNNRTD,NORECORD      * Set Default No Records to Display
          ENDIF
          MOVE      ZERO,RECNUMB
          MOVE      ZERO,DISNUMB
.
          PACK      KEY12,DEPTCODE,STARTKEY,SP70
          CALL      RSALDIA1
          CALL      RPALDIA1
.
DGTAB100  CALL      RKALDIA1
          BRANCH    OVRCD,DGTAB900
.
          MATCH     DEPTCODE,ALDIDEPT
.          GOTO      DGTAB100 IF NOT EQUAL  * HPS(BLR) Comment
          GOTO      DGTAB900 IF NOT EQUAL   * HPS(BLR) Added
.
          ADD       ONE,RECNUMB
          IF        STARTNUM>=RECNUMB
            GOTO     DGTAB100
          ENDIF
.
          CALL      DGROW000                * Display Dig.code Row
          ADD       ONE,DISNUMB
          COMPARE   NORECORD,DISNUMB
          GOTO      DGTAB100 IF NOT EQUAL
          GOTO      DGTAB999
.
DGTAB900  CALL      NOMORE00     * Display No More Records Message
.
DGTAB999  RETURN
.------------------------------------------------------------
.  Allied Health Diagnosis codes (TABLE ROW)
.------------------------------------------------------------
DGROW000  MATCH   "1",ALDIACTV
          IF      @EQUAL
             MOVE    "ACTIVE  ",ACTIDESC
          ELSE
             MOVE    "INACTIVE",ACTIDESC
          ENDIF
.
          MATCH   SP70,ALDIICD
          IF      @EQUAL
             MOVE    "&nbsp",ALDIICD
          ENDIF 
.
          MATCH   SP70,ACTIDESC
          IF      @EQUAL
             MOVE    "&nbsp",ACTIDESC
          ENDIF 
.
          MATCH     SP70,ALDISDAT
          IF        !@EQUAL
            UNPACK    ALDISDAT,CCENT,CYEAR,CMON,CDAY
            MOVE      CMON,F2
.
            LOAD      MTHNAM3,F2,JAN,FEB,MAR,APR,MAY,JUN,JUL,AUG,SEP,OCT,NOV,DEC
            PACK      SDATFRMT,CDAY,SP1,MTHNAM3,SP1,CCENT,CYEAR
          ENDIF     
.
          MATCH     SP70,ALDIEDAT
          IF        !@EQUAL
            UNPACK    ALDIEDAT,CCENT,CYEAR,CMON,CDAY
            MOVE      CMON,F2
.
            LOAD      MTHNAM3,F2,JAN,FEB,MAR,APR,MAY,JUN,JUL,AUG,SEP,OCT,NOV,DEC
            PACK      EDATFRMT,CDAY,SP1,MTHNAM3,SP1,CCENT,CYEAR
          ENDIF       
.
          WRITE     HTMLFILE;"<tr><td nowrap><A HREF='javascript:ShowDetail":
                             "(#"",LINKPRG,"#.pbl":
                             "?reportno=",LINKREP:
                             "&template=",LINKTEM:
                             "&deptcode=",DEPTCODE:
                             "&aldia002=",ALDIDIAG,"#")'>":
                             "<img src=../images/MaintenanceIcon.gif hspace=4":
                             " border=0 align=absmiddle></a>":
                             ALDIDIAG,"</td>":
                             "<td>",ALDIDESC,"</td>":
                             "<td align=center>",ALDIICD,"&nbsp;</td>":
                             "<td align=center>",ALDIMHDP,"&nbsp;</td>":
                             "<td align=center>",ALDIMHCP,"&nbsp;</td>":
                             "<td align=center>",SDATFRMT,"&nbsp;</td>":
                             "<td align=center>",EDATFRMT,"&nbsp;</td>":
                             "<td align=center>",ACTIDESC,"&nbsp</td>":
                             "</tr>"
.
          MOVE      SP70,EDATFRMT
          MOVE      SP70,SDATFRMT
.
DGROW999  RETURN
.------------------------------------------------------------
. Table of Allied Health Interventions Maintenance : Report 18
.------------------------------------------------------------
INTAB000  UNPACK    DIM127,D1,LINKPRG,DIM127
          UNPACK    DIM127,D1,LINKREP,DIM127
          UNPACK    DIM127,D1,LINKTEM,DIM127
.
          IF        NORECORD=0
            MOVE      PTCNNRTD,NORECORD      * Set Default No Records to Display
          ENDIF
          MOVE      ZERO,RECNUMB
          MOVE      ZERO,DISNUMB
.
          PACK      KEY12,DEPTCODE,STARTKEY,SP70
          CALL      RSALINC1
          CALL      RPALINC1
.
INTAB100  CALL      RKALINC1
          BRANCH    OVRCD,DGTAB999
.
          MATCH     DEPTCODE,ALINDEPT
          GOTO      INTAB900 IF NOT EQUAL
.
          ADD       ONE,RECNUMB
          IF        STARTNUM>=RECNUMB
            GOTO     INTAB100
          ENDIF
.
          CALL      INROW000                * Display Intervention Row
          ADD       ONE,DISNUMB
          COMPARE   NORECORD,DISNUMB
          GOTO      INTAB100 IF NOT EQUAL
          GOTO      INTAB999
.
INTAB900  CALL      NOMORE00     * Display No More Records Message
.
INTAB999  RETURN
.------------------------------------------------------------
.  Allied Health Intervention codes (TABLE ROW)
.------------------------------------------------------------
INROW000  MATCH   "1",ALINACTV
          IF      @EQUAL
             MOVE    "Inactive  ",ACTIDESC
          ELSE
             MOVE    "Active",ACTIDESC
          ENDIF
.
          MATCH   SP70,ACTIDESC
          IF      @EQUAL
             MOVE    "&nbsp",ACTIDESC
          ENDIF
.
          WRITE     HTMLFILE;"<tr><td nowrap><A HREF='javascript:ShowDetail":
                             "(#"",LINKPRG,"#.pbl":
                             "?reportno=",LINKREP:
                             "&template=",LINKTEM:
                             "&deptcode=",DEPTCODE:
                             "&alinc002=",ALINCODE,"#")'>":
                             "<img src=../images/MaintenanceIcon.gif hspace=4":
                             " border=0 align=absmiddle></a>":
                             ALINCODE,"</td>":
                             "<td>",ALINDESC,"</td>":
                             "<td align=center>",ACTIDESC,"&nbsp</td>":
                             "</tr>"
.
INROW999  RETURN
.---------------------------------------------------------------
.
.---------------------------------------------------------------
GEEQNM00  MOVE      " 0",KEY2
          PACK      KEY8,CCC,CYY,CMM,CDD
          REP       " 0",KEY8
          PACK      KEY22,KEY2,ALEQITEM,Z70
          CALL      RSPRIT1
GEEQNM10  CALL      RPPRIT1
          BRANCH    OVRCD,GETINM20
          COMPARE   ZERO,PRITFLAG
          GOTO      GEEQNM20 IF NOT EQUAL
          MATCH     ALEQITEM,PRITITMN
          GOTO      GEEQNM20 IF NOT EQUAL
          MATCH     KEY8,PRITDAT1
          GOTO      GEEQNM90 IF EQUAL
          GOTO      GEEQNM10 IF NOT LESS
          GOTO      GEEQNM90
.
GEEQNM20  MOVE      "&nbsp",PRITDESC
          MOVE      ONE,OVRCD
          GOTO      GETINM99
.
GEEQNM90  MOVE      ZERO,OVRCD
GEEQNM99  RETURN
.------------------------------------------------------------
. Validate Item
.------------------------------------------------------------
VALITM00  CALL      XMLHED00
          BRANCH    EXIT,VALITM99
.
          MOVE      ZERO,EFDTFLAG
          MATCH     SP70,VALDTYPE
          IF        @EQUAL
            MOVE      " 0",VALDTYPE
            GOTO      VALITM20
          ENDIF
.
          MATCH     "MB",VALDTYPE
          IF        @EQUAL
            MOVE      "M ",VALDTYPE              * allow 'MB' as well as 'M '
          ENDIF
.
          MATCH     "M ",VALDTYPE
          IF        @EQUAL
            MOVE      " 0",VALDTYPE
          ELSE
            MOVE      " 1",VALDTYPE
          ENDIF
.
VALITM20  PACK      KEY22,VALDTYPE,VALDCODE,VALDSCOD,Z70
          CALL      RSPRIT1
VALITM30  CALL      RPPRIT1
          BRANCH    OVRCD,VALITM90
.
          MOVE      PRITFLAG,KEY2
          MATCH     VALDTYPE,KEY2
          GOTO      VALITM90 IF NOT EQUAL
.
          MATCH     VALDCODE,PRITITMN
          GOTO      VALITM90 IF NOT EQUAL
.
          MATCH     SP70,VALDSCOD
          IF        !@EQUAL
            MATCH     VALDSCOD,PRITSUBN
            GOTO      VALITM90 IF NOT EQUAL
          ENDIF
.
          MATCH     SP70,VALDEFDT
          IF        !@EQUAL
            MOVE      ONE,EFDTFLAG
            MATCH     PRITDAT1,VALDEFDT
            GOTO      VALITM30 IF LESS
            MATCH     SP8,PRITDAT2          * test for a Cease Date   *I-230710
            IF        !@EQUAL
              MATCH     VALDEFDT,PRITDAT2
              GOTO      VALITM30 IF LESS    * read next if past Cease date
            ENDIF                                              * end  *I-230710
          ENDIF
.
          WRITE     HTMLFILE;"<RETURN_VALUE TYPE=SIMPLE>":
                             PRITDESC:
                             "</RETURN_VALUE>"
          GOTO      VALITM98
.
VALITM90  BRANCH    EFDTFLAG,VALITM91
          WRITE     HTMLFILE;"<RETURN_VALUE TYPE=ERROR>":
                             "Invalid Item Code - ":
                              VALDCODE,"</RETURN_VALUE>"
          GOTO      VALITM98
.
VALITM91  WRITE     HTMLFILE;"<RETURN_VALUE TYPE=ERROR>":
                             "Item not set up for effective date - ":
                              VALDCODE,"</RETURN_VALUE>"
          GOTO      VALITM98
.
VALITM98  CALL      XMLEND00
VALITM99  RETURN
.------------------------------------------------------------
. Validate Item (return amount)
.------------------------------------------------------------
VALMBS00  CALL      XMLHED00
          BRANCH    EXIT,VALMBS99
.
          MOVE      ZERO,EFDTFLAG
          MATCH     SP70,VALDTYPE
          IF        @EQUAL
            MOVE      " 0",VALDTYPE
            GOTO      VALMBS20
          ENDIF
.
          MATCH     "MBS",VALDTYPE
          IF        @EQUAL
            MOVE      " 0",VALDTYPE
          ELSE
            MOVE      " 1",VALDTYPE
          ENDIF
.
VALMBS20  PACK      KEY22,VALDTYPE,VALDCODE,VALDSCOD,Z70
          CALL      RSPRIT1
VALMBS30  CALL      RPPRIT1
          BRANCH    OVRCD,VALMBS90
.
          MOVE      PRITFLAG,KEY2
          MATCH     VALDTYPE,KEY2
          GOTO      VALMBS90 IF NOT EQUAL
.
          MATCH     VALDCODE,PRITITMN
          GOTO      VALMBS90 IF NOT EQUAL
.
          MATCH     SP70,VALDSCOD
          IF        !@EQUAL
            MATCH     VALDSCOD,PRITSUBN
            GOTO      VALMBS90 IF NOT EQUAL
          ENDIF
.
          MATCH     SP70,VALDEFDT
          IF        !@EQUAL
            MOVE      ONE,EFDTFLAG
            MATCH     PRITDAT1,VALDEFDT
            GOTO      VALMBS30 IF LESS
            MATCH     SP8,PRITDAT2
            IF        !@EQUAL
              MATCH   VALDEFDT,PRITDAT2
              GOTO    VALMBS30 IF LESS   *Read next if past Cease DATE
            ENDIF
          ENDIF
.
          WRITE     HTMLFILE;"<RETURN_VALUE TYPE=SIMPLE>":
                             PRITDESC,"|",PRITSFEE:
                             "</RETURN_VALUE>"
          GOTO      VALMBS98
.
VALMBS90  BRANCH    EFDTFLAG,VALMBS91
          WRITE     HTMLFILE;"<RETURN_VALUE TYPE=ERROR>":
                             "Invalid Item Code - ":
                              VALDCODE,"</RETURN_VALUE>"
          GOTO      VALMBS98
.
VALMBS91  WRITE     HTMLFILE;"<RETURN_VALUE TYPE=ERROR>":
                             "Item not set up for effective date - ":
                              VALDCODE,"</RETURN_VALUE>"
          GOTO      VALMBS98
.
VALMBS98  CALL      XMLEND00
VALMBS99  RETURN
.------------------------------------------------------------
. Validate a Supplier/Creditor code
.------------------------------------------------------------
VALSUP00  CALL      XMLHED00
          BRANCH    EXIT,VALSUP99
.
VALSUP20  PACK      KEY5,VALDSUPL,SP70
          CALL      RDAPMA1 
          BRANCH    OVRCD,VALSUP90
.
          WRITE     HTMLFILE;"<RETURN_VALUE TYPE=SIMPLE>":
                             APMACN1,"|",APMASCON:
                             "</RETURN_VALUE>"
          GOTO      VALSUP98
.
VALSUP90  WRITE     HTMLFILE;"<RETURN_VALUE TYPE=ERROR>":
                             "Invalid Supplier/Creditor Code - ":
                              KEY5,"</RETURN_VALUE>"
          GOTO      VALSUP98
.
VALSUP98  CALL      XMLEND00
VALSUP99  RETURN
.------------------------------------------------------------
. Process Predefined Diagnosis
.------------------------------------------------------------
ALLPDI00  RESET     UPDTTYPE
          MATCH     SP1,UPDTTYPE
          GOTO      ALLPDI40 IF EQUAL
.
          MATCH     "A",UPDTTYPE    * Add formaction
          GOTO      ALLPDI10 IF EQUAL
.
          MATCH     "U",UPDTTYPE    * Update formaction
          GOTO      ALLPDI20 IF EQUAL
.
          MATCH     "D",UPDTTYPE    * Delete formaction
          GOTO      ALLPDI30 IF EQUAL
.
          GOTO      ALLPDI93
.
.         ************ ADD FORMACTION ***********
.
ALLPDI10  MOVE      RDEPCODE,ALPDI001
          PACK      KEY12,ALPDI001,ALPDI002,SP70
          CALL      RAALPDI1
          COMPARE   ZERO,OVRCD
          GOTO      ALLPDI92 IF EQUAL
          CALL      MVALPD00                     * Move cgi to file variables
           
          PACK      KEY8,CCC,CYY,CMM,CDD
          REP       " 0",KEY8
          MOVE      KEY8,ALPDCDAT                * System date
          CLOCK     TIME,ALPDCTIM                * System time (Var chgd HPS)
          MOVE      USERID,ALPDCUID              * web user id
          MOVE      SP70,ALPDUDAT
          MOVE      SP70,ALPDUTIM
          MOVE      SP70,ALPDUUID
          PACK      KEY12,ALPDI001,ALPDI002,SP70 
          CALL      WRALPDI1                     * Writes the data
.
          MOVE      ZERO,EXIT
          GOTO      ALLPDI99
.
.         ************ UPDATE FORMACTION **********
.
ALLPDI20  MOVE      RDEPCODE,ALPDI001
          PACK      KEY12,ALPDI001,ALPDI002,SP70
          CALL      RDALPDI1
          BRANCH    OVRCD,ALLPDI91
          CALL      MVALPD00                     * Moves cgi to file variables
          PACK      KEY8,CCC,CYY,CMM,CDD
          REP       " 0",KEY8
          MOVE      KEY8,ALPDUDAT                * System Date
          CLOCK     TIME,ALPDUTIM                * System time (Var chgd HPS)
          MOVE      USERID,ALPDUUID              * web user id
          PACK      KEY12,ALPDI001,ALPDI002,SP70
          CALL      UPALPDI1                     * Updates the data
.
          MOVE      ZERO,EXIT
          GOTO      ALLPDI99
.
.         ************ DELETE FORMACTION **********
.
ALLPDI30  MOVE      RDEPCODE,ALPDI001
          PACK      KEY12,ALPDI001,ALPDI002,SP70
          CALL      RDALPDI1
          BRANCH    OVRCD,ALLPDI91
          CALL      DEALPDI1                     * Deletes the data
.
          MOVE      ZERO,EXIT
          GOTO      ALLPDI99
.
.
.         ************ DISPLAY FORMACTION **********
.
ALLPDI40  MOVE      RDEPCODE,ALPDI001
          PACK      KEY12,ALPDI001,ALPDI002,SP70
          CALL      RDALPDI1                      * Read service
          IF        OVRCD=1
            CALL      CLALLPDI                    * Clear all the file variables
          ENDIF
.
          CLEAR     WEBTITLE
          MOVE      "Predefined Diagnosis Maintenance",WEBTITLE
          RESET     WEBTITLE
.
          CALL      WEBHED00   * Create Output File and Write HTML Page Header
          BRANCH    EXIT,ALLPDI99
          CALL      WEBBOD00   * Process Web Body
          CALL      WEBEND00   * Process End of HTML File
          MOVE      ONE,EXIT
          GOTO      ALLPDI99
.
ALLPDI91  MOVE      "Predefined Diagnosis Does Not Exist",WEBTITLE
          CALL      WEBERR00
          MOVE      ONE,EXIT
          GOTO      ALLPDI99
.
ALLPDI92  MOVE      "Predefined Diagnosis Exists",WEBTITLE
          CALL      WEBERR00
          MOVE      ONE,EXIT
          GOTO      ALLPDI99
.
ALLPDI93  MOVE      "Invalid Form Action.",WEBTITLE
          CALL      WEBERR00
          MOVE      ONE,EXIT
          GOTO      ALLPDI99
.
ALLPDI94  MOVE      "Invalid Referring Department Code",WEBTITLE
          CALL      WEBERR00
          MOVE      ONE,EXIT
          GOTO      ALLPDI99
.
ALLPDI99  RETURN
.
.------------------------------------------------------------
. Hospital Selection List
.------------------------------------------------------------
HOSSEL00  UNPACK    DIM127,D1,KEY1,DIM127
          MOVE      ZERO,F1
          MOVE      KEY1,F1
          MATCH     SP70,ALDEHOSP
          GOTO      HOSSEL20 IF EQUAL
          PACK      KEY3,ALDEHOSP,SP70
          CALL      RDPTHSP1
          BRANCH    OVRCD,HOSSEL20
.
          BRANCH    F1,HOSSEL10,HOSSEL20
          WRITE     HTMLFILE;PTHSHOSP;
          GOTO      HOSSEL99
.
HOSSEL10  WRITE     HTMLFILE;PTHSNAME;
          GOTO      HOSSEL99
.
HOSSEL20  CALL      HSEL0000
.
HOSSEL99  RETURN
.------------------------------------------------------------
. Hospital Selection
.------------------------------------------------------------
HSEL0000  PACK      KEY3,SP70
          CALL      RSPTHSP1
HSEL0100  CALL      RKPTHSP1
          BRANCH    OVRCD,HSEL9999
.
          MOVE      PTHSNAME,KEY50
          PACK      KEY5,QUOTE,PTHSHOSP,QUOTE
          MATCH     ALDEHOSP,PTHSHOSP
          IF        @EQUAL
            WRITE     HTMLFILE;"<option value=",KEY5," selected>":
                               KEY50,"</option>"
          ELSE
            WRITE     HTMLFILE;"<option value=",KEY5,">",KEY50,"</option>"
          ENDIF
          GOTO      HSEL0100
.
HSEL9999  RETURN
.
.----------------------------------------------------------------
.    process case team details report 12
.----------------------------------------------------------------
ALLCAS00  RESET     UPDTTYPE
          MATCH     SP70,UPDTTYPE
          GOTO      ALLCAS40 IF EQUAL       * Display
.
          MATCH     "A",UPDTTYPE            * Add case team
          GOTO      ALLCAS10 IF EQUAL
.
          MATCH     "U",UPDTTYPE            * Update case team
          GOTO      ALLCAS20 IF EQUAL
.
          MATCH     "D",UPDTTYPE            * Delete case team
          GOTO      ALLCAS30 IF EQUAL

.          ************ ADD FORMACTION ***********

ALLCAS10  PACK      KEY10,TEAMCODE,SP70
          CALL      RDALCAS1
          COMPARE   ZERO,OVRCD
          GOTO      ALLCAS91 IF EQUAL       * if record exisits error
.
          CALL      MVALCA00                * get the cgi parameters
          MOVE      TEAMCODE,ALCATEAM
.
          PACK      KEY8,CCC,CYY,CMM,CDD
          REP       " 0",KEY8
          MOVE      KEY8,ALCACDAT
          CLOCK     TIME,ALCACTIM           * time record created
          MOVE      USERID,ALCACUID         * web user created
          MOVE      SP70,ALCAUDAT
          MOVE      SP70,ALCAUTIM
          MOVE      SP70,ALCAUUID
          MOVE      SP70,ALCASPAR
.
          CALL      WRALCAS1                * write a record
.
          MOVE      ZERO,EXIT
          GOTO      ALLCAS99
.
.          ************ UPDATE FORMACTION **********
.
ALLCAS20  PACK      KEY10,TEAMCODE,SP70
          CALL      RDALCAS1
          BRANCH    OVRCD,ALLCAS90          * error if record not found
.
          CALL      MVALCA00                * get the cgi parameters
.
          PACK      KEY8,CCC,CYY,CMM,CDD
          REP       " 0",KEY8
          MOVE      KEY8,ALCAUDAT
          CLOCK     TIME,ALCAUTIM           * time record updated
          MOVE      USERID,ALCAUUID         * web user updated
.
          CALL      UPALCAS1                * update the record
.
          MOVE      ZERO,EXIT
          GOTO      ALLCAS99
.
.          ************ DELETE FORMACTION **********
.
ALLCAS30  PACK      KEY10,TEAMCODE,SP70
          CALL      RDALCAS1
          BRANCH    OVRCD,ALLCAS90
.
          CALL      CHKDEL00
          BRANCH    EXIT,ALLCAS92
.
          CALL      DEALCAS1               * delete the record
.
          MOVE      ZERO,EXIT
          GOTO      ALLCAS99
.
.          ************ DISPLAY FORMACTION **********
.
ALLCAS40  PACK      KEY10,TEAMCODE,SP70
          CALL      RDALCAS1
          IF        OVRCD=1
            CALL      CLALCA00                  * Clear all the file variables
          ENDIF
.
          CALL      CLALCT00                    * Clear all the file variables
.
          CLEAR     WEBTITLE
          MOVE      "Case Team Maintenance",WEBTITLE
          RESET     WEBTITLE
.
          CALL      WEBHED00   * Create Output File and Write HTML Page Header
          BRANCH    EXIT,ALLCAS99
          CALL      WEBBOD00   * Process Web Body
          CALL      WEBEND00   * Process End of HTML File
          MOVE      ONE,EXIT
          GOTO      ALLCAS99
.
.         *********** ERROR CONDITIONS ***************
.
ALLCAS90  MOVE      "Case Team code does not exist.",WEBTITLE
          CALL      WEBERR00
          MOVE      ONE,EXIT
          GOTO      ALLCAS99
.
ALLCAS91  MOVE      "Case Team code already exists.",WEBTITLE
          CALL      WEBERR00
          MOVE      ONE,EXIT
          GOTO      ALLCAS99
.
ALLCAS92  MOVE      "Please remove all team members before deletion.",WEBTITLE
          CALL      WEBERR00
          MOVE      ONE,EXIT
          GOTO      ALLCAS99
.
ALLCAS99  RETURN
.
.----------------------------------------------------------------
.   output section of report no 12 and 13
.----------------------------------------------------------------
ALCC0000  BRANCH    FLDITMNO,ALCC0001,ALCC0002,ALCC0003,ALCC0004:
                             ALCC0005,ALCC0006,ALCC0007,ALCC0008
.
          WRITE     HTMLFILE;"Invalid IBA Tag";
          GOTO      ALCC9999
.
ALCC0001  CALL      CATAB000                * Case Team Table
          GOTO      ALCC9999
.
ALCC0002  CALL      NEXTCA00
          GOTO      ALCC9999
.
ALCC0003  CALL      PREVCA00
          GOTO      ALCC9999
.
ALCC0004  WRITE     HTMLFILE;TEAMCODE;
          GOTO      ALCC9999
.
ALCC0005  CALL      TETAB000                * Case Team Member Table
          GOTO      ALCC9999
.
ALCC0006  CALL      HCTAB000                * Case Teams for a HCP Table
          GOTO      ALCC9999
.
ALCC0007  WRITE     HTMLFILE;TEAMHCPC;      * HCP code
          GOTO      ALCC9999
.
ALCC0008  CALL      SSTAB000                * Search Case Teams
          GOTO      ALCC9999
.
ALCC9999  RETURN
.
.----------------------------------------------------------------
. Table of case teams : Report 12
.------------------------------------------------------------
CATAB000  UNPACK    DIM127,D1,LINKPRG,DIM127
          UNPACK    DIM127,D1,LINKREP,DIM127
          UNPACK    DIM127,D1,LINKTEM,DIM127
.
          IF        NORECORD=0
            MOVE      PTCNNRTD,NORECORD      * Set Default No Records to Display
          ENDIF
          MOVE      ZERO,RECNUMB
          MOVE      ZERO,DISNUMB
.
          PACK      KEY10,STARTKEY,SP70     * startkey for Goto Button
          CALL      RSALCAS1                * positional read
          CALL      RPALCAS1
CATAB100  CALL      RKALCAS1                * read a record
          BRANCH    OVRCD,CATAB900          * end of file
.
          ADD       ONE,RECNUMB
          IF        STARTNUM>=RECNUMB
            GOTO      CATAB100
          ENDIF
.
          CALL      CAROW000                * Display Row
          ADD       ONE,DISNUMB
          COMPARE   NORECORD,DISNUMB
          GOTO      CATAB100 IF NOT EQUAL
          GOTO      CATAB999
.
CATAB900  CALL      NOMORE00       * Display No More Records Message
.
CATAB999  RETURN
.-----------------------------------------------------------------
. Case team (TABLE ROW)
.------------------------------------------------------------
CAROW000  MATCH     "1",ALCAACTV
          IF        @EQUAL
            MOVE      "ACTIVE  ",ACTIDESC
            GOTO      CAROW010
          ENDIF
.
          MATCH     "2",ALCAACTV
          IF        @EQUAL
            MOVE      "ACTIVE  ",ACTIDESC
            GOTO      CAROW010
          ENDIF
.
          MOVE    "INACTIVE",ACTIDESC     * ALCAACTV = 0
          GOTO    CAROW010
.
CAROW010  PACK      KEY3,ALCAHOSP,SP70
          CALL      RDPTHSP1
          IF        OVRCD=1         
            MOVE      ALCAHOSP,PTHSNAME
          ENDIF
.
          WRITE     HTMLFILE;"<tr><td nowrap><A HREF='javascript:ShowDetail12":
                             "(#"",LINKPRG,"#.pbl":
                             "?reportno=",LINKREP:
                             "&template=",LINKTEM:
                             "&teamcode=",ALCATEAM,"#")'>":
                             "<img src=../images/MaintenanceIcon.gif hspace=4":
                             " border=0 align=absmiddle></a>":
                             ALCATEAM,"</td>":
                             "<td align=left>&nbsp",ALCADESC,"</td>":
                             "<td align=left>&nbsp",PTHSNAME,"</td>":
                             "<td align=left>&nbsp",ACTIDESC,"</td>":
                             "</tr>"
.
CAROW999 RETURN
.
.----------------------------------------------------------------
. Check for case team members before deleting case team Report 12
.------------------------------------------------------------
CHKDEL00  PACK      KEY20,TEAMCODE,SP70
          CALL      RSALCTM1
CHKDEL10  CALL      RKALCTM1
          BRANCH    OVRCD,CHKDEL90
.
          MATCH     TEAMCODE,ALCTTEAM
          GOTO      CHKDEL90 IF NOT EQUAL
.         
          MOVE      ONE,EXIT
          GOTO      CHKDEL99
.
CHKDEL90  MOVE      ZERO,EXIT
          GOTO      CHKDEL99
.
CHKDEL99  RETURN
.
.-----------------------------------------------------------
. Link to Next Group option 3
.-----------------------------------------------------------
NEXTCA00  MOVE      NORECORD,KEY2
          REP       " +",KEY2
          ASSIGN    STARTNUM+NORECORD,F3
          MOVE      F3,KEY3
          REP       " +",KEY3
          UNPACK    DIM127,D1,D3,DIM127
          MOVE      REPORTNO,F2
.
          REP       " +",ALCATEAM
          REP       " +",ALCTHCPC
.
          WRITE     HTMLFILE;"allweb01.pbl":
                                 "?reportno=",F2:
                                 "&template=",D3:
                                 "&startnum=",KEY3:
                                 "&norecord=",KEY2:
                                 "&teamcode=",ALCATEAM:
                                 "&alctm002=",ALCTHCPC:
                                 "&actvonly=",ACTVONLY:
                                 "&teamhcpc=",TEAMHCPC:
                                 "&startkey=",STARTKEY;
.
          REP       "+ ",ALCATEAM
          REP       "+ ",ALCTHCPC
.
NEXTCA99  RETURN
.
.-------------------------------------------------------------
. Link to Prev Group option 3
.-------------------------------------------------------------
PREVCA00  MOVE      NORECORD,KEY2
          REP       " +",KEY2
          ASSIGN    STARTNUM-NORECORD,F3
          IF        F3<0
            MOVE      ZERO,F3
          ENDIF
          MOVE      F3,KEY3
          REP       " +",KEY3
          UNPACK    DIM127,D1,FLDPARA,DIM127
          MOVE      REPORTNO,F2
.
          REP       " +",ALCATEAM
          REP       " +",ALCTHCPC
.
          WRITE     HTMLFILE;"allweb01.pbl":
                                "?reportno=",F2:
                                "&template=",FLDPARA:
                                "&startnum=",KEY3:
                                "&norecord=",KEY2:
                                "&teamcode=",ALCATEAM:
                                "&alctm002=",ALCTHCPC:
                                "&actvonly=",ACTVONLY:
                                "&teamhcpc=",TEAMHCPC:
                                "&startkey=",STARTKEY;
.
          REP       "+ ",ALCATEAM
          REP       "+ ",ALCTHCPC
.
PREVCA99  RETURN
.
.----------------------------------------------------------------
.    process case team member details report 13
.----------------------------------------------------------------
ALLTEA00  RESET     UPDTTYPE
          MATCH     SP70,UPDTTYPE
          GOTO      ALLTEA40 IF EQUAL       * Display
.
          MATCH     "A",UPDTTYPE            * Add case team
          GOTO      ALLTEA10 IF EQUAL
.
          MATCH     "U",UPDTTYPE            * Update case team
          GOTO      ALLTEA20 IF EQUAL
.
          MATCH     "D",UPDTTYPE            * Delete case team
          GOTO      ALLTEA30 IF EQUAL

.          ************ ADD FORMACTION ***********

ALLTEA10  PACK      KEY20,TEAMCODE,ALCTM002,SP70
          CALL      RDALCTM1
          COMPARE   ZERO,OVRCD
          GOTO      ALLTEA91 IF EQUAL       * if record exisits error
.
          CALL      MVALCT00                * get the cgi parameters
          MOVE      TEAMCODE,ALCTTEAM
.
          PACK      KEY8,CCC,CYY,CMM,CDD
          REP       " 0",KEY8
          MOVE      KEY8,ALCTCDAT
          CLOCK     TIME,ALCTCTIM           * time record created
          MOVE      USERID,ALCTCUID         * web user created
          MOVE      SP70,ALCTUDAT
          MOVE      SP70,ALCTUTIM
          MOVE      SP70,ALCTUUID
          MOVE      SP70,ALCTSPAR
.
          CALL      WRALCTM1                * write a record
.
          MOVE      ZERO,EXIT
          GOTO      ALLTEA99
.
.          ************ UPDATE FORMACTION **********
.
ALLTEA20  PACK      KEY20,TEAMCODE,ALCTM002,SP70
          CALL      RDALCTM1
          BRANCH    OVRCD,ALLTEA90          * error if record not found
.
          CALL      MVALCT00                * get the cgi parameters
.
          PACK      KEY8,CCC,CYY,CMM,CDD
          REP       " 0",KEY8
          MOVE      KEY8,ALCTUDAT
          CLOCK     TIME,ALCTUTIM           * time record updated
          MOVE      USERID,ALCTUUID         * web user updated
.
          CALL      UPALCTM1                * update the record
.
          MOVE      ZERO,EXIT
          GOTO      ALLTEA99
.
.          ************ DELETE FORMACTION **********
.
ALLTEA30  PACK      KEY20,TEAMCODE,ALCTM002,SP70
          CALL      RDALCTM1
          BRANCH    OVRCD,ALLTEA90
.
          CALL      DEALCTM1               * delete the record
.
          MOVE      ZERO,EXIT
          GOTO      ALLTEA99
.
.          ************ DISPLAY FORMACTION **********
.
ALLTEA40  PACK      KEY10,TEAMCODE,SP70
          CALL      RDALCAS1
          IF        OVRCD=1
            CALL      CLALCA00                    * Clear all the file variables
          ENDIF
.
          PACK      KEY20,TEAMCODE,ALCTM002,SP70
          CALL      RDALCTM1
          IF        OVRCD=1
            CALL      CLALCT00                    * Clear all the file variables
          ENDIF
.
          CLEAR     WEBTITLE
          MOVE      "Case Team Member Maintenance",WEBTITLE
          RESET     WEBTITLE
.
          CALL      WEBHED00   * Create Output File and Write HTML Page Header
          BRANCH    EXIT,ALLTEA99
          CALL      WEBBOD00   * Process Web Body
          CALL      WEBEND00   * Process End of HTML File
          MOVE      ONE,EXIT
          GOTO      ALLTEA99
.
.         *********** ERROR CONDITIONS ***************
.
ALLTEA90  MOVE      "Case team member code does not exist.",WEBTITLE
          CALL      WEBERR00
          MOVE      ONE,EXIT
          GOTO      ALLTEA99
.
ALLTEA91  MOVE      "Case team member code already exists.",WEBTITLE
          CALL      WEBERR00
          MOVE      ONE,EXIT
          GOTO      ALLTEA99
.
ALLTEA99  RETURN
.
.----------------------------------------------------------------
. Table of case team members : Report 13
.------------------------------------------------------------
TETAB000  UNPACK    DIM127,D1,LINKPRG,DIM127
          UNPACK    DIM127,D1,LINKREP,DIM127
          UNPACK    DIM127,D1,LINKTEM,DIM127
.
          IF        NORECORD=0
            MOVE      PTCNNRTD,NORECORD      * Set Default No Records to Display
          ENDIF
          MOVE      ZERO,RECNUMB
          MOVE      ZERO,DISNUMB
.
          PACK      KEY20,TEAMCODE,STARTKEY,SP70     * startkey for Goto Button
          CALL      RSALCTM1                * positional read
          CALL      RPALCTM1
TETAB100  CALL      RKALCTM1                * read a record
          BRANCH    OVRCD,TETAB900          * end of file
.
          MATCH     TEAMCODE,ALCTTEAM
          GOTO      TETAB900 IF NOT EQUAL
.
          ADD       ONE,RECNUMB
          IF        STARTNUM>=RECNUMB
            GOTO      TETAB100
          ENDIF
.
          CALL      TEROW000                * Display Row
          ADD       ONE,DISNUMB
          COMPARE   NORECORD,DISNUMB
          GOTO      TETAB100 IF NOT EQUAL
          GOTO      TETAB999
.
TETAB900  CALL      NOMORE00      * Display No More Records Message
.
TETAB999  RETURN
.-----------------------------------------------------------------
. Case team members (TABLE ROW)
.------------------------------------------------------------
TEROW000  MOVE      SP70,DOCFNAME
          PACK      KEY10,ALCTHCPC,SP70
          CALL      RDPMHCP1
          IF        OVRCD=0
            MOVE      PMHCTITL,FMTTITLE
            MOVE      PMHCGNAM,FMTGNAME
            MOVE      PMHCSNAM,FMTSNAME
            CALL      DOCNM000
          ENDIF
.
          MATCH     SP70,ALCTSDAT
          IF        !@EQUAL
            UNPACK    ALCTSDAT,CCENT,CYEAR,CMON,CDAY
            MOVE      CMON,F2
            LOAD      MTHNAM3,F2,JAN,FEB,MAR,APR,MAY,JUN,JUL,AUG,SEP,OCT,NOV,DEC
            PACK      DISPDAT1,CDAY,SP1,MTHNAM3,SP1,CCENT,CYEAR
          ELSE
            MOVE      SP70,DISPDAT1
          ENDIF
.
          MATCH     SP70,ALCTEDAT
          IF        !@EQUAL
            UNPACK    ALCTEDAT,CCENT,CYEAR,CMON,CDAY
            MOVE      CMON,F2
            LOAD      MTHNAM3,F2,JAN,FEB,MAR,APR,MAY,JUN,JUL,AUG,SEP,OCT,NOV,DEC
            PACK      DISPDAT2,CDAY,SP1,MTHNAM3,SP1,CCENT,CYEAR
          ELSE
            MOVE      SP70,DISPDAT2
          ENDIF
.
          WRITE     HTMLFILE;"<tr><td nowrap><A HREF='javascript:ShowDetail13":
                             "(#"",LINKPRG,"#.pbl":
                             "?reportno=",LINKREP:
                             "&template=",LINKTEM:
                             "&teamcode=",ALCTTEAM:
                             "&alctm002=",ALCTHCPC,"#")'>":
                             "<img src=../images/MaintenanceIcon.gif hspace=4":
                             " border=0 align=absmiddle></a>":
                             ALCTHCPC,"</td>":
                             "<td align=left>&nbsp",DOCFNAME,"</td>":
                             "<td align=center>&nbsp",DISPDAT1,"</td>":
                             "<td align=center>&nbsp",DISPDAT2,"</td>":
                             "</tr>"
.
TEROW999 RETURN
.
.----------------------------------------------------------------
. Table of case teams for a HCP: Report 13
.------------------------------------------------------------
HCTAB000  UNPACK    DIM127,D1,LINKPRG,DIM127
          UNPACK    DIM127,D1,LINKREP,DIM127
          UNPACK    DIM127,D1,LINKTEM,DIM127
.
          IF        NORECORD=0
            MOVE      "10",NORECORD         * Set Default No Records to Display
          ENDIF
          MOVE      ZERO,RECNUMB
          MOVE      ZERO,DISNUMB
.
          PACK      KEY20,TEAMHCPC,SP70     * startkey for Goto Button
          CALL      RSALCTM2                * positional read
          CALL      RPALCTM2
HCTAB100  CALL      RKALCTM2                * read a record
          BRANCH    OVRCD,HCTAB999          * end of file
.
          MATCH     TEAMHCPC,ALCTHCPC
          GOTO      HCTAB999 IF NOT EQUAL
.
          ADD       ONE,RECNUMB
          IF        STARTNUM>=RECNUMB
            GOTO      HCTAB100
          ENDIF
.
          CALL      HCROW000                * Display Row
          ADD       ONE,DISNUMB
          COMPARE   NORECORD,DISNUMB
          GOTO      HCTAB100 IF NOT EQUAL
.
HCTAB999  RETURN
.-----------------------------------------------------------------
. Case team members (TABLE ROW)
.------------------------------------------------------------
HCROW000  MATCH     SP70,ALCTSDAT
          IF        !@EQUAL
            UNPACK    ALCTSDAT,CCENT,CYEAR,CMON,CDAY
            MOVE      CMON,F2
            LOAD      MTHNAM3,F2,JAN,FEB,MAR,APR,MAY,JUN,JUL,AUG,SEP,OCT,NOV,DEC
            PACK      DISPDAT1,CDAY,SP1,MTHNAM3,SP1,CCENT,CYEAR
          ELSE
            MOVE      SP70,DISPDAT1
          ENDIF
.
          MATCH     SP70,ALCTEDAT
          IF        !@EQUAL
            UNPACK    ALCTEDAT,CCENT,CYEAR,CMON,CDAY
            MOVE      CMON,F2
            LOAD      MTHNAM3,F2,JAN,FEB,MAR,APR,MAY,JUN,JUL,AUG,SEP,OCT,NOV,DEC
            PACK      DISPDAT2,CDAY,SP1,MTHNAM3,SP1,CCENT,CYEAR
          ELSE
            MOVE      SP70,DISPDAT2
          ENDIF
.
          PACK      KEY10,ALCTTEAM,SP70
          CALL      RDALCAS1
          IF        OVRCD=1
            CALL      CLALCA00                    * Clear all the file variables
          ENDIF
.
          WRITE     HTMLFILE;"<tr><td nowrap><A HREF='javascript:ShowDetail13A":
                             "(#"",LINKPRG,"#.pbl":
                             "?reportno=",LINKREP:
                             "&template=",LINKTEM:
                             "&teamcode=",ALCTTEAM:
                             "&alctm002=",ALCTHCPC,"#")'>":
                             "<img src=../images/MaintenanceIcon.gif hspace=4":
                             " border=0 align=absmiddle></a>":
                             ALCTTEAM,"</td>":
                             "<td align=left>&nbsp",ALCADESC,"</td>":
                             "<td align=center>&nbsp",DISPDAT1,"</td>":
                             "<td align=center>&nbsp",DISPDAT2,"</td>":
                             "</tr>"
.
HCROW999 RETURN
.
.----------------------------------------------------------------
. Search of case teams : Report 13
.------------------------------------------------------------
SSTAB000  UNPACK    DIM127,D1,LINKPRG,DIM127
          UNPACK    DIM127,D1,LINKREP,DIM127
          UNPACK    DIM127,D1,LINKTEM,DIM127
.
          CALL      SSHED000                * Heading
.
          IF        NORECORD=0
            MOVE      "10",NORECORD         * Set Default No Records to Display
          ENDIF
          MOVE      ZERO,RECNUMB
          MOVE      ZERO,DISNUMB
.
          PACK      KEY50,STARTKEY,SP70     * startkey for Goto Button
          CALL      RSALCAS2                * positional read
SSTAB100  CALL      RKALCAS2                * read a record
          BRANCH    OVRCD,SSTAB999          * end of file
.
          MATCH     "1",ACTVONLY            * Display Active records only?
          GOTO      SSTAB110 IF NOT EQUAL   * No, display any record
.
          MATCH     "1",ALCAACTV            * Is Active?
          GOTO      SSTAB110 IF EQUAL       * Yes, display record
.
          MATCH     "2",ALCAACTV            * Is Active, exclude from PRIMHD?
          GOTO      SSTAB110 IF EQUAL       * Yes, display record
          GOTO      SSTAB100 IF NOT EQUAL   * No, fetch next row
.
SSTAB110  IF        IBCNMHOS=1
            MATCH     WBSEHOSP,ALCAHOSP     * Check hospital if multi hosp
            GOTO      SSTAB100 IF NOT EQUAL
          ENDIF
.
          ADD       ONE,RECNUMB
          IF        STARTNUM>=RECNUMB
            GOTO      SSTAB100
          ENDIF
.
          CALL      SSROW000                * Display Row
          ADD       ONE,DISNUMB
          COMPARE   NORECORD,DISNUMB
          GOTO      SSTAB100 IF NOT EQUAL
.
SSTAB999  RETURN
.-----------------------------------------------------------------
. Case team search (TABLE ROW)
.------------------------------------------------------------
SSROW000  MATCH     "1",ALCAACTV             *Active
          IF        @EQUAL
            MOVE      "ACTIVE  ",ACTIDESC
            GOTO      SSROW010
          ENDIF
.
          MATCH     "2",ALCAACTV
          IF        @EQUAL
            MOVE      "ACTIVE  ",ACTIDESC    *Active - exclude from PRIMHD
            GOTO       SSROW010
          ENDIF
.
          MOVE    "INACTIVE",ACTIDESC
          GOTO    SSROW010
.
SSROW010  MOVE      SP70,PTHSNAME
          PACK      KEY3,ALCAHOSP,SP70
          CALL      RDPTHSP1
.
          WRITE     HTMLFILE;"<tr><td nowrap><A HREF=#"":
                             "javascript:updateParent13('",ALCADESC:
                             "','",ALCATEAM,"')#">":
                             "<img src=../images/MaintenanceIcon.gif hspace=4":
                             " border=0 align=absmiddle></a>":
                             ALCATEAM,"</td>":
                             "<td align=left>&nbsp",ALCADESC,"</td>":
                             "<td align=left>&nbsp",ACTIDESC,"</td>":
                             "</tr>"
.
SSROW999 RETURN
.
.------------------------------------------------------------
. Search Case Team  (TABLE HEADING)
.------------------------------------------------------------
SSHED000  WRITE     HTMLFILE;"<tr>":
                               "<td class=HeadingCell width=15%>":
                               "<b>Case Team</b></td>":
                               "<td class=HeadingCell>":
                               "<b>Description</b></td>":
                               "<td class=HeadingCell>":
                               "<b>Active</b></td>":
                             "</tr>"
.
SSHED999  RETURN
.------------------------------------------------------------
. Referral Letters Details
.------------------------------------------------------------
ALLLET00  CALL      CLALLLET
          MATCH     SP70,UPDTTYPE      * Display
          GOTO      ALLLET50 IF EQUAL
.
          MATCH     "A",UPDTTYPE       * Add New
          GOTO      ALLLET10 IF EQUAL

          MATCH     "U",UPDTTYPE       * Update
          GOTO      ALLLET20 IF EQUAL

          MATCH     "D",UPDTTYPE       * Delete
          GOTO      ALLLET30 IF EQUAL
.
          MOVE      "Invalid Update Type",WEBTITLE
          CALL      WEBERR00
          GOTO      ALLLET99
.
ALLLET10  CALL      ADDLET00
          GOTO      ALLLET99
.
ALLLET20  CALL      UPDLET00
          GOTO      ALLLET99
.
ALLLET30  CALL      DELLET00
          GOTO      ALLLET99
.
ALLLET50  SQUEEZE   ALLET001
          MOVE      ALLET001,F3
          MOVE      F3,KEY3
          MOVE      ZERO,F3
          PACK      KEY6,KEY3,F3
          CALL      RDALLET1
          IF        OVRCD=1
            CALL      CLALLLET
          ENDIF
          MOVE      "Referral Letters",WEBTITLE
          CALL      WEBHED00
          BRANCH    EXIT,ALLLET99
          CALL      WEBBOD00
          CALL      WEBEND00
.
ALLLET99  RETURN
.------------------------------------------------------------
. Default Letter Details for departments
.------------------------------------------------------------
DEFLET00  CALL      CLRDLL00
          MATCH     SP70,UPDTTYPE      * Display
          GOTO      DEFLET50 IF EQUAL
.
          MATCH     "U",UPDTTYPE       * Update
          GOTO      DEFLET20 IF EQUAL
.
          MOVE      "Invalid Update Type",WEBTITLE
          CALL      WEBERR00
          GOTO      DEFLET99
.
DEFLET20  CALL      UPDDLT00
          GOTO      DEFLET99
.
DEFLET50  PACK      KEY3,DEPTCODE,SP70
          CALL      RDALDLL1
          IF        OVRCD=1
            CALL      CLRDLL00
          ENDIF
          MOVE      "Default Letters",WEBTITLE
          CALL      WEBHED00
          BRANCH    EXIT,DEFLET99
          CALL      WEBBOD00
          CALL      WEBEND00
.
DEFLET99  RETURN
+
.------------------------------------------------------------
. Medication Maintenance  
.------------------------------------------------------------
ALLMED00  CALL      CLALLMED
          MATCH     SP70,UPDTTYPE      * Display
          GOTO      ALLMED50 IF EQUAL
.
          MATCH     "A",UPDTTYPE       * Add New
          GOTO      ALLMED10 IF EQUAL

          MATCH     "U",UPDTTYPE       * Update
          GOTO      ALLMED20 IF EQUAL

          MATCH     "D",UPDTTYPE       * Delete
          GOTO      ALLMED30 IF EQUAL
.
          MOVE      "Invalid Update Type",WEBTITLE
          CALL      WEBERR00
          GOTO      ALLMED99
.
ALLMED10  CALL      ADDMED00
          GOTO      ALLMED99
.
ALLMED20  CALL      UPDMED00
          GOTO      ALLMED99
.
ALLMED30  CALL      DELMED00
          GOTO      ALLMED99
.
ALLMED50  PACK      KEY20,ALMED001,SP70
          CALL      RDALMED1
          IF        OVRCD=1
            CALL      CLALLMED
          ENDIF
          MOVE      "Medication Maintenance",WEBTITLE
          CALL      WEBHED00
          BRANCH    EXIT,ALLMED99
          CALL      WEBBOD00
          CALL      WEBEND00
.
ALLMED99  RETURN
.------------------------------------------------------------
. Add Medication
.------------------------------------------------------------
ADDMED00  CALL      CLALLMED
          PACK      ALMECODE,ALMED001,SP70
          PACK      KEY20,ALMECODE,SP70
          CALL      RDALMED1
          IF        OVRCD=1
            CALL      MVMED000
            CALL      WRALMED1
            PROC      ALLMKIUP        * Updates keyword index
            CALL      WINCLS00
          ELSE
            MOVE      "Medication Code already on file",WEBTITLE
            CALL      WEBERR00
          ENDIF
          RETURN
.------------------------------------------------------------
. Update Medication
.------------------------------------------------------------
UPDMED00  CALL      CLALLMED
          PACK      ALMECODE,ALMED001,SP70
          PACK      KEY20,ALMECODE,SP70
          CALL      RDALMED1
          IF        OVRCD=0
            CALL      MVMED000
            CALL      UPALMED1
            PROC      ALLMKIUP        * Updates keyword index
            CALL      WINCLS00
          ELSE
            MOVE      "Medication not on file",WEBTITLE
            CALL      WEBERR00
          ENDIF
          RETURN
.------------------------------------------------------------
. Delete Medication
.------------------------------------------------------------
DELMED00  PACK      KEY20,ALMECODE,SP70
          CALL      RDALMED1
          IF        OVRCD=0
            CALL      DEALMED1
            PROC      ALLMKIUP        * Updates keyword index
            CALL      WINCLS00
          ELSE
            MOVE      "Medication not on file",WEBTITLE
            CALL      WEBERR00
          ENDIF
          RETURN
.------------------------------------------------------------
. Move in Medication Details
.------------------------------------------------------------
MVMED000  MATCH     Z70,ALMED001
          IF        !@EQUAL
            PACK       ALMECODE,ALMED001,SP70
          ENDIF
          MATCH     Z70,ALMED002
          IF        !@EQUAL
            PACK       ALMEDESC,ALMED002,SP70
          ENDIF
          MATCH     Z70,ALMED003
          IF        !@EQUAL
            PACK       ALMEACTV,ALMED003,SP70
          ENDIF
          MATCH     Z70,ALMED004
          IF        !@EQUAL
            PACK       ALMEUNIT,ALMED004,SP70
          ENDIF
          MATCH     Z70,ALMED005
          IF        !@EQUAL
            PACK       ALMEGENR,ALMED005,SP70
          ENDIF
          MATCH     Z70,ALMED006
          IF        !@EQUAL
            PACK       ALMEMEDR,ALMED006,SP70
          ENDIF
          MATCH     Z70,ALMED007
          IF        !@EQUAL
            PACK       ALMEIVAD,ALMED007,SP70
          ENDIF
          MATCH     Z70,ALMED008
          IF        !@EQUAL
            PACK       ALMEINVC,ALMED008,SP70
          ENDIF
          MATCH     Z70,ALMED009
          IF        !@EQUAL
            PACK       ALMEMEDT,ALMED009,SP70
          ENDIF
.
MVMED999  RETURN
.
.-------------------------------------------------------------------------------
.  Set Parameters for medication maintenance
.-------------------------------------------------------------------------------
STMED000  UNPACK    QRYNAME,KEY5,KEY3
          MOVE      ZERO,F3
          MOVE      KEY3,F3
          STORE     QRYDATA,F3,ALMED001,ALMED002,ALMED003,ALMED004,ALMED005:
                               ALMED006,ALMED007,ALMED008,ALMED009
          RETURN
.------------------------------------------------------------------------------
. Clear medication file
.------------------------------------------------------------------------------
CLALLMED  MOVE      SP70,ALMECODE
          MOVE      SP70,ALMEDESC
          MOVE      SP70,ALMEACTV
          MOVE      SP70,ALMEUNIT
          MOVE      SP70,ALMEGENR
          MOVE      SP70,ALMEMEDR
          MOVE      SP70,ALMEIVAD
          MOVE      SP70,ALMEINVC
          MOVE      SP70,ALMEMEDT
          RETURN
.-------------------------------------------------------------------------------
.  Set Parameters
.-------------------------------------------------------------------------------
STLET000  UNPACK    QRYNAME,KEY5,KEY3
          MOVE      ZERO,F3
          MOVE      KEY3,F3
          STORE     QRYDATA,F3,ALLET001,ALLET002,ALLET003,ALLET004,ALLET005:
                               ALLET006,ALLET007,ALLET008,ALLET009
          RETURN
.------------------------------------------------------------------------------
. Clear letter file
.------------------------------------------------------------------------------
CLALLLET  MOVE      ZERO,ALLTLTNO
          MOVE      ZERO,ALLTLINO
          MOVE      SP70,ALLTTEXT
          MOVE      ZERO,ALLTLVAR
          MOVE      ZERO,ALLTPBOT
          MOVE      ZERO,ALLTPTOP
          MOVE      ZERO,ALLTPPAG
          MOVE      ZERO,ALLTPTAB
          MOVE      SP70,ALLTMMFN
          MOVE      SP70,ALLTTYPE
          MOVE      SP70,ALLTACTV
          MOVE      SP70,ALLTSPAR
          RETURN
.------------------------------------------------------------
. Add Letter
.------------------------------------------------------------
ADDLET00  CALL      CLALLLET
          SQUEEZE   ALLET001
          MOVE      ALLET001,ALLTLTNO
          MOVE      ZERO,ALLTLINO
          PACK      KEY6,ALLTLTNO,ALLTLINO,SP70
          CALL      RDALLET1
          IF        OVRCD=1
            CALL      MVLET000
            CALL      WRALLET1
            CALL      LETDET00  * Update Letter Details
            CALL      WINCLS00
          ELSE
            MOVE      "Letter Already on File",WEBTITLE
            CALL      WEBERR00
          ENDIF
          RETURN
.------------------------------------------------------------
. Update Letters 
.------------------------------------------------------------
UPDLET00  CALL      CLALLLET
          SQUEEZE   ALLET001
          MOVE      ALLET001,ALLTLTNO
          MOVE      ZERO,ALLTLINO
          PACK      KEY6,ALLTLTNO,ALLTLINO,SP70
          CALL      RDALLET1
          IF        OVRCD=0
            CALL      MVLET000
            CALL      UPALLET1
            CALL      LETDET00  * Update Letter Details
            CALL      WINCLS00
          ELSE
            MOVE      "Letter Not On File",WEBTITLE
            CALL      WEBERR00
          ENDIF
          RETURN
.------------------------------------------------------------
. Update Default Letters
.------------------------------------------------------------
UPDDLT00  CALL      CLRDLL00
          PACK      KEY3,DEPTCODE,SP70
          CALL      RDALDLL1
          IF        OVRCD=0
            PACK      ALDLDEPT,DEPTCODE,SP70
            CALL      MVDLL000
            CALL      UPALDLL1
          ELSE
            PACK      ALDLDEPT,DEPTCODE,SP70
            CALL      MVDLL000
            CALL      WRALDLL1
          ENDIF
          CALL      WINCLS00
          RETURN
.------------------------------------------------------------
. Delete Extract
.------------------------------------------------------------
DELLET00  SQUEEZE   ALLET001
          MOVE      ALLET001,ALLTLTNO
          MOVE      ZERO,ALLTLINO
          PACK      KEY6,ALLTLTNO,ALLTLINO,SP70
          CALL      RDALLET1
          IF        OVRCD=0
            CALL      DEALLET1
            CALL      LETDET00
            CALL      WINCLS00
          ELSE
            MOVE      "Letter Not On File",WEBTITLE
            CALL      WEBERR00
          ENDIF
          RETURN
.------------------------------------------------------------
. Move in Letter Details
.------------------------------------------------------------
MVLET000  MATCH     Z70,ALLET001
          IF        !@EQUAL
            SQUEEZE    ALLET001
            MOVE       ALLET001,ALLTLTNO
          ENDIF
          MATCH     Z70,ALLET002
          IF        !@EQUAL
            MOVE       ALLET002,ALLTTEXT
          ENDIF
          MATCH     Z70,ALLET003
          IF        !@EQUAL
            SQUEEZE    ALLET003
            MOVE       ALLET003,ALLTPBOT
          ENDIF
          MATCH     Z70,ALLET004
          IF        !@EQUAL
            SQUEEZE    ALLET004
            MOVE       ALLET004,ALLTPTOP
          ENDIF
          MATCH     Z70,ALLET005
          IF        !@EQUAL
            SQUEEZE    ALLET005
            MOVE       ALLET005,ALLTPPAG
          ENDIF
          MATCH     Z70,ALLET006
          IF        !@EQUAL
            SQUEEZE    ALLET006
            MOVE       ALLET006,ALLTPTAB
          ENDIF
          MATCH     Z70,ALLET007
          IF        !@EQUAL
            MOVE       ALLET007,ALLTMMFN
          ENDIF
          MATCH     Z70,ALLET008
          IF        !@EQUAL
            MOVE       ALLET008,ALLTTYPE
          ENDIF
          MATCH     Z70,ALLET009
          IF        !@EQUAL
            MOVE       ALLET009,ALLTACTV
          ENDIF
.
MVLET999  RETURN
.
.------------------------------------------------------------
. Move in Default Letter Details
.------------------------------------------------------------
MVDLL000  MATCH     Z70,ALDLL001
          IF        !@EQUAL
            MOVE       ALDLL001,ALDLRACP
          ENDIF
.
          MATCH     Z70,ALDLL002
          IF        !@EQUAL
            MOVE       ALDLL002,ALDLRACR
          ENDIF
.
          MATCH     Z70,ALDLL003
          IF        !@EQUAL
            MOVE       ALDLL003,ALDLURAP
          ENDIF
.
          MATCH     Z70,ALDLL004
          IF        !@EQUAL
            MOVE       ALDLL004,ALDLURAR
          ENDIF
.
          MATCH     Z70,ALDLL005
          IF        !@EQUAL
            MOVE       ALDLL005,ALDLRPAT
          ENDIF
.
          MATCH     Z70,ALDLL006
          IF        !@EQUAL
            MOVE       ALDLL006,ALDLRREF
          ENDIF
.
          MATCH     Z70,ALDLL007
          IF        !@EQUAL
            MOVE       ALDLL007,ALDLPLAB
          ENDIF
.
          MATCH     Z70,ALDLL008
          IF        !@EQUAL
            MOVE       ALDLL008,ALDLRACG
          ENDIF
.
          MATCH     Z70,ALDLL009
          IF        !@EQUAL
            MOVE       ALDLL009,ALDLURAG
          ENDIF
.
          MATCH     Z70,ALDLL010
          IF        !@EQUAL
            MOVE       ALDLL010,ALDLRRJG
          ENDIF
.
          RETURN
.------------------------------------------------------------
. LETDET000
.------------------------------------------------------------
LETDET00  SQUEEZE   ALLET001
          MOVE      ALLET001,ALLTLTNO
          MOVE      ALLET001,LETTNUMB
          MOVE      ZERO,ALLTLINO
          PACK      KEY6,ALLTLTNO,ALLTLINO,SP70
          CALL      RDALLET1
LETDET10  CALL      RKALLET1
          BRANCH    OVRCD,LETDET20
          COMPARE   ALLTLTNO,LETTNUMB
          GOTO      LETDET20 IF NOT EQUAL
          PACK      KEY6,ALLTLTNO,ALLTLINO,SP70
          CALL      DEALLET1
          CALL      RSALLET1
          GOTO      LETDET10
.
LETDET20  MATCH     "D",UPDTTYPE
          GOTO      LETDET99 IF EQUAL
          COMPARE   ZERO,ALLEEND
          GOTO      LETDET99 IF EQUAL
          CALL      CLALLLET
          MOVE      ZERO,F3
LETDET30  ADD       ONE,F3
          MOVE      LETTNUMB,ALLTLTNO
          MOVE      F3,ALLTLINO
          PACK      KEY6,ALLTLTNO,ALLTLINO,SP70
          CALL      RDALLET1
          IF        OVRCD=0
            MOVE      ZERO,ALLTLVAR
            SCAN      SPECCHAR,ALLECOMM[F3]
            IF        @EQUAL
              MOVE      ONE,ALLTLVAR
            ENDIF
            RESET     ALLECOMM[F3]
            MOVE      ALLECOMM[F3],ALLTTEXT
            CALL      UPALLET1
          ELSE
            MOVE      ZERO,ALLTLVAR
            SCAN      SPECCHAR,ALLECOMM[F3]
            IF        @EQUAL
              MOVE      ONE,ALLTLVAR
            ENDIF
            RESET     ALLECOMM[F3]
            MOVE      ALLECOMM[F3],ALLTTEXT
            CALL      WRALLET1
          ENDIF
          COMPARE   F3,ALLEEND
          GOTO      LETDET30 IF NOT EQUAL
LETDET99  RETURN
.------------------------------------------------------------
. Get Text
.------------------------------------------------------------
GLTEXT00  ADD       ONE,ALLEEND
          MOVE      QRYDATA,ALLECOMM[ALLEEND]
          RESET     ALLECOMM[ALLEEND]
.
GLTEXT10  READ      CONFFILE,SEQ;QRYNAME,QRYDATA * Read CONFFILE sequentially
          GOTO      GLTEXT99 IF OVER             * If end of file
          MATCH     SP70,QRYNAME                 * If next CGI parameter
          GOTO      GLTEXT80 IF NOT EQUAL
          ADD       ONE,ALLEEND                    * Increment Array Counter
          PACK      ALLECOMM[ALLEEND],QRYDATA,SP70 * Input Note to Array
          IF        ALLEEND>=999
            GOTO      GLTEXT99
          ENDIF
          GOTO      GLTEXT10
.
GLTEXT80  MOVE      ONE,TEXTAREA                 * Flag for Next CGI Parameter
GLTEXT99  RETURN
.------------------------------------------------------------
. Letter Variables
.------------------------------------------------------------
LETF0000  BRANCH    FLDITMNO,LETF0100,LETF0200,LETF0300,LETF0400,LETF0500:
                             LETF0600,LETF0700,LETF0800,LETF0900,LETF1000:
                             LETF1100,LETF1200
.
          WRITE     HTMLFILE;"Invalid Tag (LETF0000)";
          GOTO      LETF9999
.
LETF0100  COMPARE   ZERO,ALLTLTNO
          GOTO      LETF0110 IF EQUAL
          WRITE     HTMLFILE;ALLTLTNO;
          GOTO      LETF9999
.
LETF0110  MOVE      ZERO,F3
          PACK      KEY6,F3,Z70
          CALL      RSALLET2
          CALL      RPALLET2
          IF        OVRCD=1
            WRITE     HTMLFILE;"  1";
          ELSE
            ADD       ONE,ALLTLTNO
            WRITE     HTMLFILE;ALLTLTNO;
            CALL      CLALLLET
          ENDIF
          GOTO      LETF9999
.
LETF0200  MATCH     SP70,ALLTTEXT
          GOTO      LETF9999 IF EQUAL
          WRITE     HTMLFILE;ALLTTEXT;
          GOTO      LETF9999
.
LETF0300  WRITE     HTMLFILE;ALLTPBOT;
          GOTO      LETF9999
.
LETF0400  WRITE     HTMLFILE;ALLTPTOP;
          GOTO      LETF9999
.
LETF0500  WRITE     HTMLFILE;ALLTPPAG;
          GOTO      LETF9999
.
LETF0600  WRITE     HTMLFILE;ALLTPTAB;
          GOTO      LETF9999
.
LETF0700  WRITE     HTMLFILE;ALLTMMFN;
          GOTO      LETF9999
.
LETF0800  CALL      LETTAB00
          GOTO      LETF9999
.
LETF0900  SQUEEZE   ALLET001
          MOVE      ZERO,LETTNUMB
          MOVE      ALLET001,LETTNUMB
          COMPARE   ZERO,LETTNUMB
          GOTO      LETF9999 IF EQUAL
          PACK      KEY6,LETTNUMB,SP1,SP1,ZERO
          CALL      RDALLET1
LETF0910  CALL      RKALLET1
          BRANCH    OVRCD,LETF0990
          COMPARE   LETTNUMB,ALLTLTNO
          GOTO      LETF0990 IF NOT EQUAL
.
          STRIP     ALLTTEXT
          MOVELPTR  ALLTTEXT,F3
          IF        F3>0
            SFORMAT   VAR,F3
          ELSE
            SFORMAT   VAR,1
          ENDIF
          MOVE      ALLTTEXT,VAR
          WRITE     HTMLFILE;VAR
          SFORMAT   VAR,127
.
          GOTO      LETF0910
LETF0990  PACK      KEY6,LETTNUMB,SP1,SP1,ZERO
          CALL      RDALLET1
          GOTO      LETF9999
.
LETF1000  WRITE     HTMLFILE;ALLTTYPE;
          GOTO      LETF9999
.
LETF1100  WRITE     HTMLFILE;ALLTACTV;
          GOTO      LETF9999
.
LETF1200  WRITE     HTMLFILE;FILTACTV;
          GOTO      LETF9999
.
LETF9999  RETURN
.------------------------------------------------------------
. Output Table of Letter Headers Details
.------------------------------------------------------------
LETTAB00  MOVE      ZERO,F3
          PACK      KEY6,F3,SP70
          CALL      RSALLET2
LETTAB10  CALL      RKALLET2
          BRANCH    OVRCD,LETTAB99
          COMPARE   ZERO,ALLTLINO
          GOTO      LETTAB99 IF NOT EQUAL
.
          MATCH     "1",FILTACTV                 * Inactive only
          IF        @EQUAL
            MATCH     "1",ALLTACTV
            GOTO      LETTAB10 IF NOT EQUAL
          ENDIF
.
          MATCH     "0",FILTACTV                 * Active only
          IF        @EQUAL
            MATCH     "1",ALLTACTV
            GOTO      LETTAB10 IF EQUAL
          ENDIF
.
          MATCH     "1",ALLTACTV
          IF        @EQUAL
            MOVE      "Inactive",DISPACTV
          ELSE
            MOVE      "Active",DISPACTV
          ENDIF
.
          CLEAR     HTMLLINK
          APPEND    "javascript:UpdateLetter('",HTMLLINK
          APPEND    ALLTLTNO,HTMLLINK
          APPEND    "')",HTMLLINK
          RESET     HTMLLINK
          WRITE     HTMLFILE;"t.addRow(#"",HTMLLINK,"#",":
                             "#"",ALLTLTNO,"#",":
                             "#"",ALLTTEXT,"#",":
                             "#"",ALLTPBOT,"#",":
                             "#"",ALLTPTOP,"#",":
                             "#"",ALLTPPAG,"#",":
                             "#"",ALLTPTAB,"#",":
                             "#"",ALLTMMFN,"#",":
                             "#"",DISPACTV,"#");"
.
          GOTO      LETTAB10
.
LETTAB99  RETURN
.
.------------------------------------------------------------
. Table of Allied Health Medication codes : Report 1
.------------------------------------------------------------
MDTAB000  IF        NORECORD=0
            MOVE      PTCNNRTD,NORECORD      * Set Default No Records to Display
          ENDIF
          MOVE      ZERO,RECNUMB
          MOVE      ZERO,DISNUMB
.
          PACK      KEY20,STARTKEY,SP70
          CALL      RSALMED1     * Position on Startkey
          CALL      RPALMED1     * Read one back from position
.
MDTAB100  CALL      RKALMED1     * Read on first Startkey found
          BRANCH    OVRCD,MDTAB900
.
          ADD       ONE,RECNUMB
          IF        STARTNUM>=RECNUMB
            GOTO      MDTAB100
          ENDIF
.
          CALL      MDROW000                * Display Medication Row
          ADD       ONE,DISNUMB
          COMPARE   NORECORD,DISNUMB
          GOTO      MDTAB100 IF NOT EQUAL
          GOTO      MDTAB999
.
MDTAB900  CALL      NOMORE00    * Display No More Records Message
.
MDTAB999  RETURN
.------------------------------------------------------------
.  Allied Health Medication codes (TABLE ROW)
.------------------------------------------------------------
MDROW000  MATCH     "1",ALMEACTV
          IF        @EQUAL
            MOVE    "Inactive  ",ACTIDESC
          ELSE
            MOVE    "Active",ACTIDESC
          ENDIF
.
          WRITE     HTMLFILE;"<tr><td nowrap>":
                             "<img src=../images/MaintenanceIcon.gif ":
                             "class=ListIcon ":
                             "onclick=#"MedicationLink('",ALMECODE,"');#"> ":
                             ALMECODE,"</td>":
                             "<td>",ALMEDESC,"</td>":
                             "<td>",ACTIDESC,"</td>":
                             "</tr>"
.
MDROW999 RETURN
.
.------------------------------------------------------------
. Diagnosis Search Results Table
.------------------------------------------------------------
ALLDKA00  WRITE     HTMLFILE;"<tr align=center>":
                               "<td class=HeadingCell colspan=5>":
                               "You Searched for ":
                               KEYWORDS,"</td>":
                             "</tr>":
                             "<tr>":
                               "<td class=HeadingCell>Diagnosis</td>":
                               "<td class=HeadingCell>Description</td>":
                             "</tr>"
          CALL      GETWRD00       * This routine Splits the KEYWORDS field
.                                  * into KEYWRD01 to KEYWRD10
          IF        NORECORD=0
            MOVE      "10",NORECORD       * Set Default No Records to Display
          ENDIF
          MOVE      ZERO,RECNUMB
          MOVE      ZERO,DISNUMB
.
          STRIP     KEYWRD01
          PACK      KEY27,DEPTCODE,KEYWRD01,SP70
          CALL      RSALDKI2
ALLDKA10  CALL      RKALDKI2
          BRANCH    OVRCD,ALLDKA90
.
          MATCH     DEPTCODE,ALDKDEPT
          GOTO      ALLDKA90 IF NOT EQUAL
.
          PACK      KEY12,ALDKDEPT,ALDKDIAG,SP70
          CALL      RDALDIA1
          BRANCH    OVRCD,ALLDKA10
.
          MATCH     "1",ALDIACTV
          GOTO      ALLDKA10 IF NOT EQUAL
.
          MATCH     "1",CHKVINAH            * If not equal
          GOTO      ALLDKA20 IF NOT EQUAL
.
          MATCH     "00000000",VALDDATE     * VINAH version date
          IF        @EQUAL
            CALL      IBACLOCK
            PACK      VALDDATE,CCC,CYY,CMM,CDD
            REP       " 0",VALDDATE
          ENDIF
.
          MATCH     SP70,VALDDATE
          IF        !@EQUAL & !@EOS
            MATCH     SP70,ALDISDAT
            IF        !@EQUAL & !@EOS
              MATCH     ALDISDAT,VALDDATE
              GOTO      ALLDKA10 IF LESS      * Invalid code for VINAH version
            ENDIF
.
            MATCH   SP70,ALDIEDAT
            IF      !@EQUAL & !@EOS
              MATCH     VALDDATE,ALDIEDAT
              GOTO      ALLDKA10 IF LESS      * Invalid code for VINAH version
            ENDIF
          ENDIF
.
ALLDKA20  CALL      ALLDKB00
          BRANCH    OVRCD,ALLDKA10,ALLDKA90
.
          ADD       ONE,RECNUMB
          IF        STARTNUM>=RECNUMB
            GOTO      ALLDKA10
          ENDIF
.
ALLDKA50 WRITE     HTMLFILE;"<tr valign=top>":
                              "<td nowrap><a href=#"":
                              "javascript:updateParent('",ALDIDEPT:
                             "','",ALDIDIAG,"','",ALDIDESC,"')#">":
                              ALDIDIAG:
                             "<td>",ALDIDESC,"</td></tr>";
.
          ADD       ONE,DISNUMB
          COMPARE   NORECORD,DISNUMB
          GOTO      ALLDKA10 IF NOT EQUAL
ALLDKA90
.
ALLDKA99  RETURN
.
.------------------------------------------------------------
. Check Record
.------------------------------------------------------------
ALLDKB00  MATCH     KEYWRD01,ALDKKKWD
          GOTO      ALLDKB92 IF NOT EQUAL
          IF        KEYWRDNO>1
            PACK      SAVKEY27,DEPTCODE,ALDKKKWD,ALDKDIAG
            CALL      ALLDKC00
            BRANCH    EXIT,ALLDKB91
            MOVE      SAVKEY27,KEY27
            CALL      RDALDKI2
          ENDIF
.
ALLDKB90  MOVE      ZERO,OVRCD
          GOTO      ALLDKB99
.
ALLDKB91  MOVE      ONE,OVRCD
          GOTO      ALLDKB99
.
ALLDKB92  MOVE      TWO,OVRCD
ALLDKB99  RETURN
.------------------------------------------------------------
. Check for Matching Words
.------------------------------------------------------------
ALLDKC00  MOVE      ONE,F2
          MOVE      ZERO,EXIT
          PACK      SAVKEY9,ALDKDIAG,SP70
.
ALLDKC10  COMPARE   KEYWRDNO,F2           * Loop through each Key Word in Search
          GOTO      ALLDKC99 IF EQUAL     * Exit OK
.
          ADD       ONE,F2
          LOAD      KEYWRDXX,F2,KEYWRD01,KEYWRD02,KEYWRD03,KEYWRD04,KEYWRD05:
                             KEYWRD06,KEYWRD07,KEYWRD08,KEYWRD09,KEYWRD10
.
          PACK      KEY27,DEPTCODE,ALDKDIAG,KEYWRDXX
          CALL      RDALDKI1              * Check for Exact Match
          COMPARE   ZERO,OVRCD            * Ok so Continue Loop
          GOTO      ALLDKC10 IF EQUAL
.
          CALL      RKALDKI1              * Not Exact so Read Next Record
          BRANCH    OVRCD,ALLDKC90        * No Match So Exit No Match
.
          MATCH     DEPTCODE,ALDKDEPT
          GOTO      ALLDKC90 IF NOT EQUAL
.
          PACK      KEY9,ALDKDIAG,SP70
          MATCH     SAVKEY9,KEY9          * Match Key Fields
          GOTO      ALLDKC90 IF NOT EQUAL * No Match So Exit
.
          STRIP     KEYWRDXX
          MATCH     ALDKKKWD,KEYWRDXX         * Check Key Word
          GOTO      ALLDKC90 IF NOT EQUAL * No Match So Exit
.
          GOTO      ALLDKC10              * Check Next Search Word
.
ALLDKC90  MOVE      ONE,EXIT
.
ALLDKC99  RETURN
.
.------------------------------------------------------------
. Intervention Search Results Table
.------------------------------------------------------------
ALLIKA00  WRITE     HTMLFILE;"<tr align=center>":
                               "<td class=HeadingCell colspan=5>":
                               "You Searched for ":
                               KEYWORDS,"</td>":
                             "</tr>":
                             "<tr>":
                               "<td class=HeadingCell>Intervention</td>":
                               "<td class=HeadingCell>Description</td>":
                             "</tr>"
          CALL      GETWRD00       * This routine Splits the KEYWORDS field
.                                  * into KEYWRD01 to KEYWRD10
          IF        NORECORD=0
            MOVE      "10",NORECORD       * Set Default No Records to Display
          ENDIF
          MOVE      ZERO,RECNUMB
          MOVE      ZERO,DISNUMB
.
          STRIP     KEYWRD01
          PACK      KEY62,DEPTCODE,KEYWRD01,SP70
          CALL      RSALIKA2
ALLIKA10  CALL      RKALIKA2
          BRANCH    OVRCD,ALLIKA90
.
          MATCH     DEPTCODE,ALIKDEPT
          GOTO      ALLIKA90 IF NOT EQUAL
.
          PACK      KEY12,ALIKDEPT,ALIKCODE,SP70
          CALL      RDALINC1
          BRANCH    OVRCD,ALLIKA10
.
          MATCH     "1",ALINACTV
          GOTO      ALLIKA10 IF EQUAL
.
          CALL      ALLIKB00
          BRANCH    OVRCD,ALLIKA10,ALLIKA90
.
          ADD       ONE,RECNUMB
          IF        STARTNUM>=RECNUMB
            GOTO      ALLIKA10
          ENDIF
.
ALLIKA20 WRITE     HTMLFILE;"<tr valign=top>":
                              "<td nowrap><a href=#"":
                              "javascript:updateParent('",ALINDEPT:
                             "','",ALINCODE,"','",ALINDESC,"')#">":
                              ALINCODE:
                             "<td>",ALINDESC,"</td></tr>";
.
          ADD       ONE,DISNUMB
          COMPARE   NORECORD,DISNUMB
          GOTO      ALLIKA10 IF NOT EQUAL
ALLIKA90
.
ALLIKA99  RETURN
.
.------------------------------------------------------------
. Check Record
.------------------------------------------------------------
ALLIKB00  MATCH     KEYWRD01,ALIKKWRD
          GOTO      ALLIKB92 IF NOT EQUAL
          IF        KEYWRDNO>1
            PACK      SAVKEY62,DEPTCODE,ALIKKWRD,ALIKCODE
            CALL      ALLIKC00
            BRANCH    EXIT,ALLIKB91
            MOVE      SAVKEY62,KEY62
            CALL      RDALIKA2
          ENDIF
.
ALLIKB90  MOVE      ZERO,OVRCD
          GOTO      ALLIKB99
.
ALLIKB91  MOVE      ONE,OVRCD
          GOTO      ALLIKB99
.
ALLIKB92  MOVE      TWO,OVRCD
ALLIKB99  RETURN
.------------------------------------------------------------
. Check for Matching Words
.------------------------------------------------------------
ALLIKC00  MOVE      ONE,F2
          MOVE      ZERO,EXIT
          PACK      SAVKEY9,ALIKCODE,SP70
.
ALLIKC10  COMPARE   KEYWRDNO,F2           * Loop through each Key Word in Search
          GOTO      ALLIKC99 IF EQUAL     * Exit OK
.
          ADD       ONE,F2
          LOAD      KEYWRDXX,F2,KEYWRD01,KEYWRD02,KEYWRD03,KEYWRD04,KEYWRD05:
                             KEYWRD06,KEYWRD07,KEYWRD08,KEYWRD09,KEYWRD10
.
          PACK      KEY62,DEPTCODE,ALIKCODE,KEYWRDXX
          CALL      RDALIKA1              * Check for Exact Match
          COMPARE   ZERO,OVRCD            * Ok so Continue Loop
          GOTO      ALLIKC10 IF EQUAL
.
          CALL      RKALIKA1              * Not Exact so Read Next Record
          BRANCH    OVRCD,ALLIKC90        * No Match So Exit No Match
.
          MATCH     DEPTCODE,ALIKDEPT
          GOTO      ALLIKC90 IF NOT EQUAL
.
          PACK      KEY9,ALIKCODE,SP70
          MATCH     SAVKEY9,KEY9          * Match Key Fields
          GOTO      ALLIKC90 IF NOT EQUAL * No Match So Exit
.
          STRIP     KEYWRDXX
          MATCH     ALDKKKWD,KEYWRDXX         * Check Key Word
          GOTO      ALLIKC90 IF NOT EQUAL * No Match So Exit
.
          GOTO      ALLIKC10              * Check Next Search Word
.
ALLIKC90  MOVE      ONE,EXIT
.
ALLIKC99  RETURN
.
.------------------------------------------------------------
. Medication Search Results Table
.------------------------------------------------------------
ALLMKA00  WRITE     HTMLFILE;"<tr align=center>":
                               "<td class=HeadingCell colspan=5>":
                               "You Searched for ":
                               KEYWORDS,"</td>":
                             "</tr>":
                             "<tr>":
                               "<td class=HeadingCell>Medication Code</td>":
                               "<td class=HeadingCell>Description</td>":
                             "</tr>"
          CALL      GETWRD00       * This routine Splits the KEYWORDS field
.                                  * into KEYWRD01 to KEYWRD10
          IF        NORECORD=0
            MOVE      "10",NORECORD       * Set Default No Records to Display
          ENDIF
          MOVE      ZERO,RECNUMB
          MOVE      ZERO,DISNUMB
.
          STRIP     KEYWRD01
          PACK      KEY80,KEYWRD01,SP70
          CALL      RSALMKI2
ALLMKA10  CALL      RKALMKI2
          BRANCH    OVRCD,ALLMKA90
.
          PACK      KEY20,ALMKCODE,SP70
          CALL      RDALMED1
          BRANCH    OVRCD,ALLMKA10
.
          MATCH     "1",ALMEACTV
          GOTO      ALLMKA10 IF EQUAL
.
          CALL      ALLMKB00
          BRANCH    OVRCD,ALLMKA10,ALLMKA90
.
          ADD       ONE,RECNUMB
          IF        STARTNUM>=RECNUMB
            GOTO      ALLMKA10
          ENDIF
.
ALLMKA20 WRITE     HTMLFILE;"<tr valign=top>":
                              "<td nowrap><a href=#"":
                              "javascript:updateParent('":
                              ALMECODE,"','",ALMEDESC,"','":
                              ALMEUNIT,"','",ALMEMEDR,"','",ALMEMEDT,"')#">":
                              ALMECODE,"</td>":
                             "<td>",ALMEDESC,"</td></tr>"
.
          ADD       ONE,DISNUMB
          COMPARE   NORECORD,DISNUMB
          GOTO      ALLMKA10 IF NOT EQUAL
ALLMKA90
.
ALLMKA99  RETURN
.
.------------------------------------------------------------
. Check Record
.------------------------------------------------------------
ALLMKB00  MATCH     KEYWRD01,ALMKKWRD
          GOTO      ALLMKB92 IF NOT EQUAL
          IF        KEYWRDNO>1
            PACK      SAVKEY80,ALMKKWRD,ALMKCODE
            CALL      ALLMKC00
            BRANCH    EXIT,ALLMKB91
            MOVE      SAVKEY80,KEY80
            CALL      RDALMKI2
          ENDIF
.
ALLMKB90  MOVE      ZERO,OVRCD
          GOTO      ALLMKB99
.
ALLMKB91  MOVE      ONE,OVRCD
          GOTO      ALLMKB99
.
ALLMKB92  MOVE      TWO,OVRCD
ALLMKB99  RETURN
.------------------------------------------------------------
. Check for Matching Words
.------------------------------------------------------------
ALLMKC00  MOVE      ONE,F2
          MOVE      ZERO,EXIT
          PACK      SAVKEY20,ALMKCODE,SP70
.
ALLMKC10  COMPARE   KEYWRDNO,F2           * Loop through each Key Word in Search
          GOTO      ALLMKC99 IF EQUAL     * Exit OK
.
          ADD       ONE,F2
          LOAD      KEYWRDXX,F2,KEYWRD01,KEYWRD02,KEYWRD03,KEYWRD04,KEYWRD05:
                             KEYWRD06,KEYWRD07,KEYWRD08,KEYWRD09,KEYWRD10
.
          PACK      KEY80,ALMKCODE,KEYWRDXX
          CALL      RDALMKI1              * Check for Exact Match
          COMPARE   ZERO,OVRCD            * Ok so Continue Loop
          GOTO      ALLMKC10 IF EQUAL
.
          CALL      RKALMKI1              * Not Exact so Read Next Record
          BRANCH    OVRCD,ALLDKC90        * No Match So Exit No Match
.
          PACK      KEY20,ALMKCODE,SP70
          MATCH     SAVKEY20,KEY20         * Match Key Fields
          GOTO      ALLMKC90 IF NOT EQUAL * No Match So Exit
.
          STRIP     KEYWRDXX
          MATCH     ALMKKWRD,KEYWRDXX         * Check Key Word
          GOTO      ALLMKC90 IF NOT EQUAL * No Match So Exit
.
          GOTO      ALLMKC10              * Check Next Search Word
.
ALLMKC90  MOVE      ONE,EXIT
.
ALLMKC99  RETURN
.
.-----------------------------------------------------------
. Link to Next medication keyword
.-----------------------------------------------------------
NEXTMK00  MOVE      NORECORD,KEY2
          REP       " +",KEY2
          ASSIGN    STARTNUM+NORECORD,F3
          MOVE      F3,KEY3
          REP       " +",KEY3
          UNPACK    DIM127,D1,D3,DIM127
          MOVE      REPORTNO,F2
.
          REP       " +",ALMECODE
          REP       " +",KEYWORDS
.
          WRITE     HTMLFILE;"allweb01.pbl":
                                 "?reportno=",F2:
                                 "&template=",D3:
                                 "&startnum=",KEY3:
                                 "&norecord=",KEY2:
                                 "&keywords=",KEYWORDS:
                                 "&almed001=",ALMECODE;
.
          REP       "+ ",ALMECODE
          REP       "+ ",KEYWORDS
.
NEXTMK99  RETURN
.
.-------------------------------------------------------------
. Link to Prev Medication
.-------------------------------------------------------------
PREVMK00  MOVE      NORECORD,KEY2
          REP       " +",KEY2
          ASSIGN    STARTNUM-NORECORD,F3
          IF        F3<0
            MOVE      ZERO,F3
          ENDIF
          MOVE      F3,KEY3
          REP       " +",KEY3
          UNPACK    DIM127,D1,FLDPARA,DIM127
          MOVE      REPORTNO,F2
.
          REP       " +",ALMECODE
          REP       " +",KEYWORDS
.
          WRITE     HTMLFILE;"allweb01.pbl":
                                "?reportno=",F2:
                                "&template=",FLDPARA:
                                "&startnum=",KEY3:
                                "&norecord=",KEY2:
                                "&keywords=",KEYWORDS:
                                "&almed001=",ALMECODE;
.
          REP       "+ ",ALMECODE
          REP       "+ ",KEYWORDS
.
PREVMK99  RETURN
.
.------------------------------------------------------------
. Problem Search Results Table
.------------------------------------------------------------
ALLPKA00  WRITE     HTMLFILE;"<tr align=center>":
                               "<td class=HeadingCell colspan=5>":
                               "You Searched for ":
                               KEYWORDS,"</td>":
                             "</tr>":
                             "<tr>":
                               "<td class=HeadingCell>Problem</td>":
                               "<td class=HeadingCell>Description</td>":
                             "</tr>"
          CALL      GETWRD00       * This routine Splits the KEYWORDS field
.                                  * into KEYWRD01 to KEYWRD10
          IF        NORECORD=0
            MOVE      "10",NORECORD       * Set Default No Records to Display
          ENDIF
          MOVE      ZERO,RECNUMB
          MOVE      ZERO,DISNUMB
.
          STRIP     KEYWRD01
          PACK      KEY52,DEPTCODE,KEYWRD01,SP70
          CALL      RSALPKI2
ALLPKA10  CALL      RKALPKI2
          BRANCH    OVRCD,ALLPKA90
.
          MATCH     DEPTCODE,ALPKDEPT
          GOTO      ALLPKA90 IF NOT EQUAL
.
          PACK      KEY12,ALPKDEPT,ALPKPROB,SP70
          CALL      RDALPRR1
          BRANCH    OVRCD,ALLPKA10
.
          MATCH     "1",ALPRACTV
          GOTO      ALLPKA10 IF NOT EQUAL
.
          MATCH     "1",OTHERFAC
          IF        @EQUAL
            MATCH    "1",ALPROTHR           * Skip problem only codes     
            GOTO     ALLPKA10 IF EQUAL      
          ENDIF
.
          CALL      ALLPKB00
          BRANCH    OVRCD,ALLPKA10,ALLPKA90
.
          ADD       ONE,RECNUMB
          IF        STARTNUM>=RECNUMB
            GOTO      ALLPKA10
          ENDIF
.
ALLPKA20 WRITE     HTMLFILE;"<tr valign=top>":
                              "<td nowrap><a href=#"":
                              "javascript:updateParent('",ALPRDEPT:
                             "','",ALPRPROB,"','",ALPRDESC,"')#">":
                              ALPRPROB:
                             "<td>",ALPRDESC,"</td></tr>";
.
          ADD       ONE,DISNUMB
          COMPARE   NORECORD,DISNUMB
          GOTO      ALLPKA10 IF NOT EQUAL
ALLPKA90
.
ALLPKA99  RETURN
.
.------------------------------------------------------------
. Check Record
.------------------------------------------------------------
ALLPKB00  MATCH     KEYWRD01,ALPKKKWD
          GOTO      ALLPKB92 IF NOT EQUAL
          IF        KEYWRDNO>1
            PACK      SAVKEY52,DEPTCODE,ALPKKKWD,ALPKPROB
            CALL      ALLPKC00
            BRANCH    EXIT,ALLPKB91
            MOVE      SAVKEY52,KEY52
            CALL      RDALPKI2
          ENDIF
.
ALLPKB90  MOVE      ZERO,OVRCD
          GOTO      ALLPKB99
.
ALLPKB91  MOVE      ONE,OVRCD
          GOTO      ALLPKB99
.
ALLPKB92  MOVE      TWO,OVRCD
ALLPKB99  RETURN
.------------------------------------------------------------
. Check for Matching Words
.------------------------------------------------------------
ALLPKC00  MOVE      ONE,F2
          MOVE      ZERO,EXIT
          PACK      SAVKEY9,ALPKPROB,SP70
.
ALLPKC10  COMPARE   KEYWRDNO,F2           * Loop through each Key Word in Search
          GOTO      ALLPKC99 IF EQUAL     * Exit OK
.
          ADD       ONE,F2
          LOAD      KEYWRDXX,F2,KEYWRD01,KEYWRD02,KEYWRD03,KEYWRD04,KEYWRD05:
                             KEYWRD06,KEYWRD07,KEYWRD08,KEYWRD09,KEYWRD10
.
          PACK      KEY52,DEPTCODE,ALPKPROB,KEYWRDXX
          CALL      RDALPKI1              * Check for Exact Match
          COMPARE   ZERO,OVRCD            * Ok so Continue Loop
          GOTO      ALLPKC10 IF EQUAL
.
          CALL      RKALPKI1              * Not Exact so Read Next Record
          BRANCH    OVRCD,ALLPKC90        * No Match So Exit No Match
.
          MATCH     DEPTCODE,ALPKDEPT
          GOTO      ALLPKC90 IF NOT EQUAL
.
          PACK      KEY9,ALPKPROB,SP70
          MATCH     SAVKEY9,KEY9          * Match Key Fields
          GOTO      ALLPKC90 IF NOT EQUAL * No Match So Exit
.
          STRIP     KEYWRDXX
          MATCH     ALPKKKWD,KEYWRDXX         * Check Key Word
          GOTO      ALLPKC90 IF NOT EQUAL * No Match So Exit
.
          GOTO      ALLPKC10              * Check Next Search Word
.
ALLPKC90  MOVE      ONE,EXIT
.
ALLPKC99  RETURN
+
.------------------------------------------------------------------------------
. Validate Case Team Member
. INPUTS: VALDDATE - Date
.         VALDTEAM - Team
.         VALDHCPC - HCP
.         VALDMODE - Validation Mode: 0-Referral Date, 1-Admission Date
.------------------------------------------------------------------------------
VALCTM00  CALL      XMLHED00
          BRANCH    EXIT,VALCTM99
.
          PACK      KEY20,VALDTEAM,VALDHCPC,SP70
          CALL      RDALCTM1
          BRANCH    OVRCD,VALCTM80
.
          MATCH     SP70,ALCTEDAT
          GOTO      VALCTM80 IF EQUAL
          GOTO      VALCTM80 IF EOS
.
.         MATCH     VALDDATE,ALCTEDAT
.         GOTO      VALCTM90 IF LESS
.
          MATCH     ALCTEDAT,VALDDATE    * Referral Date < CT Member End Date?
          GOTO      VALCTM90 IF NOT LESS
.
VALCTM80  WRITE     HTMLFILE;"<RETURN_VALUE TYPE=SIMPLE>":
                    ONE:
                    "</RETURN_VALUE>"
.
          GOTO      VALCTM98
.
VALCTM90  WRITE     HTMLFILE;"<RETURN_VALUE TYPE=ERROR>";
          MATCH     "1",VALDMODE
          IF        @EQUAL
            WRITE     HTMLFILE;"Date must be before Case Team Member End Date.";
          ELSE
            WRITE     HTMLFILE;"Date of Referral must be before Case Team Member End Date.";
          ENDIF
          WRITE     HTMLFILE;"</RETURN_VALUE>"
          GOTO      VALCTM98
.
VALCTM98  CALL      XMLEND00
.
VALCTM99  RETURN
+
.------------------------------------------------------------
. VINAH Extract Category Code Mapping
.------------------------------------------------------------
ALLVMP00  RESET     UPDTTYPE
          MATCH     SP1,UPDTTYPE
          GOTO      ALLVMP50 IF EQUAL
.
          MATCH     "A",UPDTTYPE                 * Add formaction
          GOTO      ALLVMP10 IF EQUAL
.
          MATCH     "U",UPDTTYPE                 * Update formaction
          GOTO      ALLVMP20 IF EQUAL
.
          MATCH     "D",UPDTTYPE                 * Delete formaction
          GOTO      ALLVMP30 IF EQUAL
.
          GOTO      ALLVMP93
.
.         ************ ADD FORMACTION ***********
.
ALLVMP10  PACK      KEY3,DEPTCODE,SP70
          CALL      RDALDEP1                      * Read department table
          BRANCH    OVRCD,ALLVMP94
          MOVE      ALDEDEPT,DEPARTMN             * Save Department Variable
.
          PACK      KEY13,DEPARTMN,ALVMP001,ALVMP002,SP70
          CALL      RAALVMP1
          COMPARE   ZERO,OVRCD
          GOTO      ALLVMP92 IF EQUAL
.
          CALL      MVALVM00                     * Move cgi to file variables
.
          PACK      KEY13,DEPARTMN,ALVMP001,ALVMP002,SP70
          CALL      WRALVMP1                     * Writes the data
.
          MOVE      ZERO,EXIT
          GOTO      ALLVMP99
.
.         ************ UPDATE FORMACTION **********
.
ALLVMP20  PACK      KEY3,DEPTCODE,SP70
          CALL      RDALDEP1                      * Read department table
          BRANCH    OVRCD,ALLVMP94
          MOVE      ALDEDEPT,DEPARTMN             * Save Department Variable
.
          PACK      KEY13,DEPARTMN,ALVMP001,ALVMP002,SP70
          CALL      RDALVMP1
          BRANCH    OVRCD,ALLVMP91
.
          CALL      MVALVM00                     * Moves cgi to file variables
.
          PACK      KEY13,DEPARTMN,ALVMP001,ALVMP002,SP70
          CALL      UPALVMP1                     * Updates the data
.
          MOVE      ZERO,EXIT
          GOTO      ALLVMP99
.
.         ************ DELETE FORMACTION **********
.
ALLVMP30  PACK      KEY3,DEPTCODE,SP70
          CALL      RDALDEP1                      * Read department table
          BRANCH    OVRCD,ALLVMP94
          MOVE      ALDEDEPT,DEPARTMN             * Save Department Variable
.
          PACK      KEY13,DEPARTMN,ALVMP001,ALVMP002,SP70
          CALL      RDALVMP1
          BRANCH    OVRCD,ALLVMP91
.
          CALL      DEALVMP1                     * Deletes the data
.
          MOVE      ZERO,EXIT
          GOTO      ALLVMP99
.
ALLVMP50  PACK      KEY3,DEPTCODE,SP70
          CALL      RDALDEP1                      * Read department table
          BRANCH    OVRCD,ALLVMP94
          MOVE      ALDEDEPT,DEPARTMN             * Save Department Variable
.
          PACK      KEY13,DEPARTMN,ALVMP001,ALVMP002,SP70
          CALL      RDALVMP1                      * Read assessment
          IF        OVRCD=1
            CALL      CLALVM00                    * Clear all the file variables
          ENDIF
.
          CLEAR     WEBTITLE
          MOVE      "VINAH Extract Category Code Mapping Maintenance",WEBTITLE
          RESET     WEBTITLE
.
          CALL      WEBHED00   * Create Output File and Write HTML Page Header
          BRANCH    EXIT,ALLVMP99
          CALL      WEBBOD00   * Process Web Body
          CALL      WEBEND00   * Process End of HTML File
          MOVE      ONE,EXIT
          GOTO      ALLVMP99
.
ALLVMP91  MOVE      "Category Map Does Not Exist",WEBTITLE
          CALL      WEBERR00
          MOVE      ONE,EXIT
          GOTO      ALLVMP99
.
ALLVMP92  MOVE      "Category Map Exists",WEBTITLE
          CALL      WEBERR00
          MOVE      ONE,EXIT
          GOTO      ALLVMP99
.
ALLVMP93  MOVE      "Invalid Form Action.",WEBTITLE
          CALL      WEBERR00
          MOVE      ONE,EXIT
          GOTO      ALLVMP99
.
ALLVMP94  MOVE      "Invalid Department Code",WEBTITLE
          CALL      WEBERR00
          MOVE      ONE,EXIT
          GOTO      ALLVMP99
.
ALLVMP99  RETURN
.
.-------------------------------------------------------------------------------
.  Set Parameters for VINAH Extract Category Code Mapping
.-------------------------------------------------------------------------------
SPALV000  UNPACK    QRYNAME,KEY5,KEY3
          MOVE      KEY3,F3
          BRANCH    F3,SPALV001,SPALV002,SPALV003
.
          GOTO      SPALV999
.
SPALV001  PACK      ALVMP001,QRYDATA,SP70
          GOTO      SPALV999
.
SPALV002  UNPACK    QRYDATA,CDAY,KEY1,MTHNAM3,KEY1,CCENT,CYEAR
          CALL      SETMTH00                *Set CMON from MTHNAM3
          PACK      ALVMP002,CCENT,CYEAR,CMON,CDAY,SP70
          GOTO      SPALV999
.
SPALV003  PACK      ALVMP003,QRYDATA,SP70
          GOTO      SPALV999
.
SPALV999  RETURN
.
.------------------------------------------------------------
. Tags for VINAH Extract Category Code Mapping
.------------------------------------------------------------
ALVM0000  BRANCH    FLDITMNO,ALVM0010,ALVM0020,ALVM0030,ALVM0040:
                             ALVM0050,ALVM0060,ALVM0070,ALVM0080
.
          WRITE     HTMLFILE;"Invalid IBA Tag";
          GOTO      ALVM9999
.
ALVM0010  MOVE      "CG",CATEGORY                * Department
          MOVE      DEPARTMN,CODE
          CALL      CODITM00
          GOTO      ALVM9999
.
ALVM0020  UNPACK    DIM127,D1,KEY1,DIM127
          MOVE      ZERO,F1
          MOVE      KEY1,F1
          BRANCH    F1,ALVM0021
.
          PACK      KEY5,ALVMCATG,SP70
          CALL      RDCODE1
          IF        OVRCD=1
            MOVE      ALVMCATG,TDESC
          ENDIF
          WRITE     HTMLFILE;TDESC;              * Category Description
          GOTO      ALVM9999
.
ALVM0021  WRITE     HTMLFILE;ALVMCATG;           * Category
          GOTO      ALVM9999
.
ALVM0030  MATCH     ALVMEDAT,SP70                * End date
          GOTO      ALVM9999 IF EQUAL
.
          UNPACK    ALVMEDAT,CCENT,CYEAR,CMON,CDAY
          MOVE      CMON,F2
          LOAD      MTHNAM3,F2,JAN,FEB,MAR,APR,MAY,JUN,JUL,AUG,SEP,OCT,NOV,DEC
          WRITE     HTMLFILE;CDAY,SP1,MTHNAM3,SP1,CCENT,CYEAR;
          GOTO      ALVM9999
.
ALVM0040  WRITE     HTMLFILE;ALVMCODE;           * Code
          GOTO      ALVM9999
.
ALVM0050  CALL      NEXTVM00                     * Next page VINAH Map
          GOTO      ALVM9999
.
ALVM0060  CALL      PREVVM00                     * Prev Page VINAH Map
          GOTO      ALVM9999
.
ALVM0070  CALL      VMTAB000                     * VINAH Mapping List
          GOTO      ALVM9999
.
ALVM0080  MOVE      ALVMCATG,CATEGORY            * Mapped Cat Code
          MOVE      ALVMCODE,CODE
          CALL      CODITM00
          GOTO      ALVM9999
.
ALVM9999  RETURN
.
.------------------------------------------------------------
. Contract Codes
.------------------------------------------------------------
ALLCCT00  RESET     UPDTTYPE
          MATCH     SP1,UPDTTYPE
          GOTO      ALLCCT30 IF EQUAL
.
          MATCH     "A",UPDTTYPE    * Add formaction
          GOTO      ALLCCT10 IF EQUAL
.
          MATCH     "D",UPDTTYPE    * Delete formaction
          GOTO      ALLCCT20 IF EQUAL
.
          GOTO      ALLCCT93
.
.         ************ ADD FORMACTION ***********
.
ALLCCT10  PACK      KEY8,DEPTCODE,catgb,CONTCODE,SP70
          CALL      RDALCCT1
          IF        OVRCD=1
            UNPACK    KEY8,ALCCDEPT,ALCCTYPE,ALCCCONT
            PACK      ALCCCDAT,CCC,CYY,CMM,CDD
            REP       " 0",ALCCCDAT
            CLOCK     TIME,ALCCCTIM
            MOVE      USERID,ALCCCUID
            CALL      WRALCCT1
          ELSE
            MOVE      "Record already existed in allcctaf.",WEBTITLE
            CALL      WEBERR00
            MOVE      ONE,EXIT
            GOTO      ALLCCT99
          ENDIF
.
          GOTO      ALLCCT99
.
.         ************ DELETE FORMACTION **********
.
ALLCCT20  PACK      KEY8,DEPTCODE,catgb,CONTCODE,SP70
          CALL      RDALCCT1
          IF        OVRCD=0
            CALL      DEALCCT1
          ENDIF
.
          GOTO      ALLCCT99
.
ALLCCT30  CLEAR     WEBTITLE
          MOVE      "Contract Codes Maintenance",WEBTITLE
          RESET     WEBTITLE
.
          PACK      ALCCDEPT,DEPTCODE,SP70
.
          CALL      WEBHED00   * Create Output File and Write HTML Page Header
          BRANCH    EXIT,ALLCCT99
          CALL      WEBBOD00   * Process Web Body
          CALL      WEBEND00   * Process End of HTML File
.
          PACK      DEPTCODE,ALCCDEPT,SP70
.
          MOVE      ONE,EXIT
          GOTO      ALLCCT99
.
ALLCCT93  MOVE      "Invalid Form Action.",WEBTITLE
          CALL      WEBERR00
          MOVE      ONE,EXIT
          GOTO      ALLCCT99
.
ALLCCT99  RETURN
.
.-------------------------------------------------------------------------------
. Referral Contract Codes
.-------------------------------------------------------------------------------
ACCC0000  BRANCH    FLDITMNO,ACCC0100,ACCC0200,ACCC0300,ACCC0400,ACCC0500:
                             ACCC0600,ACCC0700,ACCC0800,ACCC0900,ACCC1000:
                             ACCC1100,ACCC1200,ACCC1300,ACCC1400
          GOTO      ACCC9999
.
ACCC0100  IF        NORECORD=0
            MOVE      PTCNNRTD,NORECORD      * Set Default No Records to Display
          ENDIF
          MOVE      ZERO,RECNUMB
          MOVE      ZERO,DISNUMB
.
          PACK      KEY8,DEPTCODE,catgb,STARTKEY,SP70
          CALL      RDALCCT1
          IF        OVRCD=0
            CALL     RPALCCT1
          ENDIF
ACCC0101  CALL      RKALCCT1
.
          BRANCH    OVRCD,ACCC0190
.
          MATCH     ALCCDEPT,DEPTCODE
          GOTO      ACCC0190 IF NOT EQUAL
.
          PACK      KEY5,CATgb,ALCCCONT,SP70
          CALL      RDCODE1
          BRANCH    OVRCD,ACCC0101
.
          MATCH     "A",PTCOACTV
          IF        @EQUAL
            MOVE      "Active  ",DIM8
          ELSE
            MOVE      "Inactive",DIM8
          ENDIF
.
          ADD       ONE,RECNUMB
          IF        STARTNUM>=RECNUMB
            GOTO      ACCC0101
          ENDIF
.
          WRITE     HTMLFILE;"<tr><td><a href='javascript:ShowDetail21":
                             "(#"allweb01.pbl?reportno=21&template=003":
                             "&deptcode=",DEPTCODE,"&contcode=",ALCCCONT,"#")'>":
                             "<img src=../images/MaintenanceIcon.gif hspace=4":
                             " border=0 align=absmiddle></a>",ALCCCONT,"</td>":
                             "<td>",TDESC,"</td>":
                             "<td>",DIM8,"</td></tr>"
.
          ADD       ONE,DISNUMB
          COMPARE   NORECORD,DISNUMB
          GOTO      ACCC0101 IF NOT EQUAL
          GOTO      ACCC9999
.
ACCC0190  CALL      NOMORE00      * Display No More Records Message
.
          GOTO      ACCC9999
.
ACCC0200  MOVE      CATgb,CATEGORY
          CALL      CODSEL00
.
          GOTO      ACCC9999
.
ACCC0300  WRITE     HTMLFILE;DEPTCODE;
          GOTO      ACCC9999
.
ACCC0400  UNPACK    DIM127,D1,KEY1,DIM127
          MOVE      ZERO,F1
          MOVE      KEY1,F1
          BRANCH    F1,ACCC0401
.
          WRITE     HTMLFILE;CONTCODE;
          GOTO      ACCC9999
.
ACCC0401  PACK      KEY5,CATgb,CONTCODE
          CALL      RDCODE1
          IF        OVRCD=1
            WRITE     HTMLFILE;"Unknown Code: ",CONTCODE;
          ELSE
            WRITE     HTMLFILE;TDESC;
          ENDIF
          GOTO      ACCC9999
.
ACCC0500  WRITE     HTMLFILE;ALCCDEPT;
          GOTO      ACCC9999
.
ACCC0600  WRITE     HTMLFILE;ALCCCONT;
          GOTO      ACCC9999
.
ACCC0700  WRITE     HTMLFILE;ALCCCDAT;
          GOTO      ACCC9999
.
ACCC0800  WRITE     HTMLFILE;ALCCCTIM;
          GOTO      ACCC9999
.
ACCC0900  WRITE     HTMLFILE;ALCCCUID;
          GOTO      ACCC9999
.
ACCC1000  WRITE     HTMLFILE;ALCCUDAT;
          GOTO      ACCC9999
.
ACCC1100  WRITE     HTMLFILE;ALCCUTIM;
          GOTO      ACCC9999
.
ACCC1200  WRITE     HTMLFILE;ALCCUUID;
          GOTO      ACCC9999
.
ACCC1300  CALL      PRVCCC00
          GOTO      ACCC9999
.
ACCC1400  CALL      NXTCCC00
          GOTO      ACCC9999
.
ACCC9999  RETURN
.
.------------------------------------------------------------
. Clear File Vars for ALLVMPFD
.------------------------------------------------------------
CLALVM00  MOVE      SP70,ALVMDEPT
          MOVE      SP70,ALVMCATG
          MOVE      SP70,ALVMEDAT
          MOVE      SP70,ALVMCODE
          MOVE      SP70,ALVMSPAR
.
CLALVM99  RETURN
.
.------------------------------------------------------------
. Move cgi to file vars for ALLVMPFD
.------------------------------------------------------------
MVALVM00  MOVE      DEPARTMN,ALVMDEPT
          MOVE      ALVMP001,ALVMCATG
          MOVE      ALVMP002,ALVMEDAT
          MOVE      ALVMP003,ALVMCODE
          MOVE      SP70,ALVMSPAR
.
MVALVM99  RETURN
.
.-----------------------------------------------------------
. Link to Next Group VINAH Map
.-----------------------------------------------------------
NEXTVM00  MOVE      NORECORD,KEY2
          REP       " +",KEY2
          ASSIGN    STARTNUM+NORECORD,F3
          MOVE      F3,KEY3
          REP       " +",KEY3
          UNPACK    DIM127,D1,D3,DIM127
          MOVE      REPORTNO,F2
.
          REP       " +",DEPTCODE
.
          WRITE     HTMLFILE;"allweb01.pbl":
                                 "?reportno=",F2:
                                 "&template=",D3:
                                 "&startnum=",KEY3:
                                 "&norecord=",KEY2:
                                 "&deptcode=",DEPTCODE;
.
          REP       "+ ",DEPTCODE
.
NEXTVM99  RETURN
.
.-------------------------------------------------------------
. Link to Prev Group VINAH Map
.-------------------------------------------------------------
PREVVM00  MOVE      NORECORD,KEY2
          REP       " +",KEY2
          ASSIGN    STARTNUM-NORECORD,F3
          IF        F3<0
            MOVE      ZERO,F3
          ENDIF
          MOVE      F3,KEY3
          REP       " +",KEY3
          UNPACK    DIM127,D1,FLDPARA,DIM127
          MOVE      REPORTNO,F2
.
          REP       " +",DEPTCODE
.
          WRITE     HTMLFILE;"allweb01.pbl":
                                "?reportno=",F2:
                                "&template=",FLDPARA:
                                "&startnum=",KEY3:
                                "&norecord=",KEY2:
                                "&deptcode=",DEPTCODE;
.
          REP       "+ ",DEPTCODE
.
PREVVM99  RETURN
.
.------------------------------------------------------------
. VIBAH Mapping List
.------------------------------------------------------------
VMTAB000  UNPACK    DIM127,D1,LINKPRG,DIM127
          UNPACK    DIM127,D1,LINKREP,DIM127
          UNPACK    DIM127,D1,LINKTEM,DIM127
.
          IF        NORECORD=0
            MOVE      PTCNNRTD,NORECORD      * Set Default No Records to Display
          ENDIF
          MOVE      ZERO,RECNUMB
          MOVE      ZERO,DISNUMB
.
          PACK      KEY13,DEPTCODE,SP70
          CALL      RDALVMP1
          COMPARE   ZERO,OVRCD
          GOTO      VMTAB150 IF EQUAL
.
VMTAB100  CALL      RKALVMP1
          BRANCH    OVRCD,VMTAB900
.
VMTAB150  MATCH     DEPTCODE,ALVMDEPT
          GOTO      VMTAB900 IF NOT EQUAL
.
          ADD       ONE,RECNUMB
          IF        STARTNUM>=RECNUMB
            GOTO      VMTAB100
          ENDIF
.
          CALL      VMROW000                * Display Row
.
          ADD       ONE,DISNUMB
          COMPARE   NORECORD,DISNUMB
          GOTO      VMTAB100 IF NOT EQUAL
          GOTO      VMTAB999
.
VMTAB900  CALL      NOMORE00    * Display No More Records Message
.
VMTAB999  RETURN
.
.------------------------------------------------------------
. VINAH Mapping (TABLE ROW)
.------------------------------------------------------------
VMROW000  PACK      KEY5,ALVMCATG,SP70
          CALL      RDCODE1
          IF        OVRCD=1
            MOVE      ALVMCATG,TDESC
          ENDIF
          MOVE      TDESC,DISPCATG
.
          MATCH     SP70,ALVMEDAT
          IF        !@EQUAL
            UNPACK    ALVMEDAT,CCENT,CYEAR,CMON,CDAY
            MOVE      CMON,F2
            LOAD      MTHNAM3,F2,JAN,FEB,MAR,APR,MAY,JUN,JUL,AUG,SEP,OCT,NOV,DEC
            PACK      DISPDAT1,CDAY,SP1,MTHNAM3,SP1,CCENT,CYEAR
          ELSE
            MOVE      SP70,DISPDAT1
          ENDIF
.
          PACK      KEY5,ALVMCATG,ALVMCODE,SP70
          CALL      RDCODE1
          IF        OVRCD=1
            MOVE      ALVMCODE,TDESC
          ENDIF
.
          WRITE     HTMLFILE;"<tr><td nowrap><A HREF='javascript:ShowDetail20":
                             "(#"",LINKPRG,"#.pbl":
                             "?reportno=",LINKREP:
                             "&template=",LINKTEM:
                             "&deptcode=",DEPTCODE:
                             "&alvmp001=",ALVMCATG:
                             "&alvmp002=",DISPDAT1,"#")'>":
                             "<img src=../images/MaintenanceIcon.gif hspace=4":
                             " border=0 align=absmiddle></a>":
                             DISPCATG,"</td>":
                             "<td align=left>",DISPDAT1,"&nbsp;</td>":
                             "<td align=left>",TDESC,"&nbsp;</td>":
                             "</tr>"
.
VMROW999 RETURN
.
.------------------------------------------------------------
. Clinic Option List
.------------------------------------------------------------
SLSITE00  PACK      KEY36,SP70
          CALL      RDSSITA2
SLSITE10  CALL      RDKSITA2
          BRANCH    OVRCD,SLSITE99
.
          MATCH     SITECODE,OSTSITE
          IF        @EQUAL
            WRITE     HTMLFILE;"<option value=#"",OSTSITE,"#" selected>":
                               OSTDESC,"</option>"
          ELSE
            WRITE     HTMLFILE;"<option value=#"",OSTSITE,"#">":
                               OSTDESC,"</option>"
          ENDIF
          GOTO      SLSITE10
.
SLSITE99  RETURN
.
.------------------------------------------------------------
. Process Department Procedures
.------------------------------------------------------------
ALLPRO00  RESET     UPDTTYPE
          MATCH     SP1,UPDTTYPE
          GOTO      ALLPRO50 IF EQUAL
.
          MATCH     "A",UPDTTYPE    * Add formaction
          GOTO      ALLPRO10 IF EQUAL
.
          MATCH     "U",UPDTTYPE    * Update formaction
          GOTO      ALLPRO20 IF EQUAL
.
          MATCH     "D",UPDTTYPE    * Delete formaction
          GOTO      ALLPRO30 IF EQUAL
.
          MATCH     "C",UPDTTYPE    * Copy formaction
          GOTO      ALLPRO40 IF EQUAL
.
          GOTO      ALLPRO93
.
.         ************ ADD FORMACTION ***********
.
ALLPRO10  PACK      KEY3,DEPTCODE,SP70
          CALL      RDALDEP1                      * Read department table
          BRANCH    OVRCD,ALLPRO94
          MOVE      ALDEDEPT,DEPARTMN             * Save Department Variable
.
          PACK      KEY12,DEPARTMN,ALPRO002,SP70
          CALL      RAALPRO1
          COMPARE   ZERO,OVRCD
          GOTO      ALLPRO92 IF EQUAL
.
          CALL      CLALLPRO
          CALL      MVALPO00                     * Move cgi to file variables

          PACK      KEY8,CCC,CYY,CMM,CDD
          REP       " 0",KEY8
          MOVE      KEY8,ALPOCDAT                * System date
          CLOCK     TIME,ALPOCTIM                * System time (Var chgd HPS)
          MOVE      USERID,ALPOCUID              * web user id
          MOVE      SP70,ALPOUDAT
          MOVE      SP70,ALPOUTIM
          MOVE      SP70,ALPOUUID
          CALL      WRALPRO1                     * Writes the data
.
          PROC      ALLARKUP                     * Updates keyword index
.
          MOVE      ZERO,EXIT
          GOTO      ALLPRO99
.
.         ************ UPDATE FORMACTION **********
.
ALLPRO20  PACK      KEY3,DEPTCODE,SP70
          CALL      RDALDEP1                      * Read department table
          BRANCH    OVRCD,ALLPRO94
          MOVE      ALDEDEPT,DEPARTMN             * Save Department Variable
.
          PACK      KEY12,DEPARTMN,ALPRO002,SP70
          CALL      RDALPRO1
          BRANCH    OVRCD,ALLPRO91
.
          CALL      MVALPO00                     * Moves cgi to file variables
.
          PACK      KEY8,CCC,CYY,CMM,CDD
          REP       " 0",KEY8
          MOVE      KEY8,ALPOUDAT                * System Date
          CLOCK     TIME,ALPOUTIM                * System time (Var chgd HPS)
          MOVE      USERID,ALPOUUID              * web user id
          CALL      UPALPRO1                     * Updates the data
.
          PROC      ALLARKUP                     * Updates keyword index
.
          MOVE      ZERO,EXIT
          GOTO      ALLPRO99
.
.         ************ DELETE FORMACTION **********
.
ALLPRO30  PACK      KEY3,DEPTCODE,SP70
          CALL      RDALDEP1                      * Read department table
          BRANCH    OVRCD,ALLPRO94
          MOVE      ALDEDEPT,DEPARTMN             * Save Department Variable
.
          PACK      KEY12,DEPARTMN,ALPRO002,SP70
          CALL      RDALPRO1
          BRANCH    OVRCD,ALLPRO91
          CALL      DEALPRO1                     * Deletes the data
.
          PROC      ALLARKUP                     * Updates keyword index
.
          MOVE      "allproaf",MAPTBNAM
          PACK      MAPTBIND,DEPTCODE,ALPRO002,SP70
          CALL      DELCSM00                * Delete Coding System Mappings
.
          MOVE      ZERO,EXIT
          GOTO      ALLPRO99
.
.         ************ COPY FORMACTION **********
.
ALLPRO40  CALL      CPRO0000                      * Copy procedures
.
          MOVE      ZERO,EXIT
          GOTO      ALLPRO99
.
.         ************ DISPLAY FORMACTION **********
.
ALLPRO50  PACK      KEY3,DEPTCODE,SP70
          CALL      RDALDEP1                      * Read department table
          BRANCH    OVRCD,ALLPRO94
          MOVE      ALDEDEPT,DEPARTMN             * Save Department Variable
.
          PACK      KEY12,DEPARTMN,ALPRO002,SP70
          CALL      RDALPRO1                      * Read service
          IF        OVRCD=1
            CALL      CLALLPRO                    * Clear all the file variables
          ENDIF
.
          CLEAR     WEBTITLE
          MOVE      "Department Procedure Maintenance",WEBTITLE
          RESET     WEBTITLE
.
          CALL      WEBHED00   * Create Output File and Write HTML Page Header
          BRANCH    EXIT,ALLPRO99
          CALL      WEBBOD00   * Process Web Body
          CALL      WEBEND00   * Process End of HTML File
          MOVE      ONE,EXIT
          GOTO      ALLPRO99
.
ALLPRO91  MOVE      "Procedure Code Does Not Exist",WEBTITLE
          CALL      WEBERR00
          MOVE      ONE,EXIT
          GOTO      ALLPRO99
.
ALLPRO92  MOVE      "Procedure Code Exists",WEBTITLE
          CALL      WEBERR00
          MOVE      ONE,EXIT
          GOTO      ALLPRO99
.
ALLPRO93  MOVE      "Invalid Form Action.",WEBTITLE
          CALL      WEBERR00
          MOVE      ONE,EXIT
          GOTO      ALLPRO99
.
ALLPRO94  MOVE      "Invalid Department Code",WEBTITLE
          CALL      WEBERR00
          MOVE      ONE,EXIT
          GOTO      ALLPRO99
.
ALLPRO99  RETURN
.
.------------------------------------------------------------
. Copy procedure details to this department.
.------------------------------------------------------------
CPRO0000  PACK      KEY12,COPYDEPT,SP70
          CALL      RSALPRO1
CPRO1000  CALL      RKALPRO1
          BRANCH    OVRCD,CPRO9999
.
          MATCH     COPYDEPT,ALPODEPT
          GOTO      CPRO9999 IF NOT EQUAL
.
          MATCH     "1",ALPOACTV
          GOTO      CPRO1000 IF NOT EQUAL
.
          PACK      SAVKEY12,ALPODEPT,ALPOPROC,SP70
.
          MOVE      DEPTCODE,ALPODEPT
.
          PACK      KEY12,ALPODEPT,ALPOPROC,SP70
          CALL      RAALPRO1
          IF        OVRCD=1
            CALL      WRALPRO1
            PROC      ALLARKUP                   * Updates keyword index
          ENDIF
.
          MOVE      SAVKEY12,KEY12
          CALL      RDALPRO1
.
          GOTO      CPRO1000
.
CPRO9999  RETURN
.
.------------------------------------------------------------
. General tags
.------------------------------------------------------------
GTAG0000  BRANCH    FLDITMNO,GTAG0010,GTAG0020,GTAG0030,GTAG0040,GTAG0050
.
          WRITE     HTMLFILE;"Invalid IBA Tag";
          GOTO      GTAG9999
.
GTAG0010  CALL      RRTAB000
          GOTO      GTAG9999
.
GTAG0020  CALL      NEXTPR00
          GOTO      GTAG9999
.
GTAG0030  CALL      PREVPR00
          GOTO      GTAG9999
.
GTAG0040  MOVE      ZERO,INCLDINP           * Exclude IP AH Departents
          CALL      DEPSEL00                * Department Selection List
          GOTO      GTAG9999
.
GTAG0050  CALL      ALLRKA00           * Department procedure keyword search
          GOTO      GTAG9999
.
GTAG9999  RETURN
.
.-----------------------------------------------------------
. Link to Next preocedure page
.-----------------------------------------------------------
NEXTPR00  MOVE      NORECORD,KEY2
          REP       " +",KEY2
          ASSIGN    STARTNUM+NORECORD,F3
          MOVE      F3,KEY3
          REP       " +",KEY3
          UNPACK    DIM127,D1,D3,DIM127
          MOVE      REPORTNO,F2
.
          REP       " +",DEPTCODE
          REP       " +",ALPOPROC
          REP       " +",KEYWORDS
.
          WRITE     HTMLFILE;"allweb01.pbl":
                                 "?reportno=",F2:
                                 "&template=",D3:
                                 "&startnum=",KEY3:
                                 "&norecord=",KEY2:
                                 "&deptcode=",DEPTCODE:
                                 "&keywords=",KEYWORDS:
                                 "&alpro002=",ALPOPROC;
.
          REP       "+ ",DEPTCODE
          REP       "+ ",ALPOPROC
          REP       "+ ",KEYWORDS
.
NEXTPR99  RETURN
.
.-------------------------------------------------------------
. Link to Prev procedure page
.-------------------------------------------------------------
PREVPR00  MOVE      NORECORD,KEY2
          REP       " +",KEY2
          ASSIGN    STARTNUM-NORECORD,F3
          IF        F3<0
            MOVE      ZERO,F3
          ENDIF
          MOVE      F3,KEY3
          REP       " +",KEY3
          UNPACK    DIM127,D1,FLDPARA,DIM127
          MOVE      REPORTNO,F2
.
          REP       " +",DEPTCODE
          REP       " +",ALPOPROC
          REP       " +",KEYWORDS
.
          WRITE     HTMLFILE;"allweb01.pbl":
                                "?reportno=",F2:
                                "&template=",FLDPARA:
                                "&startnum=",KEY3:
                                "&norecord=",KEY2:
                                "&deptcode=",DEPTCODE:
                                "&keywords=",KEYWORDS:
                                "&alpro002=",ALPOPROC;
.
          REP       "+ ",DEPTCODE
          REP       "+ ",ALPOPROC
          REP       "+ ",KEYWORDS
.
PREVPR99  RETURN
.------------------------------------------------------------
. NOMORE00 - Display "No more records" at end of list
.------------------------------------------------------------
NOMORE00  WRITE     HTMLFILE;"<tr>":
                             "<td class=RedCell colspan=20 align=center>":
                             "No more records</td>"
.
NOMORE99  RETURN
.
.------------------------------------------------------------
. Table of Allied Health Procedure Maintenance : Report 22
.------------------------------------------------------------
RRTAB000  UNPACK    DIM127,D1,LINKPRG,DIM127
          UNPACK    DIM127,D1,LINKREP,DIM127
          UNPACK    DIM127,D1,LINKTEM,DIM127
.
          IF        NORECORD=0
            MOVE      PTCNNRTD,NORECORD      * Set Default No Records to Display
          ENDIF
          MOVE      ZERO,RECNUMB
          MOVE      ZERO,DISNUMB
.
          PACK      KEY12,DEPTCODE,STARTKEY,SP70
          CALL      RSALPRO1
          CALL      RPALPRO1
.
RRTAB100  CALL      RKALPRO1
          BRANCH    OVRCD,RRTAB900
.
          MATCH     DEPTCODE,ALPODEPT
          GOTO      RRTAB900 IF NOT EQUAL   * HPS(BLR) Added
.
          ADD       ONE,RECNUMB
          IF        STARTNUM>=RECNUMB
            GOTO     RRTAB100
          ENDIF
.
          CALL      RRROW000                * Display Dig.code Row
          ADD       ONE,DISNUMB
          COMPARE   NORECORD,DISNUMB
          GOTO      RRTAB100 IF NOT EQUAL
          GOTO      RRTAB999
.
RRTAB900  CALL      NOMORE00     * Display No More Records Message
.
RRTAB999  RETURN
.------------------------------------------------------------
.  Allied Health Procedure codes (TABLE ROW)
.------------------------------------------------------------
RRROW000  MATCH   "1",ALPOACTV
          IF      @EQUAL
             MOVE    "ACTIVE  ",ACTIDESC
          ELSE
             MOVE    "INACTIVE",ACTIDESC
          ENDIF
.
          MATCH   SP70,ALPOICDC
          IF      @EQUAL
             MOVE    "&nbsp",ALPOICDC
          ENDIF
.
          MATCH   SP70,ACTIDESC
          IF      @EQUAL
             MOVE    "&nbsp",ACTIDESC
          ENDIF
.
          WRITE     HTMLFILE;"<tr><td nowrap><A HREF='javascript:ShowDetail22":
                             "(#"",LINKPRG,"#.pbl":
                             "?reportno=",LINKREP:
                             "&template=",LINKTEM:
                             "&deptcode=",DEPTCODE:
                             "&alpro002=",ALPOPROC,"#")'>":
                             "<img src=../images/MaintenanceIcon.gif hspace=4":
                             " border=0 align=absmiddle></a>":
                             ALPOPROC,"</td>":
                             "<td>",ALPODESC,"</td>":
                             "<td align=center>",ALPOICDC,"&nbsp;</td>":
                             "<td align=center>",ALPOMHDP,"&nbsp;</td>":
                             "<td align=center>",ALPOMHCP,"&nbsp;</td>":
                             "<td align=center>",ACTIDESC,"&nbsp</td>":
                             "</tr>"
.
RRROW999  RETURN
.
.------------------------------------------------------------
. Validate Procedure Code
. INPUTS: DEPTCODE - Department
.         VALDCODE - Procedure Code
.------------------------------------------------------------
VALPRO00  CALL      XMLHED00
          BRANCH    EXIT,VALPRO99
.
          PACK      KEY12,DEPTCODE,VALDCODE,SP70
          CALL      RDALPRO1
          BRANCH    OVRCD,VALPRO90
.
          MATCH     "1",ALPOACTV      * Check Status
          GOTO      VALPRO91 IF NOT EQUAL
.
          WRITE     HTMLFILE;"<RETURN_VALUE TYPE=SIMPLE>":
                    ALPODESC:
                    "</RETURN_VALUE>"
.
          GOTO      VALPRO98
.
VALPRO90  WRITE     HTMLFILE;"<RETURN_VALUE TYPE=ERROR>":
                             VALDCODE," - Procedure Code not found. ":
                             "</RETURN_VALUE>"
          GOTO      VALPRO98
.
VALPRO91  WRITE     HTMLFILE;"<RETURN_VALUE TYPE=ERROR>":
                             VALDCODE," - Procedure Code Inactive. ":
                             "</RETURN_VALUE>"
          GOTO      VALPRO98
.
VALPRO98  CALL      XMLEND00
VALPRO99  RETURN
.
.------------------------------------------------------------
. Procedure Search Results Table
.------------------------------------------------------------
ALLRKA00  WRITE     HTMLFILE;"<tr align=center>":
                               "<td class=HeadingCell colspan=5>":
                               "You Searched for ":
                               KEYWORDS,"</td>":
                             "</tr>":
                             "<tr>":
                               "<td class=HeadingCell>Procedure</td>":
                               "<td class=HeadingCell>Description</td>":
                             "</tr>"
          CALL      GETWRD00       * This routine Splits the KEYWORDS field
.                                  * into KEYWRD01 to KEYWRD10
          IF        NORECORD=0
            MOVE      "10",NORECORD       * Set Default No Records to Display
          ENDIF
          MOVE      ZERO,RECNUMB
          MOVE      ZERO,DISNUMB
.
          STRIP     KEYWRD01
          PACK      KEY27,DEPTCODE,KEYWRD01,SP70
          CALL      RSALRKI2
ALLRKA10  CALL      RKALRKI2
          BRANCH    OVRCD,ALLRKA90
.
          MATCH     DEPTCODE,ALRKDEPT
          GOTO      ALLRKA90 IF NOT EQUAL
.
          PACK      KEY12,ALRKDEPT,ALRKPROC,SP70
          CALL      RDALPRO1
          BRANCH    OVRCD,ALLRKA10
.
          MATCH     "1",ALPOACTV
          GOTO      ALLRKA10 IF NOT EQUAL
.
          CALL      ALLRKB00
          BRANCH    OVRCD,ALLRKA10,ALLRKA90
.
          ADD       ONE,RECNUMB
          IF        STARTNUM>=RECNUMB
            GOTO      ALLRKA10
          ENDIF
.
ALLRKA20 WRITE     HTMLFILE;"<tr valign=top>":
                              "<td nowrap><a href=#"":
                              "javascript:updateParent('",ALPODEPT:
                             "','",ALPOPROC,"','",ALPODESC,"')#">":
                              ALPOPROC:
                             "<td>",ALPODESC,"</td></tr>";
.
          ADD       ONE,DISNUMB
          COMPARE   NORECORD,DISNUMB
          GOTO      ALLRKA10 IF NOT EQUAL
ALLRKA90
.
ALLRKA99  RETURN
.
.------------------------------------------------------------
. Check Record
.------------------------------------------------------------
ALLRKB00  MATCH     KEYWRD01,ALRKKKWD
          GOTO      ALLRKB92 IF NOT EQUAL
          IF        KEYWRDNO>1
            PACK      SAVKEY27,DEPTCODE,ALRKKKWD,ALRKPROC
            CALL      ALLRKC00
            BRANCH    EXIT,ALLRKB91
            MOVE      SAVKEY27,KEY27
            CALL      RDALRKI2
          ENDIF
.
ALLRKB90  MOVE      ZERO,OVRCD
          GOTO      ALLRKB99
.
ALLRKB91  MOVE      ONE,OVRCD
          GOTO      ALLRKB99
.
ALLRKB92  MOVE      TWO,OVRCD
ALLRKB99  RETURN
.------------------------------------------------------------
. Check for Matching Words
.------------------------------------------------------------
ALLRKC00  MOVE      ONE,F2
          MOVE      ZERO,EXIT
          PACK      SAVKEY9,ALRKPROC,SP70
.
ALLRKC10  COMPARE   KEYWRDNO,F2           * Loop through each Key Word in Search
          GOTO      ALLRKC99 IF EQUAL     * Exit OK
.
          ADD       ONE,F2
          LOAD      KEYWRDXX,F2,KEYWRD01,KEYWRD02,KEYWRD03,KEYWRD04,KEYWRD05:
                             KEYWRD06,KEYWRD07,KEYWRD08,KEYWRD09,KEYWRD10
.
          PACK      KEY27,DEPTCODE,ALRKPROC,KEYWRDXX
          CALL      RDALRKI1              * Check for Exact Match
          COMPARE   ZERO,OVRCD            * Ok so Continue Loop
          GOTO      ALLRKC10 IF EQUAL
.
          CALL      RKALRKI1              * Not Exact so Read Next Record
          BRANCH    OVRCD,ALLRKC90        * No Match So Exit No Match
.
          MATCH     DEPTCODE,ALRKDEPT
          GOTO      ALLRKC90 IF NOT EQUAL
.
          PACK      KEY9,ALRKPROC,SP70
          MATCH     SAVKEY9,KEY9          * Match Key Fields
          GOTO      ALLRKC90 IF NOT EQUAL * No Match So Exit
.
          STRIP     KEYWRDXX
          MATCH     ALRKKKWD,KEYWRDXX         * Check Key Word
          GOTO      ALLRKC90 IF NOT EQUAL * No Match So Exit
.
          GOTO      ALLRKC10              * Check Next Search Word
.
ALLRKC90  MOVE      ONE,EXIT
.
ALLRKC99  RETURN
.
.------------------------------------------------------------
. Validate Item (return amount) with end date
.------------------------------------------------------------
VALMBE00  CALL      XMLHED00
          BRANCH    EXIT,VALMBE99
.
          MOVE      ZERO,EFDTFLAG
          MATCH     SP70,VALDTYPE
          IF        @EQUAL
            MOVE      " 0",VALDTYPE
            GOTO      VALMBE20
          ENDIF
.
          MATCH     "MBS",VALDTYPE
          IF        @EQUAL
            MOVE      " 0",VALDTYPE
          ELSE
            MOVE      " 1",VALDTYPE
          ENDIF
.
VALMBE20  PACK      KEY22,VALDTYPE,VALDCODE,VALDSCOD,Z70
          CALL      RSPRIT1
VALMBE30  CALL      RPPRIT1
          BRANCH    OVRCD,VALMBE90
.
          MOVE      PRITFLAG,KEY2
          MATCH     VALDTYPE,KEY2
          GOTO      VALMBE90 IF NOT EQUAL
.
          MATCH     VALDCODE,PRITITMN
          GOTO      VALMBE90 IF NOT EQUAL
.
          MATCH     SP70,VALDSCOD
          IF        !@EQUAL
            MATCH     VALDSCOD,PRITSUBN
            GOTO      VALMBE90 IF NOT EQUAL
          ENDIF
.
.         MATCH     SP70,VALDEFDT
.         IF        !@EQUAL
.           MOVE      ONE,EFDTFLAG
.           MATCH     PRITDAT1,VALDEFDT
.           GOTO      VALMBE30 IF LESS
.         ENDIF
.
          MATCH     SP70,VALDEFDT
          IF        !@EQUAL
            MOVE      ONE,EFDTFLAG
            MATCH     PRITDAT1,VALDEFDT
            GOTO      VALMBE30 IF LESS
            MATCH     SP8,PRITDAT2          * test for a Cease Date   *I-230710
            IF        !@EQUAL
              MATCH     VALDEFDT,PRITDAT2
              GOTO      VALMBE30 IF LESS    * read next if past Cease date
            ENDIF                                              * end  *I-230710
          ENDIF
.
          WRITE     HTMLFILE;"<RETURN_VALUE TYPE=SIMPLE>":
                             PRITDESC,"|",PRITSFEE:
                             "</RETURN_VALUE>"
          GOTO      VALMBE98
.
VALMBE90  BRANCH    EFDTFLAG,VALMBE91
          WRITE     HTMLFILE;"<RETURN_VALUE TYPE=ERROR>":
                             "Invalid Item Code - ":
                              VALDCODE,"</RETURN_VALUE>"
          GOTO      VALMBE98
.
VALMBE91  WRITE     HTMLFILE;"<RETURN_VALUE TYPE=ERROR>":
                             "Item not set up for effective date - ":
                              VALDCODE,"</RETURN_VALUE>"
          GOTO      VALMBE98
.
VALMBE98  CALL      XMLEND00
VALMBE99  RETURN
.
.------------------------------------------------------------
. Routine to display the Allied Health Departments List
.------------------------------------------------------------
IDEP0000  PACK      PTCDKEY2,ANSC,ANSG,SP70
          CALL      RDSCODE2                      * positional read
IDEP0100  CALL      RDKCODE2                      * read a record
          BRANCH    OVRCD,IDEP9999
.
          MATCH     "CG",TCODE
          GOTO      IDEP9999 IF NOT EQUAL
.
          MATCH     "I",PTCOACTV
          GOTO      IDEP0100 IF EQUAL
.
          MATCH     ANSI,TCINDC3
          GOTO      IDEP0100 IF NOT EQUAL
.
          MATCH     DEPTCODE,ACODE
          IF        @EQUAL
            WRITE     HTMLFILE;"<option value=",ACODE," selected>":
                             TDESC:
                             "</option>"
          ELSE
            WRITE     HTMLFILE;"<option value=",ACODE,">":
                             TDESC:
                             "</option>"
          ENDIF
          GOTO      IDEP0100
.
IDEP9999  RETURN
.
.------------------------------------------------------------
. Routine to display the Allied Health Departments List
. IP and AH
.------------------------------------------------------------
ADEPSL00  PACK      PTCDKEY2,ANSC,ANSG,SP70
          CALL      RDSCODE2                      * positional read
ADEPSL10  CALL      RDKCODE2                      * read a record
          BRANCH    OVRCD,ADEPSL99
.
          MATCH     "CG",TCODE
          GOTO      ADEPSL99 IF NOT EQUAL
.
          MATCH     "I",PTCOACTV
          GOTO      ADEPSL10 IF EQUAL
.
          MATCH     ANSA,TCINDC3
          IF        !@EQUAL
            MATCH     ANSI,TCINDC3
            GOTO      ADEPSL10 IF NOT EQUAL
          ENDIF
.
          MATCH     DEPTCODE,ACODE
          IF        @EQUAL
            WRITE     HTMLFILE;"<option value=",ACODE," selected>":
                             TDESC:
                             "</option>"
          ELSE
            WRITE     HTMLFILE;"<option value=",ACODE,">":
                             TDESC:
                             "</option>"
          ENDIF
          GOTO      ADEPSL10
.
ADEPSL99  RETURN
.
.------------------------------------------------------------
. Service Subtype Maintenance
.------------------------------------------------------------
SSTYPM00  RESET     UPDTTYPE
          MATCH     SP1,UPDTTYPE
          GOTO      SSTYPM30 IF EQUAL
.
          MATCH     "A",UPDTTYPE    * Add formaction
          GOTO      SSTYPM10 IF EQUAL
.
          MATCH     "D",UPDTTYPE    * Delete formaction
          GOTO      SSTYPM20 IF EQUAL
.
          GOTO      SSTYPM93
.
.         ************ ADD FORMACTION ***********
.
SSTYPM10  PACK      KEY8,DEPTCODE,CATZX,CONTCODE,SP70
          CALL      RDALCCT1
          IF        OVRCD=1
            UNPACK    KEY8,ALCCDEPT,ALCCTYPE,ALCCCONT
            PACK      ALCCCDAT,CCC,CYY,CMM,CDD
            REP       " 0",ALCCCDAT
            CLOCK     TIME,ALCCCTIM
            MOVE      USERID,ALCCCUID
            CALL      WRALCCT1
          ELSE
            MOVE      "Record already existed in allcctaf.",WEBTITLE
            CALL      WEBERR00
            MOVE      ONE,EXIT
            GOTO      SSTYPM99 
          ENDIF
.
          GOTO      SSTYPM99
.
.         ************ DELETE FORMACTION **********
.
SSTYPM20  PACK      KEY8,DEPTCODE,CATZX,CONTCODE,SP70
          CALL      RDALCCT1
          IF        OVRCD=0
            CALL      DEALCCT1
          ENDIF
.
          GOTO      SSTYPM99
.
SSTYPM30  CLEAR     WEBTITLE
          MOVE      "Service Subtype Maintenance",WEBTITLE
          RESET     WEBTITLE
.
          PACK      ALCCDEPT,DEPTCODE,SP70
.
          CALL      WEBHED00   * Create Output File and Write HTML Page Header
          BRANCH    EXIT,SSTYPM99
          CALL      WEBBOD00   * Process Web Body
          CALL      WEBEND00   * Process End of HTML File
.
          PACK      DEPTCODE,ALCCDEPT,SP70
.
          MOVE      ONE,EXIT
          GOTO      SSTYPM99
.
SSTYPM93  MOVE      "Invalid Form Action.",WEBTITLE
          CALL      WEBERR00
          MOVE      ONE,EXIT
          GOTO      SSTYPM99
.
SSTYPM99  RETURN
.
.-------------------------------------------------------------------------------
. Service Subtype Maintenance
.-------------------------------------------------------------------------------
SSTY0000  BRANCH    FLDITMNO,SSTY0100,SSTY0200,SSTY0300,SSTY0400,SSTY0500:
                             SSTY0600

.
          WRITE     HTMLFILE;"Invalid IBA Tag";
          GOTO      SSTY9999
.
SSTY0100  CALL      SSTYL000
          GOTO      SSTY9999
.
SSTY0200  MOVE      CATZX,CATEGORY
          MOVE      ALCCTYPE,CODE
          CALL      CODITM00
          GOTO      SSTY9999
.
SSTY0300  WRITE     HTMLFILE;DEPTCODE;
          GOTO      ACCC9999
.
SSTY0400  UNPACK    DIM127,D1,KEY1,DIM127
          MOVE      ZERO,F1
          MOVE      KEY1,F1
          BRANCH    F1,SSTY0401
.
          WRITE     HTMLFILE;CONTCODE;
          GOTO      SSTY9999
.
SSTY0401  PACK      KEY5,CATZX,CONTCODE
          CALL      RDCODE1
          IF        OVRCD=1
            WRITE     HTMLFILE;"Unknown Code: ",CONTCODE;
          ELSE
            WRITE     HTMLFILE;TDESC;
          ENDIF
          GOTO      SSTY9999
.
SSTY0500  CALL      PRVCCS00
          GOTO      SSTY9999
.
SSTY0600  CALL      NXTCCS00
          GOTO      SSTY9999
.
SSTY9999  RETURN
.
.-------------------------------------------------------------------------------
. Service Subtype List
.-------------------------------------------------------------------------------
SSTYL000  IF        NORECORD=0
.            MOVE      5,NORECORD      * Set Default No Records to Display
            MOVE      PTCNNRTD,NORECORD     * Set Default No Records to Display
          ENDIF
          MOVE      ZERO,RECNUMB
          MOVE      ZERO,DISNUMB
.
          PACK      KEY8,DEPTCODE,CATZX,STARTKEY,SP70
          CALL      RDALCCT1
          IF        OVRCD=0
            CALL     RPALCCT1
          ENDIF
SSTYL200  CALL      RKALCCT1
          BRANCH    OVRCD,SSTYL900
.
          MATCH     ALCCDEPT,DEPTCODE
          GOTO      SSTYL900 IF NOT EQUAL
.
          MATCH     CATZX,ALCCTYPE
          GOTO      SSTYL900 IF NOT EQUAL
.
          PACK      KEY5,CATZX,ALCCCONT,SP70
          CALL      RDCODE1
          BRANCH    OVRCD,SSTYL200
.
          MATCH     "A",PTCOACTV
          IF        @EQUAL
            MOVE      "Active  ",DIM8
          ELSE
            MOVE      "Inactive",DIM8
          ENDIF
.
          ADD       ONE,RECNUMB
          IF        STARTNUM>=RECNUMB
            GOTO      SSTYL200
          ENDIF
.
SSTYL400  WRITE     HTMLFILE;"<tr><td><a href='javascript:ShowDetail24":
                             "(#"allweb01.pbl?reportno=24&template=003":
                             "&deptcode=",DEPTCODE:
                             "&contcode=",ALCCCONT,"#")'>":
                             "<img src=../images/MaintenanceIcon.gif":
                             " class=Icon></a>",ALCCCONT,"</td>":
                             "<td>",TDESC,"</td>":
                             "<td>",DIM8,"</td></tr>"
.
          ADD       ONE,DISNUMB
          COMPARE   NORECORD,DISNUMB
          GOTO      SSTYL200 IF NOT EQUAL
          GOTO      SSTYL999 
.
SSTYL900  CALL      NOMORE00      * Display No More Records Message
.
SSTYL999  RETURN
.
.-----------------------------------------------------------
. Link to previous Subtype Codes
.-----------------------------------------------------------
PRVCCS00  MOVE      NORECORD,KEY2
          REP       " +",KEY2
          ASSIGN    STARTNUM-NORECORD,F3
          IF        F3<0
            MOVE      ZERO,F3
          ENDIF
          MOVE      F3,KEY3
          REP       " +",KEY3
          UNPACK    DIM127,D1,FLDPARA,DIM127
          MOVE      REPORTNO,F2
.
          REPLACE   " +",DEPTCODE
          REPLACE   " +",STARTKEY
.
          WRITE     HTMLFILE;"allweb01.pbl":
                             "?reportno=24":
                             "&template=001":
                             "&startnum=",KEY3:
                             "&norecord=",KEY2:
                             "&deptcode=",DEPTCODE:
                             "&startkey=",STARTKEY,"#"";
.
          REPLACE   "+ ",DEPTCODE
          REPLACE   "+ ",STARTKEY
.
PRVCCS99  RETURN
.-----------------------------------------------------------
. Link to next Subtype Codes
.-----------------------------------------------------------
NXTCCS00  MOVE      NORECORD,KEY2
          REP       " +",KEY2
          ASSIGN    STARTNUM+NORECORD,F3
          IF        F3<0
            MOVE      ZERO,F3
          ENDIF
          MOVE      F3,KEY3
          REP       " +",KEY3
          UNPACK    DIM127,D1,FLDPARA,DIM127
          MOVE      REPORTNO,F2
.
          REPLACE   " +",DEPTCODE
          REPLACE   " +",STARTKEY
.
          WRITE     HTMLFILE;"allweb01.pbl":
                             "?reportno=24":
                             "&template=001":
                             "&startnum=",KEY3:
                             "&norecord=",KEY2:
                             "&deptcode=",DEPTCODE:
                             "&startkey=",STARTKEY,"#"";
.
          REPLACE   "+ ",DEPTCODE
          REPLACE   "+ ",STARTKEY
.
NXTCCS99  RETURN
.
.-------------------------------------------------------------
.
          INC       IBAWEBCD
          INC       CLALLPDI
          INC       CLALLEQU
          INC       CLALLPRO
          INC       ALLATSIO/INC
          INC       ALLCCTIO/INC
          INC       ALLDLLIO/INC
          INC       ALLSERIO/INC
          INC       ALLDEPIO/INC
          INC       ALLDIAIO/INC
          INC       ALLDKIIO/INC
          INC       ALLDSPIO/INC
          INC       ALLINCIO/INC
          INC       ALLIKAIO/INC
          INC       ALLPKIIO/INC
          INC       ALLPROIO/INC
          INC       ALLPRRIO/INC
          INC       ALLMEDIO/INC
          INC       ALLMKIIO/INC
          INC       PRIPRAIO/INC
          INC       ALLRKIIO/INC
          INC       ALLTMPIO/INC
          INC       ALLBILIO/INC
          INC       ALLLETIO/INC
          INC       ALLPDIIO/INC
          INC       ALLVMPIO/INC
          INC       ALLIKAPR     
          INC       ALLMKIPR     
          INC       ALLADKPR     
          INC       ALLADRPR
          INC       ALLATSTM     
          INC       ALLBILTM     
          INC       ALLPDITM     
          INC       ALLEQUTM
          INC       ALLCASTM
          INC       ALLCTMTM
          INC       ALLDSPTM
          INC       ALLPROTM
          INC       DAYOFWEK
          INC       PATDOCCD
          INC       NAMSTRCD
          INC       ALLEQUIO/INC
          INC       PRIITMIO/INC
          INC       PATICDIO/INC
          INC       PATICOIO/INC
          INC       APSMASIO/INC
          INC       OUTSITIO/INC
          INC       PATHSPIO/INC  * Hospital File
          INC       ALLCASIO/INC
          INC       PMSHCPIO/INC
          INC       ALLCTMIO/INC
          INC       PATDOCTM
          INC       PATDO1IO/INC
          INC       ALLAPKPR
          INC       PMSVMTIO/INC
          INC       PMSVSTIO/INC
          INC       PMSVMTTM
          INC       PMSVSTTM
.
