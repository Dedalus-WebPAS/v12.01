.***************************************************************************
.* System    :   Inpatients                                                *
.* Program   :   DLVX1REC                                                  *
.* Desc      :   Delete pmsvx1af records                                   *
.***************************************************************************
.* Date      :   06/03/2007                                                *
.* Author    :   Jill Habasque                                             *
.* Function  :   This program will remove a range of records from pmsvx1af *
.* Modifications:                                                          *
.*       V12.00.01  14/05/2025  Peter Vela     TSK 0955096                 *
.*                  Alphanumeric Visit Number changes                      *
.*        V9.11.01  17/02/2009  Mike Laming   CAR 167860                   *
.*                  Update to PMSVX1FD standard - size to 916, add 12 vars *
.***************************************************************************
.
          INC       STD001FD
.
. FILE DESCRIPTION INCLUDES
. -------------------------
          INC       PMSVX1FD/INC
          INC       ARCVX1FD/INC
.
. LOCAL VARIABLE DEFINITION
. -------------------------
CMDLINE   DIM       80
COUNT     FORM      8
.DIM8VISN  DIM       8
VISSTART  DIM       8
VISFINSH  DIM       8
.
PRGID     INIT      "DLVX1REC"
PRGNAM    INIT      "Delete selected pmsvx1af records"
VERSION   INIT      "V12.01.00"
+
.**************************************************************************
.*                              ML0000                                    *
.*                      Controlling Logic (Mainline code)                 *
.**************************************************************************
.
ML0000    CALL      INIT0000               * initialisation and open files
.
ML0100    CALL      OPTN0000               * select options
          BRANCH    EXIT,ML9999            * EXIT = 1 if 0 chosen in menu
          BRANCH    COPTION,ML1000         * proceed with clean up
.
ML1000    CALL      PROC0000               * process
          BRANCH    EXIT,ML0100
          CALL      CONTQST                * Ok to continue ?
          BRANCH    CEXIT,ML2000:          * yes
                          ML0100:          * no
                          ML0100           * cancel
.
ML2000    CALL      DELVIS00
.
ML9999    CHAIN     PGM                    * chain back to program
+
.****************************************************************************
.*                                INIT0000             Called by: ML0000    *
.*                             initialisation                               *
.*  The initialisation routine is used to display headings and open files.  *
.****************************************************************************
.
INIT0000  CALL      DISPHEAD                  * display heading
.
          OPEN      PMSVX1A1,"pmsvx1af"
.
INIT9999  RETURN
+
.****************************************************************************
.*                                OPTN0000             Called by: ML0000    *
.*                        get user options or exit                          *
.*                                                                          *
.*    Returns:  EXIT    = FALSE (0)  Run clean up                           *
.*                        TRUE  (1)  Exit option selected                   *
.****************************************************************************
.
OPTN0000  DISPLAY   *P1:3,*EF,*P1:4,*V2LON,ZERO,*HOFF,". Exit":
                    *P1:5,*V2LON,ONE,*HOFF,". Delete records"
.
OPTN0500  KEYIN     *P1:7,*EL,"Select Option : ",*DV,UNDLN1:
                    *P17:7,*V2LON,COPTION
.
          COMPARE   ZERO,COPTION                 * exit selected ?
          GOTO      OPTN9500 IF EQUAL            * yes
.
          BRANCH    COPTION,OPTN9000             * run clean-up
.
          BEEP
          GOTO      OPTN0500
.
OPTN9000  MOVE      ZERO,EXIT
          GOTO      OPTN9999
.
OPTN9500  MOVE      ONE,EXIT
.
OPTN9999  RETURN
+
.**************************************************************************
.*                               PROC0000              Called by: ML0000  *
.*                                                                        *
.**************************************************************************
.
PROC0000  MOVE      ZERO,EXIT
          KEYIN     *P1:12,"Delete visits from ",VISSTART
          KEYIN     *P1:13,"Delete visits to   ",VISFINSH
          RJUSTIFY  VISSTART
          RJUSTIFY  VISFINSH
          MATCH     VISSTART,VISFINSH
          GOTO      PROC9000 IF LESS
.
          GOTO      PROC9999
.
PROC9000  DISPLAY   *P1:24,"Visit number to cannot be after start ";
          CALL      HITENTER
          MOVE      ONE,EXIT
.
PROC9999  RETURN
+
.**************************************************************************
.*                               DELVIS00              Called by: PROC0000*
.*                                                                        *
.**************************************************************************
DELVIS00  MOVE      ZERO,OVRCD
          TRAP      OVERCOND IF IO
          OPEN      ARCVX1A1,"arcvx1af"
          TRAPCLR   IO
          IF        OVRCD=0
            GOTO      DELVIS10
          ENDIF
          CLEAR     CMDLINE
          APPEND    "isbuild arcvx1af 916 UC1-8 ",CMDLINE             *C-167860
          RESET     CMDLINE
          EXECUTE   CMDLINE,TASKID
          OPEN      ARCVX1A1,"arcvx1af"
.
DELVIS10  MOVE      ZERO,COUNT
          PACK      KEY8,VISSTART,SP70
          CALL      RDPMVX11
          IF        OVRCD<>1
            GOTO      DELVIS30
          ENDIF
.
DELVIS15  CALL      RSPMVX11
DELVIS20  CALL      RKPMVX11
          BRANCH    OVRCD,DELVIS99
.
DELVIS30  MOVE      PMVXVISN,DIM8VISN
          MATCH     DIM8VISN,VISFINSH
          GOTO      DELVIS99 IF LESS
.
          CALL      MVPMAR00      * move pmsvx1af to arcvx1af
.
          PACK      KEY8,PMVXVISN,SP70
          CALL      RAARVX11
          IF        OVRCD<>1
            GOTO      DELVIS20
          ENDIF
.
          PACK      KEY8,PMVXVISN,SP70
          CALL      WRARVX11
          PACK      KEY8,PMVXVISN,SP70
          CALL      DEPMVX11
.
          ADD       ONE,COUNT
          PACK      KEY8,PMVXVISN,SP70
          GOTO      DELVIS15
.

.
DELVIS99  DISPLAY   *P1:23,COUNT," records deleted.";
          CALL      HITENTER
          RETURN
.
MVPMAR00  PACK      ARVXVISN,PMVXVISN,SP70
          PACK      ARVXVSDT,PMVXVSDT,SP70
          PACK      ARVXDOCA,PMVXDOCA,SP70
          PACK      ARVXDOCT,PMVXDOCT,SP70
          PACK      ARVXCSNR,PMVXCSNR,SP70
          PACK      ARVXPOST,PMVXPOST,SP70
          PACK      ARVXPIND,PMVXPIND,SP70
          PACK      ARVXVLOC,PMVXVLOC,SP70
          PACK      ARVXCFSG,PMVXCFSG,SP70
          PACK      ARVXINGP,PMVXINGP,SP70
          PACK      ARVXCPTH,PMVXCPTH,SP70
          PACK      ARVXHCP1,PMVXHCP1,SP70
          PACK      ARVXHCP2,PMVXHCP2,SP70
          PACK      ARVXHCP3,PMVXHCP3,SP70
          PACK      ARVXHCP4,PMVXHCP4,SP70
          PACK      ARVXRHC1,PMVXRHC1,SP70
          PACK      ARVXRH1G,PMVXRH1G,SP70
          PACK      ARVXRH1C,PMVXRH1G,SP70
          PACK      ARVXRHC2,PMVXRHC2,SP70
          PACK      ARVXRH2G,PMVXRH2G,SP70
          PACK      ARVXRH2C,PMVXRH2C,SP70
          PACK      ARVXRHC3,PMVXRHC2,SP70
          PACK      ARVXRH3G,PMVXRH3G,SP70
          PACK      ARVXRH3C,PMVXRH3C,SP70
          PACK      ARVXRHC4,PMVXRHC4,SP70
          PACK      ARVXRH4G,PMVXRH4G,SP70
          PACK      ARVXRH4C,PMVXRH4C,SP70
          PACK      ARVXABRG,PMVXABRG,SP70
          PACK      ARVXCADM,PMVXCADM,SP70
          PACK      ARVXIRAD,PMVXIRAD,SP70
          PACK      ARVXIDUS,PMVXIDUS,SP70
          PACK      ARVXCRAV,PMVXCRAV,SP70
          PACK      ARVXRCCT,PMVXRCCT,SP70
          PACK      ARVXAPWD,PMVXAPWD,SP70
          PACK      ARVXAPBD,PMVXAPBD,SP70
          PACK      ARVXPOWD,PMVXPOWD,SP70
          PACK      ARVXPOBD,PMVXPOBD,SP70
          PACK      ARVXPSTY,PMVXPSTY,SP70
          PACK      ARVXVALW,PMVXVALW,SP70
          PACK      ARVXPALW,PMVXPALW,SP70
          PACK      ARVXINDC,PMVXINDC,SP70
          PACK      ARVXMDAV,PMVXMDAV,SP70
          PACK      ARVXFRMS,PMVXFRMS,SP70
          PACK      ARVXCSNG,PMVXCSNG,SP70
          MOVE      PMVXPWGT,ARVXPWGT
          MOVE      PMVXPHGT,ARVXPHGT
          PACK      ARVXDHWR,PMVXDHWR,SP70
          PACK      ARVXEDC1,PMVXEDC1,SP70
          PACK      ARVXEDC2,PMVXEDC2,SP70
          PACK      ARVXEDC3,PMVXEDC3,SP70
          PACK      ARVXHOME,PMVXHOME,SP70
          PACK      ARVXUDF1,PMVXUDF1,SP70
          PACK      ARVXUDF2,PMVXUDF2,SP70
          PACK      ARVXUDF3,PMVXUDF3,SP70
          PACK      ARVXUDF4,PMVXUDF4,SP70
          PACK      ARVXUDT1,PMVXUDT1,SP70
          PACK      ARVXUDT2,PMVXUDT2,SP70
          PACK      ARVXUDT3,PMVXUDT3,SP70
          PACK      ARVXUDT4,PMVXUDT4,SP70
          PACK      ARVXUDT5,PMVXUDT5,SP70
          PACK      ARVXUDT6,PMVXUDT6,SP70
          PACK      ARVXCDTE,PMVXCDTE,SP70
          PACK      ARVXCTIM,PMVXCTIM,SP70
          PACK      ARVXWEBC,PMVXWEBC,SP70
          PACK      ARVXLUPD,PMVXLUPD,SP70
          PACK      ARVXLUPT,PMVXLUPT,SP70
          PACK      ARVXWEBU,PMVXWEBU,SP70
          PACK      ARVXMHLS,PMVXMHLS,SP70
          PACK      ARVXPICD,PMVXPICD,SP70
          PACK      ARVXRMOR,PMVXRMOR,SP70
          PACK      ARVXASUT,PMVXASUT,SP70
          PACK      ARVXELPS,PMVXELPS,SP70
          PACK      ARVXEMPL,PMVXEMPL,SP70
          PACK      ARVXFINP,PMVXFINP,SP70
          PACK      ARVXOCCP,PMVXOCCP,SP70
          PACK      ARVXPALC,PMVXPALC,SP70
          PACK      ARVXPPAL,PMVXPPAL,SP70
          PACK      ARVXPPPT,PMVXPPPT,SP70
          PACK      ARVXPSOS,PMVXPSOS,SP70
          PACK      ARVXPYSP,PMVXPYSP,SP70
          PACK      ARVXQLDB,PMVXQLDB,SP70
          PACK      ARVXREAD,PMVXREAD,SP70
          PACK      ARVXUDIN,PMVXUDIN,SP70
          PACK      ARVXUREA,PMVXUREA,SP70
          PACK      ARVXUSAC,PMVXUSAC,SP70
          PACK      ARVXUVTH,PMVXUVTH,SP70
          PACK      ARVXINTR,PMVXINTR,SP70
          PACK      ARVXLNG1,PMVXLNG1,SP70
          PACK      ARVXASGC,PMVXASGC,SP70
          PACK      ARVXMHOS,PMVXMHOS,SP70
          PACK      ARVXDSPD,PMVXDSPD,SP70
          PACK      ARVXDSIF,PMVXDSIF,SP70
          PACK      ARVXPRMI,PMVXPRMI,SP70
          PACK      ARVXPRAI,PMVXPRAI,SP70
          PACK      ARVXPRES,PMVXPRES,SP70
          PACK      ARVXUITR,PMVXUITR,SP70
          PACK      ARVXRPOA,PMVXRPOA,SP70
          PACK      ARVXRCN1,PMVXRCN1,SP70
          PACK      ARVXRCN2,PMVXRCN2,SP70
          PACK      ARVXRHFU,PMVXRHFU,SP70
          PACK      ARVXRDVA,PMVXRDVA,SP70
          PACK      ARVXRSLO,PMVXRSLO,SP70
          PACK      ARVXMLOC,PMVXMLOC,SP70
          PACK      ARVXPACC,PMVXPACC,SP70
          PACK      ARVXEDU1,PMVXEDU1,SP70
          PACK      ARVXEDU2,PMVXEDU2,SP70
          PACK      ARVXEDU3,PMVXEDU3,SP70
          PACK      ARVXPRGM,PMVXPRGM,SP70
          PACK      ARVXCONF,PMVXCONF,SP70
          PACK      ARVXEOCL,PMVXEOCL,SP70
          PACK      ARVXSLOC,PMVXSLOC,SP70
          PACK      ARVXSCLI,PMVXSCLI,SP70
          PACK      ARVXSTRA,PMVXSTRA,SP70
          PACK      ARVXQASN,PMVXQASN,SP70
          PACK      ARVXATCP,PMVXATCP,SP70
          PACK      ARVXATIM,PMVXATIM,SP70
          PACK      ARVXITIM,PMVXITIM,SP70
          PACK      ARVXHFGN,PMVXHFGN,SP70
          PACK      ARVXHFSN,PMVXHFSN,SP70
          PACK      ARVXFUPI,PMVXFUPI,SP70
          PACK      ARVXPOEC,PMVXPOEC,SP70
          PACK      ARVXSPAR,PMVXSPAR,SP70
.
MVPMAR99  RETURN
. =========================================================================
.         I/O Includes
. =========================================================================
.
          INC       STD001IO
          INC       PMSVX1IO/INC
          INC       ARCVX1IO/INC
