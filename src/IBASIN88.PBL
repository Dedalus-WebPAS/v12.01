.-----------------------------------------------------------------
          INC       STDGENDF     * Required Include
.
VERSION   INIT      "V12.01.00"
.-------------------------------------------------------
. V9.02.00  03.05.2002  Glenn Saunders
.           Export to new release i.e. v9.02 from vf.09[
.-------------------------------------------------------
. VF.00.02  22.12.1999 Charles Handaya
.           Recompiled for Fixing Audit Date (CCYYMMDD)
. VF.00.01  03.11.1999 Sandra Barcham
.           Change locked message to use X
.-----------------------------------------------------------------
EXPORTFL  FILE      ASCII, FIXED=400     * Export File (Adjust Length to Suit)
EXPORTFN  DIM       8                    * Export File Name
TABDELM   EQU       0x09                 * Tab Delimiter
.
ORDTOTAL  FORM      14.2
CSTTOTAL  FORM      14.2
REPTOTAL  FORM      14.2
LASTORD   DIM       7
NOORD     FORM      8
TOTNOORD  FORM      8
STRDAT    DIM       8
ENDDAT    DIM       8
STRCST    DIM       5
ENDCST    DIM       5
REPTTYP   FORM      1
PRTQTY    DIM       9   9,999,999
PRTAMT    DIM       13  99,999,999.99
PRTPRI    DIM       14  9,999,999.9999
PRTTOT    DIM       18  999,999,999,999.99
.
TEMPFILE  IFILE     SQL, FIXED=156, KEY="U1-5,6-13,14-20,21-23"
.
TEMPCST   DIM       5     5    1
TEMPDAT   DIM       8     8    6
TEMPORD   DIM       7     7    14
TEMPLIN   DIM       3     3    21
TEMPDES   DIM       60    60   24
TEMPSUT   DIM       15    15   84
TEMPQTY   FORM      12.2  8    101
TEMPPRI   FORM      12.4  9    109
TEMPAMT   FORM      12.2  8    118
TEMPSPA   DIM       30    30   126
.
.                              156
.-----------------------------------------------------------------
.@@@@@ Start of Generated Code @@@@@
. NB - Code & Comments Included Before the above line 
.      will not be overwritten by the generation of a 
.      program. The STDGENDF file and VERSION must appear
.      before the line. 
.-----------------------------------------
.   Program       :   IBASIN88
.   Function      :   Purchases by Cost Centre Report         
.   Generated  On :   13/12/2005
.-----------------------------------------
.=========================
.File Description Includes
.-------------------------
          INC       SINCCAFD/INC
          INC       SINPOAFD/INC
          INC       SINPOCFD/INC
          INC       SINPOFFD/INC
.=========================
.Local Variable Definition
.-------------------------
REPTDESC  DIM      20 * Scr 00 Fld     4
FROMDAT   DIM      10 * Scr 00 Fld     5
TODAT     DIM      10 * Scr 00 Fld     6
FROMCST   DIM      45 * Scr 00 Fld     7
TOCST     DIM      45 * Scr 00 Fld     8
REPTAMT   FORM     12.2 * Scr 00 Fld     9
EXPORTYN  FORM      1 * Scr 00 Fld    10
TOTONLY   FORM      1 * Scr 00 Fld    11
.
ACCEPT    FORM      1
SACCEPT   FORM      1
.
PRGID     INIT      "IBASIN88"
PRGNAM    INIT      "Purchases by Cost Centre Report         "
.
.--------------------------------
. MAINLINE - Controlling Logic
.--------------------------------
          TOPIC     PRGID
          MOVE      PORT,PARENTID
          CLOCK     PORT,DIM2
          MOVE      DIM2,PORT
ML0000
          CALL      INIT0000
          CALL      SC00L000
          CHAIN     PGM
.---------------------------------------
. INIT - Open Files & Display Heading
.---------------------------------------
INIT0000  CALL      DISPHEAD
          MOVE      ONE,CCENTRY
          MOVE      ONE,CCANLDTE
          MOVE      ONE,CDEFDTE
          MOVE      ZERO,CHIGHLT
          DISPLAY   *P56:24,"Opening controlf";
          OPEN      CONTROLF,"controlf"
          DISPLAY   *P56:24,"Opening scrsbga1";
          OPEN      SCRSBGA1,"scrsbgaf"
          DISPLAY   *P56:24,"Opening scrpsta1";
          OPEN      SCRPSTA1,"scrpstaf"
          DISPLAY   *P56:24,"Opening scrpsta1";
          OPEN      SCRPSTA2,"scrpstaf"
          DISPLAY   *P56:24,"Opening scrslta1";
          OPEN      SCRSLTA1,"scrsltaf"
          MOVE      "   24",AUDTSECT
          MOVE      "202",AUDTPOST
          READ      CONTROLF,AUDTSECT;*AUDTPOST,AUDTFLAG
          IF        AUDTFLAG=1
            DISPLAY   *P56:24,"Opening sinaudca";
            OPEN      SINAUDCA,"sinaudca"
          ENDIF
          MOVE      "   24",AUDTSECT
          MOVE      "210",AUDTPOST
          READ      CONTROLF,AUDTSECT;*AUDTPOST,AUDTFLAG
          IF        AUDTFLAG=1
            DISPLAY   *P56:24,"Opening sinaudpa";
            OPEN      SINAUDPA,"sinaudpa"
          ENDIF
          MOVE      "   24",AUDTSECT
          MOVE      "210",AUDTPOST
          READ      CONTROLF,AUDTSECT;*AUDTPOST,AUDTFLAG
          IF        AUDTFLAG=1
            DISPLAY   *P56:24,"Opening sinaudpc";
            OPEN      SINAUDPC,"sinaudpc"
          ENDIF
          MOVE      "   24",AUDTSECT
          MOVE      "218",AUDTPOST
          READ      CONTROLF,AUDTSECT;*AUDTPOST,AUDTFLAG
          IF        AUDTFLAG=1
            DISPLAY   *P56:24,"Opening sinaudpf";
            OPEN      SINAUDPF,"sinaudpf"
          ENDIF
          DISPLAY   *P56:24,"Opening sinccaaf";
          OPEN      SINCCAA1,"sinccaaf"
          DISPLAY   *P56:24,"Opening sinccaaf";
          OPEN      SINCCAA2,"sinccaaf"
          DISPLAY   *P56:24,"Opening sinpoaaf";
          OPEN      SINPOAA1,"sinpoaaf"
          DISPLAY   *P56:24,"Opening sinpoaaf";
          OPEN      SINPOAA2,"sinpoaaf"
          DISPLAY   *P56:24,"Opening sinpoaaf";
          OPEN      SINPOAA3,"sinpoaaf"
          DISPLAY   *P56:24,"Opening sinpoaaf";
          OPEN      SINPOAA4,"sinpoaaf"
          DISPLAY   *P56:24,"Opening sinpocaf";
          OPEN      SINPOCA1,"sinpocaf"
          DISPLAY   *P56:24,"Opening sinpocaf";
          OPEN      SINPOCA2,"sinpocaf"
          DISPLAY   *P56:24,"Opening sinpocaf";
          OPEN      SINPOCA3,"sinpocaf"
          DISPLAY   *P56:24,"Opening sinpocaf";
          OPEN      SINPOCA4,"sinpocaf"
          DISPLAY   *P56:24,"Opening sinpocaf";
          OPEN      SINPOCA5,"sinpocaf"
          DISPLAY   *P56:24,"Opening sinpocaf";
          OPEN      SINPOCA6,"sinpocaf"
          DISPLAY   *P56:24,"Opening sinpocaf";
          OPEN      SINPOCA7,"sinpocaf"
          DISPLAY   *P56:24,"Opening sinpocaf";
          OPEN      SINPOCA8,"sinpocaf"
          DISPLAY   *P56:24,"Opening sinpofaf";
          OPEN      SINPOFA1,"sinpofaf"
          DISPLAY   *P56:24,"Opening sinpofaf";
          OPEN      SINPOFA2,"sinpofaf"
          DISPLAY   *P56:24,"Opening sinpofaf";
          OPEN      SINPOFA3,"sinpofaf"
          DISPLAY   *P56:24,"Opening sinpofaf";
          OPEN      SINPOFA4,"sinpofaf"
INIT9999  DISPLAY   *P1:24,*EL;
          RETURN
.
.------------------------------------
. Called for Print Screen Routine 
.------------------------------------
PRTSVARS
          MATCH     "00",SCRID
          IF         @EQUAL
            CALL       PS00L000   * Options                            
          ENDIF
          RETURN
.--------------------------------
. Screen - Options                            
.--------------------------------
SC00L000
SC00L100
          MOVE      "00",SCRID
          MOVE      ZERO,PRCOL
          MOVE      ZERO,PRVERT
          MOVE      "    1",FLDID
          CALL      GETPOSIT
          IF        EXIT=0
            MOVE     SCPSCOL,PRCOL
            MOVE     SCPSROW,PRVERT
          ENDIF
          CALL      SBACK000 * Display Background
.
SC00L200
          CALL      CF00L000 * Clear Fields
          CALL      MVACCEPT
SC00L300
          CALL      KY00L000 * Enter Key Fields
          BRANCH    EXIT,SC00L999,SC00L999
SC00L400
          CALL      WP00L000 * Load any WP Details
SC00L500
          CALL      LM00L000 * Load any Batch Details
SC00L600
          CALL      DF00L000 * Display Fields
SC00L700
          CALL      SF00L000 * Select Fields
          BRANCH    EXIT,SC00L100,SC00L100,SC00L200
          IF        EXIT=4
            MOVE      ONE,EXIT
          ENDIF
SC00L800
SC00L900
SC00L999  RETURN
.--------------------------------------------------------
. Clear Fields for Screen : Options                            
.-------------------------------------------------------
CF00L000
          MOVE      SP70,REPTDESC
          MOVE      SP70,FROMDAT 
          MOVE      SP70,TODAT   
          MOVE      SP70,FROMCST 
          MOVE      SP70,TOCST   
          MOVE      ZERO,REPTAMT 
          MOVE      ZERO,EXPORTYN
          MOVE      ZERO,TOTONLY 
CF00L999  RETURN
.--------------------------------------------------------
. Enter Key Fields for Options                            
.--------------------------------------------------------
KY00L000
          MOVE      ZERO,EXIT
          GOTO      KY00L999
.
KY00L900  MOVE      ONE,EXIT
KY00L999  RETURN
.---------------------------------------------------------
. Load WP files for : Options                            
.---------------------------------------------------------
WP00L000
          RETURN
.---------------------------------------------------------
. Load Batch Screen for : Options                            
.---------------------------------------------------------
LM00L000
          RETURN
.---------------------------------------------------------
. Display Fields for : Options                            
.---------------------------------------------------------
DF00L000
          BRANCH   ACCEPT,DF00L999
          PACK     KEY15,PRGID,SCRID,SP70
          CALL     RSSCPS1
DF00L010
          CALL     RKSCPS1
          BRANCH   OVRCD,DF00L900
          MATCH    PRGID,SCPSPID
          GOTO     DF00L900 IF NOT EQUAL
          MATCH    SCRID,SCPSSID
          GOTO     DF00L900 IF NOT EQUAL
          MATCH    SP70,SCPSMTY
          GOTO     DF00L010 IF NOT EQUAL
.
          CALL     PS00L000 * Display Field
          GOTO     DF00L010
DF00L900
DF00L999
          RETURN
.---------------------------------------------------------
. Display/Print Fields for : Options                            
.---------------------------------------------------------
PS00L000   PACK      VAR,SP70,SP70
          PACK     PRINTVAR,SP70,SP70
          MOVE     SCPSITM,FIELDNO
          BRANCH    FIELDNO,PS00L999,PS00L999,PS00L999,PS00L101:
                            PS00L102,PS00L103,PS00L104,PS00L105:
                            PS00L106,PS00L107,PS00L108
          GOTO     PS00L999
.
PS00L101
          MOVE      REPTDESC,VAR     
          CALL      DISPITEM
          GOTO     PS00L999
.
PS00L102
          MOVE      FROMDAT,VAR      
          CALL      DISPITEM
          GOTO     PS00L999
.
PS00L103
          MOVE      TODAT,VAR        
          CALL      DISPITEM
          GOTO     PS00L999
.
PS00L104
          MOVE      FROMCST,VAR      
          CALL      DISPITEM
          GOTO     PS00L999
.
PS00L105
          MOVE      TOCST,VAR        
          CALL      DISPITEM
          GOTO     PS00L999
.
PS00L106
          MOVE      REPTAMT,VAR      
          CALL      DISPITEM
          GOTO     PS00L999
.
PS00L107
          MOVE      NO,YESNO
          MOVE      ZERO,FORM2
          MOVE      EXPORTYN,FORM2   
          LOAD      YESNO,FORM2,YES
          MOVE      YESNO,VAR
          CALL      DISPITEM
          GOTO     PS00L999
.
PS00L108
          MOVE      NO,YESNO
          MOVE      ZERO,FORM2
          MOVE      TOTONLY,FORM2    
          LOAD      YESNO,FORM2,YES
          MOVE      YESNO,VAR
          CALL      DISPITEM
          GOTO     PS00L999
PS00L999
          RETURN
.---------------------------------------------------------
. Selections for : Options                            
.---------------------------------------------------------
SF00L000  PACK     KEY13,PRGID,SCRID,SP70
          CALL     RSSCSL1
SF00L001  BRANCH   ACCEPT,SF00L020
.
SF00L005  CALL     MTSTQ000
          MOVE     SCSLITM,FIELDNO
          BRANCH    FIELDNO,SF00L006,SF00L101,SF00L102,SF00L103:
                            SF00L104,SF00L006,SF00L105,SF00L006:
                            SF00L106,SF00L107,SF00L108
SF00L006  BEEP
          GOTO     SF00L005
SF00L020  CALL     RKSCSL1
          BRANCH   OVRCD,SF00L090
          MATCH    PRGID,SCSLPID
          GOTO     SF00L090 IF NOT EQUAL
          MATCH    SCRID,SCSLSID
          GOTO     SF00L090 IF NOT EQUAL
          MOVE     SCSLITM,FIELDNO
          BRANCH    FIELDNO,SF00L020,SF00L020,SF00L020,SF00L103:
                            SF00L104,SF00L020,SF00L105,SF00L020:
                            SF00L106,SF00L107,SF00L108
          GOTO     SF00L020
SF00L090  MOVE     ZERO,ACCEPT
          GOTO     SF00L001
.
SF00L101
          CALL      REPT0000
          MOVE      ZERO,EXIT
          GOTO      SF00L999
.
SF00L102
          MOVE      ZERO,EXIT
          GOTO      SF00L999
.
SF00L103
          CALL     SELECTED
          MOVE      "0",CKEYTYP
          CALL      EREPT000
          IF        SCPSMAN=1
            IF        EXIT=1
              MOVE      "Mandatory Field - ",DISPMSG
              BEEP
              CALL      MESSAGE1
              GOTO      SF00L103
            ENDIF
            BRANCH    EXIT,SF00L103,SF00L990
          ELSE
            COMPARE   TWO,EXIT
            GOTO      SF00L990 IF EQUAL
          ENDIF
          MOVE      REPTDESC,VAR     
          CALL      DISPITEM
          GOTO     SF00L001
.
SF00L104
.
.
          MOVE      "    6",FLDID
          CALL      GETPOSIT
          IF        EXIT=0
            MOVE     SP70,TODAT   
            PACK      VAR,SP70,SP70
            CALL      DISPITEM
          ENDIF
          CALL     SELECTED
          MOVE      "0",CKEYTYP
          CALL      RDATE000
          IF        SCPSMAN=1
            IF        EXIT=1
              MOVE      "Mandatory Field - ",DISPMSG
              BEEP
              CALL      MESSAGE1
              GOTO      SF00L104
            ENDIF
            BRANCH    EXIT,SF00L104,SF00L990
          ELSE
            COMPARE   TWO,EXIT
            GOTO      SF00L990 IF EQUAL
          ENDIF
          MOVE      FROMDAT,VAR      
          CALL      DISPITEM
.
.
          MOVE      "    6",FLDID
          CALL      GETPOSIT
          IF        EXIT=0
            MOVE      TODAT,VAR        
            CALL      DISPITEM
          ENDIF
          GOTO     SF00L001
.
SF00L105
.
.
          MOVE      "    8",FLDID
          CALL      GETPOSIT
          IF        EXIT=0
            MOVE     SP70,TOCST   
            PACK      VAR,SP70,SP70
            CALL      DISPITEM
          ENDIF
          CALL     SELECTED
          MOVE      "0",CKEYTYP
          CALL      RCOST000
          IF        SCPSMAN=1
            IF        EXIT=1
              MOVE      "Mandatory Field - ",DISPMSG
              BEEP
              CALL      MESSAGE1
              GOTO      SF00L105
            ENDIF
            BRANCH    EXIT,SF00L105,SF00L990
          ELSE
            COMPARE   TWO,EXIT
            GOTO      SF00L990 IF EQUAL
          ENDIF
          MOVE      FROMCST,VAR      
          CALL      DISPITEM
.
.
          MOVE      "    8",FLDID
          CALL      GETPOSIT
          IF        EXIT=0
            MOVE      TOCST,VAR        
            CALL      DISPITEM
          ENDIF
          GOTO     SF00L001
.
SF00L106
          CALL     SELECTED
          MOVE      SP70,VAR
          CALL      DISPITEM
          KEYIN     *PCCOL:CVERT,*V2LON,*NOMASK,*RV,REPTAMT 
          IF        SCPSMAN=1
            COMPARE   ZERO,REPTAMT 
            IF        @EQUAL
              MOVE      "Mandatory Field - ",DISPMSG
              BEEP
              CALL      MESSAGE1
              GOTO      SF00L106
            ENDIF
          ENDIF
          MOVE      REPTAMT,VAR      
          CALL      DISPITEM
          GOTO     SF00L001
.
SF00L107
          CALL      DEFAULTN
          CALL     SELECTED
          CALL      YORN0000
          MOVE       FYESNO,EXPORTYN
          MOVE      NO,YESNO
          MOVE      ZERO,FORM2
          MOVE      EXPORTYN,FORM2   
          LOAD      YESNO,FORM2,YES
          MOVE      YESNO,VAR
          CALL      DISPITEM
          GOTO     SF00L001
.
SF00L108
          CALL      DEFAULTN
          CALL     SELECTED
          CALL      YORN0000
          MOVE       FYESNO,TOTONLY 
          MOVE      NO,YESNO
          MOVE      ZERO,FORM2
          MOVE      TOTONLY,FORM2    
          LOAD      YESNO,FORM2,YES
          MOVE      YESNO,VAR
          CALL      DISPITEM
          GOTO     SF00L001
SF00L990  MOVE      FOUR,EXIT * Exit Char Exit
SF00L999  RETURN
.@@@@@ Function Restart Point @@@@@
.----------------------------------------
. Move one to accept to for insert mode
.----------------------------------------
MVACCEPT  MOVE      ONE,ACCEPT
          RETURN
DEFAULTN    MOVE     ANSN,DEFYESNO
            RETURN
.------------------------------------------------------------
. Print Cost Centre Orders Report
.------------------------------------------------------------
REPT0000  CALL      MAKEXP00                * Create Export File if Required
          CALL      MKTEMP00
          IF        REPTTYP=1
            CALL      EXOR0000              * Extract Orders
          ELSE
            CALL      EXRE0000              * Extract Receivals
          ENDIF
.
          DISPLAY   *P1:24,*EL,"Printing Report ..."
          CLOCK     TIME,CTIMEIS
          MOVE      ZERO,CPAGENO
          MOVE      ZERO,SECTOR           * Counter
          MOVE      ZERO,REPTOTAL
          MOVE      ZERO,TOTNOORD
          MOVE      "99",CLNO             * New Page
.
          PACK      KEY5,STRCST,SP70
          CALL      RDSICA1
          IF        OVRCD=0
            CALL      RPSICA1
          ENDIF
.
REPT1000  CALL      RKSICA1
          BRANCH    OVRCD,REPT9000
          MATCH     SICACODE,ENDCST
          GOTO      REPT9000 IF LESS
.
          IF        TOTONLY=0
            MOVE      "99",CLNO              * New Page for Each Cost Centre
          ENDIF
          CALL      PCOST000               * Print Cost Centre Orders
          GOTO      REPT1000
.
REPT9000  CALL      UND132
          MOVE      "999,999,999,999.99",PRTTOT
          FEDIT     REPTOTAL,PRTTOT
          PRINT     *45,"Number of Orders   ",TOTNOORD:
                    *95,"Report Total     ",*115,PRTTOT
          CALL       UND132
          PRINT     *50,"****** End of Report *******"
          MOVE      ZERO,TOTNOORD
          CALL      TRAN0000               * Transfer Export File to PC
          CLOSE     TEMPFILE,DELETE
.
REPT9999  RETURN
.------------------------------------------------------------
. Print Cost Centre Report
.------------------------------------------------------------
PCOST000  PACK      KEY23,SICACODE,SP70
          MOVE      ZERO,CSTTOTAL
          MOVE      ZERO,NOORD
          MOVE      SP70,LASTORD
          CALL      RSTEMP1
.
PCOST100  CALL      RKTEMP1
          BRANCH    OVRCD,PCOST900
          MATCH     TEMPCST,SICACODE
          GOTO      PCOST900 IF NOT EQUAL
.
          MATCH     TEMPORD,LASTORD
          GOTO      PCOST200 IF EQUAL
          MATCH     SP70,LASTORD
          GOTO      PCOST190 IF EQUAL
.
          CALL      PRTORD00    * Print Order
.
PCOST190  MOVE      ZERO,ORDTOTAL
          MOVE      TEMPORD,LASTORD
.
PCOST200  ADD       TEMPAMT,ORDTOTAL
          ADD       TEMPAMT,CSTTOTAL
          ADD       TEMPAMT,REPTOTAL
.
          CALL      PRTLIN00    * Print Line
          GOTO      PCOST100
.
PCOST900  CALL      PRTCST00    * Print Cost Centre Total
          ADD       NOORD,TOTNOORD
          MOVE      ZERO,NOORD
.
PCOST999  RETURN
.------------------------------------------------------------
. Print Order Line
.------------------------------------------------------------
PRTLIN00  BRANCH    TOTONLY,PRTLIN99
          ADD       ONE,CLNO
          COMPARE   "55",CLNO
          CALL      PHEAD000 IF NOT LESS
.
          UNPACK    TEMPDAT,CCENT,CYEAR,CMON,CDAY
          CALL      PACDATE
          MOVE      "9,999,999.9999",PRTPRI
          FEDIT     TEMPPRI,PRTPRI
          MOVE      "99,999,999.99",PRTAMT
          FEDIT     TEMPAMT,PRTAMT
          MOVE      "9,999,999",PRTQTY
          MOVE      TEMPQTY,F10
          FEDIT     F10,PRTQTY
          PRINT     TEMPORD,SP1,CPCDATE,SP1,TEMPDES,SP1:
                    PRTQTY,SP1,TEMPSUT,PRTPRI,PRTAMT
          CALL      WRTEXP00
.
PRTLIN99  RETURN
.------------------------------------------------------------
. Print Order Total
.------------------------------------------------------------
PRTORD00  ADD       ONE,NOORD
          BRANCH    TOTONLY,PRTORD99
          MOVE      "999,999,999,999.99",PRTTOT
          FEDIT     ORDTOTAL,PRTTOT
          PRINT     *100,"---------------------------------"
          IF        ORDTOTAL>REPTAMT
            PRINT      "*****************************************":
                       *95,"Order Total",*115,PRTTOT
          ELSE
            PRINT      *95,"Order Total",*115,PRTTOT
          ENDIF
          ADD        TWO,CLNO
          COMPARE    "55",CLNO
          CALL       UND132 IF LESS
PRTORD99  RETURN
.------------------------------------------------------------
. Print Cost Centre Total
.------------------------------------------------------------
PRTCST00  COMPARE   ZERO,CSTTOTAL
          GOTO      PRTCST99 IF EQUAL
          BRANCH    TOTONLY,PRTCST10
          MOVE      "999,999,999,999.99",PRTTOT
          FEDIT     ORDTOTAL,PRTTOT
          PRINT      *100,"---------------------------------"
          IF        ORDTOTAL>REPTAMT
            PRINT      "*****************************************":
                       *95,"Order Total",*115,PRTTOT
          ELSE
            PRINT      *95,"Order Total",*115,PRTTOT
          ENDIF
          CALL       UND132
          GOTO       PRTCST20
.
PRTCST10  COMPARE    "55",CLNO
          CALL       PHEAD000 IF NOT LESS
          ADD        ONE,CLNO
.
PRTCST20  ADD        ONE,NOORD
          MOVE       "999,999,999,999.99",PRTTOT
          FEDIT      CSTTOTAL,PRTTOT
          PRINT      SICADESC:
                     *45,"Number of Orders   ",NOORD:
                     *95,"Cost Centre Total",*115,PRTTOT
PRTCST99  RETURN
.------------------------------------------------------------
. Print Page Heading
.------------------------------------------------------------
PHEAD000  CALL      HEAD132
          DISPLAY   *P30:24,CPAGENO
          IF        TOTONLY=1
            PRINT     *40,"COST CENTRE TOTALS ONLY"
          ELSE
            PRINT     *40,SICADESC,"(",SICACODE,")"
          ENDIF
          IF        REPTTYP=1
            PRINT     *40,"Purchase Order Placed":
                      " From : ",FROMDAT," to ",TODAT
          ELSE
            PRINT     *40,"Purchase Order Received":
                      " From : ",FROMDAT," to ",TODAT
          ENDIF
          CALL      UND132
          PRINT     "  P/O     Date     Description                    Part ":
                    "Number                         Qty Units               ":
                    "    Price        Total"
          CALL      UND132
          ADD       THREE,CLNO
PHEAD999  RETURN
.------------------------------------------------------------
. Extract Orders
.------------------------------------------------------------
EXOR0000  DISPLAY   *P1:24,*EL,"Extracting Orders .... "
          MOVE      ZERO,SECTOR
          PACK      KEY15,STRDAT,SP70
          CALL      RSSIPA4
.
EXOR1000  CALL      RKSIPA4
          BRANCH    OVRCD,EXOR9000
          MATCH     SIPADIN,ENDDAT
          GOTO      EXOR9000 IF LESS
          MATCH     SP8,SIPADCN
          GOTO      EXOR1000 IF NOT EQUAL
          PACK      KEY10,SIPAPON,SP70
          CALL      RSSIPC1
EXOR2000  CALL      RKSIPC1
          BRANCH    OVRCD,EXOR1000
          MATCH     SIPAPON,SIPCPON
          GOTO      EXOR1000 IF NOT EQUAL
          MATCH     STRCST,SIPCCST
          GOTO      EXOR2000 IF LESS
          MATCH     SIPCCST,ENDCST
          GOTO      EXOR2000 IF LESS
.
          ADD       ONE,SECTOR
          IF        SECTOR%100=0
            DISPLAY   *P30:24,SECTOR
          ENDIF
.
          PACK      KEY23,SIPCCST,SIPADIN,SIPAPON,SIPCITM,SP70
          UNPACK    KEY23,TEMPCST,TEMPDAT,TEMPORD,TEMPLIN
          PACK      TEMPDES,SIPCPD,SP1,SIPCPN
          MOVE      SIPCSUT,TEMPSUT
          MOVE      SIPCOQT,TEMPQTY
          MOVE      SIPCECT,TEMPPRI
          ASSIGN    SIPCECT*SIPCOQT,TEMPAMT
          MOVE      SP70,TEMPSPA
          CALL      RATEMP1
          IF        OVRCD=1
            CALL      WRTEMP1
          ENDIF
          GOTO      EXOR2000
.
EXOR9000
.
EXOR9999  RETURN
.
RSTEMP1   READ      TEMPFILE,KEY23;;
          RETURN
.
RATEMP1   MOVE      ZERO,OVRCD
          READ      TEMPFILE,KEY23;ANS
          GOTO      OVERCOND IF OVER
          RETURN
.
RDTEMP1   MOVE      ZERO,OVRCD
          READ      TEMPFILE,KEY23;TEMPCST,TEMPDAT,TEMPORD,TEMPLIN,TEMPDES:
                                   TEMPSUT,TEMPQTY,TEMPPRI,TEMPAMT,TEMPSPA
          GOTO      OVERCOND IF OVER
          RETURN
.
RKTEMP1   MOVE      ZERO,OVRCD
          READKS    TEMPFILE;TEMPCST,TEMPDAT,TEMPORD,TEMPLIN,TEMPDES:
                             TEMPSUT,TEMPQTY,TEMPPRI,TEMPAMT,TEMPSPA
          GOTO      OVERCOND IF OVER
          RETURN
.
WRTEMP1   WRITE     TEMPFILE,KEY23;TEMPCST,TEMPDAT,TEMPORD,TEMPLIN,TEMPDES:
                                   TEMPSUT,TEMPQTY,TEMPPRI,TEMPAMT,TEMPSPA
          RETURN
.
MKTEMP00  MOVE      "sin88a",KEY6
          PACK      KEY8,KEY6,PORT
          REP       " 0",KEY8
          MOVE      ZERO,OVRCD
          TRAP      OVERCOND IF IO
          OPEN      TEMPFILE,KEY8
          TRAPCLR   IO
          IF        OVRCD=0
            CLOSE     TEMPFILE,DELETE
          ENDIF
          CLEAR     KEY80
          APPEND    "isbuild ",KEY80
          APPEND    KEY8,KEY80
          APPEND    " 156 UC1-5,6-13,14-20,21-23",KEY80
          RESET     KEY80
          EXECUTE   KEY80,TASKID
          OPEN      TEMPFILE,KEY8
          RETURN
.------------------------------------------------------------
. Extract Orders
.------------------------------------------------------------
EXRE0000  DISPLAY   *P1:24,*EL,"Extracting Orders .... "
          MOVE      ZERO,SECTOR
          PACK      KEY20,STRDAT,SP70
          CALL      RSSIPF4
.
EXRE1000  CALL      RKSIPF4
          BRANCH    OVRCD,EXRE9000
          MATCH     SIPFDAT,ENDDAT
          GOTO      EXRE9000 IF LESS
          PACK      KEY7,SIPFPON,SP70
          CALL      RDSIPA1
          BRANCH    OVRCD,EXRE1000
          MATCH     SP8,SIPADCN
          GOTO      EXRE1000 IF NOT EQUAL
          PACK      KEY10,SIPFPON,SIPFITM,SP70
          CALL      RDSIPC1
          BRANCH    OVRCD,EXRE1000
.
          MATCH     STRCST,SIPCCST
          GOTO      EXRE1000 IF LESS
          MATCH     SIPCCST,ENDCST
          GOTO      EXRE1000 IF LESS
.
          ADD       ONE,SECTOR
          IF        SECTOR%100=0
            DISPLAY   *P30:24,SECTOR
          ENDIF
.
          PACK      KEY23,SIPCCST,SIPFDAT,SIPFPON,SIPCITM,SP70
          UNPACK    KEY23,TEMPCST,TEMPDAT,TEMPORD,TEMPLIN
          PACK      TEMPDES,SIPCPD,SP1,SIPCPN
          MOVE      SIPFSUT,TEMPSUT
          MOVE      SIPFQTY,TEMPQTY
          MOVE      SIPFCST,TEMPPRI
          ASSIGN    SIPFCST*SIPFQTY,TEMPAMT
          MOVE      SP70,TEMPSPA
          CALL      RATEMP1
          IF        OVRCD=1
            CALL      WRTEMP1
          ENDIF
          GOTO      EXRE1000
.
EXRE9000
.
EXRE9999  RETURN
.------------------------------------------------------------
. File       : casetran
.
. Functions  : This file contains standard routines for
.              creating and transfering TAB delimited
.              export files to a PC using the unix script
.              keatran.
.
. Routines   : MAKEXP00  - Create the Export File and Headings
.              WRTEXP00  - Write Export Record to File
.              TRAN0000  - Transfer file to PC using script keatran
.
. Note       : The Variable EXPORTYN is used to determine if a
.              export file is to be created. 0=No, 1=Yes.
.
. Variables to be Declared
. ------------------------
. EXPORTFL  FILE      ASCII, FIXED=400     * Export File (Adjust Length to Suit)
. EXPORTFN  DIM       8                    * Export File Name
. TABDELM   EQU       0x09                 * Tab Delimiter
.------------------------------------------------------------
. Create Export File
.------------------------------------------------------------
MAKEXP00  COMPARE  ZERO,EXPORTYN
          GOTO     MAKEXP99 IF EQUAL
          MOVE     "EXPORT",KEY6
          PACK     EXPORTFN,KEY6,PORT
          REP      " 0",EXPORTFN
          PREP     EXPORTFL,EXPORTFN
          WRITE    EXPORTFL,SEQ;"Cost Centre",TABDELM:
                                "Cost Centre Name",TABDELM:
                                "Order Number",TABDELM:
                                "Line Number",TABDELM:
                                "Date",TABDELM:
                                "Part Number",TABDELM:
                                "Part Description",TABDELM:
                                "Quantity",TABDELM:
                                "Supply Unit",TABDELM:
                                "Price",TABDELM:
                                "Total"
MAKEXP99  RETURN
.------------------------------------------------------------
. Write to Export File
.------------------------------------------------------------
WRTEXP00  COMPARE  ZERO,EXPORTYN
          GOTO     WRTEXP99 IF EQUAL
          PACK     KEY10,TEMPORD,TEMPLIN
          CALL     RDSIPC1
          WRITE    EXPORTFL,SEQ;SICACODE,TABDELM:
                                SICADESC,TABDELM:
                                TEMPORD,TABDELM:
                                TEMPLIN,TABDELM:
                                CPCDATE,TABDELM:
                                SIPCPN,TABDELM:
                                SIPCPD,TABDELM:
                                PRTQTY,TABDELM:
                                TEMPSUT,TABDELM:
                                PRTPRI,TABDELM:
                                PRTAMT
WRTEXP99  RETURN
.------------------------------------------------------------
. Execute Transfer Script eg softerm
.------------------------------------------------------------
TRAN0000  COMPARE  ZERO,EXPORTYN
          GOTO     TRAN9999 IF EQUAL
          MOVE     YES,DEFYESNO
          CLOSE    EXPORTFL
          DISPLAY  *P1:24,*EL,"Execute Transfer Now (":
                              *V2LON,"Y",*HOFF,"/":
                              *V2LON,"N",*HOFF,") ? "
          MOVE     "24",CVERT
          MOVE     "30",CCOL
          CALL     YORN0000
          COMPARE  ZERO,FYESNO,
          GOTO     TRAN9999 IF EQUAL   *  No Transfer
.
          MOVE     ZERO,HLEF
          CALL     GETSCR00
.
          CLEAR    KEY80
          APPEND   "keatran ",KEY80
          APPEND   EXPORTFN,KEY80
          APPEND   ".txt",KEY80
          RESET    KEY80
          EXECUTE  KEY80,TASKID
.
          CALL     PUTSCR00
.
          DISPLAY  *P1:24,*EL,"Transfer Completed Ok (":
                              *V2LON,"Y",*HOFF,"/":
                              *V2LON,"N",*HOFF,") ? "
          MOVE     "24",CVERT
          MOVE     "31",CCOL
          CALL     YORN0000
          COMPARE  ZERO,FYESNO,
          GOTO     TRAN0000 IF EQUAL   *  Not ok
.
          PREP     EXPORTFL,KEY8
          CLOSE    EXPORTFL
.
TRAN9999  RETURN
.
.------------------------------------------------------------
. Enter Report Type
.------------------------------------------------------------
EREPT000  KEYIN     *PCCOL:CVERT,*V2LON,ANS
          REP       UPPLOW,ANS
          MATCH     "O",ANS
          GOTO      EREPT100 IF EQUAL
          MATCH     "R",ANS
          GOTO      EREPT200 IF EQUAL
          MATCH     SP70,ANS
          GOTO      EREPT000 IF NOT EQUAL
          MOVE      TWO,EXIT
          GOTO      EREPT999
.
EREPT100  MOVE      "Orders Report",REPTDESC
          MOVE      ONE,REPTTYP
          MOVE      ZERO,EXIT
          GOTO      EREPT999
.
EREPT200  MOVE      "Receival Report",REPTDESC
          MOVE      TWO,REPTTYP
          MOVE      ZERO,EXIT
          GOTO      EREPT999
.
EREPT999  RETURN
.
.----------------------------------------
. Enter Date Range
.  where DAT     = Field ID
.        RDATE   = Call Routine Label
.        "    1" = Screen Item Number for "from" Variable
.        "    2" = Screen Item Number for "to" Variable
.
.  Return Values
.        FROMDAT  Date for Start of Range Formatted in a DIM 10
.        TODAT    Date for End of Range Formatted in a DIM 10
.        STRDAT   Date for Start of Range Format CCYYMMDD
.        ENDDAT   Date for End of Range Format CCYYMMDD
.----------------------------------------
RDATE000   MOVE     "    5",FLDID
           CALL     GETPOSIT
           MOVE     SP70,CDAY
           MOVE     CMM,CMON
           MOVE     CYY,CYEAR
           MOVE     CCC,CCENT
           CALL     KEYDATE
           BRANCH   OVRCD,RDATE100
           MATCH    SP2,CDAY
           GOTO     RDATE100 IF EQUAL
           PACK     STRDAT,CCENT,CYEAR,CMON,CDAY
           REP      " 0",STRDAT
           CALL     PACDATE
           MOVE     CPCDATE,FROMDAT
           GOTO     RDATE140
RDATE100   MOVE     "Start             ",FROMDAT
           MOVE     SP70,STRDAT
.
RDATE140   MOVE     FROMDAT,VAR
           CALL     DISPITEM
.
RDATE150   MOVE     "    6",FLDID
           CALL     GETPOSIT
           MOVE     SP70,CDAY
           MOVE     CMM,CMON
           MOVE     CYY,CYEAR
           MOVE     CCC,CCENT
           CALL     KEYDATE
           BRANCH   OVRCD,RDATE200
           MATCH    SP2,CDAY
           GOTO     RDATE200 IF EQUAL
           PACK     ENDDAT,CCENT,CYEAR,CMON,CDAY
           REP      " 0",ENDDAT
           CALL     PACDATE
           MOVE     CPCDATE,TODAT
           MATCH    STRDAT,ENDDAT
           GOTO     RDATE999 IF EQUAL
           GOTO     RDATE999 IF NOT LESS
           BEEP
           MOVE     "To Date Must Be > From Date - ",DISPMSG
           CALL     MESSAGE1
           GOTO     RDATE000
.
RDATE200   MOVE     "Finish             ",TODAT
           MOVE     "99999999",ENDDAT
.
RDATE999   MOVE     "    5",FLDID
           CALL     GETPOSIT
           RETURN
.
.------------------------------------------------------------
. Input Cost Centre Range
.------------------------------------------------------------
RCOST000   MOVE     "    7",FLDID
           CALL     GETPOSIT
           CALL     KSICAA00
           BRANCH   EXIT,RCOST100,RCOST999
           MOVE     SICACODE,STRCST
           PACK     FROMCST,SICACODE,SP1,SICADESC
           GOTO     RCOST140
.
RCOST100   MOVE     "Start             ",FROMCST
           MOVE     SP70,STRCST
.
RCOST140   MOVE     FROMCST,VAR
           CALL     DISPITEM
.
RCOST150   MOVE     "    8",FLDID
           CALL     GETPOSIT
           CALL     KSICAA00
           BRANCH   EXIT,RCOST200,RCOST999
           MOVE     SICACODE,ENDCST
           PACK     TOCST,SICACODE,SP1,SICADESC
           MATCH    STRCST,ENDCST
           GOTO     RCOST999 IF EQUAL
           GOTO     RCOST999 IF NOT LESS
           BEEP
           MOVE     "To Cost Centre Must Be > From Cost Centre - ",DISPMSG
           CALL     MESSAGE1
           GOTO     RCOST000
.
RCOST200   MOVE     "Finish             ",TOCST
           MOVE     "~~",ENDCST
.
RCOST999   MOVE     "    7",FLDID
           CALL     GETPOSIT
           RETURN
.
.-------------------------------
. Includes for I/O and Keyins
.-------------------------------
          INC       SINCCAIO/INC
          INC       SINCCAKY    
          INC       SINPOAIO/INC
          INC       SINPOCIO/INC
          INC       SINPOFIO/INC
.
          INC       STDGENCD
.
