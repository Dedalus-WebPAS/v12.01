.------------------------------------------------------------------------------
. Program       : COMWEB06
.
. Function      : NIHC IHI / NEHTA Interface 
.               : 
.
. Modifications : 
.------------------------------------------------------------------------------
. V11.04.04 20/02/2024  Peter Vela       TSK 0939978
.           Added functionality to display MyHR Request and Response records
.           from pmsmhqaf and pmsmhraf 
.           16/02/2024  Peter Vela       TSK 0939978
.           Added check for MyHR Episode Upload in IPOLJ000
.           10/01/2024  Peter Vela       TSK 0939978
.           Recompiled for PMSNDBFD - Added Episode and Upload URLs
.           Validate PMNPRTYP = 10 in IPOLLS00. Do not display 
.           Upload Episode to MyHR records in IPOLLS00.
. V11.04.03 18/12/2023  Peter Vela       TSK 0935874
.           Fixed loop and validation in GETIHI00
. V11.04.02 30/11/2023  Peter Vela       TSK 0935874
.           Recompiled for PMSIHEFD - Added indexes 4,5,6 and added Exception
.           Description
.           Added display of Exception description to EENROW00
.           Changed EEDTE000 to display by Created Date
.           Added PIEX2300,PIEX2400,PIEX2500,PIEX2600 
.           search IHI Exceptions by UR Number
.           Added patient folder icon in EENROW00 and all associated 
.           calling functions
. V11.04.01 20/11/2023  Peter Vela       TSK 0935874
.           Added PMIHEDAT,PMIHETIM to IAUTAB00
.           Added PMIEURNO to EENROW00 
. V11.03.07 23/10/2023  Peter Vela       TSK 0935874
.           Added multihospital validation for PMNBHOSP
.           Added tag for NIHC GetAccessTokenViewSumm Hospital Code
.           Added tag for NIHC Roles from websecaf 
.           Added tag for NIHC MyHRViewer and Pat Summ URLs
.           SETPNL00 - If single hospital, then get first hospital available in
.           pathspaf
.           IAUTAB00 - Added display of Lookup or Clear IHI in IAUTAB00
.           according to status in PMSIHIFD.PMIHSTAT
. V11.03.05 17/10/2023  Peter Vela       TSK 0935874
.           Added parameter check for pmsihiaf
. V11.03.04 10/10/2023  Peter Vela    TSK 0935874
.           Recompiled for PMSNDBFD - New URL variables
.           Recompiled for PMSIHIFD - Fixed IO calls
. V11.03.03 05/10/2023  Thanh T       TSK 0935874
.           Added WPMPNL00 to Write a record to the pmsnplaf Table 
. V11.03.02 28/09/2023  Thanh T       TSK 0935874
.           Added NIHC Interface functionality
. V11.03.01 21/09/2023  Thanh T       TSK 0935874 
.           Added NIHC Interface functionality
. V11.02.01 09/02/2022  Thanh T       TSK 0905641
.           Recompiled as OUTMA1FD (PATMASTM) changes
. V11.00.01 09/12/2020  Thanh T        TSK 0872840
.           Added PMSCCDFD/PMSCCDIO as PMSPX2TM changes
. V10.11.05 27/11/2017  Thanh Tieu     Task 0821710
.           Recompiled as PATMASTM changed
. V10.11.04 30/07/2017  Thanh T.       TSK 0821710
.           Audit admission/outpatient/UR comments. changed PATMASTM/PMSPX2TM.
. V10.11.02 26/07/2017  Thanh T.        TSK 0821710
.           Recompiled PASMISTM
. V10.11.01 14/07/2017  Thanh T.       TSK 0821710
.           Audit Amission/outpatient visit comments. PATMISTM changed.
. V10.04.02 07/04/2014  Peter Vela      CAR 286258
.           Recompiled for PATMASTM
. V10.04.01 31.03.2014  B.G.Ackland  CAR 299363
.           Replace META Tag Redirect with Javascript in Common RDIREC00
.           Routine
. V10.04.00 30/01/2014  Ebon Clements            CAR 291879
.           Created Web Server.
.------------------------------------------------------------------------------
          INC       IBAWEBDF    
          INC       WEBDATDF
.
          INC       PATDO1FD/INC   * Doctor File
          INC       PATHSPFD/INC
          INC       PATMI1FD/INC
          INC       PATMA1FD/INC
          INC       PATVISFD/INC   * Patients Visits File
          INC       PMSVX1FD/INC   * Visit Extension File
          INC       PATCONFD/INC
          INC       PATALRFD/INC
          INC       OUTSITFD/INC
          INC       PMSUCHFD/INC
          INC       PMSUCDFD/INC
          INC       PATMASTD/INC
          INC       PATPR1FD/INC
          INC       PMSIPLFD/INC
          INC       PMSPX2FD/INC
          INC       PATFN1FD/INC
          INC       PATWR1FD/INC
          INC       MRTMASFD/INC
          INC       NHIMASFD/INC
          INC       NHIETHFD/INC
          INC       PATCALAG/INC
          INC       PMSPX2TD/INC
          INC       PATRE1FD/INC
          INC       PATDGWFD/INC
          INC       VISMDTFD/INC
          INC       VISMTXFD/INC
          INC       PATITMFD/INC
          INC       PATDADFD/INC
          INC       PATVADFD/INC
          INC       PATCMCFD/INC
          INC       PATASFFD/INC
          INC       PMSHCGTD/INC
          INC       PMSHCGFD/INC
          INC       PMSHCPFD/INC
          INC       PMSHCPTD/INC
          INC       PMSCCDFD/INC            * Concession Card Details
          INC       APSMASFD/INC
          INC       PATIN1FD/INC
          INC       PATDSCFD/INC
.
          INC       PMSIERFD/INC            * HI Service Error Messages
          INC       PMSIHIFD/INC            * IHI Info
          INC       PMSIHEFD/INC            * IHI Exceptions
          INC       PMSNPLFD/INC            * NIHC IHI Polling 
          INC       PMSIRQFD/INC            * DHS Medicare Request Details
          INC       PMSMHQFD/INC
          INC       PMSIRSFD/INC           * DHS Medicare Request Result Details
          INC       PMSMHRFD/INC
          INC       PMSNDBFD/INC            
.
          INC       PATMISTD/INC
.
.
.------------------------------------------------------------------------------
CMDLINE   DIM       200
.
ACTVSTAT  DIM       20       * Activation status
ALLHFLAG  FORM      1        * 'All' hospital flag
BATCHNUM  DIM       20       * Batch ID
.
CATw0     INIT      "w0"
.
DTTMDIS1  DIM       30       * Date/Time display (DD mmm YYCC at hh:mm:ss)
DTTMDIS2  DIM       30       * Date/Time display (DD mmm YYCC at hh:mm:ss)
DATEPSTT  DIM       8        * Start Date (YYCCMMDD)
DATEPEND  DIM       8        * End Date (YYCCMMDD)
DIM8      DIM       8
DIM10     DIM       10
DIM20     DIM       20
DIM50     DIM       50
DISPDATE  DIM       11       * Display date (DD mmm YYCC)
DISPUSER  DIM       30       * Web user name
DOCTCODE  DIM       8
ENDOFLST  FORM      1        * End of list flag
ENSELOPT  DIM       1        * Enquiry selected option
ERRORCOD  DIM       4        * HI Service Error Code
F2A       FORM      2
FILTTYPE  FORM      1        * Filter Type:
                             *   1 - Service Code
                             *   2 - Requesting Organisation (Hosp. code)
FORM8     FORM      8 
HOSPCODE  DIM       3
HOSPNAME  DIM       50
IDENTNUM  DIM       20
IHINUMBR  DIM       20       * IHI Number
IHIUSERI  DIM       10       * User ID
HISMSGID  DIM       127      * HI Service messageID
IHIURNUM  DIM       8
.
HTMLLNK1  DIM       256 
HTMLLNK2  DIM       256 
.
IREQDATE  DIM       8
IREQTIME  DIM       8
IREQCNTR  DIM       4
IREQTYPE  DIM       2
IREQCODE  DIM       50
.
REQUSRNM  DIM       30
CRTUSRNM  DIM       30
UPDUSRNM  DIM       30
.
MBSDESC   DIM       70
NEXTPAGE  DIM       1        * Nextpage parameter CGI parameter
ORGNNAME  DIM       50       * Organisation name (hospital)
REQTYPED  DIM       30
REQSTATD  DIM       30
PSAGECON  DIM       3
PSAGETYP  DIM       3
REQTCODE  DIM       50       * Request code
ROWCOUNT  FORM      3        * Row count
SELSERVC  DIM       2        * IHI Source (service code)
SELREQTP  DIM       2        * HI Request Type
SERVDESC  DIM       25       * IHI Source (service description)
STARTKEY  DIM       66       * Starting Key
UPDTTYPE  DIM       1        * Update Type
VALDCODE  DIM       52       * Validation Code - remote scripting
VALDTYPE  FORM      1        * Validation Type - remote scripting
VERISTAT  DIM       20       * Verification status
WEBPSTAT  DIM       20       * WebPAS status
.
PROPFLNM  DIM       35
PROPFILE  FILE      ASCII,FIXED=256
PROPLITR  INIT      ".properties"
PROPLINE  DIM       150
.
NIHWFLNM  DIM       33
NIHWFILE  FILE      ASCII,FIXED=256
NIHWLITR  INIT      "_nihcihi"
NIHWLINE  DIM       150
NIHWLITU  INIT      "_nihcihiupload"
.
NIHRFLNM  DIM       38
NIHRFILE  FILE      ASCII,FIXED=500
NIHRLITR  INIT      "_nihcihi_response"
NIHRLINE  DIM       500
NIHRLITU  INIT      "_nihcihiupload_response"
.
NIHEFLNM  DIM       36
NIHEFILE  FILE      ASCII,FIXED=500
NIHELITR  INIT      "_nihcihi_errors"
NIHELINE  DIM       150
NIHELITU  INIT      "_nihcihiupload_errors"
.
CONSTRAT  INIT      " at "
VERSTAT1  INIT      "Verified"
VERSTAT2  INIT      "Manual"
ACTSTAT1  INIT      "Active"
ACTSTAT2  INIT      "Deceased"
ACTSTAT3  INIT      "Retired"
ACTSTAT4  INIT      "Expired"
ACTSTAT5  INIT      "Resolved"
SERVICE1  INIT      "HI Service B2B Channel"
SERVICE2  INIT      "Electronic message"
SERVICE3  INIT      "Manual entry"
WEBSTAT0  INIT      "Active"
WEBSTAT1  INIT      "Inactive"
WEBSTAT2  INIT      "Merged"
.
.------------------------------------------------------------------------------
PRGID     INIT      "COMWEB06"
VERSION   INIT      "V12.01.00"
PRGNAM    INIT      "NEHTA Interface"
.------------------------------------------------------------------------------
.
          CALL      WEBINT00       * Initialise Fifo Etc.
          CALL      INIT0000       * Open Files
.
MAIN1000  CALL      WEBRED00       * Read Fifo WEBPID and USERID
.
          COMPARE   "999",REPORTNO * End Server Process on Report Option 999
          GOTO      MAIN9999 IF EQUAL
.
          BRANCH    REPORTNO,MAIN1100,MAIN1200,MAIN1300,MAIN1400,MAIN1500:
                             MAIN1600,MAIN1700,MAIN1800,MAIN1900,MAIN2000: 
                             MAIN2100
.
          PACK      WEBTITLE,PRGID,SP1,VERSION,SP1,PRGNAM,SP70
          MOVE      "Invalid Option",WEBTITLE
          CALL      WEBERR00   * Create Output File and Write HTML Page Header
          GOTO      MAIN1000
.
MAIN1100  CALL      NEHA0000           * IHI History
          BRANCH    EXIT,MAIN1000
          CALL      NXTPAG00
          GOTO      MAIN1000
.
MAIN1200  CALL      IHIENQ00           * IHI Enquiry
          BRANCH    EXIT,MAIN1000
          CALL      NXTPAG00
          GOTO      MAIN1000
.
MAIN1300  CALL      IHIEXC00           * IHI Exceptions Enquiry
          GOTO      MAIN1000
.
MAIN1400  CALL      IHIERR00           * IHI Errors Enquiry
          GOTO      MAIN1000
.
MAIN1500  CALL      REMOTE00           * Various Remote Scripting Functions
          GOTO      MAIN1000
.
MAIN1600  CALL      IHIPOL00           * NIHC IHI Polling
          BRANCH    EXIT,MAIN1000
          CALL      NXTPAG00
          GOTO      MAIN1000
.
MAIN1700  CALL      IPOJSN00           * NIHC IHI JSON Enquiry
          BRANCH    EXIT,MAIN1000
          CALL      NXTPAG00
          GOTO      MAIN1000
.
MAIN1800  CALL      IPOREQ00           * NIHC IHI Request Enquiry
          BRANCH    EXIT,MAIN1000
          CALL      NXTPAG00
          GOTO      MAIN1000
.
MAIN1900  CALL      IPORST00           * NIHC IHI Result Enquiry
          BRANCH    EXIT,MAIN1000
          CALL      NXTPAG00
          GOTO      MAIN1000
.
MAIN2000  CALL      MYHREQ00           * NIHC MyHR Request Enquiry
          BRANCH    EXIT,MAIN1000
          CALL      NXTPAG00
          GOTO      MAIN1000
.
MAIN2100  CALL      MYHRES00           * NIHC MyHR Result Enquiry
          BRANCH    EXIT,MAIN1000
          CALL      NXTPAG00
          GOTO      MAIN1000
.
MAIN9999  MOVE      "SERVER SHUTDOWN COMPLETE",WEBTITLE
          CALL      WEBERR00
          STOP
.------------------------------------------------------------------------------
. Output Next Page Based on CGI Parameter nextpage
.------------------------------------------------------------------------------
NXTPAG00  MOVE      ZERO,F1
          MOVE      NEXTPAGE,F1
          BRANCH    F1,NXTPAG10,NXTPAG20,NXTPAG30,NXTPAG40
.
          CALL      WINCLS00
          GOTO      NXTPAG99
.
NXTPAG10  CALL      RDIREC00
          GOTO      NXTPAG99
.
NXTPAG20  CALL      GOBACK00      * Go Back 1 Html page
          GOTO      NXTPAG99
.
NXTPAG30  CALL      DAH20000      * Go Back 2 html pages
          GOTO      NXTPAG99
.
NXTPAG40  CALL      PREDIR00      * Redirect Parent
          GOTO      NXTPAG99
.
NXTPAG99  RETURN
.------------------------------------------------------------------------------
.  Redirect Parent URL
.------------------------------------------------------------------------------
PREDIR00  CALL      OPENHTML
          BRANCH    EXIT,PREDIR90
.
          WRITE     HTMLFILE;"<script type=#"text/javascript#"> {":
                             " parent.location.href=#"",REDIRECT,"#";":
                             "}":
                             "</script>"
          CALL      CLOSHTML
          GOTO      PREDIR99
.
PREDIR90  DISPLAY   "*** Fifo Not Found ***"
.
PREDIR99  RETURN
.-------------------------------------------------------------------------------
.  Goes back 1 page
.-------------------------------------------------------------------------------
GOBACK00  CALL      OPENHTML
          BRANCH    EXIT,GOBACK99
          WRITE     HTMLFILE;"<script type=#"text/javascript#"> {":
                             "    alert(#"",WEBTITLE,"#");":
                             "    self.close();":
                             "    opener.history.go(-1);":
                             "}":
                             "</script>"
          CALL      CLOSHTML
GOBACK99  RETURN
.------------------------------------------------------------------------------
. Open Files and Initialize Variables
.------------------------------------------------------------------------------
INIT0000  CALL      INTMAS00     * Open routine for PATMASTM 
          OPEN      PATHSPA1,"pathspaf"
          OPEN      PATVISA2,"patvisaf"
          OPEN      PMSVX1A1,"pmsvx1af"
          OPEN      PATRE1A1,"patre1af"
          OPEN      PATDGWA1,"patdgwaf"
          OPEN      VISMDTA1,"vismdtaf"
          OPEN      VISMTXA1,"vismtxaf"
          OPEN      PATITEM1,"patitemn"
          OPEN      PATASFA1,"patasfaf"
          OPEN      PATDSCH1,"patdschf"
          OPEN      PATCODE1,"patcodes"
.
          OPEN      PMSIHEA1,"pmsiheaf"
          OPEN      PMSIHEA2,"pmsiheaf"
          OPEN      PMSIHEA3,"pmsiheaf"
          OPEN      PMSIHEA4,"pmsiheaf"
          OPEN      PMSIHEA6,"pmsiheaf"
.
          OPEN      PMSIERA1,"pmsieraf"
          OPEN      PMSIERA2,"pmsieraf"
          OPEN      PMSIERA3,"pmsieraf"
.
          OPEN      PMSIRQA1,"pmsirqaf" 
          OPEN      PMSMHQA1,"pmsmhqaf"
          OPEN      PMSIRSA1,"pmsirsaf" 
          OPEN      PMSMHRA1,"pmsmhraf"
          OPEN      PMSNDBA2,"pmsndbaf" 
.
          OPEN      PMSIPLA1,"pmsiplaf"
          OPEN      PMSCCDA1,"pmsccdaf"
.
          OPEN      CONTROLF,"controlf"
          READ      CONTROLF,ZERO;*43,IBCNMHOS
          READ      CONTROLF,HUND18;*151,PTCNSRCT
          READ      CONTROLF,HUND20;*158,PTCNUNET
.
          MOVE      ZERO,NORECORD
          STRIP     PTCNSRCT
          MOVE      PTCNSRCT,NORECORD  * Default number of records to display
          IF        NORECORD = 0
            MOVE      FIVE,NORECORD    * Default to 5 if param not set
          ENDIF
.
          MATCH     "3",PTCNUNET
          IF        @EQUAL
            OPEN      PMSNPLA1,"pmsnplaf"
          ENDIF
.
          MATCH     "0",PTCNUNET
          IF        !@EQUAL
            OPEN      PMSIHIA1,"pmsihiaf"
            OPEN      PMSIHIA2,"pmsihiaf"
            OPEN      PMSIHIA3,"pmsihiaf"
            OPEN      PMSIHIA4,"pmsihiaf"
.           OPEN      PMSIHIA5,"pmsihiaf"
          ENDIF
.
INIT9999  RETURN
.------------------------------------------------------------------------------
. Clear Parameters
.------------------------------------------------------------------------------
CLRPAR00  MOVE      ZERO,REPORTNO
          MOVE      SP70,TEMPLATE
          MOVE      SP70,NEXTPAGE
          MOVE      SP70,REDIRECT
          MOVE      SP70,STARTKEY
          MOVE      SP70,UPDTTYPE
          MOVE      SP70,URNUMBER
          MOVE      SP70,ADMISSNO
          MOVE      SP70,STARTKEY
          MOVE      ZERO,STARTNUM
.
          MOVE      SP70,VALDTYPE
          MOVE      SP70,VALDCODE
          MOVE      SP70,BATCHNUM
          MOVE      SP70,HOSPCODE
          MOVE      SP70,ENSELOPT
          MOVE      SP70,DATEPSTT
          MOVE      SP70,DATEPEND
          MOVE      SP70,SELSERVC
          MOVE      SP70,SELREQTP
          MOVE      ZERO,FILTTYPE
          MOVE      SP70,HISMSGID
          MOVE      SP70,IHIUSERI
          MOVE      SP70,REQTCODE
          MOVE      SP70,IDENTNUM
          MOVE      SP70,ERRORCOD
.
          MOVE      SP70,IREQDATE
          MOVE      SP70,IREQTIME
          MOVE      SP70,IREQCNTR
          MOVE      SP70,IREQTYPE
          MOVE      SP70,IREQCODE
.
          MOVE      SP70,IHIURNUM
.
CLRPAR99  RETURN
.------------------------------------------------------------------------------
. Set Parameters
.------------------------------------------------------------------------------
SETPAR00  MATCH     "reportno=",QRYNAME
          IF        @EQUAL
            MOVE      QRYDATA,REPORTNO
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "template=",QRYNAME
          IF        @EQUAL
            MOVE      QRYDATA,TEMPLATE
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "updttype=",QRYNAME
          IF        @EQUAL
            MOVE      QRYDATA,UPDTTYPE
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "urnumber=",QRYNAME
          IF        @EQUAL
            MOVE      QRYDATA,URNUMBER
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "admissno=",QRYNAME
          IF        @EQUAL
            MOVE      QRYDATA,ADMISSNO
            GOTO      SETPAR99
          ENDIF
.  
          MATCH     "nextpage=",QRYNAME
          IF        @EQUAL
            MOVE      QRYDATA,NEXTPAGE
            GOTO      SETPAR99
          ENDIF 
.
          MATCH     "redirect=",QRYNAME
          IF        @EQUAL
            MOVE      QRYDATA,REDIRECT
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "startkey=",QRYNAME
          IF        @EQUAL
            MOVE      QRYDATA,STARTKEY
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "startnum=",QRYNAME
          IF        @EQUAL
            MOVE      QRYDATA,STARTNUM
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "ihinumbr=",QRYNAME
          IF        @EQUAL
            MOVE      QRYDATA,IHINUMBR
            PACK      IHINUMBR,IHINUMBR,SP70
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "ihiurnum=",QRYNAME
          IF        @EQUAL
            MOVE      QRYDATA,IHIURNUM
            PACK      IHIURNUM,IHIURNUM,SP70
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "hospcode=",QRYNAME
          IF        @EQUAL
            MOVE      QRYDATA,HOSPCODE
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "batchnum=",QRYNAME
          IF        @EQUAL
            MOVE      QRYDATA,BATCHNUM
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "valdtype=",QRYNAME
          IF        @EQUAL
            MOVE      QRYDATA,VALDTYPE
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "valdcode=",QRYNAME
          IF        @EQUAL
            MOVE      QRYDATA,VALDCODE
            PACK      VALDCODE,VALDCODE,SP70
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "enselopt=",QRYNAME
          IF        @EQUAL
            MOVE      QRYDATA,ENSELOPT
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "datepstt=",QRYNAME
          IF        @EQUAL
            MOVE      QRYDATA,DATEPSTT
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "datepend=",QRYNAME
          IF        @EQUAL
            MOVE      QRYDATA,DATEPEND
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "selservc=",QRYNAME
          IF        @EQUAL
            MOVE      QRYDATA,SELSERVC
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "hismsgid=",QRYNAME
          IF        @EQUAL
            MOVE      QRYDATA,HISMSGID
            PACK      HISMSGID,HISMSGID,SP70
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "ihiuseri=",QRYNAME
          IF        @EQUAL
            MOVE      QRYDATA,IHIUSERI
            PACK      IHIUSERI,IHIUSERI,SP70
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "selreqtp=",QRYNAME
          IF        @EQUAL
            MOVE      QRYDATA,SELREQTP
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "reqtcode=",QRYNAME
          IF        @EQUAL
            MOVE      QRYDATA,REQTCODE
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "identnum=",QRYNAME
          IF        @EQUAL
            MOVE      QRYDATA,IDENTNUM
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "errorcod=",QRYNAME
          IF        @EQUAL
            MOVE      QRYDATA,ERRORCOD
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "ireqdate=",QRYNAME
          IF        @EQUAL
            MOVE      QRYDATA,IREQDATE
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "ireqtime=",QRYNAME
          IF        @EQUAL
            MOVE      QRYDATA,IREQTIME
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "ireqcntr=",QRYNAME
          IF        @EQUAL
            MOVE      QRYDATA,IREQCNTR
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "ireqtype=",QRYNAME
          IF        @EQUAL
            MOVE      QRYDATA,IREQTYPE
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "ireqcode=",QRYNAME
          IF        @EQUAL
            MOVE      QRYDATA,IREQCODE
            GOTO      SETPAR99
          ENDIF
.
SETPAR99  RETURN
.
.------------------------------------------------------------------------------
. NEHTA IHI - Report 1 processing
.------------------------------------------------------------------------------
NEHA0000  MATCH     SP70,UPDTTYPE
          GOTO      NEHA7000 IF EQUAL
.
          MATCH     "A",UPDTTYPE    * Add
          GOTO      NEHA1000 IF EQUAL
.
          GOTO      NEHA7000
.
NEHA1000
          MOVE      ZERO,EXIT 
          GOTO      NEHA9999
.
NEHA7000  MOVE      URNUMBER,KEY8   * Read Master File
          CALL      RDMAST1
          BRANCH    OVRCD,NEHA9100
.
          MOVE      PURNO,KEY8
          CALL      RDPMPX21
          IF        OVRCD=1
            CALL      CLPMSPX2
          ENDIF
.
          PACK      KEY8,ADMISSNO,SP70
          CALL      RDMISS1
          IF        OVRCD=1
            CALL       CLPATMIS
          ENDIF
.
          CLEAR     WEBTITLE
          MOVE      "NEHTA IHI Interface",WEBTITLE
          RESET     WEBTITLE
.
          CALL      WEBHED00   * Create Output File and Write HTML Page Header
          BRANCH    EXIT,NEHA9999
          CALL      WEBBOD00   * Process Web Body
          CALL      WEBEND00   * Process End of HTML File
.
          MOVE      ONE,EXIT
          GOTO      NEHA9999
.
NEHA9000  MOVE      "Invalid Form Action.",WEBTITLE
          CALL      WEBERR00
          MOVE      ONE,EXIT
          GOTO      NEHA9999
.
NEHA9100  MOVE      "Can't find patient Master Details. ",WEBTITLE
          CALL      WEBERR00
          MOVE      ONE,EXIT
          GOTO      NEHA9999
.
NEHA9999  RETURN
+
.------------------------------------------------------------------------------
. NEHTA IHI Enquiry - Report 2 processing
.------------------------------------------------------------------------------
IHIENQ00  MATCH     SP70,UPDTTYPE
          GOTO      IHIENQ70 IF EQUAL
.
.         MATCH     "A",UPDTTYPE    * Add
.         GOTO      IHIENQ10 IF EQUAL
.
          GOTO      IHIENQ70
.
IHIENQ10
          MOVE      ZERO,EXIT
          GOTO      IHIENQ99
.
IHIENQ70  
          CLEAR     WEBTITLE
          MOVE      "NEHTA IHI Enquiry",WEBTITLE
          RESET     WEBTITLE
.
          CALL      WEBHED00   * Create Output File and Write HTML Page Header
          BRANCH    EXIT,IHIENQ99
          CALL      WEBBOD00   * Process Web Body
          CALL      WEBEND00   * Process End of HTML File
.
          MOVE      ONE,EXIT
          GOTO      IHIENQ99
.
IHIENQ90  MOVE      "Invalid Form Action.",WEBTITLE
          CALL      WEBERR00
          MOVE      ONE,EXIT
          GOTO      IHIENQ99
.
IHIENQ91  MOVE      "Can't find patient Master Details. ",WEBTITLE
          CALL      WEBERR00
          MOVE      ONE,EXIT
          GOTO      IHIENQ99
.
IHIENQ99  RETURN
+
.------------------------------------------------------------------------------
. IHI Exceptions Enquiry - Report 3 processing
.------------------------------------------------------------------------------
IHIEXC00  MATCH     SP70,UPDTTYPE
          GOTO      IHIEXC70 IF EQUAL
.
.         MATCH     "A",UPDTTYPE    * Add
.         GOTO      IHIEXC10 IF EQUAL
.
          GOTO      IHIEXC70
.
IHIEXC10
          MOVE      ZERO,EXIT
          GOTO      IHIEXC99
.
IHIEXC70
          CLEAR     WEBTITLE
          MOVE      "NEHTA IHI Exceptions Enquiry",WEBTITLE
          RESET     WEBTITLE
.
          CALL      WEBHED00   * Create Output File and Write HTML Page Header
          BRANCH    EXIT,IHIEXC99
          CALL      WEBBOD00   * Process Web Body
          CALL      WEBEND00   * Process End of HTML File
.
          MOVE      ONE,EXIT
          GOTO      IHIEXC99
.
IHIEXC90  MOVE      "Invalid Form Action.",WEBTITLE
          CALL      WEBERR00
          MOVE      ONE,EXIT
          GOTO      IHIEXC99
.
IHIEXC91  MOVE      "Can't find patient Master Details. ",WEBTITLE
          CALL      WEBERR00
          MOVE      ONE,EXIT
          GOTO      IHIEXC99
.
IHIEXC99  RETURN
+
.------------------------------------------------------------------------------
. IHI Errors Enquiry - Report 4 processing
.------------------------------------------------------------------------------
IHIERR00  MATCH     SP70,UPDTTYPE
          GOTO      IHIERR70 IF EQUAL
.
.         MATCH     "A",UPDTTYPE    * Add
.         GOTO      IHIERR10 IF EQUAL
.
          GOTO      IHIERR70
.
IHIERR10
          MOVE      ZERO,EXIT
          GOTO      IHIERR99
.
IHIERR70
          CLEAR     WEBTITLE
          MOVE      "NEHTA IHI Exceptions Enquiry",WEBTITLE
          RESET     WEBTITLE
.
          CALL      WEBHED00   * Create Output File and Write HTML Page Header
          BRANCH    EXIT,IHIERR99
          CALL      WEBBOD00   * Process Web Body
          CALL      WEBEND00   * Process End of HTML File
.
          MOVE      ONE,EXIT
          GOTO      IHIERR99
.
IHIERR90  MOVE      "Invalid Form Action.",WEBTITLE
          CALL      WEBERR00
          MOVE      ONE,EXIT
          GOTO      IHIERR99
.
IHIERR91  MOVE      "Can't find patient Master Details. ",WEBTITLE
          CALL      WEBERR00
          MOVE      ONE,EXIT
          GOTO      IHIERR99
.
IHIERR99  RETURN
.
.------------------------------------------------------------------------------
. NIHC IHI Polling Processing
.------------------------------------------------------------------------------
IHIPOL00  MATCH     "3",PTCNUNET 
          GOTO      IHIPOL92 IF NOT EQUAL
.
          MATCH     SP70,UPDTTYPE
          GOTO      IHIPOL70 IF EQUAL
          GOTO      IHIPOL70 IF EOS
.
          MATCH     "C",UPDTTYPE    * Clear IHI
          GOTO      IHIPOL10 IF EQUAL
.
          MATCH     "G",UPDTTYPE    * Get IHI
          GOTO      IHIPOL20 IF EQUAL
.
          GOTO      IHIPOL99
.
IHIPOL10  CALL      SETPNL00
          MOVE      "08",PMNPRTYP
.
          PACK      KEY28,PMNPURNO,PMNPRDAT,PMNPRTIM,PMNPCNTR,SP70
          CALL      RAPMNPL1
          IF        OVRCD=0
            GOTO      IHIPOL99 
          ENDIF
.
          CALL      WRPMNPL1
.
          MOVE      ZERO,EXIT
          GOTO      IHIPOL99
.
IHIPOL20  CALL      SETPNL00
          MOVE      "07",PMNPRTYP
.
          PACK      KEY28,PMNPURNO,PMNPRDAT,PMNPRTIM,PMNPCNTR,SP70
          CALL      RAPMNPL1
          IF        OVRCD=0
            GOTO      IHIPOL99
          ENDIF
.
          CALL      WRPMNPL1
.
          MOVE      ZERO,EXIT
          GOTO      IHIPOL99          
.
IHIPOL70  MOVE      URNUMBER,KEY8   * Read Master File
          CALL      RDMAST1
          BRANCH    OVRCD,IHIPOL91
.
          MOVE      PURNO,KEY8
          CALL      RDPMPX21
          IF        OVRCD=1
            CALL      CLPMSPX2
          ENDIF
.
          CLEAR     WEBTITLE
          MOVE      "NIHC IHI Polling Interface",WEBTITLE
          RESET     WEBTITLE
.
          CALL      WEBHED00   * Create Output File and Write HTML Page Header
          BRANCH    EXIT,IHIPOL99
          CALL      WEBBOD00   * Process Web Body
          CALL      WEBEND00   * Process End of HTML File
.
          MOVE      ONE,EXIT
          GOTO      IHIPOL99
.
IHIPOL90  MOVE      "Invalid Form Action.",WEBTITLE
          CALL      WEBERR00
          MOVE      ONE,EXIT
          GOTO      IHIPOL99
.
IHIPOL91  MOVE      "Can't find patient Master Details.",WEBTITLE
          CALL      WEBERR00
          MOVE      ONE,EXIT
          GOTO      IHIPOL99
.
IHIPOL92  MOVE      "Not Using NIHC IHI Interface.",WEBTITLE
          CALL      WEBERR00
          MOVE      ONE,EXIT
          GOTO      IHIPOL99 
.
IHIPOL99  RETURN
+
.------------------------------------------------------------
. Set pmsnplaf variables
.------------------------------------------------------------
SETPNL00  CALL      CLPMSNPL
          MOVE      URNUMBER,PMNPURNO
          CALL      IBACLOCK
          PACK      PMNPRDAT,CCC,CYY,CMM,CDD
          REP       " 0",PMNPRDAT
          CLOCK     TIME,CTIMEIS
          MOVE      CTIMEIS,PMNPRTIM
          MOVE      "   1",PMNPCNTR
.
          IF        IBCNMHOS=ONE
            MOVE      WBSEHOSP,PMNPHOSP
          ELSE
            PACK      KEY3,SP70
            CALL      RSPTHSP1            
            CALL      RKPTHSP1
            IF        OVRCD=0
              MOVE      PTHSHOSP,PMNPHOSP
            ENDIF
          ENDIF
.
          MOVE      USERID,PMNPRUID
          MOVE      "0",PMNPRSTA
          MOVE      PMNPRDAT,PMNPCDAT 
          MOVE      PMNPRTIM,PMNPCTIM
          MOVE      PMNPRUID,PMNPCUID
.
SETPNL99  RETURN
.
.------------------------------------------------------------------------------
. NIHC IHI JSON Processing
.------------------------------------------------------------------------------
IPOJSN00  MATCH     "3",PTCNUNET 
          GOTO      IPOJSN92 IF NOT EQUAL
.
          MATCH     SP70,UPDTTYPE
          GOTO      IPOJSN70 IF EQUAL
          GOTO      IPOJSN70 IF EOS
.
.
          GOTO      IPOJSN90
.
IPOJSN10
          MOVE      ZERO,EXIT
          GOTO      IPOJSN99
.
IPOJSN70  MOVE      URNUMBER,KEY8   * Read Master File
          CALL      RDMAST1
          BRANCH    OVRCD,IPOJSN91
.
          MOVE      PURNO,KEY8
          CALL      RDPMPX21
          IF        OVRCD=1
            CALL      CLPMSPX2
          ENDIF
.
          PACK      KEY28,URNUMBER,IREQDATE,IREQTIME,IREQCNTR,SP70
          CALL      RDPMNPL1 
          BRANCH    OVRCD,IPOJSN94
.
          PACK      KEY68,PMNPRTYP,PMNPRCOD,PMNPRDAT,PMNPRTIM,SP70
          CALL      RDPMIRQ1 
          IF        OVRCD=1
            CALL      CLPMSIRQ
          ENDIF
.
          PACK      KEY68,PMNPRTYP,PMNPRCOD,PMNPRDAT,PMNPRTIM,SP70
          CALL      RDPMIRS1 
          IF        OVRCD=1
            CALL      CLPMSIRS
          ENDIF
.
          PACK      KEY53,PMNPHOSP,SP70          * Read B2B Device Table
          CALL      RSPMNDB2
          CALL      RKPMNDB2
          BRANCH    OVRCD,IPOJSN93
.
          IF        IBCNMHOS=ONE
            MATCH     PMNPHOSP,PMNBHOSP            * Same Hospital
            GOTO      IPOJSN93 IF NOT EQUAL
          ENDIF
.
IPOJSN75  CLEAR     WEBTITLE
          MOVE      "NIHC IHI JSON Interface",WEBTITLE
          RESET     WEBTITLE
.
          CALL      WEBHED00   * Create Output File and Write HTML Page Header
          BRANCH    EXIT,IPOJSN99
          CALL      WEBBOD00   * Process Web Body
          CALL      WEBEND00   * Process End of HTML File
.
          MOVE      ONE,EXIT
          GOTO      IPOJSN99
.
IPOJSN90  MOVE      "Invalid Form Action.",WEBTITLE
          CALL      WEBERR00
          MOVE      ONE,EXIT
          GOTO      IPOJSN99
.
IPOJSN91  MOVE      "Can't find patient Master Details.",WEBTITLE
          CALL      WEBERR00
          MOVE      ONE,EXIT
          GOTO      IPOJSN99
.
IPOJSN92  MOVE      "Not Using NIHC IHI Interface.",WEBTITLE
          CALL      WEBERR00
          MOVE      ONE,EXIT
          GOTO      IPOJSN99
.
IPOJSN93  MOVE      "Can't find NIHC IHI Device Directory Path.",WEBTITLE
          CALL      WEBERR00
          MOVE      ONE,EXIT
          GOTO      IPOJSN99
.
IPOJSN94  MOVE      "Can't find NIHC IHI Polling Details.",WEBTITLE
          CALL      WEBERR00
          MOVE      ONE,EXIT
          GOTO      IPOJSN99
.
IPOJSN99  RETURN
.
.------------------------------------------------------------------------------
. NIHC IHI Request Processing
.------------------------------------------------------------------------------
IPOREQ00  MATCH     "3",PTCNUNET
          GOTO      IPOREQ92 IF NOT EQUAL
.
          MATCH     SP70,UPDTTYPE
          GOTO      IPOREQ70 IF EQUAL
          GOTO      IPOREQ70 IF EOS
.
.
          GOTO      IPOREQ90
.
IPOREQ10
          MOVE      ZERO,EXIT
          GOTO      IPOREQ99
.
IPOREQ70  MOVE      URNUMBER,KEY8   * Read Master File
          CALL      RDMAST1
          BRANCH    OVRCD,IPOREQ91
.
          MOVE      PURNO,KEY8
          CALL      RDPMPX21
          IF        OVRCD=1
            CALL      CLPMSPX2
          ENDIF
.
          PACK      KEY68,IREQTYPE,IREQCODE,IREQDATE,IREQTIME,SP70
          CALL      RDPMIRQ1
          BRANCH    OVRCD,IPOREQ93
.
IPOREQ75  CLEAR     WEBTITLE
          MOVE      "NIHC IHI Request Interface",WEBTITLE
          RESET     WEBTITLE
.
          CALL      WEBHED00   * Create Output File and Write HTML Page Header
          BRANCH    EXIT,IPOREQ99
          CALL      WEBBOD00   * Process Web Body
          CALL      WEBEND00   * Process End of HTML File
.
          MOVE      ONE,EXIT
          GOTO      IPOREQ99
.
IPOREQ90  MOVE      "Invalid Form Action.",WEBTITLE
          CALL      WEBERR00
          MOVE      ONE,EXIT
          GOTO      IPOREQ99
.
IPOREQ91  MOVE      "Can't find patient Master Details.",WEBTITLE
          CALL      WEBERR00
          MOVE      ONE,EXIT
          GOTO      IPOREQ99
.
IPOREQ92  MOVE      "Not Using NIHC IHI Interface.",WEBTITLE
          CALL      WEBERR00
          MOVE      ONE,EXIT
          GOTO      IPOREQ99
.
IPOREQ93  MOVE      "Can't find NIHC IHI Request Details.",WEBTITLE
          CALL      WEBERR00
          MOVE      ONE,EXIT
          GOTO      IPOREQ99
.
IPOREQ99  RETURN
.
.------------------------------------------------------------------------------
. NIHC IHI Result Processing
.------------------------------------------------------------------------------
IPORST00  MATCH     "3",PTCNUNET
          GOTO      IPORST92 IF NOT EQUAL
.
          MATCH     SP70,UPDTTYPE
          GOTO      IPORST70 IF EQUAL
          GOTO      IPORST70 IF EOS
.
.
          GOTO      IPORST90
.
IPORST10
          MOVE      ZERO,EXIT
          GOTO      IPORST99
.
IPORST70  MOVE      URNUMBER,KEY8   * Read Master File
          CALL      RDMAST1
          BRANCH    OVRCD,IPORST91
.
          MOVE      PURNO,KEY8
          CALL      RDPMPX21
          IF        OVRCD=1
            CALL      CLPMSPX2
          ENDIF
.
          PACK      KEY68,IREQTYPE,IREQCODE,IREQDATE,IREQTIME,SP70
          CALL      RDPMIRS1
          BRANCH    OVRCD,IPORST93
.
IPORST75  CLEAR     WEBTITLE
          MOVE      "NIHC IHI Result Interface",WEBTITLE
          RESET     WEBTITLE
.
          CALL      WEBHED00   * Create Output File and Write HTML Page Header
          BRANCH    EXIT,IPORST99
          CALL      WEBBOD00   * Process Web Body
          CALL      WEBEND00   * Process End of HTML File
.
          MOVE      ONE,EXIT
          GOTO      IPORST99
.
IPORST90  MOVE      "Invalid Form Action.",WEBTITLE
          CALL      WEBERR00
          MOVE      ONE,EXIT
          GOTO      IPORST99
.
IPORST91  MOVE      "Can't find patient Master Details.",WEBTITLE
          CALL      WEBERR00
          MOVE      ONE,EXIT
          GOTO      IPORST99
.
IPORST92  MOVE      "Not Using NIHC IHI Interface.",WEBTITLE
          CALL      WEBERR00
          MOVE      ONE,EXIT
          GOTO      IPORST99
.
IPORST93  MOVE      "Can't find NIHC IHI Result Details.",WEBTITLE
          CALL      WEBERR00
          MOVE      ONE,EXIT
          GOTO      IPORST99
.
IPORST99  RETURN
.
.------------------------------------------------------------------------------
. Process Fields 
.------------------------------------------------------------------------------
PROFLD00  BRANCH    REPORTNO,PROFLD10,PROFLD20,PROFLD30,PROFLD40,PROFLD99:
                             PROFLD60,PROFLD70,PROFLD80,PROFLD90,PROFL100:
                             PROFL110
.
          GOTO      PROFLD99 
.
PROFLD10  BRANCH    FLDSETNO,PROFLD11,PROFLD12,PROFLD13
          GOTO      PROFLD99
.
PROFLD11  CALL      MASF0000      * Master File Info
          GOTO      PROFLD99
.
PROFLD12  CALL      MISF0000
          GOTO      PROFLD99
.
PROFLD13  CALL      TABL0000      * Table Displays
          GOTO      PROFLD99
.
PROFLD20  BRANCH    FLDSETNO,PROFLD21
          GOTO      PROFLD99
.
PROFLD21  CALL      PIEN0000      * Process IHI Enquiry fields
          GOTO      PROFLD99
.
PROFLD30  BRANCH    FLDSETNO,PROFLD31
          GOTO      PROFLD99
.
PROFLD31  CALL      PIEX0000      * Process IHI Exceptions Enquiry fields
          GOTO      PROFLD99
.
PROFLD40  BRANCH    FLDSETNO,PROFLD41
          GOTO      PROFLD99
.
PROFLD41  CALL      PIER0000      * Process HI Service Errors Enquiry fields
          GOTO      PROFLD99
.
PROFLD60  BRANCH    FLDSETNO,PROFLD61,PROFLD62
          GOTO      PROFLD99
.
PROFLD61  CALL      MASF0000      * Master File Info
          GOTO      PROFLD99
.
PROFLD62  CALL      IPOL0000      * NIHC IHI Polling List
          GOTO      PROFLD99
.
PROFLD70  BRANCH    FLDSETNO,PROFLD71,PROFLD72
          GOTO      PROFLD99
.
PROFLD71  CALL      MASF0000      * Master File Info
          GOTO      PROFLD99
.
PROFLD72  CALL      IPOLJ000      * NIHC IHI JSON Details
          GOTO      PROFLD99
.
PROFLD80  BRANCH    FLDSETNO,PROFLD81,PROFLD82
          GOTO      PROFLD99
.
PROFLD81  CALL      MASF0000      * Master File Info
          GOTO      PROFLD99
.
PROFLD82  CALL      IPORQ000      * NIHC IHI Request Details
          GOTO      PROFLD99
.
PROFLD90  BRANCH    FLDSETNO,PROFLD91,PROFLD92
          GOTO      PROFLD99
.
PROFLD91  CALL      MASF0000      * Master File Info
          GOTO      PROFLD99
.
PROFLD92  CALL      IPORS000      * NIHC IHI Result Details
          GOTO      PROFLD99
.
PROFL100  BRANCH    FLDSETNO,PROFL101,PROFL102
          GOTO      PROFLD99
.
PROFL101  CALL      MASF0000      * Master File Info
          GOTO      PROFLD99
.
PROFL102  CALL      MYHRQ000      * NIHC MyHR Request Details
          GOTO      PROFLD99
.
PROFL110  BRANCH    FLDSETNO,PROFL111,PROFL112
          GOTO      PROFLD99
.
PROFL111  CALL      MASF0000      * Master File Info
          GOTO      PROFLD99
.
PROFL112  CALL      MYHRS000      * NIHC MyHR Result Details
          GOTO      PROFLD99
.
PROFLD99  RETURN
+
.------------------------------------------------------------------------------
. Table Displays - IHI Numbers (audit info, exceptions, etc)
.------------------------------------------------------------------------------
TABL0000  BRANCH    FLDITMNO,TABL0100,TABL0200
          GOTO      TABL9999
.
TABL0100  CALL      IHITAB00           * IHI History
          GOTO      TABL9999
.
TABL0200  CALL      IAUTAB00           * IHI Audit History
          GOTO      TABL9999
.
TABL9999  RETURN
+
.------------------------------------------------------------------------------
. IHI Number History table - by descending date order (from latest)
.------------------------------------------------------------------------------
IHITAB00  MATCH     "0",PTCNUNET
          GOTO      IHITAB99 IF EQUAL
.
          PACK      KEY62,URNUMBER,IHINUMBR,Z70
          CALL      RSPMIHI2
IHITAB10  CALL      RPPMIHI2
          BRANCH    OVRCD,IHITAB99
.
          MATCH     URNUMBER,PMIHURNO
          GOTO      IHITAB99 IF NOT EQUAL
.
          MATCH     IHINUMBR,PMIHIHIN
          GOTO      IHITAB99 IF NOT EQUAL
.
          UNPACK    SP70,VERISTAT,WEBPSTAT
.
          MOVE      ZERO,F1
          MOVE      PMIHVSTA,F1
          LOAD      VERISTAT,F1,VERSTAT1,VERSTAT2
.
          MOVE      ZERO,F1
          MOVE      WEBSTAT0,WEBPSTAT
          MOVE      PMIHSTAT,F1
          LOAD      WEBPSTAT,F1,WEBSTAT1,WEBSTAT2
.
          PACK      DISPDATE,SP70
          MATCH     SP70,PMIHADAT
          IF        !@EQUAL
            UNPACK    PMIHADAT,CCENT,CYEAR,CMON,CDAY
            MOVE      CMON,F2
            LOAD      MTHNAM3,F2,JAN,FEB,MAR,APR,MAY,JUN,JUL,AUG,SEP,OCT,NOV,DEC
            PACK      DISPDATE,CDAY,SP1,MTHNAM3,SP1,CCENT,CYEAR,SP10
          ENDIF
.
          WRITE     HTMLFILE;"<tr>":
                      "<td>&nbsp;",PMIHIHIN,"</td>":
                      "<td>&nbsp;&nbsp;",VERISTAT,"</td>":
                      "<td>&nbsp;&nbsp;",DISPDATE,"&nbsp;",PMIHATIM,"</td>":
                      "<td>&nbsp;&nbsp;",WEBPSTAT,"</td>":
                      "<td>&nbsp;&nbsp;",PMIHOURN,"</td>":
                      "</tr>";
.
          GOTO      IHITAB10
.
IHITAB99  RETURN
+
.------------------------------------------------------------------------------
. Patient IHI Audit History table - by descending date order (from latest)
.------------------------------------------------------------------------------
IAUTAB00  MATCH     "0",PTCNUNET
          GOTO      IAUTAB99 IF EQUAL 
.
          PACK      KEY46,URNUMBER,Z70
          CALL      RSPMIHI1
IAUTAB10  CALL      RPPMIHI1
          BRANCH    OVRCD,IAUTAB99
.
          MATCH     URNUMBER,PMIHURNO
          GOTO      IAUTAB99 IF NOT EQUAL
.
          UNPACK    SP70,VERISTAT,ACTVSTAT
.
          MOVE      ZERO,F1
          MOVE      PMIHVSTA,F1
          LOAD      VERISTAT,F1,VERSTAT1,VERSTAT2
.
          MOVE      ZERO,F1
          MOVE      PMIHASTA,F1
          LOAD      ACTVSTAT,F1,ACTSTAT1,ACTSTAT2,ACTSTAT3,ACTSTAT4,ACTSTAT5
.
          PACK      SERVDESC,SP70
          MOVE      ZERO,F2
          SQUEEZE   PMIHIHIS
          MOVE      PMIHIHIS,F2
          LOAD      SERVDESC,F2,SERVICE1,SERVICE2,SERVICE3
.
          PACK      KEY10,PMIHCUID,SP70
          CALL      RDWBSE1
          IF        OVRCD=0
            MOVE      WBSENAM,DISPUSER
          ELSE
            PACK      KEY10,PMIHUUID,SP70
            CALL      RDWBSE1
            IF        OVRCD=0
              MOVE      WBSENAM,DISPUSER
            ELSE
              MOVE      PMIHUUID,DISPUSER
            ENDIF
          ENDIF
.
          PACK      ORGNNAME,SP70
          PACK      KEY3,PMIHINTB,SP70
          CALL      RDPTHSP1
          IF        OVRCD<>1
            PACK      ORGNNAME,PTHSNAME,SP70
          ENDIF
.
          MOVE      SP70,DIM20
          MATCH     "0",PMIHSTAT
          IF        @EQUAL
            MOVE      "Get/Update IHI",DIM20
          ENDIF
.
          MATCH     "1",PMIHSTAT
          IF        @EQUAL
            MOVE      "Clear/Remove IHI",DIM20
          ENDIF
.
          PACK      HTMLLINK,SP70,SP70
          WRITE     HTMLFILE;"t.addRow(#"",HTMLLINK,"#",":
                             "#"",PMIHIHIN,"#",":               * 1
                             "#"",PMIHADAT,PMIHATIM,"#",":
                             "#"",VERISTAT,"#",":
                             "#"",ACTVSTAT,"#",":
                             "#"",SERVDESC,"#",":               *5
                             "#"",PMIHHISV,"#",":
                             "#"",PMIHMESI,"#",":
                             "#"",PMIHBATI,"#",":               
                             "#"",ORGNNAME,"#",":
                             "#"",PMIHCDAT,PMIHCTIM,"#",":      * 10
                             "#"",DISPUSER,"#",":
                             "#"",DIM20,"#",":
                             "#"",PMIHEDAT,PMIHETIM,"#");"
.
          GOTO      IAUTAB10
.
IAUTAB99  RETURN
.
.------------------------------------------------------------------------------
. NIHC IHI Polling Details
.------------------------------------------------------------------------------
IPOL0000  BRANCH    FLDITMNO,IPOL0100,IPOL0200,IPOL0300,IPOL0400,IPOL0500:
                             IPOL0600
          GOTO      IPOL9999
.
IPOL0100  CALL      IPOLLS00           * NIHC IHI Polling List 
          GOTO      IPOL9999
.
IPOL0200  IF        IBCNMHOS=ONE
            PACK      KEY10,USERID,SP70
            CALL      RDWBSE1
            IF        OVRCD=0
              WRITE     HTMLFILE;WBSEHOSP;
            ENDIF
          ELSE
            PACK      KEY3,SP70
            CALL      RSPTHSP1
            CALL      RKPTHSP1          
            IF        OVRCD=0
              WRITE     HTMLFILE;PTHSHOSP; 
            ENDIF
          ENDIF 
          GOTO      IPOL9999
.
IPOL0300  PACK      KEY10,USERID,SP70
          CALL      RDWBSE1
          IF        OVRCD=0
            MATCH     SP70,WBSEOCG
            IF        !@EQUAL & !@EOS
              PACK      KEY5,CATw0,WBSEOCG,SP70
              CALL      RDCODE1
              IF        OVRCD=0
.
                MATCH     "1",TCINDC4
                IF        @EQUAL
                  WRITE     HTMLFILE;"IHIAdmin";
                ENDIF
.
                MATCH     "2",TCINDC4
                IF        @EQUAL
                  WRITE     HTMLFILE;"MyHRAdmin";
                ENDIF
.
                MATCH     "3",TCINDC4
                IF        @EQUAL
                  WRITE     HTMLFILE;"DualIHIMyHRAdmin";
                ENDIF
.
              ENDIF
            ENDIF
          ENDIF
          GOTO      IPOL9999
.
IPOL0400  IF        IBCNMHOS=ONE
            PACK      KEY10,USERID,SP70
            CALL      RDWBSE1
            IF        OVRCD=0
              MATCH     SP70,WBSEHOSP
              IF        !@EQUAL & !@EOS
.
                PACK      KEY53,WBSEHOSP,SP70
                CALL      RSPMNDB2
                CALL      RKPMNDB2
                BRANCH    OVRCD,IPOL9999
.
                MATCH     WBSEHOSP,PMNBHOSP
                GOTO      IPOL9999 IF NOT EQUAL
.
                WRITE     HTMLFILE;PMNBNMUR;                
.
              ENDIF              
            ENDIF
          ELSE
.
            PACK      KEY53,SP70
            CALL      RSPMNDB2
            CALL      RKPMNDB2
            BRANCH    OVRCD,IPOL9999
.
            WRITE     HTMLFILE;PMNBNMUR;
.
          ENDIF
          GOTO      IPOL9999
.
IPOL0500  IF        IBCNMHOS=ONE
            PACK      KEY10,USERID,SP70
            CALL      RDWBSE1
            IF        OVRCD=0
              MATCH     SP70,WBSEHOSP
              IF        !@EQUAL & !@EOS
.
                PACK      KEY53,WBSEHOSP,SP70
                CALL      RSPMNDB2
                CALL      RKPMNDB2
                BRANCH    OVRCD,IPOL9999
.
                MATCH     WBSEHOSP,PMNBHOSP
                GOTO      IPOL9999 IF NOT EQUAL
.
                WRITE     HTMLFILE;PMNBNSUR;
.
              ENDIF
            ENDIF
          ELSE
.
            PACK      KEY53,SP70
            CALL      RSPMNDB2
            CALL      RKPMNDB2
            BRANCH    OVRCD,IPOL9999
.
            WRITE     HTMLFILE;PMNBNSUR;
.
          ENDIF
          GOTO      IPOL9999
.
IPOL0600  IF        IBCNMHOS=ONE
            PACK      KEY10,USERID,SP70
            CALL      RDWBSE1
            IF        OVRCD=0
              MATCH     SP70,WBSEHOSP
              IF        !@EQUAL & !@EOS
.
                PACK      KEY53,WBSEHOSP,SP70
                CALL      RSPMNDB2
                CALL      RKPMNDB2
                BRANCH    OVRCD,IPOL9999
.
                MATCH     WBSEHOSP,PMNBHOSP
                GOTO      IPOL9999 IF NOT EQUAL
.
                WRITE     HTMLFILE;PMNBUPUR;
.
              ENDIF
            ENDIF
          ELSE
.
            PACK      KEY53,SP70
            CALL      RSPMNDB2
            CALL      RKPMNDB2
            BRANCH    OVRCD,IPOL9999
.
            WRITE     HTMLFILE;PMNBUPUR;
.
          ENDIF
          GOTO      IPOL9999
.
IPOL9999  RETURN
+
.------------------------------------------------------------------------------
. NIHC IHI Polling List
.------------------------------------------------------------------------------
IPOLLS00  PACK      KEY28,URNUMBER,Z70
          CALL      RSPMNPL1
IPOLLS10  CALL      RPPMNPL1
          BRANCH    OVRCD,IPOLLS99
.
          MATCH     URNUMBER,PMNPURNO
          GOTO      IPOLLS99 IF NOT EQUAL
.
          MOVE      SP70,REQTYPED
          MATCH     "07",PMNPRTYP
          IF        @EQUAL
            MOVE      "IHI lookup",REQTYPED
          ELSE
            MATCH     "08",PMNPRTYP
            IF        @EQUAL
              MOVE      "Clear IHI",REQTYPED
            ELSE
              MATCH     "09",PMNPRTYP
              IF        @EQUAL
                MOVE      "Clear IHI then IHI Lookup",REQTYPED
              ELSE
                MATCH     "10",PMNPRTYP
                IF        @EQUAL                
                  MOVE      "MyHR Episode Upload",REQTYPED
                ENDIF
              ENDIF
            ENDIF
          ENDIF
.
          MOVE      SP70,REQSTATD
          MATCH     "0",PMNPRSTA
          IF        @EQUAL
            MOVE      "Waiting",REQSTATD
          ELSE
            MATCH     "1",PMNPRSTA
            IF        @EQUAL
              MOVE      "Request Sent",REQSTATD
            ELSE
              MATCH     "2",PMNPRSTA
              IF        @EQUAL
                MOVE      "Response Processed / Received",REQSTATD
              ELSE
                MATCH     "3",PMNPRSTA
                IF        @EQUAL
                  MOVE      "Error",REQSTATD
                ENDIF
              ENDIF
            ENDIF
          ENDIF
.
          PACK      ORGNNAME,SP70
          PACK      KEY3,PMNPHOSP,SP70
          CALL      RDPTHSP1
          IF        OVRCD<>1
            PACK      ORGNNAME,PTHSNAME,SP70
          ENDIF
.
          MOVE      SP70,REQUSRNM 
          MATCH     SP70,PMNPRUID
          IF        !@EQUAL
            PACK      KEY10,PMNPRUID,SP70
            CALL      RDWBSE1
            IF        OVRCD=0
              MOVE      WBSENAM,REQUSRNM
            ELSE
              MOVE      PMNPRUID,REQUSRNM
            ENDIF
          ENDIF 
.
          MOVE      SP70,CRTUSRNM
          MATCH     SP70,PMNPCUID
          IF        !@EQUAL
            PACK      KEY10,PMNPCUID,SP70
            CALL      RDWBSE1
            IF        OVRCD=0
              MOVE      WBSENAM,CRTUSRNM
            ELSE
              MOVE      PMNPCUID,CRTUSRNM
            ENDIF
          ENDIF
.
          MOVE      SP70,UPDUSRNM
          MATCH     SP70,PMNPUUID
          IF        !@EQUAL
            PACK      KEY10,PMNPUUID,SP70
            CALL      RDWBSE1
            IF        OVRCD=0
              MOVE      WBSENAM,UPDUSRNM
            ELSE
              MOVE      PMNPUUID,UPDUSRNM
            ENDIF
          ENDIF
.
          REP       " +",PMNPURNO
          REP       " +",PMNPRDAT
          REP       " +",PMNPRTIM
          REP       " +",PMNPCNTR
.
          CLEAR     HTMLLINK
          APPEND    "<img src='../images/JsonIcon.gif' ",HTMLLINK
          APPEND    "class=ListIcon align=left ",HTMLLINK
          APPEND    "title='JSON Details' ",HTMLLINK
          APPEND    "onclick=JSONPopupFrame('",HTMLLINK
          APPEND    PMNPURNO,HTMLLINK
          APPEND    "','",HTMLLINK  
          APPEND    PMNPRDAT,HTMLLINK
          APPEND    "','",HTMLLINK  
          APPEND    PMNPRTIM,HTMLLINK
          APPEND    "','",HTMLLINK  
          APPEND    PMNPCNTR,HTMLLINK
          APPEND    "');> ",HTMLLINK  
          RESET     HTMLLINK  
.
          REP       "+ ",PMNPURNO
          REP       "+ ",PMNPRDAT
          REP       "+ ",PMNPRTIM
          REP       "+ ",PMNPCNTR
.
IPOLLS50  CLEAR     HTMLLNK1
          CLEAR     HTMLLNK2
.
          MATCH     "10",PMNPRTYP 
          IF        @EQUAL
.
            CLEAR     HTMLLNK1
.
            PACK      DIM50,PMNPUNIQ,SP70
            PACK      KEY68,PMNPRTYP,DIM50,PMNPRDAT,PMNPRTIM,SP70
            CALL      RDPMMHQ1
            IF        OVRCD = 0
              REP       " +",PMNPRTYP
.              REP       " +",PMNPRCOD
              PACK      DIM50,PMNPUNIQ,SP70
              REP       " +",DIM50 
              REP       " +",PMNPRDAT
              REP       " +",PMNPRTIM
.
              APPEND    "<img src='../images/ForwardArrow_Green_Icon.gif' ",HTMLLNK1
              APPEND    "class=ListIcon align=right ",HTMLLNK1
              APPEND    "title='Request Details' ",HTMLLNK1
              APPEND    "onclick=MyHRRequestPopupFrame('",HTMLLNK1
              APPEND    PMNPRTYP,HTMLLNK1
              APPEND    "','",HTMLLNK1
              APPEND    DIM50,HTMLLNK1
              APPEND    "','",HTMLLNK1
              APPEND    PMNPRDAT,HTMLLNK1
              APPEND    "','",HTMLLNK1
              APPEND    PMNPRTIM,HTMLLNK1
              APPEND    "');> ",HTMLLNK1
              RESET     HTMLLNK1
.
              REP       "+ ",PMNPRTYP
.              REP       "+ ",PMNPRCOD
              REP       "+ ",PMNPRDAT
              REP       "+ ",PMNPRTIM
            ENDIF
.
            CLEAR     HTMLLNK2
.
            PACK      DIM50,PMNPUNIQ,SP70
            PACK      KEY68,PMNPRTYP,DIM50,PMNPRDAT,PMNPRTIM,SP70
            CALL      RDPMMHR1
            IF        OVRCD = 0
              REP       " +",PMNPRTYP
.              REP       " +",PMNPRCOD
              PACK      DIM50,PMNPUNIQ,SP70
              REP       " +",DIM50
              REP       " +",PMNPRDAT
              REP       " +",PMNPRTIM
.
              APPEND    "<img src='../images/BackwardArrow_Green_Icon.gif' ",HTMLLNK2
              APPEND    "class=ListIcon align=right ",HTMLLNK2
              APPEND    "title='Result Details' ",HTMLLNK2
              APPEND    "onclick=MyHRResultPopupFrame('",HTMLLNK2
              APPEND    PMNPRTYP,HTMLLNK2
              APPEND    "','",HTMLLNK2
              APPEND    DIM50,HTMLLNK2
              APPEND    "','",HTMLLNK2
              APPEND    PMNPRDAT,HTMLLNK2
              APPEND    "','",HTMLLNK2
              APPEND    PMNPRTIM,HTMLLNK2
              APPEND    "');> ",HTMLLNK2
              RESET     HTMLLNK2
.
              REP       "+ ",PMNPRTYP
              REP       "+ ",PMNPRCOD
              REP       "+ ",PMNPRDAT
              REP       "+ ",PMNPRTIM
            ENDIF
.
          ELSE   
.
            CLEAR     HTMLLNK1
.
            PACK      KEY68,PMNPRTYP,PMNPRCOD,PMNPRDAT,PMNPRTIM,SP70
            CALL      RDPMIRQ1
            IF        OVRCD = 0
              REP       " +",PMNPRTYP
              REP       " +",PMNPRCOD
              REP       " +",PMNPRDAT
              REP       " +",PMNPRTIM
. 
              APPEND    "<img src='../images/ForwardArrow_Green_Icon.gif' ",HTMLLNK1
              APPEND    "class=ListIcon align=right ",HTMLLNK1
              APPEND    "title='Request Details' ",HTMLLNK1
              APPEND    "onclick=MedicareRequestPopupFrame('",HTMLLNK1
              APPEND    PMNPRTYP,HTMLLNK1
              APPEND    "','",HTMLLNK1
              APPEND    PMNPRCOD,HTMLLNK1
              APPEND    "','",HTMLLNK1
              APPEND    PMNPRDAT,HTMLLNK1
              APPEND    "','",HTMLLNK1
              APPEND    PMNPRTIM,HTMLLNK1
              APPEND    "');> ",HTMLLNK1
              RESET     HTMLLNK1
.
              REP       "+ ",PMNPRTYP
              REP       "+ ",PMNPRCOD
              REP       "+ ",PMNPRDAT
              REP       "+ ",PMNPRTIM
            ENDIF 
.
            CLEAR     HTMLLNK2
.
            PACK      KEY68,PMNPRTYP,PMNPRCOD,PMNPRDAT,PMNPRTIM,SP70
            CALL      RDPMIRS1
            IF        OVRCD = 0
              REP       " +",PMNPRTYP
              REP       " +",PMNPRCOD
              REP       " +",PMNPRDAT
              REP       " +",PMNPRTIM
.
              APPEND    "<img src='../images/BackwardArrow_Green_Icon.gif' ",HTMLLNK2
              APPEND    "class=ListIcon align=right ",HTMLLNK2
              APPEND    "title='Result Details' ",HTMLLNK2
              APPEND    "onclick=MedicareResultPopupFrame('",HTMLLNK2
              APPEND    PMNPRTYP,HTMLLNK2
              APPEND    "','",HTMLLNK2
              APPEND    PMNPRCOD,HTMLLNK2
              APPEND    "','",HTMLLNK2
              APPEND    PMNPRDAT,HTMLLNK2
              APPEND    "','",HTMLLNK2
              APPEND    PMNPRTIM,HTMLLNK2
              APPEND    "');> ",HTMLLNK2
              RESET     HTMLLNK2
.
              REP       "+ ",PMNPRTYP
              REP       "+ ",PMNPRCOD
              REP       "+ ",PMNPRDAT
              REP       "+ ",PMNPRTIM
            ENDIF
.
          ENDIF
.
          WRITE     HTMLFILE;"t.addRow(":
                             "#"",PMNPCNTR,"#",":                         * 0
                             "#"",PMNPRDAT,PMNPRTIM:
                             HTMLLNK2,HTMLLNK1,"#",":                     * 1  
                             "#"",ORGNNAME,"#",":                         * 2
                             "#"",REQTYPED,"#",":                         * 3
                             "#"",PMNPRCOD,"#",":                         * 4
                             "#"",REQSTATD,"#",":                         * 5
                             "#"",REQUSRNM,"#",":                         * 6
                             "#"",PMNPUNIQ,HTMLLINK,"#",":                * 7   
                             "#"",PMNPEROR,"#",":                         * 8
                             "#"",PMNPCDAT,PMNPCTIM,"#",":                * 9
                             "#"",CRTUSRNM,"#",":                         * 10
                             "#"",PMNPUDAT,PMNPUTIM,"#",":                * 11
                             "#"",UPDUSRNM,"#");"                         * 12
.
          GOTO      IPOLLS10
.
IPOLLS99  RETURN
.
.------------------------------------------------------------------------------
. NIHC IHI JSON Details
.------------------------------------------------------------------------------
IPOLJ000  BRANCH    FLDITMNO,IPOLJ010,IPOLJ020,IPOLJ030,IPOLJ040,IPOLJ050:
                             IPOLJ060,IPOLJ070,IPOLJ080,IPOLJ090,IPOLJ100:
                             IPOLJ110,IPOLJ120,IPOLJ130,IPOLJ140
.
          GOTO      IPOLJ999 
.
IPOLJ010  MATCH     SP70,PMNBDPTH
          IF        @EQUAL | @EOS
            WRITE     HTMLFILE;"WebServices Polling Device directory not found.";
            GOTO      IPOLJ999
          ENDIF
.
          MATCH     SP70,PMNPUNIQ
          IF        @EQUAL | @EOS
            WRITE     HTMLFILE;"Header properties file not found.";
            GOTO      IPOLJ999
          ENDIF
.
          CLEAR     CMDLINE
          APPEND    PMNBDPTH,CMDLINE
          RESET     CMDLINE
          STRIP     CMDLINE
          ENDSET    CMDLINE
.
          MATCH     "10",PMNPRTYP
          IF        @EQUAL
            APPEND    "/webPAS_claims/nihcihiupload/",CMDLINE
          ELSE
            APPEND    "/webPAS_claims/nihcihi/",CMDLINE
          ENDIF
.
          RESET     CMDLINE
          STRIP     CMDLINE
          ENDSET    CMDLINE
          APPEND    PMNPUNIQ,CMDLINE
          APPEND    PROPLITR,CMDLINE
          RESET     CMDLINE
.
          WRITE     HTMLFILE;CMDLINE;
          GOTO      IPOLJ999
.
IPOLJ020  CALL      IHCHED00
          GOTO      IPOLJ999
.
IPOLJ030  MATCH     SP70,PMNBDPTH
          IF        @EQUAL | @EOS
            WRITE     HTMLFILE;"WebServices Polling Device directory not found.";
            GOTO      IPOLJ999
          ENDIF
.
          MATCH     SP70,PMNPUNIQ
          IF        @EQUAL | @EOS
            WRITE     HTMLFILE;"JSON Request file not found.";
            GOTO      IPOLJ999
          ENDIF
.
          CLEAR     CMDLINE
          APPEND    PMNBDPTH,CMDLINE
          RESET     CMDLINE
          STRIP     CMDLINE
          ENDSET    CMDLINE
.
          MATCH     "10",PMNPRTYP
          IF        @EQUAL
            APPEND    "/webPAS_claims/nihcihiupload/",CMDLINE
          ELSE
            APPEND    "/webPAS_claims/nihcihi/",CMDLINE
          ENDIF
.
          RESET     CMDLINE
          STRIP     CMDLINE
          ENDSET    CMDLINE
          APPEND    PMNPUNIQ,CMDLINE
.
          MATCH     "10",PMNPRTYP
          IF        @EQUAL
            APPEND    NIHWLITU,CMDLINE
          ELSE
            APPEND    NIHWLITR,CMDLINE
          ENDIF
.
          RESET     CMDLINE
.
          WRITE     HTMLFILE;CMDLINE;
          GOTO      IPOLJ999
.
IPOLJ040  CALL      IHCJSN00
          GOTO      IPOLJ999
.
IPOLJ050  MATCH     SP70,PMNBDPTH
          IF        @EQUAL | @EOS
            WRITE     HTMLFILE;"WebServices Polling Device directory not found.";
            GOTO      IPOLJ999
          ENDIF
.
          MATCH     SP70,PMNPUNIQ
          IF        @EQUAL | @EOS
            WRITE     HTMLFILE;"JSON Response file not found.";
            GOTO      IPOLJ999
          ENDIF
.
          CLEAR     CMDLINE
          APPEND    PMNBDPTH,CMDLINE
          RESET     CMDLINE
          STRIP     CMDLINE
          ENDSET    CMDLINE
.
          MATCH     "10",PMNPRTYP
          IF        @EQUAL
            APPEND    "/webPAS_claims/nihcihiupload/",CMDLINE
          ELSE
            APPEND    "/webPAS_claims/nihcihi/",CMDLINE
          ENDIF
.
          RESET     CMDLINE
          STRIP     CMDLINE
          ENDSET    CMDLINE
          APPEND    PMNPUNIQ,CMDLINE
.
          MATCH     "10",PMNPRTYP
          IF        @EQUAL
            APPEND    NIHRLITU,CMDLINE
          ELSE
            APPEND    NIHRLITR,CMDLINE
          ENDIF
.
          RESET     CMDLINE
.
          WRITE     HTMLFILE;CMDLINE;
          GOTO      IPOLJ999
.
IPOLJ060  CALL      IHCRSP00
          GOTO      IPOLJ999
.
IPOLJ070  MATCH     SP70,PMNBDPTH
          IF        @EQUAL | @EOS
            WRITE     HTMLFILE;"WebServices Polling Device directory not found.";
            GOTO      IPOLJ999
          ENDIF
.
          MATCH     SP70,PMNPUNIQ
          IF        @EQUAL | @EOS
            WRITE     HTMLFILE;"Transmission log file not found.";
            GOTO      IPOLJ999
          ENDIF
.
          CLEAR     CMDLINE
          APPEND    PMNBDPTH,CMDLINE
          RESET     CMDLINE
          STRIP     CMDLINE
          ENDSET    CMDLINE
.
          MATCH     "10",PMNPRTYP
          IF        @EQUAL
            APPEND    "/webPAS_claims/nihcihiupload/",CMDLINE
          ELSE
            APPEND    "/webPAS_claims/nihcihi/",CMDLINE
          ENDIF
.
          RESET     CMDLINE
          STRIP     CMDLINE
          ENDSET    CMDLINE
          APPEND    PMNPUNIQ,CMDLINE
.
          MATCH     "10",PMNPRTYP
          IF        @EQUAL
            APPEND    NIHELITU,CMDLINE
          ELSE
            APPEND    NIHELITR,CMDLINE
          ENDIF
.
          RESET     CMDLINE
.
          WRITE     HTMLFILE;CMDLINE;
          GOTO      IPOLJ999
.
IPOLJ080  CALL      IHCERR00
          GOTO      IPOLJ999
.
IPOLJ090  WRITE     HTMLFILE;IREQDATE;
          GOTO      IPOLJ999
.
IPOLJ100  WRITE     HTMLFILE;IREQTIME;
          GOTO      IPOLJ999
.
IPOLJ110  WRITE     HTMLFILE;IREQCNTR;
          GOTO      IPOLJ999
.
IPOLJ120  WRITE     HTMLFILE;PMNPUNIQ;
          GOTO      IPOLJ999
.
IPOLJ130  UNPACK    DIM127,D1,KEY1,DIM127
          MOVE      ZERO,F1
          MOVE      KEY1,F1
          BRANCH    F1,IPOLJ131
.
          WRITE     HTMLFILE;PMNPRDAT;
          GOTO      IPOLJ999
.
IPOLJ131  PACK      DISPDATE,SP70
          MATCH     SP70,PMNPRDAT
          IF        !@EQUAL
            UNPACK    PMNPRDAT,CCENT,CYEAR,CMON,CDAY
            MOVE      CMON,F2
            LOAD      MTHNAM3,F2,JAN,FEB,MAR,APR,MAY,JUN,JUL,AUG,SEP,OCT,NOV,DEC
            PACK      DISPDATE,CDAY,SP1,MTHNAM3,SP1,CCENT,CYEAR
          ENDIF
          WRITE     HTMLFILE;DISPDATE;
          GOTO      IPOLJ999
.
IPOLJ140  WRITE     HTMLFILE;PMNPRTIM;
          GOTO      IPOLJ999
.
IPOLJ999  RETURN
.
.------------------------------------------------------------------------------
. NIHC IHI Request Details
.------------------------------------------------------------------------------
IPORQ000  BRANCH    FLDITMNO,IPORQ010,IPORQ020,IPORQ030,IPORQ040,IPORQ050:
                             IPORQ060,IPORQ070,IPORQ080,IPORQ090,IPORQ100:
                             IPORQ110,IPORQ120,IPORQ130,IPORQ140,IPORQ150:
                             IPORQ160,IPORQ170,IPORQ180,IPORQ190,IPORQ200:
                             IPORQ210,IPORQ220,IPORQ230,IPORQ240,IPORQ250:
                             IPORQ260,IPORQ270,IPORQ280,IPORQ290,IPORQ300:
                             IPORQ310,IPORQ320,IPORQ330
.
          GOTO      IPORQ999
.
IPORQ010  WRITE     HTMLFILE;IREQTYPE;
          GOTO      MISF9999
.
IPORQ020  WRITE     HTMLFILE;IREQCODE;
          GOTO      IPORQ999
.
IPORQ030  WRITE     HTMLFILE;IREQDATE;
          GOTO      MISF9999
.
IPORQ040  WRITE     HTMLFILE;IREQTIME;
          GOTO      IPORQ999
.
IPORQ050  WRITE     HTMLFILE;PMIQRTYP;
          GOTO      MISF9999
.
IPORQ060  WRITE     HTMLFILE;PMIQCODE;
          GOTO      IPORQ999
.
IPORQ070  UNPACK    DIM127,D1,KEY1,DIM127
          MOVE      ZERO,F1
          MOVE      KEY1,F1
          BRANCH    F1,IPORQ071
.
          WRITE     HTMLFILE;PMIQRDAT;
          GOTO      IPORQ999
.
IPORQ071  PACK      DISPDATE,SP70
          MATCH     SP70,PMIQRDAT
          IF        !@EQUAL
            UNPACK    PMIQRDAT,CCENT,CYEAR,CMON,CDAY
            MOVE      CMON,F2
            LOAD      MTHNAM3,F2,JAN,FEB,MAR,APR,MAY,JUN,JUL,AUG,SEP,OCT,NOV,DEC
            PACK      DISPDATE,CDAY,SP1,MTHNAM3,SP1,CCENT,CYEAR
          ENDIF
          WRITE     HTMLFILE;DISPDATE;
          GOTO      IPORQ999
.
IPORQ080  WRITE     HTMLFILE;PMIQRTIM;
          GOTO      IPORQ999
.
IPORQ090  UNPACK    DIM127,D1,KEY1,DIM127
          MOVE      ZERO,F1
          MOVE      KEY1,F1
          BRANCH    F1,IPORQ091
.
          WRITE     HTMLFILE;PMIQRUID;
          GOTO      IPORQ999
.
IPORQ091  PACK      REQUSRNM,SP70
          MATCH     SP70,PMIQRUID
          IF        !@EQUAL
            PACK      KEY10,PMNPRUID,SP70
            CALL      RDWBSE1
            IF        OVRCD=0
              MOVE      WBSENAM,REQUSRNM
            ELSE
              MOVE      PMNPRUID,REQUSRNM
            ENDIF
          ENDIF
          WRITE     HTMLFILE;REQUSRNM;
          GOTO      IPORQ999
.
IPORQ100  WRITE     HTMLFILE;PMIQSURN;
          GOTO      IPORQ999
.
IPORQ110  WRITE     HTMLFILE;PMIQFNAM;
          GOTO      IPORQ999
.
IPORQ120  WRITE     HTMLFILE;PMIQSNAM;
          GOTO      IPORQ999
.
IPORQ130  UNPACK    DIM127,D1,KEY1,DIM127
          MOVE      ZERO,F1
          MOVE      KEY1,F1
          BRANCH    F1,IPORQ131
.
          WRITE     HTMLFILE;PMIQBDAT;
          GOTO      IPORQ999
.
IPORQ131  PACK      DISPDATE,SP70
          MATCH     SP70,PMIQBDAT
          IF        !@EQUAL
            UNPACK    PMIQBDAT,CCENT,CYEAR,CMON,CDAY
            MOVE      CMON,F2
            LOAD      MTHNAM3,F2,JAN,FEB,MAR,APR,MAY,JUN,JUL,AUG,SEP,OCT,NOV,DEC
            PACK      DISPDATE,CDAY,SP1,MTHNAM3,SP1,CCENT,CYEAR
          ENDIF
          WRITE     HTMLFILE;DISPDATE;
          GOTO      IPORQ999
.
IPORQ140  WRITE     HTMLFILE;PMIQPSEX;
          GOTO      IPORQ999
.
IPORQ150  WRITE     HTMLFILE;PMIQMEDI;
          GOTO      IPORQ999
.
IPORQ160  WRITE     HTMLFILE;PMIQMCCD;
          GOTO      IPORQ999
.
IPORQ170  UNPACK    DIM127,D1,KEY1,DIM127
          MOVE      ZERO,F1
          MOVE      KEY1,F1
          BRANCH    F1,IPORQ171
.
          WRITE     HTMLFILE;PMIQMEDV;
          GOTO      IPORQ999
.
IPORQ171  PACK      DISPDATE,SP70
          MATCH     SP70,PMIQMEDV
          IF        !@EQUAL
            UNPACK    PMIQMEDV,CCENT,CYEAR,CMON,CDAY
            MOVE      CMON,F2
            LOAD      MTHNAM3,F2,JAN,FEB,MAR,APR,MAY,JUN,JUL,AUG,SEP,OCT,NOV,DEC
            PACK      DISPDATE,CDAY,SP1,MTHNAM3,SP1,CCENT,CYEAR
          ENDIF
          WRITE     HTMLFILE;DISPDATE;
          GOTO      IPORQ999
.
IPORQ180  WRITE     HTMLFILE;PMIQDVAN;
          GOTO      IPORQ999
.
IPORQ190  WRITE     HTMLFILE;PMIQIDEN;
          GOTO      IPORQ999
.
IPORQ200  WRITE     HTMLFILE;PMIQADD1;
          GOTO      IPORQ999
.
IPORQ210  WRITE     HTMLFILE;PMIQADD2;
          GOTO      IPORQ999
.
IPORQ220  WRITE     HTMLFILE;PMIQADD3;
          GOTO      IPORQ999
.
IPORQ230  WRITE     HTMLFILE;PMIQADD4;
          GOTO      IPORQ999
.
IPORQ240  WRITE     HTMLFILE;PMIQPOST ;
          GOTO      IPORQ999
.
IPORQ250  WRITE     HTMLFILE;PMIQSAD1;
          GOTO      IPORQ999
.
IPORQ260  WRITE     HTMLFILE;PMIQSAD2;
          GOTO      IPORQ999
.
IPORQ270  WRITE     HTMLFILE;PMIQSAD3;
          GOTO      IPORQ999
.
IPORQ280  WRITE     HTMLFILE;PMIQSAD4;
          GOTO      IPORQ999
.
IPORQ290  WRITE     HTMLFILE;PMIQSPST;
          GOTO      IPORQ999
.
IPORQ300  WRITE     HTMLFILE;PMIQPTYP;
          GOTO      IPORQ999
.
IPORQ310  WRITE     HTMLFILE;PMIQNAME;
          GOTO      IPORQ999
.
IPORQ320  WRITE     HTMLFILE;PMIQSTYP;
          GOTO      IPORQ999
.
IPORQ330  WRITE     HTMLFILE;PMIQUNIT;
          GOTO      IPORQ999
.
IPORQ999  RETURN
.
.------------------------------------------------------------------------------
. NIHC IHI Result Details
.------------------------------------------------------------------------------
IPORS000  BRANCH    FLDITMNO,IPORS010,IPORS020,IPORS030,IPORS040,IPORS050:
                             IPORS060,IPORS070,IPORS080,IPORS090,IPORS100:
                             IPORS110,IPORS120,IPORS130,IPORS140,IPORS150:
                             IPORS160,IPORS170,IPORS180,IPORS190,IPORS200:
                             IPORS210,IPORS220,IPORS230,IPORS240,IPORS250:
                             IPORS260,IPORS270,IPORS280,IPORS290,IPORS300:
                             IPORS310,IPORS320,IPORS330,IPORS340,IPORS350:
                             IPORS360,IPORS370,IPORS380,IPORS390,IPORS400
.
          GOTO      IPORS999
.
IPORS010  WRITE     HTMLFILE;IREQTYPE;
          GOTO      MISF9999
.
IPORS020  WRITE     HTMLFILE;IREQCODE;
          GOTO      IPORS999
.
IPORS030  WRITE     HTMLFILE;IREQDATE;
          GOTO      MISF9999
.
IPORS040  WRITE     HTMLFILE;IREQTIME;
          GOTO      IPORS999
.
IPORS050  WRITE     HTMLFILE;PMISRTYP;
          GOTO      MISF9999
.
IPORS060  WRITE     HTMLFILE;PMISCODE;
          GOTO      IPORS999
.
IPORS070  UNPACK    DIM127,D1,KEY1,DIM127
          MOVE      ZERO,F1
          MOVE      KEY1,F1
          BRANCH    F1,IPORS071
.
          WRITE     HTMLFILE;PMISRDAT;
          GOTO      IPORS999
.
IPORS071  PACK      DISPDATE,SP70
          MATCH     SP70,PMISRDAT
          IF        !@EQUAL
            UNPACK    PMISRDAT,CCENT,CYEAR,CMON,CDAY
            MOVE      CMON,F2
            LOAD      MTHNAM3,F2,JAN,FEB,MAR,APR,MAY,JUN,JUL,AUG,SEP,OCT,NOV,DEC
            PACK      DISPDATE,CDAY,SP1,MTHNAM3,SP1,CCENT,CYEAR
          ENDIF
          WRITE     HTMLFILE;DISPDATE;
          GOTO      IPORS999
.
IPORS080  WRITE     HTMLFILE;PMISRTIM;
          GOTO      IPORS999
.
IPORS090  UNPACK    DIM127,D1,KEY1,DIM127
          MOVE      ZERO,F1
          MOVE      KEY1,F1
          BRANCH    F1,IPORS091
.
          WRITE     HTMLFILE;PMISRUID;
          GOTO      IPORS999
.
IPORS091  PACK      REQUSRNM,SP70
          MATCH     SP70,PMISRUID
          IF        !@EQUAL
            PACK      KEY10,PMNPRUID,SP70
            CALL      RDWBSE1
            IF        OVRCD=0
              MOVE      WBSENAM,REQUSRNM
            ELSE
              MOVE      PMNPRUID,REQUSRNM
            ENDIF
          ENDIF
          WRITE     HTMLFILE;REQUSRNM;
          GOTO      IPORS999
.
IPORS100  WRITE     HTMLFILE;PMISSURN;
          GOTO      IPORS999
.
IPORS110  WRITE     HTMLFILE;PMISFNAM;
          GOTO      IPORS999
.
IPORS120  WRITE     HTMLFILE;PMISSNAM;
          GOTO      IPORS999
.
IPORS130  UNPACK    DIM127,D1,KEY1,DIM127
          MOVE      ZERO,F1
          MOVE      KEY1,F1
          BRANCH    F1,IPORS131
.
          WRITE     HTMLFILE;PMISBDAT;
          GOTO      IPORS999
.
IPORS131  PACK      DISPDATE,SP70
          MATCH     SP70,PMISBDAT
          IF        !@EQUAL
            UNPACK    PMISBDAT,CCENT,CYEAR,CMON,CDAY
            MOVE      CMON,F2
            LOAD      MTHNAM3,F2,JAN,FEB,MAR,APR,MAY,JUN,JUL,AUG,SEP,OCT,NOV,DEC
            PACK      DISPDATE,CDAY,SP1,MTHNAM3,SP1,CCENT,CYEAR
          ENDIF
          WRITE     HTMLFILE;DISPDATE;
          GOTO      IPORS999
.
IPORS140  WRITE     HTMLFILE;PMISPSEX;
          GOTO      IPORS999
.
IPORS150  WRITE     HTMLFILE;PMISMEDI;
          GOTO      IPORS999
.
IPORS160  WRITE     HTMLFILE;PMISMCCD;
          GOTO      IPORS999
.
IPORS170  UNPACK    DIM127,D1,KEY1,DIM127
          MOVE      ZERO,F1
          MOVE      KEY1,F1
          BRANCH    F1,IPORS171
.
          WRITE     HTMLFILE;PMISMEDV;
          GOTO      IPORS999
.
IPORS171  PACK      DISPDATE,SP70
          MATCH     SP70,PMISMEDV
          IF        !@EQUAL
            UNPACK    PMISMEDV,CCENT,CYEAR,CMON,CDAY
            MOVE      CMON,F2
            LOAD      MTHNAM3,F2,JAN,FEB,MAR,APR,MAY,JUN,JUL,AUG,SEP,OCT,NOV,DEC
            PACK      DISPDATE,CDAY,SP1,MTHNAM3,SP1,CCENT,CYEAR
          ENDIF
          WRITE     HTMLFILE;DISPDATE;
          GOTO      IPORS999
.
IPORS180  WRITE     HTMLFILE;PMISDVAN;
          GOTO      IPORS999
.
IPORS190  WRITE     HTMLFILE;PMISIHIN;
          GOTO      IPORS999
.
IPORS200  WRITE     HTMLFILE;PMISADD1;
          GOTO      IPORS999
.
IPORS210  WRITE     HTMLFILE;PMISADD2;
          GOTO      IPORS999
.
IPORS220  WRITE     HTMLFILE;PMISADD3;
          GOTO      IPORS999
.
IPORS230  WRITE     HTMLFILE;PMISADD4;
          GOTO      IPORS999
.
IPORS240  WRITE     HTMLFILE;PMISPOST ;
          GOTO      IPORS999
.
IPORS250  WRITE     HTMLFILE;PMISSAD1;
          GOTO      IPORS999
.
IPORS260  WRITE     HTMLFILE;PMISSAD2;
          GOTO      IPORS999
.
IPORS270  WRITE     HTMLFILE;PMISSAD3;
          GOTO      IPORS999
.
IPORS280  WRITE     HTMLFILE;PMISSAD4;
          GOTO      IPORS999
.
IPORS290  WRITE     HTMLFILE;PMISSPST;
          GOTO      IPORS999
.
IPORS300  WRITE     HTMLFILE;PMISHPII;
          GOTO      IPORS999
.
IPORS310  WRITE     HTMLFILE;PMISPTYP;
          GOTO      IPORS999
.
IPORS320  WRITE     HTMLFILE;PMISNAME;
          GOTO      IPORS999
.
IPORS330  WRITE     HTMLFILE;PMISHPIO;
          GOTO      IPORS999
.
IPORS340  WRITE     HTMLFILE;PMISSTYP;
          GOTO      IPORS999
.
IPORS350  WRITE     HTMLFILE;PMISUNIT;
          GOTO      IPORS999
.
IPORS360  WRITE     HTMLFILE;PMISVSTA;
          GOTO      IPORS999
.
IPORS370  WRITE     HTMLFILE;PMISASTA;
          GOTO      IPORS999
.
IPORS380  WRITE     HTMLFILE;PMISRSCD;
          GOTO      IPORS999
.
IPORS390  WRITE     HTMLFILE;PMISRSDE;
          GOTO      IPORS999
.
IPORS400  WRITE     HTMLFILE;PMISRVER;
          GOTO      IPORS999

.
IPORS999  RETURN
+
.---------------------------------------------------------------
. NIHCIHI <tran id>.properties tag
.---------------------------------------------------------------
IHCHED00  MATCH     SP70,PMNBDPTH
          IF        @EQUAL | @EOS
            WRITE     HTMLFILE;"WebServices Polling Device directory not found.";
            GOTO      IHCHED99
          ENDIF
.
          MATCH    SP70,PMNPUNIQ
          GOTO     IHCHED99 IF EQUAL
          GOTO     IHCHED99 IF EOS
.
          CLEAR     CMDLINE
          APPEND    PMNBDPTH,CMDLINE
          RESET     CMDLINE
          STRIP     CMDLINE
          ENDSET    CMDLINE
.
          MATCH     "10",PMNPRTYP
          IF        @EQUAL
            APPEND    "/webPAS_claims/nihcihiupload/",CMDLINE
          ELSE
            APPEND    "/webPAS_claims/nihcihi/",CMDLINE
          ENDIF
.
          RESET     CMDLINE
          STRIP     CMDLINE
          ENDSET    CMDLINE
          APPEND    PMNPUNIQ,CMDLINE
          APPEND    PROPLITR,CMDLINE
          RESET     CMDLINE
.
          MOVE      ZERO,OVRCD
          TRAP      OVERCOND IF IO
          OPEN      PROPFILE,CMDLINE
          TRAPCLR   IO
          IF        OVRCD=1
            WRITE     HTMLFILE;"Can't&nbsp;read: ",CMDLINE;
            GOTO      IHCHED99
          ENDIF
.
IHCHED10  READ      PROPFILE,SEQ;PROPLINE
          GOTO      IHCHED99 IF OVER
.
          WRITE     HTMLFILE;PROPLINE
.
          GOTO      IHCHED10
.
IHCHED99  CLOSE     PROPFILE
.
          RETURN
+
.---------------------------------------------------------------
. NIHCIHI <tran id>_nihcihi tag
.---------------------------------------------------------------
IHCJSN00  MATCH     SP70,PMNBDPTH
          IF        @EQUAL | @EOS
            WRITE     HTMLFILE;"WebServices Polling Device directory not found.";
            GOTO      IHCJSN99
          ENDIF
.
          MATCH    SP70,PMNPUNIQ
          GOTO     IHCJSN99 IF EQUAL
          GOTO     IHCJSN99 IF EOS
.
          CLEAR     CMDLINE
          APPEND    PMNBDPTH,CMDLINE
          RESET     CMDLINE
          STRIP     CMDLINE
          ENDSET    CMDLINE
.
          MATCH     "10",PMNPRTYP
          IF        @EQUAL
            APPEND    "/webPAS_claims/nihcihiupload/",CMDLINE
          ELSE
            APPEND    "/webPAS_claims/nihcihi/",CMDLINE
          ENDIF
.
          RESET     CMDLINE
          STRIP     CMDLINE
          ENDSET    CMDLINE
          APPEND    PMNPUNIQ,CMDLINE
.
          MATCH     "10",PMNPRTYP
          IF        @EQUAL
            APPEND    NIHWLITU,CMDLINE
          ELSE
            APPEND    NIHWLITR,CMDLINE
          ENDIF
.
          RESET     CMDLINE
.
          MOVE      ZERO,OVRCD
          TRAP      OVERCOND IF IO
          OPEN      NIHWFILE,CMDLINE
          TRAPCLR   IO
          IF        OVRCD=1
            WRITE     HTMLFILE;"Can't&nbsp;read: ",CMDLINE;
            GOTO      IHCJSN99
          ENDIF
.
IHCJSN10  READ      NIHWFILE,SEQ;NIHWLINE
          GOTO      IHCJSN99 IF OVER
.
          WRITE     HTMLFILE;NIHWLINE
.
          GOTO      IHCJSN10
.
IHCJSN99  CLOSE     NIHWFILE
.
          RETURN
+
.---------------------------------------------------------------
. NIHCIHI <tran id>_nihcihi_response tag
.---------------------------------------------------------------
IHCRSP00  MATCH     SP70,PMNBDPTH
          IF        @EQUAL | @EOS
            WRITE     HTMLFILE;"WebServices Polling Device directory not found.";
            GOTO      IHCRSP99
          ENDIF
.
          MATCH    SP70,PMNPUNIQ
          GOTO     IHCRSP99 IF EQUAL
          GOTO     IHCRSP99 IF EOS
.
          CLEAR     CMDLINE
          APPEND    PMNBDPTH,CMDLINE
          RESET     CMDLINE
          STRIP     CMDLINE
          ENDSET    CMDLINE
.
          MATCH     "10",PMNPRTYP
          IF        @EQUAL
            APPEND    "/webPAS_claims/nihcihiupload/",CMDLINE
          ELSE
            APPEND    "/webPAS_claims/nihcihi/",CMDLINE
          ENDIF
.
          RESET     CMDLINE
          STRIP     CMDLINE
          ENDSET    CMDLINE
          APPEND    PMNPUNIQ,CMDLINE
.
          MATCH     "10",PMNPRTYP
          IF        @EQUAL
            APPEND    NIHRLITU,CMDLINE
          ELSE
            APPEND    NIHRLITR,CMDLINE
          ENDIF
.
          RESET     CMDLINE
.
          MOVE      ZERO,OVRCD
          TRAP      OVERCOND IF IO
          OPEN      NIHRFILE,CMDLINE
          TRAPCLR   IO
          IF        OVRCD=1
            WRITE     HTMLFILE;"Can't&nbsp;read: ",CMDLINE;
            GOTO      IHCRSP99
          ENDIF
.
IHCRSP10  READ      NIHRFILE,SEQ;NIHRLINE
          GOTO      IHCRSP99 IF OVER
.
          WRITE     HTMLFILE;NIHRLINE
.
          GOTO      IHCRSP10
.
IHCRSP99  CLOSE     NIHRFILE
.
          RETURN
+
.---------------------------------------------------------------
. NIHCIHI <tran id>_nihcihi_errors tag
.---------------------------------------------------------------
IHCERR00  MATCH     SP70,PMNBDPTH
          IF        @EQUAL | @EOS
            WRITE     HTMLFILE;"WebServices Polling Device directory not found.";
            GOTO      IHCERR99
          ENDIF
.
          MATCH    SP70,PMNPUNIQ
          GOTO     IHCERR99 IF EQUAL
          GOTO     IHCERR99 IF EOS
.
          CLEAR     CMDLINE
          APPEND    PMNBDPTH,CMDLINE
          RESET     CMDLINE
          STRIP     CMDLINE
          ENDSET    CMDLINE
.
          MATCH     "10",PMNPRTYP
          IF        @EQUAL
            APPEND    "/webPAS_claims/nihcihiupload/",CMDLINE
          ELSE
            APPEND    "/webPAS_claims/nihcihi/",CMDLINE
          ENDIF
.
          RESET     CMDLINE
          STRIP     CMDLINE
          ENDSET    CMDLINE
          APPEND    PMNPUNIQ,CMDLINE
.
          MATCH     "10",PMNPRTYP
          IF        @EQUAL
            APPEND    NIHELITU,CMDLINE
          ELSE
            APPEND    NIHELITR,CMDLINE
          ENDIF
.
          RESET     CMDLINE
.
          MOVE      ZERO,OVRCD
          TRAP      OVERCOND IF IO
          OPEN      NIHEFILE,CMDLINE
          TRAPCLR   IO
          IF        OVRCD=1
            WRITE     HTMLFILE;"Can't&nbsp;read: ",CMDLINE;
            GOTO      IHCERR99
          ENDIF
.
IHCERR10  READ      NIHEFILE,SEQ;NIHELINE
          GOTO      IHCERR99 IF OVER
.
          WRITE     HTMLFILE;NIHELINE
.
          GOTO      IHCERR10
.
IHCERR99  CLOSE     NIHEFILE
.
          RETURN
.
.------------------------------------------------------------------------------
. IHI Enquiry tag processing
.------------------------------------------------------------------------------
PIEN0000  BRANCH    FLDITMNO,PIEN0100,PIEN0200,PIEN0300,PIEN0400,PIEN0500:
                             PIEN0600,PIEN0700,PIEN0800,PIEN0900,PIEN1000:
                             PIEN1100,PIEN1200,PIEN1300,PIEN1400,PIEN1500:
                             PIEN1600,PIEN1700,PIEN1800,PIEN1900,PIEN2000:
                             PIEN2100,PIEN2200,PIEN2300,PIEN2400,PIEN2500:
                             PIEN2600,PIEN2700,PIEN2800,PIEN2900,PIEN3000:
                             PIEN3100,PIEN3200
          GOTO      PIEN9999
.
PIEN0100  MATCH     SP70,ENSELOPT
          GOTO      PIEN9999 IF EQUAL
          WRITE     HTMLFILE;ENSELOPT;      * Enquiry selected option
          GOTO      PIEN9999
.
PIEN0200  MATCH     SP70,IHINUMBR
          GOTO      PIEN9999 IF EQUAL
          WRITE     HTMLFILE;IHINUMBR;
          GOTO      PIEN9999
.
PIEN0300  MATCH     SP70,BATCHNUM
          GOTO      PIEN9999 IF EQUAL
          WRITE     HTMLFILE;BATCHNUM;      * Batch ID
          GOTO      PIEN9999
.
PIEN0400  CALL      HOSPID00
          GOTO      PIEN9999
.
PIEN0500  CALL      HOSNM000
          GOTO      PIEN9999
.
PIEN0600  CALL      ENHOS000
          GOTO      PIEN9999
.
PIEN0700  MATCH     SP70,ENSELOPT
          GOTO      PIEN9999 IF EQUAL
.
          MATCH     "A",ENSELOPT
          GOTO      PIEN9999 IF NOT EQUAL
.
          CALL      ENIHI000           * IHI Numbers enquiry results
          GOTO      PIEN9999
.
PIEN0800  CALL      PREVI000           * Previous button (link)
          GOTO      PIEN9999
.
PIEN0900  CALL      NEXTI000           * Next button (link)
          GOTO      PIEN9999
.
PIEN1000  MATCH     SP70,ENSELOPT
          GOTO      PIEN9999 IF EQUAL
.
          MATCH     "B",ENSELOPT
          GOTO      PIEN9999 IF NOT EQUAL
.
          CALL      ENDTE000           * IHI By Date
          GOTO      PIEN9999
.
PIEN1100  CALL      PREVD000           * Previous button (link)
          GOTO      PIEN9999
.
PIEN1200  CALL      NEXTD000           * Next button (link)
          GOTO      PIEN9999
.
PIEN1300  MATCH     SP70,ENSELOPT
          GOTO      PIEN9999 IF EQUAL
.
          MATCH     "C",ENSELOPT
          GOTO      PIEN9999 IF NOT EQUAL
.
          MOVE      ONE,FILTTYPE       * Filter on HI Service (code)
          CALL      ENDTE000           * IHI By Date (HI Service)
          GOTO      PIEN9999
.
PIEN1400  MOVE      ONE,FILTTYPE
          CALL      PREVD000           * Previous button (link)
          GOTO      PIEN9999
.
PIEN1500  MOVE      ONE,FILTTYPE
          CALL      NEXTD000           * Next button (link)
          GOTO      PIEN9999
.
PIEN1600  MATCH     SP70,ENSELOPT
          GOTO      PIEN9999 IF EQUAL
.
          MATCH     "D",ENSELOPT
          GOTO      PIEN9999 IF NOT EQUAL
.
          MOVE      FOUR,FILTTYPE
          CALL      IBACLOCK
          PACK      DATEPSTT,SP70                * no Start Date
          PACK      DATEPEND,CCC,CYY,CMM,CDD     * use today's date as End Date
          REP       " 0",DATEPEND
.
          CALL      ENDTE000           * IHI By messageID
          GOTO      PIEN9999
.
PIEN1700  MOVE      FOUR,FILTTYPE
          CALL      PREVD000           * Previous button (link)
          GOTO      PIEN9999
.
PIEN1800  MOVE      FOUR,FILTTYPE
          CALL      NEXTD000           * Next button (link)
          GOTO      PIEN9999
.
PIEN1900  MATCH     SP70,ENSELOPT
          GOTO      PIEN9999 IF EQUAL
.
          MATCH     "E",ENSELOPT
          GOTO      PIEN9999 IF NOT EQUAL
.
                                       * IHI By BatchID
          GOTO      PIEN9999
.
PIEN2000  CALL      PREVD000           * Previous button (link)
          GOTO      PIEN9999
.
PIEN2100  CALL      NEXTD000           * Next button (link)
          GOTO      PIEN9999
.
PIEN2200  MATCH     SP70,ENSELOPT
          GOTO      PIEN9999 IF EQUAL
.
          MATCH     "F",ENSELOPT
          GOTO      PIEN9999 IF NOT EQUAL
.
          MOVE      TWO,FILTTYPE       * Filter on Requesting Organisation
          CALL      ENDTE000           * IHI By Date (Req Org)
          GOTO      PIEN9999
.
PIEN2300  MOVE      TWO,FILTTYPE
          CALL      PREVD000           * Previous button (link)
          GOTO      PIEN9999
.
PIEN2400  MOVE      TWO,FILTTYPE
          CALL      NEXTD000           * Next button (link)
          GOTO      PIEN9999
.
PIEN2500  MATCH     SP70,ENSELOPT
          GOTO      PIEN9999 IF EQUAL
.
          MATCH     "G",ENSELOPT
          GOTO      PIEN9999 IF NOT EQUAL
.
          MOVE      THREE,FILTTYPE     * Filter on User ID
          CALL      ENDTE000           * IHI By User ID
          GOTO      PIEN9999
.
PIEN2600  MOVE      THREE,FILTTYPE
          CALL      PREVD000           * Previous button (link)
          GOTO      PIEN9999
.
PIEN2700  MOVE      THREE,FILTTYPE
          CALL      NEXTD000           * Next button (link)
          GOTO      PIEN9999
.
PIEN2800  MATCH     SP70,DATEPSTT
          GOTO      PIEN9999 IF EQUAL
.
          UNPACK    DATEPSTT,CCENT,CYEAR,CMON,CDAY
          MOVE      ZERO,F2
          MOVE      CMON,F2
          LOAD      MTHNAM3,F2,JAN,FEB,MAR,APR,MAY,JUN,JUL,AUG,SEP,OCT,NOV,DEC
          PACK      DISPDATE,CDAY,SP1,MTHNAM3,SP1,CCENT,CYEAR,SP10
          WRITE     HTMLFILE;DISPDATE;
          GOTO      PIEN9999
.
PIEN2900  MATCH     SP70,DATEPEND
          GOTO      PIEN9999 IF EQUAL
.
          UNPACK    DATEPEND,CCENT,CYEAR,CMON,CDAY
          MOVE      ZERO,F2
          MOVE      CMON,F2
          LOAD      MTHNAM3,F2,JAN,FEB,MAR,APR,MAY,JUN,JUL,AUG,SEP,OCT,NOV,DEC
          PACK      DISPDATE,CDAY,SP1,MTHNAM3,SP1,CCENT,CYEAR,SP10
          WRITE     HTMLFILE;DISPDATE;
          GOTO      PIEN9999
.
PIEN3000  MOVE      SELSERVC,F2
          WRITE     HTMLFILE;F2;
          GOTO      PIEN9999
.
PIEN3100  WRITE     HTMLFILE;HISMSGID;
          GOTO      PIEN9999
.
PIEN3200  MOVE      IHIUSERI,DIM10
          STRIP     DIM10
          WRITE     HTMLFILE;DIM10;
          GOTO      PIEN9999
.
PIEN9999  RETURN
+
.------------------------------------------------------------------------------
. IHI Exceptions Enquiry tag processing
.------------------------------------------------------------------------------
PIEX0000  BRANCH    FLDITMNO,PIEX0100,PIEX0200,PIEX0300,PIEX0400,PIEX0500:
                             PIEX0600,PIEX0700,PIEX0800,PIEX0900,PIEX1000:
                             PIEX1100,PIEX1200,PIEX1300,PIEX1400,PIEX1500:
                             PIEX1600,PIEX1700,PIEX1800,PIEX1900,PIEX2000:
                             PIEX2100,PIEX2200,PIEX2300,PIEX2400,PIEX2500:
                             PIEX2600
          GOTO      PIEX9999
.
PIEX0100  MATCH     SP70,ENSELOPT
          GOTO      PIEX9999 IF EQUAL
          WRITE     HTMLFILE;ENSELOPT;      * Enquiry selected option
          GOTO      PIEX9999
.
PIEX0200  MATCH     SP70,IHINUMBR
          GOTO      PIEX9999 IF EQUAL
          WRITE     HTMLFILE;IHINUMBR;
          GOTO      PIEX9999
.
PIEX0300  MATCH     SP70,BATCHNUM
          GOTO      PIEX9999 IF EQUAL
          WRITE     HTMLFILE;BATCHNUM;      * Batch ID
          GOTO      PIEX9999
.
PIEX0400  CALL      HOSPID00
          GOTO      PIEX9999
.
PIEX0500  CALL      HOSNM000
          GOTO      PIEX9999
.
PIEX0600  CALL      ENHOS000
          GOTO      PIEX9999
.
PIEX0700  MATCH     SP70,DATEPSTT
          GOTO      PIEX9999 IF EQUAL
.
          UNPACK    DATEPSTT,CCENT,CYEAR,CMON,CDAY
          MOVE      ZERO,F2
          MOVE      CMON,F2
          LOAD      MTHNAM3,F2,JAN,FEB,MAR,APR,MAY,JUN,JUL,AUG,SEP,OCT,NOV,DEC
          PACK      DISPDATE,CDAY,SP1,MTHNAM3,SP1,CCENT,CYEAR,SP10
          WRITE     HTMLFILE;DISPDATE;
          GOTO      PIEX9999
.
PIEX0800  MATCH     SP70,DATEPEND
          GOTO      PIEX9999 IF EQUAL
.
          UNPACK    DATEPEND,CCENT,CYEAR,CMON,CDAY
          MOVE      ZERO,F2
          MOVE      CMON,F2
          LOAD      MTHNAM3,F2,JAN,FEB,MAR,APR,MAY,JUN,JUL,AUG,SEP,OCT,NOV,DEC
          PACK      DISPDATE,CDAY,SP1,MTHNAM3,SP1,CCENT,CYEAR,SP10
          WRITE     HTMLFILE;DISPDATE;
          GOTO      PIEX9999
.
PIEX0900  WRITE     HTMLFILE;HISMSGID;
          GOTO      PIEX9999
.
PIEX1000  MOVE      IHIUSERI,DIM10
          STRIP     DIM10
          WRITE     HTMLFILE;DIM10;
          GOTO      PIEX9999
.
PIEX1100  MATCH     SP70,ENSELOPT
          GOTO      PIEX9999 IF EQUAL
.
          MATCH     "A",ENSELOPT
          GOTO      PIEX9999 IF NOT EQUAL
.
          CALL      EENUM000           * Exceptions By IHI Number
          GOTO      PIEX9999
.
PIEX1200  CALL      PREVI000           * Previous button (link)
          GOTO      PIEX9999
.
PIEX1300  CALL      NEXTI000           * Next button (link)
          GOTO      PIEX9999
.
PIEX1400  MATCH     SP70,ENSELOPT
          GOTO      PIEX9999 IF EQUAL
.
          MATCH     "B",ENSELOPT
          GOTO      PIEX9999 IF NOT EQUAL
.
          CALL      EEDTE000           * Exceptions By Date
          GOTO      PIEX9999
.
PIEX1500  CALL      PREVD000           * Previous button (link)
          GOTO      PIEX9999
.
PIEX1600  CALL      NEXTD000           * Next button (link)
          GOTO      PIEX9999
.
PIEX1700  MATCH     SP70,ENSELOPT
          GOTO      PIEX9999 IF EQUAL
.
          MATCH     "C",ENSELOPT
          GOTO      PIEX9999 IF NOT EQUAL
.
          MOVE      FOUR,FILTTYPE      * Filter on messageID
          CALL      IBACLOCK
          PACK      DATEPSTT,SP70                * no Start Date
          PACK      DATEPEND,CCC,CYY,CMM,CDD     * use today's date as End Date
          REP       " 0",DATEPEND
.
          CALL      EEDTE000           * Exceptions By Date
          GOTO      PIEX9999
.
PIEX1800  MOVE      FOUR,FILTTYPE      * Filter on messageID
          CALL      PREVD000           * Previous button (link)
          GOTO      PIEX9999
.
PIEX1900  MOVE      FOUR,FILTTYPE      * Filter on messageID
          CALL      NEXTD000           * Next button (link)
          GOTO      PIEX9999
.
PIEX2000  MATCH     SP70,ENSELOPT
          GOTO      PIEX9999 IF EQUAL
.
          MATCH     "D",ENSELOPT
          GOTO      PIEX9999 IF NOT EQUAL
.
          MOVE      THREE,FILTTYPE     * Filter on User ID
          CALL      EEDTE000           * Exceptions By Date
          GOTO      PIEX9999
.
PIEX2100  MOVE      THREE,FILTTYPE     * Filter on User ID
          CALL      PREVD000           * Previous button (link)
          GOTO      PIEX9999
.
PIEX2200  MOVE      THREE,FILTTYPE     * Filter on User ID
          CALL      NEXTD000           * Next button (link)
          GOTO      PIEX9999
.
PIEX2300  MATCH     SP70,ENSELOPT
          GOTO      PIEX9999 IF EQUAL
.
          MATCH     "F",ENSELOPT
          GOTO      PIEX9999 IF NOT EQUAL
.
          CALL      EEURN000           * Exceptions By UR Number
          GOTO      PIEX9999
.
PIEX2400  CALL      PREVU000           * Previous button (link)
          GOTO      PIEX9999
.
PIEX2500  CALL      NEXTU000           * Next button (link)
          GOTO      PIEX9999
.
PIEX2600  MATCH     SP70,IHIURNUM
          GOTO      PIEX9999 IF EQUAL
          WRITE     HTMLFILE;IHIURNUM;
          GOTO      PIEX9999
.
PIEX9999  RETURN
+

.------------------------------------------------------------------------------
. Display Multi-hospital selection list
.------------------------------------------------------------------------------
MHSEL000  COMPARE   ONE,IBCNMHOS
          GOTO      MHSEL999 IF NOT EQUAL
.
          WRITE     HTMLFILE;"<td class=DataLabel>Hospital ID &nbsp; &nbsp;":
                             " &nbsp; &nbsp;":
                             "<select name=hospcode title='Hospital ID' ":
                             "class=Mandatory>"
.
          CALL      HOSPID00
.
          WRITE     HTMLFILE;"</select></td>";
.
MHSEL999  RETURN
+
.------------------------------------------------------------------------------
. Hospital ID (select options)
.------------------------------------------------------------------------------
HOSPID00  PACK      KEY3,SP10
          CALL      RSPTHSP1
HOSPID10  CALL      RKPTHSP1
          BRANCH    OVRCD,HOSPID90
.
          PACK      KEY5,QUOTE,PTHSHOSP,QUOTE
          BRANCH    IBCNMHOS,HOSPID20
          WRITE     HTMLFILE;"<option value=",KEY5,">":
                             PTHSNAME,"</option>"
          GOTO      HOSPID10
.
.         Mult-Hospital
.
HOSPID20  BRANCH    ALLHFLAG,HOSPID30            * don't default to user's hosp
          MATCH     SP6,HOSPCODE
          IF        @EQUAL
            MOVE      WBSEHOSP,HOSPCODE          * default to user's Hosp code
          ENDIF
HOSPID30  MATCH     HOSPCODE,PTHSHOSP
          IF        @EQUAL
            WRITE     HTMLFILE;"<option value=",KEY5," selected>":
                               PTHSNAME,"</option>"
          ELSE
            WRITE     HTMLFILE;"<option value=",KEY5,">":
                               PTHSNAME,"</option>"
          ENDIF
          GOTO      HOSPID10
.
HOSPID90  MOVE      ZERO,ALLHFLAG
HOSPID99  RETURN
+
.------------------------------------------------------------------------------
. Display selected Hospital Name (multi-hospital)
.------------------------------------------------------------------------------
HOSNM000  COMPARE   ONE,IBCNMHOS
          GOTO      HOSNM999 IF NOT EQUAL
.
          MOVE      " Unknown",DIM8
          PACK      PTHSNAME,HOSPCODE,DIM8
          PACK      KEY3,HOSPCODE,SP10
          CALL      RDPTHSP1
.
          WRITE     HTMLFILE;PTHSNAME
.
HOSNM999  RETURN
+
.------------------------------------------------------------------------------
. Display Hospital Name (multi-hospital) for headers
.------------------------------------------------------------------------------
ENHOS000  COMPARE   ONE,IBCNMHOS          * Hospital name for header (multi-hos)
          GOTO      ENHOS900 IF NOT EQUAL
          MATCH     SP70,HOSPNAME
          GOTO      ENHOS900 IF EQUAL
.
          WRITE     HTMLFILE;"<td class=DataLabel>Hospital &nbsp;":
                             "<input type=text name=dummy4 size=25 ":
                             "class=Readonly readonly value=",QUOTE:
                             PTHSNAME,QUOTE,"></td>";
          GOTO      ENHOS999
.
ENHOS900  WRITE     HTMLFILE;"<input type=hidden name=dummy4 value=":
                             QUOTE,QUOTE,">";
ENHOS999  RETURN
+
.------------------------------------------------------------------------------
. Enquiry output - by IHI Number (descending date order)
.------------------------------------------------------------------------------
ENIHI000  MATCH     "0",PTCNUNET
          GOTO      ENIHI910 IF EQUAL
.
          MOVE      ONE,ENDOFLST           * Reset end-of-list flag
          MOVE      ZERO,ROWCOUNT
.
          MOVE      ZERO,RECNUMB
          MOVE      ZERO,DISNUMB
.
          PACK      KEY62,IHINUMBR,Z70
          CALL      RSPMIHI3
ENIHI100  CALL      RPPMIHI3                * read next record
          BRANCH    OVRCD,ENIHI910          * end of file
.
          MATCH     IHINUMBR,PMIHIHIN
          GOTO      ENIHI910 IF NOT EQUAL
.
          ADD       ONE,RECNUMB
          IF        STARTNUM>=RECNUMB
            GOTO      ENIHI100
          ENDIF
.
          CALL      IENROW00                * Output row
.
          ADD       ONE,DISNUMB
          COMPARE   NORECORD,DISNUMB
          GOTO      ENIHI100 IF NOT EQUAL
.
          CALL      RPPMIHI3                * read next record
          BRANCH    OVRCD,ENIHI910          * end of file
.
          MOVE      ZERO,ENDOFLST
          GOTO      ENIHI920
.
ENIHI910  MOVE      ONE,ENDOFLST
.
ENIHI920  CALL      NOMORE00      * Show no more records row (if applicable)
ENIHI999  RETURN
+
.------------------------------------------------------------------------------
. Enquiry output - by Date (descending date order)
.------------------------------------------------------------------------------
ENDTE000  MATCH     "0",PTCNUNET
          GOTO      ENDTE910 IF EQUAL
.
          MOVE      ONE,ENDOFLST           * Reset end-of-list flag
          MOVE      ZERO,ROWCOUNT
.
          MOVE      ZERO,RECNUMB
          MOVE      ZERO,DISNUMB
.
          PACK      KEY62,DATEPEND,Z70
          CALL      RSPMIHI4
ENDTE100  CALL      RPPMIHI4                * read next record
          BRANCH    OVRCD,ENDTE910          * end of file
.
          MATCH     DATEPEND,PMIHADAT
          GOTO      ENDTE110 IF EQUAL       * same as end date; include
          GOTO      ENDTE100 IF NOT LESS    * NOT before end date; get next rec
.
ENDTE110  MATCH     DATEPSTT,PMIHADAT       * before start date?
          GOTO      ENDTE910 IF LESS        * yes; end of list
.
          IF        FILTTYPE = 1
            STRIP     SELSERVC
            MOVE      SELSERVC,F2
            STRIP     PMIHIHIS
            MOVE      PMIHIHIS,F2A
            COMPARE   F2,F2A
            GOTO      ENDTE100 IF NOT EQUAL
          ENDIF
.
          IF        FILTTYPE = 2
            COMPARE   ONE,IBCNMHOS
            GOTO      ENDTE120 IF NOT EQUAL
.
            MATCH     HOSPCODE,PMIHINTB            
            GOTO      ENDTE100 IF NOT EQUAL
          ENDIF
.
          IF        FILTTYPE = 3
            MATCH     SP70,IHIUSERI         * no User ID specified?
            GOTO      ENDTE120 IF EQUAL
.
            MATCH     IHIUSERI,PMIHCUID
            GOTO      ENDTE100 IF NOT EQUAL
          ENDIF
.
          IF        FILTTYPE = 4
            MATCH     SP70,HISMSGID
            IF        !@EQUAL
              MATCH     HISMSGID,PMIHMESI   * matching messageID?
              GOTO      ENDTE100 IF NOT EQUAL
            ENDIF
          ENDIF
.
ENDTE120  ADD       ONE,RECNUMB
          IF        STARTNUM>=RECNUMB
            GOTO      ENDTE100
          ENDIF
.
          CALL      IENROW00                * Output row
.
          ADD       ONE,DISNUMB
          COMPARE   NORECORD,DISNUMB
          GOTO      ENDTE100 IF NOT EQUAL
.
          CALL      RPPMIHI4                * read next record
          BRANCH    OVRCD,ENDTE910          * end of file
.
          MOVE      ZERO,ENDOFLST
          GOTO      ENDTE920
.
ENDTE910  MOVE      ONE,ENDOFLST
.
ENDTE920  CALL      NOMORE00      * Show no more records row (if applicable)
ENDTE999  RETURN
+
.------------------------------------------------------------------------------
. Output row cells - IHI Enquiry
.------------------------------------------------------------------------------
IENROW00  UNPACK    SP70,VERISTAT,ACTVSTAT
.
          MOVE      ZERO,F1
          MOVE      PMIHVSTA,F1
          LOAD      VERISTAT,F1,VERSTAT1,VERSTAT2
.
          MOVE      ZERO,F1
          MOVE      PMIHASTA,F1
          LOAD      ACTVSTAT,F1,ACTSTAT1,ACTSTAT2,ACTSTAT3,ACTSTAT4,ACTSTAT5
.
          PACK      SERVDESC,SP70
          MOVE      ZERO,F2
          MOVE      PMIHIHIS,F2
          LOAD      SERVDESC,F2,SERVICE1,SERVICE2,SERVICE3
.
          PACK      KEY10,PMIHCUID,SP70
          CALL      RDWBSE1
          IF        OVRCD=0
            MOVE      WBSENAM,DISPUSER
          ELSE
            MOVE      PMIHUUID,DISPUSER
          ENDIF
.
          PACK      ORGNNAME,SP70
          PACK      KEY3,PMIHINTB,SP70
          CALL      RDPTHSP1
          IF        OVRCD<>1
            PACK      ORGNNAME,PTHSNAME,SP70
          ENDIF
.
          PACK      DTTMDIS1,SP70
          MATCH     SP70,PMIHADAT
          IF        !@EQUAL
            UNPACK    PMIHADAT,CCENT,CYEAR,CMON,CDAY
            MOVE      CMON,F2
            LOAD      MTHNAM3,F2,JAN,FEB,MAR,APR,MAY,JUN,JUL,AUG,SEP,OCT,NOV,DEC
            PACK      DTTMDIS1,CDAY,SP1,MTHNAM3,SP1,CCENT,CYEAR,SP1,CONSTRAT:
                               PMIHATIM
          ENDIF
.
          PACK      DTTMDIS2,SP70
          MATCH     SP70,PMIHCDAT
          IF        !@EQUAL
            UNPACK    PMIHCDAT,CCENT,CYEAR,CMON,CDAY
            MOVE      CMON,F2
            LOAD      MTHNAM3,F2,JAN,FEB,MAR,APR,MAY,JUN,JUL,AUG,SEP,OCT,NOV,DEC
            PACK      DTTMDIS2,CDAY,SP1,MTHNAM3,SP1,CCENT,CYEAR,SP1,CONSTRAT:
                               PMIHCTIM
          ENDIF
.
          WRITE     HTMLFILE;"<tr>":
                      "<td>&nbsp;",PMIHIHIN,"</td>":
                      "<td>&nbsp;&nbsp;",DTTMDIS1,"</td>":
                      "<td>&nbsp;&nbsp;",VERISTAT,"</td>":
                      "<td>&nbsp;&nbsp;",ACTVSTAT,"</td>":
.                      "<td>&nbsp;&nbsp;",SERVDESC,"</td>":
.                      "<td>&nbsp;&nbsp;",PMIHHISV,"</td>":
                      "<td>&nbsp;&nbsp;",PMIHMESI,"</td>":
.                      "<td>&nbsp;&nbsp;",PMIHBATI,"</td>":
                      "<td>&nbsp;&nbsp;",ORGNNAME,"</td>":
                      "<td>&nbsp;&nbsp;",DTTMDIS2,"</td>":
                      "<td>&nbsp;&nbsp;",DISPUSER,"</td>":
                      "</tr>";
.
IENROW99  RETURN
+
.------------------------------------------------------------
. PREVI000 - Link for previous button (By IHI Number)
.------------------------------------------------------------
PREVI000  MOVE      NORECORD,KEY2
          REP       " +",KEY2
          ASSIGN    STARTNUM-NORECORD,F3
          IF        F3<0
            MOVE      ZERO,F3
          ENDIF
          MOVE      F3,KEY3
          REP       " +",KEY3
          UNPACK    DIM127,D1,FLDPARA,DIM127
          MOVE      REPORTNO,DIM2
          REP       " +",DIM2
.
          WRITE     HTMLFILE;"comweb06.pbl":
                                 "?reportno=",DIM2:
                                 "&template=",FLDPARA:
                                 "&startnum=",KEY3:
                                 "&norecord=",KEY2:
                                 "&enselopt=",ENSELOPT:
                                 "&ihinumbr=",IHINUMBR;
.
PREVI999  RETURN
+
.------------------------------------------------------------
. NEXTI000 - Link for next button (By IHI Number)
.------------------------------------------------------------
NEXTI000  MOVE      NORECORD,KEY2
          REP       " +",KEY2
          ASSIGN    STARTNUM+NORECORD,F3
          MOVE      F3,KEY3
          REP       " +",KEY3
          UNPACK    DIM127,D1,FLDPARA,DIM127
          MOVE      REPORTNO,DIM2
          REP       " +",DIM2
.
          WRITE     HTMLFILE;"comweb06.pbl":
                                 "?reportno=",DIM2:
                                 "&template=",FLDPARA:
                                 "&startnum=",KEY3:
                                 "&norecord=",KEY2:
                                 "&enselopt=",ENSELOPT:
                                 "&ihinumbr=",IHINUMBR;
.
NEXTI999  RETURN
+
.------------------------------------------------------------
. PREVD000 - Link for previous button (By Date)
.------------------------------------------------------------
PREVD000  MOVE      NORECORD,KEY2
          REP       " +",KEY2
          ASSIGN    STARTNUM-NORECORD,F3
          IF        F3<0
            MOVE      ZERO,F3
          ENDIF
          MOVE      F3,KEY3
          REP       " +",KEY3
          UNPACK    DIM127,D1,FLDPARA,DIM127
          MOVE      REPORTNO,DIM2
          REP       " +",DIM2
.
          WRITE     HTMLFILE;"comweb06.pbl":
                                 "?reportno=",DIM2:
                                 "&template=",FLDPARA:
                                 "&startnum=",KEY3:
                                 "&norecord=",KEY2:
                                 "&enselopt=",ENSELOPT:
                                 "&datepstt=",DATEPSTT:
                                 "&datepend=",DATEPEND;
.
          IF        FILTTYPE = 1
            MOVE      SELSERVC,F2
            WRITE     HTMLFILE;"&selservc=",F2;
          ENDIF
.
          IF        FILTTYPE = 2
            WRITE     HTMLFILE;"&hospcode=",HOSPCODE;
          ENDIF
.
          IF        FILTTYPE = 3
            WRITE     HTMLFILE;"&ihiuseri=",IHIUSERI;
          ENDIF
.
          IF        FILTTYPE = 4
            WRITE     HTMLFILE;"&hismsgid=",HISMSGID;
          ENDIF
.
          IF        FILTTYPE = 5
            WRITE     HTMLFILE;"&selreqtp=",SELREQTP;
          ENDIF
.
PREVD999  RETURN
+
.------------------------------------------------------------
. NEXTD000 - Link for next button (By Date)
.------------------------------------------------------------
NEXTD000  MOVE      NORECORD,KEY2
          REP       " +",KEY2
          ASSIGN    STARTNUM+NORECORD,F3
          MOVE      F3,KEY3
          REP       " +",KEY3
          UNPACK    DIM127,D1,FLDPARA,DIM127
          MOVE      REPORTNO,DIM2
          REP       " +",DIM2
.
          WRITE     HTMLFILE;"comweb06.pbl":
                                 "?reportno=",DIM2:
                                 "&template=",FLDPARA:
                                 "&startnum=",KEY3:
                                 "&norecord=",KEY2:
                                 "&enselopt=",ENSELOPT:
                                 "&datepstt=",DATEPSTT:
                                 "&datepend=",DATEPEND;
.
          IF        FILTTYPE = 1
            MOVE      SELSERVC,F2
            WRITE     HTMLFILE;"&selservc=",F2;
          ENDIF
.
          IF        FILTTYPE = 2
            WRITE     HTMLFILE;"&hospcode=",HOSPCODE;
          ENDIF
.
          IF        FILTTYPE = 3
            WRITE     HTMLFILE;"&ihiuseri=",IHIUSERI;
          ENDIF
.
          IF        FILTTYPE = 4
            WRITE     HTMLFILE;"&hismsgid=",HISMSGID;
          ENDIF
.
          IF        FILTTYPE = 5
            WRITE     HTMLFILE;"&selreqtp=",SELREQTP;
          ENDIF
.
NEXTD999  RETURN
+
.------------------------------------------------------------
. NOMORE00 - Display "No more records" at end of list
.------------------------------------------------------------
NOMORE00  COMPARE   ONE,ENDOFLST
          GOTO      NOMORE99 IF NOT EQUAL
.
          WRITE     HTMLFILE;"<tr bgcolor=#FF0000>":
                             "<td colspan=11 align=center>":
                             "No more records</td></tr>"
.
NOMORE99  RETURN
+
.------------------------------------------------------------------------------
. Output row cells - IHI Exceptions Enquiry
.------------------------------------------------------------------------------
EENROW00  UNPACK    SP70,VERISTAT,ACTVSTAT
.
          MOVE      ZERO,F1
          MOVE      PMIEVSTA,F1
          LOAD      VERISTAT,F1,VERSTAT1,VERSTAT2
.
          MOVE      ZERO,F1
          MOVE      PMIEASTA,F1
          LOAD      ACTVSTAT,F1,ACTSTAT1,ACTSTAT2,ACTSTAT3,ACTSTAT4,ACTSTAT5
.
          PACK      SERVDESC,SP70
          MOVE      ZERO,F2
          MOVE      PMIEIHIS,F2
          LOAD      SERVDESC,F2,SERVICE1,SERVICE2,SERVICE3
.
          PACK      KEY10,PMIECUID,SP70
          CALL      RDWBSE1
          IF        OVRCD=0
            MOVE      WBSENAM,DISPUSER
          ELSE
            MOVE      PMIEUUID,DISPUSER
          ENDIF
.
          PACK      DTTMDIS1,SP70
          MATCH     SP70,PMIEADAT
          IF        !@EQUAL
            UNPACK    PMIEADAT,CCENT,CYEAR,CMON,CDAY
            MOVE      CMON,F2
            LOAD      MTHNAM3,F2,JAN,FEB,MAR,APR,MAY,JUN,JUL,AUG,SEP,OCT,NOV,DEC
            PACK      DTTMDIS1,CDAY,SP1,MTHNAM3,SP1,CCENT,CYEAR,SP1,CONSTRAT:
                               PMIEATIM
          ENDIF
.
          PACK      DTTMDIS2,SP70
          MATCH     SP70,PMIECDAT
          IF        !@EQUAL
            UNPACK    PMIECDAT,CCENT,CYEAR,CMON,CDAY
            MOVE      CMON,F2
            LOAD      MTHNAM3,F2,JAN,FEB,MAR,APR,MAY,JUN,JUL,AUG,SEP,OCT,NOV,DEC
            PACK      DTTMDIS2,CDAY,SP1,MTHNAM3,SP1,CCENT,CYEAR,SP1,CONSTRAT:
                               PMIECTIM
          ENDIF
.
          MATCH     SP70,PMIEURNO
          IF        !@EQUAL & !@EOS
.
            PACK      KEY8,PMIEURNO,SP70
            CALL      RDPMPX21
            IF        OVRCD=1
              CALL      CLPMSPX2
            ENDIF
.
          ENDIF
.
          WRITE     HTMLFILE;"<tr>":
                      "<td>&nbsp; ";
.
.          MATCH     SP70,PMPXFLDR
.          IF        !@EQUAL & !@EOS
.
            CALL      PATFLD00
.
            REP       " +",PMIEURNO
.
            WRITE     HTMLFILE;"<a href=comweb06.pbl?":
                             "&reportno=01":
                             "&template=010":
                             "&urnumber=",PMIEURNO,">";
.
            WRITE     HTMLFILE;"<img src=../images/PatientFolder",KEY3,".gif":
                               " class=Icon></a> ";
.
            REP       "+ ",PMIEURNO
.
.          ENDIF  
.
          WRITE     HTMLFILE;PMIEURNO,"</td>":
                    "<td>&nbsp;",PMIEIHIN,"</td>":
                    "<td>&nbsp;",PMIEOTUR,"</td>":
                    "<td>&nbsp;&nbsp;",DTTMDIS1,"</td>":
                    "<td>&nbsp;&nbsp;",VERISTAT,"</td>":
                    "<td>&nbsp;&nbsp;",ACTVSTAT,"</td>":
.                     "<td>&nbsp;&nbsp;",SERVDESC,"</td>":
.                     "<td>&nbsp;&nbsp;",PMIEHISV,"</td>":
                    "<td>&nbsp;&nbsp;",PMIEMESI,"</td>":
                    "<td>&nbsp;&nbsp;",DTTMDIS2,"</td>":
                    "<td>&nbsp;&nbsp;",DISPUSER,"</td>":
                    "<td>&nbsp;&nbsp;",PMIEDESC,"</td>":
                    "</tr>";
.
EENROW99  RETURN
+
.------------------------------------------------------------------------------
. Exceptions Enquiry - by IHI Number (descending date order)
.------------------------------------------------------------------------------
EENUM000  MOVE      ONE,ENDOFLST           * Reset end-of-list flag
          MOVE      ZERO,ROWCOUNT
.
          MOVE      ZERO,RECNUMB
          MOVE      ZERO,DISNUMB
.
          PACK      KEY72,IHINUMBR,Z70
          CALL      RSPMIHE2
EENUM100  CALL      RPPMIHE2                * read next record
          BRANCH    OVRCD,EENUM910          * end of file
.
          MATCH     IHINUMBR,PMIEIHIN
          GOTO      EENUM910 IF NOT EQUAL
.
          ADD       ONE,RECNUMB
          IF        STARTNUM>=RECNUMB
            GOTO      EENUM100
          ENDIF
.
          CALL      EENROW00                * Output row
.
          ADD       ONE,DISNUMB
          COMPARE   NORECORD,DISNUMB
          GOTO      EENUM100 IF NOT EQUAL
.
          CALL      RPPMIHE2                * read next record
          BRANCH    OVRCD,EENUM910          * end of file
.
          MOVE      ZERO,ENDOFLST
          GOTO      EENUM920
.
EENUM910  MOVE      ONE,ENDOFLST
.
EENUM920  CALL      NOMORE00      * Show no more records row (if applicable)
EENUM999  RETURN
+
.------------------------------------------------------------------------------
. Exceptions Enquiry - by Date (descending date order)
.------------------------------------------------------------------------------
EEDTE000  MOVE      ONE,ENDOFLST           * Reset end-of-list flag
          MOVE      ZERO,ROWCOUNT
.
          MOVE      ZERO,RECNUMB
          MOVE      ZERO,DISNUMB
.
          PACK      KEY88,DATEPEND,Z70
          CALL      RSPMIHE6
EEDTE100  CALL      RPPMIHE6                * read next record
          BRANCH    OVRCD,EEDTE910          * end of file
.
          MATCH     DATEPEND,PMIECDAT
          GOTO      EEDTE110 IF EQUAL       * same as end date; include
          GOTO      EEDTE100 IF NOT LESS    * NOT before end date; get next rec
.
EEDTE110  MATCH     SP70,DATEPSTT
          GOTO      EEDTE111 IF EQUAL
.
          MATCH     DATEPSTT,PMIECDAT       * before start date?
          GOTO      EEDTE910 IF LESS        * yes; end of list
.
EEDTE111  IF        FILTTYPE = 1
            STRIP     SELSERVC
            MOVE      SELSERVC,F2
            STRIP     PMIEIHIS
            MOVE      PMIEIHIS,F2A
            COMPARE   F2,F2A
            GOTO      EEDTE100 IF NOT EQUAL
          ENDIF
.
          IF        FILTTYPE = 3
            MATCH     SP70,IHIUSERI         * no User ID specified?
            GOTO      EEDTE120 IF EQUAL
.
            MATCH     IHIUSERI,PMIECUID
            GOTO      EEDTE100 IF NOT EQUAL
          ENDIF
.
          IF        FILTTYPE = 4
            MATCH     SP70,HISMSGID
            IF        !@EQUAL
              MATCH     HISMSGID,PMIEMESI   * matching messageID?
              GOTO      EEDTE100 IF NOT EQUAL
            ENDIF
          ENDIF
.
EEDTE120  ADD       ONE,RECNUMB
          IF        STARTNUM>=RECNUMB
            GOTO      EEDTE100
          ENDIF
.
          CALL      EENROW00                * Output row
.
          ADD       ONE,DISNUMB
          COMPARE   NORECORD,DISNUMB
          GOTO      EEDTE100 IF NOT EQUAL
.
          CALL      RPPMIHE6                * read next record
          BRANCH    OVRCD,EEDTE910          * end of file
.
          MOVE      ZERO,ENDOFLST
          GOTO      EEDTE920
.
EEDTE910  MOVE      ONE,ENDOFLST
.
EEDTE920  CALL      NOMORE00      * Show no more records row (if applicable)
EEDTE999  RETURN
+
.------------------------------------------------------------------------------
. HI Service Errors Enquiry tag processing
.------------------------------------------------------------------------------
PIER0000  BRANCH    FLDITMNO,PIER0100,PIER0200,PIER0300,PIER0400,PIER0500:
                             PIER0600,PIER0700,PIER0800,PIER0900,PIER1000:
                             PIER1100,PIER1200,PIER1300,PIER1400,PIER1500:
                             PIER1600,PIER1700,PIER1800,PIER1900,PIER2000:
                             PIER2100,PIER2200,PIER2300,PIER2400,PIER2500:
                             PIER2600,PIER2700
          GOTO      PIEX9999
.
PIER0100  MATCH     SP70,ENSELOPT
          GOTO      PIER9999 IF EQUAL
          WRITE     HTMLFILE;ENSELOPT;      * Enquiry selected option
          GOTO      PIER9999
.
PIER0200  MATCH     SP70,SELREQTP
          GOTO      PIER9999 IF EQUAL
          WRITE     HTMLFILE;SELREQTP;      * Request Type
          GOTO      PIER9999
.
PIER0300  MATCH     SP70,REQTCODE
          GOTO      PIER9999 IF EQUAL
          WRITE     HTMLFILE;REQTCODE;      * Request Code
          GOTO      PIER9999
.
PIER0400  MATCH     SP70,IDENTNUM
          GOTO      PIER9999 IF EQUAL
          WRITE     HTMLFILE;IDENTNUM;      * Identification Number
          GOTO      PIER9999
.
PIER0500  MATCH     SP70,IHIUSERI
          GOTO      PIER9999 IF EQUAL
          WRITE     HTMLFILE;IHIUSERI;      * Request User Id
          GOTO      PIER9999
.
PIER0600  MATCH     SP70,ERRORCOD
          GOTO      PIER9999 IF EQUAL
          WRITE     HTMLFILE;ERRORCOD;      * Error Code
          GOTO      PIER9999
.
PIER0700  MATCH     SP70,DATEPSTT
          GOTO      PIER9999 IF EQUAL
.
          UNPACK    DATEPSTT,CCENT,CYEAR,CMON,CDAY
          MOVE      ZERO,F2
          MOVE      CMON,F2
          LOAD      MTHNAM3,F2,JAN,FEB,MAR,APR,MAY,JUN,JUL,AUG,SEP,OCT,NOV,DEC
          PACK      DISPDATE,CDAY,SP1,MTHNAM3,SP1,CCENT,CYEAR,SP10
          WRITE     HTMLFILE;DISPDATE;
          GOTO      PIER9999
.
PIER0800  MATCH     SP70,DATEPEND
          GOTO      PIER9999 IF EQUAL
.
          UNPACK    DATEPEND,CCENT,CYEAR,CMON,CDAY
          MOVE      ZERO,F2
          MOVE      CMON,F2
          LOAD      MTHNAM3,F2,JAN,FEB,MAR,APR,MAY,JUN,JUL,AUG,SEP,OCT,NOV,DEC
          PACK      DISPDATE,CDAY,SP1,MTHNAM3,SP1,CCENT,CYEAR,SP10
          WRITE     HTMLFILE;DISPDATE;
          GOTO      PIER9999
.
PIER0900  
          GOTO      PIER9999
.
PIER1000  MATCH     SP70,ENSELOPT
          GOTO      PIER9999 IF EQUAL
.
          MATCH     "A",ENSELOPT
          GOTO      PIER9999 IF NOT EQUAL
.
          MOVE      ONE,FILTTYPE
          CALL      ERDAT000           * Errors By Request Type
          GOTO      PIER9999
.
PIER1100  MOVE      ONE,FILTTYPE
          CALL      PREVE000           * Previous button (link)
          GOTO      PIER9999
.
PIER1200  MOVE      ONE,FILTTYPE
          CALL      NEXTE000           * Next button (link)
          GOTO      PIER9999
.
PIER1300  MATCH     SP70,ENSELOPT
          GOTO      PIER9999 IF EQUAL
.
          MATCH     "B",ENSELOPT
          GOTO      PIER9999 IF NOT EQUAL
.
          MOVE      TWO,FILTTYPE
          CALL      ERDAT000           * Errors By Request Code
          GOTO      PIER9999
.
PIER1400  MOVE      TWO,FILTTYPE
          CALL      PREVE000           * Previous button (link)
          GOTO      PIER9999
.
PIER1500  MOVE      TWO,FILTTYPE
          CALL      NEXTE000           * Next button (link)
          GOTO      PIER9999
.
PIER1600  MATCH     SP70,ENSELOPT
          GOTO      PIER9999 IF EQUAL
.
          MATCH     "C",ENSELOPT
          GOTO      PIER9999 IF NOT EQUAL
.
          CALL      ERIDN000           * Errors By Identification Number
          GOTO      PIER9999
.
PIER1700  MOVE      THREE,FILTTYPE
          CALL      PREVE000           * Previous button (link)
          GOTO      PIER9999
.
PIER1800  MOVE      THREE,FILTTYPE
          CALL      NEXTE000           * Next button (link)
          GOTO      PIER9999
.
PIER1900  MATCH     SP70,ENSELOPT
          GOTO      PIER9999 IF EQUAL
.
          MATCH     "D",ENSELOPT
          GOTO      PIER9999 IF NOT EQUAL
.
          MOVE      ZERO,FILTTYPE
          CALL      ERDAT000           * Errors By Date range
          GOTO      PIER9999
.
PIER2000  MOVE      ZERO,FILTTYPE
          CALL      PREVE000           * Previous button (link)
          GOTO      PIER9999
.
PIER2100  MOVE      ZERO,FILTTYPE
          CALL      NEXTE000           * Next button (link)
          GOTO      PIER9999
.
PIER2200  MATCH     SP70,ENSELOPT
          GOTO      PIER9999 IF EQUAL
.
          MATCH     "E",ENSELOPT
          GOTO      PIER9999 IF NOT EQUAL
.
          MOVE      FOUR,FILTTYPE
          CALL      ERDAT000           * Errors By Date range
          GOTO      PIER9999
.
PIER2300  MOVE      FOUR,FILTTYPE
          CALL      PREVE000           * Previous button (link)
          GOTO      PIER9999
.
PIER2400  MOVE      FOUR,FILTTYPE
          CALL      NEXTE000           * Next button (link)
          GOTO      PIER9999
.
PIER2500  MATCH     SP70,ENSELOPT
          GOTO      PIER9999 IF EQUAL
.
          MATCH     "F",ENSELOPT
          GOTO      PIER9999 IF NOT EQUAL
.
          MOVE      FIVE,FILTTYPE
          CALL      ERDAT000           * Errors By Date range
          GOTO      PIER9999
.
PIER2600  MOVE      FIVE,FILTTYPE
          CALL      PREVE000           * Previous button (link)
          GOTO      PIER9999
.
PIER2700  MOVE      FIVE,FILTTYPE
          CALL      NEXTE000           * Next button (link)
          GOTO      PIER9999
.
PIER9999  RETURN
+
.------------------------------------------------------------
. PREVE000 - Link for previous button (Errors - By Date)
.------------------------------------------------------------
PREVE000  MOVE      NORECORD,KEY2
          REP       " +",KEY2
          ASSIGN    STARTNUM-NORECORD,F3
          IF        F3<0
            MOVE      ZERO,F3
          ENDIF
          MOVE      F3,KEY3
          REP       " +",KEY3
          UNPACK    DIM127,D1,FLDPARA,DIM127
          MOVE      REPORTNO,DIM2
          REP       " +",DIM2
.
          WRITE     HTMLFILE;"comweb06.pbl":
                                 "?reportno=",DIM2:
                                 "&template=",FLDPARA:
                                 "&startnum=",KEY3:
                                 "&norecord=",KEY2:
                                 "&enselopt=",ENSELOPT:
                                 "&datepstt=",DATEPSTT:
                                 "&datepend=",DATEPEND;
.
          IF        FILTTYPE = 1
            WRITE     HTMLFILE;"&selreqtp=",SELREQTP;
          ENDIF
.
          IF        FILTTYPE = 2
            WRITE     HTMLFILE;"&reqtcode=",REQTCODE;
          ENDIF
.
          IF        FILTTYPE = 3
            WRITE     HTMLFILE;"&identnum=",IDENTNUM;
          ENDIF
.
          IF        FILTTYPE = 4
            WRITE     HTMLFILE;"&ihiuseri=",IHIUSERI;
          ENDIF
.
          IF        FILTTYPE = 5
            WRITE     HTMLFILE;"&errorcod=",ERRORCOD;
          ENDIF
.
PREVE999  RETURN
+
.------------------------------------------------------------
. NEXTE000 - Link for next button (Errors - By Date)
.------------------------------------------------------------
NEXTE000  MOVE      NORECORD,KEY2
          REP       " +",KEY2
          ASSIGN    STARTNUM+NORECORD,F3
          MOVE      F3,KEY3
          REP       " +",KEY3
          UNPACK    DIM127,D1,FLDPARA,DIM127
          MOVE      REPORTNO,DIM2
          REP       " +",DIM2
.
          WRITE     HTMLFILE;"comweb06.pbl":
                                 "?reportno=",DIM2:
                                 "&template=",FLDPARA:
                                 "&startnum=",KEY3:
                                 "&norecord=",KEY2:
                                 "&enselopt=",ENSELOPT:
                                 "&datepstt=",DATEPSTT:
                                 "&datepend=",DATEPEND;
.
          IF        FILTTYPE = 1
            WRITE     HTMLFILE;"&selreqtp=",SELREQTP;
          ENDIF
.
          IF        FILTTYPE = 2
            WRITE     HTMLFILE;"&reqtcode=",REQTCODE;
          ENDIF
.
          IF        FILTTYPE = 3
            WRITE     HTMLFILE;"&identnum=",IDENTNUM;
          ENDIF
.
          IF        FILTTYPE = 4
            WRITE     HTMLFILE;"&ihiuseri=",IHIUSERI;
          ENDIF
.
          IF        FILTTYPE = 5
            WRITE     HTMLFILE;"&errorcod=",ERRORCOD;
          ENDIF
.
NEXTE999  RETURN
.------------------------------------------------------------------------------
. Output row cells - HI Errors Enquiry
.------------------------------------------------------------------------------
ERRROW00  PACK      KEY10,PMIRRUID,SP70
          CALL      RDWBSE1
          IF        OVRCD=0
            MOVE      WBSENAM,DISPUSER
          ELSE
            MOVE      PMIEUUID,DISPUSER
          ENDIF
.
          PACK      DTTMDIS1,SP70
          MATCH     SP70,PMIRRDAT
          IF        !@EQUAL
            UNPACK    PMIRRDAT,CCENT,CYEAR,CMON,CDAY
            MOVE      CMON,F2
            LOAD      MTHNAM3,F2,JAN,FEB,MAR,APR,MAY,JUN,JUL,AUG,SEP,OCT,NOV,DEC
            PACK      DTTMDIS1,CDAY,SP1,MTHNAM3,SP1,CCENT,CYEAR,SP1,CONSTRAT:
                               PMIRRTIM
          ENDIF
.
          WRITE     HTMLFILE;"<tr>":
                      "<td>&nbsp;",PMIRCODE,"</td>":
                      "<td>&nbsp;",PMIRINUM,"</td>":
                      "<td>&nbsp;&nbsp;",DTTMDIS1,"</td>":
                      "<td>&nbsp;&nbsp;",DISPUSER,"</td>":
                      "<td>&nbsp;&nbsp;",PMIRECOD,"</td>":
                      "<td>&nbsp;&nbsp;",PMIREMES,"</td>":
                      "</tr>";
.

ERRROW99  RETURN
+
.------------------------------------------------------------------------------
. Errors Enquiry - by Date (descending date order)
.------------------------------------------------------------------------------
ERDAT000  MOVE      ONE,ENDOFLST           * Reset end-of-list flag
          MOVE      ZERO,ROWCOUNT
.
          MOVE      ZERO,RECNUMB
          MOVE      ZERO,DISNUMB
.
          PACK      KEY88,DATEPEND,Z70
          CALL      RSPMIER2
ERDAT100  CALL      RPPMIER2                * read next record
          BRANCH    OVRCD,ERDAT910          * end of file
.
          MATCH     DATEPEND,PMIRRDAT
          GOTO      ERDAT110 IF EQUAL       * same as end date; include
          GOTO      ERDAT100 IF NOT LESS    * NOT before end date; get next rec
.
ERDAT110  MATCH     SP70,DATEPSTT
          GOTO      ERDAT111 IF EQUAL
.
          MATCH     DATEPSTT,PMIRRDAT       * before start date?
          GOTO      EEDTE910 IF LESS        * yes; end of list
.
ERDAT111  IF        FILTTYPE=1
            MATCH     SELREQTP,PMIRRTYP     * same Request Type?
            GOTO      ERDAT100 IF NOT EQUAL
          ENDIF
.
          IF        FILTTYPE=2
            MATCH     REQTCODE,PMIRCODE     * same Request Code?
            GOTO      ERDAT100 IF NOT EQUAL
          ENDIF
.
          IF        FILTTYPE=4
            MATCH     IHIUSERI,PMIRRUID     * same User ID?
            GOTO      ERDAT100 IF NOT EQUAL
          ENDIF
.
          IF        FILTTYPE=5
            MATCH     ERRORCOD,PMIRECOD     * same Error Code?
            GOTO      ERDAT100 IF NOT EQUAL
          ENDIF
.
          ADD       ONE,RECNUMB
          IF        STARTNUM>=RECNUMB
            GOTO      ERDAT100
          ENDIF
.
          CALL      ERRROW00                * Output row
.
          ADD       ONE,DISNUMB
          COMPARE   NORECORD,DISNUMB
          GOTO      ERDAT100 IF NOT EQUAL
.
          CALL      RPPMIER2                * read next record
          BRANCH    OVRCD,ERDAT910          * end of file
.
          MOVE      ZERO,ENDOFLST
          GOTO      ERDAT920
.
ERDAT910  MOVE      ONE,ENDOFLST
.
ERDAT920  CALL      NOMORE00      * Show no more records row (if applicable)
ERDAT999  RETURN
+
.------------------------------------------------------------------------------
. Errors Enquiry - by Idenfitication Number (descending date order)
.------------------------------------------------------------------------------
ERIDN000  MOVE      ONE,ENDOFLST           * Reset end-of-list flag
          MOVE      ZERO,ROWCOUNT
.
          MOVE      ZERO,RECNUMB
          MOVE      ZERO,DISNUMB
.
          PACK      KEY88,IDENTNUM,Z70
          CALL      RSPMIER3
ERIDN100  CALL      RPPMIER3                * read next record
          BRANCH    OVRCD,ERIDN910          * end of file
.
          MATCH     IDENTNUM,PMIRINUM
          GOTO      ERIDN910 IF NOT EQUAL
.
          ADD       ONE,RECNUMB
          IF        STARTNUM>=RECNUMB
            GOTO      ERIDN100
          ENDIF
.
          CALL      ERRROW00                * Output row
.
          ADD       ONE,DISNUMB
          COMPARE   NORECORD,DISNUMB
          GOTO      ERIDN100 IF NOT EQUAL
.
          CALL      RPPMIER2                * read next record
          BRANCH    OVRCD,ERIDN910          * end of file
.
          MOVE      ZERO,ENDOFLST
          GOTO      ERIDN920
.
ERIDN910  MOVE      ONE,ENDOFLST
.
ERIDN920  CALL      NOMORE00      * Show no more records row (if applicable)
ERIDN999  RETURN
+
.------------------------------------------------------------------------------
. IHI Enquiry - Remote Scripting
.
.   Parameters:
.     VALDTYPE - Type of validation:
.                  1 -> Validate IHI Number exists
.     VALDCODE - value to validate
.------------------------------------------------------------------------------
REMOTE00  BRANCH    VALDTYPE,REMOTE10,REMOTE20,REMOTE30,REMOTE40,REMOTE50:
                             REMOTE60
          GOTO      REMOTE90
.
REMOTE10  CALL      VALIHI00     * Validate IHI Number exists
          GOTO      REMOTE99
.
REMOTE20
.REMOTE20  CALL      VALMID00     * Validate HI Service messageID exists
          GOTO      REMOTE99
.
REMOTE30  CALL      VALIHE00      * Validate IHI Number exists in Exceptions tbl
          GOTO      REMOTE99
.
REMOTE40  CALL      WRTPOL00      * Write record to DHS Medicare Polling Table
          GOTO      REMOTE99
.
REMOTE50  CALL      GETIHI00      * Gets IHI Number for specified UR (Pat Merge)
          GOTO      REMOTE99
.
REMOTE60  CALL      VALEID00      * Validate ID Number exists in Errors table
          GOTO      REMOTE99
.
REMOTE90  CALL      XMLHED00
          WRITE     HTMLFILE;"<RETURN_VALUE TYPE=ERROR>":
                             "Invalid Validation Type":
                             "</RETURN_VALUE>"
          CALL      XMLEND00
          GOTO      REMOTE99
.
REMOTE99  RETURN
+
.------------------------------------------------------------------------------
. Validate IHI Number exists (IHI Details table)
.------------------------------------------------------------------------------
VALIHI00  CALL      XMLHED00
          BRANCH    EXIT,VALIHI99
.
          MATCH     "0",PTCNUNET
          GOTO      VALIHI91 IF EQUAL
.
          PACK      KEY62,VALDCODE,SP70
          CALL      RSPMIHI3
          CALL      RKPMIHI3
          BRANCH    OVRCD,VALIHI91
.
          MATCH     VALDCODE,PMIHIHIN
          GOTO      VALIHI91 IF NOT EQUAL
.
          WRITE     HTMLFILE;"<RETURN_VALUE TYPE=SIMPLE>":
                              ONE:
                             "</RETURN_VALUE>"
.
          GOTO      VALIHI98
.
VALIHI91  WRITE     HTMLFILE;"<RETURN_VALUE TYPE=ERROR>":
                             "IHI Number not found.":
                             "</RETURN_VALUE>"
          GOTO      VALIHI98
.
VALIHI98  CALL      XMLEND00
VALIHI99  RETURN
+
.------------------------------------------------------------------------------
. Validate HI Service messageID exists (IHI Details table)
.------------------------------------------------------------------------------
VALMID00  CALL      XMLHED00
          BRANCH    EXIT,VALMID99
.
.         PACK      KEY62,VALDCODE,SP70
.         CALL      RSPMIHI3
.         CALL      RKPMIHI3
.         BRANCH    OVRCD,VALMID91
.
.         MATCH     VALDCODE,PMIHIHIN
.         GOTO      VALMID91 IF NOT EQUAL
.
          WRITE     HTMLFILE;"<RETURN_VALUE TYPE=SIMPLE>":
                              ONE:
                             "</RETURN_VALUE>"
.
          GOTO      VALMID98
.
VALMID91  WRITE     HTMLFILE;"<RETURN_VALUE TYPE=ERROR>":
                             "IHI Number not found.":
                             "</RETURN_VALUE>"
          GOTO      VALMID98
.
VALMID98  CALL      XMLEND00
VALMID99  RETURN
+
.------------------------------------------------------------------------------
. Validate IHI Number exists (Exceptions table)
.------------------------------------------------------------------------------
VALIHE00  CALL      XMLHED00
          BRANCH    EXIT,VALIHE99
.
          PACK      KEY72,VALDCODE,SP70
          CALL      RSPMIHE2
          CALL      RKPMIHE2
          BRANCH    OVRCD,VALIHE91
.
          MATCH     VALDCODE,PMIEIHIN
          GOTO      VALIHE91 IF NOT EQUAL
.
          WRITE     HTMLFILE;"<RETURN_VALUE TYPE=SIMPLE>":
                              ONE:
                             "</RETURN_VALUE>"
.
          GOTO      VALIHE98
.
VALIHE91  WRITE     HTMLFILE;"<RETURN_VALUE TYPE=ERROR>":
                             "IHI Number not found.":
                             "</RETURN_VALUE>"
          GOTO      VALIHE98
.
VALIHE98  CALL      XMLEND00
VALIHE99  RETURN
+
.------------------------------------------------------------------------------
. Write a record to the DHS Medicare polling table
.------------------------------------------------------------------------------
WRTPOL00  CALL      XMLHED00
          BRANCH    EXIT,WRTPOL99
.
          MATCH     SP70,VALDCODE
          GOTO      WRTPOL91 IF EQUAL
.
          UNPACK    VALDCODE,KEY2,KEY50,D10    
          PACK      KEY11,USERID,SP70
          CALL      WIPL0000 
.
          WRITE     HTMLFILE;"<RETURN_VALUE TYPE=SIMPLE>":
                              ONE:
                             "</RETURN_VALUE>"
.
          GOTO      WRTPOL98
.
WRTPOL91  WRITE     HTMLFILE;"<RETURN_VALUE TYPE=ERROR>":
                             "Invalid Request Type.":
                             "</RETURN_VALUE>"
          GOTO      WRTPOL98
.
WRTPOL98  CALL      XMLEND00
WRTPOL99  RETURN
+
.------------------------------------------------------------------------------
. Returns a IHI Number for the specified UR
.------------------------------------------------------------------------------
GETIHI00  CALL      XMLHED00
          BRANCH    EXIT,GETIHI99
.
          MATCH     "0",PTCNUNET
          GOTO      GETIHI91 IF EQUAL
.
          MOVE      VALDCODE,DIM8
.
          PACK      KEY62,DIM8,Z70
          CALL      RSPMIHI2
GETIHI10  CALL      RPPMIHI2
          BRANCH    OVRCD,GETIHI91
.
          MATCH     DIM8,PMIHURNO
          GOTO      GETIHI91 IF NOT EQUAL
.
          MATCH     "1",PMIHASTA            * Activated?
          GOTO      GETIHI10 IF NOT EQUAL   * no; get next record
.
          MATCH     "0",PMIHSTAT            * Active IHI?
          GOTO      GETIHI91 IF NOT EQUAL   * No; get next record
.
          WRITE     HTMLFILE;"<RETURN_VALUE TYPE=SIMPLE>":
                             PMIHIHIN:
                             "</RETURN_VALUE>"
          GOTO      GETIHI98
.
GETIHI91  WRITE     HTMLFILE;"<RETURN_VALUE TYPE=SIMPLE>":
                             SP1:
                             "</RETURN_VALUE>"
.
          GOTO      GETIHI98
.
GETIHI98  CALL      XMLEND00
GETIHI99  RETURN
+
.------------------------------------------------------------------------------
. Validate ID Number exists (Errors table)
.------------------------------------------------------------------------------
VALEID00  CALL      XMLHED00
          BRANCH    EXIT,VALEID99
.
          PACK      KEY88,VALDCODE,SP70
          CALL      RSPMIER3
          CALL      RKPMIER3
          BRANCH    OVRCD,VALEID91
.
          MATCH     VALDCODE,PMIRINUM
          GOTO      VALEID91 IF NOT EQUAL
.
          WRITE     HTMLFILE;"<RETURN_VALUE TYPE=SIMPLE>":
                              ONE:
                             "</RETURN_VALUE>"
.
          GOTO      VALEID98
.
VALEID91  WRITE     HTMLFILE;"<RETURN_VALUE TYPE=ERROR>":
                             "Identification Number not found.":
                             "</RETURN_VALUE>"
          GOTO      VALEID98
.
VALEID98  CALL      XMLEND00
VALEID99  RETURN
+
.------------------------------------------------------------------------------
. Exceptions Enquiry - by UR Number (descending date order)
.------------------------------------------------------------------------------
EEURN000  MOVE      ONE,ENDOFLST           * Reset end-of-list flag
          MOVE      ZERO,ROWCOUNT
.
          MOVE      ZERO,RECNUMB
          MOVE      ZERO,DISNUMB
.
          PACK      KEY88,IHIURNUM,Z70
          CALL      RSPMIHE4
EEURN100  CALL      RPPMIHE4                * read next record
          BRANCH    OVRCD,EEURN910          * end of file
.
          MATCH     IHIURNUM,PMIEURNO
          GOTO      EEURN910 IF NOT EQUAL
.
          ADD       ONE,RECNUMB
          IF        STARTNUM>=RECNUMB
            GOTO      EEURN100
          ENDIF
.
          CALL      EENROW00                * Output row
.
          ADD       ONE,DISNUMB
          COMPARE   NORECORD,DISNUMB
          GOTO      EEURN100 IF NOT EQUAL
.
          CALL      RPPMIHE4                * read next record
          BRANCH    OVRCD,EEURN910          * end of file
.
          MOVE      ZERO,ENDOFLST
          GOTO      EEURN920
.
EEURN910  MOVE      ONE,ENDOFLST
.
EEURN920  CALL      NOMORE00      * Show no more records row (if applicable)
EEURN999  RETURN
+
.------------------------------------------------------------
. PREVU000 - Link for previous button (By UR Number)
.------------------------------------------------------------
PREVU000  MOVE      NORECORD,KEY2
          REP       " +",KEY2
          ASSIGN    STARTNUM-NORECORD,F3
          IF        F3<0
            MOVE      ZERO,F3
          ENDIF
          MOVE      F3,KEY3
          REP       " +",KEY3
          UNPACK    DIM127,D1,FLDPARA,DIM127
          MOVE      REPORTNO,DIM2
          REP       " +",DIM2
.
          WRITE     HTMLFILE;"comweb06.pbl":
                                 "?reportno=",DIM2:
                                 "&template=",FLDPARA:
                                 "&startnum=",KEY3:
                                 "&norecord=",KEY2:
                                 "&enselopt=",ENSELOPT:
                                 "&ihiurnum=",IHIURNUM;
.
PREVU999  RETURN
+
.------------------------------------------------------------
. NEXTU000 - Link for next button (By UR Number)
.------------------------------------------------------------
NEXTU000  MOVE      NORECORD,KEY2
          REP       " +",KEY2
          ASSIGN    STARTNUM+NORECORD,F3
          MOVE      F3,KEY3
          REP       " +",KEY3
          UNPACK    DIM127,D1,FLDPARA,DIM127
          MOVE      REPORTNO,DIM2
          REP       " +",DIM2
.
          WRITE     HTMLFILE;"comweb06.pbl":
                                 "?reportno=",DIM2:
                                 "&template=",FLDPARA:
                                 "&startnum=",KEY3:
                                 "&norecord=",KEY2:
                                 "&enselopt=",ENSELOPT:
                                 "&ihiurnum=",IHIURNUM;
.
NEXTU999  RETURN
+
.------------------------------------------------------------------------------
. NIHC MyHR Request Processing
.------------------------------------------------------------------------------
MYHREQ00  MATCH     "3",PTCNUNET
          GOTO      MYHREQ92 IF NOT EQUAL
.
          MATCH     SP70,UPDTTYPE
          GOTO      MYHREQ70 IF EQUAL
          GOTO      MYHREQ70 IF EOS
.
.
          GOTO      MYHREQ90
.
MYHREQ10
          MOVE      ZERO,EXIT
          GOTO      MYHREQ99
.
MYHREQ70  MOVE      URNUMBER,KEY8   * Read Master File
          CALL      RDMAST1
          BRANCH    OVRCD,MYHREQ91
.
          MOVE      PURNO,KEY8
          CALL      RDPMPX21
          IF        OVRCD=1
            CALL      CLPMSPX2
          ENDIF
.
          PACK      KEY68,IREQTYPE,IREQCODE,IREQDATE,IREQTIME,SP70
          CALL      RDPMMHQ1
          BRANCH    OVRCD,MYHREQ93
.
MYHREQ75  CLEAR     WEBTITLE
          MOVE      "NIHC MyHR Request Interface",WEBTITLE
          RESET     WEBTITLE
.
          CALL      WEBHED00   * Create Output File and Write HTML Page Header
          BRANCH    EXIT,MYHREQ99
          CALL      WEBBOD00   * Process Web Body
          CALL      WEBEND00   * Process End of HTML File
.
          MOVE      ONE,EXIT
          GOTO      MYHREQ99
.
MYHREQ90  MOVE      "Invalid Form Action.",WEBTITLE
          CALL      WEBERR00
          MOVE      ONE,EXIT
          GOTO      MYHREQ99
.
MYHREQ91  MOVE      "Can't find patient Master Details.",WEBTITLE
          CALL      WEBERR00
          MOVE      ONE,EXIT
          GOTO      MYHREQ99
.
MYHREQ92  MOVE      "Not Using NIHC Interface.",WEBTITLE
          CALL      WEBERR00
          MOVE      ONE,EXIT
          GOTO      MYHREQ99
.
MYHREQ93  MOVE      "Can't find NIHC Request Details.",WEBTITLE
          CALL      WEBERR00
          MOVE      ONE,EXIT
          GOTO      MYHREQ99
.
MYHREQ99  RETURN
.
.------------------------------------------------------------------------------
. NIHC MyHR Result Processing
.------------------------------------------------------------------------------
MYHRES00  MATCH     "3",PTCNUNET
          GOTO      MYHRES92 IF NOT EQUAL
.
          MATCH     SP70,UPDTTYPE
          GOTO      MYHRES70 IF EQUAL
          GOTO      MYHRES70 IF EOS
.
.
          GOTO      MYHRES90
.
MYHRES10
          MOVE      ZERO,EXIT
          GOTO      MYHRES99
.
MYHRES70  MOVE      URNUMBER,KEY8   * Read Master File
          CALL      RDMAST1
          BRANCH    OVRCD,MYHRES91
.
          MOVE      PURNO,KEY8
          CALL      RDPMPX21
          IF        OVRCD=1
            CALL      CLPMSPX2
          ENDIF
.
          PACK      KEY68,IREQTYPE,IREQCODE,IREQDATE,IREQTIME,SP70
          CALL      RDPMMHR1
          BRANCH    OVRCD,MYHRES93
.
MYHRES75  CLEAR     WEBTITLE
          MOVE      "NIHC MyHR Result Interface",WEBTITLE
          RESET     WEBTITLE
.
          CALL      WEBHED00   * Create Output File and Write HTML Page Header
          BRANCH    EXIT,MYHRES99
          CALL      WEBBOD00   * Process Web Body
          CALL      WEBEND00   * Process End of HTML File
.
          MOVE      ONE,EXIT
          GOTO      MYHRES99
.
MYHRES90  MOVE      "Invalid Form Action.",WEBTITLE
          CALL      WEBERR00
          MOVE      ONE,EXIT
          GOTO      MYHRES99
.
MYHRES91  MOVE      "Can't find patient Master Details.",WEBTITLE
          CALL      WEBERR00
          MOVE      ONE,EXIT
          GOTO      MYHRES99
.
MYHRES92  MOVE      "Not Using NIHC Interface.",WEBTITLE
          CALL      WEBERR00
          MOVE      ONE,EXIT
          GOTO      MYHRES99
.
MYHRES93  MOVE      "Can't find NIHC Result Details.",WEBTITLE
          CALL      WEBERR00
          MOVE      ONE,EXIT
          GOTO      MYHRES99
.
MYHRES99  RETURN
.
.------------------------------------------------------------------------------
. NIHC MyHR Request Details
.------------------------------------------------------------------------------
MYHRQ000  BRANCH    FLDITMNO,MYHRQ010,MYHRQ020,MYHRQ030,MYHRQ040,MYHRQ050:
                             MYHRQ060,MYHRQ070,MYHRQ080,MYHRQ090,MYHRQ100:
                             MYHRQ110,MYHRQ120,MYHRQ130,MYHRQ140,MYHRQ150:
                             MYHRQ160,MYHRQ170,MYHRQ180,MYHRQ190,MYHRQ200:
                             MYHRQ210,MYHRQ220,MYHRQ230,MYHRQ240,MYHRQ250:
                             MYHRQ260,MYHRQ270,MYHRQ280,MYHRQ290
.
          GOTO      MYHRQ999
.
MYHRQ010  WRITE     HTMLFILE;IREQTYPE;
          GOTO      MYHRQ999
.
MYHRQ020  WRITE     HTMLFILE;IREQCODE;
          GOTO      MYHRQ999
.
MYHRQ030  WRITE     HTMLFILE;IREQDATE;
          GOTO      MISF9999
.
MYHRQ040  WRITE     HTMLFILE;IREQTIME;
          GOTO      MYHRQ999
.
MYHRQ050  WRITE     HTMLFILE;PMMQRTYP;
          GOTO      MISF9999
.
MYHRQ060  WRITE     HTMLFILE;PMMQCODE;
          GOTO      MYHRQ999
.
MYHRQ070  UNPACK    DIM127,D1,KEY1,DIM127
          MOVE      ZERO,F1
          MOVE      KEY1,F1
          BRANCH    F1,MYHRQ071
.
          WRITE     HTMLFILE;PMMQRDAT;
          GOTO      MYHRQ999
.
MYHRQ071  PACK      DISPDATE,SP70
          MATCH     SP70,PMMQRDAT
          IF        !@EQUAL
            UNPACK    PMMQRDAT,CCENT,CYEAR,CMON,CDAY
            MOVE      CMON,F2
            LOAD      MTHNAM3,F2,JAN,FEB,MAR,APR,MAY,JUN,JUL,AUG,SEP,OCT,NOV,DEC
            PACK      DISPDATE,CDAY,SP1,MTHNAM3,SP1,CCENT,CYEAR
          ENDIF
          WRITE     HTMLFILE;DISPDATE;
          GOTO      MYHRQ999
.
MYHRQ080  WRITE     HTMLFILE;PMMQRTIM;
          GOTO      MYHRQ999
.
MYHRQ090  UNPACK    DIM127,D1,KEY1,DIM127
          MOVE      ZERO,F1
          MOVE      KEY1,F1
          BRANCH    F1,MYHRQ091
.
          WRITE     HTMLFILE;PMMQRUID;
          GOTO      MYHRQ999
.
MYHRQ091  PACK      REQUSRNM,SP70
          MATCH     SP70,PMMQRUID
          IF        !@EQUAL
            PACK      KEY10,PMMQRUID,SP70
            CALL      RDWBSE1
            IF        OVRCD=0
              MOVE      WBSENAM,REQUSRNM
            ELSE
              MOVE      PMMQRUID,REQUSRNM
            ENDIF
          ENDIF
          WRITE     HTMLFILE;REQUSRNM;
          GOTO      MYHRQ999
. 
MYHRQ100  WRITE     HTMLFILE;PMMQHOSP;
          GOTO      MYHRQ999
.
MYHRQ110  WRITE     HTMLFILE;PMMQEPID;
          GOTO      MYHRQ999
.
MYHRQ120  UNPACK    DIM127,D1,KEY1,DIM127
          MOVE      ZERO,F1
          MOVE      KEY1,F1
          BRANCH    F1,MYHRQ121
.
          WRITE     HTMLFILE;PMMQADAT;
          GOTO      MYHRQ999
.
MYHRQ121  PACK      DISPDATE,SP70
          MATCH     SP70,PMMQADAT
          IF        !@EQUAL
            UNPACK    PMMQADAT,CCENT,CYEAR,CMON,CDAY
            MOVE      CMON,F2
            LOAD      MTHNAM3,F2,JAN,FEB,MAR,APR,MAY,JUN,JUL,AUG,SEP,OCT,NOV,DEC
            PACK      DISPDATE,CDAY,SP1,MTHNAM3,SP1,CCENT,CYEAR
          ENDIF
          WRITE     HTMLFILE;DISPDATE;
          GOTO      MYHRQ999
.
MYHRQ130  WRITE     HTMLFILE;PMMQREAS
          GOTO      MYHRQ999
.
MYHRQ140  WRITE     HTMLFILE;PMMQETYP;
          GOTO      MYHRQ999
.
MYHRQ150  WRITE     HTMLFILE;PMMQELCY;
          GOTO      MYHRQ999
.
MYHRQ160  WRITE     HTMLFILE;PMMQCONS;
          GOTO      MYHRQ999
.
MYHRQ170  WRITE     HTMLFILE;PMMQAUTH;
          GOTO      MYHRQ999
.
MYHRQ180  WRITE     HTMLFILE;PMMQRHCP;
          GOTO      MYHRQ999
.
MYHRQ190  WRITE     HTMLFILE;PMMQB64P;
          GOTO      MYHRQ999
.
MYHRQ200  WRITE     HTMLFILE;PMMQMIME;
          GOTO      MYHRQ999
.
MYHRQ210  WRITE     HTMLFILE;PMMQFLNM;
          GOTO      MYHRQ999
.
MYHRQ220  WRITE     HTMLFILE;PMMQSUBJ;
          GOTO      MYHRQ999
.
MYHRQ230  WRITE     HTMLFILE;PMMQURNO;
          GOTO      MYHRQ999
.
MYHRQ240  UNPACK    DIM127,D1,KEY1,DIM127
          MOVE      ZERO,F1
          MOVE      KEY1,F1
          BRANCH    F1,MYHRQ241
.
          WRITE     HTMLFILE;PMMQCDAT;
          GOTO      MYHRQ999
.
MYHRQ241  PACK      DISPDATE,SP70
          MATCH     SP70,PMMQCDAT
          IF        !@EQUAL
            UNPACK    PMMQCDAT,CCENT,CYEAR,CMON,CDAY
            MOVE      CMON,F2
            LOAD      MTHNAM3,F2,JAN,FEB,MAR,APR,MAY,JUN,JUL,AUG,SEP,OCT,NOV,DEC
            PACK      DISPDATE,CDAY,SP1,MTHNAM3,SP1,CCENT,CYEAR
          ENDIF
          WRITE     HTMLFILE;DISPDATE;
          GOTO      MYHRQ999
.
MYHRQ250  WRITE     HTMLFILE;PMMQCTIM;
          GOTO      MYHRQ999
.
MYHRQ260  PACK      REQUSRNM,SP70
          MATCH     SP70,PMMQCUID
          IF        !@EQUAL
            PACK      KEY10,PMMQCUID,SP70
            CALL      RDWBSE1
            IF        OVRCD=0
              MOVE      WBSENAM,REQUSRNM
            ELSE
              MOVE      PMMQCUID,REQUSRNM
            ENDIF
          ENDIF
          WRITE     HTMLFILE;REQUSRNM;
          GOTO      MYHRQ999
.
MYHRQ270  UNPACK    DIM127,D1,KEY1,DIM127
          MOVE      ZERO,F1
          MOVE      KEY1,F1
          BRANCH    F1,MYHRQ271
.
          WRITE     HTMLFILE;PMMQUDAT;
          GOTO      MYHRQ999
.
MYHRQ271  PACK      DISPDATE,SP70
          MATCH     SP70,PMMQUDAT
          IF        !@EQUAL
            UNPACK    PMMQUDAT,CCENT,CYEAR,CMON,CDAY
            MOVE      CMON,F2
            LOAD      MTHNAM3,F2,JAN,FEB,MAR,APR,MAY,JUN,JUL,AUG,SEP,OCT,NOV,DEC
            PACK      DISPDATE,CDAY,SP1,MTHNAM3,SP1,CCENT,CYEAR
          ENDIF
          WRITE     HTMLFILE;DISPDATE;
          GOTO      MYHRQ999
.
MYHRQ280  WRITE     HTMLFILE;PMMQUTIM;
          GOTO      MYHRQ999
.
MYHRQ290  PACK      REQUSRNM,SP70
          MATCH     SP70,PMMQUUID
          IF        !@EQUAL
            PACK      KEY10,PMMQUUID,SP70
            CALL      RDWBSE1
            IF        OVRCD=0
              MOVE      WBSENAM,REQUSRNM
            ELSE
              MOVE      PMMQUUID,REQUSRNM
            ENDIF
          ENDIF
          WRITE     HTMLFILE;REQUSRNM;
          GOTO      MYHRQ999
.
MYHRQ999  RETURN
.
.------------------------------------------------------------------------------
. NIHC MyHR Result Details
.------------------------------------------------------------------------------
MYHRS000  BRANCH    FLDITMNO,MYHRS010,MYHRS020,MYHRS030,MYHRS040,MYHRS050:
                             MYHRS060,MYHRS070,MYHRS080,MYHRS090,MYHRS100:
                             MYHRS110,MYHRS120,MYHRS130,MYHRS140,MYHRS150:
                             MYHRS160,MYHRS170,MYHRS180,MYHRS190,MYHRS200:
                             MYHRS210,MYHRS220,MYHRS230,MYHRS240,MYHRS250:
                             MYHRS260,MYHRS270,MYHRS280,MYHRS290,MYHRS300:
                             MYHRS310,MYHRS320,MYHRS330,MYHRS340,MYHRS350:
                             MYHRS360,MYHRS370
.
          GOTO      MYHRS999
.
MYHRS010  WRITE     HTMLFILE;IREQTYPE;
          GOTO      MYHRS999
.
MYHRS020  WRITE     HTMLFILE;IREQCODE;
          GOTO      MYHRS999
.
MYHRS030  WRITE     HTMLFILE;IREQDATE;
          GOTO      MISF9999
.
MYHRS040  WRITE     HTMLFILE;IREQTIME;
          GOTO      MYHRS999
.
MYHRS050  WRITE     HTMLFILE;PMMJRTYP;
          GOTO      MISF9999
.
MYHRS060  WRITE     HTMLFILE;PMMJCODE;
          GOTO      MYHRS999
.
MYHRS070  UNPACK    DIM127,D1,KEY1,DIM127
          MOVE      ZERO,F1
          MOVE      KEY1,F1
          BRANCH    F1,MYHRS071
.
          WRITE     HTMLFILE;PMMJRDAT;
          GOTO      MYHRS999
.
MYHRS071  PACK      DISPDATE,SP70
          MATCH     SP70,PMMJRDAT
          IF        !@EQUAL
            UNPACK    PMMJRDAT,CCENT,CYEAR,CMON,CDAY
            MOVE      CMON,F2
            LOAD      MTHNAM3,F2,JAN,FEB,MAR,APR,MAY,JUN,JUL,AUG,SEP,OCT,NOV,DEC
            PACK      DISPDATE,CDAY,SP1,MTHNAM3,SP1,CCENT,CYEAR
          ENDIF
          WRITE     HTMLFILE;DISPDATE;
          GOTO      MYHRS999
.
MYHRS080  WRITE     HTMLFILE;PMMJRTIM;
          GOTO      MYHRS999
.
MYHRS090  WRITE     HTMLFILE;PMMJERRM;
          GOTO      MYHRS999
.
MYHRS100  WRITE     HTMLFILE;PMMJRCOD;
          GOTO      MYHRS999
.
MYHRS110  WRITE     HTMLFILE;PMMJRDSC;
          GOTO      MYHRS999
.
MYHRS120  WRITE     HTMLFILE;PMMJRDET;
          GOTO      MYHRS999
.
MYHRS130  WRITE     HTMLFILE;PMMJSTAT;
          GOTO      MYHRS999
.
MYHRS140  WRITE     HTMLFILE;PMMJHOSP;
          GOTO      MYHRS999
.
MYHRS150  WRITE     HTMLFILE;PMMJHOSC;
          GOTO      MYHRS999
.
MYHRS160  WRITE     HTMLFILE;PMMJPAID;
          GOTO      MYHRS999
.
MYHRS170  WRITE     HTMLFILE;PMMJPSID;
          GOTO      MYHRS999
.
MYHRS180  WRITE     HTMLFILE;PMMJSEID;
          GOTO      MYHRS999
.
MYHRS190  UNPACK    DIM127,D1,KEY1,DIM127
          MOVE      ZERO,F1
          MOVE      KEY1,F1
          BRANCH    F1,MYHRS191
.
          WRITE     HTMLFILE;PMMJADAT;
          GOTO      MYHRS999
.
MYHRS191  PACK      DISPDATE,SP70
          MATCH     SP70,PMMJADAT
          IF        !@EQUAL
            UNPACK    PMMJADAT,CCENT,CYEAR,CMON,CDAY
            MOVE      CMON,F2
            LOAD      MTHNAM3,F2,JAN,FEB,MAR,APR,MAY,JUN,JUL,AUG,SEP,OCT,NOV,DEC
            PACK      DISPDATE,CDAY,SP1,MTHNAM3,SP1,CCENT,CYEAR
          ENDIF
          WRITE     HTMLFILE;DISPDATE;
          GOTO      MYHRS999
.
MYHRS200  WRITE     HTMLFILE;PMMJARES;
          GOTO      MYHRS999
.
MYHRS210  UNPACK    DIM127,D1,KEY1,DIM127
          MOVE      ZERO,F1
          MOVE      KEY1,F1
          BRANCH    F1,MYHRS211
.
          WRITE     HTMLFILE;PMMJDDAT;
          GOTO      MYHRS999
.
MYHRS211  PACK      DISPDATE,SP70
          MATCH     SP70,PMMJDDAT
          IF        !@EQUAL
            UNPACK    PMMJDDAT,CCENT,CYEAR,CMON,CDAY
            MOVE      CMON,F2
            LOAD      MTHNAM3,F2,JAN,FEB,MAR,APR,MAY,JUN,JUL,AUG,SEP,OCT,NOV,DEC
            PACK      DISPDATE,CDAY,SP1,MTHNAM3,SP1,CCENT,CYEAR
          ENDIF
          WRITE     HTMLFILE;DISPDATE;
          GOTO      MYHRS999
.
MYHRS220  WRITE     HTMLFILE;PMMJRHCP;
          GOTO      MYHRS999
.
MYHRS230  WRITE     HTMLFILE;PMMJAUTH;
          GOTO      MYHRS999
.
MYHRS240  WRITE     HTMLFILE;PMMJETYP;
          GOTO      MYHRS999
.
MYHRS250  WRITE     HTMLFILE;PMMJELCI;
          GOTO      MYHRS999
.
MYHRS260  WRITE     HTMLFILE;PMMJCONW;
          GOTO      MYHRS999
.
MYHRS270  WRITE     HTMLFILE;PMMJWARD;
          GOTO      MYHRS999
.
MYHRS280  WRITE     HTMLFILE;PMMJROOM;
          GOTO      MYHRS999
.
MYHRS290  WRITE     HTMLFILE;PMMJABED;
          GOTO      MYHRS999
.
MYHRS300  UNPACK    DIM127,D1,KEY1,DIM127
          MOVE      ZERO,F1
          MOVE      KEY1,F1
          BRANCH    F1,MYHRS301
.
          WRITE     HTMLFILE;PMMJEDTC;
          GOTO      MYHRS999
.
MYHRS301  PACK      DISPDATE,SP70
          MATCH     SP70,PMMJEDTC
          IF        !@EQUAL
            UNPACK    PMMJEDTC,CCENT,CYEAR,CMON,CDAY
            MOVE      CMON,F2
            LOAD      MTHNAM3,F2,JAN,FEB,MAR,APR,MAY,JUN,JUL,AUG,SEP,OCT,NOV,DEC
            PACK      DISPDATE,CDAY,SP1,MTHNAM3,SP1,CCENT,CYEAR
          ENDIF
          WRITE     HTMLFILE;DISPDATE;
          GOTO      MYHRS999
.
MYHRS310  UNPACK    DIM127,D1,KEY1,DIM127
          MOVE      ZERO,F1
          MOVE      KEY1,F1
          BRANCH    F1,MYHRS311
.
          WRITE     HTMLFILE;PMMJEDTM;
          GOTO      MYHRS999
.
MYHRS311  PACK      DISPDATE,SP70
          MATCH     SP70,PMMJEDTM
          IF        !@EQUAL
            UNPACK    PMMJEDTM,CCENT,CYEAR,CMON,CDAY
            MOVE      CMON,F2
            LOAD      MTHNAM3,F2,JAN,FEB,MAR,APR,MAY,JUN,JUL,AUG,SEP,OCT,NOV,DEC
            PACK      DISPDATE,CDAY,SP1,MTHNAM3,SP1,CCENT,CYEAR
          ENDIF
          WRITE     HTMLFILE;DISPDATE;
          GOTO      MYHRS999
.
MYHRS320  UNPACK    DIM127,D1,KEY1,DIM127
          MOVE      ZERO,F1
          MOVE      KEY1,F1
          BRANCH    F1,MYHRS321
.
          WRITE     HTMLFILE;PMMJCDAT;
          GOTO      MYHRS999
.
MYHRS321  PACK      DISPDATE,SP70
          MATCH     SP70,PMMJCDAT
          IF        !@EQUAL
            UNPACK    PMMJCDAT,CCENT,CYEAR,CMON,CDAY
            MOVE      CMON,F2
            LOAD      MTHNAM3,F2,JAN,FEB,MAR,APR,MAY,JUN,JUL,AUG,SEP,OCT,NOV,DEC
            PACK      DISPDATE,CDAY,SP1,MTHNAM3,SP1,CCENT,CYEAR
          ENDIF
          WRITE     HTMLFILE;DISPDATE;
          GOTO      MYHRS999
.
MYHRS330  WRITE     HTMLFILE;PMMJCTIM;
          GOTO      MYHRS999
.UPTOHERE
MYHRS340  PACK      REQUSRNM,SP70
          MATCH     SP70,PMMJCUID
          IF        !@EQUAL
            PACK      KEY10,PMMJCUID,SP70
            CALL      RDWBSE1
            IF        OVRCD=0
              MOVE      WBSENAM,REQUSRNM
            ELSE
              MOVE      PMMJCUID,REQUSRNM
            ENDIF
          ENDIF
          WRITE     HTMLFILE;REQUSRNM;
          GOTO      MYHRQ999
.
MYHRS350  UNPACK    DIM127,D1,KEY1,DIM127
          MOVE      ZERO,F1
          MOVE      KEY1,F1
          BRANCH    F1,MYHRS351
.
          WRITE     HTMLFILE;PMMJUDAT;
          GOTO      MYHRS999
.
MYHRS351  PACK      DISPDATE,SP70
          MATCH     SP70,PMMJUDAT
          IF        !@EQUAL
            UNPACK    PMMJUDAT,CCENT,CYEAR,CMON,CDAY
            MOVE      CMON,F2
            LOAD      MTHNAM3,F2,JAN,FEB,MAR,APR,MAY,JUN,JUL,AUG,SEP,OCT,NOV,DEC
            PACK      DISPDATE,CDAY,SP1,MTHNAM3,SP1,CCENT,CYEAR
          ENDIF
          WRITE     HTMLFILE;DISPDATE;
          GOTO      MYHRS999
.
MYHRS360  WRITE     HTMLFILE;PMMJUTIM;
          GOTO      MYHRS999
.
MYHRS370  PACK      REQUSRNM,SP70
          MATCH     SP70,PMMJUUID
          IF        !@EQUAL
            PACK      KEY10,PMMJUUID,SP70
            CALL      RDWBSE1
            IF        OVRCD=0
              MOVE      WBSENAM,REQUSRNM
            ELSE
              MOVE      PMMJUUID,REQUSRNM
            ENDIF
          ENDIF
          WRITE     HTMLFILE;REQUSRNM;
          GOTO      MYHRQ999
.
MYHRS999  RETURN
+
.------------------------------------------------------------------------------
.
          INC       IBAWEBCD
          INC       WEBDATCD
.
          INC       PATDO1IO/INC   * Doctor File
          INC       PATHSPIO/INC
          INC       PATMI1IO/INC
          INC       PATMA1IO/INC
          INC       PATVISIO/INC   * Patients Visits File
          INC       PMSVX1IO/INC   * Visit Extension File
          INC       PATALRIO/INC
          INC       OUTSITIO/INC
          INC       PMSUCHIO/INC
          INC       PMSUCDIO/INC
          INC       PMSIPLIO/INC
          INC       PATPR1IO/INC
          INC       PMSPX2IO/INC
          INC       PATFN1IO/INC
          INC       PATWR1IO/INC
          INC       MRTMASIO/INC
          INC       NHIMASIO/INC
          INC       NHIETHIO/INC
          INC       PATRE1IO/INC
          INC       PATDGWIO/INC
          INC       VISMDTIO/INC
          INC       VISMTXIO/INC
          INC       PATITMIO/INC
          INC       PATDADIO/INC
          INC       PATVADIO/INC
          INC       PATCMCIO/INC
          INC       PATASFIO/INC
          INC       PMSHCGIO/INC
          INC       PMSHCPIO/INC
          INC       PMSCCDIO/INC            * Concession Card Details
          INC       APSMASIO/INC
          INC       PATIN1IO/INC
          INC       PATDSCIO/INC
.
          INC       PMSIERIO/INC            * HI Error Messages
          INC       PMSIHIIO/INC            * IHI Info
          INC       PMSIHEIO/INC            * IHI Exceptions
          INC       PMSNPLIO/INC            
          INC       PMSIRQIO/INC            
          INC       PMSMHQIO/INC
          INC       PMSIRSIO/INC            
          INC       PMSMHRIO/INC
          INC       PMSNDBIO/INC            
.
          INC       CALCAGE
          INC       CLNHIMAS                * Clear nhimasaf file variables
          INC       CLPATMIS                * Clear admission file variables
          INC       CLPMSPX2
          INC       CLPMSNPL
          INC       CLPMSIRQ
          INC       CLPMSMHQ
          INC       CLPMSIRS
          INC       CLPMSMHR
.
          INC       PATMASTM
          INC       PATDOCTM
          INC       PMSHCGTM
          INC       PMSHCPTM
          INC       PMSPX2TM
          INC       PATMSXTM
          INC       PATMISTM
          INC       PATDOCCD
          INC       PMSIPLCD
          INC       NAMSTRCD
          INC       DAYOFWEK

