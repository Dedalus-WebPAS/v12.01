.----------------------------------------------------------------------
. Program       : PATWEB77
.
. Function      : General Table Maintenance
.
. Modifications :
.----------------------------------------------------------------------
. V12.00.01 23/09/2025  J.Tan         TSK 0966921
.           Mod to create permanent tempfile for NZ Invoice/Revenue breakdown
. V11.05.03 27/03/2022 Alina Bhari    Task 0957676 
.           Added flag when Previous record with a prior Effective Start Date
.           FLAGLEFD
. V11.05.02 25/02/2025  Don Nguyen    TSK 0952080
.           Recompiled for PATMKIPR
. V11.05.01 20/01/2025  Alina Bhari   TSK 0947787
.           Display all miscellaneous charges in desc/Asc order based
.           on Effective Date (viewtype=1/0) -VIEWTYPE,MCHG4100,MISCDA00,
.           MISCDD00,MISCDR00,DISKEY21,SHOWTYPE,DISKEY29
.           Displayed the latest record for each miscellaneous item-MISCDD05
.           Displayed only current miscellaneous records -MISCDD10
.           Recompiled for NZPMCHTM
. V11.04.03 27/06/2024  Thanh T       TSK 0947684
.           Recompiled for NZPTFETM changes
. V11.04.02 25/06/2024  Thanh T       TSK 0947684
.           Added PMSHCGTD. Recompiled for NZPTFETM, NZPTFETM changes           
. V11.04.01 01/02/2024  Nikitha B     TSK 0942484
.           Added Casemix Type(CASETYPE) filter at CASFTB05 to display
.           Casemix Theatre Fee Maintenance records.
. V11.03.06 04/10/2023  J.Tan         TSK 0936839
.           Added LOOPCNTR to Billing default (BDTB0000)
. V11.03.05 30/08/2023  Bella Turco   TSK 0935278
.           Added PTCNNRTD to Table of Misc Charges MCHGTB00                 
. V11.03.04 24/08/2023  J.Tan         TSK 0936839
.           Mod Billing default to reposition key (BDTB0000)
. V11.03.03 10/01/2023  Bella Turco   TSK 0921957
.           Continued adding PTCNNRTD & NOMORE00 to maintenance lists
. V11.03.02 14/12/2022  Bella Turco    TSK 0921957
.           Added NOMORE00 - Display "No more records" at end of list
.           Added PTCNNRTD - Displays number of rows set by parameter value
. V11.03.01 30/11/2022  Thanh T       TSK 0909503
.           Added GDESC000 to get and update charge code description of
.           User Group Favourite Charge Items pmsufiaf table   
. V11.02.04 24/08/2022  Thanh T       TSK 0908346
.           Added MAIN3100, HSEL1000, CTDM0000, CTCD0000 for Claim
.           type clinical document mapping maintenance 
. V11.02.03 08.09.2022  DA Sarkies    TSK 0909756
.           Changed column sizes of Fav Items Table, and increases size of
.           variables holding description
. V11.02.02 24/08/2022  Thanh T       TSK 0908346
.           Added MAIN3100, HSEL1000, CTDM0000, CTCD0000 for Claim
.           type clinical document mapping maintenance 
. V11.02.01 16/03/2022  Thanh T       TSK 0909503
.           Clear Charge Code Description (PMUFDESC) from pmsufiaf
. V11.01.01 28/04/2021 Ebon Clements  TSK 0899124
.           Fixed spelling of quantitly - FGLSHD00
. V11.00.05 13/01/2021 Tracey Nguyen  TSK 0888079
.           1)Added heading routine BDTBHD00 
.           2)Added multi hosp functionality - BDTRW000  
.           3)Recompiled for PATBDETM
. V11.00.04 27/11/2020 Tracey Nguyen  TSK 0888079
.           Added NOBDEAX1 for TRAP IO on patbdeaf file
. V11.00.03 13/10/2020 Tracey Nguyen  TSK 0888079
.           Added reportno=20 for Billing Defaults Maintenance
.           - MAIN3000,BDEF0000,PATBDEFD/IO/TD/TM
. V11.00.02 22/05/2020 Peter Vela     TSK 0871644
.           Fixed default group functionality in UPDFTG00
.           Added Default Group validation to REMOTS00
. V11.00.01 15/05/2020 J.Tan          TSK 0890767
.           Rcompiled for NZPMCHTM - Misc.desc for Pack item
. V10.15.04 14/02/2020  Tracey Nguyen     TSK 0888054
.           Populated date/time/userid fields in add/update nzpcfnaf 
.           - NZPCFN10, NZPCFN15, NZPCFN20, NZPCFN25 
. V10.15.03 07/02/2020  Peter Vela        TSK 0871644
.           Recompiled for PMSUFIFD
. V10.15.02 30/01/2020  Thanh T           TSK 0871644
.           Added MAIN2900 for User Group Favourite Charge Items Maintenance
. V10.15.01 07/01/2020  Thanh T           TSK 0871644
.           Added MAIN2900 for User Group Favourite Charge Items Maintenance
. V10.14.01 05/03/2017  J.Tan             TSK 0870796
.           Added LOOPCNTR to CASFTB00 (Casemix theatre fee)
. V10.11.01 20/07/2017  Peter Vela        TSK 0835226
.           Added Eclipse Type of Service Code
. V10.10.02 19/06/2017  Ebon Clements     TSK 0839907
.           Added keep alive to casemix funding search - CASMTB00
. V10.10.01 17/03/2017  J.Tan             TSK 0315207
.           Added Target LOS to Casemix funding
. V10.09.01 04/01/2017  Steve Armstrong   TSK 0315207
.           Added new variables (PTCMTRPT & PTCMTLOS) to CLRCAS00
.----------------------------------------------------------------------
. V10.08.01 10/07/2016  J.Tan         TSK 0822042
.           Fixed Johns Hopkins Bed fees
.----------------------------------------------------------------------
. V10.06.01 09/04/2015  Ania P         CAR 261630
.           Removed use of temp file name
.----------------------------------------------------------------------
. V10.04.05 17/05/2014 J.Tan  CAR 300260
.           Recompiled for NZPMCHVL - checking previous rec after Inactive Item
. V10.04.04 23/04/2014 J.Tan  CAR 300260
.           Fixed checking overlap NZ Private Misc.items
. V10.04.03 02/04/2014 J.Tan  CAR 299227
.           Mods to set Effective todate of previous record for NZ Misc.item
. V10.04.02 31.03.2014  B.G.Ackland  CAR 299363
.           Replace META Tag Redirect with Javascript in Common RDIREC00
.           Routine
. V10.04.01 05/02/2014  J.Tan          CAR 296620
.           Mods Casemix funding List (CASMTB00) to use index 2 for Contract ID
.----------------------------------------------------------------------
. V10.03.07 11/10/2013  Don Nguyen     CAR 287376
.           Recompiled for NZPMCHTM - Replaced " with ' for all instances of 
.           NZMCDESC.
. V10.03.06 24/09/2013  Don Nguyen     CAR 287376
.           Recompiled for NZPMCHTM - convert double quotes to single quotes
. V10.03.05 13/05/2013  J.Tan          CAR 282824
.           Added Transfer Trim Point to Casemix funding
. V10.03.04 28/05/2012  J.Tan          CAR 244246
.           Added Eclipse Equivalent and Type
. V10.03.03 18/05/2012  J.Tan          CAR 263195
.           Fixed searching for theatre fees
. V10.03.02 09/03/2012 J.Tan           CAR 259879
.           Added Active/Inactive and Effective to date to NZ Misc.Charge
. V10.03.01 01/02/2012 J.Tan           CAR 257597
.           Fixed initialising Doctor specific field for NZP Contract Funding
. V10.02.03 09/10/2011  J.Tan          CAR 252728
.           Fixed searching for bed fees for blank HF
. V10.02.02 08/04/2011  J.Tan          CAR 233034
.           Fixed searching for bed fees display
. V10.02.01 29/03/2011  Peter Vela     CAR 203048
.           Moved JHSTFEA1 into CFEETYP=9 validation
. V10.01.10 23/02/2011  Peter Vela     CAR 233034
.           Removed new bed fee file (newbfeef)
. V10.01.09 21/02/2011  Ebon Clements  CAR 233160
.           Added effective from and to date validation to misc charges
. V10.01.08 17/02/2011  Peter Vela     CAR 233034
.           Added BDFEE016 Display only empty contract ids Bed Fee Mapping Maintenance.
. V10.01.07 15/02/2011  Ebon Clements  CAR 233048
.           Removed old/new file functionality from casemix theatre fees
. V10.01.06 04/02/2011  Ebon Clements  CAR 233928
.           Added audit of deleted billing contract records
. V10.01.05 02/02/2011  Mike Laming    CAR 233046
.           Removed old/new file for Misc. Charge file (PATMC1.. & PATMC2..)
. V10.01.04 28/01/2011  Peter Vela     CAR 233048
.           Added Contract ID to Theatre Fee Maintenance
.           25/01/2011  Ebon Clements  CAR 233050
.           Removed old/new file and effective dates from casemix funding
.           12/01/2011  Peter Vela     CAR 233034
.           Added Contract ID to Bed Fee Maintenance
. V10.01.03 15/12/2010  Peter Vela     CAR 233048
.           Added Theatre Fee Mapping Table Functionality
. V10.01.02 06/12/2010  Peter Vela     CAR 233034
.           Added Bed Fee Mapping Table functionality
. V10.01.01 29/11/2010  Mike Laming    CAR 233046
.           Mods to use "H/F Table Type" PTMCHFTT (replacing H/F Table)
. V10.00.05 19/10/2010  J.Tan          CAR 229299
.           Added Delete option to All Current Billing files
. V10.00.04 12/10/2010  J.Tan          CAR 231376
.           Recompiled for Bed fees update
. V10.00.03 30/08/2010  J.Tan          CAR 229168
.           Mods for Contract ID generation
. V10.00.02 21/05/2010  J.Tan             CAR 220995
.           Mods for Bed fee,theatre fees & misc.charge enq.& bill.fees update
. V10.00.01 30/04/2010  J.Tan             CAR 220887
.           Mods checking for Active/Inactive of Misc.charge
. V9.12.02  07/09/2009  J.Tan             CAR 205303
.           Added Contract ID
. ........  07/09/2009  Mike Laming       CAR 193373
.           Change MCGDL000 (Misc.Charges Global Deletion) to add Effective date
. V9.12.01  28/08/2009  Mike Laming       CAR 204388
.           Fixed "GOTO STFGU100" to "GOTO STFGD100" at STFGD000
. V9.11.05  05/01/2009  J.Tan             CAR 188607
.           Recompiled for NZPMCHTM - Desc.for Exploding misc.items
. V9.11.04  15/01/2009  J.Tan             CAR 187277
.           Recompile for PATMC1IO - new fields for Eclipse
. V9.11.03  05/01/2009  J.Tan             CAR 186453
.           Recompiled for NZPMCHTM - Desc.for Exploding misc.items
. V9.11.02  30/12/2008  J.Tan             CAR 185945
.           Recompiled for NZPMCHTM - redirect for misc.items
. V9.11.01  24/11/2008  Ebon Clements     CAR 183976            
.           Added eclipse feilds to misc charges file
. V9.09.05  29/01/2008  Peter Vela        CAR 155334            
.           Added post and display functionality for PATMCPRTR (MSCHG030)
. V9.09.04  10/07/2007  Steve Armstrong   CAR 144789
.           Recompiled for changes to PATMC1IO.
. V9.09.03  29/06/2007 J.Tan
.           Mods to set spoolfile for Update bedfee function
. V9.09.02  21/06/2007 J.Tan         
.           Removed Process/Fromdate from Global Update Bed fees function
. V9.09.01  12/06/2007  Ebon Clements CAR 141984
.           Recompiled for NZPCFNTM - next and prev tags
. V9.08.22  08/05/2007  Mike Laming  CAR 137125 HDP 2007 DRG 5.2
.           Mods to PATDGWFD - Add field PTDWDRGV (add to Keys)
. V9.08.21  09/03/2007 Neelkamal Pyla CAR 134906
.           Mods to NZPCFN10 - changed read routine to read records from New
.           Contract Funding file, NZPCFN30 - Changed key to delete records
. V9.08.20  15/02/2007 Ebon Clements CAR 130831  
.           Recompiled for NZPTFETM.INC - theatre fee filters             
. V9.08.19  14/02/2007 Ebon Clements CAR 119999  
.           Added Hosp, claim code  and contract to contract funding list
. V9.08.18  19/01/2007 Jill Habasque             
.           Mods to update NZCFDOCS
. V9.08.17  17/01/2007 Ebon Clements CAR 130831
.           Recompiled for NZPTFETM - Theatre fee list
. V9.08.16  17/01/2007 Jill Habasque CAR 130962
.           Fixed packing of copy to date (instead of yycc)
. V9.08.15  12/01/2007 Jill Habasque CAR 129178
.           Recompiled for NZPMCHTM - multiply price by quantity in CALTOT00
. V9.08.14  11/01/2007 Ebon Clements CAR 129231
.           Fixed clear of NZCFSPRI in contract funding maintenance
. V9.08.13  03/01/2007 Jill Habasque CAR 129247
.           Changed to only used NZPFPPOR for rev and inv breakdown totals
. V9.08.12  03/01/2007 Jill Habasque CAR 129178
.           Recompiled for NZPMCHTM - added quotes around GST codes
. V9.08.11  02/01/2007 Ebon Clements CAR 126779
.           Added report 13 nz private provider type maintenance
. V9.08.10  06/12/2006 Jill Habasque CAR 119985
.           Fixed global delete of nzpbfeaf
. V9.08.09  24/11/2006 Jill Habasque CAR 119999
.           Added nz private contract funding functions
. V9.08.08  21/11/2006 Ebon Clements CAR 120007
.           Added nz private misc charge global functions
. V9.08.07  21/11/2006 Ebon Clements CAR 120001
.           Added nz private contract procedure fee global functions
.           21/11/2006 Jill Habasque CAR 119985
.           Added nz private bed fee global functions
. V9.08.06  17/11/2006 Ebon Clements CAR 120007
.           Added report 11 NZ private exploding misc charges maintenance
. V9.08.05  09/11/2006 Ebon Clements CAR 120007
.           Added report 11 NZ private misc charges maintenance
. V9.08.04  03/11/2006 Ebon Clements CAR 119985
.           Added report 10 NZ private bed fee maintenance
. V9.08.03  26/10/2006 Ebon Clements CAR 120001
.           Added report 9 NZ private contract procedure fee maintenance
. V9.08.02  26/10/2006 J.Tan         CAR 122541
.           Mods for Alternate misc.item group
. V9.08.01  05/10/2006  Ebon Clements CAR 120013
.           Added report 8 nz private theatre fee maintenance
. V9.07.03  12/07/2006  Mike Laming   CAR 103365
.           Added logic for PTMCALGR & cgi Var. MSCHG029
. V9.07.02  12/07/2006  Mike Laming   CAR 103365
.           Added Increase Charges to Helth Fund Duplication in Misc.Charge file
. V9.07.01  04/07/2006  J.Tan         CAR 103365
.           Added Global update to new misc.charge file
. V9.05.01  09/03/2006  Ebon Clements CAR 78533
.           Mods for PATCODTM - Hospital specific category codes
. V9.05.B02 30/01/2006  Ebon Clements CAR 93186
.           Mods for REDIRECT length change. Recompiled for IBAWEBDF
. V9.04.07 10/11/2005  J.Tan        CAR 55176
.          Added LGA and Catchment code allocation option
. V9.04.06 04/08/2005  J.Tan        CAR 62750
.          Mods not to use the redefined amount variables
. V9.04.05 02/08/2005  J.Tan   CAR 69726  
.          Fixed changing misc.item with blank effective date.
. V9.04.04 20/07/2005  J.Tan   CAR 68129  
.          Fixed packing of dates to be century then year
. V9.04.03 20/06/2005  J.Tan   CAR 63988  
.          Mods to default claim code for misc.charge from system parameter
. V9.04.02 19/10/2004  Lina Vo            
.          Changed Generate Misc Charge keyword search to use GENERMKI instead 
.          of IBAHOS10.
. V9.04.01 29/09/2004  Lina Vo CAR 53798
.          Recompiled for PATMKIPR - changes for multi hospital 
. V9.03.11 27/07/2004  J.Tan  CAR 52075
.          Recompiled for PATMKIPR-added misc.code to keyword search
. V9.03.10 21/07/2004 Pat Dirito     CAR 50510
.          Fixed TRAP IO call at labels BEDFEE81, OPRCHG81, MSCCHG81
. V9.03.09 24/06/2004 Ebon Clements  CAR 50746
.          Added MSCHG027 and MSCHG028 cgis
. V9.03.08 29/04/2004 J.Tan   CAR 47560
.          Removed displaying item sequence on the casemix theatre fee list
. V9.03.07 15/04/2004 J.Tan   CAR 48824 
.          Mods checking for bed fee processing flag (PTCNWBFE).
.          16/04/2004 Lina Vo CAR 48824 
.          Mods to Theatre Fee Maintenance to Lock Web Flag (PTCNWTFE) when
.          entering Global Maintenance template.
.          Mods to Misc Charge Maintenance to Lock Web Flag (PTCNWMCH) when
.          entering Global Maintenance template.
.          Also changed to lock using userid.
.          Mods Global Bed Fee Maintenance handling of Health Fund & Table.
. V9.03.06 08/01/2004  Pat Dirito                CAR 46543
.          Casemix Theatre Fee defects - Fixed output var CASF1700
. V9.03.05 02/10/2003  Pat Dirito                CAR 36492
.          Further Mods to Casemix Theatre Fee Global Functions
. V9.03.04 08/09/2003  Pat Dirito                CAR 36492
.          Added Casemix Theatre Fee Maintenance
.          01/09/2003  Lina Vo                   CAR 36486 & 40497
.          Added Miscellaneous Charges Maintenance.                        
.          Recompiled for PATMCHFD & IO.                                   
. V9.03.03 18/08/2003  Lina Vo                   CAR 36528
.          Added tag for HFBAND in OCHG0200 and OCHG2400 (Only Health Fund 
.          has banding not Health Fund Table).
.          Made OPCHG005 right justifed when it's an MBS Fee field as per 
.          IBABIL14.
.          Removed Match for 'All' in STCHG000. 
.          Added Global Theatre Fee functionality from IBABIL14.
. V9.03.02 13/08/2003  Sylvek Litewka            CAR 41293
.          Removed FD, IO and OPEN of webschaf. These are now included in 
.          IBAWEBDF.PBL and IBAWEBCD.PBL.
. V9.03.01 30/05/2003  Pat Dirito                SRF 36490
.          Added Casemix Funding Maintenance
.----------------------------------------------------------------------
. V9.02.00 31/03/2003 Ebon Clements SRF 36527
.          Created web bed fee schedule functions to IBARSH10
.          14/02/2002 Ashwin
.          Created Program
.----------------------------------------------------------------------
          INC       IBAWEBDF
          INC       WEBDATDF
          INC       RSHWEBDF
          INC       APSMASFD/INC
          INC       PATHLFFD/INC
          INC       PATLSDFD/INC
          INC       PATIN1FD/INC
          INC       PMSDCAFD/INC
          INC       PMSHCPTD/INC
          INC       PMSHCGTD/INC
          INC       NZPBFETD/INC      * cgi vars NZ private bed fee
          INC       NZPCFNTD/INC      * cgi vars NZ private contract funding
          INC       NZPMCHTD/INC      * cgi vars NZ private misc charges fee
          INC       NZPTFETD/INC      * cgi vars NZ private theatre fee
          INC       NZPPFETD/INC      * cgi vars NZ private procedure fee
          INC       NZPPTYTD/INC      * cgi vars NZ private provider type
.
          INC       IBAGSTFD/INC      * GST master file
          INC       PMSHCPFD/INC
          INC       PATDO1FD/INC
          INC       MLTCFNFD/INC      * NZ priv contract funding doctors
          INC       MLTCF1FD/INC      * New NZ priv contract funding doctors
          INC       NZPBFEFD/INC      * NZ priv bed fee
          INC       NZPBF1FD/INC      * New NZ priv bed fee
          INC       NZPCFNFD/INC      * New NZ priv contract funding
          INC       NZPCF1FD/INC      * New NZ priv contract funding
          INC       NZPIBRFD/INC      * NZ priv contract proc fee inv breakdown 
          INC       TMPIBRFD/INC      * NZ priv contract proc fee inv breakdown 
          INC       NZPIB1FD/INC      * NZ priv contract proc fee inv breakdown 
          INC       NZPMCHFD/INC      * NZ priv misc charges
          INC       NZPMC1FD/INC      * New NZ priv misc charges
          INC       NZPMXCFD/INC      * NZ priv misc charge exploding items
          INC       NZPMX1FD/INC      * New NZ priv misc charge exploding items
          INC       NZPPFEFD/INC      * NZ private procedure fee
          INC       NZPPF1FD/INC      * New NZ private procedure fee
          INC       NZPRBRFD/INC      * NZ priv contract proc fee rev breakdown 
          INC       TMPRBRFD/INC      * NZ priv contract proc fee rev breakdown 
          INC       NZPPTYFD/INC       * NZ priv related provider type
          INC       NZPRB1FD/INC      * NZ priv contract proc fee rev breakdown 
          INC       NZPTFEFD/INC      * NZ private theatre fee
          INC       NZPTF1FD/INC      * New NZ private theatre fee
          INC       PATADRFD/INC      * Audit misc charge file
          INC       PATCONFD/INC      * Control file
          INC       JHSBF1FD/INC
          INC       JHSTF1FD/INC 
          INC       PATBDEFD/INC      * Billing Defaults File
          INC       PATBDETD/INC      * Billing Defaults File CGI variables
          INC       PATBFEFD/INC      * Bed Fee file
.         INC       PATBF1FD/INC      * Bed Fee file(New)
          INC       PATFN1FD/INC      * Health Fund File
          INC       PATHSPFD/INC      * Hospital file
          INC       PATITMFD/INC      * MBS Items File
          INC       PATLGAFD/INC      * LGA file
          INC       PMSCIDFD/INC
          INC       PATCT1FD/INC      * Catchment code file
          INC       PATMBFFD/INC      * Bed Fee Mapping File
          INC       PATMTFFD/INC      * Theatre Fee Mapping File
          INC       PATMCHFD/INC      * Misc Charge File
          INC       PATTFEFD/INC      * Theatre Fee File
          INC       PATCMXFD/INC      * Casemix Funding File
          INC       PATCMCFD/INC      * Casemix Codes File
          INC       PATCTFFD/INC      * Casemix Theatre Fee File
          INC       PATDGWFD/INC      * Patient DRG Desc & Weighting files
          INC       TFILEVAR/INC
          INC       PMSUFIFD/INC      * User Group Favourite Charge Items
          INC       PMSVSCFD/INC      * Clinical Coding Value Set Codes File
          INC       PMSPRGFD/INC      * Program Codes Table
          INC       MLTSECFD/INC
          INC       ACCDMAFD/INC
.
.----------------------------------------------------------------------
. CGI Parameters
.----------------------------------------------------------------------
ACTIDESC  DIM       3
ADDSCREN  FORM      1
ALLOCCID  DIM       6
BFMCOUNT  FORM      3
BRKDTYPE  DIM       1
BRKDCODE  DIM       3
DOCTCODE  DIM       6
DISPEDAT  DIM       11
NEXTPAGE  DIM       1
UPDTTYPE  DIM       1         * Update Type
STARTKEY  DIM       10        * Starting Key
DELALLFG  FORM      1         * Flag for Delete All records from New file
DIM3      DIM       3
DISKEY21  DIM       21     * Compare vriable for descending order MISC charge
DISKEY29  DIM       29     * Compare vriable for descending order MISC charge NZ
FILEFLAG  DIM       1         * File Flag to pick Current or New
CONTRCID  DIM       6
CASETYPE  DIM       1         * Type of Casemix Search           
CLAMDESC  DIM       20
COPYFLAG  DIM       1         * Load flag to create new file with current data
CMIXCODE  DIM       9
FILETYPE  DIM       1
KEY21A    DIM       21
KEY29A    DIM       29
MENUFLAG  DIM       1        * Menu Type (Maintenance/Enquiry)
NEWFFLAG  DIM       1         * Flag to check for New file
MLCFN001  DIM       10
NZIBH001  DIM       3
NZIBH002  FORM      14.2
NZIBH003  DIM       3
CHECKALL  DIM       1         * Check for all Health Fund
INCRFLAG  DIM       1         * Type 1=Dollars Increase,2=Percentage Increase
INCRPORT  FORM      6.2
INVALDFL  FORM      1
REDIREC1  DIM       227
SAVKEY    DIM       23
SAVKEY21  DIM       21
SAVKEY31  DIM       31
SAVKEY29  DIM       29
SAVKEY50  DIM       50
SAVKEY58  DIM       58
SESTDESC  DIM       20
SHOWTYPE  DIM       1
DNTSHWIN  DIM       1
DIFF      FORM      2
COUNT     FORM      2
CASDESCR  DIM       35
CASCODE   DIM       5
CASTYPE   DIM       5
FINISHR   FORM      1
FINISHI   FORM      1
FIRST     FORM      1
FILTHOSP  DIM       3
FILTOCCG  DIM       3
FILTFAVG  DIM       3
FILTUSID  DIM       10
FILTCLAM  DIM       3
FILTSYST  DIM       1
FILTDCTY  DIM       3
FILTACTV  DIM       1
WORKUSID  DIM       10
CURRDATE  DIM       8
CURRTIME  DIM       8
CHRITMDS  DIM       90
COPYHOSP  DIM       3
COPYOCCG  DIM       3
COPYUSID  DIM       10
COPYFAVG  DIM       3
COPYGHED  DIM       3
COPYDFTG  DIM       3
SRCHHOSP  DIM       3
SRCHOCCG  DIM       3
SRCHUSID  DIM       10
SRCHFAVG  DIM       3
SRCHGHED  DIM       3
SRCHCITM  DIM       9
SHOWFLAG  FORM      1
VALDTYPE  FORM      1         * Validation Type
SHOWREVN  DIM       1
UPDATEFL  FORM      1         * Update Type
UPDATETY  DIM       1         * Update Type (A)dd,(U)pdate,(D)elete,Blank=disp
SETFONT   DIM       20
ENDFONT   DIM       7
VALFDATE  DIM       8
VALTDATE  DIM       8
.
EFFDATE1  DIM       8
EFFDATE2  DIM       8
CHRDESC1  DIM       90
CHRDESC2  DIM       90
BLNK90    DIM       90
.
CDMAP001  DIM       3
CDMAP002  DIM       3
CDMAP003  DIM       1
CDMAP004  DIM       3
CDMAP005  DIM       3
CDMAP006  DIM       3
CDMAP007  DIM       1
CDMAP008  DIM       1
CDMAP009  DIM       3
CDMAP010  DIM       3
CDMAP011  DIM       1
CDMAP012  DIM       3
CDMAP013  DIM       3
CDMAP014  DIM       3
CDMAP015  DIM       1
.
. Bed Fee File
.
BDFEE001  DIM       3         * CLM CODE (CODES FILE CAT. CL)
BDFEE002  DIM       6         * HEALTH FUND (PATFNDH FILE)
BDFEE003  DIM       3         * HEALTH FUND TABLE (PATFNDH)
BDFEE004  DIM       3         * ADMISSION TYPE (CODES CAT. A)
BDFEE005  DIM       3         * BED TYPE (CODES CAT. BT)
BDFEE006  FORM      3         * HIGHEST DAY IN PERIOD
BDFEE007  FORM      12.2      * PATIENT PORTION OF RATE
BDFEE008  FORM      12.2      * REBATE PORTION OF RATE
BDFEE009  FORM      1         * No OF INVOICES (1 OR 2 ONLY)
BDFEE010  DIM       30        * DESCRIPTION
BDFEE011  FORM      1         * Health Fund All               
BDFEE012  FORM      1         * Health Fund Table All       
BDFEE013  FORM      1         * Last Day in Period All       
BDFEE014  DIM       6         * Contract ID
BDFEE015  DIM       8         * HEALTH FUND TABLE FOR JOHNS HOPKINS
BDFEE016  DIM       1         * Display only empty Contract IDs 
.
CPFEE001  DIM       3         * COPY TO CLM CODE (CODES FILE CAT. CL)
CPFEE002  DIM       6         * COPY TO HEALTH FUND (PATFNDH FILE)
CPFEE003  DIM       8         * COPY TO HEALTH FUND TABLE (PATFNDH)
CPFEE004  DIM       3         * COPY TO ADMISSION TYPE (CODES CAT. A)
CPFEE005  DIM       3         * COPY TO BED TYPE (CODES CAT. BT)
.
FROMDATE  DIM       8         * FROM DATE TO UPDATE CURRENT PATIENT BED FEES
BFEEDATE  DIM       8         * DATE BED FEE UPDATE PROCESSED                
BFEETIME  DIM       8         * TIME BED FEE UPDATE PROCESSED
RECALCHG  FORM      1         * RUN RECALCULATION OF PATIENT CHARGES
.
. Theatre Fee File
.
OPCHG001   DIM        3       * CLM CODE (CODES FILE CAT. CL)
OPCHG002   DIM        6       * H.F. (PATFUNDH FILE)
OPCHG003   DIM        3       * H.F. TABLE (PATFUNDH)
OPCHG004   DIM        1       * DAY CASE RATE INDICATOR
.                             * " = Day Case rate
.                             * = Not a Day Case rate
OPCHG005   DIM        5       * LAST MBS FEE IN RANGE or
.
OPCHG006   FORM      12.2     * REBATE PORT IF 1st HIGHEST FEE
OPCHG007   FORM      12.2     * PATIENT PORTION
OPCHG008   FORM      12.2     * REBATE PORT IF 2nd HIGHEST FEE
OPCHG009   FORM      12.2     * PATIENT PORTION
OPCHG010   FORM      12.2     * REBATE PORT IF 3rd HIGHEST FEE
OPCHG011   FORM      12.2     * PATIENT PORTION
OPCHG012   FORM      12.2     * REBATE PORT IF 4th HIGHEST FEE
OPCHG013   FORM      12.2     * PATIENT PORTION
OPCHG014   FORM      12.2     * REBATE PORT IF 5th HIGHEST FEE
OPCHG015   FORM      12.2     * PATIENT PORTION
OPCHG016   FORM      12.2     * REBATE PORT IF 6th HIGHEST FEE
OPCHG017   FORM      12.2     * PATIENT PORTION
OPCHG018   FORM       1       * NUMBER OF INVS (1 OR 2 ONLY)
.
. Global Duplication of New File
.
OPCHG019   DIM        3       * Copy To CLM CODE (CODES FILE CAT. CL)
OPCHG020   DIM        6       * Copy To H.F. (PATFUNDH FILE)
OPCHG021   DIM        8       * Copy To H.F. TABLE (PATFUNDH)
OPCHG022   DIM        1       * Copy To DAY CASE RATE INDICATOR
.                             * " = Day Case rate
.                             * = Not a Day Case rate
OPCHG023   DIM        5       * Copy To LAST MBS FEE IN RANGE or
OPCHG024   FORM       1       * Health Fund All               
OPCHG025   FORM       1       * Health Fund Table All       
.
OPCHG026   DIM        6       * Contract ID
OPCHG027   DIM        8       * Health Fund Table JHS
.
. Casemix Funding Maintenance
.
CASMX001    DIM      3        * Claim code
CASMX002    DIM      6        * Health Fund
CASMX003    DIM      9        * DRG/MBS Code
CASMX006    FORM     4        * Expected Length of Stay
CASMX007    FORM     1        * Detailed invoice flag
CASMX009    DIM      6        * Contract ID
CASMX010    DIM     11        * Eclipse Equivalent
CASMX011    DIM      2        * Eclipse Type of Service
CASMX012    DIM      3        * Transfer Trim Point
CASMX013    DIM      4        * Target LOS
CASMX014    DIM      2        * Health Care Provider (Eclipse)
.
CPYMX001    DIM      3        * Claim code
CPYMX002    DIM      6        * Health Fund
CPYMX003    DIM      9        * DRG/MBS Code
CPYMX004    DIM      1        * Start type
.                                1 = Admission from
.                                2 = Discharged from
.
FVGRP001   DIM       3        * Hospital ID (pathspaf)	    
FVGRP002   DIM       3        * User Occupational Group (Cat w0)	      
FVGRP003   DIM      10        * Web User (websecaf) blank for all	      
FVGRP004   DIM       3        * Favourite Group (Cat w4)	      
FVGRP005   DIM       3        * Default Favourite Group (Yes/No)	      
FVGRP006   DIM       3        * Group Heading (Cat w5)	    
FVGRP007   DIM       9        * Charge Code (patmchgf/nzpmchaf)	    
FVGRP008   DIM       6        * Quantity	      
FVGRP009   DIM       90       * Charge Code Description	      
.
. Miscellaneous Charge Maintenance
.
MSCHG001   DIM        3       * CLM CODE (CODES FILE CAT. CL)
MSCHG002   DIM        6       * H.F. (PATFUNDH FILE)
MSCHG003   DIM        8       * H.F. TABLE (PATFUNDH)       *** (no longer used)
MSCHG004   DIM        9       * CHARGE CODE             
MSCHG005   DIM       30       * DESCRIPTION
MSCHG006   FORM       1       * CHARGE TYPE 2=THEATRE FEE 3=MISC ITEM
MSCHG007   DIM        3       * MISC CHARGE GROUP (CAT FI)
MSCHG008   FORM    12.2       * PATIENT PORTION
MSCHG009   FORM    12.2       * REBATE PORTION
MSCHG010   FORM       1       * NUMBER OF INVS - 1 OR 2 ONLY
MSCHG011   FORM       1       * INDICATOR FOR CHANGING DESC. 0=NO 1=YES
MSCHG012   FORM       1       * IS GST APPLICABLE TO CHARGE 0=GST FREE
.                                                           1=GST PAYABLE
.                                                           2=EITHER
MSCHG013   DIM        6       * GST PAYABLE CODE FROM GST RATES TABLE
MSCHG014   DIM       10       * EDI EQUIVALENT
MSCHG015   FORM       1       * CASEMIX FUNDING CHARGEABLE
MSCHG016   DIM        1       * KEYIN REBATE PORTION Y=YES OTHERWISE NO
MSCHG017   DIM        1       * CHARGE ON BEHALF OF DOCTOR Y=YES OTHERWISE NO
MSCHG018   DIM        1       * TAC TYPE A=AMA ITEM 
.                                        P=PARAMEDICAL ITEM
.                                        T=TAC ITEM
MSCHG019   DIM        4       * TAC DURATION (MIN) ONLY REQUIRED BY PARAMEDICAL
MSCHG020   DIM        8       * EFFECTIVE DATE CCYYMMDD
.
MSCHG029   DIM        3       * Alternate MISC CHARGE GROUP (CAT FN)
MSCHG030   DIM        1       * Prosthetic Tracking   (0=No, 1=Yes)
MSCHG031   DIM        11      * Eclipse Equivalent
MSCHG032   DIM        2       * Eclipse Type of Service
MSCHG033   DIM        1       * Active/Inactive flag  (0=Active, 1=Inactive)
MSCHG034   DIM        3       * Health Fund Table Type (Cat."HT")
MSCHG035   DIM        8       * Effective To Date (CCYYMMDD)
MSCHG036   DIM        2       * Health Care Provider (Eclipse)
.
. Global Duplication of New File
.
MSCHG021   DIM        3       * Copy To CLM CODE (CODES FILE CAT. CL)
MSCHG022   DIM        6       * Copy To H.F. (PATFUNDH FILE)
MSCHG023   DIM        8       * Copy To H.F. TABLE (PATFUNDH)
MSCHG024   DIM        9       * Copy To Misc. Charge Code       
MSCHG025   FORM       1       * Health Fund All               
MSCHG026   FORM       1       * Health Fund Table All       
MSCHG027   FORM       1       * All misc charge codes       
MSCHG028   FORM       1       * Copy to misc charge codes       
.
. Casemix Theatre Fee Maintenance
.
CASTH001    DIM     3        * Claim code
CASTH002    DIM     6        * Health Fund
CASTH003    DIM     3        * Table Type
CASTH004    DIM     9        * DRG Code (blank if not DRG)
CASTH005    DIM     3        * MBS Banding (blank if not MBS)
CASTH006    DIM     1        * Daycase Yes/No
.                               1 = Yes
.                               0 = No
CASTH007    FORM    2        * Item sequence
CASTH008    FORM    8.2      * rebate portion
CASTH009    FORM    8.2      * patient portion
CASTH010    DIM     5        * MBS Item/Theatre Class
CASTH011    DIM     8        * Health Fund Table     
CASTH012    DIM     6        * Contract ID
.
. Copy To Vars
.
CPYTH001    DIM     3        * Claim code
CPYTH002    DIM     6        * Health Fund
CPYTH003    DIM     3        * Table Type
CPYTH004    DIM     9        * DRG Code (blank if not DRG)
CPYTH005    DIM     3        * MBS Banding (blank if not MBS)
CPYTH006    DIM     1        * Daycase Yes/No
.                               1 = Yes
.                               0 = No
.
. LGA and Catchment Code cgi variables
.
PTCAT001    DIM     3        * Catchment code
PTCAT002    DIM     4        * LGA code
PTCAT003    DIM     1        * Normal/Unallocated postcode only?
PTCAT004    DIM     4        * Starting postcode
PTCAT005    DIM     4        * Ending postcode
.
.----------------------------------------------------------------------
. Program Variables
.----------------------------------------------------------------------
ADD       DIM       2             *      AUDIT DAY
AMM       DIM       2             *      AUDIT MONTH
ACC       DIM       2             *      audit century
AYY       DIM       2             *      AUDIT YEAR
ACTION    DIM       1             *      ACTION
.                                             A == ADDED
.                                             B == BEFORE CHANGE
.                                             C == CHANGED TO
OPERCODE  DIM       4             *      OPERATOR CODE
DIM5      DIM       5
DIM11     DIM       11
DIM12     DIM       12
DIM12A    DIM       12
DIM12B    DIM       12
DIM20     DIM       20
DIM20A    DIM       20
DIM20B    DIM       20
DIM20C    DIM       20
DIM20D    DIM       20
DIM20E    DIM       20
DIM20F    DIM       20
DIM40A    DIM       40
DIM40B    DIM       40
FORM1P1   FORM      1.1   
FORM2P1   FORM      2.1
FORM3     FORM      3      
FLAGLEFD  FORM      1       * Previous record with a prior Effective Start Date
EXPFEE    INIT      "EXPLODING"
CLAIMCOD  DIM       3
HLTHFUND  DIM       6
FEECLASS  DIM       5
INDEXCNT  FORM      2 
FORM5     FORM      5
NOBDEAX1  FORM      1
NOACCDMA  FORM      1
PSTCODE   FORM      4
SKEY12    DIM       12
SKEY25    DIM       25
SKEY30    DIM       30
TOTAL     FORM      6.2
TOTALAMT  FORM      12.2
TOTALCS   FORM      12.2
TABLTYPE  DIM       20
TOTADDIT  FORM      14.2
LNK2PRT   FORM      1
LOOPCNTR  FORM      8
CMDLINE   DIM       60
MESSAGE   DIM       100
THCFLG    FORM      2 
UPDFLAG   FORM      1
BLANK     INIT      "BLANK"
CATw0     INIT      "w0"
CATw4     INIT      "w4"
CATw5     INIT      "w5"
ADMISFRM  INIT      "Admission From"
DISCHFRM  INIT      "Discharge From"
MISCFEE   INIT      "MISC. FEE  "
SEC1      FORM      "00001"
THTRFEE   INIT      "THEATRE FEE"
NINETY9   FORM      "99"
MBFUID    DIM       10[20]
MBFCLM    DIM       3[20]
MBFHFN    DIM       6[20]
MBFATP    DIM       3[20]
WORKDATE  DATE      8
.
MULTCNT1  FORM      3            * Counter fot multipl1 array
MULTCNT2  FORM      3            * Counter fot multipl2 array
MULTCNT3  FORM      3            * Counter fot multipl3 array
.
CNT1      FORM      3
CNT2      FORM      3
CNT3      FORM      3
.
MULT1ARR  DIM       3[999]       * Multiple 1 Array
MULT2ARR  DIM       3[999]       * Multiple 2 Array
MULT3ARR  DIM       3[999]       * Multiple 3 Array
.
MULTIPL1  INIT      "Multipl1"
MULTIPL2  INIT      "Multipl2"
MULTIPL3  INIT      "Multipl3"
.
CCLMDESC  DIM       20
SYSTDESC  DIM       20
CTYPDESC  DIM       20
ILOSDESC  DIM       20
DTYPDESC  DIM       20
IACTDESC  DIM       3
DELTDESC  DIM       3
CUSRNAME  DIM       30
CDTEDESC  DIM       11
UUSRNAME  DIM       30
UDTEDESC  DIM       11
DUSRNAME  DIM       30
DDTEDESC  DIM       11
.
.----------------------------------------------------------------------
PRGID     INIT      "PATWEB77"
VERSION   INIT      "V12.01.00"
PRGNAM    INIT      "General Table Maintenance"
.----------------------------------------------------------------------
          CALL      WEBINT00       * Initialise Fifo Etc.
          CALL      INIT0000       * Open Files
.
MAIN1000  CALL      WEBRED00       * Read Fifo WEBPID and USERID
.
          COMPARE   "999",REPORTNO * End Server Process on Report Option 999
          GOTO      MAIN9999 IF EQUAL
.
          PACK      CURRDATE,CCC,CYY,CMM,CDD
          REP       " 0",CURRDATE
.
          BRANCH    REPORTNO,MAIN1100,MAIN1200,MAIN1300,MAIN1400,MAIN1500:
                             MAIN1600,MAIN1700,MAIN1800,MAIN1900,MAIN2000:
                             MAIN2100,MAIN2200,MAIN2300,MAIN2400,MAIN2500:
                             MAIN2600,MAIN2700,MAIN2800,MAIN2900,MAIN3000:
                             MAIN3100
.
          PACK      WEBTITLE,PRGID,SP1,VERSION,SP1,PRGNAM,SP70
          MOVE      "Invalid Option",WEBTITLE
          CALL      WEBERR00   * Create Output File and Write HTML Page Header
          GOTO      MAIN1000
.
MAIN1100  CALL      BEDFEE00        * Bed Fee Maintenance
          BRANCH    EXIT,MAIN1000
          MOVE      "Update Complete",WEBTITLE
          CALL      NXTPAG00
          GOTO      MAIN1000
.
MAIN1200  CALL      OPRCHG00        * Theatre Charges Maintenance
          BRANCH    EXIT,MAIN1000
          MOVE      "Update Complete",WEBTITLE
          CALL      NXTPAG00
          GOTO      MAIN1000
.
MAIN1300  CALL      CASMIX00        * Casemix Funding Maintenance
          BRANCH    EXIT,MAIN1000
          MOVE      "Update Complete",WEBTITLE
          CALL      NXTPAG00
          GOTO      MAIN1000
.
MAIN1400  CALL      MSCCHG00        * Misc. Charges Maintenance
          BRANCH    EXIT,MAIN1000
          MOVE      "Update Complete",WEBTITLE
          CALL      NXTPAG00
          GOTO      MAIN1000
.
MAIN1500  CALL      CASTHR00        * Casemix Theatre Fee Maintenance
          BRANCH    EXIT,MAIN1000
          MOVE      "Update Complete",WEBTITLE
          CALL      NXTPAG00
          GOTO      MAIN1000
.
MAIN1600  CALL      REMOTS00        * Remote Scripting Functions 
          GOTO      MAIN1000
.
MAIN1700  CALL      CATLGA00        * Catchment and LGA Allocation
          BRANCH    EXIT,MAIN1000
          MOVE      "Allocation Complete",WEBTITLE
          CALL      NXTPAG00
          GOTO      MAIN1000
.
MAIN1800  CALL      NZPTHR00        * NZ Private Theatre Fee Maintenance
          BRANCH    EXIT,MAIN1000
          MOVE      "Update Complete",WEBTITLE
          CALL      NXTPAG00
          GOTO      MAIN1000
.
MAIN1900  CALL      NZPPRC00       * NZ Private Procedure Fee Maintenance
          BRANCH    EXIT,MAIN1000
          MOVE      "Update Complete",WEBTITLE
          CALL      NXTPAG00
          GOTO      MAIN1000
.
MAIN2000  CALL      NZBFEE00       * NZ Private Bed Fee Maintenance
          BRANCH    EXIT,MAIN1000
          MOVE      "Update Complete",WEBTITLE
          CALL      NXTPAG00
          GOTO      MAIN1000
.
MAIN2100  CALL      NZPMSC00       * NZ Private Misc Changes Maintenance
          BRANCH    EXIT,MAIN1000
          MOVE      "Update Complete",WEBTITLE
          CALL      NXTPAG00
          GOTO      MAIN1000
.
MAIN2200  CALL      NZPCFN00       * NZ Private Contract Funding Maintenance
          BRANCH    EXIT,MAIN1000
          MOVE      "Update Complete",WEBTITLE
          CALL      NXTPAG00
          GOTO      MAIN1000
.
MAIN2300  CALL      NZPPTY00       * NZ Private Provider Type Maintenance
          BRANCH    EXIT,MAIN1000
          MOVE      "Update Complete",WEBTITLE
          CALL      NXTPAG00
          GOTO      MAIN1000
.
MAIN2400  CALL      BILFEE00        * Billing Fees Update
          BRANCH    EXIT,MAIN1000
          MOVE      "Update Complete",WEBTITLE
          CALL      NXTPAG00
          GOTO      MAIN1000
.
MAIN2500  CALL      BFEMAP00        * Bed Fee Mapping
          BRANCH    EXIT,MAIN1000
          MOVE      "Update Complete",WEBTITLE
          CALL      NXTPAG00
          GOTO      MAIN1000
.
MAIN2600  CALL      TFEMAP00        * Bed Fee Mapping
          BRANCH    EXIT,MAIN1000
          MOVE      "Update Complete",WEBTITLE
          CALL      NXTPAG00
          GOTO      MAIN1000
.
MAIN2700  IF        CFEETYP=9
            CALL      JHSFEE00       * Johns Hopkins Bed Fee Maintenance
            BRANCH    EXIT,MAIN1000
          ENDIF
          MOVE      "Update Complete",WEBTITLE
          CALL      NXTPAG00
          GOTO      MAIN1000
.
MAIN2800  IF        CFEETYP=9
            CALL      JHSCHG00       * Johns Hopkins Theatre Charges Maintenance
            BRANCH    EXIT,MAIN1000
          ENDIF
          MOVE      "Update Complete",WEBTITLE
          CALL      NXTPAG00
          GOTO      MAIN1000
.
MAIN2900  CALL      FAVGRP00         * User Group Favourite Charge Items
          BRANCH    EXIT,MAIN1000
          CALL      NXTPAG00               
          GOTO      MAIN1000
.
MAIN3000  CALL      BDEF0000         * Billing Defaults file for Admissions
          BRANCH    EXIT,MAIN1000    * Maintenance
          CALL      NXTPAG00
          GOTO      MAIN1000
.
MAIN3100  CALL      CTDM0000         * Claim type / clinical doc mapping
          BRANCH    EXIT,MAIN1000    * Maintenance
          CALL      NXTPAG00
          GOTO      MAIN1000
.
MAIN9999  MOVE      "SERVER SHUTDOWN COMPLETE",WEBTITLE
          CALL      WEBERR00
          STOP
.------------------------------------------------------------
. Output Next Page Based on CGI Parameter nextpage
.------------------------------------------------------------
NXTPAG00  MOVE      ZERO,F1
          MOVE      NEXTPAGE,F1
          BRANCH    F1,NXTPAG10,NXTPAG20,NXTPAG30,NXTPAG40
.
          CALL      WINCLS00
          GOTO      NXTPAG99
.
NXTPAG10  CALL      RDIREC00
          GOTO      NXTPAG99
.
NXTPAG20  CALL      GOBACK00
          GOTO      NXTPAG99
.
NXTPAG30  CALL      PREDIR00      * Redirect Parent
          GOTO      NXTPAG99
.
NXTPAG40  CALL      PRADIR00      * Redirect Parent with alert of webtitle
          GOTO      NXTPAG99
.
NXTPAG99  RETURN
.
.------------------------------------------------------------------------------
.  Redirect Parent URL
.------------------------------------------------------------------------------
PREDIR00  CALL      OPENHTML
          BRANCH    EXIT,PREDIR90
.
          WRITE     HTMLFILE;"<script type=#"text/javascript#"> {":
                             " parent.location.href=#"",REDIRECT,"#";":
                             "}":
                             "</script>"
          CALL      CLOSHTML
          GOTO      PREDIR99
.
PREDIR90  DISPLAY   "*** Fifo Not Found ***"
.
PREDIR99  RETURN
.
.------------------------------------------------------------------------------
.  Redirect Parent URL
.------------------------------------------------------------------------------
PRADIR00  CALL      OPENHTML
          BRANCH    EXIT,PRADIR90
.
          WRITE     HTMLFILE;"<script type=#"text/javascript#"> {":
                             " parent.location.href=#"",REDIRECT,"#";":
                             "}":
                             "</script>"
          CALL      CLOSHTML
          GOTO      PRADIR99
.
PRADIR90  DISPLAY   "*** Fifo Not Found ***"
.
PRADIR99  RETURN
.------------------------------------------------------------------------------
.  Goes back x number of pages
.------------------------------------------------------------------------------
GOBACK00  CALL      OPENHTML
          BRANCH    EXIT,GOBACK99
          MOVE      NEXTPAGE,F1
          SUB       TWO,F1
          WRITE     HTMLFILE;"<script type=#"text/javascript#"> {":
                             "    alert(#"",WEBTITLE,"#");":
.                            "    self.close();":
                             "    window.history.go(-",F1,");":
                             "}":
                             "</script>"
          CALL      CLOSHTML
GOBACK99  RETURN
.------------------------------------------------------------
. Remote Scripting Functions  
.             - VALDTYPE : 1. Validate UR Info
.                          2. Validate MBS Copy Section Only
.                          3. NOT USED
.                          4. Default Group Validation
.------------------------------------------------------------
REMOTS00  BRANCH    VALDTYPE,REMOTS10,REMOTS20,REMOTS30,REMOTS40
          GOTO      REMOTS91
.
REMOTS10  CALL      VALMBS00        * Validate MBS    
          GOTO      REMOTS99
.
REMOTS20  CALL      VALCPY00        * Validate MBS Copy Section Only
          GOTO      REMOTS99
.
REMOTS30
          GOTO      REMOTS99
.
REMOTS40  CALL      VALDEF00
          GOTO      REMOTS99
.
REMOTS91  CALL      XMLHED00
          WRITE     HTMLFILE;"<RETURN_VALUE TYPE=ERROR>":
                             "Invalid Validation Type":
                             "</RETURN_VALUE>"
          CALL      XMLEND00
          GOTO      REMOTS99
.
REMOTS99  RETURN
.------------------------------------------------------------
. Open Files and Initialize Variables
.------------------------------------------------------------
INIT0000  OPEN      CONTROLF,"controlf"
          OPEN      IBAGSTA1,"ibagstaf"
          OPEN      PMSHCPA1,"pmshcpaf"
          OPEN      MLTCFNA1,"mltcfnaf"
          OPEN      MLTCFN11,"mltcf1af"
          OPEN      NZPBFEA1,"nzpbfeaf"
          OPEN      NZPBF1A1,"nzpbf1af"
          OPEN      NZPMCHA1,"nzpmchaf"
          OPEN      NZPMCHA3,"nzpmchaf"
          OPEN      NZPMC1A1,"nzpmc1af"
          OPEN      NZPMC1A3,"nzpmc1af"
          OPEN      NZPMXCA1,"nzpmxcaf"
          OPEN      NZPMX1A1,"nzpmx1af"
          OPEN      NZPPFEA1,"nzppfeaf"
          OPEN      NZPPF1A1,"nzppf1af"
          OPEN      NZPTFEA1,"nzptfeaf"
          OPEN      NZPTFEA2,"nzptfeaf"
          OPEN      NZPTF1A1,"nzptf1af"
          OPEN      NZPTF1A2,"nzptf1af"
          OPEN      NZPPTYA1,"nzpptyaf"
          OPEN      PATCODE1,"patcodes"
          OPEN      PATCODE2,"patcodes"
          OPEN      PATBFEE1,"patbfeef"
          OPEN      PATBFEE3,"patbfeef"
          OPEN      PATITEM1,"patitemn"
          OPEN      PATMBFA1,"patmbfaf"
          OPEN      PATMBFA2,"patmbfaf"
          OPEN      PATMBFA3,"patmbfaf"
          OPEN      PATMBFA4,"patmbfaf"
          OPEN      PATMTFA1,"patmtfaf"
          OPEN      PATMTFA3,"patmtfaf"
          OPEN      PATFN1A1,"patfn1af"
          OPEN      PATMCHG1,"patmchgf"
          OPEN      PATTFEE1,"pattfeef"
          OPEN      PATTFEE2,"pattfeef"
          OPEN      PATLGAA1,"patlgaaf"
          OPEN      PMSCIDA1,"pmscidaf"
          OPEN      PATCT1C1,"patct1cf"
          OPEN      PATCMXA1,"patcmxaf"
          OPEN      PATCMXA2,"patcmxaf"
          OPEN      PATCMCA1,"patcmcaf"
          OPEN      WEBSECA3,"websecaf"
          OPEN      MLTSECA1,"mltsecaf" 
          OPEN      PATCTFA1,"patctfaf"
          OPEN      PATCTFA3,"patctfaf"
          OPEN      PATDGWA1,"patdgwaf"
          OPEN      PATHSPA1,"pathspaf"
          OPEN      PMSDCAA1,"pmsdcaaf"
          OPEN      NZPCFNA1,"nzpcfnaf"
          OPEN      NZPCFN11,"nzpcf1af"
          OPEN      NZPIBRA1,"nzpibraf"
          OPEN      NZPIBR11,"nzpib1af"
          OPEN      NZPRBRA1,"nzprbraf"
          OPEN      NZPRBR11,"nzprb1af"
          OPEN      PMSUFIA1,"pmsufiaf"
          OPEN      PMSVSCA1,"pmsvscaf"
          OPEN      PMSPRGA1,"pmsprgaf"
.
          READ      CONTROLF,TEN;*218,CAUDR
          READ      CONTROLF,TEN9;*215,CMCNOHF,*212,CFEETYP
          READ      CONTROLF,TWENTY;*193,PTCNDCLM
          READ      CONTROLF,ZERO;*43,IBCNMHOS
          READ      CONTROLF,HUND25;*238,PTCNNRTD
.
          MOVE      ZERO,F2
          MOVE      PTCNNRTD,F2
          IF        F2 = 0
            MOVE      "10",PTCNNRTD
          ENDIF
.
          IF        CFEETYP=9
            OPEN      JHSBFEA1,"jhsbfeaf"
            OPEN      JHSTFEA1,"jhstfeaf"
          ENDIF
.
          IF        IBCNMHOS=1
            OPEN      MLTCODA1,"mltcodaf"
            OPEN      MLTCODA2,"mltcodaf"
          ENDIF
.
          IF        CAUDR=ZERO     
            OPEN      PATRAUD,"patraud"
          ENDIF
.
          MOVE      ZERO,NOBDEAX1
          MOVE      ZERO,OVRCD
          TRAP      OVERCOND IF IO
          OPEN      PATBDEA1,"patbdeaf"
          TRAPCLR   IO
          IF        OVRCD=1
            MOVE      ONE,NOBDEAX1     * patbdeaf file not found
          ENDIF
.
          MOVE      ZERO,NOACCDMA
          MOVE      ZERO,OVRCD
          TRAP      OVERCOND IF IO
          OPEN      ACCDMAA1,"accdmaaf"
          TRAPCLR   IO
          IF        OVRCD=1
            MOVE      ONE,NOACCDMA     * accdmaaf not found
          ENDIF
.
          MOVE      ZERO,OVRCD
          TRAP      OVERCOND IF IO
          OPEN      ACCDMAA2,"accdmaaf"
          TRAPCLR   IO
          IF        OVRCD=1
            MOVE      ONE,NOACCDMA     * accdmaaf not found
          ENDIF
.
          CALL      CRTM0000      * create temporary Revenue/Invoice breakdown
.
INIT9999  RETURN
.
.------------------------------------------------------------
. Clear Parameters
.------------------------------------------------------------
CLRPAR00  MOVE      SP70,BRKDTYPE
          MOVE      SP70,NZIBH001
          MOVE      ZERO,NZIBH002
          MOVE      SP70,NZIBH003
          MOVE      SP70,FILETYPE
          MOVE      SP70,BRKDCODE
          MOVE      ZERO,REPORTNO
          MOVE      SP70,TEMPLATE
          MOVE      SP70,CMIXCODE
          MOVE      ZERO,NORECORD
          MOVE      ZERO,STARTNUM
          MOVE      SP70,NEXTPAGE
          PACK      REDIRECT,SP70,SP70,SP70,SP70
          PACK      REDIREC1,SP70,SP70,SP70,SP70
          MOVE      ZERO,SHOWREVN
          MOVE      SP70,STARTKEY
          MOVE      SP70,UPDTTYPE
          MOVE      SP70,KEYWORDS
          MOVE      SP70,FILEFLAG
          MOVE      SP70,CASETYPE
          MOVE      SP70,NEWFFLAG
          MOVE      SP70,CHECKALL
          MOVE      SP70,INCRFLAG
	  MOVE      ZERO,DELALLFG
          MOVE      ZERO,VALDTYPE
          MOVE      ZERO,ADDSCREN
          MOVE      SP70,MENUFLAG
          MOVE      SP70,VIEWTYPE
          MOVE      SP70,SHOWTYPE
.
          MOVE      SP70,BDFEE001
          MOVE      SP70,BDFEE002
          MOVE      SP70,BDFEE003
          MOVE      SP70,BDFEE004
          MOVE      SP70,BDFEE005
          MOVE      ZERO,BDFEE006
          MOVE      ZERO,BDFEE007
          MOVE      ZERO,BDFEE008
          MOVE      SP70,BDFEE009
          MOVE      SP70,BDFEE010
          MOVE      ZERO,BDFEE011
          MOVE      ZERO,BDFEE012
          MOVE      ZERO,BDFEE013
          MOVE      SP70,BDFEE014
          MOVE      SP70,BDFEE015
          MOVE      SP70,BDFEE016
.
          MOVE      SP70,CPFEE001
          MOVE      SP70,CPFEE002
          MOVE      SP70,CPFEE003
          MOVE      SP70,CPFEE004
          MOVE      SP70,CPFEE005
.
          MOVE      SP70,OPCHG001
          MOVE      SP70,OPCHG002
          MOVE      SP70,OPCHG003
          MOVE      SP70,OPCHG004
          MOVE      SP70,OPCHG005
          MOVE      ZERO,OPCHG006
          MOVE      ZERO,OPCHG007
          MOVE      ZERO,OPCHG008
          MOVE      ZERO,OPCHG009
          MOVE      ZERO,OPCHG010
          MOVE      ZERO,OPCHG011
          MOVE      ZERO,OPCHG012
          MOVE      ZERO,OPCHG013
          MOVE      ZERO,OPCHG014
          MOVE      ZERO,OPCHG015
          MOVE      ZERO,OPCHG016
          MOVE      ZERO,OPCHG017
          MOVE      ZERO,OPCHG018
.
          MOVE      SP70,OPCHG019
          MOVE      SP70,OPCHG020
          MOVE      SP70,OPCHG021
          MOVE      SP70,OPCHG022
          MOVE      SP70,OPCHG023
          MOVE      ZERO,OPCHG024
          MOVE      ZERO,OPCHG025
          MOVE      SP70,OPCHG026
          MOVE      SP70,OPCHG027
.
          MOVE      SP70,CASMX001
          MOVE      SP70,CASMX002
          MOVE      SP70,CASMX003
          MOVE      ZERO,CASMX006
          MOVE      ZERO,CASMX007
          MOVE      SP70,CASMX009
          MOVE      SP70,CASMX010
          MOVE      SP70,CASMX011
          MOVE      SP70,CASMX012
          MOVE      ZERO,CASMX013
          MOVE      SP70,CASMX014
.
          MOVE      SP70,FVGRP001
          MOVE      SP70,FVGRP002
          MOVE      SP70,FVGRP003
          MOVE      SP70,FVGRP004
          MOVE      SP70,FVGRP005
          MOVE      SP70,FVGRP006
          MOVE      SP70,FVGRP007
          MOVE      SP70,FVGRP008
          MOVE      SP70,FVGRP009
          MOVE      ZERO,FLAGLEFD
.
          MOVE      SP70,CPYMX001
          MOVE      SP70,CPYMX002
          MOVE      SP70,CPYMX003
          MOVE      SP70,CPYMX004
.
          MOVE      SP70,MSCHG001
          MOVE      SP70,MSCHG002
...       MOVE      SP70,MSCHG003                * (no longer used)
          MOVE      SP70,MSCHG004
          MOVE      SP70,MSCHG005
          MOVE      ZERO,MSCHG006
          MOVE      SP70,MSCHG007
          MOVE      ZERO,MSCHG008
          MOVE      ZERO,MSCHG009
          MOVE      ZERO,MSCHG010
          MOVE      ZERO,MSCHG011
          MOVE      ZERO,MSCHG012
          MOVE      SP70,MSCHG013
          MOVE      SP70,MSCHG014
          MOVE      ZERO,MSCHG015
          MOVE      SP70,MSCHG016
          MOVE      SP70,MSCHG017
          MOVE      SP70,MSCHG018
          MOVE      SP70,MSCHG019
          MOVE      SP70,MSCHG020
          MOVE      SP70,MSCHG021
          MOVE      SP70,MSCHG022
          MOVE      SP70,MSCHG023
          MOVE      SP70,MSCHG024
          MOVE      ZERO,MSCHG025
          MOVE      ZERO,MSCHG026
          MOVE      ZERO,MSCHG027
          MOVE      ZERO,MSCHG028
          MOVE      SP70,MSCHG029
          MOVE      SP70,MSCHG030
          MOVE      SP70,MSCHG031
          MOVE      SP70,MSCHG032
          MOVE      SP70,MSCHG033
          MOVE      SP70,MSCHG034
          MOVE      SP70,MSCHG035
          MOVE      SP70,MSCHG036
.
          MOVE      SP70,CASTH001
          MOVE      SP70,CASTH002
          MOVE      SP70,CASTH003
          MOVE      SP70,CASTH004
          MOVE      SP70,CASTH005
          MOVE      SP70,CASTH006
          MOVE      ZERO,CASTH007
          MOVE      ZERO,CASTH008
          MOVE      ZERO,CASTH009
          MOVE      SP70,CASTH010
          MOVE      SP70,CASTH011
          MOVE      SP70,CASTH012
          MOVE      SP70,CPYTH001
          MOVE      SP70,CPYTH002
          MOVE      SP70,CPYTH003
          MOVE      SP70,CPYTH004
          MOVE      SP70,CPYTH005
          MOVE      SP70,CPYTH006
.
          MOVE      SP70,PTCAT001
          MOVE      SP70,PTCAT002
          MOVE      SP70,PTCAT003
          MOVE      SP70,PTCAT004
          MOVE      SP70,PTCAT005
.
          MOVE      SP70,COPYFLAG
          MOVE      SP70,FROMDATE 
          MOVE      SP70,BFEEDATE 
          MOVE      SP70,BFEETIME 
          MOVE      ZERO,RECALCHG 
          MOVE      ZERO,UPDATEFL
          MOVE      SP70,UPDATETY
          MOVE      ZERO,SHOWFLAG
          MOVE      SP70,FILTHOSP
          MOVE      SP70,FILTOCCG
          MOVE      SP70,FILTFAVG
          MOVE      SP70,FILTUSID
          MOVE      SP70,FILTCLAM
          MOVE      SP70,FILTSYST
          MOVE      SP70,FILTDCTY
          MOVE      SP70,FILTACTV
          MOVE      SP70,COPYHOSP
          MOVE      SP70,COPYOCCG
          MOVE      SP70,COPYFAVG
          MOVE      SP70,COPYUSID
          MOVE      SP70,COPYDFTG
          MOVE      SP70,COPYGHED
          MOVE      SP70,SRCHHOSP
          MOVE      SP70,SRCHOCCG
          MOVE      SP70,SRCHUSID
          MOVE      SP70,SRCHFAVG
          MOVE      SP70,SRCHGHED
          MOVE      SP70,SRCHCITM
.
          MOVE      SP70,CDMAP001
          MOVE      SP70,CDMAP002
          MOVE      SP70,CDMAP003
          MOVE      SP70,CDMAP004
          MOVE      SP70,CDMAP005
          MOVE      SP70,CDMAP006
          MOVE      SP70,CDMAP007
          MOVE      SP70,CDMAP008
          MOVE      SP70,CDMAP009
          MOVE      SP70,CDMAP010
          MOVE      SP70,CDMAP011
          MOVE      SP70,CDMAP012
          MOVE      SP70,CDMAP013
          MOVE      SP70,CDMAP014
          MOVE      SP70,CDMAP015
.
          CALL      CPPTBE00                * Billing Defaults
.
          CALL      CPNZBF00                * NZ private bed fee
          CALL      CPNZMC00                * NZ private misc charges
          CALL      CPNZMX00                * NZ private exploding misc charges
          CALL      CPNZTF00                * NZ private theatre fee
          CALL      CPNZPF00                * NZ private procedure fee
          CALL      CPNZCF00                * NZ private contract funding
          CALL      CPNZPT00                * NZ private provider type
.
          MOVE      SP70,DNTSHWIN
.
          MOVE      ONE,F2
          WHILE     F2 <= 20
            MOVE      SP70,MBFUID[F2]
            MOVE      SP70,MBFCLM[F2]
            MOVE      SP70,MBFHFN[F2]
            MOVE      SP70,MBFATP[F2]
            ADD       ONE,F2
          DO
.
          MOVE      ZERO,MULTCNT1
          MOVE      ZERO,MULTCNT2
          MOVE      ZERO,MULTCNT3 
.
          MOVE      ONE,F3
          WHILE     F3 < 999 
            ADD       ONE,F3
            MOVE      SP70,MULT1ARR[F3]
          DO
.
          MOVE      ONE,F3
          WHILE     F3 < 999
            ADD       ONE,F3
            MOVE      SP70,MULT2ARR[F3]
          DO
.
          MOVE      ONE,F3
          WHILE     F3 < 999
            ADD       ONE,F3
            MOVE      SP70,MULT3ARR[F3]
          DO
.
CLRPAR99  RETURN
.
.------------------------------------------------------------
. Set Parameters
.------------------------------------------------------------
SETPAR00  MATCH     "reportno=",QRYNAME
          IF        @EQUAL
            MOVE      QRYDATA,REPORTNO
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "cmixcode=",QRYNAME
          IF        @EQUAL
            MOVE      QRYDATA,CMIXCODE
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "template=",QRYNAME
          IF        @EQUAL
            MOVE      QRYDATA,TEMPLATE
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "viewtype=",QRYNAME
          IF        @EQUAL
            MOVE      QRYDATA,VIEWTYPE
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "showtype=",QRYNAME
          IF        @EQUAL
            MOVE      QRYDATA,SHOWTYPE
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "nextpage=",QRYNAME
          IF        @EQUAL
            MOVE      QRYDATA,NEXTPAGE
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "redirect=",QRYNAME
          IF        @EQUAL
            MOVE      QRYDATA,REDIRECT
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "redirec1=",QRYNAME
          IF        @EQUAL
            ENDSET    REDIRECT
            APPEND    QRYDATA,REDIRECT
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "menuflag=",QRYNAME
          IF        @EQUAL
            MOVE      QRYDATA,MENUFLAG
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "startkey=",QRYNAME
          IF        @EQUAL
            MOVE      QRYDATA,STARTKEY
            PACK      STARTKEY,STARTKEY,SP70
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "norecord=",QRYNAME
          IF        @EQUAL
            MOVE      QRYDATA,NORECORD
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "startnum=",QRYNAME
          IF        @EQUAL
            MOVE      QRYDATA,STARTNUM
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "updttype=",QRYNAME
          IF        @EQUAL
            MOVE      QRYDATA,UPDTTYPE
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "keywords=",QRYNAME
          IF        @EQUAL
            MOVE      QRYDATA,KEYWORDS
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "copyflag=",QRYNAME
          IF        @EQUAL
            MOVE      QRYDATA,COPYFLAG
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "fileflag=",QRYNAME
          IF        @EQUAL
            MOVE      QRYDATA,FILEFLAG
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "casetype=",QRYNAME
          IF        @EQUAL
            MOVE      QRYDATA,CASETYPE
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "checkall=",QRYNAME
          IF        @EQUAL
            MOVE      QRYDATA,CHECKALL
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "incrflag=",QRYNAME
          IF        @EQUAL
            MOVE      QRYDATA,INCRFLAG
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "recalchg=",QRYNAME
          IF        @EQUAL
            MOVE      QRYDATA,RECALCHG
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "addscren=",QRYNAME
          IF        @EQUAL
            MOVE      QRYDATA,ADDSCREN
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "fromdate=",QRYNAME
          IF        @EQUAL
            UNPACK    QRYDATA,CDAY,KEY1,MTHNAM3,KEY1,CCENT,CYEAR
            CALL      SETMTH00                *Set CMON from MTHNAM3
            PACK      FROMDATE,CCENT,CYEAR,CMON,CDAY,SP70
            REP       " 0",FROMDATE
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "bfeedate=",QRYNAME
          IF        @EQUAL
            UNPACK    QRYDATA,CDAY,KEY1,MTHNAM3,KEY1,CCENT,CYEAR
            CALL      SETMTH00                *Set CMON from MTHNAM3
            PACK      BFEEDATE,CCENT,CYEAR,CMON,CDAY,SP70
            REP       " 0",BFEEDATE
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "bfeetime=",QRYNAME
          IF        @EQUAL
            MOVE      QRYDATA,BFEETIME
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "cpfee",QRYNAME
          IF        @EQUAL
            CALL      CPFEE000
            COMPARE   ZERO,EXIT
            GOTO      SETPAR99 IF EQUAL
          ENDIF
.
          MATCH     "bdfee",QRYNAME
          IF        @EQUAL
            CALL      STFEE000
            COMPARE   ZERO,EXIT
            GOTO      SETPAR99 IF EQUAL
          ENDIF
.
          MATCH     "opchg",QRYNAME
          IF        @EQUAL
            CALL      STCHG000
            COMPARE   ZERO,EXIT
            GOTO      SETPAR99 IF EQUAL
          ENDIF
.
          MATCH     "casmx",QRYNAME
          IF        @EQUAL
            CALL      CSMIX000
            COMPARE   ZERO,EXIT
            GOTO      SETPAR99 IF EQUAL
          ENDIF
.
          MATCH     "cpymx",QRYNAME
          IF        @EQUAL
            CALL      CPMIX000
            COMPARE   ZERO,EXIT
            GOTO      SETPAR99 IF EQUAL
          ENDIF
.
          MATCH     "casth",QRYNAME
          IF        @EQUAL
            CALL      CSTHR000
            COMPARE   ZERO,EXIT
            GOTO      SETPAR99 IF EQUAL
          ENDIF
.
          MATCH     "cpyth",QRYNAME
          IF        @EQUAL
            CALL      CSTHC000
            COMPARE   ZERO,EXIT
            GOTO      SETPAR99 IF EQUAL
          ENDIF
.
          MATCH     "ptcat",QRYNAME
          IF        @EQUAL
            CALL      PCATC000
            COMPARE   ZERO,EXIT
            GOTO      SETPAR99 IF EQUAL
          ENDIF
.
          MATCH     "mschg",QRYNAME
          IF        @EQUAL
            CALL      SMCHG000
            COMPARE   ZERO,EXIT
            GOTO      SETPAR99 IF EQUAL
          ENDIF
.
          MATCH     "delallfg=",QRYNAME
          IF        @EQUAL
            MOVE      QRYDATA,DELALLFG
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "valdtype=",QRYNAME
          IF        @EQUAL
            MOVE      QRYDATA,VALDTYPE
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "nztfe",QRYNAME
          IF        @EQUAL
            CALL      SPNZTF00
            COMPARE   ZERO,EXIT
            GOTO      SETPAR99 IF EQUAL
          ENDIF
.
          MATCH     "cptfe",QRYNAME
          IF        @EQUAL
            CALL      CCNZTF00
            COMPARE   ZERO,EXIT
            GOTO      SETPAR99 IF EQUAL
          ENDIF
.
          MATCH     "nzpfe",QRYNAME
          IF        @EQUAL
            CALL      SPNZPF00
            COMPARE   ZERO,EXIT
            GOTO      SETPAR99 IF EQUAL
          ENDIF
.
          MATCH     "cppfe",QRYNAME
          IF        @EQUAL
            CALL      SCNZPF00
            COMPARE   ZERO,EXIT
            GOTO      SETPAR99 IF EQUAL
          ENDIF
.
.
          MATCH     "nzbfe",QRYNAME
          IF        @EQUAL
            CALL      SPNZBF00
            COMPARE   ZERO,EXIT
            GOTO      SETPAR99 IF EQUAL
          ENDIF
.
          MATCH     "cpnzb",QRYNAME
          IF        @EQUAL
            CALL      CCNZBF00
            COMPARE   ZERO,EXIT
            GOTO      SETPAR99 IF EQUAL
          ENDIF
.
          MATCH     "nzmch",QRYNAME
          IF        @EQUAL
            CALL      SPNZMC00
            COMPARE   ZERO,EXIT
            GOTO      SETPAR99 IF EQUAL
          ENDIF
.
          MATCH     "cpmch",QRYNAME
          IF        @EQUAL
            CALL      CCNZMC00
            COMPARE   ZERO,EXIT
            GOTO      SETPAR99 IF EQUAL
          ENDIF
.
          MATCH     "nzmxc",QRYNAME
          IF        @EQUAL
            CALL      SPNZMX00
            COMPARE   ZERO,EXIT
            GOTO      SETPAR99 IF EQUAL
          ENDIF
.
          MATCH     "brkdtype=",QRYNAME
          IF        @EQUAL
            MOVE      QRYDATA,BRKDTYPE
            GOTO      SETPAR99
          ENDIF     
.
          MATCH     "showrevn=",QRYNAME
          IF        @EQUAL
            MOVE      QRYDATA,SHOWREVN
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "brkdcode=",QRYNAME
          IF        @EQUAL
            MOVE      QRYDATA,BRKDCODE
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "updatefl=",QRYNAME
          IF        @EQUAL
            MOVE      QRYDATA,UPDATEFL
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "updatety=",QRYNAME
          IF        @EQUAL
            MOVE      QRYDATA,UPDATETY
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "filetype=",QRYNAME
          IF        @EQUAL
            MOVE      QRYDATA,FILETYPE
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "nzibh001=",QRYNAME
          IF        @EQUAL
            MOVE      QRYDATA,NZIBH001
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "nzibh003=",QRYNAME
          IF        @EQUAL
            MOVE      QRYDATA,NZIBH003
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "nzibh002=",QRYNAME
          IF        @EQUAL
            SQUEEZE   QRYDATA
            MOVE      QRYDATA,NZIBH002
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "nzcfn",QRYNAME 
          IF        @EQUAL
            CALL      SPNZCF00
            COMPARE   ZERO,EXIT
            GOTO      SETPAR99 IF EQUAL
          ENDIF
.
          MATCH     "nzpty",QRYNAME
          IF        @EQUAL
            CALL      SPNZPT00
            COMPARE   ZERO,EXIT
            GOTO      SETPAR99 IF EQUAL
          ENDIF
. 
.
          MATCH     "cpcfn",QRYNAME
          IF        @EQUAL
            CALL      CCNZCF00
            COMPARE   ZERO,EXIT
            GOTO      SETPAR99 IF EQUAL
          ENDIF
.
          MATCH     "mlcfn001=",QRYNAME
          IF        @EQUAL
            SQUEEZE   QRYDATA
            MOVE      QRYDATA,MLCFN001
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "dntshwin=",QRYNAME
          IF        @EQUAL
            MOVE      QRYDATA,DNTSHWIN
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "uid00",QRYNAME
          IF        @EQUAL
            CALL      STUID000
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "clm00",QRYNAME
          IF        @EQUAL
            CALL      STCLM000
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "hfn00",QRYNAME
          IF        @EQUAL
            CALL      STHFN000
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "atp00",QRYNAME
          IF        @EQUAL
            CALL      STATP000
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "alloccid=",QRYNAME
          IF        @EQUAL
            MOVE      QRYDATA,alloccid
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "fvgrp",QRYNAME
          IF        @EQUAL
            CALL      STFGP000
            COMPARE   ZERO,EXIT
            GOTO      SETPAR99 IF EQUAL
          ENDIF
.
          MATCH     "showflag=",QRYNAME
          IF        @EQUAL
            MOVE      QRYDATA,SHOWFLAG
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "filthosp=",QRYNAME
          IF        @EQUAL
            PACK      FILTHOSP,QRYDATA,SP70
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "filtoccg=",QRYNAME
          IF        @EQUAL
            PACK      FILTOCCG,QRYDATA,SP70
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "filtfavg=",QRYNAME
          IF        @EQUAL
            PACK      FILTFAVG,QRYDATA,SP70
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "filtusid=",QRYNAME
          IF        @EQUAL
            PACK      FILTUSID,QRYDATA,SP70
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "filtclam=",QRYNAME
          IF        @EQUAL
            PACK      FILTCLAM,QRYDATA,SP70
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "filtsyst=",QRYNAME
          IF        @EQUAL
            PACK      FILTSYST,QRYDATA,SP70
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "filtdcty=",QRYNAME
          IF        @EQUAL
            PACK      FILTDCTY,QRYDATA,SP70
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "filtactv=",QRYNAME
          IF        @EQUAL
            PACK      FILTACTV,QRYDATA,SP70
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "copyhosp=",QRYNAME
          IF        @EQUAL
            PACK      COPYHOSP,QRYDATA,SP70
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "copyoccg=",QRYNAME
          IF        @EQUAL
            PACK      COPYOCCG,QRYDATA,SP70
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "copyfavg=",QRYNAME
          IF        @EQUAL
            PACK      COPYFAVG,QRYDATA,SP70
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "copyusid=",QRYNAME
          IF        @EQUAL
            PACK      COPYUSID,QRYDATA,SP70
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "copydftg=",QRYNAME
          IF        @EQUAL
            PACK      COPYDFTG,QRYDATA,SP70
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "copyghed=",QRYNAME
          IF        @EQUAL
            PACK      COPYGHED,QRYDATA,SP70
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "srchhosp=",QRYNAME
          IF        @EQUAL
            PACK      SRCHHOSP,QRYDATA,SP70
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "srchoccg=",QRYNAME
          IF        @EQUAL
            PACK      SRCHOCCG,QRYDATA,SP70
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "srchusid=",QRYNAME
          IF        @EQUAL
            PACK      SRCHUSID,QRYDATA,SP70
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "srchfavg=",QRYNAME
          IF        @EQUAL
            PACK      SRCHFAVG,QRYDATA,SP70
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "srchghed=",QRYNAME
          IF        @EQUAL
            PACK      SRCHGHED,QRYDATA,SP70
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "srchcitm=",QRYNAME
          IF        @EQUAL
            PACK      SRCHCITM,QRYDATA,SP70
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "ptbde",QRYNAME
          IF        @EQUAL
            CALL      SPPTB000            * Billing Defaults
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "multipl1",QRYNAME
          IF        @EQUAL
            IF        MULTCNT1 < 999
              ADD       ONE,MULTCNT1
              PACK      MULT1ARR[MULTCNT1],QRYDATA,SP70
            ENDIF
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "multipl2",QRYNAME
          IF        @EQUAL
            IF        MULTCNT2 < 999
              ADD       ONE,MULTCNT2
              PACK      MULT2ARR[MULTCNT2],QRYDATA,SP70
            ENDIF
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "multipl3",QRYNAME
          IF        @EQUAL
            IF        MULTCNT3 < 999
              ADD       ONE,MULTCNT3
              PACK      MULT3ARR[MULTCNT3],QRYDATA,SP70
            ENDIF
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "cdmap001=",QRYNAME
          IF        @EQUAL
            PACK      CDMAP001,QRYDATA,SP70
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "cdmap002=",QRYNAME
          IF        @EQUAL
            PACK      CDMAP002,QRYDATA,SP70
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "cdmap003=",QRYNAME
          IF        @EQUAL
            PACK      CDMAP003,QRYDATA,SP70
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "cdmap004=",QRYNAME
          IF        @EQUAL
            PACK      CDMAP004,QRYDATA,SP70
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "cdmap005=",QRYNAME
          IF        @EQUAL
            PACK      CDMAP005,QRYDATA,SP70
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "cdmap006=",QRYNAME
          IF        @EQUAL
            PACK      CDMAP006,QRYDATA,SP70
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "cdmap007=",QRYNAME
          IF        @EQUAL
            PACK      CDMAP007,QRYDATA,SP70
            GOTO      SETPAR99
          ENDIF
.
	  MATCH     "cdmap008=",QRYNAME
          IF        @EQUAL
            PACK      CDMAP008,QRYDATA,SP70
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "cdmap009=",QRYNAME
          IF        @EQUAL
            PACK      CDMAP009,QRYDATA,SP70
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "cdmap010=",QRYNAME
          IF        @EQUAL
            PACK      CDMAP010,QRYDATA,SP70
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "cdmap011=",QRYNAME
          IF        @EQUAL
            PACK      CDMAP011,QRYDATA,SP70
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "cdmap012=",QRYNAME
          IF        @EQUAL
            PACK      CDMAP012,QRYDATA,SP70
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "cdmap013=",QRYNAME
          IF        @EQUAL
            PACK      CDMAP013,QRYDATA,SP70
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "cdmap014=",QRYNAME
          IF        @EQUAL
            PACK      CDMAP014,QRYDATA,SP70
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "cdmap015=",QRYNAME
          IF        @EQUAL
            PACK      CDMAP015,QRYDATA,SP70
            GOTO      SETPAR99
          ENDIF
.
SETPAR99  RETURN
.------------------------------------------------------------------------------
. Set Parameters for Bed Fee Maintenance
.------------------------------------------------------------------------------
STFEE000  MOVE      ZERO,EXIT
          UNPACK    QRYNAME,KEY5,KEY3
          MOVE      KEY3,F3
.
          BRANCH    F3,STFEE001,STFEE002,STFEE003,STFEE004,STFEE005:
                       STFEE006,STFEE007,STFEE008,STFEE009,STFEE010:
                       STFEE011,STFEE012,STFEE013,STFEE014,STFEE015:
                       STFEE016
.
          MOVE      ONE,EXIT
          GOTO      STFEE999
.
STFEE001  MOVE      QRYDATA,BDFEE001
          PACK      BDFEE001,BDFEE001,SP70
          GOTO      STFEE999
.
STFEE002  MOVE      QRYDATA,BDFEE002
          PACK      BDFEE002,BDFEE002,SP70
          GOTO      STFEE999
.
STFEE003  MOVE      QRYDATA,BDFEE003
          PACK      BDFEE003,BDFEE003,SP70
          GOTO      STFEE999
.
STFEE004  MOVE      QRYDATA,BDFEE004
          PACK      BDFEE004,BDFEE004,SP70
          GOTO      STFEE999
.
STFEE005  MOVE      QRYDATA,BDFEE005
          GOTO      STFEE999
.
STFEE006  MOVE      QRYDATA,BDFEE006
          GOTO      STFEE999
.
STFEE007  MOVE      QRYDATA,BDFEE007
          GOTO      STFEE999
.
STFEE008  MOVE      QRYDATA,BDFEE008
          GOTO      STFEE999
.
STFEE009  MOVE      QRYDATA,BDFEE009
          GOTO      STFEE999
.
STFEE010  MOVE      QRYDATA,BDFEE010
          GOTO      STFEE999
.
STFEE011  MOVE      QRYDATA,BDFEE011
          GOTO      STFEE999
.
STFEE012  MOVE      QRYDATA,BDFEE012
          GOTO      STFEE999
.
STFEE013  MOVE      QRYDATA,BDFEE013
          GOTO      STFEE999
.
STFEE014  MOVE      QRYDATA,BDFEE014
          PACK      BDFEE014,BDFEE014,SP70
          GOTO      STFEE999
.
STFEE015  MOVE      QRYDATA,BDFEE015
          PACK      BDFEE015,BDFEE015,SP70
          GOTO      STFEE999
.
STFEE016  MOVE      QRYDATA,BDFEE016
          PACK      BDFEE016,BDFEE016,SP70
          GOTO      STFEE999
.
STFEE999  RETURN
.------------------------------------------------------------------------------
. Set Parameters for Copy Bed Fee function
.------------------------------------------------------------------------------
CPFEE000  MOVE      ZERO,EXIT
          UNPACK    QRYNAME,KEY5,KEY3
          MOVE      KEY3,F3
.
          MATCH     "All",QRYDATA
          IF        @EQUAL
            MOVE      SP70,QRYDATA
          ENDIF
.
          BRANCH    F3,CPFEE001,CPFEE002,CPFEE003,CPFEE004,CPFEE005
.
          MOVE      ONE,EXIT
          GOTO      CPFEE999
.
CPFEE001  MOVE      QRYDATA,CPFEE001
          PACK      CPFEE001,CPFEE001,SP70
          GOTO      CPFEE999
.
CPFEE002  MOVE      QRYDATA,CPFEE002
          PACK      CPFEE002,CPFEE002,SP70
          GOTO      CPFEE999
.
CPFEE003  MOVE      QRYDATA,CPFEE003
          PACK      CPFEE003,CPFEE003,SP70
          GOTO      CPFEE999
.
CPFEE004  MOVE      QRYDATA,CPFEE004
          PACK      CPFEE004,CPFEE004,SP70
          GOTO      CPFEE999
.
CPFEE005  MOVE      QRYDATA,CPFEE005
          GOTO      CPFEE999
.
CPFEE999  RETURN
.------------------------------------------------------------------------------
. Set Parameters for Casemix Funding Maintenance
.------------------------------------------------------------------------------
CSMIX000  MOVE      ZERO,EXIT
          UNPACK    QRYNAME,KEY5,KEY3
          MOVE      KEY3,F3
.
          MATCH     "All",QRYDATA
          IF        @EQUAL
            MOVE      SP70,QRYDATA
          ENDIF
.
          BRANCH    F3,CSMIX001,CSMIX002,CSMIX003,CSMIX004,CSMIX005:
                       CSMIX006,CSMIX007,CSMIX008,CSMIX009,CSMIX010:
                       CSMIX011,CSMIX012,CSMIX013,CSMIX014
.
          MOVE      ONE,EXIT
          GOTO      CSMIX999
.
CSMIX001  MOVE      QRYDATA,CASMX001
          PACK      CASMX001,CASMX001,SP70
          GOTO      CSMIX999
.
CSMIX002  MOVE      QRYDATA,CASMX002
          PACK      CASMX002,CASMX002,SP70
          GOTO      CSMIX999
.
CSMIX003  MOVE      QRYDATA,CASMX003
          PACK      CASMX003,CASMX003,SP70
          GOTO      CSMIX999
.
CSMIX004  
          GOTO      CSMIX999
.
CSMIX005 
          GOTO      CSMIX999
.
CSMIX006  MOVE      QRYDATA,CASMX006
          GOTO      CSMIX999
.
CSMIX007  MOVE      QRYDATA,CASMX007
          GOTO      CSMIX999
.
CSMIX008  
          GOTO      CSMIX999
.
CSMIX009  MOVE      QRYDATA,CASMX009
          PACK      CASMX009,CASMX009,SP70
          GOTO      CSMIX999
.
CSMIX010  MOVE      QRYDATA,CASMX010
          PACK      CASMX010,CASMX010,SP70
          GOTO      CSMIX999
.
CSMIX011  MOVE      QRYDATA,CASMX011
          PACK      CASMX011,CASMX011,SP70
          GOTO      CSMIX999
.
CSMIX012  MOVE      QRYDATA,CASMX012
          PACK      CASMX012,CASMX012,SP70
          GOTO      CSMIX999
.
CSMIX013  MOVE      QRYDATA,CASMX013
          GOTO      CSMIX999
.
CSMIX014  MOVE      QRYDATA,CASMX014
          GOTO      CSMIX999
.
CSMIX999  RETURN
.------------------------------------------------------------------------------
. Set Parameters for Casemix Funding Copy to HF Duplication
.------------------------------------------------------------------------------
CPMIX000  MOVE      ZERO,EXIT
          UNPACK    QRYNAME,KEY5,KEY3
          MOVE      KEY3,F3
.
          MATCH     "All",QRYDATA
          IF        @EQUAL
            MOVE      SP70,QRYDATA
          ENDIF
.
          BRANCH    F3,CPMIX001,CPMIX002,CPMIX003,CPMIX004
.
          MOVE      ONE,EXIT
          GOTO      CPMIX999
.
CPMIX001  MOVE      QRYDATA,CPYMX001
          PACK      CPYMX001,CPYMX001,SP70
          GOTO      CPMIX999
.
CPMIX002  MOVE      QRYDATA,CPYMX002
          PACK      CPYMX002,CPYMX002,SP70
          GOTO      CPMIX999
.
CPMIX003  MOVE      QRYDATA,CPYMX003
          PACK      CPYMX003,CPYMX003,SP70
          GOTO      CPMIX999
.
CPMIX004  MOVE      QRYDATA,CPYMX004
          PACK      CPYMX004,CPYMX004,SP70
          GOTO      CPMIX999
.
CPMIX999  RETURN
.------------------------------------------------------------------------------
. Set Parameters for Theatre Charges Maintenance 
.------------------------------------------------------------------------------
STCHG000  MOVE      ZERO,EXIT
          UNPACK    QRYNAME,KEY5,KEY3
          MOVE      KEY3,F3
.
          BRANCH    F3,STCHG001,STCHG002,STCHG003,STCHG004,STCHG005:
                       STCHG006,STCHG007,STCHG008,STCHG009,STCHG010:
                       STCHG011,STCHG012,STCHG013,STCHG014,STCHG015:
                       STCHG016,STCHG017,STCHG018,STCHG019,STCHG020:
                       STCHG021,STCHG022,STCHG023,STCHG024,STCHG025:
                       STCHG026,STCHG027
.
          MOVE      ONE,EXIT
          GOTO      STCHG999
.
STCHG001  MOVE      QRYDATA,OPCHG001
          PACK      OPCHG001,OPCHG001,SP70
          GOTO      STCHG999
.
STCHG002  MOVE      QRYDATA,OPCHG002
          PACK      OPCHG002,OPCHG002,SP70
          GOTO      STCHG999
.
STCHG003  MOVE      QRYDATA,OPCHG003
          PACK      OPCHG003,OPCHG003,SP70
          GOTO      STCHG999
.
STCHG004  MOVE      QRYDATA,OPCHG004
          PACK      OPCHG004,OPCHG004,SP70
          GOTO      STCHG999
.
STCHG005  MOVE      QRYDATA,OPCHG005
          PACK      OPCHG005,OPCHG005,SP70
          GOTO      STCHG999
.
STCHG006  MOVE      QRYDATA,OPCHG006
          GOTO      STCHG999
.
STCHG007  MOVE      QRYDATA,OPCHG007
          GOTO      STCHG999
.
STCHG008  MOVE      QRYDATA,OPCHG008
          GOTO      STCHG999
.
STCHG009  MOVE      QRYDATA,OPCHG009
          GOTO      STCHG999
.
STCHG010  MOVE      QRYDATA,OPCHG010
          GOTO      STCHG999
.
STCHG011  MOVE      QRYDATA,OPCHG011
          GOTO      STCHG999
.
STCHG012  MOVE      QRYDATA,OPCHG012
          GOTO      STCHG999
.
STCHG013  MOVE      QRYDATA,OPCHG013
          GOTO      STCHG999
.
STCHG014  MOVE      QRYDATA,OPCHG014
          GOTO      STCHG999
.
STCHG015  MOVE      QRYDATA,OPCHG015
          GOTO      STCHG999
.
STCHG016  MOVE      QRYDATA,OPCHG016
          GOTO      STCHG999
.
STCHG017  MOVE      QRYDATA,OPCHG017
          GOTO      STCHG999
.
STCHG018  MOVE      QRYDATA,OPCHG018
          GOTO      STCHG999
.
. Set Parameters for Theatre Charges (Health fund duplicate)
.
STCHG019  MOVE      QRYDATA,OPCHG019
          PACK      OPCHG019,OPCHG019,SP70
          GOTO      STCHG999
.
STCHG020  MOVE      QRYDATA,OPCHG020
          PACK      OPCHG020,OPCHG020,SP70
          GOTO      STCHG999
.
STCHG021  MOVE      QRYDATA,OPCHG021
          PACK      OPCHG021,OPCHG021,SP70
          GOTO      STCHG999
.
STCHG022  MOVE      QRYDATA,OPCHG022
          PACK      OPCHG022,OPCHG022,SP70
          GOTO      STCHG999
.
STCHG023  MOVE      QRYDATA,OPCHG023
          PACK      OPCHG023,OPCHG023,SP70
          GOTO      STCHG999
.
STCHG024  MOVE      QRYDATA,OPCHG024
          GOTO      STCHG999
.
STCHG025  MOVE      QRYDATA,OPCHG025
          GOTO      STCHG999
.
STCHG026  MOVE      QRYDATA,OPCHG026
          PACK      OPCHG026,OPCHG026,SP70
          GOTO      STCHG999
.
STCHG027  MOVE      QRYDATA,OPCHG027
          PACK      OPCHG027,OPCHG027,SP70
          GOTO      STCHG999
.
STCHG999  RETURN
.
.------------------------------------------------------------------------------
. Set Parameters for Miscellaneous Charges Maintenance
.------------------------------------------------------------------------------
SMCHG000  MOVE      ZERO,EXIT
          UNPACK    QRYNAME,KEY5,KEY3
          MOVE      KEY3,F3
.
          BRANCH    F3,SMCHG001,SMCHG002,SMCHG003,SMCHG004,SMCHG005:
                       SMCHG006,SMCHG007,SMCHG008,SMCHG009,SMCHG010:
                       SMCHG011,SMCHG012,SMCHG013,SMCHG014,SMCHG015:
                       SMCHG016,SMCHG017,SMCHG018,SMCHG019,SMCHG020:
                       SMCHG021,SMCHG022,SMCHG023,SMCHG024,SMCHG025:
                       SMCHG026,SMCHG027,SMCHG028,SMCHG029,SMCHG030:
                       SMCHG031,SMCHG032,SMCHG033,SMCHG034,SMCHG035:
                       SMCHG036
.
          MOVE      ONE,EXIT
          GOTO      SMCHG999
.
SMCHG001  MOVE      QRYDATA,MSCHG001
          PACK      MSCHG001,MSCHG001,SP70
          GOTO      SMCHG999
.
SMCHG002  MOVE      QRYDATA,MSCHG002
          PACK      MSCHG002,MSCHG002,SP70
          GOTO      SMCHG999
.
SMCHG003  MOVE      QRYDATA,MSCHG003        * Not in Use              *C-233045
          PACK      MSCHG003,MSCHG003,SP70
          GOTO      SMCHG999
.
SMCHG004  MOVE      QRYDATA,MSCHG004
          PACK      MSCHG004,MSCHG004,SP70
          GOTO      SMCHG999
.
SMCHG005  MOVE      QRYDATA,MSCHG005
          PACK      MSCHG005,MSCHG005,SP70
          GOTO      SMCHG999
.
SMCHG006  MOVE      QRYDATA,MSCHG006
          GOTO      SMCHG999
.
SMCHG007  MOVE      QRYDATA,MSCHG007
          PACK      MSCHG007,MSCHG007,SP70
          GOTO      SMCHG999
.
SMCHG008  MOVE      QRYDATA,MSCHG008
          GOTO      SMCHG999
.
SMCHG009  MOVE      QRYDATA,MSCHG009
          GOTO      SMCHG999
.
SMCHG010  MOVE      QRYDATA,MSCHG010
          GOTO      SMCHG999
.
SMCHG011  MOVE      QRYDATA,MSCHG011
          GOTO      SMCHG999
.
SMCHG012  MOVE      QRYDATA,MSCHG012
          GOTO      SMCHG999
.
SMCHG013  MOVE      QRYDATA,MSCHG013
          PACK      MSCHG013,MSCHG013,SP70
          GOTO      SMCHG999
.
SMCHG014  MOVE      QRYDATA,MSCHG014
          PACK      MSCHG014,MSCHG014,SP70
          GOTO      SMCHG999
.
SMCHG015  MOVE      QRYDATA,MSCHG015
          GOTO      SMCHG999
.
SMCHG016  MOVE      QRYDATA,MSCHG016
          PACK      MSCHG016,MSCHG016,SP70
          GOTO      SMCHG999
.
SMCHG017  MOVE      QRYDATA,MSCHG017
          PACK      MSCHG017,MSCHG017,SP70
          GOTO      SMCHG999
.
SMCHG018  MOVE      QRYDATA,MSCHG018
          PACK      MSCHG018,MSCHG018,SP70
          GOTO      SMCHG999
.
SMCHG019  MOVE      QRYDATA,MSCHG019
          PACK      MSCHG019,MSCHG019,SP70
          GOTO      SMCHG999
.
SMCHG020  UNPACK    QRYDATA,CDAY,KEY1,MTHNAM3,KEY1,CCENT,CYEAR
          CALL      SETMTH00            * Set CMON from MTHNAM3
          PACK      MSCHG020,CCENT,CYEAR,CMON,CDAY
          MATCH     SP70,MSCHG020
          IF        !@EQUAL
            REP       " 0",MSCHG020
          ENDIF
          GOTO      SMCHG999
.
SMCHG021  MOVE      QRYDATA,MSCHG021
          PACK      MSCHG021,MSCHG021,SP70
          GOTO      SMCHG999
.
SMCHG022  MOVE      QRYDATA,MSCHG022
          PACK      MSCHG022,MSCHG022,SP70
          GOTO      SMCHG999
.
SMCHG023  MOVE      QRYDATA,MSCHG023
          PACK      MSCHG023,MSCHG023,SP70
          GOTO      SMCHG999
.
SMCHG024  MOVE      QRYDATA,MSCHG024
          PACK      MSCHG024,MSCHG024,SP70
          GOTO      SMCHG999
.
SMCHG025  MOVE      QRYDATA,MSCHG025
          GOTO      SMCHG999
.
SMCHG026  MOVE      QRYDATA,MSCHG026
          GOTO      SMCHG999
.
SMCHG027  MOVE      QRYDATA,MSCHG027
          GOTO      SMCHG999
.
SMCHG028  MOVE      QRYDATA,MSCHG028
          GOTO      SMCHG999
.
SMCHG029  MOVE      QRYDATA,MSCHG029
          PACK      MSCHG029,MSCHG029,SP70
          GOTO      SMCHG999
.
SMCHG030  MOVE      QRYDATA,MSCHG030
          GOTO      SMCHG999
.
SMCHG031  MOVE      QRYDATA,MSCHG031
          GOTO      SMCHG999
.
SMCHG032  MOVE      QRYDATA,MSCHG032
          GOTO      SMCHG999
.
SMCHG033  MOVE      QRYDATA,MSCHG033
          GOTO      SMCHG999
.
SMCHG034  MOVE      QRYDATA,MSCHG034
          PACK      MSCHG034,MSCHG034,SP70
          GOTO      SMCHG999
.
SMCHG035  UNPACK    QRYDATA,CDAY,KEY1,MTHNAM3,KEY1,CCENT,CYEAR
          CALL      SETMTH00            * Set CMON from MTHNAM3
          PACK      MSCHG035,CCENT,CYEAR,CMON,CDAY
          MATCH     SP70,MSCHG035
          IF        !@EQUAL
            REP       " 0",MSCHG035
          ENDIF
SMCHG036  MOVE      QRYDATA,MSCHG036
          GOTO      SMCHG999
.
SMCHG999  RETURN
.
.------------------------------------------------------------------------------
. Set Parameters for Miscellaneous Charges Maintenance 
.------------------------------------------------------------------------------
STFGP000  MOVE      ZERO,EXIT
          UNPACK    QRYNAME,KEY5,KEY3
          MOVE      KEY3,F3
.
          BRANCH    F3,STFGP001,STFGP002,STFGP003,STFGP004,STFGP005:
                       STFGP006,STFGP007,STFGP008,STFGP009
.
          MOVE      ONE,EXIT
          GOTO      STFGP999
.
STFGP001  MOVE      QRYDATA,FVGRP001
          PACK      FVGRP001,FVGRP001,SP70
          GOTO      STFGP999
.
STFGP002  MOVE      QRYDATA,FVGRP002
          PACK      FVGRP002,FVGRP002,SP70
          GOTO      STFGP999
.
STFGP003  MOVE      QRYDATA,FVGRP003
          PACK      FVGRP003,FVGRP003,SP70
          GOTO      STFGP999
.
STFGP004  MOVE      QRYDATA,FVGRP004
          PACK      FVGRP004,FVGRP004,SP70
          GOTO      STFGP999
.
STFGP005  MOVE      QRYDATA,FVGRP005
          PACK      FVGRP005,FVGRP005,SP70
          GOTO      STFGP999
.
STFGP006  MOVE      QRYDATA,FVGRP006
          PACK      FVGRP006,FVGRP006,SP70
          GOTO      STFGP999
.
STFGP007  MOVE      QRYDATA,FVGRP007
          PACK      FVGRP007,FVGRP007,SP70
          GOTO      STFGP999
.
STFGP008  MOVE      QRYDATA,FVGRP008
          PACK      FVGRP008,FVGRP008,SP70
          GOTO      STFGP999
.
STFGP009  MOVE      QRYDATA,FVGRP009
          PACK      FVGRP009,FVGRP009,SP70
          GOTO      STFGP999
.
STFGP999  RETURN
.
.------------------------------------------------------------------------------
. Set Parameters for Casemix Theatre Fee Maintenance
.------------------------------------------------------------------------------
CSTHR000  MOVE      ZERO,EXIT
          UNPACK    QRYNAME,KEY5,KEY3
          MOVE      KEY3,F3
.
          MATCH     "All",QRYDATA
          IF        @EQUAL
            MOVE      SP70,QRYDATA
          ENDIF
.
          BRANCH    F3,CSTHR001,CSTHR002,CSTHR003,CSTHR004,CSTHR005:
                       CSTHR006,CSTHR007,CSTHR008,CSTHR009,CSTHR010:
                       CSTHR011,CSTHR012
.
          MOVE      ONE,EXIT
          GOTO      CSTHR999
.
CSTHR001  MOVE      QRYDATA,CASTH001
          PACK      CASTH001,CASTH001,SP70
          GOTO      CSTHR999
.
CSTHR002  MOVE      QRYDATA,CASTH002
          PACK      CASTH002,CASTH002,SP70
          GOTO      CSTHR999
.
CSTHR003  MOVE      QRYDATA,CASTH003
          PACK      CASTH003,CASTH003,SP70
          GOTO      CSTHR999
.
CSTHR004  MOVE      QRYDATA,CASTH004
          PACK      CASTH004,CASTH004,SP70
          GOTO      CSTHR999
.
CSTHR005  MOVE      QRYDATA,CASTH005
          PACK      CASTH005,CASTH005,SP70
          GOTO      CSTHR999
.
CSTHR006  MATCH     "A",QRYDATA          * All option set
          IF        @EQUAL
            MOVE      SP70,QRYDATA
          ENDIF
          MOVE      QRYDATA,CASTH006
          PACK      CASTH006,CASTH006,SP70
          GOTO      CSTHR999
.
CSTHR007  MOVE      QRYDATA,CASTH007
          GOTO      CSTHR999
.
CSTHR008  MOVE      QRYDATA,CASTH008
          GOTO      CSTHR999
.
CSTHR009  MOVE      QRYDATA,CASTH009
          GOTO      CSTHR999
.
CSTHR010  MOVE      QRYDATA,CASTH010
          PACK      CASTH010,CASTH010,SP70
          GOTO      CSTHR999
.
CSTHR011  MOVE      QRYDATA,CASTH011
          PACK      CASTH011,CASTH011,SP70
          GOTO      CSTHR999
.
CSTHR012  MOVE      QRYDATA,CASTH012
          PACK      CASTH012,CASTH012,SP70
          GOTO      CSTHR999
.
CSTHR999  RETURN
.------------------------------------------------------------------------------
. Set Parameters for Casemix Theatre Fee Maintenance - Copy To Section
.------------------------------------------------------------------------------
CSTHC000  MOVE      ZERO,EXIT
          UNPACK    QRYNAME,KEY5,KEY3
          MOVE      KEY3,F3
.
          MATCH     "All",QRYDATA
          IF        @EQUAL
            MOVE      SP70,QRYDATA
          ENDIF
.
          BRANCH    F3,CSTHC001,CSTHC002,CSTHC003,CSTHC004,CSTHC005:
                       CSTHC006
.
          MOVE      ONE,EXIT
          GOTO      CSTHC999
.
CSTHC001  MOVE      QRYDATA,CPYTH001
          PACK      CPYTH001,CPYTH001,SP70
          GOTO      CSTHC999
.
CSTHC002  MOVE      QRYDATA,CPYTH002
          PACK      CPYTH002,CPYTH002,SP70
          GOTO      CSTHC999
.
CSTHC003  MOVE      QRYDATA,CPYTH003
          PACK      CPYTH003,CPYTH003,SP70
          GOTO      CSTHC999
.
CSTHC004  MOVE      QRYDATA,CPYTH004
          PACK      CPYTH004,CPYTH004,SP70
          GOTO      CSTHC999
.
CSTHC005  MOVE      QRYDATA,CPYTH005
          PACK      CPYTH005,CPYTH005,SP70
          GOTO      CSTHC999
.
CSTHC006  MATCH     "A",QRYDATA          * All option set
          IF        @EQUAL
            MOVE      SP70,QRYDATA
          ENDIF
          MOVE      QRYDATA,CPYTH006
          PACK      CPYTH006,CPYTH006,SP70
          GOTO      CSTHC999
.
CSTHC999  RETURN
+
.------------------------------------------------------------------------------
. Set Parameters for LGA & Catchment code allocation
.------------------------------------------------------------------------------
PCATC000  MOVE      ZERO,EXIT
          UNPACK    QRYNAME,KEY5,KEY3
          MOVE      KEY3,F3
.
          BRANCH    F3,PCATC001,PCATC002,PCATC003,PCATC004,PCATC005
          MOVE      ONE,EXIT
          GOTO      PCATC999
.
PCATC001  MOVE      QRYDATA,PTCAT001
          PACK      PTCAT001,PTCAT001,SP70
          GOTO      PCATC999
.
PCATC002  MOVE      QRYDATA,PTCAT002
          PACK      PTCAT002,PTCAT002,SP70
          GOTO      PCATC999
.
PCATC003  MOVE      QRYDATA,PTCAT003
          PACK      PTCAT003,PTCAT003,SP70
          GOTO      PCATC999
.
PCATC004  MOVE      QRYDATA,PTCAT004
          PACK      PTCAT004,PTCAT004,SP70
          GOTO      PCATC999
.
PCATC005  MOVE      QRYDATA,PTCAT005
          PACK      PTCAT005,PTCAT005,SP70
          GOTO      PCATC999
.
PCATC999  RETURN
.
.------------------------------------------------------------------------------
. Bed Fee Maintenance: Display,Add,Update,Delete
.------------------------------------------------------------------------------
BEDFEE00  RESET     UPDTTYPE
.
          MATCH     SP70,UPDTTYPE           * Display formaction
          GOTO      BEDFEE80 IF EQUAL
.
          MATCH     "A",UPDTTYPE            * Add formaction
          GOTO      BEDFEE10 IF EQUAL
.
          MATCH     "U",UPDTTYPE            * Update formaction
          GOTO      BEDFEE20 IF EQUAL
.
          MATCH     "D",UPDTTYPE            * Delete formaction
          GOTO      BEDFEE30 IF EQUAL
.
.         MATCH     "G",UPDTTYPE            * Global Update formaction
.         GOTO      BEDFEE40 IF EQUAL
.
.         MATCH     "H",UPDTTYPE            * Health Fund Duplication
.         GOTO      BEDFEE50 IF EQUAL 
.
.         MATCH     "E",UPDTTYPE            * Global Delete formaction
.         GOTO      BEDFEE60 IF EQUAL
.
.         MATCH     "C",UPDTTYPE            * Create New File
.         GOTO      BEDFEE70 IF EQUAL
.
.         MATCH     "F",UPDTTYPE            * Update New File
.         GOTO      BEDFEE75 IF EQUAL
.
          GOTO      BEDFEE93
.
BEDFEE10  
.         MATCH     "N",FILEFLAG
.         GOTO      BEDFEE15 IF EQUAL
          PACK      KEY27,BDFEE001,BDFEE002,BDFEE003,BDFEE004,BDFEE005,BDFEE014,BDFEE006
          CALL      RDBFEE1                 * Add into Current File
          COMPARE   ZERO,OVRCD
          GOTO      BEDFEE92 IF EQUAL
          CALL      SAVFEE00
          CALL      WRBFEE1
          GOTO      BEDFEE98
.
.BEDFEE15  PACK      KEY27,BDFEE001,BDFEE002,BDFEE003,BDFEE004,BDFEE005,BDFEE014,BDFEE006
.          CALL      RDBF1E1                 * Add into New File
.          COMPARE   ZERO,OVRCD
.          GOTO      BEDFEE92 IF EQUAL
.          CALL      SAVFEE00
.          CALL      WRBF1E1
.          GOTO      BEDFEE98
.
BEDFEE20  
.         MATCH     "N",FILEFLAG
.         GOTO      BEDFEE25 IF EQUAL
          PACK      KEY27,BDFEE001,BDFEE002,BDFEE003,BDFEE004,BDFEE005,BDFEE014,BDFEE006
          CALL      RDBFEE1                 * Update into Current File
          BRANCH    OVRCD,BEDFEE91
          CALL      SAVFEE00
          CALL      UPBFEE1
          GOTO      BEDFEE98
.
.BEDFEE25  PACK      KEY27,BDFEE001,BDFEE002,BDFEE003,BDFEE004,BDFEE005,BDFEE014,BDFEE006
.          CALL      RDBF1E1                 * Update into New File
.          BRANCH    OVRCD,BEDFEE91
.          CALL      SAVFEE00
.          CALL      UPBF1E1
.          GOTO      BEDFEE98
.
BEDFEE30  
.         MATCH     "N",FILEFLAG
.         GOTO      BEDFEE35 IF EQUAL
.
          PACK      KEY27,BDFEE001,BDFEE002,BDFEE003,BDFEE004,BDFEE005,BDFEE014,BDFEE006
          CALL      RDBFEE1                 * Delete from Current File
          BRANCH    OVRCD,BEDFEE91
          CALL      DEBFEE1
.
          CALL      ABFE0000                 * Write delete audit
.
          GOTO      BEDFEE98
.
.BEDFEE35  PACK      KEY27,BDFEE001,BDFEE002,BDFEE003,BDFEE004,BDFEE005,BDFEE014,BDFEE006
.          CALL      RDBF1E1                 * Delete from New File
.          BRANCH    OVRCD,BEDFEE91
.          CALL      DEBF1E1
.          GOTO      BEDFEE98
.
.BEDFEE40  CALL      SGLU0000                * Schedule global update
.          GOTO      BEDFEE99
.
.BEDFEE50  CALL      SHFD0000                * Schedule health fund duplication
.          GOTO      BEDFEE99
.
.BEDFEE60  CALL      SGLD0000                * Schedule global deletion        
.          GOTO      BEDFEE99
.
.BEDFEE70  CALL      SNEW0000                * Schedule new file creation
.          GOTO      BEDFEE99
.
.BEDFEE75  CALL      SUPD0000                * Schedule bed fee update
.          GOTO      BEDFEE99
.
BEDFEE80  MOVE      ZERO,EXIT
          MATCH     "4",TEMPLATE
          IF        @EQUAL
            CALL      LCKBF000                * Check if Locked
            BRANCH    EXIT,BEDFEE99
          ENDIF
.
.         MATCH     "N",FILEFLAG
.         GOTO      BEDFEE81 IF EQUAL
          PACK      KEY27,BDFEE001,BDFEE002,BDFEE003,BDFEE004,BDFEE005,BDFEE014,BDFEE006
          CALL      RDBFEE1
          IF        OVRCD=1
            CALL      CLRFEE00
          ENDIF
          GOTO      BEDFEE82
.
.BEDFEE81  MOVE      ZERO,OVRCD
.          TRAP      OVERCOND IF IO
.          OPEN      PATBF1E1,"newbfeef"
.          TRAPCLR   IO
.          BRANCH    OVRCD,BEDFEE94
.
.          MOVE      ONE,NEWFFLAG
.          PACK      KEY27,BDFEE001,BDFEE002,BDFEE003,BDFEE004,BDFEE005,BDFEE014,BDFEE006
.          CALL      RDBF1E1
.          IF        OVRCD=1
.            CALL      CLRFEE00
.          ENDIF
.
BEDFEE82  CLEAR     WEBTITLE
          MOVE      "Bed Fee Maintenance",WEBTITLE
          RESET     WEBTITLE
.
          CALL      WEBHED00   * Create Output File and Write HTML Page Header
          BRANCH    EXIT,BEDFEE99
          CALL      WEBBOD00   * Process Web Body
          CALL      WEBEND00   * Process End of HTML File
.
          MOVE      ONE,EXIT
          GOTO      BEDFEE99
.
BEDFEE91  MOVE      "Record does not exist",WEBTITLE
          CALL      WEBERR00
          MOVE      ONE,EXIT
          GOTO      BEDFEE99
.
BEDFEE92  MOVE      "Record already exists",WEBTITLE
          CALL      WEBERR00
          MOVE      ONE,EXIT
          GOTO      BEDFEE99
.
BEDFEE93  MOVE      "Invalid Form Action.",WEBTITLE
          CALL      WEBERR00
          MOVE      ONE,EXIT
          GOTO      BEDFEE99
.
BEDFEE94  MOVE      "No New File.File Must be Created First.",WEBTITLE
          CALL      WEBERR00
          MOVE      ONE,EXIT
          GOTO      BEDFEE99
.
BEDFEE98  MOVE      ZERO,EXIT
BEDFEE99  RETURN
.
.--------------------------------------------------------------------------
.*                             SNEW0000                                   *
.*   Schedule creation of new bed fee file from IBARSH10                  *
.--------------------------------------------------------------------------
SNEW0000  MOVE      "IBARSH10",SCHDPGID
          MOVE      "Create New Bed Fee File",SCHDDESC
          PACK      SCHDDATE,CCC,CYY,CMM,CDD
          REP       " 0",SCHDDATE
          CLOCK     TIME,SCHDTIME
.
.         Write Keyin parameters for Extract
.
          MOVE      ONE,KEYSTARR[1]          * Option 1 Create New File
          MOVE      ANSY,KEYSTARR[2]         * Yes to create new file
          MOVE      COPYFLAG,KEYSTARR[3]     * Start with a copy of current data
.
          MATCH     ANSY,COPYFLAG
          IF        @EQUAL
            MOVE      THREE,KEYSTCNT         * Number of Keyins  
          ELSE
            MOVE      ANSY,KEYSTARR[4]       * Yes start with a empty file 
            MOVE      FOUR,KEYSTCNT          * Number of Keyins
          ENDIF
.
          CALL      SCHPRO00   * Schedule Extract
.
SNEW9999  RETURN
.
.------------------------------------------------------------------------------
.*                             TGLU0000                                       *
.*   Schedule Update of new to Current Casemix Theatre Fee File from IBARSH10 *
.--------------------------------------------------------------------    ------
TGLU0000  MOVE      "IBARSH10",SCHDPGID
          MOVE      "Update New to Current Casemix Theatre Fee File",SCHDDESC
          PACK      SCHDDATE,CCC,CYY,CMM,CDD
          REP       " 0",SCHDDATE
          CLOCK     TIME,SCHDTIME
.
.         Write Keyin parameters for Extract
.
          MOVE      TEN7,KEYSTARR[1]         * Option 17 Update New to Current
          MOVE      ANSY,KEYSTARR[2]         * Yes to Update           
          MOVE      TWO,KEYSTCNT             * Number of Keyins  
.
          CALL      SCHPRO00   * Schedule Extract
.
TGLU9999  RETURN
.
.--------------------------------------------------------------------------
. Check if Locked - Bed Fee Maintenance
.--------------------------------------------------------------------------
LCKBF000  READ      CONTROLF,SEVENTY9;*3,PTCNBFEM
          READ      CONTROLF,HUND10;*11,PTCNWBFE
.
          MATCH     SP10,PTCNWBFE             * check if web locked
          GOTO      LCKBF990 IF EQUAL
.
          PACK      KEY10,PTCNWBFE,SP10
          CALL      RDWBSE1
          BRANCH    OVRCD,LCKBF100
          GOTO      LCKBF200
.
LCKBF100  MOVE      "Unknown User",WBSENAM
.
LCKBF200  SQUEEZE   PTCNWBFE
          CLEAR     FORMATNM
          APPEND    PTCNWBFE,FORMATNM
          APPEND    " - ",FORMATNM
          APPEND    WBSENAM,FORMATNM
          RESET     FORMATNM
          CLEAR     WEBTITLE
          APPEND    "Bed Fee Maintanence locked by ",WEBTITLE
          APPEND    FORMATNM,WEBTITLE
          RESET     WEBTITLE
          CALL      WEBERR00
          MOVE      ONE,EXIT
          GOTO      LCKBF999
.
LCKBF990  MATCH     SP70,UPDTTYPE
          GOTO      LCKBF992 IF NOT EQUAL
.
          PACK      PTCNWBFE,USERID,SP10
          WRITAB    CONTROLF,HUND10;*11,PTCNWBFE
.
LCKBF992  MOVE      ZERO,EXIT
LCKBF999  RETURN
+
.--------------------------------------------------------------------------
.*                             SGLU0000                                   *
.*   Schedule global update of bed fees from IBARSH10                     *
.--------------------------------------------------------------------------
SGLU0000  MOVE      "IBARSH10",SCHDPGID
          MOVE      "Global Update of Bed Fee Charges",SCHDDESC
          PACK      SCHDDATE,CCC,CYY,CMM,CDD
          REP       " 0",SCHDDATE
          CLOCK     TIME,SCHDTIME
.
.         Write Keyin parameters for Extract
.
          MOVE      ONE,INDEXCNT
          MOVE      THREE,KEYSTARR[INDEXCNT]          * Option
.
          ADD       ONE,INDEXCNT
          MOVE      BDFEE001,KEYSTARR[INDEXCNT]   * Claim Type
.    
          BRANCH    BDFEE011,SGLU0100             * All Health Fund
.
          MATCH     BDFEE002,SP70                 * Blank Health Fund
          GOTO      SGLU0200 IF EQUAL
.
          ADD       ONE,INDEXCNT
          MOVE      BDFEE002,KEYSTARR[INDEXCNT]   * Single Health Fund
.
          BRANCH    BDFEE012,SGLU0100             * All Health Fund Table
.
          ADD       ONE,INDEXCNT
          MOVE      BDFEE015,KEYSTARR[INDEXCNT]   * Single Health Fund Table
.
          GOTO      SGLU0300
.
SGLU0100  ADD       ONE,INDEXCNT
          MOVE      SP70,KEYSTARR[INDEXCNT]            * All Health Fund
          GOTO      SGLU0300
.
.         Blank Health Fund requires Spaces to be passed to IBARSH10.  
.         SCHPRO00 strips fields of spaces therefore, to pass spaces,
.         characters should be appended to the field.  Note: Make sure 
.         there are enough spaces to fill the whole field.
.
SGLU0200  ADD       ONE,INDEXCNT
          PACK      KEYSTARR[INDEXCNT],SP6,BLANK,SP70 * Blank Health Fund
          GOTO      SGLU0300
.
SGLU0300  ADD       ONE,INDEXCNT
          MOVE      BDFEE004,KEYSTARR[INDEXCNT]   * Admission Type
          ADD       ONE,INDEXCNT
          MOVE      BDFEE005,KEYSTARR[INDEXCNT]   * Bed Type
.
          ADD       ONE,INDEXCNT
          IF        BDFEE013=1
            MOVE      SP70,KEYSTARR[INDEXCNT]       * All Days        
          ELSE 
            MOVE      BDFEE006,KEYSTARR[INDEXCNT]   * Last day in period
          ENDIF
.
          ADD       ONE,INDEXCNT
          MOVE      INCRFLAG,KEYSTARR[INDEXCNT]   * Increase type
          ADD       ONE,INDEXCNT
          MOVE      BDFEE007,KEYSTARR[INDEXCNT]   * Patient portion
          ADD       ONE,INDEXCNT
          MOVE      BDFEE008,KEYSTARR[INDEXCNT]  * Rebate portion
          ADD       ONE,INDEXCNT
          MOVE      ANSY,KEYSTARR[INDEXCNT]      * Confirm yes to update
.
          MOVE      INDEXCNT,KEYSTCNT          * Number of Keyins
.
          CALL      SCHPRO00   * Schedule Extract
.
SGLU9999  RETURN
.
.--------------------------------------------------------------------------
.*                             SHFD0000                                   *
.*   Schedule health fund / table duplication from IBARSH10               *
.--------------------------------------------------------------------------
SHFD0000  MOVE      "IBARSH10",SCHDPGID
          MOVE      "Bed Fee Health Fund/Table Duplication",SCHDDESC
          PACK      SCHDDATE,CCC,CYY,CMM,CDD
          REP       " 0",SCHDDATE
          CLOCK     TIME,SCHDTIME
.
.         Write Keyin parameters for Extract
.
          MOVE      ONE,INDEXCNT
          MOVE      FOUR,KEYSTARR[INDEXCNT]         * Option
.
.         Copy From Section
.
          ADD       ONE,INDEXCNT
          MOVE      BDFEE001,KEYSTARR[INDEXCNT]     * Claim Type
.
          BRANCH    BDFEE011,SHFD0100             * All Health Fund
.
          MATCH     BDFEE002,SP70                 * Blank Health Fund
          GOTO      SHFD0200 IF EQUAL
.
          ADD       ONE,INDEXCNT
          MOVE      BDFEE002,KEYSTARR[INDEXCNT]   * Single Health Fund
.
          BRANCH    BDFEE012,SHFD0100             * All Health Fund Table
.
          ADD       ONE,INDEXCNT
          MOVE      BDFEE015,KEYSTARR[INDEXCNT]   * Single Health Fund Table
.
          GOTO      SHFD0300
.
SHFD0100  ADD       ONE,INDEXCNT
          MOVE      SP70,KEYSTARR[INDEXCNT]            * All Health Fund
          GOTO      SHFD0300
.
.         Blank Health Fund requires Spaces to be passed to IBARSH10.  
.         SCHPRO00 strips fields of spaces therefore, to pass spaces,
.         characters should be appended to the field.  Note: Make sure 
.         there are enough spaces to fill the whole field.
.
SHFD0200  ADD       ONE,INDEXCNT
          PACK      KEYSTARR[INDEXCNT],SP6,BLANK,SP70 * Blank Health Fund
          GOTO      SHFD0300
.
SHFD0300  ADD       ONE,INDEXCNT
          MOVE      BDFEE004,KEYSTARR[INDEXCNT]     * Admission Type
          ADD       ONE,INDEXCNT
          MOVE      BDFEE005,KEYSTARR[INDEXCNT]     * Bed Type   
.
.         Copy To Section
.
          MATCH     BDFEE001,SP70                 * Copy From All Claim Type
          IF        !@EQUAL
            ADD       ONE,INDEXCNT
            MOVE      CPFEE001,KEYSTARR[INDEXCNT] * Copy To Claim Type
          ENDIF
.
          BRANCH    BDFEE011,SHFD0500             * Copy From All Health Fund
.
          MATCH     CPFEE002,SP70                 * Copy From Blank Health Fund
          GOTO      SHFD0400 IF EQUAL
.
          ADD       ONE,INDEXCNT
          MOVE      CPFEE002,KEYSTARR[INDEXCNT]   * Single Health Fund
.
          BRANCH    BDFEE012,SHFD0500             * Copy From All HF Table
.
          ADD       ONE,INDEXCNT
          MOVE      CPFEE003,KEYSTARR[INDEXCNT]   * Single Health Fund Table
.
          GOTO      SHFD0500
.
.         Blank Health Fund requires Spaces to be passed to IBARSH10.  
.         SCHPRO00 strips fields of spaces therefore, to pass spaces,
.         characters should be appended to the field.  Note: Make sure 
.         there are enough spaces to fill the whole field.
.
SHFD0400  ADD       ONE,INDEXCNT
          PACK      KEYSTARR[INDEXCNT],SP6,BLANK,SP70 * Blank Health Fund
.
SHFD0500  MATCH     SP10,BDFEE004
          IF        !@EQUAL
            ADD       ONE,INDEXCNT
            MOVE      CPFEE004,KEYSTARR[INDEXCNT]  * Copy To Admission Type
          ENDIF
.
          MATCH     SP10,BDFEE005
          IF        !@EQUAL
            ADD       ONE,INDEXCNT
            MOVE      CPFEE005,KEYSTARR[INDEXCNT]  * Copy To Bed Type
          ENDIF
.
          ADD       ONE,INDEXCNT
          MOVE      "Y",KEYSTARR[INDEXCNT]         * Yes to Post
          ADD       ONE,INDEXCNT
          MOVE      SP70,KEYSTARR[INDEXCNT]        * Enter      
.
          MOVE      INDEXCNT,KEYSTCNT              * number of keystrokes
.
          CALL      SCHPRO00   * Schedule Extract
.
SHFD9999  RETURN
.
.--------------------------------------------------------------------------
.*                             CTHDEL00                                   *
.*   Schedule Casemix Theatre Fee Global Delete - Option 6 IBAADT28       *
.--------------------------------------------------------------------------
CTHDEL00  MOVE      "IBAADT28",SCHDPGID
          MOVE      "Casemix Theatre Fee - Global Deletion (New file)",SCHDDESC
          PACK      SCHDDATE,CCC,CYY,CMM,CDD
          REP       " 0",SCHDDATE
          CLOCK     TIME,SCHDTIME
.
.         Write Keyin parameters 

          MOVE      ZERO,F2
          MOVE      ZERO,DIFF
          MOVE      TEN1,COUNT       * Optimal Keystrokes is 11
.
          MOVE      SIX,KEYSTARR[1]         * Option
          MOVE      CASTH012,KEYSTARR[2]    * Contract ID
          MOVE      CASTH001,KEYSTARR[3]    * Claim Type
.
          MATCH     SP70,CASTH002           * Set to All so no Table Type input
          IF        @EQUAL
            SUB       ONE,COUNT             * Reduce Keystroke counter
            ASSIGN    11-COUNT,DIFF         * Set DIFF Var
            MOVE      CASTH002,KEYSTARR[4]  * Health Fund
          ELSE
            MATCH     BLANK,CASTH002          * Blank no Table Type input
            IF        @EQUAL
              SUB       ONE,COUNT             * Reduce Keystroke counter
              ASSIGN    11-COUNT,DIFF         * Set DIFF Var
              PACK      KEYSTARR[4],SP6,BLANK,SP70  * Health Fund - Blank!
            ELSE
              MOVE      CASTH003,KEYSTARR[4]  * Health Fund
              MOVE      CASTH004,KEYSTARR[5]  * Table Type       
            ENDIF
          ENDIF
.
          ASSIGN    6-DIFF,F2
          MATCH     "D",CASETYPE
          IF        @EQUAL 
            MOVE      ONE,KEYSTARR[F2]        * Set to DRG
            ASSIGN    7-DIFF,F2
            MOVE      CASTH004,KEYSTARR[F2]    * DRG Code  
          ELSE   
            MOVE      TWO,KEYSTARR[F2]         * Set to MBS
            ASSIGN    7-DIFF,F2
            MOVE      CASTH005,KEYSTARR[F2]    * MBS Code  
          ENDIF
.
          ASSIGN    8-DIFF,F2
          MOVE      CASTH006,KEYSTARR[F2]    * Day Case  
.
          ASSIGN    9-DIFF,F2
          MOVE      "Y",KEYSTARR[F2]         * Yes Delete 
.
          ASSIGN    10-DIFF,F2
          MOVE      "\",KEYSTARR[F2]         * Exit Deletion Screen
.
          ASSIGN    11-DIFF,F2
          MOVE      SP70,KEYSTARR[F2]        * Enter      
.
          MOVE      COUNT,KEYSTCNT          
.
          CALL      SCHPRO00   * Schedule Extract
.
CTHDEL99  RETURN
.--------------------------------------------------------------------------
.*                             GLFUND00                                   *
.*   Schedule Casemix Theatre Fee Health Fund duplication from IBAADT28   *
.--------------------------------------------------------------------------
GLFUND00  MOVE      "IBAADT28",SCHDPGID
          MOVE      "Casemix Theatre Fee Health Fund Duplication",SCHDDESC
          PACK      SCHDDATE,CCC,CYY,CMM,CDD
          REP       " 0",SCHDDATE
          CLOCK     TIME,SCHDTIME
.
.         Write Keyin parameters 
.
          MOVE      ZERO,F2
          MOVE      ZERO,DIFF
          MOVE      TEN7,COUNT       * Optimal Keystrokes is 17
.
          MOVE      FIVE,KEYSTARR[1]        * Option
.
.  Copy From Section
.
          MOVE      CASTH012,KEYSTARR[2]    * Contract ID
          MOVE      CASTH001,KEYSTARR[3]    * Claim Type
.
          MATCH     SP70,CASTH002           * Set to All so no Table Type input 
          IF        @EQUAL
            SUB       ONE,COUNT             * Reduce Keystroke counter
            ASSIGN    17-COUNT,DIFF         * Set DIFF Var
            MOVE      CASTH002,KEYSTARR[4]  * Health Fund
          ELSE
            MATCH     BLANK,CASTH002        * Blank No Table Type input
            IF        @EQUAL                  
              SUB       ONE,COUNT             * Reduce Keystroke counter
              ASSIGN    17-COUNT,DIFF         * Set DIFF Var
              PACK      KEYSTARR[4],SP6,BLANK,SP70  * Health Fund - Blank!
            ELSE
              MOVE      CASTH002,KEYSTARR[4]  * Health Fund
              MOVE      CASTH003,KEYSTARR[5]  * Table Type       
            ENDIF
          ENDIF
.
          ASSIGN    6-DIFF,F2
          MATCH     "D",CASETYPE
          IF        @EQUAL 
            MOVE      ONE,KEYSTARR[F2]        * Set to DRG
            ASSIGN    7-DIFF,F2
            MOVE      CASTH004,KEYSTARR[F2]    * DRG Code  
          ELSE   
            MOVE      TWO,KEYSTARR[F2]         * Set to MBS
            ASSIGN    7-DIFF,F2
            MOVE      CASTH005,KEYSTARR[F2]    * MBS Code  
          ENDIF
.
          ASSIGN    8-DIFF,F2
          MOVE      CASTH006,KEYSTARR[F2]    * Day Case  
.
.  Copy To Section
.
          MATCH     SP70,CPYTH001           * Set to All (NO KEYPRESS EVENT)
          IF        @EQUAL
            SUB       ONE,COUNT             * Reduce Keystroke counter
            ASSIGN    17-COUNT,DIFF         * Set DIFF Var
          ELSE
            ASSIGN    9-DIFF,F2
            MOVE      CPYTH001,KEYSTARR[F2]  * Copy to Claim Type
          ENDIF
.
          MATCH     SP70,CPYTH002           * Set to All (NO KEYPRESS EVENT)
          IF        @EQUAL
            SUB       ONE,COUNT             * Reduce Keystroke counter
            ASSIGN    17-COUNT,DIFF         * Set DIFF Var
          ELSE
            MATCH     BLANK,CPYTH002
            IF        @EQUAL
              SUB       ONE,COUNT             * Reduce Keystroke counter
              ASSIGN    17-COUNT,DIFF         * Set DIFF Var
              ASSIGN    10-DIFF,F2
              PACK      KEYSTARR[F2],SP6,BLANK,SP70  * Health Fund - Blank!
            ELSE
              ASSIGN    10-DIFF,F2
              MOVE      CPYTH002,KEYSTARR[F2]  * Health Fund
              ASSIGN    11-DIFF,F2
              MOVE      CPYTH003,KEYSTARR[F2]  * Table Type       
            ENDIF
          ENDIF
.
          MATCH     "D",CASETYPE
          IF        @EQUAL 
            MATCH     SP70,CPYTH004           * Set to All (NO KEYPRESS EVENT)
            IF        @EQUAL
              SUB       ONE,COUNT             * Reduce Keystroke counter
              ASSIGN    17-COUNT,DIFF         * Set DIFF Var
            ELSE
              ASSIGN    12-DIFF,F2
              MOVE      CPYTH004,KEYSTARR[F2]  * DRG Code          
            ENDIF
          ELSE   
            MATCH     SP70,CPYTH005           * Set to All (NO KEYPRESS EVENT)
            IF        @EQUAL
              SUB       ONE,COUNT             * Reduce Keystroke counter
              ASSIGN    17-COUNT,DIFF         * Set DIFF Var
            ELSE
              ASSIGN    12-DIFF,F2
              MOVE      CPYTH005,KEYSTARR[F2]  * MBS Code          
            ENDIF
          ENDIF
.
          MATCH     SP70,CPYTH006           * Set to All (NO KEYPRESS EVENT)
          IF        @EQUAL
            SUB       ONE,COUNT             * Reduce Keystroke counter
            ASSIGN    17-COUNT,DIFF         * Set DIFF Var
          ELSE
            ASSIGN    13-DIFF,F2
            MOVE      CPYTH006,KEYSTARR[F2]  * Day Case 
          ENDIF
.
          ASSIGN    14-DIFF,F2
          MOVE      ANSY,KEYSTARR[F2]       * Yes to Copy 
.
          ASSIGN    15-DIFF,F2
          MOVE      "\",KEYSTARR[F2]        * Exit Duplication Screen
.
          ASSIGN    16-DIFF,F2
          MOVE      SP70,KEYSTARR[F2]       * Press enter to exit   
.
          ASSIGN    17-DIFF,F2
          MOVE      SP70,KEYSTARR[F2]       * Exit IBAADT28
.
          MOVE      COUNT,KEYSTCNT          * Key Strokes
.
          CALL      SCHPRO00   * Schedule Extract
.
GLFUND99  RETURN
.--------------------------------------------------------------------------
.*                             CPYFEE00                                   *
.*   Schedule Copy Patient Theatre Fee - from IBAADT28                    *
.--------------------------------------------------------------------------
CPYFEE00  MOVE      "IBAADT28",SCHDPGID
          MOVE      "Copy from Patient Theatre Fee (New file)",SCHDDESC
          PACK      SCHDDATE,CCC,CYY,CMM,CDD
          REP       " 0",SCHDDATE
          CLOCK     TIME,SCHDTIME
.
.         Write Keyin parameters 
.
          MOVE      ZERO,F2
          MOVE      ZERO,DIFF
          MOVE      TEN5,COUNT            * Optimal Keystrokes is 15
.
          MOVE      SEVEN,KEYSTARR[1]     * Option
.
.  Copy From Section
.
          MOVE      CASTH012,KEYSTARR[2]    * Contract ID
          MOVE      CASTH001,KEYSTARR[3]    * Claim Type
.
          MATCH     BLANK,CASTH002          * Blank No Table input
          IF        @EQUAL                  
            SUB       ONE,COUNT             * Reduce Keystroke counter
            ASSIGN    15-COUNT,DIFF         * Set DIFF Var
            PACK      KEYSTARR[4],SP6,BLANK,SP70  * Health Fund - Blank!
          ELSE
            MOVE      CASTH002,KEYSTARR[4]  * Health Fund
            MOVE      CASTH011,KEYSTARR[5]  * Health Fund Table
          ENDIF
.
          ASSIGN    6-DIFF,F2
          MOVE      CASTH006,KEYSTARR[F2]   * Day Case  
.
          MATCH     SP70,CASTH010           * Set to All 
          IF        @EQUAL
            SUB       ONE,COUNT             * Reduce Keystroke counter
            ASSIGN    15-COUNT,DIFF         * Set DIFF Var
            ASSIGN    7-DIFF,F2
            MOVE      CASTH010,KEYSTARR[F2] * Theatre Class
            ASSIGN    8-DIFF,F2
            MOVE      CPYTH005,KEYSTARR[F2] * Copy To - Theatre Class
            GOTO      CPYFEE10   
          ELSE
            ASSIGN    7-DIFF,F2
            MOVE      CASTH010,KEYSTARR[F2] * MBS/Theatre Fee  
          ENDIF
.
.  Copy To Section
.
          ASSIGN    8-DIFF,F2
          MOVE      CASTH012,KEYSTARR[F2]   * Contract ID
.
          MATCH     "D",CASETYPE
          IF        @EQUAL
            ASSIGN    9-DIFF,F2
            MOVE      ONE,KEYSTARR[F2]         * Set to DRG
            ASSIGN    10-DIFF,F2
            MOVE      CPYTH004,KEYSTARR[F2]    * DRG Code
          ELSE
            ASSIGN    9-DIFF,F2
            MOVE      TWO,KEYSTARR[F2]         * Set to MBS
            ASSIGN    10-DIFF,F2
            MOVE      CPYTH005,KEYSTARR[F2]    * MBS Code
          ENDIF
.
CPYFEE10  ASSIGN    11-DIFF,F2
          MOVE      CPYTH006,KEYSTARR[F2]   * Day Case    
.
          ASSIGN    12-DIFF,F2
          MOVE      ANSY,KEYSTARR[F2]       * Yes to Copy 
.
          ASSIGN    13-DIFF,F2
          MOVE      "\",KEYSTARR[F2]        * Exit Copy Screen
.
          ASSIGN    14-DIFF,F2
          MOVE      SP70,KEYSTARR[F2]       * Press enter to exit   
.
          ASSIGN    15-DIFF,F2
          MOVE      SP70,KEYSTARR[F2]       * Exit IBAADT28
.
          MOVE      COUNT,KEYSTCNT          * Key Strokes
.
          CALL      SCHPRO00   * Schedule Extract
.
CPYFEE99  RETURN
.--------------------------------------------------------------------------
.*                             SGLD0000                                   *
.*   Schedule global deletion of bed fees from IBARSH10                   *
.--------------------------------------------------------------------------
SGLD0000  MOVE      "IBARSH10",SCHDPGID
          MOVE      "Bed Fee Global Deletion",SCHDDESC
          PACK      SCHDDATE,CCC,CYY,CMM,CDD
          REP       " 0",SCHDDATE
          CLOCK     TIME,SCHDTIME
.
.         Write Keyin parameters for Extract
.
          MOVE      ONE,INDEXCNT
          MOVE      FIVE,KEYSTARR[INDEXCNT]         * Option
.
          ADD       ONE,INDEXCNT
          MOVE      BDFEE001,KEYSTARR[INDEXCNT]   * Claim Type
.
          BRANCH    BDFEE011,SGLD0100             * All Health Fund
.
          MATCH     BDFEE002,SP70                 * Blank Health Fund
          GOTO      SGLD0200 IF EQUAL
.
          ADD       ONE,INDEXCNT
          MOVE      BDFEE002,KEYSTARR[INDEXCNT]   * Single Health Fund
.
          BRANCH    BDFEE012,SGLD0100             * All Health Fund Table
.
          ADD       ONE,INDEXCNT
          MOVE      BDFEE015,KEYSTARR[INDEXCNT]   * Single Health Fund Table
.
          GOTO      SGLD0300
.
SGLD0100  ADD       ONE,INDEXCNT
          MOVE      SP70,KEYSTARR[INDEXCNT]            * All Health Fund
          GOTO      SGLD0300
.
.         Blank Health Fund requires Spaces to be passed to IBARSH10.  
.         SCHPRO00 strips fields of spaces therefore, to pass spaces,
.         characters should be appended to the field.  Note: Make sure 
.         there are enough spaces to fill the whole field.
.
SGLD0200  ADD       ONE,INDEXCNT
          PACK      KEYSTARR[INDEXCNT],SP6,BLANK,SP70 * Blank Health Fund
          GOTO      SGLD0300
.
SGLD0300  ADD       ONE,INDEXCNT
          MOVE      BDFEE004,KEYSTARR[INDEXCNT]   * Admission Type
.
          ADD       ONE,INDEXCNT
          MOVE      BDFEE005,KEYSTARR[INDEXCNT]   * Bed Type          
.
          ADD       ONE,INDEXCNT
          MOVE      ANSY,KEYSTARR[INDEXCNT]         * Yes perform deletion
          MOVE      INDEXCNT,KEYSTCNT           * Number of Keyins
.
          CALL      SCHPRO00   * Schedule Extract
.
SGLD9999  RETURN
.
.--------------------------------------------------------------------------
.*                             SUPD0000                                   *
.*   Schedule update of bed fee file from IBARSH10                      *
.--------------------------------------------------------------------------
SUPD0000  MOVE      "IBARSH10",SCHDPGID
          MOVE      "Update Bed Fee File",SCHDDESC
          PACK      SCHDDATE,CCC,CYY,CMM,CDD
          REP       " 0",SCHDDATE
          CLOCK     TIME,SCHDTIME
          MOVE      "S",SCHDPRNT
          MOVE      "1",SCHDCOPY
.
.         Write Keyin parameters for Extract
.
          MOVE      TWO,KEYSTARR[1]          * Option
          MOVE      ANSY,KEYSTARR[2]         * Yes to update charges
          IF        RECALCHG=1
            MOVE      ANSY,KEYSTARR[3]
            UNPACK    BFEEDATE,CCENT,CYEAR,CMON,CDAY
            PACK      KEY8,CDAY,CMON,CCENT,CYEAR,SP70
            MOVE      KEY8,KEYSTARR[4]
.
            REP       ": ",BFEETIME
            SQUEEZE   BFEETIME
            MOVE      BFEETIME,KEYSTARR[5]
.
            MOVE      ANSY,KEYSTARR[6]
            MOVE      SP70,KEYSTARR[7]
            MOVE      SEVEN,KEYSTCNT             * Number of Keyins
          ELSE
            MOVE      ANSN,KEYSTARR[3]
            MOVE      SP70,KEYSTARR[4]
            MOVE      FOUR,KEYSTCNT             * Number of Keyins
          ENDIF
.
SUPD1000  CALL      SCHPRO00   * Schedule Extract
.
SUPD9999  RETURN
.-----------------------------------------------------------
. Initialize's file data
.-----------------------------------------------------------
CLRFEE00  MOVE      SP70,BFCLM
          MOVE      SP70,BFHFUND
          MOVE      SP70,PTBFHTYP
          MOVE      SP70,BFATYPE
          MOVE      SP70,BFBTYPE
          MOVE      ZERO,BFENDDY
          MOVE      ZERO,BFPAT
          MOVE      ZERO,BFHF
          MOVE      ZERO,BFNINV
          MOVE      SP70,BFDESC
. Spare Variables
          MOVE      SP70,SBFCLM
          MOVE      SP70,SBFHFUND
          MOVE      SP70,SPTBFHTY
          MOVE      SP70,SBFEXTFD
          MOVE      SP70,SBFATYPE
          MOVE      SP70,SBFBTYPE
          MOVE      ZERO,SBFENDDY
          MOVE      ZERO,SBFPAT
          MOVE      ZERO,SBFHF
          MOVE      ZERO,SBFNINV
          MOVE      SP70,SBFDESC
          MOVE      SP70,SBFHDP
.
CLRFEE99  RETURN
.
.---------------------------------------------------------------------------
. Moves cgi variables into file variables
.---------------------------------------------------------------------------
SAVFEE00  MOVE      BDFEE001,BFCLM
          MOVE      BDFEE002,BFHFUND
          MOVE      BDFEE003,PTBFHTYP
          MOVE      BDFEE004,BFATYPE
          MOVE      BDFEE005,BFBTYPE
          MOVE      BDFEE006,BFENDDY
          MOVE      BFENDDY,DBFENDDY
          MOVE      BDFEE007,BFPAT
          MOVE      BDFEE008,BFHF
          MOVE      BDFEE009,BFNINV
          MOVE      BDFEE010,BFDESC
          MOVE      BDFEE014,PTBFCNID
.
SAVFEE99  RETURN
.
.------------------------------------------------------------
. Theare Charges Maintenance: Display,Add,Update,Delete
.------------------------------------------------------------
OPRCHG00  RESET     UPDTTYPE
.
          MATCH     SP1,UPDTTYPE
          GOTO      OPRCHG80 IF EQUAL
.
          MATCH     "A",UPDTTYPE            * Add formaction
          GOTO      OPRCHG10 IF EQUAL
.
          MATCH     "U",UPDTTYPE            * Update formaction
          GOTO      OPRCHG20 IF EQUAL
.
          MATCH     "D",UPDTTYPE            * Delete formaction
          GOTO      OPRCHG30 IF EQUAL
.
.         MATCH     "C",UPDTTYPE            * Create New Theatre Fee File
.         GOTO      OPRCHG41 IF EQUAL
.
.         MATCH     "G",UPDTTYPE            * Global Update of Charges (New)
.         GOTO      OPRCHG42 IF EQUAL
.
.         MATCH     "H",UPDTTYPE            * Health Fund/Table Duplic. (New)
.         GOTO      OPRCHG43 IF EQUAL
.
.         MATCH     "E",UPDTTYPE            * Global Delete formaction
.         GOTO      OPRCHG44 IF EQUAL
.
.         MATCH     "F",UPDTTYPE            * Update New to Current Fee File
.         GOTO      OPRCHG45 IF EQUAL
.
          GOTO      OPRCHG93
.
.         Insert New Theatre Fee
.
OPRCHG10  MOVE      OPCHG001,CLAIMCOD
          MOVE      OPCHG002,HLTHFUND
          MOVE      OPCHG005,FEECLASS
          CALL      CHKMBS00                * right justify MBS fees
          MOVE      FEECLASS,OPCHG005
.         MATCH     "N",FILEFLAG
.         GOTO      OPRCHG15 IF EQUAL
          PACK      KEY24,OPCHG001,OPCHG002,OPCHG003,OPCHG004,OPCHG005,OPCHG026,SP70
          CALL      RDTFEE1         * Add into Current File
          COMPARE   ZERO,OVRCD
          GOTO      OPRCHG92 IF EQUAL
          CALL      SAVCHG00
          CALL      WRTFEE1
          GOTO      OPRCHG98
.
.OPRCHG15  PACK      KEY24,OPCHG001,OPCHG002,OPCHG003,OPCHG004,OPCHG005,OPCHG026,SP70
.          CALL      RDTF1E1         * Add into New File
.          COMPARE   ZERO,OVRCD
.          GOTO      OPRCHG92 IF EQUAL
.          CALL      SAVCHG00
.          CALL      WRTF1E1
.          GOTO      OPRCHG98
.
.         Update Theatre Fee
.
OPRCHG20  
.         MATCH     "N",FILEFLAG
.         GOTO      OPRCHG25 IF EQUAL
          PACK      KEY24,OPCHG001,OPCHG002,OPCHG003,OPCHG004,OPCHG005,OPCHG026,SP70
          CALL      RDTFEE1         * Update into Current File
          BRANCH    OVRCD,OPRCHG91
          CALL      SAVCHG00
          CALL      UPTFEE1
          GOTO      OPRCHG98
.
.OPRCHG25  PACK      KEY24,OPCHG001,OPCHG002,OPCHG003,OPCHG004,OPCHG005,OPCHG026,SP70
.          CALL      RDTF1E1         * Update into New File
.          BRANCH    OVRCD,OPRCHG91
.          CALL      SAVCHG00
.          CALL      UPTF1E1
.          GOTO      OPRCHG98
.
.         Delete Theatre Fee
.
OPRCHG30  
.         MATCH     "N",FILEFLAG
.         GOTO      OPRCHG35 IF EQUAL
          PACK      KEY24,OPCHG001,OPCHG002,OPCHG003,OPCHG004,OPCHG005,OPCHG026,SP70
          CALL      RDTFEE1         * Delete from Current File
          BRANCH    OVRCD,OPRCHG91
          CALL      DETFEE1
.
          CALL      ATFE0000                 * Write delete audit
.
          GOTO      OPRCHG98
.
.OPRCHG35  PACK      KEY24,OPCHG001,OPCHG002,OPCHG003,OPCHG004,OPCHG005,OPCHG026,SP70
.          CALL      RDTF1E1         * Delete from New File
.          BRANCH    OVRCD,OPRCHG91
.          CALL      DETF1E1
.          GOTO      OPRCHG98
.
.OPRCHG41  CALL      STFCN000       * Schedule Create New Theatre Fee File 
.          GOTO      OPRCHG98
.
.OPRCHG42  CALL      STFGU000       * Schedule Global Update of Charges (New)
.          GOTO      OPRCHG98
.
.OPRCHG43  CALL      STFGC000       * Schedule Global Copy of Theatre Fee (New)
.          GOTO      OPRCHG98
.
.OPRCHG44  CALL      STFGD000       * Schedule Global Delete of Theatre Fee(New)
.          GOTO      OPRCHG98
.
.OPRCHG45  CALL      STFRP000        * Schedule Replace Current with New File
.          GOTO      OPRCHG98
.
.         Display  
.
OPRCHG80  MOVE      ZERO,EXIT
          MATCH     "4",TEMPLATE
          IF        @EQUAL
            CALL      LCKTF000       * Check if Locked
            BRANCH    EXIT,OPRCHG99
          ENDIF
.
.         MATCH     "N",FILEFLAG
.         GOTO      OPRCHG81 IF EQUAL
          PACK      KEY24,OPCHG001,OPCHG002,OPCHG003,OPCHG004,OPCHG005,OPCHG026,SP70
          CALL      RDTFEE1
          IF        OVRCD=1
            CALL      CLRCHG00
          ENDIF
          GOTO      OPRCHG82
.
.OPRCHG81  MOVE      ZERO,OVRCD
.          TRAP      OVERCOND IF IO
.          OPEN      PATTF1E1,"newtfeef"
.          TRAPCLR   IO
.          BRANCH    OVRCD,OPRCHG94 
.
.          MOVE      ONE,NEWFFLAG
.          PACK      KEY24,OPCHG001,OPCHG002,OPCHG003,OPCHG004,OPCHG005,OPCHG026,SP70
.          CALL      RDTF1E1
.          IF        OVRCD=1
.            CALL      CLRCHG00
.          ENDIF
.
OPRCHG82  CLEAR     WEBTITLE
          MOVE      "Theatre Fee Maintenance",WEBTITLE
          RESET     WEBTITLE
.
          CALL      WEBHED00   * Create Output File and Write HTML Page Header
          BRANCH    EXIT,OPRCHG99
          CALL      WEBBOD00   * Process Web Body
          CALL      WEBEND00   * Process End of HTML File
.
          MOVE      ONE,EXIT
          GOTO      OPRCHG99
.
OPRCHG91  MOVE      "Record does not exist",WEBTITLE
          CALL      WEBERR00
          MOVE      ONE,EXIT
          GOTO      OPRCHG99
.
OPRCHG92  MOVE      "Record already exists",WEBTITLE
          CALL      WEBERR00
          MOVE      ONE,EXIT
          GOTO      OPRCHG99
.
OPRCHG93  MOVE      "Invalid Form Action.",WEBTITLE
          CALL      WEBERR00
          MOVE      ONE,EXIT
          GOTO      OPRCHG99
.
OPRCHG94  MOVE      "No New File.File Must be Created First.",WEBTITLE
          CALL      WEBERR00
          MOVE      ONE,EXIT
          GOTO      OPRCHG99
.
OPRCHG98  MOVE      ZERO,EXIT
OPRCHG99  RETURN
.
.--------------------------------------------------------------------------
. Check if Locked - Theatre Fee Maintenance
.--------------------------------------------------------------------------
LCKTF000  READ      CONTROLF,SEVENTY9;*1,PTCNTFEM
          READ      CONTROLF,HUND10;*1,PTCNWTFE
.
          MATCH     SP10,PTCNWTFE             * check if web locked
          GOTO      LCKTF990 IF EQUAL
.
          PACK      KEY10,PTCNWTFE,SP10
          CALL      RDWBSE1
          BRANCH    OVRCD,LCKTF100
          GOTO      LCKTF200 
.
LCKTF100  MOVE      "Unknown User",WBSENAM
.
LCKTF200  SQUEEZE   PTCNWTFE
          CLEAR     FORMATNM
          APPEND    PTCNWTFE,FORMATNM
          APPEND    " - ",FORMATNM
          APPEND    WBSENAM,FORMATNM
          RESET     FORMATNM
          CLEAR     WEBTITLE
          APPEND    "Theatre Fee Maintanence locked by ",WEBTITLE
          APPEND    FORMATNM,WEBTITLE
          RESET     WEBTITLE
          CALL      WEBERR00
          MOVE      ONE,EXIT
          GOTO      LCKTF999
.
LCKTF990  MOVE      ZERO,EXIT
          PACK      PTCNWTFE,USERID,SP10
          WRITAB    CONTROLF,HUND10;*1,PTCNWTFE
.
LCKTF999  RETURN
+
.--------------------------------------------------------------------------
. Check whether MBS Fee or Theatre Classification
.       MBS Fee is right justfied
.       Theatre Classification is left justfied
. Input Fields:     CLAIMCOD
.                   HLTHFUND
.                   FEECLASS
. Returns:          FEECLASS with correct justified format.      
.--------------------------------------------------------------------------
CHKMBS00  MOVE      ZERO,THCFLG
.
          PACK      KEY5,ANSC,ANSL,CLAIMCOD,SP70
          CALL      RDCODE1
          BRANCH    OVRCD,CHKMBS99
.
          MOVE      TCFORM6,THCFLG
.
          MATCH     SP70,HLTHFUND
          GOTO      CHKMBS90 IF EQUAL
          PACK      KEY14,HLTHFUND,ZERO,ZERO,ZERO,ZERO,SP70
          CALL      RDFUND1
          BRANCH    OVRCD,OCHG9999
          MOVE      HFBAND,THCFLG
.
CHKMBS90  COMPARE   ZERO,THCFLG
          GOTO      CHKMBS99 IF NOT EQUAL
.
          SQUEEZE   FEECLASS
          TYPE      FEECLASS
          GOTO      CHKMBS99 IF NOT EQUAL
          MOVE      ZERO,FORM5
          MOVE      FEECLASS,FORM5
          MOVE      FORM5,FEECLASS
.
CHKMBS99  RETURN
.
.--------------------------------------------------------------------------
. Initialize's file data
.--------------------------------------------------------------------------
CLRCHG00  MOVE      SP70,TFCLM
          MOVE      SP70,TFHFUND
          MOVE      SP70,PTTFHTYP
          MOVE      SP70,TFDAYC
          MOVE      SP70,TFENDMBS
          MOVE      ZERO,TFHF1
          MOVE      ZERO,TFPAT1
          MOVE      ZERO,TFHF2
          MOVE      ZERO,TFPAT2
          MOVE      ZERO,TFHF3
          MOVE      ZERO,TFPAT3
          MOVE      ZERO,TFHF4
          MOVE      ZERO,TFPAT4
          MOVE      ZERO,TFHF5
          MOVE      ZERO,TFPAT5
          MOVE      ZERO,TFHF6
          MOVE      ZERO,TFPAT6
          MOVE      ZERO,TFNINV
.Spare Variables
          MOVE      SP70,STFCLM
          MOVE      SP70,STFHFUND
          MOVE      SP70,STFHFTAB
          MOVE      SP70,STFENDMB
          MOVE      SP70,STFDAYC
          MOVE      ZERO,STFHF1
          MOVE      ZERO,STFPAT1
          MOVE      ZERO,STFHF2
          MOVE      ZERO,STFPAT2
          MOVE      ZERO,STFHF3
          MOVE      ZERO,STFPAT3
          MOVE      ZERO,STFHF4
          MOVE      ZERO,STFPAT4
          MOVE      ZERO,STFHF5
          MOVE      ZERO,STFPAT5
          MOVE      ZERO,STFHF6
          MOVE      ZERO,STFPAT6
          MOVE      ZERO,STFNINV
          MOVE      SP70,PTTFCNID
.
CLRCHG99  RETURN
.
.------------------------------------------------------------
. Moves cgi variables into file variables
.------------------------------------------------------------
SAVCHG00  MOVE      OPCHG001,TFCLM
          MOVE      OPCHG002,TFHFUND
          MOVE      OPCHG003,PTTFHTYP
          MOVE      OPCHG004,TFDAYC
          MOVE      OPCHG005,TFENDMBS
          MOVE      OPCHG026,PTTFCNID
          CALL      SAVTOT00
.
SAVCHG99  RETURN
.
.------------------------------------------------------------
. Save patient/rebate portion
.------------------------------------------------------------
SAVTOT00  MOVE      OPCHG006,TFHF1
          MOVE      OPCHG007,TFPAT1
          MOVE      OPCHG008,TFHF2
          MOVE      OPCHG009,TFPAT2
          MOVE      OPCHG010,TFHF3
          MOVE      OPCHG011,TFPAT3
          MOVE      OPCHG012,TFHF4
          MOVE      OPCHG013,TFPAT4
          MOVE      OPCHG014,TFHF5
          MOVE      OPCHG015,TFPAT5
          MOVE      OPCHG016,TFHF6
          MOVE      OPCHG017,TFPAT6
          MOVE      OPCHG018,TFNINV
.
SAVTOT99  RETURN
.
.--------------------------------------------------------------------------
.*                             STFCN000                                   *
.*   Schedule Create New Theatre Fee file from IBARSH10                   *
.--------------------------------------------------------------------------
STFCN000  MOVE      "IBARSH10",SCHDPGID
          MOVE      "Theatre Fee - Create New file",SCHDDESC
          PACK      SCHDDATE,CCC,CYY,CMM,CDD
          REP       " 0",SCHDDATE
          CLOCK     TIME,SCHDTIME
.
.         Write Keyin parameters 
. 
          MOVE      TEN2,KEYSTARR[1]         * Option 12 Create New File
          MOVE      ANSY,KEYSTARR[2]         * Yes to create new file
          MOVE      COPYFLAG,KEYSTARR[3]     * Start with a copy of current data
.
          MATCH     ANSY,COPYFLAG
          IF        @EQUAL
            MOVE      THREE,KEYSTCNT         * Number of Keyins
          ELSE
            MOVE      ANSY,KEYSTARR[4]       * Yes start with a empty file
            MOVE      FOUR,KEYSTCNT          * Number of Keyins
          ENDIF
.
          CALL      SCHPRO00   * Schedule Extract
.
STFCN999  RETURN
.
.--------------------------------------------------------------------------
.*                             STFGU000                                   *
.* Schedule Global Update of Theatre Fee Charges (New file) from IBABIL14 *
.--------------------------------------------------------------------------
STFGU000  MOVE      "IBABIL14",SCHDPGID
          MOVE      "Theatre Fee - Global Update of Charges (New file)",SCHDDESC
          PACK      SCHDDATE,CCC,CYY,CMM,CDD
          REP       " 0",SCHDDATE
          CLOCK     TIME,SCHDTIME
.
.         Write Keyin parameters 
.
          MOVE      ONE,INDEXCNT
          MOVE      EIGHT,KEYSTARR[INDEXCNT]      * Option
          ADD       ONE,INDEXCNT
          MOVE      OPCHG001,KEYSTARR[INDEXCNT]   * Claim Type
.
          BRANCH    OPCHG024,STFGU100             * All Health Fund
.
          MATCH     OPCHG002,SP70                 * Blank Health Fund
....      GOTO      STFGU200 IF EQUAL                                 *C-204388
          IF        @EQUAL | @EOS
            GOTO      STFGU200
          ENDIF
.
          ADD       ONE,INDEXCNT
          MOVE      OPCHG002,KEYSTARR[INDEXCNT]   * Single Health Fund
.
          BRANCH    OPCHG025,STFGU100             * All Health Fund Table
.
          ADD       ONE,INDEXCNT
          MOVE      OPCHG027,KEYSTARR[INDEXCNT]   * Single Health Fund Table
.
          GOTO      STFGU300
.
STFGU100  ADD       ONE,INDEXCNT
          MOVE      SP70,KEYSTARR[INDEXCNT]            * All Health Fund
          GOTO      STFGU300
.
.         Blank Health Fund requires Spaces to be passed to IBABIL14.  
.         SCHPRO00 strips fields of spaces therefore, to pass spaces,
.         characters should be appended to the field.  Note: Make sure 
.         there are enough spaces to fill the whole field.
.
STFGU200  ADD       ONE,INDEXCNT
          PACK      KEYSTARR[INDEXCNT],SP6,BLANK,SP70 * Blank Health Fund
          GOTO      STFGU300
.
STFGU300  ADD       ONE,INDEXCNT
          MOVE      OPCHG004,KEYSTARR[INDEXCNT]   * Day Case Rate
.
          MATCH     OPCHG005,SP70
          IF        !@EQUAL
            MOVE      OPCHG001,CLAIMCOD
            MOVE      OPCHG002,HLTHFUND
            MOVE      OPCHG005,FEECLASS
            CALL      CHKMBS00                    * right justify MBS fees
            MOVE      FEECLASS,OPCHG005
          ENDIF
          ADD       ONE,INDEXCNT
          MOVE      OPCHG005,KEYSTARR[INDEXCNT]   * MBS Fee/Theatre Class
.
          ADD       ONE,INDEXCNT
          MOVE      OPCHG018,KEYSTARR[INDEXCNT]   * $ or % Increase      
          ADD       ONE,INDEXCNT
          MOVE      OPCHG007,KEYSTARR[INDEXCNT]   * 1st Highest Pat Por Increase
          ADD       ONE,INDEXCNT
          MOVE      OPCHG006,KEYSTARR[INDEXCNT]   * 1st Highest Reb Por Increase
          ADD       ONE,INDEXCNT
          MOVE      OPCHG009,KEYSTARR[INDEXCNT]   * 2nd Highest Pat Por Increase
          ADD       ONE,INDEXCNT
          MOVE      OPCHG008,KEYSTARR[INDEXCNT]   * 2nd Highest Reb Por Increase
          ADD       ONE,INDEXCNT
          MOVE      OPCHG011,KEYSTARR[INDEXCNT]   * 3rd Highest Pat Por Increase
          ADD       ONE,INDEXCNT
          MOVE      OPCHG010,KEYSTARR[INDEXCNT]   * 3rd Highest Reb Por Increase
          ADD       ONE,INDEXCNT
          MOVE      OPCHG013,KEYSTARR[INDEXCNT]   * 4th Highest Pat Por Increase
          ADD       ONE,INDEXCNT
          MOVE      OPCHG012,KEYSTARR[INDEXCNT]   * 4th Highest Reb Por Increase
          ADD       ONE,INDEXCNT
          MOVE      OPCHG015,KEYSTARR[INDEXCNT]   * 5th Highest Pat Por Increase
          ADD       ONE,INDEXCNT
          MOVE      OPCHG014,KEYSTARR[INDEXCNT]   * 5th Highest Reb Por Increase
          ADD       ONE,INDEXCNT
          MOVE      OPCHG017,KEYSTARR[INDEXCNT]   * 6th Highest Pat Por Increase
          ADD       ONE,INDEXCNT
          MOVE      OPCHG016,KEYSTARR[INDEXCNT]   * 6th Highest Reb Por Increase
.
          ADD       ONE,INDEXCNT
          MOVE      "P",KEYSTARR[INDEXCNT]        * Post       
          ADD       ONE,INDEXCNT
          MOVE      SP70,KEYSTARR[INDEXCNT]       * Enter      
.
          MOVE      INDEXCNT,KEYSTCNT          
.
          CALL      SCHPRO00   * Schedule Extract
.
STFGU999  RETURN
.
.--------------------------------------------------------------------------
.*                             STFGC000                                   *
.*   Schedule Global Copy of New Theatre Fee file from IBABIL14           *
.--------------------------------------------------------------------------
STFGC000  MOVE      "IBABIL14",SCHDPGID
          MOVE      "Theatre Fee - Global Copy (New file)",SCHDDESC
          PACK      SCHDDATE,CCC,CYY,CMM,CDD
          REP       " 0",SCHDDATE
          CLOCK     TIME,SCHDTIME
.
.         Write Keyin parameters 
.
          MOVE      ONE,INDEXCNT
          MOVE      NINE,KEYSTARR[INDEXCNT]       * Option
.
.         Copy From Section
.
          ADD       ONE,INDEXCNT
          MOVE      OPCHG001,KEYSTARR[INDEXCNT]   * Claim Type
.
          BRANCH    OPCHG024,STFGC100             * All Health Fund
.
          MATCH     OPCHG002,SP70                 * Blank Health Fund
....      GOTO      STFGC200 IF EQUAL                                 *C-204388
          IF        @EQUAL | @EOS
            GOTO      STFGC200
          ENDIF
.
          ADD       ONE,INDEXCNT
          MOVE      OPCHG002,KEYSTARR[INDEXCNT]   * Single Health Fund
.
          BRANCH    OPCHG025,STFGC100             * All Health Fund Table
.
          ADD       ONE,INDEXCNT
          MOVE      OPCHG027,KEYSTARR[INDEXCNT]   * Single Health Fund Table
.
          GOTO      STFGC300
.
STFGC100  ADD       ONE,INDEXCNT
          MOVE      SP70,KEYSTARR[INDEXCNT]            * All Health Fund
          GOTO      STFGC300
.
.         Blank Health Fund requires Spaces to be passed to IBABIL14.  
.         SCHPRO00 strips fields of spaces therefore, to pass spaces,
.         characters should be appended to the field.  Note: Make sure 
.         there are enough spaces to fill the whole field.
.
STFGC200  ADD       ONE,INDEXCNT
          PACK      KEYSTARR[INDEXCNT],SP6,BLANK,SP70 * Blank Health Fund
          GOTO      STFGC300
.
STFGC300  ADD       ONE,INDEXCNT
          MOVE      OPCHG004,KEYSTARR[INDEXCNT]   * Day Case Rate
.
          MATCH     OPCHG005,SP70
          IF        !@EQUAL
            MOVE      OPCHG001,CLAIMCOD
            MOVE      OPCHG002,HLTHFUND
            MOVE      OPCHG005,FEECLASS
            CALL      CHKMBS00                    * right justify MBS fees
            MOVE      FEECLASS,OPCHG005
          ENDIF
          ADD       ONE,INDEXCNT
          MOVE      OPCHG005,KEYSTARR[INDEXCNT]   * MBS Fee/Theatre Class
.
.
.         Copy To Section
.
          MATCH     OPCHG001,SP70                 * Copy From All Claim Type
          IF        !@EQUAL
            ADD       ONE,INDEXCNT
            MOVE      OPCHG019,KEYSTARR[INDEXCNT] * Claim Type
          ENDIF
.
          BRANCH    OPCHG024,STFGC500             * Copy From All Health Fund
.
          MATCH     OPCHG020,SP70                 * Copy From Blank Health Fund
....      GOTO      STFGC400 IF EQUAL                                 *C-204388
          IF        @EQUAL | @EOS
            GOTO      STFGC400
          ENDIF
.
          ADD       ONE,INDEXCNT
          MOVE      OPCHG020,KEYSTARR[INDEXCNT]   * Single Health Fund
.
          BRANCH    OPCHG025,STFGC500             * Copy From All HF Table
.
          ADD       ONE,INDEXCNT
          MOVE      OPCHG021,KEYSTARR[INDEXCNT]   * Single Health Fund Table
.
          GOTO      STFGC500
.
.         Blank Health Fund requires Spaces to be passed to IBABIL14.  
.         SCHPRO00 strips fields of spaces therefore, to pass spaces,
.         characters should be appended to the field.  Note: Make sure 
.         there are enough spaces to fill the whole field.
.
STFGC400  ADD       ONE,INDEXCNT
          PACK      KEYSTARR[INDEXCNT],SP6,BLANK,SP70 * Blank Health Fund
.
STFGC500  ADD       ONE,INDEXCNT
          MOVE      OPCHG022,KEYSTARR[INDEXCNT]   * Day Case Rate
.
          MATCH     OPCHG005,SP70                 * Copy From All MBS Fee/Class
          GOTO      STFGC600 IF EQUAL
.
          MOVE      OPCHG019,CLAIMCOD
          MOVE      OPCHG020,HLTHFUND
          MOVE      OPCHG023,FEECLASS
          CALL      CHKMBS00                    * right justify MBS fees
          MOVE      FEECLASS,OPCHG023
          ADD       ONE,INDEXCNT
          MOVE      OPCHG023,KEYSTARR[INDEXCNT] * MBS Fee/Theatre Class
.
STFGC600  ADD       ONE,INDEXCNT
          MOVE      "Y",KEYSTARR[INDEXCNT]        * Yes to Post
          ADD       ONE,INDEXCNT
          MOVE      SP70,KEYSTARR[INDEXCNT]       * Enter      
          ADD       ONE,INDEXCNT
          MOVE      "\",KEYSTARR[INDEXCNT]        * \ to Exit  
          ADD       ONE,INDEXCNT
          MOVE      SP70,KEYSTARR[INDEXCNT]       * Enter      
.
          MOVE      INDEXCNT,KEYSTCNT          
.
          CALL      SCHPRO00   * Schedule Extract
.
STFGC999  RETURN
.
.--------------------------------------------------------------------------
.*                             STFGD000                                   *
.*   Schedule Global Delete of New Theatre Fee file from IBABIL14         *
.--------------------------------------------------------------------------
STFGD000  MOVE      "IBABIL14",SCHDPGID
          MOVE      "Theatre Fee - Global Delete (New file)",SCHDDESC
          PACK      SCHDDATE,CCC,CYY,CMM,CDD
          REP       " 0",SCHDDATE
          CLOCK     TIME,SCHDTIME
.
.         Write Keyin parameters 
.
          MOVE      ONE,INDEXCNT
          MOVE      TEN,KEYSTARR[INDEXCNT]       * Option
          ADD       ONE,INDEXCNT
          MOVE      OPCHG001,KEYSTARR[INDEXCNT]  * Claim Type
.
          BRANCH    OPCHG024,STFGD100             * All Health Fund

          MATCH     OPCHG002,SP70                 * Blank Health Fund
....      GOTO      STFGD200 IF EQUAL                                 *C-204388
          IF        @EQUAL | @EOS
            GOTO      STFGD200
          ENDIF
.
          ADD       ONE,INDEXCNT
          MOVE      OPCHG002,KEYSTARR[INDEXCNT]   * Single Health Fund
.
          BRANCH    OPCHG025,STFGD100             * All Health Fund Table
.
          ADD       ONE,INDEXCNT
          MOVE      OPCHG027,KEYSTARR[INDEXCNT]   * Single Health Fund Table
.
          GOTO      STFGD300
.
STFGD100  ADD       ONE,INDEXCNT
          MOVE      SP70,KEYSTARR[INDEXCNT]            * All Health Fund
          GOTO      STFGD300
.
.         Blank Health Fund requires Spaces to be passed to IBABIL14.  
.         SCHPRO00 strips fields of spaces therefore, to pass spaces,
.         characters should be appended to the field.  Note: Make sure 
.         there are enough spaces to fill the whole field.
.
STFGD200  ADD       ONE,INDEXCNT
          PACK      KEYSTARR[INDEXCNT],SP6,BLANK,SP70 * Blank Health Fund
          GOTO      STFGD300
.
STFGD300  ADD       ONE,INDEXCNT
          MOVE      OPCHG004,KEYSTARR[INDEXCNT]   * Day Case Rate
.
          MATCH     OPCHG005,SP70
          IF        !@EQUAL
            MOVE      OPCHG001,CLAIMCOD
            MOVE      OPCHG002,HLTHFUND
            MOVE      OPCHG005,FEECLASS
            CALL      CHKMBS00                    * right justify MBS fees
            MOVE      FEECLASS,OPCHG005
          ENDIF
          ADD       ONE,INDEXCNT
          MOVE      OPCHG005,KEYSTARR[INDEXCNT]   * MBS Fee/Theatre Class
.
          ADD       ONE,INDEXCNT
          MOVE      "Y",KEYSTARR[INDEXCNT]       * Yes Delete 
          ADD       ONE,INDEXCNT
          MOVE      SP70,KEYSTARR[INDEXCNT]      * Enter      
.
          MOVE      INDEXCNT,KEYSTCNT          
.
          CALL      SCHPRO00   * Schedule Extract
.
STFGD999  RETURN
.
.--------------------------------------------------------------------------
.*                             STFRP000                                   *
.*   Schedule Update Current Theatre Fee File with New File from IBARSH10 *
.--------------------------------------------------------------------------
STFRP000  MOVE      "IBARSH10",SCHDPGID
          MOVE      "Theatre Fee - Update Current file with New file",SCHDDESC
          PACK      SCHDDATE,CCC,CYY,CMM,CDD
          REP       " 0",SCHDDATE
          CLOCK     TIME,SCHDTIME
.
.         Write Keyin parameters 
. 
          MOVE      TEN3,KEYSTARR[1]         * Option 13 Update New to Current
          MOVE      ANSY,KEYSTARR[2]         * Yes to Update
          MOVE      TWO,KEYSTCNT             * Number of Keyins
.
          CALL      SCHPRO00   * Schedule Extract
.
STFRP999  RETURN
.
.------------------------------------------------------------------------------
. Casemix Funding Maintenance: Display,Add,Update,Delete
.------------------------------------------------------------------------------
CASMIX00  RESET     UPDTTYPE
          MATCH     SP70,UPDTTYPE           * Display formaction
          GOTO      CASMIX80 IF EQUAL
.
          MATCH     "A",UPDTTYPE            * Add formaction
          GOTO      CASMIX10 IF EQUAL
.
          MATCH     "U",UPDTTYPE            * Update formaction
          GOTO      CASMIX20 IF EQUAL
.
          MATCH     "D",UPDTTYPE            * Delete formaction
          GOTO      CASMIX30 IF EQUAL
.
          GOTO      CASMIX93
.
.   **********  ADD FORMACTION  **********
.
CASMIX10  PACK      KEY24,CASMX001,CASMX002,CASMX003:
                          CASMX009,SP70
          CALL      RDPTCMX1                 * Add into Current File
          COMPARE   ZERO,OVRCD
          GOTO      CASMIX92 IF EQUAL
.
          CALL      SAVCAS00
          PACK      KEY24,CASMX001,CASMX002,CASMX003:
                          CASMX009,SP70
          CALL      WRPTCMX1
          GOTO      CASMIX98
.
.   **********  UPDATE FORMACTION  **********
.
CASMIX20  PACK      KEY24,CASMX001,CASMX002,CASMX003:
                          CASMX009,SP70
          CALL      RDPTCMX1                 * Update into Current File
          BRANCH    OVRCD,CASMIX91
.
          PACK      KEY24,CASMX001,CASMX002,CASMX003:
                          CASMX009,SP70
          CALL      RDPTCMX1                 * Update into Current File
          CALL      SAVCAS00
          CALL      UPPTCMX1
          GOTO      CASMIX98
.
.   **********  DELETE FORMACTION  **********
.
CASMIX30  PACK      KEY24,CASMX001,CASMX002,CASMX003:
                          CASMX009,SP70
          CALL      RDPTCMX1                 * Delete from Current File
          BRANCH    OVRCD,CASMIX91
.
          CALL      DEPTCMX1
.
          CALL      ACMX0000                 * Write delete audit
.
          GOTO      CASMIX98
.
.   **********  DISPLAY FORMACTION  **********
.
CASMIX80  MOVE      ZERO,EXIT
          PACK      KEY24,CASMX001,CASMX002,CASMX003:
                          CASMX009,SP70
          CALL      RDPTCMX1
          IF        OVRCD=1
            CALL      CLRCAS00
          ENDIF
.
CASMIX82  CLEAR     WEBTITLE
          MOVE      "Casemix Funding Maintenance",WEBTITLE
          RESET     WEBTITLE
.
          CALL      WEBHED00   * Create Output File and Write HTML Page Header
          BRANCH    EXIT,CASMIX99
          CALL      WEBBOD00   * Process Web Body
          CALL      WEBEND00   * Process End of HTML File
.
          MOVE      ONE,EXIT
          GOTO      CASMIX99
.
CASMIX91  MOVE      "Record does not exist",WEBTITLE
          CALL      WEBERR00
          MOVE      ONE,EXIT
          GOTO      CASMIX99
.
CASMIX92  MOVE      "Record already exists",WEBTITLE
          CALL      WEBERR00
          MOVE      ONE,EXIT
          GOTO      CASMIX99
.
CASMIX93  MOVE      "Invalid Form Action.",WEBTITLE
          CALL      WEBERR00
          MOVE      ONE,EXIT
          GOTO      CASMIX99
.
CASMIX94  MOVE      "Overlapping existing Start/End Date.",WEBTITLE
          CALL      WEBERR00
          MOVE      ONE,EXIT
          GOTO      CASMIX99
.
CASMIX98  MOVE      ZERO,EXIT
CASMIX99  RETURN
+
.---------------------------------------------------------------------------
. Clear Casemix Funding Vars
.---------------------------------------------------------------------------
CLRCAS00  MOVE      SP70,PTCMCLMN    * Claim code
          MOVE      SP70,PTCMHFND    * Health Fund
          MOVE      SP70,PTCMCASM    * DRG/MBS Code
          MOVE      ZERO,PTCMXLOS    * Expected Length of Stay
          MOVE      ZERO,PTCMDIFG    * Detailed invoice flag
          MOVE      SP70,PTCMCNID    * Contract ID
          MOVE      SP70,PTCMECEQ    * Eclipse Equivalent
          MOVE      SP70,PTCMECTS    * Eclipse Type of Service
          MOVE      SP70,PTCMTRPT    * Transfer Trim Point
          MOVE      ZERO,PTCMTLOS    * Target Length of Stay
          MOVE      SP70,PTCMEHCP    * Health Care Provider
          MOVE      SP70,PTCMSPAR    * Spare
.
CLRCAS99  RETURN
.---------------------------------------------------------------------------
. Save Casemix Funding Vars
.---------------------------------------------------------------------------
SAVCAS00  MOVE      CASMX001,PTCMCLMN    * Claim code
          MOVE      CASMX002,PTCMHFND    * Health Fund
          MOVE      CASMX003,PTCMCASM    * Casemix Code
          MOVE      CASMX006,PTCMXLOS    * Expected Length of Stay
          MOVE      CASMX007,PTCMDIFG    * Detailed Invoice Flag
          MOVE      CASMX009,PTCMCNID    * Contract ID
          MOVE      CASMX010,PTCMECEQ    * Eclipse Equivalent
          MOVE      CASMX011,PTCMECTS    * Eclipse Type of Service
          MOVE      CASMX012,PTCMTRPT    * Transfer Trim Point
          MOVE      CASMX013,PTCMTLOS    * Target Length of Stay
          MOVE      CASMX014,PTCMEHCP    * Health Care Provider
          MOVE      SP70,PTCMSPAR        * Spare
.
SAVCAS99  RETURN
.------------------------------------------------------------------------------
. Miscellaneous Charges Maintenance: Display,Add,Update,Delete
.------------------------------------------------------------------------------
MSCCHG00  RESET     UPDTTYPE
          MATCH     SP70,UPDTTYPE           * Display formaction
          GOTO      MSCCHG80 IF EQUAL
.
          MATCH     "A",UPDTTYPE            * Add formaction
          GOTO      MSCCHG10 IF EQUAL
.
          MATCH     "U",UPDTTYPE            * Update formaction
          GOTO      MSCCHG20 IF EQUAL
.
          MATCH     "D",UPDTTYPE            * Delete formaction
          GOTO      MSCCHG30 IF EQUAL
.
.         Global Functions
.
          MATCH     "G",UPDTTYPE            * Generate Default Keyword file 
          GOTO      MSCCHG60 IF EQUAL
.
          GOTO      MSCCHG93
.
.   **********  ADD FORMACTION  **********
.
MSCCHG10  MOVE      ZERO,EXIT
.                                                                     *C-233046
          MOVE      MSCHG020,VALFDATE
          MOVE      MSCHG035,VALTDATE
          PACK      KEY29,MSCHG001,MSCHG002,MSCHG034,MSCHG004,MSCHG020,SP70
          CALL      VMDT0000               * Validate effective dates
          BRANCH    EXIT,MSCCHG95
.
          PACK      KEY29,MSCHG001,MSCHG002,MSCHG034,MSCHG004,MSCHG020,SP70
          CALL      RDMCHG1                 * Add into Current File
          COMPARE   ZERO,OVRCD
          GOTO      MSCCHG92 IF EQUAL
.
          CALL      SAVMSC00
          CALL      WRMCHG1
          PROC      PATMKIUP              * update default misc charge keyword
.
          BRANCH    CAUDR,MSCCHG98 
          MOVE      ANSA,ACTION
          CALL      SVMAUD00          * write new record for audit file
          CALL      WRRAUD
.
          CALL      EDAT0000              * Auto populate prev items end date
.
          GOTO      MSCCHG98
.
.   **********  UPDATE FORMACTION  **********
.
MSCCHG20  MOVE      ZERO,EXIT
.                                                                     *C-233046
          MOVE      MSCHG020,VALFDATE
          MOVE      MSCHG035,VALTDATE
          PACK      KEY29,MSCHG001,MSCHG002,MSCHG034,MSCHG004,MSCHG020,SP70
          CALL      VMDT0000               * Validate effective dates
          BRANCH    EXIT,MSCCHG95
.
          PACK      KEY29,MSCHG001,MSCHG002,MSCHG034,MSCHG004,MSCHG020,SP70
          CALL      RDMCHG1                 * Update into Current File
          BRANCH    OVRCD,MSCCHG91
.
          IF        CAUDR=ZERO
            CALL      SVMAUD00        * save before changes for audit file
          ENDIF
          CALL      SAVMSC00
          CALL      UPMCHG1
          PROC      PATMKIUP              * update default misc charge keyword
.
          BRANCH    CAUDR,MSCCHG98  
          MOVE      ANSB,ACTION
          CALL      WRRAUD            * write old record to audit file
          MOVE      ANSC,ACTION
          CALL      SVMAUD00          * write new changes to audit file
          CALL      WRRAUD
          GOTO      MSCCHG98
.
.   **********  DELETE FORMACTION  **********
.
MSCCHG30  MOVE      ZERO,EXIT
.  
          PACK      KEY29,MSCHG001,MSCHG002,MSCHG034,MSCHG004,MSCHG020,SP70
          CALL      RDMCHG1                 * Delete from New File
          BRANCH    OVRCD,MSCCHG91
.   
          CALL      DEMCHG1
.
          CALL      AMCH0000                 * Write delete audit
.
          BRANCH    CAUDR,MSCCHG98
          MOVE      "D",ACTION
          CALL      SVMAUD00          * write old record to audit file
          CALL      WRRAUD
          GOTO      MSCCHG98
. 
.   **********  GLOBAL FUNCTIONS   **********
.
MSCCHG60  CALL      MCGGN000                * Schedule gen default keyword file
          GOTO      MSCCHG99
.
.   **********  DISPLAY FORMACTION  **********
.
MSCCHG80  MOVE      ZERO,EXIT
          MATCH     "4",TEMPLATE
          IF        @EQUAL
            CALL      LCKMC000                * Check if Locked
            BRANCH    EXIT,MSCCHG99
          ENDIF
.                                                                     *C-233046
          PACK      KEY29,MSCHG001,MSCHG002,MSCHG034,MSCHG004,MSCHG020,SP70
          CALL      RDMCHG1
          IF        OVRCD=1
            CALL      CLRMSC00
          ENDIF
          GOTO      MSCCHG82
.
MSCCHG82  CLEAR     WEBTITLE
          MOVE      "Miscellaneous Charges Maintenance",WEBTITLE
          RESET     WEBTITLE
.
          CALL      WEBHED00   * Create Output File and Write HTML Page Header
          BRANCH    EXIT,MSCCHG99
          CALL      WEBBOD00   * Process Web Body
          CALL      WEBEND00   * Process End of HTML File
.
          MOVE      ONE,EXIT
          GOTO      MSCCHG99
.
MSCCHG91  MOVE      "Record does not exist",WEBTITLE
          CALL      WEBERR00
          MOVE      ONE,EXIT
          GOTO      MSCCHG99
.
MSCCHG92  MOVE      "Record already exists",WEBTITLE
          CALL      WEBERR00
          MOVE      ONE,EXIT
          GOTO      MSCCHG99
.
MSCCHG93  MOVE      "Invalid Form Action.",WEBTITLE
          CALL      WEBERR00
          MOVE      ONE,EXIT
          GOTO      MSCCHG99
.
MSCCHG94  MOVE      "No New File.File Must be Created First.",WEBTITLE
          CALL      WEBERR00
          MOVE      ONE,EXIT
          GOTO      MSCCHG99
.
MSCCHG95  MOVE      "Invalid Effective From/To Date (Overlap).",WEBTITLE
          CALL      WEBERR00
          MOVE      ONE,EXIT
          GOTO      MSCCHG99
.
MSCCHG98  MOVE      ZERO,EXIT
MSCCHG99  RETURN
.---------------------------------------------------------------------------
. Clear Miscellaneous Charges Vars
.---------------------------------------------------------------------------
CLRMSC00  MOVE      SP70,MCLMCOD    
          MOVE      SP70,MHFUND    
....      MOVE      SP70,MHFTAB                                       *D-223046
          MOVE      SP70,MCHARGE    
          MOVE      SP70,MDESC    
          MOVE      ZERO,MITMTYP    
          MOVE      SP70,MMSCGRP    
          MOVE      ZERO,MPATPOR   
          MOVE      ZERO,MHFPOR   
          MOVE      ZERO,MNINV   
          MOVE      ZERO,MINDIC   
          MOVE      ZERO,PTMCGSTA   
          MOVE      SP70,PTMCGSTC    
          MOVE      SP70,PTMCEDIE    
          MOVE      ZERO,PTMCCFCY   
          MOVE      SP70,PTMCKREB    
          MOVE      SP70,PTMCCOBD    
          MOVE      SP70,PTMCTACT    
          MOVE      SP70,PTMCTACD    
          MOVE      SP70,PTMCEFDT    
          MOVE      SP70,PTMCALGR                                     *I-103365
          MOVE      SP70,PTMCPRTR
          MOVE      SP70,PTMCECEQ
          MOVE      SP70,PTMCECTS
          MOVE      SP70,PTMCACTV
          MOVE      SP70,PTMCHFTT
          MOVE      SP70,PTMCETDT
          MOVE      SP70,PTMCEHCP
          MOVE      SP70,PTMCSPAR   * Spare
.
CLRMSC99  RETURN
.---------------------------------------------------------------------------
. Save Miscellaneous Charges Vars
.---------------------------------------------------------------------------
SAVMSC00  MOVE      MSCHG001,MCLMCOD    
          MOVE      MSCHG002,MHFUND    
...       MOVE      MSCHG003,MHFTAB              * (no longer used)   *D-233046
          MOVE      MSCHG004,MCHARGE    
          MOVE      MSCHG005,MDESC    
          MOVE      MSCHG006,MITMTYP    
          MOVE      MSCHG007,MMSCGRP    
          MOVE      MSCHG008,MPATPOR   
          MOVE      MSCHG009,MHFPOR   
          MOVE      MSCHG010,MNINV   
          MOVE      MSCHG011,MINDIC   
          MOVE      MSCHG012,PTMCGSTA   
          MOVE      MSCHG013,PTMCGSTC    
          MOVE      MSCHG014,PTMCEDIE    
          MOVE      MSCHG015,PTMCCFCY   
          MOVE      MSCHG016,PTMCKREB    
          MOVE      MSCHG017,PTMCCOBD    
          MOVE      MSCHG018,PTMCTACT    
          MOVE      MSCHG019,PTMCTACD    
          MOVE      MSCHG020,PTMCEFDT    
          MOVE      MSCHG029,PTMCALGR    
          MOVE      MSCHG030,PTMCPRTR
          MOVE      MSCHG031,PTMCECEQ
          MOVE      MSCHG032,PTMCECTS
          MOVE      MSCHG033,PTMCACTV
          MOVE      MSCHG034,PTMCHFTT
          MOVE      MSCHG035,PTMCETDT
          MOVE      MSCHG036,PTMCEHCP
          MOVE      SP70,PTCMSPAR        * Spare
.
SAVMSC99  RETURN
+
.--------------------------------------------------------------------------
.   SUBROUTINE TO SAVE ALL THE BEFORE CHANGES BEFORE WRITING TO PATADRFD
.--------------------------------------------------------------------------
SVMAUD00  MOVE      MCLMCOD,SMCLMCOD
          MOVE      MHFUND,SMHFUND
....      MOVE      MHFTAB,SMHFTAB                                    *D-233046 
          MOVE      MCHARGE,SMCHARGE
          MOVE      MDESC,SMDESC
          MOVE      MITMTYP,SMITMTYP
          MOVE      MMSCGRP,SMMSCGRP
          MOVE      MPATPOR,SMPATPOR
          MOVE      MHFPOR,SMHFPOR
          MOVE      MNINV,SMNINV
          MOVE      MINDIC,SMINDIC
          MOVE      PTMCGSTA,SPTMCGSA
          MOVE      PTMCGSTC,SPTMCGSC
          MOVE      PTMCEDIE,SPTMCEDI
          MOVE      PTMCCFCY,SPTMCCFC
          MOVE      PTMCKREB,SPTMCKRE
          MOVE      PTMCCOBD,SPTMCCOB
          MOVE      PTMCTACT,SPTMCTAT
          MOVE      PTMCTACD,SPTMCTAD
          MOVE      PTMCEFDT,SPTMCEFD
          MOVE      PTMCALGR,SPTMCALF
          MOVE      PTMCPRTR,SPTMCPRT
          MOVE      PTMCECEQ,SPTMCECE
          MOVE      PTMCECTS,SPTMCECT
          MOVE      PTMCACTV,SPTMCACT
          MOVE      PTMCHFTT,SPTMCHFT
          MOVE      PTMCETDT,SPTMCETD
          MOVE      PTMCEHCP,SPTMCEHC
.
          CALL      IBACLOCK
          PACK      KEY8,CCC,CYY,CMM,CDD       * Current Date
          REP       " 0",KEY8
          UNPACK    KEY8,ACC,AYY,AMM,ADD
.
SVMAUD99  RETURN
.--------------------------------------------------------------------------
. Check if Locked - Misc. Charges Maintenance
.--------------------------------------------------------------------------
LCKMC000  READ      CONTROLF,SEVENTY9;*31,PTCNMCHM
          READ      CONTROLF,HUND10;*31,PTCNWMCH
.
          MATCH     SP10,PTCNWMCH             * check if web locked
          GOTO      LCKMC990 IF EQUAL
.
          PACK      KEY10,PTCNWMCH,SP10
          CALL      RDWBSE1
          BRANCH    OVRCD,LCKMC100
          GOTO      LCKMC200 
.
LCKMC100  MOVE      "Unknown User",WBSENAM
.
LCKMC200  SQUEEZE   PTCNWMCH
          CLEAR     FORMATNM
          APPEND    PTCNWMCH,FORMATNM
          APPEND    " - ",FORMATNM
          APPEND    WBSENAM,FORMATNM
          RESET     FORMATNM
          CLEAR     WEBTITLE
          APPEND    "Misc. Charge Maintanence locked by ",WEBTITLE
          APPEND    FORMATNM,WEBTITLE
          RESET     WEBTITLE
          CALL      WEBERR00
          MOVE      ONE,EXIT
          GOTO      LCKMC999
.
LCKMC990  MOVE      ZERO,EXIT
          PACK      PTCNWMCH,USERID,SP10
          WRITAB    CONTROLF,HUND10;*31,PTCNWMCH
.
LCKMC999  RETURN
+
.--------------------------------------------------------------------------
.*                             MCGNW000                                   *
.*   Schedule Create New Misc Charge file from IBARSH10                   *
.--------------------------------------------------------------------------
MCGNW000  MOVE      "IBARSH10",SCHDPGID
          MOVE      "Misc Charge - Create New file",SCHDDESC
          PACK      SCHDDATE,CCC,CYY,CMM,CDD
          REP       " 0",SCHDDATE
          CLOCK     TIME,SCHDTIME
.
.         Write Keyin parameters 
. 
          MOVE      TEN4,KEYSTARR[1]         * Option 14 Create New File
          MOVE      ANSY,KEYSTARR[2]         * Yes to overwrite new file
          MOVE      COPYFLAG,KEYSTARR[3]     * Start with a copy of current data
.
          MATCH     ANSY,COPYFLAG
          IF        @EQUAL
            MOVE      THREE,KEYSTCNT         * Number of Keyins
          ELSE
            MOVE      ANSY,KEYSTARR[4]       * Yes start with a empty file
            MOVE      FOUR,KEYSTCNT          * Number of Keyins
          ENDIF
.
          CALL      SCHPRO00   * Schedule Extract
.
MCGNW999  RETURN
.
.--------------------------------------------------------------------------
.*                             MCGDP000                                   *
.*   Schedule Global Copy of New Misc Charge file from IBAHOS10           *
.--------------------------------------------------------------------------
MCGDP000  MOVE      "IBAHOS10",SCHDPGID
          MOVE      "Misc Charge - Global Copy (New file)",SCHDDESC
          PACK      SCHDDATE,CCC,CYY,CMM,CDD
          REP       " 0",SCHDDATE
          CLOCK     TIME,SCHDTIME
.
.         Write Keyin parameters 
.
          MOVE      ONE,INDEXCNT
          MOVE      EIGHT,KEYSTARR[INDEXCNT]       * Option
.
.         Copy From Section
.
          ADD       ONE,INDEXCNT
          MOVE      MSCHG001,KEYSTARR[INDEXCNT]   * Claim Type
.
.         Check the parameter that says whether or not we key in H.F.'s
.
          BRANCH    CMCNOHF,MCGDP350                                  *C-103365
.
          BRANCH    MSCHG025,MCGDP100             * All Health Fund
.
          MATCH     MSCHG002,SP70                 * Blank Health Fund
....      GOTO      MCGDP200 IF EQUAL                                 *C-193373
          IF        @EQUAL | @EOS
            GOTO      MCGDP200
          ENDIF
.
          ADD       ONE,INDEXCNT
          MOVE      MSCHG002,KEYSTARR[INDEXCNT]   * Single Health Fund
.
          BRANCH    MSCHG026,MCGDP100             * All Health Fund Table
.
          ADD       ONE,INDEXCNT
....      MOVE      MSCHG003,KEYSTARR[INDEXCNT]   * Single Health Fund Table
          MOVE      MSCHG034,KEYSTARR[INDEXCNT]   * Single H/F Table Type
.
          GOTO      MCGDP300
.
MCGDP100  ADD       ONE,INDEXCNT
          MOVE      SP70,KEYSTARR[INDEXCNT]            * All Health Fund
          GOTO      MCGDP300
.
.         Blank Health Fund requires Spaces to be passed to IBAHOS10.  
.         SCHPRO00 strips fields of spaces therefore, to pass spaces,
.         characters should be appended to the field.  Note: Make sure 
.         there are enough spaces to fill the whole field.
.
MCGDP200  ADD       ONE,INDEXCNT
          PACK      KEYSTARR[INDEXCNT],SP6,BLANK,SP70 * Blank Health Fund
          GOTO      MCGDP300
.
MCGDP300  ADD       ONE,INDEXCNT
          MOVE      MSCHG004,KEYSTARR[INDEXCNT]   * Misc Charage Code
.
.                                                        * start      *I-103365
          ADD       ONE,INDEXCNT
          MOVE      INCRFLAG,KEYSTARR[INDEXCNT]   * Increase type
          ADD       ONE,INDEXCNT
          MOVE      MSCHG008,KEYSTARR[INDEXCNT]   * Patient portion
          ADD       ONE,INDEXCNT
          MOVE      MSCHG009,KEYSTARR[INDEXCNT]  * Rebate portion
.                                                        * end        *I-103365
.
.         Copy To Section
.
MCGDP350  MATCH     MSCHG001,SP70                 * Copy From All Claim Type
          IF        !@EQUAL
            ADD       ONE,INDEXCNT
            MOVE      MSCHG021,KEYSTARR[INDEXCNT] * Claim Type
          ENDIF
.
.         Check the parameter that says whether or not we key in H.F.'s
.
          BRANCH    CMCNOHF,MCGDP500
.
          BRANCH    MSCHG025,MCGDP500             * Copy From All Health Fund
.
          MATCH     MSCHG022,SP70                 * Copy To Blank Health Fund
....      GOTO      MCGDP400 IF EQUAL                                 *C-193373
          IF        @EQUAL | @EOS
            GOTO      MCGDP400
          ENDIF
.
          ADD       ONE,INDEXCNT
          MOVE      MSCHG022,KEYSTARR[INDEXCNT]   * Single Health Fund
.
          BRANCH    MSCHG026,MCGDP500             * Copy From All HF Table
.
          ADD       ONE,INDEXCNT
          MOVE      MSCHG023,KEYSTARR[INDEXCNT]   * Single Health Fund Table
.
          GOTO      MCGDP500
.
.         Blank Health Fund requires Spaces to be passed to IBAHOS10.  
.         SCHPRO00 strips fields of spaces therefore, to pass spaces,
.         characters should be appended to the field.  Note: Make sure 
.         there are enough spaces to fill the whole field.
.
MCGDP400  ADD       ONE,INDEXCNT
          PACK      KEYSTARR[INDEXCNT],SP6,BLANK,SP70 * Blank Health Fund
.
MCGDP500  MATCH     MSCHG004,SP70                 * Copy From All Misc Charge  
          GOTO      MCGDP600 IF EQUAL
.
          ADD       ONE,INDEXCNT
          MOVE      MSCHG024,KEYSTARR[INDEXCNT]   * Misc Charge Code
.
MCGDP600  ADD       ONE,INDEXCNT
          MOVE      "Y",KEYSTARR[INDEXCNT]        * Yes to Post
          ADD       ONE,INDEXCNT
          MOVE      SP70,KEYSTARR[INDEXCNT]       * Enter      
          ADD       ONE,INDEXCNT
          MOVE      "\",KEYSTARR[INDEXCNT]        * \ to Exit  
          ADD       ONE,INDEXCNT
          MOVE      SP70,KEYSTARR[INDEXCNT]       * Enter      
.
          MOVE      INDEXCNT,KEYSTCNT          
.
          CALL      SCHPRO00   * Schedule Extract
.
MCGDP999  RETURN
.
.--------------------------------------------------------------------------
.*                             MCGDL000                                   *
.*   Schedule Global Delete of New Misc Charge file from IBAHOS10         *
.--------------------------------------------------------------------------
MCGDL000  MOVE      "IBAHOS10",SCHDPGID
          PACK      SCHDDATE,CCC,CYY,CMM,CDD
          REP       " 0",SCHDDATE
          CLOCK     TIME,SCHDTIME
.
          BRANCH    UPDFLAG,MCGDL020
.
          MOVE      "Misc Charge - Global Delete (New file)",SCHDDESC
.
.         Write Keyin parameters 
.
          MOVE      ONE,INDEXCNT
          MOVE      NINE,KEYSTARR[INDEXCNT]       * Option
          GOTO      MCGDL040
.
MCGDL020  MOVE      "Misc Charge - Global Update (New file)",SCHDDESC
.
.         Write Keyin parameters 
.
          MOVE      ONE,INDEXCNT
          MOVE      TEN,KEYSTARR[INDEXCNT]       * Option
.
MCGDL040  ADD       ONE,INDEXCNT
          MOVE      MSCHG001,KEYSTARR[INDEXCNT]  * Claim Type
.
.         Check the parameter that says whether or not we key in H.F.'s
.
          BRANCH    CMCNOHF,MCGDL300
.
          BRANCH    MSCHG025,MCGDL100             * All Health Fund

          MATCH     MSCHG002,SP70                 * Blank Health Fund
....      GOTO      MCGDL200 IF EQUAL                                 *C-193373
          IF        @EQUAL | @EOS
            GOTO      MCGDL200
          ENDIF
.
          ADD       ONE,INDEXCNT
          MOVE      MSCHG002,KEYSTARR[INDEXCNT]   * Single Health Fund
.
          BRANCH    MSCHG026,MCGDL100             * All Health Fund Table
.
          ADD       ONE,INDEXCNT
....      MOVE      MSCHG003,KEYSTARR[INDEXCNT]   * Single Health Fund Table
          MOVE      MSCHG034,KEYSTARR[INDEXCNT]   * Single H/Fund Table Type
.
          GOTO      MCGDL300
.
MCGDL100  ADD       ONE,INDEXCNT
          MOVE      SP70,KEYSTARR[INDEXCNT]            * All Health Fund
          GOTO      MCGDL300
.
.         Blank Health Fund requires Spaces to be passed to IBAHOS10.  
.         SCHPRO00 strips fields of spaces therefore, to pass spaces,
.         characters should be appended to the field.  Note: Make sure 
.         there are enough spaces to fill the whole field.
.
MCGDL200  ADD       ONE,INDEXCNT
          PACK      KEYSTARR[INDEXCNT],SP6,BLANK,SP70 * Blank Health Fund
          GOTO      MCGDL300
.
MCGDL300  ADD       ONE,INDEXCNT
          MOVE      MSCHG004,KEYSTARR[INDEXCNT]  * Misc Charge Code
.
          BRANCH    UPDFLAG,MCGDL400
.
.                                                * Misc Charge Group  *I-193373
          ADD       ONE,INDEXCNT
          MOVE      MSCHG007,KEYSTARR[INDEXCNT]
.
.                                                * Effective Date     *I-193373
          ADD       ONE,INDEXCNT
          UNPACK    MSCHG020,CCENT,CYEAR,CMON,CDAY
          PACK      KEY8,CDAY,CMON,CCENT,CYEAR
          MOVE      KEY8,KEYSTARR[INDEXCNT]      *                end *I-193373
.
          IF        DELALLFG=ONE
            ADD       ONE,INDEXCNT
            MOVE      SP70,KEYSTARR[INDEXCNT]    * Enter to remove all records
          ENDIF
.
          ADD       ONE,INDEXCNT
          MOVE      "Y",KEYSTARR[INDEXCNT]       * Yes Delete 
          ADD       ONE,INDEXCNT
          MOVE      SP70,KEYSTARR[INDEXCNT]      * Enter      
          ADD       ONE,INDEXCNT
          MOVE      SP70,KEYSTARR[INDEXCNT]      * Enter      
          GOTO      MCGDL900
.
MCGDL400  ADD       ONE,INDEXCNT
          MOVE      INCRFLAG,KEYSTARR[INDEXCNT]   * Increase type
          ADD       ONE,INDEXCNT
          MOVE      MSCHG008,KEYSTARR[INDEXCNT]   * Patient portion
          ADD       ONE,INDEXCNT
          MOVE      MSCHG009,KEYSTARR[INDEXCNT]  * Rebate portion
          ADD       ONE,INDEXCNT
          MOVE      ANSY,KEYSTARR[INDEXCNT]      * Confirm yes to update
          ADD       ONE,INDEXCNT
          MOVE      SP70,KEYSTARR[INDEXCNT]      * Enter      
          ADD       ONE,INDEXCNT
          MOVE      SP70,KEYSTARR[INDEXCNT]      * Enter      
.
MCGDL900  MOVE      INDEXCNT,KEYSTCNT          * Number of Keyins
.
          CALL      SCHPRO00   * Schedule Extract
.
MCGDL999  RETURN
.
.--------------------------------------------------------------------------
.*                             MCGUP000                                   *
.*   Schedule Update Current Misc Charge File with New File from IBARSH10 *
.--------------------------------------------------------------------------
MCGUP000  MOVE      "IBARSH10",SCHDPGID
          MOVE      "Misc Charge - Update Current file with New file",SCHDDESC
          PACK      SCHDDATE,CCC,CYY,CMM,CDD
          REP       " 0",SCHDDATE
          CLOCK     TIME,SCHDTIME
.
.         Write Keyin parameters 
. 
          MOVE      TEN5,KEYSTARR[1]       * Option 15 Update New to Current
          MOVE      ANSY,KEYSTARR[2]        * Yes to Update
          MOVE      TWO,KEYSTCNT           * Number of Keyins
.
          CALL      SCHPRO00   * Schedule Extract
.
MCGUP999  RETURN
.
.--------------------------------------------------------------------------
.*                             MCGGN000                                   *
.* Schedule Generate Default Misc Charge Item Keyword file from GENERMKI  *
.--------------------------------------------------------------------------
MCGGN000  MOVE      "GENERMKI",SCHDPGID
          MOVE      "Misc Charge - Generate Default Keyword file",SCHDDESC
          PACK      SCHDDATE,CCC,CYY,CMM,CDD
          REP       " 0",SCHDDATE
          CLOCK     TIME,SCHDTIME
.
.         Write Keyin parameters 
. 
          MOVE      ANSY,KEYSTARR[1]         * Yes to generate keyword file
          MOVE      SP10,KEYSTARR[2]         * Enter                       
          MOVE      TWO,KEYSTCNT             * Number of Keyins
.
          CALL      SCHPRO00   * Schedule Extract
.
MCGGN999  RETURN
.------------------------------------------------------------------------------
. Casemix Theatre Fee Maintenance: Display,Add,Update,Delete
.------------------------------------------------------------------------------
CASTHR00  RESET     UPDTTYPE
          MATCH     SP70,UPDTTYPE           * Display formaction
          GOTO      CASTHR80 IF EQUAL
.
          MATCH     "A",UPDTTYPE            * Add formaction
          GOTO      CASTHR10 IF EQUAL
.
          MATCH     "U",UPDTTYPE            * Update formaction
          GOTO      CASTHR20 IF EQUAL
.
          MATCH     "D",UPDTTYPE            * Delete formaction
          GOTO      CASTHR30 IF EQUAL
.
          MATCH     "H",UPDTTYPE            * Health Fund Duplication
          GOTO      CASTHR50 IF EQUAL 
.
          MATCH     "E",UPDTTYPE            * Global Delete formaction
          GOTO      CASTHR60 IF EQUAL
.
          MATCH     "G",UPDTTYPE            * Global Update formaction
          GOTO      CASTHR70 IF EQUAL
.
          MATCH     "P",UPDTTYPE            * Copy Patient Theatre Fee 
          GOTO      CASTHR75 IF EQUAL
.
          GOTO      CASTHR93
.
.   **********  ADD FORMACTION  **********
.
CASTHR10  PACK      KEY33,CASTH012,CASTH001,CASTH002,CASTH003,CASTH004,CASTH005:
                          CASTH006,CASTH007,SP70
          CALL      RDPTCTF1                 * Add into Current File
          COMPARE   ZERO,OVRCD
          GOTO      CASTHR92 IF EQUAL
.
          CALL      SAVTHR00
          CALL      WRPTCTF1
          GOTO      CASTHR98
.
.   **********  UPDATE FORMACTION  **********
.
CASTHR20  PACK      KEY33,CASTH012,CASTH001,CASTH002,CASTH003,CASTH004,CASTH005:
                          CASTH006,CASTH007,SP70
          CALL      RDPTCTF1                 * Update into Current File
          BRANCH    OVRCD,CASTHR91
.
          CALL      SAVTHR00
          CALL      UPPTCTF1
          GOTO      CASTHR98
.
.   **********  DELETE FORMACTION  **********
.
CASTHR30  CALL      DELCSF00      * Delete all for Header Record 
          GOTO      CASTHR98
.
CASTHR50  CALL      GLFUND00      * Schedule health fund duplication
          GOTO      CASTHR99
.
CASTHR60  CALL      CTHDEL00      * Schedule global deletion        
          GOTO      CASTHR99
.
CASTHR70  CALL      TGLU0000      * Schedule Update New to Current
          GOTO      CASTHR99
.
CASTHR75  CALL      CPYFEE00      * Copy Patient Theatre Fee 
          GOTO      CASTHR99
.
.   **********  DISPLAY FORMACTION  **********
.
CASTHR80  MOVE      ZERO,EXIT
.
          PACK      KEY33,CASTH012,CASTH001,CASTH002,CASTH003,CASTH004,CASTH005:
                          CASTH006,CASTH007,SP70
          CALL      RDPTCTF1
          IF        OVRCD=1
            CALL      CLRTHR00
          ENDIF
.
CASTHR82  CLEAR     WEBTITLE
          MOVE      "Casemix Theatre Fee Maintenance",WEBTITLE
          RESET     WEBTITLE
.
          CALL      WEBHED00   * Create Output File and Write HTML Page Header
          BRANCH    EXIT,CASTHR99
          CALL      WEBBOD00   * Process Web Body
          CALL      WEBEND00   * Process End of HTML File
.
          MOVE      ONE,EXIT
          GOTO      CASTHR99
.
CASTHR91  MOVE      "Record does not exist",WEBTITLE
          CALL      WEBERR00
          MOVE      ONE,EXIT
          GOTO      CASTHR99
.
CASTHR92  MOVE      "Record already exists",WEBTITLE
          CALL      WEBERR00
          MOVE      ONE,EXIT
          GOTO      CASTHR99
.
CASTHR93  MOVE      "Invalid Form Action.",WEBTITLE
          CALL      WEBERR00
          MOVE      ONE,EXIT
          GOTO      CASTHR99
.
CASTHR98  MOVE      ZERO,EXIT
CASTHR99  RETURN
.---------------------------------------------------------------------------
. Clear Casemix Theatre Fee Vars
.---------------------------------------------------------------------------
CLRTHR00  MOVE      SP70,PTCTCLMN   * Claim code
          MOVE      SP70,PTCTHFND   * Health Fund
          MOVE      SP70,PTCTTABT   * Table Type
          MOVE      SP70,PTCTCASM   * DRG Code (blank if not DRG)
          MOVE      SP70,PTCTMBSB   * MBS Banding (blank if not MBS)
          MOVE      SP70,DPTCTDCA   * Daycase Yes/No
          MOVE      SP70,DPTCTITM   * Item sequence
          MOVE      ZERO,PTCTDREB   * rebate portion
          MOVE      ZERO,PTCTDPAT   * patient portion
          MOVE      SP70,PTCTSPAR   * Spare
.
CLRTHR99  RETURN
.---------------------------------------------------------------------------
. Save Casemix Theatre Fee Vars
.---------------------------------------------------------------------------
SAVTHR00  MOVE      CASTH001,PTCTCLMN   * Claim code
          MOVE      CASTH002,PTCTHFND   * Health Fund
          MOVE      CASTH003,PTCTTABT   * Table Type
          MOVE      CASTH004,PTCTCASM   * DRG Code (blank if not DRG)
          MOVE      CASTH005,PTCTMBSB   * MBS Banding (blank if not MBS)
          MOVE      CASTH006,PTCTDCAS   * Daycase Yes/No
          MOVE      CASTH007,PTCTITMS   * Item sequence
          MOVE      CASTH008,PTCTDREB   * rebate portion
          MOVE      CASTH009,PTCTDPAT   * patient portion
          MOVE      CASTH012,PTCTCNID   * Contract ID
          MOVE      SP70,PTCTSPAR       * Spare

SAVTHR99  RETURN
.---------------------------------------------------------------------------
. Delete all Fee Records for Casemix Theatre Fee Header Record(New/Current File)
. Note also Deletes Header Record first up as it is sequence no 1 
.---------------------------------------------------------------------------
DELCSF00  PACK     KEY33,CASTH012,CASTH001,CASTH002,CASTH003,CASTH004,CASTH005:
                         CASTH006,SP70
          CALL      RSPTCTF1
          CALL      RKPTCTF1
          BRANCH    OVRCD,DELCSF99
.
          MATCH     CASTH012,PTCTCNID          * Contract ID
          GOTO      DELCSF99 IF NOT EQUAL
.
          MATCH     CASTH001,PTCTCLMN          * Claim Code
          GOTO      DELCSF99 IF NOT EQUAL
.
          MATCH     CASTH002,PTCTHFND          * Health Fund
          GOTO      DELCSF99 IF NOT EQUAL
.
          MATCH     CASTH003,PTCTTABT          * Table Type
          GOTO      DELCSF99 IF NOT EQUAL
.
          MATCH     CASTH004,PTCTCASM          * DRG Code
          GOTO      DELCSF99 IF NOT EQUAL
.
          MATCH     CASTH005,PTCTMBSB          * MBS Code
          GOTO      DELCSF99 IF NOT EQUAL
.
          MATCH     CASTH006,DPTCTDCA          * Day Case
          GOTO      DELCSF99 IF NOT EQUAL
.
          PACK      KEY33,PTCTCNID,PTCTCLMN,PTCTHFND,PTCTTABT,PTCTCASM,PTCTMBSB:
                          PTCTDCAS,PTCTITMS,SP70
          CALL      DEPTCTF1
.
          CALL      ACTF0000                 * Write delete audit
.
          GOTO      DELCSF00
.
DELCSF99  RETURN
.---------------------------------------------------------------------------
. Validate MBS   
.---------------------------------------------------------------------------
VALMBS00  CALL      XMLHED00
          BRANCH    EXIT,VALMBS99 
.
          MOVE      ZERO,THCFLG
. 
          MATCH     SP70,CASTH001            * Set to All
          GOTO      VALMBS10 IF EQUAL
.
          MOVE      "CL",CATEGORY            * Claim Code CGI
          MOVE      CASTH001,CODE
          CALL      GETCOD00
          BRANCH    OVRCD,VALMBS10
.
          MOVE      TCFORM6,THCFLG 
.
VALMBS10  MATCH     BLANK,CASTH002      * If blank no validation on Health Fund
          GOTO      VALMBS20 IF EQUAL
.
          MATCH     SP70,CASTH002       * SP70 = ALL
          GOTO      VALMBS20 IF EQUAL
.
          PACK      KEY14,CASTH002,SP70
          CALL      RDSFUND1
          CALL      RDKFUND1
          BRANCH    OVRCD,VALMBS20
.
          MATCH     CASTH002,HCODE 
          GOTO      VALMBS20 IF NOT EQUAL 
.
          MOVE      HFBAND,THCFLG 
.
VALMBS20  IF        THCFLG = 0 
            CLEAR     MESSAGE
            MOVE      "Copy From - Theatre Classification not Setup!",MESSAGE
            ENDSET    MESSAGE 
            APPEND    " Please change either of Health Fund or Claim",MESSAGE
            ENDSET    MESSAGE 
            APPEND    " Type.",MESSAGE
            WRITE     HTMLFILE;"<RETURN_VALUE TYPE=ERROR>":
                               MESSAGE,"</RETURN_VALUE>"
            GOTO      VALMBS98
          ENDIF
.
.  Validate Copy To Section
.
          MATCH     SP70,CPYTH001            * Set to All
          GOTO      VALMBS30 IF EQUAL
.
          MOVE      "CL",CATEGORY            * Claim Code CGI
          MOVE      CPYTH001,CODE
          CALL      GETCOD00
          BRANCH    OVRCD,VALMBS30
.
          MOVE      TCFORM6,THCFLG 
.
VALMBS30  MATCH     BLANK,CPYTH002      * If blank no validation on Health Fund
          GOTO      VALMBS40 IF EQUAL
.
          MATCH     SP70,CPYTH002       * SP70 = ALL
          GOTO      VALMBS40 IF EQUAL
.
          PACK      KEY14,CPYTH002,SP70
          CALL      RDSFUND1
          CALL      RDKFUND1
          BRANCH    OVRCD,VALMBS40
.
          MATCH     CPYTH002,HCODE 
          GOTO      VALMBS40 IF NOT EQUAL 
.
          MOVE      HFBAND,THCFLG 
.
VALMBS40  IF        THCFLG = 0 
            CLEAR     MESSAGE
            MOVE      "Copy To - Theatre Classification not Setup!",MESSAGE
            ENDSET    MESSAGE 
            APPEND    " Please change either of Health Fund or Claim",MESSAGE
            ENDSET    MESSAGE 
            APPEND    " Type.",MESSAGE
            WRITE     HTMLFILE;"<RETURN_VALUE TYPE=ERROR>":
                               MESSAGE,"</RETURN_VALUE>"
            GOTO      VALMBS98
          ENDIF
.
.  Output dummy data as all OK!
.
          WRITE     HTMLFILE;"<RETURN_VALUE TYPE=SIMPLE>":
                             ZERO,"|":
                             "</RETURN_VALUE>"
          GOTO      VALMBS98
.
VALMBS98  CALL      XMLEND00
VALMBS99  RETURN
.---------------------------------------------------------------------------
. Validate MBS   
.---------------------------------------------------------------------------
VALCPY00  CALL      XMLHED00
          BRANCH    EXIT,VALCPY99 
.
          MOVE      ZERO,THCFLG
.
.  Validate Copy To Section
.
          MATCH     SP70,CPYTH001            * Set to All
          GOTO      VALCPY30 IF EQUAL
.
          MOVE      "CL",CATEGORY            * Claim Code CGI
          MOVE      CPYTH001,CODE
          CALL      GETCOD00
          BRANCH    OVRCD,VALCPY30
.
          MOVE      TCFORM6,THCFLG 
.
VALCPY30  MATCH     BLANK,CPYTH002      * If blank no validation on Health Fund
          GOTO      VALCPY40 IF EQUAL
.
          MATCH     SP70,CPYTH002       * SP70 = ALL
          GOTO      VALCPY40 IF EQUAL
.
          PACK      KEY14,CPYTH002,SP70
          CALL      RDSFUND1
          CALL      RDKFUND1
          BRANCH    OVRCD,VALCPY40
.
          MATCH     CPYTH002,HCODE 
          GOTO      VALCPY40 IF NOT EQUAL 
.
          MOVE      HFBAND,THCFLG 
.
VALCPY40  BRANCH    ADDSCREN,VALCPY45    * Posting from Add Screen?
.
          IF        THCFLG = 0 
            CLEAR     MESSAGE
            MOVE      "Copy To - Theatre Classification not Setup!",MESSAGE
            ENDSET    MESSAGE 
            APPEND    " Please change either of Health Fund or Claim",MESSAGE
            ENDSET    MESSAGE 
            APPEND    " Type.",MESSAGE
            WRITE     HTMLFILE;"<RETURN_VALUE TYPE=ERROR>":
                               MESSAGE,"</RETURN_VALUE>"
            GOTO      VALCPY98
          ENDIF
          GOTO      VALCPY50
.
VALCPY45  IF        THCFLG = 0 
            CLEAR     MESSAGE
            MOVE      "Theatre Classification not Setup!",MESSAGE
            ENDSET    MESSAGE 
            APPEND    " Please change either of Health Fund or Claim",MESSAGE
            ENDSET    MESSAGE 
            APPEND    " Type.",MESSAGE
            WRITE     HTMLFILE;"<RETURN_VALUE TYPE=ERROR>":
                               MESSAGE,"</RETURN_VALUE>"
            GOTO      VALCPY98
          ENDIF
.
.  Output dummy data as all OK!
.
VALCPY50  WRITE     HTMLFILE;"<RETURN_VALUE TYPE=SIMPLE>":
                             ZERO,"|":
                             "</RETURN_VALUE>"
          GOTO      VALCPY98
.
VALCPY98  CALL      XMLEND00
VALCPY99  RETURN
+
.---------------------------------------------------------------------------
. Catchment code and LGA allocation
.---------------------------------------------------------------------------
CATLGA00  RESET     UPDTTYPE
          MATCH     SP70,UPDTTYPE           * Display formaction
          GOTO      CATLGA80 IF EQUAL
.
          MATCH     "P",UPDTTYPE            * Clear Postcode allocation 
          GOTO      CATLGA10 IF EQUAL
.
          MATCH     "C",UPDTTYPE            * Catchment code allocation 
          GOTO      CATLGA20 IF EQUAL
.
          MATCH     "L",UPDTTYPE            * LGA Code allocation 
          GOTO      CATLGA30 IF EQUAL
.
          MATCH     "G",UPDTTYPE            * Generate LGA keyword search
          GOTO      CATLGA40 IF EQUAL
.
          GOTO      CATLGA93
.
CATLGA10  CALL      SCLP0000                * Schedule clear all Postcode alloc.
          GOTO      CATLGA99
.
CATLGA20  CALL      SCAT0000                * Schedule Catchment code alloc.
          GOTO      CATLGA99
.
CATLGA30  CALL      SLGA0000                * Schedule LGA code allocation
          GOTO      CATLGA99
.
CATLGA40  CALL      LGAGN000                * Schedule gen LGA keyword file
          GOTO      CATLGA99
.
CATLGA80  CLEAR     WEBTITLE
          MOVE      "LGA & Catchment Code Allocation",WEBTITLE
          RESET     WEBTITLE
.
          CALL      WEBHED00   * Create Output File and Write HTML Page Header
          BRANCH    EXIT,CATLGA99
          CALL      WEBBOD00   * Process Web Body
          CALL      WEBEND00   * Process End of HTML File
.
          MOVE      ONE,EXIT
          GOTO      CATLGA99
.
CATLGA93  MOVE      "Invalid Form Action.",WEBTITLE
          CALL      WEBERR00
          MOVE      ONE,EXIT
          GOTO      CATLGA99
.
CATLGA98  MOVE      ZERO,EXIT
CATLGA99  RETURN
+
.---------------------------------------------------------------------------
. Schedule Clear Postcode allocation from IBAHOS66
.---------------------------------------------------------------------------
SCLP0000  MOVE      "IBAHOS66",SCHDPGID
          MOVE      "Clear Postcode Allocation",SCHDDESC
          PACK      SCHDDATE,CCC,CYY,CMM,CDD
          REP       " 0",SCHDDATE
          CLOCK     TIME,SCHDTIME
.
.         Write Keyin parameters
.
          MOVE      "1",KEYSTARR[1]          * Option 1
          MOVE      ANSY,KEYSTARR[2]         * Yes to clear postcode
          MOVE      TWO,KEYSTCNT             * Number of Keyins
.
          CALL      SCHPRO00   * Schedule Extract
.
SCLP9999  RETURN
+
.---------------------------------------------------------------------------
. Schedule Catchment code allocation from IBAHOS66
.---------------------------------------------------------------------------
SCAT0000  MOVE      "IBAHOS66",SCHDPGID
          MOVE      "Catchment Code Allocation",SCHDDESC
          PACK      SCHDDATE,CCC,CYY,CMM,CDD
          REP       " 0",SCHDDATE
          CLOCK     TIME,SCHDTIME
.
.         Write Keyin parameters
.
          MOVE      "2",KEYSTARR[1]          * Option 2
          MOVE      PTCAT001,KEYSTARR[2]     * Catchment code
          MOVE      ANSY,KEYSTARR[3]         * Yes to allocate
          MOVE      PTCAT003,KEYSTARR[4]     * Normal/Unallocated postcode only
          MOVE      PTCAT004,KEYSTARR[5]     * Starting postcode
          MOVE      PTCAT005,KEYSTARR[6]     * Ending postcode
          MOVE      ANSY,KEYSTARR[7]         * Yes to post
          MOVE      SEVEN,KEYSTCNT           * Number of Keyins
.
          CALL      SCHPRO00   * Schedule Extract
.
SCAT9999  RETURN
+
.---------------------------------------------------------------------------
. Schedule LGA allocation from IBAHOS66
.---------------------------------------------------------------------------
SLGA0000  MOVE      "IBAHOS66",SCHDPGID
          MOVE      "LGA Allocation",SCHDDESC
          PACK      SCHDDATE,CCC,CYY,CMM,CDD
          REP       " 0",SCHDDATE
          CLOCK     TIME,SCHDTIME
.
.         Write Keyin parameters
.
          MOVE      "3",KEYSTARR[1]          * Option 3
          MOVE      PTCAT002,KEYSTARR[2]     * LGA code
          MOVE      ANSY,KEYSTARR[3]         * Yes to allocate
          MOVE      PTCAT003,KEYSTARR[4]     * Normal/Unallocated postcode only
          MOVE      PTCAT004,KEYSTARR[5]     * Starting postcode
          MOVE      PTCAT005,KEYSTARR[6]     * Ending postcode
          MOVE      ANSY,KEYSTARR[7]         * Yes to post
          MOVE      SEVEN,KEYSTCNT           * Number of Keyins
.
          CALL      SCHPRO00   * Schedule Extract
.
SLGA9999  RETURN
+
.--------------------------------------------------------------------------
.*                             LGAGN000                                   *
.* Schedule Generate Default Misc Charge Item Keyword file from GENERKLG  *
.--------------------------------------------------------------------------
LGAGN000  MOVE      "GENERKLG",SCHDPGID
          MOVE      "LGA - Generate Keyword file",SCHDDESC
          PACK      SCHDDATE,CCC,CYY,CMM,CDD
          REP       " 0",SCHDDATE
          CLOCK     TIME,SCHDTIME
.
.         Write Keyin parameters
.
          MOVE      ANSY,KEYSTARR[1]         * Yes to generate keyword file
          MOVE      SP10,KEYSTARR[2]         * Enter
          MOVE      TWO,KEYSTCNT             * Number of Keyins
.
          CALL      SCHPRO00   * Schedule Extract
.
LGAGN999  RETURN
+
.---------------------------------------------------------------------------
. Process Fields 
.---------------------------------------------------------------------------
PROFLD00  BRANCH    REPORTNO,PROFLD10,PROFLD20,PROFLD30,PROFLD40,PROFLD50:
                             PROFLD99,PROFLD70,PROFLD80,PROFLD90,PROFL100:
                             PROFL110,PROFL120,PROFL130,PROFL140,PROFL150:
                             PROFL160,PROFL170,PROFL180,PROFL190,PROFL200:
                             PROFL210
          GOTO      PROFLD99
.
PROFLD10  BRANCH    FLDSETNO,PROFLD11
          GOTO      PROFLD99
.
PROFLD11  CALL      BFEE0000
          GOTO      PROFLD99
.
PROFLD20  BRANCH    FLDSETNO,PROFLD21
          GOTO      PROFLD99
.
PROFLD21  CALL      OCHG0000
          GOTO      PROFLD99
.
PROFLD30  BRANCH    FLDSETNO,PROFLD31
          GOTO      PROFLD99
.
PROFLD31  CALL      CASM0000             * Casemix Funding Maintenance
          GOTO      PROFLD99
.
PROFLD40  BRANCH    FLDSETNO,PROFLD41
          GOTO      PROFLD99
.
PROFLD41  CALL      MCHG0000
          GOTO      PROFLD99
.
PROFLD50  BRANCH    FLDSETNO,PROFLD51
          GOTO      PROFLD99
.
PROFLD51  CALL      CASF0000             * Casemix Theatre Fee Maintenance
          GOTO      PROFLD99
.
PROFLD70  BRANCH    FLDSETNO,PROFLD71
          GOTO      PROFLD99
.
PROFLD71  CALL      CTCH0000             * LGA/Catchment code allocation
          GOTO      PROFLD99
.
PROFLD80  BRANCH    FLDSETNO,PROFLD81
          GOTO      PROFLD99
.
PROFLD81  CALL      NZTF0000             * NZ private theatre fees        
          GOTO      PROFLD99
.
PROFLD90  BRANCH    FLDSETNO,PROFLD91
          GOTO      PROFLD99
.
PROFLD91  CALL      NZPF0000             * NZ private procedure fees        
          GOTO      PROFLD99
.
PROFL100  BRANCH    FLDSETNO,PROFL101
          GOTO      PROFLD99
.
PROFL101  CALL      NZBF0000             * NZ private bed fees        
          GOTO      PROFLD99
.
PROFL110  BRANCH    FLDSETNO,PROFL111,PROFL112
          GOTO      PROFLD99
.
PROFL111  CALL      NZMC0000             * NZ private misc charges
          GOTO      PROFLD99
.
PROFL112  CALL      NZMX0000             * NZ private exploding misc charges
          GOTO      PROFLD99
.
PROFL120  BRANCH    FLDSETNO,PROFL121,PROFL122
          GOTO      PROFLD99
.
PROFL121  CALL      NZCF0000             * NZ Contract Funding Maintenance
          GOTO      PROFLD99
.
PROFL122  CALL      MLCF0000             * NZ Contract Doctor  Maintenance
          GOTO      PROFLD99
.
PROFL130  BRANCH    FLDSETNO,PROFL131
          GOTO      PROFLD99
.
PROFL131  CALL      NZPT0000             * NZ Priv related provider types  
          GOTO      PROFLD99
.
PROFL140  BRANCH    FLDSETNO,PROFL141
          GOTO      PROFLD99
.
PROFL141  CALL      UFEE0000             * Billing Fees update
          GOTO      PROFLD99
.
PROFL150  BRANCH    FLDSETNO,PROFL151
          GOTO      PROFLD99
.
PROFL151  CALL      BFMP0000             * Bed Fee Mapping
          GOTO      PROFLD99
.
PROFL160  BRANCH    FLDSETNO,PROFL161
          GOTO      PROFLD99
.
PROFL161  CALL      TFMP0000             * Theatre Fee Mapping
          GOTO      PROFLD99
.
PROFL170  BRANCH    FLDSETNO,PROFL171
          GOTO      PROFLD99
.
PROFL171  CALL      JFEE0000
          GOTO      PROFLD99
.
PROFL180  BRANCH    FLDSETNO,PROFL181
          GOTO      PROFLD99
.
PROFL181  CALL      JCHG0000
          GOTO      PROFLD99
.
PROFL190  BRANCH    FLDSETNO,PROFL191
          GOTO      PROFLD99
.
PROFL191  CALL      FVGP0000
          GOTO      PROFLD99
.
PROFL200  BRANCH    FLDSETNO,PROFL201,PROFL202
          GOTO      PROFLD99
.
PROFL201  BRANCH    NOBDEAX1,PROFLD99   * Exit if patbdeaf file not found
          CALL      PTBD0000            * Billing Defaults table tags 
          GOTO      PROFLD99
.
PROFL202  BRANCH    NOBDEAX1,PROFLD99   * Exit if patbdeaf file not found
          CALL      BILD0000            * Extra Billing Defaults tags 
          GOTO      PROFLD99
.
PROFL210  BRANCH    FLDSETNO,PROFL211
          GOTO      PROFLD99
.
PROFL211  CALL      CTCD0000 
          GOTO      PROFLD99
.
PROFLD99  RETURN
+
.--------------------------------------------------------------------------
. Billing Fees Output
.--------------------------------------------------------------------------
UFEE0000  BRANCH    FLDITMNO,UFEE0100,UFEE0200,UFEE0300
          GOTO      UFEE9999
.
UFEE0100  MOVE      ZERO,OVRCD
          TRAP      OVERCOND IF IO
          OPEN      JHSBF1A1,"newbfeaf"
          TRAPCLR   IO
          BRANCH    OVRCD,UFEE0140
.
          MOVE      SP70,KEY27
          CALL      RSJHB1A1
          CALL      RKJHB1A1
          BRANCH    OVRCD,UFEE0140
          GOTO      UFEE0150
.
UFEE0140  WRITE     HTMLFILE;ZERO;          * New file empty of does not exist
          GOTO      UFEE9999
.
UFEE0150  WRITE     HTMLFILE;ONE;           * New file contains some records
          GOTO      UFEE9999
.
UFEE0200  MOVE      ZERO,OVRCD
          TRAP      OVERCOND IF IO
          OPEN      JHSTF1A1,"newtfeaf"
          TRAPCLR   IO
          BRANCH    OVRCD,UFEE0240
.
          MOVE      SP70,KEY23
          CALL      RSJHT1A1
          CALL      RKJHT1A1
          BRANCH    OVRCD,UFEE0240
          GOTO      UFEE0250
.
UFEE0240  WRITE     HTMLFILE;ZERO;          * New file empty of does not exist
          GOTO      UFEE9999
.
UFEE0250  WRITE     HTMLFILE;ONE;           * New file contains some records
          GOTO      UFEE9999
.
UFEE0300  WRITE     HTMLFILE;ZERO;          * New file empty of does not exist
          GOTO      UFEE9999
.
UFEE9999  RETURN
+
.--------------------------------------------------------------------------
. Bed Fee Maintenance Output
.--------------------------------------------------------------------------
BFEE0000  BRANCH    FLDITMNO,BFEE0100,BFEE0200,BFEE0300,BFEE0400,BFEE0500:
                             BFEE0600,BFEE0700,BFEE0800,BFEE0900,BFEE1000:
                             BFEE1100,BFEE1200,BFEE1300,BFEE1400,BFEE1500:
                             BFEE1600,BFEE1700,BFEE1800,BFEE1900,BFEE2000:
                             BFEE2100,BFEE2200,BFEE2300,BFEE2400,BFEE2500:
                             BFEE2600,BFEE2700,BFEE2800
          GOTO      BFEE9999
.
BFEE0100  MOVE      "CL",CATEGORY
          MOVE      BFCLM,CODE
          CALL      CODITM00
          GOTO      BFEE9999
.
BFEE0200  UNPACK    DIM127,D1,KEY1,DIM127
          MOVE      KEY1,F1
          BRANCH    F1,BFEE0210
          WRITE     HTMLFILE;BFHFUND;
          GOTO      BFEE9999
.
BFEE0210  MATCH     SP70,BFHFUND
          GOTO      BFEE9999 IF EQUAL
          PACK      KEY14,BFHFUND,SP70
          CALL      RDSFUND1
          CALL      RDKFUND1
          BRANCH    OVRCD,BFEE9999
          WRITE     HTMLFILE;HFNAME;
          GOTO      BFEE9999
.
BFEE0300  UNPACK    DIM127,D1,KEY1,DIM127
          MOVE      KEY1,F1
          BRANCH    F1,BFEE0310
          WRITE     HTMLFILE;PTBFHTYP;
          GOTO      BFEE9999
.
BFEE0310  MOVE      "HT",CATEGORY
          MOVE      PTBFHTYP,CODE
          CALL      CODITM00
          GOTO      BFEE9999
.
BFEE0400  MOVE      "A ",CATEGORY
          MOVE      BFATYPE,CODE
          CALL      CODITM00
          GOTO      BFEE9999
.
BFEE0500  MOVE      "BT",CATEGORY
          MOVE      BFBTYPE,CODE
          CALL      CODITM00
          GOTO      BFEE9999
.
BFEE0600  WRITE     HTMLFILE;BFENDDY;
          GOTO      BFEE9999
.
BFEE0700  WRITE     HTMLFILE;BFPAT;
          GOTO      BFEE9999
.
BFEE0800  WRITE     HTMLFILE;BFHF;
          GOTO      BFEE9999
.
BFEE0900  COMPARE   ONE,BFNINV
          IF        @EQUAL
            WRITE     HTMLFILE;"<option value=",ONE," selected>":
                               BFNINV,"</option>"
          ELSE
            WRITE     HTMLFILE;"<option value=",ONE,">":
                               ONE,"</option>"
          ENDIF
.
          COMPARE   TWO,BFNINV
          IF        @EQUAL
            WRITE     HTMLFILE;"<option value=",TWO," selected>":
                               BFNINV,"</option>"
          ELSE
            WRITE     HTMLFILE;"<option value=",TWO,">":
                               TWO,"</option>"
          ENDIF
          GOTO      BFEE9999
.
BFEE1000  WRITE     HTMLFILE;BFDESC;
          GOTO      BFEE9999
.
BFEE1100  CALL      BFEETB00
          GOTO      BFEE9999
.
BFEE1200  CALL      NEXTFE00
          GOTO      BFEE9999
.
BFEE1300  CALL      PREVFE00
          GOTO      BFEE9999
.
BFEE1400  MOVE      "CL",CATEGORY
          MOVE      BDFEE001,CODE
          CALL      CODITM00
          GOTO      BFEE9999
.
BFEE1500  UNPACK    DIM127,D1,KEY1,DIM127
          MOVE      KEY1,F1
          BRANCH    F1,BFEE1510
          WRITE     HTMLFILE;BDFEE002;
          GOTO      BFEE9999
.
BFEE1510  MATCH     SP70,BDFEE002
          GOTO      BFEE9999 IF EQUAL
          PACK      KEY14,BDFEE002,SP70
          CALL      RDSFUND1
          CALL      RDKFUND1
          BRANCH    OVRCD,BFEE9999
          WRITE     HTMLFILE;HFNAME;
          GOTO      BFEE9999
.
BFEE1600  UNPACK    DIM127,D1,KEY1,DIM127
          MOVE      KEY1,F1
          BRANCH    F1,BFEE1610,BFEE1620
          WRITE     HTMLFILE;BDFEE003;
          GOTO      BFEE9999
.
BFEE1610  PACK      KEY14,BDFEE002,BDFEE003,SP70
          CALL      RDFUND1
          BRANCH    OVRCD,BFEE9999
          WRITE     HTMLFILE;HFNAME;
          GOTO      BFEE9999
.
BFEE1620  MOVE      "HT",CATEGORY
          MOVE      BDFEE003,CODE
          CALL      CODITM00
          GOTO      BFEE9999
.
BFEE1700  MOVE      "A ",CATEGORY
          MOVE      BDFEE004,CODE
          CALL      CODITM00
          GOTO      BFEE9999
.
BFEE1800  WRITE     HTMLFILE;FILEFLAG;
          GOTO      BFEE9999
.
BFEE1900  
          GOTO      BFEE9999
.
BFEE2000  
.         MOVE      ZERO,OVRCD
.         TRAP      OVERCOND IF IO
.         OPEN      PATBF1E1,"newbfeef"
.         TRAPCLR   IO
.         BRANCH    OVRCD,BFEE2040
.
.         MOVE      SP70,KEY27
.         CALL      RDSBF1E1
.         CALL      RDKBF1E1
.         BRANCH    OVRCD,BFEE2040
.         GOTO      BFEE2050
.
BFEE2040 
.         WRITE     HTMLFILE;ZERO;          * New file empty of does not exist
          GOTO      BFEE9999
.
BFEE2050  
.         WRITE     HTMLFILE;ONE;           * New file contains some records
          GOTO      BFEE9999
.
BFEE2100  MOVE      "CL",CATEGORY
          MOVE      SP10,CODE
          CALL      CODITM00
          GOTO      BFEE9999
.
BFEE2200  MOVE      "A ",CATEGORY
          MOVE      SP10,CODE
          CALL      CODITM00
          GOTO      BFEE9999
.
BFEE2300  MOVE      "BT",CATEGORY
          MOVE      SP10,CODE
          CALL      CODITM00
          GOTO      BFEE9999
.
BFEE2400  WRITE     HTMLFILE;PTBFCNID;
          GOTO      BFEE9999
.
BFEE2500  WRITE     HTMLFILE;BDFEE014;
          GOTO      BFEE9999
.
BFEE2600  MATCH     SP70,BDFEE014
          GOTO      BFEE9999 IF EQUAL
          GOTO      BFEE9999 IF EOS
.
          PACK      KEY6,BDFEE014,SP70
          CALL      RDPMCID1
          IF        OVRCD=0
            MATCH     SP70,PMCIDESC
            IF        @EQUAL | @EOS
              WRITE     HTMLFILE;PMCICNTR;
            ELSE
              WRITE     HTMLFILE;PMCIDESC;
            ENDIF
          ELSE
            WRITE     HTMLFILE;"Unknown Contract ID";
          ENDIF
.
          GOTO      BFEE9999
.
BFEE2700  WRITE     HTMLFILE;PTBFCNID;
          GOTO      BFEE9999
.
BFEE2800  MATCH     SP70,PTBFCNID
          GOTO      BFEE9999 IF EQUAL
          GOTO      BFEE9999 IF EOS
.
          PACK      KEY6,PTBFCNID,SP70
          CALL      RDPMCID1
          IF        OVRCD=0
            MATCH     SP70,PMCIDESC
            IF        @EQUAL | @EOS
              WRITE     HTMLFILE;PMCICNTR;
            ELSE
              WRITE     HTMLFILE;PMCIDESC;
            ENDIF
          ELSE
            WRITE     HTMLFILE;"Unknown Contract ID";
          ENDIF
.
          GOTO      BFEE9999
.
BFEE9999  RETURN
.
.--------------------------------------------------------------------------
. NZ Private Contract Doctor Codes 
.--------------------------------------------------------------------------
MLCF0000  BRANCH    FLDITMNO,MLCF0100,MLCF0200
          GOTO      MLCF9999
.
MLCF0100  UNPACK    DIM127,D1,KEY1,DIM127
          MOVE      ZERO,F1
          MOVE      KEY1,F1
          BRANCH    F1,MLCF0110
          PACK      KEY10,MLCFHCPC,SP70
          CALL      RDPMHCP1
          BRANCH    OVRCD,MLCF9999
          MOVE      PMHCTITL,FMTTITLE
          MOVE      PMHCGNAM,FMTGNAME
          MOVE      PMHCSNAM,FMTSNAME
          CALL      DOCNM000
          WRITE     HTMLFILE;DOCFNAME;
          GOTO      MLCF9999
.
MLCF0110  WRITE     HTMLFILE;MLCFHCPC;
          GOTO      MLCF9999
.
MLCF0200  WRITE     HTMLFILE;MLCFN001;
          GOTO      MLCF9999
.
MLCF9999  RETURN
+
.--------------------------------------------------------------------------
. Theatre Charge Maintenance Output
.--------------------------------------------------------------------------
OCHG0000  BRANCH    FLDITMNO,OCHG0100,OCHG0200,OCHG0300,OCHG0400,OCHG0500:
                             OCHG0600,OCHG0700,OCHG0800,OCHG0900,OCHG1000:
                             OCHG1100,OCHG1200,OCHG1300,OCHG1400,OCHG1500:
                             OCHG1600,OCHG1700,OCHG1800,OCHG1900,OCHG2000:
                             OCHG2100,OCHG2200,OCHG2300,OCHG2400,OCHG2500:
                             OCHG2600,OCHG2700,OCHG2800,OCHG2900,OCHG3000:
                             OCHG3100,OCHG3200,OCHG3300,OCHG3400
          GOTO      OCHG9999
.
OCHG0100  MOVE      "CL",CATEGORY
          MOVE      TFCLM,CODE
          CALL      CODITM00
          GOTO      OCHG9999
.
OCHG0200  UNPACK    DIM127,D1,KEY1,DIM127
          MOVE      KEY1,F1
          MATCH     SP70,TFHFUND
          GOTO      OCHG9999 IF EQUAL
          PACK      KEY14,TFHFUND,ZERO,ZERO,ZERO,ZERO,SP70
          CALL      RDFUND1
          BRANCH    OVRCD,OCHG9999
          BRANCH    F1,OCHG0210,OCHG0220
          WRITE     HTMLFILE;TFHFUND;
          GOTO      OCHG9999
OCHG0210  WRITE     HTMLFILE;HFNAME;
          GOTO      OCHG9999
OCHG0220  WRITE     HTMLFILE;HFBAND;
          GOTO      OCHG9999
.
OCHG0300  UNPACK    DIM127,D1,KEY1,DIM127
          MOVE      KEY1,F1
          BRANCH    F1,OCHG0310
          WRITE     HTMLFILE;PTTFHTYP;
          GOTO      OCHG9999
OCHG0310  MATCH     SP70,PTTFHTYP
          GOTO      OCHG9999 IF EQUAL
          GOTO      OCHG9999 IF EOS
          PACK      KEY5,ANSH,ANST,PTTFHTYP,SP70
          CALL      RDCODE1
          BRANCH    OVRCD,OCHG9999
          WRITE     HTMLFILE;TDESC;
          GOTO      OCHG9999
.
OCHG0400  WRITE     HTMLFILE;TFDAYC;
          GOTO      OCHG9999
.
OCHG0500  WRITE     HTMLFILE;TFENDMBS;
          GOTO      OCHG9999
.
OCHG0600  WRITE     HTMLFILE;TFHF1;
          GOTO      OCHG9999
.
OCHG0700  WRITE     HTMLFILE;TFPAT1;
          GOTO      OCHG9999
.
OCHG0800  WRITE     HTMLFILE;TFHF2;
          GOTO      OCHG9999
.
OCHG0900  WRITE     HTMLFILE;TFPAT2;
          GOTO      OCHG9999
.
OCHG1000  WRITE     HTMLFILE;TFHF3;
          GOTO      OCHG9999
.
OCHG1100  WRITE     HTMLFILE;TFPAT3;
          GOTO      OCHG9999
.
OCHG1200  WRITE     HTMLFILE;TFHF4;
          GOTO      OCHG9999
.
OCHG1300  WRITE     HTMLFILE;TFPAT4;
          GOTO      OCHG9999
.
OCHG1400  WRITE     HTMLFILE;TFHF5;
          GOTO      OCHG9999
.
OCHG1500  WRITE     HTMLFILE;TFPAT5;
          GOTO      OCHG9999
.
OCHG1600  WRITE     HTMLFILE;TFHF6;
          GOTO      OCHG9999
.
OCHG1700  WRITE     HTMLFILE;TFPAT6;
          GOTO      OCHG9999
.
OCHG1800  COMPARE   ONE,TFNINV
          IF        @EQUAL
            WRITE     HTMLFILE;"<option value=",ONE," selected>":
                               TFNINV,"</option>"
          ELSE
            WRITE     HTMLFILE;"<option value=",ONE,">":
                               ONE,"</option>"
          ENDIF
.
          COMPARE   TWO,TFNINV
          IF        @EQUAL
            WRITE     HTMLFILE;"<option value=",TWO," selected>":
                               TFNINV,"</option>"
          ELSE
            WRITE     HTMLFILE;"<option value=",TWO,">":
                               TWO,"</option>"
          ENDIF
          GOTO      OCHG9999
.
OCHG1900  CALL      OCHGTB00
          GOTO      OCHG9999
.
OCHG2000  CALL      NEXTCH00
          GOTO      OCHG9999
.
OCHG2100  CALL      PREVCH00
          GOTO      OCHG9999
.
OCHG2200  MOVE      "TB",CATEGORY
          MOVE      TFENDMBS,CODE
          CALL      CODITM00
          GOTO      OCHG9999
.
OCHG2300  MOVE      "CL",CATEGORY
          MOVE      OPCHG001,CODE
          CALL      CODITM00
          GOTO      OCHG9999
.
OCHG2400  UNPACK    DIM127,D1,KEY1,DIM127
          MOVE      KEY1,F1
          MATCH     SP70,OPCHG002
          GOTO      OCHG9999 IF EQUAL
          PACK      KEY14,OPCHG002,ZERO,ZERO,ZERO,ZERO,SP4,SP70
          CALL      RDFUND1
          BRANCH    OVRCD,OCHG9999
          BRANCH    F1,OCHG2410,OCHG2420
          WRITE     HTMLFILE;OPCHG002;
          GOTO      OCHG9999
OCHG2410  WRITE     HTMLFILE;HFNAME;
          GOTO      OCHG9999
OCHG2420  WRITE     HTMLFILE;HFBAND;
          GOTO      OCHG9999
.
OCHG2500  UNPACK    DIM127,D1,KEY1,DIM127
          MOVE      KEY1,F1
          BRANCH    F1,OCHG2510
          WRITE     HTMLFILE;OPCHG003;
          GOTO      OCHG9999
OCHG2510  MATCH     SP70,OPCHG003
          GOTO      OCHG9999 IF EQUAL
          GOTO      OCHG9999 IF EOS
          PACK      KEY5,ANSH,ANST,OPCHG003,SP70
          CALL      RDCODE1
          BRANCH    OVRCD,OCHG9999
          WRITE     HTMLFILE;TDESC;
          GOTO      OCHG9999
.
OCHG2600  WRITE     HTMLFILE;OPCHG004;
          GOTO      OCHG9999
.
OCHG2700  WRITE     HTMLFILE;FILEFLAG;
          GOTO      OCHG9999
.
OCHG2800  WRITE     HTMLFILE;NEWFFLAG;
          GOTO      OCHG9999
.
OCHG2900  MOVE      ZERO,OVRCD
          TRAP      OVERCOND IF IO
          OPEN      JHSTF1A1,"newtfeaf"
          TRAPCLR   IO
          BRANCH    OVRCD,OCHG2940
.
          CALL      RSJHT1A1
          CALL      RKJHT1A1
          BRANCH    OVRCD,OCHG2940
          GOTO      OCHG2950
.
OCHG2940  WRITE     HTMLFILE;ZERO;          * New file empty of does not exist
          GOTO      OCHG9999
.
OCHG2950  WRITE     HTMLFILE;ONE;           * New file contains some records
          GOTO      OCHG9999
.
OCHG3000  MOVE      "HT",CATEGORY
          MOVE      OPCHG003,CODE
          CALL      CODITM00
          GOTO      OCHG9999
.
OCHG3100  WRITE     HTMLFILE;OPCHG026;
          GOTO      OCHG9999
.
OCHG3200  MATCH     SP70,OPCHG026
          GOTO      OCHG9999 IF EQUAL
          GOTO      OCHG9999 IF EOS
.
          PACK      KEY6,OPCHG026,SP70
          CALL      RDPMCID1
          IF        OVRCD=0
            MATCH     SP70,PMCIDESC
            IF        @EQUAL | @EOS
              WRITE     HTMLFILE;PMCICNTR;
            ELSE
              WRITE     HTMLFILE;PMCIDESC;
            ENDIF
          ELSE
            WRITE     HTMLFILE;"Unknown Contract ID";
          ENDIF
.
          GOTO      OCHG9999
.
OCHG3300  WRITE     HTMLFILE;PTTFCNID;
          GOTO      OCHG9999
.
OCHG3400  MATCH     SP70,PTTFCNID
          GOTO      OCHG9999 IF EQUAL
          GOTO      OCHG9999 IF EOS
.
          PACK      KEY6,PTTFCNID,SP70
          CALL      RDPMCID1
          IF        OVRCD=0
            MATCH     SP70,PMCIDESC
            IF        @EQUAL | @EOS
              WRITE     HTMLFILE;PMCICNTR;
            ELSE
              WRITE     HTMLFILE;PMCIDESC;
            ENDIF
          ELSE
            WRITE     HTMLFILE;"Unknown Contract ID";
          ENDIF
.
          GOTO      OCHG9999
.
OCHG9999  RETURN
.
.--------------------------------------------------------------------------
. Casemix Funding Maintenance Output
.--------------------------------------------------------------------------
CASM0000  BRANCH    FLDITMNO,CASM0100,CASM0200,CASM0300,CASM0400,CASM0500:
                             CASM0600,CASM0700,CASM0800,CASM0900,CASM1000:
                             CASM1100,CASM1200,CASM1300,CASM1400,CASM1500:
                             CASM1600,CASM1700,CASM1800,CASM1900,CASM2000:
                             CASM2100,CASM2200,CASM2300,CASM2400
          GOTO      CASM9999
.
CASM0100  MOVE      "CL",CATEGORY            * Claim Code
          MOVE      PTCMCLMN,CODE
          CALL      CODITM00
          GOTO      CASM9999
.
CASM0200  UNPACK    DIM127,D1,KEY1,DIM127
          MOVE      KEY1,F1
          BRANCH    F1,CASM0210
          WRITE     HTMLFILE;PTCMHFND;       * Health Fund
          GOTO      CASM9999
.
CASM0210  MATCH     SP70,PTCMHFND
          GOTO      CASM9999 IF EQUAL
.
          PACK      KEY14,PTCMHFND,SP70
          CALL      RDSFUND1
          CALL      RDKFUND1
          BRANCH    OVRCD,CASM9999
          WRITE     HTMLFILE;HFNAME;        * Health Fund Name
          GOTO      CASM9999
.
CASM0300  UNPACK    DIM127,D1,KEY1,DIM127
          MOVE      KEY1,F1
          BRANCH    F1,CASM0310
          WRITE     HTMLFILE;PTCMCASM;      * Casemix Code
          GOTO      CASM9999
.
CASM0310  MATCH     SP70,PTCMCASM
          GOTO      CASM9999 IF EQUAL
.
          PACK      KEY9,PTCMCASM,SP70
          CALL      RDPTCMC1
          BRANCH    OVRCD,CASM9999
          WRITE     HTMLFILE;PTCADES1;      * Casemix Code Desc
          GOTO      CASM9999
.
CASM0400 
          GOTO      CASM9999
.
CASM0500 
          GOTO      CASM9999
.
CASM0600  COMPARE   ZERO,PTCMXLOS           * Exp LOS
          GOTO      CASM9999 IF EQUAL
          WRITE     HTMLFILE;PTCMXLOS;
          GOTO      CASM9999
.
CASM0700  COMPARE   ZERO,PTCMDIFG           * Detailed Invoice Flag
          GOTO      CASM9999 IF EQUAL
          WRITE     HTMLFILE;PTCMDIFG;
          GOTO      CASM9999
.
CASM0800  CALL      CASMTB00                * Casemix Funding Table
          GOTO      CASM9999
.
CASM0900  CALL      NEXTCS00
          GOTO      CASM9999
.
CASM1000  CALL      PREVCS00
          GOTO      CASM9999
.
CASM1100  MOVE      "CL",CATEGORY            * Claim Code
          MOVE      CASMX001,CODE
          CALL      CODITM00
          GOTO      CASM9999
.
CASM1200  UNPACK    DIM127,D1,KEY1,DIM127
          MOVE      KEY1,F1
          BRANCH    F1,CASM1210
          WRITE     HTMLFILE;CASMX002;       * Health Fund
          GOTO      CASM9999
.
CASM1210  MATCH     SP70,CASMX002
          GOTO      CASM9999 IF EQUAL
.
          PACK      KEY14,CASMX002,SP70
          CALL      RDSFUND1
          CALL      RDKFUND1
          BRANCH    OVRCD,CASM9999
          WRITE     HTMLFILE;HFNAME;        * Health Fund Name
          GOTO      CASM9999
.
CASM1300  UNPACK    DIM127,D1,KEY1,DIM127
          MOVE      KEY1,F1
          BRANCH    F1,CASM1310
          WRITE     HTMLFILE;CASMX003;      * Casemix Code
          GOTO      CASM9999
.
CASM1310  MATCH     SP70,CASMX003
          GOTO      CASM9999 IF EQUAL
.
          PACK      KEY9,CASMX003,SP70
          CALL      RDPTCMC1
          BRANCH    OVRCD,CASM9999
          WRITE     HTMLFILE;PTCADES1;      * Casemix Code Desc
          GOTO      CASM9999
.
CASM1400  
          GOTO      CASM9999
.
CASM1500  WRITE     HTMLFILE;CMIXCODE;
          GOTO      CASM9999
.
CASM1600  MATCH     SP70,CMIXCODE
          GOTO      CASM9999 IF EQUAL
.
          PACK      KEY9,CMIXCODE,SP70
          CALL      RDPTCMC1
          BRANCH    OVRCD,CASM1650
          WRITE     HTMLFILE;PTCADES1;      * Casemix Code Desc
          GOTO      CASM9999
.
CASM1650  WRITE     HTMLFILE;"Invalid Code";
          GOTO      CASM9999
.
CASM1700  
          GOTO      CASM9999
.
CASM1800  MATCH     SP70,PTCMCNID
          GOTO      CASM9999 IF EQUAL
          WRITE     HTMLFILE;PTCMCNID;
          GOTO      CASM9999
.
CASM1900  UNPACK    DIM127,D1,KEY1,DIM127
          MOVE      KEY1,F1
          BRANCH    F1,CASM1910
          WRITE     HTMLFILE;CASMX009;      * Contract ID
          GOTO      CASM9999
.
CASM1910  PACK      KEY6,CASMX009,SP70
          CALL      RDPMCID1
          BRANCH    OVRCD,CASM9999
.
          WRITE     HTMLFILE;PMCIDESC;
          GOTO      CASM9999
.
CASM2000  WRITE     HTMLFILE;PTCMECEQ;      * Eclipse Equivalent
          GOTO      MCHG9999
.
CASM2100  WRITE     HTMLFILE;PTCMECTS;      * Eclipse Type of Service
          GOTO      MCHG9999
.
CASM2200  WRITE     HTMLFILE;PTCMTRPT;      * Transfer Trim Point
          GOTO      MCHG9999
.
CASM2300  COMPARE   ZERO,PTCMTLOS           * Target LOS
          GOTO      CASM9999 IF EQUAL
          WRITE     HTMLFILE;PTCMTLOS;
          GOTO      CASM9999
.
CASM2400  WRITE     HTMLFILE;PTCMEHCP;      * Health Care Provider
          GOTO      MCHG9999
.
CASM9999  RETURN
+
.--------------------------------------------------------------------------
.         Selection List for Contract ID
.--------------------------------------------------------------------------
CNID0000  MOVE      SP10,KEY6
          MOVE      ZERO,F1
          PACK      KEY24,SP70
          CALL      RSPTCMX2
CNID1000  CALL      RKPTCMX2
          BRANCH    OVRCD,CNID9999
.
          BRANCH    F1,CNID2000
          MOVE      PTCMCNID,KEY6
          MOVE      ONE,F1
          GOTO      CNID4000
.
CNID2000  MATCH     KEY6,PTCMCNID 
          GOTO      CNID1000 IF EQUAL
          MOVE      PTCMCNID,KEY6
.
CNID4000  MATCH     KEY6,CONTRCID
          IF        @EQUAL
            WRITE     HTMLFILE;"<option value=",KEY6," selected>":
                               KEY6,"</option>"
          ELSE
            WRITE     HTMLFILE;"<option value=",KEY6,">",KEY6,"</option>"
          ENDIF
          GOTO      CNID1000
.
CNID9999  RETURN
+
.--------------------------------------------------------------------------
. Miscellaneous Charges Maintenance Output
.--------------------------------------------------------------------------
MCHG0000  BRANCH    FLDITMNO,MCHG0100,MCHG0200,MCHG0300,MCHG0400,MCHG0500:
                             MCHG0600,MCHG0700,MCHG0800,MCHG0900,MCHG1000:
                             MCHG1100,MCHG1200,MCHG1300,MCHG1400,MCHG1500:
                             MCHG1600,MCHG1700,MCHG1800,MCHG1900,MCHG2000:
                             MCHG2100,MCHG2200,MCHG2300,MCHG2400,MCHG2500:
                             MCHG2600,MCHG2700,MCHG2800,MCHG2900,MCHG3000:
                             MCHG3100,MCHG3200,MCHG3300,MCHG3400,MCHG3500:
                             MCHG3600,MCHG3700,MCHG3800,MCHG3900,MCHG4000:
                             MCHG4100,MCHG4200
          GOTO      MCHG9999
.
MCHG0100  MOVE      "CL",CATEGORY            * Claim Code
          MOVE      MCLMCOD,CODE
          CALL      CODITM00
          GOTO      MCHG9999
.
MCHG0200  UNPACK    DIM127,D1,KEY1,DIM127
          MOVE      KEY1,F1
          BRANCH    F1,MCHG0210
          WRITE     HTMLFILE;MHFUND;       * Health Fund
          GOTO      MCHG9999
.
MCHG0210  MATCH     SP70,MHFUND
          GOTO      MCHG9999 IF EQUAL
.
          PACK      KEY14,MHFUND,ZERO,ZERO,ZERO,ZERO,SP70
          CALL      RDFUND1
          BRANCH    OVRCD,MCHG9999
          WRITE     HTMLFILE;HFNAME;        * Health Fund Name
          GOTO      MCHG9999
.
MCHG0300                                                              *D-233046
          GOTO      MCHG9999
.
MCHG0400  MATCH     SP70,MCHARGE            * Charge Code
          GOTO      MCHG9999 IF EQUAL
          WRITE     HTMLFILE;MCHARGE;
          GOTO      MCHG9999
.
MCHG0500  MATCH     SP70,MDESC              * Charge Description
          GOTO      MCHG9999 IF EQUAL
          WRITE     HTMLFILE;MDESC;
          GOTO      MCHG9999
.
MCHG0600  WRITE     HTMLFILE;MITMTYP;       * Charge Type 2=Theatre Fee, 3=Misc
          GOTO      MCHG9999
.
MCHG0700  MOVE      "FI",CATEGORY           * Misc Charge Group (Cat FI)
          MOVE      MMSCGRP,CODE
          CALL      CODITM00
          GOTO      MCHG9999
.
MCHG0800  WRITE     HTMLFILE;MPATPOR;       * Patient Portion                  
          GOTO      MCHG9999
.
MCHG0900  WRITE     HTMLFILE;MHFPOR;        * Rebate Portion                   
          GOTO      MCHG9999
.
MCHG1000  WRITE     HTMLFILE;MNINV;         * Number of Invoices - 1 or 2 only
          GOTO      MCHG9999
.
MCHG1100  WRITE     HTMLFILE;MINDIC;        * Indicator for changing desc.     
          GOTO      MCHG9999
.
MCHG1200  WRITE     HTMLFILE;PTMCGSTA;      * Is GST applicable to charge      
          GOTO      MCHG9999
.
MCHG1300  CALL      CODGST00                * GST payable code fr. GST rate tabl
          GOTO      MCHG9999
.
MCHG1400  MATCH     SP70,PTMCEDIE;          * EDI Equivalent 
          GOTO      MCHG9999 IF EQUAL
          WRITE     HTMLFILE;PTMCEDIE;
          GOTO      MCHG9999
.
MCHG1500  WRITE     HTMLFILE;PTMCCFCY;      * Casemix funding chargeable       
          GOTO      MCHG9999
.
MCHG1600  MATCH     SP70,PTMCKREB;          * Keyin Rebate Portion
          GOTO      MCHG9999 IF EQUAL
          WRITE     HTMLFILE;PTMCKREB;
          GOTO      MCHG9999
.
MCHG1700  MATCH     SP70,PTMCCOBD;          * Charge on behalf of doctor
          GOTO      MCHG9999 IF EQUAL
          WRITE     HTMLFILE;PTMCCOBD;
          GOTO      MCHG9999
.
MCHG1800  MATCH     SP70,PTMCTACT;          * TAC type A=AMA P=Paramedical T=TAC
          GOTO      MCHG9999 IF EQUAL
          WRITE     HTMLFILE;PTMCTACT;
          GOTO      MCHG9999
.
MCHG1900  MATCH     SP70,PTMCTACD;          * TAC Duration(min) only paramedical
          GOTO      MCHG9999 IF EQUAL
          WRITE     HTMLFILE;PTMCTACD;
          GOTO      MCHG9999
.
MCHG2000  MATCH     SP70,PTMCEFDT;          * Effective date CCYYMMDD
          GOTO      MCHG9999 IF EQUAL
          UNPACK    PTMCEFDT,CCENT,CYEAR,CMON,CDAY
          MOVE      CMON,F2
          LOAD      MTHNAM3,F2,JAN,FEB,MAR,APR,MAY,JUN,JUL,AUG,SEP,OCT,NOV,DEC
          WRITE     HTMLFILE;CDAY,SP1,MTHNAM3,SP1,CCENT,CYEAR;
          GOTO      MCHG9999
.
MCHG2100  MOVE      "CL",CATEGORY            * Claim Code
          MATCH     "1",TEMPLATE
          GOTO      MCHG2120 IF NOT EQUAL
          MATCH     SP70,MSCHG001
          GOTO      MCHG2120 IF NOT EQUAL
          MOVE      PTCNDCLM,CODE          * Default claim code
          GOTO      MCHG2140
.
MCHG2120  MOVE      MSCHG001,CODE
MCHG2140  CALL      CODITM00
          GOTO      MCHG9999
.
MCHG2200  UNPACK    DIM127,D1,KEY1,DIM127
          MOVE      KEY1,F1
          BRANCH    F1,MCHG2210
          WRITE     HTMLFILE;MSCHG002;       * Health Fund
          GOTO      MCHG9999
.
MCHG2210  MATCH     SP70,MSCHG002
          GOTO      MCHG9999 IF EQUAL
.
          PACK      KEY14,MSCHG002,ZERO,ZERO,ZERO,ZERO,SP70
          CALL      RDFUND1
          BRANCH    OVRCD,MCHG9999
          WRITE     HTMLFILE;HFNAME;        * Health Fund Name
          GOTO      MCHG9999
.
MCHG2300  UNPACK    DIM127,D1,KEY1,DIM127                             *C-233046
....      MOVE      KEY1,F1
....      BRANCH    F1,MCHG2310
....      WRITE     HTMLFILE;MSCHG003;       * Health Fund Table
          GOTO      MCHG9999
.
MCHG2310  MATCH     SP70,MSCHG003
          GOTO      MCHG9999 IF EQUAL
.
          PACK      KEY14,MSCHG002,MSCHG003,SP70
          CALL      RDFUND1
          BRANCH    OVRCD,MCHG9999
          WRITE     HTMLFILE;HFNAME;        * Health Fund Name
          GOTO      MCHG9999
.
MCHG2400  MATCH     SP70,MSCHG004
          GOTO      MCHG9999 IF EQUAL
          WRITE     HTMLFILE;MSCHG004;
          GOTO      MCHG9999
.
MCHG2500  CALL      MCHGTB00
          GOTO      MCHG9999
.
MCHG2600  CALL      NEXTMC00
          GOTO      MCHG9999
.
MCHG2700  CALL      PREVMC00
          GOTO      MCHG9999
.
MCHG2800 
          GOTO      MCHG9999
.
MCHG2900 
          GOTO      MCHG9999
.
MCHG3000 
          GOTO      MCHG9999
.
MCHG3100
          GOTO      MCHG9999
.
MCHG3200  WRITE     HTMLFILE;PTCNDCLM;      * default claim code              
          GOTO      MCHG9999
.
MCHG3300  MOVE      "FN",CATEGORY           * Alt. Misc Charge Group (Cat FN)
          MOVE      PTMCALGR,CODE
          CALL      CODITM00
          GOTO      MCHG9999
.
MCHG3400  WRITE     HTMLFILE;PTMCPRTR;      * Prosthetic Tracking
          GOTO      MCHG9999
.
MCHG3500  WRITE     HTMLFILE;PTMCECEQ;      * Eclipse Equivalent   
          GOTO      MCHG9999
.
MCHG3600  WRITE     HTMLFILE;PTMCECTS;      * Eclipse Type of Service
          GOTO      MCHG9999
.
MCHG3700  WRITE     HTMLFILE;PTMCACTV;      * Active/Inactive flag
          GOTO      MCHG9999
.
.                                                            * start  *I-233046
MCHG3800  MOVE      "HT",CATEGORY           * H/F Table Type (Cat "HT")at FN)
          MATCH     "1",TEMPLATE
          GOTO      MCHG3820 IF NOT EQUAL
          MATCH     SP70,MSCHG034
          GOTO      MCHG3820 IF NOT EQUAL
          MOVE      PTMCHFTT,CODE          * Default ???
          GOTO      MCHG3840
.
MCHG3820  MOVE      MSCHG034,CODE
MCHG3840  CALL      CODITM00
          GOTO      MCHG9999
.
MCHG3900  MATCH     SP70,PTMCETDT;          * Effective To date CCYYMMDD
          GOTO      MCHG9999 IF EQUAL
          UNPACK    PTMCETDT,CCENT,CYEAR,CMON,CDAY
          MOVE      CMON,F2
          LOAD      MTHNAM3,F2,JAN,FEB,MAR,APR,MAY,JUN,JUL,AUG,SEP,OCT,NOV,DEC
          WRITE     HTMLFILE;CDAY,SP1,MTHNAM3,SP1,CCENT,CYEAR;
          GOTO      MCHG9999                                 * end    *I-233046
.
MCHG4000  WRITE     HTMLFILE;PTMCEHCP;
          GOTO      MCHG9999
.
MCHG4100  WRITE     HTMLFILE;VIEWTYPE;
          GOTO      MCHG9999
.
MCHG4200  WRITE     HTMLFILE;SHOWTYPE;
          GOTO      MCHG9999
.
MCHG9999  RETURN
.--------------------------------------------------------------------------
. Casemix Theatre Fee Maintenance Output
.--------------------------------------------------------------------------
CASF0000  BRANCH    FLDITMNO,CASF0100,CASF0200,CASF0300,CASF0400,CASF0500:
                             CASF0600,CASF0700,CASF0800,CASF0900,CASF1000:
                             CASF1100,CASF1200,CASF1300,CASF1400,CASF1500:
                             CASF1600,CASF1700,CASF1800,CASF1900,CASF2000:
                             CASF2100,CASF2200,CASF2300,CASF2400,CASF2500
          GOTO      CASF9999
.
CASF0100  MOVE      "CL",CATEGORY            * Claim Code
          MOVE      PTCTCLMN,CODE
          CALL      CODITM00
          GOTO      CASF9999
.
CASF0200  UNPACK    DIM127,D1,KEY1,DIM127
          MOVE      KEY1,F1
          BRANCH    F1,CASF0210
          WRITE     HTMLFILE;PTCTHFND;       * Health Fund
          GOTO      CASF9999
.
CASF0210  MATCH     SP70,PTCTHFND
          GOTO      CASF9999 IF EQUAL
.
          PACK      KEY14,PTCTHFND,SP70
          CALL      RDSFUND1
          CALL      RDKFUND1
          BRANCH    OVRCD,CASF9999
          WRITE     HTMLFILE;HFNAME;        * Health Fund Name
          GOTO      CASF9999
.
CASF0300  MOVE      "HT",CATEGORY           * Table Type
          MOVE      PTCTTABT,CODE
          CALL      CODITM00
          GOTO      CASF9999
.
CASF0400  UNPACK    DIM127,D1,KEY1,DIM127
          MOVE      KEY1,F1
          BRANCH    F1,CASF0410
          WRITE     HTMLFILE;PTCTCASM;      * DRG Code
          GOTO      CASF9999
.
CASF0410  MATCH     SP70,PTCTCASM
          GOTO      CASF9999 IF EQUAL
.
          PACK      KEY4,PTCTCASM,SP70
          MOVE      "999",KEY3
          PACK      KEY7,KEY4,KEY3,SP10     * last DRG version        *I-137125
          CALL      RSPTDGW1
          CALL      RPPTDGW1
          BRANCH    OVRCD,CASF9999
          MATCH     PTDWDRGC,KEY4           * same DRG code ?         *I-137125
          GOTO      CASF9999 IF NOT EQUAL                             *I-137125
          WRITE     HTMLFILE;PTDWDESC;      * DRG Code Desc
          GOTO      CASF9999
.
CASF0500  MOVE      "TB",CATEGORY           * MBS Theatre Banding Cat 
          MOVE      PTCTMBSB,CODE
          CALL      CODITM00
          GOTO      CASF9999
.
CASF0600  WRITE     HTMLFILE;PTCTDCAS;      * Day Case Y/N  
          GOTO      CASF9999
.
CASF0700  WRITE     HTMLFILE;PTCTITMS;      * Item Sequence
          GOTO      CASF9999
.
CASF0800  COMPARE   ZERO,PTCTDREB 
          GOTO      CASF9999 IF EQUAL
          WRITE     HTMLFILE;PTCTDREB;      * Rebate Portion
          GOTO      CASF9999
.
CASF0900  COMPARE   ZERO,PTCTDPAT 
          GOTO      CASF9999 IF EQUAL
          WRITE     HTMLFILE;PTCTDPAT;      * Patient Portion
          GOTO      CASF9999
.
CASF1000  CALL      CASFTB00                * Casemix Theatre Fee Table
          GOTO      CASF9999
.
CASF1100  CALL      NEXTTH00
          GOTO      CASF9999
.
CASF1200  CALL      PREVTH00
          GOTO      CASF9999
.
CASF1300  WRITE     HTMLFILE;FILEFLAG;
          GOTO      CASF9999
.
CASF1400  MOVE      "CL",CATEGORY            * Claim Code CGI
          MOVE      CASTH001,CODE
          CALL      CODITM00
          GOTO      CASF9999
.
CASF1500  UNPACK    DIM127,D1,KEY1,DIM127
          MOVE      KEY1,F1
          BRANCH    F1,CASF1510
          WRITE     HTMLFILE;CASTH002;       * Health Fund CGI
          GOTO      CASF9999
.
CASF1510  MATCH     SP70,CASTH002
          GOTO      CASF9999 IF EQUAL
.
          PACK      KEY14,CASTH002,SP70
          CALL      RDSFUND1
          CALL      RDKFUND1
          BRANCH    OVRCD,CASF9999
          WRITE     HTMLFILE;HFNAME;        * Health Fund Name
          GOTO      CASF9999
.
CASF1600  MOVE      "HT",CATEGORY           * Table Type CGI
          MOVE      CASTH003,CODE
          CALL      CODITM00
          GOTO      CASF9999
.
CASF1700  UNPACK    DIM127,D1,KEY1,DIM127
          MOVE      KEY1,F1
          BRANCH    F1,CASF1710
          MATCH     SP70,CASTH004
          GOTO      CASF9999 IF EQUAL
          WRITE     HTMLFILE;CASTH004;      * DRG Code CGI
          GOTO      CASF9999
.
CASF1710  MATCH     SP70,CASTH004
          GOTO      CASF9999 IF EQUAL
.
          PACK      KEY4,CASTH004,SP70
          MOVE      "999",KEY3
          PACK      KEY7,KEY4,KEY3,SP10     * last DRG version        *I-137125
          CALL      RSPTDGW1
          CALL      RPPTDGW1
          BRANCH    OVRCD,CASF9999
          MATCH     PTDWDRGC,KEY4           * same DRG code ?         *I-137125
          GOTO      CASF9999 IF NOT EQUAL                             *I-137125
          WRITE     HTMLFILE;PTDWDESC;      * DRG Code Desc
          GOTO      CASF9999
.
CASF1800  MOVE      "TB",CATEGORY           * MBS Theatre Banding Cat 
          MOVE      CASTH005,CODE
          CALL      CODITM00
          GOTO      CASF9999
.
CASF1900  WRITE     HTMLFILE;CASTH006;      * Day Case Y/N CGI
          GOTO      CASF9999
.
CASF2000  WRITE     HTMLFILE;CASETYPE;      * Type Casemix Code DRG or MBS
          GOTO      CASF9999
.
CASF2100  CALL      CSFETB00                * Table of Casemix Theatre Fees
          GOTO      CASF9999
.
CASF2200  CALL      NXTSEQ00                * Get Next Sequence No
          WRITE     HTMLFILE;F2;
          GOTO      CASF9999
.
CASF2300  CALL      NEXTTF00
          GOTO      CASF9999
.
CASF2400  CALL      PREVTF00
          GOTO      CASF9999
.
CASF2500  UNPACK    DIM127,D1,KEY1,DIM127
          MOVE      KEY1,F1
          BRANCH    F1,CASF2510
          WRITE     HTMLFILE;CASTH012;      * Contract ID
          GOTO      CASF9999
.
CASF2510  PACK      KEY6,CASTH012,SP70
          CALL      RDPMCID1
          BRANCH    OVRCD,CASM9999
.
          WRITE     HTMLFILE;PMCIDESC;      * Contract Description
          GOTO      CASF9999
.
CASF9999  RETURN
.
.--------------------------------------------------------------------------
. LGA and Catchment code allocation
.--------------------------------------------------------------------------
CTCH0000  BRANCH    FLDITMNO,CTCH0100,CTCH0200,CTCH0300,CTCH0400,CTCH0500
          GOTO      CASF9999
.
CTCH0100  MOVE      "CH",CATEGORY            * Catchment code
          MOVE      PTCAT001,CODE
          CALL      CODITM00
          GOTO      CASF9999
.
CTCH0200  CALL      LGAS0000                 * LGA selection
          GOTO      CASF9999
.
CTCH0300  WRITE     HTMLFILE;PTCAT003; 
          GOTO      CASF9999
.
CTCH0400  WRITE     HTMLFILE;PTCAT004; 
          GOTO      CASF9999
.
CTCH0500  WRITE     HTMLFILE;PTCAT005; 
          GOTO      CASF9999
.
CTCH9999  RETURN
+
.-------------------------------------------------------------------------
. LGA Selection
.-------------------------------------------------------------------------
LGAS0000  UNPACK    DIM127,D1,KEY1,DIM127     * .0   Religious visit
          MOVE      ZERO,F1
          MOVE      KEY1,F1
          BRANCH    F1,LGAS1000
          WRITE     HTMLFILE;PTCAT002;
          GOTO      LGAS9999
.
LGAS1000  MOVE      SP70,KEY4
          CALL      RDSLGAA1
LGAS2000  CALL      RDKLGAA1
          BRANCH    OVRCD,LGAS9999
.
          MATCH     PTCAT002,LGACODE
          IF        @EQUAL
            WRITE     HTMLFILE;"<option value=#"",LGACODE,"#" selected> ":
                               LGACODE,": ",LGADESC,"</option>"
          ELSE
            WRITE     HTMLFILE;"<option value=#"",LGACODE,"#"> ":
                               LGACODE,": ",LGADESC,"</option>"
          ENDIF
          GOTO      LGAS2000
.
LGAS9999  RETURN
+
.-------------------------------------------------------------------------
. Get Next Sequence No
.-------------------------------------------------------------------------
NXTSEQ00  MOVE      ONE,F2                 * Initialize Sequence to 1
.
          PACK      KEY33,CASTH012,CASTH001,CASTH002,CASTH003,CASTH004,CASTH005:
                          CASTH006,Z70  * Cur File
          CALL      RSPTCTF1                                     
          CALL      RPPTCTF1                                        
          BRANCH    OVRCD,NXTSEQ99                                
.
          MATCH     CASTH012,PTCTCNID          * Contract ID
          GOTO      NXTSEQ99 IF NOT EQUAL
.
          MATCH     CASTH001,PTCTCLMN          * Claim Code
          GOTO      NXTSEQ99 IF NOT EQUAL
.
          MATCH     CASTH002,PTCTHFND          * Health Fund
          GOTO      NXTSEQ99 IF NOT EQUAL
.
          MATCH     CASTH003,PTCTTABT          * Table Type
          GOTO      NXTSEQ99 IF NOT EQUAL
.
          MATCH     CASTH004,PTCTCASM          * DRG Code
          GOTO      NXTSEQ99 IF NOT EQUAL
.
          MATCH     CASTH005,PTCTMBSB          * MBS Code
          GOTO      NXTSEQ99 IF NOT EQUAL
.
          MATCH     CASTH006,DPTCTDCA          * Day Case       
          GOTO      NXTSEQ99 IF NOT EQUAL
.
          MOVE      ZERO,F2
          MOVE      PTCTITMS,F2
          ADD       ONE,F2           
.
NXTSEQ99  RETURN
.
.-------------------------------------------------------------------------
. Link to Next Fees
.-------------------------------------------------------------------------
NEXTFE00  MOVE      NORECORD,KEY2
          REP       " +",KEY2
          ASSIGN    STARTNUM+NORECORD,F3
          MOVE      F3,KEY3
          REP       " +",KEY3
          UNPACK    DIM127,D1,FLDPARA,DIM127
          MOVE      REPORTNO,F2
.
          WRITE     HTMLFILE;"patweb77.pbl":
                                 "?reportno=",F2:
                                 "&template=",FLDPARA:
                                 "&startnum=",KEY3:
                                 "&norecord=",KEY2:
                                 "&bdfee001=",BDFEE001:
                                 "&bdfee002=",BDFEE002:
                                 "&bdfee003=",BDFEE003:
                                 "&bdfee004=",BDFEE004:
                                 "&bdfee014=",BDFEE014;
.                                "&fileflag=",FILEFLAG;
.
          MATCH     "1",MENUFLAG
          IF        @EQUAL
            WRITE     HTMLFILE;"&menuflag=1";
          ENDIF
.
NEXTFE99  RETURN
.
.-------------------------------------------------------------
. Link to Prev Fees
.-------------------------------------------------------------
PREVFE00  MOVE      NORECORD,KEY2
          REP       " +",KEY2
          ASSIGN    STARTNUM-NORECORD,F3
          IF        F3<0
            MOVE      ZERO,F3
          ENDIF
          MOVE      F3,KEY3
          REP       " +",KEY3
          UNPACK    DIM127,D1,FLDPARA,DIM127
          MOVE      REPORTNO,F2
.
          WRITE     HTMLFILE;"patweb77.pbl":
                                 "?reportno=",F2:
                                 "&template=",FLDPARA:
                                 "&startnum=",KEY3:
                                 "&norecord=",KEY2:
                                 "&bdfee001=",BDFEE001:
                                 "&bdfee002=",BDFEE002:
                                 "&bdfee003=",BDFEE003:
                                 "&bdfee004=",BDFEE004:
                                 "&bdfee014=",BDFEE014;
.                                "&fileflag=",FILEFLAG;
.
          MATCH     "1",MENUFLAG
          IF        @EQUAL
            WRITE     HTMLFILE;"&menuflag=1";
          ENDIF
.
PREVFE99  RETURN
.-------------------------------------------------------------------------
. Link to Next Casemix Funds
.-------------------------------------------------------------------------
NEXTCS00  MOVE      NORECORD,KEY2
          REP       " +",KEY2
          ASSIGN    STARTNUM+NORECORD,F3
          MOVE      F3,KEY3
          REP       " +",KEY3
          UNPACK    DIM127,D1,FLDPARA,DIM127
          MOVE      REPORTNO,F2
.
          REP       " +",CASMX001
          REP       " +",CASMX002
          REP       " +",CASMX003
          REP       " +",CASMX009
.
          WRITE     HTMLFILE;"patweb77.pbl":
                                 "?reportno=",F2:
                                 "&template=",FLDPARA:
                                 "&startnum=",KEY3:
                                 "&norecord=",KEY2:
                                 "&casmx001=",CASMX001:
                                 "&casmx002=",CASMX002:
                                 "&casmx003=",CASMX003:
                                 "&casmx009=",CASMX009;
.
          MATCH     "1",MENUFLAG
          IF        @EQUAL
            WRITE     HTMLFILE;"&menuflag=1";
          ENDIF
.
          REP       "+ ",CASMX001
          REP       "+ ",CASMX002
          REP       "+ ",CASMX003
          REP       "+ ",CASMX009
.
NEXTCS99  RETURN
.
.-------------------------------------------------------------
. Link to Prev Casemix Funds
.-------------------------------------------------------------
PREVCS00  MOVE      NORECORD,KEY2
          REP       " +",KEY2
          ASSIGN    STARTNUM-NORECORD,F3
          IF        F3<0
            MOVE      ZERO,F3
          ENDIF
          MOVE      F3,KEY3
          REP       " +",KEY3
          UNPACK    DIM127,D1,FLDPARA,DIM127
          MOVE      REPORTNO,F2
.
          REP       " +",CASMX001
          REP       " +",CASMX002
          REP       " +",CASMX003
          REP       " +",CASMX009
.
          WRITE     HTMLFILE;"patweb77.pbl":
                                 "?reportno=",F2:
                                 "&template=",FLDPARA:
                                 "&startnum=",KEY3:
                                 "&norecord=",KEY2:
                                 "&casmx001=",CASMX001:
                                 "&casmx002=",CASMX002:
                                 "&casmx003=",CASMX003:
                                 "&casmx009=",CASMX009;
.
          MATCH     "1",MENUFLAG
          IF        @EQUAL
            WRITE     HTMLFILE;"&menuflag=1";
          ENDIF
.
          REP       "+ ",CASMX001
          REP       "+ ",CASMX002
          REP       "+ ",CASMX003
          REP       "+ ",CASMX009
.
PREVCS99  RETURN
.-------------------------------------------------------------------------
. Link to Next Set Casemix Theatre Fees
.-------------------------------------------------------------------------
NEXTTH00  MOVE      NORECORD,KEY2
          REP       " +",KEY2
          ASSIGN    STARTNUM+NORECORD,F3
          MOVE      F3,KEY3
          REP       " +",KEY3
          UNPACK    DIM127,D1,FLDPARA,DIM127
          MOVE      REPORTNO,F2
          MOVE      F2,DIM2
          REP       " +",DIM2
.
          REP       " +",CASTH001
          REP       " +",CASTH002
          REP       " +",CASTH003
          REP       " +",CASTH004
          REP       " +",CASTH005
          REP       " +",CASTH006
          REP       " +",CASTH012
          REP       " +",CASETYPE
.
          WRITE     HTMLFILE;"patweb77.pbl":
                                 "?reportno=",DIM2:
                                 "&template=",FLDPARA:
                                 "&startnum=",KEY3:
                                 "&norecord=",KEY2:
                                 "&casth001=",CASTH001:
                                 "&casth002=",CASTH002:
                                 "&casth003=",CASTH003:
                                 "&casth004=",CASTH004:
                                 "&casth005=",CASTH005:
                                 "&casth006=",CASTH006:
                                 "&casth012=",CASTH012:
                                 "&casetype=",CASETYPE:
                                 "&fileflag=",FILEFLAG;
.
          MATCH     "1",MENUFLAG
          IF        @EQUAL
            WRITE     HTMLFILE;"&menuflag=1";
          ENDIF
.
          REP       "+ ",CASTH001
          REP       "+ ",CASTH002
          REP       "+ ",CASTH003
          REP       "+ ",CASTH004
          REP       "+ ",CASTH005
          REP       "+ ",CASTH006
          REP       "+ ",CASTH012
          REP       "+ ",CASETYPE
.
NEXTTH99  RETURN
.-------------------------------------------------------------
. Link to Prev Casemix Theatre
.-------------------------------------------------------------
PREVTH00  MOVE      NORECORD,KEY2
          REP       " +",KEY2
          ASSIGN    STARTNUM-NORECORD,F3
          IF        F3<0
            MOVE      ZERO,F3
          ENDIF
          MOVE      F3,KEY3
          REP       " +",KEY3
          UNPACK    DIM127,D1,FLDPARA,DIM127
          MOVE      REPORTNO,F2
          MOVE      F2,DIM2
          REP       " +",DIM2
.
          REP       " +",CASTH001
          REP       " +",CASTH002
          REP       " +",CASTH003
          REP       " +",CASTH004
          REP       " +",CASTH005
          REP       " +",CASTH006
          REP       " +",CASTH012
          REP       " +",CASETYPE
.
          WRITE     HTMLFILE;"patweb77.pbl":
                                 "?reportno=",DIM2:
                                 "&template=",FLDPARA:
                                 "&startnum=",KEY3:
                                 "&norecord=",KEY2:
                                 "&casth001=",CASTH001:
                                 "&casth002=",CASTH002:
                                 "&casth003=",CASTH003:
                                 "&casth004=",CASTH004:
                                 "&casth005=",CASTH005:
                                 "&casth006=",CASTH006:
                                 "&casth012=",CASTH012:
                                 "&casetype=",CASETYPE:
                                 "&fileflag=",FILEFLAG;
.
          MATCH     "1",MENUFLAG
          IF        @EQUAL
            WRITE     HTMLFILE;"&menuflag=1";
          ENDIF
.
          REP       "+ ",CASTH001
          REP       "+ ",CASTH002
          REP       "+ ",CASTH003
          REP       "+ ",CASTH004
          REP       "+ ",CASTH005
          REP       "+ ",CASTH006
          REP       "+ ",CASTH012
          REP       "+ ",CASETYPE
.
PREVTH99  RETURN
.-------------------------------------------------------------------------
. Link to Next Set Casemix Theatre Fees Sequences 
.-------------------------------------------------------------------------
NEXTTF00  MOVE      NORECORD,KEY2
          REP       " +",KEY2
          ASSIGN    STARTNUM+NORECORD,F3
          MOVE      F3,KEY3
          REP       " +",KEY3
          UNPACK    DIM127,D1,FLDPARA,DIM127
          MOVE      REPORTNO,F2
          MOVE      F2,DIM2
          REP       " +",DIM2
.
          REP       " +",CASTH001
          REP       " +",CASTH002
          REP       " +",CASTH003
          REP       " +",CASTH004
          REP       " +",CASTH005
          REP       " +",CASTH006
          REP       " +",CASTH012
.
          WRITE     HTMLFILE;"patweb77.pbl":
                                 "?reportno=",DIM2:
                                 "&template=",FLDPARA:
                                 "&startnum=",KEY3:
                                 "&norecord=",KEY2:
                                 "&casth001=",CASTH001:
                                 "&casth002=",CASTH002:
                                 "&casth003=",CASTH003:
                                 "&casth004=",CASTH004:
                                 "&casth005=",CASTH005:
                                 "&casth006=",CASTH006:
                                 "&casth012=",CASTH012:
                                 "&casth007=1":
                                 "&fileflag=",FILEFLAG;
.
          MATCH     "1",MENUFLAG
          IF        @EQUAL
            WRITE     HTMLFILE;"&menuflag=1";
          ENDIF
.
          REP       "+ ",CASTH001
          REP       "+ ",CASTH002
          REP       "+ ",CASTH003
          REP       "+ ",CASTH004
          REP       "+ ",CASTH005
          REP       "+ ",CASTH006
          REP       "+ ",CASTH012
.
NEXTTF99  RETURN
.-------------------------------------------------------------
. Link to Prev Casemix Theatre Fee Sequences
.-------------------------------------------------------------
PREVTF00  MOVE      NORECORD,KEY2
          REP       " +",KEY2
          ASSIGN    STARTNUM-NORECORD,F3
          IF        F3<0
            MOVE      ZERO,F3
          ENDIF
          MOVE      F3,KEY3
          REP       " +",KEY3
          UNPACK    DIM127,D1,FLDPARA,DIM127
          MOVE      REPORTNO,F2
          MOVE      F2,DIM2
          REP       " +",DIM2
.
          REP       " +",CASTH001
          REP       " +",CASTH002
          REP       " +",CASTH003
          REP       " +",CASTH004
          REP       " +",CASTH005
          REP       " +",CASTH006
          REP       " +",CASTH012
.
          WRITE     HTMLFILE;"patweb77.pbl":
                                 "?reportno=",DIM2:
                                 "&template=",FLDPARA:
                                 "&startnum=",KEY3:
                                 "&norecord=",KEY2:
                                 "&casth001=",CASTH001:
                                 "&casth002=",CASTH002:
                                 "&casth003=",CASTH003:
                                 "&casth004=",CASTH004:
                                 "&casth005=",CASTH005:
                                 "&casth006=",CASTH006:
                                 "&casth012=",CASTH012:
                                 "&casth007=1":
                                 "&fileflag=",FILEFLAG;
.
          MATCH     "1",MENUFLAG
          IF        @EQUAL
            WRITE     HTMLFILE;"&menuflag=1";
          ENDIF
.
          REP       "+ ",CASTH001
          REP       "+ ",CASTH002
          REP       "+ ",CASTH003
          REP       "+ ",CASTH004
          REP       "+ ",CASTH005
          REP       "+ ",CASTH006
          REP       "+ ",CASTH012
.
PREVTF99  RETURN
.------------------------------------------------------------
. Table of Bed Fee File Details
.------------------------------------------------------------
BFEETB00  UNPACK    DIM127,D1,LINKPRG,DIM127
          UNPACK    DIM127,D1,LINKREP,DIM127
          UNPACK    DIM127,D1,LINKTEM,DIM127
.
          IF        NORECORD=0
            MOVE      PTCNNRTD,NORECORD      * Set Default No Records to Display
          ENDIF
          MOVE      ZERO,RECNUMB
          MOVE      ZERO,DISNUMB
.
          MATCH     SP70,BDFEE014
          IF        !@EQUAL & !@EOS
            MATCH     SP70,BDFEE001
            IF        !@EQUAL
              MATCH     SP70,BDFEE002
              IF        !@EQUAL
                PACK     KEY27,BDFEE014,BDFEE001,BDFEE002,BDFEE003,BDFEE004,SP70
              ELSE
                PACK     KEY27,BDFEE014,BDFEE001,BDFEE002,SP70
              ENDIF
            ELSE
              PACK      KEY27,BDFEE014,BDFEE001,SP70
            ENDIF
            CALL      RDSBFEE3                                         * File
          ELSE
            MATCH     SP70,BDFEE002
            IF        !@EQUAL
              PACK      KEY27,BDFEE001,BDFEE002,BDFEE003,BDFEE004,SP70
            ELSE
              PACK      KEY27,BDFEE001,BDFEE002,SP70
            ENDIF
            CALL      RDSBFEE1                                         * File
          ENDIF
.
BFEETB05  MATCH     SP70,BDFEE014
          IF        !@EQUAL & !@EOS
            CALL      RDKBFEE3 
          ELSE
            CALL      RDKBFEE1                                        * Current 
          ENDIF
          BRANCH    OVRCD,BFEETB90                                   * File
.
BFEETB20  MATCH     SP70,BDFEE014
          IF        !@EQUAL & !@EOS
.
            MATCH     BDFEE014,PTBFCNID
            GOTO      BFEETB90 IF NOT EQUAL
.
            MATCH     SP70,BDFEE001
            IF        !@EQUAL
              MATCH     BDFEE001,BFCLM
              GOTO      BFEETB90 IF NOT EQUAL
            ENDIF
.
            MATCH     SP70,BDFEE002
            IF        !@EQUAL
              MATCH     BDFEE002,BFHFUND
              IF        !@EQUAL
                MATCH     SP70,BDFEE001
                GOTO      BFEETB05 IF EQUAL
                GOTO      BFEETB90
              ENDIF
            ENDIF
.
            MATCH     SP70,BDFEE003
            IF        !@EQUAL
              MATCH     BDFEE003,PTBFHTYP
              IF        !@EQUAL
                MATCH     SP70,BDFEE002
                GOTO      BFEETB05 IF EQUAL
                GOTO      BFEETB90
              ENDIF
            ENDIF
.
            MATCH     SP70,BDFEE004
            IF        !@EQUAL
              MATCH     BDFEE004,BFATYPE
              GOTO      BFEETB05 IF NOT EQUAL
            ENDIF
.
          ELSE
.
            MATCH     BDFEE001,BFCLM
            GOTO      BFEETB90 IF NOT EQUAL
.
            MATCH     SP70,BDFEE002
            IF        !@EQUAL
              MATCH     BDFEE002,BFHFUND
              IF        !@EQUAL
                MATCH     SP70,BDFEE001
                GOTO      BFEETB05 IF EQUAL
                GOTO      BFEETB90
              ENDIF
            ENDIF
.
            MATCH     SP70,BDFEE003
            IF        !@EQUAL
              MATCH     BDFEE003,PTBFHTYP
              IF        !@EQUAL
                MATCH     SP70,BDFEE002
                GOTO      BFEETB05 IF EQUAL
                GOTO      BFEETB90
              ENDIF
            ENDIF
.
            MATCH     SP70,BDFEE004
            IF        !@EQUAL
              MATCH     BDFEE004,BFATYPE
              GOTO      BFEETB05 IF NOT EQUAL
            ENDIF
.
            MATCH     SP70,BDFEE014
            IF        !@EQUAL & !@EOS
              PACK      BDFEE014,BDFEE014,SP70
              MATCH     BDFEE014,PTBFCNID
              IF        !@EQUAL
                GOTO      BFEETB05
              ENDIF
            ENDIF
.
          ENDIF
.
          ADD       ONE,RECNUMB
          IF        STARTNUM>=RECNUMB
            GOTO      BFEETB05
          ENDIF
.
          CALL      BFEERW00
          ADD       ONE,DISNUMB
          COMPARE   NORECORD,DISNUMB
          IF        !@EQUAL
.           MATCH     "N",FILEFLAG
.           GOTO      BFEETB15 IF EQUAL
            GOTO      BFEETB05
          ENDIF
          GOTO      BFEETB99
.
BFEETB90  CALL      NOMORE00     * Display No More Records Message
.
BFEETB99  RETURN
.------------------------------------------------------------
. Bed Fee File Table (TABLE ROW)
.------------------------------------------------------------
BFEERW00  MOVE      "A ",CATEGORY
          MOVE      BFATYPE,CODE
          CALL      GETCOD00
.
          MOVE      ZERO,TOTAL
          ADD       BFHF,TOTAL
          ADD       BFPAT,TOTAL
.
          WRITE     HTMLFILE;"<tr><td>&nbsp;",PTBFCNID,"</td>":
                             "<td>&nbsp;",BFCLM,"</td>":
                             "<td nowrap><A HREF='javascript:ShowLink":
                             "(#"",LINKPRG,"#.pbl":
                             "?reportno=",LINKREP:
                             "&template=",LINKTEM:
                             "&bdfee001=",BFCLM:
                             "&bdfee002=",BFHFUND:
                             "&bdfee003=",PTBFHTYP:
                             "&bdfee004=",BFATYPE:
                             "&bdfee005=",BFBTYPE:
                             "&bdfee006=",BFENDDY:
                             "&bdfee014=",PTBFCNID,"#")'>":
.                            "&fileflag=",FILEFLAG,"#")'>":
                             "<img src=../images/MaintenanceIcon.gif hspace=4":
                             " border=0 align=absmiddle></a>":
                             BFHFUND,"</td>":
                             "<td>&nbsp;",PTBFHTYP,"</td>":
                             "<td>&nbsp;",TDESC,"</td>":
                             "<td>&nbsp;",BFBTYPE,"</td>":
                             "<td>&nbsp;",BFENDDY,"</td>":
                             "<td>&nbsp;",BFDESC,"</td>":
                             "<td>&nbsp;",BFNINV,"</td>":
                             "<td>&nbsp;",BFPAT,"</td>":
                             "<td>&nbsp;",BFHF,"</td>":
                             "<td>&nbsp;",TOTAL,"</td>":
                             "</tr>"
.
BFEERW99 RETURN
.
.------------------------------------------------------------
. Table of Casemix Funding Details
.------------------------------------------------------------
CASMTB00  UNPACK    DIM127,D1,LINKPRG,DIM127
          UNPACK    DIM127,D1,LINKREP,DIM127
          UNPACK    DIM127,D1,LINKTEM,DIM127
.
          IF        NORECORD=0
            MOVE      PTCNNRTD,NORECORD      * Set Default No Records to Display
          ENDIF
          MOVE      ZERO,RECNUMB
          MOVE      ZERO,DISNUMB
          MOVE      ZERO,LOOPCNTR
.
.         if a Contract ID is entered, use index 2 and position on Contract ID
.
          MOVE      ONE,F1                     * Using index 1
          MATCH     SP70,CASMX009              * Contract ID
          GOTO      CASMTB40 IF EQUAL
.
          MOVE      TWO,F1                     * Using index 2
          PACK      KEY24,CASMX009,CASMX001,CASMX002,CASMX003
          CALL      RDPTCMX2
          COMPARE   ZERO,OVRCD
          GOTO      CASMTB60 IF EQUAL
.
          CALL      RSPTCMX2
CASMTB10  CALL      RKPTCMX2
          BRANCH    OVRCD,CASMTB90
.
          MATCH     CASMX009,PTCMCNID              * Contract ID
          GOTO      CASMTB90 IF NOT EQUAL
.
          GOTO      CASMTB52
.
.         Claim code field is a Mandatory selection field
.
CASMTB40  MATCH     SP70,CASMX001
          GOTO      CASMTB99 IF EQUAL
.
          PACK      KEY24,CASMX001,CASMX002,CASMX003,SP70  * Current
          CALL      RSPTCMX1                                     
CASMTB50  CALL      RKPTCMX1                                        
          BRANCH    OVRCD,CASMTB99                                
.
CASMTB52  MATCH     CASMX001,PTCMCLMN
          GOTO      CASMTB90 IF NOT EQUAL
.
          ADD       ONE,LOOPCNTR
.
.  Write record number in a comment to keep apache listening if no matches   
.  are found per 1,000 records
.
          IF        (LOOPCNTR = 1000)
            WRITE     HTMLFILE;"<!--",LOOPCNTR,"-->"
            MOVE      ZERO,LOOPCNTR
          ENDIF
.
          MATCH     SP70,CASMX002
          IF        !@EQUAL
            MATCH     CASMX002,PTCMHFND       
            GOTO      CASMTB80 IF NOT EQUAL
          ENDIF
.
          MATCH     SP70,CASMX003
          IF        !@EQUAL
            MATCH     CASMX003,PTCMCASM       
            GOTO      CASMTB80 IF NOT EQUAL
          ENDIF 
.
          COMPARE   TWO,F1
          GOTO      CASMTB60 IF EQUAL              * Using index 2
.
          MATCH     SP70,CASMX009
          IF        !@EQUAL
            MATCH     CASMX009,PTCMCNID              * Contract ID       
            IF        !@EQUAL
              GOTO      CASMTB80
            ENDIF
          ENDIF
.
CASMTB60  ADD       ONE,RECNUMB
          IF        STARTNUM>=RECNUMB
            GOTO      CASMTB80
          ENDIF
.
          CALL      CASMRW00
.
          MOVE      ZERO,LOOPCNTR
.
          ADD       ONE,DISNUMB
          COMPARE   NORECORD,DISNUMB
          IF        !@EQUAL
            GOTO      CASMTB80
          ENDIF
          GOTO      CASMTB99
.
CASMTB80  BRANCH    F1,CASMTB50,CASMTB10
          GOTO      CASMTB99
.
CASMTB90  CALL      NOMORE00      * Display No More Records Message
.
CASMTB99  RETURN
.------------------------------------------------------------
. Casemix Funding Table (TABLE ROW)
.------------------------------------------------------------
CASMRW00  PACK      KEY9,PTCMCASM,SP70
          CALL      RDPTCMC1
          IF        OVRCD=1
            MOVE      "&nbsp;",PTCADES1  * Casemix Code Description
          ENDIF 
.
          MOVE      "No",KEY3
          COMPARE   ONE,PTCMDIFG
          IF        @EQUAL
            MOVE      "Yes",KEY3
          ENDIF
.
          WRITE     HTMLFILE;"<tr><td nowrap><A HREF='javascript:ShowLink":
                             "(#"",LINKPRG,"#.pbl":
                             "?reportno=",LINKREP:
                             "&template=",LINKTEM:
                             "&casmx009=",PTCMCNID:
                             "&casmx001=",PTCMCLMN:
                             "&casmx002=",PTCMHFND:
                             "&casmx003=",PTCMCASM,"#")'>":
                             "<img src=../images/MaintenanceIcon.gif hspace=4":
                             " border=0 align=absmiddle></a>":
                             PTCMCASM,"</td>":
                             "<td>",PTCADES1,"</td>":
                             "<td>",PTCMXLOS,"</td>":
                             "<td>",KEY3,"</td>":
                             "<td>",PTCMCNID,"</td>":
                             "<td>&nbsp;",PTCMHFND,"</td>":
                             "</tr>"
.
CASMRW99  RETURN
.------------------------------------------------------------
. Table of Casemix Theatre Fee Header Record Details
.------------------------------------------------------------
CASFTB00  UNPACK    DIM127,D1,LINKPRG,DIM127
          UNPACK    DIM127,D1,LINKREP,DIM127
          UNPACK    DIM127,D1,LINKTEM,DIM127
.
          IF        NORECORD=0
            MOVE      PTCNNRTD,NORECORD      * Set Default No Records to Display
          ENDIF
          MOVE      ZERO,RECNUMB
          MOVE      ZERO,DISNUMB
          MOVE      ZERO,LOOPCNTR
.
          MATCH     SP70,CASTH001
          GOTO      CASFTB90 IF EQUAL
.
          MOVE      ONE,F2
          PACK      KEY33,F2,CASTH001,SP70  * Cur File
.
          MATCH     SP70,CASTH002
          IF        !@EQUAL
            PACK      KEY33,F2,CASTH001,CASTH002,CASTH003,SP70
          ENDIF
.
          CALL      RSPTCTF3                                     
CASFTB05  CALL      RKPTCTF3                                        
          BRANCH    OVRCD,CASFTB90                                
.
          COMPARE   ONE,PTCTITMS                 * Only Sequence 1's
          GOTO      CASFTB90 IF NOT EQUAL
.
          MATCH     CASTH001,PTCTCLMN            * Claim Code
          GOTO      CASFTB90 IF NOT EQUAL
.
          MATCH     SP70,CASTH002                
          IF        !@EQUAL
            MATCH     CASTH002,PTCTHFND          * Health Fund
            GOTO      CASFTB90 IF NOT EQUAL
          ENDIF 
.
          MATCH     SP70,CASTH003                
          IF        !@EQUAL
            MATCH     CASTH003,PTCTTABT          * Table Type
            GOTO      CASFTB90 IF NOT EQUAL
          ENDIF
.
          ADD       ONE,LOOPCNTR
.
.  Write record number in a comment to keep apache listening if no matches
.  are found per 1,000 records
.
          IF        (LOOPCNTR = 1000)
            WRITE     HTMLFILE;"<!--",LOOPCNTR,"-->"
            MOVE      ZERO,LOOPCNTR
          ENDIF
.
          MATCH     SP70,CASTH012
          IF        !@EQUAL
            MATCH     CASTH012,PTCTCNID          * Contract ID
            GOTO      CASFTB50 IF NOT EQUAL
          ENDIF
.
          MATCH     SP70,CASTH004                * DRG Code
          IF        !@EQUAL
            MATCH     CASTH004,PTCTCASM       
            GOTO      CASFTB50 IF NOT EQUAL
          ENDIF 
.
          MATCH     SP70,CASTH005                * MBS Code
          IF        !@EQUAL
            MATCH     CASTH005,PTCTMBSB       
            GOTO      CASFTB50 IF NOT EQUAL
          ENDIF 
.
          MATCH     SP70,CASTH006                
          IF        !@EQUAL
            MATCH     CASTH006,DPTCTDCA          * Day Case       
            GOTO      CASFTB50 IF NOT EQUAL
          ENDIF 
.
          MATCH     SP70,CASETYPE
          IF        !@EQUAL
            MATCH     "D",CASETYPE               * check for DRG casemix
            IF        @EQUAL
              MATCH      SP70,PTCTCASM           * check DRG Code is not blank
              IF        @EQUAL
                GOTO       CASFTB50 
              ENDIF
            ENDIF
          ENDIF
.
          MATCH     SP70,CASETYPE
          IF        !@EQUAL
            MATCH     "M",CASETYPE               * check for MBS Band casemix 
            IF        @EQUAL
              MATCH      SP70,PTCTMBSB           * check MBS Band is not blank
              IF        @EQUAL
                GOTO       CASFTB50
              ENDIF
            ENDIF
          ENDIF
.
          ADD       ONE,RECNUMB
          IF        STARTNUM>=RECNUMB
            GOTO      CASFTB05
          ENDIF
.
          CALL      CASFRW00
.
          MOVE      ZERO,LOOPCNTR
.
          ADD       ONE,DISNUMB
          COMPARE   NORECORD,DISNUMB
          IF        !@EQUAL
            GOTO      CASFTB05
          ENDIF
          GOTO      CASFTB99
.
CASFTB50  GOTO      CASFTB05
.
CASFTB90  CALL      NOMORE00     * Display No More Records Message
.
CASFTB99  RETURN
.------------------------------------------------------------
. Casemix Theatre Fee Table (TABLE ROW)
.------------------------------------------------------------
CASFRW00  MOVE      "&nbsp;",CASCODE   * Code 
	  MOVE      "&nbsp;",CASDESCR  * Code Description
          MOVE      "&nbsp;",CASTYPE   * Type
.
          MATCH     SP70,PTCTCASM
          IF        !@EQUAL
            PACK      KEY9,PTCTCASM,SP70
            CALL      RDPTCMC1
            IF        OVRCD=1
              MOVE      "&nbsp;",CASCODE   * Code 
              MOVE      "&nbsp;",CASDESCR  * Code Description
            ELSE  
              MOVE      PTCTCASM,CASCODE   * Code
              MOVE      PTCADES1,CASDESCR  * Casemix Code Description
              MOVE      "DRG",CASTYPE      * Type
            ENDIF 
          ENDIF
.
          MATCH      SP70,PTCTMBSB
          IF         !@EQUAL
            MOVE      "TB",CATEGORY
            MOVE      PTCTMBSB,CODE
            CALL      GETCOD00
            MOVE      PTCTMBSB,CASCODE   * Code 
            MOVE      TDESC,CASDESCR     * Casemix Code Description
            MOVE      "BAND",CASTYPE     * Type
          ENDIF
.
          MATCH     SP70,PTCTHFND
          IF        !@EQUAL
            PACK      KEY14,PTCTHFND,SP70
            CALL      RDSFUND1
            CALL      RDKFUND1
            BRANCH    OVRCD,CASF9999
            MOVE      PTCTHFND,HLTHFUND
          ELSE
            MOVE      "&nbsp;",HLTHFUND 
            MOVE      "&nbsp;",HFNAME 
          ENDIF
.
          MOVE      "&nbsp;",TABLTYPE
          MATCH     SP70,PTCTTABT
          IF        !@EQUAL
            MOVE      "HT",CATEGORY           * Table Type
            MOVE      PTCTTABT,CODE
            CALL      GETCOD00
            MOVE      TDESC,TABLTYPE
          ENDIF
.
          MOVE      "No",KEY3       
          COMPARE   ONE,PTCTDCAS        * Day Case Y/N
          IF        @EQUAL
            MOVE      "Yes",KEY3
          ENDIF
.
          WRITE     HTMLFILE;"<tr>":
                             "<td>",PTCTCNID,"&nbsp;</td>":
                             "<td nowrap><A HREF='javascript:ShowLink":
                             "(#"",LINKPRG,"#.pbl":
                             "?reportno=",LINKREP:
                             "&template=",LINKTEM;
.
          MATCH     "1",MENUFLAG
          IF        @EQUAL
            WRITE     HTMLFILE;"&menuflag=1";
          ENDIF
.
          WRITE     HTMLFILE;"&casth012=",PTCTCNID:
                             "&casth001=",PTCTCLMN:
                             "&casth002=",PTCTHFND:
                             "&casth003=",PTCTTABT:
                             "&casth004=",PTCTCASM:
                             "&casth005=",PTCTMBSB:
                             "&casth006=",PTCTDCAS:
                             "&casth007=",PTCTITMS:
                             "&fileflag=",FILEFLAG,"#")'>":
                             "<img src=../images/MaintenanceIcon.gif hspace=4":
                             " border=0 align=absmiddle></a>":
                             CASTYPE,"</td>":
                             "<td>",CASCODE,"</td>":
                             "<td>",CASDESCR,"</td>":
                             "<td>",HLTHFUND,"</td>":
                             "<td>",HFNAME,"</td>":
                             "<td>",TABLTYPE,"</td>":
                             "<td>",KEY3,"</td>":
                             "</tr>"
.
CASFRW99 RETURN
.------------------------------------------------------------
. Table of Casemix Theatre Fee Details Record 
.------------------------------------------------------------
CSFETB00  UNPACK    DIM127,D1,LINKPRG,DIM127
          UNPACK    DIM127,D1,LINKREP,DIM127
          UNPACK    DIM127,D1,LINKTEM,DIM127
.
          CALL      CSFEHD00      * Output Table Heading
.
          IF        NORECORD=0
            MOVE      "11",NORECORD       * Set Default No Records to Display
          ENDIF
          MOVE      ZERO,RECNUMB
          MOVE      ZERO,DISNUMB
.
          MATCH     SP70,CASTH001
          GOTO      CSFETB99 IF EQUAL
.
          PACK      KEY33,CASTH012,CASTH001,CASTH002,CASTH003,CASTH004,CASTH005:
                          CASTH006,SP70  * Cur File
          CALL      RSPTCTF1                                     
CSFETB05  CALL      RKPTCTF1                                        
          BRANCH    OVRCD,CSFETB99                                
.
          MATCH     CASTH012,PTCTCNID          * Contract ID
          GOTO      CSFETB99 IF NOT EQUAL
.
          MATCH     CASTH001,PTCTCLMN          * Claim Code
          GOTO      CSFETB99 IF NOT EQUAL
.
          MATCH     CASTH002,PTCTHFND          * Health Fund
          GOTO      CSFETB99 IF NOT EQUAL
.
          MATCH     CASTH003,PTCTTABT          * Table Type
          GOTO      CSFETB99 IF NOT EQUAL
.
          MATCH     CASTH004,PTCTCASM          * DRG Code
          GOTO      CSFETB99 IF NOT EQUAL
.
          MATCH     CASTH005,PTCTMBSB          * MBS Code
          GOTO      CSFETB99 IF NOT EQUAL
.
          MATCH     CASTH006,DPTCTDCA          * Day Case       
          GOTO      CSFETB99 IF NOT EQUAL
.
          ADD       ONE,RECNUMB
          IF        STARTNUM>=RECNUMB
            GOTO      CSFETB05
          ENDIF
.
          CALL      CSFERW00
.
          ADD       ONE,DISNUMB
          COMPARE   NORECORD,DISNUMB
          IF        !@EQUAL
            GOTO      CSFETB05
          ENDIF
.
CSFETB99  RETURN
.------------------------------------------------------------
. Casemix Theatre Fee's Details Table (TABLE HEADING)
.------------------------------------------------------------
CSFEHD00  WRITE     HTMLFILE;"<tr>":
                             "<td class=HeadingCell>Sequence No</td>":
                             "<td class=HeadingCell>Patient</td>":
                             "<td class=HeadingCell>Rebate</td>":
                             "<td class=HeadingCell>Total</td>":
                             "</tr>"
.
CSFEHD99  RETURN
.------------------------------------------------------------
. Casemix Theatre Fee's Details Table (TABLE ROW)
.------------------------------------------------------------
CSFERW00  MOVE      ZERO,TOTALCS
          ADD       PTCTDREB,TOTALCS
          ADD       PTCTDPAT,TOTALCS
. 
          WRITE     HTMLFILE;"<tr><td nowrap>";
.
          MATCH     "1",MENUFLAG
          GOTO      CSFERW20 IF EQUAL
.
          WRITE     HTMLFILE;"<A HREF='javascript:ShowLink":
                             "(#"",LINKPRG,"#.pbl":
                             "?reportno=",LINKREP:
                             "&template=",LINKTEM:
                             "&casth012=",PTCTCNID:
                             "&casth001=",PTCTCLMN:
                             "&casth002=",PTCTHFND:
                             "&casth003=",PTCTTABT:
                             "&casth004=",PTCTCASM:
                             "&casth005=",PTCTMBSB:
                             "&casth006=",PTCTDCAS:
                             "&casth007=",PTCTITMS:
                             "&fileflag=",FILEFLAG,"#")'>":
                             "<img src=../images/MaintenanceIcon.gif hspace=4":
                             " border=0 align=absmiddle></a>";
.
CSFERW20 WRITE     HTMLFILE;PTCTITMS,"</td>":
                             "<td>",PTCTDPAT,"</td>":
                             "<td>",PTCTDREB,"</td>":
                             "<td>",TOTALCS,"</td>":
                             "</tr>"
.
CSFERW99 RETURN
.-------------------------------------------------------------------------
. Link to Next Theatre Charges
.-------------------------------------------------------------------------
NEXTCH00  MOVE      NORECORD,KEY2
          REP       " +",KEY2
          ASSIGN    STARTNUM+NORECORD,F3
          MOVE      F3,KEY3
          REP       " +",KEY3
          UNPACK    DIM127,D1,FLDPARA,DIM127
          MOVE      REPORTNO,F2
.
          WRITE     HTMLFILE;"patweb77.pbl":
                                 "?reportno=",F2:
                                 "&template=",FLDPARA:
                                 "&startnum=",KEY3:
                                 "&norecord=",KEY2:
                                 "&opchg001=",OPCHG001:
                                 "&opchg002=",OPCHG002:
                                 "&opchg003=",OPCHG003:
                                 "&opchg004=",OPCHG004:
                                 "&opchg026=",OPCHG026;
.                                "&fileflag=",FILEFLAG;
.
          MATCH     "1",MENUFLAG
          IF        @EQUAL
            WRITE     HTMLFILE;"&menuflag=1";
          ENDIF
.
NEXTCH99  RETURN
.
.-------------------------------------------------------------
. Link to Prev Theatre Charges
.-------------------------------------------------------------
PREVCH00  MOVE      NORECORD,KEY2
          REP       " +",KEY2
          ASSIGN    STARTNUM-NORECORD,F3
          IF        F3<0
            MOVE      ZERO,F3
          ENDIF
          MOVE      F3,KEY3
          REP       " +",KEY3
          UNPACK    DIM127,D1,FLDPARA,DIM127
          MOVE      REPORTNO,F2
.
          WRITE     HTMLFILE;"patweb77.pbl":
                                 "?reportno=",F2:
                                 "&template=",FLDPARA:
                                 "&startnum=",KEY3:
                                 "&norecord=",KEY2:
                                 "&opchg001=",OPCHG001:
                                 "&opchg002=",OPCHG002:
                                 "&opchg003=",OPCHG003:
                                 "&opchg004=",OPCHG004:
                                 "&opchg026=",OPCHG026;
.                                "&fileflag=",FILEFLAG;
.
          MATCH     "1",MENUFLAG
          IF        @EQUAL
            WRITE     HTMLFILE;"&menuflag=1";
          ENDIF
.
PREVCH99  RETURN
.
.------------------------------------------------------------
. Table of Theatre Charges File Details
.------------------------------------------------------------
OCHGTB00  UNPACK    DIM127,D1,LINKPRG,DIM127
          UNPACK    DIM127,D1,LINKREP,DIM127
          UNPACK    DIM127,D1,LINKTEM,DIM127
.
          IF        NORECORD=0
            MOVE      PTCNNRTD,NORECORD      * Set Default No Records to Display
          ENDIF
          MOVE      ZERO,RECNUMB
          MOVE      ZERO,DISNUMB
.
          MATCH     SP70,OPCHG026
          IF        !@EQUAL & !@EOS
            PACK      KEY24,OPCHG026,OPCHG001,OPCHG002,OPCHG003,OPCHG004,SP70
            CALL      RDTFEE2
            COMPARE   ZERO,OVRCD
            GOTO      OCHGTB20 IF EQUAL
          ELSE 
            PACK      KEY24,OPCHG001,OPCHG002,OPCHG003,OPCHG004,SP70   * Current
            CALL      RDTFEE1                                          * File
            COMPARE   ZERO,OVRCD
            GOTO      OCHGTB20 IF EQUAL
          ENDIF
.
          MATCH     SP70,OPCHG026
          IF        !@EQUAL & !@EOS
            PACK      KEY24,OPCHG026,OPCHG001,OPCHG002,OPCHG003,OPCHG004,SP70
            CALL      RDSTFEE2
          ELSE
            PACK      KEY24,OPCHG001,OPCHG002,OPCHG003,OPCHG004,SP70   * Current
            CALL      RDSTFEE1                                         * File
          ENDIF
.
OCHGTB05  MATCH     SP70,OPCHG026
          IF        !@EQUAL & !@EOS
            CALL      RDKTFEE2
          ELSE 
            CALL      RDKTFEE1                                         * Current
          ENDIF
          BRANCH    OVRCD,OCHGTB90                                   * File
          GOTO      OCHGTB20
.
OCHGTB20  MATCH     SP70,OPCHG026
          IF        !@EQUAL & !@EOS
.
            MATCH     OPCHG026,PTTFCNID
            GOTO      OCHGTB90 IF NOT EQUAL
.
            MATCH     SP70,OPCHG001
            IF        !@EQUAL
              MATCH     OPCHG001,TFCLM
              GOTO      OCHGTB05 IF NOT EQUAL
            ENDIF
.
            MATCH     SP70,OPCHG002
            IF        !@EQUAL
              MATCH     OPCHG002,TFHFUND
              IF        !@EQUAL
                MATCH     SP70,OPCHG001
                GOTO      OCHGTB05 IF EQUAL
                GOTO      OCHGTB90
              ENDIF
            ENDIF
.
            MATCH     SP70,OPCHG003
            IF        !@EQUAL
              MATCH     OPCHG003,PTTFHTYP
              IF        !@EQUAL
                MATCH     SP70,OPCHG001
                GOTO      OCHGTB05 IF EQUAL
                GOTO      OCHGTB90
              ENDIF
            ENDIF
.
            MATCH     SP70,OPCHG004
            IF        !@EQUAL
              MATCH     OPCHG004,TFDAYC
              GOTO      OCHGTB05 IF NOT EQUAL
            ENDIF
.
          ELSE
.
            MATCH     SP70,OPCHG001
            IF        !@EQUAL
              MATCH     OPCHG001,TFCLM
              GOTO      OCHGTB90 IF NOT EQUAL
            ENDIF
.
            MATCH     SP70,OPCHG002
            IF        !@EQUAL
              MATCH     OPCHG002,TFHFUND
              GOTO      OCHGTB90 IF NOT EQUAL
            ENDIF
.
            MATCH     SP70,OPCHG003
            IF        !@EQUAL
              MATCH     OPCHG003,PTTFHTYP
              GOTO      OCHGTB99 IF NOT EQUAL
            ENDIF
.
            MATCH     SP70,OPCHG004
            IF        !@EQUAL
              MATCH     OPCHG004,TFDAYC
              GOTO      OCHGTB05 IF NOT EQUAL
            ENDIF
.
            MATCH     SP70,OPCHG026
            IF        !@EQUAL & !@EOS
              PACK      OPCHG026,OPCHG026,SP70
              MATCH     OPCHG026,PTTFCNID
              GOTO      OCHGTB05 IF NOT EQUAL
            ENDIF
.
          ENDIF
.
          ADD       ONE,RECNUMB
          IF        STARTNUM>=RECNUMB
            GOTO      OCHGTB05
          ENDIF
.
          CALL      OCHGRW00
          ADD       ONE,DISNUMB
          COMPARE   NORECORD,DISNUMB
          GOTO      OCHGTB05 IF NOT EQUAL
          GOTO      OCHGTB99
.
OCHGTB90  CALL      NOMORE00     * Display No More Records Message
.
OCHGTB99  RETURN
.
.------------------------------------------------------------
. Theatre Charges File Table (TABLE ROW)
.------------------------------------------------------------
OCHGRW00  MOVE      ZERO,TOTAL
          ADD       TFHF1,TOTAL
          ADD       TFPAT1,TOTAL
.
          MATCH     ANSD,TFDAYC
          IF        @EQUAL
            MOVE     "Yes",D3
          ELSE
            MOVE     "No ",D3
          ENDIF
.
          MOVE      TFENDMBS,DIM19               * Default MBS description
.
          MATCH     SP70,TFHFUND                 * Check Claim Code
          GOTO      OCHGRW10 IF EQUAL
.
          PACK      KEY14,TFHFUND,ZERO,ZERO,ZERO,ZERO,SP70
          CALL      RDFUND1
          BRANCH    OVRCD,OCHGRW50
.
          GOTO      OCHGRW20
.
OCHGRW10  PACK      KEY5,ANSC,ANSL,TFCLM,SP70
          CALL      RDCODE1
          BRANCH    OVRCD,OCHGRW50
.
          MOVE      TCFORM6,HFBAND
.
OCHGRW20  COMPARE   ZERO,HFBAND
          GOTO      OCHGRW50 IF EQUAL
.
          PACK      KEY5,ANST,ANSB,TFENDMBS
          CALL      RDCODE1
          BRANCH    OVRCD,OCHGRW50
          MOVE      TDESC,DIM19
.
OCHGRW50  WRITE     HTMLFILE;"<tr><td nowrap>",PTTFCNID,"</td>":
                             "<td nowrap>",TFCLM,"</td>":
                             "<td nowrap><A HREF='javascript:ShowLink":
                             "(#"",LINKPRG,"#.pbl":
                             "?reportno=",LINKREP:
                             "&template=",LINKTEM:
                             "&opchg001=",TFCLM:
                             "&opchg002=",TFHFUND:
                             "&opchg003=",PTTFHTYP:
                             "&opchg004=",TFDAYC:
                             "&opchg005=",TFENDMBS:
                             "&opchg026=",PTTFCNID:
                             "&fileflag=",FILEFLAG,"#")'>":
                             "<img src=../images/MaintenanceIcon.gif hspace=4":
                             " border=0 align=absmiddle>":
                             "</a>",DIM19,"</td>":
                             "<td>&nbsp;",TFHFUND,"</td>":
                             "<td>&nbsp;",PTTFHTYP,"</td>":
                             "<td>&nbsp;",D3,"</td>":
                             "<td>&nbsp;",TFNINV,"</td>":
                             "<td>&nbsp;",TFPAT1,"</td>":
                             "<td>&nbsp;",TFHF1,"</td>":
                             "<td>&nbsp;",TOTAL,"</td>":
                             "</tr>"
.
OCHGRW99 RETURN
.------------------------------------------------------------
. GST Code Selection List
.------------------------------------------------------------
CODGST00  PACK      KEY6,SP70
          CALL      RSIBGS1
CODGST10  CALL      RKIBGS1
          BRANCH    OVRCD,CODGST99
          COMPARE   "1",IBGSACTV
          GOTO      CODGST10 IF EQUAL
.
          MATCH     PTMCGSTC,IBGSCODE
          IF        @EQUAL
            WRITE     HTMLFILE;"<option value=",IBGSCODE," selected>":
                               IBGSDESC,"</option>"
          ELSE
            WRITE     HTMLFILE;"<option value=",IBGSCODE,">":
                               IBGSDESC,"</option>"
          ENDIF
.
          GOTO      CODGST10
.
CODGST99  RETURN
.-------------------------------------------------------------------------
. Link to Next Miscellaneous Charges
.-------------------------------------------------------------------------
NEXTMC00  MOVE      NORECORD,KEY2
          REP       " +",KEY2
          ASSIGN    STARTNUM+NORECORD,F3
          MOVE      F3,KEY3
          REP       " +",KEY3
          UNPACK    DIM127,D1,FLDPARA,DIM127
          MOVE      REPORTNO,F2
.
          WRITE     HTMLFILE;"patweb77.pbl":
                                 "?reportno=",F2:
                                 "&template=",FLDPARA:
                                 "&startnum=",KEY3:
                                 "&norecord=",KEY2:
                                 "&mschg001=",MSCHG001:
                                 "&mschg002=",MSCHG002:
....                             "&mschg003=",MSCHG003:               *C-233046
                                 "&mschg034=",MSCHG034:
                                 "&mschg004=",MSCHG004:
                                 "&fileflag=",FILEFLAG:
                                 "&viewtype=",VIEWTYPE:
                                 "&showtype=",SHOWTYPE;
.
          MATCH     "1",MENUFLAG
          IF        @EQUAL
            WRITE     HTMLFILE;"&menuflag=1";
          ENDIF
.
NEXTMC99  RETURN
.
.-------------------------------------------------------------
. Link to Prev Miscellaneous Charges
.-------------------------------------------------------------
PREVMC00  MOVE      NORECORD,KEY2
          REP       " +",KEY2
          ASSIGN    STARTNUM-NORECORD,F3
          IF        F3<0
            MOVE      ZERO,F3
          ENDIF
          MOVE      F3,KEY3
          REP       " +",KEY3
          UNPACK    DIM127,D1,FLDPARA,DIM127
          MOVE      REPORTNO,F2
.
          WRITE     HTMLFILE;"patweb77.pbl":
                                 "?reportno=",F2:
                                 "&template=",FLDPARA:
                                 "&startnum=",KEY3:
                                 "&norecord=",KEY2:
                                 "&mschg001=",MSCHG001:
                                 "&mschg002=",MSCHG002:
....                             "&mschg003=",MSCHG003:               *C-233046
                                 "&mschg034=",MSCHG034:
                                 "&mschg004=",MSCHG004:
                                 "&fileflag=",FILEFLAG:
                                 "&viewtype=",VIEWTYPE:
                                 "&showtype=",SHOWTYPE;
.
          MATCH     "1",MENUFLAG
          IF        @EQUAL
            WRITE     HTMLFILE;"&menuflag=1";
          ENDIF
.
PREVMC99  RETURN
.
.------------------------------------------------------------
. Table of Miscellaneous Charges Details
.------------------------------------------------------------
MCHGTB00  UNPACK    DIM127,D1,LINKPRG,DIM127
          UNPACK    DIM127,D1,LINKREP,DIM127
          UNPACK    DIM127,D1,LINKTEM,DIM127
.
          IF        NORECORD=0
            MOVE      PTCNNRTD,NORECORD      * Set Default No Records to Display
          ENDIF
          MOVE      ZERO,RECNUMB
          MOVE      ZERO,DISNUMB
.
          MATCH     SP70,MSCHG001
          GOTO      MCHGTB90 IF EQUAL
.
          MOVE      SP70,DISKEY21
.         Get the first record
          PACK      KEY29,MSCHG001,MSCHG002,MSCHG034,SP70   * Current
          CALL      RDMCHG1                                 * File
          COMPARE   ZERO,OVRCD
          GOTO      MCHGTB20 IF EQUAL
.
.         First Loop for the first record(f1)
          PACK      KEY29,MSCHG001,MSCHG002,MSCHG034,MSCHG004,SP70   * Current
          CALL      RDSMCHG1                                * File
MCHGTB05  CALL      RDKMCHG1                                * Current
          BRANCH    OVRCD,MCHGTB90                          * File
.
MCHGTB20  MATCH     MSCHG001,MCLMCOD
          GOTO      MCHGTB90 IF NOT EQUAL
.
          MATCH     MSCHG002,MHFUND
          GOTO      MCHGTB90 IF NOT EQUAL
.
          MATCH     MSCHG034,PTMCHFTT                                 *C-233046
          GOTO      MCHGTB90 IF NOT EQUAL
.
          PACK      SAVKEY21,MCLMCOD,MHFUND,PTMCHFTT,MCHARGE,SP70 
          MATCH     SAVKEY21,DISKEY21
          GOTO      MCHGTB05 IF EQUAL   * Read for next unique record 
.
.         Get all child record of f1 with different effective date 
          PACK      DISKEY21,MCLMCOD,MHFUND,PTMCHFTT,MCHARGE,SP70
          MATCH     "1",VIEWTYPE
          IF        @EQUAL
            CALL      MISCDD00
            BRANCH    EXIT,MCHGTB99
          ELSE
            CALL      MISCDA00 
            BRANCH    EXIT,MCHGTB99
          ENDIF 
.
          PACK      KEY29,SAVKEY21,SP70   *repositioning KEY29
          CALL      RDMCHG1
          GOTO      MCHGTB05
.
MCHGTB90  CALL      NOMORE00     * Display No More Records Message
.
MCHGTB99  RETURN
.
.------------------------------------------------------------
. Miscellaneous Charges File reading record ASC
. SAVEKEY21=Key value for record to print no effective date
.------------------------------------------------------------
MISCDA00  PACK      KEY29,SAVKEY21,SP70
          CALL      RDMCHG1
          COMPARE   ZERO,OVRCD
          GOTO      MISCDA10 IF EQUAL
.
          CALL      RDSMCHG1
MISCDA05  CALL      RDKMCHG1
          BRANCH    OVRCD,MISCDA90
.
MISCDA10  PACK      KEY21,MCLMCOD,MHFUND,PTMCHFTT,MCHARGE,SP70
          MATCH     SAVKEY21,KEY21
          GOTO      MISCDA90 IF NOT EQUAL   *Not the correct loop
.
          CALL      MISCDR00
          BRANCH    EXIT,MISCDA95
.
          GOTO      MISCDA05 
.
MISCDA90  MOVE      ZERO,EXIT               * Not Full page
          GOTO      MISCDA99
.
MISCDA95  MOVE      ONE,EXIT                * Full Page Found
          GOTO      MISCDA99
.
MISCDA99  RETURN
.
.------------------------------------------------------------
. Miscellaneous Charges File reading record DSC
. SAVEKEY21=Key value for record to print no effective date
.------------------------------------------------------------
MISCDD00  PACK      KEY29,SAVKEY21,Z70
.
          CALL      IBACLOCK
          PACK      CURRDATE,CCC,CYY,CMM,CDD         * Current Date
          REP       " 0",CURRDATE
.
          CALL      RDSMCHG1
MISCDD05  CALL      RDPMCHG1
          BRANCH    OVRCD,MISCDD90
.
          PACK      KEY21,MCLMCOD,MHFUND,PTMCHFTT,MCHARGE,Z70
          MATCH     SAVKEY21,KEY21
          GOTO      MISCDD90 IF NOT EQUAL   *Not the correct loop
.
.         Get only current miscellaneous charge
          MATCH     "2",SHOWTYPE
          IF        @EQUAL
.
            MATCH     SP70,PTMCETDT
            GOTO      MISCDD10 IF EQUAL
.
            MATCH     PTMCETDT,CURRDATE  *if > or equal to current date
            GOTO      MISCDD05 IF NOT LESS
          ENDIF
.
MISCDD10  CALL      MISCDR00
          BRANCH    EXIT,MISCDD95
.
.         Get the each most recent record for each Misc Charge
          MATCH     "1",SHOWTYPE
          IF        @EQUAL
            GOTO      MISCDD90
          ENDIF
.
          GOTO      MISCDD05
.
MISCDD90  MOVE      ZERO,EXIT               * Not Full page
          GOTO      MISCDD99
.
MISCDD95  MOVE      ONE,EXIT                * Full Page Found
          GOTO      MISCDD99
.
MISCDD99  RETURN
.
.------------------------------------------------------------
. Miscellaneous Charges File Paging and display Table (TABLE ROW)
.------------------------------------------------------------
MISCDR00  ADD       ONE,RECNUMB
          IF        STARTNUM>=RECNUMB
            GOTO      MISCDR90
          ENDIF
.
          CALL      MCHGRW00                * write data line
.
          ADD       ONE,DISNUMB
          COMPARE   NORECORD,DISNUMB
          IF        !@EQUAL
            GOTO      MISCDR90
          ENDIF
.
          GOTO      MISCDR95
.
MISCDR90  MOVE      ZERO,EXIT               * Not Full page
          GOTO      MISCDR99
.
MISCDR95  MOVE      ONE,EXIT                * Full Page Found
          GOTO      MISCDR99
.
MISCDR99  RETURN
.
.------------------------------------------------------------
. Miscellaneous Charges File Table (TABLE ROW)
.------------------------------------------------------------
MCHGRW00  MOVE      SP20,DIM20
          MOVE      SP70,TDESC
          MATCH     SP10,MMSCGRP
          GOTO      MCHGRW05 IF EQUAL
          PACK      KEY5,ANSF,ANSI,MMSCGRP
          CALL      RDCODE1
          BRANCH    OVRCD,MCHGRW05
          MOVE      TDESC,DIM20
.
MCHGRW05  MOVE      SP20,DIM11
          LOAD      DIM11,MITMTYP,SP20,THTRFEE,MISCFEE
.
          MOVE      SP70,SETFONT
          MOVE      SP70,ENDFONT
          MOVE      "Yes",KEY3
          MATCH     "1",PTMCACTV               * Inactive?
          IF        @EQUAL
            MOVE      "No ",KEY3
            MOVE      "<font color=#FF0000>",SETFONT
            MOVE      "</font>",ENDFONT
          ENDIF
.
          UNPACK    SP70,DIM12A,DIM12B
          MATCH     SP20,PTMCEFDT
          GOTO      MCHGRW50 IF EQUAL
          UNPACK    PTMCEFDT,CCENT,CYEAR,CMON,CDAY
          MOVE      CMON,F2
          LOAD      MTHNAM3,F2,JAN,FEB,MAR,APR,MAY,JUN,JUL,AUG,SEP,OCT,NOV,DEC
          PACK      DIM12A,CDAY,SP1,MTHNAM3,SP1,CCENT,CYEAR
.
MCHGRW50  MATCH     SP20,PTMCETDT
          GOTO      MCHGRW60 IF EQUAL
          UNPACK    PTMCETDT,CCENT,CYEAR,CMON,CDAY
          MOVE      CMON,F2
          LOAD      MTHNAM3,F2,JAN,FEB,MAR,APR,MAY,JUN,JUL,AUG,SEP,OCT,NOV,DEC
          PACK      DIM12B,CDAY,SP1,MTHNAM3,SP1,CCENT,CYEAR
.
MCHGRW60  WRITE     HTMLFILE;"<tr><td nowrap><A HREF='javascript:ShowLink":
                             "(#"",LINKPRG,"#.pbl":
                             "?reportno=",LINKREP:
                             "&template=",LINKTEM:
                             "&mschg001=",MCLMCOD:
                             "&mschg002=",MHFUND:
                             "&mschg034=",PTMCHFTT:      * was MHFTAB *C-233046
                             "&mschg004=",MCHARGE:
                             "&mschg020=",DIM12A:
                             "&mschg035=",DIM12B:
                             "&fileflag=",FILEFLAG,"#")'>":
                             "<img src=../images/MaintenanceIcon.gif hspace=4":
                             " border=0 align=absmiddle>":
                             "</a>",MCHARGE,"</td>":
                             "<td>&nbsp;",SETFONT,MDESC,ENDFONT,"</td>":
                             "<td>&nbsp;",SETFONT,MHFUND,ENDFONT,"</td>":
....                         "<td>&nbsp;",SETFONT,MHFTAB,ENDFONT,"</td>":
                             "<td>&nbsp;",SETFONT,PTMCHFTT,ENDFONT,"</td>":
                             "<td>&nbsp;",SETFONT,DIM12A,ENDFONT,"</td>":
                             "<td>&nbsp;",SETFONT,DIM11,ENDFONT,"</td>":
                             "<td>&nbsp;",SETFONT,DIM20,ENDFONT,"</td>":
                             "<td>&nbsp;",SETFONT,MPATPOR,ENDFONT,"</td>":
                             "<td>&nbsp;",SETFONT,MHFPOR,ENDFONT,"</td>":
                             "<td>&nbsp;",SETFONT,KEY3,ENDFONT,"</td>":
                             "<td>&nbsp;",SETFONT,DIM12B,ENDFONT,"</td>":
                             "</tr>"
.
MCHGRW99 RETURN
.
.------------------------------------------------------------------------------
. NZ Private Theatre Fee Maintenance: Display,Add,Update,Delete
.------------------------------------------------------------------------------
NZPTHR00  RESET     UPDTTYPE
          MATCH     SP70,UPDTTYPE           * Display formaction
          GOTO      NZPTHR80 IF EQUAL       
.         
          MATCH     "A",UPDTTYPE            * Add formaction
          GOTO      NZPTHR10 IF EQUAL       
.         
          MATCH     "U",UPDTTYPE            * Update formaction
          GOTO      NZPTHR20 IF EQUAL       
.
          MATCH     "D",UPDTTYPE            * Delete formaction
          GOTO      NZPTHR30 IF EQUAL
.
          MATCH     "C",UPDTTYPE            * Create New File
          GOTO      NZPTHR40 IF EQUAL
.
          MATCH     "H",UPDTTYPE            * Health Fund Duplication
          GOTO      NZPTHR50 IF EQUAL
.
          MATCH     "E",UPDTTYPE            * Global Delete formaction
          GOTO      NZPTHR60 IF EQUAL
.
          MATCH     "G",UPDTTYPE            * Update New to Current file 
          GOTO      NZPTHR70 IF EQUAL
.
          GOTO      NZPTHR93
.
.   **********  ADD FORMACTION  **********
.
NZPTHR10  MATCH     "N",FILEFLAG
          GOTO      NZPTHR15 IF EQUAL
.
          PACK      KEY33,NZTFE001,NZTFE002,NZTFE003,NZTFE004,NZTFE005:
                          NZTFE006,NZTFE007,SP70
          CALL      RDNZTFE1                 * Add into Current File
          COMPARE   ZERO,OVRCD
          GOTO      NZPTHR92 IF EQUAL
.
          CALL      MVNZTF00
.
          PACK      NZTFCDAT,CCC,CYY,CMM,CDD
          REP       " 0",NZTFCDAT                * Systen date
          CLOCK     TIME,NZTFCTIM                * System time
          MOVE      USERID,NZTFCUID              * web user id
          MOVE      SP70,NZTFUDAT
          MOVE      SP70,NZTFUTIM
          MOVE      SP70,NZTFUUID
.
          CALL      WRNZTFE1
          GOTO      NZPTHR98
.
NZPTHR15  PACK      KEY33,NZTFE001,NZTFE002,NZTFE003,NZTFE004,NZTFE005:
                          NZTFE006,NZTFE007,SP70
          CALL      RDNZTF11                 * Add into New File
          COMPARE   ZERO,OVRCD
          GOTO      NZPTHR92 IF EQUAL
.
          CALL      MVNZTF00
.
          PACK      NZTFCDAT,CCC,CYY,CMM,CDD
          REP       " 0",NZTFCDAT                * Systen date
          CLOCK     TIME,NZTFCTIM                * System time
          MOVE      USERID,NZTFCUID              * web user id
          MOVE      SP70,NZTFUDAT
          MOVE      SP70,NZTFUTIM
          MOVE      SP70,NZTFUUID
.
          CALL      WRNZTF11
          GOTO      NZPTHR98
.
.     **********  UPDATE FORMACTION  **********
.
NZPTHR20  MATCH     "N",FILEFLAG
          GOTO      NZPTHR25 IF EQUAL
          PACK      KEY33,NZTFE001,NZTFE002,NZTFE003,NZTFE004,NZTFE005:
                          NZTFE006,NZTFE007,SP70
          CALL      RDNZTFE1                 * Update into Current File
          BRANCH    OVRCD,NZPTHR91
.
          CALL      MVNZTF00
.
          PACK      NZTFUDAT,CCC,CYY,CMM,CDD
          REP       " 0",NZTFUDAT                * Systen date
          CLOCK     TIME,NZTFUTIM                * System time
          MOVE      USERID,NZTFUUID              * web user id
.
          CALL      UPNZTFE1
          GOTO      NZPTHR98
.
NZPTHR25  PACK      KEY33,NZTFE001,NZTFE002,NZTFE003,NZTFE004,NZTFE005:
                          NZTFE006,NZTFE007,SP70
          CALL      RDNZTF11                 * Update into New File
          BRANCH    OVRCD,NZPTHR91
.
          CALL      MVNZTF00
.
          PACK      NZTFUDAT,CCC,CYY,CMM,CDD
          REP       " 0",NZTFUDAT                * Systen date
          CLOCK     TIME,NZTFUTIM                * System time
          MOVE      USERID,NZTFUUID              * web user id
.
          CALL      UPNZTF11
          GOTO      NZPTHR98
.
.   **********  DELETE FORMACTION  **********
.
NZPTHR30  CALL      DELTHR00      * Delete all for Header Record
          GOTO      NZPTHR98
.
NZPTHR40  CALL      CNZT0000      * Schedule new file creation
          GOTO      NZPTHR99
.
NZPTHR50  CALL      HNZT0000      * Schedule health fund duplication
          GOTO      NZPTHR99
.
NZPTHR60  CALL      DNZT0000      * Schedule global deletion
          GOTO      NZPTHR99
.
NZPTHR70  CALL      UNZT0000      * Schedule Update New to Current
          GOTO      NZPTHR99
.
.   **********  DISPLAY FORMACTION  **********
.
NZPTHR80  MOVE      ZERO,EXIT
          MATCH     "N",FILEFLAG
          GOTO      NZPTHR81 IF EQUAL
.
          PACK      KEY33,NZTFE001,NZTFE002,NZTFE003,NZTFE004,NZTFE005:
                          NZTFE006,NZTFE007,SP70
          CALL      RDNZTFE1
          IF        OVRCD=1
            CALL      CLNZTF00
          ENDIF
          GOTO      NZPTHR82
.
NZPTHR81  PACK      KEY33,NZTFE001,NZTFE002,NZTFE003,NZTFE004,NZTFE005:
                          NZTFE006,NZTFE007,SP70
          CALL      RDNZTF11
          IF        OVRCD=1
            CALL      CLNZTF00
          ENDIF
.
NZPTHR82  CLEAR     WEBTITLE
          MOVE      "NZ Private Theatre Fee Maintenance",WEBTITLE
          RESET     WEBTITLE
.
          CALL      WEBHED00   * Create Output File and Write HTML Page Header
          BRANCH    EXIT,NZPTHR99
          CALL      WEBBOD00   * Process Web Body
          CALL      WEBEND00   * Process End of HTML File
.
          MOVE      ONE,EXIT
          GOTO      NZPTHR99
.
NZPTHR91  MOVE      "Record does not exist",WEBTITLE
          CALL      WEBERR00
          MOVE      ONE,EXIT
          GOTO      NZPTHR99
.
NZPTHR92  MOVE      "Record already exists",WEBTITLE
          CALL      WEBERR00
          MOVE      ONE,EXIT
          GOTO      NZPTHR99
.
NZPTHR93  MOVE      "Invalid Form Action.",WEBTITLE
          CALL      WEBERR00
          MOVE      ONE,EXIT
          GOTO      NZPTHR99
.
NZPTHR98  MOVE      ZERO,EXIT
NZPTHR99  RETURN
.---------------------------------------------------------------------------
. Delete all NZ Private Theatre Fee Records(New File)
.---------------------------------------------------------------------------
DELTHR00  PACK      KEY33,NZTFE001,NZTFE002,NZTFE003,NZTFE004,NZTFE005:
                          NZTFE006,SP70
          CALL      RSNZTF11               
          CALL      RKNZTF11                
          BRANCH    OVRCD,DELTHR99
.
          MATCH     NZTFE001,NZTFHOSP          * Hospital
          GOTO      DELTHR99 IF NOT EQUAL
.
          MATCH     NZTFE002,NZTFSEST          * Session Type
          GOTO      DELTHR99 IF NOT EQUAL
.
          MATCH     NZTFE003,NZTFCLAM          * Claim Code
          GOTO      DELTHR99 IF NOT EQUAL
.
          MATCH     NZTFE004,NZTFFUND          * Health Fund
          GOTO      DELTHR99 IF NOT EQUAL
.
          MATCH     NZTFE005,NZTFFTAB          * Health Fund Table
          GOTO      DELTHR99 IF NOT EQUAL
.
          MATCH     NZTFE006,NZTFEDAT          * Effective Date
          GOTO      DELTHR99 IF NOT EQUAL
.
          PACK      KEY33,NZTFHOSP,NZTFSEST,NZTFCLAM,NZTFFUND,NZTFFTAB:
                          NZTFEDAT,NZTFISEQ,SP70
          CALL      DENZTF11
.
          GOTO      DELTHR00
.
DELTHR99  RETURN
.
.--------------------------------------------------------------------------
.*                             CNZT0000                                   *
.*   Schedule creation of new NZ Private Theatre Fee File from IBARSH10   *
.--------------------------------------------------------------------------
CNZT0000  MOVE      "IBARSH10",SCHDPGID
          MOVE      "Create New NZ Private Theatre Fee File",SCHDDESC
          PACK      SCHDDATE,CCC,CYY,CMM,CDD
          REP       " 0",SCHDDATE
          CLOCK     TIME,SCHDTIME
.
.         Write Keyin parameters for Extract
.
          MOVE      TWENTY2,KEYSTARR[1]      * Option 22 Create New File
          MOVE      ANSY,KEYSTARR[2]         * Yes to create new file
          MOVE      COPYFLAG,KEYSTARR[3]     * Start with a copy of current data
.
          MATCH     ANSY,COPYFLAG
          IF        @EQUAL
            MOVE      SP70,KEYSTARR[4]       * Enter
            MOVE      FOUR,KEYSTCNT          * Number of Keyins
          ELSE
            MOVE      ANSY,KEYSTARR[4]       * Yes start with a empty file
            MOVE      SP70,KEYSTARR[5]       * Enter
            MOVE      FIVE,KEYSTCNT          * Number of Keyins
          ENDIF
.
          CALL      SCHPRO00   * Schedule Extract
.
CNZT9999  RETURN
.
.------------------------------------------------------------------------------
.*                             UNZT0000                                       *
.*   Schedule Update of new to Current NZ Private Theatre Fee File from       *
.*   IBARSH10                                                                 *
.------------------------------------------------------------------------------
UNZT0000  MOVE      "IBARSH10",SCHDPGID
          MOVE      "Update New to Current NZ Private Theatre Fee File",SCHDDESC
          PACK      SCHDDATE,CCC,CYY,CMM,CDD
          REP       " 0",SCHDDATE
          CLOCK     TIME,SCHDTIME
.
.         Write Keyin parameters for Extract
.
          MOVE      TWENTY3,KEYSTARR[1]      * Option 23 Update New to Current
          MOVE      ANSY,KEYSTARR[2]         * Yes to Update
          MOVE      SP70,KEYSTARR[3]         * Enter
          MOVE      THREE,KEYSTCNT             * Number of Keyins
.
          CALL      SCHPRO00   * Schedule Extract
.
UNZT9999  RETURN
.
.------------------------------------------------------------------------------
.*                             DNZT0000                                       *
.*   Schedule Global Delete on new  NZ Private Theatre Fee File from          *
.*   IBARSH10                                                                 *
.------------------------------------------------------------------------------
DNZT0000  MOVE      "IBARSH10",SCHDPGID
          MOVE      "Global Delete on New NZ Private Theatre Fee File",SCHDDESC
          PACK      SCHDDATE,CCC,CYY,CMM,CDD
          REP       " 0",SCHDDATE
          CLOCK     TIME,SCHDTIME
.
.         Write Keyin parameters for Extract
.
          MOVE      TWENTY4,KEYSTARR[1]      * Option 24 Global Delete new file
          MOVE      NZTFE001,KEYSTARR[2]     * Hospital             
          MOVE      NZTFE002,KEYSTARR[3]     * Session Type
          MOVE      NZTFE003,KEYSTARR[4]     * Claim Code
          MOVE      NZTFE004,KEYSTARR[5]     * Health Fund
          MOVE      NZTFE005,KEYSTARR[6]     * Health Fund Table
.
          UNPACK    NZTFE006,CCENT,CYEAR,CMON,CDAY
          PACK      KEYSTARR[7],CDAY,CMON,CCENT,CYEAR     * Effective Date
.
          MOVE      ANSY,KEYSTARR[8]         * Yes to Update
          MOVE      SP70,KEYSTARR[9]         * Enter
          MOVE      NINE,KEYSTCNT            * Number of Keyins
.
          CALL      SCHPRO00   * Schedule Extract
.
DNZT9999  RETURN
.
.------------------------------------------------------------------------------
.*                             HNZT0000                                       *
.*   Schedule Health Fund Duplication on new NZ Private Theatre Fee File      *
.*   from IBARSH10                                                            *
.------------------------------------------------------------------------------
HNZT0000  MOVE      "IBARSH10",SCHDPGID
          CLEAR     SCHDDESC
          APPEND    "H/Fund Duplication on New NZ Private Theatre ",SCHDDESC
          APPEND    "Fee File",SCHDDESC
          RESET     SCHDDESC
          PACK      SCHDDATE,CCC,CYY,CMM,CDD
          REP       " 0",SCHDDATE
          CLOCK     TIME,SCHDTIME
.         
.         Write Keyin parameters for Extract
.         
          MOVE      TWENTY5,KEYSTARR[1]      * Option 25 duplication new file
          MOVE      NZTFE001,KEYSTARR[2]     * Hospital
          MOVE      NZTFE002,KEYSTARR[3]     * Session Type
          MOVE      NZTFE003,KEYSTARR[4]     * Claim Code
          MOVE      NZTFE004,KEYSTARR[5]     * Health Fund
          MOVE      NZTFE005,KEYSTARR[6]     * Health Fund Table
.
          UNPACK    NZTFE006,CCENT,CYEAR,CMON,CDAY
          PACK      KEYSTARR[7],CDAY,CMON,CCENT,CYEAR     * Effective Date
.
          MOVE      CPTFE001,KEYSTARR[8]     * Copy to Hospital
          MOVE      CPTFE002,KEYSTARR[9]     * Copy to Session Type
          MOVE      CPTFE003,KEYSTARR[10]    * Copy to Claim Code
          MOVE      CPTFE004,KEYSTARR[11]    * Copy to Health Fund
          MOVE      CPTFE005,KEYSTARR[12]    * Copy to Health Fund Table
.
          UNPACK    CPTFE006,CCENT,CYEAR,CMON,CDAY
          PACK      KEYSTARR[13],CDAY,CMON,CCENT,CYEAR  * Copy to Effective Date
.
          MOVE      ANSY,KEYSTARR[14]        * Yes to Update
          MOVE      SP70,KEYSTARR[15]        * Enter
          MOVE      TEN5,KEYSTCNT            * Number of Keyins
.
          CALL      SCHPRO00   * Schedule Extract
.
HNZT9999  RETURN
.
.------------------------------------------------------------------------------
. NZ Private Procedure Fee Maintenance: Display,Add,Update,Delete
.------------------------------------------------------------------------------
NZPPRC00  MATCH     "B",FILETYPE            * Breakdown table
          IF        @EQUAL
            CALL      NZRB0000
            GOTO      NZPPRC99
          ENDIF
.
          RESET     UPDTTYPE
          MATCH     SP70,UPDTTYPE           * Display formaction
          GOTO      NZPPRC80 IF EQUAL
.
          MATCH     "A",UPDTTYPE            * Add formaction
          GOTO      NZPPRC10 IF EQUAL
.
          MATCH     "U",UPDTTYPE            * Update formaction
          GOTO      NZPPRC20 IF EQUAL
.
          MATCH     "D",UPDTTYPE            * Delete formaction
          GOTO      NZPPRC30 IF EQUAL
.
          MATCH     "C",UPDTTYPE            * Create New File
          GOTO      NZPPRC40 IF EQUAL
.
          MATCH     "H",UPDTTYPE            * Health Fund Duplication
          GOTO      NZPPRC50 IF EQUAL
.
          MATCH     "E",UPDTTYPE            * Global Delete formaction
          GOTO      NZPPRC60 IF EQUAL
.
          MATCH     "G",UPDTTYPE            * Update New to Current file
          GOTO      NZPPRC70 IF EQUAL
.
          GOTO      NZPPRC93
.
.   **********  ADD FORMACTION  **********
.
NZPPRC10  MATCH     "N",FILEFLAG
          GOTO      NZPPRC15 IF EQUAL
.
          PACK      KEY37,NZPFE001,NZPFE002,NZPFE003,NZPFE004,NZPFE005:
                          NZPFE006,SP70
          CALL      RDNZPFE1                 * Add into Current File
          COMPARE   ZERO,OVRCD
          GOTO      NZPPRC92 IF EQUAL
          CALL      CLNZPF00
.
          CALL      MVNZPF00
          IF        NZPFCONT=1
            MOVE      ZERO,NZPFHPOR
          ENDIF
.
          PACK      NZPFCDAT,CCC,CYY,CMM,CDD
          REP       " 0",NZPFCDAT                * Systen date
          CLOCK     TIME,NZPFCTIM                * System time
          MOVE      USERID,NZPFCUID              * web user id
          MOVE      SP70,NZPFUDAT
          MOVE      SP70,NZPFUTIM
          MOVE      SP70,NZPFUUID
.
          CALL      WRNZPFE1
          GOTO      NZPPRC98
.
NZPPRC15  PACK      KEY37,NZPFE001,NZPFE002,NZPFE003,NZPFE004,NZPFE005:
                          NZPFE006,SP70
          CALL      RDNZPF11                 * Add into New File
          COMPARE   ZERO,OVRCD
          GOTO      NZPPRC92 IF EQUAL
.
          CALL      MVNZPF00
.
          PACK      NZPFCDAT,CCC,CYY,CMM,CDD
          REP       " 0",NZPFCDAT                * Systen date
          CLOCK     TIME,NZPFCTIM                * System time
          MOVE      USERID,NZPFCUID              * web user id
          MOVE      SP70,NZPFUDAT
          MOVE      SP70,NZPFUTIM
          MOVE      SP70,NZPFUUID
.
          CALL      WRNZPF11
          GOTO      NZPPRC98
.
.     **********  UPDATE FORMACTION  **********
.
NZPPRC20  MATCH     "N",FILEFLAG
          GOTO      NZPPRC25 IF EQUAL
          PACK      KEY37,NZPFE001,NZPFE002,NZPFE003,NZPFE004,NZPFE005:
                          NZPFE006,SP70
          CALL      RDNZPFE1                 * Update into Current File
          BRANCH    OVRCD,NZPPRC91
.
          CALL      MVNZPF00
          IF        NZPFCONT=1
            MOVE      ZERO,NZPFHPOR
          ENDIF
.
          PACK      NZPFUDAT,CCC,CYY,CMM,CDD
          REP       " 0",NZPFUDAT                * Systen date
          CLOCK     TIME,NZPFUTIM                * System time
          MOVE      USERID,NZPFUUID              * web user id
.
          CALL      UPNZPFE1
.
          IF        NZPFIBRK<>1
            CALL      DINVBR00                   * Delete inv breakdown
          ENDIF
.
          IF        NZPFRBRK<>1
            CALL      DREVBR00                   * Delete rev breakdown
          ENDIF
.
          CALL      INVB0000                     * Check Inv/Rev breakdown
          BRANCH    EXIT,NZPPRC99
.
          GOTO      NZPPRC98
.
NZPPRC25  PACK      KEY37,NZPFE001,NZPFE002,NZPFE003,NZPFE004,NZPFE005:
                          NZPFE006,SP70
          CALL      RDNZPF11                 * Update into New File
          BRANCH    OVRCD,NZPPRC91
.
          CALL      MVNZPF00
.
          PACK      NZPFUDAT,CCC,CYY,CMM,CDD
          REP       " 0",NZPFUDAT                * Systen date
          CLOCK     TIME,NZPFUTIM                * System time
          MOVE      USERID,NZPFUUID              * web user id
.
          CALL      UPNZPF11
.
          IF        NZPFIBRK<>1
            CALL      DINVBR00                   * Delete inv breakdown
          ENDIF
.
          IF        NZPFRBRK<>1
            CALL      DREVBR00                   * Delete rev breakdown
          ENDIF
.
          CALL      INVB0000                     * Check Inv/Rev breakdown
          BRANCH    EXIT,NZPPRC99
.
          GOTO      NZPPRC98
.
.   **********  DELETE FORMACTION  **********
.
NZPPRC30  MATCH     "N",FILEFLAG
          GOTO      NZPPRC35 IF EQUAL
          PACK      KEY37,NZPFE001,NZPFE002,NZPFE003,NZPFE004,NZPFE005:
                          NZPFE006,SP70
          CALL      RDNZPFE1                 * Update into Current File
          BRANCH    OVRCD,NZPPRC91
.
          CALL      DENZPFE1
.
          CALL      DINVBR00                 * Delete inv breakdown
          CALL      DREVBR00                 * Delete rev breakdown
          GOTO      NZPPRC98
.
NZPPRC35  PACK      KEY37,NZPFE001,NZPFE002,NZPFE003,NZPFE004,NZPFE005:
                          NZPFE006,SP70
          CALL      RDNZPF11                 * Update into New File
          BRANCH    OVRCD,NZPPRC91
.
          CALL      DENZPF11
.
          CALL      DINVBR00                 * Delete inv breakdown
          CALL      DREVBR00                 * Delete rev breakdown
          GOTO      NZPPRC98
.
NZPPRC40  CALL      CNZP0000      * Schedule new file creation
          GOTO      NZPPRC99
.
NZPPRC50  CALL      HNZP0000      * Schedule proc fee duplication
          GOTO      NZPPRC99
.
NZPPRC60  CALL      DNZP0000      * Schedule global deletion
          GOTO      NZPPRC99
.
NZPPRC70  CALL      UNZP0000      * Schedule Update New to Current
          GOTO      NZPPRC99
.
.   **********  DISPLAY FORMACTION  **********
.
NZPPRC80  MOVE      ZERO,EXIT
          MATCH     "N",FILEFLAG
          GOTO      NZPPRC81 IF EQUAL
.
          PACK      KEY37,NZPFE001,NZPFE002,NZPFE003,NZPFE004,NZPFE005:
                          NZPFE006,SP70
          CALL      RDNZPFE1
          IF        OVRCD=1
            CALL      CLNZPF00
          ENDIF
          GOTO      NZPPRC82
.
NZPPRC81  PACK      KEY37,NZPFE001,NZPFE002,NZPFE003,NZPFE004,NZPFE005:
                          NZPFE006,SP70
          CALL      RDNZPF11
          IF        OVRCD=1
            CALL      CLNZPF00
          ENDIF
.
NZPPRC82  CLEAR     WEBTITLE
          MOVE      "NZ Private Procedure Fee Maintenance",WEBTITLE
          RESET     WEBTITLE
.
          CALL      WEBHED00   * Create Output File and Write HTML Page Header
          BRANCH    EXIT,NZPPRC99
          CALL      WEBBOD00   * Process Web Body
          CALL      WEBEND00   * Process End of HTML File
.
          MOVE      ONE,EXIT
          GOTO      NZPPRC99
.
NZPPRC91  MOVE      "Record does not exist",WEBTITLE
          CALL      WEBERR00
          MOVE      ONE,EXIT
          GOTO      NZPPRC99
.
NZPPRC92  MOVE      "Record already exists",WEBTITLE
          CALL      WEBERR00
          MOVE      ONE,EXIT
          GOTO      NZPPRC99
.
NZPPRC93  MOVE      "Invalid Form Action.",WEBTITLE
          CALL      WEBERR00
          MOVE      ONE,EXIT
          GOTO      NZPPRC99
.
NZPPRC98  MOVE      ZERO,EXIT
NZPPRC99  RETURN
.
.------------------------------------------------------------------------------
. Delete NZ Private Procedure Fee Invoice Breakdown
.------------------------------------------------------------------------------
DINVBR00  MATCH     "N",FILEFLAG
          GOTO      DINVBR10 IF EQUAL
.         
          PACK      KEY40,NZPFE001,NZPFE002,NZPFE003,NZPFE004:
                          NZPFE005,NZPFE006,SP70
          CALL      RSNZIBR1
DINVBR05  CALL      RKNZIBR1                     * Curr File
          BRANCH    OVRCD,DINVBR99
          GOTO      DINVBR20
.         
DINVBR10  PACK      KEY40,NZPFE001,NZPFE002,NZPFE003,NZPFE004:
                          NZPFE005,NZPFE006,SP70 
          CALL      RSNZIB11
DINVBR15  CALL      RKNZIB11                     * New File
          BRANCH    OVRCD,DINVBR99
.
DINVBR20  MATCH     NZPFE001,NZIBHOSP            * Hospital
          GOTO      DINVBR99 IF NOT EQUAL
.
          MATCH     NZPFE002,NZIBCLMC            * Claim Code
          GOTO      DINVBR99 IF NOT EQUAL
.
          MATCH     NZPFE003,NZIBCNTR            * Contract 
          GOTO      DINVBR99 IF NOT EQUAL
.
          MATCH     NZPFE004,NZIBFTAB            * Fund Table
          GOTO      DINVBR99 IF NOT EQUAL
.
          MATCH     NZPFE005,NZIBCPRC            * Contract Procedure
          GOTO      DINVBR99 IF NOT EQUAL
.
          MATCH     NZPFE006,NZIBEFDT            * Effective Date
          GOTO      DINVBR99 IF NOT EQUAL
.
          PACK      KEY40,NZIBHOSP,NZIBCLMC,NZIBCNTR,NZIBFTAB:
                          NZIBCPRC,NZIBEFDT,NZIBBRCD,SP70
.
          MATCH     "N",FILEFLAG
          IF        @EQUAL
            CALL      DENZIB11
            GOTO      DINVBR15
          ELSE
            CALL      DENZIBR1
            GOTO      DINVBR05
          ENDIF
.
DINVBR99  RETURN
.
.------------------------------------------------------------------------------
. Delete NZ Private Procedure Fee Revenue Breakdown
.------------------------------------------------------------------------------
DREVBR00  MATCH     "N",FILEFLAG
          GOTO      DREVBR10 IF EQUAL
.
          PACK      KEY40,NZPFE001,NZPFE002,NZPFE003,NZPFE004:
                          NZPFE005,NZPFE006,SP70
          CALL      RSNZRBR1
DREVBR05  CALL      RKNZRBR1                     * Curr File
          BRANCH    OVRCD,DREVBR99
          GOTO      DREVBR20
.
DREVBR10  PACK      KEY40,NZPFE001,NZPFE002,NZPFE003,NZPFE004:
                          NZPFE005,NZPFE006,SP70
          CALL      RSNZRB11
DREVBR15  CALL      RKNZRB11                     * New File
          BRANCH    OVRCD,DREVBR99
.
DREVBR20  MATCH     NZPFE001,NZRBHOSP            * Hospital
          GOTO      DREVBR99 IF NOT EQUAL
.
          MATCH     NZPFE002,NZRBCLMC            * Claim Code
          GOTO      DREVBR99 IF NOT EQUAL
.
          MATCH     NZPFE003,NZRBCNTR            * Contract
          GOTO      DREVBR99 IF NOT EQUAL
.
          MATCH     NZPFE004,NZRBFTAB            * Fund Table
          GOTO      DREVBR99 IF NOT EQUAL
.
          MATCH     NZPFE005,NZRBCPRC            * Contract Procedure
          GOTO      DREVBR99 IF NOT EQUAL
.
          MATCH     NZPFE006,NZRBEFDT            * Effective Date
          GOTO      DREVBR99 IF NOT EQUAL
.
          PACK      KEY40,NZRBHOSP,NZRBCLMC,NZRBCNTR,NZRBFTAB:
                          NZRBCPRC,NZRBEFDT,NZRBBRCD,SP70
.
          MATCH     "N",FILEFLAG
          IF        @EQUAL
            CALL      DENZRB11
            GOTO      DREVBR15
          ELSE
            CALL      DENZRBR1
            GOTO      DREVBR05
          ENDIF
.
DREVBR99  RETURN
.
.******************************************************************************
.*                             CRTM0000                                       *
.*                Open and create the temporary file                          *
.******************************************************************************
CRTM0000  TRAP      CRTM1000 IF IO
          OPEN      TMPRBRA1,"tmprbraf"
          TRAPCLR   IO
          GOTO      CRTM2000
.
CRTM1000  CLEAR     CMDLINE
          APPEND    "isbuild tmprbraf",CMDLINE
          APPEND    " 110 U1-3,4-6,7-12,13-20,21-29,30-37,38-40",CMDLINE
          RESET     CMDLINE
.
          EXECUTE   CMDLINE,TASKID
          OPEN      TMPRBRA1,"tmprbraf"
.
CRTM2000  TRAP      CRTM3000 IF IO
          OPEN      TMPIBRA1,"tmpibraf"
          TRAPCLR   IO
          GOTO      CRTM9999
.
CRTM3000  CLEAR     CMDLINE
          APPEND    "isbuild tmpibraf",CMDLINE
          APPEND    " 110 U1-3,4-6,7-12,13-20,21-29,30-37,38-40",CMDLINE
          RESET     CMDLINE
.
          EXECUTE   CMDLINE,TASKID
          OPEN      TMPIBRA1,"tmpibraf"
.
CRTM9999  RETURN
+
.--------------------------------------------------------------------------
.*                             NZRB0000                                   *
.*   Update nz private contract procedure breakdown codes                 *
.--------------------------------------------------------------------------
NZRB0000  MOVE      ZERO,EXIT
          MATCH     ANSA,UPDTTYPE
          GOTO      NZRB1000 IF EQUAL
.
          MATCH     ANSU,UPDTTYPE
          GOTO      NZRB2000 IF EQUAL
.
          MATCH     ANSD,UPDTTYPE
          GOTO      NZRB3000 IF EQUAL
.
          GOTO      NZRB9999
.
NZRB1000  PACK      TEMPHOSP,NZPFE001,SP70
          PACK      TEMPCLMC,NZPFE002,SP70
          PACK      TEMPCNTR,NZPFE003,SP70
          PACK      TEMPFTAB,NZPFE004,SP70
          PACK      TEMPCPRC,NZPFE005,SP70
          PACK      TEMPEFDT,NZPFE006,SP70
.
          PACK      TEMPBRCD,NZIBH001,SP70
          MOVE      NZIBH002,TEMPAMNT
.
          PACK      KEY40,TEMPHOSP,TEMPCLMC,TEMPCNTR,TEMPFTAB,TEMPCPRC:
                          TEMPEFDT,TEMPBRCD,SP70
          MATCH     ANSR,BRKDTYPE
          IF        @EQUAL
            CALL      RATMRBR1
            IF        OVRCD=1
              CALL      WRTMRBR1
            ENDIF
          ENDIF
          MATCH     ANSI,BRKDTYPE
          IF        @EQUAL
            CALL      RATMIBR1
            IF        OVRCD=1
              CALL      WRTMIBR1
            ENDIF
          ENDIF
          GOTO      NZRB9999
.
NZRB2000  MATCH     "N",FILEFLAG
          GOTO      NZRB2100 IF EQUAL
          PACK      KEY37,NZPFE001,NZPFE002,NZPFE003,NZPFE004:
                          NZPFE005,NZPFE006,SP70
          CALL      RDNZPFE1
          BRANCH    OVRCD,NZRB9100
          GOTO      NZRB2200
.
NZRB2100  PACK      KEY37,NZPFE001,NZPFE002,NZPFE003,NZPFE004:
                          NZPFE005,NZPFE006,SP70
          CALL      RDNZPF11
          BRANCH    OVRCD,NZRB9100
.
NZRB2200  MATCH     ANSR,BRKDTYPE
          IF        @EQUAL
            CALL      WRNZ0000
            GOTO      NZRB9999
          ENDIF
.
          MATCH     ANSI,BRKDTYPE
          IF        @EQUAL
            CALL      WINZ0000
            GOTO      NZRB9999
          ENDIF
.
          GOTO      NZRB9999
.
NZRB3000  PACK      TEMPHOSP,NZPFE001,SP70
          PACK      TEMPCLMC,NZPFE002,SP70
          PACK      TEMPCNTR,NZPFE003,SP70
          PACK      TEMPFTAB,NZPFE004,SP70
          PACK      TEMPCPRC,NZPFE005,SP70
          PACK      TEMPEFDT,NZPFE006,SP70
.         
          PACK      TEMPBRCD,NZIBH003,SP70
          MOVE      NZIBH002,TEMPAMNT
.         
          PACK      KEY40,TEMPHOSP,TEMPCLMC,TEMPCNTR,TEMPFTAB,TEMPCPRC:
                          TEMPEFDT,TEMPBRCD,SP70 
.
          MATCH     ANSR,BRKDTYPE
          IF        @EQUAL
            CALL      DETMRBR1
          ENDIF
          MATCH     ANSI,BRKDTYPE
          IF        @EQUAL
            CALL      DETMIBR1
          ENDIF
          GOTO      NZRB9999
.
NZRB9000  MOVE      "Record already exists",WEBTITLE
          CALL      WEBERR00
          MOVE      ONE,EXIT
          GOTO      NZRB9999
.
NZRB9100  MOVE      "Missing pathlfaf record",WEBTITLE
          CALL      WEBERR00
          MOVE      ONE,EXIT
          GOTO      NZRB9999
.
NZRB9999  RETURN
.
.******************************************************************************
.*                             WRNZ0000                                       *
.*                  Write to overnight revenue Breakdown file                 *
.******************************************************************************
WRNZ0000  PACK      KEY40,NZPFHOSP,NZPFCLMC,NZPFCNTR,NZPFFTAB:
                          NZPFCPRC,NZPFEFDT,SP70
          MATCH     ANSN,FILEFLAG
          IF        @EQUAL
            CALL      RSNZRB11
          ELSE
            CALL      RSNZRBR1
          ENDIF
.         
WRNZ1000  MATCH     ANSN,FILEFLAG
          IF        @EQUAL
            CALL      RKNZRB11
          ELSE
            CALL      RKNZRBR1
          ENDIF
          BRANCH    OVRCD,WRNZ5000
.         
          MATCH     NZRBHOSP,NZPFHOSP            * same hospital ?
          GOTO      WRNZ5000 IF NOT EQUAL
.
          MATCH     NZRBCLMC,NZPFCLMC            * same claim code ?
          GOTO      WRNZ5000 IF NOT EQUAL
.
          MATCH     NZRBCNTR,NZPFCNTR            * same health fund ?
          GOTO      WRNZ5000 IF NOT EQUAL
.
          MATCH     NZRBFTAB,NZPFFTAB            * same claim code ?
          GOTO      WRNZ5000 IF NOT EQUAL
.
          MATCH     NZRBCPRC,NZPFCPRC            * same procedure ?
          GOTO      WRNZ5000 IF NOT EQUAL
.
          MATCH     NZRBEFDT,NZPFEFDT            * same effective date?
          GOTO      WRNZ5000 IF NOT EQUAL
.
          PACK      KEY40,NZRBHOSP,NZRBCLMC,NZRBCNTR,NZRBFTAB,NZRBCPRC:
                          NZRBEFDT,NZRBBRCD,SP70
          MATCH     ANSN,FILEFLAG
          IF        @EQUAL
            CALL      DENZRB11
          ELSE
            CALL      DENZRBR1
          ENDIF
.
          GOTO      WRNZ1000
.
WRNZ5000  PACK      KEY40,NZPFHOSP,NZPFCLMC,NZPFCNTR,NZPFFTAB:
                          NZPFCPRC,NZPFEFDT,SP70
          CALL      RSTMRBR1
WRNZ6000  CALL      RKTMRBR1
          BRANCH    OVRCD,WRNZ9999
.
          MOVE      SP70,NZRBHOSP             * clear variables before writing
          MOVE      SP70,NZRBCLMC
          MOVE      SP70,NZRBCNTR
          MOVE      SP70,NZRBFTAB
          MOVE      SP70,NZRBCPRC
          MOVE      SP70,NZRBEFDT
          MOVE      SP70,NZRBBRCD
          MOVE      ZERO,NZRBAMNT
          MOVE      SP70,NZRBSPAR
.
          MOVE      TEMPHOSP,NZRBHOSP         * clear variables before writing
          MOVE      TEMPCLMC,NZRBCLMC
          MOVE      TEMPCNTR,NZRBCNTR
          MOVE      TEMPFTAB,NZRBFTAB
          MOVE      TEMPCPRC,NZRBCPRC
          MOVE      TEMPEFDT,NZRBEFDT
          MOVE      TEMPBRCD,NZRBBRCD
          MOVE      TEMPAMNT,NZRBAMNT
.
          PACK      KEY40,NZRBHOSP,NZRBCLMC,NZRBCNTR,NZRBFTAB,NZRBCPRC:
                          NZRBEFDT,NZRBBRCD,SP70
          MATCH     ANSN,FILEFLAG
          IF        @EQUAL
            CALL      RANZRB11
          ELSE
            CALL      RANZRBR1
          ENDIF
          IF        OVRCD=1
            MATCH     ANSN,FILEFLAG
            IF        @EQUAL
              CALL      WRNZRB11
            ELSE
              CALL      WRNZRBR1
            ENDIF
          ENDIF
          GOTO      WRNZ6000
.
WRNZ9999  RETURN
.
.******************************************************************************
.*                             WINZ0000                                       *
.* Write to nz private contract procedure fee Invoice Breakdown file          *
.******************************************************************************
WINZ0000  PACK      KEY40,NZPFHOSP,NZPFCLMC,NZPFCNTR,NZPFFTAB:
                          NZPFCPRC,NZPFEFDT,SP70
          MATCH     ANSN,FILEFLAG
          IF        @EQUAL
            CALL      RSNZIB11
          ELSE
            CALL      RSNZIBR1
          ENDIF
.
WINZ1000  MATCH     ANSN,FILEFLAG
          IF        @EQUAL
            CALL      RKNZIB11
          ELSE
            CALL      RKNZIBR1
          ENDIF
          BRANCH    OVRCD,WINZ5000
.
          MATCH     NZIBHOSP,NZPFHOSP            * same hospital ?
          GOTO      WINZ5000 IF NOT EQUAL        
.         
          MATCH     NZIBCLMC,NZPFCLMC            * same claim code ?
          GOTO      WINZ5000 IF NOT EQUAL        
.         
          MATCH     NZIBCNTR,NZPFCNTR            * same health fund ?
          GOTO      WINZ5000 IF NOT EQUAL
.
          MATCH     NZIBFTAB,NZPFFTAB            * same claim code ?
          GOTO      WINZ5000 IF NOT EQUAL
.
          MATCH     NZIBCPRC,NZPFCPRC            * same procedure ?
          GOTO      WINZ5000 IF NOT EQUAL
.
          MATCH     NZIBEFDT,NZPFEFDT            * same effective date?
          GOTO      WINZ5000 IF NOT EQUAL
.
          PACK      KEY40,NZIBHOSP,NZIBCLMC,NZIBCNTR,NZIBFTAB,NZIBCPRC:
                          NZIBEFDT,NZIBBRCD,SP70
          MATCH     ANSN,FILEFLAG
          IF        @EQUAL
            CALL      DENZIB11
          ELSE
            CALL      DENZIBR1
          ENDIF
.
          GOTO      WINZ1000
.
WINZ5000  PACK      KEY40,NZPFHOSP,NZPFCLMC,NZPFCNTR,NZPFFTAB:
                          NZPFCPRC,NZPFEFDT,SP70
          CALL      RSTMIBR1
WINZ6000  CALL      RKTMIBR1
          BRANCH    OVRCD,WINZ9999
.
          MOVE      SP70,NZIBHOSP             * clear variables before writing
          MOVE      SP70,NZIBCLMC
          MOVE      SP70,NZIBCNTR
          MOVE      SP70,NZIBFTAB
          MOVE      SP70,NZIBCPRC
          MOVE      SP70,NZIBEFDT
          MOVE      SP70,NZIBBRCD
          MOVE      ZERO,NZIBAMNT
          MOVE      SP70,NZIBSPAR
.             
          MOVE      TEMPHOSP,NZIBHOSP         * clear variables before writing
          MOVE      TEMPCLMC,NZIBCLMC
          MOVE      TEMPCNTR,NZIBCNTR
          MOVE      TEMPFTAB,NZIBFTAB
          MOVE      TEMPCPRC,NZIBCPRC
          MOVE      TEMPEFDT,NZIBEFDT
          MOVE      TEMPBRCD,NZIBBRCD
          MOVE      TEMPAMNT,NZIBAMNT
.
          PACK      KEY40,NZIBHOSP,NZIBCLMC,NZIBCNTR,NZIBFTAB,NZIBCPRC:       
                          NZIBEFDT,NZIBBRCD,SP70
          MATCH     ANSN,FILEFLAG
          IF        @EQUAL
            CALL      RANZIB11
          ELSE
            CALL      RANZIBR1
          ENDIF
          IF        OVRCD=1
            MATCH     ANSN,FILEFLAG
            IF        @EQUAL
              CALL      WRNZIB11
            ELSE
              CALL      WRNZIBR1
            ENDIF
          ENDIF
          GOTO      WINZ6000
.
WINZ9999  RETURN
.
.------------------------------------------------------------------------------
. Check nz private proc fee inv and rev breakdown agains total 
.------------------------------------------------------------------------------
INVB0000  BRANCH    NZPFCONT,INVB9999
.
          COMPARE   ONE,NZPFIBRK            * skip of not using inv breakdown
          GOTO      INVB5500 IF NOT EQUAL
.
          MOVE      ZERO,TOTADDIT
.
          PACK      KEY40,NZPFHOSP,NZPFCLMC,NZPFCNTR,NZPFFTAB:
                          NZPFCPRC,NZPFEFDT,SP70
          MATCH     ANSN,FILEFLAG
          IF        @EQUAL
            CALL      RSNZIB11
          ELSE
            CALL      RSNZIBR1
          ENDIF
.
INVB1000  MATCH     ANSN,FILEFLAG                * Check inv breakdown
          IF        @EQUAL
            CALL      RKNZIB11
          ELSE
            CALL      RKNZIBR1
          ENDIF
          BRANCH    OVRCD,INVB5000
.
          MATCH     NZIBHOSP,NZPFHOSP            * same hospital
          GOTO      INVB5000 IF NOT EQUAL
.
          MATCH     NZIBCLMC,NZPFCLMC            * same claim code
          GOTO      INVB5000 IF NOT EQUAL
.
          MATCH     NZIBCNTR,NZPFCNTR            * same health fund
          GOTO      INVB5000 IF NOT EQUAL
.
          MATCH     NZIBFTAB,NZPFFTAB            * same health fund table
          GOTO      INVB5000 IF NOT EQUAL
.
          MATCH     NZIBCPRC,NZPFCPRC            * same procdure
          GOTO      INVB5000 IF NOT EQUAL
.
          MATCH     NZIBEFDT,NZPFEFDT            * same effective date
          GOTO      INVB5000 IF NOT EQUAL
.
          ADD       NZIBAMNT,TOTADDIT
          GOTO      INVB1000
.
INVB5000  SUB       NZPFPPOR,TOTADDIT
......    SUB       NZPFHPOR,TOTADDIT
          COMPARE   ZERO,TOTADDIT
          GOTO      INVB9000 IF NOT EQUAL
.
INVB5500  COMPARE   ONE,NZPFRBRK            * skip of not using inv breakdown
          GOTO      INVB9999 IF NOT EQUAL
. 
          MOVE      ZERO,TOTADDIT
.
          PACK      KEY40,NZPFHOSP,NZPFCLMC,NZPFCNTR,NZPFFTAB:
                          NZPFCPRC,NZPFEFDT,SP70
          MATCH     ANSN,FILEFLAG
          IF        @EQUAL
            CALL      RSNZRB11
          ELSE
            CALL      RSNZRBR1
          ENDIF
.
INVB6000  MATCH     ANSN,FILEFLAG                * check rev  breakdown
          IF        @EQUAL
            CALL      RKNZRB11
          ELSE
            CALL      RKNZRBR1
          ENDIF
          BRANCH    OVRCD,INBV7000
.
          MATCH     NZRBHOSP,NZPFHOSP            * same hospital
          GOTO      INBV7000 IF NOT EQUAL
.
          MATCH     NZRBCLMC,NZPFCLMC            * same claim code
          GOTO      INBV7000 IF NOT EQUAL
.
          MATCH     NZRBCNTR,NZPFCNTR            * same health fund
          GOTO      INBV7000 IF NOT EQUAL
.
          MATCH     NZRBFTAB,NZPFFTAB            * same health fund table
          GOTO      INBV7000 IF NOT EQUAL
.
          MATCH     NZRBCPRC,NZPFCPRC            * same procedure code
          GOTO      INBV7000 IF NOT EQUAL
.
          MATCH     NZRBEFDT,NZPFEFDT            * same effective date
          GOTO      INBV7000 IF NOT EQUAL
.
          ADD       NZRBAMNT,TOTADDIT
          GOTO      INVB6000
.
INBV7000  SUB       NZPFPPOR,TOTADDIT
........  SUB       NZPFHPOR,TOTADDIT
          COMPARE   ZERO,TOTADDIT
          GOTO      INVB9000 IF NOT EQUAL
.
          MOVE      ZERO,EXIT
          GOTO      INVB9999

INVB9000  CLEAR    WEBTITLE
          APPEND   "Warning: Total Inv/Rev breakdown must be ",WEBTITLE
          APPEND   "equal to the Fixed Fee.",WEBTITLE
          RESET     WEBTITLE
          MOVE      ZERO,F1
          MOVE      NEXTPAGE,F1
          COMPARE   THREE,F1
          IF        @EQUAL
            CALL      PRADIR00
          ELSE
            CALL      WEBERR00
          ENDIF
.
          MOVE      ONE,EXIT               * total <> inv/rev  breakdown
          GOTO      INVB9999
.
INVB9999  RETURN
.
.------------------------------------------------------------------------------
. NZ Private Bed Fee Maintenance: Display,Add,Update,Delete
.------------------------------------------------------------------------------
NZBFEE00  RESET     UPDTTYPE
.
          MATCH     SP70,UPDTTYPE           * Display formaction
          GOTO      NZBFEE80 IF EQUAL
.
          MATCH     "A",UPDTTYPE            * Add formaction
          GOTO      NZBFEE10 IF EQUAL
.
          MATCH     "U",UPDTTYPE            * Update formaction
          GOTO      NZBFEE20 IF EQUAL
.
          MATCH     "D",UPDTTYPE            * Delete formaction
          GOTO      NZBFEE30 IF EQUAL
.
          MATCH     "G",UPDTTYPE            * Global Update formaction
          GOTO      NZBFEE40 IF EQUAL
.
          MATCH     "H",UPDTTYPE            * Health Fund Duplication
          GOTO      NZBFEE50 IF EQUAL
.
          MATCH     "E",UPDTTYPE            * Global Delete formaction
          GOTO      NZBFEE60 IF EQUAL
.
          MATCH     "C",UPDTTYPE            * Create New File
          GOTO      NZBFEE70 IF EQUAL
.
          MATCH     "F",UPDTTYPE            * Update New File
          GOTO      NZBFEE75 IF EQUAL
.
          GOTO      NZBFEE93
.
NZBFEE10  MATCH     "N",FILEFLAG
          GOTO      NZBFEE15 IF EQUAL
.
          PACK      KEY37,NZBFE001,NZBFE002,NZBFE003,NZBFE004,NZBFE005:
                          NZBFE006,NZBFE008,NZBFE007,SP70
          CALL      RDNZBFE1                * Add into Current File
          COMPARE   ZERO,OVRCD
          GOTO      NZBFEE92 IF EQUAL
.
          CALL      MVNZBF00
.
          PACK      NZBFCDAT,CCC,CYY,CMM,CDD
          REP       " 0",NZBFCDAT                * Systen date
          CLOCK     TIME,NZBFCTIM                * System time
          MOVE      USERID,NZBFCUID              * web user id
          MOVE      SP70,NZBFUDAT
          MOVE      SP70,NZBFUTIM
          MOVE      SP70,NZBFUUID
.
          CALL      WRNZBFE1
.
          MOVE      ZERO,EXIT
          GOTO      NZBFEE99
.
NZBFEE15  PACK      KEY37,NZBFE001,NZBFE002,NZBFE003,NZBFE004,NZBFE005:
                          NZBFE006,NZBFE008,NZBFE007,SP70
          CALL      RDNZBF11                * Add into New File
          COMPARE   ZERO,OVRCD
          GOTO      NZBFEE92 IF EQUAL
.
          CALL      MVNZBF00
.
          PACK      NZBFCDAT,CCC,CYY,CMM,CDD
          REP       " 0",NZBFCDAT                * Systen date
          CLOCK     TIME,NZBFCTIM                * System time
          MOVE      USERID,NZBFCUID              * web user id
          MOVE      SP70,NZBFUDAT
          MOVE      SP70,NZBFUTIM
          MOVE      SP70,NZBFUUID
.
          CALL      WRNZBF11
.
          MOVE      ZERO,EXIT
          GOTO      NZBFEE99
.
NZBFEE20  MATCH     "N",FILEFLAG
          GOTO      NZBFEE25 IF EQUAL
.
          PACK      KEY37,NZBFE001,NZBFE002,NZBFE003,NZBFE004,NZBFE005:
                          NZBFE006,NZBFE008,NZBFE007,SP70
          CALL      RDNZBFE1                * Update into Current File
          BRANCH    OVRCD,NZBFEE91
.
          CALL      MVNZBF00
.
          PACK      NZBFUDAT,CCC,CYY,CMM,CDD
          REP       " 0",NZBFUDAT                * Systen date
          CLOCK     TIME,NZBFUTIM                * System time
          MOVE      USERID,NZBFUUID              * web user id
.
          CALL      UPNZBFE1
.
          MOVE      ZERO,EXIT
          GOTO      NZBFEE99
.
NZBFEE25  PACK      KEY37,NZBFE001,NZBFE002,NZBFE003,NZBFE004,NZBFE005:
                          NZBFE006,NZBFE008,NZBFE007,SP70
          CALL      RDNZBF11                * Update into New File
          BRANCH    OVRCD,NZBFEE91
.
          CALL      MVNZBF00
.
          PACK      NZBFUDAT,CCC,CYY,CMM,CDD
          REP       " 0",NZBFUDAT                * Systen date
          CLOCK     TIME,NZBFUTIM                * System time
          MOVE      USERID,NZBFUUID              * web user id
.
          CALL      UPNZBF11
.
          MOVE      ZERO,EXIT
          GOTO      NZBFEE99
.
NZBFEE30  PACK      KEY37,NZBFE001,NZBFE002,NZBFE003,NZBFE004,NZBFE005:
                          NZBFE006,NZBFE008,NZBFE007,SP70
          CALL      RDNZBF11                * Delete from New File
          BRANCH    OVRCD,NZBFEE91
          CALL      DENZBF11
.
          MOVE      ZERO,EXIT
          GOTO      NZBFEE99
.
NZBFEE40  CALL      NZGU0000                * Schedule global update
          GOTO      NZBFEE99
.
NZBFEE50  CALL      NZDP0000                * Schedule NZ Bed fee duplication
          GOTO      NZBFEE99
.
NZBFEE60  CALL      NZGD0000                * Schedule NZ global deletion
          GOTO      NZBFEE99
.
NZBFEE70  CALL      NZSN0000                * Schedule new file creation
          GOTO      NZBFEE99
.
NZBFEE75  CALL      NZUD0000                * Schedule NZ bed fee update
          GOTO      NZBFEE99
.
NZBFEE80  MOVE      ZERO,EXIT
          MATCH     "4",TEMPLATE
          IF        @EQUAL
            CALL      LCKBF000                * Check if Locked
            BRANCH    EXIT,NZBFEE99
          ENDIF
.
          MATCH     "N",FILEFLAG
          GOTO      NZBFEE81 IF EQUAL
.
          PACK      KEY37,NZBFE001,NZBFE002,NZBFE003,NZBFE004,NZBFE005:
                          NZBFE006,NZBFE008,NZBFE007,SP70
          CALL      RDNZBFE1
          IF        OVRCD=1
            CALL      CLNZBF00
          ENDIF
          GOTO      NZBFEE82
.
NZBFEE81  PACK      KEY37,NZBFE001,NZBFE002,NZBFE003,NZBFE004,NZBFE005:
                          NZBFE006,NZBFE008,NZBFE007,SP70
          CALL      RDNZBF11
          IF        OVRCD=1
            CALL      CLNZBF00
          ENDIF
.
NZBFEE82  CLEAR     WEBTITLE
          MOVE      "NZ Private Bed Fee Maintenance",WEBTITLE
          RESET     WEBTITLE
.
          CALL      WEBHED00   * Create Output File and Write HTML Page Header
          BRANCH    EXIT,NZBFEE99
          CALL      WEBBOD00   * Process Web Body
          CALL      WEBEND00   * Process End of HTML File
.
          MOVE      ONE,EXIT
          GOTO      NZBFEE99
.
NZBFEE91  MOVE      "Record does not exist",WEBTITLE
          CALL      WEBERR00
          MOVE      ONE,EXIT
          GOTO      NZBFEE99
.
NZBFEE92  MOVE      "Record already exists",WEBTITLE
          CALL      WEBERR00
          MOVE      ONE,EXIT
          GOTO      NZBFEE99
.
NZBFEE93  MOVE      "Invalid Form Action.",WEBTITLE
          CALL      WEBERR00
          MOVE      ONE,EXIT
          GOTO      NZBFEE99
.
NZBFEE99  RETURN
.
.------------------------------------------------------------------------------
. NZ Private Miscellaneous Charges Maintenance: Display,Add,Update,Delete
.------------------------------------------------------------------------------
NZPMSC00  RESET     UPDTTYPE
          MATCH     SP70,UPDTTYPE           * Display formaction
          GOTO      NZPMSC80 IF EQUAL
.
          MATCH     "A",UPDTTYPE            * Add formaction
          GOTO      NZPMSC10 IF EQUAL
.
          MATCH     "U",UPDTTYPE            * Update formaction
          GOTO      NZPMSC20 IF EQUAL
.
          MATCH     "D",UPDTTYPE            * Delete formaction
          GOTO      NZPMSC30 IF EQUAL
.
          MATCH     "B",UPDTTYPE            * Add Exploding Item 
          GOTO      NZPMSC40 IF EQUAL
.
          MATCH     "F",UPDTTYPE            * Update Exploding Item 
          GOTO      NZPMSC50 IF EQUAL
.
          MATCH     "I",UPDTTYPE            * Update Exploding Item 
          GOTO      NZPMSC60 IF EQUAL
.
          MATCH     "C",UPDTTYPE            * Create New File
          GOTO      NZPMSC70 IF EQUAL
.
          MATCH     "L",UPDTTYPE            * Update New to Current
          GOTO      NZPMSC71 IF EQUAL
.
          MATCH     "H",UPDTTYPE            * Misc Fee Duplication (New)
          GOTO      NZPMSC72 IF EQUAL
.
          MATCH     "E",UPDTTYPE            * Global Delete (New)
          GOTO      NZPMSC73 IF EQUAL
.
          MATCH     "G",UPDTTYPE            * Generate Default Keyword file
          GOTO      NZPMSC74 IF EQUAL
.
          MATCH     "P",UPDTTYPE            * Global update New file
          GOTO      NZPMSC75 IF EQUAL
.
          GOTO      NZPMSC93
.
.   **********  ADD FORMACTION  **********
.
NZPMSC10  MOVE      NZMCH006,VALFDATE
          MOVE      NZMCH019,VALTDATE
          PACK      KEY37,NZMCH001,NZMCH002,NZMCH003,NZMCH004,NZMCH005:
                          NZMCH006,SP70
          CALL      VNDT0000               * Validate effective dates
          BRANCH    EXIT,NZPMSC95
.
          MATCH     "N",FILEFLAG
          GOTO      NZPMSC15 IF EQUAL
.
          PACK      KEY37,NZMCH001,NZMCH002,NZMCH003,NZMCH004,NZMCH005:
                          NZMCH006,SP70
          CALL      RDNZMCH1                * Add into Current File
          COMPARE   ZERO,OVRCD
          GOTO      NZPMSC92 IF EQUAL
.
          CALL      MVNZMC00
.
          PACK      NZMCCDAT,CCC,CYY,CMM,CDD
          REP       " 0",NZMCCDAT                * Systen date
          CLOCK     TIME,NZMCCTIM                * System time
          MOVE      USERID,NZMCCUID              * web user id
          MOVE      SP70,NZMCUDAT
          MOVE      SP70,NZMCUTIM
          MOVE      SP70,NZMCUUID
.
          CALL      WRNZMCH1
.
          PROC      PATMKIUP              * update default misc charge keyword
.
          CALL      ENZD0000              * Auto populate prev.item end date
.
          MOVE      ZERO,EXIT
          GOTO      NZPMSC99
.
NZPMSC15  PACK      KEY37,NZMCH001,NZMCH002,NZMCH003,NZMCH004,NZMCH005:
                          NZMCH006,SP70
          CALL      RDNZMC11                * Add into New File
          COMPARE   ZERO,OVRCD
          GOTO      NZPMSC92 IF EQUAL
.
          CALL      MVNZMC00
.
          PACK      NZMCCDAT,CCC,CYY,CMM,CDD
          REP       " 0",NZMCCDAT                * Systen date
          CLOCK     TIME,NZMCCTIM                * System time
          MOVE      USERID,NZMCCUID              * web user id
          MOVE      SP70,NZMCUDAT
          MOVE      SP70,NZMCUTIM
          MOVE      SP70,NZMCUUID
.
          CALL      WRNZMC11
.
          CALL      ENZD0000              * Auto populate prev.item end date
.
          MOVE      ZERO,EXIT
          GOTO      NZPMSC99
.
.   **********  UPDATE FORMACTION  **********
.
NZPMSC20  MOVE      NZMCH006,VALFDATE
          MOVE      NZMCH019,VALTDATE
          PACK      KEY37,NZMCH001,NZMCH002,NZMCH003,NZMCH004,NZMCH005:
                          NZMCH006,SP70
          CALL      VNDT0000               * Validate effective dates
          BRANCH    EXIT,NZPMSC95
.
          MATCH     "N",FILEFLAG
          GOTO      NZPMSC25 IF EQUAL
.
          PACK      KEY37,NZMCH001,NZMCH002,NZMCH003,NZMCH004,NZMCH005:
                          NZMCH006,SP70
          CALL      RDNZMCH1                * Update into Current File
          BRANCH    OVRCD,NZPMSC91
.
          CALL      MVNZMC00
.
          PACK      NZMCUDAT,CCC,CYY,CMM,CDD
          REP       " 0",NZMCUDAT                * Systen date
          CLOCK     TIME,NZMCUTIM                * System time
          MOVE      USERID,NZMCUUID              * web user id
.
          CALL      UPNZMCH1
.
          PROC      PATMKIUP              * update default misc charge keyword
.
          MOVE      ZERO,EXIT
          GOTO      NZPMSC99
.
NZPMSC25  PACK      KEY37,NZMCH001,NZMCH002,NZMCH003,NZMCH004,NZMCH005:
                          NZMCH006,SP70
          CALL      RDNZMC11                * Update into New File
          BRANCH    OVRCD,NZPMSC91
.
          CALL      MVNZMC00
.
          PACK      NZMCUDAT,CCC,CYY,CMM,CDD
          REP       " 0",NZMCUDAT                * Systen date
          CLOCK     TIME,NZMCUTIM                * System time
          MOVE      USERID,NZMCUUID              * web user id
.
          CALL      UPNZMC11
.
          MOVE      ZERO,EXIT
          GOTO      NZPMSC99
.
.   **********  DELETE FORMACTION  **********
.
NZPMSC30  PACK      KEY37,NZMCH001,NZMCH002,NZMCH003,NZMCH004,NZMCH005:
                          NZMCH006,SP70
          CALL      DENZMC11                * Delete from New File
          BRANCH    OVRCD,NZPMSC91
.
          CALL      DENZMC11
.
          CALL      DMXP0000                * Delete Exploding Items
.
          MOVE      ZERO,EXIT
          GOTO      NZPMSC99
.
.   **********  ADD EXPLODING ITEM FORMACTION  **********
.   
NZPMSC40  MATCH     "N",FILEFLAG
          GOTO      NZPMSC45 IF EQUAL
.         
          PACK      KEY37,NZMCH001,NZMCH002,NZMCH003,NZMCH004,NZMCH005:
                          NZMCH006,SP70
          CALL      RDNZMCH1                * Add into Current File
          BRANCH    OVRCD,NZPMSC91
.         
          MOVE      ZERO,F3
          PACK      KEY40,NZMCH001,NZMCH002,NZMCH003,NZMCH004,NZMCH005:
                          NZMCH006,Z70
          CALL      RSNZMXC1
          CALL      RPNZMXC1
          BRANCH    OVRCD,NZPMSC42
.
          MATCH     NZMCH001,NZMXHOSP            * hospital
          GOTO      NZPMSC42 IF NOT EQUAL
.         
          MATCH     NZMCH002,NZMXCLMC            * claim code
          GOTO      NZPMSC42 IF NOT EQUAL
.         
          MATCH     NZMCH003,NZMXCNTR            * health fund
          GOTO      NZPMSC42 IF NOT EQUAL
.         
          MATCH     NZMCH004,NZMXFTAB            * table
          GOTO      NZPMSC42 IF NOT EQUAL
.         
          MATCH     NZMCH005,NZMXMCHG            * misc charge
          GOTO      NZPMSC42 IF NOT EQUAL
.         
          MATCH     NZMCH006,NZMXEFDT            * effective date
          GOTO      NZPMSC42 IF NOT EQUAL
.
          MOVE      NZMXUNIQ,F3                  * get next uniq number 
.         
NZPMSC42  ADD       ONE,F3
          MOVE      F3,NZMXUNIQ
          CALL      MVNZMX00 
.
          PACK      NZMXCDAT,CCC,CYY,CMM,CDD
          REP       " 0",NZMXCDAT                * Systen date
          CLOCK     TIME,NZMXCTIM                * System time
          MOVE      USERID,NZMXCUID              * web user id
          MOVE      SP70,NZMXUDAT
          MOVE      SP70,NZMXUTIM                
          MOVE      SP70,NZMXUUID   
.
          CALL      RANZMXC1
          COMPARE   ZERO,OVRCD
          GOTO      NZPMSC40 IF EQUAL
.
          CALL      WRNZMXC1
.
          MOVE      ZERO,EXIT
          GOTO      NZPMSC99
.         
NZPMSC45  PACK      KEY37,NZMCH001,NZMCH002,NZMCH003,NZMCH004,NZMCH005:
                          NZMCH006,SP70
          CALL      RDNZMC11                * Add into New File
          BRANCH    OVRCD,NZPMSC91
.
          MOVE      ZERO,F3
          PACK      KEY40,NZMCH001,NZMCH002,NZMCH003,NZMCH004,NZMCH005:
                          NZMCH006,Z70
          CALL      RSNZMX11
          CALL      RPNZMX11
          BRANCH    OVRCD,NZPMSC47
.
          MATCH     NZMCH001,NZMXHOSP            * hospital
          GOTO      NZPMSC47 IF NOT EQUAL
.
          MATCH     NZMCH002,NZMXCLMC            * claim code
          GOTO      NZPMSC47 IF NOT EQUAL
.
          MATCH     NZMCH003,NZMXCNTR            * health fund
          GOTO      NZPMSC47 IF NOT EQUAL
.
          MATCH     NZMCH004,NZMXFTAB            * table
          GOTO      NZPMSC47 IF NOT EQUAL
.
          MATCH     NZMCH005,NZMXMCHG            * misc charge
          GOTO      NZPMSC47 IF NOT EQUAL
.
          MATCH     NZMCH006,NZMXEFDT            * effective date
          GOTO      NZPMSC47 IF NOT EQUAL
.
          MOVE      NZMXUNIQ,F3                  * get next uniq number
.
NZPMSC47  ADD       ONE,F3
          MOVE      F3,NZMXUNIQ
          CALL      MVNZMX00
.
          PACK      NZMXCDAT,CCC,CYY,CMM,CDD
          REP       " 0",NZMXCDAT                * Systen date
          CLOCK     TIME,NZMXCTIM                * System time
          MOVE      USERID,NZMXCUID              * web user id
          MOVE      SP70,NZMXUDAT
          MOVE      SP70,NZMXUTIM
          MOVE      SP70,NZMXUUID
.
          CALL      RANZMX11
          COMPARE   ZERO,OVRCD
          GOTO      NZPMSC45 IF EQUAL
.
          CALL      WRNZMX11
.
          MOVE      ZERO,EXIT
          GOTO      NZPMSC99
.
.
.   **********  UPDATE EXPLODING ITEM FORMACTION  **********
.
NZPMSC50  MATCH     "N",FILEFLAG
          GOTO      NZPMSC55 IF EQUAL
.
          PACK      KEY37,NZMCH001,NZMCH002,NZMCH003,NZMCH004,NZMCH005:
                          NZMCH006,SP70
          CALL      RDNZMCH1                * Update into Current File
          BRANCH    OVRCD,NZPMSC91
.
          PACK      KEY40,NZMCH001,NZMCH002,NZMCH003,NZMCH004,NZMCH005:
                          NZMCH006,NZMXC003,SP70
          CALL      RDNZMXC1                * Update into Current File
          BRANCH    OVRCD,NZPMSC91
.
          CALL      MVNZMX00
.         
          PACK      NZMXUDAT,CCC,CYY,CMM,CDD
          REP       " 0",NZMXUDAT                * Systen date
          CLOCK     TIME,NZMXUTIM                * System time
          MOVE      USERID,NZMXUUID              * web user id
.         
          CALL      UPNZMXC1
.
          MOVE      ZERO,EXIT
          GOTO      NZPMSC99
.
NZPMSC55  PACK      KEY37,NZMCH001,NZMCH002,NZMCH003,NZMCH004,NZMCH005:
                          NZMCH006,SP70
          CALL      RDNZMC11                * Update into New File
          BRANCH    OVRCD,NZPMSC91
.
          PACK      KEY40,NZMCH001,NZMCH002,NZMCH003,NZMCH004,NZMCH005:
                          NZMCH006,NZMXC003,SP70
          CALL      RDNZMX11                * Update into Current File
          BRANCH    OVRCD,NZPMSC91
.
          CALL      MVNZMX00
.
          PACK      NZMXUDAT,CCC,CYY,CMM,CDD
          REP       " 0",NZMXUDAT                * Systen date
          CLOCK     TIME,NZMXUTIM                * System time
          MOVE      USERID,NZMXUUID              * web user id
.
          CALL      UPNZMX11
.
          MOVE      ZERO,EXIT
          GOTO      NZPMSC99
.
.
.   **********  Delete EXPLODING ITEM FORMACTION  **********
.
NZPMSC60  PACK      KEY37,NZMCH001,NZMCH002,NZMCH003,NZMCH004,NZMCH005:
                          NZMCH006,SP70
          CALL      RDNZMC11                * Update into New File
          BRANCH    OVRCD,NZPMSC91
.
          PACK      KEY40,NZMCH001,NZMCH002,NZMCH003,NZMCH004,NZMCH005:
                          NZMCH006,NZMXC003,SP70
          CALL      RDNZMX11                * Update into Current File
          BRANCH    OVRCD,NZPMSC91
.
          CALL      DENZMX11
.
          MOVE      ZERO,EXIT
          GOTO      NZPMSC99
.
.   **********  GLOBAL FUNCTIONS   **********
.
NZPMSC70  CALL      CNZM0000              * Schedule new file creation
          GOTO      MSCCHG99                
.
NZPMSC71  CALL      UNZM0000              * Schedule update new to current
          GOTO      NZPMSC99
.
NZPMSC72  CALL      HNZM0000              * Schedule misc fee duplic.(new)
          GOTO      NZPMSC99
.
NZPMSC73  CALL      DNZM0000              * Schedule global deletion (new)
          GOTO      NZPMSC99
.
NZPMSC74  CALL      KNZM0000              * Schedule gen default keyword file
          GOTO      NZPMSC99
.
NZPMSC75  CALL      INZM0000              * Schedule global update (new)
          GOTO      NZPMSC99
.
.   **********  DISPLAY FORMACTION  **********
.
NZPMSC80  MOVE      ZERO,EXIT
          MATCH     "7",TEMPLATE
          IF        @EQUAL
            CALL      LCKMC000                * Check if Locked
            BRANCH    EXIT,NZPMSC99
          ENDIF
.
          MATCH     "N",FILEFLAG
          GOTO      NZPMSC81 IF EQUAL
.
          PACK      KEY37,NZMCH001,NZMCH002,NZMCH003,NZMCH004,NZMCH005:
                          NZMCH006,SP70     
          CALL      RDNZMCH1
          IF        OVRCD=1
            CALL      CLNZMC00
          ENDIF
.
          PACK      KEY40,NZMCH001,NZMCH002,NZMCH003,NZMCH004,NZMCH005:
                          NZMCH006,NZMXC003,SP70     
          CALL      RDNZMXC1
          IF        OVRCD=1
            CALL      CLNZMX00
          ENDIF
          GOTO      NZPMSC82
.
NZPMSC81  PACK      KEY37,NZMCH001,NZMCH002,NZMCH003,NZMCH004,NZMCH005:
                          NZMCH006,SP70     
          CALL      RDNZMC11
          IF        OVRCD=1
            CALL      CLNZMC00
          ENDIF
.
          PACK      KEY40,NZMCH001,NZMCH002,NZMCH003,NZMCH004,NZMCH005:
                          NZMCH006,NZMXC003,SP70     
          CALL      RDNZMX11
          IF        OVRCD=1
            CALL      CLNZMX00
          ENDIF
.
NZPMSC82  CLEAR     WEBTITLE
          MOVE      "NZ Private Miscellaneous Charges Maintenance",WEBTITLE
          RESET     WEBTITLE
.
          CALL      WEBHED00   * Create Output File and Write HTML Page Header
          BRANCH    EXIT,NZPMSC99
          CALL      WEBBOD00   * Process Web Body
          CALL      WEBEND00   * Process End of HTML File
.
          MOVE      ONE,EXIT
          GOTO      NZPMSC99
.
NZPMSC91  MOVE      "Record does not exist",WEBTITLE
          CALL      WEBERR00
          MOVE      ONE,EXIT
          GOTO      NZPMSC99
.
NZPMSC92  MOVE      "Record already exists",WEBTITLE
          CALL      WEBERR00
          MOVE      ONE,EXIT
          GOTO      NZPMSC99
.
NZPMSC93  MOVE      "Invalid Form Action.",WEBTITLE
          CALL      WEBERR00
          MOVE      ONE,EXIT
          GOTO      NZPMSC99
.
NZPMSC95  MOVE      "Invalid Effective From/To Date (Overlap).",WEBTITLE
          CALL      WEBERR00
          MOVE      ONE,EXIT
          GOTO      NZPMSC99
.
NZPMSC99  RETURN
.
.------------------------------------------------------------------------------
. Delete linked NZ Private Misc Charge Exploding Items
.------------------------------------------------------------------------------
DMXP0000  PACK      KEY40,NZMCH001,NZMCH002,NZMCH003,NZMCH004,NZMCH005:
                          NZMCH006,SP70
          CALL      RSNZMX11 
          CALL      RKNZMX11
          BRANCH    OVRCD,DMXP9999
.
          MATCH     NZMCH001,NZMXHOSP            * hospital
          GOTO      DMXP9999 IF NOT EQUAL
.
          MATCH     NZMCH002,NZMXCLMC            * claim code
          GOTO      DMXP9999 IF NOT EQUAL
.
          MATCH     NZMCH003,NZMXCNTR            * health fund
          GOTO      DMXP9999 IF NOT EQUAL
.
          MATCH     NZMCH004,NZMCFTAB            * health fund table
          GOTO      DMXP9999 IF NOT EQUAL
.
          MATCH     NZMCH005,NZMXMCHG            * misc charge
          GOTO      DMXP9999 IF NOT EQUAL
.
          MATCH     NZMCH006,NZMXEFDT            * effective date
          GOTO      DMXP9999 IF NOT EQUAL
.
          PACK      KEY40,NZMXHOSP,NZMXCLMC,NZMXCNTR,NZMCFTAB,NZMXMCHG:
                          NZMXEFDT,NZMXUNIQ,SP70
          CALL      DENZMX11
.
          GOTO      DMXP0000
.
DMXP9999  RETURN
.
.--------------------------------------------------------------------------
.*                             NZGU0000                                   *
.*   Schedule global update of of NZ bed fees from IBARSH10               *
.--------------------------------------------------------------------------
NZGU0000  MOVE      "IBARSH12",SCHDPGID
          MOVE      "Global Update of NZ Bed Fee Charges",SCHDDESC
          PACK      SCHDDATE,CCC,CYY,CMM,CDD
          REP       " 0",SCHDDATE
          CLOCK     TIME,SCHDTIME
.
.         Write Keyin parameters for Extract
.
          MOVE      ONE,INDEXCNT
          MOVE      TEN2,KEYSTARR[INDEXCNT]     * Option
.
          ADD       ONE,INDEXCNT
          MOVE      NZBFE001,KEYSTARR[INDEXCNT]   * Hospital  
.
          ADD       ONE,INDEXCNT
          MOVE      NZBFE002,KEYSTARR[INDEXCNT]   * Claim Type
.
          BRANCH    NZBFE012,NZGU0100             * All Health Fund
.
          MATCH     NZBFE003,SP70                 * Blank Health Fund
          GOTO      NZGU0200 IF EQUAL
.
          ADD       ONE,INDEXCNT
          MOVE      NZBFE003,KEYSTARR[INDEXCNT]   * Single Health Fund
.
          BRANCH    NZBFE013,NZGU0100             * All Health Fund Table
.
          ADD       ONE,INDEXCNT
          MOVE      NZBFE004,KEYSTARR[INDEXCNT]   * Single Health Fund Table
.
          GOTO      NZGU0300
.
NZGU0100  ADD       ONE,INDEXCNT
          MOVE      SP70,KEYSTARR[INDEXCNT]            * All Health Fund
          GOTO      NZGU0300
.
.         Blank Health Fund requires Spaces to be passed to IBARSH12.
.         SCHPRO00 strips fields of spaces therefore, to pass spaces,
.         characters should be appended to the field.  Note: Make sure
.         there are enough spaces to fill the whole field.
.
NZGU0200  ADD       ONE,INDEXCNT
          PACK      KEYSTARR[INDEXCNT],SP6,BLANK,SP70 * Blank Health Fund
          GOTO      NZGU0300
.
NZGU0300  ADD       ONE,INDEXCNT
          MOVE      NZBFE005,KEYSTARR[INDEXCNT]   * Admission Type
          ADD       ONE,INDEXCNT
          MOVE      NZBFE006,KEYSTARR[INDEXCNT]   * Bed Type
.
          ADD       ONE,INDEXCNT
          IF        NZBFE014=1
            MOVE      SP70,KEYSTARR[INDEXCNT]       * All Days
          ELSE
            MOVE      NZBFE007,KEYSTARR[INDEXCNT]   * Last day in period
          ENDIF
.
          ADD       ONE,INDEXCNT
          MOVE      INCRFLAG,KEYSTARR[INDEXCNT]   * Increase type
          ADD       ONE,INDEXCNT
          MOVE      NZBFE009,KEYSTARR[INDEXCNT]   * Patient portion
          ADD       ONE,INDEXCNT
          MOVE      NZBFE010,KEYSTARR[INDEXCNT]  * Rebate portion
          ADD       ONE,INDEXCNT
          MOVE      ANSY,KEYSTARR[INDEXCNT]      * Confirm yes to update
.
          MOVE      INDEXCNT,KEYSTCNT          * Number of Keyins
.
          CALL      SCHPRO00   * Schedule Extract
.
NZGU9999  RETURN
.
.--------------------------------------------------------------------------
.*                             NZSN0000                                   *
.*   Schedule creation of new NZ bed fee file from IBARSH12               *
.--------------------------------------------------------------------------
NZSN0000  MOVE      "IBARSH12",SCHDPGID
          MOVE      "Create New Bed Fee File",SCHDDESC
          PACK      SCHDDATE,CCC,CYY,CMM,CDD
          REP       " 0",SCHDDATE
          CLOCK     TIME,SCHDTIME
.
.         Write Keyin parameters for Extract
.
          MOVE      TEN1,KEYSTARR[1]          * Option 1 Create New File
          MOVE      ANSY,KEYSTARR[2]         * Yes to create new file
          MOVE      COPYFLAG,KEYSTARR[3]     * Start with a copy of current data
.
          MATCH     ANSY,COPYFLAG
          IF        @EQUAL
            MOVE      THREE,KEYSTCNT         * Number of Keyins
          ELSE
            MOVE      ANSY,KEYSTARR[4]       * Yes start with a empty file
            MOVE      FOUR,KEYSTCNT          * Number of Keyins
          ENDIF
.
          CALL      SCHPRO00   * Schedule Extract
.
NZSN9999  RETURN
.
.--------------------------------------------------------------------------
.*                             NZGD0000                                   *
.*   Schedule global deletion of NZ bed fees from IBARSH12                *
.--------------------------------------------------------------------------
NZGD0000  MOVE      "IBARSH12",SCHDPGID
          MOVE      "NZ Bed Fee Global Deletion",SCHDDESC
          PACK      SCHDDATE,CCC,CYY,CMM,CDD
          REP       " 0",SCHDDATE
          CLOCK     TIME,SCHDTIME
.
.         Write Keyin parameters for Extract
.
          MOVE      ONE,INDEXCNT
          MOVE      TEN3,KEYSTARR[INDEXCNT]         * Option
.
          ADD       ONE,INDEXCNT
          MOVE      NZBFE001,KEYSTARR[INDEXCNT]   * Hospital
          ADD       ONE,INDEXCNT
          MOVE      NZBFE002,KEYSTARR[INDEXCNT]   * Claim Type
.
          BRANCH    NZBFE012,NZGD0100             * All Health Fund
.
          MATCH     NZBFE003,SP70                 * Blank Health Fund
          GOTO      NZGD0200 IF EQUAL
.
          ADD       ONE,INDEXCNT
          MOVE      NZBFE003,KEYSTARR[INDEXCNT]   * Single Health Fund
.
          BRANCH    NZBFE013,SGLD0100             * All Health Fund Table
.
          ADD       ONE,INDEXCNT
          MOVE      NZBFE004,KEYSTARR[INDEXCNT]   * Single Health Fund Table
.
          GOTO      NZGD0300
.
NZGD0100  ADD       ONE,INDEXCNT
          MOVE      SP70,KEYSTARR[INDEXCNT]            * All Health Fund
          GOTO      NZGD0300
.
.         Blank Health Fund requires Spaces to be passed to IBARSH10.
.         SCHPRO00 strips fields of spaces therefore, to pass spaces,
.         characters should be appended to the field.  Note: Make sure
.         there are enough spaces to fill the whole field.
.
NZGD0200  ADD       ONE,INDEXCNT
          PACK      KEYSTARR[INDEXCNT],SP6,BLANK,SP70 * Blank Health Fund
          GOTO      NZGD0300
.
NZGD0300  ADD       ONE,INDEXCNT
          MOVE      NZBFE005,KEYSTARR[INDEXCNT]   * Admission Type
.
          ADD       ONE,INDEXCNT
          MOVE      NZBFE006,KEYSTARR[INDEXCNT]   * Bed Type
.
          ADD       ONE,INDEXCNT
          MOVE      ANSY,KEYSTARR[INDEXCNT]         * Yes perform deletion
          MOVE      INDEXCNT,KEYSTCNT           * Number of Keyins
.
          CALL      SCHPRO00   * Schedule Extract
.
NZGD9999  RETURN
.
.--------------------------------------------------------------------------
.*                             CNZP0000                                   *
.*   Schedule creation of new NZ Private Contract Procedure Fee File      *
.*   from IBARSH12                                                        *
.--------------------------------------------------------------------------
CNZP0000  MOVE      "IBARSH12",SCHDPGID
          MOVE      "Create New NZ Private Contract Procedure Fee File",SCHDDESC
          PACK      SCHDDATE,CCC,CYY,CMM,CDD
          REP       " 0",SCHDDATE
          CLOCK     TIME,SCHDTIME
.
.         Write Keyin parameters for Extract
.
          MOVE      TEN6,KEYSTARR[1]         * Option 16 Create New File
          MOVE      ANSY,KEYSTARR[2]         * Yes to create new file
          MOVE      COPYFLAG,KEYSTARR[3]     * Start with a copy of current data
.
          MATCH     ANSY,COPYFLAG
          IF        @EQUAL
            MOVE      SP70,KEYSTARR[4]       * Enter
            MOVE      FOUR,KEYSTCNT          * Number of Keyins
          ELSE
            MOVE      ANSY,KEYSTARR[4]       * Yes start with a empty file
            MOVE      SP70,KEYSTARR[5]       * Enter
            MOVE      FIVE,KEYSTCNT          * Number of Keyins
          ENDIF
.
          CALL      SCHPRO00   * Schedule Extract
.
CNZP9999  RETURN
.
.------------------------------------------------------------------------------
.*                             UNZP0000                                       *
.*   Schedule Update of new to Current NZ Private Contract procedure Fee File *
.*   from IBARSH12                                                            *
.------------------------------------------------------------------------------
UNZP0000  MOVE      "IBARSH12",SCHDPGID
          CLEAR      SCHDDESC
          APPEND    "Update New to Current NZ Private Contract ",SCHDDESC
          APPEND    "Procedure Fee File",SCHDDESC
          RESET     SCHDDESC
          PACK      SCHDDATE,CCC,CYY,CMM,CDD
          REP       " 0",SCHDDATE
          CLOCK     TIME,SCHDTIME
.
.         Write Keyin parameters for Extract
.
          MOVE      TEN9,KEYSTARR[1]         * Option 19 Update New to Current
          MOVE      ANSY,KEYSTARR[2]         * Yes to Update
          MOVE      SP70,KEYSTARR[3]         * Enter
          MOVE      THREE,KEYSTCNT             * Number of Keyins
.
          CALL      SCHPRO00   * Schedule Extract
.
UNZP9999  RETURN
.
.------------------------------------------------------------------------------
.*                             DNZP0000                                       *
.*   Schedule Global Delete on new  NZ Private Contract Procedure  Fee File   *
.*   from IBARSH12                                                            *
.------------------------------------------------------------------------------
DNZP0000  MOVE      "IBARSH12",SCHDPGID
          CLEAR     SCHDDESC
          APPEND    "Global Delete on New NZ Private Contract ",SCHDDESC
          APPEND    "Procedure Fee File",SCHDDESC
          RESET     SCHDDESC
          PACK      SCHDDATE,CCC,CYY,CMM,CDD
          REP       " 0",SCHDDATE
          CLOCK     TIME,SCHDTIME
.
.         Write Keyin parameters for Extract
.
          MOVE      TEN8,KEYSTARR[1]         * Option 18 Global Delete new file
          MOVE      NZPFE001,KEYSTARR[2]     * Hospital
          MOVE      NZPFE002,KEYSTARR[3]     * Claim Code   
          MOVE      NZPFE003,KEYSTARR[4]     * Health Fund
          MOVE      NZPFE004,KEYSTARR[5]     * Table
          MOVE      NZPFE005,KEYSTARR[6]     * Contract Proc
.
          UNPACK    NZPFE006,CCENT,CYEAR,CMON,CDAY
          PACK      KEYSTARR[7],CDAY,CMON,CCENT,CYEAR     * Effective Date
.
          MOVE      ANSY,KEYSTARR[8]         * Yes to Update
          MOVE      SP70,KEYSTARR[9]         * Enter
          MOVE      NINE,KEYSTCNT            * Number of Keyins
.
          CALL      SCHPRO00   * Schedule Extract
.
DNZP9999  RETURN
.
.------------------------------------------------------------------------------
.*                             HNZP0000                                       *
.*   Schedule Procedure Fee Duplication on new NZ Private Contract Procedure  *
.*   Fee File from IBARSH12                                                   *
.------------------------------------------------------------------------------
HNZP0000  MOVE      "IBARSH12",SCHDPGID
          CLEAR     SCHDDESC
          APPEND    "Duplication on New NZ ",SCHDDESC
          APPEND    "Private Contract Procedure Fee File",SCHDDESC
          RESET     SCHDDESC
          PACK      SCHDDATE,CCC,CYY,CMM,CDD
          REP       " 0",SCHDDATE
          CLOCK     TIME,SCHDTIME
.
.         Write Keyin parameters for Extract
.
          MOVE      TEN7,KEYSTARR[1]         * Option 17 Proc Fee Dup new file
          MOVE      NZPFE001,KEYSTARR[2]     * Hospital
          MOVE      NZPFE002,KEYSTARR[3]     * Claim Code    
          MOVE      NZPFE003,KEYSTARR[4]     * Health Fund
          MOVE      NZPFE004,KEYSTARR[5]     * Table
          MOVE      NZPFE005,KEYSTARR[6]     * Contract Proc
  
          UNPACK    NZPFE006,CCENT,CYEAR,CMON,CDAY
          PACK      KEYSTARR[7],CDAY,CMON,CCENT,CYEAR     * Effective Date
.
          MOVE      CPPFE001,KEYSTARR[8]     * Copy to Hospital
          MOVE      CPPFE002,KEYSTARR[9]     * Copy to Claim Code   
          MOVE      CPPFE003,KEYSTARR[10]    * Copy to Health Fund
          MOVE      CPPFE004,KEYSTARR[11]    * Copy to Table
          MOVE      CPPFE005,KEYSTARR[12]    * Copy to Contract Proc
.
          UNPACK    CPPFE006,CCENT,CYEAR,CMON,CDAY
          PACK      KEYSTARR[13],CDAY,CMON,CCENT,CYEAR  * Copy to Effective Date
.
          MOVE      ANSY,KEYSTARR[14]        * Yes to Update
          MOVE      SP70,KEYSTARR[15]        * Enter
          MOVE      TEN5,KEYSTCNT            * Number of Keyins

          CALL      SCHPRO00   * Schedule Extract
.
HNZP9999  RETURN
.--------------------------------------------------------------------------
.*                             NZUD0000                                   *
.*   Schedule update of NZ bed fee file from IBARSH12                     *
.--------------------------------------------------------------------------
NZUD0000  MOVE      "IBARSH12",SCHDPGID
          MOVE      "Update NZ Bed Fee File",SCHDDESC
          PACK      SCHDDATE,CCC,CYY,CMM,CDD
          REP       " 0",SCHDDATE
          CLOCK     TIME,SCHDTIME
.
.         Write Keyin parameters for Extract
.
          MOVE      TEN5,KEYSTARR[1]          * Option
          MOVE      ANSY,KEYSTARR[2]         * Yes to update charges
          IF        RECALCHG=1
            MOVE      ANSY,KEYSTARR[3]
            UNPACK    BFEEDATE,CCENT,CYEAR,CMON,CDAY
            PACK      KEY8,CDAY,CMON,CCENT,CYEAR,SP70
            MOVE      KEY8,KEYSTARR[4]
.
            MOVE      BFEETIME,KEYSTARR[5]
.
            UNPACK    FROMDATE,CCENT,CYEAR,CMON,CDAY
            PACK      KEY8,CDAY,CMON,CCENT,CYEAR,SP70
            MOVE      KEY8,KEYSTARR[6]
.
            MOVE      ANSY,KEYSTARR[7]
            MOVE      SP70,KEYSTARR[8]
            MOVE      EIGHT,KEYSTCNT             * Number of Keyins
          ELSE
            MOVE      ANSN,KEYSTARR[3]
            MOVE      SP70,KEYSTARR[4]
            MOVE      FOUR,KEYSTCNT             * Number of Keyins
          ENDIF
.
NZUD1000  CALL      SCHPRO00   * Schedule Extract
.
NZUD9999  RETURN
+
.--------------------------------------------------------------------------
.*                             NZDP0000                                   *
.*   Schedule health fund / table duplication from IBARSH10               *
.--------------------------------------------------------------------------
NZDP0000  MOVE      "IBARSH12",SCHDPGID
          MOVE      "NZ Bed Fee Duplication",SCHDDESC
          PACK      SCHDDATE,CCC,CYY,CMM,CDD
          REP       " 0",SCHDDATE
          CLOCK     TIME,SCHDTIME
.
.         Write Keyin parameters for Extract
.
          MOVE      ONE,INDEXCNT
          MOVE      TEN4,KEYSTARR[INDEXCNT]         * Option
.
.         Copy From Section
.
          ADD       ONE,INDEXCNT
          MOVE      NZBFE001,KEYSTARR[INDEXCNT]     * Hospital  
          ADD       ONE,INDEXCNT
          MOVE      NZBFE002,KEYSTARR[INDEXCNT]     * Claim Type
.
          BRANCH    NZBFE012,NZDP0100             * All Health Fund
.
          MATCH     NZBFE003,SP70                 * Blank Health Fund
          GOTO      NZDP0200 IF EQUAL
.
          ADD       ONE,INDEXCNT
          MOVE      NZBFE003,KEYSTARR[INDEXCNT]   * Single Health Fund
.
          BRANCH    NZBFE013,NZDP0100             * All Health Fund Table
.
          ADD       ONE,INDEXCNT
          MOVE      NZBFE004,KEYSTARR[INDEXCNT]   * Single Health Fund Table
.
          GOTO      NZDP0300
.
NZDP0100  ADD       ONE,INDEXCNT
          MOVE      SP70,KEYSTARR[INDEXCNT]            * All Health Fund
          GOTO      NZDP0300
.
.         Blank Health Fund requires Spaces to be passed to IBARSH12.
.         SCHPRO00 strips fields of spaces therefore, to pass spaces,
.         characters should be appended to the field.  Note: Make sure
.         there are enough spaces to fill the whole field.
.
NZDP0200  ADD       ONE,INDEXCNT
          PACK      KEYSTARR[INDEXCNT],SP6,BLANK,SP70 * Blank Health Fund
          GOTO      NZDP0300
.
NZDP0300  ADD       ONE,INDEXCNT
          MOVE      NZBFE005,KEYSTARR[INDEXCNT]     * Admission Type
          ADD       ONE,INDEXCNT
          MOVE      NZBFE006,KEYSTARR[INDEXCNT]     * Bed Type
.
.         Copy To Section
.
          MATCH     NZBFE001,SP70 
          IF        !@EQUAL
            ADD       ONE,INDEXCNT
            MOVE      CPNZB001,KEYSTARR[INDEXCNT] * Copy To Hospital  
          ENDIF
.

          MATCH     NZBFE002,SP70                 * Copy From All Claim Type
          IF        !@EQUAL
            ADD       ONE,INDEXCNT
            MOVE      CPNZB002,KEYSTARR[INDEXCNT] * Copy To Claim Type
          ENDIF
.
          BRANCH    NZBFE012,NZDP0500             * Copy From All Health Fund
.
          MATCH     CPNZB003,SP70                 * Copy From Blank Health Fund
          GOTO      NZDP0400 IF EQUAL
.
          ADD       ONE,INDEXCNT
          MOVE      CPNZB003,KEYSTARR[INDEXCNT]   * Single Health Fund
.
          BRANCH    NZBFE013,NZDP0500             * Copy From All HF Table
.
          ADD       ONE,INDEXCNT
          MOVE      CPNZB004,KEYSTARR[INDEXCNT]   * Single Health Fund Table
.
          GOTO      NZDP0500
.
.         Blank Health Fund requires Spaces to be passed to IBARSH10.
.         SCHPRO00 strips fields of spaces therefore, to pass spaces,
.         characters should be appended to the field.  Note: Make sure
.         there are enough spaces to fill the whole field.
.
NZDP0400  ADD       ONE,INDEXCNT
          PACK      KEYSTARR[INDEXCNT],SP6,BLANK,SP70 * Blank Health Fund
.
NZDP0500  MATCH     SP10,NZBFE005
          IF        !@EQUAL
            ADD       ONE,INDEXCNT
            MOVE      CPNZB005,KEYSTARR[INDEXCNT]  * Copy To Admission Type
          ENDIF
.
          MATCH     SP10,NZBFE006
          IF        !@EQUAL
            ADD       ONE,INDEXCNT
            MOVE      CPNZB006,KEYSTARR[INDEXCNT]  * Copy To Bed Type
          ENDIF
.
          ADD       ONE,INDEXCNT
          MOVE      "Y",KEYSTARR[INDEXCNT]         * Yes to Post
          ADD       ONE,INDEXCNT
          MOVE      SP70,KEYSTARR[INDEXCNT]        * Enter
.
          MOVE      INDEXCNT,KEYSTCNT              * number of keystrokes
.
          CALL      SCHPRO00   * Schedule Extract
.
NZDP9999  RETURN
.
.
.--------------------------------------------------------------------------
.*                             CNZM0000                                   *
.*   Schedule creation of new NZ Private Misc Charges File from IBARSH12  *
.--------------------------------------------------------------------------
CNZM0000  MOVE      "IBARSH12",SCHDPGID
          MOVE      "Create New NZ Private Misc Charges File",SCHDDESC
          PACK      SCHDDATE,CCC,CYY,CMM,CDD
          REP       " 0",SCHDDATE
          CLOCK     TIME,SCHDTIME
.
.         Write Keyin parameters for Extract
.
          MOVE      TWENTY,KEYSTARR[1]       * Option 20 Create New File
          MOVE      ANSY,KEYSTARR[2]         * Yes to create new file
          MOVE      COPYFLAG,KEYSTARR[3]     * Start with a copy of current data
.
          MATCH     ANSY,COPYFLAG
          IF        @EQUAL
            MOVE      SP70,KEYSTARR[4]       * Enter
            MOVE      FOUR,KEYSTCNT          * Number of Keyins
          ELSE
            MOVE      ANSY,KEYSTARR[4]       * Yes start with a empty file
            MOVE      SP70,KEYSTARR[5]       * Enter
            MOVE      FIVE,KEYSTCNT          * Number of Keyins
          ENDIF
.
          CALL      SCHPRO00   * Schedule Extract
.
CNZM9999  RETURN
.
.------------------------------------------------------------------------------
.*                             UNZM0000                                       *
.*   Schedule Update of new to Current NZ Private Misc Charges File           *
.*   from IBARSH12                                                            *
.------------------------------------------------------------------------------
UNZM0000  MOVE      "IBARSH12",SCHDPGID
          CLEAR      SCHDDESC
          APPEND    "Update New to Current NZ Private Misc ",SCHDDESC
          APPEND    "Charges File",SCHDDESC
          RESET     SCHDDESC
          PACK      SCHDDATE,CCC,CYY,CMM,CDD
          REP       " 0",SCHDDATE
          CLOCK     TIME,SCHDTIME
.
.         Write Keyin parameters for Extract
.
          MOVE      TWENTY1,KEYSTARR[1]      * Option 21 Update New to Current
          MOVE      ANSY,KEYSTARR[2]         * Yes to Update
          MOVE      SP70,KEYSTARR[3]         * Enter
          MOVE      THREE,KEYSTCNT             * Number of Keyins
.
          CALL      SCHPRO00   * Schedule Extract
.
UNZM9999  RETURN
.
.------------------------------------------------------------------------------
.*                             HNZM0000                                       *
.*   Schedule Duplication on new NZ Private Misc Charges file from IBARSH12   *
.------------------------------------------------------------------------------
HNZM0000  MOVE      "IBARSH12",SCHDPGID
          MOVE      "Duplication on New NZ Private Misc Charges File",SCHDDESC
          RESET     SCHDDESC
          PACK      SCHDDATE,CCC,CYY,CMM,CDD
          REP       " 0",SCHDDATE
          CLOCK     TIME,SCHDTIME
.
.         Write Keyin parameters for Extract
.
          MOVE      TWENTY2,KEYSTARR[1]      * Option 22 misc dup new file
          MOVE      NZMCH001,KEYSTARR[2]     * Hospital
          MOVE      NZMCH002,KEYSTARR[3]     * Claim Code
          MOVE      NZMCH003,KEYSTARR[4]     * Health Fund
          MOVE      NZMCH004,KEYSTARR[5]     * Table
          MOVE      NZMCH005,KEYSTARR[6]     * Charge Code  

          UNPACK    NZMCH006,CCENT,CYEAR,CMON,CDAY
          PACK      KEYSTARR[7],CDAY,CMON,CCENT,CYEAR     * Effective Date
.
          MOVE      CPMCH001,KEYSTARR[8]     * Copy to Hospital
          MOVE      CPMCH002,KEYSTARR[9]     * Copy to Claim Code
          MOVE      CPMCH003,KEYSTARR[10]    * Copy to Health Fund
          MOVE      CPMCH004,KEYSTARR[11]    * Copy to Table
          MOVE      CPMCH005,KEYSTARR[12]    * Copy to Charge Code
.
          UNPACK    CPMCH006,CCENT,CYEAR,CMON,CDAY
          PACK      KEYSTARR[13],CDAY,CMON,CCENT,CYEAR  * Copy to Effective Date
.
          MOVE      ANSY,KEYSTARR[14]        * Yes to Update
          MOVE      SP70,KEYSTARR[15]        * Enter
          MOVE      TEN5,KEYSTCNT            * Number of Keyins

          CALL      SCHPRO00   * Schedule Extract
.
HNZM9999  RETURN
.
.------------------------------------------------------------------------------
.*                             DNZM0000                                       *
.*   Schedule Global Delete on new NZ Private Misc Charges file from          *
.*   IBARSH12                                                                 *
.------------------------------------------------------------------------------
DNZM0000  MOVE      "IBARSH12",SCHDPGID
          CLEAR     SCHDDESC
          APPEND    "Global Delete on New NZ Private Misc ",SCHDDESC
          APPEND    "Charges File",SCHDDESC
          RESET     SCHDDESC
          PACK      SCHDDATE,CCC,CYY,CMM,CDD
          REP       " 0",SCHDDATE
          CLOCK     TIME,SCHDTIME
.
.         Write Keyin parameters for Extract
.
          MOVE      TWENTY3,KEYSTARR[1]      * Option 23 Global Delete new file
          MOVE      NZMCH001,KEYSTARR[2]     * Hospital
          MOVE      NZMCH002,KEYSTARR[3]     * Claim Code
          MOVE      NZMCH003,KEYSTARR[4]     * Health Fund
          MOVE      NZMCH004,KEYSTARR[5]     * Table
          MOVE      NZMCH005,KEYSTARR[6]     * Charge Code
          MOVE      NZMCH018,KEYSTARR[7]     * Active/Inactive flag
.
          UNPACK    NZMCH006,CCENT,CYEAR,CMON,CDAY
          PACK      KEYSTARR[8],CDAY,CMON,CCENT,CYEAR     * Effective Date
.
          UNPACK    NZMCH019,CCENT,CYEAR,CMON,CDAY
          PACK      KEYSTARR[9],CDAY,CMON,CCENT,CYEAR     * Effective End Date
.
          MOVE      ANSY,KEYSTARR[10]        * Yes to Update
          MOVE      SP70,KEYSTARR[11]        * Enter
          MOVE      "11",KEYSTCNT            * Number of Keyins
.
          CALL      SCHPRO00   * Schedule Extract
.
DNZM9999  RETURN
.
.--------------------------------------------------------------------------
.*                             KNZM0000                                   *
.* Schedule Generate Default NZ Private Misc Charge Item Keyword file     *
.* from GENERMKI                                                          *
.--------------------------------------------------------------------------
KNZM0000  MOVE      "GENERMKI",SCHDPGID
          CLEAR     SCHDDESC
          APPEND    "NZ Private Misc Charge - ",SCHDDESC
          APPEND    "Generate Default Keyword file",SCHDDESC
          RESET     SCHDDESC
          PACK      SCHDDATE,CCC,CYY,CMM,CDD
          REP       " 0",SCHDDATE
          CLOCK     TIME,SCHDTIME
.
.         Write Keyin parameters
.
          MOVE      ANSY,KEYSTARR[1]         * Yes to generate keyword file
          MOVE      SP10,KEYSTARR[2]         * Enter
          MOVE      TWO,KEYSTCNT             * Number of Keyins
.
          CALL      SCHPRO00   * Schedule Extract
.
KNZM9999  RETURN
.
.--------------------------------------------------------------------------
.*                             INZM0000                                   *
.* Schedule Global update on new NZ priv misc charge file from IBSRSH12   *
.--------------------------------------------------------------------------
INZM0000  MOVE      "IBARSH12",SCHDPGID
          CLEAR     SCHDDESC
          APPEND    "Global Update on New NZ Private Misc ",SCHDDESC
          APPEND    "Charges File",SCHDDESC
          RESET     SCHDDESC 
          PACK      SCHDDATE,CCC,CYY,CMM,CDD
          REP       " 0",SCHDDATE
          CLOCK     TIME,SCHDTIME
.         
.         Write Keyin parameters
.
          MOVE      TWENTY4,KEYSTARR[1]      * Option 24 Global Upd new file
          MOVE      NZMCH001,KEYSTARR[2]     * Hospital
          MOVE      NZMCH002,KEYSTARR[3]     * Claim Code
          MOVE      NZMCH003,KEYSTARR[4]     * Health Fund
          MOVE      NZMCH004,KEYSTARR[5]     * Table
          MOVE      NZMCH005,KEYSTARR[6]     * Charge Code
.
          UNPACK    NZMCH006,CCENT,CYEAR,CMON,CDAY
          PACK      KEYSTARR[7],CDAY,CMON,CCENT,CYEAR     * Effective Date
.
          MOVE      INCRFLAG,KEYSTARR[8]     * Increase Type
          MOVE      NZMCH010,KEYSTARR[9]     * Increase Amount
          MOVE      ANSY,KEYSTARR[10]        * Yes to Update
          MOVE      SP70,KEYSTARR[11]        * Enter
          MOVE      TEN1,KEYSTCNT            * Number of Keyins
.
          CALL      SCHPRO00   * Schedule Extract
.
INZM9999  RETURN
+
.------------------------------------------------------------------------------
. NZ Contract Funding Maintenance: Display,Add,Update,Delete
.------------------------------------------------------------------------------
NZPCFN00  RESET     UPDTTYPE
          MATCH     SP70,UPDTTYPE           * Display formaction
          GOTO      NZPCFN85 IF EQUAL
. 
          MATCH     "A",UPDTTYPE            * Add formaction
          GOTO      NZPCFN10 IF EQUAL
.         
          MATCH     "U",UPDTTYPE            * Update formaction
          GOTO      NZPCFN20 IF EQUAL
.         
          MATCH     "D",UPDTTYPE            * Delete formaction
          GOTO      NZPCFN30 IF EQUAL
.
          MATCH     "C",UPDTTYPE            * Create New File
          GOTO      NZPCFN40 IF EQUAL
.
          MATCH     "H",UPDTTYPE            * Health Fund Duplication
          GOTO      NZPCFN50 IF EQUAL
.
          MATCH     "E",UPDTTYPE            * Global Delete formaction
          GOTO      NZPCFN60 IF EQUAL
.
          MATCH     "G",UPDTTYPE            * Global Update formaction
          GOTO      NZPCFN70 IF EQUAL
.
          MATCH     "B",UPDTTYPE            * Add Doctor
          GOTO      NZPCFN75 IF EQUAL
.
          MATCH     "F",UPDTTYPE            * Remove Doctor Item
          GOTO      NZPCFN80 IF EQUAL
.
          GOTO      NZPCFN93
.
.   **********  ADD FORMACTION  **********
.
NZPCFN10  MATCH     "N",FILEFLAG
          GOTO      NZPCFN15 IF EQUAL
.
          PACK      KEY30,NZCFN001,NZCFN002,NZCFN003,NZCFN004,NZCFN005:
                          NZCFN006,SP70
          CALL      RDNZCFN1                 * Add into Current File
          COMPARE   ZERO,OVRCD
          GOTO      NZPCFN92 IF EQUAL
.
          CALL      MVNZCF00
.
          PACK      NZCFCDAT,CCC,CYY,CMM,CDD
          REP       " 0",NZCFCDAT                * Systen date
          CLOCK     TIME,NZCFCTIM                * System time
          MOVE      USERID,NZCFCUID              * web user id
          MOVE      SP70,NZCFUDAT
          MOVE      SP70,NZCFUTIM
          MOVE      SP70,NZCFUUID
.
          CALL      WRNZCFN1
          GOTO      NZPCFN98
.
NZPCFN15  PACK      KEY30,NZCFN001,NZCFN002,NZCFN003,NZCFN004,NZCFN005:
                          NZCFN006,SP70
          CALL      RDNZCF11                 * Add into New File
          COMPARE   ZERO,OVRCD
          GOTO      NZPCFN92 IF EQUAL
.
          CALL      MVNZCF00
.
          PACK      NZCFCDAT,CCC,CYY,CMM,CDD
          REP       " 0",NZCFCDAT                * Systen date
          CLOCK     TIME,NZCFCTIM                * System time
          MOVE      USERID,NZCFCUID              * web user id
          MOVE      SP70,NZCFUDAT
          MOVE      SP70,NZCFUTIM
          MOVE      SP70,NZCFUUID
.
          CALL      WRNZCF11
          GOTO      NZPCFN98
.
.   **********  UPDATE FORMACTION  **********
.
NZPCFN20  MATCH     "N",FILEFLAG
          GOTO      NZPCFN25 IF EQUAL
          PACK      KEY30,NZCFN001,NZCFN002,NZCFN003,NZCFN004,NZCFN005:
                          NZCFN006,SP70
          CALL      RDNZCFN1                 * Update into Current File
          BRANCH    OVRCD,NZPCFN91
.
          CALL      MVNZCF00
.
          PACK      NZCFUDAT,CCC,CYY,CMM,CDD
          REP       " 0",NZCFUDAT                * Systen date
          CLOCK     TIME,NZCFUTIM                * System time
          MOVE      USERID,NZCFUUID              * web user id
.
          CALL      UPNZCFN1
          GOTO      NZPCFN98
.
NZPCFN25  PACK      KEY30,NZCFN001,NZCFN002,NZCFN003,NZCFN004,NZCFN005:
                          NZCFN006,SP70
          CALL      RDNZCF11                 * Update into New File
          BRANCH    OVRCD,NZPCFN91
.
          CALL      MVNZCF00
.
          PACK      NZCFUDAT,CCC,CYY,CMM,CDD
          REP       " 0",NZCFUDAT                * Systen date
          CLOCK     TIME,NZCFUTIM                * System time
          MOVE      USERID,NZCFUUID              * web user id
.
          CALL      UPNZCF11
          GOTO      NZPCFN98
.
.   **********  DELETE FORMACTION  **********
.
NZPCFN30  PACK      KEY30,NZCFN001,NZCFN002,NZCFN003,NZCFN004,NZCFN005:
                          NZCFN006,SP70
          CALL      RDNZCF11                 * Delete from New File
          BRANCH    OVRCD,NZPCFN91
.
          CALL      DENZCF11
          GOTO      NZPCFN98
.
NZPCFN40  CALL      CNZC0000         * Schedule new file creation
          GOTO      NZPCFN99
.
NZPCFN50  CALL      HNZC0000         * Schedule health fund duplication
          GOTO      NZPCFN99
.
NZPCFN60  CALL      DNZC0000         * Schedule global deletion
          GOTO      NZPCFN99
.
NZPCFN70  CALL      UNZC0000         * Schedule Update New to Current
          GOTO      NZPCFN99
.
.   **********  ADD DOCTOR  **********
.
NZPCFN75  MATCH     "N",FILEFLAG
          GOTO      NZPCFN78 IF EQUAL
.
          PACK      KEY40,NZCFN001,NZCFN002,NZCFN003,NZCFN004,NZCFN005:
                          NZCFN006,MLCFN001,SP70
          CALL      RDMLCFN1
          BRANCH    OVRCD,NZPCFN79
          GOTO      NZPCFN99
.
NZPCFN78  PACK      KEY40,NZCFN001,NZCFN002,NZCFN003,NZCFN004,NZCFN005:
                          NZCFN006,MLCFN001,Z70
          CALL      RDMLCF11
          BRANCH    OVRCD,NZPCFN79
          GOTO      NZPCFN99
.
NZPCFN79  MOVE      MLCFN001,MLCFHCPC
          MOVE      NZCFN001,MLCFHOSP
          MOVE      NZCFN002,MLCFCLMC
          MOVE      NZCFN003,MLCFCNTR
          MOVE      NZCFN004,MLCFPROC
          MOVE      NZCFN005,MLCFSTYP
          MOVE      NZCFN006,MLCFSDAT
.
          MATCH     "N",FILEFLAG
          IF        @EQUAL
            CALL      RAMLCF11
            IF        OVRCD=1
              CALL      WRMLCF11
            ENDIF
          ELSE
            CALL      RAMLCFN1
            IF        OVRCD=1
              CALL      WRMLCFN1
            ENDIF
          ENDIF
.
          CALL      UDOCS000       * Update doctor specific flag with yes
          MOVE      ZERO,EXIT
          GOTO      NZPCFN99
.
.   **********  Delete Doctor Code  **********
.
NZPCFN80  PACK      KEY40,NZCFN001,NZCFN002,NZCFN003,NZCFN004,NZCFN005:
                          NZCFN006,MLCFN001,SP70
          MATCH     "N",FILEFLAG
          IF        @EQUAL
            CALL      RDMLCF11                * Update into New File
            BRANCH    OVRCD,NZPCFN99
            CALL      DEMLCF11
          ELSE
            CALL      RDMLCFN1                * Update into Current File
            BRANCH    OVRCD,NZPCFN99
            CALL      DEMLCFN1
          ENDIF
.
          CALL      RDOCS000       * Remoce doctor specific flag if required
          MOVE      ZERO,EXIT
          GOTO      NZPMSC99
.
.   **********  DISPLAY FORMACTION  **********
.
NZPCFN85  MOVE      ZERO,EXIT
          MATCH     "N",FILEFLAG
          GOTO      NZPCFN88 IF EQUAL
.
          PACK      KEY30,NZCFN001,NZCFN002,NZCFN003,NZCFN004,NZCFN005:
                          NZCFN006,SP70
          CALL      RDNZCFN1
          IF        OVRCD=1
            CALL      CLNZCF00
          ENDIF
          MATCH     SP70,MLCFN001
          IF        !@EQUAL
            PACK      KEY40,NZCFN001,NZCFN002,NZCFN003,NZCFN004,NZCFN005:
                            NZCFN006,MLCFN001,SP70
            CALL      RDMLCFN1
            IF        OVRCD=1
              MOVE      SP70,MLCFHCPC
            ENDIF
          ENDIF
          GOTO      NZPCFN90
.
NZPCFN88  PACK      KEY30,NZCFN001,NZCFN002,NZCFN003,NZCFN004,NZCFN005:
                          NZCFN006,SP70
          CALL      RDNZCF11
          IF        OVRCD=1
            CALL      CLNZCF00
          ENDIF
          MATCH     SP70,MLCFN001
          IF        !@EQUAL
            PACK      KEY40,NZCFN001,NZCFN002,NZCFN003,NZCFN004,NZCFN005:
                            NZCFN006,MLCFN001,SP70
            CALL      RDMLCF11
            IF        OVRCD=1
              MOVE      SP70,MLCFHCPC
            ENDIF
          ENDIF
          GOTO      NZPCFN90
.
NZPCFN90  CLEAR     WEBTITLE
          MOVE      "Casemix Funding Maintenance",WEBTITLE
          RESET     WEBTITLE
.
          CALL      WEBHED00   * Create Output File and Write HTML Page Header
          BRANCH    EXIT,NZPCFN99
          CALL      WEBBOD00   * Process Web Body
          CALL      WEBEND00   * Process End of HTML File
.
          MOVE      ONE,EXIT
          GOTO      NZPCFN99
.
NZPCFN91  MOVE      "Record does not exist",WEBTITLE
          CALL      WEBERR00
          MOVE      ONE,EXIT
          GOTO      NZPCFN99
.
NZPCFN92  MOVE      "Record already exists",WEBTITLE
          CALL      WEBERR00
          MOVE      ONE,EXIT
          GOTO      NZPCFN99
.
NZPCFN93  MOVE      "Invalid Form Action.",WEBTITLE
          CALL      WEBERR00
          MOVE      ONE,EXIT
          GOTO      NZPCFN99
.
NZPCFN98  MOVE      ZERO,EXIT
NZPCFN99  RETURN
.
.--------------------------------------------------------------------------
.*                             UDOCS000                                   *
.* Update nzpcfnaf doctor specific with yes when adding a doctor code     *
.--------------------------------------------------------------------------
UDOCS000  PACK      KEY30,MLCFHOSP,MLCFCLMC,MLCFCNTR,MLCFPROC,MLCFSTYP:
                          MLCFSDAT,SP70
.
          MATCH     "N",FILEFLAG
          IF        @EQUAL
            CALL      RDNZCF11
            BRANCH    OVRCD,UDOCS999
            MOVE      ONE,NZCFDOCS
            CALL      UPNZCF11
          ELSE
            CALL      RDNZCFN1
            BRANCH    OVRCD,UDOCS999
            MOVE      ONE,NZCFDOCS
            CALL      UPNZCFN1
          ENDIF
.
UDOCS999  RETURN
+
.--------------------------------------------------------------------------
.*                             RDOCS000                                   *
.* Remove nzpcfnaf doctor specific with if removing last doctor code      *
.--------------------------------------------------------------------------
RDOCS000  PACK      KEY30,MLCFHOSP,MLCFCLMC,MLCFCNTR,MLCFPROC,MLCFSTYP:
                          MLCFSDAT,SP70
.
          PACK      KEY40,MLCFHOSP,MLCFCLMC,MLCFCNTR,MLCFPROC,MLCFSTYP:
                          MLCFSDAT,SP70
          MATCH     "N",FILEFLAG
          IF        @EQUAL
            CALL      RSMLCF11
            CALL      RKMLCF11
            BRANCH    OVRCD,RDOCS100
          ELSE
            CALL      RSMLCFN1
            CALL      RKMLCFN1
            BRANCH    OVRCD,RDOCS100
          ENDIF
.
          PACK      SKEY30,MLCFHOSP,MLCFCLMC,MLCFCNTR,MLCFPROC,MLCFSTYP:
                           MLCFSDAT,SP70
.
          MATCH     SKEY30,KEY30
          GOTO      RDOCS999 IF EQUAL
.
RDOCS100  MATCH     "N",FILEFLAG
          IF        @EQUAL
            CALL      RDNZCF11
            BRANCH    OVRCD,UDOCS999
            MOVE      ZERO,NZCFDOCS
            CALL      UPNZCF11
          ELSE
            CALL      RDNZCFN1
            BRANCH    OVRCD,UDOCS999
            MOVE      ZERO,NZCFDOCS
            CALL      UPNZCFN1
          ENDIF
.
RDOCS999  RETURN
+
.--------------------------------------------------------------------------
.*                             CNZC0000                                   *
.*   Schedule creation of new NZ Private Contract Funding from IBARSH12   *
.--------------------------------------------------------------------------
CNZC0000  MOVE      "IBARSH12",SCHDPGID
          MOVE      "Create New NZ Private Contract Funding File",SCHDDESC
          PACK      SCHDDATE,CCC,CYY,CMM,CDD
          REP       " 0",SCHDDATE
          CLOCK     TIME,SCHDTIME
.
.         Write Keyin parameters for Extract
.
          MOVE      TWENTY5,KEYSTARR[1]      * Option 25 Create New File
          MOVE      ANSY,KEYSTARR[2]         * Yes to create new file
          MOVE      COPYFLAG,KEYSTARR[3]     * Start with a copy of current data
.
          MATCH     ANSY,COPYFLAG
          IF        @EQUAL
            MOVE      SP70,KEYSTARR[4]       * Enter
            MOVE      FOUR,KEYSTCNT          * Number of Keyins
          ELSE
            MOVE      ANSY,KEYSTARR[4]       * Yes start with a empty file
            MOVE      SP70,KEYSTARR[5]       * Enter
            MOVE      FIVE,KEYSTCNT          * Number of Keyins
          ENDIF
.
          CALL      SCHPRO00   * Schedule Extract
.
CNZC9999  RETURN
.
.------------------------------------------------------------------------------
.*                             HNZC0000                                       *
.*   Schedule Duplication on new NZ Private Contract funding                  *
.*   File from IBARSH12                                                       *
.------------------------------------------------------------------------------
HNZC0000  MOVE      "IBARSH12",SCHDPGID
          CLEAR     SCHDDESC
          APPEND    "Duplication on New NZ ",SCHDDESC
          APPEND    "Private Contract Funding File",SCHDDESC
          RESET     SCHDDESC
          PACK      SCHDDATE,CCC,CYY,CMM,CDD
          REP       " 0",SCHDDATE
          CLOCK     TIME,SCHDTIME
.
.         Write Keyin parameters for Extract
.
          MOVE      TWENTY6,KEYSTARR[1]      * Option 26 Dup new file
          MOVE      NZCFN001,KEYSTARR[2]     * Hospital
          MOVE      NZCFN002,KEYSTARR[3]     * Claim Code
          MOVE      NZCFN003,KEYSTARR[4]     * Contract      
          MOVE      NZCFN004,KEYSTARR[5]     * Contract Procedure Code
          MOVE      NZCFN005,KEYSTARR[6]     * Start Type

          UNPACK    NZCFN006,CCENT,CYEAR,CMON,CDAY
          PACK      KEYSTARR[7],CDAY,CMON,CCENT,CYEAR     * Effective Date
.
          MOVE      CPCFN001,KEYSTARR[8]     * Copy to Hospital
          MOVE      CPCFN002,KEYSTARR[9]     * Copy to Claim Code
          MOVE      CPCFN003,KEYSTARR[10]    * Copy to Contract
          MOVE      CPCFN004,KEYSTARR[11]    * Copy to Contract Procedure Code
          MOVE      CPCFN005,KEYSTARR[12]    * Copy to Start Type
.
          UNPACK    CPCFN006,CCENT,CYEAR,CMON,CDAY
          PACK      KEYSTARR[13],CDAY,CMON,CCENT,CYEAR  * Copy to Start Date
.
          MOVE      ANSY,KEYSTARR[14]        * Yes to Update
          MOVE      SP70,KEYSTARR[15]        * Enter
          MOVE      TEN5,KEYSTCNT            * Number of Keyins

          CALL      SCHPRO00   * Schedule Extract
.
HNZC9999  RETURN
.
.------------------------------------------------------------------------------
.*                             DNZC0000                                       *
.*   Schedule Global Delete on new NZ Private Contract Funding File           *
.*   from IBARSH12                                                            *
.------------------------------------------------------------------------------
DNZC0000  MOVE      "IBARSH12",SCHDPGID
          CLEAR     SCHDDESC
          APPEND    "Global Delete on New NZ Private Contract ",SCHDDESC
          APPEND    "Funding File",SCHDDESC
          RESET     SCHDDESC
          PACK      SCHDDATE,CCC,CYY,CMM,CDD
          REP       " 0",SCHDDATE
          CLOCK     TIME,SCHDTIME
.
.         Write Keyin parameters for Extract
.
          MOVE      TWENTY7,KEYSTARR[1]      * Option 27 Global Delete new file
          MOVE      NZCFN001,KEYSTARR[2]     * Hospital
          MOVE      NZCFN002,KEYSTARR[3]     * Claim Code
          MOVE      NZCFN003,KEYSTARR[4]     * Contract    
          MOVE      NZCFN004,KEYSTARR[5]     * Contract Proc
          MOVE      NZCFN005,KEYSTARR[6]     * Start Type
.
          UNPACK    NZCFN006,CCENT,CYEAR,CMON,CDAY
          PACK      KEYSTARR[7],CDAY,CMON,CCENT,CYEAR     * Start Date
.
          MOVE      ANSY,KEYSTARR[8]         * Yes to Update
          MOVE      SP70,KEYSTARR[9]         * Enter
          MOVE      NINE,KEYSTCNT            * Number of Keyins
.
          CALL      SCHPRO00   * Schedule Extract
.
DNZC9999  RETURN
.
.------------------------------------------------------------------------------
.*                             UNZC0000                                       *
.*   Schedule Update of new to Current NZ Private Contract Funding File       *
.*   from IBARSH12                                                            *
.------------------------------------------------------------------------------
UNZC0000  MOVE      "IBARSH12",SCHDPGID
          CLEAR      SCHDDESC
          APPEND    "Update New to Current NZ Private Contract ",SCHDDESC
          APPEND    "Funding File",SCHDDESC
          RESET     SCHDDESC
          PACK      SCHDDATE,CCC,CYY,CMM,CDD
          REP       " 0",SCHDDATE
          CLOCK     TIME,SCHDTIME
.
.         Write Keyin parameters for Extract
.
          MOVE      TWENTY8,KEYSTARR[1]      * Option 28 Update New to Current
          MOVE      ANSY,KEYSTARR[2]         * Yes to Update
          MOVE      SP70,KEYSTARR[3]         * Enter
          MOVE      THREE,KEYSTCNT           * Number of Keyins
.
          CALL      SCHPRO00   * Schedule Extract
.
UNZC9999  RETURN
.
.------------------------------------------------------------------------------
. NZ Priv Related Provider Type Maintenance: Display,Add,Update,Delete
.------------------------------------------------------------------------------
NZPPTY00  RESET     UPDTTYPE
          MATCH     SP70,UPDTTYPE           * Display formaction
          GOTO      NZPPTY85 IF EQUAL
.
          MATCH     "A",UPDTTYPE            * Add formaction
          GOTO      NZPPTY10 IF EQUAL
.
          MATCH     "U",UPDTTYPE            * Update formaction
          GOTO      NZPPTY20 IF EQUAL
.
          MATCH     "D",UPDTTYPE            * Delete formaction
          GOTO      NZPPTY30 IF EQUAL
.
          GOTO      NZPPTY93
.
.   **********  ADD FORMACTION  **********
.
NZPPTY10  PACK      KEY3,NZPTY001,SP70
          CALL      RDNZPTY1                 * Add into Current File
          COMPARE   ZERO,OVRCD
          GOTO      NZPPTY92 IF EQUAL
.
          CALL      MVNZPT00
.
          PACK      NZPTCDAT,CCC,CYY,CMM,CDD
          REP       " 0",NZPTCDAT                * Systen date
          CLOCK     TIME,NZPTCTIM                * System time
          MOVE      USERID,NZPTCUID              * web user id
          MOVE      SP70,NZPTUDAT
          MOVE      SP70,NZPTUTIM
          MOVE      SP70,NZPTUUID
.
          CALL      WRNZPTY1
.
          MOVE      ZERO,EXIT
          GOTO      NZPPTY99
.
.   **********  UPDATE FORMACTION  **********
.
NZPPTY20  PACK      KEY3,NZPTY001,SP70
          CALL      RDNZPTY1                 * Update into Current File
          BRANCH    OVRCD,NZPPTY91
.
          CALL      MVNZPT00
.
          PACK      NZPTUDAT,CCC,CYY,CMM,CDD
          REP       " 0",NZPTUDAT                * Systen date
          CLOCK     TIME,NZPTUTIM                * System time
          MOVE      USERID,NZPTUUID              * web user id
.
          CALL      UPNZPTY1
.
          MOVE      ZERO,EXIT
          GOTO      NZPPTY99
.
.   **********  DELETE FORMACTION  **********
.
NZPPTY30  PACK      KEY3,NZPTY001,SP70
          CALL      RDNZPTY1                 * Delete from New File
          BRANCH    OVRCD,NZPPTY91
.
          CALL      DENZPTY1
.
          MOVE      ZERO,EXIT
          GOTO      NZPPTY99
.
.
.   **********  DISPLAY FORMACTION  **********
.
NZPPTY85  PACK      KEY3,NZPTY001,SP70
          CALL      RDNZPTY1
          IF        OVRCD=1
            CALL      CLNZPT00
          ENDIF
.
          CLEAR     WEBTITLE
          MOVE      "Related Provider Type Maintenance",WEBTITLE
          RESET     WEBTITLE
.
          CALL      WEBHED00   * Create Output File and Write HTML Page Header
          BRANCH    EXIT,NZPPTY99
          CALL      WEBBOD00   * Process Web Body
          CALL      WEBEND00   * Process End of HTML File
.
          MOVE      ONE,EXIT
          GOTO      NZPPTY99
.
NZPPTY91  MOVE      "Record does not exist",WEBTITLE
          CALL      WEBERR00
          MOVE      ONE,EXIT
          GOTO      NZPPTY99
.
NZPPTY92  MOVE      "Record already exists",WEBTITLE
          CALL      WEBERR00
          MOVE      ONE,EXIT
          GOTO      NZPPTY99
.
NZPPTY93  MOVE      "Invalid Form Action.",WEBTITLE
          CALL      WEBERR00
          MOVE      ONE,EXIT
          GOTO      NZPPTY99
.
NZPPTY99  RETURN
.
.------------------------------------------------------------------------------
. Billing Fees Update
.------------------------------------------------------------------------------
BILFEE00  RESET     UPDTTYPE
.
          MATCH     SP70,UPDTTYPE           * Display formaction
          GOTO      BILFEE80 IF EQUAL
.
          MATCH     "G",UPDTTYPE            * Bed fees Global Update formaction
          GOTO      BILFEE10 IF EQUAL
.
          MATCH     "T",UPDTTYPE            * Theatre fees Global Update
          GOTO      BILFEE20 IF EQUAL
.
          GOTO      BILFEE93
.
BILFEE10  MOVE      ZERO,OVRCD
          TRAP      OVERCOND IF IO
          OPEN      JHSBF1A1,"newbfeaf"
          TRAPCLR   IO
          BRANCH    OVRCD,BILFEE94
.
          CALL      LCKBF000                * Check if Locked
          BRANCH    EXIT,BILFEE99
.
          PACK      PTCNWBFE,USERID,SP10
          WRITAB    CONTROLF,HUND10;*11,PTCNWBFE
.
          CALL      SUPD0000                * Schedule bed fee update
.
          PACK      PTCNBFEM,ZERO,ZERO
          WRITAB    CONTROLF,SEVENTY9;*3,PTCNBFEM
          MOVE      SP10,PTCNWBFE
          WRITAB    CONTROLF,HUND10;*11,PTCNWBFE
.
          GOTO      BILFEE99
.
BILFEE20  MOVE      ZERO,OVRCD
          TRAP      OVERCOND IF IO
          OPEN      JHSTF1A1,"newtfeaf"
          TRAPCLR   IO
          BRANCH    OVRCD,BILFEE94
.
          CALL      LCKTF000                * Check if Locked
          BRANCH    EXIT,BILFEE99
.
          PACK      PTCNWTFE,USERID,SP10
          WRITAB    CONTROLF,HUND10;*1,PTCNWTFE
.
          CALL      STFRP000        * Schedule Replace Current with New File
.
          PACK      PTCNTFEM,ZERO,ZERO
          WRITAB    CONTROLF,SEVENTY9;*1,PTCNTFEM
          MOVE      SP10,PTCNWTFE
          WRITAB    CONTROLF,HUND10;*1,PTCNWTFE
.
          GOTO      BILFEE99
.
BILFEE80  MOVE      ZERO,EXIT
.
          CLEAR     WEBTITLE
          MOVE      "Billing Fees Update",WEBTITLE
          RESET     WEBTITLE
.
          CALL      WEBHED00   * Create Output File and Write HTML Page Header
          BRANCH    EXIT,BILFEE99
          CALL      WEBBOD00   * Process Web Body
          CALL      WEBEND00   * Process End of HTML File
.
          MOVE      ONE,EXIT
          GOTO      BILFEE99
.
BILFEE93  MOVE      "Invalid Form Action.",WEBTITLE
          CALL      WEBERR00
          MOVE      ONE,EXIT
          GOTO      BILFEE99
.
BILFEE94  MOVE      "No New File.File Must be Created First.",WEBTITLE
          CALL      WEBERR00
          MOVE      ONE,EXIT
          GOTO      BILFEE99
.
BILFEE98  MOVE      ZERO,EXIT
BILFEE99  RETURN
.
.------------------------------------------------------------------------------
. Bed Fee Mapping
.------------------------------------------------------------------------------
BFEMAP00  RESET     UPDTTYPE
.
          MATCH     SP70,UPDTTYPE           * Display formaction
          GOTO      BFEMAP80 IF EQUAL
.
          MATCH     "U",UPDTTYPE
          GOTO      BFEMAP70 IF EQUAL
.
          MATCH     "A",UPDTTYPE
          GOTO      BFEMAP60 IF EQUAL
.
          MATCH     "S",UPDTTYPE
          GOTO      BFEMAP50 IF EQUAL
.
          GOTO      BFEMAP93
.
BFEMAP50  CALL      ALLSRC00
.
          MOVE      ZERO,EXIT
          GOTO      BFEMAP99
.
BFEMAP60  CALL      ALLCID00
.
          MOVE      ZERO,EXIT
          GOTO      BFEMAP99
.
BFEMAP70  CALL      ALLUSD00
.
          MOVE      ZERO,EXIT
          GOTO      BFEMAP99
.
BFEMAP80  CLEAR     WEBTITLE
          MOVE      "Bed Fee Mapping",WEBTITLE
          RESET     WEBTITLE
.
          CALL      WEBHED00   * Create Output File and Write HTML Page Header
          BRANCH    EXIT,BFEMAP99
          CALL      WEBBOD00   * Process Web Body
          CALL      WEBEND00   * Process End of HTML File
.
          MOVE      ONE,EXIT
          GOTO      BFEMAP99
.
BFEMAP93  MOVE      "Invalid Form Action.",WEBTITLE
          CALL      WEBERR00
          MOVE      ONE,EXIT
          GOTO      BFEMAP99
.
BFEMAP99  RETURN
+
.--------------------------------------------------------------------------
. Bed Fee Mapping Tags
.--------------------------------------------------------------------------
BFMP0000  BRANCH    FLDITMNO,BFMP0100,BFMP0200,BFMP0300,BFMP0400,BFMP0500:
                             BFMP0600,BFMP0700,BFMP0800,BFMP0900
          GOTO      BFMP9999
.
BFMP0100  CALL      BFMT0000
          GOTO      BFMP9999
.
BFMP0200  MOVE      "CL",CATEGORY
          MOVE      BDFEE001,CODE
          CALL      CODITM00
          GOTO      BFMP9999
.
BFMP0300  UNPACK    DIM127,D1,KEY1,DIM127
          MOVE      KEY1,F1
          BRANCH    F1,BFMP0310
          WRITE     HTMLFILE;BDFEE002;
          GOTO      BFMP9999
.
BFMP0310  MATCH     SP70,BDFEE002
          GOTO      BFMP9999 IF EQUAL
          PACK      KEY14,BDFEE002,SP70
          CALL      RDSFUND1
          CALL      RDKFUND1
          BRANCH    OVRCD,BFMP9999
          WRITE     HTMLFILE;HFNAME;
          GOTO      BFMP9999
.
BFMP0400  MOVE      "A ",CATEGORY
          MOVE      BDFEE004,CODE
          CALL      CODITM00
          GOTO      BFMP9999
.
BFMP0500  CALL      NEXTBM00
          GOTO      BFMP9999
.
BFMP0600  CALL      PREVBM00
          GOTO      BFMP9999
.
BFMP0700  WRITE     HTMLFILE;STARTNUM;
          GOTO      BFMP9999
.
BFMP0800  WRITE     HTMLFILE;NORECORD;
          GOTO      BFMP9999
.
BFMP0900  WRITE     HTMLFILE;BDFEE016;
          GOTO      BFMP9999
.
BFMP9999  RETURN
+
.------------------------------------------------------------
. Table of Bed Fee File Details
.------------------------------------------------------------
BFMT0000  IF        NORECORD=0
            MOVE      "20",NORECORD       * Set Default No Records to Display
          ENDIF
          MOVE      ZERO,RECNUMB
          MOVE      ZERO,DISNUMB
.
          MATCH     SP70,BDFEE001
          GOTO      BFMT9999 IF EQUAL
.
          MATCH     "1",BDFEE016
          IF        @EQUAL
            PACK      KEY18,SP6,BDFEE001,BDFEE002,BDFEE004,SP70
            CALL      RDPTMBF4
          ELSE
            PACK      KEY12,BDFEE001,BDFEE002,BDFEE004,SP70            * Current
            CALL      RDPTMBF1                                         * File
          ENDIF
          COMPARE   ZERO,OVRCD
          GOTO      BFMT0020 IF EQUAL
.
          MATCH     "1",BDFEE016
          IF        @EQUAL
            PACK      KEY18,SP6,BDFEE001,BDFEE002,BDFEE004,SP70
            CALL      RSPTMBF4
          ELSE
            PACK      KEY12,BDFEE001,BDFEE002,BDFEE004,SP70            * Current
            CALL      RSPTMBF1                                         * File
          ENDIF
.
BFMT0005  MATCH     "1",BDFEE016
          IF        @EQUAL
            CALL      RKPTMBF4
          ELSE
            CALL      RKPTMBF1                                         * Current
          ENDIF
          BRANCH    OVRCD,BFMT9999                                   * File
.
BFMT0020  MATCH     "1",BDFEE016
          IF        @EQUAL
            MATCH     SP70,PTMBCNTR
            GOTO      BFMT9999 IF NOT EQUAL
          ENDIF
.
          MATCH     BDFEE001,PTMBCLAM       * Mandatory, should not be spaces
          GOTO      BFMT9999 IF NOT EQUAL
.
          MATCH     BDFEE002,PTMBHFND       * Match for spaces as this is valid
          GOTO      BFMT9999 IF NOT EQUAL
.
          MATCH     SP70,BDFEE004
          IF        !@EQUAL
            MATCH     BDFEE004,PTMBATYP
            GOTO      BFMT9999 IF NOT EQUAL
          ENDIF
.
          ADD       ONE,RECNUMB
          IF        STARTNUM>=RECNUMB
            GOTO      BFMT0005
          ENDIF
.
          CALL      BFTR0000
          ADD       ONE,DISNUMB
          COMPARE   NORECORD,DISNUMB
          IF        !@EQUAL
            GOTO      BFMT0005
          ENDIF
.
BFMT9999  RETURN
.------------------------------------------------------------
. Bed Fee Mapping File Table (TABLE ROW)
.------------------------------------------------------------
BFTR0000  MOVE      "A ",CATEGORY
          MOVE      PTMBATYP,CODE
          CALL      GETCOD00
.
          WRITE     HTMLFILE;"<tr>":
                             "  <td>&nbsp;",PTMBCLAM,"</td>":
                             "  <td>&nbsp;",PTMBHFND,"</td>";
.
BFTR5000  MATCH     SP70,TDESC
          IF        @EQUAL | @EOS
            WRITE     HTMLFILE;"  <td>&nbsp;",PTMBATYP,"</td>";
          ELSE
            WRITE     HTMLFILE;"  <td>&nbsp;",TDESC,"</td>";
          ENDIF
.
          MOVE      SP70,DIM5
          MOVE      ZERO,FORM5
          MOVE      DISNUMB,FORM5
          ADD       ONE,FORM5
          MOVE      FORM5,DIM5
          REP       " 0",DIM5
.
          MATCH     SP70,PTMBUSID
          IF        @EQUAL | @EOS
            WRITE     HTMLFILE;"  <td>&nbsp;",PTMBCNTR,"</td>":
                          "  <td>&nbsp;<input type=checkbox name=d_uid",DIM5:
                          " value=1 onclick=updateAllocMap();>"
          ELSE
            WRITE     HTMLFILE;"  <td>&nbsp;",PTMBCNTR,"</td>":
                          "  <td>&nbsp;<input type=checkbox name=d_uid",DIM5:
                          " value=1 onclick=updateAllocMap(); checked>"
          ENDIF
.
          WRITE     HTMLFILE;"<input type=hidden name=uid",DIM5,">":
                    "<input type=hidden name=clm",DIM5," value=",PTMBCLAM,">":
                    "<input type=hidden name=hfn",DIM5," value=",PTMBHFND,">":
                    "<input type=hidden name=atp",DIM5," value=",PTMBATYP,">":
                    "  </td>":
                    "</tr>"
.
BFTR9999 RETURN
.-------------------------------------------------------------------------
. Link to Next Fees Mapping
.-------------------------------------------------------------------------
NEXTBM00  MOVE      NORECORD,KEY2
          REP       " +",KEY2
          ASSIGN    STARTNUM+NORECORD,F3
          MOVE      F3,KEY3
          REP       " +",KEY3
          UNPACK    DIM127,D1,FLDPARA,DIM127
          MOVE      REPORTNO,F2
.
          REP       " +",BDFEE001
          REP       " +",BDFEE002
          REP       " +",BDFEE004
          REP       " +",BDFEE016
.
          WRITE     HTMLFILE;"patweb77.pbl":
                                 "?reportno=",F2:
                                 "&template=",FLDPARA:
                                 "&startnum=",KEY3:
                                 "&norecord=",KEY2:
                                 "&bdfee001=",BDFEE001:
                                 "&bdfee002=",BDFEE002:
                                 "&bdfee004=",BDFEE004:
                                 "&bdfee016=",BDFEE016;
.
          REP       "+ ",BDFEE001
          REP       "+ ",BDFEE002
          REP       "+ ",BDFEE004
          REP       "+ ",BDFEE016
.
NEXTBM99  RETURN
.
.-------------------------------------------------------------
. Link to Prev Fees Mapping
.-------------------------------------------------------------
PREVBM00  MOVE      NORECORD,KEY2
          REP       " +",KEY2
          ASSIGN    STARTNUM-NORECORD,F3
          IF        F3<0
            MOVE      ZERO,F3
          ENDIF
          MOVE      F3,KEY3
          REP       " +",KEY3
          UNPACK    DIM127,D1,FLDPARA,DIM127
          MOVE      REPORTNO,F2
.
          REP       " +",BDFEE001
          REP       " +",BDFEE002
          REP       " +",BDFEE004
          REP       " +",BDFEE016
.
          WRITE     HTMLFILE;"patweb77.pbl":
                                 "?reportno=",F2:
                                 "&template=",FLDPARA:
                                 "&startnum=",KEY3:
                                 "&norecord=",KEY2:
                                 "&bdfee001=",BDFEE001:
                                 "&bdfee002=",BDFEE002:
                                 "&bdfee004=",BDFEE004:
                                 "&bdfee016=",BDFEE016;
.
          REP       "+ ",BDFEE001
          REP       "+ ",BDFEE002
          REP       "+ ",BDFEE004
          REP       "+ ",BDFEE016
.
PREVBM99  RETURN
+
.------------------------------------------------------------
. Set parameters for User ID / Allocation Indicator
.------------------------------------------------------------
STUID000  MOVE      ZERO,EXIT
          UNPACK    QRYNAME,KEY5,KEY3
          MOVE      KEY3,F3
          RESET     QRYDATA
          MATCH     SP70,QRYDATA
          GOTO      STUID999 IF EQUAL
          MOVE      QRYDATA,MBFUID[F3]
STUID999  RETURN
+
.------------------------------------------------------------
. Set parameters for Claim Type
.------------------------------------------------------------
STCLM000  MOVE      ZERO,EXIT
          UNPACK    QRYNAME,KEY5,KEY3
          MOVE      KEY3,F3
          RESET     QRYDATA
          MATCH     SP70,QRYDATA
          GOTO      STCLM999 IF EQUAL
          MOVE      QRYDATA,MBFCLM[F3]
STCLM999  RETURN
+
.------------------------------------------------------------
. Set parameters for Health Fund
.------------------------------------------------------------
STHFN000  MOVE      ZERO,EXIT
          UNPACK    QRYNAME,KEY5,KEY3
          MOVE      KEY3,F3
          RESET     QRYDATA
          MATCH     SP70,QRYDATA
          GOTO      STHFN999 IF EQUAL
          MOVE      QRYDATA,MBFHFN[F3]
STHFN999  RETURN
+
.------------------------------------------------------------
. Set parameters for Admission Type
.------------------------------------------------------------
STATP000  MOVE      ZERO,EXIT
          UNPACK    QRYNAME,KEY5,KEY3
          MOVE      KEY3,F3
          RESET     QRYDATA
          MATCH     SP70,QRYDATA
          GOTO      STATP999 IF EQUAL
          MOVE      QRYDATA,MBFATP[F3]
STATP999  RETURN
+
.------------------------------------------------------------
. Mark patmbfaf record for contract id allocation
.------------------------------------------------------------
ALLUSD00  MOVE      ONE,F2
          WHILE     F2 <= 20
.
            PACK      MBFCLM[F2],MBFCLM[F2],SP70
            PACK      MBFHFN[F2],MBFHFN[F2],SP70
            PACK      MBFATP[F2],MBFATP[F2],SP70
            PACK      MBFUID[F2],MBFUID[F2],SP70
.
            PACK      KEY12,MBFCLM[F2],MBFHFN[F2],MBFATP[F2],SP70
            CALL      RDPTMBF1
            IF        OVRCD=0
              MATCH     "1",MBFUID[F2]
              IF        @EQUAL
                MOVE      WBSEUID,PTMBUSID
              ELSE
                MOVE      SP70,PTMBUSID
              ENDIF
.
              CALL    UPPTMBF1
.
            ENDIF
.
            ADD       ONE,F2
          DO
.
          ENDSET    REDIRECT
.
          APPEND    "&startnum=",REDIRECT
          APPEND    STARTNUM,REDIRECT
.
          APPEND    "&norecord=",REDIRECT
          APPEND    NORECORD,REDIRECT
.
          MATCH     SP70,BDFEE001
          IF        !@EQUAL & !@EOS
            APPEND    "&bdfee001=",REDIRECT
            APPEND    BDFEE001,REDIRECT
          ENDIF
.
          MATCH     SP70,BDFEE002
          IF        !@EQUAL & !@EOS
            APPEND    "&bdfee002=",REDIRECT
            APPEND    BDFEE002,REDIRECT
          ENDIF
.
          MATCH     SP70,BDFEE004
          IF        !@EQUAL & !@EOS
            APPEND    "&bdfee004=",REDIRECT
            APPEND    BDFEE004,REDIRECT
          ENDIF
.
          MATCH     SP70,BDFEE016
          IF        !@EQUAL & !@EOS
            APPEND    "&bdfee016=",REDIRECT
            APPEND    BDFEE016,REDIRECT
          ENDIF
.
ALLUSD99  RETURN
+
.------------------------------------------------------------
. Alocate New Contract ID to patmbfaf
.------------------------------------------------------------
ALLCID00  PACK      KEY12,SP70
          CALL      RSPTMBF1
ALLCID10  CALL      RKPTMBF1
          BRANCH    OVRCD,ALLCID90
.
          MATCH     SP70,PTMBUSID
          IF        !@EQUAL & !@EOS
            MATCH     WBSEUID,PTMBUSID
            IF        @EQUAL
              MOVE      SP70,PTMBUSID
              MOVE      ALLOCCID,PTMBCNTR 
              CALL      UPPTMBF1
            ENDIF
          ENDIF
.
.
          GOTO      ALLCID10
.
ALLCID90  ENDSET    REDIRECT
.
          APPEND    "&startnum=",REDIRECT
          APPEND    STARTNUM,REDIRECT
.
          APPEND    "&norecord=",REDIRECT
          APPEND    NORECORD,REDIRECT
.
          MATCH     SP70,BDFEE001
          IF        !@EQUAL & !@EOS
            APPEND    "&bdfee001=",REDIRECT
            APPEND    BDFEE001,REDIRECT
          ENDIF
.
          MATCH     SP70,BDFEE002
          IF        !@EQUAL & !@EOS
            APPEND    "&bdfee002=",REDIRECT
            APPEND    BDFEE002,REDIRECT
          ENDIF
.
          MATCH     SP70,BDFEE004
          IF        !@EQUAL & !@EOS
            APPEND    "&bdfee004=",REDIRECT
            APPEND    BDFEE004,REDIRECT
          ENDIF
.
          MATCH     SP70,BDFEE016
          IF        !@EQUAL & !@EOS
            APPEND    "&bdfee016=",REDIRECT
            APPEND    BDFEE016,REDIRECT
          ENDIF
.
ALLCID99  RETURN
+
.------------------------------------------------------------
. Clear out patmbfaf contract ids on a new search
.------------------------------------------------------------
ALLSRC00  PACK      KEY12,SP70
          CALL      RSPTMBF1
ALLSRC10  CALL      RKPTMBF1
          BRANCH    OVRCD,ALLSRC90
.
          MATCH     SP70,PTMBUSID
          IF        !@EQUAL & !@EOS
            MATCH     WBSEUID,PTMBUSID
            IF        @EQUAL
              MOVE      SP70,PTMBUSID
              CALL      UPPTMBF1
            ENDIF
          ENDIF
.
          GOTO      ALLSRC10
.
ALLSRC90  ENDSET    REDIRECT
.
          APPEND    "&startnum=",REDIRECT
          APPEND    STARTNUM,REDIRECT
.
          APPEND    "&norecord=",REDIRECT
          APPEND    NORECORD,REDIRECT
.
          MATCH     SP70,BDFEE001
          IF        !@EQUAL & !@EOS
            APPEND    "&bdfee001=",REDIRECT
            APPEND    BDFEE001,REDIRECT
          ENDIF
.
          MATCH     SP70,BDFEE002
          IF        !@EQUAL & !@EOS
            APPEND    "&bdfee002=",REDIRECT
            APPEND    BDFEE002,REDIRECT
          ENDIF
.
          MATCH     SP70,BDFEE004
          IF        !@EQUAL & !@EOS
            APPEND    "&bdfee004=",REDIRECT
            APPEND    BDFEE004,REDIRECT
          ENDIF
.
          MATCH     SP70,BDFEE016
          IF        !@EQUAL & !@EOS
            APPEND    "&bdfee016=",REDIRECT
            APPEND    BDFEE016,REDIRECT
          ENDIF
.
ALLSRC99  RETURN
+
.------------------------------------------------------------------------------
. Bed Fee Mapping
.------------------------------------------------------------------------------
TFEMAP00  RESET     UPDTTYPE
.
          MATCH     SP70,UPDTTYPE           * Display formaction
          GOTO      TFEMAP80 IF EQUAL
.
          MATCH     "U",UPDTTYPE
          GOTO      TFEMAP70 IF EQUAL
.
          MATCH     "A",UPDTTYPE
          GOTO      TFEMAP60 IF EQUAL
.
          MATCH     "S",UPDTTYPE
          GOTO      TFEMAP50 IF EQUAL
.
          GOTO      TFEMAP93
.
TFEMAP50  CALL      ALLSRT00
.
          MOVE      ZERO,EXIT
          GOTO      TFEMAP99
.
TFEMAP60  CALL      ALLCIT00
.
          MOVE      ZERO,EXIT
          GOTO      TFEMAP99
.
TFEMAP70  CALL      ALLUST00
.
          MOVE      ZERO,EXIT
          GOTO      TFEMAP99
.
TFEMAP80  CLEAR     WEBTITLE
          MOVE      "Theatre Fee Mapping",WEBTITLE
          RESET     WEBTITLE
.
          CALL      WEBHED00   * Create Output File and Write HTML Page Header
          BRANCH    EXIT,TFEMAP99
          CALL      WEBBOD00   * Process Web Body
          CALL      WEBEND00   * Process End of HTML File
.
          MOVE      ONE,EXIT
          GOTO      TFEMAP99
.
TFEMAP93  MOVE      "Invalid Form Action.",WEBTITLE
          CALL      WEBERR00
          MOVE      ONE,EXIT
          GOTO      TFEMAP99
.
TFEMAP99  RETURN
+
.--------------------------------------------------------------------------
. Bed Fee Mapping Tags
.--------------------------------------------------------------------------
TFMP0000  BRANCH    FLDITMNO,TFMP0100,TFMP0200,TFMP0300,TFMP0400,TFMP0500:
                             TFMP0600,TFMP0700,TFMP0800,TFMP0900
          GOTO      TFMP9999
.
TFMP0100  CALL      TFMT0000
          GOTO      TFMP9999
.
TFMP0200  MOVE      "CL",CATEGORY
          MOVE      BDFEE001,CODE
          CALL      CODITM00
          GOTO      TFMP9999
.
TFMP0300  UNPACK    DIM127,D1,KEY1,DIM127
          MOVE      KEY1,F1
          BRANCH    F1,TFMP0310
          WRITE     HTMLFILE;BDFEE002;
          GOTO      TFMP9999
.
TFMP0310  MATCH     SP70,BDFEE002
          GOTO      TFMP9999 IF EQUAL
          PACK      KEY14,BDFEE002,SP70
          CALL      RDSFUND1
          CALL      RDKFUND1
          BRANCH    OVRCD,TFMP9999
          WRITE     HTMLFILE;HFNAME;
          GOTO      TFMP9999
.
TFMP0400  MOVE      "A ",CATEGORY
          MOVE      BDFEE004,CODE
          CALL      CODITM00
          GOTO      TFMP9999
.
TFMP0500  CALL      NEXTTM00
          GOTO      TFMP9999
.
TFMP0600  CALL      PREVTM00
          GOTO      TFMP9999
.
TFMP0700  WRITE     HTMLFILE;STARTNUM;
          GOTO      TFMP9999
.
TFMP0800  WRITE     HTMLFILE;NORECORD;
          GOTO      TFMP9999
.
TFMP0900  WRITE     HTMLFILE;BDFEE016;
          GOTO      TFMP9999
.
TFMP9999  RETURN
+
.------------------------------------------------------------
. Table of Theatre Fee File Details
.------------------------------------------------------------
TFMT0000  IF        NORECORD=0
            MOVE      "20",NORECORD       * Set Default No Records to Display
          ENDIF
          MOVE      ZERO,RECNUMB
          MOVE      ZERO,DISNUMB
.
          MATCH     SP70,BDFEE001
          GOTO      TFMT9999 IF EQUAL
.
          MATCH     "1",BDFEE016
          IF        @EQUAL
            PACK      KEY15,SP6,BDFEE001,BDFEE002,SP70
            CALL      RDPTMTF3
          ELSE
            PACK      KEY9,BDFEE001,BDFEE002,SP70            * Current
            CALL      RDPTMTF1                                         * File
          ENDIF
.
          COMPARE   ZERO,OVRCD
          GOTO      TFMT0020 IF EQUAL
.
          MATCH     "1",BDFEE016
          IF        @EQUAL
            PACK      KEY15,SP6,BDFEE001,BDFEE002,SP70
            CALL      RSPTMTF3
          ELSE
            PACK      KEY9,BDFEE001,BDFEE002,SP70            * Current
            CALL      RSPTMTF1                                         * File
          ENDIF
.
TFMT0005  MATCH     "1",BDFEE016
          IF        @EQUAL
            CALL      RKPTMTF3
          ELSE
            CALL      RKPTMTF1                                         * Current
          ENDIF
          BRANCH    OVRCD,TFMT9999                                   * File
.
TFMT0020  MATCH     "1",BDFEE016
          IF        @EQUAL
            MATCH     SP70,PTMTCNTR
            GOTO      TFMT9999 IF NOT EQUAL
          ENDIF
.
          MATCH     BDFEE001,PTMTCLAM       * Mandatory, should not be spaces
          GOTO      TFMT9999 IF NOT EQUAL
.
          MATCH     BDFEE002,PTMTHFND       * Match for spaces as this is valid
          GOTO      TFMT9999 IF NOT EQUAL
.
          ADD       ONE,RECNUMB
          IF        STARTNUM>=RECNUMB
            GOTO      TFMT0005
          ENDIF
.
          CALL      TFTR0000
          ADD       ONE,DISNUMB
          COMPARE   NORECORD,DISNUMB
          IF        !@EQUAL
            GOTO      TFMT0005
          ENDIF
.
TFMT9999  RETURN
+
.------------------------------------------------------------
. Theatre Fee Mapping File Table (TABLE ROW)
.------------------------------------------------------------
TFTR0000  WRITE     HTMLFILE;"<tr>":
                             "  <td>&nbsp;",PTMTCLAM,"</td>":
                             "  <td>&nbsp;",PTMTHFND,"</td>";
.
          MOVE      SP70,DIM5
          MOVE      ZERO,FORM5
          MOVE      DISNUMB,FORM5
          ADD       ONE,FORM5
          MOVE      FORM5,DIM5
          REP       " 0",DIM5
.
          MATCH     SP70,PTMTUSID
          IF        @EQUAL | @EOS
            WRITE     HTMLFILE;"  <td>&nbsp;",PTMTCNTR,"</td>":
                          "  <td>&nbsp;<input type=checkbox name=d_uid",DIM5:
                          " value=1 onclick=updateAllocMap();>"
          ELSE
            WRITE     HTMLFILE;"  <td>&nbsp;",PTMTCNTR,"</td>":
                          "  <td>&nbsp;<input type=checkbox name=d_uid",DIM5:
                          " value=1 onclick=updateAllocMap(); checked>"
          ENDIF
.
          WRITE     HTMLFILE;"<input type=hidden name=uid",DIM5,">":
                    "<input type=hidden name=clm",DIM5," value=",PTMTCLAM,">":
                    "<input type=hidden name=hfn",DIM5," value=",PTMTHFND,">":
                    "  </td>":
                    "</tr>"
.
TFTR9999 RETURN
+
.-------------------------------------------------------------------------
. Link to Next Fees Mapping
.-------------------------------------------------------------------------
NEXTTM00  MOVE      NORECORD,KEY2
          REP       " +",KEY2
          ASSIGN    STARTNUM+NORECORD,F3
          MOVE      F3,KEY3
          REP       " +",KEY3
          UNPACK    DIM127,D1,FLDPARA,DIM127
          MOVE      REPORTNO,F2
.
          REP       " +",BDFEE001
          REP       " +",BDFEE002
          REP       " +",BDFEE016
.
          WRITE     HTMLFILE;"patweb77.pbl":
                                 "?reportno=",F2:
                                 "&template=",FLDPARA:
                                 "&startnum=",KEY3:
                                 "&norecord=",KEY2:
                                 "&bdfee001=",BDFEE001:
                                 "&bdfee002=",BDFEE002:
                                 "&bdfee016=",BDFEE016;
.
          REP       "+ ",BDFEE001
          REP       "+ ",BDFEE002
          REP       "+ ",BDFEE016
.
NEXTTM99  RETURN
.
.-------------------------------------------------------------
. Link to Prev Fees Mapping
.-------------------------------------------------------------
PREVTM00  MOVE      NORECORD,KEY2
          REP       " +",KEY2
          ASSIGN    STARTNUM-NORECORD,F3
          IF        F3<0
            MOVE      ZERO,F3
          ENDIF
          MOVE      F3,KEY3
          REP       " +",KEY3
          UNPACK    DIM127,D1,FLDPARA,DIM127
          MOVE      REPORTNO,F2
.
          REP       " +",BDFEE001
          REP       " +",BDFEE002
          REP       " +",BDFEE016
.
          WRITE     HTMLFILE;"patweb77.pbl":
                                 "?reportno=",F2:
                                 "&template=",FLDPARA:
                                 "&startnum=",KEY3:
                                 "&norecord=",KEY2:
                                 "&bdfee001=",BDFEE001:
                                 "&bdfee002=",BDFEE002:
                                 "&bdfee016=",BDFEE016;
.
          REP       "+ ",BDFEE001
          REP       "+ ",BDFEE002
          REP       "+ ",BDFEE016
.
PREVTM99  RETURN
+
.------------------------------------------------------------
. Mark patmtfaf record for contract id allocation
.------------------------------------------------------------
ALLUST00  MOVE      ONE,F2
          WHILE     F2 <= 20
.
            PACK      MBFCLM[F2],MBFCLM[F2],SP70
            PACK      MBFHFN[F2],MBFHFN[F2],SP70
            PACK      MBFUID[F2],MBFUID[F2],SP70
.
            PACK      KEY9,MBFCLM[F2],MBFHFN[F2],SP70
            CALL      RDPTMTF1
            IF        OVRCD=0
              MATCH     "1",MBFUID[F2]
              IF        @EQUAL
                MOVE      WBSEUID,PTMTUSID
              ELSE
                MOVE      SP70,PTMTUSID
              ENDIF
.
              CALL    UPPTMTF1
.
            ENDIF
.
            ADD       ONE,F2
          DO
.
          ENDSET    REDIRECT
.
          APPEND    "&startnum=",REDIRECT
          APPEND    STARTNUM,REDIRECT
.
          APPEND    "&norecord=",REDIRECT
          APPEND    NORECORD,REDIRECT
.
          MATCH     SP70,BDFEE001
          IF        !@EQUAL & !@EOS
            APPEND    "&bdfee001=",REDIRECT
            APPEND    BDFEE001,REDIRECT
          ENDIF
.
          MATCH     SP70,BDFEE002
          IF        !@EQUAL & !@EOS
            APPEND    "&bdfee002=",REDIRECT
            APPEND    BDFEE002,REDIRECT
          ENDIF
.
          MATCH     SP70,BDFEE016
          IF        !@EQUAL & !@EOS
            APPEND    "&bdfee016=",REDIRECT
            APPEND    BDFEE016,REDIRECT
          ENDIF
.
ALLUST99  RETURN
+
.------------------------------------------------------------
. Alocate New Contract ID to patmtfaf
.------------------------------------------------------------
ALLCIT00  PACK      KEY9,SP70
          CALL      RSPTMTF1
ALLCIT10  CALL      RKPTMTF1
          BRANCH    OVRCD,ALLCIT90
.
          MATCH     SP70,PTMTUSID
          IF        !@EQUAL & !@EOS
            MATCH     WBSEUID,PTMTUSID
            IF        @EQUAL
              MOVE      SP70,PTMTUSID
              MOVE      ALLOCCID,PTMTCNTR
              CALL      UPPTMTF1
            ENDIF
          ENDIF
.
.
          GOTO      ALLCIT10
.
ALLCIT90  ENDSET    REDIRECT
.
          APPEND    "&startnum=",REDIRECT
          APPEND    STARTNUM,REDIRECT
.
          APPEND    "&norecord=",REDIRECT
          APPEND    NORECORD,REDIRECT
.
          MATCH     SP70,BDFEE001
          IF        !@EQUAL & !@EOS
            APPEND    "&bdfee001=",REDIRECT
            APPEND    BDFEE001,REDIRECT
          ENDIF
.
          MATCH     SP70,BDFEE002
          IF        !@EQUAL & !@EOS
            APPEND    "&bdfee002=",REDIRECT
            APPEND    BDFEE002,REDIRECT
          ENDIF
.
          MATCH     SP70,BDFEE016
          IF        !@EQUAL & !@EOS
            APPEND    "&bdfee016=",REDIRECT
            APPEND    BDFEE016,REDIRECT
          ENDIF
.
ALLCIT99  RETURN
+
.------------------------------------------------------------
. Clear out patmtfaf contract ids on a new search
.------------------------------------------------------------
ALLSRT00  PACK      KEY9,SP70
          CALL      RSPTMTF1
ALLSRT10  CALL      RKPTMTF1
          BRANCH    OVRCD,ALLSRT90
.
          MATCH     SP70,PTMTUSID
          IF        !@EQUAL & !@EOS
            MATCH     WBSEUID,PTMTUSID
            IF        @EQUAL
              MOVE      SP70,PTMTUSID
              CALL      UPPTMTF1
            ENDIF
          ENDIF
.
          GOTO      ALLSRT10
.
ALLSRT90  ENDSET    REDIRECT
.
          APPEND    "&startnum=",REDIRECT
          APPEND    STARTNUM,REDIRECT
.
          APPEND    "&norecord=",REDIRECT
          APPEND    NORECORD,REDIRECT
.
          MATCH     SP70,BDFEE001
          IF        !@EQUAL & !@EOS
            APPEND    "&bdfee001=",REDIRECT
            APPEND    BDFEE001,REDIRECT
          ENDIF
.
          MATCH     SP70,BDFEE002
          IF        !@EQUAL & !@EOS
            APPEND    "&bdfee002=",REDIRECT
            APPEND    BDFEE002,REDIRECT
          ENDIF
.
          MATCH     SP70,BDFEE016
          IF        !@EQUAL & !@EOS
            APPEND    "&bdfee016=",REDIRECT
            APPEND    BDFEE016,REDIRECT
          ENDIF
.
ALLSRT99  RETURN
+
.------------------------------------------------------------------------------
. Bed Fee Maintenance: Display,Add,Update,Delete
.------------------------------------------------------------------------------
JHSFEE00  RESET     UPDTTYPE
.
          MATCH     SP70,UPDTTYPE           * Display formaction
          GOTO      JHSFEE80 IF EQUAL
.
          MATCH     "A",UPDTTYPE            * Add formaction
          GOTO      JHSFEE10 IF EQUAL
.
          MATCH     "U",UPDTTYPE            * Update formaction
          GOTO      JHSFEE20 IF EQUAL
.
          MATCH     "D",UPDTTYPE            * Delete formaction
          GOTO      JHSFEE30 IF EQUAL
.
          MATCH     "G",UPDTTYPE            * Global Update formaction
          GOTO      JHSFEE40 IF EQUAL
.
          MATCH     "H",UPDTTYPE            * Health Fund Duplication
          GOTO      JHSFEE50 IF EQUAL
.
          MATCH     "E",UPDTTYPE            * Global Delete formaction
          GOTO      JHSFEE60 IF EQUAL
.
          MATCH     "C",UPDTTYPE            * Create New File
          GOTO      JHSFEE70 IF EQUAL
.
          MATCH     "F",UPDTTYPE            * Update New File
          GOTO      JHSFEE75 IF EQUAL
.
          GOTO      JHSFEE93
.
JHSFEE10  MATCH     "N",FILEFLAG
          GOTO      JHSFEE15 IF EQUAL
          PACK      KEY26,BDFEE001,BDFEE002,BDFEE015,BDFEE004,BDFEE005,BDFEE006
          CALL      RDJHBFE1                * Add into Current File
          COMPARE   ZERO,OVRCD
          GOTO      JHSFEE92 IF EQUAL
          CALL      SVJFEE00
          CALL      WRJHBFE1
          GOTO      JHSFEE98
.
JHSFEE15  PACK      KEY26,BDFEE001,BDFEE002,BDFEE015,BDFEE004,BDFEE005,BDFEE006
          CALL      RDJHB1A1                * Add into New File
          COMPARE   ZERO,OVRCD
          GOTO      JHSFEE92 IF EQUAL
          CALL      SVJFEE00
          CALL      WRJHB1A1
          GOTO      JHSFEE98
.
JHSFEE20  MATCH     "N",FILEFLAG
          GOTO      JHSFEE25 IF EQUAL
          PACK      KEY26,BDFEE001,BDFEE002,BDFEE015,BDFEE004,BDFEE005,BDFEE006
          CALL      RDJHBFE1                * Update into Current File
          BRANCH    OVRCD,JHSFEE91
          CALL      SVJFEE00
          CALL      UPJHBFE1
          GOTO      JHSFEE98
.
JHSFEE25  PACK      KEY26,BDFEE001,BDFEE002,BDFEE015,BDFEE004,BDFEE005,BDFEE006
          CALL      RDJHB1A1                * Update into New File
          BRANCH    OVRCD,JHSFEE91
          CALL      SVJFEE00
          CALL      UPJHB1A1
          GOTO      JHSFEE98
.
JHSFEE30  MATCH     "N",FILEFLAG
          GOTO      JHSFEE35 IF EQUAL
.
          PACK      KEY26,BDFEE001,BDFEE002,BDFEE015,BDFEE004,BDFEE005,BDFEE006
          CALL      RDJHBFE1                * Delete from Current File
          BRANCH    OVRCD,JHSFEE91
          CALL      DEJHBFE1
          GOTO      JHSFEE98
.
JHSFEE35  PACK      KEY26,BDFEE001,BDFEE002,BDFEE015,BDFEE004,BDFEE005,BDFEE006
          CALL      RDJHB1A1                * Delete from New File
          BRANCH    OVRCD,JHSFEE91
          CALL      DEJHB1A1
          GOTO      JHSFEE98
.
JHSFEE40  CALL      SGLU0000                * Schedule global update
          GOTO      JHSFEE99
.
JHSFEE50  CALL      SHFD0000                * Schedule health fund duplication
          GOTO      JHSFEE99
.
JHSFEE60  CALL      SGLD0000                * Schedule global deletion
          GOTO      JHSFEE99
.
JHSFEE70  CALL      SNEW0000                * Schedule new file creation
          GOTO      JHSFEE99
.
JHSFEE75  CALL      SUPD0000                * Schedule bed fee update
          GOTO      JHSFEE99
.
JHSFEE80  MOVE      ZERO,EXIT
          MATCH     "4",TEMPLATE
          IF        @EQUAL
            CALL      LCKBF000                * Check if Locked
            BRANCH    EXIT,JHSFEE99
          ENDIF
.
          MATCH     "N",FILEFLAG
          GOTO      JHSFEE81 IF EQUAL
          PACK      KEY26,BDFEE001,BDFEE002,BDFEE015,BDFEE004,BDFEE005,BDFEE006
          CALL      RDJHBFE1
          IF        OVRCD=1
            CALL      CLJFEE00
          ENDIF
          GOTO      JHSFEE82
.
JHSFEE81  MOVE      ZERO,OVRCD
          TRAP      OVERCOND IF IO
          OPEN      JHSBF1A1,"newbfeaf"
          TRAPCLR   IO
          BRANCH    OVRCD,JHSFEE94
.
          MOVE      ONE,NEWFFLAG
          PACK      KEY26,BDFEE001,BDFEE002,BDFEE015,BDFEE004,BDFEE005,BDFEE006
          CALL      RDJHB1A1
          IF        OVRCD=1
            CALL      CLJFEE00
          ENDIF
.
JHSFEE82  CLEAR     WEBTITLE
          MOVE      "Bed Fee Maintenance",WEBTITLE
          RESET     WEBTITLE
.
          CALL      WEBHED00   * Create Output File and Write HTML Page Header
          BRANCH    EXIT,JHSFEE99
          CALL      WEBBOD00   * Process Web Body
          CALL      WEBEND00   * Process End of HTML File
.
          MOVE      ONE,EXIT
          GOTO      JHSFEE99
.
JHSFEE91  MOVE      "Record does not exist",WEBTITLE
          CALL      WEBERR00
          MOVE      ONE,EXIT
          GOTO      JHSFEE99
.
JHSFEE92  MOVE      "Record already exists",WEBTITLE
          CALL      WEBERR00
          MOVE      ONE,EXIT
          GOTO      JHSFEE99
.
JHSFEE93  MOVE      "Invalid Form Action.",WEBTITLE
          CALL      WEBERR00
          MOVE      ONE,EXIT
          GOTO      JHSFEE99
.
JHSFEE94  MOVE      "No New File.File Must be Created First.",WEBTITLE
          CALL      WEBERR00
          MOVE      ONE,EXIT
          GOTO      JHSFEE99
.
JHSFEE98  MOVE      ZERO,EXIT
JHSFEE99  RETURN
.---------------------------------------------------------------------------
. Moves cgi variables into file variables
.---------------------------------------------------------------------------
SVJFEE00  MOVE      BDFEE001,BFCLM
          MOVE      BDFEE002,BFHFUND
          MOVE      BDFEE015,BFHFTAB
          MOVE      BDFEE004,BFATYPE
          MOVE      BDFEE005,BFBTYPE
          MOVE      BDFEE006,BFENDDY
          MOVE      BDFEE007,BFPAT
          MOVE      BDFEE008,BFHF
          MOVE      BDFEE009,BFNINV
          MOVE      BDFEE010,BFDESC
.
SVJFEE99  RETURN
.-----------------------------------------------------------
. Initialize's file data
.-----------------------------------------------------------
CLJFEE00  MOVE      SP70,BFCLM
          MOVE      SP70,BFHFUND
          MOVE      SP70,BFHFTAB
          MOVE      SP70,BFATYPE
          MOVE      SP70,BFBTYPE
          MOVE      ZERO,BFENDDY
          MOVE      ZERO,BFPAT
          MOVE      ZERO,BFHF
          MOVE      ZERO,BFNINV
          MOVE      SP70,BFDESC
          MOVE      SP70,BFHDP
. Spare Variables
          MOVE      SP70,SBFCLM
          MOVE      SP70,SBFHFUND
          MOVE      SP70,SBFHFTAB
          MOVE      SP70,SBFEXTFD
          MOVE      SP70,SBFATYPE
          MOVE      SP70,SBFBTYPE
          MOVE      ZERO,SBFENDDY
          MOVE      ZERO,SBFPAT
          MOVE      ZERO,SBFHF
          MOVE      ZERO,SBFNINV
          MOVE      SP70,SBFDESC
          MOVE      SP70,SBFHDP
.
CLJFEE99  RETURN
.
.--------------------------------------------------------------------------
. Bed Fee Maintenance Output
.--------------------------------------------------------------------------
JFEE0000  BRANCH    FLDITMNO,JFEE0100,JFEE0200,JFEE0300,JFEE0400,JFEE0500:
                             JFEE0600,JFEE0700,JFEE0800,JFEE0900,JFEE1000:
                             JFEE1100,JFEE1200,JFEE1300,JFEE1400,JFEE1500:
                             JFEE1600,JFEE1700,JFEE1800,JFEE1900,JFEE2000:
                             JFEE2100,JFEE2200,JFEE2300
          GOTO      JFEE9999
.
JFEE0100  MOVE      "CL",CATEGORY
          MOVE      BFCLM,CODE
          CALL      CODITM00
          GOTO      JFEE9999
.
JFEE0200  UNPACK    DIM127,D1,KEY1,DIM127
          MOVE      KEY1,F1
          BRANCH    F1,JFEE0210
          WRITE     HTMLFILE;BFHFUND;
          GOTO      JFEE9999
.
JFEE0210  MATCH     SP70,BFHFUND
          GOTO      JFEE9999 IF EQUAL
          PACK      KEY14,BFHFUND,SP70
          CALL      RDSFUND1
          CALL      RDKFUND1
          BRANCH    OVRCD,JFEE9999
          WRITE     HTMLFILE;HFNAME;
          GOTO      JFEE9999
.
JFEE0300  UNPACK    DIM127,D1,KEY1,DIM127
          MOVE      KEY1,F1
          BRANCH    F1,JFEE0310
          WRITE     HTMLFILE;BFHFTAB;
          GOTO      JFEE9999
.
JFEE0310  PACK      KEY14,BFHFUND,BFHFTAB,SP70
          CALL      RDFUND1
          BRANCH    OVRCD,JFEE9999
          WRITE     HTMLFILE;HFNAME;
          GOTO      JFEE9999
.
JFEE0400  MOVE      "A ",CATEGORY
          MOVE      BFATYPE,CODE
          CALL      CODITM00
          GOTO      JFEE9999
.
JFEE0500  MOVE      "BT",CATEGORY
          MOVE      BFBTYPE,CODE
          CALL      CODITM00
          GOTO      JFEE9999
.
JFEE0600  WRITE     HTMLFILE;BFENDDY;
          GOTO      JFEE9999
.
JFEE0700  WRITE     HTMLFILE;BFPAT;
          GOTO      JFEE9999
.
JFEE0800  WRITE     HTMLFILE;BFHF;
          GOTO      JFEE9999
.
JFEE0900  COMPARE   ONE,BFNINV
          IF        @EQUAL
            WRITE     HTMLFILE;"<option value=",ONE," selected>":
                               BFNINV,"</option>"
          ELSE
            WRITE     HTMLFILE;"<option value=",ONE,">":
                               ONE,"</option>"
          ENDIF
.
          COMPARE   TWO,BFNINV
          IF        @EQUAL
            WRITE     HTMLFILE;"<option value=",TWO," selected>":
                               BFNINV,"</option>"
          ELSE
            WRITE     HTMLFILE;"<option value=",TWO,">":
                               TWO,"</option>"
          ENDIF
          GOTO      JFEE9999
.
JFEE1000  WRITE     HTMLFILE;BFDESC;
          GOTO      JFEE9999
.
JFEE1100  CALL      JFEETB00
          GOTO      JFEE9999
.
JFEE1200  CALL      NEXTFJ00
          GOTO      JFEE9999
.
JFEE1300  CALL      PREVFJ00
          GOTO      JFEE9999
.
JFEE1400  MOVE      "CL",CATEGORY
          MOVE      BDFEE001,CODE
          CALL      CODITM00
          GOTO      JFEE9999
.
JFEE1500  UNPACK    DIM127,D1,KEY1,DIM127
          MOVE      KEY1,F1
          BRANCH    F1,JFEE1510
          WRITE     HTMLFILE;BDFEE002;
          GOTO      JFEE9999
.
JFEE1510  MATCH     SP70,BDFEE002
          GOTO      JFEE9999 IF EQUAL
          PACK      KEY14,BDFEE002,SP70
          CALL      RDSFUND1
          CALL      RDKFUND1
          BRANCH    OVRCD,JFEE9999
          WRITE     HTMLFILE;HFNAME;
          GOTO      JFEE9999
.
JFEE1600  UNPACK    DIM127,D1,KEY1,DIM127
          MOVE      KEY1,F1
          BRANCH    F1,JFEE1610
          WRITE     HTMLFILE;BDFEE015;
          GOTO      JFEE9999
.
JFEE1610  PACK      KEY14,BDFEE002,BDFEE015,SP70
          CALL      RDFUND1
          BRANCH    OVRCD,JFEE9999
          WRITE     HTMLFILE;HFNAME;
          GOTO      JFEE9999
.
JFEE1700  MOVE      "A ",CATEGORY
          MOVE      BDFEE004,CODE
          CALL      CODITM00
          GOTO      JFEE9999
.
JFEE1800  WRITE     HTMLFILE;FILEFLAG;
          GOTO      JFEE9999
.
JFEE1900
          GOTO      JFEE9999
.
JFEE2000  MOVE      ZERO,OVRCD
          TRAP      OVERCOND IF IO
          OPEN      JHSBF1A1,"newbfeaf"
          TRAPCLR   IO
          BRANCH    OVRCD,JFEE2040
.
          MOVE      SP70,KEY26
          CALL      RSJHB1A1
          CALL      RKJHB1A1
          BRANCH    OVRCD,JFEE2040
          GOTO      JFEE2050
.
JFEE2040  WRITE     HTMLFILE;ZERO;          * New file empty of does not exist
          GOTO      JFEE9999
.
JFEE2050  WRITE     HTMLFILE;ONE;           * New file contains some records
          GOTO      JFEE9999
.
JFEE2100  MOVE      "CL",CATEGORY
          MOVE      SP10,CODE
          CALL      CODITM00
          GOTO      JFEE9999
.
JFEE2200  MOVE      "A ",CATEGORY
          MOVE      SP10,CODE
          CALL      CODITM00
          GOTO      JFEE9999
.
JFEE2300  MOVE      "BT",CATEGORY
          MOVE      SP10,CODE
          CALL      CODITM00
          GOTO      JFEE9999
.
JFEE9999  RETURN
.------------------------------------------------------------
. Table of Bed Fee File Details
.------------------------------------------------------------
JFEETB00  UNPACK    DIM127,D1,LINKPRG,DIM127
          UNPACK    DIM127,D1,LINKREP,DIM127
          UNPACK    DIM127,D1,LINKTEM,DIM127
.
          IF        NORECORD=0
            MOVE      "11",NORECORD       * Set Default No Records to Display
          ENDIF
          MOVE      ZERO,RECNUMB
          MOVE      ZERO,DISNUMB
.
          MATCH     SP70,BDFEE001
          GOTO      JFEETB99 IF EQUAL
.
          MATCH     "N",FILEFLAG
          GOTO      JFEETB10 IF EQUAL
.
          PACK      KEY26,BDFEE001,BDFEE002,BDFEE015,BDFEE004,SP70   * Current
          CALL      RDJHBFE1                                         * File
          COMPARE   ZERO,OVRCD
          GOTO      JFEETB20 IF EQUAL
.
          PACK      KEY26,BDFEE001,BDFEE002,BDFEE015,BDFEE004,SP70   * Current
          CALL      RSJHBFE1                                         * File
JFEETB05  CALL      RKJHBFE1                                         * Current
          BRANCH    OVRCD,JFEETB99                                   * File
          GOTO      JFEETB20
.
JFEETB10  PACK      KEY26,BDFEE001,BDFEE002,BDFEE015,BDFEE004,SP70   * New File
          CALL      RDJHB1A1
          COMPARE   ZERO,OVRCD
          GOTO      JFEETB20 IF EQUAL
.
          PACK      KEY26,BDFEE001,BDFEE002,BDFEE015,BDFEE004,SP70   * New File
          CALL      RSJHB1A1
JFEETB15  CALL      RKJHB1A1                                         * New File
          BRANCH    OVRCD,JFEETB99
.
JFEETB20  MATCH     BDFEE001,BFCLM
          GOTO      JFEETB99 IF NOT EQUAL
.
          MATCH     BDFEE002,BFHFUND        * Match for spaces as this is valid
          GOTO      JFEETB99 IF NOT EQUAL
.
          MATCH     BDFEE015,BFHFTAB        * Match for spaces as this is valid
          GOTO      JFEETB99 IF NOT EQUAL
.
          MATCH     SP70,BDFEE004
          IF        !@EQUAL
            MATCH     BDFEE004,BFATYPE
            GOTO      JFEETB99 IF NOT EQUAL
          ENDIF
.
          ADD       ONE,RECNUMB
          IF        STARTNUM>=RECNUMB
            MATCH     "N",FILEFLAG
            GOTO      JFEETB15 IF EQUAL
            GOTO      JFEETB05
          ENDIF
.
          CALL      JFEERW00
          ADD       ONE,DISNUMB
          COMPARE   NORECORD,DISNUMB
          IF        !@EQUAL
            MATCH     "N",FILEFLAG
            GOTO      JFEETB15 IF EQUAL
            GOTO      JFEETB05
          ENDIF
.
JFEETB99  RETURN
.------------------------------------------------------------
. Bed Fee File Table (TABLE ROW) Johns Hopkins
.------------------------------------------------------------
JFEERW00  MOVE      "A ",CATEGORY
          MOVE      BFATYPE,CODE
          CALL      GETCOD00
.
          MOVE      ZERO,TOTAL
          ADD       BFHF,TOTAL
          ADD       BFPAT,TOTAL
.
          WRITE     HTMLFILE;"<tr><td nowrap><A HREF='javascript:ShowLink":
                             "(#"",LINKPRG,"#.pbl":
                             "?reportno=",LINKREP:
                             "&template=",LINKTEM:
                             "&bdfee001=",BFCLM:
                             "&bdfee002=",BFHFUND:
                             "&bdfee015=",BFHFTAB:
                             "&bdfee004=",BFATYPE:
                             "&bdfee005=",BFBTYPE:
                             "&bdfee006=",BFENDDY:
                             "&fileflag=",FILEFLAG,"#")'>":
                             "<img src=../images/MaintenanceIcon.gif hspace=4":
                             " border=0 align=absmiddle></a>":
                             BFHFUND,"</td>":
                             "<td>&nbsp;",BFHFTAB,"</td>":
                             "<td>&nbsp;",TDESC,"</td>":
                             "<td>&nbsp;",BFBTYPE,"</td>":
                             "<td>&nbsp;",BFENDDY,"</td>":
                             "<td>&nbsp;",BFDESC,"</td>":
                             "<td>&nbsp;",BFNINV,"</td>":
                             "<td>&nbsp;",BFPAT,"</td>":
                             "<td>&nbsp;",BFHF,"</td>":
                             "<td>&nbsp;",TOTAL,"</td>":
                             "</tr>"
.
JFEERW99 RETURN
.-------------------------------------------------------------------------
. Link to Next Fees Johns Hopkins
.-------------------------------------------------------------------------
NEXTFJ00  MOVE      NORECORD,KEY2
          REP       " +",KEY2
          ASSIGN    STARTNUM+NORECORD,F3
          MOVE      F3,KEY3
          REP       " +",KEY3
          UNPACK    DIM127,D1,FLDPARA,DIM127
          MOVE      REPORTNO,F2
.
          WRITE     HTMLFILE;"patweb77.pbl":
                                 "?reportno=",F2:
                                 "&template=",FLDPARA:
                                 "&startnum=",KEY3:
                                 "&norecord=",KEY2:
                                 "&bdfee001=",BDFEE001:
                                 "&bdfee002=",BDFEE002:
                                 "&bdfee003=",BDFEE003:
                                 "&bdfee004=",BDFEE004:
                                 "&fileflag=",FILEFLAG;
.
          MATCH     "1",MENUFLAG
          IF        @EQUAL
            WRITE     HTMLFILE;"&menuflag=1";
          ENDIF
.
NEXTFJ99  RETURN
.
.-------------------------------------------------------------
. Link to Prev Fees Johns Hopkins
.-------------------------------------------------------------
PREVFJ00  MOVE      NORECORD,KEY2
          REP       " +",KEY2
          ASSIGN    STARTNUM-NORECORD,F3
          IF        F3<0
            MOVE      ZERO,F3
          ENDIF
          MOVE      F3,KEY3
          REP       " +",KEY3
          UNPACK    DIM127,D1,FLDPARA,DIM127
          MOVE      REPORTNO,F2
.
          WRITE     HTMLFILE;"patweb77.pbl":
                                 "?reportno=",F2:
                                 "&template=",FLDPARA:
                                 "&startnum=",KEY3:
                                 "&norecord=",KEY2:
                                 "&bdfee001=",BDFEE001:
                                 "&bdfee002=",BDFEE002:
                                 "&bdfee003=",BDFEE003:
                                 "&bdfee004=",BDFEE004:
                                 "&fileflag=",FILEFLAG;
.
          MATCH     "1",MENUFLAG
          IF        @EQUAL
            WRITE     HTMLFILE;"&menuflag=1";
          ENDIF
.
PREVFJ99  RETURN
.
.------------------------------------------------------------
. Write audit for deletion of patcmxaf record
.------------------------------------------------------------
ACMX0000  MOVE      "patcmxaf",PMDCFILE
          MOVE      PTCMCNID,PMDCCONT
          PACK      PMDCRKEY,PTCMCLMN,PTCMHFND,PTCMCASM,PTCMCNID,SP70
.
          MOVE      USERID,PMDCDUID
          PACK      PMDCDDAT,CCC,CYY,CMM,CDD
          REP       " 0",PMDCDDAT
          CLOCK     TIME,PMDCDTIM
          MOVE      SP70,PMDCSPAR
.
          MOVE      ZERO,F3
.
ACMX1000  ADD       ONE,F3
          MOVE      F3,PMDCUNIQ
.
          PACK      KEY27,PMDCFILE,PMDCDDAT,PMDCDTIM,PMDCUNIQ,SP70
          CALL      RAPMDCA1
          IF        OVRCD=1
            CALL      WRPMDCA1
          ELSE
            GOTO      ACMX1000
          ENDIF
.
ACMX9999  RETURN
.
.------------------------------------------------------------
. Write audit for deletion of patbfeef record
.------------------------------------------------------------
ABFE0000  MOVE      "patbfeef",PMDCFILE
          MOVE      PTBFCNID,PMDCCONT
          PACK      PMDCRKEY,BFCLM,BFHFUND,PTBFHTYP,BFATYPE,BFBTYPE,PTBFCNID:
                             BFENDDY,SP70
.
          MOVE      USERID,PMDCDUID
          PACK      PMDCDDAT,CCC,CYY,CMM,CDD
          REP       " 0",PMDCDDAT
          CLOCK     TIME,PMDCDTIM
          MOVE      SP70,PMDCSPAR
.
          MOVE      ZERO,F3
.
ABFE1000  ADD       ONE,F3
          MOVE      F3,PMDCUNIQ
.
          PACK      KEY27,PMDCFILE,PMDCDDAT,PMDCDTIM,PMDCUNIQ,SP70
          CALL      RAPMDCA1
          IF        OVRCD=1
            CALL      WRPMDCA1
          ELSE
            GOTO      ABFE1000
          ENDIF
.
ABFE9999  RETURN
.
.------------------------------------------------------------
. Write audit for deletion of pattfeef record
.------------------------------------------------------------
ATFE0000  MOVE      "pattfeef",PMDCFILE
          MOVE      PTTFCNID,PMDCCONT
          PACK      PMDCRKEY,TFCLM,TFHFUND,PTTFHTYP,TFDAYC,TFENDMBS,PTTFCNID:
                             SP70
.
          MOVE      USERID,PMDCDUID
          PACK      PMDCDDAT,CCC,CYY,CMM,CDD
          REP       " 0",PMDCDDAT
          CLOCK     TIME,PMDCDTIM
          MOVE      SP70,PMDCSPAR
.
          MOVE      ZERO,F3
.
ATFE1000  ADD       ONE,F3
          MOVE      F3,PMDCUNIQ
.
          PACK      KEY27,PMDCFILE,PMDCDDAT,PMDCDTIM,PMDCUNIQ,SP70
          CALL      RAPMDCA1
          IF        OVRCD=1
            CALL      WRPMDCA1
          ELSE
            GOTO      ATFE1000
          ENDIF
.
ATFE9999  RETURN
.
.------------------------------------------------------------
. Write audit for deletion of patctfaf record
.------------------------------------------------------------
ACTF0000  MOVE      "patctfaf",PMDCFILE
          MOVE      PTCTCNID,PMDCCONT
          PACK      PMDCRKEY,PTCTCNID,PTCTCLMN,PTCTHFND,PTCTTABT,PTCTCASM:
                             PTCTMBSB,PTCTDCAS,PTCTITMS,SP70
.
          MOVE      USERID,PMDCDUID
          PACK      PMDCDDAT,CCC,CYY,CMM,CDD
          REP       " 0",PMDCDDAT
          CLOCK     TIME,PMDCDTIM
          MOVE      SP70,PMDCSPAR
.
          MOVE      ZERO,F3
.
ACTF1000  ADD       ONE,F3
          MOVE      F3,PMDCUNIQ
.
          PACK      KEY27,PMDCFILE,PMDCDDAT,PMDCDTIM,PMDCUNIQ,SP70
          CALL      RAPMDCA1
          IF        OVRCD=1
            CALL      WRPMDCA1
          ELSE
            GOTO      ACTF1000
          ENDIF
.
ACTF9999  RETURN
.
.------------------------------------------------------------
. Write audit for deletion of patmchgf record
.------------------------------------------------------------
AMCH0000  MOVE      "patmchgf",PMDCFILE
          MOVE      SP70,PMDCCONT
          PACK      PMDCRKEY,MCLMCOD,MHFUND,PTMCHFTT,MCHARGE,PTMCEFDT,SP70
.
          MOVE      USERID,PMDCDUID
          PACK      PMDCDDAT,CCC,CYY,CMM,CDD
          REP       " 0",PMDCDDAT
          CLOCK     TIME,PMDCDTIM
          MOVE      SP70,PMDCSPAR
.
          MOVE      ZERO,F3
.
AMCH1000  ADD       ONE,F3
          MOVE      F3,PMDCUNIQ
.
          PACK      KEY27,PMDCFILE,PMDCDDAT,PMDCDTIM,PMDCUNIQ,SP70
          CALL      RAPMDCA1
          IF        OVRCD=1
            CALL      WRPMDCA1
          ELSE
            GOTO      AMCH1000
          ENDIF
.
AMCH9999  RETURN

.
.------------------------------------------------------------
. Theare Charges Maintenance: Display,Add,Update,Delete JHS
.------------------------------------------------------------
JHSCHG00  RESET     UPDTTYPE
.
          MATCH     SP1,UPDTTYPE
          GOTO      JHSCHG80 IF EQUAL
.
          MATCH     "A",UPDTTYPE            * Add formaction
          GOTO      JHSCHG10 IF EQUAL
.
          MATCH     "U",UPDTTYPE            * Update formaction
          GOTO      JHSCHG20 IF EQUAL
.
          MATCH     "D",UPDTTYPE            * Delete formaction
          GOTO      JHSCHG30 IF EQUAL
.
          MATCH     "C",UPDTTYPE            * Create New Theatre Fee File
          GOTO      JHSCHG41 IF EQUAL
.
          MATCH     "G",UPDTTYPE            * Global Update of Charges (New)
          GOTO      JHSCHG42 IF EQUAL
.
          MATCH     "H",UPDTTYPE            * Health Fund/Table Duplic. (New)
          GOTO      JHSCHG43 IF EQUAL
.
          MATCH     "E",UPDTTYPE            * Global Delete formaction
          GOTO      JHSCHG44 IF EQUAL
.
          MATCH     "F",UPDTTYPE            * Update New to Current Fee File
          GOTO      JHSCHG45 IF EQUAL
.
          GOTO      JHSCHG93
.
.         Insert New Theatre Fee
.
JHSCHG10  MOVE      OPCHG001,CLAIMCOD
          MOVE      OPCHG002,HLTHFUND
          MOVE      OPCHG005,FEECLASS
          CALL      CHKMBS00                * right justify MBS fees
          MOVE      FEECLASS,OPCHG005
          MATCH     "N",FILEFLAG
          GOTO      JHSCHG15 IF EQUAL
          PACK      KEY23,OPCHG001,OPCHG002,OPCHG027,OPCHG004,OPCHG005,SP70
          CALL      RDJHTFE1         * Add into Current File
          COMPARE   ZERO,OVRCD
          GOTO      JHSCHG92 IF EQUAL
          CALL      SVJCHG00
          CALL      WRJHTFE1
          GOTO      JHSCHG98
.
JHSCHG15  PACK      KEY23,OPCHG001,OPCHG002,OPCHG027,OPCHG004,OPCHG005,SP70
          CALL      RDJHT1A1         * Add into New File
          COMPARE   ZERO,OVRCD
          GOTO      JHSCHG92 IF EQUAL
          CALL      SVJCHG00
          CALL      WRJHT1A1
          GOTO      JHSCHG98
.
.         Update Theatre Fee
.
JHSCHG20  MATCH     "N",FILEFLAG
          GOTO      JHSCHG25 IF EQUAL
          PACK      KEY23,OPCHG001,OPCHG002,OPCHG027,OPCHG004,OPCHG005,SP70
          CALL      RDJHTFE1         * Update into Current File
          BRANCH    OVRCD,JHSCHG91
          CALL      SVJCHG00
          CALL      UPJHTFE1
          GOTO      JHSCHG98
.
JHSCHG25  PACK      KEY23,OPCHG001,OPCHG002,OPCHG027,OPCHG004,OPCHG005,SP70
          CALL      RDJHT1A1         * Update into New File
          BRANCH    OVRCD,JHSCHG91
          CALL      SVJCHG00
          CALL      UPJHT1A1
          GOTO      JHSCHG98
.
.         Delete Theatre Fee
.
JHSCHG30  MATCH     "N",FILEFLAG
          GOTO      JHSCHG35 IF EQUAL
          PACK      KEY23,OPCHG001,OPCHG002,OPCHG027,OPCHG004,OPCHG005,SP70
          CALL      RDJHTFE1         * Delete from Current File
          BRANCH    OVRCD,JHSCHG91
          CALL      DEJHTFE1
          GOTO      JHSCHG98
.
JHSCHG35  PACK      KEY23,OPCHG001,OPCHG002,OPCHG027,OPCHG004,OPCHG005,SP70
          CALL      RDJHT1A1         * Delete from New File
          BRANCH    OVRCD,JHSCHG91
          CALL      DEJHT1A1
          GOTO      JHSCHG98
.
JHSCHG41  CALL      STFCN000        * Schedule Create New Theatre Fee File
          GOTO      JHSCHG98
.
JHSCHG42  CALL      STFGU000        * Schedule Global Update of Charges (New)
          GOTO      JHSCHG98
.
JHSCHG43  CALL      STFGC000        * Schedule Global Copy of Theatre Fee (New)
          GOTO      JHSCHG98
.
JHSCHG44  CALL      STFGD000        * Schedule Global Delete of Theatre Fee(New)
          GOTO      JHSCHG98
.
JHSCHG45  CALL      STFRP000        * Schedule Replace Current with New File
          GOTO      JHSCHG98
.
.         Display
.
JHSCHG80  MOVE      ZERO,EXIT
          MATCH     "4",TEMPLATE
          IF        @EQUAL
            CALL      LCKTF000       * Check if Locked
            BRANCH    EXIT,JHSCHG99
          ENDIF
.
          MATCH     "N",FILEFLAG
          GOTO      JHSCHG81 IF EQUAL
          PACK      KEY23,OPCHG001,OPCHG002,OPCHG027,OPCHG004,OPCHG005,SP70
          CALL      RDJHTFE1
          IF        OVRCD=1
            CALL      CLJCHG00
          ENDIF
          GOTO      JHSCHG82
.
JHSCHG81  MOVE      ZERO,OVRCD
          TRAP      OVERCOND IF IO
          OPEN      JHSTF1A1,"newtfeaf"
          TRAPCLR   IO
          BRANCH    OVRCD,JHSCHG94
.
          MOVE      ONE,NEWFFLAG
          PACK      KEY23,OPCHG001,OPCHG002,OPCHG027,OPCHG004,OPCHG005,SP70
          CALL      RDJHT1A1
          IF        OVRCD=1
            CALL      CLJCHG00
          ENDIF
.
JHSCHG82  CLEAR     WEBTITLE
          MOVE      "JHS Theatre Fee Maintenance",WEBTITLE
          RESET     WEBTITLE
.
          CALL      WEBHED00   * Create Output File and Write HTML Page Header
          BRANCH    EXIT,JHSCHG99
          CALL      WEBBOD00   * Process Web Body
          CALL      WEBEND00   * Process End of HTML File
.
          MOVE      ONE,EXIT
          GOTO      JHSCHG99
.
JHSCHG91  MOVE      "Record does not exist",WEBTITLE
          CALL      WEBERR00
          MOVE      ONE,EXIT
          GOTO      JHSCHG99
.
JHSCHG92  MOVE      "Record already exists",WEBTITLE
          CALL      WEBERR00
          MOVE      ONE,EXIT
          GOTO      JHSCHG99
.
JHSCHG93  MOVE      "Invalid Form Action.",WEBTITLE
          CALL      WEBERR00
          MOVE      ONE,EXIT
          GOTO      JHSCHG99
.
JHSCHG94  MOVE      "No New File.File Must be Created First.",WEBTITLE
          CALL      WEBERR00
          MOVE      ONE,EXIT
          GOTO      JHSCHG99
.
JHSCHG98  MOVE      ZERO,EXIT
JHSCHG99  RETURN
.
.------------------------------------------------------------
. Moves cgi variables into file variables
.------------------------------------------------------------
SVJCHG00  MOVE      OPCHG001,TFCLM
          MOVE      OPCHG002,TFHFUND
          MOVE      OPCHG027,TFHFTAB
          MOVE      OPCHG004,TFDAYC
          MOVE      OPCHG005,TFENDMBS
          CALL      SAVTOT00
.
SVJCHG99  RETURN
.
.--------------------------------------------------------------------------
. Initialize's file data JHS
.--------------------------------------------------------------------------
CLJCHG00  MOVE      SP70,TFCLM
          MOVE      SP70,TFHFUND
          MOVE      SP70,TFHFTAB
          MOVE      SP70,TFDAYC
          MOVE      SP70,TFENDMBS
          MOVE      ZERO,TFHF1
          MOVE      ZERO,TFPAT1
          MOVE      ZERO,TFHF2
          MOVE      ZERO,TFPAT2
          MOVE      ZERO,TFHF3
          MOVE      ZERO,TFPAT3
          MOVE      ZERO,TFHF4
          MOVE      ZERO,TFPAT4
          MOVE      ZERO,TFHF5
          MOVE      ZERO,TFPAT5
          MOVE      ZERO,TFHF6
          MOVE      ZERO,TFPAT6
          MOVE      ZERO,TFNINV
.Spare Variables
          MOVE      SP70,STFCLM
          MOVE      SP70,STFHFUND
          MOVE      SP70,STFHFTAB
          MOVE      SP70,STFENDMB
          MOVE      SP70,STFDAYC
          MOVE      ZERO,STFHF1
          MOVE      ZERO,STFPAT1
          MOVE      ZERO,STFHF2
          MOVE      ZERO,STFPAT2
          MOVE      ZERO,STFHF3
          MOVE      ZERO,STFPAT3
          MOVE      ZERO,STFHF4
          MOVE      ZERO,STFPAT4
          MOVE      ZERO,STFHF5
          MOVE      ZERO,STFPAT5
          MOVE      ZERO,STFHF6
          MOVE      ZERO,STFPAT6
          MOVE      ZERO,STFNINV
.
CLJCHG99  RETURN
.--------------------------------------------------------------------------
. Theatre Charge Maintenance Output JHS
.--------------------------------------------------------------------------
JCHG0000  BRANCH    FLDITMNO,JCHG0100,JCHG0200,JCHG0300,JCHG0400,JCHG0500:
                             JCHG0600,JCHG0700,JCHG0800,JCHG0900,JCHG1000:
                             JCHG1100,JCHG1200,JCHG1300,JCHG1400,JCHG1500:
                             JCHG1600,JCHG1700,JCHG1800,JCHG1900,JCHG2000:
                             JCHG2100,JCHG2200,JCHG2300,JCHG2400,JCHG2500:
                             JCHG2600,JCHG2700,JCHG2800,JCHG2900
          GOTO      JCHG9999
.
JCHG0100  MOVE      "CL",CATEGORY
          MOVE      TFCLM,CODE
          CALL      CODITM00
          GOTO      JCHG9999
.
JCHG0200  UNPACK    DIM127,D1,KEY1,DIM127
          MOVE      KEY1,F1
          MATCH     SP70,TFHFUND
          GOTO      JCHG9999 IF EQUAL
          PACK      KEY14,TFHFUND,ZERO,ZERO,ZERO,ZERO,SP70
          CALL      RDFUND1
          BRANCH    OVRCD,JCHG9999
          BRANCH    F1,JCHG0210,JCHG0220
          WRITE     HTMLFILE;TFHFUND;
          GOTO      JCHG9999
JCHG0210  WRITE     HTMLFILE;HFNAME;
          GOTO      JCHG9999
JCHG0220  WRITE     HTMLFILE;HFBAND;
          GOTO      JCHG9999
.
JCHG0300  UNPACK    DIM127,D1,KEY1,DIM127
          MOVE      KEY1,F1
          BRANCH    F1,JCHG0310
          WRITE     HTMLFILE;TFHFTAB;
          GOTO      JCHG9999
JCHG0310  PACK      KEY14,TFHFUND,TFHFTAB,SP70
          CALL      RDFUND1
          BRANCH    OVRCD,JCHG9999
          WRITE     HTMLFILE;HFNAME;
          GOTO      JCHG9999
.
JCHG0400  WRITE     HTMLFILE;TFDAYC;
          GOTO      JCHG9999
.
JCHG0500  WRITE     HTMLFILE;TFENDMBS;
          GOTO      JCHG9999
.
JCHG0600  WRITE     HTMLFILE;TFHF1;
          GOTO      JCHG9999
.
JCHG0700  WRITE     HTMLFILE;TFPAT1;
          GOTO      JCHG9999
.
JCHG0800  WRITE     HTMLFILE;TFHF2;
          GOTO      JCHG9999
.
JCHG0900  WRITE     HTMLFILE;TFPAT2;
          GOTO      JCHG9999
.
JCHG1000  WRITE     HTMLFILE;TFHF3;
          GOTO      JCHG9999
.
JCHG1100  WRITE     HTMLFILE;TFPAT3;
          GOTO      JCHG9999
.
JCHG1200  WRITE     HTMLFILE;TFHF4;
          GOTO      JCHG9999
.
JCHG1300  WRITE     HTMLFILE;TFPAT4;
          GOTO      JCHG9999
.
JCHG1400  WRITE     HTMLFILE;TFHF5;
          GOTO      JCHG9999
.
JCHG1500  WRITE     HTMLFILE;TFPAT5;
          GOTO      JCHG9999
.
JCHG1600  WRITE     HTMLFILE;TFHF6;
          GOTO      JCHG9999
.
JCHG1700  WRITE     HTMLFILE;TFPAT6;
          GOTO      JCHG9999
.
JCHG1800  COMPARE   ONE,TFNINV
          IF        @EQUAL
            WRITE     HTMLFILE;"<option value=",ONE," selected>":
                               TFNINV,"</option>"
          ELSE
            WRITE     HTMLFILE;"<option value=",ONE,">":
                               ONE,"</option>"
          ENDIF
.
          COMPARE   TWO,TFNINV
          IF        @EQUAL
            WRITE     HTMLFILE;"<option value=",TWO," selected>":
                               TFNINV,"</option>"
          ELSE
            WRITE     HTMLFILE;"<option value=",TWO,">":
                               TWO,"</option>"
          ENDIF
          GOTO      JCHG9999
.
JCHG1900  CALL      JCHGTB00
          GOTO      JCHG9999
.
JCHG2000  CALL      NEXJCH00
          GOTO      JCHG9999
.
JCHG2100  CALL      PREJCH00
          GOTO      JCHG9999
.
JCHG2200  MOVE      "TB",CATEGORY
          MOVE      TFENDMBS,CODE
          CALL      CODITM00
          GOTO      JCHG9999
.
JCHG2300  MOVE      "CL",CATEGORY
          MOVE      OPCHG001,CODE
          CALL      CODITM00
          GOTO      JCHG9999
.
JCHG2400  UNPACK    DIM127,D1,KEY1,DIM127
          MOVE      KEY1,F1
          MATCH     SP70,OPCHG002
          GOTO      JCHG9999 IF EQUAL
          PACK      KEY14,OPCHG002,ZERO,ZERO,ZERO,ZERO,SP4,SP70
          CALL      RDFUND1
          BRANCH    OVRCD,JCHG9999
          BRANCH    F1,JCHG2410,JCHG2420
          WRITE     HTMLFILE;OPCHG002;
          GOTO      JCHG9999
JCHG2410  WRITE     HTMLFILE;HFNAME;
          GOTO      JCHG9999
JCHG2420  WRITE     HTMLFILE;HFBAND;
          GOTO      JCHG9999
.
JCHG2500  UNPACK    DIM127,D1,KEY1,DIM127
          MOVE      KEY1,F1
          BRANCH    F1,JCHG2510
          WRITE     HTMLFILE;OPCHG027;
          GOTO      JCHG9999
JCHG2510  PACK      KEY14,OPCHG002,OPCHG027,SP70
          CALL      RDFUND1
          BRANCH    OVRCD,JCHG9999
          WRITE     HTMLFILE;HFNAME;
          GOTO      JCHG9999
.
JCHG2600  WRITE     HTMLFILE;OPCHG004;
          GOTO      JCHG9999
.
JCHG2700  WRITE     HTMLFILE;FILEFLAG;
          GOTO      JCHG9999
.
JCHG2800  WRITE     HTMLFILE;NEWFFLAG;
          GOTO      JCHG9999
.
JCHG2900  MOVE      ZERO,OVRCD
          TRAP      OVERCOND IF IO
          OPEN      JHSTF1A1,"newtfeaf"
          TRAPCLR   IO
          BRANCH    OVRCD,JCHG2940
.
          CALL      RSJHT1A1
          CALL      RKJHT1A1
          BRANCH    OVRCD,JCHG2940
          GOTO      JCHG2950
.
JCHG2940  WRITE     HTMLFILE;ZERO;          * New file empty of does not exist
          GOTO      JCHG9999
.
JCHG2950  WRITE     HTMLFILE;ONE;           * New file contains some records
          GOTO      JCHG9999
.
JCHG9999  RETURN
.
.------------------------------------------------------------
. Table of Theatre Charges File Details JHS
.------------------------------------------------------------
JCHGTB00  UNPACK    DIM127,D1,LINKPRG,DIM127
          UNPACK    DIM127,D1,LINKREP,DIM127
          UNPACK    DIM127,D1,LINKTEM,DIM127
.
          IF        NORECORD=0
            MOVE      "10",NORECORD       * Set Default No Records to Display
          ENDIF
          MOVE      ZERO,RECNUMB
          MOVE      ZERO,DISNUMB
.
          MATCH     SP70,OPCHG001
          GOTO      JCHGTB99 IF EQUAL
.
          MATCH     "N",FILEFLAG
          GOTO      JCHGTB10 IF EQUAL
.
          PACK      KEY23,OPCHG001,OPCHG002,OPCHG027,OPCHG004,SP70   * Current
          CALL      RDJHTFE1                                          * File
          COMPARE   ZERO,OVRCD
          GOTO      JCHGTB20 IF EQUAL
.
          PACK      KEY23,OPCHG001,OPCHG002,OPCHG027,OPCHG004,SP70   * Current
          CALL      RSJHTFE1                                         * File
JCHGTB05  CALL      RKJHTFE1                                         * Current
          BRANCH    OVRCD,JCHGTB99                                   * File
          GOTO      JCHGTB20
.
JCHGTB10  PACK      KEY23,OPCHG001,OPCHG002,OPCHG027,OPCHG004,SP70   * New File
          CALL      RDJHT1A1
          COMPARE   ZERO,OVRCD
          GOTO      JCHGTB20 IF EQUAL
.
          PACK      KEY23,OPCHG001,OPCHG002,OPCHG027,OPCHG004,SP70   * New File
          CALL      RSJHT1A1
JCHGTB15  CALL      RKJHT1A1                                         * New File
          BRANCH    OVRCD,JCHGTB99
.
JCHGTB20  MATCH     OPCHG001,TFCLM
          GOTO      JCHGTB99 IF NOT EQUAL
.
          MATCH     OPCHG002,TFHFUND
          GOTO      JCHGTB99 IF NOT EQUAL
.
          MATCH     OPCHG027,TFHFTAB
          GOTO      JCHGTB99 IF NOT EQUAL
.
          MATCH     OPCHG004,TFDAYC
          IF        !@EQUAL
            MATCH     "N",FILEFLAG
            GOTO      JCHGTB15 IF EQUAL
            GOTO      JCHGTB05
          ENDIF
.
          ADD       ONE,RECNUMB
          IF        STARTNUM>=RECNUMB
            MATCH     "N",FILEFLAG
            GOTO      JCHGTB15 IF EQUAL
            GOTO      JCHGTB05
          ENDIF
.
          CALL      JCHGRW00
          ADD       ONE,DISNUMB
          COMPARE   NORECORD,DISNUMB
          IF        !@EQUAL
            MATCH     "N",FILEFLAG
            GOTO      JCHGTB15 IF EQUAL
            GOTO      JCHGTB05
          ENDIF
.
JCHGTB99  RETURN
.
.------------------------------------------------------------
. Theatre Charges File Table (TABLE ROW)
.------------------------------------------------------------
JCHGRW00  MOVE      ZERO,TOTAL
          ADD       TFHF1,TOTAL
          ADD       TFPAT1,TOTAL
.
          MATCH     ANSD,TFDAYC
          IF        @EQUAL
            MOVE     "Yes",D3
          ELSE
            MOVE     "No ",D3
          ENDIF
.
          MOVE      TFENDMBS,DIM19               * Default MBS description
.
          MATCH     SP70,TFHFUND                 * Check Claim Code
          GOTO      JCHGRW10 IF EQUAL
.
          PACK      KEY14,TFHFUND,ZERO,ZERO,ZERO,ZERO,SP70
          CALL      RDFUND1
          BRANCH    OVRCD,JCHGRW50
.
          GOTO      JCHGRW20
.
JCHGRW10  PACK      KEY5,ANSC,ANSL,TFCLM,SP70
          CALL      RDCODE1
          BRANCH    OVRCD,JCHGRW50
.
          MOVE      TCFORM6,HFBAND
.
JCHGRW20  COMPARE   ZERO,HFBAND
          GOTO      JCHGRW50 IF EQUAL
.
          PACK      KEY5,ANST,ANSB,TFENDMBS
          CALL      RDCODE1
          BRANCH    OVRCD,JCHGRW50
          MOVE      TDESC,DIM19
.
JCHGRW50  WRITE     HTMLFILE;"<tr><td nowrap><A HREF='javascript:ShowLink":
                             "(#"",LINKPRG,"#.pbl":
                             "?reportno=",LINKREP:
                             "&template=",LINKTEM:
                             "&opchg001=",TFCLM:
                             "&opchg002=",TFHFUND:
                             "&opchg027=",TFHFTAB:
                             "&opchg004=",TFDAYC:
                             "&opchg005=",TFENDMBS:
                             "&fileflag=",FILEFLAG,"#")'>":
                             "<img src=../images/MaintenanceIcon.gif hspace=4":
                             " border=0 align=absmiddle>":
                             "</a>",DIM19,"</td>":
                             "<td>&nbsp;",TFHFUND,"</td>":
                             "<td>&nbsp;",TFHFTAB,"</td>":
                             "<td>&nbsp;",D3,"</td>":
                             "<td>&nbsp;",TFNINV,"</td>":
                             "<td>&nbsp;",TFPAT1,"</td>":
                             "<td>&nbsp;",TFHF1,"</td>":
                             "<td>&nbsp;",TOTAL,"</td>":
                             "</tr>"
.
JCHGRW99 RETURN
.-------------------------------------------------------------------------
. Link to Next Theatre Charges JHS
.-------------------------------------------------------------------------
NEXJCH00  MOVE      NORECORD,KEY2
          REP       " +",KEY2
          ASSIGN    STARTNUM+NORECORD,F3
          MOVE      F3,KEY3
          REP       " +",KEY3
          UNPACK    DIM127,D1,FLDPARA,DIM127
          MOVE      REPORTNO,F2
.
          WRITE     HTMLFILE;"patweb77.pbl":
                                 "?reportno=",F2:
                                 "&template=",FLDPARA:
                                 "&startnum=",KEY3:
                                 "&norecord=",KEY2:
                                 "&opchg001=",OPCHG001:
                                 "&opchg002=",OPCHG002:
                                 "&opchg027=",OPCHG027:
                                 "&opchg004=",OPCHG004:
                                 "&fileflag=",FILEFLAG;
.
          MATCH     "1",MENUFLAG
          IF        @EQUAL
            WRITE     HTMLFILE;"&menuflag=1";
          ENDIF
.
NEXJCH99  RETURN
.
.-------------------------------------------------------------
. Link to Prev Theatre Charges
.-------------------------------------------------------------
PREJCH00  MOVE      NORECORD,KEY2
          REP       " +",KEY2
          ASSIGN    STARTNUM-NORECORD,F3
          IF        F3<0
            MOVE      ZERO,F3
          ENDIF
          MOVE      F3,KEY3
          REP       " +",KEY3
          UNPACK    DIM127,D1,FLDPARA,DIM127
          MOVE      REPORTNO,F2
.
          WRITE     HTMLFILE;"patweb77.pbl":
                                 "?reportno=",F2:
                                 "&template=",FLDPARA:
                                 "&startnum=",KEY3:
                                 "&norecord=",KEY2:
                                 "&opchg001=",OPCHG001:
                                 "&opchg002=",OPCHG002:
                                 "&opchg027=",OPCHG027:
                                 "&opchg004=",OPCHG004:
                                 "&fileflag=",FILEFLAG;
.
          MATCH     "1",MENUFLAG
          IF        @EQUAL
            WRITE     HTMLFILE;"&menuflag=1";
          ENDIF
.
PREJCH99  RETURN
.
.-----------------------------------------------------------------
. Auto populate the previous misc items effective to date if blank
.-----------------------------------------------------------------
EDAT0000  PACK      KEY29,MSCHG001,MSCHG002,MSCHG034,MSCHG004,MSCHG020,SP70
          CALL      RDSMCHG1
          CALL      RDPMCHG1
          BRANCH    OVRCD,EDAT9999
.
          MATCH     MSCHG001,MCLMCOD
          GOTO      EDAT9999 IF NOT EQUAL
.
          MATCH     MSCHG002,MHFUND
          GOTO      EDAT9999 IF NOT EQUAL
.
          MATCH     MSCHG034,PTMCHFTT
          GOTO      EDAT9999 IF NOT EQUAL
.
          MATCH     MSCHG004,MCHARGE
          GOTO      EDAT9999 IF NOT EQUAL
.
          MATCH     SP70,PTMCETDT                * Exit if effective to date is
          GOTO      EDAT9999 IF NOT EQUAL        * already populated
.
          MOVE      MSCHG020,WORKDATE
          SUB       ONE,WORKDATE
          MOVE      WORKDATE,PTMCETDT                                           
.
          CALL      UPMCHG1
.
EDAT9999  RETURN
.
.******************************************************************************
. Auto populate the previous SX misc items effective to date if blank
.******************************************************************************
ENZD0000  PACK      KEY37,NZMCH001,NZMCH002,NZMCH003,NZMCH004,NZMCH005:
                          NZMCH006,SP70
          MATCH     "N",FILEFLAG
          IF        @EQUAL
            CALL      RSNZMC11
            CALL      RPNZMC11
          ELSE
            CALL      RSNZMCH1
            CALL      RPNZMCH1
          ENDIF
          BRANCH    OVRCD,ENZD9999
.
          MATCH     NZMCH001,NZMCHOSP
          GOTO      ENZD9999 IF NOT EQUAL
.
          MATCH     NZMCH002,NZMCCLMC
          GOTO      ENZD9999 IF NOT EQUAL
.
          MATCH     NZMCH003,NZMCCNTR
          GOTO      ENZD9999 IF NOT EQUAL
.
          MATCH     NZMCH004,NZMCFTAB
          GOTO      ENZD9999 IF NOT EQUAL
.
          MATCH     NZMCH005,NZMCMCHG
          GOTO      ENZD9999 IF NOT EQUAL
.
          MATCH     SP70,NZMCEEDT                * Exit if effective to date is
          GOTO      ENZD9999 IF NOT EQUAL        * already populated
.
          MOVE      NZMCH006,WORKDATE
          SUB       ONE,WORKDATE
          MOVE      WORKDATE,NZMCEEDT
.
          MATCH     "N",FILEFLAG
          IF        @EQUAL
            CALL      UPNZMC11                   * Update new file
          ELSE
            CALL      UPNZMCH1                   * Update current file
          ENDIF
.
ENZD9999  RETURN
+
.--------------------------------------------------------------------------
. User Group Favourite Charge Items Maintenance tags
.--------------------------------------------------------------------------
FVGP0000  BRANCH    FLDITMNO,FVGP0100,FVGP0200,FVGP0300,FVGP0400,FVGP0500:
                             FVGP0600,FVGP0700,FVGP0800,FVGP0900,FVGP1000:
                             FVGP1100,FVGP1200,FVGP1300,FVGP1400,FVGP1500:
                             FVGP1600,FVGP1700,FVGP1800,FVGP1900,FVGP2000:
                             FVGP2100,FVGP2200,FVGP2300,FVGP2400,FVGP2500:
                             FVGP2600,FVGP2700,FVGP2800,FVGP2900,FVGP3000:
                             FVGP3100,FVGP3200,FVGP3300,FVGP3400,FVGP3500:
                             FVGP3600,FVGP3700,FVGP3800,FVGP3900
.
          WRITE     HTMLFILE;"Invalid IBA Tag";
          GOTO      FVGP9999
.
FVGP0100  CALL      HSEL0000
          GOTO      FVGP9999
.
FVGP0200  MOVE      "w0",CATEGORY
          MOVE      PMUFUOGR,CODE
          CALL      CODITM00
          GOTO      FVGP9999
.
FVGP0300  WRITE     HTMLFILE;PMUFUSER; 
          GOTO      FVGP9999
.
FVGP0400  MOVE      "w4",CATEGORY
          MOVE      PMUFFAVG,CODE
          CALL      CODITM00
          GOTO      FVGP9999
.
FVGP0500  WRITE     HTMLFILE;PMUFFAVD;
          GOTO      FVGP9999
.
FVGP0600  MOVE      "w5",CATEGORY
          MOVE      PMUFGHED,CODE
          CALL      CODITM00
          GOTO      FVGP9999
.
FVGP0700  WRITE     HTMLFILE;PMUFCODE;
          GOTO      FVGP9999
.
FVGP0800  WRITE     HTMLFILE;PMUFQUAN;
          GOTO      FVGP9999
.
FVGP0900  CALL      HSELU000 
          GOTO      FVGP9999
.
FVGP1000  CALL      FGPLST00 
          GOTO      FVGP9999
.
FVGP1100  CALL      NEXTFV00 
          GOTO      FVGP9999
.
FVGP1200  CALL      PREVFV00 
          GOTO      FVGP9999
.
FVGP1300  WRITE     HTMLFILE;SHOWFLAG;
          GOTO      FVGP9999
.
FVGP1400  WRITE     HTMLFILE;NORECORD;
          GOTO      FVGP9999
.
FVGP1500  WRITE     HTMLFILE;FILTHOSP;
          GOTO      FVGP9999
.
FVGP1600  WRITE     HTMLFILE;FILTOCCG;
          GOTO      FVGP9999
.
FVGP1700  WRITE     HTMLFILE;FILTUSID;
          GOTO      FVGP9999
.
FVGP1800  WRITE     HTMLFILE;FILTFAVG;
          GOTO      FVGP9999
.
FVGP1900  CALL      HSELD000 
          GOTO      FVGP9999
.
FVGP2000  MOVE      "w0",CATEGORY
          COMPARE   ONE,SHOWFLAG
          IF        @EQUAL
            MOVE      FILTOCCG,CODE
          ELSE
            MOVE      SP70,CODE
          ENDIF
          CALL      CODITM00
          GOTO      FVGP9999
.
FVGP2100  COMPARE   ONE,SHOWFLAG
          IF        @EQUAL
            WRITE     HTMLFILE;FILTUSID;
          ENDIF
          GOTO      FVGP9999
.
FVGP2200  MOVE      "w4",CATEGORY
          COMPARE   ONE,SHOWFLAG
          IF        @EQUAL
            MOVE      FILTFAVG,CODE
          ELSE
            MOVE      SP70,CODE
          ENDIF
          CALL      CODITM00
          GOTO      FVGP9999
.
FVGP2300  WRITE     HTMLFILE;COPYHOSP;
          GOTO      FVGP9999
.
FVGP2400  WRITE     HTMLFILE;COPYOCCG;
          GOTO      FVGP9999
.
FVGP2500  WRITE     HTMLFILE;COPYUSID;
          GOTO      FVGP9999
.
FVGP2600  WRITE     HTMLFILE;COPYFAVG;
          GOTO      FVGP9999
.
FVGP2700  WRITE     HTMLFILE;COPYDFTG;
          GOTO      FVGP9999
.
FVGP2800  WRITE     HTMLFILE;COPYGHED;
          GOTO      FVGP9999
.
FVGP2900  WRITE     HTMLFILE;SRCHHOSP;
          GOTO      FVGP9999
.
FVGP3000  WRITE     HTMLFILE;SRCHOCCG;
          GOTO      FVGP9999
.
FVGP3100  WRITE     HTMLFILE;SRCHUSID;
          GOTO      FVGP9999
.
FVGP3200  WRITE     HTMLFILE;SRCHFAVG;
          GOTO      FVGP9999
.
FVGP3300  WRITE     HTMLFILE;SRCHGHED;
          GOTO      FVGP9999
.
FVGP3400  WRITE     HTMLFILE;SRCHCITM;
          GOTO      FVGP9999
.
FVGP3500  PACK      KEY3,PMUFHOSP,SP70
          CALL      RDPTHSP1
          IF        OVRCD=0 
            WRITE     HTMLFILE;PTHSNAME;
          ENDIF
          GOTO      FVGP9999
.
FVGP3600  WRITE     HTMLFILE;PMUFHOSP;
          GOTO      FVGP9999
.
FVGP3700  WRITE     HTMLFILE;PMUFUOGR;
          GOTO      FVGP9999
.
FVGP3800  WRITE     HTMLFILE;PMUFFAVG;
          GOTO      FVGP9999
.
FVGP3900  WRITE     HTMLFILE;PMUFGHED;
          GOTO      FVGP9999
.
FVGP9999  RETURN
.
.------------------------------------------------------------
. Hospital Selection - Add favourite group 
.------------------------------------------------------------
HSEL0000  PACK      KEY3,SP70
          CALL      RSPTHSP1
HSEL0100  CALL      RKPTHSP1
          BRANCH    OVRCD,HSEL9999
.
          PACK      KEY13,USERID,SP70                * All hospital access
          CALL      RDMLSEC1
          IF        OVRCD=1
            PACK      KEY13,USERID,PTHSHOSP,SP70     * This hospital access
            CALL      RDMLSEC1
            BRANCH    OVRCD,HSEL0100
          ENDIF
.
          PACK      KEY10,USERID,SP70
          CALL      RDWBSE1
.
          MOVE      PTHSNAME,KEY50
          PACK      KEY5,QUOTE,PTHSHOSP,QUOTE
          MATCH     WBSEHOSP,PTHSHOSP
          IF        @EQUAL
            WRITE     HTMLFILE;"<option value=",KEY5," selected>":
                               KEY50,"</option>"
          ELSE
            WRITE     HTMLFILE;"<option value=",KEY5,">",KEY50,"</option>"
          ENDIF
          GOTO      HSEL0100
.
HSEL9999  RETURN
.
.------------------------------------------------------------
. Hospital Selection - Update favourite group
.------------------------------------------------------------
HSELU000  PACK      KEY3,SP70
          CALL      RSPTHSP1
HSELU100  CALL      RKPTHSP1
          BRANCH    OVRCD,HSELU999
.
          PACK      KEY13,USERID,SP70                * All hospital access
          CALL      RDMLSEC1
          IF        OVRCD=1
            PACK      KEY13,USERID,PTHSHOSP,SP70     * This hospital access
            CALL      RDMLSEC1
            BRANCH    OVRCD,HSELU100
          ENDIF
.
          MOVE      PTHSNAME,KEY50
          PACK      KEY5,QUOTE,PTHSHOSP,QUOTE
          MATCH     PMUFHOSP,PTHSHOSP
          IF        @EQUAL
            WRITE     HTMLFILE;"<option value=",KEY5," selected>":
                               KEY50,"</option>"
          ELSE
            WRITE     HTMLFILE;"<option value=",KEY5,">",KEY50,"</option>"
          ENDIF
          GOTO      HSELU100
.
HSELU999  RETURN
.
.------------------------------------------------------------
. Hospital Selection with default from web user
.------------------------------------------------------------
HSELD000  PACK      KEY3,SP70
          CALL      RSPTHSP1
HSELD100  CALL      RKPTHSP1
          BRANCH    OVRCD,HSELD999
.
          PACK      KEY13,USERID,SP70                * All hospital access
          CALL      RDMLSEC1
          IF        OVRCD=1
            PACK      KEY13,USERID,PTHSHOSP,SP70     * This hospital access
            CALL      RDMLSEC1
            BRANCH    OVRCD,HSELD100
          ENDIF
.
          PACK      KEY10,USERID,SP70
          CALL      RDWBSE1
.
          MOVE      PTHSNAME,KEY50
          PACK      KEY5,QUOTE,PTHSHOSP,QUOTE
.
          COMPARE   ONE,SHOWFLAG
          IF        @EQUAL
            MATCH     FILTHOSP,PTHSHOSP
          ELSE
            MOVE      WBSEHOSP,FILTHOSP 
            MATCH     WBSEHOSP,PTHSHOSP 
          ENDIF
.
          IF        @EQUAL
            WRITE     HTMLFILE;"<option value=",KEY5," selected>":
                               KEY50,"</option>"
          ELSE
            WRITE     HTMLFILE;"<option value=",KEY5,">",KEY50,"</option>"
          ENDIF
          GOTO      HSELD100
.
HSELD999  RETURN
.
.------------------------------------------------------------
. Hospital Selection 
.------------------------------------------------------------
HSEL1000  PACK      KEY3,SP70
          CALL      RSPTHSP1
HSEL1020  CALL      RKPTHSP1
          BRANCH    OVRCD,HSELD999
.
          MOVE      PTHSNAME,KEY50
          PACK      KEY5,QUOTE,ACDMHOSP,QUOTE
.
          MATCH     ACDMHOSP,PTHSHOSP
          IF        @EQUAL
            WRITE     HTMLFILE;"<option value=",KEY5," selected>":
                               KEY50,"</option>"
          ELSE
            WRITE     HTMLFILE;"<option value=",KEY5,">",KEY50,"</option>"
          ENDIF
          GOTO      HSELD100
.
HSEL1999  RETURN
.
.------------------------------------------------------------
. Favourite User Group Charge Items Maintenance
.------------------------------------------------------------
FAVGRP00  MOVE      ZERO,EXIT
          RESET     UPDATETY
          MATCH     SP70,UPDATETY
          GOTO      FAVGRP60 IF EQUAL
.
          MATCH     "A",UPDATETY            * Add Formaction
          GOTO      FAVGRP10 IF EQUAL
.
          MATCH     "U",UPDATETY            * Update Formaction
          GOTO      FAVGRP20 IF EQUAL
.
          MATCH     "D",UPDATETY            * Delete Formaction
          GOTO      FAVGRP30 IF EQUAL
.
          MATCH     "C",UPDATETY            * Copy Item Formaction
          GOTO      FAVGRP40 IF EQUAL
.
          GOTO      FAVGRP93
.
.         ************ ADD FORMACTION ***********
.
FAVGRP10  PACK      KEY31,FVGRP001,FVGRP002,FVGRP003,FVGRP004:
                          FVGRP006,FVGRP007,SP70
          CALL      RDPMUFI1
          COMPARE   ZERO,OVRCD
          GOTO      FAVGRP91 IF EQUAL
.
          CALL      CLMVGP00                     * Clear File Variables
          CALL      MFVGRP00                     * Move cgi to file variables
.
          PACK      PMUFSPAR,SP70
.
          CALL      IBACLOCK
          PACK      KEY8,CCC,CYY,CMM,CDD         * Current Date
          REP       " 0",KEY8
          MOVE      KEY8,PMUFCDAT
          MOVE      CTIMEIS,PMUFCTIM
          MOVE      USERID,PMUFCUSR
.
          CALL      WRPMUFI1                     * Writes the data
          CALL      UPDFTG00                     * Update default group 
.
          MOVE      ZERO,EXIT
          GOTO      FAVGRP99
.
.         ************ UPDATE FORMACTION **********
.
FAVGRP20  PACK      KEY31,FVGRP001,FVGRP002,FVGRP003,FVGRP004:
                          FVGRP006,FVGRP007,SP70
          CALL      RDPMUFI1
          COMPARE   ONE,OVRCD
          GOTO      FAVGRP92 IF EQUAL
.
          CALL      MFVGRP00                     * Move cgi to file variables
.
          CALL      UPPMUFI1                     * Update the data
          CALL      UPDFTG00                     * Update default group
.
          MOVE      ZERO,EXIT
          GOTO      FAVGRP99
.
.         ************ DELETE FORMACTION **********
.
FAVGRP30  PACK      KEY31,FVGRP001,FVGRP002,FVGRP003,FVGRP004:
                          FVGRP006,FVGRP007,SP70
          CALL      RDPMUFI1
          COMPARE   ONE,OVRCD
          GOTO      FAVGRP92 IF EQUAL
.
          CALL      DEPMUFI1                     * Delete the data
.
          MOVE      ZERO,EXIT
          GOTO      FAVGRP99
.
.         ************ Copy Item FORMACTION **********
.
FAVGRP40  CALL      IBACLOCK
          PACK      KEY8,CCC,CYY,CMM,CDD       * Current Date
          REP       " 0",KEY8
          PACK      KEY31,COPYHOSP,COPYOCCG,COPYUSID,COPYFAVG,COPYGHED,SP70
FAVGRP42  CALL      RSPMUFI1
FAVGRP43  CALL      RKPMUFI1
          BRANCH    OVRCD,FAVGRP48
.
          MATCH     COPYHOSP,PMUFHOSP
          GOTO      FAVGRP48 IF NOT EQUAL
.
          MATCH     COPYOCCG,PMUFUOGR
          GOTO      FAVGRP48 IF NOT EQUAL
.
          MATCH     COPYUSID,PMUFUSER
          GOTO      FAVGRP48 IF NOT EQUAL
.
          MATCH     COPYFAVG,PMUFFAVG
          GOTO      FAVGRP48 IF NOT EQUAL
.
          MATCH     COPYGHED,PMUFGHED
          GOTO      FAVGRP48 IF NOT EQUAL
.
          PACK      SAVKEY31,PMUFHOSP,PMUFUOGR,PMUFUSER,PMUFFAVG,PMUFGHED:
                             PMUFCODE,SP70
.
          MOVE      FVGRP001,PMUFHOSP
          MOVE      FVGRP002,PMUFUOGR
          MOVE      FVGRP003,PMUFUSER
          MOVE      FVGRP004,PMUFFAVG
          MOVE      FVGRP006,PMUFGHED
.
          PACK      KEY31,PMUFHOSP,PMUFUOGR,PMUFUSER,PMUFFAVG,PMUFGHED:
                    PMUFCODE,SP70
          CALL      RDPMUFI1
          IF        OVRCD=0
            MATCH     FVGRP005,PMUFFAVD
            IF        !@EQUAL
              MOVE      FVGRP005,PMUFFAVD
              CALL      UPPMUFI1
            ENDIF
            MOVE      SAVKEY31,KEY31  
            GOTO      FAVGRP42
          ENDIF
.
          MOVE      FVGRP005,PMUFFAVD
.
          MOVE      KEY8,PMUFCDAT
          MOVE      CTIMEIS,PMUFCTIM
          MOVE      USERID,PMUFCUSR
.
          CALL      GDESC000                     * Get charge code description 
.
          CALL      WRPMUFI1 
          MOVE      SAVKEY31,KEY31  
          GOTO      FAVGRP42
.
FAVGRP48  CALL      UPDFTG00                     * Update default group
          MOVE      ZERO,EXIT
          GOTO      FAVGRP99
.
.         ************ DISPLAY FORMACTION **********
.
FAVGRP60  MOVE      "User Group Favourite Charge Items Maintenance",WEBTITLE
          PACK      KEY31,SRCHHOSP,SRCHOCCG,SRCHUSID,SRCHFAVG,SRCHGHED:
                          SRCHCITM,SP70
          CALL      RDPMUFI1
          IF        OVRCD=1
            UNPACK    SP70,PMUFUOGR,PMUFUSER,PMUFHOSP,PMUFFAVG,PMUFFAVD:
                           PMUFGHED,PMUFCODE,PMUFQUAN,PMUFCDAT,PMUFCTIM:
                           PMUFCUSR     
          ENDIF 
.
          CALL      WEBHED00   * Create Output File and Write HTML Page Header
          BRANCH    EXIT,FAVGRP99
          CALL      WEBBOD00                * Process Web Body
          CALL      WEBEND00                * Process End of HTML File
          MOVE      ONE,EXIT
          GOTO      FAVGRP99
.
FAVGRP91  MOVE      "Record already exists on file.",WEBTITLE
          CALL      WEBERR00
          MOVE      ONE,EXIT
          GOTO      FAVGRP99
.
FAVGRP92  MOVE      "Record does not exist on file.",WEBTITLE
          CALL      WEBERR00
          MOVE      ONE,EXIT
          GOTO      FAVGRP99
.
FAVGRP93  MOVE      "Invalid Form Action.",WEBTITLE
          CALL      WEBERR00
          MOVE      ONE,EXIT
          GOTO      FAVGRP99
.
FAVGRP99  RETURN
.
.--------------------------------------------------------------------------
. Get charge code description NZPMCHFD.NZMCDESC
.--------------------------------------------------------------------------
GDESC000  MOVE      SP70,EFFDATE1                 * Eff date for hospital
          PACK      CHRDESC1,SP70,SP70            * Desc for hospital
          MOVE      SP70,EFFDATE2                 * Eff date for blank hospital
          PACK      CHRDESC2,SP70,SP70            * Desc for blank hospital
          PACK      BLNK90,SP70,SP70
.
          PACK      KEY37,PMUFCODE,SP70
          CALL      RSNZMCH3
GDESC200  CALL      RKNZMCH3
          BRANCH    OVRCD,GDESC800
.
          MATCH     PMUFCODE,NZMCMCHG
          GOTO      GDESC800 IF NOT EQUAL
.
          MATCH     "1",NZMCACFL
          GOTO      GDESC200 IF EQUAL
.
          MATCH     PMUFHOSP,NZMCHOSP              * Match hospital
          IF        @EQUAL
            MATCH     EFFDATE1,NZMCEFDT            * Effective date start
            GOTO      GDESC200 IF LESS
            MOVE      NZMCDESC,CHRDESC1            * Charge Code Description
            MOVE      NZMCEFDT,EFFDATE1
            GOTO      GDESC200
          ENDIF
.
          MATCH     SP70,NZMCHOSP
          IF        @EQUAL
            MATCH     EFFDATE2,NZMCEFDT            * Effective date start
            GOTO      GDESC200 IF LESS
            MOVE      NZMCDESC,CHRDESC2            * Charge Code Description
            MOVE      NZMCEFDT,EFFDATE2
            GOTO      GDESC200
          ENDIF
.
          GOTO      GDESC200
.
GDESC800  MOVE      CHRDESC1,PMUFDESC
          MATCH     BLNK90,CHRDESC1
          IF        @EQUAL
            MOVE      CHRDESC2,PMUFDESC
          ENDIF
.
GDESC999  RETURN
.
.-------------------------------------------------------------------------------
. Clear favourite group variables
.-------------------------------------------------------------------------------
CLMVGP00  MOVE      SP70,PMUFUOGR
          MOVE      SP70,PMUFUSER
          MOVE      SP70,PMUFHOSP
          MOVE      SP70,PMUFFAVG
          MOVE      SP70,PMUFFAVD
          MOVE      SP70,PMUFGHED
          MOVE      SP70,PMUFCODE
          MOVE      SP70,PMUFQUAN
          MOVE      SP70,PMUFCDAT
          MOVE      SP70,PMUFCTIM
          MOVE      SP70,PMUFCUSR
          MOVE      SP70,PMUFDESC
          MOVE      SP70,PMUFSPAR
.
CLMVGP99  RETURN
+
.-------------------------------------------------------------------------------
. Move cgi variables to favourite group file variables
.-------------------------------------------------------------------------------
MFVGRP00  MATCH     Z70,FVGRP001
          IF        !@EQUAL
            MOVE      FVGRP001,PMUFHOSP
          ENDIF
.
          MATCH     Z70,FVGRP002
          IF        !@EQUAL
            MOVE      FVGRP002,PMUFUOGR
          ENDIF
.
          MATCH     Z70,FVGRP003
          IF        !@EQUAL
            MOVE      FVGRP003,PMUFUSER
          ENDIF
.
          MATCH     Z70,FVGRP004
          IF        !@EQUAL
            MOVE      FVGRP004,PMUFFAVG
          ENDIF
.
          MATCH     Z70,FVGRP005
          IF        !@EQUAL
            MOVE      FVGRP005,PMUFFAVD
          ENDIF
.
          MATCH     Z70,FVGRP006
          IF        !@EQUAL
            MOVE      FVGRP006,PMUFGHED
          ENDIF
.
          MATCH     Z70,FVGRP007
          IF        !@EQUAL
            MOVE      FVGRP007,PMUFCODE
          ENDIF
.
          MOVE      FVGRP008,PMUFQUAN
.
          MATCH     Z70,FVGRP009
          IF        !@EQUAL
            MOVE      FVGRP009,PMUFDESC
          ENDIF
.
MFVGRP99  RETURN
.
.------------------------------------------------------------------------
. Update defult group for all the rows with the same hospital, occupation
. group, user id, favourite group and sub group heading 
.------------------------------------------------------------------------
UPDFTG00  PACK      KEY31,FVGRP001,FVGRP002,FVGRP003,FVGRP004:
                          SP70
          CALL      RSPMUFI1
UPDFTG20  CALL      RKPMUFI1
          BRANCH    OVRCD,UPDFTG99
.
          MATCH     FVGRP001,PMUFHOSP
          GOTO      UPDFTG99 IF NOT EQUAL
.
          MATCH     FVGRP002,PMUFUOGR
          GOTO      UPDFTG99 IF NOT EQUAL
.
          MATCH     FVGRP003,PMUFUSER
          GOTO      UPDFTG99 IF NOT EQUAL
.
          MATCH     FVGRP004,PMUFFAVG
          GOTO      UPDFTG99 IF NOT EQUAL
.
.          MATCH     FVGRP006,PMUFGHED
.          GOTO      UPDFTG99 IF NOT EQUAL
.
.          MATCH     FVGRP005,PMUFFAVD
.          GOTO      UPDFTG20 IF EQUAL
.
          MOVE      FVGRP005,PMUFFAVD
          CALL      UPPMUFI1
.
          GOTO      UPDFTG20
.
UPDFTG99  RETURN
.
.------------------------------------------------------------
. Favourite group Search
.------------------------------------------------------------
FGPLST00  UNPACK    DIM127,D1,LINKPRG,DIM127
          UNPACK    DIM127,D1,LINKREP,DIM127
          UNPACK    DIM127,D1,LINKTEM,DIM127
          MOVE      ZERO,F2 
          UNPACK    DIM127,D1,DIM2,DIM127
          MOVE      DIM2,F2
          MOVE      F2,NORECORD 
          CALL      FGLSHD00
.
          COMPARE   ONE,SHOWFLAG
FGPLST05  IF        !@EQUAL
            GOTO      FGPLST99
          ENDIF 
.
          IF        NORECORD=0
            MOVE      "20",NORECORD       * Set Default No Records to Display
          ENDIF
          MOVE      ZERO,RECNUMB
          MOVE      ZERO,DISNUMB
.
          PACK      KEY31,FILTHOSP,SP70
          CALL      RSPMUFI1
FGPLST10  CALL      RKPMUFI1
          BRANCH    OVRCD,FGPLST99
.
          MATCH     SP70,FILTHOSP
          IF        !@EQUAL
            MATCH     FILTHOSP,PMUFHOSP
            GOTO      FGPLST99 IF NOT EQUAL
          ENDIF
.
          MATCH     SP70,FILTOCCG
          IF        !@EQUAL
            MATCH     FILTOCCG,PMUFUOGR
            GOTO      FGPLST10 IF NOT EQUAL
          ENDIF
.
          MATCH     SP70,FILTUSID
          IF        !@EQUAL
            MATCH     FILTUSID,PMUFUSER
            GOTO      FGPLST10 IF NOT EQUAL
          ENDIF
.
          MATCH     SP70,FILTFAVG
          IF        !@EQUAL
            MATCH     FILTFAVG,PMUFFAVG
            GOTO      FGPLST10 IF NOT EQUAL            
          ENDIF
.
FGPLST30  ADD       ONE,RECNUMB
          IF        STARTNUM>=RECNUMB
            GOTO      FGPLST10
          ENDIF
.
          CALL      WRTROW00
.
          ADD       ONE,DISNUMB
          COMPARE   NORECORD,DISNUMB
          GOTO      FGPLST10 IF NOT EQUAL
.
FGPLST99  RETURN
.
.-------------------------------------------------------------------------------
. Write favourite group heading                           
.-------------------------------------------------------------------------------
FGLSHD00  MOVE      ZERO,FORM1 
          WRITE     HTMLFILE;"<table width=100% border=1 cellspacing=0 ":
                      "cellpadding=1 style=#"table-layout: fixed;#">"
.
          WRITE     HTMLFILE;"<tr>";
          IF        IBCNMHOS=1 
            WRITE     HTMLFILE;"<td class=HeadingCell width=50>Hospital</td>";
          ENDIF 
          WRITE     HTMLFILE;"<td class=HeadingCell width=30>":
                      "Occupational Group</td>":
                      "<td class=HeadingCell width=30>User ID</td>":
                      "<td class=HeadingCell width=30>Favourite Group</td>":
                      "<td class=HeadingCell width=20>Default Group</td>":
                      "<td class=HeadingCell width=50>Sub-Group Heading</td>":
                      "<td class=HeadingCell width=90>Item</td>":
                      "<td class=HeadingCell width=20>Quantity</td>":
                      "</tr>"
FGLSHD99  RETURN
.
.-------------------------------------------------------------------------------
. Write favourite group line                                 
.-------------------------------------------------------------------------------
WRTROW00  PACK      KEY3,PMUFHOSP,SP70
          CALL      RDPTHSP1
          IF        OVRCD=1
            CALL      CLPATHSP
          ENDIF
.
          WRITE     HTMLFILE;"<tr valign=top>";
          IF        IBCNMHOS=1
            WRITE     HTMLFILE;"<td>",PTHSNAME,"</td>";
          ENDIF
. 
          PACK      KEY5,CATw0,PMUFUOGR,SP70
          CALL      RDCODE1
          IF        OVRCD=1
            MOVE      PMUFUOGR,PTCDLDES
          ENDIF
          WRITE     HTMLFILE;"<td>",PTCDLDES,"</td>";
.
          PACK      KEY10,PMUFUSER
          CALL      RDWBSE1
          IF        OVRCD=1
            MOVE      PMUFUSER,WBSENAM
          ENDIF
          WRITE     HTMLFILE;"<td>",WBSENAM,"</td>";
.
          PACK      KEY5,CATw4,PMUFFAVG,SP70
          CALL      RDCODE1
          IF        OVRCD=1
            MOVE      PMUFFAVG,PTCDLDES
          ENDIF
          WRITE     HTMLFILE;"<td>",PTCDLDES,"</td>";
.
          WRITE     HTMLFILE;"<td>",PMUFFAVD,"</td>";
.
          PACK      KEY5,CATw5,PMUFGHED,SP70
          CALL      RDCODE1
          IF        OVRCD=1
            MOVE      PMUFGHED,PTCDLDES
          ENDIF
          WRITE     HTMLFILE;"<td>",PTCDLDES,"</td>";
.
          CALL      CHGITD00
          WRITE     HTMLFILE;"<td><a href='javascript:UpdateFavGroupLink(":
                             "#"",LINKPRG,".pbl?":
                             "&reportno=",LINKREP:
                             "&template=",LINKTEM:
                             "&srchhosp=",PMUFHOSP:
                             "&srchoccg=",PMUFUOGR:
                             "&srchusid=",PMUFUSER:
                             "&srchfavg=",PMUFFAVG:
                             "&srchghed=",PMUFGHED:
                             "&srchcitm=",PMUFCODE,"#")'>";
          WRITE     HTMLFILE;"<img src=../images/MaintenanceIcon.gif":
                             " class=Icon></a> ":
                             CHRITMDS,"</td>";
.
          WRITE     HTMLFILE;"<td>",PMUFQUAN,"</td>";
.
          WRITE     HTMLFILE;"<tr>"
.
WRTROW99  RETURN
.
.-------------------------------------------------------------------------------
. Retrieve charge item description                                 
.-------------------------------------------------------------------------------
CHGITD00  MOVE      PMUFCODE,CHRITMDS 
.
          IF        CFEETYP=FIVE
            PACK      KEY37,PMUFCODE,SP70
            CALL      RSNZMCH3
CHGITD20    CALL      RKNZMCH3
            BRANCH    OVRCD,CHGITD99
.
            MATCH     PMUFCODE,NZMCMCHG
            GOTO      CHGITD99 IF NOT EQUAL
.
            MATCH     "1",NZMCACFL
            GOTO      CHGITD20 IF EQUAL
.
            MOVE      NZMCDESC,CHRITMDS
          ELSE
            PACK      KEY9,PMUFCODE,SP70
            IF        IBCNMHOS=1
              PACK      KEY3,WBSEHOSP,SP70
              CALL      RDPTHSP1
              BRANCH    OVRCD,CHGITD30
              PACK      KEY29,PTHSDCLM,SP6,SP3,KEY9,CURRDATE,SP10
            ELSE
CHGITD30      PACK      KEY29,PTCNDCLM,SP6,SP3,KEY9,CURRDATE,SP10
            ENDIF
.
            CALL      PATMCHRD
            IF        EXIT=ZERO
              MOVE      MDESC,CHRITMDS
            ENDIF
          ENDIF
.
CHGITD99  RETURN
.
.------------------------------------------------------------
. Next Favourite Group list
.------------------------------------------------------------
NEXTFV00  CALL      SETLNK00            * Set up Link
          MOVE      NORECORD,KEY2
          REP       " +",KEY2
          ASSIGN    STARTNUM+NORECORD,F3
          MOVE      F3,KEY3
          REP       " +",KEY3
          UNPACK    DIM127,D1,FLDPARA,DIM127
.
          WRITE     HTMLFILE;"patweb77.pbl?reportno=19":
                             "&template=",FLDPARA:
                             "&startnum=",KEY3:
                             "&norecord=",KEY2:
                             HTMLLINK;
.
          REP       "+ ",KEY3
.
NEXTFV99  RETURN
.
.------------------------------------------------------------
. Previous Favourite Group list
.------------------------------------------------------------
PREVFV00  CALL      SETLNK00            * Set up Link
          MOVE      NORECORD,KEY2
          REP       " +",KEY2
          ASSIGN    STARTNUM-NORECORD,F3
          IF        F3<0
            MOVE      ZERO,F3
          ENDIF
          MOVE      F3,KEY3
          REP       " +",KEY3
          UNPACK    DIM127,D1,FLDPARA,DIM127
.
          WRITE     HTMLFILE;"patweb77.pbl?reportno=19":
                             "&template=",FLDPARA:
                             "&startnum=",KEY3:
                             "&norecord=",KEY2:
                             HTMLLINK;
.
          REP       "+ ",KEY3
.
PREVFV99  RETURN
+
.------------------------------------------------------------
. Setup Link Details for Favourite Group list
.------------------------------------------------------------
SETLNK00  REP       " +",FILTHOSP
          REP       " +",FILTOCCG
          REP       " +",FILTUSID
          REP       " +",FILTFAVG
.
          CLEAR     HTMLLINK
          APPEND    "&filthosp=",HTMLLINK
          APPEND    FILTHOSP,HTMLLINK
          APPEND    "&filtoccg=",HTMLLINK
          APPEND    FILTOCCG,HTMLLINK
          APPEND    "&filtusid=",HTMLLINK
          APPEND    FILTUSID,HTMLLINK
          APPEND    "&filtfavg=",HTMLLINK
          APPEND    FILTFAVG,HTMLLINK
          APPEND    "&showflag=1",HTMLLINK
          RESET     HTMLLINK
.
          REP       "+ ",FILTHOSP
          REP       "+ ",FILTOCCG
          REP       "+ ",FILTUSID
          REP       "+ ",FILTFAVG
.
SETLNK99  RETURN
.
.---------------------------------------------------------------------------
. Validate Default Group
.---------------------------------------------------------------------------
VALDEF00  CALL      XMLHED00
          BRANCH    EXIT,VALDEF99
.
          PACK      KEY31,FVGRP001,FVGRP002,FVGRP003,SP70
          CALL      RSPMUFI1
VALDEF10  CALL      RKPMUFI1
          BRANCH    OVRCD,VALDEF40
.
          MATCH     FVGRP001,PMUFHOSP
          GOTO      VALDEF40 IF NOT EQUAL
.
          MATCH     FVGRP002,PMUFUOGR
          GOTO      VALDEF40 IF NOT EQUAL
.
          MATCH     FVGRP003,PMUFUSER
          GOTO      VALDEF40 IF NOT EQUAL
.
          MATCH     FVGRP004,PMUFFAVG
          GOTO      VALDEF10 IF EQUAL
.
          MATCH     "Yes",PMUFFAVD
          GOTO      VALDEF10 IF NOT EQUAL
.
          GOTO      VALDEF50
.
VALDEF40  WRITE     HTMLFILE;"<RETURN_VALUE TYPE=SIMPLE>":
                             ZERO:
                             "</RETURN_VALUE>"
.
          GOTO      VALDEF98
.
VALDEF50  WRITE     HTMLFILE;"<RETURN_VALUE TYPE=SIMPLE>":
                             ONE:
                             "</RETURN_VALUE>"
          GOTO      VALDEF98
.
VALDEF98  CALL      XMLEND00
VALDEF99  RETURN
+
.------------------------------------------------------------------------------
. Billing Defaults for Admission Maintenance - patbdeaf file
.------------------------------------------------------------------------------
BDEF0000  BRANCH    NOBDEAX1,BDEF9500       * Error if patbdeaf file not found
.
          RESET     UPDTTYPE
          MATCH     SP1,UPDTTYPE            * Display formaction
          GOTO      BDEF4000 IF EQUAL
.
          MATCH     "A",UPDTTYPE            * Add formaction
          GOTO      BDEF1000 IF EQUAL
.
          MATCH     "U",UPDTTYPE            * Update formaction
          GOTO      BDEF2000 IF EQUAL
.
          MATCH     "D",UPDTTYPE            * Delete formaction
          GOTO      BDEF3000 IF EQUAL
.
          GOTO      BDEF9300
.
.
.         ************ ADD FORMACTION ***********
.
BDEF1000  MOVE      ZERO,EXIT
          MOVE      PTBDE002,VALFDATE
          MOVE      PTBDE003,VALTDATE
          PACK      KEY58,PTBDE001,PTBDE005,PTBDE006,PTBDE007,PTBDE004:
                          PTBDE002,SP70
          MOVE      KEY58,SAVKEY58
          CALL      VBDDT000               * Validate effective dates overlaps
          BRANCH    EXIT,BDEF9400
.
          MOVE      SAVKEY58,KEY58
          CALL      RDPTBDE1                                        
          COMPARE   ZERO,OVRCD             * Record already exists?
          GOTO      BDEF9200 IF EQUAL      * Yes, display error message
.
          CALL      CLPTBE00               * No,initialize patbdeaf fields
          CALL      MVPTBE00               * Move input vars to patdbeaf fields
          PACK      PTBECDAT,CCC,CYY,CMM,CDD
          REP       " 0",PTBECDAT                * Systen date
          CLOCK     TIME,PTBECTIM                * System time
          MOVE      USERID,PTBECUID              * web user id
          MOVE      SP70,PTBEUDAT
          MOVE      SP70,PTBEUTIM
          MOVE      SP70,PTBEUUID

          CALL      WRPTBDE1               * Write new record to patdbeaf table
.
          CALL      UPEDT000       * Auto update prev record effective end date
.
          GOTO      BDEF9999
.
.         ************ UPDATE FORMACTION **********
.
BDEF2000  MOVE      ZERO,EXIT
          MOVE      PTBDE002,VALFDATE
          MOVE      PTBDE003,VALTDATE
          PACK      KEY58,PTBDE001,PTBDE005,PTBDE006,PTBDE007,PTBDE004:
                          PTBDE002,SP70
          MOVE      KEY58,SAVKEY58
          CALL      VBDDT000                * Validate effective dates overlaps
          BRANCH    EXIT,BDEF9400
.
          MOVE      SAVKEY58,KEY58
          CALL      RDPTBDE1                * Is the record found?
          BRANCH    OVRCD,BDEF9100          * No, Display error message
          CALL      MVPTBE00                * Yes,save input variables
          PACK      PTBEUDAT,CCC,CYY,CMM,CDD
          REP       " 0",PTBEUDAT                * Systen date
          CLOCK     TIME,PTBEUTIM                * System time
          MOVE      USERID,PTBEUUID              * web user id

          CALL      UPPTBDE1                * Update record
.
          GOTO      BDEF9999
.
.         ************ DELETE FORMACTION **********
.
BDEF3000  MOVE      ZERO,EXIT
          PACK      KEY58,PTBDE001,PTBDE005,PTBDE006,PTBDE007,PTBDE004:
                          PTBDE002,SP70
          CALL      RDPTBDE1                * Is the record found?
          BRANCH    OVRCD,BDEF9100          * No, Display error message
          CALL      DEPTBDE1                * Yes, Delete record
.
          GOTO      BDEF9999
.
.         ************ DISPLAY FORMACTION **********
.
BDEF4000  MOVE      ZERO,EXIT
          PACK      KEY58,PTBDE001,PTBDE005,PTBDE006,PTBDE007,PTBDE004:
                          PTBDE002,SP70
          CALL      RDPTBDE1
          IF        OVRCD=1
            CALL      CLPTBE00              * Clear all the file variables
          ENDIF
.
          CLEAR     WEBTITLE
          MOVE      "Patient Billing Defaults Maintenance",WEBTITLE
          RESET     WEBTITLE
.
          CALL      WEBHED00                * Output File & Write HTML Pg Header
          BRANCH    EXIT,BDEF9999
.
          CALL      WEBBOD00                * Process Web Body
.
          CALL      WEBEND00                * Process End of HTML File
.
          MOVE      ONE,EXIT
          GOTO      BDEF9999
.
.         ************ DISPLAY ERROR MESSAGE **********
.
BDEF9100  MOVE      "Billing Default record does not exist",WEBTITLE
          CALL      WEBERR00
          MOVE      ONE,EXIT
          GOTO      BDEF9999
.
BDEF9200  MOVE      "Billing Default record exists",WEBTITLE
          CALL      WEBERR00
          MOVE      ONE,EXIT
          GOTO      BDEF9999
.
BDEF9300  MOVE      "Invalid Form Action.",WEBTITLE
          CALL      WEBERR00
          MOVE      ONE,EXIT
          GOTO      BDEF9999
.
BDEF9400  MOVE      "Invalid Effective From/To Date (Overlap).",WEBTITLE
          CALL      WEBERR00
          MOVE      ONE,EXIT
          GOTO      BDEF9999
.
BDEF9500  MOVE      "Billing Defaults file not found.",WEBTITLE
          CALL      WEBERR00
          MOVE      ONE,EXIT
          GOTO      BDEF9999
.
BDEF9999  RETURN
+
.------------------------------------------------------------------------
.   Clear Billing Defaults table fields
.------------------------------------------------------------------------
CLPTBE00  MOVE      SP70,PTBEHOSP
          MOVE      SP70,PTBESDTE
          MOVE      SP70,PTBEEDTE
          MOVE      SP70,PTBEVSID
          MOVE      SP70,PTBECLMC
          MOVE      SP70,PTBEHFND
          MOVE      SP70,PTBEHFTB
          MOVE      SP70,PTBEILOS
          MOVE      ZERO,PTBETLOS
          MOVE      SP70,PTBECSMX
          MOVE      SP70,PTBECPAY
          MOVE      SP70,PTBEDRGC
          MOVE      SP70,PTBEDRGV
          MOVE      SP70,PTBEADMN
          MOVE      SP70,PTBECARE
          MOVE      SP70,PTBEPRGM
          MOVE      SP70,PTBEPILL
          MOVE      SP70,PTBEMBSI
          MOVE      SP70,PTBEALER
          PACK      PTBESPAR,SP70,SP70
.
CLPTBE99  RETURN
.
.--------------------------------------------------------------------------
. Auto populate previous Billing Default End date if blank
.--------------------------------------------------------------------------
UPEDT000  MOVE      KEY58,SAVKEY50
          CALL      RSPTBDE1               * Check for the same Billing Default
          CALL      RPPTBDE1               * with an earlier effective from
          BRANCH    OVRCD,UPEDT999         * date
.
          PACK      KEY50,PTBEHOSP,PTBECLMC,PTBEHFND,PTBEHFTB,PTBEVSID,SP20
          MATCH     SAVKEY50,KEY50
          GOTO      UPEDT999 IF NOT EQUAL   * Not matching,exit 
.
          MATCH     SP70,PTBEEDTE           * Effective end date already on 
          GOTO      UPEDT999 IF NOT EQUAL   * previous Billing Default,exit
.
.--------- If previous record exists then that record should be automatically
.--------- end-dated with the date begin set to 1 day prior to the new Start
.--------- Date.  
          MOVE      PTBDE002,WORKDATE        
          SUB       ONE,WORKDATE            * Calculate prev record End date
          MOVE      WORKDATE,PTBEEDTE
.
          PACK      PTBEUDAT,CCC,CYY,CMM,CDD
          REP       " 0",PTBEUDAT                * Systen date
          CLOCK     TIME,PTBEUTIM                * System time
          MOVE      USERID,PTBEUUID              * web user id
.
          CALL      UPPTBDE1                * Update the prev record 
.
UPEDT999  RETURN
.--------------------------------------------------------------------------
. Billing Defaults Maintenance Output tags
.--------------------------------------------------------------------------
BILD0000  BRANCH    FLDITMNO,BILD0010,BILD0020,BILD0030,BILD0040,BILD0050:
                             BILD0060,BILD0070,BILD0080,BILD0090,BILD0100:
                             BILD0110
          GOTO      BILD9999
.
BILD0010  CALL      HOSPL000           * Hospital list
          GOTO      BILD9999
.
BILD0020  GOTO      BILD9999
.
BILD0030  CALL      PRGML000           * Program Code List             
          GOTO      BILD9999
.
BILD0040  CALL      BDTB0000           * Billing Defaults Table output
          GOTO      BILD9999
.
BILD0050  CALL      NEXTBD00
          GOTO      BILD9999 
.
BILD0060  CALL      PREVBD00
          GOTO      BILD9999
.
BILD0070  WRITE     HTMLFILE;PTBDE001;    * Filter Hospital
          GOTO      BILD9999
.
BILD0080  MATCH     Z70,PTBDE004
          IF        @EQUAL
            MOVE      SP70,PTBDE004
          ENDIF
          UNPACK    DIM127,D1,KEY1,DIM127
          MOVE      KEY1,F1
          BRANCH    F1,BILD0081
          WRITE     HTMLFILE;PTBDE004;    * Filter Reason for admission
          GOTO      BILD9999
BILD0081  MATCH     SP70,PTBDE004
          GOTO      BILD9999 IF EQUAL
          PACK      KEY33,ANSB,ANSR,ANSA,PTBDE004,SP70
          CALL      RDPMVSC1
          BRANCH    OVRCD,BILD9999
          WRITE     HTMLFILE;PMVCPTRM;    * Description
          GOTO      BILD9999
.
BILD0090  MOVE      "CL",CATEGORY
          MOVE      PTBDE005,CODE         * Filter Claim Type
          CALL      CODITM00
          GOTO      BILD9999
.
BILD0100  MATCH     Z70,PTBDE006
          IF        @EQUAL
            MOVE      SP70,PTBDE006
          ENDIF
          UNPACK    DIM127,D1,KEY1,DIM127
          MOVE      KEY1,F1
          BRANCH    F1,BILD0101
          WRITE     HTMLFILE;PTBDE006;    * Filter Health Fund code
          GOTO      BILD9999
BILD0101  MATCH     SP70,PTBDE006
          GOTO      BILD9999 IF EQUAL
          PACK      KEY14,PTBDE006,ZERO,ZERO,ZERO,ZERO,SP4,SP70
          CALL      RDFUND1
          BRANCH    OVRCD,BILD9999
          WRITE     HTMLFILE;HFNAME;      * Health Fund Name
          GOTO      BILD9999
.
BILD0110  MATCH     Z70,PTBDE007
          IF        @EQUAL
            MOVE      SP70,PTBDE007
          ENDIF 
          UNPACK    DIM127,D1,KEY1,DIM127
          MOVE      KEY1,F1
          BRANCH    F1,BILD0111
          WRITE     HTMLFILE;PTBDE007;    * Filter Health Fund table level code
          GOTO      BILD9999
BILD0111  MATCH     SP70,PTBDE006
          GOTO      BILD9999 IF EQUAL
          MATCH     SP70,PTBDE007
          GOTO      BILD9999 IF EQUAL
          PACK      KEY14,PTBDE006,PTBDE007,SP70
          CALL      RDFUND1
          BRANCH    OVRCD,BILD9999
          WRITE     HTMLFILE;HFNAME;      * Health Fund table level name
          GOTO      BILD9999
.
BILD9999  RETURN
+
.--------------------------------------------------------------------------
. Hospital List
.--------------------------------------------------------------------------
HOSPL000  UNPACK    SP70,PTHSNAME
          PACK      KEY3,SP70
          CALL      RSPTHSP1
HOSPL100  CALL      RKPTHSP1
          BRANCH    OVRCD,HOSPL999
.
          MATCH     PTBDE001,PTHSHOSP
          IF        @EQUAL
            WRITE     HTMLFILE;"<option value=#"",PTHSHOSP,"#" selected>":
                               PTHSNAME,"</option>"
          ELSE
            WRITE     HTMLFILE;"<option value=#"",PTHSHOSP,"#">":
                               PTHSNAME,"</option>"
          ENDIF
          GOTO      HOSPL100
.
HOSPL999  RETURN
+
.--------------------------------------------------------------------------
. Billing Reason for Admission list
.--------------------------------------------------------------------------
BRADL000  MOVE      "BRA",DIM3
          PACK      KEY33,DIM3,SP70
          CALL      RSPMVSC1
BRADL100  CALL      RKPMVSC1
          BRANCH    OVRCD,BRADL999
.
          MATCH     DIM3,PMVCVSID
          GOTO      BRADL100 IF NOT EQUAL
.
          MATCH     PTBDE004,PMVCCODE
          IF        @EQUAL
            WRITE     HTMLFILE;"<option value=#"",PMVCCODE,"#" selected>":
                               PMVCPTRM,"</option>"
          ELSE
            WRITE     HTMLFILE;"<option value=#"",PMVCCODE,"#">":
                               PMVCPTRM,"</option>"
          ENDIF
          GOTO      BRADL100                
.
BRADL999  RETURN
+
.--------------------------------------------------------------------------
. Program Code List                    
.--------------------------------------------------------------------------
PRGML000  UNPACK    SP70,PMPGDESC
          PACK      KEY8,SP70
          CALL      RSPMPRG1
PRGML100  CALL      RKPMPRG1
          BRANCH    OVRCD,PRGML999
.
          MATCH     "1",PMPGACTV
          GOTO      PRGML100 IF EQUAL        * don't display inactive codes
.
          MATCH     PTBDE016,PMPGCODE
          IF        @EQUAL
            WRITE     HTMLFILE;"<option value=#"",PMPGCODE,"#" selected>":
                               PMPGDESC,"</option>"
          ELSE
            WRITE     HTMLFILE;"<option value=#"",PMPGCODE,"#">":
                               PMPGDESC,"</option>"
          ENDIF
          GOTO      PRGML100
.
PRGML999  RETURN
+
.--------------------------------------------------------------------------
. Billing Defaults  - Table List Output tag
.--------------------------------------------------------------------------
BDTB0000  UNPACK    DIM127,D1,LINKPRG,DIM127
          UNPACK    DIM127,D1,LINKREP,DIM127
          UNPACK    DIM127,D1,LINKTEM,DIM127
.
          CALL      BDTBHD00              * Display table headings
          IF        NORECORD=0
            MOVE      PTCNNRTD,NORECORD      * Set Default No Records to Display
          ENDIF
          MOVE      ZERO,RECNUMB
          MOVE      ZERO,DISNUMB
          MOVE      ZERO,LOOPCNTR
.
          REP       "~ ",PTBDE004
          REP       "~ ",PTBDE005
          REP       "~ ",PTBDE006
          REP       "~ ",PTBDE007
.
          MATCH     SP70,PTBDE005
          GOTO      BDTB9999 IF EQUAL          * Claim code is mandatory
.
          PACK      KEY58,PTBDE001,PTBDE005,PTBDE006,SP70
          CALL      RSPTBDE1
BDTB1000  CALL      RKPTBDE1
          BRANCH    OVRCD,BDTB9999
.
.  Write record number in a comment to keep apache listening if no matches
.  are found per 100 records
.
          ADD       ONE,LOOPCNTR
.
          IF        (LOOPCNTR > 100)
            WRITE     HTMLFILE;"<!--",LOOPCNTR,"-->"
            MOVE      ZERO,LOOPCNTR
          ENDIF
.
          MATCH     SP70,PTBDE001                     * Filter Hospital
          IF        !@EQUAL
            MATCH     PTBDE001,PTBEHOSP
            GOTO      BDTB9999 IF NOT EQUAL
          ENDIF
.
          MATCH     PTBDE005,PTBECLMC                 * claim code mandatory
          GOTO      BDTB9999 IF NOT EQUAL
.
          MATCH     SP70,PTBDE006                     * Filter Health Fund
          IF        !@EQUAL
            MATCH     PTBDE006,PTBEHFND              
            GOTO      BDTB9999 IF NOT EQUAL
.
            MATCH     SP70,PTBDE007                     * Filter HF Table level
            IF        !@EQUAL
              MATCH     PTBDE007,PTBEHFTB
              GOTO      BDTB9999 IF NOT EQUAL 
            ENDIF 
          ENDIF
.
          MATCH     SP70,PTBDE004                     * Filter Value Set ID
          IF        !@EQUAL
            MATCH     PTBDE004,PTBEVSID              
            GOTO      BDTB1000 IF NOT EQUAL
          ENDIF
.
          ADD       ONE,RECNUMB
          IF        STARTNUM>=RECNUMB
            GOTO      BDTB1000
          ENDIF
.
          CALL      BDTRW000
          MOVE      ZERO,LOOPCNTR
.
          ADD       ONE,DISNUMB
          COMPARE   NORECORD,DISNUMB
          IF        !@EQUAL
            GOTO      BDTB1000
          ENDIF
          GOTO      BDTB9999
.
BDTB9999  CALL      NOMORE00      * Display No More Records Message
          RETURN
+
.-----------------------------------------------------------
. Billing Defaults List Column Headings
.-----------------------------------------------------------
BDTBHD00  WRITE    HTMLFILE;"<tr>":
                   "<td class=HeadingCell>Effective Start Date</td>":
                   "<td class=HeadingCell>Effective End Date</td>":
                   "<td class=HeadingCell>Reason for Admission Code</td>":
                   "<td class=HeadingCell>Claim Type</td>":
                   "<td class=HeadingCell>Health Fund</td>":
                   "<td class=HeadingCell>HF Level</td>":
                   "<td class=HeadingCell>Intended Length of Stay</td>":
                   "<td class=HeadingCell>Admission Type</td>":
                   "<td class=HeadingCell>Care Type</td>";
.
          IF       IBCNMHOS=1
            WRITE    HTMLFILE;"<td class=HeadingCell>Hospital</td>";
          ENDIF
.
          WRITE    HTMLFILE;"</tr>";
.
BDTBHD99  RETURN
+
.------------------------------------------------------------
. Billing Defaults table (TABLE ROW)
.------------------------------------------------------------
BDTRW000  PACK      KEY3,PTBEHOSP,SP70     * Get Hospital name
          CALL      RDPTHSP1
          IF        OVRCD=1
            CALL      CLPATHSP
          ENDIF
.
.-------- Format Effective Start/End Date fields
          UNPACK    SP70,DIM12A,DIM12B 
.
          MATCH     PTBESDTE,SP70
          GOTO      BDTRW010 IF EQUAL
.
          UNPACK    PTBESDTE,CCENT,CYEAR,CMON,CDAY
          MOVE      CMON,F2
          LOAD      MTHNAM3,F2,JAN,FEB,MAR,APR,MAY,JUN,JUL,AUG,SEP,OCT,NOV,DEC
          PACK      DIM12A,CDAY,SP1,MTHNAM3,SP1,CCENT,CYEAR
.
BDTRW010  MATCH     PTBEEDTE,SP70
          GOTO      BDTRW020 IF EQUAL
.
          UNPACK    PTBEEDTE,CCENT,CYEAR,CMON,CDAY
          MOVE      CMON,F2
          LOAD      MTHNAM3,F2,JAN,FEB,MAR,APR,MAY,JUN,JUL,AUG,SEP,OCT,NOV,DEC
          PACK      DIM12B,CDAY,SP1,MTHNAM3,SP1,CCENT,CYEAR
.
.-------- Get Description for Reason of Admission
BDTRW020  MOVE      "BRA",DIM3
          PACK      KEY33,DIM3,PTBEVSID,SP70
          CALL      RDPMVSC1
          IF        OVRCD=1
            MOVE      SP70,PMVCPTRM
          ENDIF 
.
          UNPACK    SP70,DIM20A,DIM20B,DIM20C
          UNPACK    SP70,DIM20D

.-------- Get description for Claim Type - CAT CL
          PACK      KEY5,ANSC,ANSL,PTBECLMC
          CALL      RDCODE1
          IF        OVRCD=0
            MOVE      TDESC,DIM20A
          ENDIF
.
.-------- Get description for Length of stay - CAT VI
          PACK      KEY5,ANSV,ANSI,PTBEILOS
          CALL      RDCODE1
          IF        OVRCD=0
            MOVE      TDESC,DIM20B
          ENDIF
.
.-------- Get description for Admission Type - CAT A
          PACK      KEY5,ANSA,SP1,PTBEADMN
          CALL      RDCODE1
          IF        OVRCD=0
            MOVE      TDESC,DIM20C
          ENDIF
.
.-------- Get description for Care Type - CAT CC
          PACK      KEY5,ANSC,ANSC,PTBECARE
          CALL      RDCODE1
          IF        OVRCD=0
            MOVE      TDESC,DIM20D
          ENDIF
.
.------- Get Health fund name/table level
          MOVE      SP70,DIM40A
          MOVE      SP70,DIM40B
         
          PACK      KEY14,PTBEHFND,ZERO,ZERO,ZERO,ZERO,SP4,SP70
          CALL      RDFUND1
          IF        OVRCD=0
            MOVE      HFNAME,DIM40A
            PACK      KEY14,PTBEHFND,PTBEHFTB,SP70
            CALL      RDFUND1
            IF        OVRCD=0
              MOVE      HFNAME,DIM40B
            ENDIF
          ENDIF
.
.-------- Write table row 
          WRITE     HTMLFILE;"<tr><td nowrap><A HREF='javascript:ShowLink":
                             "(#"",LINKPRG,"#.pbl":
                             "?reportno=",LINKREP:
                             "&template=",LINKTEM:
                             "&ptbde001=",PTBEHOSP:
                             "&ptbde002=",DIM12A:
                             "&ptbde004=",PTBEVSID:
                             "&ptbde005=",PTBECLMC:
                             "&ptbde006=",PTBEHFND:
                             "&ptbde007=",PTBEHFTB,"#")'>":
                             "<img src=../images/MaintenanceIcon.gif ":
                             "class=Icon></a>":
                             DIM12A,"</td>":
                             "<td>",DIM12B,"</td>":
                             "<td>",PMVCPTRM,"</td>":
                             "<td>",DIM20A,"</td>":
                             "<td>",DIM40A,"</td>":
                             "<td>",DIM40B,"</td>":
                             "<td>",DIM20B,"</td>":
                             "<td>",DIM20C,"</td>":
                             "<td>",DIM20D,"</td>";
          IF        IBCNMHOS=1
            WRITE     HTMLFILE;"<td>",PTHSNAME,"</td>";
          ENDIF
          WRITE     HTMLFILE;"</tr>";
.
BDTRW999  RETURN
+         
.-------------------------------------------------------------------------
. Link to Next Billing Defaults
.-------------------------------------------------------------------------
NEXTBD00  MOVE      NORECORD,KEY2
          REP       " +",KEY2
          ASSIGN    STARTNUM+NORECORD,F3
          MOVE      F3,KEY3
          REP       " +",KEY3
          UNPACK    DIM127,D1,FLDPARA,DIM127
          MOVE      REPORTNO,F2
.
          REP       " +",PTBDE001
          REP       " +",PTBDE004
          REP       " +",PTBDE005
          REP       " +",PTBDE006
          REP       " +",PTBDE007
.
          WRITE     HTMLFILE;"patweb77.pbl":
                                 "?reportno=",F2:
                                 "&template=",FLDPARA:
                                 "&startnum=",KEY3:
                                 "&norecord=",KEY2:
                                 "&ptbde001=",PTBDE001:
                                 "&ptbde004=",PTBDE004:
                                 "&ptbde005=",PTBDE005:
                                 "&ptbde006=",PTBDE006:
                                 "&ptbde007=",PTBDE007;
.
          REP       "+ ",PTBDE001
          REP       "+ ",PTBDE004
          REP       "+ ",PTBDE005
          REP       "+ ",PTBDE006
          REP       "+ ",PTBDE007
.
NEXTBD99  RETURN
+
.-------------------------------------------------------------
. Link to Prev Billing Defaults
.-------------------------------------------------------------
PREVBD00  MOVE      NORECORD,KEY2
          REP       " +",KEY2
          ASSIGN    STARTNUM-NORECORD,F3
          IF        F3<0
            MOVE      ZERO,F3
          ENDIF
          MOVE      F3,KEY3
          REP       " +",KEY3
          UNPACK    DIM127,D1,FLDPARA,DIM127
          MOVE      REPORTNO,F2
.
          REP       " +",PTBDE001
          REP       " +",PTBDE004
          REP       " +",PTBDE005
          REP       " +",PTBDE006
          REP       " +",PTBDE007
.
          WRITE     HTMLFILE;"patweb77.pbl":
                                 "?reportno=",F2:
                                 "&template=",FLDPARA:
                                 "&startnum=",KEY3:
                                 "&norecord=",KEY2:
                                 "&ptbde001=",PTBDE001:
                                 "&ptbde004=",PTBDE004:
                                 "&ptbde005=",PTBDE005:
                                 "&ptbde006=",PTBDE006:
                                 "&ptbde007=",PTBDE007;
.
          REP       "+ ",PTBDE001
          REP       "+ ",PTBDE004
          REP       "+ ",PTBDE005
          REP       "+ ",PTBDE006
          REP       "+ ",PTBDE007
.
PREVBD99  RETURN
.
.------------------------------------------------------------------------------
. Claim Type / Clinical Document Mapping maintenance
.------------------------------------------------------------------------------
CTDM0000  BRANCH    NOACCDMA,CTDM9500       * Error if accdmaaf file not found
.
          RESET     UPDTTYPE
          MATCH     SP1,UPDTTYPE            * Display formaction
          GOTO      CTDM5000 IF EQUAL
.
          MATCH     "A",UPDTTYPE            * Add formaction
          GOTO      CTDM1000 IF EQUAL
.
          MATCH     "U",UPDTTYPE            * Update formaction
          GOTO      CTDM2000 IF EQUAL
.
          MATCH     "D",UPDTTYPE            * Delete formaction
          GOTO      CTDM3000 IF EQUAL
.
          GOTO      CTDM9300
.
.
.         ************ ADD FORMACTION ***********
.
CTDM1000  MOVE      ZERO,EXIT
.
          CALL      ADCDMA00               * Add visit comments
          BRANCH    EXIT,CTDM9999 
.
          GOTO      CTDM9999
.
.         ************ UPDATE FORMACTION **********
.
CTDM2000  MOVE      ZERO,EXIT
          PACK      KEY16,CDMAP009,CDMAP010,CDMAP011,CDMAP012,CDMAP013:
                          CDMAP014,SP70
          CALL      RDACDMA1
          BRANCH    OVRCD,CTDM9100
.
          IF        IBCNMHOS=1
            MOVE      CDMAP001,ACDMHOSP
          ELSE
            MOVE      SP70,ACDMHOSP
          ENDIF    
.
          MOVE      CDMAP002,ACDMCCLM
          MOVE      CDMAP003,ACDMSYST
          MOVE      CDMAP004,ACDMCTYP
          MOVE      CDMAP005,ACDMILOS
          MOVE      CDMAP006,ACDMDTYP
          MOVE      CDMAP007,ACDMIACT          
.
          MOVE      USERID,ACDMUUSR
          CALL      IBACLOCK
          PACK      ACDMUDTE,CCC,CYY,CMM,CDD
          REP       " 0",ACDMUDTE
          MOVE      CTIMEIS,ACDMUTIM
          CALL      UPACDMA1
          BRANCH    OVRCD,CTDM9200  
.
          GOTO      CTDM9999
.
.         ************ DELETE FORMACTION **********
.
CTDM3000  MOVE      ZERO,EXIT
          PACK      KEY16,CDMAP009,CDMAP010,CDMAP011,CDMAP012,CDMAP013:
                          CDMAP014,SP70
          CALL      RDACDMA1
          BRANCH    OVRCD,CTDM9100
.
          MOVE      "1",ACDMDELT
          MOVE      USERID,ACDMDUSR
          CALL      IBACLOCK
          PACK      ACDMDDTE,CCC,CYY,CMM,CDD
          REP       " 0",ACDMDDTE
          MOVE      CTIMEIS,ACDMDTIM
          CALL      UPACDMA1
.
          GOTO      CTDM9999
.
.         ************ DISPLAY FORMACTION **********
.
CTDM5000  MOVE      ZERO,EXIT
          PACK      KEY16,CDMAP001,CDMAP002,CDMAP003,CDMAP004,CDMAP005:
                          CDMAP006,SP70
          CALL      RDACDMA1
.
          CLEAR     WEBTITLE
          MOVE      "Claim Type Clinical Document Mappingaintenance",WEBTITLE
          RESET     WEBTITLE
.
          CALL      WEBHED00                * Output File & Write HTML Pg Header
          BRANCH    EXIT,CTDM9999
.
          CALL      WEBBOD00                * Process Web Body
.
          CALL      WEBEND00                * Process End of HTML File
.
          MOVE      ONE,EXIT
          GOTO      CTDM9999
.
.         ************ DISPLAY ERROR MESSAGE **********
.
CTDM9100  MOVE      "Claim Clinical Doc Mapping record does not exist",WEBTITLE
          CALL      WEBERR00
          MOVE      ONE,EXIT
          GOTO      CTDM9999
.
CTDM9200  MOVE      "Claim Clinical Doc Mapping record record exists",WEBTITLE
          CALL      WEBERR00
          MOVE      ONE,EXIT
          GOTO      CTDM9999
.
CTDM9300  MOVE      "Invalid Form Action.",WEBTITLE
          CALL      WEBERR00
          MOVE      ONE,EXIT
          GOTO      CTDM9999
.
CTDM9500  MOVE      "Claim Clinical Doc Mapping table not found.",WEBTITLE
          CALL      WEBERR00
          MOVE      ONE,EXIT
          GOTO      CTDM9999
.
CTDM9999  RETURN
.
.------------------------------------------------------------------------------
. Claim Type Clinical Document Mapping Maintenance tags
.------------------------------------------------------------------------------
CTCD0000  BRANCH    FLDITMNO,CTCD0100,CTCD0200,CTCD0300,CTCD0400,CTCD0500:
                             CTCD0600,CTCD0700,CTCD0800,CTCD0900,CTCD1000:
                             CTCD1100,CTCD1200,CTCD1300,CTCD1400,CTCD1500:
                             CTCD1600,CTCD1700,CTCD1800,CTCD1900,CTCD2000:
                             CTCD2100,CTCD2200
.
          WRITE     HTMLFILE;"Invalid IBA Tag";
          GOTO      CTCD9999
.
CTCD0100  CALL      HSELD000            * Hospital ID
          GOTO      CTCD9999
.
CTCD0200  WRITE     HTMLFILE;FILTHOSP;
          GOTO      CTCD9999
.
CTCD0300  WRITE     HTMLFILE;FILTCLAM;
          GOTO      CTCD9999
.
CTCD0400  WRITE     HTMLFILE;FILTSYST;
          GOTO      CTCD9999
.
CTCD0500  WRITE     HTMLFILE;FILTDCTY;
          GOTO      CTCD9999
.
CTCD0600  WRITE     HTMLFILE;FILTACTV;
          GOTO      CTCD9999
.
CTCD0700  MOVE      "CL",CATEGORY
          MOVE      FILTCLAM,CODE
          CALL      CODITM00
          GOTO      CTCD9999
.
CTCD0800  MOVE      "wi",CATEGORY
          MOVE      FILTDCTY,CODE
          CALL      CODITM00
          GOTO      CTCD9999
.
CTCD0900  WRITE     HTMLFILE;SHOWFLAG;
          GOTO      CTCD9999
.
CTCD1000  CALL      CCDMAP00     
          GOTO      CTCD9999
.
CTCD1100  CALL      NXTCCM00
          GOTO      CTCD9999
.
CTCD1200  CALL      PRVCCM00
          GOTO      CTCD9999
.
CTCD1300  CALL      HSEL1000           * Hospital ID
          GOTO      CTCD9999
.
CTCD1400  MOVE      "CL",CATEGORY
          MOVE      ACDMCCLM,CODE
          CALL      CODITM00
          GOTO      CTCD9999
.
CTCD1500  WRITE     HTMLFILE;ACDMSYST;
          GOTO      CTCD9999
.
CTCD1600  MOVE      "CC",CATEGORY
          MOVE      ACDMCTYP,CODE
          CALL      CODITM00
          GOTO      CTCD9999
.
CTCD1700  MOVE      "VI",CATEGORY
          MOVE      ACDMILOS,CODE
          CALL      CODITM00
          GOTO      CTCD9999
.
CTCD1800  MOVE      "wi",CATEGORY
          MOVE      ACDMDTYP,CODE
          CALL      CODITM00
          GOTO      CTCD9999
.
CTCD1900  WRITE     HTMLFILE;ACDMIACT;
          GOTO      CTCD9999
.
CTCD2000  WRITE     HTMLFILE;ACDMHOSP;
          GOTO      CTCD9999
.
CTCD2100  WRITE     HTMLFILE;ACDMDELT;
          GOTO      CTCD9999
.
CTCD2200  MOVE      "wi",CATEGORY
          MOVE      SP70,CODE
          CALL      CODITM00
          GOTO      CTCD9999
.
CTCD9999  RETURN
.
.------------------------------------------------------------------------------
. Initialize  claim type clinical doc mapping
.------------------------------------------------------------------------------
INCDMA00  MOVE      SP70,ACDMDELT
          MOVE      USERID,ACDMCUSR
          MOVE      CURRDATE,ACDMCDTE
          MOVE      CURRTIME,ACDMCTIM
          MOVE      SP70,ACDMUUSR
          MOVE      SP70,ACDMUDTE
          MOVE      SP70,ACDMUTIM
          MOVE      SP70,ACDMDUSR
          MOVE      SP70,ACDMDDTE
          MOVE      SP70,ACDMDTIM
.
INCDMA99  RETURN
.
.------------------------------------------------------------------------------
. Inserting new datas into the claim type clinical doc mapping
.------------------------------------------------------------------------------
ADCDMA00  MOVE      ZERO,EXIT
.
          CALL      IBACLOCK
          PACK      CURRDATE,CCC,CYY,CMM,CDD
          REP       " 0",CURRDATE
          MOVE      CTIMEIS,CURRTIME
.
          CALL      ADCDST00
          CALL      CLACCDMA
.
          IF        IBCNMHOS=1
            MOVE      CDMAP001,ACDMHOSP
          ELSE
            MOVE      SP70,ACDMHOSP
          ENDIF
.
          MOVE      CDMAP002,ACDMCCLM
          MOVE      CDMAP003,ACDMSYST
          MOVE      CDMAP007,ACDMIACT
.
          CALL      INCDMA00
.        
          MOVE      SP70,ACDMCTYP
          MOVE      SP70,ACDMILOS           
          MOVE      SP70,ACDMDTYP            
.
. Care type is selected
.
ADCDMA20  IF        MULTCNT1 = 0
            MOVE      SP70,ACDMCTYP 
          ELSE
            MOVE      ZERO,CNT1
            WHILE     CNT1 < MULTCNT1
              ADD       ONE,CNT1 
              MOVE      MULT1ARR[CNT1],ACDMCTYP
              CALL      ADCTYP00
            DO
            GOTO      ADCDMA99
          ENDIF
.
. Intended LOS is selected. Care type is not selected
.           
ADCDMA40  IF        MULTCNT2 = 0
            MOVE      SP70,ACDMILOS
          ELSE
            MOVE      ZERO,CNT2
            WHILE     CNT2 < MULTCNT2
              ADD       ONE,CNT2
              MOVE      MULT2ARR[CNT2],ACDMILOS
              CALL      ADILOS00
            DO
            GOTO      ADCDMA99
          ENDIF
.
. Document type is selected. Care type/Intended LOS are not selected
.
ADCDMA60  IF        MULTCNT3 = 0
            MOVE      SP70,ACDMDTYP
          ELSE
            MOVE      ZERO,CNT3
            WHILE     CNT3 < MULTCNT3
              ADD       ONE,CNT3
              MOVE      MULT3ARR[CNT3],ACDMDTYP
              CALL      WACDMA00
            DO
            GOTO      ADCDMA99
          ENDIF
.
. Care type/Intended LOS/Document type are not not selected
.
          CALL      WACDMA00 
.
ADCDMA99  RETURN
.
.------------------------------------------------------------------------------
. Insert data for one set of care type and all data for Intended LOS
. Document type
.------------------------------------------------------------------------------
ADCTYP00  IF        MULTCNT2 = 0
            MOVE      SP70,ACDMILOS
          ELSE
            MOVE      ZERO,CNT2
            WHILE     CNT2 < MULTCNT2
              ADD       ONE,CNT2
              MOVE      MULT2ARR[CNT2],ACDMILOS
              CALL      ADILOS00
            DO
            GOTO      ADCTYP99
          ENDIF
.
          IF        MULTCNT3 = 0
            MOVE      SP70,ACDMDTYP
          ELSE
            MOVE      ZERO,CNT3
            WHILE     CNT3 < MULTCNT3
              ADD       ONE,CNT3
              MOVE      MULT3ARR[CNT3],ACDMDTYP
              CALL      WACDMA00
            DO
            GOTO      ADCTYP99
          ENDIF
.
          CALL      WACDMA00
.
ADCTYP99  RETURN
.
.------------------------------------------------------------------------------
. Insert data for one set of Intended LOS and Document type
.------------------------------------------------------------------------------
ADILOS00  IF        MULTCNT3 = 0
            MOVE      SP70,ACDMDTYP
          ELSE
            MOVE      ZERO,CNT3
            WHILE     CNT3 < MULTCNT3
              ADD       ONE,CNT3
              MOVE      MULT3ARR[CNT3],ACDMDTYP
              CALL      WACDMA00
            DO
            GOTO      ADILOS99
          ENDIF
.
          CALL      WACDMA00
.
ADILOS99  RETURN
.
.------------------------------------------------------------------------------
. Write out accdmaaf data
.------------------------------------------------------------------------------
WACDMA00  PACK      KEY16,ACDMHOSP,ACDMCCLM,ACDMSYST,ACDMCTYP,ACDMILOS:
                          ACDMDTYP,SP70
. 
          CALL      RDACDMA1
          IF        OVRCD = 1
            CALL      WRACDMA1              * Write Record
            GOTO      WACDMA99
          ENDIF
.
. Update record if already existed
.
          CALL      INCDMA00
          CALL      UPACDMA1
.
WACDMA99  RETURN
.
.------------------------------------------------------------------------------
. Set the multiple codes array when the All option is selected 
.------------------------------------------------------------------------------
ADCDST00  IF        MULTCNT1 <> 1
            GOTO      ADCDST20
          ENDIF
          MATCH     SP70,MULT1ARR[1]
          GOTO      ADCDST20 IF NOT EQUAL
.
. All codes is selected for care type, set all the codes to array
.  
          MOVE      ZERO,MULTCNT1
          MOVE      SP70,MULT1ARR[1] 
.
          MOVE      "CC",DIM2
          PACK      KEY5,DIM2,SP70
          CALL      RDSCODE1
ADCDST10  CALL      RDKCODE1
          BRANCH    OVRCD,ADCDST20
.
          MATCH     DIM2,TCODE
          GOTO      ADCDST20 IF NOT EQUAL
.
          MATCH     "I",PTCOACTV
          GOTO      ADCDST10 IF EQUAL
.
          ADD       ONE,MULTCNT1
          MOVE      ACODE,MULT1ARR[MULTCNT1]
.
          GOTO      ADCDST10
.
ADCDST20  IF        MULTCNT2 <> 1
            GOTO      ADCDST40
          ENDIF
          MATCH     SP70,MULT2ARR[1]
          GOTO      ADCDST40 IF NOT EQUAL
.
. All codes is selected for intended LOS, set all the codes to array
.  
          MOVE      ZERO,MULTCNT2
          MOVE      SP70,MULT2ARR[1] 
.
          MOVE      "VI",DIM2
          PACK      KEY5,DIM2,SP70
          CALL      RDSCODE1
ADCDST30  CALL      RDKCODE1
          BRANCH    OVRCD,ADCDST40
.
          MATCH     DIM2,TCODE
          GOTO      ADCDST40 IF NOT EQUAL
.
          MATCH     "I",PTCOACTV
          GOTO      ADCDST30 IF EQUAL
. 
          ADD       ONE,MULTCNT2
          MOVE      ACODE,MULT2ARR[MULTCNT2] 
.
          GOTO      ADCDST30 
.
ADCDST40  IF        MULTCNT3 <> 1
            GOTO      ADCDST99
          ENDIF
          MATCH     SP70,MULT3ARR[1]
          GOTO      ADCDST99 IF NOT EQUAL
.
. All codes is selected for document type, set all the codes to array
.
          MOVE      ZERO,MULTCNT3
          MOVE      SP70,MULT3ARR[1] 
.
          MOVE      "wi",DIM2
          PACK      KEY5,DIM2,SP70
          CALL      RDSCODE1
ADCDST50  CALL      RDKCODE1
          BRANCH    OVRCD,ADCDST99
.
          MATCH     DIM2,TCODE
          GOTO      ADCDST99 IF NOT EQUAL
.
          MATCH     "I",PTCOACTV
          GOTO      ADCDST50 IF EQUAL
. 
          ADD       ONE,MULTCNT3
          MOVE      ACODE,MULT3ARR[MULTCNT3] 
.
          GOTO      ADCDST50 
.
ADCDST99  RETURN
.
.--------------------------------------------------------------------------
. Retrieve Claim type clinical document mapping details list
.--------------------------------------------------------------------------
CCDMAP00  UNPACK    DIM127,D1,LINKPRG,DIM127
          UNPACK    DIM127,D1,LINKREP,DIM127
          UNPACK    DIM127,D1,LINKTEM,DIM127
.
          IF        NORECORD=0
            MOVE     PTCNNRTD,NORECORD       * Set Default No Records to Display
          ENDIF
          MOVE      ZERO,RECNUMB
          MOVE      ZERO,DISNUMB
.
          IF        IBCNMHOS = 1
            PACK      KEY16,FILTHOSP,FILTCLAM,FILTSYST,SP70
            CALL      RSACDMA1
          ELSE
            PACK      KEY16,FILTCLAM,FILTSYST,SP70
            CALL      RSACDMA2
          ENDIF 
CCDMAP20  IF        IBCNMHOS = 1
            CALL      RKACDMA1
          ELSE
            CALL      RKACDMA2
          ENDIF
          BRANCH    OVRCD,CCDMAP90
.
          IF        IBCNMHOS = 1 
            MATCH     SP70,FILTHOSP
            IF        !@EQUAL & !@EOS
              MATCH     FILTHOSP,ACDMHOSP
              GOTO      CCDMAP90 IF NOT EQUAL
            ENDIF 
          ENDIF
.
          MATCH     SP70,FILTCLAM
          IF        !@EQUAL
            MATCH     FILTCLAM,ACDMCCLM
            GOTO      CCDMAP90 IF NOT EQUAL
          ENDIF
.
          MATCH     SP70,FILTSYST
          IF        !@EQUAL
            MATCH     FILTSYST,ACDMSYST
            GOTO      CCDMAP20 IF NOT EQUAL
          ENDIF
.
CCDMAP40  MATCH     SP70,FILTDCTY
          IF        !@EQUAL
            MATCH     FILTDCTY,ACDMDTYP
            GOTO      CCDMAP20 IF NOT EQUAL
          ENDIF
.
          MATCH     "1",FILTACTV
          IF        @EQUAL
            MATCH     "1",ACDMIACT
            GOTO      CCDMAP20 IF EQUAL
          ENDIF
.
          ADD       ONE,RECNUMB
          IF        STARTNUM>=RECNUMB
            GOTO      CCDMAP20
          ENDIF
.
          CALL      CCDMPL00
          ADD       ONE,DISNUMB
          COMPARE   NORECORD,DISNUMB
CCDMA800  IF        !@EQUAL
            GOTO      CCDMAP20
          ENDIF
          GOTO      CCDMAP99
.
CCDMAP90  CALL      NOMORE00      * Display No More Records Message
.
CCDMAP99  RETURN
.
.--------------------------------------------------------------------------
. Retrieve Claim type clinical document mapping line
.--------------------------------------------------------------------------
CCDMPL00  MOVE      SP70,PTHSNAME
          IF        IBCNMHOS = 1 
            PACK      KEY3,ACDMHOSP,SP70
            CALL      RDPTHSP1
          ENDIF
.
          MOVE      SP70,CCLMDESC
          MOVE      "CL",CATEGORY
          MOVE      ACDMCCLM,CODE
          CALL      GETCOD00
          IF        OVRCD = 0
            MOVE      TDESC,CCLMDESC
          ENDIF
.
          MOVE      SP70,SYSTDESC
          MATCH     "I",ACDMSYST
          IF        @EQUAL
            MOVE      "Inpatient",SYSTDESC
          ENDIF
          MATCH     "E",ACDMSYST
          IF        @EQUAL
            MOVE      "Emergency",SYSTDESC
          ENDIF
          MATCH     "O",ACDMSYST
          IF        @EQUAL
            MOVE      "Outpatient",SYSTDESC
          ENDIF
          MATCH     "P",ACDMSYST
          IF        @EQUAL
            MOVE      "Private Practice",SYSTDESC
          ENDIF
.
          MOVE      SP70,CTYPDESC
          MOVE      "CC",CATEGORY
          MOVE      ACDMCTYP,CODE
          CALL      GETCOD00
          IF        OVRCD = 0
            MOVE      TDESC,CTYPDESC
          ENDIF
.
          MOVE      SP70,ILOSDESC
          MOVE      "VI",CATEGORY
          MOVE      ACDMILOS,CODE
          CALL      GETCOD00
          IF        OVRCD = 0
            MOVE      TDESC,ILOSDESC
          ENDIF
.
          MOVE      SP70,DTYPDESC
          MOVE      "wi",CATEGORY
          MOVE      ACDMDTYP,CODE
          CALL      GETCOD00
          IF        OVRCD = 0
            MOVE      TDESC,DTYPDESC
          ENDIF
.          
          MOVE      "Yes",IACTDESC
          MATCH     "1",ACDMIACT
          IF        @EQUAL
            MOVE      "No",IACTDESC 
          ENDIF    
.
          MOVE      "Yes",DELTDESC
          MATCH     "1",ACDMDELT
          IF        @EQUAL
            MOVE      "No",DELTDESC
          ENDIF
.
          MOVE      SP70,CUSRNAME
          MATCH     SP70,ACDMCUSR
          IF        !@EQUAL 
            PACK      KEY10,ACDMCUSR,SP70
            CALL      RDWBSE1
            IF        OVRCD=0
              MOVE      WBSENAM,CUSRNAME
            ELSE
              MOVE      ACDMCUSR,CUSRNAME
            ENDIF  
          ENDIF
.
          MOVE      SP70,CDTEDESC
          MATCH     SP70,ACDMCDTE
          IF        !@EQUAL
            UNPACK    ACDMCDTE,CCENT,CYEAR,CMON,CDAY
            MOVE      CMON,F2
            LOAD      MTHNAM3,F2,JAN,FEB,MAR,APR,MAY,JUN,JUL,AUG,SEP,OCT,NOV,DEC
            PACK      CDTEDESC,CDAY,SP1,MTHNAM3,SP1,CCENT,CYEAR
          ENDIF
.
          MOVE      SP70,UUSRNAME
          MATCH     SP70,ACDMUUSR
          IF        !@EQUAL
            PACK      KEY10,ACDMUUSR,SP70
            CALL      RDWBSE1
            IF        OVRCD=0
              MOVE      WBSENAM,UUSRNAME
            ELSE
              MOVE      ACDMUUSR,UUSRNAME
            ENDIF
          ENDIF
.
          MOVE      SP70,UDTEDESC
          MATCH     SP70,ACDMUDTE
          IF        !@EQUAL
            UNPACK    ACDMUDTE,CCENT,CYEAR,CMON,CDAY
            MOVE      CMON,F2
            LOAD      MTHNAM3,F2,JAN,FEB,MAR,APR,MAY,JUN,JUL,AUG,SEP,OCT,NOV,DEC
            PACK      UDTEDESC,CDAY,SP1,MTHNAM3,SP1,CCENT,CYEAR
          ENDIF
.
          MOVE      SP70,DUSRNAME
          MATCH     SP70,ACDMDUSR
          IF        !@EQUAL
            PACK      KEY10,ACDMDUSR,SP70
            CALL      RDWBSE1
            IF        OVRCD=0
              MOVE      WBSENAM,DUSRNAME
            ELSE
              MOVE      ACDMDUSR,DUSRNAME
            ENDIF
          ENDIF
.
          MOVE      SP70,DDTEDESC
          MATCH     SP70,ACDMDDTE
          IF        !@EQUAL
            UNPACK    ACDMDDTE,CCENT,CYEAR,CMON,CDAY
            MOVE      CMON,F2
            LOAD      MTHNAM3,F2,JAN,FEB,MAR,APR,MAY,JUN,JUL,AUG,SEP,OCT,NOV,DEC
            PACK      DDTEDESC,CDAY,SP1,MTHNAM3,SP1,CCENT,CYEAR
          ENDIF
.
          MOVE      SP70,PTHSNAME
          IF        IBCNMHOS = 1 
            PACK      KEY3,ACDMHOSP,SP70
            CALL      RDPTHSP1
            WRITE     HTMLFILE;"<tr><td nowrap>":
                               "<a HREF='javascript:ModifyClaimDocMapping":
                               "(#"",LINKPRG,"#.pbl":
                               "?reportno=",LINKREP:
                               "&template=",LINKTEM:
                               "&cdmap001=",ACDMHOSP:
                               "&cdmap002=",ACDMCCLM:
                               "&cdmap003=",ACDMSYST:
                               "&cdmap004=",ACDMCTYP:
                               "&cdmap005=",ACDMILOS:
                               "&cdmap006=",ACDMDTYP,"#")'>":
                               "<img src=../images/MaintenanceIcon.gif":
                               " class=Icon></a>":
                               PTHSNAME,"</td>":
                               "<td>&nbsp;",CCLMDESC,"</td>";
          ELSE
            WRITE     HTMLFILE;"<tr><td nowrap>":
                               "<a HREF='javascript:ModifyClaimDocMapping":
                               "(#"",LINKPRG,"#.pbl":
                               "?reportno=",LINKREP:
                               "&template=",LINKTEM:
                               "&cdmap001=",ACDMHOSP:
                               "&cdmap002=",ACDMCCLM:
                               "&cdmap003=",ACDMSYST:
                               "&cdmap004=",ACDMCTYP:
                               "&cdmap005=",ACDMILOS:
                               "&cdmap006=",ACDMDTYP,"#")'>":
                               "<img src=../images/MaintenanceIcon.gif":
                               " class=Icon></a>":
                               CCLMDESC,"</td>";
          ENDIF
.
          WRITE     HTMLFILE;"<td>&nbsp;",SYSTDESC,"</td>":
                             "<td>&nbsp;",CTYPDESC,"</td>":
                             "<td>&nbsp;",ILOSDESC,"</td>":
                             "<td>&nbsp;",DTYPDESC,"</td>":
                             "<td>&nbsp;",IACTDESC,"</td>":
                             "<td>&nbsp;",CUSRNAME,"</td>":
                             "<td>&nbsp;",CDTEDESC,"</td>":
                             "<td>&nbsp;",UUSRNAME,"</td>":
                             "<td>&nbsp;",UDTEDESC,"</td>":
                             "<td>&nbsp;",DUSRNAME,"</td>":
                             "<td>&nbsp;",DDTEDESC,"</td>":
                             "</tr>"
.
CCDMPL99 RETURN
.
.-----------------------------------------------------------------------------
. Next Claim type clinical document list
.-----------------------------------------------------------------------------
NXTCCM00  MOVE      NORECORD,KEY2
          REP       " +",KEY2
          ASSIGN    STARTNUM+NORECORD,F3
          MOVE      F3,KEY3
          REP       " +",KEY3
          UNPACK    DIM127,D1,FLDPARA,DIM127
          MOVE      REPORTNO,F2
.
          WRITE     HTMLFILE;"patweb77.pbl":
                             "?reportno=",F2:
                             "&template=",FLDPARA:
                             "&startnum=",KEY3:
                             "&norecord=",KEY2:
                             "&filthosp=",FILTHOSP:
                             "&filtclam=",FILTCLAM:
                             "&filtsyst=",FILTSYST:
                             "&filtdtyp=",FILTDCTY:
                             "&filtactv=",FILTACTV;
.
NXTCCM99  RETURN
.
.-----------------------------------------------------------------------------
. Previous Claim type clinical document list
.-----------------------------------------------------------------------------
PRVCCM00  MOVE      NORECORD,KEY2
          REP       " +",KEY2
          ASSIGN    STARTNUM-NORECORD,F3
          IF        F3<0
            MOVE      ZERO,F3
          ENDIF
          MOVE      F3,KEY3
          REP       " +",KEY3
          UNPACK    DIM127,D1,FLDPARA,DIM127
          MOVE      REPORTNO,F2
.
          WRITE     HTMLFILE;"patweb77.pbl":
                             "?reportno=",F2:
                             "&template=",FLDPARA:
                             "&startnum=",KEY3:
                             "&norecord=",KEY2:
                             "&filthosp=",FILTHOSP:
                             "&filtclam=",FILTCLAM:
                             "&filtsyst=",FILTSYST:
                             "&filtdtyp=",FILTDCTY:
                             "&filtactv=",FILTACTV;
.
PRVCCM99  RETURN
.------------------------------------------------------------
. NOMORE00 - Display "No more records" at end of list
.------------------------------------------------------------
NOMORE00  WRITE     HTMLFILE;"<tr>":
                             "<td class=RedCell colspan=20 align=center>":
                             "No more records</td>"
.
NOMORE99  RETURN
+
.
.-----------------------------------------------------------------------------
          INC       CLNZPBFE
          INC       CLNZPMCH
          INC       CLNZPMXC
          INC       CLNZPPTY
          INC       DAYOFWEK
          INC       IBAWEBCD
          INC       NAMSTRCD
          INC       PATBDETM                * Billing Defaults file 
          INC       PATDOCCD
          INC       PATDOCTM
          INC       PMSHCPTM
          INC       NZPBFETM
          INC       NZPCFNTM
          INC       NZPMCHTM
          INC       NZPPFETM
          INC       NZPTFETM
          INC       NZPPTYTM
          INC       WEBDATCD
          INC       RSHWEBCD
          INC       PATMKIPR
          INC       PATBDEVL   * Validate patbdeaf for effective date overlaps
          INC       PATITMRD   * Read MBS code file                             
          INC       PATMCHVL
          INC       NZPMCHVL
          INC       PATMCHRD
.
          INC       IBAGSTIO/INC   * GST master file
          INC       MLTCFNIO/INC   * NZ priv contract funding doctors
          INC       MLTCF1IO/INC   * New NZ priv contract funding doctors
          INC       NZPCFNIO/INC   * NZ priv contract funding
          INC       NZPCF1IO/INC   * New NZ priv contract funding
          INC       NZPBFEIO/INC   * NZ priv bed fee
          INC       NZPBF1IO/INC   * New NZ priv bed fee
          INC       NZPIBRIO/INC   * NZ priv contract proc fee inv breakdown 
          INC       TMPIBRIO/INC   * NZ priv contract proc fee inv breakdown 
          INC       NZPIB1IO/INC   * NZ priv contract proc fee inv breakdown 
          INC       NZPPFEIO/INC   * NZ private procedure fee
          INC       NZPPF1IO/INC   * New NZ private procedure fee
          INC       NZPRBRIO/INC   * NZ priv contract proc fee rev breakdown 
          INC       TMPRBRIO/INC   * NZ priv contract proc fee rev breakdown 
          INC       NZPRB1IO/INC   * NZ priv contract proc fee rev breakdown 
          INC       NZPMCHIO/INC   * NZ priv misc charges
          INC       NZPMC1IO/INC   * New NZ priv misc charges
          INC       NZPMXCIO/INC   * NZ priv misc charge exploding items
          INC       NZPMX1IO/INC   * New NZ priv misc charge exploding items
          INC       NZPPTYIO/INC    * NZ priv related provider type
          INC       NZPTFEIO/INC   * NZ private theatre fee
          INC       NZPTF1IO/INC   * New NZ private theatre fee
          INC       PATADRIO/INC   * Audit misc charge file
          INC       JHSBF1IO/INC
          INC       JHSTF1IO/INC
          INC       PATBDEIO/INC   * Billing Defaults File
          INC       PATBFEIO/INC   * Bed Fee file
.         INC       PATBF1IO/INC   * Bed Fee file(New)
          INC       PATFN1IO/INC   * Health Fund File
          INC       PATHSPIO/INC   * Hospital file
          INC       CLPATHSP  
          INC       PATITMIO/INC   * MBS Items File
          INC       PATMBFIO/INC   * Bed Fee Mapping File
          INC       PATMTFIO/INC   * Theatre Fee Mapping File
          INC       PATMCHIO/INC   * Misc Charge File
          INC       PATTFEIO/INC   * Theatre Fee File
          INC       PATLGAIO/INC   * LGA file
          INC       PMSCIDIO/INC
          INC       PATCT1IO/INC   * Catchment code file
          INC       PATCMXIO/INC   * Casemix Funding File
          INC       PATCMCIO/INC   * Casemix Codes File
          INC       PATCTFIO/INC   * Casemix Theatre Fee File
          INC       PATDGWIO/INC   * Patient DRG Desc & Weighting files
          INC       PMSDCAIO/INC
          INC       PMSHCPIO/INC
          INC       PATDO1IO/INC
          INC       PATIN1IO/INC
          INC       APSMASIO/INC
          INC       PMSUFIIO/INC
          INC       PMSVSCIO/INC   * Clinical Coding Value Set Codes File
          INC       PMSPRGIO/INC   * Program Codes Table
          INC       MLTSECIO/INC
          INC       ACCDMAIO/INC
          INC       CLACCDMA
          INC       TFILENAM

