.******************************************************************************
.* System   : Patient Management                                              *
.* Program  : IBAINP48                                                        *
.* Desc.    : Health Department Transmission for Tasmania            Tas HDP  *
.******************************************************************************
.* Date     : 10/03/1994                                                      *
.* Author   : Jeni Tan                                                        *
.* Function : This program provides data transmission for Tasmanian Health    *
.*            department for all patients disched during the period selected  *
.* Mods     :                                                                 *
.******************************************************************************
.*        V12.00.02 16/09/2025  Nikitha B      TSK  0966598                   *
.*                  Added missing TRNDIC6 at DIAG1700                         *
.*        V12.00.01 22/05/2025 Thanh T         TSK 0955096                    *
.*                  Changed for alphanumeric visit number                     *
.******************************************************************************
.*        V11.05.02 09/05/2025  Nikitha B      TSK  0957501                   *
.*                  Added PreJulyTest to JULY2025 variable.                   *
.*        V11.05.01 09/04/2025  Nikitha B      TSK  0957501                   *
.*                  TAS APC Statutory Changes 2025-26. Added DOYR2025. Added  *
.*                  TRANGEND(CAT Gi). Added TRNDIC1 to TRNDIC30 - Addi Diag   * 
.*                  Clus Ids. Added TRNPDCID - Principal Diag Clus Id.        *
.*                  Updated Cat G values in VALD0000.                         *
.*        V11.04.04 17.07.2024  Ebon Clements  Task 0949391                   *
.*                  Removed debug print of DRG date GDRG0000                  *
.*        V11.04.03 02.05.2024  DA Sarkies     Task 0943852                   *
.*                  Changed code so blank space is displayed if no code       *
.*        V11.04.02 30.04.2024  DA Sarkies     Task 0943852                   *
.*                  Changed DRG version number to display code for 10.00      *
.*                  and above                                                 *
.*        V11.04.01 27.03.2024  DA Sarkies     Task 0943852                   *
.*                  2024 Stat Changed                                         *
.*        V11.02.01 08/09/2022  Bella Turco    Task 0921363                   *
.*                  Changed PROC1000 to read from Cat. "G " Indicator 6 for   *
.*                  TRANSEX                                                   *
.*        V11.00.01 10/03/2020  Jill Parkinson Task 0879163                   *
.*                  Added SEXDSCIO include                                    *
.*        V10.14.01 12/06/2019  Nicole Torrisi TSK 0876417                    *
.*                  1 July 2019 changes - Labour Force Status - TRANOCCP      *
.*                  now read from first 2 characters of Cat KD HDP            *
.*        V10.12.04 13/06/2018  Nicole Torrisi TSK 0852595                    *
.*                  Changed DOYR2018 date to July 1 - testing complete        *
.*        V10.12.03 12/06/2018  Nicole Torrisi TSK 0852595                    *
.*                  Fixed .txt extension on extract file                      *
.*        V10.12.02 08/05/2018  Nicole Torrisi TSK 0852595                    *
.*                  Changed DOYR2018 date for testing                         *
.*        V10.12.01 13/03/2018  Nicole Torrisi TSK 0852595                    *
.*                  1 July 2018 changes - Added Address, Given Name and       *
.*                  Surname and changed format of Doctor Name                 *
.*        V10.11.01 08/09/2017  Ebon Clements  TSK 0818097                    *
.*                  Added excluded newborn functionality -  EXNB0000          *
.*        V10.06.01 01/06/2015  Jill Parkinson CAR 316477                     *
.*                  1 July 2015 changes.  DRG 8.0, ICD 10 edition 9, added    *
.*                  Transfer Hospital, Psych Days and Doctor Name             *
.*        V10.05.01 05/12/2012 J.Tan           CAR 303664                     *
.*                  Get drg from patpgraf based on discharge date grouper     *
.*                  version. (GDRG000)                                        *
.*        V10.03.01 22/08/2012  Jill Parkinson CAR 271136                     *
.*                  Added check for IBCNMHOS before matching hospital code    *
.*        V10.02.04 31/10/2011  Mike Laming    CAR 250267                     *
.*                  Correct vars for changed length of PTICUMEC at PROC1500   *
.*        V10.02.03 26/09/2011  Saroeun Soeur CAR 249669                      *
.*                  added multi hospital functionality                        *
.*        V10.02.02 29/04/2011  Saroeun Soeur CAR 242283                      *
.*                  DSTAT is now parameter driven                             *
.*        V10.02.01 28/03/2011  Mike Laming   CAR 240107                      *
.*                  Mods to PATECDaf & PATECOaf variables & Keys - file change*
.*        V10.01.01 09/02/2011  Jill Parkinson CAR 237613                     *
.*                  Added call to us1                                         *
.*        V10.00.02 17/08/2010  Jill Parkinson CAR 228445                     *
.*                  Fixed packing of admission criteria                       *
.*        V10.00.01 05/05/2010  Jill Parkinson  CAR 221230                    *
.*                  Changed Admission criteria back to DIM 1                  *
.*        V9.12.01  19/06/2009  Mike Laming   CAR ??????                      *
.*                  Add PMVXIDUS (Cat."VI") to check against PTCNDSCI         *
.*        V9.11.01  24/04/2009  Mike Laming   CAR 192779                      *
.*                  Re-ported from V6.17 (not V5) for 2009 HD changes         *
.*        V6.17.01  24/04/2009  Mike Laming   CAR 192779                      *
.*                  2009 changes - increase Diagnosis codes to Dim 8 and add  *
.*                  Onset code as pos 1 of Diag. Code at DIAG1200             *
.*        V6.15.01  06/06/2007  Ian Farnell   CAR 124840                      *
.*                  Change LOAD on KEY2 to use PTCNUREA at PEOC1014           *
.*                  Increased range for validation of TRANATYP & TRANMHLS     *
.******************************************************************************
.*        V6.14.01  29/05/2006  Mike Laming   CAR 105249    2006 HCP          *
.*                  Change Size & Position of PTCNUREA                        *
.*        V6.13.05  11/11/2005  Peter Vela    CAR 84260                       *
.*                  Increase PTCNUREA load statement to 1 - 9.                *
.*                  Add 8=PTMIUS08(U8) 9=PTMIUS09(U9)                         * 
.*        V6.13.04  27/10/2005  Mike Laming   CAR 76098                       *
.*                  Increase PTCNPPPT to 1 - 9 (which AUSR for Election Stat) *
.*                  Add 8=PTMIUS10(V1) & 9=PTMIUS11(V2)                       *
.*        V6.13.03  02/09/2005  Mike Laming   CAR 74429                       *
.*                  Change Extract File Name to use TODATE at MVEXT000        *
.*        V6.13.02  08/0*/2005  Mike Laming   CAR 70834                       *
.*                  Correct Parameter PTCNPPPT at PEOC1014 & increase         *
.*                  TRANADCR to 2 chars                                       *
.*        V6.13.01  08/06/2005  Mike Laming   CAR 61453                       *
.*                  Note - "WRITE WORK" statements now end in ";" to create 1 *
.*                         long Extract record                                *
.*        V6.12.02  27/05/2005  Mike Laming   CAR 61453                       *
.*                  Tas HDP Changes 2005 - mods as per document               *
.*        V6.12.01  17/05/2004  Mike Laming   CAR 49016                       *
.*                  Tasmania uses 1,2,3 & 9                                   *
.*        V6.12.00  17/05/2004  Mike Laming   CAR 49016                       *
.*                  July 2004 PRS/2 - changed to use sex routine SEXDSC00     *
.*        V6.09.01  06/06/2002  Davin  2002/2003 changes                      *
.*                  Recompiled for change to paticuaf                         *
.*        V6.09.B02 06/03/2001  Caleb Sharman  SRF 7667                       *
.*                  Mods to TRANSUBR                                          *
.*        V6.09.B01 23/02/2001  Jill Habasque                                 *
.*                  Mods for ABWGHT - changes to unpack into 4 characters     *
.*        V6.07.01  29/08/2000  Steve Downing                                 *
.*                  Mods to include Indeterminate and Unknown sex             *
.*        V6.07.B02 02/02/2000  Greg Horvat                                   *
.*                  Fixed a bug reading the patient operation episode file    *
.*        V6.07.B01 02/02/2000  Greg Horvat                                   *
.*                  Changed to get the coding from the episode coding files   *
.*        V6.06.02  05/01/2000  Jill Habasque                                 *
.*                  Fixed printing of error report                            *
.*        V6.06.01  26/11/1999  Jill Habasque                                 *
.*                  1999/2000 changes                                         *
.*        V6.05.01  08/12/1998  Nicole Harrington                             *
.*                  Removed CCENTRY                                           *
.*        V6.04.01  23/04/97 J.Tan    SRF 618963                              *
.*                  Added range of claim code                                 *
.*        V6.01.02  03/06/94 J.Tan    SRF 129812                              *
.*                  Mods Account type to be dim 2 instead of dim 1            *
.*        V6.03.B00 12/01/1995  Greg Horvat      New Release 6.03             *
.*                  Recompiled for PATMASFD - Changed PBDATE to be CCYYMMDD   *
.*        V6.03.01  26/07/1995  Greg Horvat                                   *
.*                  Changed the admission and U/R numerbs to be 8 characters  *
.*                  instead of 6 characters                                   *
.*                                                                            *
.******************************************************************************
.
.         FILE DESCRIPTION INCLUDES
.
          INC       STDGENDF
.
          INC       IBACONFD/INC
          INC       PATCODFD/INC            * Patient Codes File
          INC       PATCONFD/INC
          INC       PATDADFD/INC
          INC       PATDO1FD/INC
          INC       PATVADFD/INC
          INC       PATDSCFD/INC            * Patient discharge File
          INC       PATECDFD/INC            * Patient episode disease file
          INC       PATECOFD/INC            * Patient episode operation file
          INC       PATICUFD/INC
          INC       PATMA1FD/INC            * Patient Master File
          INC       PATMI1FD/INC            * Patient Admission File
          INC       PATTRNFD/INC
          INC       PATPGRFD/INC
.                                                                     *I-192779
          INC       PMSPX2FD/INC            * Master extention 2
          INC       PATVISFD/INC
          INC       PMSVX1FD/INC
          INC       PATHSPFD/INC
          INC       MRTCONFD/INC
.
.         LOCAL VARIABLE DEFINITION
.
CATCC     INIT      "CC"
CATGI     INIT      "Gi"
CODECL    INIT      "CL"
CODED     INIT      "D "
CODES     INIT      "S "
CODEP     INIT      "P "
CODEKD    INIT      "KD"
CODEKI    INIT      "KI"
CODEU1    INIT      "U1"
CODEU2    INIT      "U2"
CODEU3    INIT      "U3"
CODEU4    INIT      "U4"
CODEU5    INIT      "U5"
CODEU6    INIT      "U6"
CODEU7    INIT      "U7"
CODEU8    INIT      "U8"
CODEU9    INIT      "U9"
CODEVA    INIT      "VA"
CODEVI    INIT      "VI"
..CODEV1    INIT      "V1"
..CODEV2    INIT      "V2"
COUNT     FORM      2
CODE      DIM       2
CODEP1    INIT      "P1"
CODEP2    INIT      "P2"
CODEP3    INIT      "P3"
CODEP4    INIT      "P4"
CODEP5    INIT      "P5"
CODEP6    INIT      "P6" 
CALDAYS   FORM      6
CDYSDAYS  FORM      6
CDYSFDTE  DIM       8
CDYSTDTE  DIM       8
CDYSYEAR  FORM      2
CMDLINE   DIM       80
DOYR2025  FORM      1
DRGVERS   DIM       3
DRG041    INIT      "041"
DRG042    INIT      "042"
DRG050    INIT      "050"
DRG051    INIT      "051"
DRG052    INIT      "052"
DRG060    INIT      "060"
DRG062    INIT      "062"
DRG070    INIT      "070"
DRG080    INIT      "080"
DRG090    INIT      "090"
DRG100    INIT      "100"
DRG110    INIT      "110"
JULY2025  INIT      "20250701"
DIM1A     DIM       1
ECOL1     FORM      2
ENDCLM    DIM       3
ERRMSG    DIM       40
ERRNO     FORM      3
MHCODE    DIM       3
FORM8     FORM      8
FROMDATE  DIM       8
.
NOLEAVES  FORM      3
.
SP100     INIT      "                                                  ":
                    "                                                  "
STARTED   FORM      1
STRCLM    DIM       3
TODATE    DIM       8
WORKLDAY  FORM      3
WRKDATE1  DIM       8                                                  *I-61453
WRKDATE2  DIM       8                                                  *I-61453
WRKDAYS   FORM      4                                                  *I-61453
DRGDATE   DIM       8
.
PRGID     INIT      "IBAINP48"
PRGNAM    INIT      "HEALTH DEPARTMENT TRANSMISSION (TASMANIA)"
VERSION   INIT      "V12.01.00"
.
.         TRANSMISSION FILE DEFINITION   * before 01/07/2015
.
.WORK      FILE      ASCII, FIXED=640
.
. NAME    TYPE  LENGTH  START LOC.  DESCRIPTION
. ----    ----  ------  ----------  -----------
.TRANHOSI  DIM      4        1       Hospital Identifier                *I-61453
.TRANURNO  DIM     10        5       UR Number                 * was 8  *C-61453
.TRANADMN  DIM     10       15       Admission Number          * was 8  *C-61453
.TRANADAT  DIM      8       25       Admission Date
.TRANDDAT  DIM      8       33       Discharge Date (DDMMCCYY)
.TRANDOB   DIM      8       41       Date of Birth (ddmmccyy)
.TRANLEAV  DIM      3       49       No of Leave Days
.TRANLVS   DIM      3       52       Leave Periods (number)             *I-61453
.TRANSEX   DIM      1       55       Sex
.TRANINDS  DIM      1       56       Indigenous Status
.TRANMARS  DIM      1       57       Marital Status
.TRANSUBR  DIM     30       58       Suburb
.TRANCNTY  DIM      4       88       Country of Birth
.TRANOCCP  DIM      2       92       Occupation
.TRANPAYC  DIM      2       94       Payment Class
.TRANSRFL  DIM      2       96       Source of Referral
.TRANDCHS  DIM      2       98       Discharge Status
.TRANHIS   DIM      1      100       Hospital Insurance Status
.TRANATYP  DIM      2      101       Admission Type
.TRANCTYP  DIM      2      103       Care Type                          *I-61453
.TRANINFW  DIM      4      105       Infant weight (grams)
.TRANMECH  DIM      4      109       Hours on mechanical ventilation
.TRANPOST  DIM      4      113       Postcode
.TRANADCR  DIM      1      117       Admission Criteria
.TRANMHLS  DIM      1      118       Mental Health Legal Status
..
.TRANREAD  DIM      1      119       Re-Admission Reason
.TRANAPES  DIM      1      120       Admitted Patient Election Status
.TRANMEST  DIM      1      121       Medicare Eligibility Status
.TRANILOS  DIM      1      122       Intended Length of Hospital stay
.TRANIHCP  DIM      1      123       Inter-Hospital Contracted Patient
.TRANQNDY  DIM      4      124       Qualified Days for Newborn
..
.TRANDRG   DIM      4      128       Diagnosis Related Group (DRG)
.TRANPDIG  DIM      8      132       Principal Diagnosis
..
.TRANDI1   DIM      8      140       Diagnosis code 1
.TRANDI2   DIM      8      148       Diagnosis code 2
.TRANDI3   DIM      8      156       Diagnosis code 3
.TRANDI4   DIM      8      164       Diagnosis code 4
.TRANDI5   DIM      8      172       Diagnosis code 5
.TRANDI6   DIM      8      180       Diagnosis code 6
.TRANDI7   DIM      8      188       Diagnosis code 7
.TRANDI8   DIM      8      196       Diagnosis code 8
.TRANDI9   DIM      8      204       Diagnosis code 9
.TRANDI10  DIM      8      212       Diagnosis code 10
.TRANDI11  DIM      8      220       Diagnosis code 11
.TRANDI12  DIM      8      228       Diagnosis code 12
.TRANDI13  DIM      8      236       Diagnosis code 13
.TRANDI14  DIM      8      244       Diagnosis code 14
.TRANDI15  DIM      8      252       Diagnosis code 15
.TRANDI16  DIM      8      260       Diagnosis code 16
.TRANDI17  DIM      8      268       Diagnosis code 17
.TRANDI18  DIM      8      276       Diagnosis code 18
.TRANDI19  DIM      8      284       Diagnosis code 19
.TRANDI20  DIM      8      292       Diagnosis code 20
.TRANDI21  DIM      8      300       Diagnosis code 21
.TRANDI22  DIM      8      308       Diagnosis code 22
.TRANDI23  DIM      8      316       Diagnosis code 23
.TRANDI24  DIM      8      324       Diagnosis code 24
.TRANDI25  DIM      8      332       Diagnosis code 25
.TRANDI26  DIM      8      340       Diagnosis code 26
.TRANDI27  DIM      8      348       Diagnosis code 27
.TRANDI28  DIM      8      356       Diagnosis code 28
.TRANDI29  DIM      8      364       Diagnosis code 29
.TRANDI30  DIM      8      372       Diagnosis code 30
..
.TRANOP1   DIM      8      380       Operation code 1
.TRANOP2   DIM      8      388       Operation code 2
.TRANOP3   DIM      8      396       Operation code 3
.TRANOP4   DIM      8      404       Operation code 4
.TRANOP5   DIM      8      412       Operation code 5
.TRANOP6   DIM      8      420       Operation code 6
.TRANOP7   DIM      8      428       Operation code 7
.TRANOP8   DIM      8      436       Operation code 8
.TRANOP9   DIM      8      444       Operation code 9
.TRANOP10  DIM      8      452       Operation code 10
.TRANOP11  DIM      8      460       Operation code 11
.TRANOP12  DIM      8      468       Operation code 12
.TRANOP13  DIM      8      476       Operation code 13
.TRANOP14  DIM      8      484       Operation code 14
.TRANOP15  DIM      8      492       Operation code 15
.TRANOP16  DIM      8      500       Operation code 16
.TRANOP17  DIM      8      508       Operation code 17
.TRANOP18  DIM      8      516       Operation code 18
.TRANOP19  DIM      8      524       Operation code 19
.TRANOP20  DIM      8      532       Operation code 20
.TRANOP21  DIM      8      540       Operation code 21
.TRANOP22  DIM      8      548       Operation code 22
.TRANOP23  DIM      8      556       Operation code 23
.TRANOP24  DIM      8      564       Operation code 24
.TRANOP25  DIM      8      572       Operation code 25
.TRANOP26  DIM      8      580       Operation code 26
.TRANOP27  DIM      8      588       Operation code 27
.TRANOP28  DIM      8      596       Operation code 28
.TRANOP29  DIM      8      604       Operation code 29
.TRANOP30  DIM      8      612       Operation code 30
.TRANCHNM  DIM      20     620       Contracted Hospital Name
.TRANPSYC  FORM     5      640       Number of Psych care days
.TRANSPRC  DIM      40     645       Surgical Patient Responsible Clinician
.
.          End-of-record   685
.
.         TRANSMISSION FILE DEFINITION    * before 01/07/2025
.
.WORK       FILE      ASCII, FIXED=775
.
. NAME    TYPE  LENGTH  START LOC.  DESCRIPTION
. ----    ----  ------  ----------  -----------
.TRANHOSI  DIM      4        1       Hospital Identifier                *I-61453
.TRANURNO  DIM     10        5       UR Number                 * was 8  *C-61453
.TRANADMN  DIM     10       15       Admission Number          * was 8  *C-61453
.TRANADAT  DIM      8       25       Admission Date
.TRANDDAT  DIM      8       33       Discharge Date (DDMMCCYY)
.TRANDOB   DIM      8       41       Date of Birth (ddmmccyy)
.TRANLEAV  DIM      3       49       No of Leave Days
.TRANLVS   DIM      3       52       Leave Periods (number)             *I-61453
.TRANSEX   DIM      1       55       Sex
.TRANINDS  DIM      1       56       Indigenous Status
.TRANMARS  DIM      1       57       Marital Status
.TRANSUBR  DIM     30       58       Suburb
.TRANCNTY  DIM      4       88       Country of Birth
.TRANOCCP  DIM      2       92       Occupation
.TRANPAYC  DIM      2       94       Payment Class
.TRANSRFL  DIM      2       96       Source of Referral
.TRANDCHS  DIM      2       98       Discharge Status
.TRANHIS   DIM      1      100       Hospital Insurance Status
.TRANATYP  DIM      2      101       Admission Type
.TRANCTYP  DIM      2      103       Care Type                          *I-61453
.TRANINFW  DIM      4      105       Infant weight (grams)
.TRANMECH  DIM      4      109       Hours on mechanical ventilation
.TRANPOST  DIM      4      113       Postcode
.TRANADCR  DIM      1      117       Admission Criteria
.TRANMHLS  DIM      1      118       Mental Health Legal Status
..
.TRANREAD  DIM      1      119       Re-Admission Reason
.TRANAPES  DIM      1      120       Admitted Patient Election Status
.TRANMEST  DIM      1      121       Medicare Eligibility Status
.TRANILOS  DIM      1      122       Intended Length of Hospital stay
.TRANIHCP  DIM      1      123       Inter-Hospital Contracted Patient
.TRANQNDY  DIM      4      124       Qualified Days for Newborn
..
.TRANDRG   DIM      4      128       Diagnosis Related Group (DRG)
TRANPDIG  DIM      8      132       Principal Diagnosis
..
TRANDI1   DIM      8      140       Diagnosis code 1
TRANDI2   DIM      8      148       Diagnosis code 2
TRANDI3   DIM      8      156       Diagnosis code 3
TRANDI4   DIM      8      164       Diagnosis code 4
TRANDI5   DIM      8      172       Diagnosis code 5
TRANDI6   DIM      8      180       Diagnosis code 6
TRANDI7   DIM      8      188       Diagnosis code 7
TRANDI8   DIM      8      196       Diagnosis code 8
TRANDI9   DIM      8      204       Diagnosis code 9
TRANDI10  DIM      8      212       Diagnosis code 10
TRANDI11  DIM      8      220       Diagnosis code 11
TRANDI12  DIM      8      228       Diagnosis code 12
TRANDI13  DIM      8      236       Diagnosis code 13
TRANDI14  DIM      8      244       Diagnosis code 14
TRANDI15  DIM      8      252       Diagnosis code 15
TRANDI16  DIM      8      260       Diagnosis code 16
TRANDI17  DIM      8      268       Diagnosis code 17
TRANDI18  DIM      8      276       Diagnosis code 18
TRANDI19  DIM      8      284       Diagnosis code 19
TRANDI20  DIM      8      292       Diagnosis code 20
TRANDI21  DIM      8      300       Diagnosis code 21
TRANDI22  DIM      8      308       Diagnosis code 22
TRANDI23  DIM      8      316       Diagnosis code 23
TRANDI24  DIM      8      324       Diagnosis code 24
TRANDI25  DIM      8      332       Diagnosis code 25
TRANDI26  DIM      8      340       Diagnosis code 26
TRANDI27  DIM      8      348       Diagnosis code 27
TRANDI28  DIM      8      356       Diagnosis code 28
TRANDI29  DIM      8      364       Diagnosis code 29
TRANDI30  DIM      8      372       Diagnosis code 30
 .
.TRANOP1   DIM      8      380       Operation code 1
.TRANOP2   DIM      8      388       Operation code 2
.TRANOP3   DIM      8      396       Operation code 3
.TRANOP4   DIM      8      404       Operation code 4
.TRANOP5   DIM      8      412       Operation code 5
.TRANOP6   DIM      8      420       Operation code 6
.TRANOP7   DIM      8      428       Operation code 7
.TRANOP8   DIM      8      436       Operation code 8
.TRANOP9   DIM      8      444       Operation code 9
.TRANOP10  DIM      8      452       Operation code 10
.TRANOP11  DIM      8      460       Operation code 11
.TRANOP12  DIM      8      468       Operation code 12
.TRANOP13  DIM      8      476       Operation code 13
.TRANOP14  DIM      8      484       Operation code 14
.TRANOP15  DIM      8      492       Operation code 15
.TRANOP16  DIM      8      500       Operation code 16
.TRANOP17  DIM      8      508       Operation code 17
.TRANOP18  DIM      8      516       Operation code 18
.TRANOP19  DIM      8      524       Operation code 19
.TRANOP20  DIM      8      532       Operation code 20
.TRANOP21  DIM      8      540       Operation code 21
.TRANOP22  DIM      8      548       Operation code 22
.TRANOP23  DIM      8      556       Operation code 23
.TRANOP24  DIM      8      564       Operation code 24
.TRANOP25  DIM      8      572       Operation code 25
.TRANOP26  DIM      8      580       Operation code 26
.TRANOP27  DIM      8      588       Operation code 27
.TRANOP28  DIM      8      596       Operation code 28
.TRANOP29  DIM      8      604       Operation code 29
.TRANOP30  DIM      8      612       Operation code 30
.TRANCHNM  DIM      20     620       Contracted Hospital Name
.TRANPSYC  FORM     5      640       Number of Psych care days
.TRANSPRC  DIM      40     645       Surgical Patient Responsible Clinician
.TRANADDR  DIM      30     685       Address of Usual Residence
.TRANGNAM  DIM      30     715       Patient's Given Name
.TRANSNAM  DIM      30     745       Patient's Surname
.
.         End-of-record   775
.
.         TRANSMISSION FILE DEFINITION   * after 01/07/2025
.
WORK      FILE      ASCII, FIXED=640
.
. NAME    TYPE  LENGTH  START LOC.  DESCRIPTION
. ----    ----  ------  ----------  -----------
TRANHOSI   DIM      4        1       Hospital Identifier                *I-61453
TRANURNO   DIM     10        5       UR Number                 * was 8  *C-61453
TRANADMN   DIM     10       15       Admission Number          * was 8  *C-61453
TRANADAT   DIM      8       25       Admission Date
TRANDDAT   DIM      8       33       Discharge Date (DDMMCCYY)
TRANDOB    DIM      8       41       Date of Birth (ddmmccyy)
TRANLEAV   DIM      3       49       No of Leave Days
TRANLVS    DIM      3       52       Leave Periods (number)             *I-61453
TRANGEND   DIM      1       55       Gender
TRANSEX    DIM      1       56       Sex At Birth
TRANINDS   DIM      1       57       Indigenous Status
TRANMARS   DIM      1       58       Marital Status
TRANSUBR   DIM     30       59       Suburb
TRANCNTY   DIM      4       89       Country of Birth
TRANOCCP   DIM      2       93       Occupation
TRANPAYC   DIM      2       95       Payment Class
TRANSRFL   DIM      2       97       Source of Referral
TRANDCHS   DIM      2       99       Discharge Status
TRANHIS    DIM      1      101       Hospital Insurance Status
TRANATYP   DIM      2      102       Admission Type
TRANCTYP   DIM      2      104       Care Type                          *I-61453
TRANINFW   DIM      4      106       Infant weight (grams)
TRANMECH   DIM      4      110       Hours on mechanical ventilation
TRANPOST   DIM      4      114       Postcode
TRANADCR   DIM      1      118       Admission Criteria
TRANMHLS   DIM      1      119       Mental Health Legal Status
.
TRANREAD   DIM      1      120       Re-Admission Reason
TRANAPES   DIM      1      121       Admitted Patient Election Status
TRANMEST   DIM      1      122       Medicare Eligibility Status
TRANILOS   DIM      1      123       Intended Length of Hospital stay
TRANIHCP   DIM      1      124       Inter-Hospital Contracted Patient
TRANQNDY   DIM      4      125       Qualified Days for Newborn
.
TRANDRG    DIM      4      129       Diagnosis Related Group (DRG)
TRNPDCID   DIM     10      133       Principal Diagnosis with Cluster ID
.
TRNDIC1    DIM     10      143      Additional Diagnosis 1 with Cluster ID
TRNDIC2    DIM     10      153      Additional Diagnosis 2 with Cluster ID
TRNDIC3    DIM     10      163      Additional Diagnosis 3 with Cluster ID
TRNDIC4    DIM     10      173      Additional Diagnosis 4 with Cluster ID
TRNDIC5    DIM     10      183      Additional Diagnosis 5 with Cluster ID
TRNDIC6    DIM     10      193      Additional Diagnosis 6 with Cluster ID
TRNDIC7    DIM     10      203      Additional Diagnosis 7 with Cluster ID
TRNDIC8    DIM     10      213      Additional Diagnosis 8 with Cluster ID
TRNDIC9    DIM     10      223      Additional Diagnosis 9 with Cluster ID
TRNDIC10   DIM     10      233      Additional Diagnosis 10 with Cluster ID
TRNDIC11   DIM     10      243      Additional Diagnosis 11 with Cluster ID
TRNDIC12   DIM     10      253      Additional Diagnosis 12 with Cluster ID
TRNDIC13   DIM     10      263      Additional Diagnosis 13 with Cluster ID
TRNDIC14   DIM     10      273      Additional Diagnosis 14 with Cluster ID
TRNDIC15   DIM     10      283      Additional Diagnosis 15 with Cluster ID
TRNDIC16   DIM     10      293      Additional Diagnosis 16 with Cluster ID
TRNDIC17   DIM     10      303      Additional Diagnosis 17 with Cluster ID
TRNDIC18   DIM     10      313      Additional Diagnosis 18 with Cluster ID
TRNDIC19   DIM     10      323      Additional Diagnosis 19 with Cluster ID 
TRNDIC20   DIM     10      333      Additional Diagnosis 20 with Cluster ID
TRNDIC21   DIM     10      343      Additional Diagnosis 21 with Cluster ID
TRNDIC22   DIM     10      353      Additional Diagnosis 22 with Cluster ID
TRNDIC23   DIM     10      363      Additional Diagnosis 23 with Cluster ID
TRNDIC24   DIM     10      373      Additional Diagnosis 24 with Cluster ID
TRNDIC25   DIM     10      383      Additional Diagnosis 25 with Cluster ID
TRNDIC26   DIM     10      393      Additional Diagnosis 26 with Cluster ID
TRNDIC27   DIM     10      403      Additional Diagnosis 27 with Cluster ID
TRNDIC28   DIM     10      413      Additional Diagnosis 28 with Cluster ID
TRNDIC29   DIM     10      423      Additional Diagnosis 29 with Cluster ID
TRNDIC30   DIM     10      433      Additional Diagnosis 30 with Cluster ID
.
TRANOP1    DIM      8      443       Operation code 1
TRANOP2    DIM      8      451       Operation code 2
TRANOP3    DIM      8      459       Operation code 3
TRANOP4    DIM      8      467       Operation code 4
TRANOP5    DIM      8      475       Operation code 5
TRANOP6    DIM      8      483       Operation code 6
TRANOP7    DIM      8      491       Operation code 7
TRANOP8    DIM      8      499       Operation code 8
TRANOP9    DIM      8      507       Operation code 9
TRANOP10   DIM      8      515       Operation code 10
TRANOP11   DIM      8      523       Operation code 11
TRANOP12   DIM      8      531       Operation code 12
TRANOP13   DIM      8      539       Operation code 13
TRANOP14   DIM      8      547       Operation code 14
TRANOP15   DIM      8      555       Operation code 15
TRANOP16   DIM      8      563       Operation code 16
TRANOP17   DIM      8      571       Operation code 17
TRANOP18   DIM      8      579       Operation code 18
TRANOP19   DIM      8      587       Operation code 19
TRANOP20   DIM      8      595       Operation code 20
TRANOP21   DIM      8      603       Operation code 21
TRANOP22   DIM      8      611       Operation code 22
TRANOP23   DIM      8      619       Operation code 23
TRANOP24   DIM      8      627       Operation code 24
TRANOP25   DIM      8      635       Operation code 25
TRANOP26   DIM      8      643       Operation code 26
TRANOP27   DIM      8      651       Operation code 27
TRANOP28   DIM      8      659       Operation code 28
TRANOP29   DIM      8      667       Operation code 29
TRANOP30   DIM      8      675       Operation code 30
.
TRANCHNM   DIM     20      683       Contracted Hospital Name
TRANPSYC   FORM     5      703       Number of Psych care days
TRANSPRC   DIM     40      708       Surgical Patient Responsible Clinician
TRANADDR   DIM     30      748       Address of Usual Residence
TRANGNAM   DIM     30      778       Patient's Given Name
TRANSNAM   DIM     30      808       Patient's Surname 
.
.         End-of-record   838
.
.*******************************************************************************
.*                              ML0000                    CALLED BY :     0000 *
.*                   Controlling Logic (Mainline Code)                         *
.*******************************************************************************
ML0000    CALL      INIT0000                 * Initialization and open files
.
ML0100    CALL      OPTN0000                 * Select options
          BRANCH    EXIT,ML9999              * Exit = 1 if 0 chosen in menu
          BRANCH    OPTION,ML1000            
.
ML1000    CALL      DSCR0000                 * Display screen options
          CALL      DATE0000                 * Obtain Date Range
          BRANCH    EXIT,ML0100              * Exit = 1; Error : Invalid Date
.
          CALL      RCLM0000                 * Keyin Range of claim code
          BRANCH    EXIT,ML0100
.
          CALL      KHOS0000                 * Keyin Hospsital
          BRANCH    EXIT,ML0100 
.
          CALL      CONTQST                  * Ok to Continue ?
          BRANCH    CEXIT,ML1100,ML1000,ML0100  *Yes, No, Cancel
.
ML1100    CALL      PROC0000                 * Yes. Process each record
          CALL      MVEXT000                 * Re-name the Extract file
          GOTO      ML0100                   * Return for next option
.
ML9999    CHAIN     PGM
+
.******************************************************************************
.*                                  KHOS0000                                  *
.*                            Enter The hospital                              *
.******************************************************************************
KHOS0000  COMPARE   ONE,IBCNMHOS
          GOTO      KHOS9999 IF NOT EQUAL
.
          DISPLAY   *P1:24,*EL,"Hospital Id : ";
          MOVE      TEN5,ECOL
          MOVE      "24",EVERT
          MOVE      SP3,CKYIDEF3
          MOVE      ZERO,CKYIMAND           * Not Mandatory
          OPEN      PATHSPA1,"pathspaf"
.
          CALL      PATHSPKY
          BRANCH    EXIT,KHOS2000,KHOS9500
          GOTO      KHOS3000
.
KHOS2000  MOVE      "All Hospitals",PTHSNAME
          MOVE      SP10,PTHSHOSP
          MOVE      ZERO,EXIT
.
KHOS3000  CLOSE     PATHSPA1
.
          DISPLAY   *P20:24,*V2LON,PTHSNAME;
          GOTO      KHOS9999
.
KHOS9500  MOVE      ONE,EXIT
KHOS9999  RETURN
+
.*******************************************************************************
.*                             INIT0000                   CALLED BY :   ML0000 *
.*            Initialize variables, display heading, and open files            *
.*******************************************************************************
INIT0000  CALL      DISPHEAD                 * Display Heading
.
          DISPLAY   *P56:24,"Opening ";
.
          DISPLAY   *P64:24,"controlf"       * Open CONTROLF
          OPEN      CONTROLF,"controlf"
.
          READ      CONTROLF,TEN;*54,CFILENO
          READ      CONTROLF,TWENTY1;*214,PTCNUREA,*221,CNSWLOC,*220,PTNSWHDP
          READ      CONTROLF,SEVENTY9;*82,PTCNDSCI,*83,PTCNESTB,*114,PTCNPPPT
          READ      CONTROLF,SEVENTY9;*115,PTCNDGUP,*116,PTCNDGUA,*239,PTCNDGAD
          READ      CONTROLF,SEVENTY9;*240,PTCNDGDS,*241,PTCNDGTR,*242,PTCNDGRG
          READ      CONTROLF,EIGHTY8;*239,PTCNOCCP,*241,PTCNCSTA
          READ      CONTROLF,EIGHTY8;*242,PNSWRACE
          READ      CONTROLF,HUND05;*158,PTCNDGPV
          READ      CONTROLF,ZERO;*43,IBCNMHOS
          READ      CONTROLF,HUND19;*183,PTCNED41,*191,PTCNED42,*199,PTCNED50:
                                    *207,PTCNED51,*215,PTCNED52,*223,PTCNED60:
                                    *231,PTCNED62,*239,PTCNED70
          READ      CONTROLF,HUND20;*232,PTCNED80
          READ      CONTROLF,HUND23;*232,PTCNED90
          READ      CONTROLF,HUND24;*224,PTCNE100
          READ      CONTROLF,HUND28;*239,PTCNE110
          READ      CONTROLF,HUND31;*1,MRCNDCID
.
          DISPLAY   *P64:24,"patcodes"
          OPEN      PATCODE1,"patcodes"
.
          DISPLAY   *P64:24,"patdschf"
          OPEN      PATDSCH2,"patdschf"
.
          DISPLAY   *P64:24,"patecdaf"
          OPEN      PATECDA2,"patecdaf"
.
          DISPLAY   *P64:24,"patecoaf"
          OPEN      PATECOA2,"patecoaf"
.
          DISPLAY   *P64:24,"patdadaf"
          OPEN      PATDADA1,"patdadaf"
          OPEN      PATVADA1,"patvadaf"
.
          DISPLAY   *P64:24,"patdo1af"
          OPEN      PATDO1A1,"patdo1af"
.
          DISPLAY   *P64:24,"patmi1af"
          OPEN      PATMI1A1,"patmi1af"
          OPEN      PMSVX1A1,"pmsvx1af"
.
          DISPLAY   *P64:24,"patma1af"
          OPEN      PATMA1A1,"patma1af"
          OPEN      PATMX1A1,"patmx1af"
.                                                                     *I-192779
.
          DISPLAY   *P64:24,"pmspx2af";
          OPEN      PMSPX2A1,"pmspx2af"
.
          DISPLAY   *P64:24,"patvisaf";
          OPEN      PATVISA1,"patvisaf"
.
          DISPLAY   *P64:24,"pmsvx1af";
          OPEN      PMSVX1A1,"pmsvx1af"                               *I-192779
.
          DISPLAY   *P64:24,"pattranf";
          OPEN      PATTRAN2,"pattranf"
.
          DISPLAY   *P64:24,"patpgraf";
          OPEN      PATPGRA1,"patpgraf"
.
          MOVE      ZERO,ERRNO
.
          CALL      CLEA0000                 * Clear variables         *I-61543
.
INIT9999  RETURN
+
.******************************************************************************
.*             CLEA0000 - Clear variables                                     *
.******************************************************************************
CLEA0000  UNPACK    SP100,TRANURNO,TRANADMN,TRANADAT,TRANDDAT 
          UNPACK    SP100,TRANDOB,TRANLEAV,TRANGEND,TRANSEX,TRANINDS,TRANMARS 
          UNPACK    SP100,TRANSUBR,TRANCNTY,TRANOCCP,TRANPAYC 
          UNPACK    SP100,TRANSRFL,TRANDCHS,TRANHIS,TRANATYP 
          UNPACK    SP100,TRANINFW,TRANMECH,TRANPOST,TRANADCR,TRANMHLS 
          UNPACK    SP100,TRANDI1,TRANDI2,TRANDI3,TRANDI4,TRANDI5  
          UNPACK    SP100,TRANDI6,TRANDI7,TRANDI8,TRANDI9,TRANDI10 
          UNPACK    SP100,TRANDI11,TRANDI12,TRANDI13,TRANDI14,TRANDI15
          UNPACK    SP100,TRANDI16,TRANDI17,TRANDI18,TRANDI19,TRANDI20
          UNPACK    SP100,TRANDI21,TRANDI22,TRANDI23,TRANDI24,TRANDI25
          UNPACK    SP100,TRANDI26,TRANDI27,TRANDI28,TRANDI29,TRANDI30
.  
          UNPACK    SP100,TRNPDCID
          UNPACK    SP100,TRNDIC1,TRNDIC2,TRNDIC3,TRNDIC4,TRNDIC5
          UNPACK    SP100,TRNDIC6,TRNDIC7,TRNDIC8,TRNDIC9,TRNDIC10
          UNPACK    SP100,TRNDIC11,TRNDIC12,TRNDIC13,TRNDIC14,TRNDIC15
          UNPACK    SP100,TRNDIC16,TRNDIC17,TRNDIC18,TRNDIC19,TRNDIC20
          UNPACK    SP100,TRNDIC21,TRNDIC22,TRNDIC23,TRNDIC24,TRNDIC25
          UNPACK    SP100,TRNDIC26,TRNDIC27,TRNDIC28,TRNDIC29,TRNDIC30
.
          UNPACK    SP100,TRANOP1,TRANOP2,TRANOP3,TRANOP4  
          UNPACK    SP100,TRANOP5,TRANOP6,TRANOP7,TRANOP8,TRANOP9,TRANOP10 
          UNPACK    SP100,TRANOP11,TRANOP12,TRANOP13,TRANOP14,TRANOP15
          UNPACK    SP100,TRANOP16,TRANOP17,TRANOP18,TRANOP19,TRANOP20
          UNPACK    SP100,TRANOP21,TRANOP22,TRANOP23,TRANOP24,TRANOP25
          UNPACK    SP100,TRANOP26,TRANOP27,TRANOP28,TRANOP29,TRANOP30 
.
.******************************************** start of addition        *I-61453
          UNPACK    SP100,TRANHOSI,TRANLVS,TRANCTYP,TRANREAD,TRANAPES 
          UNPACK    SP100,TRANMEST,TRANILOS,TRANIHCP,TRANQNDY,TRANDRG  
          UNPACK    SP100,TRANPDIG
          UNPACK    SP100,TRANCHNM
          MOVE      ZERO,TRANPSYC
          UNPACK    SP100,TRANSPRC,TRANADDR
          UNPACK    SP100,TRANGNAM,TRANSNAM
.********************************************   end of addition        *I-61453

.******************************************** moved from WRTE0000      *I-61453
.                                            * initialise icd.. diagnosis codes
          UNPACK    SP100,TRANDI1,TRANDI2,TRANDI3,TRANDI4,TRANDI5
          UNPACK    SP100,TRANDI6,TRANDI7,TRANDI8,TRANDI9,TRANDI10
          UNPACK    SP100,TRANDI11,TRANDI12,TRANDI13,TRANDI14,TRANDI15
          UNPACK    SP100,TRANDI16,TRANDI17,TRANDI18,TRANDI19,TRANDI20
          UNPACK    SP100,TRANDI21,TRANDI22,TRANDI23,TRANDI24,TRANDI25
          UNPACK    SP100,TRANDI26,TRANDI27,TRANDI28,TRANDI29,TRANDI30
.
.                                            * initialise icd.. operation codes
          UNPACK    SP100,TRANOP1,TRANOP2,TRANOP3,TRANOP4,TRANOP5
          UNPACK    SP100,TRANOP6,TRANOP7,TRANOP8,TRANOP9,TRANOP10
          UNPACK    SP100,TRANOP11,TRANOP12,TRANOP13,TRANOP14,TRANOP15
          UNPACK    SP100,TRANOP16,TRANOP17,TRANOP18,TRANOP19,TRANOP20
          UNPACK    SP100,TRANOP21,TRANOP22,TRANOP23,TRANOP24,TRANOP25
          UNPACK    SP100,TRANOP26,TRANOP27,TRANOP28,TRANOP29,TRANOP30
.******************************************** end of WRTE0000 Code     *I-61453
.
CLEA9999  RETURN
+
.*******************************************************************************
.*                             OPTN0000                   CALLED BY :   ML0100 *
.*                         Obtain the options                                  *
.*******************************************************************************
OPTN0000  DISPLAY   *P1:4,*EF,*V2LON,ZERO,*HOFF," = Exit":
                    *P1:5,*V2LON,ONE,*HOFF," = Range of Discharge Date "
          KEYIN     *P1:7,"Please Select : ",*V2LON,OPTION
.
          COMPARE   ZERO,OPTION
          GOTO      OPTN9000 IF EQUAL        * Exit
.
          BRANCH    OPTION,OPTN8000
.
          BEEP                               * Error : Invalid Option
          GOTO      OPTN0000
.
OPTN8000  MOVE      FALSE,EXIT               * Set Exit = 0
          GOTO      OPTN9999
.
OPTN9000  MOVE      TRUE,EXIT                * Set Exit = 1
.
OPTN9999  RETURN
+
.*******************************************************************************
.*                             DSCR0000                   CALLED BY :   ML1000 *
.*                       Display screen                                        *
.*******************************************************************************
DSCR0000  DISPLAY   *P1:10,*EF,"From date : ":
                    *P1:12,"  To date : ":
                    *P1:16,"From Claim Code : ":
                    *P1:18,"  To Claim Code : ";
DSCR9999  RETURN
+
.*******************************************************************************
.*                             DATE0000                   CALLED BY :   ML1000 *
.*                       Specifiy the date range                               *
.*******************************************************************************
DATE0000  MOVE      FALSE,EXIT 
DATE1000  MOVE      TEN4,CCOL
          MOVE      TEN,CVERT
          UNPACK    SP10,CDAY,CMON,CYEAR
          MOVE      CCC,CCENT
          CALL      KEYDATE
          BRANCH    OVRCD,DATE9900           * No Input: Return to prev field
.
          PACK      FROMDATE,CCENT,CYEAR,CMON,CDAY
          REP       " 0",FROMDATE
.
          MOVE      TEN4,CCOL
          MOVE      TEN2,CVERT
          CALL      KEYDATE
          BRANCH    OVRCD,DATE1000
.
          PACK      TODATE,CCENT,CYEAR,CMON,CDAY
          REP       " 0",TODATE
.
          MATCH     FROMDATE,TODATE          * todate < fromdate?
          GOTO      DATE9999 IF NOT LESS     * Yes. Exit Routine
.   
DATE9000  DISPLAY   *P1:24,*B,"To date must be after From date. ";
          CALL      HITENTER 
          GOTO      DATE0000                 * Input another date
.
DATE9900  MOVE      TRUE,EXIT
.
DATE9999  RETURN
+
.*******************************************************************************
.*                             RCLM0000                   CALLED BY :   ML1000 *
.*        Enter range of claim codes                                           *
.*******************************************************************************
RCLM0000  MOVE      ZERO,EXIT
          MOVE      SP3,STRCLM
          MOVE      SP3,ENDCLM
          MOVE      "20",ECOL               * keyin position
          MOVE      "25",ECOL1
          MOVE      CODECL,CODE             * set up category
.
RCLM1000  MOVE      "16",EVERT
          MOVE      SP10,ACODE
          CALL      PATCODKY                * Keyin claim code
          BRANCH    EXIT,RCLM2000,RCLM9000  * nothing,exit entered
          MOVE      ACODE,STRCLM            * Set the from claim code
          DISPLAY   *PECOL1:EVERT,*V2LON,TDESC;
          GOTO      RCLM5000
.
RCLM2000  DISPLAY   *PECOL:EVERT,*V2LON,"Start";
          MOVE      ZERO,EXIT
.
RCLM5000  MOVE      "18",EVERT
          MOVE      SP10,ACODE
          CALL      PATCODKY                * Keyin claim code
          BRANCH    EXIT,RCLM6000,RCLM9000  * nothing,exit entered
          MOVE      ACODE,ENDCLM            * Set the to claim code
          MATCH     STRCLM,ENDCLM
          IF        @LESS
            DISPLAY   *P1:24,"Starting Claim must be before End Claim."; 
            CALL      HITENTER
            GOTO      RCLM0000
          ENDIF
.
          DISPLAY   *PECOL1:EVERT,*V2LON,TDESC;
          MOVE      ZERO,EXIT
          GOTO      RCLM9999
.
RCLM6000  DISPLAY   *PECOL:EVERT,*V2LON,"Finish";
          MOVE      "~~~",ENDCLM
          MOVE      ZERO,EXIT
          GOTO      RCLM9999
.
RCLM9000  MOVE      ONE,EXIT
RCLM9999  RETURN
+
.*******************************************************************************
.*                             PROC0000                   CALLED BY :   ML1000 *
.*        Process the admissions within the date range specified               *
.*******************************************************************************
PROC0000  CLOSE     WORK                     * remove if already exist
          PREP      WORK,"tashdp"            * create a transmission file
          CALL      IBACLOCK
          CALL      HEAD132
          IF        IBCNMHOS =1
            PRINT     *40,"Hospital: ",PTHSNAME;
          ENDIF
.
          MOVE      ZERO,DOYR2025
          SCAN      "PreJulyTest",REPTNAME
          IF        @EQUAL
            MATCH     "20250101",TODATE 
          ELSE
            MATCH     "20250701",TODATE
          ENDIF
.
          IF        !@LESS
            MOVE      ONE,DOYR2025
            MOVE      "20250101",JULY2025
          ENDIF
          RESET     REPTNAME
.
          DISPLAY   *P1:24,"Processing Admission No. : ";
          PACK      KEY16,FROMDATE,SP10
          CALL      RDSDSCH2                 * Positional Read from the fromdate
PROC1000  CALL      RDKDSCH2                 * Read Next patdsch record
          BRANCH    OVRCD,PROC9999           * End of file
.
          MATCH     DDATE,TODATE             * less than todate
          GOTO      PROC9999 IF LESS         * out of range
.
          UNPACK    DDATE,CCENT,CYEAR,CMON,CDAY     * Discharge Date
          PACK      TRANDDAT,CDAY,CMON,CCENT,CYEAR
          PACK      DRGDATE,CCENT,CYEAR,CMON,CDAY
.
          DISPLAY   *P29:24,*EL,*V2LON,DADMNO;
.
          MOVE      DURNO,KEY8               * No.
          CALL      RDMAST1                  * Read Next PATMIS record
          BRANCH    OVRCD,PROC1000           * URNO not on Master File
.
          MOVE      DURNO,KEY8                * No.
          CALL      RDPMPX21                  * Read Next VisitExtension record
          BRANCH    OVRCD,PROC1000            * URNO not on VisitExtension file
.
          PACK      KEY8,DADMNO                                       *I-192779
          CALL      RDPMVX11                * Read visit extension file record
          IF        OVRCD=1
            PACK      PMVXABRG,SP10
          ENDIF
.
          IF        IBCNMHOS=1
            MATCH     SP10,PTHSHOSP           * if all hospital
            IF        !@EQUAL
              MATCH     PMVXMHOS,PTHSHOSP
              GOTO      PROC1000 IF NOT EQUAL
            ENDIF
          ENDIF
.
          MOVE      "9",TRANSEX             * Patient sex - default Unknown
          PACK      KEY5,ANSG,SP1,PSEX,SP70
          CALL      RDCODE1                 * Cat."G "
          IF        OVRCD=0
            MOVE      TCINDC6,TRANSEX       * Sex At Birth   
          ENDIF
.
          IF        DOYR2025 = ONE
            PACK      KEY5,CATGI,PMPXUCC4,SP70  * Cat."Gi"
            CALL      RDCODE1
            IF        OVRCD=0
              UNPACK    THCSCOD,TRANGEND        * Patient Gender HDP position 1
            ENDIF
          ENDIF
.
.         Check with indicator whether we are using address line one or
.         address line two as the Locality
.
          STRIP     PADD1
          STRIP     PADD2
.                                           * Using address line 3(suburb)
          PACK      TRANSUBR,PSUBRB,SP30                               *I-61453
          PACK      TRANADDR,PADD1,SP1,PADD2,SP30 * 2018 change
          BRANCH    CNSWLOC,PROC1001
.                                            * Using address line 2
          PACK      TRANSUBR,PADD2,SP30                                *I-61453
.
          PACK      TRANADDR,PADD1,SP30      * 2018 change
.
PROC1001  MOVE      PPOST,TRANPOST           * Post code
.
          PACK      TRANGNAM,PGNAME,SP30     * 2018 change
.
          PACK      TRANSNAM,PTMASNAM,SP30   * 2018 change
.
          MOVE      DADMNO,KEY8
          CALL      RDMISS1
          BRANCH    OVRCD,PROC1000           * Missing admission record
.
          CALL      EXNB0000                 * Excluded newborn
          BRANCH    EXIT,PROC1000
.
          MATCH     STRCLM,ACLAIM            * Check for claim code range
          GOTO      PROC1000 IF LESS
          MATCH     ACLAIM,ENDCLM
          GOTO      PROC1000 IF LESS
.
          PACK      KEY5,ANSC,SP1,PCONT
          CALL      RDCODE1                  * Cat."C "
          IF        OVRCD = 0
            UNPACK    THCSCOD,TRANCNTY
          ENDIF
.
          PACK      KEY5,ANSA,SP1,ATYPE      * Admission Type          *I-61453
          CALL      RDCODE1                  * Cat."A "
          IF        OVRCD=0
            MOVE      THCSCOD,TRANATYP
            REP       " 0",TRANATYP                                    *I-61453
          ENDIF
.
          MOVE      "9",TRANADCR                                      *I-61453
          PACK      KEY5,CATCC,ACARE        * Admission criteria & Care Type
          CALL      RDCODE1                 * Cat."CC"
          IF        OVRCD=0
            MATCH     "9",TCINDC8
            IF        !@EQUAL
.                                           * Admission criteria
              PACK      TRANADCR,TCINDC8
              REP       " 0",TRANADCR
            ENDIF
            MOVE      THCSCOD,TRANCTYP      * Care Type
            REP       " 0",TRANCTYP
          ENDIF
.
          PACK      KEY5,ANSS,SP1,ASRCE
          CALL      RDCODE1                 * Cat."S "
          IF        OVRCD = 0
            UNPACK    THCSCOD,TRANSRFL      * Source of referral
            REP       " 0",TRANSRFL                                    *I-61453
          ENDIF
.
          PACK      KEY8,AADMNO,SP70
          CALL      RDPTDAD1
          IF        OVRCD<>1
            PACK      KEY5,PTDAADTS,SP70
            CALL      RDPTVAD1
            IF        OVRCD<>1
              PACK      TRANCHNM,PTVANHSC,SP70
            ENDIF
          ENDIF
.
          PACK      KEY6,ADOCTA,SP70
          CALL      RDDOCT1
          IF        OVRCD<>1
            CALL      DOCNM000
            PACK      TRANSPRC,PACFNAME,SP70
          ENDIF
.
          PACK      KEY5,CODECL,ACLAIM
          CALL      RDCODE1                 * Cat."CL"
          IF        OVRCD = 0
            UNPACK    THCSCOD,TRANPAYC      * payment class.
            REP       " 0",TRANPAYC                                    *I-61453
          ENDIF
.
.                                           * Indigenous Status       *C-192779
          MOVE      "9",TRANINDS            * default "Note Stated"
          MATCH     SP3,PMVXABRG
          IF        !@EQUAL
            PACK      KEY5,CODEVA,PMVXABRG,SP5
            CALL      RDCODE1    
            IF        OVRCD = 0
              UNPACK    THCSCOD,TRANINDS    * Indigenous status
            ENDIF
          ENDIF
.
.******************************************** start of addition        *I-61453
.                                           * Medicare Eligibility Status
PROC1013  MOVE      "9",TRANMEST            * Medicare Elig. Status - Not Stated
          PACK      KEY5,ANST,SP1,PTYPE
          CALL      RDCODE1                 * Cat."T "
          IF        OVRCD = 0
            MATCH     "1",TCINDC1
            IF        @EQUAL
              MOVE      "1",TRANMEST        * Medicare Elig. Status - Eligible
            ELSE
              MOVE      "2",TRANMEST        * Medicare Elig. Status - Ineligible
            ENDIF
          ENDIF
.                                           * Re-admission
.                   ************************* start of changes        *C-192779
PEOC1014  PACK      KEY5,ANSK,ANSO,PMVXUREA
          CALL      RDCODE1                 * Cat."KO"
          IF        OVRCD<>1
            UNPACK    THCSCOD,TRANREAD      * unplanned readmission
          ENDIF
.
.                                           * Admitted Patient Election Status
          MOVE      "9",TRANAPES
          MATCH     SP3,PMVXPPPT
          IF        !@EQUAL
            PACK      KEY5,CODEKI,PMVXPPPT,SP70
            CALL      RDCODE1               * Cat."KI"
            IF        OVRCD <> 1
              MOVE      THCSCOD,TRANAPES    * Election Status
            ENDIF
          ENDIF
.                   *************************   end of changes        *C-192779
.
.                                           * Intended Length of Stay
PROC1015  MOVE      "9",TRANILOS
          IF        PTCNDSCI = 0
            MATCH     SP3,ACLSS             * admission class blank ?
            GOTO      PROC1016 IF EQUAL
            PACK      KEY5,CODEP,ACLSS
          ELSE
            LOAD      DIM3,PTCNDSCI,AUSR1,AUSR2,AUSR3,AUSR4,AUSR5,PMVXIDUS
            LOAD      KEY2,PTCNDSCI,CODEU1,CODEU2,CODEU3,CODEU4,CODEU5,CODEVI
...         MATCH     SP3,ACODE             * admission class blank ?
            MATCH     SP3,DIM3              * admission class blank ?
            GOTO      PROC1016 IF EQUAL     * yes - ignore
            PACK      KEY5,KEY2,DIM3,SP5
          ENDIF
          CALL      RDCODE1                 * Cat."P "
          IF        OVRCD = 0
            UNPACK    TCINDC1,TRANILOS      * Intended Length of Stay
          ENDIF
.
PROC1016  MOVE      SP1,ANS
          MOVE      "9",TRANIHCP            * Inter-Hospital Contracted Patient
          MATCH     SP3,ASRCE
          IF        !@EQUAL
            PACK      KEY5,CODES,ASRCE
            CALL      RDCODE1               * Cat."S "
            IF        OVRCD = 0
              MOVE      TCINDC6,TRANIHCP    * Inter-Hospital Contracted Patient
            ENDIF
          ENDIF
.
PROC1017  MOVE      "0000",TRANQNDY         * def for Qualified Days for Newborn
          PACK      KEY5,ANSA,SP1,ATYPE
          CALL      RDCODE1                 * Cat."A "
          BRANCH    OVRCD,PROC1018
          MATCH     "01",THCSCOD
          GOTO      PROC1018 IF NOT EQUAL
          PACK      KEY5,CATCC,ACARE
          CALL      RDCODE1                 * Cat."CC"
          BRANCH    OVRCD,PROC1018
          MATCH     "04",THCSCOD
          GOTO      PROC1018 IF NOT EQUAL
          CALL      QUAL0000                * Calculate Qualified Days
          MOVE      WRKDAYS,TRANQNDY
          REP       " 0",TRANQNDY
.
PROC1018  MOVE      SP1,ANS
.********************************************   end of addition        *I-61453

.
          PACK      KEY5,ANSM,SP1,PMSTAT
          CALL      RDCODE1                  * Cat."M "
          IF        OVRCD = 0
            PACK      TRANMARS,THCSCOD,SP20  * Marital status
          ENDIF
.
          PACK       KEY5,ANSC,ANSL,ACLAIM
          CALL       RDCODE1                 * Cat."CL"
          IF         OVRCD=0
            MOVE      TCINDC7,TRANHIS        * Hospital insurance
          ENDIF
.
          PACK      KEY5,SP10
          IF        PTNSWHDP = 0
            MATCH     SP3,DDEST
            IF        !@EQUAL
              PACK      KEY5,ANSD,ANSD,DDEST
            ENDIF
          ELSE
            MATCH     SP3,DSTAT
            IF        !@EQUAL
              PACK      KEY5,ANSD,SP1,DSTAT
            ENDIF
          ENDIF
          CALL      RDCODE1                  * Cat."D "
          MOVE      THCSCOD,TRANDCHS                                   *I-61453
.
          UNPACK    ABWGHT,DIM2,TRANINFW          * Baby admission weight
          REP       " 0",TRANINFW
.
          LOAD      MHCODE,PTCNCSTA,DUSD1,DUSD2,DUSD3,DUSD4,DUSD5
          MATCH     SP3,MHCODE
          IF        !@EQUAL
            PACK      KEY5,ANSD,PTCNCSTA,MHCODE       * Mental Health Legal Stat
            CALL      RDCODE1                * Cat."D?"
            IF        OVRCD<>1
              MOVE      THCSCOD,TRANMHLS
            ENDIF
          ENDIF
.
          UNPACK    PBDATE,XCENT,XYEAR,XMON,XDAY
          PACK      TRANDOB,XDAY,XMON,XCENT,XYEAR
.
          UNPACK    ADATE,XCENT,XYEAR,XMON,XDAY
          PACK      TRANADAT,XDAY,XMON,XCENT,XYEAR * Admission date
.
          OPEN      PATICUA1,"paticuaf"
          PACK      KEY8,AADMNO
          CALL      RDPTICU1
          IF        OVRCD=0
            MOVE      PTICUMEC,FORM4         * (form 5 to form 4)     *C-250267
            MOVE      FORM4,TRANMECH                                  *C-250267
            REP       " 0",TRANMECH                                    *I-61453
          ENDIF
          CLOSE     PATICUA1
          CALL      CLOS0000
          CALL      EMPL0000                 * Get employment status
.
PROC2000  CALL      VALD0000                 * Validate the data
          CALL      DIAG0000                 * Get Diagnosis & Procs.  *I-61453
          CALL      WRTE0000                 * Yes. Write to the trans.File 
          CALL      CLEA0000                 * Clear variables
          GOTO      PROC1000                 * Get Next Admission Number
.
PROC9999  DISPLAY   *P1:24,*EL,*P19:24,*V2LON:
                    "** Transmission Data Processing Completed **",*W;
          CLOSE     WORK
          COMPARE   ZERO,ERRNO
          IF        !@EQUAL
            DISPLAY   *P1:24,*EL,*V2LON,"** Errors found **";
            CALL      HITENTER
            PRINT     *1,"-----------------------------------":
                       "-----------------------------------":
                      *N,"*** End of Report ***"
          ELSE
            PRINT     *1," *** No errors found ***"
          ENDIF
.
          RETURN
+
.****************************************************************************
.*                  CLOS0000 - Calculate Length of Stay        PROC0000     * .****************************************************************************
.
CLOS0000  MOVE      ZERO,WORKLDAY           * Initialise leave days
          MOVE      ZERO,NOLEAVES                                      *I-61453
          MOVE      ZERO,TRANPSYC
.
          PACK      KEY30,AADMNO,SP20
          CALL      RDSTRAN2                * Position on & read the transfer
CLOS1000  CALL      RDKTRAN2                  file
          IF        OVRCD=1
            GOTO      CLOS7000              * Error
          ENDIF
          MATCH     AADMNO,TADMN
          IF        !@EQUAL
            GOTO      CLOS7000              * Error
          ENDIF
.
          CMATCH    ANSA,TMOVE
          GOTO      CLOS2000 IF EQUAL       * Admission record
.
          CMATCH    ANSL,TMOVE
          GOTO      CLOS3000 IF EQUAL       * Leave record
.
          CMATCH    ANSR,TMOVE
          GOTO      CLOS4000 IF EQUAL       * Return from leave record
.
          CMATCH    ANSC,TMOVE
          GOTO      CLOS5000 IF EQUAL       * Change record
.
          CMATCH    ANSD,TMOVE
          GOTO      CLOS6000 IF EQUAL       * Discharge record
.
          GOTO      CLOS5000                * Assume change record
.
. ----- Admission Record -----
.
CLOS2000  CALL      LSAV0000                * Save details
          GOTO      CLOS1000
.
. ----- Leave Record -----
.
CLOS3000  CALL      LEND0000                * Process end of a period
          ADD       ONE,NOLEAVES                                       *I-61453
          GOTO      CLOS1000
.
. ----- Return Record -----
.
CLOS4000  CALL      LDAY0000                * Calculate the leave days
          CALL      LSAV0000                * Save details
          GOTO      CLOS1000
.
. ----- Change Record -----
.
CLOS5000  CALL      LEND0000                * Process end of a period
          CALL      LSAV0000                * Save new details
          GOTO      CLOS1000
.
. ----- Discharge Record -----
.
CLOS6000  CALL      LEND0000                * Process end of a period
          GOTO      CLOS9000
.
. ----- Error -----
.
CLOS7000  MOVE      DDATE,TDATE             * Assume discharge date
          CALL      LEND0000                * Process end of a period
          GOTO      CLOS9999
.
. ----- Finished -----
.
CLOS9000  MOVE      WORKLDAY,TRANLEAV       * Total leave days
          REPLACE   " 0",TRANLEAV           * zero fill
          MOVE      NOLEAVES,TRANLVS                                   *I-61453
          REPLACE   " 0",TRANLVS                                       *I-61453
.
CLOS9999  RETURN
+
.******************************************** start of addition        *I-61453
.****************************************************************************
.*                  QUAL0000 - Calculate Number of Qualified Days (Newborn) *
.****************************************************************************
QUAL0000  MOVE      ZERO,WRKDAYS
          MOVE      ZERO,STARTED 
          PACK      SP30,WRKDATE1,WRKDATE2
.
          PACK      KEY30,AADMNO,SP20
          CALL      RDSTRAN2                * Position on & read the transfer
QUAL1000  CALL      RDKTRAN2                  file
          IF        OVRCD=1
            GOTO      QUAL9000              * end of data
          ENDIF
          MATCH     AADMNO,TADMN
          IF        !@EQUAL
            GOTO      QUAL9000              * end of data
          ENDIF
.
          PACK      KEY5,ANSA,SP1,TATYPE
          CALL      RDCODE1                 * Cat."A "
          IF        OVRCD = 0
            MATCH     "04",THCSCOD
            IF        @EQUAL
              BRANCH    STARTED,QUAL4000
              GOTO      QUAL2000            * save Date & start counting
            ENDIF
          ENDIF
.                                           * no Code or not Qualified
          BRANCH    STARTED,QUAL5000        * work out the No.of days
          GOTO      QUAL1000
.
.
QUAL2000  MOVE      TMOVE,ANS
          REP       "A-R-",ANS
          MATCH     "-",ANS
          GOTO      QUAL1000 IF NOT EQUAL
          MOVE      TDATE,WRKDATE1
          MOVE      ONE,STARTED
          GOTO      QUAL1000
.
QUAL4000  MOVE      TMOVE,ANS               * check Transfer type
          REP       "L-D-",ANS
          MATCH     "-",ANS
          GOTO      QUAL1000 IF NOT EQUAL   * (just a transfer - get next)
.
.                                           * status has changed - calc. Days
QUAL5000  MOVE      TDATE,WRKDATE2
          MOVE      WRKDATE1,CDYSFDTE
          MOVE      WRKDATE2,CDYSTDTE
          CALL      CALCDAYS                * Calculate diff between dates
....      SUB       ONE,CDYSDAYS            * We do want inclusive dates
          ADD       CDYSDAYS,WRKDAYS
          UNPACK    SP30,WRKDATE1,WRKDATE2
          MOVE      ZERO,STARTED
          GOTO      QUAL1000
.
.
QUAL9000  MOVE      ZERO,STARTED
.
QUAL9999  RETURN
.********************************************   end of addition        *I-61453
.
.******************************************************************************
.*                                  LSAV0000              Called by: CLOS0000 *
.*         Save Start Of Period Details For Length Of Stay Calculations       *
.******************************************************************************
LSAV0000  PACK      CDYSFDTE,TDATE
          MOVE      TATYPE,STATYPE
          MOVE      TRBTYP,STRBTYP
LSAV9999  RETURN
+
.******************************************************************************
.*                                  LEND0000              Called by: CLOS0000 *
.*              Process End Of Period Details For Length Of Stay              *
.******************************************************************************
LEND0000  PACK      CDYSTDTE,TDATE
          MATCH     CDYSTDTE,CDYSFDTE
          GOTO      LEND9000 IF NOT LESS
.
          CALL      CALCDAYS                * Calculate diff between dates
          SUB       ONE,CDYSDAYS            * We dont want inclusive dates
.
          PACK      KEY5,ANSB,ANST,STRBTYP,SP70   * Using room type
          CALL      RDCODE1
          BRANCH    OVRCD,LEND9000
.
          MATCH     ANSA,TCINDC3
          GOTO      LEND9000 IF NOT EQUAL    * Not psych room type
.           
          ADD       CDYSDAYS,TRANPSYC
.
LEND9000  MOVE      TDATE,STDATE            * Save transfer date for leave days
LEND9999  RETURN
+
.******************************************************************************
.*                                  LDAY0000              Called by: CLOS0000 *
.*                           Calculate The Leave Days                         *
.******************************************************************************
LDAY0000  PACK      CDYSFDTE,STDATE
          PACK      CDYSTDTE,TDATE
          MATCH     CDYSTDTE,CDYSFDTE
          GOTO      LDAY9999 IF NOT LESS
.
          CALL      CALCDAYS                * Calculate diff between dates
          SUB       ONE,CDYSDAYS            * We dont want inclusive dates
          ADD       CDYSDAYS,WORKLDAY       * Total leave days
LDAY9999  RETURN
+
.****************************************************************************
.*                  EMPL0000 - Employment Status               PROC0000     *
.*              (or Occupation Status or Labour Force Status)               *
.****************************************************************************
.                   ****************************** start of change    *C-192779
EMPL0000  MOVE      ZERO,FORM1
          MOVE      "09",TRANOCCP                * "unknown" occupation status
          MATCH     SP3,PMVXEMPL
          IF        !@EQUAL
            PACK      KEY5,CODEKD,PMVXEMPL,SP70
            CALL      RDCODE1                    * Cat."KD"
            IF        OVRCD = 0
              STRIP     THCSCOD
              UNPACK    THCSCOD,KEY2,DIM2
              PACK      TRANOCCP,KEY2,SP70
            ENDIF
          ENDIF
          REP       " 0",TRANOCCP
          MATCH     "00",TRANOCCP
          IF        @EQUAL
            MOVE      "09",TRANOCCP
          ENDIF
.                   ******************************   end of change    *C-192779
.
EMPL9999  RETURN
.
.*******************************************************************************
.*                             VALD0000                   CALLED BY : PROC0000 *
.*                        Validate the data                                    *
.*******************************************************************************
.  
VALD0000  MOVE      ZERO,FORM1
          MOVE      TRANINDS,FORM1          * only 1,2,3,4 or 9
          IF        FORM1 < 1 | FORM1 > 4 & FORM1 <> 9
            MOVE      "Invalid Indigenous Status ",ERRMSG
            CALL      PRINTERR
          ENDIF
.
. ------- patient Sex at Birth  -----------
.
          COMPARE   DOYR2025,ONE
          GOTO      VALD0500 IF NOT EQUAL
.
          MATCH     JULY2025,DDATE
          GOTO      VALD0500 IF LESS
.
          MOVE      ZERO,FORM1
          MOVE      TRANSEX,FORM1           * Only Sex At Birth of 1, 2, 3 or 9
          IF        FORM1 < 1 | FORM1 > 3 & FORM1 <> 9
            CLEAR     ERRMSG
            MOVE      "Invalid Sex At Birth Type ",ERRMSG
            CALL      PRINTERR
            GOTO      VALD1000
          ENDIF
          GOTO      VALD1000
.
VALD0500  MOVE      ZERO,FORM1
          MOVE      TRANSEX,FORM1           * Only SEX of 1, 2, 3, 4, 5 or 9
          IF        FORM1 < 1 | FORM1 > 5 & FORM1 <> 9 
            MOVE      "Invalid Sex Type ",ERRMSG
            CALL      PRINTERR
          ENDIF
.
. ------- patient Gender  -----------
.
VALD1000  COMPARE   DOYR2025,ONE
          GOTO      VALD2000 IF NOT EQUAL
. 
          MATCH     JULY2025,DDATE
          GOTO      VALD2000 IF LESS
.
          MATCH     SP70,TRANGEND           *  Gender blank ?
          IF        @EQUAL
            CLEAR     ERRMSG
            MOVE      "Invalid Gender Type ",ERRMSG
            CALL      PRINTERR
            GOTO      VALD2000
          ENDIF
.
          PACK      KEY5,CATGI,PMPXUCC4,SP70   * Gender code invalid ?
          CALL      RDCODE1
          IF        OVRCD=1
            CLEAR     ERRMSG
            MOVE      "Invalid Gender Type ",ERRMSG
            CALL      PRINTERR
            GOTO      VALD2000
          ENDIF
.
          MOVE      ZERO,FORM1
          MOVE      TRANGEND,FORM1        * Only Gender of 1, 2, 3, 4, 5 or 9
          IF        FORM1 < 1 | FORM1 > 5 & FORM1 <> 9
            CLEAR     ERRMSG
            MOVE      "Invalid Gender Type ",ERRMSG
            CALL      PRINTERR
            GOTO      VALD2000
          ENDIF
. 
VALD2000  MOVE      ZERO,FORM1
          MOVE      TRANMARS,FORM1
          IF        FORM1 < 1 | FORM1 > 6
            MOVE      "Invalid Marital Status ",ERRMSG
            CALL      PRINTERR
          ENDIF
.
          MOVE      ZERO,FORM2
          MOVE      TRANPAYC,FORM2
.....     IF        FORM2 < 0 | FORM2 > 14                              D-61453
          IF        FORM2 < 1 | FORM2 > 12 & FORM1 <> 14 & FORM2 <> 20
            MOVE      "Invalid Payment Class ",ERRMSG
            CALL      PRINTERR
          ENDIF
.
          MOVE      ZERO,FORM2
          MOVE      TRANSRFL,FORM2
.                                                                      *C-61453
          IF        FORM2 < 0 | FORM2 > 21 & FORM2 <> 99
            MOVE      "Invalid Source of Referral ",ERRMSG
            CALL      PRINTERR
          ENDIF
.
          MOVE      ZERO,FORM2
          MOVE      TRANDCHS,FORM2
          IF        FORM2<0|FORM2>21&FORM2<99|FORM2>99|FORM2=5
            MOVE      "Invalid Discharge Status ",ERRMSG
            CALL      PRINTERR
          ENDIF
.
          MOVE      ZERO,FORM1
          MOVE      TRANHIS,FORM1
          IF        FORM1<1|FORM1>3
            MOVE      "Invalid Hospital Insurance Status ",ERRMSG
            CALL      PRINTERR
          ENDIF
.
          MOVE      ZERO,FORM2
          MOVE      TRANATYP,FORM2
.....     IF        FORM2 <1|FORM2>12&FORM2<99|FORM2>99                 D-61453
          IF        FORM2 < 0 | FORM2 > 14
            MOVE      "Invalid Admission Type ",ERRMSG
            CALL      PRINTERR
          ENDIF
.
          MOVE      ZERO,FORM1
          MOVE      TRANADCR,FORM1
.....     IF        FORM1<1|FORM1>3                                     D-61453
          IF        FORM1 <> 1 & FORM1 <> 3 & FORM1 <> 4 & FORM1 <> 9
            MOVE      "Invalid Admission Criteria ",ERRMSG
            CALL      PRINTERR
          ENDIF
.
.******************************************** start of addition        *I-61453
          MOVE      ZERO,FORM1
          MOVE      TRANMEST,FORM1
          IF        FORM1 < 1 | FORM1 > 3 & FORM1 <> 9
            MOVE      "Invalid Medicare Eligibility Status ",ERRMSG
            CALL      PRINTERR
          ENDIF
.
          MOVE      ZERO,FORM2
          MOVE      TRANCTYP,FORM2
          IF        FORM2 < 1 | FORM2 > 4 & FORM2 <> 99
            MOVE      "Invalid Care Type ",ERRMSG
            CALL      PRINTERR
          ENDIF
.
          MOVE      ZERO,FORM1
          MOVE      TRANREAD,FORM1
          IF        FORM1 < 1 | FORM1 > 3 & FORM1 <> 9
            MOVE      "Invalid Re-admission Reason ",ERRMSG
            CALL      PRINTERR
          ENDIF
.
          MOVE      ZERO,FORM1
          MOVE      TRANAPES,FORM1     
          IF        FORM1 <> 1 & FORM1 <> 2 & FORM1 <> 9
            MOVE      "Invalid Admitted Patient Election Status ",ERRMSG
            CALL      PRINTERR
          ENDIF
.
          MOVE      ZERO,FORM1
          MOVE      TRANILOS,FORM1
          IF        FORM1 < 1 | FORM1 > 2 & FORM1 <> 9
            MOVE      "Invalid Intended Length of Hospital Stay ",ERRMSG
            CALL      PRINTERR
          ENDIF
.
          MOVE      ZERO,FORM1
          MOVE      TRANIHCP,FORM1
          IF        FORM1 < 1 | FORM1 > 3 & FORM1 <> 9
            MOVE      "Invalid Inter-Hospital Contracted Patient ",ERRMSG
            CALL      PRINTERR
          ENDIF
.
.********************************************   end of addition        *I-61453
.
          MOVE      ZERO,FORM1
          MOVE      TRANMHLS,FORM1
          COMPARE   ZERO,FORM1
          GOTO      VALD9999 IF EQUAL
          IF        FORM1>2
            MOVE      "Invalid Mental Health Legal Status ",ERRMSG
            CALL      PRINTERR
          ENDIF
.
VALD9999  RETURN
+
.*******************************************************************************
.*                             PRINTERR                   CALLED BY : PROC0000 *
.*                        Print error message                                  *
.*******************************************************************************
PRINTERR  IF        ERRNO=0
            PRINT     *1,"-----------------------------------":
                         "-----------------------------------":
                      *N,"| Admission | Description",*70,"|":
                      *N,"-----------------------------------":
                         "-----------------------------------"
          ENDIF
          PRINT     *1,"| ",AADMNO,*13,"| ",ERRMSG,*70,"|"
          ADD       ONE,ERRNO
.
          RETURN
+
.*******************************************************************************
.*                             DIAG0000                   CALLED BY : PROC0000 *
.*           Get Diagnosis & Procedures - code moved from WRTE0000             *
.*******************************************************************************
DIAG0000  MOVE      ZERO,EXIT
.
          MOVE      ZERO,COUNT
          PACK      KEY16,AADMNO,SP20                                 *C-240107
          CALL      RSPTECD2                * Position on & read a patient
DIAG1000  CALL      RKPTECD2                  episode disease file record
          BRANCH    OVRCD,DIAG2000
.
          MATCH     AADMNO,PTEDADMN
          GOTO      DIAG2000 IF NOT EQUAL
.
          COMPARE   THIRTY2,COUNT               * maximum of 31 codes
          GOTO      DIAG2000 IF NOT LESS
.
DIAG1200  MOVE      ZERO,FORM1                                        *I-192779
          MOVE      PTEDOSET,FORM1
          IF        FORM1 < 1 | FORM1 > 2 & FORM1 <> 9
            CLEAR     ERRMSG
            APPEND    "Invalid Onset code for Code ",ERRMSG
            APPEND    PTEDCODE,ERRMSG
            RESET     ERRMSG
            CALL      PRINTERR
          ENDIF
.
.******************************************** start of addition        *I-61453
          COMPARE   DOYR2025,ONE
          GOTO      DIAG1500 IF NOT EQUAL
. 
          CMATCH    "P",PTEDTYPE             
          IF        @EQUAL
            MATCH     SP10,TRNPDCID     * have we got Principal yet?
            IF        @EQUAL
              MATCH     "1",MRCNDCID    * DCID parameter ticked ?
              IF        @EQUAL
                PACK      TRNPDCID,PTEDDCID,PTEDOSET,PTEDCODE,SP10  * yes 
                GOTO      DIAG1000      
              ELSE
                PACK      TRNPDCID,NINE,SP1,PTEDOSET,PTEDCODE,SP10  * no
                GOTO      DIAG1000
              ENDIF
            ENDIF
          ENDIF            
.
          GOTO      DIAG1700

DIAG1500  CMATCH    "P",PTEDTYPE
          IF        @EQUAL
            MATCH     SP7,TRANPDIG          * have we got Principal yet?
            IF        @EQUAL
....          MOVE      PTEDCODE,TRANPDIG
              PACK      TRANPDIG,PTEDOSET,PTEDCODE,SP10             *C-192779
              GOTO      DIAG1000
            ENDIF
          ENDIF
.
.********************************************   end of addition        *I-61453
. 
....      MOVE      PTEDCODE,DIM8
DIAG1700  COMPARE   DOYR2025,ONE
          GOTO      DIAG1900 IF NOT EQUAL
.
          PACK      DIM10,PTEDDCID,PTEDOSET,PTEDCODE,SP10           
          ADD       ONE,COUNT              * Addi Diag codes with Clus Ids
          STORE     DIM10,COUNT,TRNDIC1,TRNDIC2,TRNDIC3,TRNDIC4,TRNDIC5:
                                TRNDIC6,TRNDIC7,TRNDIC8,TRNDIC9,TRNDIC10:
                                TRNDIC11,TRNDIC12,TRNDIC13,TRNDIC14:
                                TRNDIC15,TRNDIC16,TRNDIC17,TRNDIC18:
                                TRNDIC19,TRNDIC20,TRNDIC21,TRNDIC22:
                                TRNDIC23,TRNDIC24,TRNDIC25,TRNDIC26:
                                TRNDIC27,TRNDIC28,TRNDIC29,TRNDIC30
          GOTO      DIAG1000
.
DIAG1900  PACK      DIM8,PTEDOSET,PTEDCODE,SP10                       *C-192779
          ADD       ONE,COUNT
          STORE     DIM8,COUNT,TRANDI1,TRANDI2,TRANDI3,TRANDI4:
                               TRANDI5,TRANDI6,TRANDI7,TRANDI8:
                               TRANDI9,TRANDI10,TRANDI11,TRANDI12:
                               TRANDI13,TRANDI14,TRANDI15,TRANDI16:
                               TRANDI17,TRANDI18,TRANDI19,TRANDI20:
                               TRANDI21,TRANDI22,TRANDI23,TRANDI24:
                               TRANDI25,TRANDI26,TRANDI27,TRANDI28:
                               TRANDI29,TRANDI30
          GOTO      DIAG1000
.
.
.                                           * Procedure Codes
DIAG2000  MOVE      ZERO,COUNT
          PACK      KEY16,AADMNO,SP20                                 *C-240107
          CALL      RSPTECO2                * Position on & read a patient
DIAG3000  CALL      RKPTECO2                  episode operation file record
          BRANCH    OVRCD,DIAG5000
.
          MATCH     AADMNO,PTEOADMN
          GOTO      DIAG5000 IF NOT EQUAL
.
          COMPARE   THIRTY1,COUNT               * maximum of 12 codes
          GOTO      DIAG5000 IF NOT LESS
.
          MOVE      PTEOCODE,DIM8
          ADD       ONE,COUNT
          STORE     DIM8,COUNT,TRANOP1,TRANOP2,TRANOP3,TRANOP4:
                               TRANOP5,TRANOP6,TRANOP7,TRANOP8:
                               TRANOP9,TRANOP10,TRANOP11,TRANOP12:
                               TRANOP13,TRANOP14,TRANOP15,TRANOP16:
                               TRANOP17,TRANOP18,TRANOP19,TRANOP20:
                               TRANOP21,TRANOP22,TRANOP23,TRANOP24:
                               TRANOP25,TRANOP26,TRANOP27,TRANOP28:
                               TRANOP29,TRANOP30
          GOTO      DIAG3000
.
DIAG5000  MOVE      ZERO,EXIT
.
DIAG9999  RETURN
+
.*******************************************************************************
.*                             WRTE0000                   CALLED BY : PROC0000 *
.*                        Write to the transmission file                       *
.*******************************************************************************
WRTE0000  MOVE      ZERO,EXIT
          MOVE      CFILENO,TRANHOSI
          PACK      TRANURNO,SP2,AURNO       * UR Number
          REP       " 0",TRANURNO
          PACK      TRANADMN,SP2,DAADMNO     * Admission Number
          REP       " 0",TRANADMN
.
          UNPACK    PTCNDGPV,KEY1,DIM1,KEY1     * DRG Version
          PACK      TRANDRG,ANSV,DIM1,DOT,KEY1  * format "Vn.n"
          CALL      GDRG0000                    * Get DRG Code
.
          IF        DOYR2025 = ONE
             WRITE     WORK,SEQ;TRANHOSI,TRANURNO,TRANADMN,TRANADAT,TRANDDAT:
                               TRANDOB,TRANLEAV,TRANLVS,TRANGEND,TRANSEX:
                               TRANINDS,TRANMARS,TRANSUBR,TRANCNTY,TRANOCCP:
                               TRANPAYC,TRANSRFL,TRANDCHS,TRANHIS,TRANATYP:
                               TRANCTYP,TRANINFW,TRANMECH,TRANPOST,TRANADCR:
                               TRANMHLS,TRANREAD,TRANAPES,TRANMEST,TRANILOS:
                               TRANIHCP,TRANQNDY,TRANDRG,TRNPDCID;
          ELSE
            WRITE     WORK,SEQ;TRANHOSI,TRANURNO,TRANADMN,TRANADAT,TRANDDAT:
                               TRANDOB,TRANLEAV,TRANLVS,TRANSEX,TRANINDS:
                               TRANMARS,TRANSUBR,TRANCNTY,TRANOCCP,TRANPAYC:
                               TRANSRFL,TRANDCHS,TRANHIS,TRANATYP,TRANCTYP:
                               TRANINFW,TRANMECH,TRANPOST,TRANADCR,TRANMHLS:
                               TRANREAD,TRANAPES,TRANMEST,TRANILOS,TRANIHCP:
                               TRANQNDY,TRANDRG,TRANPDIG;              *C-61453
          ENDIF
.
.         Write the diagnosis codes/diagnosis codes with cluster id 
.         to the transmission file
.
WRTE1500  IF        DOYR2025 = ONE
            WRITE     WORK,SEQ;TRNDIC1,TRNDIC2,TRNDIC3,TRNDIC4:
                               TRNDIC5,TRNDIC6,TRNDIC7,TRNDIC8:
                               TRNDIC9,TRNDIC10,TRNDIC11,TRNDIC12:
                               TRNDIC13,TRNDIC14,TRNDIC15,TRNDIC16:
                               TRNDIC17,TRNDIC18,TRNDIC19,TRNDIC20:
                               TRNDIC21,TRNDIC22,TRNDIC23,TRNDIC24:
                               TRNDIC25,TRNDIC26,TRNDIC27,TRNDIC28:
                               TRNDIC29,TRNDIC30;
          ELSE  
            WRITE     WORK,SEQ;TRANDI1,TRANDI2,TRANDI3,TRANDI4:
                               TRANDI5,TRANDI6,TRANDI7,TRANDI8:
                               TRANDI9,TRANDI10,TRANDI11,TRANDI12:
                               TRANDI13,TRANDI14,TRANDI15,TRANDI16:
                               TRANDI17,TRANDI18,TRANDI19,TRANDI20:
                               TRANDI21,TRANDI22,TRANDI23,TRANDI24:
                               TRANDI25,TRANDI26,TRANDI27,TRANDI28:
                               TRANDI29,TRANDI30;                      *C-61453
          ENDIF
.
.         Write the operation codes to the transmission file
.
WRTE2500  WRITE     WORK,SEQ;TRANOP1,TRANOP2,TRANOP3,TRANOP4:
                             TRANOP5,TRANOP6,TRANOP7,TRANOP8:
                             TRANOP9,TRANOP10,TRANOP11,TRANOP12:
                             TRANOP13,TRANOP14,TRANOP15,TRANOP16:
                             TRANOP17,TRANOP18,TRANOP19,TRANOP20:
                             TRANOP21,TRANOP22,TRANOP23,TRANOP24:
                             TRANOP25,TRANOP26,TRANOP27,TRANOP28:
                             TRANOP29,TRANOP30,TRANCHNM,TRANPSYC:
                             TRANSPRC,TRANADDR,TRANGNAM,TRANSNAM
.
          RETURN
+
.******************************************************************************
.*                                  GDRG0000              Called by: GDGR0000 *
.*                              Get The DRG Code                              *
.******************************************************************************
GDRG0000  MATCH     SP8,DRGDATE 
          GOTO      GDRG9000 IF EQUAL       * Patient not discharged
          MOVE      SP70,TRANDRG
.
          MATCH     PTCNE110,DRGDATE        * disc.date > DRG 11.0 effect.date?
          IF        !@LESS
            MOVE      PTDSDDRG,TRANDRG
            GOTO      GDRG9000
          ENDIF
.
          MATCH     PTCNE100,DRGDATE        * disc.date > DRG 10.0 effect.date?
          IF        !@LESS
            MOVE      PTDSDDRG,TRANDRG
            GOTO      GDRG9000
          ENDIF
.
          MATCH     PTCNED90,DRGDATE        * disc.date > DRG 8.0 effect.date?
          IF        !@LESS
            MOVE      DRG090,DRGVERS        * Use 9.0 DRG version
            GOTO      GDRG4000
          ENDIF
.
          MATCH     PTCNED80,DRGDATE        * disc.date > DRG 8.0 effect.date?
          IF        !@LESS
            MOVE      DRG080,DRGVERS        * Use 8.0 DRG version
            GOTO      GDRG4000
          ENDIF
.
          MATCH     PTCNED70,DRGDATE        * disc.date > DRG 7.0 effect.date?
          IF        !@LESS
            MOVE      DRG070,DRGVERS        * Use 7.0 DRG version
            GOTO      GDRG4000
          ENDIF
.
          MATCH     PTCNED62,DRGDATE        * disc.date > DRG 6.2 effect.date?
          IF        !@LESS
            MOVE      DRG062,DRGVERS        * Using 6.2 DRG version
            GOTO      GDRG4000
          ENDIF
.
          MATCH     PTCNED60,DRGDATE        * disc.date > DRG 6.0 effect.date?
          IF        !@LESS
            MOVE      DRG060,DRGVERS        * Using 6.0 DRG version
            GOTO      GDRG4000
          ENDIF
.
          MATCH     PTCNED52,DRGDATE        * disc.date > DRG 5.2 effect.date?
          IF        !@LESS
            MOVE      DRG052,DRGVERS        * Using 5.2 DRG version
            GOTO      GDRG4000
          ENDIF
.
          MATCH     PTCNED51,DRGDATE        * disc.date > DRG 5.1 effect.date?
          IF        !@LESS
            MOVE      DRG051,DRGVERS        * Using 5.1 DRG version
            GOTO      GDRG4000
          ENDIF
.
          MATCH     PTCNED50,DRGDATE        * disc.date > DRG 5.0 effect.date?
          IF        !@LESS
            MOVE      DRG050,DRGVERS        * Using 5.0 DRG version
            GOTO      GDRG4000
          ENDIF
.
          MATCH     PTCNED42,DRGDATE        * disc.date > DRG 4.2 effect.date?
          IF        !@LESS
            MOVE      DRG042,DRGVERS        * Using 4.2 DRG version
            GOTO      GDRG4000
          ENDIF
.
          MATCH     PTCNED41,DRGDATE        * disc.date > DRG 4.1 effect.date?
          IF        !@LESS
            MOVE      DRG041,DRGVERS        * Using 4.1 DRG version
            GOTO      GDRG4000
          ENDIF
.
          GOTO      GDRG9000
.
GDRG4000  PACK      KEY13,AADMNO,SP1,ONE,DRGVERS
          CALL      RDPTPGR1                * Read a patient grouper file record
          BRANCH    OVRCD,GDRG9000
.
          UNPACK    PTPGGPVR,KEY1,DIM1,KEY1     * DRG Version
          PACK      TRANDRG,ANSV,DIM1,DOT,KEY1  * format "Vn.n"
.
GDRG9000  MOVE      ZERO,EXIT
GDRG9999  RETURN
+
.------------------------------------------------------------
. Move Extract to Web Directory
.------------------------------------------------------------
MVEXT000  MOVE      "tashdp",KEY6           * WORK file name
          CALL      IBACLOCK
          UNPACK    CFILENO,DIM4,DIM2
.
          UNPACK    TODATE,CCENT,CYEAR,CMON,CDAY                       *I-74429
          PACK      KEY10,DIM4,CMON,CCENT,CYEAR                        *I-74429
          REP       " 0",KEY10
.
          CLEAR     CMDLINE                 * re-name Extract file
          APPEND    "mv ",CMDLINE
          APPEND    KEY6,CMDLINE
          APPEND    ".txt ",CMDLINE
          APPEND    KEY10,CMDLINE
          APPEND    ".txt ",CMDLINE
          RESET     CMDLINE
          EXECUTE   CMDLINE,TASKID
.
          CLEAR     CMDLINE                 * Header file
          APPEND    "ibainp48.us1 ",CMDLINE
          APPEND    KEY10,CMDLINE
          APPEND    ".txt ",CMDLINE
          RESET     CMDLINE
          EXECUTE   CMDLINE,TASKID
.
MVEXT999  RETURN
.
+
.******************************************************************************
.                                 DOCNM000
.    Set up doctors name after a successful read on doctor file.
.****************************************************************************
DOCNM000  MOVE      ONE,PACFRMT             * Title Given name Surname
          MOVE      DSNAME,PACSNAME         * use pacdate to fix doctor's name
          MOVE      DGNAME,PACGNAME         * get first letter in given name
          MOVE      DTITL,PACTITLE
          CALL      PACNAME                 * pack up doctor's name
DOCNM999  RETURN
+
.****************************************************************************
.         I/O INCLUDES
.
          INC       STDGENCD
          INC       CALCDAYS
          INC       EXCLNEWB
          INC       PATCODKY                * Keyin code
          INC       PATHSPKY
          INC       SEXDSCIO

.
          INC       PATCODIO/INC            * Patient Codes File
          INC       PATDO1IO/INC
          INC       PATDADIO/INC
          INC       PATVADIO/INC
          INC       PATDSCIO/INC            * Patient discharge File
          INC       PATECDIO/INC            * Patient episode disease file
          INC       PATECOIO/INC            * Patient episode operation file
          INC       PATICUIO/INC
          INC       PATMA1IO/INC            * Patient Master File
          INC       PATMI1IO/INC            * Patient Admission File
          INC       PATTRNIO/INC
          INC       PATPGRIO/INC
.                                                                     *I-192779
          INC       PMSPX2IO/INC            * Master extention 2
          INC       PATVISIO/INC
          INC       PMSVX1IO/INC
          INC       PATHSPIO/INC

+
