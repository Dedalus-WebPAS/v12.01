.******************************************************************************
.* System         : Patient Management                                        *
.* Program        : IBAINP91.PBL                                              *
.* Name           : Extract Data for HCP / HEC                                *
.******************************************************************************
.* Date           : 09/10/1995                                                *
.* Author         : Junior                                                    *
.* Function       : To Create a data file for casemix analysis.               *
.* Modifications  :                                                           *
.*                                                                            *
.******************************************************************************
.* V12.00.03  16/06/2025  J.Tan          TSK 0961623                          *
.*            Fixed issue with Alphanumeric visit number changes              *
.* V12.00.02  03/06/2025  J.Tan          TSK 0955096                          *
.*            Added Alphanumeric visit number changes                         *
.* V12.00.01  30/05/2025 Jacob Jackson   TSK 0955096                          *
.*            Alphanumeric changes                                            *
.* V11.05.02  24/03/2025  Davin          TSK 0956210                          *
.*            Add ICD10 Ed.13 - Go-live Date PTCNGDX3 (Sect.130 Pos.86)       *
.* V11.05.01  13/03/2025  Alina Bhari    Task 0955915                         *
.*            Added DOYR2025 for Stat changes -KDAT8000                       *
.*            Output ICD version "1013" for all extract with or after ICD10 Ed*
.*              13 - Go-live Date PTCNGDX3  -INIT0000,WHED0000                *
.*            Used 2 digit field for the mode of seperation from PTCDUDF3     *
.*              from the codes in CATD or CAT DD - VALSEPMD,GDAT1000          *
.*            Added Validation to accept birth weight to 9999 - GDAT0500      *
.*            Recompile for GETDRG                                            *
.* V11.04.03  08/04/2024  Sunny          Task 0941622                         *
.*            Fixed CALC0000 and CALT0000 - was not checking for next day     *
.* V11.04.02  18/03/2024  Sunny          Task 0941622                         *
.*            Added DOYR2024 for Stat changes                                 *
.* V11.04.01  15/03/2024  J.Tan          Task 0919335                         *
.*            Mod to check HF History file for HF Group and HCP Equivalent    *
.* V11.03.01  07/09/2023  Bella Turco    Task 0930387                         *
.*            Added new routine ERRAP00 - print error message for All Patients*
.*            Added new routine SPLERO00 - split error message into 3 rows    *
.* V11.02.02  08/04/2022  Jill Parkinson Task 0916526                         *
.*            July 2022 changes                                               *
.* V11.02.01  31/03/2022  Davin          TSK 0917793                          *
.*            Add ICD10 Ed.12 - Go-live Date PTCNGDX2 (Sect.128 Pos.231)      *
.* V11.01.06  16/09/2021  Davin          TSK 0911056                          *
.*            Mods to use Cat.G indc3 for DRGSEX (GDAT0250)                   *
.* V11.01.05  09/08/2021  Thanh T        TSK 0897469                          *
.*            Added Extract type option 7 - Private Patients Excluding        *
.*            Public/Reciprocal                                               *
.* V11.01.04  16/06/2021  Jill Parkinson Task 0907716                         *
.*            Reset dates to July 1 2021                                      *
.* V11.01.03  27/04/2021  Ebon Clements  Task 0902746                         *
.*            Report gender from category G indicator 1 - DRGSEX              *
.* V11.01.02  09/04/2021  Jill Parkinson Task 0902614                         *
.*            July 2021 changes                                               *
.* V11.01.01  22/02/2021  J.Tan          TSK 0888639                          *
.*            Changed patmmbs counter record to DIM3                          *
.* V11.00.20  10/11/2020  Ebon Clements  Task 0897216                         *
.*            Added ANSNAP Classification must not be blank error             *
.* V11.00.19  03/09/2020  Jill Parkinson Task 0896838                         *
.*            Changed error for palliative care to care type for July 2020    *
.* V11.00.18  24/08/2020  Thanh T        TSK 0891214                          *
.*            Changed GDAT0550 to output DRGICULS field as when intensive     *
.*            care unit is greater 9999                                       *
.* V11.00.17  20/08/2020  Thanh T        TSK 0891214                          *
.*            Changed GDAT0550 to output DRGCCUHR field as 9999 when critical *
.*            care unit is greater 9999                                       * 
.* V11.00.16  17/08/2020  Thanh T        TSK 0895799                          *
.*            Changed VDAT1000 to not right justified XDRGSCAT field          *
.* V11.00.15  13/08/2020  Thanh T        TSK 0891214                          *
.*            Changed GDAT0550 to output DRGHRS field as 9999 when intensive  *
.*            care unit is greater 9999                                       * 
.* V11.00.14  31/07/2020  J.Tan          Task 0895191                         *
.*            Mod GMLS9000 default DRGLEGST to 8 for Disc.date < 1/7/2029     *
.* V11.00.13  31/07/2020  J.Tan          Task 0895191                         *
.*            Mod GMLS0000 default DRGLEGST to 8 for Disc.date < 1/7/2019     *
.* V11.00.12  24/07/2020  Jill Parkinson Task 0881843                         *
.*            Changed ANSNAP start date= adate and end date=ddate             *
.* V11.00.11  18/06/2020  Jill Parkinson Task 0893436                         *
.*            Changed write of XARDRGVN only for 2020 +                       *
.* V11.00.10  01/06/2020  Jill Parkinson Task 0892532                         *
.*            Changed 2020 start date to 20200701                             *
.* V11.00.09  23/04/2020  Tracey Nguyen  Task 0889652                         *
.*            Statutory Changes 2020-2021 - Removed leading zero and left     *
.*            aligned XARDRGVN                                                *
.* V11.00.08  21/04/2020  Jill Parkinson Task 0889652                         *
.*            Added DOYR2020 functionality                                    *
.*            21/04/2020  Tracey Nguyen  Task 0889652                         *
.*            1)Removed SNAPREC1/EXTRSNA1 variables no longer required        *
.*            2)Used DIM50 for longer error message in VDAT2000               *
.*            3)Checked for DOYR2020 flag in OSNP0000,EXTD8000 to use the     *
.*              correct AN-SNAP file layout                                   *
.*            4)Reverted MVEXT000 back                                        *
.* V11.00.07  20/04/2020  Tracey Nguyen  Task 0889652                         *
.*            Statutory Changes 2020-2021 - Restored DOYR2019 flag            *
.* V11.00.06  17/04/2020  Ebon Clements  Task 0890742                         *
.*            Report 9999 mechanical ventilation hours if hours > 9999        *
.*            for QLD - GDAT0550                                              *
.* V11.00.05  15/04/2020  Tracey Nguyen  Task 0889652                         *
.*            Statutory Changes 2020-2021                                     *
.*            Added check for SNAPRECS/SNAPREC1 in MVEXT000 to move AN-SNAP   *
.*            file to web directory if there are records                      *
.* V11.00.04  15/04/2020  Tracey Nguyen  Task 0889652                         *
.*            Statutory Changes 2020-2021                                     *
.*            Added SNAPREC1 to check for header record in ANSPFIL1           *
.* V11.00.03  08/04/2020  Tracey Nguyen  Task 0889652                         *
.*            Statutory Changes 2020-2021                                     *
.*            1)Added XARDRGVN to INPFIL6 file layout                         *
.*            2)Added ANSPFIL1 - new AN-SNAP file layout                      *
.*            3)Modified - GDAT0000,VDAT0000,WHED0000,WSHD0000,ANSP0000,      *
.*              OSNP0000,MVEXT000                                             *
.* V11.00.02  06/03/2020  Jill Parkinson Task 0881843                         *
.*            Removed change from V10.13.01                                   *
.* V11.00.01 11/03/2020  J.Tan          TSK 0838262                           *
.*           Added Effective from and to date to MBS Item file                *
.* V10.14.07  15/08/2019  Jill Parkinson Task 0879919                         *
.*            Changed SNP file only to not update hcp version in the header   *
.* V10.14.06  15/08/2019  Jill Parkinson Task 0879913                         *
.*            Changed legals status to default to 9 instead of 8 after 07/2019*
.* V10.14.05  04/04/2019  J.Tan          TSK 0870471                          *
.*            Fixed validating Legal status                                   *
.* V10.14.04  04/04/2019  J.Tan          TSK 0870471                          *
.*            Fixed validating Legal status                                   *
.* V10.14.04  04/04/2019  J.Tan          TSK 0870471                          *
.*            Fixed validating Legal status                                   *
.* V10.14.03  18/03/2019  J.Tan          TSK 0870471                          *
.*            Mod for 2019 Statutory changes                                  *
.* V10.14.02  14/03/2019  Don Nguyen     TSK 0869412                          *
.*            Added read of ICD10 Ed.11 Go-live Date parameter (PTCNGDX1)     *
.* V10.14.01  18/02/2019  Ebon Clements  TSK 0829856                          *
.*            Recompiled for GETEFDRG - Contract from effective date          *
.******************************************************************************
.* V10.13.01  09/10/2018  Nicole Torrisi TSK 0863509                          *
.*            Fixed ANSNAP extract to exclude Programs with a Therapy End     *
.*            Date (PMUGENDD) after the End Date of the extract (ENDDTE8)     *
.* V10.12.03  06/06/2018  Thanh T.       TSK 0856952                          *
.*            Changed output extract file name when running Extract data      *
.*            for HCP using the PHDB extract option                           *
.* V10.12.02  25/05/2018  J.Tan          TSK 0854843                          *
.*            Fixed calculating Palliative care days (NHOSPDAY)               *
.* V10.12.01  16/05/2018  J.Tan          TSK 0854843                          *
.*            Exclude leave days from Palliative care days                    *
.******************************************************************************
.* V10.11.01  08/09/2017  Ebon Clements  TSK 0818097                          *
.*            Added excluded newborn functionality -  EXNB0000                *
.* V10.11.02  01/09/2017  Ken Bell       TSK 0807846                          *
.*            Check DVA Card Expiry Date against Visit Date instead of the    *
.*            current date. Local logic added replacing the call to GCCARD00  *
.* V10.11.01  19/07/2017  Davin          TSK 0842120                          *
.*            Check if procedure time is mandatory (PT0ODTMN) before printing *
.*            ERRMSG09 ("No operation times found for 1st Primary MBS code")  *
.* V10.10.04  27/06/2017  Nicole Torrisi TSK 0840444                          *
.*            Changed report back to 80 columns and fixed blank lines         *
.* V10.10.03  17/05/2017  Richa Phogat   TSK 0838585                          *
.*            Modified spelling from 'refferal' to referral' in VDAT1100      *
.* V10.10.02  16/03/2017  Richa Phogat   TSK 0832066                          *
.*            Changed DVA Card Number collected from PMCDCNUM.PMSCCDFD instead* 
.*            f PREPAT.PMIMA1FD                                               *
.* V10.10.01  10/03/2017  Jill Parkinson TSK 0833095                          *
.*            July 2017 changes - 23 hour stay warning and icd/drg version    *
.*            17/03/2017  Davin          TSK 0833093     HDP 2017/2018        *
.*            Add ICD10 Ed.10 - Go-live Date PTCNGDVX (Sect.110 Pos.85)       *
.* V10.09.01  23/01/2017  J.Tan          TSK 0829949                          *
.*            Mods checking for Baby Weight > 9000g to send 0000              *
.* V10.08.09  10/11/2016  Don Nguyen     TSK 0826811                          *
.*            Modified GDAT3000 to check for blank Principal CMBS Procedure   *
.*            Code (DRGPORCD); use Miscellaneous Service Code 1 (DRGMSC01)    *
.*            for operation Date/Time instead.                                *
.* V10.08.08  19/09/2016  J.Tan          TSK 0320461                          *
.*            Mods checking for Baby Weight > 9999g to send 0000              *
.* V10.08.07  06/09/2016  Jill Parkinson TSK 0825001                          *
.*            Added in match of indicator5=3 in GDAT0950                      *
.* V10.08.06  29/08/2016  Jill Parkinson TSK 0824124                          *
.*            Commented out match to indicator4=5 in GDAT0950                 *
.*            26/08/2016  Don Nguyen     TSK 0312570                          *
.*            Recompiled for GETDRG (GTDRG000)                                *
.*            Added PMSEDGFD/IO and GETEFDRG                                  *
.* V10.08.05  18/08/2016  Jill Parkinson TSK 0824094                          *
.*            Mods to allow A as a valid coding prefix                        *
.* V10.08.04  20/07/2016  J.Tan          TSK 0822058                          *
.*            Mods to send zero work adjustment if less than zero             *
.* V10.08.03  23/06/2016  Jill Parkinson TSK 0821050                          *
.*            Added check of mehdlsaf for legal status                        *
.* V10.08.02  03/06/2016  J.Tan          CAR 0817642                          *
.*            Fixed checking credit note for lumpsum amount                   *
.* V10.08.01  29/03/2016  Peter Vela      CAR 0813961                         *
.*            2016 Stat Changes                                               *
.* V10.06.07  08/09/2015  Jill Parkinson CAR 320381                           *
.*            Added use of pmvxelps if it has been entered                    *
.* V10.06.06  06/08/2015  Ebon Clements  CAR 305387                           *
.*            Added ReSubmitted disk option - RSUB0000                        *
.* V10.06.05  02/07/2015  Ebon Clements  CAR 318629                           *
.*            Removed USINGI10 using ICD10 test                               *
.* V10.06.04  01/07/2015  Ebon Clements  CAR 317588                           *
.*            Changed to report H/F membership from the visit extension file  *
.*            PMVXFNDM not the admission file AFNDMM - HFMN3000               *
.* V10.06.03  01/06/2015  Ebon Clements  CAR 317142                           *
.*            Recompiled for GETDRG - Added DRG Version 8.0                   *
.* V10.06.02  14/04/2015  Jill Parkinson CAR 311731                           *
.*            Changed to use AFUNDH instead of PFUNDH for ANSNAP              *
.* V10.06.01  17/03/2015  Davin         CAR 311669      HDP 2015/16           *
.*            Add PTCNGDV9 for ICD10 Ed.9 Go-live Date (Sect.110 Pos.77)      *
.* V10.05.03  26/11/2014  J.Tan            CAR 308879                         *
.*            Mods to use Hospital type from pathspaf file for Multi hospital *
.* V10.05.02  13/11/2014  Davin            CAR 306362                         *
.*            Added 2012 changes to HEC extract                               *
.*            03/11/2014  Davin            CAR 298733                         *
.*            Don't move spaces to fee/charge fields (removed vdat6000 code)  *
.* V10.05.01  18/09/2014  Davin            CAR 304204                         *
.*            Recompiled for GETDRG - get drg vers based on disch date        *
.* V10.04.02  15/06/2014 Jill Parkinson CAR 301639                            *
.*            Moved TFILENAM to INIT000 and call KILL000 on exiting           *
.* V10.04.01  27/02/2014 Ania P          CAR 297649                           *
.*            If PTDSVOGU = 62, move 6x to DRGVOGU - for all values of OPTION *
.*            Previously this was only done if OPTION=5                       *
.* V10.03.18  06/12/2013 Sandra Barcham  CAR 294744                           *
.*            Fix ANSP0000 to allow 20 in care type                           *
.* V10.03.17  03/12/2013 Sandra Barcham  CAR 294744                           *
.*            Fix Discharge FIM score for expressiont                         *
.* V10.03.16  27/11/2013  Patrick Adair  CAR 259559                           *
.*            Do not extract ANSNAP for non rehab patients ANSP0000           *
.* V10.03.15  30/10/2013  Jill Parkinson CAR 288109                           *
.*            Added check for day cases  to be ignored in ANSP0000            *
.* V10.03.14  17/10/2013  Davin         CAR 281275                            *
.*            Submit 6x not 62 for grouper version in PHDB (drgvogu)          *
.* V10.03.13  23/04/2013  Davin         CAR 284420      HDP 2013/14           *
.*            Add PTCNGDV8 for ICD10 Ed.8 Go-live Date (Sect.110 Pos.69)      *
.*        V10.03.12 08/01/2013  Jill Parkinson CAR 277282                     *
.*                  Commented out error at KHGP3000                           *
.*        V10.03.11 04/01/2013  Jill Parkinson CAR 278325                     *
.*                  Mods to only write snap header if snap records exist      *
.* V10.03.10  28/12/2012 Patrick Adair                             CAR 261630 *
.*                       Removed port number from temp file name              *
.*        V10.03.09 20/12/2012  Jill Parkinson CAR 278325                     *
.*                  Added AN-SNAP Header record                               *
.*        V10.03.08 06/12/2012  Patrick Adair  CAR 274409                     *
.*                  Added AN-SNAP extract                                     *
.*        V10.03.07 04/12/2012  Jill Parkinson CAR 277282                     *
.*                  Changed VALHFC00 go to VALHFC91 if no patcfaaf exists     *
.*        V10.03.06 29/11/2012  Jill Parkinson CAR 277282                     *
.*                  Added check for OPTION in VALHFC00                        *
.*        V10.03.05 09/11/2012  Jill Parkinson CAR 263828                     *
.*                  Fixed newborn days length                                 *
.*        V10.03.04 23/10/2012  Don Nguyen     CAR 263828                     *
.*                  Completed remaining sections of 2012 HCP Extract spec.    *
.*                  Modified VCHF0000 to call VALHFC00 for both HCP & HEC     *
.*                  extracts.                                                 *
.*                  Modified VALHFC00 to set the Insurer Identifier (DRGFUND) *
.*                  accordingly for HCP extracts.                             *
.*                  Modified HFMN0000 to set the Insurer Membership Identifier*
.*                  accordingly for HCP extracts.                             *
.*        V10.03.03 03/10/2012  Don Nguyen     CAR 263828                     *
.*                  Changes for November 1 2012 reporting (DOYR2012)          *
.*        V10.03.02 01/06/2012  Don Nguyen     CAR 266366                     *
.*                  Added ability to also do HEC extract (DRGADOCT, VALHFC00) *
.*        V10.03.01 06/01/2012  Mike Laming    CAR 242229                     *
.*                  Add test for "Source of Referral" to validate "Provider No*
.*        V10.02.03 10/06/2011  Saroeun Soeur CAR 238691                      *
.*                  left align KEY14, MMBS2000                                * 
.*        V10.02.02 19/04/2011  Saroeun Soeur CAR 238691                      *
.*                  removed Alphabet char in KEY14, MMBS2000                  * 
.*        V10.02.01 28/03/2011  Mike Laming   CAR 240107                      *
.*                  Mods to PATECDaf & PATECOaf variables & Keys - file change*
.*        V10.01.04 07/03/2011  J.Tan          CAR 233149                     *
.*                  Mods C/P Additional fees to check for Fees Inv. group     *
.*        V10.01.03 15/02/2011  Jill Parkinson CAR 237811                     *
.*                  Commented out match 3,OPTION in HFMN0000                  *
.*        V10.01.02 20/12/2010  Mike Laming   CAR 233046                      *
.*                  Mods to Misc.Charges PATMCHFD - Key change, logic changes *
.*                  24/01/2011  J.Tan         CAR 233200                      *
.*                  Replaced PTCNHCPB with PTCNHCCC                           *
.*        V10.01.01 16/12/2010  Jill Parkinson CAR 233075                     *
.*                  Added move of 1 to WORKHHDY in CLOS0200                   *
.*                  Commented out add 1 to WORKHIHV in FEES3000               *
.*        V10.00.07 23/09/2010  Mike Laming    CAR 219801 (also 226603,222429)*
.*                  Removed PSYCFLAG test for HIH Days (WORKHIHV)             *
.*        V10.00.06 13/07/2010  Jill Parkinson CAR 224999                     *
.*                  Fixed packing of hshospar[]                               *
.*        V10.00.05 06/07/2010  Jill Parkinson CAR 225495                     *
.*                  Fixed lengths of paticuaf fields                          *
.*        V10.00.04 30/04/2010  J.Tan     CAR 220887                          *
.*                  Mods checking for Active/Inactive of Misc.charge          *
.*        V10.00.03 22/04/2010  Jill Parkinson CAR 220506                     *
.*                  July 2010 Changes                                         *
.*        V10.00.02 07/04/2010  Mike Laming   CAR 219246      HDP 2010        *
.*                  Add PTCNGDV7 for ICD10 Ed.7 Go-live Date (Sect.110 Pos.61)*
.*        V10.00.01 18/03/2010  Jill Parkinson  CAR                           *
.*                  Mods to allow for multiple hospitals                      *
.*        V9.12.05  01/03/2010  Steve Armstrong  CAR 212096                   *
.*                  Mods for Unplanned Theatre visit (Cat KB - DRGTHEVS) to   *
.*                  allow HDP Equiv. of "9", but send it as a "2".            *
.*        V9.12.04  06/01/2010  Mike Laming    CAR 212648                     *
.*                  Changed Cat.DD Ind.5 to check "1" "Acute Hosp" at GDAT0950*
.*        V9.12.03  18/12/2009  Jill Parkinson CAR 212771                     *
.*                  Changed to default DRGPALLV to 1 if care type = palliative*
.*        V9.12.02  16/10/2009  Jill Parkinson CAR 297820                     *
.*                  Changed unplanned readmission to use ptcdnhcp             *
.*        V9.12.01  26/05/2009  Jill Habasque  CAR 193603                     *
.*                  Mods to ignore tran source for DD indicator 5=5 and       *
.*                  S indicator 3=2                                           *
.*        V9.11.05  24/02/2009  Mike Laming    CAR 171272                     *
.*                  Mods to routine CHIH0000 to bring in line with V6.16 &    *
.*                  change calc of WORKHIHV - moved to FEES3010               *
.*        V9.11.04  16/02/2009 J.Tan             189944                       *
.*                  Mods Number of Outreach for daycase patients              *
.*        V9.11.03  22/10/2008 Sandra Barcham    180494                       *
.*                  Read item file to check for misc for secondary mbs        *
.*        V9.11.02  17/10/2008 Sandra Barcham    178636                       *
.*                  If record doesnt exist in patitemn use tmisgrp            *
.*        V9.11.01  14/10/2008 Sandra Barcham    180494                       *
.*                  Fix writing miscellaneous service codes to primary MBS    *
.*        V9.10.02  11/07/2008 Jill Habasque CAR 171988                       *
.*                  Mods to clear pmsvx1af if not found (instead of pmspx2af) *
.*        V9.10.01  02/05/2008 Jill Habasque CAR 167672                       *
.*                  July 2008 changes                                         *
.*        V9.09.09  15/04/2008 Jill Habasque CAR 166094                       *
.*                  Copies NT option from 6.16                                *
.*        V9.09.08  26/03/2007 Ian Farnell    CAR  164367                     *
.*                  Use adate not pvidate for admission date                  *
.*        V9.09.07  20/03/2008  Mike Laming   CAR 163918    HDP 2008          *
.*                  Add PTCNGDV6 for ICD10 Ed.6 Go-live                       *
.*        V9.09.06  28/02/2008 Sandra Barcham     CAR 155685                  *
.*                  Check patdtraf for theatre items                          *
.*                  Also print Primary CMBS Code in warning                   *
.*        V9.09.05  13/02/2008  Jill Habasque     CAR 155685                  *
.*                  Added checks for R63Z and L61Z                            *
.*        V9.09.04  11/02/2008 Ian Farnell        CAR 159600                  *
.*                  added read of controlf for PTCNDTRF                       *
.*        V9.09.03  17/12/2007 Sandra Barcham     CAR 157778                  *
.*                  Remove MHCNUSE from opens to stop I * C on mehlagaf       *
.*        V9.09.02  22/11/2007  Steve Armstrong   CAR 155044                  *
.*                  Mods for multi-hospital (get Approval Number from         *
.*                  pathspaf [PTHSAPPR] instead of controlf [CAPPRVNO]).      *
.*                  12/10/2007 Ian Farnell    CAR  134683                     *
.*                  remove match on MHCNUSE so call to GMLS0000 is made for   *
.*                  all patients so Cat LS always used for Mental Health Legal*
.*                  status. removed setting default at CPSY9000               *
.*        V9.09.01  22/11/2007  Peter Vela    CAR  132264                     *
.*                  Recompiled for PATCHCFD                                   *
.******************************************************************************
.*        V9.08.09  01/06/2007  Mike Laming   CAR  fixit                      *
.*                  Replace routine DCLM000 with include for PATDEFCL         *
.*        V9.08.08  18/04/2007 Peter Vela     CAR  135210                     *
.*                  Added Validations for PATITMFD.PTITMSCH - Misc Srv Charge *
.*        V9.08.07  13/03/2007 Sandra Barcham CAR  130450                     *
.*                  Fix incorrect clearing of DRGACCFF instead of DRGLWFF     *
.*        V9.08.06  15/12/2006 Ian Farnell    CAR  124175                     *
.*                  In PLOS6000 Sub 1 from LoS if entire episode is Pall care *
.*        V9.08.05  17/11/2006 Sandra Barcham CAR  122945                     *
.*                  Fix CCU dollar amount                                     *
.*        V9.08.04  31/10/2006 Sandra Barcham CAR  123049                     *
.*                  Fixed Hospital Type to allow for Day Surgery              *
.*                  Moved validation of cat FI tcind6 to theatre fee          *
.*                  Fixed incorrect calculation of Palliative Care Days       *
.*        V9.08.03  17/10/2006 Sandra Barcham CAR  121196                     *
.*                  Stop Same Day Status using category KN should use PTCNDSCI*
.*                  Fixed suffix on mbs items                                 *
.*                  Fixed Legal Status                                        *
.*        V9.08.02  27/09/2006 Sandra Barcham CAR  119121                     *
.*                  Fixed Palliative Care Status 2 does not match care type 33*
.*        V6.08.01  26/09/2006 Sandra Barcham CAR  118958                     *
.*                  Fix PHDB Invalid DRG                                      *
.*                  26/09/2006 Sandra Barcham CAR  120075                     *
.*                  Allow 9 for 2006 Admission Status                         *
.*                  26/09/2006 Sandra Barcham CAR  119475                     *
.*                  Remove from other fees unmapped cat fi                    *
.*                  26/09/2006 Sandra Barcham CAR  120045                     *
.*                  Change error message for baby weight to warning           *
.*        V9.07.09  16/08/2006  Jill Habasque CAR  115867                     *
.*                  Added option 5 - RUN PHDB to get rid of ADT72             *
.*                  Added PLOS0000 to calculate palliative care days          *
.*                  Fixed outreach dates to be DDMMCCYY instead of DDMMYYCC   *
.*                  Added check for 000000000 in theatre and accommodation    *
.*        V9.07.08  15/08/2006 Sandra Barcham CAR 116194                      *
.*                  For DRGREADM in 2006/2006 default is blank but in 2006/2007
.*                  Default should be 8                                       *
.*        V9.07.07  09/08/2006  Mike Laming   CAR 115102                      *
.*                  Correct Intended Length of Stay to Cat."KM" at GDAT3000   *
.*        V9.07.06  04/08/2006  Mike Laming   CAR 113059                      *
.*                  Remove Prosthesis Error message at VDAT8500               *
.*        V9.07.05  02/06/2006  Mike Laming   CAR 114731                      *
.*                  Change DRGPALLV to default to "2" if blank                *
.*        ........  02/06/2006  Mike Laming   CAR 114698                      *
.*                  Change DRGREADM to default to "8" if blank - at GDAT0700  *
.*        V9.07.04  27/07/2006  Mike Laming   CAR 113951                      *
.*                  Add further tests for bundled charges at VDAT6000         *
.*        V9.07.03  29/06/2006  Peter Vela    CAR 108546                      *
.*                  Mods for ABWGHT length change                             *
.*        V9.07.02  06/07/2006  Mike Laming   CAR 111488                      *
.*                  Add date check to "Transfer from and to" (DRGTRNFR)       *
.*        V9.07.01  05/07/2006  Mike Laming   CAR 111104                      *
.*                  Change Unplanned Theatre Visit to "2" if HDP Eqiv not used*
.*        V9.06.01  28/04/2006  Mike Laming   CAR 105249   HDP 2006           *
.*                  Add HCP Changes for July 2006                             *
.*        ........  15/05/2006  Mike Laming   CAR 105244      2006 HDP        *
.*                  ADD PTCNGDV5 for ICD10 Ed.5 Go-live                       *
.*        V9.04.05  02/08/2005  Jill Habasque                                 *
.*                  Mods to send ptvaprov instead of ptdaadts and ptdadcts    *
.*                  Mods to send 8 if not MH for MH Legal status              *
.*                  Removed code for Discharge intention on admission-optional*
.*                  Removed code for Palliative care status (optional field)  *
.*        V9.04.04  20/01/2005  Guomin Fu    CAR 55795                        *
.*                  HCP 2004 changes                                          *
.*        V9.04.03  15/12/2004  Mike Laming  CAR 53930                        *
.*                  Add Cat.FI 2nd Ind."C" to Misc.Items for Bundles/Casemix  *
.*                  at FEES3000                                               *
.*        V9.04.02  05/10/2004  Peter Vela CAR 53371                          *
.*                  Mods for NSW templates                                    *
.*        V9.04.01  23/08/2004  Lina Vo CAR 52901                             *
.*                  Added Multi-Hospital processing                           *
.*        V9.03.08  19/07/2004  J.Tan   CAR 51885                             *
.*                  Mods to check for credit notes                            *
.*        V9.03.07  06/07/2004  Peter Vela       CAR 51505                    *
.*                  - DRGICDN now controlled by start date of extract         *
.*        V9.03.06  10/06/2004  Peter Vela       CAR 50606                    *
.*                  2004 Statutory Changes                                    *
.*                  - DRGICDN new value "1004"                                *
.*                  - DRGVOGU new value "5.0" functionality already in GETDRG *
.*                  - Added Intersex to DRGSEX                                *
.*        V9.03.05  10/06/2004  Ebon Clements CAR 50620                       *
.*                  Added MVEXT000 move extract files to extract directory    *
.*        V9.03.04  15/04/2004  Mike Laming   CAR 48888                       *
.*                  Change to only send Oper.Code with PTEOTYPE = "O"         *
.*        V9.03.03  12/01/2004  Sylvek Litewka  CAR 20222                     *
.*                  Modified procedures DISE0000 and OPER0000 to read ICD     *
.*                  files using new IO routines RDPTICD1 and RDPTICO1 and     *
.*                  patient's discharge date.                                 *
.*        V9.03.02  27/11/2003  Mike Laming  CAR 44498                        *
.*                  At FEES0200, change Casemix to calc WORKBUND as Accomm.   *
.*                  Add Bundled/Casemix Adjustment - Cat J Ind. 2 = "C"       *
.*        V9.03.01  16/09/2003  Lina Vo     CAR 40497                         *
.*                  Changed index and read of patmchgf to include effective   *
.*                  date.                                                     *
.*        V9.02.09  20/12/2002  Mike Laming SRF 34781 (see 23800)             *
.*                  Changed to extract the correct DRG version                *
.*                  16/12/2002  Peter Vela  SRF 33633                         *
.*                  - Enabled use of ERRMSG09                                 *
.*                  - Added code to replace blank admission time with 0001    *
.*        V9.02.08  23/09/2002  Dean Cramer srf 22494                         *
.*                  Allow for null entry in for Health Fund Group in option 3 * 
.*        V9.02.07  16/09/2002  Peter Vela SRF/MOD 19400                      *
.*                  - Urgency of Admission (DRGASTAT)	                      *
.*                    - Can no longer be blank, Error message added           *	
.*                    - 9 to default into it                                  *
.*                  - Care Type (XDRGSCAT)                                    *
.*                    - Changed from Dim1 to Dim3                             *
.*                    - Now gets value from PTCDNHCP, new field in patcodes   *
.*                    - New Validation checks                                 *
.*                  - Inter Hospital Contract patient (DRGCTRST)              *
.*                    Can no longer be blank, Error message added             *
.*                  - Mental Helth Legal Status (DRGLEGST)                    *
.*                    - Default field to 8 if not a psychiatric patient       *
.*                    - Can no longer be blank, Error message added 	      *
.*                    - New validation checks                                 *
.*                    - Mods to use CAT CC  if selected in IBAPAT98           *
.*                  - Added ICD vrsion to Header Record                      *
.*                  - Modified Episode Record to accommodate new field length *
.*        V9.02.06  16/07/2002  Ashwin                                        *
.*                  SRF17204 - Fix Admission Status                           *
.*        V9.02.05  21/06/2002  J.Tan                                         *
.*                  Fixed opening pmsvx1 file                                 *
.*        V9.02.04  23/05/2002  Steve Downing  SRF 17379                      *
.*                  Mods to check dtr rec. type when calculating bundled fees *
.*        V9.02.03  06/12/2001  Tonii                                         *
.*                  Removed Episode flag for casemix funding                  *
.*        V9.02.02  01/11/2001  Greg Horvat                                   *
.*                  Added xtra option to the parameter PTCNDSCI               *
.*        V9.02.01  02/10/2001  Greg Horvat      SRF 13332                    *
.*                  Changed to send the new format no (0400) in the header    *
.*                  record after the 1/7/2001                                 *
.*        V9.00.B02 07/06/2001  Steve Downing                                 *
.*                  Mods to be consistent with NHDD, extra validation on fees *
.*        V5.10.B01 26/02/2001  Jill Habasque                                 *
.*                  Mods for ABWGHT - changed to DIM 6                        *
.*        V5.08.09  03/11/2000  Dean Cramer      SRF 6909                     *
.*                  Recompiled for GETDRG                                     *
.*        V5.08.08  02/11/2000  Dean Cramer      SRF 6909                     *
.*                  Recompiled for GETDRG                                     *
.*                  Clear DRG & MDC code variables so previously read codes   *
.*                  are not returned when none are detected by the get process*
.*                  Also extract these codes from the discharge file for use  *
.*                  as default values.                                        *
.*        V5.08.07  25.10.2000 J.Tan                                          *
.*                  Recompiled for WEB Report Scheduler                       *
.*        V5.08.06  28/09/2000  Tonii                                         *
.*                  Fixed so extract shows 3 for Indeterminate and not I      *
.*        V5.08.05  15/09/2000  Jill Habasque                                 *
.*                  Changed to use GETDRG                                     *
.*        V5.08.04  31/08/2000  Tonii                                         *
.*                  Mods to accept Indeterminate as valid patient sex desc.   *
.*        V5.08.03  16/08/2000  Caleb Sharman                                 *
.*                  Changed Health Fund variables to be 8 chars               *
.*        V5.08.02  06/06/2000  Tonii                                         *
.*                  Changed from KEY10 to KEY14 for the health fund file      *
.*        V5.08.01  01/05/2000  Greg Horvat                                   *
.*                  Changed to open patmx1af when opening patma1af            *
.*        V5.08.B02 15/03/2000  Greg Horvat                                   *
.*                  Changed to read the health fund & misc charges files with *
.*                  the correct keys                                          *
.*        V5.08.B01 15/03/2000  Greg Horvat                                   *
.*                  Changed to get the coding from the episode coding files   *
.*        V5.07.09  14/12/1999  Greg Horvat                                   *
.*                  Recompiled for PATM10T9 - Fixed obstetric & tendon injury *
.*                  complex mapping bugs                                      *
.*                  21/12/1999  Greg Horvat      SRF 636607                   *
.*                  Fixed missing primary disease code error                  *
.*        V5.07.08  09/12/1999  Davin  SRF 636218                             *
.*                  Commented out use of ERRMSG09                             *
.*        V5.07.07  08/12/1999  J Habasque SRF 634935                         *
.*                  Changed Admission type to use 3rd Pos of HDP              *
.*        V5.07.06  26/11/1999  Davin                                         *
.*                  Changed for 4 character drgs                              *
.*        V5.07.05  25/11/1999  J Habasque                                    *
.*                  Added DRGCTRST to be tcindc6 of Cat S                     *
.*        V5.07.04  06/11/1999  Greg Horvat                                   *
.*                  Recompiled for PATM10T9 - Changed for new complex mapping *
.*                  file structure & added more complex maps                  *
.*        V5.07.03  27/10/1999  J Habasque SRF 634935 634936                  *
.*                  Changed DRGSCAT to use tcindc9                            *
.*                  Changed ICU stay (Cat A) to use tcindc10                  *
.*        V5.07.02  11/10/1999  J Habasque                                    *
.*                  Changed DRGVERNO to be 0300                               *
.*        V5.07.01  27/09/1999  Jill Habasque SRF 633907                      *
.*                  Copied changes made in 6.06                               *
.*        V5.07.00  04/05/1999  Andrew Peel      Ported from V6.06.00         *
.*                                                                            *
.******************************************************************************
+
          INC       STD001FD
          INC       PATCALAG/INC            * Calculate age include
.
          INC       IBACONFD/INC
          INC       PAT3MIFD/INC            * ICD9 mapping file
          INC       PATCMPFD/INC            * Complex mapping file
          INC       PATCHCFD/INC            * Care type changes
          INC       PATCODFD/INC            * Codes file
          INC       PATCONFD/INC            * Control file
          INC       PMSCNOFD/INC            * Credit note summary file
          INC       PATDADFD/INC            * Transfer destination file
          INC       PATDDHFD/INC            * HF History file
          INC       PATVADFD/INC            * Transfer destination file
          INC       PATDO1FD/INC            * Doctors file
          INC       PATDSCFD/INC            * Discharge file
          INC       PATDTRFD/INC            * Debtor file
          INC       PATECDFD/INC            * Patient episode disease file
          INC       PATECOFD/INC            * Patient episode operation file
          INC       PMSFCIFD/INC            * Credit note file
          INC       PATFIMFD/INC            * FIM Scores File            C274409
          INC       PATFN1FD/INC            * Health fund file
          INC       PATFX1FD/INC
          INC       PATHSPFD/INC            * Hospital file
          INC       PATHGPFD/INC            * Health fund group file
          INC       PATICDFD/INC            * ICD disease code file
          INC       PATICOFD/INC            * ICD operation code file
          INC       PATICUFD/INC            * ICU file
          INC       PATINVFD/INC            * Invoice file
          INC       PATITMFD/INC            * Item file
          INC       PATMA1FD/INC            * Master file
          INC       PATMCHFD/INC            * Miscellaneous charges file
          INC       PATMI1FD/INC            * Admission file
          INC       PATMMBFD/INC            * Medical records file
          INC       PMSMTIFD/INC            * Misc.Theatre item file
          INC       PATPGRFD/INC            * Patient grouper file
          INC       PATTRNFD/INC            * Bed transfer file
          INC       PATVISFD/INC            * Visit file
          INC       PMSAPGFD/INC            * Program Details Ext File   C274409
          INC       PMSUPGFD/INC            * Program Details File       C274409
          INC       PMSVX1FD/INC            * Visit extension file
          INC       PMSPX2FD/INC
          INC       PATCFAFD/INC            * Claim Code Future Actions file
          INC       PATWC1FD/INC            * Workers Compensation Claims file
          INC       PATWMAFD/INC            * Motor Accident Board Claims file
.
          INC       MEHCONFD/INC            * Mental health controlf    *I-53371
          INC       MEHLEGFD/INC            * Mental health legal status
          INC       MEHDLSFD/INC            * Mental health legal status
          INC       WEBSECFD/INC
          INC       IBASEQFD/INC                 * Sequential Numbers File
          INC       TFILEVAR/INC                 * Generate Temp File Name
          INC       WEBERRFD/INC                 * Web Server Error Logging
          INC       PMSEDGFD/INC       * Effective DRG Dates
          INC       PMSCCDFD/INC
.
. ----- Tempfile Variables -----
.
INPFILE1  FILE      ASCII, FIXED=513 (icd9 only)
INPFILE2  FILE      ASCII, FIXED=753 (icd9 & icd10)
.
.EXTRACT FILE LAYOUT - For HCP
.-------------------
.Header Record
.-------------
.Name     Type    Length    Start  Description
.-------  ----    ------    -----  -----------
DRGHOSPN  DIM       8         1    Hospital provider number
DRGFNDID  DIM       3         9    Fund / group identifier
DRGDSKRN  DIM       8         12   Diskette reference number
DRGDATPR  DIM       8         20   Date prepared (ddmmccyy)
DRGNOREC  DIM       4         28   Number of records
DRGTSTFG  DIM       1         32   Test flag
DRGRESUB  DIM       1         33   Resubmitted disk
DRGSTRT   DIM       8         34   Period start (ddmmccyy)
DRGEND    DIM       8         42   Period end (ddmmccyy)
DRGVERNO  DIM       4         50   HCP version no
.
.End of Record                54
.
.Episode Records
.---------------
.Name     Type    Length    Start  Description
.-------  ----    ------    -----  -----------
DRGMEMBN  DIM       15        1    Health fund membership no./repat no.
DRGFUND   DIM       3         16   Fund identifer
DRGADMN   DIM       15        19   Admission number
DRGSNAME  DIM       28        34   Patients surname
DRGGNAME  DIM       20        62   Patients given name
DRGBDAT   DIM       8         82   Birth date (ddmmccyy)
DRGPCODE  DIM       4         90   Patients postcode
DRGSEX    DIM       1         94   Sex (1=Male, 2=Female,3=Indeter, 9= Unknown)
DRGADAT   DIM       8         95   Admission date (ddmmccyy)
DRGDDAT   DIM       8        103   Discharge date (ddmmccyy)
DRGHTYPE  DIM       1        111   Hospital type
DRGICULS  DIM       3        112   ICU length of stay
DRGDRG    DIM       3        115   DRG code
DRGVOGU   DIM       2        118   Version of grouper used
DRGATME   DIM       4        120   Admission time (hhmm)
DRGADMTT  DIM       1        124   Patients admission transfer type
.SP3      DIM       3        125   3 spaces
.SP3      DIM       3        128   3 spaces
DRGAWHT   DIM       4        131   Admission weight (< 365 days old)
DRGHMV    DIM       4        135   Hours on mechanical ventilation
DRGSEP    DIM       2        139   Separation mode
DRGDTME   DIM       4        141   Discharge time (hhmm)
DRGDSCTT  DIM       1        145   Patients discharge transfer type
.SP4      DIM       4        146   4 spaces
DRGLDAYS  DIM       4        150   Patients leave days
DRGNALOS  DIM       4        154   Non-acute length of stay
DRGDIAG   DIM       5        158   Primary diagnoses
DRGSD01   DIM       5        163   Secondary diagnosis 1
DRGSD02   DIM       5        168   Secondary diagnosis 2
DRGSD03   DIM       5        173   Secondary diagnosis 3
DRGSD04   DIM       5        178   Secondary diagnosis 4
DRGSD05   DIM       5        183   Secondary diagnosis 5
DRGSD06   DIM       5        188   Secondary diagnosis 6
DRGSD07   DIM       5        193   Secondary diagnosis 7
DRGSD08   DIM       5        198   Secondary diagnosis 8
DRGSD09   DIM       5        203   Secondary diagnosis 9
DRGSD10   DIM       5        208   Secondary diagnosis 10
DRGSD11   DIM       5        213   Secondary diagnosis 11
DRGSD12   DIM       5        218   Secondary diagnosis 12
DRGSD13   DIM       5        223   Secondary diagnosis 13
DRGSD14   DIM       5        228   Secondary diagnosis 14
DRGOPER   DIM       4        233   Primary operation
DRGSO01   DIM       4        237   Secondary operation code 1
DRGSO02   DIM       4        241   Secondary operation code 2
DRGSO03   DIM       4        245   Secondary operation code 3
DRGSO04   DIM       4        249   Secondary operation code 4
DRGSO05   DIM       4        253   Secondary operation code 5
DRGSO06   DIM       4        257   Secondary operation code 6
DRGSO07   DIM       4        261   Secondary operation code 7
DRGSO08   DIM       4        265   Secondary operation code 8
DRGSO09   DIM       4        269   Secondary operation code 9
DRGSO10   DIM       4        273   Secondary operation code 10
DRGSO11   DIM       4        277   Secondary operation code 11
DRGSO12   DIM       4        281   Secondary operation code 12
DRGSO13   DIM       4        285   Secondary operation code 13
DRGSO14   DIM       4        289   Secondary operation code 14
DRGILOS   DIM       1        293   Sameday patient flag / intended LOS
DRGPORCD  DIM       11       294   Princpal CMBS procedure code
DRGPORDT  DIM       8        305   Princpal CMBS procedure date (ddmmccyy)
DRGPORTM  DIM       4        313   Princpal CMBS procedure time
DRGSMBS1  DIM       110      317   Secondary CMBS procedure codes
DRGSMBS2  DIM       44       427   Secondary CMBS procedure codes
DRGACCFE  DIM       6        471   Accommodation fee (for wards)
DRGORFE   DIM       5        477   OR fee
DRGLWFE   DIM       5        482   Labour ward fee
DRGICUFE  DIM       5        487   ICU fee
DRGPROFE  DIM       5        492   Prosthesis fee
DRGPHAFE  DIM       5        497   Pharmaceutical fee
DRGOTHFE  DIM       5        502   Other fees
DRGBUNFE  DIM       6        507   Bundled/casemix fees
DRGURNO   DIM       8
.
.End of Record (icd9 only)   513
.
DRG10PDG  DIM       5        513   Principle Diagnosis (icd10)
DRG10D01  DIM       5        518   Additional Diagnosis 1 (icd10)
DRG10D02  DIM       5        523   Additional Diagnosis 2 (icd10)
DRG10D03  DIM       5        528   Additional Diagnosis 3 (icd10)
DRG10D04  DIM       5        533   Additional Diagnosis 4 (icd10)
DRG10D05  DIM       5        538   Additional Diagnosis 5 (icd10)
DRG10D06  DIM       5        543   Additional Diagnosis 6 (icd10)
DRG10D07  DIM       5        548   Additional Diagnosis 7 (icd10)
DRG10D08  DIM       5        553   Additional Diagnosis 8 (icd10)
DRG10D09  DIM       5        558   Additional Diagnosis 9 (icd10)
DRG10D10  DIM       5        563   Additional Diagnosis 10 (icd10)
DRG10D11  DIM       5        568   Additional Diagnosis 11 (icd10)
DRG10D12  DIM       5        573   Additional Diagnosis 12 (icd10)
DRG10D13  DIM       5        578   Additional Diagnosis 13 (icd10)
DRG10D14  DIM       5        583   Additional Diagnosis 14 (icd10)
DRG10D15  DIM       5        588   Additional Diagnosis 15 (icd10)
DRG10D16  DIM       5        593   Additional Diagnosis 16 (icd10)
DRG10D17  DIM       5        598   Additional Diagnosis 17 (icd10)
DRG10D18  DIM       5        603   Additional Diagnosis 18 (icd10)
DRG10D19  DIM       5        608   Additional Diagnosis 19 (icd10)
DRG10PPR  DIM       7        613   Principle Procedure (icd10)
DRG10P01  DIM       7        620   Additional Procedure 1 (icd10)
DRG10P02  DIM       7        627   Additional Procedure 2 (icd10)
DRG10P03  DIM       7        634   Additional Procedure 3 (icd10)
DRG10P04  DIM       7        641   Additional Procedure 4 (icd10)
DRG10P05  DIM       7        648   Additional Procedure 5 (icd10)
DRG10P06  DIM       7        655   Additional Procedure 6 (icd10)
DRG10P07  DIM       7        662   Additional Procedure 7 (icd10)
DRG10P08  DIM       7        669   Additional Procedure 8 (icd10)
DRG10P09  DIM       7        676   Additional Procedure 9 (icd10)
DRG10P10  DIM       7        683   Additional Procedure 10 (icd10)
DRG10P11  DIM       7        690   Additional Procedure 11 (icd10)
DRG10P12  DIM       7        697   Additional Procedure 12 (icd10)
DRG10P13  DIM       7        704   Additional Procedure 13 (icd10)
DRG10P14  DIM       7        711   Additional Procedure 14 (icd10)
DRG10P15  DIM       7        718   Additional Procedure 15 (icd10)
DRG10P16  DIM       7        725   Additional Procedure 16 (icd10)
DRG10P17  DIM       7        732   Additional Procedure 17 (icd10)
DRG10P18  DIM       7        739   Additional Procedure 18 (icd10)
DRG10P19  DIM       7        746   Additional Procedure 19 (icd10)
.
.End of Record (icd10 only)  753
.
INPFILE3  FILE      ASCII, FIXED=617 (After 01/07/1999)
.
.Header Record
.-------------
.Name     Type    Length    Start  Description
.-------  ----    ------    -----  -----------
.DRGHOSPN  DIM       8         1    Hospital provider number
.DRGFNDID  DIM       3         9    Fund / group identifier
.DRGDSKRN  DIM       8         12   Diskette reference number
.DRGDATPR  DIM       8         20   Date prepared (ddmmccyy)
.DRGNOREC  DIM       4         28   Number of records
.DRGTSTFG  DIM       1         32   Test flag
.DRGRESUB  DIM       1         33   Resubmitted disk
.DRGSTRT   DIM       8         34   Period start (ddmmccyy)
.DRGEND    DIM       8         42   Period end (ddmmccyy)
.DRGVERNO  DIM       4         50   HCP version no
.
.End of Record                 54
.
.Episode Records
.---------------
.Name     Type    Length    Start  Description
.-------  ----    ------    -----  -----------
.DRGMEMBN DIM       15        1    Health fund membership no./repat no.
.DRGFUND  DIM       3         16   Fund identifer
.DRGADMN  DIM       15        19   Admission number
.DRGSNAME DIM       28        34   Patients surname
.DRGGNAME DIM       20        62   Patients given name
.DRGBDAT  DIM       8         82   Birth date (ddmmccyy)
.DRGPCODE DIM       4         90   Patients postcode
.DRGSEX   DIM       1         94   Sex (1=Male, 2=Female,3=Indeter, 9= Unknown)
DRGMSTAT  DIM       1         95   Marital status
.DRGADAT  DIM       8         96   Admission date (ddmmccyy)
.DRGDDAT  DIM       8        104   Discharge date (ddmmccyy)
.DRGHTYPE DIM       1        112   Hospital type
.DRGICULS DIM       3        113   ICU length of stay
DRGHRS    DIM       4        116   ICU Hrs
DRGPSYC   DIM       3        120   Total Psychiatric care days
XDRGDRG   DIM       4        123   DRG code
.DRGVOGU  DIM       2        127   Version of grouper used
.DRGATME  DIM       4        129   Admission time (hhmm)
DRGASTAT  DIM       1        133   Admission status/Urgency Status
DRGTRNFR  DIM       8        134   Provider number of hospital transfer from
DRGSCAT   DIM       1        142   Service category
DRGASRC   DIM       1        143   Source of referral
DRGDSINT  DIM       1        144   Discharge intention on admission
DRGCTRST  DIM       1        145   Contract status on admission
DRGLEGST  DIM       1        146   Mental health legal status
DRGPALLV  DIM       1        147   Palliative care status
DRGREADM  DIM       1        148   Unplanned readmission within 28 days
DRGTHEVS  DIM       1        149   Unplanned theatre visit
.DRGAWHT  DIM       4        150   Admission weight (< 365 days old)
.DRGHMV   DIM       4        154   Hours on mechanical ventilation
.DRGSEP   DIM       2        158   Separation mode
.DRGDTME  DIM       4        160   Discharge time (hhmm)
.DRGLDAYS DIM       4        164   Patients leave days
DRGTRNTO  DIM       8        168   Provider number of hospital transfer to
.DRGNALOS DIM       4        176   Non-acute length of stay
DRGDYHOM  DIM       2        180   Total days spent at home
.DRG10PDG DIM       5        182   Principle Diagnosis (icd10)
.DRG10D01 DIM       5        187   Additional Diagnosis 1 (icd10)
.DRG10D02 DIM       5        192   Additional Diagnosis 2 (icd10)
.DRG10D03 DIM       5        197   Additional Diagnosis 3 (icd10)
.DRG10D04 DIM       5        202   Additional Diagnosis 4 (icd10)
.DRG10D05 DIM       5        207   Additional Diagnosis 5 (icd10)
.DRG10D06 DIM       5        212   Additional Diagnosis 6 (icd10)
.DRG10D07 DIM       5        217   Additional Diagnosis 7 (icd10)
.DRG10D08 DIM       5        222   Additional Diagnosis 8 (icd10)
.DRG10D09 DIM       5        227   Additional Diagnosis 9 (icd10)
.DRG10D10 DIM       5        232   Additional Diagnosis 10 (icd10)
.DRG10D11 DIM       5        237   Additional Diagnosis 11 (icd10)
.DRG10D12 DIM       5        242   Additional Diagnosis 12 (icd10)
.DRG10D13 DIM       5        247   Additional Diagnosis 13 (icd10)
.DRG10D14 DIM       5        252   Additional Diagnosis 14 (icd10)
.DRG10D15 DIM       5        257   Additional Diagnosis 15 (icd10)
.DRG10D16 DIM       5        262   Additional Diagnosis 16 (icd10)
.DRG10D17 DIM       5        267   Additional Diagnosis 17 (icd10)
.DRG10D18 DIM       5        272   Additional Diagnosis 18 (icd10)
.DRG10D19 DIM       5        277   Additional Diagnosis 19 (icd10)
.DRG10PPR DIM       7        282   Principle Procedure (icd10)
.DRG10P01 DIM       7        289   Additional Procedure 1 (icd10)
.DRG10P02 DIM       7        296   Additional Procedure 2 (icd10)
.DRG10P03 DIM       7        303   Additional Procedure 3 (icd10)
.DRG10P04 DIM       7        310   Additional Procedure 4 (icd10)
.DRG10P05 DIM       7        317   Additional Procedure 5 (icd10)
.DRG10P06 DIM       7        324   Additional Procedure 6 (icd10)
.DRG10P07 DIM       7        331   Additional Procedure 7 (icd10)
.DRG10P08 DIM       7        338   Additional Procedure 8 (icd10)
.DRG10P09 DIM       7        345   Additional Procedure 9 (icd10)
.DRG10P10 DIM       7        352   Additional Procedure 10 (icd10)
.DRG10P11 DIM       7        359   Additional Procedure 11 (icd10)
.DRG10P12 DIM       7        366   Additional Procedure 12 (icd10)
.DRG10P13 DIM       7        373   Additional Procedure 13 (icd10)
.DRG10P14 DIM       7        380   Additional Procedure 14 (icd10)
.DRG10P15 DIM       7        387   Additional Procedure 15 (icd10)
.DRG10P16 DIM       7        394   Additional Procedure 16 (icd10)
.DRG10P17 DIM       7        401   Additional Procedure 17 (icd10)
.DRG10P18 DIM       7        408   Additional Procedure 18 (icd10)
.DRG10P19 DIM       7        415   Additional Procedure 19 (icd10)
.DRGILOS  DIM       1        422   Sameday patient flag / intended LOS
XDRGPORC  DIM       14       423   Princpal CMBS procedure code
.DRGPORDT DIM       8        437   Princpal CMBS procedure date (ddmmccyy)
.DRGPORTM DIM       4        445   Princpal CMBS procedure time
XDRGSMB1  DIM       70       449   Secondary CMBS procedure codes
XDRGSMB2  DIM       56       519   Secondary CMBS procedure codes
.DRGACCFE DIM       6        575   Accommodation fee (for wards)
.DRGORFE  DIM       5        581   OR fee
.DRGLWFE  DIM       5        586   Labour ward fee
.DRGICUFE DIM       5        591   ICU fee
.DRGPROFE DIM       5        596   Prosthesis fee
.DRGPHAFE DIM       5        601   Pharmaceutical fee
.DRGOTHFE DIM       5        606   Other fees
.DRGBUNFE DIM       6        611   Bundled/casemix fees
.
.End of Record               617
.
INPFILE4  FILE      ASCII, FIXED=619 (After 01/07/2002)
.
.Header Record
.-------------
.Name     Type    Length    Start  Description
.-------  ----    ------    -----  -----------
.DRGHOSPN  DIM       8         1    Hospital provider number
.DRGFNDID  DIM       3         9    Fund / group identifier
.DRGDSKRN  DIM       8         12   Diskette reference number
.DRGDATPR  DIM       8         20   Date prepared (ddmmccyy)
.DRGNOREC  DIM       4         28   Number of records
.DRGTSTFG  DIM       1         32   Test flag
.DRGRESUB  DIM       1         33   Resubmitted disk
.DRGSTRT   DIM       8         34   Period start (ddmmccyy)
.DRGEND    DIM       8         42   Period end (ddmmccyy)
.DRGVERNO  DIM       4         50   HCP version no
DRGICDVN   DIM       4         54   ICD version no
.
.End of Record                 58
.
.Episode Records
.---------------
.Name     Type    Length    Start  Description
.-------  ----    ------    -----  -----------
.DRGMEMBN DIM       15        1    Health fund membership no./repat no.
.DRGFUND  DIM       3         16   Fund identifer
.DRGADMN  DIM       15        19   Admission number
.DRGSNAME DIM       28        34   Patients surname
.DRGGNAME DIM       20        62   Patients given name
.DRGBDAT  DIM       8         82   Birth date (ddmmccyy)
.DRGPCODE DIM       4         90   Patients postcode
.DRGSEX   DIM       1         94   Sex (1=Male, 2=Female, 0= Unknown)
.DRGMSTAT DIM       1         95   Marital status
.DRGADAT  DIM       8         96   Admission date (ddmmccyy)
.DRGDDAT  DIM       8        104   Discharge date (ddmmccyy)
.DRGHTYPE DIM       1        112   Hospital type
.DRGICULS DIM       3        113   ICU length of stay
.DRGHRS   DIM       4        116   ICU Hrs
.DRGPSYC  DIM       3        120   Total Psychiatric care days
.XDRGDRG  DIM       4        123   DRG code
.DRGVOGU  DIM       2        127   Version of grouper used
.DRGATME  DIM       4        129   Admission time (hhmm)
.DRGASTAT DIM       1        133   Admission status/Urgency Status
.DRGTRNFR DIM       8        134   Provider number of hospital transfer from
XDRGSCAT  DIM       3        142   Service category
.DRGASRC  DIM       1        145   Source of referral
.DRGDSINT DIM       1        146   Discharge intention on admission
.DRGCTRST DIM       1        147   Contract status on admission
.DRGLEGST DIM       1        148   Mental health legal status
.DRGPALLV DIM       1        149   Palliative care status
.DRGREADM DIM       1        150   Unplanned readmission within 28 days
.DRGTHEVS DIM       1        151   Unplanned theatre visit
.DRGAWHT  DIM       4        152   Admission weight (< 365 days old)
.DRGHMV   DIM       4        156   Hours on mechanical ventilation
.DRGSEP   DIM       2        160   Separation mode
.DRGDTME  DIM       4        162   Discharge time (hhmm)
.DRGLDAYS DIM       4        166   Patients leave days
.DRGTRNTO DIM       8        170   Provider number of hospital transfer to
.DRGNALOS DIM       4        178   Non-acute length of stay
.DRGDYHOM DIM       2        182   Total days spent at home
.DRG10PDG DIM       5        184   Principle Diagnosis (icd10)
.DRG10D01 DIM       5        189   Additional Diagnosis 1 (icd10)
.DRG10D02 DIM       5        194   Additional Diagnosis 2 (icd10)
.DRG10D03 DIM       5        199   Additional Diagnosis 3 (icd10)
.DRG10D04 DIM       5        204   Additional Diagnosis 4 (icd10)
.DRG10D05 DIM       5        209   Additional Diagnosis 5 (icd10)
.DRG10D06 DIM       5        214   Additional Diagnosis 6 (icd10)
.DRG10D07 DIM       5        219   Additional Diagnosis 7 (icd10)
.DRG10D08 DIM       5        224   Additional Diagnosis 8 (icd10)
.DRG10D09 DIM       5        229   Additional Diagnosis 9 (icd10)
.DRG10D10 DIM       5        234   Additional Diagnosis 10 (icd10)
.DRG10D11 DIM       5        239   Additional Diagnosis 11 (icd10)
.DRG10D12 DIM       5        244   Additional Diagnosis 12 (icd10)
.DRG10D13 DIM       5        249   Additional Diagnosis 13 (icd10)
.DRG10D14 DIM       5        254   Additional Diagnosis 14 (icd10)
.DRG10D15 DIM       5        259   Additional Diagnosis 15 (icd10)
.DRG10D16 DIM       5        264   Additional Diagnosis 16 (icd10)
.DRG10D17 DIM       5        269   Additional Diagnosis 17 (icd10)
.DRG10D18 DIM       5        274   Additional Diagnosis 18 (icd10)
.DRG10D19 DIM       5        279   Additional Diagnosis 19 (icd10)
.DRG10PPR DIM       7        284   Principle Procedure (icd10)
.DRG10P01 DIM       7        291   Additional Procedure 1 (icd10)
.DRG10P02 DIM       7        298   Additional Procedure 2 (icd10)
.DRG10P03 DIM       7        305   Additional Procedure 3 (icd10)
.DRG10P04 DIM       7        312   Additional Procedure 4 (icd10)
.DRG10P05 DIM       7        319   Additional Procedure 5 (icd10)
.DRG10P06 DIM       7        326   Additional Procedure 6 (icd10)
.DRG10P07 DIM       7        333   Additional Procedure 7 (icd10)
.DRG10P08 DIM       7        340   Additional Procedure 8 (icd10)
.DRG10P09 DIM       7        347   Additional Procedure 9 (icd10)
.DRG10P10 DIM       7        354   Additional Procedure 10 (icd10)
.DRG10P11 DIM       7        361   Additional Procedure 11 (icd10)
.DRG10P12 DIM       7        368   Additional Procedure 12 (icd10)
.DRG10P13 DIM       7        375   Additional Procedure 13 (icd10)
.DRG10P14 DIM       7        382   Additional Procedure 14 (icd10)
.DRG10P15 DIM       7        389   Additional Procedure 15 (icd10)
.DRG10P16 DIM       7        396   Additional Procedure 16 (icd10)
.DRG10P17 DIM       7        403   Additional Procedure 17 (icd10)
.DRG10P18 DIM       7        410   Additional Procedure 18 (icd10)
.DRG10P19 DIM       7        417   Additional Procedure 19 (icd10)
.DRGILOS  DIM       1        424   Sameday patient flag / intended LOS
.XDRGPORC DIM       14       425   Princpal CMBS procedure code
.DRGPORDT DIM       8        439   Princpal CMBS procedure date (ddmmccyy)
.DRGPORTM DIM       4        447   Princpal CMBS procedure time
.XDRGSMB1 DIM       70       451   Secondary CMBS procedure codes
.XDRGSMB2 DIM       56       521   Secondary CMBS procedure codes
.DRGACCFE DIM       6        577   Accommodation fee (for wards)
.DRGORFE  DIM       5        583   OR fee
.DRGLWFE  DIM       5        588   Labour ward fee
.DRGICUFE DIM       5        593   ICU fee
.DRGPROFE DIM       5        598   Prosthesis fee
.DRGPHAFE DIM       5        603   Pharmaceutical fee
.DRGOTHFE DIM       5        608   Other fees
.DRGBUNFE DIM       6        613   Bundled/casemix fees
.DRGURNO  DIM       8        619   Patient UR number  * only for Northern Terr.
.
.End of Record               627
.
.******************************************** start of addition       *I-105249
INPFILE5  FILE      ASCII, FIXED=1215 (After 01/07/2006)
.
.Header Record
.-------------
.Name     Type    Length    Start  Description
.-------  ----    ------    -----  -----------
.DRGHOSPN  DIM       8         1    Hospital provider number
.DRGFNDID  DIM       3         9    Fund / group identifier
.DRGDSKRN  DIM       8         12   Diskette reference number
.DRGDATPR  DIM       8         20   Date prepared (ddmmccyy)
.DRGNOREC  DIM       4         28   Number of records
.DRGTSTFG  DIM       1         32   Test flag
.DRGRESUB  DIM       1         33   Resubmitted disk
.DRGSTRT   DIM       8         34   Period start (ddmmccyy)
.DRGEND    DIM       8         42   Period end (ddmmccyy)
.DRGVERNO  DIM       4         50   HCP version no
.DRGICDVN  DIM       4         54   ICD version no
.
.End of Record                 58
.
.Episode Records
.---------------
.Name     Type    Length    Start  Description
.-------  ----    ------    -----  -----------
.DRGMEMBN DIM       15        1    Health fund membership no./repat no.
.DRGFUND  DIM       3         16   Fund identifer
.DRGADMN  DIM       15        19   Admission number / Episode Identifier
.DRGSNAME DIM       28        34   Patients surname / Family Name
.DRGGNAME DIM       20        62   Patients given name
.DRGBDAT  DIM       8         82   Birth date (ddmmccyy)
.DRGPCODE DIM       4         90   Patients postcode
.DRGSEX   DIM       1         94   Sex (1=Male, 2=Female,
.                                       3=Indeter, 4=Intersex, 9= Unknown)
.DRGADAT  DIM       8         95   Admission date (ddmmccyy)
.DRGDDAT  DIM       8        103   Discharge date (ddmmccyy)
.DRGHTYPE DIM       1        111   Hospital type
.DRGICULS DIM       3        112   ICU length of stay / ICU Days
.DRGHRS   DIM       4        115   ICU Hrs
.DRGPSYC  DIM       3        119   Total Psychiatric care days
.XDRGDRG  DIM       4        122   DRG code
.DRGVOGU  DIM       2        126   Version of grouper / DRG Version
.DRGATME  DIM       4        128   Admission time (hhmm)
.DRGASTAT DIM       1        132   Admission status/Urgency Status
.DRGTRNFR DIM       8        133   Provider number of hospital transfer from
.XDRGSCAT DIM       3        141   Care Type (Service category)
.DRGASRC  DIM       1        144   Source of referral
.DRGDSINT DIM       1        145   Discharge intention on admission
.DRGCTRST DIM       1        146   Contract status / Inter-Hosp Contract Patient
.DRGLEGST DIM       1        147   Mental health legal status
.DRGPALLV DIM       1        148   Palliative care status
.DRGREADM DIM       1        149   Readmission within 28 days             *Chng
.DRGTHEVS DIM       1        150   Unplanned theatre visit
.DRGAWHT  DIM       4        151   Infant Admission weight (< 365 days old)
.DRGHMV   DIM       4        155   Hours on mechanical ventilation
.DRGSEP   DIM       2        159   Separation mode
.DRGDTME  DIM       4        161   Discharge time (hhmm)
.DRGLDAYS DIM       4        165   Patients leave days
.DRGTRNTO DIM       8        169   Provider number of hospital transfer to
.DRGNALOS DIM       4        177   Non-certified days of stay             *Chng
DRGHIHDY  DIM       4        181   No.of Outreach (Hosp-in-the-home) days *Chng
.DRG10PDG DIM       5        185   Principle Diagnosis (icd10)
.DRG10D01 DIM       5        190   Additional Diagnosis 1 (icd10)
.DRG10D02 DIM       5        195   Additional Diagnosis 2 (icd10)
.DRG10D03 DIM       5        200   Additional Diagnosis 3 (icd10)
.DRG10D04 DIM       5        205   Additional Diagnosis 4 (icd10)
.DRG10D05 DIM       5        210   Additional Diagnosis 5 (icd10)
.DRG10D06 DIM       5        215   Additional Diagnosis 6 (icd10)
.DRG10D07 DIM       5        220   Additional Diagnosis 7 (icd10)
.DRG10D08 DIM       5        225   Additional Diagnosis 8 (icd10)
.DRG10D09 DIM       5        230   Additional Diagnosis 9 (icd10)
.DRG10D10 DIM       5        235   Additional Diagnosis 10 (icd10)
.DRG10D11 DIM       5        240   Additional Diagnosis 11 (icd10)
.DRG10D12 DIM       5        245   Additional Diagnosis 12 (icd10)
.DRG10D13 DIM       5        250   Additional Diagnosis 13 (icd10)
.DRG10D14 DIM       5        255   Additional Diagnosis 14 (icd10)
.DRG10D15 DIM       5        260   Additional Diagnosis 15 (icd10)
.DRG10D16 DIM       5        265   Additional Diagnosis 16 (icd10)
.DRG10D17 DIM       5        270   Additional Diagnosis 17 (icd10)
.DRG10D18 DIM       5        275   Additional Diagnosis 18 (icd10)
.DRG10D19 DIM       5        280   Additional Diagnosis 19 (icd10)
DRG10D20  DIM       5        285   Additional Diagnosis 20 (icd10)
DRG10D21  DIM       5        290   Additional Diagnosis 21 (icd10)
DRG10D22  DIM       5        295   Additional Diagnosis 22 (icd10)
DRG10D23  DIM       5        300   Additional Diagnosis 23 (icd10)
DRG10D24  DIM       5        305   Additional Diagnosis 24 (icd10)
DRG10D25  DIM       5        310   Additional Diagnosis 25 (icd10)
DRG10D26  DIM       5        315   Additional Diagnosis 26 (icd10)
DRG10D27  DIM       5        320   Additional Diagnosis 27 (icd10)
DRG10D28  DIM       5        325   Additional Diagnosis 28 (icd10)
DRG10D29  DIM       5        330   Additional Diagnosis 29 (icd10)
DRG10D30  DIM       5        330   Additional Diagnosis 30 (icd10)
DRG10D31  DIM       5        340   Additional Diagnosis 31 (icd10)
DRG10D32  DIM       5        345   Additional Diagnosis 32 (icd10)
DRG10D33  DIM       5        350   Additional Diagnosis 33 (icd10)
DRG10D34  DIM       5        355   Additional Diagnosis 34 (icd10)
DRG10D35  DIM       5        360   Additional Diagnosis 35 (icd10)
DRG10D36  DIM       5        365   Additional Diagnosis 36 (icd10)
DRG10D37  DIM       5        370   Additional Diagnosis 37 (icd10)
DRG10D38  DIM       5        375   Additional Diagnosis 38 (icd10)
DRG10D39  DIM       5        380   Additional Diagnosis 39 (icd10)
DRG10D40  DIM       5        385   Additional Diagnosis 40 (icd10)
DRG10D41  DIM       5        390   Additional Diagnosis 41 (icd10)
DRG10D42  DIM       5        395   Additional Diagnosis 42 (icd10)
DRG10D43  DIM       5        400   Additional Diagnosis 43 (icd10)
DRG10D44  DIM       5        405   Additional Diagnosis 44 (icd10)
DRG10D45  DIM       5        410   Additional Diagnosis 45 (icd10)
DRG10D46  DIM       5        415   Additional Diagnosis 46 (icd10)
DRG10D47  DIM       5        420   Additional Diagnosis 47 (icd10)
DRG10D48  DIM       5        425   Additional Diagnosis 48 (icd10)
DRG10D49  DIM       5        430   Additional Diagnosis 49 (icd10)
.DRG10PPR DIM       7        435   Principle Procedure (icd10)
.DRG10P01 DIM       7        442   Additional Procedure 1 (icd10)
.DRG10P02 DIM       7        449   Additional Procedure 2 (icd10)
.DRG10P03 DIM       7        456   Additional Procedure 3 (icd10)
.DRG10P04 DIM       7        463   Additional Procedure 4 (icd10)
.DRG10P05 DIM       7        470   Additional Procedure 5 (icd10)
.DRG10P06 DIM       7        477   Additional Procedure 6 (icd10)
.DRG10P07 DIM       7        484   Additional Procedure 7 (icd10)
.DRG10P08 DIM       7        491   Additional Procedure 8 (icd10)
.DRG10P09 DIM       7        498   Additional Procedure 9 (icd10)
.DRG10P10 DIM       7        505   Additional Procedure 10 (icd10)
.DRG10P11 DIM       7        512   Additional Procedure 11 (icd10)
.DRG10P12 DIM       7        519   Additional Procedure 12 (icd10)
.DRG10P13 DIM       7        526   Additional Procedure 13 (icd10)
.DRG10P14 DIM       7        533   Additional Procedure 14 (icd10)
.DRG10P15 DIM       7        540   Additional Procedure 15 (icd10)
.DRG10P16 DIM       7        547   Additional Procedure 16 (icd10)
.DRG10P17 DIM       7        554   Additional Procedure 17 (icd10)
.DRG10P18 DIM       7        561   Additional Procedure 18 (icd10)
.DRG10P19 DIM       7        568   Additional Procedure 19 (icd10)
DRG10P20  DIM       7        575   Additional Procedure 20 (icd10)
DRG10P21  DIM       7        582   Additional Procedure 21 (icd10)
DRG10P22  DIM       7        589   Additional Procedure 22 (icd10)
DRG10P23  DIM       7        966   Additional Procedure 23 (icd10)
DRG10P24  DIM       7        603   Additional Procedure 24 (icd10)
DRG10P25  DIM       7        610   Additional Procedure 25 (icd10)
DRG10P26  DIM       7        617   Additional Procedure 26 (icd10)
DRG10P27  DIM       7        624   Additional Procedure 27 (icd10)
DRG10P28  DIM       7        631   Additional Procedure 28 (icd10)
DRG10P29  DIM       7        638   Additional Procedure 29 (icd10)
DRG10P30  DIM       7        645   Additional Procedure 30 (icd10)
DRG10P31  DIM       7        652   Additional Procedure 31 (icd10)
DRG10P32  DIM       7        659   Additional Procedure 32 (icd10)
DRG10P33  DIM       7        666   Additional Procedure 33 (icd10)
DRG10P34  DIM       7        673   Additional Procedure 34 (icd10)
DRG10P35  DIM       7        680   Additional Procedure 35 (icd10)
DRG10P36  DIM       7        687   Additional Procedure 36 (icd10)
DRG10P37  DIM       7        694   Additional Procedure 37 (icd10)
DRG10P38  DIM       7        701   Additional Procedure 38 (icd10)
DRG10P39  DIM       7        708   Additional Procedure 39 (icd10)
DRG10P40  DIM       7        715   Additional Procedure 40 (icd10)
DRG10P41  DIM       7        722   Additional Procedure 41 (icd10)
DRG10P42  DIM       7        729   Additional Procedure 42 (icd10)
DRG10P43  DIM       7        736   Additional Procedure 43 (icd10)
DRG10P44  DIM       7        743   Additional Procedure 44 (icd10)
DRG10P45  DIM       7        750   Additional Procedure 45 (icd10)
DRG10P46  DIM       7        757   Additional Procedure 46 (icd10)
DRG10P47  DIM       7        764   Additional Procedure 47 (icd10)
DRG10P48  DIM       7        771   Additional Procedure 48 (icd10)
DRG10P49  DIM       7        778   Additional Procedure 49 (icd10)
.DRGILOS  DIM       1        785   Sameday patient flag / Sameday Status
.XDRGPORC DIM       14       786   Princpal CMBS procedure code
.DRGPORDT DIM       8        800   Princpal CMBS procedure date (ddmmccyy)
.DRGPORTM DIM       4        808   Princpal CMBS Oper.Theatre time (minutes)
.XDRGSMB1 DIM       70       812   Secondary CMBS procedure codes
.XDRGSMB2 DIM       56       882   Secondary CMBS procedure codes
DRGACCFF  DIM       9        938   Accommodation fee (for wards)
DRGORFF   DIM       9        947   OR / Theatre fee
DRGLWFF   DIM       9        956   Labour ward fee
DRGICUFF  DIM       9        965   ICU / Intensive Care Unit fee
DRGPROFF  DIM       9        974   Prosthesis fee
DRGPHAFF  DIM       9        983   Pharmaceutical fee
DRGOTHFF  DIM       9        992   Other fees
DRGBUNFF  DIM       9       1001   Bundled/casemix fees
DRGMRNUM  DIM       20      1010   Medical Record Number - UR Number
DRGMSC01  DIM       11      1030   Miscellaneous Service Code 1
DRGMSC02  DIM       11      1041   Miscellaneous Service Code 2
DRGMSC03  DIM       11      1052   Miscellaneous Service Code 3
DRGMSC04  DIM       11      1063   Miscellaneous Service Code 4
DRGMSC05  DIM       11      1074   Miscellaneous Service Code 5
DRGMSC06  DIM       11      1085   Miscellaneous Service Code 6
DRGMSC07  DIM       11      1096   Miscellaneous Service Code 7
DRGMSC08  DIM       11      1107   Miscellaneous Service Code 8
DRGMSC09  DIM       11      1118   Miscellaneous Service Code 9
DRGMSC10  DIM       11      1129   Miscellaneous Service Code 10
DRGHIHFF  DIM       9       1140   Outreach (Hosp-in-home care) Charges (Fee)
DRGSCNFF  DIM       9       1149   Special Care Nusery Charges (Fee)
DRGCCUFF  DIM       9       1158   Coronary Care Unit Charges (Fee)
DRGSCNHR  DIM       4       1167   Special Care Nusery Hours
DRGCCUHR  DIM       4       1171   Coronary Care Unit Hours
DRGSCNLS  DIM       3       1175   Special Care Nusery Days (LOS)
DRGCCULS  DIM       3       1178   Coronary Care Unit Days (LOS)
DRGNBQDY  DIM       4       1181   Number of Qualified Days for Newborn
DRGHIHBD  DIM       8       1185   Outreach (Hosp-in-home care) Commence Date
DRGHIHED  DIM       8       1193   Outreach (Hosp-in-home care) Completed Date
DRGHIHVD  DIM       4       1201   No. Outreach (Hosp-in-home care) Visit Days
DRGPALDY  DIM       4       1205   Palliative Care Days
.
.End of Record              1209   HCP Extract
.
.********************************************
.
DRGADOCT  DIM       6       1209   Attending Doctor for HEC Extract
.
.End of Record              1215   HEC Extract
.********************************************
.
INPFILE6  FILE      ASCII, FIXED=1261 (After 01/07/2020)
.
.Header Record
.-------------
.Name     Type    Length    Start  Description
.-------  ----    ------    -----  -----------
.DRGHOSPN  DIM       8         1    Hospital provider number
.DRGFNDID  DIM       3         9    Fund / group identifier
.DRGDSKRN  DIM       8         12   Diskette reference number
.DRGDATPR  DIM       8         20   Date prepared (ddmmccyy)
.DRGNOREC  DIM       4         28   Number of records
.DRGTSTFG  DIM       1         32   Test flag
.DRGRESUB  DIM       1         33   Resubmitted disk
.DRGSTRT   DIM       8         34   Period start (ddmmccyy)
.DRGEND    DIM       8         42   Period end (ddmmccyy)
.DRGVERNO  DIM       4         50   HCP version no
.DRGICDVN  DIM       4         54   ICD version no
.
.End of Record                 58
.
.Episode Records
.---------------
.Name     Type    Length    Start  Description
.-------  ----    ------    -----  -----------
.DRGMEMBN DIM       15        1    Health fund membership no./repat no.
.DRGFUND  DIM       3         16   Fund identifer
.DRGADMN  DIM       15        19   Admission number / Episode Identifier
.DRGSNAME DIM       28        34   Patients surname / Family Name
.DRGGNAME DIM       20        62   Patients given name
.DRGBDAT  DIM       8         82   Birth date (ddmmccyy)
.DRGPCODE DIM       4         90   Patients postcode
.DRGSEX   DIM       1         94   Sex (1=Male, 2=Female,
.                                       3=Indeter, 4=Intersex, 9= Unknown)
.DRGADAT  DIM       8         95   Admission date (ddmmccyy)
.DRGDDAT  DIM       8        103   Discharge date (ddmmccyy)
.DRGHTYPE DIM       1        111   Hospital type
.DRGICULS DIM       3        112   ICU length of stay / ICU Days
.DRGHRS   DIM       4        115   ICU Hrs
XDRGPSYC  DIM       5        119   Total Psychiatric care days
.XDRGDRG  DIM       4        124   DRG code
.DRGVOGU  DIM       2        128   Version of grouper / DRG Version
.DRGATME  DIM       4        130   Admission time (hhmm)
.DRGASTAT DIM       1        134   Admission status/Urgency Status
.DRGTRNFR DIM       8        135   Provider number of hospital transfer from
.XDRGSCAT DIM       3        143   Care Type (Service category)
.DRGASRC  DIM       1        146   Source of referral
.DRGDSINT DIM       1        147   Discharge intention on admission
.DRGCTRST DIM       1        148   Contract status / Inter-Hosp Contract Patient
.DRGLEGST DIM       1        149   Mental health legal status
.DRGPALLV DIM       1        150   Palliative care status
.DRGREADM DIM       1        151   Readmission within 28 days             *Chng
.DRGTHEVS DIM       1        152   Unplanned theatre visit
.DRGAWHT  DIM       4        153   Infant Admission weight (< 365 days old)
.DRGHMV   DIM       4        157   Hours on mechanical ventilation
.DRGSEP   DIM       2        161   Separation mode
.DRGDTME  DIM       4        163   Discharge time (hhmm)
.DRGLDAYS DIM       4        167   Patients leave days
.DRGTRNTO DIM       8        171   Provider number of hospital transfer to
.DRGNALOS DIM       4        179   Non-certified days of stay             *Chng
.DRGHIHDY DIM       4        183   No.of Outreach (Hosp-in-the-home) days *Chng
XDRG10PD  DIM       6        187   Principle Diagnosis (icd10)
XDRG1D01  DIM       6        193   Additional Diagnosis 1 (icd10)
XDRG1D02  DIM       6        199   Additional Diagnosis 2 (icd10)
XDRG1D03  DIM       6        205   Additional Diagnosis 3 (icd10)
XDRG1D04  DIM       6        211   Additional Diagnosis 4 (icd10)
XDRG1D05  DIM       6        217   Additional Diagnosis 5 (icd10)
XDRG1D06  DIM       6        223   Additional Diagnosis 6 (icd10)
XDRG1D07  DIM       6        229   Additional Diagnosis 7 (icd10)
XDRG1D08  DIM       6        235   Additional Diagnosis 8 (icd10)
XDRG1D09  DIM       6        241   Additional Diagnosis 9 (icd10)
XDRG1D10  DIM       6        247   Additional Diagnosis 10 (icd10)
XDRG1D11  DIM       6        253   Additional Diagnosis 11 (icd10)
XDRG1D12  DIM       6        259   Additional Diagnosis 12 (icd10)
XDRG1D13  DIM       6        265   Additional Diagnosis 13 (icd10)
XDRG1D14  DIM       6        271   Additional Diagnosis 14 (icd10)
XDRG1D15  DIM       6        277   Additional Diagnosis 15 (icd10)
XDRG1D16  DIM       6        283   Additional Diagnosis 16 (icd10)
XDRG1D17  DIM       6        289   Additional Diagnosis 17 (icd10)
XDRG1D18  DIM       6        295   Additional Diagnosis 18 (icd10)
XDRG1D19  DIM       6        301   Additional Diagnosis 19 (icd10)
XDRG1D20  DIM       6        307   Additional Diagnosis 20 (icd10)
XDRG1D21  DIM       6        313   Additional Diagnosis 21 (icd10)
XDRG1D22  DIM       6        319   Additional Diagnosis 22 (icd10)
XDRG1D23  DIM       6        325   Additional Diagnosis 23 (icd10)
XDRG1D24  DIM       6        331   Additional Diagnosis 24 (icd10)
XDRG1D25  DIM       6        337   Additional Diagnosis 25 (icd10)
XDRG1D26  DIM       6        343   Additional Diagnosis 26 (icd10)
XDRG1D27  DIM       6        349   Additional Diagnosis 27 (icd10)
XDRG1D28  DIM       6        355   Additional Diagnosis 28 (icd10)
XDRG1D29  DIM       6        361   Additional Diagnosis 29 (icd10)
XDRG1D30  DIM       6        367   Additional Diagnosis 30 (icd10)
XDRG1D31  DIM       6        373   Additional Diagnosis 31 (icd10)
XDRG1D32  DIM       6        379   Additional Diagnosis 32 (icd10)
XDRG1D33  DIM       6        385   Additional Diagnosis 33 (icd10)
XDRG1D34  DIM       6        391   Additional Diagnosis 34 (icd10)
XDRG1D35  DIM       6        397   Additional Diagnosis 35 (icd10)
XDRG1D36  DIM       6        403   Additional Diagnosis 36 (icd10)
XDRG1D37  DIM       6        409   Additional Diagnosis 37 (icd10)
XDRG1D38  DIM       6        415   Additional Diagnosis 38 (icd10)
XDRG1D39  DIM       6        421   Additional Diagnosis 39 (icd10)
XDRG1D40  DIM       6        427   Additional Diagnosis 40 (icd10)
XDRG1D41  DIM       6        433   Additional Diagnosis 41 (icd10)
XDRG1D42  DIM       6        439   Additional Diagnosis 42 (icd10)
XDRG1D43  DIM       6        445   Additional Diagnosis 43 (icd10)
XDRG1D44  DIM       6        451   Additional Diagnosis 44 (icd10)
XDRG1D45  DIM       6        457   Additional Diagnosis 45 (icd10)
XDRG1D46  DIM       6        463   Additional Diagnosis 46 (icd10)
XDRG1D47  DIM       6        469   Additional Diagnosis 47 (icd10)
XDRG1D48  DIM       6        475   Additional Diagnosis 48 (icd10)
XDRG1D49  DIM       6        481   Additional Diagnosis 49 (icd10)
.DRG10PPR DIM       7        487   Principle Procedure (icd10)
.DRG10P01 DIM       7        494   Additional Procedure 1 (icd10)
.DRG10P02 DIM       7        501   Additional Procedure 2 (icd10)
.DRG10P03 DIM       7        508   Additional Procedure 3 (icd10)
.DRG10P04 DIM       7        515   Additional Procedure 4 (icd10)
.DRG10P05 DIM       7        522   Additional Procedure 5 (icd10)
.DRG10P06 DIM       7        529   Additional Procedure 6 (icd10)
.DRG10P07 DIM       7        536   Additional Procedure 7 (icd10)
.DRG10P08 DIM       7        543   Additional Procedure 8 (icd10)
.DRG10P09 DIM       7        550   Additional Procedure 9 (icd10)
.DRG10P10 DIM       7        557   Additional Procedure 10 (icd10)
.DRG10P11 DIM       7        564   Additional Procedure 11 (icd10)
.DRG10P12 DIM       7        571   Additional Procedure 12 (icd10)
.DRG10P13 DIM       7        578   Additional Procedure 13 (icd10)
.DRG10P14 DIM       7        585   Additional Procedure 14 (icd10)
.DRG10P15 DIM       7        592   Additional Procedure 15 (icd10)
.DRG10P16 DIM       7        599   Additional Procedure 16 (icd10)
.DRG10P17 DIM       7        606   Additional Procedure 17 (icd10)
.DRG10P18 DIM       7        613   Additional Procedure 18 (icd10)
.DRG10P19 DIM       7        620   Additional Procedure 19 (icd10)
.DRG10P20 DIM       7        627   Additional Procedure 20 (icd10)
.DRG10P21 DIM       7        634   Additional Procedure 21 (icd10)
.DRG10P22 DIM       7        641   Additional Procedure 22 (icd10)
.DRG10P23 DIM       7        648   Additional Procedure 23 (icd10)
.DRG10P24 DIM       7        655   Additional Procedure 24 (icd10)
.DRG10P25 DIM       7        662   Additional Procedure 25 (icd10)
.DRG10P26 DIM       7        669   Additional Procedure 26 (icd10)
.DRG10P27 DIM       7        676   Additional Procedure 27 (icd10)
.DRG10P28 DIM       7        683   Additional Procedure 28 (icd10)
.DRG10P29 DIM       7        690   Additional Procedure 29 (icd10)
.DRG10P30 DIM       7        697   Additional Procedure 30 (icd10)
.DRG10P31 DIM       7        704   Additional Procedure 31 (icd10)
.DRG10P32 DIM       7        711   Additional Procedure 32 (icd10)
.DRG10P33 DIM       7        718   Additional Procedure 33 (icd10)
.DRG10P34 DIM       7        725   Additional Procedure 34 (icd10)
.DRG10P35 DIM       7        732   Additional Procedure 35 (icd10)
.DRG10P36 DIM       7        739   Additional Procedure 36 (icd10)
.DRG10P37 DIM       7        746   Additional Procedure 37 (icd10)
.DRG10P38 DIM       7        753   Additional Procedure 38 (icd10)
.DRG10P39 DIM       7        760   Additional Procedure 39 (icd10)
.DRG10P40 DIM       7        767   Additional Procedure 40 (icd10)
.DRG10P41 DIM       7        774   Additional Procedure 41 (icd10)
.DRG10P42 DIM       7        781   Additional Procedure 42 (icd10)
.DRG10P43 DIM       7        788   Additional Procedure 43 (icd10)
.DRG10P44 DIM       7        795   Additional Procedure 44 (icd10)
.DRG10P45 DIM       7        802   Additional Procedure 45 (icd10)
.DRG10P46 DIM       7        809   Additional Procedure 46 (icd10)
.DRG10P47 DIM       7        816   Additional Procedure 47 (icd10)
.DRG10P48 DIM       7        823   Additional Procedure 48 (icd10)
.DRG10P49 DIM       7        830   Additional Procedure 49 (icd10)
.DRGILOS  DIM       1        837   Sameday patient flag / Sameday Status
.XDRGPORC DIM       14       838   Princpal CMBS procedure code
.DRGPORDT DIM       8        852   Princpal CMBS procedure date (ddmmccyy)
.DRGPORTM DIM       4        860   Princpal CMBS Oper.Theatre time (minutes)
.XDRGSMB1 DIM       70       864   Secondary CMBS procedure codes
.XDRGSMB2 DIM       56       934   Secondary CMBS procedure codes
.DRGACCFF DIM       9        990   Accommodation fee (for wards)
.DRGORFF  DIM       9        999   OR / Theatre fee
.DRGLWFF  DIM       9       1008   Labour ward fee
.DRGICUFF DIM       9       1017   ICU / Intensive Care Unit fee
.DRGPROFF DIM       9       1026   Prosthesis fee
.DRGPHAFF DIM       9       1035   Pharmaceutical fee
.DRGOTHFF DIM       9       1044   Other fees
.DRGBUNFF DIM       9       1053   Bundled/casemix fees
.DRGMRNUM DIM       20      1062   Medical Record Number - UR Number
.DRGMSC01 DIM       11      1082   Miscellaneous Service Code 1
.DRGMSC02 DIM       11      1093   Miscellaneous Service Code 2
.DRGMSC03 DIM       11      1104   Miscellaneous Service Code 3
.DRGMSC04 DIM       11      1115   Miscellaneous Service Code 4
.DRGMSC05 DIM       11      1126   Miscellaneous Service Code 5
.DRGMSC06 DIM       11      1137   Miscellaneous Service Code 6
.DRGMSC07 DIM       11      1148   Miscellaneous Service Code 7
.DRGMSC08 DIM       11      1159   Miscellaneous Service Code 8
.DRGMSC09 DIM       11      1170   Miscellaneous Service Code 9
.DRGMSC10 DIM       11      1181   Miscellaneous Service Code 10
.DRGHIHFF DIM       9       1192   Outreach (Hosp-in-home care) Charges (Fee)
.DRGSCNFF DIM       9       1201   Special Care Nusery Charges (Fee)
.DRGCCUFF DIM       9       1210   Coronary Care Unit Charges (Fee)
.DRGSCNHR DIM       4       1219   Special Care Nusery Hours
.DRGCCUHR DIM       4       1223   Coronary Care Unit Hours
.DRGSCNLS DIM       3       1227   Special Care Nusery Days (LOS)
.DRGCCULS DIM       3       1230   Coronary Care Unit Days (LOS)
XDRGNBQD  DIM       5       1233   Number of Qualified Days for Newborn *Change
.DRGHIHBD DIM       8       1238   Outreach (Hosp-in-home care) Commence Date
.DRGHIHED DIM       8       1246   Outreach (Hosp-in-home care) Completed Date
.DRGPALDY DIM       4       1254   Palliative Care Days
XARDRGVN  DIM       3       1258   AR DRG Version
.
.End of Record              1261   HCP Extract
.
.********************************************
.
.DRGADOCT DIM       6       1267   Attending Doctor for HEC Extract
.
.End of Record              1267   HEC Extract
.********************************************   end of addition       *I-105249
.
TEMP1     IFILE     SQL,FIXED=18, KEY="U1-6,7-9,10-17"
FILELIN1  INIT      " 18 U1-6,7-9,10-17"
.
.Name     Type      Length   Physical   Start   Description
.----     ----      ------   --------   -----   -----------
HCPCODE   DIM       6        6          1       Health fund group code
CLMTYPE   DIM       3        3          7       Claim type
DADMISS   DIM       8        8          10      Admission no
.
.End of Record                          18
.
TEMP2     IFILE     SQL,FIXED=14, KEY="U1-6,7-9"
FILELIN2  INIT      " 14 U1-6,7-9"
.
.Name     Type      Length   Physical   Start   Description
.----     ----      ------   --------   -----   -----------
.HCPCODE  DIM       6        6          1       Health fund group code
.CLMTYPE  DIM       3        3          7       Claim type
CLMCNT    FORM      5        4          10      Claim type counter
.
.End of Record                          14
.
. ---------------------------- AN-SNAP Extract File --------------------- 274409
.
ANSPFILE  FILE      ASCII, FIXED=178
.Name     Type    Length    Start  Description
.-------  ----    ------    -----  -----------
.DRGHOSPN  DIM       8         1    Hospital provider number
.DRGFNDID  DIM       3         9    Fund / group identifier
.DRGDSKRN  DIM       8         12   Diskette reference number
.DRGDATPR  DIM       8         20   Date prepared (ddmmccyy)
DRGNOSNP  DIM       4         28   Number of records
.DRGTSTFG  DIM       1         32   Test flag
.DRGRESUB  DIM       1         33   Resubmitted disk
.DRGSTRT   DIM       8         34   Period start (ddmmccyy)
.DRGEND    DIM       8         42   Period end (ddmmccyy)
.DRGVERNO  DIM       4         50   ANSNAP version no
.BLANK     DIM       4         54   Blan
.FILETYPE  DIM       1         58   S
.
.End of Record                 59
.
.
. HCP/PHDB AN-SNAP Extract File
. ------------------------------------------------------------------------------
ANPMEMBN  DIM     15        1     Health fund membership no./repat no.
ANPFUND   DIM     3         16    Fund identifer
ANPANID   DIM     15        19    URNO Counter (MRN No -Record No)
ANPSNAME  DIM     28        34    Patients surname
ANPGNAME  DIM     20        62    Patients given name
ANPBDAT   DIM     8         82    Birth date (ddmmccyy)
ANPPCODE  DIM     4         90    Patients postcode
ANPSEX    DIM     1         94    Sex (1=Male, 2=Female,3=Indeter, 9= Unknown)
ANPXSDAT  DIM     8         95    Admission date (ddmmccyy)
ANPXENDD  DIM     8         103   Separation date (ddmmccyy)
ANPXEPTY  DIM     1         111   Episode type (o=overnight)
ANPAEATS  DIM     1         112   Admission FIM Eating Score
ANPAGRMS  DIM     1         113   Admission FIM Grooming Score
ANPABTHS  DIM     1         114   Admission FIM Bathing Score
ANPAUPBS  DIM     1         115   Admission FIM Dressing Upper Body Score
ANPALWBS  DIM     1         116   Admission FIM Dressing Lower Body Score
ANPATLTS  DIM     1         117   Admission FIM Toileting Score
ANPABLMS  DIM     1         118   Admission FIM Bladder Management Score
ANPABWMS  DIM     1         119   Admission FIM Bowel Management Score
ANPATBDS  DIM     1         120   Admission FIM Xfers - Bed/Chr/WChr Score
ANPATTLS  DIM     1         121   Admission FIM Xfers - Toilet Score
ANPATBTS  DIM     1         122   Admission FIM Xfers - Bath/Shower Score
ANPALOCS  DIM     1         123   Admission FIM Locomotion Score
ANPASTRS  DIM     1         124   Admission FIM Stairs Score
ANPACOMS  DIM     1         125   Admission FIM Comprehension Score
ANPAEXPS  DIM     1         126   Admission FIM Expression Score
ANPASCIS  DIM     1         127   Admission FIM Social Interaction Score
ANPAPRBS  DIM     1         128   Admission FIM Problem Solving Score
ANPAMEMS  DIM     1         129   Admission FIM Memory Score
ANPDEATS  DIM     1         130   Discharge FIM Eating Score
ANPDGRMS  DIM     1         131   Discharge FIM Grooming Score
ANPDBTHS  DIM     1         132   Discharge FIM Bathing Score
ANPDUPBS  DIM     1         133   Discharge FIM Dressing Upper Body Score
ANPDLWBS  DIM     1         134   Discharge FIM Dressing Lower Body Score
ANPDTLTS  DIM     1         135   Discharge FIM Toileting Score
ANPDBLMS  DIM     1         136   Discharge FIM Bladder Management Score
ANPDBWMS  DIM     1         137   Discharge FIM Bowel Management Score
ANPDTBDS  DIM     1         138   Discharge FIM Xfers - Bed/Chr/WChr Score
ANPDTTLS  DIM     1         139   Discharge FIM Xfers - Toilet Score
ANPDTBTS  DIM     1         140   Discharge FIM Xfers - Bath/Shower Score
ANPDLOCS  DIM     1         141   Discharge FIM Locomotion Score
ANPDSTRS  DIM     1         142   Discharge FIM Stairs Score
ANPDCOMS  DIM     1         143   Discharge FIM Comprehension Score
ANPDEXPS  DIM     1         144   Discharge FIM Expression Score
ANPDSCIS  DIM     1         145   Discharge FIM Social Interaction Score
ANPDPRBS  DIM     1         146   Discharge FIM Problem Solving Score
ANPDMEMS  DIM     1         147   Discharge FIM Memory Score
ANPXICDE  DIM     7         148   Impairment Code
ANPXASSO  DIM     1         155   Assessment Only
ANPXVRCL  DIM     4         156   AN-SNAP Version/Classification
ANPXVERS  DIM     2         160   AN-SNAP Version AGAIN?!?! (incl Leading 0)
ANPXRPDT  DIM     8         162   Rehabilitation Plan Date (ddmmccyy)
ANPXRDDT  DIM     8         170   Discharge Plan Date (ddmmccyy)

. End of Record             178

ANSPFIL1  FILE      ASCII, FIXED=163    * after 01/07/2020
.Name     Type    Length    Start  Description
.-------  ----    ------    -----  -----------
. HCP/PHDB AN-SNAP Extract File
. ------------------------------------------------------------------------------
.ANPMEMBN  DIM     15        1     Health fund membership no./repat no.
.ANPFUND   DIM     3         16    Fund identifer
.ANPANID   DIM     15        19    URNO Counter (MRN No -Record No)
.ANPSNAME  DIM     28        34    Patients surname
.ANPGNAME  DIM     20        62    Patients given name
.ANPBDAT   DIM     8         82    Birth date (ddmmccyy)
.ANPPCODE  DIM     4         90    Patients postcode
.ANPSEX    DIM     1         94    Sex (1=Male, 2=Female,3=Indeter, 9= Unknown)
.ANPXSDAT  DIM     8         95    Admission date (ddmmccyy)
.ANPXENDD  DIM     8         103   Separation date (ddmmccyy)
.ANPXEPTY  DIM     1         111   Episode type (o=overnight)
.ANPAEATS  DIM     1         112   Admission FIM Eating Score
.ANPAGRMS  DIM     1         113   Admission FIM Grooming Score
.ANPABTHS  DIM     1         114   Admission FIM Bathing Score
.ANPAUPBS  DIM     1         115   Admission FIM Dressing Upper Body Score
.ANPALWBS  DIM     1         116   Admission FIM Dressing Lower Body Score
.ANPATLTS  DIM     1         117   Admission FIM Toileting Score
.ANPABLMS  DIM     1         118   Admission FIM Bladder Management Score
.ANPABWMS  DIM     1         119   Admission FIM Bowel Management Score
.ANPATBDS  DIM     1         120   Admission FIM Xfers - Bed/Chr/WChr Score
.ANPATTLS  DIM     1         121   Admission FIM Xfers - Toilet Score
.ANPATBTS  DIM     1         122   Admission FIM Xfers - Bath/Shower Score
.ANPALOCS  DIM     1         123   Admission FIM Locomotion Score
.ANPASTRS  DIM     1         124   Admission FIM Stairs Score
.ANPACOMS  DIM     1         125   Admission FIM Comprehension Score
.ANPAEXPS  DIM     1         126   Admission FIM Expression Score
.ANPASCIS  DIM     1         127   Admission FIM Social Interaction Score
.ANPAPRBS  DIM     1         128   Admission FIM Problem Solving Score
.ANPAMEMS  DIM     1         129   Admission FIM Memory Score
.ANPDEATS  DIM     1         130   Discharge FIM Eating Score
.ANPDGRMS  DIM     1         131   Discharge FIM Grooming Score
.ANPDBTHS  DIM     1         132   Discharge FIM Bathing Score
.ANPDUPBS  DIM     1         133   Discharge FIM Dressing Upper Body Score
.ANPDLWBS  DIM     1         134   Discharge FIM Dressing Lower Body Score
.ANPDTLTS  DIM     1         135   Discharge FIM Toileting Score
.ANPDBLMS  DIM     1         136   Discharge FIM Bladder Management Score
.ANPDBWMS  DIM     1         137   Discharge FIM Bowel Management Score
.ANPDTBDS  DIM     1         138   Discharge FIM Xfers - Bed/Chr/WChr Score
.ANPDTTLS  DIM     1         139   Discharge FIM Xfers - Toilet Score
.ANPDTBTS  DIM     1         140   Discharge FIM Xfers - Bath/Shower Score
.ANPDLOCS  DIM     1         141   Discharge FIM Locomotion Score
.ANPDSTRS  DIM     1         142   Discharge FIM Stairs Score
.ANPDCOMS  DIM     1         143   Discharge FIM Comprehension Score
.ANPDEXPS  DIM     1         144   Discharge FIM Expression Score
.ANPDSCIS  DIM     1         145   Discharge FIM Social Interaction Score
.ANPDPRBS  DIM     1         146   Discharge FIM Problem Solving Score
.ANPDMEMS  DIM     1         147   Discharge FIM Memory Score
.ANPXICDE  DIM     7         148   Impairment Code
.ANPXVRCL  DIM     4         155   AN-SNAP Version/Classification
.ANPXVERS  DIM     2         159   AN-SNAP Version AGAIN?!?! (incl Leading 0)
ANPMEIPS  DIM     1         161   Mode of Episode Start - Inpatient
ANPMEIPE  DIM     1         162   Mode of Episode End - Inpatient
.
.End of Record              163

.
. ---------------------------------------------------------------------- C274409
.         temporary file  - URNO Count - Counts number of AN-SNAP extract per
.         URNO.  Why? Good question. Ask the people requiring the file.
.
WORK1     IFILE     SQL, FIXED=13, KEY="U1-8"
.
.Name     Type     Size    Physical   Start       Description
.----     ----     ----    --------   -----       -----------
XXXXURNO  DIM       8         8         1         Patient U/R Number
XXXXCNTR  FORM      6         4         9         Record Number
.
.End of record                         13
.
. ----- Program Variables -----
.
T3HRTIME  FORM     4
T4HRTIME  FORM     4
STAYTIME  FORM     4
NBRDAYS   FORM      4                       * No of days in hospital
DAYMIN    FORM      "1440"
NUMHOUR   FORM     2
NUMMIN    FORM     2
ADDNFEES  FORM     12.2
ADMISS    FORM      8                       * Admission no
ADMTYPE   DIM       3                       * Admission type code
.                                                                        C274409
ANSPNAME  DIM       12                      * AN-SNAP Extract File Name
ANSPRECS  FORM      1                       * AN-SNAP Extract exists
.                                             1=yes 0=no
.
BEDTYPE   DIM       3                       * Bed type code
BJDAY     FORM      3                       * For CALCAGE
.
CRDNAMNT  FORM     10.2
CALDAYS   FORM      4                       * For NHOSPDAY
CDYSDAYS  FORM      6                       * For CALCDAYS
CDYSFDTE  DIM       8                       * For CALCDAYS
CDYSTDTE  DIM       8                       * For CALCDAYS
CDYSYEAR  FORM      2                       * For CALCDAYS
CHRCOUNT  FORM      2                       * Character counter
CJDAY     FORM      3                       * For CALCAGE
CLMCODE   DIM       3                       * Claim code
CLMDESC   DIM       20                      * Claim code description
CMDLINE   DIM       100
CMPCNT    FORM      1
COD1CNT   FORM      2
COD9CNT   FORM      2
CODE      DIM       2
COUNTER   FORM      2
CRDFLAG   FORM      1
CURRDATE  DIM       8                       * Current date (ccyymmdd)
.
DDRGCODE  DIM       4
DIM4      DIM       4
DIM5      DIM       5
DIM8      DIM       8
DIM10     DIM       10
DIM12     DIM       12
DIM20     DIM       20
DIM24     DIM       24
DIM40     DIM       40
DIM50     DIM       50
DIM100    DIM       100
DMDCCODE  DIM       4
DRGVER    DIM       3
.
ENDDTE8   DIM       8                       * End date (ccyymmdd)
ENDTME5   DIM       5                       * End time (hh:mm)
ERRMSG    DIM       120                     * Error message line
ERRORCNT  FORM      5                       * Error counter
WARNGCNT  FORM      5                       * Warning counter
WRNFLAG   FORM      1                       
EXTRDCNT  FORM      5                       * Extracted record counter
EXTRSNAP  FORM      5                       * Extracted SNAP record counter
.
FROMDATE  DIM       8                       * From date for NHOSPDAY
FNAMEA    DIM       8                       * Tempfile name
FNAMEB    DIM       8                       * Tempfile name
FNAME1    DIM       8                       * Temp URNO/CNTR file name   C274409
FORM2A    FORM      2
FORM3     FORM      3
FORM5     FORM      5
FORM6     FORM      6
FORM8     FORM      8
FORM9     FORM      9
FORM102   FORM      10.2
FORM122   FORM      12.2
.
GRPCODE   DIM       6                       * Health fund group code
GRPCNT    FORM      5                       * Health fund group counter
GRPDESC   DIM       34                      * Health fund group description
.
HADHIH    FORM      1                       
HADICU    FORM      1
HADCCU    FORM      1
HADSCN    FORM      1
HCPFNAME  DIM       9                       * HCP filename
.
ICD9ODAT  DIM       8                       * Prim ICD9 operation date ddmmccyy
ICD9OTIM  FORM      4                       * Primary ICD9 operation time
ICDPTNMD  DIM       1                       * ICD Procedure Time non-mandatory?
.                                             (1=non-mandatory)
INPFNAME  DIM       24
.
JUSTNO    FORM      2                       * Right justification amount
KEY21A    DIM       21 
KEY26A    DIM       26 
LJUSCODE  DIM       80                      * Left justified code
MTIFLAG   FORM      1
MAPFILE   FORM      1                       * Mapping file flag
MSCNUMB   FORM      3                                                 *I-105249
MSG1      DIM       60
MSG2      DIM       60
MSG01     DIM       40
MSG02     DIM       40
MSG03     DIM       40
.
DOYR2025  FORM      1
.DOYR2024  FORM      1
NOOFHOSP  FORM      2
COUNT     FORM      2
.
HSAPPRAR  DIM       10[99]
HSHOSPAR  DIM       3[99]
HSNAMEAR  DIM       50[99]
PSAGECON  DIM       3
PSAGETYP  DIM       1
PSYCFLAG  FORM      1
.
RJUSCODE  DIM       80                      * Right justified code
.
SAVCODE   DIM       6                       * Save the health fund group
SAVKEY10  DIM       10
SAVTYPE   DIM       3                       * Save the claim type
SAVFDATE  DIM       8
SNAPRECS  FORM      1
STRTDTE8  DIM       8                       * Start date (ccyymmdd)
STRTTME5  DIM       5                       * Start time (hh:mm)
STRLTYP   DIM       3
.
TODATE    DIM       8                       * To date for NHOSPDAY
TIME4     FORM      4                       * Calculation time
TOTRDCNT  FORM      5                       * Total record counter
TYPOFFEE  DIM       15                      * Type of fee
.
VALSEPMD  DIM       2                       * 2 digit from user defined field 3
VMDILIST  DIM       5
.
WDATE1    DIM       8                       * For NHOSPDAY
WDATE2    DIM       8                       * For NHOSPDAY
WORKACC   FORM      10.2                    * Accommodation fee
WORKPLOS  FORM      4                       * Palliative length of stay counter
WORKALOS  FORM      4                       * Acute length of stay counter
WORKBUND  FORM      10.2                    * Bundled/casemix fee
WORKICU   FORM      10.2                    * ICU fee
WORKCCU   FORM      10.2                    * CCU fee                 *I-105249
WORKSCN   FORM      10.2                    * SCN fee                 *I-105249
WORKHIH   FORM      10.2                    * Outreach (HIH) Fee      *I-105249
WORKICLS  FORM      3                       * ICU days counter
WORKCCLS  FORM      3                       * CCU days counter        *I-105249
WORKSCLS  FORM      3                       * SCN days counter        *I-105249
WORKBABY  FORM      5                       * SCN days counter        *I-105249
WORKHIHV  FORM      4                       * Outreach (HIH) Vis days *I-105249
WORKPSYC  FORM      5                       * Psychiatric
WORKHDAY  FORM      2                       * Home (HIH) days
WORKHHDY  FORM      4                       * Home (HIH) days *New    *I-115867
WORKLDAY  FORM      4                       * Leave days
WORKLW    FORM      10.2                    * Labour ward fee
WORKNLOS  FORM      4                       * Non acute length of stay counter
WORKOR    FORM      10.2                    * Theatre fee
WORKOTHR  FORM      10.2                    * Other fee
WORKPHRM  FORM      10.2                    * Pharmaceutical fee
WORKPROS  FORM      10.2                    * Prosthesis fee
WORKTOTL  FORM      10.2                    * Total fee
WORKDATE  DIM       8                                                 *I-105249
PRVDTRDT  DIM       8                                                 *I-105249
.
EXTRTYPE  FORM      1                       * Extract Type: 1=HCP, 2=HEC
.
CFPAYCOD  DIM       3        * 3M Codefinder PAY Code
.
. ----- Program Constants -----
.
CATCC     INIT      "CC"
CATCP     INIT      "CP"
CATCL     INIT      "CL"
CATD      INIT      "D "
CATDD     INIT      "DD"
CATDE     INIT      "DE"
CATDV     INIT      "DV"
CATIH     INIT      "IH"
CATIN     INIT      "IN"
CATKN     INIT      "KN"
CATOT     INIT      "OT"
CATSE     INIT      "SE"
CATSI     INIT      "SI"
CATTP     INIT      "TP"
CATWC     INIT      "WC"
CODELS    INIT      "LS"
CATU1     INIT      "U1"
CATU2     INIT      "U2"
CATU3     INIT      "U3"
CATU4     INIT      "U4"
CATU5     INIT      "U5"
CATVI     INIT      "VI"
.
ERRMSG01  INIT      "Missing admission record"
ERRMSG02  INIT      "Missing master file record"
ERRMSG03  INIT      "Missing visit file record"
ERRMSG04  INIT      "DVA patient missing Repat number"
ERRMSG05  INIT      "No health fund membership number"
ERRMSG06  INIT      "Invalid separation mode for code"
ERRMSG07  INIT      "No primary disease code found"
ERRMSG08  INIT      "No operation date found for 1st Primary MBS code"
ERRMSG09  INIT      "No operation times found for 1st Primary MBS code"
ERRMSG10  INIT      "fee is negative"
ERRMSG11  INIT      "Urgency status must be blank,1,2 or 3"
ERRMSG12  INIT      "Invalid source of referral"
ERRMSG13  INIT      "Palliative Care Status must be blank, 1 or 2"
ERRMSG14  INIT      "Unplanned theatre visit must be blank,1 or 2"
ERRMSG15  INIT      "Marital Status must be blank or 1 to 6"
ERRMSG16  INIT      "Invalid Discharge intention on admission"
ERRMSG17  INIT      "Hospital Provider No missing for Transfer Source Code"
.                   "....*....1....*....2....*....3....*....4....*....5"
.
FNMHDR1   INIT      "tmpur1"                                           * C274409
HYPHEN    INIT      "-"                                                * C274409
ONEINIT   INIT      "1"                                                * C274409
.
SP100     INIT      "                                                  ":
                    "                                                  "
.
ZED30     INIT      "zzzzzzzzzzzzzzzzzzzzzzzzzzzzzz"
ZERO3     INIT      "000"
ZERO8     INIT      "0000    "
.
.******************************************************************************
PRGID     INIT      "IBAINP91"
PRGNAM    INIT      "Extract Data For HCP / HEC"
VERSION   INIT      "V12.01.00"
.******************************************************************************
PRGNAM1   DIM       30
PRGNAM2   DIM       30
PRGNAM3   DIM       30
.
PRGNAMC   INIT      "Extract Data For "
STRHCHE   INIT      "HCP / HEC"
.
STRHCP1   INIT      "HCP"
STRHCP2   INIT      "PHDB"
STRHCP3   INIT      "NT"
.
STRHEC1   INIT      "HEC"
STRHEC2   INIT      "PHEC"
STRHEC3   INIT      "HECNT"
.
+
.******************************************************************************
.*                                   ML0000                                   *
.*                                Mainline Code                               *
.******************************************************************************
ML0000    CALL      INIT0000                * Initialise variables & open files
ML0100    CALL      SELE0000                * Select Extract type (HCP / HEC)
          BRANCH    OPTION,ML0500,ML0500
          GOTO      ML9999
.
ML0500    CALL      OPTN0000                * Choose main option
          BRANCH    OPTION,ML1000,ML2000,ML3000,ML4000,ML1000:
                           ML1000,ML1000
          GOTO      ML0100
.
. ----- Option 1 - all patients -----
.
ML1000    CALL      KHOS0000                * keyin Hospital ID    
          BRANCH    EXIT,ML0500
.
          CALL      KDAT0000                * Get the date ranges
          BRANCH    EXIT,ML1000
.
ML1100    IF        OPTION=5
            CALL      PFIL0000
          ELSE
            CALL      FILE0000            * Get extract file name
          ENDIF
          BRANCH    EXIT,ML1000
.
          CALL      RSUB0000                * Keyin ReSubmitt period
          BRANCH    EXIT,ML1100
.
          CALL      CONTQST                 * Ok to Continue (Y/N/C) ?
          BRANCH    CEXIT,ML5000,ML1100,ML0500
.                         Yes    No     Cancel
          GOTO      ML0500
.
. ----- Option 2 - by health fund group -----
.
ML2000    CALL      KHOS0000                * keyin Hospital ID    
          BRANCH    EXIT,ML0500
.
          CALL      KHGP0000                * Get health fund group
          BRANCH    EXIT,ML2000,ML0500
.
ML2100    CALL      KDAT0000                * Get the date ranges
          BRANCH    EXIT,ML2000
.
ML2200    CALL      FILE0000                * Get extract file name
          BRANCH    EXIT,ML2100
.
          CALL      RSUB0000                * Keyin ReSubmitt period
          BRANCH    EXIT,ML2200
.
          CALL      CONTQST                 * Ok to Continue (Y/N/C) ?
          BRANCH    CEXIT,ML5000,ML2200,ML0500
.                         Yes    No     Cancel
          GOTO      ML0500
.
. ----- Option 3 - by claim code / health fund group -----
.
ML3000    CALL      KHOS0000                * keyin Hospital ID    
          BRANCH    EXIT,ML0500
.
          CALL      KCLM0000                * Get claim code
          BRANCH    EXIT,ML3000,ML0500
.
ML3100    CALL      KHGP0000                * Get health fund group
          BRANCH    EXIT,ML3000,ML0500
.
ML3200    CALL      KDAT0000                * Get the date ranges
          BRANCH    EXIT,ML3100
.
ML3300    CALL      FILE0000                * Get extract file name
          BRANCH    EXIT,ML3200
.
          CALL      RSUB0000                * Keyin ReSubmitt period
          BRANCH    EXIT,ML3300
.
          CALL      CONTQST                 * Ok to Continue (Y/N/C) ?
          BRANCH    CEXIT,ML5000,ML3300,ML0500
.                         Yes    No     Cancel
          GOTO      ML0500
.
. ----- Option 4 - patients to be extracted -----
.
ML4000    CALL      COPT0000                * Sub option
          BRANCH    EXIT,ML0500
          BRANCH    COPTION,ML4100,ML4300
.
ML4050    CALL      KHOS0000                * keyin Hospital ID    
          BRANCH    EXIT,ML4000
.
ML4100    CALL      KHGP0000                * Get health fund group
          BRANCH    EXIT,ML4050
.
ML4200    CALL      KDAT0000                * Get the date ranges
          BRANCH    EXIT,ML4100
.
          CALL      RSUB0000                * Keyin ReSubmitt period
          BRANCH    EXIT,ML4200
.
          CALL      CONTQST                 * Ok to Continue (Y/N/C) ?
          BRANCH    CEXIT,ML5000,ML4200,ML0500
          GOTO      ML0500
.
ML4300    CALL      KHOS0000                * keyin Hospital ID    
          BRANCH    EXIT,ML4000
.
          CALL      KDAT0000                * Get the date ranges
          BRANCH    EXIT,ML4000
.
          CALL      RSUB0000                * Keyin ReSubmitt period
          BRANCH    EXIT,ML4300
.
          CALL      CONTQST                 * Ok to Continue (Y/N/C) ?
          BRANCH    CEXIT,ML5000,ML4300,ML0500
.                         Yes    No     Cancel
          GOTO      ML0500
.
ML5000    CALL      EXTD0000                * Extract the data
.
          COMPARE   FOUR,OPTION
          GOTO      ML0500 IF EQUAL
.
          CALL      MVEXT000                * Move files to extract directory
.
          GOTO      ML0500
.
ML9999    CALL      KILL0000
          CHAIN     PGM
+
.******************************************************************************
.*                                  INIT0000              Called by: ML0000   *
.*                               Initialisation                               *
.******************************************************************************
INIT0000  CALL      DISPHEAD                * Display screen header
          DISPLAY   *P56:24,"Opening patcodes"
          OPEN      PATCODE1,"patcodes"
.
          DISPLAY   *P64:24,"patchcof"
          OPEN      PATCHCO1,"patchcof"
.
          DISPLAY   *P64:24,"patdo1af"
          OPEN      PATDO1A1,"patdo1af"
.
          DISPLAY   *P64:24,"patdschf"
          OPEN      PATDSCH2,"patdschf"
.
          DISPLAY   *P64:24,"patdtraf"
          OPEN      PATDTRA1,"patdtraf"
          OPEN      PATDTRA3,"patdtraf"
.
          DISPLAY   *P64:24,"patfimaf";
          OPEN      PATFIMA1,"patfimaf"
.
          DISPLAY   *P64:24,"patfn1af"
          OPEN      PATFN1A1,"patfn1af"
.
          DISPLAY   *P64:24,"pathgrpf"
          OPEN      PATHGRP1,"pathgrpf"
.
          DISPLAY   *P64:24,"paticuaf"
          OPEN      PATICUA1,"paticuaf"
.
          DISPLAY   *P64:24,"patdadaf"
          OPEN      PATDADA1,"patdadaf"
.
          DISPLAY   *P64:24,"patvadaf"
          OPEN      PATVADA1,"patvadaf"
.
          DISPLAY   *P64:24,"patecdaf"
          OPEN      PATECDA2,"patecdaf"
.
          DISPLAY   *P64:24,"patecoaf"
          OPEN      PATECOA2,"patecoaf"
.
          DISPLAY   *P64:24,"patitemn"
          OPEN      PATITEM1,"patitemn"
.
          DISPLAY   *P64:24,"patma1af"
          OPEN      PATMA1A1,"patma1af"
.
          DISPLAY   *P64:24,"patmx1af"
          OPEN      PATMX1A1,"patmx1af"
.
          DISPLAY   *P64:24,"patmchgf"
          OPEN      PATMCHG1,"patmchgf"
.
          DISPLAY   *P64:24,"patmi1af"
          OPEN      PATMI1A1,"patmi1af"
.
          DISPLAY   *P64:24,"patmmbsf"
          OPEN      PATMMBS1,"patmmbsf"
.
          DISPLAY   *P64:24,"patmmbsf"
          OPEN      PATMMBS2,"patmmbsf"
.
          DISPLAY   *P64:24,"pattranf"
          OPEN      PATTRAN2,"pattranf"
.
          DISPLAY   *P64:24,"patvisaf"
          OPEN      PATVISA1,"patvisaf"
.
          DISPLAY   *P64:24,"patinvrf"
          OPEN      PATINVR1,"patinvrf"
.
          DISPLAY   *P64:24,"pmsfciaf"
          OPEN      PMSFCIA1,"pmsfciaf"
.
          DISPLAY   *P64:24,"pmscnoaf"
          OPEN      PMSCNOA3,"pmscnoaf"
.
          DISPLAY   *P64:24,"pmsmtiaf"
          OPEN      PMSMTIA1,"pmsmtiaf"
.
          DISPLAY   *P64:24,"paticddf"
          CALL      OPICD1
.
          DISPLAY   *P64:24,"paticdof"
          CALL      OPICO1
.
          DISPLAY   *P64:24,"pmsapgaf";
          OPEN      PMSAPGA1,"pmsapgaf"
.
          DISPLAY   *P64:24,"pmsupgaf";
          OPEN      PMSUPGA1,"pmsupgaf"
.
          DISPLAY   *P64:24,"pmsvx1af"
          OPEN      PMSVX1A1,"pmsvx1af"
.
          DISPLAY   *P64:24,"patcfaaf"
          OPEN      PATCFAA1,"patcfaaf"          * CAR 263828
.
          DISPLAY   *P64:24,"patwc1af"
          OPEN      PATWC1A1,"patwc1af"          * CAR 263828
.
          DISPLAY   *P64:24,"patwmabf"
          OPEN      PATWMAB1,"patwmabf"          * CAR 263828
.
          DISPLAY   *P64:24,"pmsccdaf";
          OPEN      PMSCCDA1,"pmsccdaf"
.
          CALL      TFILENAM                     * Generate temporary file name
          MOVE      TFILNAME,FNAMEA
.
          CALL      TFILENAM                     * Generate temporary file name
          MOVE      TFILNAME,FNAMEB
.
          DISPLAY   *P64:24,"controlf"
          OPEN      CONTROLF,"controlf"
.
          MOVE      ZERO,COUNTER
          READ      CONTROLF,ZERO;*43,IBCNMHOS
          READ      CONTROLF,TEN;*79,CAPPRVNO,*235,CMDISP,CMDISS,CMDISC,CMDISA
          READ      CONTROLF,TEN3;*245,CHOSTYP
          READ      CONTROLF,TWENTY;*193,PTCNDCLM
          READ      CONTROLF,TWENTY1;*45,PTCNDRSM,*46,PTCNBAGE,*216,PTCNDTRF
          READ      CONTROLF,SIXTY9;*69,MHCNUSE                         *I-53371
          READ      CONTROLF,SEVENTY7;*216,PTCNPALC,*220,PTCNEDRG       *C-53371
          READ      CONTROLF,SEVENTY9;*82,PTCNDSCI:
                                      *94,PTCNADTT,PTCNDSTT
          READ      CONTROLF,EIGHTY;*250,PTCNHDPS
          READ      CONTROLF,EIGHTY8;*59,PTCNI10D
          READ      CONTROLF,EIGHTY8;*241,PTCNCSTA
          READ      CONTROLF,HUND03;*43,PTCNDFIN
          READ      CONTROLF,HUND05;*217,PTCNGDV4,*227,PTCNGDV5       *C-105244
          READ      CONTROLF,HUND12;*239,PTCNGDV6                     *I-163918
          READ      CONTROLF,HUND10;*61,PTCNGDV7,*69,PTCNGDV8:        *I-284420
                                    *77,PTCNGDV9,*85,PTCNGDVX:        *I-0833093
                                    *228,PTCNHCCC
          READ      CONTROLF,HUND17;*220,PTCNGDX1
          READ      CONTROLF,HUND28;*231,PTCNGDX2                     *I-0917793
          READ      CONTROLF,HUND30;*86,PTCNGDX3                      *I-0956210
.
.         IF        MHCNUSE=1
            DISPLAY   *P64:24,"mehlegaf";                               *I-53371
            OPEN      MEHLEGA1,"mehlegaf"
            DISPLAY   *P64:24,"mehdlsaf";                               *I-53371
            OPEN      MEHDLSA1,"mehdlsaf"
.         ENDIF
.
          PACK      VMDILIST,CMDISP,CMDISS,CMDISC,CMDISA,ANSA
          MOVE      ZERO,OVRCD
          TRAP      OVERCOND IF IO
          OPEN      PAT3MIA1,"pat3miaf"
          TRAPCLR   IO
          IF        OVRCD=1
            MOVE      ZERO,MAPFILE          * 3M mapping file does not exist
          ELSE
            MOVE      ONE,MAPFILE           * 3M mapping file does exist
          ENDIF
.
          PACK      CURRDATE,CCC,CYY,CMM,CDD
          REP       " 0",CURRDATE
          CLOCK     TIME,CTIMEIS
.
          MOVE      ZERO,ANSPRECS                                      * C274409
INIT9000  MOVE      ZERO,EXIT
INIT9999  RETURN
+
.******************************************************************************
.*                                  SELE0000              Called by: ML0000   *
.*                  Choose Extract Type (HCP / HEC)                           *
.******************************************************************************
SELE0000  MOVE      ZERO,OPTION
          MOVE      ONE,EXTRTYPE        * default to HCP Extract
          PACK      PRGNAM,PRGNAMC,STRHCHE,SP70
          CALL      DISPHEAD   
          DISPLAY   *P1:3,*EF:
                    *P1:4,*V2LON,"0",*HOFF," = Exit":
                    *P1:5,*V2LON,"1",*HOFF:
                    " = HCP Extract":
                    *P1:6,*V2LON,"2",*HOFF:
                    " = HEC Extract"
.
          DISPLAY   *P1:8,"Select Extract type : ";
          MOVE      "8",CVERT
.
SELE1000  KEYIN     *P23:8,*DV,UNDLN2,*P23:8,*V2LON,OPTION;
.
          COMPARE   ZERO,OPTION
          GOTO      SELE9100 IF EQUAL
.
          BRANCH    OPTION,SELE2000,SELE3000
.
          BEEP
          GOTO      SELE1000
.
SELE2000  PACK      PRGNAM1,PRGNAMC,STRHCP1,SP70
          PACK      PRGNAM2,PRGNAMC,STRHCP2,SP70
          PACK      PRGNAM3,PRGNAMC,STRHCP3,SP70
          MOVE      ONE,EXTRTYPE
          GOTO      SELE9000
.
SELE3000  PACK      PRGNAM1,PRGNAMC,STRHEC1,SP70
          PACK      PRGNAM2,PRGNAMC,STRHEC2,SP70
          PACK      PRGNAM3,PRGNAMC,STRHEC3,SP70
          MOVE      TWO,EXTRTYPE
          GOTO      SELE9000
.
SELE9000  MOVE      ZERO,EXIT
          GOTO      SELE9999
.
SELE9100  MOVE      ONE,EXIT
SELE9999  RETURN
+
.******************************************************************************
.*                                  OPTN0000              Called by: ML0000   *
.*                             Choose Main Option                             *
.******************************************************************************
OPTN0000  MOVE      ZERO,OPTION
          MOVE      ZERO,COPTION
          MOVE      SP6,GRPCODE             * Clear the health fund group
          MOVE      PRGNAM1,PRGNAM
          CALL      DISPHEAD   
          DISPLAY   *P1:3,*EF:
                    *P1:4,*V2LON,"0",*HOFF," = Exit":
                    *P1:5,*V2LON,"1",*HOFF:
                    " = All Patients":
                    *P1:6,*V2LON,"2",*HOFF:
                    " = All Patients for a Health Fund Group":
                    *P1:7,*V2LON,"3",*HOFF:
                    " = Patients for a Claim Code / Health Fund Group":
                    *P1:8,*V2LON,"4",*HOFF:
                    " = List the No. of Patients to be Extracted":
                    *P1:9,*V2LON,"5",*HOFF:
                    " = Run ";
          IF        EXTRTYPE=1
            DISPLAY   STRHCP2;
          ENDIF
          IF        EXTRTYPE=2
            DISPLAY   STRHEC2;
          ENDIF
          DISPLAY   " Extract"
.
          MOVE      "13",CVERT
.
          DISPLAY   *P1:10,*V2LON,"6",*HOFF:
                    " = Northern Territory Health Extract"
.
          DISPLAY   *P1:11,*V2LON,"7",*HOFF:
                    " = Private Patients Excluding Public/Reciprocal"
.
          DISPLAY   *P1:CVERT,"Select option : ";
OPTN1000  KEYIN     *P17:CVERT,*DV,UNDLN2,*P17:CVERT,*V2LON,OPTION;
.
          COMPARE   ZERO,OPTION
          GOTO      OPTN9500 IF EQUAL
.
          BRANCH    OPTION,OPTN2000,OPTN3000,OPTN4000,OPTN5000,OPTN6000:
                           OPTN7000,OPTN8000
.
          BEEP
          GOTO      OPTN1000
.
OPTN2000  DISPLAY   *P50:2,*V2LON," - All Patients ";
          GOTO      OPTN9000
.
OPTN3000  DISPLAY   *P50:2,*V2LON," - Health Fund Group ";
          GOTO      OPTN9000
.
OPTN4000  DISPLAY   *P50:2,*V2LON," - Claim Code/Health Fund Group ";
          GOTO      OPTN9000
.
OPTN5000  DISPLAY   *P50:2,*V2LON," - Patients to be Extracted ";
          GOTO      OPTN9000
.
OPTN6000  DISPLAY   *P50:2,*V2LON," - ";
          IF        EXTRTYPE=1
            DISPLAY   *V2LON,STRHCP2;
          ENDIF
          IF        EXTRTYPE=2
            DISPLAY   *V2LON,STRHEC2; 
          ENDIF
          DISPLAY   *V2LON," Extract ";
          GOTO      OPTN9000
.
OPTN7000  DISPLAY   *P50:2,*V2LON," - NT Health Extract  ";
          GOTO      OPTN9000
.
OPTN8000  DISPLAY   *P50:2,*V2LON:
                    " - Private Patients Excluding Public/Reciprocal";
          GOTO      OPTN9000
.
OPTN9000  ADD       TWO,CVERT
          MOVE      ZERO,EXIT
          GOTO      OPTN9999
.
OPTN9500  MOVE      ONE,EXIT
OPTN9999  RETURN
+
.******************************************************************************
.*                                  KHOS0000              Called by: ML0000   *
.*                            Enter The Date Ranges                           *
.******************************************************************************
KHOS0000  COMPARE   ONE,IBCNMHOS
          GOTO      KHOS9999 IF NOT EQUAL
.
          MOVE      ZERO,COUNTER
          MOVE      ZERO,NOOFHOSP
          KEYIN     *P1:CVERT,"Number of Hospitals: ",NOOFHOSP;
          IF        NOOFHOSP<1
            GOTO      KHOS9999
          ENDIF
          MOVE      ONE,COUNTER
.
KHOS1000  ADD       ONE,CVERT
          DISPLAY   *P1:CVERT,*EL,"Hospital Id : ";
          MOVE      TEN5,ECOL
          MOVE      CVERT,EVERT
          MOVE      SP3,CKYIDEF3
          MOVE      ONE,CKYIMAND           * Not Mandatory
          OPEN      PATHSPA1,"pathspaf"
.
          CALL      PATHSPKY
          BRANCH    EXIT,KHOS9500,KHOS9500
          GOTO      KHOS3000
.
KHOS2000  MOVE      "All Hospitals",PTHSNAME
          MOVE      SP10,PTHSHOSP
          MOVE      ZERO,EXIT
.
KHOS3000  DISPLAY   *P20:CVERT,*V2LON,PTHSNAME;
          PACK      HSAPPRAR[COUNTER],PTHSAPPR,SP70
          PACK      HSHOSPAR[COUNTER],PTHSHOSP,SP70
          PACK      HSNAMEAR[COUNTER],PTHSNAME,SP70
          ADD       ONE,COUNTER
          COMPARE   NOOFHOSP,COUNTER
          GOTO      KHOS1000 IF LESS
          GOTO      KHOS1000 IF EQUAL
          GOTO      KHOS9999
.
KHOS9500  MOVE      ONE,EXIT
KHOS9999  RETURN
+
.******************************************************************************
.*                                  KCLM0000              Called by: ML0000   *
.*                            Enter The Claim Code                            *
.******************************************************************************
KCLM0000  MOVE      "21",ECOL
          MOVE      "17",EVERT
          MOVE      "CL",CODE
          MOVE      SP3,CKYIDEF3            * No default
          MOVE      ZERO,CKYIMAND           * Keyin not mandatory
          MOVE      ONE,CNEWDS              * Don't return for keyin
          DISPLAY   *P1:EVERT,"Claim Code        :",*EF;
          CALL      PATCODKY                * Keyin the claim code
          BRANCH    EXIT,KCLM9500,KCLM9900
.                        Enter    Exit
.
          DISPLAY   *P31:EVERT,TDESC
          MOVE      ACODE,CLMCODE
          MOVE      TDESC,CLMDESC
          MOVE      ZERO,EXIT
          GOTO      KCLM9999
.
KCLM9500  MOVE      ONE,EXIT
          GOTO      KCLM9999
.
KCLM9900  MOVE      TWO,EXIT
KCLM9999  RETURN
+
.******************************************************************************
.*                                  KHGP0000              Called by: ML0000   *
.*                         Enter The Health Fund Group                        *
.******************************************************************************
KHGP0000  MOVE      "21",ECOL
          LOAD      EVERT,OPTION,TEN,TEN7,TEN8,TEN8
          MOVE      SP6,CKYIDEF6            * No default
          MOVE      ZERO,CKYIMAND           * Keyin not mandatory
          MOVE      ONE,CNEWDS              * Don't return for keyin
KHGP1000  DISPLAY   *P1:EVERT,"Health Fund Group :",*EF;
          CALL      PATHGPKY                * Keyin the health fund group
          BRANCH    EXIT,KHGP4000,KHGP4000,KHGP9900
.                        Space    Nothing  Exit
.
          MOVE      PTHGCODE,GRPCODE
          MOVE      PTHGDESC,GRPDESC
          DISPLAY   *P31:EVERT,PTHGDESC;
.
. ----- Check To See If This Health Fund Group Is Part Of A Health Fund -----
.
          PACK      KEY14,SP20
          CALL      RDSFUND1                * Position on & read the health
KHGP2000  CALL      RDKFUND1                  fund file
          BRANCH    OVRCD,KHGP3000
.
          MATCH     ZERO8,HFTABL
          GOTO      KHGP2000 IF NOT EQUAL   * Only want 1st record for HF
.
          MOVE      "02",KEY2               * check HF history for HF Group
          PACK      KEY17,HCODE,KEY2,SP70
          CALL      PATDDHRD
.
          MATCH     GRPCODE,PTHFHGRP
          GOTO      KHGP2000 IF NOT EQUAL   * Not HFG required
.
          GOTO      KHGP9000                * HFG found for this HF
.
KHGP3000  
...       DISPLAY   *P1:24,*EL,*B,"No Health Funds set up for this Health ":
...                 "Fund Group.  ";
...       CALL      HITENTER
...       GOTO      KHGP1000
          GOTO      KHGP9000
.
. ----- Spaces Entered -----
.
KHGP4000  MOVE      SP6,GRPCODE
          MOVE      SP30,GRPDESC
          BRANCH    OPTION,KHGP9000,KHGP6000,KHGP5000,KHGP6000
.
KHGP5000  DISPLAY   *PECOL:EVERT,*V2LON,"All Patients";
          GOTO      KHGP9000
.
KHGP6000  DISPLAY   *PECOL:EVERT,*V2LON,"Unknown Patients";
.
KHGP9000  MOVE      ZERO,EXIT
          GOTO      KHGP9999
.
KHGP9500  MOVE      ONE,EXIT
          GOTO      KHGP9999
.
KHGP9900  MOVE      TWO,EXIT
KHGP9999  RETURN
+
.******************************************************************************
.*                                  COPT0000              Called by: ML0000   *
.*                                 Sub Option                                 *
.******************************************************************************
COPT0000  MOVE      ZERO,COPTION
          DISPLAY   *P1:12,*EF:
                    *P1:13,*V2LON,"1",*HOFF," = Detailed Report":
                    *P1:14,*V2LON,"2",*HOFF," = Summary Report":
                    *P1:16,"Select option : ";
COPT1000  KEYIN     *P17:16,*DV,UNDLN2,*P17:16,*V2LON,COPTION;
          MOVE      17,CVERT 
.
          COMPARE   ZERO,COPTION
          GOTO      COPT9500 IF EQUAL
.
          BRANCH    COPTION,COPT2000,COPT3000
.
          BEEP
          GOTO      COPT1000
.
COPT2000  DISPLAY   *P58:2,*V2LON,"(Detailed) ";
          GOTO      COPT9000
.
COPT3000  DISPLAY   *P58:2,*V2LON,"(Summary) ";
.
COPT9000  MOVE      ZERO,EXIT
          GOTO      COPT9999
.
COPT9500  MOVE      ONE,EXIT
COPT9999  RETURN
+
.******************************************************************************
.*                                  KDAT0000              Called by: ML0000   *
.*                            Enter The Date Ranges                           *
.******************************************************************************
KDAT0000  MOVE      "21",CCOL
          LOAD      CVERT,OPTION,TEN7,TEN8,TEN9,TEN9,TEN7,TEN7,TEN7
          LOAD      CVERT,COPTION,TWENTY,TEN8
          DISPLAY   *P1:CVERT,"Starting Date     : ",*EF;
          ADD       ONE,CVERT
          DISPLAY   *P1:CVERT,"Ending Date       : ";
.
          MOVE      ZERO,DOYR2025
          MOVE      ONE,CCANLDTE            * Blank cancel default
          MOVE      ZERO,CHIGHLT            * Use highlight
.
. ----- Enter Starting Date -----
.
KDAT1000  SUB       ONE,CVERT
KDAT2000  MOVE      CCC,CCENT
          UNPACK    SP6,CYEAR,CMON,CDAY     * No defaults
          CALL      KEYDATE                 * Keyin date
          BRANCH    OVRCD,KDAT9500          * Nothing entered
          BRANCH    CQUEST,KDAT2000
.
          PACK      STRTDTE8,CCENT,CYEAR,CMON,CDAY
          REP       " 0",STRTDTE8
.
          MATCH     STRTDTE8,CURRDATE
          GOTO      KDAT3000 IF NOT LESS    * Date is <= current date
.
          DISPLAY   *P1:24,*B,"Date must not be after current date.  ",*EL;
          CALL      HITENTER 
.         GOTO      KDAT2000
.
. ----- Enter Ending Date -----
.
KDAT3000  ADD       ONE,CVERT
KDAT4000  UNPACK    STRTDTE8,CCENT,CYEAR,CMON,CDAY * Get defaults
          CALL      KEYDATE                 * Keyin date
          BRANCH    OVRCD,KDAT1000          * Nothing entered
          BRANCH    CQUEST,KDAT4000
.
          PACK      ENDDTE8,CCENT,CYEAR,CMON,CDAY
          REP       " 0",ENDDTE8
.
          MATCH     STRTDTE8,ENDDTE8
          GOTO      KDAT5000 IF NOT LESS    * Date is <= start date
.
          DISPLAY   *P1:24,*B,"Ending date must be after Starting date.  ",*EL;
          CALL      HITENTER 
          GOTO      KDAT4000
.
. ----- Check End Date >= Current Date -----
.
KDAT5000  MATCH     ENDDTE8,CURRDATE
          GOTO      KDAT8000 IF NOT LESS    * Date is <= current date
.
          DISPLAY   *P1:24,*B,"Date must not be after current date.  ",*EL;
          CALL      HITENTER 
          GOTO      KDAT4000
.
KDAT8000  SCAN      "PreJulyTest",REPTNAME
          IF        @EQUAL
            MATCH     "20250101",STRTDTE8
          ELSE
            MATCH     "20250701",STRTDTE8
          ENDIF
          GOTO      KDAT9000 IF LESS

          MOVE      ONE,DOYR2025
.
KDAT9000  MOVE      ZERO,EXIT
          GOTO      KDAT9999
.
KDAT9500  MOVE      ONE,EXIT
.
KDAT9999  RETURN
+
.******************************************************************************
.*                                  FILE0000              Called by: ML0000   *
.*                            Get Extract Filename                            *
.******************************************************************************
FILE0000  LOAD      CVERT,OPTION,TEN9,TWENTY,TWENTY1,TEN5,TEN9,TEN9,TEN9
          DISPLAY   *P1:CVERT,*EL,"Extract File Name : ";
.
FILE1000  MOVE      GRPCODE,KEY3
          UNPACK    ENDDTE8,CCENT,CYEAR,CMON,CDAY
          IF        OPTION = 6
            PACK      HCPFNAME,ANSN,ANST,CDAY,CMON
            GOTO      FILE1050
          ELSE
            IF        OPTION = 7
              MOVE      "CORAS",DIM5
              PACK      HCPFNAME,DIM5,CDAY,CMON
              GOTO      FILE1050
            ENDIF            
          ENDIF
          MATCH     SP3,KEY3
          IF        @EQUAL
            PACK      HCPFNAME,CDAY,CMON
          ELSE
            PACK      HCPFNAME,KEY3,CDAY,CMON
          ENDIF
.
FILE1050  MATCH     "IBARSH99",PGM
          GOTO      FILE1100 IF EQUAL       * overwrite for WEB
.
          KEYIN     *P21:CVERT,*EL,*V2LON,*RV,HCPFNAME;
.
          ENDSET    HCPFNAME
          APPEND    SP8,HCPFNAME
          RESET     HCPFNAME
.
          CMATCH    EXITCHAR,HCPFNAME
          GOTO      FILE9500 IF EQUAL       * Exit
.
          MATCH     SP8,HCPFNAME
          GOTO      FILE9500 IF EQUAL       * Exit
.
. ----- Set Up Extract Filename -----
.
FILE1100  STRIP     HCPFNAME
          SQUEEZE   HCPFNAME
          MOVE      SP20,INPFNAME
          CLEAR     INPFNAME
          APPEND    HCPFNAME,INPFNAME
          APPEND    "/hcp",INPFNAME
          RESET     INPFNAME
.
          DISPLAY   *P21:CVERT,*EL,*V2LON,*+,HCPFNAME,".hcp";
.
          MOVE      ZERO,OVRCD
          TRAP      OVERCOND IF IO
.                                                                     *I-105249
          OPEN      INPFILE6,INPFNAME
          TRAPCLR   IO
          BRANCH    OVRCD,FILE9000        * File doesnt exist
          CLOSE     INPFILE6
.
FILE2000  MATCH     "IBARSH99",PGM
          GOTO      FILE9000 IF EQUAL       * overwrite for WEB
.
          KEYIN     *P1:24,*B,*EL,"An extraction file with this name":
                    " already exists. Overwrite it (",*V2LON,*DV,ANSY:
                    *HOFF,"/",*V2LON,*DV,ANSN,*HOFF,") ? ",*V2LON,ANS;
          REP       UPPLOW,ANS
          MATCH     ANSY,ANS
          GOTO      FILE9000 IF EQUAL       * Overwrite file
.
          MATCH     ANSN,ANS
          GOTO      FILE1000 IF EQUAL       * Keyin filename again
.
          BEEP
          GOTO      FILE2000
.
FILE9000  MOVE      ZERO,EXIT
          GOTO      FILE9999
.
FILE9500  MOVE      ONE,EXIT
FILE9999  RETURN
+
.******************************************************************************
.*                           PHDB   FILE0000              Called by: ML0000   *
.*                   Get Extract Filename if running PHDB                     *
.******************************************************************************
PFIL0000  MOVE      "19",CVERT
          DISPLAY   *P1:CVERT,*EL,"Extract File Name : ";
.
.         Set up extract filename
.
          COMPARE   ONE,IBCNMHOS                 * I-155044
          IF        @EQUAL
            PACK      LJUSCODE,PTHSAPPR,SP100
          ELSE
            PACK      LJUSCODE,CAPPRVNO,SP100
          ENDIF
.
          MOVE      "8",JUSTNO
          CALL      RJUS0000                * Right justify code
          MOVE      RJUSCODE,DIM8           * Hospital no
.
          REP       " 0",DIM8
          MOVE      SP20,INPFNAME
          CLEAR     INPFNAME
          APPEND    DIM8,INPFNAME
          APPEND    "_PHDB_",INPFNAME
.
          UNPACK    ENDDTE8,CCENT,CYEAR,CMON,CDAY
          REP       " 0",CMON
.
          APPEND    CMON,INPFNAME 
          APPEND    CCENT,INPFNAME
          APPEND    CYEAR,INPFNAME
          APPEND    ".txt_",INPFNAME
          RESET     INPFNAME
.
          MOVE      INPFNAME,DIM24
          REP       "/.",DIM24
          DISPLAY   *P21:CVERT,*EL,*V2LON,*+,DIM24;
.
          MOVE      ZERO,OVRCD
          TRAP      OVERCOND IF IO
.
          OPEN      INPFILE6,INPFNAME
          TRAPCLR   IO
          BRANCH    OVRCD,FILE9000          * File doesnt exist
          CLOSE     INPFILE6
.
PFIL2000  MATCH     "IBARSH",PGM
          GOTO      PFIL9000 IF EQUAL
.
          KEYIN     *P1:24,*B,*EL,"An extraction file with this name":
                    " already exists. Overwrite it (",*V2LON,*DV,ANSY:
                    *HOFF,"/",*V2LON,*DV,ANSN,*HOFF,") ? ",*V2LON,ANS;
          REP       UPPLOW,ANS
          MATCH     ANSY,ANS
          GOTO      PFIL9000 IF EQUAL       * Overwrite file
.
          MATCH     ANSN,ANS
          GOTO      PFIL9500 IF EQUAL       * Keyin filename again
.
          BEEP
          GOTO      PFIL2000
.
PFIL9000  MOVE      ZERO,EXIT
          GOTO      PFIL9999
.
PFIL9500  MOVE      ONE,EXIT
PFIL9999  RETURN
+
.******************************************************************************
.*                                  EXTD0000              Called by: ML0000   *
.*                 Extract All Patients Within The Date Range                 *
.******************************************************************************
EXTD0000  IF        OPTION=4
            CALL      OPEN0000              * Open the tempfile
          ELSE
            PREP      INPFILE6,INPFNAME                             *I-105249
          ENDIF
          DISPLAY   *P1:24,*EL,"Processing : ",*P40:24,"Loading : ";
          MOVE      ZERO,SNAPRECS
          MOVE      ZERO,EXTRSNAP
          MOVE      ZERO,ERRORCNT
          MOVE      ZERO,EXTRDCNT
          MOVE      ZERO,TOTRDCNT
          MOVE      ZERO,CPAGENO            * Reset page number
          CALL      HEAD0000                * Print page heading
          CALL      WHED0000                * Write the HCP header details
          PACK      KEY16,STRTDTE8,SP20
          CALL      RDSDSCH2                * Position on & loop through the
EXTD1000  CALL      RDKDSCH2                  discharge file
          BRANCH    OVRCD,EXTD8000
.
          MATCH     DDATE,ENDDTE8
          GOTO      EXTD8000 IF LESS        * Date after end date
.
.         Multi-Hospital Processing
.
          COMPARE   ONE,IBCNMHOS
          GOTO      EXTD2000 IF NOT EQUAL
.
          MOVE      DADMNO,KEY8
          CALL      RDPMVX11
          BRANCH    OVRCD,EXTD1000
.
          MOVE      ONE,COUNT
          WHILE     COUNT<=NOOFHOSP
            MATCH     HSHOSPAR[COUNT],PMVXMHOS
            GOTO      EXTD2000 IF EQUAL
            ADD       ONE,COUNT
          DO
          GOTO      EXTD1000
.
EXTD2000  MOVE      DDATE,ICDRDDTE          * Used for reading ICD files
.
EXTD2500  ADD       ONE,TOTRDCNT            * Increment total record counter
          UNPACK    DDATE,CCENT,CYEAR,CMON,CDAY
          CALL      PACDATE
          DISPLAY   *P14:24,*V2LON,DADMNO,SP2,CPCDATE; * Display something
.
          MOVE      DADMNO,KEY8
          CALL      RDMISS1                 * Read the admission file
          IF        OVRCD=1
            PACK      ERRMSG,ERRMSG01,SP100
            CALL      ERR0000               * Print error
            GOTO      EXTD1000
          ENDIF
.
          IF        OPTION=7
            PACK      KEY5,ANSC,ANSL,ACLAIM,SP70
            CALL      RDCODE1
            IF        OVRCD=0
              MATCH     ANSP,TCINDC1
              IF        @EQUAL
                GOTO      EXTD1000
              ELSE
                MATCH     ANSR,TCINDC1
                IF        @EQUAL
                  GOTO      EXTD1000
                ENDIF
              ENDIF
            ENDIF
          ENDIF
.
          CALL      EXNB0000                  * Excluded newborn
          BRANCH    EXIT,EXTD1000
.
          IF        OPTION=5
            PACK      KEY5,CATCL,ACLAIM
            CALL      RDCODE1                 * Cat."CL"
            BRANCH    OVRCD,EXTD7000
.
            MATCH     "1",TCINDC6
            GOTO      EXTD1000 IF EQUAL
          ENDIF
.
EXTD7000  MATCH     SP3,ATYPE
          GOTO      EXTD1000 IF EQUAL
.
          PACK      KEY5,ANSA,SP1,ATYPE     * Read the patients code file
          CALL      RDCODE1                 * Cat."A "
          BRANCH    OVRCD,EXTD1000
.
          MATCH     ANSX,TCINDC5
          GOTO      EXTD1000 IF EQUAL       * Exclude from extract
.
          MATCH     ANSB,TCINDC3
          GOTO      EXTD1000 IF EQUAL       * Ignore boarder & unqual patients
.
          IF        OPTION<>5
            CALL      VCHF0000              * Validate claim code & health fund
            BRANCH    EXIT,EXTD1000
          ENDIF
.
          MOVE      AURNO,KEY8
          CALL      RDMAST1                 * Read the master file
          IF        OVRCD=1
            PACK      ERRMSG,ERRMSG02,SP100
            CALL      ERR0000               * Print error
            GOTO      EXTD1000
          ENDIF
.
          MOVE      DADMNO,PVIBILL
          MOVE      PVIBILL,KEY8
          CALL      RDVISA1                 * Read the visit file
          IF        OVRCD=1
            PACK      ERRMSG,ERRMSG03,SP100
            CALL      ERR0000               * Print error
            GOTO      EXTD1000
          ENDIF
.
          MOVE      PVIBILL,KEY8            * Read Visit ext file      *I-53371
          CALL      RDPMVX11
          IF        OVRCD=1
            CALL      CLPMSVX1
          ENDIF
.
          ADD       ONE,EXTRDCNT            * Increment extracted record counter
          DISPLAY   *P50:24,*EL,*V2LON,AADMNO,SP2,AFUNDH;
          IF        OPTION=4
            CALL      LODT0000              * Load the tempfile
          ELSE
            CALL      CVAR0000              * Clear variables
            CALL      GDAT0000              * Get the data for the HCP file
            CALL      ZFNF0000              * Zero fill numeric fields
            CALL      VDAT0000              * validate HDP variables
            CALL      ANSP0000              * AN-SNAP Extract (options 1-3 only)
            CALL      WRTD0000              * Write the data to the HCP file
          ENDIF
          GOTO      EXTD1000
.
. ----- End Of Processing -----
.
EXTD8000  IF        OPTION=4
            CALL      PRTT0000              * Print the tempfile
            CALL      KILL0000              * Delete the tempfile
          ELSE
            MOVE      EXTRDCNT,FORM4
            MOVE      FORM4,DRGNOREC
            REP       " 0",DRGNOREC
            MOVE      EXTRSNAP,FORM4
            MOVE      FORM4,DRGNOSNP
            REP       " 0",DRGNOSNP
.
            WRITAB    INPFILE6,ZERO;*28,DRGNOREC *Update no of rec. written
.
.*---------*T0889652 - Use ANSPFIL1 AN-SNAP file layout from 01/07/2020
            IF        SNAPRECS = 1
              WRITAB    ANSPFIL1,ZERO;*28,DRGNOSNP *Update no of rec. written
            ENDIF
.
            CALL      UND80
            PRINT     *N,"Number of Records Read      : ",TOTRDCNT:
                      *N,"Number of Records Extracted : ",EXTRDCNT:
                      *N,"Number of Errors Found      : ",ERRORCNT:
                      *N,"Number of Warnings Found    : ",WARNGCNT;
            IF        OPTION=5
              PRINT     *N,"Extract File Name           : ",INPFNAME;
            ELSE
              PRINT     *N,"Extract File Name           : ",HCPFNAME;
            ENDIF
            PRINT     *N,*N,"*** End of Report ***"
            DISPLAY   *P1:24,*EL,EXTRDCNT," records extracted. ":
                      ERRORCNT," errors found. ";
            CALL      HITENTER
          ENDIF
.
EXTD9000  MOVE      ZERO,EXIT
EXTD9999  RETURN
+
.******************************************************************************
.*                                  HEAD0000              Called by: EXTD0000 *
.*                          Print The Report Heading                          *
.******************************************************************************
HEAD0000  LOAD      CNOUNDLN,OPTION,ZERO,ZERO,ZERO,ONE,ZERO,ZERO,ZERO
          MOVE      PRGNAM1,PRGNAM
          IF        OPTION=5
            PACK      PRGNAM,PRGNAM2,SP70
          ENDIF
          IF        OPTION=6
            PACK      PRGNAM,PRGNAM3,SP70
          ENDIF
          CALL      HEAD80
          IF        IBCNMHOS =1
          MOVE      ONE,COUNT
          WHILE     COUNT<=NOOFHOSP
            PRINT     *N,*20,"Hospital          : ",HSNAMEAR[COUNT]
            ADD       "1",CLNO
            ADD       ONE,COUNT
          DO
.
          ENDIF
.
          UNPACK    STRTDTE8,CCENT,CYEAR,CMON,CDAY
          CALL      PACDATE
          PRINT     *20,"From Date         : ",CPCDATE
          UNPACK    ENDDTE8,CCENT,CYEAR,CMON,CDAY
          CALL      PACDATE
          PRINT     *20,"To Date           : ",CPCDATE,*N
          ADD       "2",CLNO
          BRANCH    OPTION,HEAD1000,HEAD2000,HEAD3000,HEAD4000,HEAD5000:
                           HEAD1000,HEAD6000
.
HEAD1000  PRINT     *20,"All Patients"
          ADD       "1",CLNO
          GOTO      HEAD3500
.
HEAD2000  PRINT     *20,"Health Fund Group : ",GRPCODE,SP1,GRPDESC
          ADD       "1",CLNO
          GOTO      HEAD3500
.
HEAD3000  PRINT     *20,"Claim Code        : ",CLMCODE,SP4,CLMDESC,*N;
          MATCH     SP6,GRPCODE
          IF        @EQUAL
            PRINT     *20,"Health Fund Group : All Patients"
          ELSE
            PRINT     *20,"Health Fund Group : ",GRPCODE,SP1,GRPDESC
          ENDIF
          ADD       "2",CLNO
.
HEAD3500  CALL      UND80
          COMPARE   OPTION,ONE
          IF        @EQUAL
            PRINT     *1,"|Adm No.",*10,"|U/R No.",*19,"|Error Message":
                      *60,"| CL",*70,"| Fund",*80,"|"
          ELSE
            PRINT     *1,"|Adm No.",*10,"|U/R No.",*19,"|Error Message",*80,"|"
          ENDIF
          ADD       "1",CLNO
          CALL      UND80
          GOTO      HEAD9000
.
HEAD4000  IF        COPTION=1
            MATCH     SP6,GRPCODE
            IF        @EQUAL
              PRINT     *20,"Health Fund Group : Unknown",*N
            ELSE
              PRINT     *20,"Health Fund Group : ",GRPCODE,SP1,GRPDESC,*N
            ENDIF
            ADD       "2",CLNO
            PRINT     *20,"List the No. of Patients to be Extracted ":
                          "(Detailed)",*N:
                      *23,"*---------------------------------*",*N:
                      *23,"|  Health  |Claim| Admin  | Claim |",*N:
                      *23,"|Fund Group|Type | Number | Total |",*N:
                      *23,"*---------------------------------*"
          ELSE
            PRINT     *20,"List the No. of Patients to be Extracted ":
                          "(Summary)",*N:
                      *24,"*--------------------------------*",*N:
                      *24,"|  Health  |Claim| Claim |  HFG  |",*N:
                      *24,"|Fund Group|Type | Total | Total |",*N:
                      *24,"*--------------------------------*"
          ENDIF
          ADD       "6",CLNO
          GOTO      HEAD9000
.             
HEAD5000  IF        EXTRTYPE=1
            PRINT     *20," PHDB Extract "
          ENDIF
          IF        EXTRTYPE=2
            PRINT     *20," PHEC Extract "
          ENDIF
          ADD       "1",CLNO
          GOTO      HEAD3500
.
HEAD6000  PRINT     *20,"Private Patients Excluding Public/Reciprocal"
          ADD       "1",CLNO
          GOTO      HEAD3500
.
HEAD9000  MOVE      ZERO,EXIT
HEAD9999  RETURN
+
.******************************************************************************
.*                                  WHED0000              Called by: EXTD0000 *
.*                    Write The Header Record For HCP File                    *
.******************************************************************************
WHED0000  COMPARE   FOUR,OPTION
          GOTO      WHED9000 IF EQUAL       * Dont write header details
.
          COMPARE   ONE,IBCNMHOS                 * I-155044
          IF        @EQUAL
            PACK      LJUSCODE,PTHSAPPR,SP100
          ELSE
            PACK      LJUSCODE,CAPPRVNO,SP100
          ENDIF
          MOVE      "8",JUSTNO
          CALL      RJUS0000                * Right justify code
          MOVE      RJUSCODE,DRGHOSPN       * Hospital no
.
          MOVE      GRPCODE,DRGFNDID        * Fund/group identifier
.
          READ      CONTROLF,SEVENTY9;*96,PTCNHCPC
          MOVE      PTCNHCPC,DRGDSKRN       * Diskette reference no
          ADD       ONE,PTCNHCPC            * Increment HCP counter
          WRITAB    CONTROLF,SEVENTY9;*96,PTCNHCPC
.
          UNPACK    CURRDATE,CCENT,CYEAR,CMON,CDAY
          PACK      DRGDATPR,CDAY,CMON,CCENT,CYEAR
          REP       " 0",DRGDATPR           * Date prepared
.
          MOVE      SP4,DRGNOREC            * No of records
          MOVE      "P",DRGTSTFG            * Test flag
.
          UNPACK    STRTDTE8,CCENT,CYEAR,CMON,CDAY
          PACK      DRGSTRT,CDAY,CMON,CCENT,CYEAR
          REP       " 0",DRGSTRT            * Start period
.
          UNPACK    ENDDTE8,CCENT,CYEAR,CMON,CDAY
          PACK      DRGEND,CDAY,CMON,CCENT,CYEAR
          REP       " 0",DRGEND             * End period
.
.
.         Version will be 0500 in the header record of extracts
.         printed for dates => 01/07/2002
.
          MOVE      "0900",DRGVERNO
.
.         Version will be 1000 in the header record of extracts
.         printed for dates => 01/07/2019
.
          MATCH     "20190701",STRTDTE8
          IF        @EQUAL | !@LESS
            MOVE      "1000",DRGVERNO
          ENDIF
.
.-------- *T0889652 Version will be 1100 in the header record of extracts
.         printed for dates => 01/07/2020
.
          MATCH     "20200701",STRTDTE8
          IF        @EQUAL | !@LESS
            MOVE      "1100",DRGVERNO
          ENDIF
.
          MOVE      "1003",DRGICDVN
          MATCH     STRTDTE8,PTCNGDV4          * ICD10 Ed.4
          IF        @LESS | @EQUAL
            MOVE      "1004",DRGICDVN
          ENDIF
          MATCH     STRTDTE8,PTCNGDV5          * ICD10 Ed.5           *I-105244
          IF        @LESS | @EQUAL
            MOVE      "1005",DRGICDVN
          ENDIF
          MATCH     STRTDTE8,PTCNGDV6          * ICD10 Ed.6           *I-163918
          IF        @LESS | @EQUAL
            MOVE      "1006",DRGICDVN
          ENDIF
          MATCH     STRTDTE8,PTCNGDV7          * ICD10 Ed.7           *I-219246
          IF        @LESS | @EQUAL
            MOVE      "1007",DRGICDVN
          ENDIF
          MATCH     STRTDTE8,PTCNGDV8          * ICD10 Ed.8           *I-284420
          IF        @LESS | @EQUAL
            MOVE      "1008",DRGICDVN
          ENDIF
          MATCH     STRTDTE8,PTCNGDV9          * ICD10 Ed.9           *I-311669
          IF        @LESS | @EQUAL
            MOVE      "1009",DRGICDVN
          ENDIF
          MATCH     STRTDTE8,PTCNGDVX          * ICD10 Ed.10          *I-0833093
          IF        @LESS | @EQUAL
            MOVE      "1010",DRGICDVN
          ENDIF
          MATCH     STRTDTE8,PTCNGDX1          * ICD10 Ed.11
          IF        @LESS | @EQUAL
            MOVE      "1011",DRGICDVN
          ENDIF
          MATCH     STRTDTE8,PTCNGDX2          * ICD10 Ed.12          *I-0917793
          IF        @LESS | @EQUAL
            MOVE      "1012",DRGICDVN
          ENDIF
          MATCH     STRTDTE8,PTCNGDX3          * ICD10 Ed.13          *I-0956210
          IF        @LESS | @EQUAL
            MOVE      "1013",DRGICDVN
          ENDIF
.                                                                     *C-105249
          WRITE     INPFILE6,SEQ;DRGHOSPN,DRGFNDID,DRGDSKRN,DRGDATPR:
                                 DRGNOREC,DRGTSTFG,DRGRESUB,DRGSTRT:
                                 DRGEND,DRGVERNO,DRGICDVN
.
          GOTO      WHED9000
.
WHED9000  MOVE      ZERO,EXIT
WHED9999  RETURN
+
.******************************************************************************
.*                                  WSHD0000              Called by: EXTD0000 *
.*                    Write The Header Record For SNAP File                   *
.******************************************************************************
WSHD0000  COMPARE   FOUR,OPTION
          GOTO      WSHD9000 IF EQUAL       * Dont write header details
.
          COMPARE   ONE,IBCNMHOS                 * I-155044
          IF        @EQUAL
            PACK      LJUSCODE,PTHSAPPR,SP100
          ELSE
            PACK      LJUSCODE,CAPPRVNO,SP100
          ENDIF
          MOVE      "8",JUSTNO
          CALL      RJUS0000                * Right justify code
          MOVE      RJUSCODE,DRGHOSPN       * Hospital no
.
          MOVE      GRPCODE,DRGFNDID        * Fund/group identifier
.
          READ      CONTROLF,SEVENTY9;*96,PTCNHCPC
          MOVE      PTCNHCPC,DRGDSKRN       * Diskette reference no
          ADD       ONE,PTCNHCPC            * Increment HCP counter
          WRITAB    CONTROLF,SEVENTY9;*96,PTCNHCPC
.
          UNPACK    CURRDATE,CCENT,CYEAR,CMON,CDAY
          PACK      DRGDATPR,CDAY,CMON,CCENT,CYEAR
          REP       " 0",DRGDATPR           * Date prepared
.
          MOVE      SP4,DRGNOREC            * No of records
          MOVE      "P",DRGTSTFG            * Test flag
.
          UNPACK    STRTDTE8,CCENT,CYEAR,CMON,CDAY
          PACK      DRGSTRT,CDAY,CMON,CCENT,CYEAR
          REP       " 0",DRGSTRT            * Start period
.
          UNPACK    ENDDTE8,CCENT,CYEAR,CMON,CDAY
          PACK      DRGEND,CDAY,CMON,CCENT,CYEAR
          REP       " 0",DRGEND             * End period
.
.         Version will be 0500 in the header record of extracts
.         printed for dates => 01/07/2002
.
          MOVE      "0900",DRGVERNO
.
.... not for ANSNAP  Tas 0879919
.         Version will be 1000 in the header record of extracts
.         printed for dates => 01/07/2019
.
....      MATCH     "20190701",DDATE
....      IF        @EQUAL | !@LESS
....        MOVE      "1000",DRGVERNO
....      ENDIF
.
.
.-------- *T0889652 Version will be 1000 in the header record using 
.-------- ANSPFIL1 AN-SNAP file layout after 01/07/2020
          MOVE      "1000",DRGVERNO
.
          WRITE     ANSPFIL1,SEQ;DRGHOSPN,DRGFNDID,DRGDSKRN,DRGDATPR:
                                 DRGNOSNP,DRGTSTFG,DRGRESUB,DRGSTRT:
                                 DRGEND,DRGVERNO,SP4,ANSS
.
          GOTO      WSHD9000
.
WSHD9000  MOVE      ZERO,EXIT
WSHD9999  RETURN
+
.******************************************************************************
.*                                   ERR0000              Called by: EXTD0000 *
.*                            Print An Error Message                          *
.******************************************************************************
ERR0000   COMPARE   ONE,OPTION
          IF        @EQUAL
            GOTO      ERRAP00
          ELSE
            GOTO      ERR0050
          ENDIF
          GOTO      ERR9999
ERR0050   COMPARE   FOUR,OPTION
          GOTO      ERR9000 IF EQUAL        * Dont print error messages
.
          COMPARE   "55",CLNO
          CALL      HEAD0000 IF NOT LESS
.
          STRIP     ERRMSG
          MOVELPTR  ERRMSG,FORM3
.
          IF        FORM3>SIXTY
            CALL      SPLERR00
            STRIP     MSG1
ERR1000     CMATCH    SP1,MSG2                 * Eliminate leading blanks
            IF        @EQUAL
              BUMP      MSG2
              GOTO      ERR1000 IF NOT EOS
            ENDIF

            PACK      KEY60,MSG2,SP70          * reset form pointer
            MOVE      KEY60,MSG2

            STRIP     MSG2
            PRINT     *1,"|",DADMNO,*10,"|",DURNO,*19,"|",MSG1,*80,"|",*N:
                      *1,"|",*10,"|",*19,"|",MSG2,*80,"|"
            ADD       TWO,CLNO
          ELSE
            PACK      MSG1,ERRMSG,SP70
            PRINT     *1,"|",DADMNO,*10,"|",DURNO,*19,"|",MSG1,*80,"|"
            ADD       ONE,CLNO
          ENDIF
.
          IF        WRNFLAG=1
            ADD       ONE,WARNGCNT
          ELSE
            ADD       ONE,ERRORCNT
          ENDIF
.
ERR9000   MOVE      ZERO,EXIT
ERR9999   MOVE      ZERO,WRNFLAG
          RETURN
+
.******************************************************************************
.*                                   ERRAP00              Called by: ERR0000  *
.*                  Print All Patient Error Message (OPTION 1)                *
.******************************************************************************
ERRAP00   COMPARE   FOUR,OPTION
          GOTO      ERRAP90 IF EQUAL        * Dont print error messages
.
          COMPARE   "55",CLNO
          CALL      HEAD0000 IF NOT LESS
.
          STRIP     ERRMSG
          MOVELPTR  ERRMSG,FORM3
.
          IF        FORM3>FORTY
            CALL      SPLERO00
            STRIP     MSG01
ERRAP10     CMATCH    SP1,MSG02                 * Eliminate leading blanks
            IF        @EQUAL
              BUMP      MSG02
              GOTO      ERRAP10 IF NOT EOS
            ENDIF
.
            PACK      KEY40,MSG02,SP70          * reset form pointer
            MOVE      KEY40,MSG02
.
            STRIP     MSG02
            MATCH     SP70,MSG03
            IF        @EQUAL
              PRINT     *1,"|",DADMNO,*10,"|",DURNO,*19,"|",MSG01:
                        *60,"| ",ACLAIM,*70,"| ",AFUNDH,*80,"|",*N:
                        *1,"|",*10,"|",*19,"|",MSG02,*60,"|",*70,"|",*80,"|"
              ADD       TWO,CLNO
            ELSE
ERRAP20       CMATCH    SP1,MSG03                 * Eliminate leading blanks
              IF        @EQUAL
                BUMP      MSG03
                GOTO      ERRAP20 IF NOT EOS
              ENDIF
              PACK      KEY40,MSG03,SP70          * reset form pointer
              MOVE      KEY40,MSG03
              STRIP     MSG03
              PRINT     *1,"|",DADMNO,*10,"|",DURNO,*19,"|",MSG01:
                        *60,"| ",ACLAIM,*70,"| ",AFUNDH,*80,"|",*N:
                       *1,"|",*10,"|",*19,"|",MSG02,*60,"|",*70,"|",*80,"|",*N:
                       *1,"|",*10,"|",*19,"|",MSG03,*60,"|",*70,"|",*80,"|"
              ADD       THREE,CLNO 
            ENDIF
          ELSE
            PACK      MSG01,ERRMSG,SP70
            PRINT     *1,"|",DADMNO,*10,"|",DURNO,*19,"|",MSG01:
                      *60,"| ",ACLAIM,*70,"| ",AFUNDH,*80,"|"
            ADD       ONE,CLNO
          ENDIF
.
          IF        WRNFLAG=1
            ADD       ONE,WARNGCNT
          ELSE
            ADD       ONE,ERRORCNT
          ENDIF
.
ERRAP90   MOVE      ZERO,EXIT
ERRAP99   MOVE      ZERO,WRNFLAG
          RETURN
+
.******************************************************************************
.*                                   SPLERR00             Called by: ERR0000  *
.*                    Split Error Message into MSG1 and MSG2                  *
.******************************************************************************
SPLERR00  MOVE      SP70,MSG1
          MOVE      SP70,MSG2
          MOVE      SIXTY,FORM2
SPLERR10  RESET     ERRMSG,FORM2
          CMATCH    ERRMSG,SP1
.
          IF        @EQUAL
            UNPACK    ERRMSG,MSG2
            RESET     ERRMSG
            SETLPTR   ERRMSG,FORM2
            UNPACK    ERRMSG,MSG1
            RESET     ERRMSG
            GOTO      SPLERR99
          ENDIF
.
          SUBTRACT  ONE,FORM2
.
          IF        FORM2=ZERO
            RESET     ERRMSG
            UNPACK    ERRMSG,MSG1,MSG2
          ELSE
            GOTO      SPLERR10
          ENDIF
.
SPLERR99  RETURN
+
.******************************************************************************
.*                                   SPLERO00             Called by: ERRAP00  *
.*                 Split Error Message into MSG1, MSG2 and MSG3               *
.******************************************************************************
SPLERO00  MOVE      SP70,MSG01
          MOVE      SP70,MSG02
          MOVE      SP70,MSG03
          MOVE      ONE,FORM3                * FP - pointer
          MOVE      FORTY,F3                 * LL - logical length
          GOTO      SPLERO15
SPLERO10  ADD       FORTY,F3
SPLERO15  RESET     ERRMSG,FORM3
          SETLPTR   ERRMSG,F3
SPLERO20  CMATCH    ERRMSG,SP1
          IF        @EQUAL
            BUMP      ERRMSG                 * remove leading spaces
            ADD       ONE,FORM3
            GOTO      SPLERO20 IF NOT EOS
          ENDIF
.
          MOVEFPTR  ERRMSG,FORM3
          RESET     ERRMSG,F3
SPLERO30  CMATCH    ERRMSG,SP1
          IF        !@EQUAL
            BUMP      ERRMSG,-1              * remove trailing spaces
            SUBTRACT    ONE,F3
            COMPARE     F3,FORM3
            IF          @EQUAL
              ADD         FORTY,F3
              GOTO        SPLERO40
            ENDIF
            GOTO        SPLERO30
          ENDIF
.
SPLERO40  RESET     ERRMSG,FORM3
          SETLPTR   ERRMSG,F3
          MATCH     SP70,MSG01
          IF        @EQUAL
            UNPACK    ERRMSG,MSG01
            MOVE      F3,FORM3
            GOTO      SPLERO10
          ENDIF          
          MATCH     SP70,MSG02
          IF        @EQUAL
            UNPACK    ERRMSG,MSG02
            MOVE      F3,FORM3
            GOTO      SPLERO10
          ENDIF
          MATCH     SP70,MSG03
          IF        @EQUAL
            UNPACK    ERRMSG,MSG03
            GOTO      SPLERO99
          ENDIF
. 
SPLERO99  RETURN
+
.******************************************************************************
.*                                  VCHF0000              Called by: EXTD0000 *
.*                  Validate Claim Code & Health Fund                         *
.******************************************************************************
VCHF0000  MOVE      SP6,DRGFUND
          MOVE      SP6,HCPCODE
          BRANCH    OPTION,VCHF1000,VCHF2000,VCHF3000,VCHF4000,VCHF9999:
                           VCHF9999,VCHF1000
          GOTO      VCHF9000
.
. ----- Option 1 - all patients -----
.
VCHF1000  MATCH     SP6,AFUNDH
          IF        @EQUAL
            CALL      VALHFC00              * Work Cover, TAC or DVA instead
            BRANCH    EXIT,VCHF9500
            GOTO      VCHF9000
          ENDIF
.
          PACK      KEY14,AFUNDH,ZERO8,SP10
          CALL      RDFUND1                 * Read the health fund file
          BRANCH    OVRCD,VCHF9000
.
          MOVE      "02",KEY2               * check HF history for HF Group
          PACK      KEY17,AFUNDH,KEY2,DDATE,SP70
          CALL      PATDDHRD
.
          MOVE      "01",KEY2               * check HF history for HCP eq.
          PACK      KEY17,AFUNDH,KEY2,DDATE,SP70
          CALL      PATDDHRD
.
          MATCH     SP6,PTHFHGRP
          GOTO      VCHF9000 IF EQUAL       * Blank health fund group, exit
.
          PACK      KEY6,PTHFHGRP
          CALL      RDPAHGP1                * Read the HGP file
          BRANCH    OVRCD,VCHF9000
.
          PACK      DRGFUND,AFUNDH,SP10     * Use health fund code
          MATCH     SP6,PTHFHCPE
          IF        !@EQUAL
            PACK      DRGFUND,PTHFHCPE,SP10 * Use HCP equilvalent
          ENDIF
          GOTO      VCHF9000
.
. ----- Option 2 - by health fund group -----
.
VCHF2000  MATCH     SP6,GRPCODE
          GOTO      VCHF2100 IF EQUAL       * Blank health fund group code
.
          MATCH     SP6,AFUNDH
          IF        @EQUAL
            CALL      VALHFC00              * Work Cover, TAC or DVA instead
            BRANCH    EXIT,VCHF9500
            GOTO      VCHF9000
          ENDIF
.
          PACK      KEY14,AFUNDH,ZERO8,SP10
          CALL      RDFUND1                 * Read the health fund file
          BRANCH    OVRCD,VCHF9500
.
          MOVE      "02",KEY2               * check HF history for HF Group
          PACK      KEY17,AFUNDH,KEY2,DDATE,SP70
          CALL      PATDDHRD
.
          MOVE      "01",KEY2               * check HF history for HF equivalent
          PACK      KEY17,AFUNDH,KEY2,DDATE,SP70
          CALL      PATDDHRD
.
          MATCH     SP6,PTHFHGRP
          GOTO      VCHF9500 IF EQUAL       * Blank health fund group, error
.
          MATCH     GRPCODE,PTHFHGRP
          GOTO      VCHF9500 IF NOT EQUAL   * Different health fund group, error
.
          PACK      KEY6,PTHFHGRP
          CALL      RDPAHGP1                * Read the HGP file
          BRANCH    OVRCD,VCHF9500
.
          PACK      DRGFUND,AFUNDH,SP10     * Use health fund code
          MATCH     SP6,PTHFHCPE
          IF        !@EQUAL
            PACK      DRGFUND,PTHFHCPE,SP10 * Use HCP equilvalent
          ENDIF
          GOTO      VCHF9000
.
VCHF2100  MATCH     SP6,AFUNDH
          GOTO      VCHF9000 IF EQUAL       * Blank health fund, exit
.
          PACK      KEY14,AFUNDH,ZERO8,SP10
          CALL      RDFUND1                 * Read the health fund file
          BRANCH    OVRCD,VCHF9000
.
          MOVE      "02",KEY2               * check HF history for HF Group
          PACK      KEY17,AFUNDH,KEY2,DDATE,SP70
          CALL      PATDDHRD
.
          MATCH     SP6,PTHFHGRP
          GOTO      VCHF9000 IF EQUAL       * Blank health fund group, exit
.
          PACK      KEY6,PTHFHGRP
          CALL      RDPAHGP1                * Read the HGP file
          BRANCH    OVRCD,VCHF9000
          GOTO      VCHF9500
.
. ----- Option 3 - by claim code / health fund group -----
.
VCHF3000  MATCH     CLMCODE,ACLAIM
          GOTO      VCHF9500 IF NOT EQUAL   * Different claim code, error
.
          MATCH     SP6,GRPCODE
          GOTO      VCHF3100 IF EQUAL       * Blank health fund group code
.
          MATCH     SP6,AFUNDH
          IF        @EQUAL
            CALL      VALHFC00              * Work Cover, TAC or DVA instead
            BRANCH    EXIT,VCHF9500
            GOTO      VCHF9000
          ENDIF
.
          PACK      KEY14,AFUNDH,ZERO8,SP10
          CALL      RDFUND1                 * Read the health fund file
          BRANCH    OVRCD,VCHF9500
.
          MOVE      "02",KEY2               * check HF history for HF Group
          PACK      KEY17,AFUNDH,KEY2,DDATE,SP70
          CALL      PATDDHRD
.
          MOVE      "01",KEY2               * check HF history for HF equivalent
          PACK      KEY17,AFUNDH,KEY2,DDATE,SP70
          CALL      PATDDHRD
.
          MATCH     SP6,PTHFHGRP
          GOTO      VCHF9500 IF EQUAL       * Blank health fund group, error
.
          MATCH     GRPCODE,PTHFHGRP
          GOTO      VCHF9500 IF NOT EQUAL   * Different health fund group, error
.
          PACK      KEY6,PTHFHGRP
          CALL      RDPAHGP1                * Read the HGP file
          BRANCH    OVRCD,VCHF9500
.
          PACK      DRGFUND,AFUNDH,SP10     * Use health fund code
          MATCH     SP6,PTHFHCPE
          IF        !@EQUAL
            PACK      DRGFUND,PTHFHCPE,SP10 * Use HCP equilvalent
          ENDIF
          GOTO      VCHF9000
.
VCHF3100  MATCH     SP6,AFUNDH
          GOTO      VCHF9000 IF EQUAL       * Blank health fund, exit
.
          PACK      KEY14,AFUNDH,ZERO8,SP10
          CALL      RDFUND1                 * Read the health fund file
          BRANCH    OVRCD,VCHF9000
          GOTO      VCHF9000
.
. ----- Option 4 - patients to be extracted -----
.
VCHF4000  BRANCH    COPTION,VCHF4100,VCHF4300
          GOTO      VCHF9000
.
. ----- Detailed -----
.
VCHF4100  MATCH     SP6,GRPCODE
          GOTO      VCHF4200 IF EQUAL       * Blank health fund group code
.
          MATCH     SP6,AFUNDH
          GOTO      VCHF9500 IF EQUAL       * Blank health fund, error
.
          PACK      KEY14,AFUNDH,ZERO8,SP10
          CALL      RDFUND1                 * Read the health fund file
          BRANCH    OVRCD,VCHF9500
.
          MOVE      "02",KEY2               * check HF history for HF Group
          PACK      KEY17,AFUNDH,KEY2,DDATE,SP70
          CALL      PATDDHRD
.
          MATCH     SP6,PTHFHGRP
          GOTO      VCHF9500 IF EQUAL       * Blank health fund group, error
.
          MATCH     GRPCODE,PTHFHGRP
          GOTO      VCHF9500 IF NOT EQUAL   * Different health fund group, error
.
          PACK      KEY6,PTHFHGRP
          CALL      RDPAHGP1                * Read the HGP file
          BRANCH    OVRCD,VCHF9500
.
          PACK      HCPCODE,PTHFHGRP,SP10   * Use health fund group
          GOTO      VCHF9000
.
VCHF4200  MATCH     SP6,AFUNDH
          GOTO      VCHF9000 IF EQUAL       * Blank health fund, exit
.
          PACK      KEY14,AFUNDH,ZERO8,SP10
          CALL      RDFUND1                 * Read the health fund file
          BRANCH    OVRCD,VCHF9000
.
          MOVE      "02",KEY2               * check HF history for HF Group
          PACK      KEY17,AFUNDH,KEY2,DDATE,SP70
          CALL      PATDDHRD
.
          MATCH     SP6,PTHFHGRP
          GOTO      VCHF9000 IF EQUAL       * Blank health fund group, exit
.
          PACK      KEY6,PTHFHGRP
          CALL      RDPAHGP1                * Read the HGP file
          BRANCH    OVRCD,VCHF9000
          GOTO      VCHF9500
.
. ----- Summary -----
.
VCHF4300  MATCH     SP6,AFUNDH
          GOTO      VCHF9000 IF EQUAL       * Blank health fund, exit
.
          PACK      KEY14,AFUNDH,ZERO8,SP10
          CALL      RDFUND1                 * Read the health fund file
          BRANCH    OVRCD,VCHF9000
.
          MOVE      "02",KEY2               * check HF history for HF Group
          PACK      KEY17,AFUNDH,KEY2,DDATE,SP70
          CALL      PATDDHRD
.
          MATCH     SP6,PTHFHGRP
          GOTO      VCHF9000 IF EQUAL       * Blank health fund group, exit
.
          PACK      KEY6,PTHFHGRP
          CALL      RDPAHGP1                * Read the HGP file
          BRANCH    OVRCD,VCHF9000
.
          PACK      HCPCODE,PTHFHGRP,SP10   * Use health fund group
          GOTO      VCHF9000
.
VCHF9000  MOVE      ZERO,EXIT
          GOTO      VCHF9999
.
VCHF9500  MOVE      ONE,EXIT
VCHF9999  RETURN
+
.******************************************************************************
.*                                  LODT0000              Called by: EXTD0000 *
.*                              Load The Tempfile                             *
.******************************************************************************
LODT0000  MATCH     SP6,HCPCODE
          IF        @EQUAL
            MOVE      "zzzzzz",HCPCODE
          ENDIF
.
          MOVE      AADMNO,ADMISS
          MOVE      ACLAIM,CLMTYPE
          COMPARE   ONE,COPTION
          GOTO      LODT5000 IF NOT EQUAL   * Summary option
.
          PACK      KEY17,HCPCODE,CLMTYPE,ADMISS
          CALL      RATEMP1                 * Position read on the 1st tempfile
          IF        OVRCD=1
            CALL      WRTEMP1               * Write to the 1st tempfile
          ENDIF
          GOTO      LODT9000
.
LODT5000  PACK      KEY9,HCPCODE,CLMTYPE
          CALL      RDTEMP2                 * Read the 2nd tempfile
          IF        OVRCD=1
            MOVE      ONE,CLMCNT
            CALL      WRTEMP2               * Write to the 2nd tempfile
          ELSE
            ADD       ONE,CLMCNT
            CALL      UPTEMP2               * Update the 2nd tempfile
          ENDIF
.
LODT9000  MOVE      ZERO,EXIT
LODT9999  RETURN
+
.******************************************************************************
.*                                  CVAR0000              Called by: EXTD0000 *
.*                       Clear The Data For The HCP File                      *
.******************************************************************************
CVAR0000  UNPACK    SP100,DRGMEMBN,DRGADMN,DRGSNAME,DRGGNAME,DRGBDAT
          UNPACK    SP100,DRGPCODE,DRGSEX,DRGADAT,DRGDDAT,DRGHTYPE
          UNPACK    SP100,DRGICULS,DRGDRG,DRGVOGU,DRGATME,DRGADMTT,XARDRGVN
          UNPACK    SP100,DRGHRS,DRGPSYC,XDRGDRG,DRGASTAT
          UNPACK    SP100,DRGTRNFR,DRGSCAT,DRGASRC,DRGDSINT
          UNPACK    SP100,DRGCTRST,DRGLEGST,DRGPALLV,DRGREADM,DRGTHEVS
          UNPACK    SP100,DRGAWHT,DRGHMV,DRGSEP,DRGMSTAT
          UNPACK    SP100,DRGDTME,DRGDSCTT,DRGLDAYS,DRGNALOS,DRGTRNTO
          UNPACK    SP100,DRGDYHOM,DRGHIHDY,XDRGPORC,XDRGSCAT
          UNPACK    SP100,DRGDIAG,DRGSD01,DRGSD02,DRGSD03,DRGSD04
          UNPACK    SP100,DRGSD05,DRGSD06,DRGSD07,DRGSD08,DRGSD09
          UNPACK    SP100,DRGSD10,DRGSD11,DRGSD12,DRGSD13,DRGSD14
          UNPACK    SP100,DRGOPER,DRGSO01,DRGSO02,DRGSO03,DRGSO04
          UNPACK    SP100,DRGSO05,DRGSO06,DRGSO07,DRGSO08,DRGSO09
          UNPACK    SP100,DRGSO10,DRGSO11,DRGSO12,DRGSO13,DRGSO14
          UNPACK    SP100,DRGILOS,DRGPORCD,DRGPORDT,DRGPORTM
          PACK      DRGSMBS1,SP100,SP10
          CLEAR     DRGSMBS1
          PACK      DRGSMBS2,SP100
          CLEAR     DRGSMBS2
          PACK      XDRGSMB1,SP100,SP10
          CLEAR     XDRGSMB1
          PACK      XDRGSMB2,SP100
          CLEAR     XDRGSMB2
          UNPACK    SP100,DRGACCFE,DRGORFE,DRGLWFE,DRGICUFE,DRGPROFE
          UNPACK    SP100,DRGPHAFE,DRGOTHFE,DRGBUNFE
.
.         Clear ICD10 specific fields
.
          UNPACK    SP100,DRG10PDG,DRG10D01,DRG10D02,DRG10D03,DRG10D04:
                          DRG10D05,DRG10D06,DRG10D07,DRG10D08,DRG10D09:
                          DRG10D10,DRG10D11,DRG10D12,DRG10D13,DRG10D14:
                          DRG10D15,DRG10D16,DRG10D17,DRG10D18,DRG10D19
          UNPACK    SP100,DRG10PPR,DRG10P01,DRG10P02,DRG10P03,DRG10P04:
                          DRG10P05,DRG10P06,DRG10P07,DRG10P08,DRG10P09:
                          DRG10P10,DRG10P11,DRG10P12,DRG10P13
          UNPACK    SP100,DRG10P14,DRG10P15,DRG10P16,DRG10P17,DRG10P18,DRG10P19
.
.
.                                           * new variables for 2006  *I-105249
CVAR2006  UNPACK    SP100,DRG10D20,DRG10D21,DRG10D22,DRG10D23,DRG10D24:
                          DRG10D25,DRG10D26,DRG10D27,DRG10D28,DRG10D29:
                          DRG10D30,DRG10D31,DRG10D32,DRG10D33,DRG10D34
          UNPACK    SP100,DRG10D35,DRG10D36,DRG10D37,DRG10D38,DRG10D39:
                          DRG10D40,DRG10D41,DRG10D42,DRG10D43,DRG10D44:
                          DRG10D45,DRG10D46,DRG10D47,DRG10D48,DRG10D49
          UNPACK    SP100,DRG10P20,DRG10P21,DRG10P22,DRG10P23,DRG10P24:
                          DRG10P25,DRG10P26,DRG10P27,DRG10P28,DRG10P29
          UNPACK    SP100,DRG10P30,DRG10P31,DRG10P32,DRG10P33,DRG10P34:
                          DRG10P35,DRG10P36,DRG10P37,DRG10P38,DRG10P39
          UNPACK    SP100,DRG10P40,DRG10P41,DRG10P42,DRG10P43,DRG10P44:
                          DRG10P45,DRG10P46,DRG10P47,DRG10P48,DRG10P49
          UNPACK    SP100,DRGMRNUM,DRGMSC01,DRGMSC02,DRGMSC03,DRGMSC04:
                          DRGMSC05,DRGMSC06,DRGMSC07
          UNPACK    SP100,DRGMSC08,DRGMSC09,DRGMSC10,DRGHIHFF,DRGSCNFF:
                          DRGCCUFF,DRGSCNHR,DRGCCUHR,DRGSCNLS,DRGCCULS
          UNPACK    SP100,DRGNBQDY,DRGHIHBD,DRGHIHED,DRGHIHVD,DRGPALDY
.
          UNPACK    SP100,DRGACCFF,DRGORFF,DRGLWFF,DRGICUFF,DRGPROFF
          UNPACK    SP100,DRGPHAFF,DRGOTHFF,DRGBUNFF
.
          MOVE      ZERO,HADHIH
          MOVE      ZERO,HADICU
          MOVE      ZERO,HADCCU
          MOVE      ZERO,HADSCN
.
          UNPACK    SP100,XDRGPSYC,XDRG10PD,XDRGNBQD
          UNPACK    SP100,XDRG1D01,XDRG1D02,XDRG1D03,XDRG1D04:
                          XDRG1D05,XDRG1D06,XDRG1D07,XDRG1D08:
                          XDRG1D09,XDRG1D10,XDRG1D11,XDRG1D12:
                          XDRG1D13,XDRG1D14,XDRG1D15,XDRG1D16
.
          UNPACK    SP100,XDRG1D17,XDRG1D18,XDRG1D19,XDRG1D20:
                          XDRG1D21,XDRG1D22,XDRG1D23,XDRG1D24:
                          XDRG1D25,XDRG1D26,XDRG1D27,XDRG1D28:
                          XDRG1D29,XDRG1D30,XDRG1D31,XDRG1D32
.
          UNPACK    SP100,XDRG1D33,XDRG1D34,XDRG1D35,XDRG1D36:
                          XDRG1D37,XDRG1D38,XDRG1D39,XDRG1D40:
                          XDRG1D41,XDRG1D42,XDRG1D43,XDRG1D44:
                          XDRG1D45,XDRG1D46,XDRG1D47,XDRG1D48
          UNPACK    SP100,XDRG1D49
.
          IF        EXTRTYPE=2
            UNPACK    SP100,DRGADOCT
          ENDIF
.
CVAR9000  MOVE      ZERO,EXIT
CVAR9999  RETURN
+
.******************************************************************************
.*                                  GDAT0000              Called by: EXTD0000 *
.*                        Get The Data For The HCP File                       *
.******************************************************************************
GDAT0000  IF        OPTION<>5
            GOTO      GDAT0200
          ENDIF
.
          MOVE      CATSI,KEY3
          PACK      KEY5,ANSC,ANSL,ACLAIM
          CALL      RDCODE1                 * Cat."CL"
          BRANCH    OVRCD,GDAT0100
.
          MATCH     SP1,TCINDC5
          GOTO      GDAT0100 IF EQUAL       * Blank indicator
.
          TYPE      TCINDC5
          GOTO      GDAT0100 IF NOT EQUAL   * Non numeric indicator
.
          MOVE      ZERO,FORM1
          MOVE      TCINDC5,FORM1
          MOVE      CATOT,KEY3
          LOAD      KEY3,FORM1,CATIH,CATIN,CATSI,CATWC,CATTP:
                               CATCP,CATDV,CATDE,CATSE * Payer id
.
GDAT0100  MOVE      KEY3,DRGFUND            * Payer id for PHDB
.
GDAT0200  CALL      HFMN0000                * Get the health fund membership no
.
          IF        PTCNHDPS = 8
            MOVE      PURNO,DRGURNO
          ENDIF
.                                                                     *I-115102
          MOVE      PURNO,DIM10             * Medical Record No./UR No.
          SQUEEZE   DIM10
          PACK      DRGMRNUM,DIM10,SP20
.
          PACK      DRGADMN,AADMNO,SP20
          SQUEEZE   DRGADMN
          PACK      DRGADMN,DRGADMN,SP20
.
          IF        OPTION<>5
            PACK      DRGSNAME,PSNAME,SP70
            PACK      DRGGNAME,PGNAME,SP70
          ENDIF
.
          UNPACK    PBDATE,CCENT,CYEAR,CMON,CDAY
          PACK      DRGBDAT,CDAY,CMON,CCENT,CYEAR * DOB
.
          MOVE      PPOST,DRGPCODE          * Postcode
          MATCH     "UNKNOWN",PSUBRB                                *I-105249
          IF        @EQUAL
            MOVE      "9999",DRGPCODE
          ENDIF
          MATCH     "OS",PADD4
          IF        @EQUAL
            MOVE      "8888",DRGPCODE
          ENDIF
.
          MOVE      NINE,DRGSEX                  * default sex to 9
.
          PACK      KEY5,ANSG,SP1,PSEX,SP70
          CALL      RDCODE1
          BRANCH    OVRCD,GDAT0250
.
          MOVE      ZERO,F1
          MOVE      TCINDC3,F1                   * Sex Cat G ind 3 (TSK 0911056)
          MOVE      F1,DRGSEX
.
GDAT0250  MOVE      ZERO,FORM1
          MOVE      DRGSEX,FORM1                 * 1, 2, 3 or 9 valid
          IF        (FORM1<1 | FORM1>3) & (FORM1 <> 9)
            MOVE      "Invalid patient sex type               ",DIM40
            PACK      ERRMSG,DIM40,SP100
            CALL      ERR0000               * Print error
          ENDIF
.
          MOVE      "6",DRGMSTAT            * not stated/inadequately describe
          PACK      KEY5,ANSM,SP1,PMSTAT
          CALL      RDCODE1                 * Cat."M "
          IF        OVRCD<>1
            UNPACK    TCINDC2,DRGMSTAT      * Marital status
          ENDIF
.
          UNPACK    ADATE,CCENT,CYEAR,CMON,CDAY
          PACK      DRGADAT,CDAY,CMON,CCENT,CYEAR * Admission date
.
          UNPACK    ATIME,CHOUR,KEY1,CMIN
          PACK      DRGATME,CHOUR,CMIN      * Admission time
          REP       " 0",DRGATME
          MATCH     "0000",DRGATME
          IF        @EQUAL
            MOVE      "0001",DRGATME        * Zero admission time invalid
          ENDIF
.
          UNPACK    DDATE,CCENT,CYEAR,CMON,CDAY
          PACK      DRGDDAT,CDAY,CMON,CCENT,CYEAR * Discharge date
.
          UNPACK    DTIME,CHOUR,KEY1,CMIN
          PACK      DRGDTME,CHOUR,CMIN      * Discharge time
.
          MOVE      "9",DRGHTYPE            * Default
.
          COMPARE   ONE,IBCNMHOS
          GOTO      GDAT0300 IF NOT EQUAL   * not multi hospital
.
          PACK      KEY3,PMVXMHOS,SP70
          MATCH     SP70,PMVXMHOS
          GOTO      GDAT0300 IF EQUAL       * no hospital id
.
          CALL      RDPTHSP1
          BRANCH    OVRCD,GDAT0300
.
          MATCH     "0",PTHSHOST
          IF        @EQUAL
            MOVE      "2",DRGHTYPE          * Private hospital
          ELSE
            MATCH     "1",PTHSHOST
            IF        @EQUAL
              MOVE      "1",DRGHTYPE          * Public hospital
            ELSE
              MATCH     "2",PTHSHOST
              IF        @EQUAL
                MOVE      "3",DRGHTYPE          * Private Day
                CALL      CALC0000            * check 23 hour warning
.                IF        DOYR2024=1
                  CALL      CALT0000          * check 24 hour warning 
.                ENDIF
              ELSE
                MATCH     "3",PTHSHOST
                IF        @EQUAL
                  MOVE      "4",DRGHTYPE          * Public Day
.                  IF        DOYR2024=1
                    CALL      CALT0000        * check 24 hour warning 
.                  ENDIF
                ENDIF
              ENDIF
            ENDIF
          ENDIF
          GOTO      GDAT0400
.
GDAT0300  IF        CHOSTYP=0
            IF        PTCNDFIN=1
              MOVE      "3",DRGHTYPE        * Private Day
              CALL      CALC0000            * check 23 hour warning
.              IF        DOYR2024=1
                CALL      CALT0000          * check 24 hour warning
.              ENDIF
            ELSE
              MOVE      "2",DRGHTYPE        * Private hospital
            ENDIF
          ENDIF
          IF        CHOSTYP=1
            IF        PTCNDFIN=1
              MOVE      "4",DRGHTYPE        * Public Day
.              IF        DOYR2024=1
                CALL      CALT0000          * check 24 hour warning
.              ENDIF
            ELSE
              MOVE      "1",DRGHTYPE        * Public hospital
            ENDIF
          ENDIF
.
GDAT0400  CALL      CLOS0000                * Calculate LOS
          CALL      PLOS0000                * Calculat Palliative LOS
          CALL      GETDRG
          MOVE      DDRGCODE,DRGDRG
.
.....     MOVE      PTDSDDRG,DRGDRG         * DRG
          PACK      XDRGDRG,DDRGCODE,SP10   * DRG (DIM4)
          UNPACK    DRGVER,KEY1,DRGVOGU     * Version of grouper used  *I-90210
          PACK      KEY3,DRGVER,SP70
          IF        OPTION=5
            UNPACK    PTDSVOGU,KEY1,DRGVOGU * Version of grouper used for PHDB
            MOVE      PTDSDDRG,XDRGDRG
.---------- *T0889652 - for OPTION=5 use PTDSVOGU as the DRG version 
            PACK      KEY3,PTDSVOGU,SP70  * Save DRG Version      
          ENDIF
.
          MATCH     "62",DRGVOGU
          IF        @EQUAL
            MOVE      "6x",DRGVOGU
            MOVE      DRGVOGU,KEY3          * Save DRG Version      *T0889652
          ENDIF
.
          MATCH     "20190701",DDATE
          IF        @EQUAL | !@LESS
            MATCH     "100",KEY3
            IF        @EQUAL
              MOVE      "A0",DRGVOGU         * DRG Version 10.01
            ENDIF
          ENDIF
.
.-------- *T0889652 - new field XARDRGVN is created to send the AR DRG Version 
.-------- Number with 3 chars. DRGVOGU is inactive and to send spaces in the 
          CMATCH   "0",KEY3
          IF       @EQUAL
            UNPACK   KEY3,D1,DIM2       * Eliminate leading zero
            PACK     XARDRGVN,DIM2,SP1  * Left aligned version number
          ELSE
            MOVE     KEY3,XARDRGVN      
          ENDIF
          MOVE     SP70,DRGVOGU         * DRGVOGU inactive as only has 2 chars
.
GDAT0500  PACK      AGEDATE,ADATE
          CALL      CALCAGE                 * Calculate age
.                                                                     *C-105249
          IF        PSAGEDAY < PTCNBAGE
.             UNPACK    ABWGHT,DIM2,DRGAWHT * Admission weight
.             MATCH     SP4,DRGAWHT           
            MATCH     SP6,ABWGHT
            IF        @EQUAL
              CLEAR     DIM50
              APPEND    "Weight missing for patient under ",DIM50
              APPEND    PTCNBAGE,DIM50
              APPEND    " days",DIM50
              RESET     DIM50
              PACK      ERRMSG,DIM50,SP100
              CALL      ERR0000           * Print error
            ELSE    
.           If weight > 9000
.
              MOVE      ABWGHT,FORM6      
.
              IF        DOYR2025=1
                IF        FORM6 > 9999
                  MOVE      "0000",DRGAWHT
                  CLEAR     ERRMSG
                  APPEND    "Warning Birth Weight > 9999g, ",ERRMSG
                  APPEND    "extracting : 0000",ERRMSG
                  APPEND    SP70,ERRMSG
                  RESET     ERRMSG
                  CALL      ERR0000         * Print error
                ELSE
                  UNPACK    ABWGHT,D2,DIM4
                  MOVE      DIM4,FORM4
                  MOVE      FORM4,DRGAWHT
                ENDIF
              ELSE
                IF        FORM6 > 9000
                  MOVE      "0000",DRGAWHT
                  CLEAR     ERRMSG
                  APPEND    "Warning Birth Weight > 9000g, ",ERRMSG
                  APPEND    "extracting : 0000",ERRMSG
                  APPEND    SP70,ERRMSG
                  RESET     ERRMSG
                  CALL      ERR0000         * Print error
                ELSE
                  UNPACK    ABWGHT,D2,DIM4
                  MOVE      DIM4,FORM4
                  MOVE      FORM4,DRGAWHT
                ENDIF
              ENDIF 
.
            ENDIF
          ENDIF
.
.         ICU, CCU, SCN & Mech.Vent Hours   **********
.
GDAT0550  MOVE      AADMNO,KEY8
          CALL      RDPTICU1                * Read the patient ICU file
          IF        OVRCD<>1
            MOVE      PTICUINT,FORM4
            MOVE      FORM4,DRGHRS       * ICU hours
            MOVE      PTICUCCU,FORM4
            MOVE      FORM4,DRGCCUHR     * CCU hours               *I-105249
            MOVE      PTICHNCU,FORM4
            MOVE      FORM4,DRGSCNHR     * SCN/NCU hours           *I-105249
            MOVE      PTICUMEC,FORM4
            MOVE      FORM4,DRGHMV       * Hours on mechanical ventilation
.
            MOVE      ZERO,F5
            MOVE      PTICUINT,F5
            IF        F5 > 9999
              MOVE      "9999",DRGHRS   * ICU hours
              MOVE      "000",DRGICULS  * ICU length of stay
            ENDIF 
            MOVE      ZERO,F5
            MOVE      PTICUCCU,F5
            IF        F5 > 9999
              MOVE      "9999",DRGCCUHR * CCU hours
            ENDIF
            MOVE      ZERO,F5           * If mech vent hours exceed
            MOVE      PTICUMEC,F5       * 9999 hrs then only report 9999 hrs
            IF        F5>9999
              MOVE      "9999",DRGHMV   * Hours on mechanical ventilation
            ENDIF
          ENDIF
.
.         Admission status/Urgency Status   **********
.
          MOVE      "9",DRGASTAT          * default - Not Known/Not Reported
.
. CAR  320381 Use category KC if it has been completed, otherwise category P
.
          MATCH     SP3,PMVXELPS
          IF        !@EQUAL
            PACK      KEY5,ANSK,ANSC,PMVXELPS,SP70
            CALL      RDCODE1               * Cat."KC"
            IF        OVRCD <> 1
              UNPACK    THCSCOD,DRGASTAT * Admission status
              GOTO      GDAT0560
            ENDIF
          ENDIF
.
          MATCH     SP3,ACLSS
          IF        !@EQUAL
            PACK      KEY5,ANSP,SP1,ACLSS
            CALL      RDCODE1               * Cat."P "
            IF        OVRCD <> 1
              UNPACK    THCSCOD,DIM2,DRGASTAT,DIM1 * Admission status  *C-53371
              MATCH     SP1,DRGASTAT
              IF        @EQUAL
                MOVE      DIM1,DRGASTAT                                *I-53371
              ENDIF
            ENDIF
          ENDIF
.
.         Service category / Care Type      **********
.
GDAT0560  MATCH     SP3,ACARE
          IF        !@EQUAL
            PACK      KEY5,ANSC,ANSC,ACARE
            CALL      RDCODE1               * Cat."CC"
            IF        OVRCD <> 1
              MOVE      TCINDC9,DRGSCAT
              MOVE      PTCDNHCP,XDRGSCAT
.----------- *T0889652 - Use User Defined Field 4 from 01/07/2020
              MOVE      PTCDUDF4,XDRGSCAT     * User Defined field 4 
              SQUEEZE   XDRGSCAT
            ENDIF
          ENDIF
.
.         Source of referral                **********
.
          MOVE      "9",DRGASRC             * default to Other
          MATCH     SP3,ASRCE
          IF        !@EQUAL
            PACK      KEY5,ANSS,SP1,ASRCE
            CALL      RDCODE1               * Cat."S "
            IF        OVRCD <> 1
              UNPACK    TCINDC3,DRGASRC     * source of referral
            ENDIF
          ENDIF
.
.         Discharge intention (optional field) **********
.
          PACK      KEY5,ANSK,ANSN,PMVXUDIN 
          CALL      RDCODE1                 * Cat."KN"
          IF        OVRCD = 0
            UNPACK    THCSCOD,DRGDSINT      * Discharge Intention
          ENDIF
.
.         Contract status on admission      **********
.
          MOVE      "9",DRGCTRST            * default to "9"
          MATCH     SP3,ASRCE
          IF        !@EQUAL
            PACK      KEY5,ANSS,SP1,ASRCE
            CALL      RDCODE1               * Cat."S "
            IF        OVRCD = 0
.------------ *T0889652 - Use Cat S ind14 
              MOVE      TCINDC14,DRGCTRST
            ENDIF
          ENDIF
.
.         Mental health legal status        **********
.
.         COMPARE   ONE,MHCNUSE                                        *I-53371
.         IF        @EQUAL
            CALL      GMLS0000              * get DRGLEGST from Cat."LS"
.         ELSE
.                                           * otherwise get DRGLEGST from other
.           IF        PTCNCSTA = 6
.             PACK      KEY5,CATCC,ACARE
.             CALL      RDCODE1             * Cat."CC"
.             IF        OVRCD<>1
.               UNPACK    THCSCOD,DRGLEGST  * mental health legal status
.             ENDIF
.           ELSE                               
.             LOAD      ACODE,PTCNCSTA,DUSD1,DUSD2,DUSD3,DUSD4,DUSD5
.             MATCH     SP3,ACODE
.             IF        !@EQUAL
.               PACK      KEY5,ANSD,PTCNCSTA,ACODE
.               CALL      RDCODE1             * Cat."Dn"
.               IF        OVRCD <> 1
.                 UNPACK    THCSCOD,DRGLEGST  * mental health legal status
.               ENDIF
.             ENDIF
.           ENDIF 
.         ENDIF 
.
.         Palliative care status    *********
.
GDAT0600  MATCH     SP70,PMVXPALC
          IF        !@EQUAL
            PACK      KEY5,ANSK,ANSG,PMVXPALC
            CALL      RDCODE1                 * Cat."KG"
            IF        OVRCD<>1
              UNPACK    THCSCOD,DRGPALLV      * Palliative care status alternat
            ENDIF
          ENDIF
.******************************************** start of addition       *I-114731
          MATCH     SP1,DRGPALLV            * default to "2" if blank (for 2006)
          IF        @EQUAL
            MOVE      "2",DRGPALLV
          ENDIF
.********************************************   end of addition       *I-114731
.
.         Re-admission in 28 Days    **********
.
GDAT0700  PACK      KEY5,ANSK,ANSO,PMVXUREA
          CALL      RDCODE1                 * Cat."KO"
          IF        OVRCD<>1
            UNPACK    PTCDNHCP,DRGREADM   * unplanned readmission alternate
          ENDIF
.******************************************** start of addition       *I-114698
.
GDAT0705  MATCH     SP1,DRGREADM         * default to "8" if blank (for 2006)
          IF        @EQUAL
            MOVE      "8",DRGREADM
          ENDIF
.********************************************   end of addition       *I-114698
.
.         Unplanned Theatre Visit           **********
.
          PACK      KEY5,ANSK,ANSB,PMVXUVTH
          CALL      RDCODE1                 * Cat."KB"
          IF        OVRCD<>1
            UNPACK    THCSCOD,DRGTHEVS      * unplanned readmission alternate
          ENDIF
.                                                        * added      *I-111104
          CMATCH    SP1,DRGTHEVS
          GOTO      GDAT0800 IF NOT EQUAL
          MOVE      "2",DRGTHEVS            * not used - set "No Unplanned Vis."
.                                                        * end        *I-111104
.
.         Transfer from and to              **********
.
GDAT0800  PACK      KEY8,AADMNO
          CALL      RDPTDAD1                * Read PATDADFD
          BRANCH    OVRCD,GDAT1000          * no transfers either way
.
          MATCH     SP3,ASRCE
          IF        !@EQUAL
            PACK      KEY5,ANSS,SP1,ASRCE,SP70
            CALL      RDCODE1               * Cat."S "
            IF        OVRCD = 0
              MATCH     "2",TCINDC3
              GOTO      GDAT0900 IF EQUAL
            ENDIF
          ENDIF
.
          MATCH     SP70,PTDAADTS
          IF        !@EQUAL
            MOVE      SP20,PTVAPROV
            PACK      KEY5,PTDAADTS,SP70
            CALL      RDPTVAD1              * get the Provider No.
            MATCH     SP20,PTVAPROV
            IF        !@EQUAL
              PACK      DRGTRNFR,PTVAPROV,SP20   * Hospital Transferred from
            ELSE
.                                         * test for "Admitted Patient Trans"
              MATCH     "1",DRGASRC       * Source of Referral      *I-242229
              IF        @EQUAL
                PACK      ERRMSG,ERRMSG17,SP1,PTDAADTS,SP100
                CALL      ERR0000         * Print error
                GOTO      GDAT0900
              ENDIF
.
.------------ *T0889652 - Check if source of transfer is 4 - Transferred from
.------------ another accident and emergency facility 
              MATCH     "4",DRGASRC
              IF        @EQUAL
                PACK      ERRMSG,ERRMSG17,SP1,PTDAADTS,SP100
                CALL      ERR0000          * Print error
                GOTO      GDAT0900
              ENDIF
            ENDIF
          ENDIF
.
.                                           * check if Destination is Hospital
GDAT0900  MOVE      SP1,TCINDC2
          IF        PTCNDTRF = 1
            PACK      KEY5,ANSD,SP1,DSTAT
            CALL      RDCODE1               * Cat."D "
          ELSE
            PACK      KEY5,ANSD,ANSD,DDEST
            CALL      RDCODE1               * Cat."DD"
          ENDIF
          BRANCH    OVRCD,GDAT1000
          MATCH     "1",TCINDC2             * is it a hospital ?
          GOTO      GDAT1000 IF NOT EQUAL
.
.                                           * Destination is another Hospital
...T0950  MATCH     "5",TCINDC5                                       *D-212648
...       GOTO      GDAT1000 IF EQUAL
.                                                                     *I-212648
GDAT0950  MATCH     "1",TCINDC5             * "1" = Transfer to Acute Hospital
          GOTO      GDAT0960 IF EQUAL       * reclassified, ignore
.
          MATCH     "3",TCINDC5         
          GOTO      GDAT0960 IF EQUAL
          GOTO      GDAT1000
.
GDAT0960  MATCH     SP10,PTDADCTS
          GOTO      GDAT1000 IF EQUAL
.
          MOVE      SP20,PTVAPROV
          PACK      KEY5,PTDADCTS,SP70
          CALL      RDPTVAD1
          MATCH     SP20,PTVAPROV
          IF        !@EQUAL   
            PACK      DRGTRNTO,PTVAPROV,SP20   * Hospital Transferred from
          ELSE
.                                         * test for "Admitted Patient Trans"
            MATCH     "1",DRGASRC         * Source of Referral    *I-242229
            IF        @EQUAL 
              PACK      ERRMSG,ERRMSG17,SP1,PTDADCTS,SP100
              CALL      ERR0000           * Print error
            ENDIF
.
          ENDIF
.
.         Seperation Mode                   **********
.
GDAT1000  MOVE      "9",TCINDC5             * Default to "Home/Other"
          MOVE      CATDD,TCODE             * Default
          LOAD      TCODE,PTCNDRSM,CATD,CATDD
.
          MOVE      DDEST,ACODE             * Default
          LOAD      ACODE,PTCNDRSM,DSTAT,DDEST
          MATCH     SP3,ACODE
          GOTO      GDAT2000 IF EQUAL       * No seperation mode code
.
          PACK      KEY5,TCODE,ACODE
          CALL      RDCODE1                 * Cat."D " or Cat."DD"
          BRANCH    OVRCD,GDAT2000
.
          IF        DOYR2025=1
.           User defined 3 is 10 characterlong so just get 2 character from it
            UNPACK    PTCDUDF3,VALSEPMD,DIM8     
            TYPE      VALSEPMD
            GOTO      GDAT2000 IF NOT EQUAL   * Valid separation mode indicator
.
            RJUSTIFY  VALSEPMD             
            REP       " 0",VALSEPMD
            GOTO      GDAT2200 
.
          ELSE
            TYPE      TCINDC5
            GOTO      GDAT2000 IF NOT EQUAL   * Valid separation mode indicator
.
            MATCH     "0",TCINDC5             * "0" is invalid
            GOTO      GDAT2200 IF NOT EQUAL 
          ENDIF
.
GDAT2000  PACK      ERRMSG,ERRMSG06,SP1,ACODE,SP100
          CALL      ERR0000                 * Print error
.
GDAT2200  IF        DOYR2025=1
            PACK      DRGSEP,VALSEPMD         * Separation mode
          ELSE 
            PACK      DRGSEP,ZERO,TCINDC5     * Separation mode
          ENDIF 
.
GDAT3000  CALL      DISE0000                * Get the disease codes
          CALL      OPER0000                * Get the operation codes
          CALL      PATGILOS                * Get intended LOS         D-115102
          MOVE      KEY1,DRGILOS
          CALL      MMBS0000                * MBS codes
          CALL      FEES0000                * Calculate the fees
.
.         Now check if the Principal CMBS Procedure Code (DRGPORCD) is blank;
.         If so use the first Miscellaneous Service Code (DRGMSC01) Date & Time
.         for the Principal CMBS Procedure Date/Time.
.
          MATCH     SP70,DRGPORCD           * Principal CMBS Proc Code exists?
          GOTO      GDAT4000 IF NOT EQUAL   * skip
.
          MATCH     SP70,DRGMSC01           * no Miscellaneous Service Code?
          GOTO      GDAT4000 IF EQUAL       * skip
.
          MOVE      DRGMSC01,KEY9
          MOVE      ONE,KEY3
          RJUSTIFY  KEY3
          PACK      KEY20,KEY9,AADMNO,KEY3,SP20
          CALL      RDMMBS2
          BRANCH    OVRCD,GDAT4000
.
          UNPACK    MMDATE,CCENT,CYEAR,CMON,CDAY
          PACK      DRGPORDT,CDAY,CMON,CCENT,CYEAR
          REP       " 0",DRGPORDT           * MBS date from ICD9 oper date
.
          MOVE      MMSTIM,STRTTME5
          MOVE      MMETIM,ENDTME5
          CALL      CTIM0000                * Calculate start & end time
          COMPARE   ZERO,TIME4
          IF        !@EQUAL
            MOVE      TIME4,DRGPORTM
            REP       " 0",DRGPORTM         * MBS operation time
          ENDIF
.
GDAT4000
.
.******************************************** start of addition       *I-105249
.                                           * new variables for 01/07/2006
.                                           * No. of Qualified Days for Newborn
..        See       DRGNBQDY in CLOS0000
.                                           * Palliative Care Days
..        See       DRGPALDY in CLOS0000
.********************************************   end of addition       *I-105249
.
          IF        EXTRTYPE=2
             MOVE      ADOCTA,DRGADOCT      * Attending Doctor for HEC
          ENDIF
.
GDAT9000  MOVE      ZERO,EXIT
GDAT9999  RETURN
+
.******************************************************************************
.*                                  GMLS0000              Called by: GDAT0000 *
.*                      Get legal status from mehlegaf               *I-53371 *
.******************************************************************************
GMLS0000  PACK       KEY21,AADMNO,ZED30
          CALL       RSMHLEG1
          CALL       RPMHLEG1
          MATCH      AADMNO,MHLEADMN
          IF         @EQUAL
            PACK        KEY5,ANSL,ANSS,MHLESTAT
            CALL        RDCODE1          * Cat."LS"
            IF          OVRCD <> 1
              MOVE        PTCDNHCP,DRGLEGST
              MATCH        "20190701",DDATE
              IF           @EQUAL | !@LESS
                MOVE         PTCDUDF3,DRGLEGST     * User Defined field 3
              ENDIF
            ENDIF
          ELSE 
            MATCH       SP70,PMVXMHLS
            IF          !@EQUAL
              PACK        KEY5,ANSL,ANSS,PMVXMHLS                     *I-53371
              CALL        RDCODE1          * Cat."LS"
              IF          OVRCD <> 1
                MOVE        PTCDNHCP,DRGLEGST
                MATCH        "20190701",DDATE
                IF           @EQUAL | !@LESS
                  MOVE         PTCDUDF3,DRGLEGST     * User Defined field 3
                ENDIF
              ENDIF
            ENDIF
.
            MATCH       "20190701",DDATE
            IF          @EQUAL | !@LESS
              REP         " 9",DRGLEGST
            ELSE
              REP         " 8",DRGLEGST
            ENDIF
          ENDIF
.
GMLS1000  PACK      KEY32,AURNO,Z70
          CALL      RSMHDLS1
          CALL      RPMHDLS1
          BRANCH    OVRCD,GMLS9000
.
          MATCH     AURNO,MHDLURNO
          GOTO      GMLS9000 IF NOT EQUAL
.
          MATCH     SP70,MHDLEDAT
          GOTO      GMLS5000 IF EQUAL
          GOTO      GMLS5000 IF EOS
.
          MATCH     DDATE,MHDLEDAT
          GOTO      GMLS9000 IF LESS
.
GMLS5000  MATCH     SP70,MHDLSCOD
          GOTO      GMLS9000 IF EQUAL
          GOTO      GMLS9000 IF EOS
.
          MATCH     SP70,MHDLSCOD
          IF        !@EQUAL
            PACK      KEY5,ANSL,ANSS,MHDLSCOD,SP70
            CALL      RDCODE1
            IF        OVRCD<>1
              MOVE      PTCDNHCP,DRGLEGST
              MATCH     "20190701",DDATE
              IF        @EQUAL | !@LESS
                MOVE       PTCDUDF3,DRGLEGST     * User Defined field 3
              ENDIF
            ENDIF
          ENDIF
.
GMLS9000  MATCH       "20190701",DDATE
          IF          @EQUAL | !@LESS
            REP       " 9",DRGLEGST
          ELSE
            REP       " 8",DRGLEGST
          ENDIF
.
GMLS9999  RETURN
+
.******************************************************************************
.*                                  HFMN0000              Called by: GDAT0000 *
.*                      Get The Health Fund Membership No                     *
.******************************************************************************
HFMN0000  COMPARE   FIVE,OPTION    * PHDB does not send member number
          IF        @EQUAL
            PACK      DRGMEMBN,SP70
            GOTO      HFMN9000
          ENDIF
.
.....     COMPARE   THREE,OPTION
.....     GOTO      HFMN3000 IF NOT EQUAL   * Not by claim code/HFG
.
          MATCH     SP3,ACLAIM
          GOTO      HFMN3000 IF EQUAL       * Blank claim code
.
          PACK      KEY5,ANSC,ANSL,ACLAIM
          CALL      RDCODE1                 * Cat."CL"
          BRANCH    OVRCD,HFMN3000
.
          COMPARE   EXTRTYPE,TWO            * HEC extract?
          GOTO      HFMN0020 IF EQUAL       * Yes; skip next part
.
          PACK      DIM5,TCINDC1,TCINDC2,TCINDC3,TCINDC4,TCINDC5,SP70
          SCAN      "W",DIM5                     * Work Cover patient?
          IF        @EQUAL
            PACK      KEY8,DADMNO,SP70
            CALL      RDWCOM1
            BRANCH    OVRCD,HFMN0010
.
            PACK      DRGMEMBN,WCCLMNO,SP70      * use WC Insurance Claim No.
            GOTO      HFMN9000
          ENDIF
.
HFMN0010  SCAN      "M",DIM5                     * TAC patient?
          IF        @EQUAL
            PACK      KEY8,DADMNO,SP70
            CALL      RDWMAB1
            BRANCH    OVRCD,HFMN0020
.
            PACK      DRGMEMBN,MREFNO,SP70       * use M.A.B Reference No.
            GOTO      HFMN9000
          ENDIF
.
HFMN0020  MOVE      ONE,FORM1
HFMN1000  COMPARE   FORM1,FIVE
          GOTO      HFMN3000 IF LESS
.
          MOVE      SP1,KEY1
          LOAD      KEY1,FORM1,TCINDC1,TCINDC2,TCINDC3,TCINDC4,TCINDC5
          MATCH     ANSV,KEY1
          GOTO      HFMN2000 IF EQUAL       * Veterian affairs patient
.
          ADD       ONE,FORM1
          GOTO      HFMN1000
.
.         Get DVA Number using concession card details
.         compares Expiry Date to inpatient Visit Date
HFMN2000  MOVE      THREE,DIM1              * set for DVA card type
.         CALL      GCCARD00                * Replacing for 0843392
.
          PACK      KEY19,PURNO,SP70
          CALL      RSPMCCD1
HFMN2050  CALL      RKPMCCD1
          BRANCH    OVRCD,HFMN2080
.
          MATCH     PURNO,PMCDURNO          * Same U/R Still ?
          GOTO      HFMN2080 IF NOT EQUAL   * No Nothing Found
.
.         Check if the card type is DVA (Cat ct, Indicator 3)
.
          MOVE      "ct",DIM2
          PACK      KEY5,DIM2,PMCDCTYP
          CALL      RDCODE1                 * Code on file ?
          BRANCH    OVRCD,HFMN2050          * No Ignore Record
.
          MATCH     DIM1,TCINDC1            * Same Card Type ?
          GOTO      HFMN2050 IF NOT EQUAL   * No Ignore Record
.
.         Check if an Expiry Date exists for Consession card
.
          MATCH     SP8,PMCDEXDT            * Expiry Date Blank ?
          GOTO      HFMN2100 IF EQUAL       * Yes Assume Valid
.
.         There is expiry date, compare it with Visit Date
.
          MATCH     ADATE,PMCDEXDT          * Card Valid For Date ?
          GOTO      HFMN2050 IF LESS        * No Ignore Record
.
          GOTO      HFMN2100                * Yes Assume Valid
.
.         Blank out Consession Card values (Nothing Found)
.
HFMN2080  MOVE      SP70,PMCDCNUM
          MOVE      SP70,PMCDCTYP
          MOVE      SP70,PMCDEXDT
          MOVE      SP70,PMCDDVAC
.
.         Report an Error if the Concession Card is blank
.
HFMN2100  PACK      DRGMEMBN,PMCDCNUM,SP70
          MATCH     SP20,DRGMEMBN
          IF        @EQUAL
            PACK      ERRMSG,ERRMSG04,SP100
            CALL      ERR0000               * Print error
          ENDIF
          GOTO      HFMN9000
.
HFMN3000  PACK      DRGMEMBN,PMVXFNDM,SP70
          MATCH     SP6,GRPCODE
          IF        !@EQUAL
            MATCH     SP20,DRGMEMBN
            IF        @EQUAL
              PACK      ERRMSG,ERRMSG05,SP100
              CALL      ERR0000             * Print error
            ENDIF
          ENDIF
.
HFMN9000  MOVE      ZERO,EXIT
HFMN9999  RETURN
+
.******************************************************************************
.*                                  RJUS0000              Called by: GDAT0000 *
.*                            Right Justify The Code                          *
.******************************************************************************
RJUS0000  PACK      RJUSCODE,SP100
          RESET     LJUSCODE,JUSTNO
          MOVE      ZERO,CHRCOUNT
RJUS1000  CMATCH    SP1,LJUSCODE
          GOTO      RJUS2000 IF NOT EQUAL
.
          ADD       ONE,CHRCOUNT
          BUMP      LJUSCODE,-1
          GOTO      RJUS2000 IF EOS
.
          COMPARE   JUSTNO,CHRCOUNT
          GOTO      RJUS1000 IF LESS
.
RJUS2000  RESET     LJUSCODE
          CLEAR     RJUSCODE
          RESET     RJUSCODE,CHRCOUNT
          APPEND    LJUSCODE,RJUSCODE
          RESET     RJUSCODE
.
RJUS9000  MOVE      ZERO,EXIT
RJUS9999  RETURN
+
.******************************************************************************
.*                                  CLOS0000              Called by: GDAT0000 *
.*                     Calculate The LOS For This Patient                     *
.******************************************************************************
CLOS0000  MOVE      ZERO,WORKALOS           * Reset acute LOS
          MOVE      ZERO,WORKNLOS           * Reset non-acute LOS
          MOVE      ZERO,WORKICLS           * Reset ICU LOS
          MOVE      ZERO,WORKCCLS           * Reset CCU LOS           *I-105249
          MOVE      ZERO,WORKSCLS           * Reset SCN LOS           *I-105249
          MOVE      ZERO,WORKBABY           * Reset Qual Baby days    *I-105249
          MOVE      ZERO,WORKPSYC           * Reset psychiatric LOS
          MOVE      ZERO,WORKLDAY           * Reset leave days
          MOVE      ZERO,WORKHDAY           * Reset Outreach (HIH) days
          MOVE      ZERO,WORKHHDY           *  Outreach (HIH) days    *I-115867
          MOVE      ZERO,WORKHIHV           * Outreach (HIH) Vis days *I-105249
          MOVE      SP10,STRLTYP            * Initialise leave type
.
. ----- Daycase -----
.
CLOS0100  MATCH     ADATE,DDATE
          IF        @EQUAL
            MOVE      ONE,WORKALOS
            MOVE      ZERO,WORKNLOS
            PACK      KEY30,AADMNO,ZED30
            CALL      RDSTRAN2              * Position on & read the transfer
            CALL      RDPTRAN2                file
            IF        OVRCD=0
              MATCH     AADMNO,TADMN
              GOTO      CLOS8000 IF NOT EQUAL
.
              MOVE      TATYPE,ADMTYPE
              MOVE      TRBTYP,BEDTYPE
.
              CALL      CHKC0000            * Check a stay in a ICU/CCU/SCN
.                                           * EXIT value - 1=ICU 2=CCU 3=SCN
              IF        EXIT > 0
                STORE     ONE,EXIT,WORKICLS,WORKCCLS,WORKSCLS         *I-105249
                MOVE      ZERO,EXIT
              ENDIF
.
              CALL      CPSY0000            * Check for psychiatric
              IF        EXIT = 0
                MOVE      ONE,WORKPSYC
                MOVE      ZERO,EXIT
              ENDIF
.
CLOS0200      CALL      CHIH0000            * check Outreach (HIH) stay
              IF        EXIT = 1
                MOVE      ONE,WORKHDAY      
                MOVE      ONE,WORKHHDY      
                UNPACK    ADATE,CCENT,CYEAR,CMON,CDAY                 *I-105249
                PACK      DRGHIHBD,CDAY,CMON,CCENT,CYEAR              *I-105249
                MOVE      DRGHIHBD,DRGHIHED                           *I-105249
....            IF        PSYCFLAG = 0                                *D-219801
                  MOVE      ONE,WORKHIHV    * set Outreach Visit days 
....            ENDIF                                                 *D-219801
                MATCH     ADATE,DDATE
                IF        @EQUAL
....              ADD       ONE,WORKHHDY
                ENDIF
                MOVE      ZERO,EXIT
              ENDIF
.               
              CALL      CBBY0000            * Check for Qual Baby     *I-105249
              IF        EXIT = 1
                MOVE      ONE,WORKBABY
                MOVE      ZERO,EXIT         
              ENDIF     
.               
            ENDIF
.
            GOTO      CLOS8000
          ENDIF
.
. ----- Non Daycase -----
.
          PACK      KEY30,AADMNO,SP20
          CALL      RDSTRAN2                * Position on & read the transfer
CLOS1000  CALL      RDKTRAN2                  file
          BRANCH    OVRCD,CLOS7000
.
          MATCH     AADMNO,TADMN
          GOTO      CLOS7000 IF NOT EQUAL
.
          CMATCH    ANSA,TMOVE
          GOTO      CLOS2000 IF EQUAL       * Admission record
.
          CMATCH    ANSL,TMOVE
          GOTO      CLOS3000 IF EQUAL       * Leave record
.
          CMATCH    ANSR,TMOVE
          GOTO      CLOS4000 IF EQUAL       * Return from leave record
.
          CMATCH    ANSC,TMOVE
          GOTO      CLOS5000 IF EQUAL       * Change record
.
          CMATCH    ANSD,TMOVE
          GOTO      CLOS6000 IF EQUAL       * Discharge record
.
          GOTO      CLOS5000                * Assume change record
.
. ----- Admission Record -----
.
CLOS2000  CALL      LSAV0000                * Save details
          GOTO      CLOS1000
.
. ----- Leave Record -----
.
CLOS3000  CALL      LEND0000                * Process end of a period
          GOTO      CLOS1000
.
. ----- Return Record -----
.
CLOS4000  CALL      LDAY0000                * Calculate the leave days
          CALL      LSAV0000                * Save details
          GOTO      CLOS1000
.
. ----- Change Record -----
.
CLOS5000  CALL      LEND0000                * Process end of a period
          CALL      LSAV0000                * Save new details
          GOTO      CLOS1000
.
. ----- Discharge Record -----
.
CLOS6000  CALL      LEND0000                * Process end of a period
          GOTO      CLOS8000
.
. ----- Error -----
.
CLOS7000  MOVE      DDATE,TDATE             * Assume discharge date
          CALL      LEND0000                * Process end of a period
.
. ----- Finished -----
.
CLOS8000  MOVE      WORKNLOS,DRGNALOS       * Non-acute LOS
          MOVE      WORKICLS,DRGICULS       * ICU LOS
          MOVE      WORKCCLS,DRGCCULS       * CCU LOS                 *I-105249
          MOVE      WORKSCLS,DRGSCNLS       * SCN LOS                 *I-105249
          MOVE      WORKBABY,F4             * change F5 to F4
          MOVE      F4,DRGNBQDY             * Qual Baby days
          MOVE      WORKLDAY,DRGLDAYS       * Total leave days
          MOVE      WORKHDAY,DRGDYHOM       * Home (HIH) days
          MOVE      WORKHHDY,DRGHIHDY       * Outreach (HIH) days     *I-105249
          MOVE      WORKHIHV,DRGHIHVD       * Outreach (HIH) Vis days *I-105249
          MOVE      WORKPSYC,F3             * change F5 to F3
          MOVE      F3,DRGPSYC              * Psychiatric LOS
.
          MOVE      WORKBABY,XDRGNBQD     * Qualified days for Newborns
          MOVE      WORKPSYC,XDRGPSYC     * Total Psychiatric Care Days
.
CLOS9000  MOVE      ZERO,EXIT
CLOS9999  RETURN
+
.******************************************************************************
.*                                  PLOS0000              Called by: GDAT0000 *
.*                     Calculate The LOS For This Patient                     *
.******************************************************************************
PLOS0000  MOVE      ZERO,WORKPLOS           * Reset palliative LOS
          PACK      SAVFDATE,ADATE,SP70
          PACK      KEY24,DAADMNO,SP70
          CALL      RDSCHCO1
PLOS1000  CALL      RDKCHCO1
          BRANCH    OVRCD,PLOS5000
.
          MATCH     DAADMNO,DCHADMN
          GOTO      PLOS5000 IF NOT EQUAL
.
          MATCH     "CC",CHCATG
          GOTO      PLOS1000 IF NOT EQUAL
.
          PACK      CDYSFDTE,SAVFDATE       * All palliative care days
          PACK      SAVFDATE,CHDATE
.
          PACK      KEY5,ANSC,ANSC,CHCODE,SP70
          CALL      RDCODE1
          BRANCH    OVRCD,PLOS1000
.
          MOVE      ZERO,FORM3
          SQUEEZE   PTCDNHCP
          MOVE      PTCDNHCP,FORM3
          IF        FORM3<30 | FORM3>33
            GOTO      PLOS1000              * Not palliative care stay
          ENDIF
.
          PACK      CDYSTDTE,CHDATE
          MATCH     CHDATE,ENDDTE8
          IF        @LESS
            PACK      CDYSTDTE,ENDDTE8
          ENDIF
          CALL      PALD0000             * Days in palliative care with no leave
          ADD       CDYSDAYS,WORKPLOS
          GOTO      PLOS1000
.
PLOS5000  PACK      KEY5,ANSC,ANSC,ACARE,SP70
          CALL      RDCODE1
          BRANCH    OVRCD,PLOS9000
.
          MOVE      ZERO,FORM3
          SQUEEZE   PTCDNHCP
          MOVE      PTCDNHCP,FORM3
          IF        FORM3>29 & FORM3<34
            MATCH     SP1,DRGPALLV          * default to "2" if blank (for 2006)
            IF        @EQUAL
              MOVE      "1",DRGPALLV
            ENDIF
            GOTO      PLOS6000              * Palliative care days
          ELSE
            GOTO      PLOS9000              * Not palliative care days
          ENDIF
.
PLOS6000  PACK      CDYSFDTE,SAVFDATE       * Calculate palliative care days
          PACK      CDYSTDTE,DDATE
          MATCH     DDATE,ENDDTE8
          IF        @LESS
            PACK      CDYSTDTE,ENDDTE8
          ENDIF
          CALL      PALD0000             * Days in palliative care with no leave
          MOVE      CDYSDAYS,WORKPLOS
          GOTO      PLOS9000
.
PLOS9000  MOVE      WORKPLOS,DRGPALDY
PLOS9999  RETURN
+
.******************************************************************************
.*                                  PALD0000              Called by: CLOS0000 *
.*         Calculate days in palliative care with no leave days               *
.******************************************************************************
PALD0000  MOVE      CDYSFDTE,FROMDATE
          MOVE      CDYSTDTE,TODATE
          CALL      NHOSPDAY                 * LOS with no leave
          MOVE      NBRDAYS,CDYSDAYS
PALD9999  RETURN
+
.******************************************************************************
.*                                  LSAV0000              Called by: CLOS0000 *
.*         Save Start Of Period Details For Length Of Stay Calculations       *
.******************************************************************************
LSAV0000  PACK      CDYSFDTE,TDATE
          MOVE      TATYPE,STATYPE
          MOVE      TRBTYP,STRBTYP
LSAV9000  MOVE      ZERO,EXIT
LSAV9999  RETURN
+
.******************************************************************************
.*                                  LEND0000              Called by: CLOS0000 *
.*              Process End Of Period Details For Length Of Stay              *
.******************************************************************************
LEND0000  PACK      CDYSTDTE,TDATE
          MATCH     CDYSTDTE,CDYSFDTE
          GOTO      LEND8000 IF NOT LESS
.
          CALL      CALCDAYS                * Calculate diff between dates
          SUB       ONE,CDYSDAYS            * We dont want inclusive dates
          ADD       CDYSDAYS,WORKALOS       * Acute LOS
          MOVE      STATYPE,ADMTYPE
          MOVE      STRBTYP,BEDTYPE
.
          CALL      CHKC0000                * Check if stay in a ICU
.                                                                     *C-105249
          IF        EXIT > 0
            MOVE      ZERO,FORM3            * EXIT value - 1=ICU 2=CCU 3=SCN
            LOAD      FORM3,EXIT,WORKICLS,WORKCCLS,WORKSCLS
            ADD       CDYSDAYS,FORM3
            STORE     FORM3,EXIT,WORKICLS,WORKCCLS,WORKSCLS
            MOVE      ZERO,EXIT
          ENDIF
.
          CALL      CPSY0000                * Check for psychiatric (PSYCFLAG)
          IF        EXIT = 0
            ADD       CDYSDAYS,WORKPSYC
          ENDIF
.
          CALL      CHIH0000                * Calc. Outreach (HIH) days
          IF        EXIT = 1
            ADD       CDYSDAYS,WORKHDAY
            ADD       CDYSDAYS,WORKHHDY                               *I-115867
....        IF        PSYCFLAG = 0                                    *D-219801
              ADD       CDYSDAYS,WORKHIHV   *Outreach (HIH) Vis days  
....        ENDIF                                                     *D-219801
            MATCH     SP8,DRGHIHBD                                    *I-105249
            IF        @EQUAL
              UNPACK    CDYSFDTE,CCENT,CYEAR,CMON,CDAY                *I-105249
              PACK      DRGHIHBD,CDAY,CMON,CCENT,CYEAR                *I-105249
            ENDIF
            UNPACK    CDYSTDTE,CCENT,CYEAR,CMON,CDAY                  *I-105249
            PACK      DRGHIHED,CDAY,CMON,CCENT,CYEAR                  *I-105249
            MOVE      ZERO,EXIT
          ENDIF
.
          CALL      CBBY0000                * Check for psychiatric (PSYCFLAG)
          IF        EXIT = 1
            ADD       CDYSDAYS,WORKBABY
          ENDIF
.
LEND8000  MOVE      TDATE,STDATE            * Save transfer date for leave days
          MOVE      PTTRLTYP,STRLTYP
.
LEND9000  MOVE      ZERO,EXIT
LEND9999  RETURN
+
.******************************************************************************
.*                                  CHKC0000              Called by: CLOS0000 *
.*                   Check For A Stay In A Critical Care Unit      & LEND0000 *
.*                                                                 & FEES0000 *
.******************************************************************************
CHKC0000  MOVE      ZERO,EXIT               * Default normal/HDU bed stay
.
          IF        PTCNHCCC=1
.                                           * using Bed Type for HCP extract
            MATCH     SP3,BEDTYPE
            GOTO      CHKC9000 IF EQUAL     * Dont allow blank codes
.
            PACK      KEY5,ANSB,ANST,BEDTYPE * Using bed type for CCU/ICU
            CALL      RDCODE1               * Cat."BT"
            BRANCH    OVRCD,CHKC9000
            GOTO      CHKC5000
          ELSE
.                                           * using Admission Type for HCP extr.
            MATCH     SP3,ADMTYPE
            GOTO      CHKC9000 IF EQUAL     * Dont allow blank codes
.
            PACK      KEY5,ANSA,SP1,ADMTYPE * Using admin type for CCU/ICU
            CALL      RDCODE1               * Cat."A "
            BRANCH    OVRCD,CHKC9000
            GOTO      CHKC5000
          ENDIF
          MOVE      ONE,EXIT                * valid CCU/ICU/SCN stay (not HDU)
          GOTO      CHKC9999
.
CHKC5000  MOVE      ZERO,EXIT                                         *I-105249
          MOVE      ZERO,FORM1
          MOVE      TCINDC9,FORM1           * save Ind.9 for 1=ICU 3=CCU 4=SCN
          LOAD      EXIT,FORM1,ONE,ZERO,TWO,THREE
.
          BRANCH    EXIT,CHKC5101,CHKC5102,CHKC5103
          GOTO      CHKC9999
CHKC5101  MOVE      ONE,HADICU
          GOTO      CHKC9999
CHKC5102  MOVE      ONE,HADCCU
          GOTO      CHKC9999
CHKC5103  MOVE      ONE,HADSCN
          GOTO      CHKC9999
.
.
CHKC9000  MOVE      ZERO,EXIT
.
CHKC9999  RETURN
+
.******************************************************************************
.*                                  CHIH0000              Called by: CLOS0000 *
.*                   Check For Hospital at home (Outreach or HIH)  & LEND0000 *
.******************************************************************************
CHIH0000  MOVE      ZERO,EXIT               * Default normal bed stay
          IF        PTCNHCCC=1
            MATCH     SP3,BEDTYPE
            GOTO      CHIH9000 IF EQUAL     * Dont allow blank codes
.
            PACK      KEY5,ANSB,ANST,BEDTYPE  * Using bed type for HIH    
            CALL      RDCODE1               * Cat."BT"
            BRANCH    OVRCD,CHIH9000
.
            MATCH     ANSH,TCINDC1
            GOTO      CHIH9000 IF NOT EQUAL * Not an HIH Stay   
          ELSE                                                        *I-171272
            MATCH     SP3,ADMTYPE
            GOTO      CHIH9000 IF EQUAL     * Dont allow blank codes
.
            PACK      KEY5,ANSA,SP1,ADMTYPE * Using admin type for HOME
            CALL      RDCODE1               * Cat."A "
            BRANCH    OVRCD,CHIH9000
.
            MATCH     "4",TCINDC1
            GOTO      CHIH9000 IF NOT EQUAL * Not an HIH stay
          ENDIF                                                       *I-171272
.
.                                           * valid Hosp-in-home Bed Type
          MOVE      ONE,HADHIH
          MOVE      ONE,EXIT
          GOTO      CHIH9999
.
CHIH9000  MOVE      ZERO,EXIT
          GOTO      CHIH9999
.
CHIH9999  RETURN
+
.******************************************************************************
.*                                  CPSY0000                                  *
.*                   Check For psychiatricunit                                *
.******************************************************************************
CPSY0000  MOVE      ONE,EXIT
          MOVE      ZERO,PSYCFLAG
          MOVE      SP1,TCINDC3
          MATCH     SP3,ADMTYPE
          GOTO      CPSY9999 IF EQUAL     * Dont allow blank codes
.
          PACK      KEY5,ANSA,SP1,ADMTYPE * Using admin type for psychiatric
          CALL      RDCODE1               * Cat."A "
          BRANCH    OVRCD,CPSY9999
.
          MATCH     "P",TCINDC3
          GOTO      CPSY9999 IF NOT EQUAL
          MOVE      ONE,PSYCFLAG
.
          MATCH     SP1,DRGLEGST
          IF        @EQUAL
            MATCH       "20190701",DDATE
            IF          @EQUAL | !@LESS
              MOVE      "9",DRGLEGST
            ELSE
              MOVE      "8",DRGLEGST
            ENDIF
          ENDIF
          MOVE      ZERO,EXIT
.
CPSY9999  RETURN
+
.******************************************** start of addition       *I-105249
.******************************************************************************
.*                                  CBBY0000                                  *
.*                   Check For Qualified Baby                                 *
.******************************************************************************
CBBY0000  MOVE      ZERO,EXIT
          MOVE      SP1,TCINDC3
          MATCH     SP3,ADMTYPE
          GOTO      CBBY9999 IF EQUAL     * Dont allow blank codes
.
          PACK      KEY5,ANSA,SP1,ADMTYPE * Using admin type for Qual Baby
          CALL      RDCODE1               * Cat."A "
          BRANCH    OVRCD,CBBY9999
.
          CMATCH    "Q",PTCDNHCP
          GOTO      CBBY9999 IF NOT EQUAL
.
          MOVE      ONE,EXIT              * Qualified baby found
.
.
CBBY9999  RETURN
.********************************************   end of addition       *I-105249
+
.******************************************************************************
.*                                  LDAY0000              Called by: CLOS0000 *
.*                           Calculate The Leave Days                         *
.******************************************************************************
LDAY0000  PACK      CDYSFDTE,STDATE
          PACK      CDYSTDTE,TDATE
          MATCH     CDYSTDTE,CDYSFDTE
          GOTO      LDAY9000 IF NOT LESS
.
          CALL      CALCDAYS                * Calculate diff between dates
          SUB       ONE,CDYSDAYS            * We dont want inclusive dates
          ADD       CDYSDAYS,WORKLDAY       * Total leave days
.
LDAY9000  MOVE      ZERO,EXIT
LDAY9999  RETURN
+
.******************************************************************************
.*                                  DISE0000              Called by: GDAT0000 *
.*                  Format The Disease Codes For This Patient                 *
.******************************************************************************
DISE0000  MOVE      ZERO,COD9CNT
          MOVE      ZERO,COD1CNT
          PACK      KEY16,AADMNO,SP20                                 *C-240107
          CALL      RSPTECD2                * Position on & read a patient
DISE1000  CALL      RKPTECD2                  episode disease file record
          BRANCH    OVRCD,DISE5000
.
          MATCH     AADMNO,PTEDADMN
          GOTO      DISE5000 IF NOT EQUAL   * Different admin no
.
          RESET     VMDILIST
          SCAN      PTEDTYPE,VMDILIST
          GOTO      DISE1000 IF NOT EQUAL   * Not a valid disease type
.
          MOVE      PTEDCODE,SPTEDCOD       * Save the disease code
          COMPARE   "15",COD9CNT
          GOTO      DISE4000 IF NOT LESS    * Code counter >= 15
.
          MOVE      ZERO,CMPCNT             * Complex map counter - no
          MATCH     PTCNI10D,PTEDDTCD
          IF        !@LESS
            MOVE      PTEDCODE,PTCPCOD
            CALL      PATM10T9              * Map ICD10 to ICD9 codes
            MOVE      PTCP1MCD,PTEDCODE
            MOVE      ONE,CMPCNT            * Complex map counter - yes
          ENDIF
.
DISE2000  PACK      KEY9,PTEDCODE
          CALL      RD10T9D1                * Read an ICD9 disease file record
          BRANCH    OVRCD,DISE3000
.
          IF        MAPFILE=1
            PACK      KEY10,ANSD,PTEDCODE
            CALL      RDPA3MI1              * Read the 3M grouper mapping file
            IF        OVRCD<>1
              MOVE      PT3MMAP,PTEDCODE    * Replace ICD9 code with mapped code
            ENDIF
          ENDIF
.
          MATCH     ANSM,PTEDCODE
          GOTO      DISE3000 IF EQUAL       * Don't send morphology codes
.
          ADD       ONE,COD9CNT
          REP       ". - / ",PTEDCODE
          SQUEEZE   PTEDCODE
          PACK      PTEDCODE,PTEDCODE,SP10
.                                           * File format 1 and 2 (old stuff)
          STORE     PTEDCODE,COD9CNT,DRGDIAG,DRGSD01,DRGSD02,DRGSD03,DRGSD04:
                                     DRGSD05,DRGSD06,DRGSD07,DRGSD08,DRGSD09:
                                     DRGSD10,DRGSD11,DRGSD12,DRGSD13,DRGSD14
.
          COMPARE   "15",COD9CNT
          GOTO      DISE4000 IF NOT LESS    * Code counter >= 15
.
DISE3000  COMPARE   ZERO,CMPCNT
          GOTO      DISE4000 IF EQUAL       * Not using complex mapping
.
          ADD       ONE,CMPCNT
          COMPARE   FOUR,CMPCNT
          GOTO      DISE4000 IF NOT LESS    * Complex map counter >=4
.
          MOVE      SP9,PTEDCODE
          LOAD      PTEDCODE,CMPCNT,PTCP1MCD,PTCP2MCD,PTCP3MCD
          MATCH     SP9,PTEDCODE
          GOTO      DISE2000 IF NOT EQUAL   * Not blank code
.
DISE4000  MOVE      SPTEDCOD,PTEDCODE
          PACK      KEY9,PTEDCODE,SP70
          CALL      RDPTICD1
          BRANCH    OVRCD,DISE1000
          COMPARE   ONE,ICDRDVER            * ICD9?
          IF        @EQUAL
            MOVE      DICD10CD,PTEDCODE     * Mapped ICD10 disease code
            PACK      KEY9,PTEDCODE,SP70
            CALL      RDPT10D1              * Read an ICD10 disease file rec
            BRANCH    OVRCD,DISE1000
          ENDIF
.
          MATCH     "4",PT0DACRQ
          GOTO      DISE1000 IF EQUAL       * Morphology code
.
          ADD       ONE,COD1CNT
          REP       ". - / ",PTEDCODE
          SQUEEZE   PTEDCODE
          PACK      PTEDCODE,PTEDCODE,SP10
.
.         Map 'Condition Onset Flag' for Queensland
.
          IF        PTCNHDPS = 4
            MATCH     "1",PTEDOSET
            IF        @EQUAL
              MOVE      TWO,PTEDOSET
            ELSE
              MATCH     "2",PTEDOSET
              IF        @EQUAL
                MOVE      ONE,PTEDOSET
              ENDIF
            ENDIF
          ENDIF
.
          PACK      KEY6,SP70
          PACK      KEY6,PTEDOSET,PTEDCODE
          STORE     KEY6,COD1CNT,XDRG10PD,XDRG1D01,XDRG1D02,XDRG1D03:
                                       XDRG1D04,XDRG1D05,XDRG1D06,XDRG1D07:
                                       XDRG1D08,XDRG1D09,XDRG1D10,XDRG1D11:
                                       XDRG1D12,XDRG1D13,XDRG1D14,XDRG1D15:
                                       XDRG1D16,XDRG1D17,XDRG1D18,XDRG1D19:
                                       XDRG1D20,XDRG1D21,XDRG1D22,XDRG1D23:
                                       XDRG1D24,XDRG1D25,XDRG1D26,XDRG1D27:
                                       XDRG1D28,XDRG1D29,XDRG1D30,XDRG1D31:
                                       XDRG1D32,XDRG1D33,XDRG1D34,XDRG1D35:
                                       XDRG1D36,XDRG1D37,XDRG1D38,XDRG1D39:
                                       XDRG1D40,XDRG1D41,XDRG1D42,XDRG1D43:
                                       XDRG1D44,XDRG1D45,XDRG1D46,XDRG1D47:
                                       XDRG1D48,XDRG1D49
.
DISE4100  COMPARE   "50",COD1CNT                                    *I-105249
          GOTO      DISE1000 IF LESS      * Code counter < 50
.
DISE5000  COMPARE   ZERO,COD1CNT
          GOTO      DISE9000 IF NOT EQUAL   * Disease codes extracted
.
          PACK      ERRMSG,ERRMSG07,SP100
          CALL      ERR0000                 * Print error
.
DISE9000  MOVE      ZERO,EXIT
DISE9999  RETURN
+
.******************************************************************************
.*                                  OPER0000              Called by: GDAT0000 *
.*                  Format The Operation Data For This Patient                *
.******************************************************************************
OPER0000  MOVE      SP8,ICD9ODAT
          MOVE      ZERO,ICD9OTIM
          MOVE      ZERO,ICDPTNMD
          MOVE      ZERO,COD9CNT
          MOVE      ZERO,COD1CNT
          PACK      KEY16,AADMNO,SP20                                 *C-240107
          CALL      RSPTECO2                * Position on & read a patient
OPER1000  CALL      RKPTECO2                  episode operation file record
          BRANCH    OVRCD,OPER9000
.
          MATCH     AADMNO,PTEOADMN
          GOTO      OPER9000 IF NOT EQUAL   * Different admin no
.
.....     MATCH     ANSX,PTEOTYPE                                       D-48888
.....     GOTO      OPER1000 IF EQUAL       * Ignore this oper. code    D-48888
          MATCH     ANSO,PTEOTYPE                                      *I-48888
          GOTO      OPER1000 IF NOT EQUAL   * Ignore "X" "I" & "N"     *I-48888
.
          MATCH     PTCNEDRG,PTEOCODE
          GOTO      OPER1000 IF EQUAL       * Exclude dummy code
.
          MOVE      PTEOCODE,SPTEOCOD       * Save the operation code
          COMPARE   "15",COD9CNT
          GOTO      OPER4000 IF NOT LESS    * Code counter >= 15
.
          MOVE      ZERO,CMPCNT             * Complex map counter - no
          MATCH     PTCNI10D,PTEODTCD
          IF        !@LESS
            MOVE      PTEOCODE,PTCPCOD
            CALL      PATM10T9              * Map ICD10 to ICD9 codes
            MOVE      PTCP1MCD,PTEOCODE
            MOVE      ONE,CMPCNT            * Complex map counter - yes
          ENDIF
.
OPER2000  PACK      KEY9,PTEOCODE
          CALL      RD10T9O1                * Read an ICD9 operation file record
          BRANCH    OVRCD,OPER3000
.
          IF        MAPFILE=1
            PACK      KEY10,ANSO,PTEOCODE
            CALL      RDPA3MI1              * Read the 3M grouper mapping file
            IF        OVRCD<>1
              MOVE      PT3MMAP,PTEOCODE    * Replace ICD9 code with mapped code
            ENDIF
          ENDIF
.
          ADD       ONE,COD9CNT
          REP       ". - / ",PTEOCODE
          SQUEEZE   PTEOCODE
          PACK      PTEOCODE,PTEOCODE,SP10
          STORE     PTEOCODE,COD9CNT,DRGOPER,DRGSO01,DRGSO02,DRGSO03,DRGSO04:
                                     DRGSO05,DRGSO06,DRGSO07,DRGSO08,DRGSO09:
                                     DRGSO10,DRGSO11,DRGSO12,DRGSO13,DRGSO14
.
          IF        COD9CNT=1
            MOVE      PTEODATE,ICD9ODAT
            MOVE      PTEOSTTM,STRTTME5
            MOVE      PTEOEDTM,ENDTME5
            CALL      CTIM0000              * Calculate start & end time
            MOVE      TIME4,ICD9OTIM        * Save the primary operation time
          ENDIF
.
          COMPARE   "15",COD9CNT
          GOTO      OPER4000 IF NOT LESS    * Code counter >= 15
.
OPER3000  COMPARE   ZERO,CMPCNT
          GOTO      OPER4000 IF EQUAL       * Not using complex mapping
.
          ADD       ONE,CMPCNT
          COMPARE   FOUR,CMPCNT
          GOTO      OPER4000 IF NOT LESS    * Complex map counter >=4
.
          MOVE      SP9,PTEOCODE
          LOAD      PTEOCODE,CMPCNT,PTCP1MCD,PTCP2MCD,PTCP3MCD
          MATCH     SP9,PTEOCODE
          GOTO      OPER2000 IF NOT EQUAL   * Not blank code
.
OPER4000  MOVE      SPTEOCOD,PTEOCODE
          PACK      KEY9,PTEOCODE,SP70
          CALL      RDPTICO1
          BRANCH    OVRCD,OPER1000
          COMPARE   ONE,ICDRDVER            * ICD9?
          IF        @EQUAL
            MOVE      OICD10CD,PTEOCODE     * Mapped ICD10 operation code
            PACK      KEY9,PTEOCODE,SP70
            CALL      RDPT10O1              * Read an ICD10 operation file rec
            BRANCH    OVRCD,OPER1000
          ENDIF
.
          ADD       ONE,COD1CNT
          REP       ". - / ",PTEOCODE
          SQUEEZE   PTEOCODE
          PACK      PTEOCODE,PTEOCODE,SP10
          STORE   PTEOCODE,COD1CNT,DRG10PPR,DRG10P01,DRG10P02,DRG10P03,DRG10P04:
                                   DRG10P05,DRG10P06,DRG10P07,DRG10P08,DRG10P09:
                                   DRG10P10,DRG10P11,DRG10P12,DRG10P13,DRG10P14:
                                   DRG10P15,DRG10P16,DRG10P17,DRG10P18,DRG10P19:
.                                                   * added for 2006  *I-105249
                                   DRG10P20,DRG10P21,DRG10P22,DRG10P23,DRG10P24:
                                   DRG10P25,DRG10P26,DRG10P27,DRG10P28,DRG10P29:
                                   DRG10P30,DRG10P31,DRG10P32,DRG10P33,DRG10P34:
                                   DRG10P35,DRG10P36,DRG10P37,DRG10P38,DRG10P39:
                                   DRG10P40,DRG10P41,DRG10P42,DRG10P43,DRG10P44:
                                   DRG10P45,DRG10P46,DRG10P47,DRG10P48,DRG10P49
.
          IF        COD1CNT=1
            MOVE      PTEODATE,ICD9ODAT
            MOVE      PTEOSTTM,STRTTME5
            MOVE      PTEOEDTM,ENDTME5
            CALL      CTIM0000              * Calculate start & end time
            MOVE      TIME4,ICD9OTIM        * Save the primary operation time
            MOVE      PT0ODTMN,ICDPTNMD     * ICD Procedure Time non-mandatory?
          ENDIF
.
          COMPARE   "50",COD1CNT                                    *I-105249
          GOTO      OPER1000 IF LESS      * Code counter < 50
.
OPER9000  MOVE      ZERO,EXIT
OPER9999  RETURN
+
.******************************************************************************
.*                                  CTIM0000              Called by: MMBS0000 *
.*                          Calculate Time In Theatre              & OPER0000 *
.******************************************************************************
CTIM0000  MOVE      ZERO,TIME4              * If times are blank
          UNPACK    STRTTME5,CHOUR,ANS,CMIN
          MATCH     SP2,CHOUR
          GOTO      CTIM9000 IF EQUAL
.
          MOVE      CHOUR,IHOUR
          MOVE      CMIN,IMIN
          ASSIGN    (IHOUR*60)+IMIN,FORM8
.
          UNPACK    ENDTME5,CHOUR,ANS,CMIN
          MATCH     SP2,CHOUR
          GOTO      CTIM9000 IF EQUAL
.
          MOVE      CHOUR,IHOUR
          MOVE      CMIN,IMIN
          ASSIGN    (IHOUR*60)+IMIN-FORM8,FORM8
.
          IF        FORM8>=0
            MOVE      FORM8,TIME4
          ELSE
            ASSIGN    (FORM8+1440),TIME4    * 1440 = minutes in a day
          ENDIF
.
CTIM9000  MOVE      ZERO,EXIT
CTIM9999  RETURN
+
.******************************************************************************
.*                                  MMBS0000              Called by: GDAT0000 *
.*                    Format The MBS Data For This Patient                    *
.******************************************************************************
MMBS0000  PACK      KEY11,AADMNO,SP10
          CALL      RDSMMBS1                * Position on & read the mecdical
MMBS0010  CALL      RDKMMBS1                  records MBS file
          IF        OVRCD=1
            GOTO      MMBS8000
          ELSE 
            MATCH     AADMNO,MMADMN
            GOTO      MMBS8000 IF EQUAL
          ENDIF
.
          MATCH     SP9,MMCODE
          GOTO      MMBS0010 IF EQUAL       * No MBS code
.
          PACK      KEY9,MMCODE,SP70
          PACK      KEY17,KEY9,MMDATE,SP70
          CALL      PATITMRD
          BRANCH    OVRCD,MMBS0010
.
          MATCH     "1",PTITMSCH
          GOTO      MMBS0010 IF EQUAL
.
MMBS0040  PACK      KEY18,AADMNO,TWO,SP70
          CALL      RDSDTRN3
MMBS0050  CALL      RDKDTRN3
          BRANCH    OVRCD,MMBS8000
.
          MATCH     AADMNO,TADMNO
          GOTO      MMBS8000 IF NOT EQUAL
          COMPARE   TWO,TRECTYPE
          GOTO      MMBS8000 IF NOT EQUAL
.
          MATCH     MMCODE,TITEMNO
          GOTO      MMBS0050 IF NOT EQUAL
.
          MOVE      MMCODE,DRGPORCD         * MBS code
.
          PACK      XDRGPORC,MMCODE,SP20
          REP    "A B C D E F G H I J K L M N O P Q R S T U V W X Y Z ",XDRGPORC
          SQUEEZE   XDRGPORC
          PACK      XDRGPORC,XDRGPORC,SP20
.
          PACK      MMDATE,MMDATE,SP10
          MATCH     SP8,MMDATE
          IF        @EQUAL
            MATCH     ICD9ODAT,SP8
            IF        @EQUAL
              PACK      ERRMSG,ERRMSG08,SP1,MMCODE,SP100
              CALL      ERR0000             * Print error
            ELSE
              UNPACK    ICD9ODAT,CCENT,CYEAR,CMON,CDAY
              PACK      DRGPORDT,CDAY,CMON,CCENT,CYEAR
              REP       " 0",DRGPORDT       * MBS date from ICD9 oper date
            ENDIF
          ELSE
            UNPACK    MMDATE,CCENT,CYEAR,CMON,CDAY
            PACK      DRGPORDT,CDAY,CMON,CCENT,CYEAR
            REP       " 0",DRGPORDT         * MBS operation date
          ENDIF
.
          MOVE      MMSTIM,STRTTME5
          MOVE      MMETIM,ENDTME5
          CALL      CTIM0000                * Calculate start & end time
          IF        TIME4=0
            IF        ICD9OTIM=0
              MATCH     ADATE,DDATE
              IF        @EQUAL
                MATCH     "R63Z",XDRGDRG
                GOTO      MMBS0500 IF EQUAL  * Chemotherapy does not need a time
.
                MATCH     "L61Z",XDRGDRG
                GOTO      MMBS0500 IF EQUAL  * Dialysis does not need a time
.
                MATCH     "1",ICDPTNMD
                GOTO      MMBS0500 IF EQUAL  * Procedure Time non-mandatory
.
                PACK      ERRMSG,ERRMSG09,SP1,MMCODE,SP100         * I SRF 33633
                CALL      ERR0000           * Print error
              ENDIF
            ELSE
              MOVE      ICD9OTIM,DRGPORTM
              REP       " 0",DRGPORTM       * MBS time from ICD9 oper time
            ENDIF
          ELSE
            MOVE      TIME4,DRGPORTM
            REP       " 0",DRGPORTM         * MBS operation time
          ENDIF
MMBS0500  PACK      KEY110,SP100,SP10
          CLEAR     KEY110
          PACK      KEY70,SP100
          CLEAR     KEY70
.
MMBS1000  CALL      RDKMMBS1                * Read the next med rec MBS record
          BRANCH    OVRCD,MMBS8000
.
          MATCH     AADMNO,MMADMN
          GOTO      MMBS8000 IF NOT EQUAL
.
          PACK      KEY9,MMCODE,SP70
          PACK      KEY17,KEY9,MMDATE,SP70
          CALL      PATITMRD
          BRANCH    OVRCD,MMBS1000
.
          MATCH     "1",PTITMSCH
          GOTO      MMBS1000 IF EQUAL
.
MMBS2000  PACK      KEY14,MMCODE,SP20
          REP       "A B C D E F G H I J K L M N O P Q R S T U V W X Y Z ",KEY14
          SQUEEZE   KEY14
          PACK      KEY14,KEY14,SP70
          APPEND    KEY14,KEY70
          IF        @EOS
            APPEND    KEY14,XDRGSMB2        * Secondary CMBS procedure
            GOTO      MMBS8000 IF EOS
          ELSE
            APPEND    KEY14,XDRGSMB1        * Secondary CMBS procedure
          ENDIF
          GOTO      MMBS1000
.
MMBS8000  RESET     DRGSMBS1
          RESET     DRGSMBS2
          RESET     XDRGSMB1
          RESET     XDRGSMB2
.
MMBS9000  MOVE      ZERO,EXIT
MMBS9999  RETURN
+
.******************************************************************************
.*                                  FEES0000              Called by: GDAT0000 *
.*                    Calculate The Fees From The patdtraf                    *
.******************************************************************************
FEES0000  MOVE      ZERO,WORKACC            * Reset accommodation fee
          MOVE      ZERO,WORKOR             * Reset theatre fee
          MOVE      ZERO,WORKLW             * Reset labour ward fee
          MOVE      ZERO,WORKICU            * Reset ICU fee
          MOVE      ZERO,WORKPROS           * Reset prosthesis fee
          MOVE      ZERO,WORKPHRM           * Reset pharmaceutical fee
          MOVE      ZERO,WORKOTHR           * Reset other fees
          MOVE      ZERO,WORKBUND           * Reset bundled/casemix fees
          MOVE      ZERO,WORKTOTL           * Reset total fees
          MOVE      ZERO,MTIFLAG
.
.******************************************** start of addition       *I-105249
          MOVE      ZERO,MSCNUMB            * Misc.Service Codes count
          MOVE      ZERO,WORKCCU            * Reset CCU fee
          MOVE      ZERO,WORKSCN            * Reset SCN fee
          MOVE      ZERO,WORKHIH            * Reset Outreach (HIH) Fee
          MOVE      SP10,WORKDATE
.********************************************   end of addition       *I-105249
.
          PACK      KEY22,AADMNO,SP20
          CALL      RDSDTRN1                * Position on & read the DTR file
FEES0100  CALL      RDKDTRN1
          BRANCH    OVRCD,FEES7500
.
          MATCH     AADMNO,TADMNO
          GOTO      FEES7500 IF NOT EQUAL   * Different admission number
.
FEES0200  MOVE     ZERO,OVRCD
          MOVE     ZERO,ADDNFEES
.                             Accom    Theatre  Misc.   Doc.Fees Csh.Recpt
          BRANCH    TRECTYPE,FEES1000,FEES2000,FEES3000,FEES0100,FEES0100:
                             FEES6000
.
. ----- Accommodation Record -----
.
.         Need to allow for ICU accommodation here. This will need to be
.         done when the definition is finalised.
.
FEES1000  MOVE      ZERO,EXIT
.                                           * Check for Casemix Lump Sum
          MATCH    ANSY,PTMICMXP
          IF        @EQUAL
            ASSIGN    PTDTLSPT+PTDTLSRB+WORKBUND,WORKBUND
          ENDIF
.
          CALL      CRDN0000              * Check for credit note
.
          MOVE      PTDTADPT,ADDNFEES
          ADD       PTDTADRB,ADDNFEES
          COMPARE   ZERO,ADDNFEES
          GOTO      FEES1800 IF EQUAL     * No additional charge
.
          MATCH     SP70,TMISGRP
          GOTO      FEES1600 IF EQUAL     * No Category FI for Additional charge
          MOVE      SP1,TCINDC2
          PACK      KEY5,ANSF,ANSI,TMISGRP
          CALL      RDCODE1                 * Read the codes file
          BRANCH    OVRCD,FEES1600
          MATCH     SP70,TCINDC2
          GOTO      FEES1600 IF EQUAL     * Indicator is not setup
          COMPARE   ZERO,TNODAYS
          GOTO      FEES1600 IF EQUAL     * zero bed days
.
          COMPARE   ZERO,CRDFLAG
          GOTO      FEES1600 IF EQUAL     * had been credit noted
.
.         If there is an additional charge for Casepayment, then we put the 
.         charges using Category FI
.
          MULT      TNODAYS,ADDNFEES
          COMPARE   ADDNFEES,TPATAMTT
          GOTO      FEES1600 IF LESS    * error, total charge<additional charge
.
          SUB       ADDNFEES,TPATAMTT   * Total Daily charge - Additional charge
          GOTO      FEES1800
.
FEES1600  MOVE      ZERO,ADDNFEES
.
FEES1800  BRANCH    CRDFLAG,FEES1820
.
          MOVE      TREF,KEY8
          CALL      RDINV1
          IF        OVRCD=0 & PTINCMIX=1 & TRECTYPE=1
            MATCH     "1",PMCNSTAT            * Check for fully credited
            IF        @EQUAL
              MATCH     ANSY,PTMICMXP
              IF        @EQUAL
                SUB       PTDTLSPT,WORKBUND
                SUB       PTDTLSRB,WORKBUND     * Lumpsum rebate credit note
              ENDIF
            ENDIF
          ENDIF
.
FEES1820  PACK      XDATE,TFCENT,TFYEAR,TFMONTH,TFDAY
          REP       " 0",XDATE
          PACK      KEY30,AADMNO,XDATE,ZED30
          CALL      RDSTRAN2
          CALL      RDPTRAN2
          IF        OVRCD = 0
            MATCH     TADMN,AADMNO
            GOTO      FEES1825 IF NOT EQUAL
.
            MOVE      TATYPE,ADMTYPE
            MOVE      TRBTYP,BEDTYPE
.
            CALL      CHKC0000              * Check if stay in a ICU
            IF        EXIT > 0
.                                                                     *I-105249
              MOVE      ZERO,FORM102        * EXIT value - 1=ICU 2=CCU 3=SCN
              LOAD      FORM102,EXIT,WORKICU,WORKCCU,WORKSCN
              ADD       TPATAMTT,FORM102
              IF        CRDFLAG = 0
                ADD       CRDNAMNT,FORM102  * ICU fee
              ENDIF
              STORE     FORM102,EXIT,WORKICU,WORKCCU,WORKSCN
              MOVE      ZERO,EXIT
              GOTO      FEES1900
            ENDIF
          ENDIF
.
FEES1825  CALL      CHIH0000                * Calc. Outreach (HIH) stay
          IF        EXIT = 1
            ADD       TPATAMTT,WORKHIH
            IF        CRDFLAG=0
              ADD       CRDNAMNT,WORKHIH
            ENDIF
            GOTO      FEES1900
          ENDIF
.
          ADD       TPATAMTT,WORKACC        * Accommodation fee
          BRANCH    CRDFLAG,FEES1900
          ADD       CRDNAMNT,WORKACC          * Accommodation fee
.
FEES1900  COMPARE   ZERO,ADDNFEES         * Check if there is an Additional fee
          GOTO      FEES0100 IF EQUAL
.
.         Put the addional charges to Category FI
.
          MOVE      SP1,TCINDC2
          PACK      KEY5,ANSF,ANSI,TMISGRP
          CALL      RDCODE1                 * Read the codes file
          BRANCH    OVRCD,FEES0100
.
          MOVE      ADDNFEES,TPATAMTT
          GOTO      FEES3005
.
. ----- Theatre Record -----
.
FEES2000  CALL      GCFI0000                * Get category FI 2nd indicator
          CMATCH    ANSL,TCINDC2
          IF        @EQUAL
            ADD       TPATAMTT,WORKLW       * Labour ward fee
            CALL      CRDN0000              * Check for credit note
            BRANCH    CRDFLAG,FEES2100
            ADD       CRDNAMNT,WORKLW       * Labour ward fee
            GOTO      FEES2100
          ENDIF
.
          ADD       TPATAMTT,WORKOR         * Theatre fee
          CALL      CRDN0000                * Check for credit note
          BRANCH    CRDFLAG,FEES2100
          ADD       CRDNAMNT,WORKOR         * Theatre fee
.
FEES2100  MATCH     "1",PTITMSCH
          GOTO      FEES2500 IF EQUAL
.
          CMATCH    "2",TCINDC6           * from 01/07/2006
          IF        @EQUAL
FEES2500    ADD       ONE,MSCNUMB         * add 1 to Misc.Service Codes count
            MOVE      TITEMNO,KEY9
            SQUEEZE   KEY9
            PACK      DIM20,KEY9,SP20
            STORE     DIM20,MSCNUMB,DRGMSC01,DRGMSC02,DRGMSC03,DRGMSC04:
                                    DRGMSC05,DRGMSC06,DRGMSC07,DRGMSC08:
                                    DRGMSC09,DRGMSC10
          ENDIF
.
          BRANCH    MTIFLAG,FEES7600
          GOTO      FEES0100
.
. ----- Miscellaneous Charge Record -----
.
FEES3000  CALL      GCFI0000                * Get category FI 2nd indicator
.
FEES3005  CMATCH    ANSA,TCINDC2
          IF        @EQUAL
            ADD       TPATAMTT,WORKACC      * Accommodation adjustment
            CALL      CRDN0000              * Check for credit note
            BRANCH    CRDFLAG,FEES3100
            ADD       CRDNAMNT,WORKACC      * Accommodation adjustment
            GOTO      FEES3100
          ENDIF
.
.******************************************** Start of Addition        *I-53930
          CMATCH    ANSC,TCINDC2
          IF        @EQUAL
            ADD       TPATAMTT,WORKBUND     * Bundled/casemix fee
            CALL      CRDN0000              * Check for credit note
            BRANCH    CRDFLAG,FEES3100
            ADD       CRDNAMNT,WORKBUND     * Bundled/casemix adjustment
            GOTO      FEES3100
          ENDIF
.********************************************   End of Addition        *I-53930
.
          CMATCH    ANSD,TCINDC2
          IF        @EQUAL
            ADD       TPATAMTT,WORKPHRM     * Pharmaceutical fee
            CALL      CRDN0000              * Check for credit note
            BRANCH    CRDFLAG,FEES3100
            ADD       CRDNAMNT,WORKPHRM     * Pharmaceutical fee
            GOTO      FEES3100
          ENDIF
.
          CMATCH    ANSI,TCINDC2
          IF        @EQUAL
            ADD       TPATAMTT,WORKICU      * ICU adjustment
            CALL      CRDN0000              * Check for credit note
            BRANCH    CRDFLAG,FEES3100
            ADD       CRDNAMNT,WORKICU      * ICU  adjustment
            GOTO      FEES3100
          ENDIF
.
.                                                                     *I-105249
          CMATCH    ANSU,TCINDC2
          IF        @EQUAL
            ADD       TPATAMTT,WORKCCU    * CCU adjustment
            CALL      CRDN0000            * Check for credit note
            BRANCH    CRDFLAG,FEES3100
            ADD       CRDNAMNT,WORKCCU    * CCU  adjustment
            GOTO      FEES3100
          ENDIF
          CMATCH    ANSS,TCINDC2
          IF        @EQUAL
            ADD       TPATAMTT,WORKSCN    * SCN adjustment
            CALL      CRDN0000            * Check for credit note
            BRANCH    CRDFLAG,FEES3100
            ADD       CRDNAMNT,WORKSCN    * SCN  adjustment
            GOTO      FEES3100
          ENDIF
.
          CMATCH    ANSH,TCINDC2
          IF        @EQUAL
            ADD       TPATAMTT,WORKHIH    * Outreach (HIH) Fee
            CALL      CRDN0000            * Check for credit note
            BRANCH    CRDFLAG,FEES3100
            ADD       CRDNAMNT,WORKHIH    * HIH  adjustment
.                                                                     *I-171272
FEES3010    IF        PSYCFLAG = 1
....          ADD       ONE,WORKHIHV
            ENDIF                                            * end of *I-171272
            GOTO      FEES3100
          ENDIF
.
          CMATCH    ANSL,TCINDC2
          IF        @EQUAL
            ADD       TPATAMTT,WORKLW       * Labour ward fee
            CALL      CRDN0000              * Check for credit note
            BRANCH    CRDFLAG,FEES3100
            ADD       CRDNAMNT,WORKLW       * Labour ward fee
            GOTO      FEES3100
          ENDIF
.
          CMATCH    ANSP,TCINDC2
          IF        @EQUAL
            ADD       TPATAMTT,WORKPROS     * Prosthesis fee
            CALL      CRDN0000              * Check for credit note
            BRANCH    CRDFLAG,FEES3100
            ADD       CRDNAMNT,WORKPROS     * Prosthesis fee
            GOTO      FEES3100
          ENDIF
.
          CMATCH    ANST,TCINDC2
          IF        @EQUAL
            ADD       TPATAMTT,WORKOR       * Theatre adjustment
            CALL      CRDN0000              * Check for credit note
            BRANCH    CRDFLAG,FEES3100
            ADD       CRDNAMNT,WORKOR       * Thetare adjustment
            GOTO      FEES3100
          ENDIF
.
.
          CMATCH    ANSO,TCINDC2
          IF        @EQUAL
            ADD       TPATAMTT,WORKOTHR       * Other adjustment
            CALL      CRDN0000
            BRANCH    CRDFLAG,FEES3100
            ADD       CRDNAMNT,WORKOTHR       * Other fees
            GOTO      FEES3100
          ENDIF
.
FEES3100  BRANCH    MTIFLAG,FEES7600
          GOTO      FEES0100
.
.
. ----- Journal Record -----
.
FEES6000  MOVE      SP1,TCINDC2
          MATCH     SP3,TTYPE
          GOTO      FEES0100 IF EQUAL       * Code not set up       
.
          PACK      KEY5,ANSJ,SP1,TTYPE
          CALL      RDCODE1                 * Read the codes file
.
          CMATCH    ANSA,TCINDC2
          IF        @EQUAL
            ADD       TPATAMTT,WORKACC      * Accommodation adjustment
          ENDIF
.
          CMATCH    ANSD,TCINDC2
          IF        @EQUAL
            ADD       TPATAMTT,WORKPHRM     * Pharmaceutical adjustment
          ENDIF
.
          CMATCH    ANSI,TCINDC2
          IF        @EQUAL
            ADD       TPATAMTT,WORKICU      * ICU adjustment
          ENDIF
.
.                                                                     *I-105249
          CMATCH    ANSU,TCINDC2
          IF        @EQUAL
            ADD       TPATAMTT,WORKCCU    * CCU adjustment
          ENDIF
          CMATCH    ANSS,TCINDC2
          IF        @EQUAL
            ADD       TPATAMTT,WORKSCN    * SCN adjustment
          ENDIF
.
          CMATCH    ANSH,TCINDC2
          IF        @EQUAL
            ADD       TPATAMTT,WORKHIH    * Outreach (HIH) Adjustment
....                                        * Outreach Visit Days for Psych.
....        IF        PSYCFLAG = 1        * logic moved to FEES3010 - *M-171272
....          PACK      WORKDATE,DTFCENT,DTFYEAR,DTFMONTH,DTFDAY
....          REP       " 0",WORKDATE
....          MATCH     WORKDATE,PRVDTRDT
....          IF        @LESS
....            ADD       ONE,WORKHIHV
....          ENDIF
....          MOVE      WORKDATE,PRVDTRDT
....        ENDIF
          ENDIF
.
          CMATCH    ANSL,TCINDC2
          IF        @EQUAL
            ADD       TPATAMTT,WORKLW       * Labour ward adjustment
          ENDIF
.
          CMATCH    ANSP,TCINDC2
          IF        @EQUAL
            ADD       TPATAMTT,WORKPROS     * Prosthesis adjustment
          ENDIF
.
          CMATCH    ANST,TCINDC2
          IF        @EQUAL
            ADD       TPATAMTT,WORKOR       * Theatre adjustment
          ENDIF
.
          CMATCH    ANSC,TCINDC2
          IF        @EQUAL
            ADD       TPATAMTT,WORKBUND     * Bundled/casemix adjustment
          ENDIF
.
          CMATCH    ANSO,TCINDC2
          IF        @EQUAL
            ADD       TPATAMTT,WORKOTHR     * Other fee adjustment
          ENDIF
.
          GOTO      FEES0100
.
. ----- Bundled/Casemix Fees -----
.
.
.       Check with Misc.theatre item file
.
FEES7500  MOVE      ONE,MTIFLAG
          PACK      KEY14,AADMNO,SP20
          CALL      RSPMMTI1                * Position on & read pmsmtiaf file
FEES7600  CALL      RKPMMTI1
          BRANCH    OVRCD,FEES8000
.
          MATCH     PMMIVISN,DAADMNO
          GOTO      FEES8000 IF NOT EQUAL
          MOVE      PMMIAMTT,TPATAMTT
          MOVE      PMMIITEM,TITEMNO
          MOVE      PMMIRTYP,TRECTYPE
          BRANCH    TRECTYPE,FEES7600,FEES2000,FEES3000
          GOTO      FEES7600
.
. ----- Finished Calculating Amounts -----
.
FEES8000  MOVE      WORKACC,FORM102
          MOVE      "Accommodation ",TYPOFFEE
          CALL      GCNF0000                * Get correct numeric format
          MOVE      FORM6,DRGACCFE          * Accomdation fee
          MOVE      FORM9,DRGACCFF          * Accomdation fee         *I-115102
.
          MOVE      WORKOR,FORM102
          MOVE      "Theatre       ",TYPOFFEE
          CALL      GCNF0000                * Get correct numeric format
          MOVE      FORM5,DRGORFE           * Operation fee
          MOVE      FORM9,DRGORFF           * Operation fee           *I-115102
.
          MOVE      WORKLW,FORM102
          MOVE      "Labour ward   ",TYPOFFEE
          CALL      GCNF0000                * Get correct numeric format
          MOVE      FORM5,DRGLWFE           * Labour ward fee
          MOVE      FORM9,DRGLWFF           * Labour ward fee         *I-115102
.
          MOVE      WORKICU,FORM102
          MOVE      "ICU           ",TYPOFFEE
          CALL      GCNF0000                * Get correct numeric format
          MOVE      FORM5,DRGICUFE          * CCU/ICU fee
          MOVE      FORM9,DRGICUFF          * CCU/ICU fee             *I-115102
.
.                                                                     *I-115102
          MOVE      WORKCCU,FORM102
          MOVE      "CCU           ",TYPOFFEE
          CALL      GCNF0000              * Get correct numeric format
          MOVE      FORM9,DRGCCUFF        * CCU fee
.
          MOVE      WORKSCN,FORM102
          MOVE      "SCN           ",TYPOFFEE
          CALL      GCNF0000              * Get correct numeric format
          MOVE      FORM9,DRGSCNFF        * SCN fee
.
          MOVE      WORKHIH,FORM102
          MOVE      "Outreach      ",TYPOFFEE
          CALL      GCNF0000              * Get correct numeric format
          MOVE      FORM9,DRGHIHFF        * Outreach (HIH) Fee
.
          MOVE      WORKHIHV,DRGHIHVD     * Outreach Visit Days
.
.
          MOVE      WORKPROS,FORM102
          MOVE      "Prosthesis    ",TYPOFFEE
          CALL      GCNF0000                * Get correct numeric format
          MOVE      FORM5,DRGPROFE          * Prosthesis fee
          MOVE      FORM9,DRGPROFF          * Prosthesis fee           *I-115102
.
          MOVE      WORKPHRM,FORM102
          MOVE      "Pharmaceutical",TYPOFFEE
          CALL      GCNF0000                * Get correct numeric format
          MOVE      FORM5,DRGPHAFE          * Pharmaceutical fee
          MOVE      FORM9,DRGPHAFF          * Pharmaceutical fee      *I-115102
.
          MOVE      WORKOTHR,FORM102
          MOVE      "Other         ",TYPOFFEE
          CALL      GCNF0000                * Get correct numeric format
          MOVE      FORM5,DRGOTHFE          * Other fee
          MOVE      FORM9,DRGOTHFF          * Other fee               *I-115102
.
          MOVE      WORKBUND,FORM102
          MOVE      "Bundled       ",TYPOFFEE
          CALL      GCNF0000                * Get correct numeric format
          MOVE      FORM6,DRGBUNFE          * Bundled/casemix fee
          MOVE      FORM9,DRGBUNFF          * Bundled/casemix fee     *I-115102
.
FEES9000  MOVE      ZERO,EXIT
FEES9999  RETURN
+
.******************************************************************************
.*                                  CRDN0000              Called by: FEES0000 *
.******************************************************************************
CRDN0000  MOVE      ONE,CRDFLAG
          MOVE      ZERO,CRDNAMNT       * Total amount of credit notes
          BRANCH    MTIFLAG,CRDN9999    * No credit notes for next invoice item
          PACK      KEY16,TREF,SP70
          CALL      RSPMCNO3
CRDN1000  CALL      RKPMCNO3
          BRANCH    OVRCD,CRDN9999
          MATCH     TREF,PMCNINVN
          GOTO      CRDN9999 IF NOT EQUAL
.
          PACK      KEY30,DTADMNO,TREF,TTRANSN1,PMCNCRNO
          CALL      RDPMFCI1
          BRANCH    OVRCD,CRDN9999           * No credit note found
          ADD       PMFCCAMT,CRDNAMNT
.
.
          MOVE      ZERO,CRDFLAG
          GOTO      CRDN1000
.
CRDN9999  RETURN
+
.******************************************************************************
.*                                  GCFI0000              Called by: FEES0000 *
.*                      Get The Category FI 2nd Indicator                     *
.******************************************************************************
GCFI0000  MOVE      ZERO,EXIT
          MOVE      SP1,TCINDC2
          COMPARE   TWO,TRECTYPE
          GOTO      GCFI1000 IF NOT EQUAL   * Only check item file for MBS codes
.
. ----- Read The Item File To Get The Category FI For MBS Items -----
.
          PACK      KEY9,TITEMNO
          PACK      KEY17,KEY9,CURRDATE,SP70
          CALL      PATITMRD                * Read the item file
          MOVE      IMISGRP,ACODE           * Set up the correct cat FI
          COMPARE   ZERO,OVRCD
          GOTO      GCFI3000 IF EQUAL       * Found the miscell charge record
.
. ----- Read The Miscell Charge File With Full Key -----
.
GCFI1000  UNPACK    SP20,PTHFBCAT           * change "H/F Table" to "Table Type"
          PACK      KEY14,AFUNDH,AFNDTB,SP20
          CALL      RDFUND1                 * "Table Type code" now in PTHFBCAT
.
          PACK      KEY29,ACLAIM,AFUNDH,PTHFBCAT,TITEMNO,CURRDATE,SP10
          CALL      PATMCHRD                * read Misc.Charges file 
          COMPARE   ZERO,EXIT
          GOTO      GCFI2000 IF EQUAL
.                                           * - try a blank health fund
          PACK      KEY29,ACLAIM,SP6,SP3,TITEMNO,CURRDATE,SP10
          CALL      PATMCHRD                * read Misc.Charges file 
          COMPARE   ZERO,EXIT
          GOTO      GCFI2000 IF EQUAL
.                                           * - last chance, try default Claim
          CALL      DCLM0000
          PACK      KEY29,PTCNDCLM,SP6,SP3,TITEMNO,CURRDATE,SP10
          CALL      PATMCHRD                * read Misc.Charges file 
          COMPARE   ZERO,EXIT
          IF        !@EQUAL
            MOVE      TMISGRP,ACODE
            GOTO      GCFI3000
          ENDIF
.
GCFI2000  MOVE      MMSCGRP,ACODE
.
GCFI3000  MATCH     SP3,ACODE
          GOTO      GCFI9000 IF EQUAL       * Code not set up
.
          PACK      KEY5,ANSF,ANSI,ACODE
          CALL      RDCODE1                 * Read the codes file
.
GCFI9000  MOVE      ZERO,EXIT
GCFI9999  RETURN
+
.******************************************************************************
.*                                  GCNF0000              Called by: FEES0000 *
.*                       Get The Correct Numeric Format                       *
.******************************************************************************
GCNF0000  MOVE      FORM102,FORM5
          MOVE      FORM102,FORM6
          IF        FORM6<0
            STRIP     TYPOFFEE
            PACK      ERRMSG,TYPOFFEE,SP1,ERRMSG10,SP100
            CALL      ERR0000               * Print an error message
          ENDIF
          IF        FORM102<0
            MOVE      ZERO,FORM102
          ENDIF
          ADD       FORM102,WORKTOTL        * Increment total
.
.********************************************                         *I-105249
.                                           * new format from 01/07/2006
          MOVE      FORM102,FORM122
          MULT      "100",FORM122           
          MOVE      FORM122,FORM9           * remove decimal point
.
GCNF9000  MOVE      ZERO,EXIT
GCNF9999  RETURN
+
.******************************************************************************
.*                                  ZFNF0000              Called by: EXTD0000 *
.*                          Zero Fill Numeric Fields                          *
.******************************************************************************
ZFNF0000  REP       " 0",DRGBDAT
          REP       " 0",DRGADAT
          REP       " 0",DRGDDAT
          REP       " 0",DRGICULS
          REP       " 0",DRGHRS
          REP       " 0",DRGATME
          REP       " 0",DRGAWHT
          REP       " 0",DRGHMV
          REP       " 0",DRGPSYC
          REP       " 0",DRGDYHOM
          REP       " 0",DRGHIHDY                                     *I-105249
          REP       " 0",DRGDTME
          REP       " 0",DRGLDAYS
          REP       " 0",DRGNALOS
          REP       " 0",DRGPORTM
          REP       " 0",DRGACCFE
          REP       " 0",DRGORFE
          REP       " 0",DRGLWFE
          REP       " 0",DRGICUFE
          REP       " 0",DRGPROFE
          REP       " 0",DRGPHAFE
          REP       " 0",DRGOTHFE
          REP       " 0",DRGBUNFE
.
.******************************************** start of addition       *I-105249
          REP       " 0",DRGHIHFF
          REP       " 0",DRGSCNFF
          REP       " 0",DRGCCUFF
          REP       " 0",DRGSCNHR
          REP       " 0",DRGCCUHR
          REP       " 0",DRGSCNLS
          REP       " 0",DRGCCULS
          REP       " 0",DRGNBQDY
..        REP       " 0",DRGHIHBD
..        REP       " 0",DRGHIHED
          REP       " 0",DRGHIHVD
          REP       " 0",DRGPALDY
.                                           * renamed fields (bigger)
          REP       " 0",DRGACCFF
          REP       " 0",DRGORFF
          REP       " 0",DRGLWFF
          REP       " 0",DRGICUFF
          REP       " 0",DRGPROFF
          REP       " 0",DRGPHAFF
          REP       " 0",DRGOTHFF
          REP       " 0",DRGBUNFF
.********************************************   end of addition       *I-105249
.
          REP       " 0",XDRGNBQD
          REP       " 0",XDRGPSYC
.
ZFNF9000  MOVE      ZERO,EXIT
ZFNF9999  RETURN
+
.******************************************************************************
.*                                  WRTD0000              Called by: EXTD0000 *
.*                    Write The Data To The Morbidity File                    *
.******************************************************************************
.         HCP Extract?
.
WRTD0000  WRITE     INPFILE6,SEQ;DRGMEMBN,DRGFUND,DRGADMN,DRGSNAME,DRGGNAME:
                              DRGBDAT,DRGPCODE,DRGSEX,DRGADAT,DRGDDAT:
                              DRGHTYPE,DRGICULS,DRGHRS,XDRGPSYC,XDRGDRG:
                              DRGVOGU,DRGATME,DRGASTAT,DRGTRNFR,XDRGSCAT:
                              DRGASRC,DRGDSINT,DRGCTRST,DRGLEGST,DRGPALLV:
                              DRGREADM,DRGTHEVS,DRGAWHT,DRGHMV,DRGSEP:
                              DRGDTME,DRGLDAYS,DRGTRNTO,DRGNALOS,DRGHIHDY:
                              XDRG10PD,XDRG1D01,XDRG1D02,XDRG1D03,XDRG1D04:
                              XDRG1D05,XDRG1D06,XDRG1D07,XDRG1D08,XDRG1D09:
                              XDRG1D10,XDRG1D11,XDRG1D12,XDRG1D13,XDRG1D14:
                              XDRG1D15,XDRG1D16,XDRG1D17,XDRG1D18,XDRG1D19:
                              XDRG1D20,XDRG1D21,XDRG1D22,XDRG1D23,XDRG1D24:
                              XDRG1D25,XDRG1D26,XDRG1D27,XDRG1D28,XDRG1D29:
                              XDRG1D30,XDRG1D31,XDRG1D32,XDRG1D33,XDRG1D34:
                              XDRG1D35,XDRG1D36,XDRG1D37,XDRG1D38,XDRG1D39:
                              XDRG1D40,XDRG1D41,XDRG1D42,XDRG1D43,XDRG1D44:
                              XDRG1D45,XDRG1D46,XDRG1D47,XDRG1D48,XDRG1D49:
                              DRG10PPR,DRG10P01,DRG10P02,DRG10P03,DRG10P04:
                              DRG10P05,DRG10P06,DRG10P07,DRG10P08,DRG10P09:
                              DRG10P10,DRG10P11,DRG10P12,DRG10P13,DRG10P14:
                              DRG10P15,DRG10P16,DRG10P17,DRG10P18,DRG10P19:
                              DRG10P20,DRG10P21,DRG10P22,DRG10P23,DRG10P24:
                              DRG10P25,DRG10P26,DRG10P27,DRG10P28,DRG10P29:
                              DRG10P30,DRG10P31,DRG10P32,DRG10P33,DRG10P34:
                              DRG10P35,DRG10P36,DRG10P37,DRG10P38,DRG10P39:
                              DRG10P40,DRG10P41,DRG10P42,DRG10P43,DRG10P44:
                              DRG10P45,DRG10P46,DRG10P47,DRG10P48,DRG10P49:
                              DRGILOS,XDRGPORC,DRGPORDT,DRGPORTM,XDRGSMB1:
                              XDRGSMB2,DRGACCFF,DRGORFF,DRGLWFF,DRGICUFF:
                              DRGPROFF,DRGPHAFF,DRGOTHFF,DRGBUNFF,DRGMRNUM:
                              DRGMSC01,DRGMSC02,DRGMSC03,DRGMSC04,DRGMSC05:
                              DRGMSC06,DRGMSC07,DRGMSC08,DRGMSC09,DRGMSC10:
                              DRGHIHFF,DRGSCNFF,DRGCCUFF,DRGSCNHR,DRGCCUHR:
                              DRGSCNLS,DRGCCULS,XDRGNBQD,DRGHIHBD,DRGHIHED:
                              DRGPALDY,XARDRGVN;
.
.         HEC Extract?
.
          IF        EXTRTYPE=2
            WRITE     INPFILE6,SEQ;DRGADOCT
          ELSE
            WRITE     INPFILE6,SEQ;
          ENDIF
.
WRTD9999  RETURN
+
.******************************************************************************
.*                                  VDAT0000                                  *
.*                            Validating data                                 *
.******************************************************************************
VDAT0000  MOVE      ZERO,FORM1
          MATCH     SP1,DRGMSTAT
          GOTO      VDAT0500 IF EQUAL
.                                           * Admission Status/Urgency Status
VDAT0500  MOVE      ZERO,FORM1
          MATCH     SP1,DRGASTAT
          IF        @EQUAL
            MOVE      "9",DRGASTAT        * default - Not Known/Not Reported
            GOTO      VDAT0900
          ENDIF
.                                                             
          MOVE      DRGASTAT,FORM1
          IF        FORM1 <> 9
            IF        FORM1 < 1 | FORM1 > 3
              MOVE      "Admission Status must be between 1-3 or 9 ",DIM40
              PACK      ERRMSG,DIM40,SP100
              CALL      ERR0000           * Print error
            ENDIF
          ENDIF
.                                           
VDAT0900  MOVE      ZERO,FORM1
          MOVE      ZERO,FORM3
.
.------- *T0889652 - Validate Care type using PTCDUDF4 
          MOVE      XDRGSCAT,FORM3
          IF        (FORM3 > 0 & FORM3 < 12) | FORM3 = 88
            IF        FORM3 = 8
              GOTO      VDAT0990            * Invalid care type 8
            ELSE
              GOTO      VDAT1000            * Valid Care types 1-7,9-11,88
            ENDIF                            
          ELSE
            GOTO      VDAT0990              * Invalid all others 
          ENDIF
.
VDAT0990  MOVE      "Invalid Service Category ",DIM40
          PACK      ERRMSG,DIM40,SP100
          CALL      ERR0000               * Print error
.
.VDAT1000  PACK      LJUSCODE,XDRGSCAT,SP70
.          MOVE      "3",JUSTNO
.          CALL      RJUS0000
.          MOVE      RJUSCODE,XDRGSCAT
.
VDAT1000
.
VDAT1050  TYPE      DRGASRC
          GOTO      VDAT1100 IF NOT EQUAL
          MATCH     "3",DRGASRC
          GOTO      VDAT1200 IF NOT EQUAL
.
VDAT1100  MOVE      "Invalid Source of referral                ",DIM40
          PACK      ERRMSG,DIM40,SP100
          CALL      ERR0000                 * Print error
.
.                                           * Discharge Intention on Admission
VDAT1200  MOVE      ZERO,FORM1
          MATCH     SP1,DRGDSINT
          GOTO      VDAT2000 IF EQUAL
          MOVE      DRGDSINT,FORM1
.                                                                     *I-105249
          BRANCH    FORM1,VDAT2000,VDAT2000,VDAT2000,VDAT2000,VDAT2000:
                          VDAT1400,VDAT1400,VDAT2000,VDAT2000
.
VDAT1400  MOVE      "Invalid Discharge Intention on Admission  ",DIM40
          PACK      ERRMSG,DIM40,SP100
          CALL      ERR0000                 * Print error
.
VDAT2000  MATCH     SP1,DRGCTRST
          IF        @EQUAL
            MOVE      "Contract Status must not be blank ",DIM40  * SRF 19638
            PACK      ERRMSG,DIM40,SP100
            CALL      ERR0000               * Print error
          ENDIF
.---------- *T0889652 - Validate Adm src (Cat S) using ind14
          MOVE      DRGCTRST,FORM1
          IF        (FORM1 > 0 & FORM1 < 6) | FORM1 = 9 
            GOTO      VDAT2500
          ELSE
            MOVE      "Contract Status must be between 1-5, or 9 ",DIM50
            PACK      ERRMSG,DIM50,SP100
            CALL      ERR0000                * Print error
            GOTO      VDAT2500
          ENDIF
.
VDAT2500  COMPARE   ZERO,PSYCFLAG
          GOTO      VDAT3000 IF EQUAL
          MATCH     SP1,DRGLEGST
          IF        @EQUAL
            MOVE      "M.H. Legal status must not be blank ",DIM40
            PACK      ERRMSG,DIM40,SP100
            CALL      ERR0000
            GOTO      VDAT3000
          ENDIF
.
          MOVE      ZERO,FORM1
          MOVE      DRGLEGST,FORM1
          BRANCH    FORM1,VDAT3000,VDAT3000
          COMPARE   NINE,FORM1
          GOTO      VDAT3000 IF EQUAL
          MOVE      "M.H. Legal status must be 1,2,9  ",DIM40
          PACK      ERRMSG,DIM40,SP100
          CALL      ERR0000                 * Print error
.
.                                           * Palliative Care Status
VDAT3000  MOVE      ZERO,FORM1
          MOVE      DRGPALLV,FORM1
          BRANCH    FORM1,VDAT3550,VDAT3550 * valid codes "1" or "2"
.
          MOVE      "Palliative Care Status must be 1 or 2 ",DIM40
          PACK      ERRMSG,DIM40,SP100
          CALL      ERR0000                 * Print error
          GOTO      VDAT4000
.
VDAT3550  MOVE      ZERO,FORM3
          MOVE      XDRGSCAT,FORM3
          IF        FORM3=3
            MATCH     "1",DRGPALLV          * Palliative care required
            GOTO      VDAT4000 IF EQUAL
            MOVE     "E025.1 - Palliative Care Type Selected (Cat CC) with a non-palliative care status (Cat KG)",DIM100
            PACK      ERRMSG,DIM100,SP100
            CALL      ERR0000                 * Print error
            GOTO      VDAT4000
          ELSE
            MATCH     "2",DRGPALLV          * Palliative care not required
            GOTO      VDAT4000 IF EQUAL
            MOVE    "Palliative Care Status 1 does not match Care Type",DIM50
            PACK      ERRMSG,DIM50,SP100
            CALL      ERR0000                 * Print error
            GOTO      VDAT4000
          ENDIF
.
.                                           * Readmission within 28 days
VDAT4000  MOVE      ZERO,FORM1
          MOVE      DRGREADM,ANS
.                                                                     *I-105249
          REP       "1-2-3-8-",ANS
          MATCH     "-",ANS
          GOTO      VDAT4500 IF EQUAL
          MOVE      "Re-admission within 28 days must be 1, 2, 3 or 8",DIM50
          PACK      ERRMSG,DIM50,SP100
          CALL      ERR0000               * Print error
.                                           * Unplanned Theatre Visit
VDAT4500  MOVE      ZERO,FORM1
.                                                                     *I-105249
          MOVE      DRGTHEVS,FORM1
          BRANCH    FORM1,VDAT8000,VDAT8000,VDAT4700,VDAT4700,VDAT4700:
                          VDAT4700,VDAT4700,VDAT4700,VDAT4800
.
VDAT4700  MOVE      "Unplanned Theatre visit must be 1 or 2",DIM40
          PACK      ERRMSG,DIM40,SP100
          CALL      ERR0000                 * Print error
          GOTO      VDAT8000
.
.         If HDP Equiv. is set to "9" (for NSW Extract), then we need to
.         change this to "2" for HCP Extract (and Eclipse) - CAR 212096.
.
VDAT4800  MOVE      TWO,DRGTHEVS
.
.
.********************************************   end of addition       *I-105249
.
VDAT8000  MATCH     "20010701",DDATE
          GOTO      VDAT9999 IF LESS
.
          MATCH     "00000",DRGICULS        * ICU Length of stay
          GOTO      VDAT8500 IF EQUAL
          MATCH     "00000",DRGICUFE        * ICU Fee
          GOTO      VDAT8500 IF NOT EQUAL
          MATCH     "000000",DRGBUNFE       * Bundled/casemix fees
          GOTO      VDAT8500 IF NOT EQUAL
          MOVE      "No ICU or bundled charge for ICU days     ",DIM40
          PACK      ERRMSG,DIM40,SP100
          CALL      ERR0000                 * Print error
.
VDAT8500  MOVE      ZERO,EXIT
.********************************************                          D-113059
....      MATCH     "00000",DRGPROFE        * Prosthesis fee
....      GOTO      VDAT9999 IF EQUAL
....      MATCH     "00000",DRGORFE         * OR/Theatre fee
....      GOTO      VDAT9999 IF NOT EQUAL
....      MATCH     "000000",DRGBUNFE       * Bundled/casemix fees
....      GOTO      VDAT9999 IF NOT EQUAL
....      MOVE      "No theatre or bundled charge for prosthesis charge",DIM50
....      PACK      ERRMSG,DIM50,SP100
....      CALL      ERR0000                 * Print error
.
VDAT9999  RETURN
+
.******************************************************************************
.*                                  PRTT0000              Called by: EXTD0000 *
.*                             Print The Tempfile                             *
.******************************************************************************
PRTT0000  MOVE      ZERO,CLMCNT
          MOVE      ZERO,GRPCNT
          DISPLAY   *P1:24,*EL,"Printing : ";
          COMPARE   ONE,COPTION
          GOTO      PRTT5000 IF NOT EQUAL   * Summary option
.
. ----- Detailed report option -----
.
          PACK      KEY17,SP20
          CALL      RSTEMP1                 * Position on & read the 1st
          CALL      RKTEMP1                   tempfile
          BRANCH    OVRCD,PRTT3000
          GOTO      PRTT2000
.
PRTT1000  CALL      RKTEMP1                 * Read next 1st tempfile record
          BRANCH    OVRCD,PRTT4000
.
          IF        CLNO>58
            MATCH     SAVTYPE,CLMTYPE
            IF        @EQUAL
              PRINT     *49,"|",*57,"|"
            ELSE
              PRINT     *49,"|",*51,CLMCNT,*57,"|"
              MOVE      ZERO,CLMCNT
            ENDIF
            PRINT     *23,"*---------------------------------*"
            CALL      HEAD0000              * Print report header
          ENDIF
.
          MATCH     SAVTYPE,CLMTYPE
          IF        @EQUAL
            PRINT     *49,"|",*57,"|"
          ELSE
            PRINT     *49,"|",*51,CLMCNT,*57,"|"
            PRINT     *23,"*---------------------------------*"
            MOVE      ZERO,CLMCNT
          ENDIF
          ADD       ONE,CLNO
.
PRTT2000  MATCH     "zzzzzz",HCPCODE
          IF        @EQUAL
            PRINT     *23,"|",*26,"Unknown",*34,"|",*36,CLMTYPE:
                      *40,"|",*41,ADMISS;
          ELSE
            PRINT     *23,"|",*26,HCPCODE,*34,"|",*36,CLMTYPE:
                      *40,"|",*41,ADMISS;
          ENDIF
          DISPLAY   *P12:24,*V2LON,ADMISS;
          ADD       ONE,CLMCNT
          MOVE      CLMTYPE,SAVTYPE
          GOTO      PRTT1000
.
PRTT3000  MATCH     SP6,GRPCODE
          IF        @EQUAL
            PRINT     *23,"|",*26,"Unknown",*34,"|",*40,"|";
          ELSE
            PRINT     *23,"|",*26,GRPCODE,*34,"|",*40,"|";
          ENDIF
.
PRTT4000  PRINT     *49,"|",*51,CLMCNT,*57,"|",*N:
                    *23,"*---------------------------------*",*N:
                    *23,"|",*26,"Total",*34,"|",*40,"|":
                    *49,"|",*51,EXTRDCNT,*57,"|",*N:
                    *23,"*---------------------------------*",*N,*N:
                    *1,"*** End of Report ***"
          GOTO      PRTT9000
.
. ----- Summary report option -----
.
PRTT5000  PACK      KEY9,SP10
          CALL      RSTEMP2                 * Position on & read the 2nd
          CALL      RKTEMP2                   tempfile
          BRANCH    OVRCD,PRTT7500
          GOTO      PRTT7000
.
PRTT6000  CALL      RKTEMP2                 * Read next 2nd tempfile record
          BRANCH    OVRCD,PRTT8000
.
          IF        CLNO>58
            MATCH     SAVCODE,HCPCODE
            IF        @EQUAL
              PRINT     *49,"|",*57,"|"
            ELSE
              PRINT     *49,"|",*51,GRPCNT,*57,"|"
              MOVE      ZERO,GRPCNT
            ENDIF
            PRINT     *24,"*--------------------------------*"
.
            CALL      HEAD0000              * Print report header
            GOTO      PRTT7000
          ENDIF
.
          MATCH     SAVCODE,HCPCODE
          IF        @EQUAL
            PRINT     *49,"|",*57,"|"
            ADD       "1",CLNO
          ELSE
            PRINT     *49,"|",*51,GRPCNT,*57,"|",*N:
                      *24,"*--------------------------------*"
            ADD       "2",CLNO
            MOVE      ZERO,GRPCNT
          ENDIF
.
PRTT7000  MATCH     "zzzzzz",HCPCODE
          IF        @EQUAL
            PRINT     *24,"|",*27,"Unknown",*35,"|",*37,CLMTYPE:
                      *41,"|",*43,CLMCNT;
          ELSE
            PRINT     *24,"|",*27,HCPCODE,*35,"|",*37,CLMTYPE:
                      *41,"|",*43,CLMCNT;
          ENDIF
          DISPLAY   *P12:24,*V2LON,HCPCODE,SP2,CLMTYPE;
          ADD       CLMCNT,GRPCNT
          MOVE      HCPCODE,SAVCODE
          GOTO      PRTT6000
.
PRTT7500  PRINT     *24,"|",*35,"|",*41,"|";
.
PRTT8000  PRINT     *49,"|",*51,GRPCNT,*57,"|",*N:
                    *24,"*--------------------------------*",*N:
                    *24,"|",*27,"Total",*35,"|",*41,"|":
                    *49,"|",*51,EXTRDCNT,*57,"|",*N:
                    *24,"*--------------------------------*",*N,*N:
                    *1,"*** End of Report ***"
.
PRTT9000  MOVE      ZERO,EXIT
PRTT9999  RETURN
+
.******************************************************************************
.*                                  VALHFC00              Called by: VCHF0000 *
.*                  Validate Health Fund Group Code and Claim Code            *
.******************************************************************************
VALHFC00  IF        EXTRTYPE=2
            MOVE      "UNI",DRGFUND              * for HEC extract
          ENDIF
.
          MATCH     SP70,ACLAIM
          GOTO      VALHFC91 IF EQUAL
          GOTO      VALHFC91 IF EOS
.
          MATCH     SP6,GRPCODE
          GOTO      VALHFC10 IF EQUAL
.
          IF        OPTION<>2 & OPTION<>3
            GOTO      VALHFC10    * only validate if running by HF Group
          ENDIF
.
.         Only include patient if Claim Code has a matching Health Fund
.         Group code to that selected for the HCP extract. (CAR 263828)
.
          PACK      KEY3,ACLAIM,SP70
          CALL      RDPTCFA1
          BRANCH    OVRCD,VALHFC91
.
          MATCH     SP70,PTCFHFGC
          GOTO      VALHFC91 IF EQUAL
.
          MATCH     PTCFHFGC,GRPCODE           * Same Health Fund Group code?
          GOTO      VALHFC91 IF NOT EQUAL      * No; exclude patient
.
VALHFC10  PACK      KEY5,ANSC,ANSL,ACLAIM,SP70
          CALL      RDCODE1
          BRANCH    OVRCD,VALHFC91
.
          PACK      DIM5,TCINDC1,TCINDC2,TCINDC3,TCINDC4,TCINDC5,SP70
          SCAN      "W",DIM5
          IF        @EQUAL
            IF        EXTRTYPE=2
              MOVE      "WC ",DRGFUND            * HEC Extract
            ELSE
              MOVE      "VWA",DRGFUND            * HCP Extract
            ENDIF
          ENDIF
.
          SCAN      "M",DIM5
          IF        @EQUAL
            MOVE      "TAC",DRGFUND
          ENDIF
.
          IF        EXTRTYPE=2
            SCAN      "V",DIM5
            IF        @EQUAL
              MOVE      "DVA",DRGFUND
            ENDIF
          ENDIF
.
VALHFC90  MOVE      ZERO,EXIT
          GOTO      VALHFC99
.
VALHFC91  MOVE      ONE,EXIT
VALHFC99  RETURN
+
.******************************************************************************
.*                                  OPEN0000              Called by: EXTD0000 *
.*                              Open The Tempfile                             *
.******************************************************************************
OPEN0000  CALL      KILL0000                * Delete the tempfile
.
          CLEAR     CMDLINE
          APPEND    "isbuild ",CMDLINE
          COMPARE   ONE,COPTION
          GOTO      OPEN5000 IF NOT EQUAL   * Summary option
.
          APPEND    FNAMEA,CMDLINE
          APPEND    FILELIN1,CMDLINE
          RESET     CMDLINE
          EXECUTE   CMDLINE,TASKID
          OPEN      TEMP1,FNAMEA
          GOTO      OPEN9000
.
OPEN5000  APPEND    FNAMEB,CMDLINE
          APPEND    FILELIN2,CMDLINE
          RESET     CMDLINE
          EXECUTE   CMDLINE,TASKID
          OPEN      TEMP2,FNAMEB
.
OPEN9000  MOVE      ZERO,EXIT
OPEN9999  RETURN
+
.******************************************************************************
.*                                  KILL0000              Called by: EXTD0000 *
.*                             Delete The Tempfile                 & OPEN0000 *
.******************************************************************************
KILL0000  CLOSE     TEMP1
          CLOSE     TEMP2
.
          CLEAR     CMDLINE
          APPEND    "iserase ",CMDLINE
          COMPARE   ONE,COPTION
          GOTO      KILL5000 IF NOT EQUAL   * Summary option
.
          APPEND    FNAMEA,CMDLINE
          RESET     CMDLINE
          EXECUTE   CMDLINE,TASKID
          GOTO      KILL9000
.
KILL5000  APPEND    FNAMEB,CMDLINE
          RESET     CMDLINE
          EXECUTE   CMDLINE,TASKID
.
KILL9000  MOVE      ZERO,EXIT
KILL9999  RETURN
+
.******************************************************************************
.*                       I/O Routines For The Tempfile                        *
.******************************************************************************
RSTEMP1   MOVE      ZERO,OVRCD
          RESET     KEY17
          READ      TEMP1,KEY17;;
          RETURN
.
RATEMP1   MOVE      ZERO,OVRCD
          RESET     KEY17
          READ      TEMP1,KEY17;ANS
          GOTO      OVERCOND IF OVER
          RETURN
.
RKTEMP1   MOVE      ZERO,OVRCD
          READKS    TEMP1;HCPCODE,CLMTYPE,DADMISS
          GOTO      OVERCOND IF OVER
          MOVE      DADMISS,ADMISS
          RETURN
.
WRTEMP1   RESET     KEY17
          MOVE      ADMISS,DADMISS
          WRITE     TEMP1,KEY17;HCPCODE,CLMTYPE,DADMISS
          RETURN
.
RSTEMP2   MOVE      ZERO,OVRCD
          RESET     KEY9
          READ      TEMP2,KEY9;;
          RETURN
.
RDTEMP2   MOVE      ZERO,OVRCD
          RESET     KEY9
          READ      TEMP2,KEY9;HCPCODE,CLMTYPE,CLMCNT
          GOTO      OVERCOND IF OVER
          RETURN
.
RKTEMP2   MOVE      ZERO,OVRCD
          READKS    TEMP2;HCPCODE,CLMTYPE,CLMCNT
          GOTO      OVERCOND IF OVER
          RETURN
.
WRTEMP2   RESET     KEY9
          WRITE     TEMP2,KEY9;HCPCODE,CLMTYPE,CLMCNT
          RETURN
.
UPTEMP2   UPDATE    TEMP2;HCPCODE,CLMTYPE,CLMCNT
          RETURN
.
.------------------------------------------------------------
. Move Extract to Web Directory
.------------------------------------------------------------
MVEXT000  CLEAR     CMDLINE                 * Header file
.                              Only if AN-SNAP exists                    C274409
          IF        ANSPRECS = 1
            APPEND    "ibainp91.us3 ",CMDLINE
            APPEND    HCPFNAME,CMDLINE         * Use of HCPFNAME is intentional
            APPEND    ".snp",CMDLINE
            RESET     CMDLINE
            EXECUTE   CMDLINE,TASKID
          ENDIF
.
          CLEAR     CMDLINE                 * Header file
          IF        OPTION=5
            APPEND    "ibainp91.us2 ",CMDLINE
            APPEND    INPFNAME,CMDLINE
            RESET     CMDLINE
            REP       "/.",CMDLINE
          ELSE
            APPEND    "ibainp91.us1 ",CMDLINE
            APPEND    HCPFNAME,CMDLINE
            APPEND    ".hcp",CMDLINE
          ENDIF
          RESET     CMDLINE
          EXECUTE   CMDLINE,TASKID
.
MVEXT999  RETURN
.
. ******************************************************************************
. * Create AN-SNAP Extract for Options 1-3 and 7 if records exist              *
. ******************************************************************************
ANSP0000  IF        OPTION = 7
            GOTO      ANSP0100                   * Options 7
          ENDIF
.
          IF        OPTION > 3
            GOTO      ANSP9999                   * Options 1,2,3 only
          ENDIF
.
ANSP0100  MATCH     ADATE,DDATE                  * day case doesn't require SNAP
          GOTO      ANSP9999 IF EQUAL
.                                                * Non Rehab doesn't require SNAP 
          MATCH     SP70,ACARE
          GOTO      ANSP9999 IF EQUAL
.
          PACK      KEY5,ANSC,ANSC,ACARE,SP70
          CALL      RDCODE1
          BRANCH    OVRCD,ANSP9999
.          
          MOVE      PTCDNHCP,DIM4
          SQUEEZE   DIM4
          MOVE      ZERO TO FORM4
          MOVE      DIM4,FORM4      
          IF        FORM4 < 20 | FORM4 > 23
            GOTO      ANSP9999
          ENDIF            
.
ANSP0500  PACK      KEY31,AURNO,SP70             * Read thru Program Details
          CALL      RDPMUPG1
ANSP1000  CALL      RKPMUPG1
          BRANCH    OVRCD,ANSP9999               * EOF Reached - No Error
.
          MATCH     PMUGURNO,AURNO               * Check for EOR - No Error
          GOTO      ANSP9999 IF NOT EQUAL
.
          MATCH     PMUGATYP,ATYPE
          GOTO      ANSP1000 IF NOT EQUAL
.
          MATCH     SP70,PMUGCLAM
          IF        !@EQUAL
            MATCH     PMUGCLAM,ACLAIM
            GOTO      ANSP1000 IF NOT EQUAL
          ENDIF
.
          MATCH     SP70,PMUGFUND
          GOTO      ANSP2000 IF EQUAL
.
          MATCH     PMUGFUND,AFUNDH
          GOTO      ANSP1000 IF NOT EQUAL
.
          PACK      KEY14,AFUNDH,AFNDTB,SP10
          CALL      RDFUND1
          BRANCH    OVRCD,ANSP1000
.
          MATCH     PMUGTABT,PTHFBCAT
          GOTO      ANSP1000 IF NOT EQUAL
.
ANSP2000  MATCH     PMUGSDAT,ADATE
          GOTO      ANSP1000 IF LESS
.
          MATCH     SP70,PMUGENDD
          IF        @EQUAL
            GOTO      ANSP9800                   * Print Error message
          ENDIF
.
          MATCH     ADATE,PMUGENDD
          GOTO      ANSP1000 IF LESS
.
...       MATCH     PMUGENDD,ENDDTE8
...       GOTO      ANSP1000 IF LESS
.                                                * Clear Extract and Work Fields
          CALL      CLRV0000
.                                    * check for Adm FIM & Set up extract fields
          CALL      EAFM0000
          IF        EXIT = 1
            MOVE      "Missing Admission FIM Details",DIM40
            PACK      ERRMSG,DIM40,SP100
            CALL      ERR0000
          ENDIF
.                                    * check for Dsc FIM & Set up extract fields
          CALL      EDFM0000
          IF        EXIT = 1
            MOVE      "Missing Discharge FIM Details",DIM40
            PACK      ERRMSG,DIM40,SP100
            CALL      ERR0000
          ENDIF
.
          MATCH     SP70,PMUGRPDT
          IF        @EQUAL
            MOVE      "Missing Rehabilitation Plan Date",DIM40
            PACK      ERRMSG,DIM40,SP100
            CALL      ERR0000
          ENDIF
.
          MATCH     SP70,PMUGRDDT
          IF        @EQUAL
            MOVE      "Missing Discharge Plan Date",DIM40
            PACK      ERRMSG,DIM40,SP100
            CALL      ERR0000
          ENDIF
.                                 valid AN-SNAP Record found for Inpatient Visit
          IF        ANSPRECS = 0
            CALL      OSNP0000                   * Open and Create Files
          ENDIF
.                                                * Set Up DRG details in Extract
          PACK      ANPMEMBN,DRGMEMBN,SP70
          PACK      ANPFUND,DRGFUND,SP70
          PACK      ANPSNAME,DRGSNAME,SP70
          PACK      ANPGNAME,DRGGNAME,SP70
          PACK      ANPBDAT,DRGBDAT,SP70
          PACK      ANPPCODE,DRGPCODE,SP70
          PACK      ANPSEX,DRGSEX,SP70
.                                                * Admission Date
          UNPACK    ADATE,CCENT,CYEAR,CMON,CDAY
          PACK      ANPXSDAT,CDAY,CMON,CCENT,CYEAR
.                                                * Discharge Date
          UNPACK    DDATE,CCENT,CYEAR,CMON,CDAY
          PACK      ANPXENDD,CDAY,CMON,CCENT,CYEAR
.                                                * Episode Type
          PACK      ANPXEPTY,ANSO,SP70
.
.                                                * Rehabilitation Plan Date
          UNPACK    PMUGRPDT,CCENT,CYEAR,CMON,CDAY
          PACK      ANPXRPDT,CDAY,CMON,CCENT,CYEAR
.                                                * Discharge Plan Date
          UNPACK    PMUGRDDT,CCENT,CYEAR,CMON,CDAY
          PACK      ANPXRDDT,CDAY,CMON,CCENT,CYEAR
.
          PACK      KEY31,PMUGURNO,PMUGATYP,PMUGCLAM,PMUGFUND,PMUGTABT:
                          PMUGEDAT,SP70
          CALL      RDPMAPG1
          BRANCH    OVRCD,ANSP9800               * Print Error Message

.                                                * Assessment Only Indicator
          MATCH     "1",PMAGASSO
          IF        @EQUAL
            MOVE      ONE,ANPXASSO
          ELSE
            MOVE      TWO,ANPXASSO
          ENDIF
.                                                * Impairment Code
          PACK      ANPXICDE,PMAGICDE,SP70
.
          MATCH     SP70,PMAGSNAP
          IF        @EQUAL
            MOVE      "ANSNAP Classification must not be blank ",DIM40
            PACK      ERRMSG,DIM40,SP100
            CALL      ERR0000
          ENDIF
.                                                * AN-SNAP Version/Class Code
          UNPACK    PMAGVERS,D1,DIM1
          PACK      ANPXVRCL,DIM1,PMAGSNAP,SP70
.                                                * AN-SNAP Version AGAIN!!!!!!
          PACK      ANPXVERS,PMAGVERS
          REP       " 0",ANPXVERS
.
          MATCH     "02",ANPXVERS
          GOTO      ANSP2900 IF EQUAL
.
          MATCH     "03",ANPXVERS
          GOTO      ANSP2900 IF EQUAL
.
          MATCH     "04",ANPXVERS
          GOTO      ANSP2900 IF EQUAL
.
          MATCH     "05",ANPXVERS
          GOTO      ANSP2900 IF EQUAL
.
.          IF        DOYR2024=1
.           MATCH     "05",ANPXVERS
.           GOTO      ANSP2900 IF EQUAL
.          ENDIF
.
          MOVE      "Invalid AN-SNAP Version ",DIM40
          PACK      ERRMSG,DIM40,SP100
          CALL      ERR0000
.
.-------- Mode of Episode Start - Inpatient (Cat S ind15)
ANSP2900  MOVE      SP70,ANPMEIPS
          PACK      KEY5,ANSS,SP1,ASRCE
          CALL      RDCODE1                * Cat."S "
          IF        OVRCD=0
            MOVE      TCINDC15,ANPMEIPS
          ENDIF
.          
.-------- Mode of Episode End - Inpatient (Cat D/DD ind12)
          MOVE      SP70,ANPMEIPE
          IF        PTCNDTRF = 1
            PACK      KEY5,ANSD,SP1,DSTAT
            CALL      RDCODE1               * Cat."D "
          ELSE
            PACK      KEY5,ANSD,ANSD,DDEST
            CALL      RDCODE1               * Cat."DD"
          ENDIF
          IF        OVRCD=0
            MOVE      TCINDC12,ANPMEIPE
          ENDIF
.
ANSP3000  PACK      KEY8,AURNO
          CALL      RDWORK1
          IF        OVRCD = 1
            MOVE      ZERO,XXXXCNTR
          ENDIF
.
          ASSIGN    XXXXCNTR+ONE,XXXXCNTR
          IF        XXXXCNTR > 1
            CALL      UPWORK1
          ELSE
            CALL      WRWORK1
          ENDIF
.                                                * Medical Record Number-Counter
          PACK      ANPANID,AURNO,HYPHEN,XXXXCNTR
          SQUEEZE   ANPANID
.
          COMPARE   ZERO,SNAPRECS
          IF        @EQUAL
            CALL      WSHD0000             * Write SNAP Header
            MOVE      ONE,SNAPRECS
          ENDIF
.
.-------- *T0889652 use ANSPFIL1 AN-SNAP file layout from 01/07/2020
ANSP5000  WRITE     ANSPFIL1,SEQ;ANPMEMBN,ANPFUND,ANPANID,ANPSNAME,ANPGNAME:
                                 ANPBDAT,ANPPCODE,ANPSEX,ANPXSDAT,ANPXENDD:
                                 ANPXEPTY,ANPAEATS,ANPAGRMS,ANPABTHS,ANPAUPBS:
                                 ANPALWBS,ANPATLTS,ANPABLMS,ANPABWMS,ANPATBDS:
                                 ANPATTLS,ANPATBTS,ANPALOCS,ANPASTRS,ANPACOMS:
                                 ANPAEXPS,ANPASCIS,ANPAPRBS,ANPAMEMS,ANPDEATS:
                                 ANPDGRMS,ANPDBTHS,ANPDUPBS,ANPDLWBS,ANPDTLTS:
                                 ANPDBLMS,ANPDBWMS,ANPDTBDS,ANPDTTLS,ANPDTBTS:
                                 ANPDLOCS,ANPDSTRS,ANPDCOMS,ANPDEXPS,ANPDSCIS:
                                 ANPDPRBS,ANPDMEMS,ANPXICDE,ANPXVRCL,ANPXVERS:
                                 ANPMEIPS,ANPMEIPE
.
          ADD       ONE,EXTRSNAP
          GOTO      ANSP1000

ANSP9800  MOVE      "AN-SNAP details incomplete",DIM40
          PACK      ERRMSG,DIM40,SP100
          CALL      ERR0000
          GOTO      ANSP9999
.
ANSP9999  RETURN
.
.*******************************************************************************
.*                                  OSNP0000               Called by: ANSP0000 *
.*                                                                             *
.* Open Files required for AN-SNAP Extract - only if Records exist  CAR 274409 *
.* for extract                                                                 *
.*******************************************************************************
OSNP0000  CLEAR     ANSPNAME
          APPEND    HCPFNAME,ANSPNAME
          APPEND    "/snp",ANSPNAME
          RESET     ANSPNAME
.
          DISPLAY   *P21:CVERT,*EL,*V2LON,*+,ANSPNAME,".snp";
.
.--------*T0889652 - AN-SNAP ANSPFIL File layout from 01/07/2020
          CLOSE     ANSPFIL1,DELETE
          PREP      ANSPFIL1,ANSPNAME
.                                                * Create temp URNO count file
          CALL      CRET0000                     * This is a ludicrous extract
.                                                * requirement but meh!
          MOVE      ONE,ANSPRECS
.
OSNP9999  RETURN
.
. ******************************************************************************
. *                                  CRET0000             Called by : ONSP0000 *
. *                                                                            *
. * Create the temporary URNO count file                            CAR 274409 *
. ******************************************************************************
.
CRET0000  PACK      FNAME1,FNMHDR1,PORT          * allocate temporary file name
          REP       " 0",FNAME1
.
          CALL      KANS0000                     * Remove any existing files
.
          CLEAR     CMDLINE                      * Create temporary file
          APPEND    "isbuild ",CMDLINE
          APPEND    FNAME1,CMDLINE
          APPEND    " 13 U1-8",CMDLINE
          RESET     CMDLINE
.
          EXECUTE   CMDLINE,TASKID
.
          OPEN      WORK1,FNAME1                 * Open temporary file
.
CRET9999  RETURN
.
. ******************************************************************************
. *                                  KANS0000             Called by : ONSP0000 *
. *                                                                            *
. * Delete the temporary URNO count file                            CAR 274409 *
. ******************************************************************************
.
KANS0000  CLOSE     WORK1                        * ensure temporary file closed
.
          CLEAR     CMDLINE                      * remove temporary file
          APPEND    "iserase ",CMDLINE
          APPEND    FNAME1,CMDLINE
          RESET     CMDLINE
.
          EXECUTE   CMDLINE,TASKID
.
KANS9999  RETURN
.
.*******************************************************************************
.*                                  EAFM0000               Called by: EXTR0000 *
.*                                                                             *
.* Set up Admission FIM Score Extract Fields                        CAR 274409 *
.*******************************************************************************
.
EAFM0000  PACK      KEY24,DPVIBILL,SP70
          CALL      RDPTFIM1
EAFM1000  CALL      RKPTFIM1
          BRANCH    OVRCD,EAFM9800
.
          MATCH     PTFIVISN,DPVIBILL
          GOTO      EAFM9800 IF NOT EQUAL
.
          MATCH     ONEINIT,PTFIDELT
          GOTO      EAFM1000 IF EQUAL
.
          MATCH     "A",PTFITYPE
          GOTO       EAFM9800 IF NOT EQUAL
.                                           ******************  Admission Scores
          MOVE      PTFIEATS,F1                   * Eating
          MOVE      F1,ANPAEATS
.
          MOVE      PTFIGRMS,F1                   * Grooming
          MOVE      F1,ANPAGRMS
.
          MOVE      PTFIBTHS,F1                   * Bathing
          MOVE      F1,ANPABTHS
.
          MOVE      PTFIUPBS,F1                   * Dressing Upper Body
          MOVE      F1,ANPAUPBS
.
          MOVE      PTFILWBS,F1                   * Dressing Lower Body
          MOVE      F1,ANPALWBS
.
          MOVE      PTFITLTS,F1                   * Toileting Score
          MOVE      F1,ANPATLTS
.
          MOVE      PTFIBLMS,F1                   * Bladder Management
          MOVE      F1,ANPABLMS
.
          MOVE      PTFIBWMS,F1                   * Bowel Management
          MOVE      F1,ANPABWMS
.
          MOVE      PTFITBDS,F1                  * Transfers - Bed/Chair/W'Chair
          MOVE      F1,ANPATBDS
.
          MOVE      PTFITTLS,F1                  * Transfers - Toilet
          MOVE      F1,ANPATTLS
.
          MOVE      PTFITBTS,F1                  * Transfers - Bath/Shower
          MOVE      F1,ANPATBTS
.
          MOVE      PTFILOCS,F1                  * Locomotion
          MOVE      F1,ANPALOCS
.
          MOVE      PTFISTRS,F1                  * Stairs
          MOVE      F1,ANPASTRS
.
          MOVE      PTFICOMS,F1                  * Comprehension
          MOVE      F1,ANPACOMS
.
          MOVE      PTFIEXPS,F1                  * Expression
          MOVE      F1,ANPAEXPS
.
          MOVE      PTFISCIS,F1                  * Social Interaction
          MOVE      F1,ANPASCIS
.
          MOVE      PTFIPRBS,F1                  * Problem Solving
          MOVE      F1,ANPAPRBS
.
          MOVE      PTFIMEMS,F1                  * Memory
          MOVE      F1,ANPAMEMS
.
          MOVE      ZERO,EXIT
          GOTO      EAFM9999
.
EAFM9800  MOVE      ONE,EXIT
          GOTO      EAFM9999
.
EAFM9999  RETURN
.
.*******************************************************************************
.*                                  EDFM0000               Called by: EXTR0000 *
.*                                                                             *
.* Set up Discharge FIM Score Extract Fields                        CAR 274409 *
.*******************************************************************************
.
EDFM0000  PACK      KEY24,DPVIBILL,SP70
          CALL      RDPTFIM1
EDFM1000  CALL      RKPTFIM1
          BRANCH    OVRCD,EDFM9800
.
          MATCH     PTFIVISN,DPVIBILL
          GOTO      EDFM9800 IF NOT EQUAL
.
          MATCH     ONEINIT,PTFIDELT
          GOTO      EDFM1000 IF EQUAL
.
          MATCH     "D",PTFITYPE
          GOTO      EDFM1000 IF NOT EQUAL
.                                           ******************  Discharge Scores
          MOVE      PTFIEATS,F1                  * Eating
          MOVE      F1,ANPDEATS
.
          MOVE      PTFIGRMS,F1                  * Grooming
          MOVE      F1,ANPDGRMS
.
          MOVE      PTFIBTHS,F1                  * Bathing
          MOVE      F1,ANPDBTHS
.
          MOVE      PTFIUPBS,F1                  * Dressing Upper Body
          MOVE      F1,ANPDUPBS
.
          MOVE      PTFILWBS,F1                  * Dressing Lower Body
          MOVE      F1,ANPDLWBS
.
          MOVE      PTFITLTS,F1                  * Toileting Score
          MOVE      F1,ANPDTLTS
.
          MOVE      PTFIBLMS,F1                  * Bladder Management
          MOVE      F1,ANPDBLMS
.
          MOVE      PTFIBWMS,F1                  * Bowel Management
          MOVE      F1,ANPDBWMS
.
          MOVE      PTFITBDS,F1                  * Transfers - Bed/Chair/W'Chair
          MOVE      F1,ANPDTBDS
.
          MOVE      PTFITTLS,F1                  * Transfers - Toilet
          MOVE      F1,ANPDTTLS
.
          MOVE      PTFITBTS,F1                  * Transfers - Bath/Shower
          MOVE      F1,ANPDTBTS
.
          MOVE      PTFILOCS,F1                  * Locomotion
          MOVE      F1,ANPDLOCS
.
          MOVE      PTFISTRS,F1                  * Stairs
          MOVE      F1,ANPDSTRS
.
          MOVE      PTFICOMS,F1                  * Comprehension
          MOVE      F1,ANPDCOMS
.
          MOVE      PTFIEXPS,F1                  * Expression
          MOVE      F1,ANPDEXPS
.
          MOVE      PTFISCIS,F1                  * Social InteractionR
          MOVE      F1,ANPDSCIS
.
          MOVE      PTFIPRBS,F1                  * Problem Solving
          MOVE      F1,ANPDPRBS
.
          MOVE      PTFIMEMS,F1                  * Memory
          MOVE      F1,ANPDMEMS
.
          MOVE      ZERO,EXIT
          GOTO      EDFM9999
.
EDFM9800  MOVE      ONE,EXIT
          GOTO      EDFM9999
.
EDFM9999  RETURN
.
.*******************************************************************************
.*                                  CLRV0000               Called by: ANSP0000 *
.*                                                                             *
.* Clear the AN-SNAP Extract File Variables                         CAR 274409 *
.*******************************************************************************
CLRV0000  MOVE      SP70,ANPMEMBN
          MOVE      SP70,ANPFUND
          MOVE      SP70,ANPANID
          MOVE      SP70,ANPSNAME
          MOVE      SP70,ANPGNAME
          MOVE      SP70,ANPBDAT
          MOVE      SP70,ANPPCODE
          MOVE      SP70,ANPSEX
          MOVE      SP70,ANPXSDAT
          MOVE      SP70,ANPXENDD
          MOVE      SP70,ANPXEPTY
          MOVE      SP70,ANPAEATS
          MOVE      SP70,ANPAGRMS
          MOVE      SP70,ANPABTHS
          MOVE      SP70,ANPAUPBS
          MOVE      SP70,ANPALWBS
          MOVE      SP70,ANPATLTS
          MOVE      SP70,ANPABLMS
          MOVE      SP70,ANPABWMS
          MOVE      SP70,ANPATBDS
          MOVE      SP70,ANPATTLS
          MOVE      SP70,ANPATBTS
          MOVE      SP70,ANPALOCS
          MOVE      SP70,ANPASTRS
          MOVE      SP70,ANPACOMS
          MOVE      SP70,ANPAEXPS
          MOVE      SP70,ANPASCIS
          MOVE      SP70,ANPAPRBS
          MOVE      SP70,ANPAMEMS
          MOVE      SP70,ANPDEATS
          MOVE      SP70,ANPDGRMS
          MOVE      SP70,ANPDBTHS
          MOVE      SP70,ANPDUPBS
          MOVE      SP70,ANPDLWBS
          MOVE      SP70,ANPDTLTS
          MOVE      SP70,ANPDBLMS
          MOVE      SP70,ANPDBWMS
          MOVE      SP70,ANPDTBDS
          MOVE      SP70,ANPDTTLS
          MOVE      SP70,ANPDTBTS
          MOVE      SP70,ANPDLOCS
          MOVE      SP70,ANPDSTRS
          MOVE      SP70,ANPDCOMS
          MOVE      SP70,ANPDEXPS
          MOVE      SP70,ANPDSCIS
          MOVE      SP70,ANPDPRBS
          MOVE      SP70,ANPDMEMS
          MOVE      SP70,ANPXICDE
          MOVE      SP70,ANPXASSO
          MOVE      SP70,ANPXVRCL
          MOVE      SP70,ANPXVERS
          MOVE      SP70,ANPXRPDT
          MOVE      SP70,ANPXRDDT
          MOVE      SP70,ANPMEIPS
          MOVE      SP70,ANPMEIPE
.
CVRV9999  RETURN
.
.******************************************************************************
.*                                  RSUB0000              Called by: ML0000   *
.*                            ReSubmitted Disc Yes/No                         *
.*******************************************************************************
RSUB0000  MOVE      "N",DRGRESUB            * Not re-running period
          LOAD      CVERT,OPTION,TWENTY,TWENTY1,TWENTY2,TWENTY2,TWENTY:
                                 TWENTY,TWENTY
.
RSUB1000  KEYIN     *P1:CVERT,*EL,"Re-Submitting Disk : ",*V2LON,*RV,DRGRESUB;
.
          PACK      DRGRESUB,DRGRESUB,SP70
.
          MATCH     SP70,DRGRESUB           * User selected exit
          GOTO      RSUB9000 IF EQUAL
.
          MATCH     EXITCHAR,DRGRESUB       * User selected exit
          GOTO      RSUB9000 IF EQUAL
.
          REP       UPPLOW,DRGRESUB
.
          MATCH     ANSY,DRGRESUB
          GOTO      RSUB8000 IF EQUAL       * Ok re-running period
.
          MATCH     ANSN,DRGRESUB
          GOTO      RSUB8000 IF EQUAL       * ok not re-running period
.
          BEEP
          GOTO      RSUB1000
.
RSUB8000  MOVE      ZERO,EXIT
          GOTO      RSUB9999 
.
RSUB9000  MOVE      ONE,EXIT
          GOTO      RSUB9999 
.
RSUB9999  RETURN
+
.------------------------------------------------------------
.         CALCD000  Check 23hour stay
.------------------------------------------------------------
CALC0000  MOVE      ZERO,STAYTIME                * initialise duration
          MOVE      "1380",T3HRTIME
.
.         Convert times to numeric hours and minutes
.
          UNPACK    ATIME,CHOUR,ANS,CMIN,ANS,ANS,ANS
          MOVE      CHOUR,IHOUR
          MOVE      CMIN,IMIN
          UNPACK    DTIME,CHOUR,ANS,CMIN,ANS,ANS,ANS
          MOVE      CHOUR,NUMHOUR
          MOVE      CMIN,NUMMIN
.
.         Get the number of whole days the patient has been in
.
          DAYSEP    ADATE,DDATE,FORM5
          COMPARE   ZERO,FORM5                   * valid no. of days ?
          GOTO      CALC9999 IF LESS             * no - invalid dates
          GOTO      CALC0050 IF EQUAL            * yes - same day
.
          COMPARE   TWO,FORM5             * same or next day? Must be longer  
          GOTO      CALC0095 IF NOT LESS  * than a 23 hour stay
.
.         Not same day as patient arrived
.
          IF        IMIN > 0
            ADD       ONE,IHOUR
            ASSIGN    (STAYTIME + (60-IMIN)),STAYTIME
          ENDIF
          ASSIGN    (STAYTIME + ((TWENTY4-IHOUR)*60)),STAYTIME
          ASSIGN    (STAYTIME + ((FORM1 - 1) * DAYMIN)),STAYTIME
.
          ASSIGN    (STAYTIME + NUMMIN + (NUMHOUR*60)),STAYTIME
          IF        STAYTIME<T3HRTIME
            GOTO      CALC9999
          ENDIF
          GOTO      CALC0090
.
.         Still same day patient arrived
.
CALC0050  IF        NUMMIN < IMIN
            ADD       ONE,IHOUR
            ADD       SIXTY,NUMMIN
          ENDIF
          ASSIGN    (STAYTIME + ((NUMHOUR - IHOUR) * 60)),STAYTIME
          ASSIGN    (STAYTIME + (NUMMIN - IMIN)),STAYTIME
.
CALC0090  IF        STAYTIME<T3HRTIME
            GOTO      CALC9999
          ENDIF
.
CALC0095  CLEAR     ERRMSG
          APPEND    "Warning EW031 - Patient Duration greater than ",ERRMSG
          APPEND    "23 hours for a private day facility. ",ERRMSG
          APPEND    SP70,ERRMSG
          RESET     ERRMSG
          MOVE      ONE,WRNFLAG
          CALL      ERR0000         * Print error
.
CALC9999  RETURN
+
.------------------------------------------------------------
.         CALT0000  Check 24hour stay
.------------------------------------------------------------
CALT0000  MOVE      ZERO,STAYTIME                * initialise duration
          MOVE      "1440",T4HRTIME
.
.         Convert times to numeric hours and minutes
.
          UNPACK    ATIME,CHOUR,ANS,CMIN,ANS,ANS,ANS
          MOVE      CHOUR,IHOUR
          MOVE      CMIN,IMIN
          UNPACK    DTIME,CHOUR,ANS,CMIN,ANS,ANS,ANS
          MOVE      CHOUR,NUMHOUR
          MOVE      CMIN,NUMMIN
.
.         Get the number of whole days the patient has been in
.
          DAYSEP    ADATE,DDATE,FORM5
          COMPARE   ZERO,FORM5                   * valid no. of days ?
          GOTO      CALT9999 IF LESS             * no - invalid dates
          GOTO      CALT0050 IF EQUAL            * yes - same day
.
          COMPARE   TWO,FORM5             * same or next day? Must be longer
          GOTO      CALT0095 IF NOT LESS  * than a 24 hour stay
.
.         Not same day as patient arrived
.
          IF        IMIN > 0
            ADD       ONE,IHOUR
            ASSIGN    (STAYTIME + (60-IMIN)),STAYTIME
          ENDIF
          ASSIGN    (STAYTIME + ((TWENTY4-IHOUR)*60)),STAYTIME
          ASSIGN    (STAYTIME + ((FORM1 - 1) * DAYMIN)),STAYTIME
.
          ASSIGN    (STAYTIME + NUMMIN + (NUMHOUR*60)),STAYTIME
          IF        STAYTIME<T4HRTIME
            GOTO      CALT9999
          ENDIF
          GOTO      CALT0090
.
.         Still same day patient arrived
.
CALT0050  IF        NUMMIN < IMIN
            ADD       ONE,IHOUR
            ADD       SIXTY,NUMMIN
          ENDIF
          ASSIGN    (STAYTIME + ((NUMHOUR - IHOUR) * 60)),STAYTIME
          ASSIGN    (STAYTIME + (NUMMIN - IMIN)),STAYTIME
.
CALT0090  IF        STAYTIME<T4HRTIME
            GOTO      CALT9999
          ENDIF
.
CALT0095  CLEAR     ERRMSG
          APPEND    "Warning EW212 - Patient duration greater than ",ERRMSG
          APPEND    "24 hours for a day facility. ",ERRMSG
          APPEND    SP70,ERRMSG
          RESET     ERRMSG
          MOVE      ONE,WRNFLAG
          CALL      ERR0000         * Print error
.
CALT9999  RETURN
+
. ******************************************************************************
. * I/O routines for temporary URNO Counter File                    CAR 274409 *
. ******************************************************************************
.
RDSWORK1  READ      WORK1,KEY8;;
          RETURN
.
RDKWORK1  MOVE      ZERO,OVRCD
          READKS    WORK1;XXXXURNO,XXXXCNTR
          GOTO      OVERCOND IF OVER
          RETURN
.
RDWORK1   MOVE      ZERO,OVRCD
          READ      WORK1,KEY8;XXXXURNO,XXXXCNTR
          GOTO      OVERCOND IF OVER
          RETURN
.
UPWORK1   UPDATE    WORK1;XXXXURNO,XXXXCNTR
          RETURN
.
WRWORK1   WRITE     WORK1,KEY8;KEY8,XXXXCNTR
          RETURN
.
+
.==============================================================================
.
          INC       PATHSPKY
          INC       STD001IO
.
          INC       CALCAGE                 * Calculate patients age
          INC       CALCDAYS                * Calculate diff between dates
          INC       EXCLNEWB
          INC       GETDRG
          INC       PATCODKY                * Input code
          INC       PATDEFCL                * routine DCLM0000
          INC       PATGILOS                * Get intended LOS         D*115102
          INC       PATHGPKY                * Input health fund group
          INC       PATM10T9                * Map ICD10 to ICD9 codes
          INC       CLPMSPX2                * Clear PMSVX1FD           *I-53371
          INC       CLPMSVX1
          INC       PATMCHRD                * Miscellaneous Charges read routine
          INC       PATITMRD
          INC       PATDDHRD
          INC       TFILENAM                * Generate Temp File Name
          INC       GETEFDRG
          INC       NHOSPDAY
.
          INC       IBASEQIO/INC            * Sequential Numbers File
          INC       PAT3MIIO/INC            * ICD9 mapping file
          INC       PATCHCIO/INC            * Care type changes
          INC       PATCODIO/INC            * Codes file
          INC       PATCMPIO/INC            * Complex mapping file
          INC       PMSCNOIO/INC            * Credit note summary file
          INC       PATFIMIO/INC            * FIM Score File
          INC       PATFX1IO/INC
          INC       PATDADIO/INC            * Transfer destination file
          INC       PATDDHIO/INC            * HF History file
          INC       PATVADIO/INC            * Transfer destination file
          INC       PATDO1IO/INC            * Doctors file
          INC       PATDSCIO/INC            * Discharge file
          INC       PATDTRIO/INC            * Debtor file
          INC       PATECDIO/INC            * Patient episode disease file
          INC       PATECOIO/INC            * Patient episode operation file
          INC       PMSFCIIO/INC            * Credit note file
          INC       PATFN1IO/INC            * Health fund file
          INC       PATHSPIO/INC            * Hospital file
          INC       PATHGPIO/INC            * Health fund group file
          INC       PATICDIO/INC            * ICD Disease code File
          INC       PATICOIO/INC            * ICD Operation Code File
          INC       PATICUIO/INC            * ICU file
          INC       PATINVIO/INC            * Invoice file
          INC       PATITMIO/INC            * Item file
          INC       PATMA1IO/INC            * Master file
          INC       PATMCHIO/INC            * Miscellaneous charges file
          INC       PATMI1IO/INC            * Admission file
          INC       PATMMBIO/INC            * Medical records file
          INC       PMSMTIIO/INC            * Misc.Theatre item file
          INC       PATPGRIO/INC            * Patient grouper file
          INC       PATTRNIO/INC            * Bed transfer file
          INC       PMSAPGIO/INC            * Program Details Ext File
          INC       PMSUPGIO/INC            * Program Details File
          INC       PATVISIO/INC            * Visit file
          INC       PMSVX1IO/INC            * Visit extension file
          INC       PMSPX2IO/INC
          INC       PATCFAIO/INC            * Claim Code Future Actions file
          INC       PATWC1IO/INC            * Workers Compensation Claims file
          INC       PATWMAIO/INC            * Motor Accident Board Claims file
          INC       PMSCCDIO/INC
.
          INC       MEHLEGIO/INC            * Mental Health legal status
          INC       MEHDLSIO/INC            * Mental Health legal status
          INC       WEBERRIO/INC            * Web Server Error Logging
          INC       PMSEDGIO/INC       * Effective DRG Dates
+
.
