.--------------------------------------------------------------------------
. Program       : PATWEB94
.
. Function      : Key Word Code Search Server
.
. Modifications : 
.--------------------------------------------------------------------------
. V11.05.02 20/03/2025  Davin         TSK 0956210
.           Add ICD10 Ed.13 - Go-live Date PTCNGDX3 (Sect.130 Pos.86)
. V11.05.01 25/02/2025  Don Nguyen    TSK 0952080
.           Fixed previous/next button link URL's to also include Contract Type,
.           Contract (Health Fund) & Table; LTGR0000 & NXGR0000
. V11.04.01 13/06/2024  Nikitha B     TSK 0944592
.           Rectified listing of MBS items via keyword at SPTIKA15.
. V11.03.02 03/08/2022  Thanh T       TSK 0865577
.           Packed PT0DDESC and PT0DDSC2 with spaces
. V11.03.01 25/11/2022  Bella Turco   TSK 0921957
.           Removed duplicate "No more records" row from SPTKDA00              
. V11.02.05 04.10.2022  DA Sarkies    TSK 0924898
.           Added code to display full misc item description is hospital is 
.           nzprivate
. V11.02.04 14.09.2022  DA Sarkies    TSK 0909756
.           Increased size of ITEMDESC to 90. Changed KEY40 to KEY90 to hold 
.           NZ Description
. V11.02.03 21/07/2022  Bella Turco   TSK 0921957
.           Continued adding PTCNNRTD parameter and "No more records" message
. V11.02.02 19/07/2022  Bella Turco   TSK 0921957
.           Added NOMORE00 - Display "No more records" at end of list
.           Added PTCNNRTD - Displays number of rows set by parameter value
. V11.02.01 30/03/2022  Davin         TSK 0917793
.           Add ICD10 Ed.12 - Go-live Date PTCNGDX2 (Sect.128 Pos.231)
.--------------------------------------------------------------------------
. V11.00.07 20/10/2020  Tracey Nguyen  TSK 0888079
.           Added tag DRGS0800 to return DRG version details in SPTKDA40
. V11.00.06 18/05/2020  Peter Vela     TSK 0871644
.           Added ADDMSC00 to SPTNKA00
. V11.00.05 27/04/2020  J.Tan          TSK 0838262
.           Fixed tag for EFFDATES
. V11.00.04 21/04/2020  J.Tan          TSK 0838262
.           Fixed Next and Previous MBS items
. V11.00.03 16/03/2020  Peter Vela     TSK 0871644
.           Added validation in SPTNKA00 for OPCNPTMC
.           10/04/2020  J.Tan          TSK 0838262
.           Fixed display colspan and order of MBS items
. V11.00.02 19/03/2020  J.Tan          TSK 0838262
.           Fixed Item keyword search
. V11.00.01 24/02/2020  J.Tan          TSK 0838262
.           Added Effective from and to date to MBS Item file
. V10.15.01 10/02/2020  Peter Vela     TSK 0871644
.           Fixed SPTNKA10 to check NZPMCH health fund table
. V10.14.01 03/10/2019  Thanh T        TSK 0882260
.           Changed SPTKDA00 to cater for DGR version 10 and 11 
.--------------------------------------------------------------------------
. V10.10.02 12/07/2017  Davin          TSK 0840832
.           Item Code Search - display item code first in results list if it is
.           entered as the keyword and exists on opriteaf (ITMALL00/ITMSPC00)
. V10.10.01 17/03/2017  Davin          TSK 0833093     HDP 2017/2018
.           Add PTCNGDVX for ICD10 Ed.10 Go-live Date (Sect.110 Pos.85)
. V10.08.01 29/06/2016 Nicole Torrisi TSK 0820430
.           Fixed issue with output of ICD code description in SPTOCA20/30
. V10.06.01 17/03/2015  Davin         CAR 311669      HDP 2015/16
.           Add PTCNGDV9 for ICD10 Ed.9 Go-live Date (Sect.110 Pos.77)
. V10.04.03 07/05/2014  J.Tan            CAR 300260
.           Mods checking previous record after finding NZ Inactive Item
. V10.04.02 24/04/2014  Don Nguyen    CAR 299270
.           Moved search/add logic for MSCARRAY from DMSCRW00 into new routine
.           ADDMSC00. Added SRCHHOSP to URL string for LTGR0000 and NXGR0000.
. V10.04.01 13/02/2013  Patrick Adair CAR 273419
.           Amended ICD Search displays to show 200/100/70 char descriptions
. V10.03.04 19.03.2013  B.G.Ackland   CAR 288225
.           Enhancement for JSON return to enable AJAX call from Mobility Suite
.           Adding Coded Health Issues
.           New Tag %PATWEB94.03.006
. V10.03.03 23/04/2013  Davin         CAR 284420      HDP 2013/14
.           Add PTCNGDV8 for ICD10 Ed.8 Go-live Date (Sect.110 Pos.69)
. V10.03.02 29/01/2013  J.Tan         CAR 246749
.           Mods checking for Expired Operating rooms item table (opriteaf)
. V10.03.01 16/03/2012  J.Tan         CAR 259879
.           Mods checking for Active/Inactive NZ Misc.charge
. V10.01.01 20/12/2010  Mike Laming   CAR 233046
.           Mods to Misc.Charges PATMCHFD - Key change, logic changes
. V10.00.02 18/06/2010  Mike Laming    CAR 224240
.           Re-compiled for PATKCDIO & PATKCOIO - ICD10 Ed.7 fix (CAR 219246)
. V10.00.01 30/04/2010  J.Tan          CAR 220887
.           Mods checking for Active/Inactive of Misc.charge
. V9.12.03  04/02/2010  Jill Parkinson CAR 214072
.           Mods to output PTITDESC in updateparent
. V9.12.02  25/01/2009  Saroeun Soeur  CAR 211805
.           fixed quote and double quote issue in NZ, MDESC - MSCSRH10
. V9.12.01  17/12/2009  Peter McMullen CAR 210130
.           Convert to newer Dr name format routine DOCNM000
. V9.11.01  03/03/2009  Ebon Clements CAR 191013
.           Added expected LOS to casemix code search updatePatent - SPTCMA00 
. V9.10.01  06/06/2008  Jill Habasque CAR 166095
.           Mods to output PT0ODESC and PT0DDESC
. V9.09.02  20/06/2007  Ebon Clements CAR 143030
.           Fixed colspan in SPTIKA00
. V9.09.01  19/06/2007  Jill Habasque CAR 142154                    
.           Changed NZ miscellaneous keyword search to use all miscellaneous
.           items (not just default claim code items)
. V9.08.08  08/05/2007  Mike Laming  CAR 137125 HDP 2007 DRG 5.2
.           Mods to PATDGWFD - Add field PTDWDRGV (add to Keys)
. V9.08.07  18/04/2007  Peter Vela     CAR 135210
.           Added Misc Change Indicator to SPTIKA00 MBS Item Maintenance
. V9.08.06  15/03/2007  Neelkamal Pyla CAR 122996
.           Added Active Column to SPTIKA00 MBS Item Maintenance 
. V9.08.05  03/01/2007  Jill Habasque CAR 120009
.           Mods to read nzpmchaf if cfeetyp=5 (nzprivate)
. V9.08.04  04/11/2006  Peter Vela    CAR 126013
.           Fixed colspan SPTIKA00
. V9.08.03  20/11/2006  Ebon Clements CAR 120007
.           Added NZ private misc charge functionality to SPTNKA00
. V9.08.02  17/11/2006  Peter Vela    CAR 124538
.           Added Misc Grp and Type of Certificate to SPTIKA00 MBS Item
.           Maintenance
. V9.08.01  15/11/2006  J.Tan         CAR 120003
.           Removed Suggested class.from MBS screen for NZ Private
. V9.05.02  12/04/2006  Mike Laming   CAR 99990
.           Add Clipboard Icon to DRG Code Maintenance at label SPTKDA30
. V9.05.01  09/03/2006  Ebon Clements CAR 78533
.           Mods for PATCODTM - Hospital specific category codes
. V9.04.03  23/11/2005  J.Tan     CAR 55176  
.           Added LGA Search
. V9.04.02  17/02/2005  Lina Vo   CAR 56404  
.           Changed program to read Operating Room item file with new key size.
. V9.04.01  29/09/2004  Lina Vo   CAR 53798  
.           Put Misc. Charge keyword search Heading in server.
.           Changed program to use Hospital PTHSDCLM when multi hospital.
. V9.03.07  27/07/2004  J.Tan     CAR 52075  
.           Fixed Misc.keyword search to use patmki file
. V9.03.06  22/06/2004  Henry Son                CAR 49037
.           VIC DHS 2004 changes - ICD10 Ed.4 include Keyword
.           search file includes.
. V9.03.05  22/12/2003  Sylvek Litewka  CAR 45685
.           VIC DHS 2003 changes - ICD10v3 changes. Modified procedures 
.           ICSS0800 and OCSS0800 to display new 'Sex Edit' values.
.           16/12/2003  Sylvek Litewka  CAR 20222
.           Modified ICD Code Search procedures SPTDCA00 and SPTOCA00 to list
.           ICD10 V2 or ICD10 V3 codes based on the patient Discharge Date. 
.           Modified MAIN1700, MAIN1800 and VALCOD00 to use common IO routines
.           RDPTICD1 and RDPTICO1 when reading ICD files.
. V9.03.04  14/11/2003  Lina Vo       CAR 41010
.           Added GST fields to View MBS items screen.              
. V9.03.03  10/10/2003  Lina Vo       CAR 41778
.           Removed SETFONT & ENDFONT from SPTCMA00 to display casemix 
.           description in black.             
. V9.03.02  01/09/2003  Lina Vo       CAR 40497
.           Changed index and read of patmchgf to include effective date.
.           Changed search default misc charge - SPTNKA00.     
. V9.03.01  20/06/2003  Lina Vo       CAR 36485
.           Added MBS current & new file search functionality. 
. V9.02.11  24/03/2003  Jill Habasque SRF 36489
.           Changed casemix code descriptions to display in black
. V9.02.10  05/03/2003  J.Tan  SRF 36969
.           Added daycase suggested class.
. V9.02.09  21.11.2002  Peter Vela               SRF 33349
.           Added functionality for lookup screen, keyword search 
.           (patweb9410002.html)
. V9.02.08  03.10.2002  Lina Vo                  SRF 22723
.           Changed Terminology of MBS to Proc for NZ.  Used PTCNHDPS (read
.           from controlf) to determine whether NZ user.
. V9.02.07  24.09.2002  Pat Dirito               SRF 22495
.           Added call to JAVDES00(strip quotes from string) to ICD10 & 9
.           searches.
. V9.02.06  07.08.2002  Pat Dirito               SRF 18475
.           Added functionality to display ICD9 search.
. V9.02.05  29.05.2002 Dean Cramer       
.           Recompile after changes to PATCMCFD 
. V9.02.04  16.05.2002 Dean Cramer       
.           Include Casemix Codes Search
.           Include clinical speciality in DRG search server
.           Remove Show Inactive tests from DRG - irrelevant
. V9.02.03  12/04/2002 Ashwin
.           Fix reportno in Previous and Next link
. V9.02.02  16/01/2002 Pat Dirito
.           Now Diagnosis Code search is only returning posting
.           records.
. V9.02.01  09.01.2002 Kuldeep,Ashwin
.           Add Item Code Search
. V9.00.00  03/08/2001 HPS Sachin
.           Added MISC0000 for Miscellaneous Code Search frame  
.-----------------------------------------------------------------------------
.                 V5.10.B01 19.04.2001 Pat Dirito
.                           Changed all instances of Disease to Diagnosis
.                           23.03.2001 Katie Nelson 
.                           Changes made at Taranaki ported from 5.08
.                 V5.09.02 27.12.2000 Pat Dirito  
.                          Recompiled for IBAWEBCD changes.
.                 V5.08.05 27.10.2000 K.C.Nelson 
.                          replaced single quote with space on ICD10 operation
.                          code description to stop javascript error.
.                 V5.08.04 13.10.2000 K.C.Nelson 
.                          Added select on validation code
.                 V5.08.03 25.05.2000 B.G.Ackland
.                          Fixed Links to Javascript
.                 V5.08.02 18.05.2000 Pat Dirito   
.                          Added relative pathing to images                 
.                 V5.08.01 16.05.2000 Katie Nelson 
.                          Port from 5.07                                   
.                 V5.07.04 28.04.2000 Katie Nelson 
.                          Changed VALDCODE to output spaces if invalid code
.                          04.04.2000 Katie Nelson 
.                          Added Doctor code validation              
.                          20.03.2000 Katie Nelson 
.                          Changed KEY3 to KEY4, KEY18 to KEY19, 
.                          DRGCODES to DIM 4 for increase in DRG codes size.
.                 V5.07.03 18.02.2000 Pat Dirito 
.                          Added validation of category codes       
.                          18.02.2000 Pat Dirito 
.                          ShowMbs now incorporates report no       
.                 V5.07.02 20.01.2000 B.G.Ackland
.                          Changed Open for ICD Files for ICD10 to Work
.                 V5.07.01 20.12.1999 Katie Nelson      
.                          Recompiled for IBAWEBDF/IBAWEBCD
.                 V5.07.00 28/06/1999 Nicole Harrington
.                          Ported from 6.06 - 5.07
.----------------------------------------------------------------------
.                 V6.06.02 25.05.1999 Katie Nelson
.                          Swapped DPCODE and DDESC in updateParent function
.                          Swapped OPCODE and ODESC in updateParent function
.                 V6.06.01 07.05.1999 Pat Dirito 
.                          Added ";" to the last line of 
.                          NXGR and LTGR for Update PREV and NEXT buttons
.                 V6.06.00 11.02.1998 B.G.Ackland
.                          Created Program
.
.----------------------------------------------------------------------
          INC       IBAWEBDF    
          INC       IBAGSTFD/INC      * GST master file
          INC       NZPMCHFD/INC
          INC       PATCONFD/INC
          INC       PATKDRFD/INC
          INC       PATDGWFD/INC
          INC       PATHSPFD/INC
          INC       PATIKIFD/INC
          INC       PATIK1FD/INC
          INC       PATKCMFD/INC
          INC       PATITMFD/INC
          INC       PATLGAFD/INC        
          INC       PATKLGFD/INC        
          INC       PATDO1FD/INC
          INC       PATDICFD/INC
          INC       PATKCDFD/INC
          INC       PATKCOFD/INC
          INC       PATOICFD/INC
          INC       PATICDFD/INC
          INC       PATICOFD/INC
          INC       PATMCHFD/INC            * HPS  CODE
          INC       PATMKIFD/INC
          INC       PATCMCFD/INC                              
          INC       OPRITEFD/INC
          INC       OPRCONFD/INC
.
COUNT     FORM      3
CURRDATE  DIM       8
SAVECODE  DIM       10   * Save Validation Code
RPTNO     FORM      1
OPRITM01  DIM       1           * Item Indicator
LINK2PRT  FORM      1           * Key for Keyword index
ITEMSTAT  FORM      1
CASESTAT  FORM      1
MBSITEMN  DIM       9
MBSEFFDT  DIM       8
MULTHOSP  DIM       3
DEFCLMFL  FORM      1 
DIM3      DIM       3 
DIM6      DIM       6 
DIM8      DIM       8 
DIM12     DIM       12
DIM3A     DIM       3
DIM20A    DIM       20
DIM20B    DIM       20
DIM20C    DIM       20
DIM60     DIM       60
DRGCODES  DIM       4
DOCTCODE  DIM       6
DRGVERZ   DIM       3                                                 *I-137125
DRGVDESZ  DIM       4                                                 *I-137125
DV1       DIM       1                                                 *I-137125
DV2       DIM       1                                                 *I-137125
ENDNAME   DIM       80
EFFDATES  DIM       8
MSCARRAY  DIM       9[99]
ICDDCODE  DIM       9
ICDOCODE  DIM       9
CASECODE  DIM       9
DISPDESC  DIM       200
JAVSNAME  DIM       80
KEY21A    DIM       21
KEY29A    DIM       29
LNK2PRT   FORM      1
VALDTYPE  FORM      1    * Validation Type
VALCATEG  DIM       2    * Validation Category
VALDCODE  DIM       10   * Validation Code
VALDNAME  DIM       40   * Validation Name
USNGICD9  DIM       1
DISCHDTE  DIM       8    * Discharge Date
.
STRTNAME  DIM       80
SAVKEY34  DIM       34
SAVKEY56  DIM       56
SAVKEY24  DIM       24
SAVKEY19  DIM       19
SAVKEY9   DIM       9
SAVKEY4   DIM       4
SRCHHOSP  DIM       3
SRCHCLAM  DIM       3
SRCHCNTR  DIM       6
SRCHTABL  DIM       8
.
NEWTITLE  DIM       30
TITLE01   INIT      "MBS Item Search Engine"
TITLE02   INIT      "DRG Code Search Engine"
TITLE03   INIT      "ICD9 Diagnosis Code Search Engine"
TITLE04   INIT      "ICD9 Operation Code Search Engine"
TITLE05   INIT      "MBS/DRG/ICD Code Search Server"   
TITLE11   INIT      "Item Code Search"
.
GSTFREE   INIT      "GST Free"
GSTPAYBL  INIT      "GST Payable"
GSTEITHR  INIT      "Either"
.
SETFONT   DIM       20
ENDFONT   DIM       7
.
.------------------------------------------------------------
PRGID     INIT      "PATWEB94"
VERSION   INIT      "V12.01.00"
PRGNAM    INIT      "MBS/DRG/ICD/CMC Key Word Search Server"
.------------------------------------------------------------
.
          CALL      WEBINT00       * Initialise Fifo Etc.
          CALL      INIT0000       * Open Files
.
MAIN1000  CALL      WEBRED00       * Read Fifo WEBPID and USERID
.
          COMPARE   "999",REPORTNO * End Server Process on Report Option 999
          GOTO      MAIN9999 IF EQUAL
.
          PACK      CURRDATE,CCC,CYY,CMM,CDD
          REP       " 0",CURRDATE
.
          BRANCH    REPORTNO,MAIN1100,MAIN1200,MAIN1300,MAIN1400:
                             MAIN1500,MAIN1600,MAIN1700,MAIN1800:
                             MAIN1900,MAIN2000,MAIN2100,MAIN2200:
                             MAIN2300,MAIN2400
.
          PACK      WEBTITLE,PRGID,SP1,VERSION,SP1,PRGNAM,SP70
          MOVE      "INVALID OPTION",WEBTITLE
          CALL      WEBERR00   * Create Output File and Write HTML Page Header
          GOTO      MAIN1000
.
MAIN1100  CALL      HEADER00    
          GOTO      MAIN1000
.
MAIN1200  CALL      HEADER00    
          GOTO      MAIN1000
.
MAIN1300  CALL      HEADER00    
          GOTO      MAIN1000
.
MAIN1400  CALL      HEADER00    
          GOTO      MAIN1000
.
MAIN1500  PACK      KEY17,MBSITEMN,MBSEFFDT,SP70
          CALL      PATITMRD
          IF        OVRCD=0
            CALL      HEADER00    
          ELSE
            MOVE      "Invalid MBS Item",WEBTITLE
            CALL      WEBERR00
          ENDIF
          GOTO      MAIN1000
.
MAIN1600  MOVE      DRGCODES,KEY4
          MOVE      "999",KEY3
          PACK      KEY7,KEY4,KEY3,SP10   * last DRG version          *I-137125
          CALL      RSPTDGW1
          CALL      RPPTDGW1
          IF        OVRCD=0
            MATCH     PTDWDRGC,KEY4         * same DRG code ?         *I-137125
            IF        @EQUAL
              CALL      HEADER00    
              GOTO      MAIN1000
            ENDIF
          ENDIF
          MOVE      "Invalid DRG Code",WEBTITLE
          CALL      WEBERR00
          GOTO      MAIN1000
.
MAIN1700  MOVE      ICDDCODE,KEY9
          CALL      RDPTICD1 
          IF        OVRCD=0
            CALL      HEADER00    
          ELSE
            MOVE      "Invalid ICD10 Diagnosis Code",WEBTITLE
            CALL      WEBERR00
          ENDIF
          GOTO      MAIN1000
.
MAIN1800  MOVE      ICDOCODE,KEY9
          CALL      RDPTICO1 
          IF        OVRCD=0
            CALL      HEADER00    
          ELSE
            MOVE      "Invalid ICD10 Operation Code",WEBTITLE
            CALL      WEBERR00
          ENDIF
          GOTO      MAIN1000
.
MAIN1900  CALL      VALCOD00
          GOTO      MAIN1000
.
MAIN2000  CALL      HEADER00 
          GOTO      MAIN1000
.
MAIN2100  CALL      HEADER00                * Item Search
          GOTO      MAIN1000
.
MAIN2200  CALL      HEADER00                               
          GOTO      MAIN1000
.
MAIN2300  MOVE      CASECODE,KEY9
          CALL      RDPTCMC1
          IF        OVRCD=0
            CALL      HEADER00    
          ELSE
            MOVE      "Invalid Case Mix Code",WEBTITLE
            CALL      WEBERR00
          ENDIF
          GOTO      MAIN1000
.
MAIN2400  CALL      HEADER00           * LGA search        
          GOTO      MAIN1000
.
MAIN9999  MOVE      "SERVER SHUTDOWN COMPLETE",WEBTITLE
          CALL      WEBERR00
          STOP
.------------------------------------------------------------
. Open Files and Initialize Variables
.------------------------------------------------------------
INIT0000  OPEN      PATKDRA1,"patkdraf"
          OPEN      PATKDRA2,"patkdraf"
          OPEN      PATDGWA1,"patdgwaf"
          OPEN      PATDGWA3,"patdgwaf"
          OPEN      PATHSPA1,"pathspaf"
          OPEN      PATIKIA1,"patikiaf"
          OPEN      PATIKIA2,"patikiaf"
          OPEN      PATKCMA1,"patkcmaf"
          OPEN      PATKCMA2,"patkcmaf"
          OPEN      PATITEM1,"patitemn"
          OPEN      PATITEM2,"patitemn"
          OPEN      PATCODE1,"patcodes"
          OPEN      PATDICA1,"patdicaf"
          OPEN      PATDICA2,"patdicaf"
          OPEN      PATKCOA1,"patkcoaf"
          OPEN      PATKCOA2,"patkcoaf"
          OPEN      PATOICA1,"patoicaf"
          OPEN      PATOICA2,"patoicaf"
          OPEN      PATDO1A1,"patdo1af"
          OPEN      PATLGAA1,"patlgaaf"
          OPEN      PATKLGA1,"patklgaf"
          OPEN      PATKLGA2,"patklgaf"
          OPEN      PATMCHG2,"patmchgf"     * HPS CODE
          OPEN      PATMCHG1,"patmchgf"
          OPEN      PATMKIA1,"patmkiaf"
          OPEN      PATMKIA2,"patmkiaf"
          OPEN      PATMKIA3,"patmkiaf"
          OPEN      PATCMCA1,"patcmcaf"                  
          OPEN      PATCMCA2,"patcmcaf"                  
          OPEN      OPRITEA1,"opriteaf"
          OPEN      OPRITEA2,"opriteaf"
          OPEN      OPRITEA4,"opriteaf"
          OPEN      NZPMCHA1,"nzpmchaf"
          OPEN      NZPMCHA3,"nzpmchaf"
.
          CALL      OPICO1
          CALL      OPICO2
          CALL      OPICD1
          CALL      OPICD2
.
          CALL      OPKCO1
          CALL      OPKCO2
          CALL      OPKCD1
          CALL      OPKCD2
.
          OPEN      IBAGSTA1,"ibagstaf"
          OPEN      CONTROLF,"controlf"
          READ      CONTROLF,ZERO;*43,IBCNMHOS
          READ      CONTROLF,EIGHTY;*250,PTCNHDPS
          READ      CONTROLF,TEN9;*212,CFEETYP
          READ      CONTROLF,HUND13;*66,OPCNPTMC
          READ      CONTROLF,HUND25;*238,PTCNNRTD
.
          IF        IBCNMHOS=1
            OPEN      MLTCODA1,"mltcodaf"
            OPEN      MLTCODA2,"mltcodaf"
          ENDIF
.
          MOVE      ZERO,F2
          MOVE      PTCNNRTD,F2
          IF        F2 = 0
            MOVE      "10",PTCNNRTD
          ENDIF
.
          RETURN
.------------------------------------------------------------
. Clear Parameters
.------------------------------------------------------------
CLRPAR00  MOVE      ZERO,REPORTNO
          MOVE      SP70,TEMPLATE
          MOVE      SP70,KEYWORDS
          MOVE      SP70,EFFDATES
          MOVE      SP70,MULTHOSP
          MOVE      ZERO,VALDTYPE
          MOVE      SP70,VALCATEG
          MOVE      SP70,VALDCODE
          MOVE      SP70,VALDNAME
          MOVE      ZERO,NORECORD
          MOVE      ZERO,STARTNUM
          MOVE      ZERO,ITEMSTAT
          MOVE      ZERO,CASESTAT
          MOVE      SP70,MBSITEMN
          MOVE      SP70,MBSEFFDT
          MOVE      SP70,DRGCODES
          MOVE      SP70,ICDDCODE
          MOVE      SP70,ICDOCODE
          MOVE      SP70,CASECODE
          MOVE      SP70,OPRITM01
          MOVE      SP70,USNGICD9
          MOVE      SP70,DISCHDTE
          MOVE      SP70,SRCHHOSP
          MOVE      SP70,SRCHCLAM
          MOVE      SP70,SRCHCNTR
          MOVE      SP70,SRCHTABL
          MOVE      ONE,COUNT
          WHILE     COUNT < HUNDRED
            MOVE      SP70,MSCARRAY[COUNT]  * Misc charge array
            ADD       ONE,COUNT
          DO
.
          MOVE      ZERO,COUNT
          RETURN
.------------------------------------------------------------
. Set Parameters
.------------------------------------------------------------
SETPAR00  MATCH     "reportno=",QRYNAME
          IF        @EQUAL
            MOVE      QRYDATA,REPORTNO
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "template=",QRYNAME
          IF        @EQUAL
            MOVE      QRYDATA,TEMPLATE
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "valdtype=",QRYNAME
          IF        @EQUAL
            MOVE      QRYDATA,VALDTYPE
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "valcateg=",QRYNAME
          IF        @EQUAL
            MOVE      QRYDATA,VALCATEG
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "valdcode=",QRYNAME
          IF        @EQUAL
            MOVE      QRYDATA,VALDCODE
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "valdname=",QRYNAME
          IF        @EQUAL
            MOVE      QRYDATA,VALDNAME
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "keywords=",QRYNAME
          IF        @EQUAL
            MOVE      QRYDATA,KEYWORDS
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "effdates=",QRYNAME
          IF        @EQUAL
            UNPACK    QRYDATA,CDAY,KEY1,MTHNAM3,KEY1,CCENT,CYEAR
            CALL      SETMTH00              * Set CMON from MTHNAM3
            PACK      EFFDATES,CCENT,CYEAR,CMON,CDAY,SP70
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "multhosp=",QRYNAME
          IF        @EQUAL
            PACK      MULTHOSP,QRYDATA,SP10
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "norecord=",QRYNAME
          IF        @EQUAL
            MOVE      QRYDATA,NORECORD
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "startnum=",QRYNAME
          IF        @EQUAL
            MOVE      QRYDATA,STARTNUM
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "itemstat=",QRYNAME
          IF        @EQUAL
            MOVE      QRYDATA,ITEMSTAT
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "mbsitemn=",QRYNAME
          IF        @EQUAL
            MOVE      QRYDATA,MBSITEMN
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "mbseffdt=",QRYNAME
          IF        @EQUAL
            MOVE      QRYDATA,MBSEFFDT
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "drgcodes=",QRYNAME
          IF        @EQUAL
            MOVE      QRYDATA,DRGCODES
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "drgversn=",QRYNAME
          IF        @EQUAL
            MOVE      QRYDATA,DRGVERZ 
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "icddcode=",QRYNAME
          IF        @EQUAL
            MOVE      QRYDATA,ICDDCODE
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "icdocode=",QRYNAME
          IF        @EQUAL
            MOVE      QRYDATA,ICDOCODE
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "casecode=",QRYNAME
          IF        @EQUAL
            MOVE      QRYDATA,CASECODE
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "usngicd9=",QRYNAME
          IF        @EQUAL
            MOVE      QRYDATA,USNGICD9
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "dischdte=",QRYNAME
          IF        @EQUAL
            MOVE      QRYDATA,DISCHDTE
            PACK      ICDRDDTE,DISCHDTE,SP70
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "casestat=",QRYNAME
          IF        @EQUAL
            MOVE      QRYDATA,CASESTAT
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "opritm01=",QRYNAME
          IF        @EQUAL
            MOVE      QRYDATA,OPRITM01
            PACK      OPRITM01,OPRITM01,SP70
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "srchhosp=",QRYNAME
          IF        @EQUAL
            PACK      SRCHHOSP,QRYDATA,SP70
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "srchclam=",QRYNAME
          IF        @EQUAL
            PACK      SRCHCLAM,QRYDATA,SP70
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "srchcntr=",QRYNAME
          IF        @EQUAL
            PACK      SRCHCNTR,QRYDATA,SP70
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "srchtabl=",QRYNAME
          IF        @EQUAL
            PACK      SRCHTABL,QRYDATA,SP70
            GOTO      SETPAR99
          ENDIF
.
SETPAR99  RETURN
.------------------------------------------------------------
. Header Routine           
.------------------------------------------------------------
HEADER00  CLEAR     WEBTITLE
          LOAD      NEWTITLE,REPORTNO,TITLE01,TITLE02,TITLE03,TITLE04:
                                      TITLE05,TITLE05,TITLE05,TITLE05:
                                      TITLE11
          APPEND    NEWTITLE,WEBTITLE
          RESET     WEBTITLE
.
          CALL      WEBHED00   * Create Output File and Write HTML Page Header
          BRANCH    EXIT,HEADER99
.
          CALL      WEBBOD00   * Process Web Body
.
          CALL      WEBEND00   * Process End of HTML File
.
HEADER99  RETURN
.-------------------------------------------------------------
.Process Fields From Template Body
.-------------------------------------------------------------
PROFLD00  BRANCH    REPORTNO,PROFLD10,PROFLD20,PROFLD30,PROFLD40,PROFLD50:
                             PROFLD60,PROFLD70,PROFLD80,PROFLD90,PROFL100:
                             PROFL110,PROFL120,PROFL130,PROFL140
.
PROFLD10  CALL      MBSS0000 
          GOTO      PROFLD99
.
PROFLD20  CALL      DRGS0000
          GOTO      PROFLD99
.
PROFLD30  CALL      ICDS0000
          GOTO      PROFLD99
.
PROFLD40  CALL      ICOS0000
          GOTO      PROFLD99
.
PROFLD50  CALL      MCSS0000
          GOTO      PROFLD99
.
PROFLD60  CALL      DCSS0000
          GOTO      PROFLD99
.
PROFLD70  CALL      ICSS0000
          GOTO      PROFLD99
.
PROFLD80  CALL      OCSS0000
          GOTO      PROFLD99
.                                           *** HPS Code Starts Here ***
PROFLD90  
          GOTO      PROFLD99
.
PROFL100  CALL      MISC0000                
          GOTO      PROFLD99
.
PROFL110  CALL      OPRITM00
          GOTO      PROFLD99
.                                           *** HPS Code Ends Here ***
PROFL120  CALL      CMCS0000
          GOTO      PROFLD99
.                                                                       
PROFL130  CALL      CCSS0000
          GOTO      PROFLD99
.                                                                       
PROFL140  CALL      LGAS0000                * LGA
          GOTO      PROFLD99
.                                                                       
PROFLD99  RETURN
.-------------------------------------------------------------
. MBS Item Search Results
.-------------------------------------------------------------
MBSS0000  BRANCH    FLDITMNO,MBSS0100,MBSS0200,MBSS0300,MBSS0400,MBSS0500
.
MBSS0100  CALL      NXGR0000
          GOTO      MBSS9999
.
MBSS0200  CALL      LTGR0000
          GOTO      MBSS9999
.
MBSS0300  MOVE      ZERO,LINK2PRT
          CALL      SPTIKA00
          GOTO      MBSS9999
.
MBSS0400  MOVE      ONE,LINK2PRT
          CALL      SPTIKA00
          GOTO      MBSS9999
.
MBSS0500  MOVE      TWO,LINK2PRT
          MOVE      SP70,EFFDATES
.kkkk
          CALL      SPTIKA00
          GOTO      MBSS9999
.
MBSS9999  RETURN
.------------------------------------------------------------
. Display MBS Item Results
.------------------------------------------------------------
.
SPTIKA00  WRITE     HTMLFILE;"<tr align=center>":
                             "<td class=HeadingCell colspan=9><b>":
                             "You Searched for ":
                               KEYWORDS,"</td>":
                             "</tr>":
                             "<tr>";
          IF        PTCNHDPS = ONE
            WRITE     HTMLFILE;"<td class=HeadingCell><b>Proc Code</b></td>";
          ELSE
            WRITE     HTMLFILE;"<td class=HeadingCell><b>MBS Code</b></td>";
          ENDIF
          WRITE     HTMLFILE;"<td class=HeadingCell><b>Description</b></td>";
.
          WRITE     HTMLFILE;"<td class=HeadingCell>":
                             "<b>Effective From Date</b></td>";
          IF        CFEETYP<>5
            WRITE     HTMLFILE;"<td class=HeadingCell><b>Suggested Class</b>":
                             "</td>";
          ENDIF
.
          WRITE     HTMLFILE;"<td class=HeadingCell><b>Misc. Group</b></td>";
     WRITE     HTMLFILE;"<td class=HeadingCell><b>Type of Certificate</b></td>";
     WRITE     HTMLFILE;"<td class=HeadingCell><b>Msc.Srv.Charge</b></td>";
          WRITE     HTMLFILE;"<td class=HeadingCell><b>Active</b></td>";
          WRITE     HTMLFILE;"<td class=HeadingCell>":
                             "<b>Effective To Date</b></td>";
          WRITE     HTMLFILE;"</tr>"
.
          CALL      GETWRD00       * This routine Splits the KEYWORDS field
.                                  * into KEYWRD01 to KEYWRD10
.
          IF        LINK2PRT<>1
            UNPACK    DIM127,D1,LINKPRG,DIM127
            UNPACK    DIM127,D1,LINKREP,DIM127
            UNPACK    DIM127,D1,LINKTEM,DIM127
          ENDIF
.
          IF        NORECORD=0
            MOVE      PTCNNRTD,NORECORD      * Set Default No Records to Display
          ENDIF
          MOVE      ZERO,RECNUMB
          MOVE      ZERO,DISNUMB
.
          PACK      EFFDATES,EFFDATES,SP70
          STRIP     KEYWRD01
          PACK      KEY24,KEYWRD01,SP70
          CALL      RSPTIK2          * read keywords(patikiaf) for patitemn
SPTIKA10  CALL      RKPTIK2
          BRANCH    OVRCD,SPTIKA90
.
          MOVE      PTIKITM,KEY9
          PACK      KEY17,KEY9,SP10     * List all effective date Item
          CALL      RDSITEM1
SPTIKA15  CALL      RDKITEM1
          BRANCH    OVRCD,SPTIKA10
.
          MATCH     ITEMNO,KEY9         * same MBS item code ?
          GOTO      SPTIKA10 IF NOT EQUAL
.
          CALL      SPTIKB00
          BRANCH    OVRCD,SPTIKA15,SPTIKA90
.
          ADD       ONE,RECNUMB
          IF        STARTNUM>=RECNUMB
            GOTO      SPTIKA15
          ENDIF
.
.         Check Effective date
.
          MATCH     SP70,EFFDATES
          IF        !@EQUAL
            MATCH     PTITEFDT,EFFDATES
            GOTO      SPTIKA15 IF LESS
.
            MATCH     SP70,PTITETDT
            IF        !@EQUAL
              MATCH     EFFDATES,PTITETDT
             GOTO      SPTIKA15 IF LESS
            ENDIF
          ENDIF
.
          MOVE      "A ",CATEGORY
          MOVE      ICLSS,CODE
          CALL      CODDES00
          MOVE      TDESC,DIM20A
.
          MOVE      "FI",CATEGORY
          MOVE      IMISGRP,CODE
          CALL      CODDES00
          MOVE      TDESC,DIM20B
.
          UNPACK    SP70,KEY12,DIM12
          UNPACK    PTITEFDT,CCENT,CYEAR,CMON,CDAY
          MOVE      CMON,F2
          LOAD      MTHNAM3,F2,JAN,FEB,MAR,APR,MAY,JUN,JUL,AUG,SEP,OCT,NOV,DEC
          PACK      KEY12,CDAY,SP1,MTHNAM3,SP1,CCENT,CYEAR

          MATCH     SP70,PTITETDT
          IF        !@EQUAL
            UNPACK    PTITETDT,CCENT,CYEAR,CMON,CDAY
            MOVE      CMON,F2
            LOAD      MTHNAM3,F2,JAN,FEB,MAR,APR,MAY,JUN,JUL,AUG,SEP,OCT,NOV,DEC
            PACK      DIM12,CDAY,SP1,MTHNAM3,SP1,CCENT,CYEAR
          ELSE
            MOVE      "&nbsp;",DIM12
          ENDIF
.
          MOVE      "cr",CATEGORY
          MOVE      PTITTCER,CODE
          CALL      CODDES00
          MOVE      TDESC,DIM20C
.
          MOVE      SP70,SETFONT
          MOVE      SP70,ENDFONT
          MATCH     "I",PTITACTV  
          IF        @EQUAL
            MOVE      "<font color=#FF0000>",SETFONT
            MOVE      "</font>",ENDFONT
          ENDIF
.
          MATCH     SP70,IDESC
          IF        @EQUAL
            MOVE      "&nbsp;",IDESC
          ENDIF
.
          MATCH     SP70,DIM20A
          IF        @EQUAL
            MOVE      "&nbsp;",DIM20A
          ENDIF             
.
          MATCH     SP70,DIM20B
          IF        @EQUAL
            MOVE      "&nbsp;",DIM20B
          ENDIF
.
          MATCH     SP70,DIM20C
          IF        @EQUAL
            MOVE      "&nbsp;",DIM20C
          ENDIF
.
          MOVE      "No",KEY3
          MATCH     " ",PTITACTV
          IF        @EQUAL
            MOVE      "Yes",KEY3
          ENDIF
.
          MATCH     ANSA,PTITACTV
          IF        @EQUAL
            MOVE      "Yes",KEY3
          ENDIF
.
          MATCH     ANSI,PTITACTV
          IF        @EQUAL
            MOVE      "No",KEY3
          ENDIF
.
          MOVE      "No ",DIM3A
          MATCH     "1",PTITMSCH
          IF        @EQUAL
            MOVE      "Yes",DIM3A
          ENDIF
.
          BRANCH    LINK2PRT,SPTIKA50,SPTIKA60                   
.
          WRITE     HTMLFILE;"<tr valign=top>":
                              "<td><a href=",LINKPRG,".pbl?":
                               "&reportno=",LINKREP:
                               "&template=",LINKTEM:
                               "&itemkeys=",KEY9,">":
                               ITEMNO,"</a></td>";
          IF        CFEETYP<>5
            WRITE     HTMLFILE;"<td>",SETFONT,IDESC,ENDFONT,"</td></font>";
          ELSE
            WRITE     HTMLFILE;"<td>",SETFONT,PTITDESC,ENDFONT,"</td></font>";
          ENDIF
          WRITE     HTMLFILE;"<td>&nbsp;",SETFONT,KEY12,ENDFONT,"</td>";
.
          IF        CFEETYP<>5
            WRITE     HTMLFILE;"<td>&nbsp;",SETFONT,DIM20A,ENDFONT,"</td>";
          ENDIF
.
          WRITE     HTMLFILE;"<td>&nbsp;",SETFONT,DIM20B,ENDFONT,"</td>";
          WRITE     HTMLFILE;"<td>&nbsp;",SETFONT,DIM20C,ENDFONT,"</td>";
          WRITE     HTMLFILE;"<td>&nbsp;",SETFONT,DIM3A,ENDFONT,"</td>";
          WRITE     HTMLFILE;"<td>&nbsp;",SETFONT,KEY3,ENDFONT,"</td>";
          WRITE     HTMLFILE;"<td>&nbsp;",SETFONT,DIM12,ENDFONT,"</td>";
          WRITE     HTMLFILE;"</tr>"
.
          GOTO      SPTIKA80
.
SPTIKA50  REP       "#', ",IDESC 
          REP       "#", ",IDESC 
          RESET     IDESC
.
          WRITE     HTMLFILE;"<tr valign=top>":
                              "<td><a href=#"":
                              "javascript:updateParent('",PTITDESC:  
                              "','",ITEMNO,"','",PTITEFDT,"')#">":
                              "<img src=../images/MaintenanceIcon.gif hspace=4":
                              " border=0 align=absmiddle></a>": 
                              ITEMNO,"</td>";
          IF        CFEETYP<>5
            WRITE     HTMLFILE;"<td>",SETFONT,IDESC,ENDFONT,"</td>";
          ELSE
            WRITE     HTMLFILE;"<td>",SETFONT,PTITDESC,ENDFONT,"</td>";
          ENDIF
.
          WRITE     HTMLFILE;"<td>&nbsp;",SETFONT,KEY12,ENDFONT,"</td>";
.
          IF        CFEETYP<>5
            WRITE     HTMLFILE;"<td>",SETFONT,DIM20A,ENDFONT,"</td>";
          ENDIF
          WRITE     HTMLFILE;"<td>&nbsp;",SETFONT,DIM20B,ENDFONT,"</td>";
          WRITE     HTMLFILE;"<td>&nbsp;",SETFONT,DIM20C,ENDFONT,"</td>";
          WRITE     HTMLFILE;"<td>&nbsp;",SETFONT,DIM3A,ENDFONT,"</td>";
          WRITE     HTMLFILE;"<td>&nbsp;",SETFONT,KEY3,ENDFONT,"</td>";
          WRITE     HTMLFILE;"<td>&nbsp;",SETFONT,DIM12,ENDFONT,"</td>";
          WRITE     HTMLFILE;"</tr>"
.
          GOTO      SPTIKA80
.
SPTIKA60  WRITE     HTMLFILE;"<tr valign=top>":
                             "<td><a href='":
                             "javascript:showMbs01(#"":
                              LINKPRG,".pbl?":
                              "&reportno=",LINKREP:
                              "&template=",LINKTEM:
                              "&mbsitemn=",KEY9:
                              "&mbseffdt=",PTITEFDT,"#");'>":
                              "<img src=../images/MaintenanceIcon.gif hspace=4":
                              " border=0 align=absmiddle></a>": 
                              ITEMNO,"</td>";
          IF        CFEETYP<>5
            WRITE     HTMLFILE;"<td>",SETFONT,IDESC,ENDFONT,"</td>";
          ELSE
            WRITE     HTMLFILE;"<td>",SETFONT,PTITDESC,ENDFONT,"</td>";
          ENDIF
          WRITE     HTMLFILE;"<td>&nbsp;",SETFONT,KEY12,ENDFONT,"</td>";
.
          IF        CFEETYP<>5
            WRITE     HTMLFILE;"<td>",SETFONT,DIM20A,ENDFONT,"</td>";
          ENDIF
          WRITE     HTMLFILE;"<td>&nbsp;",SETFONT,DIM20B,ENDFONT,"</td>";
          WRITE     HTMLFILE;"<td>&nbsp;",SETFONT,DIM20C,ENDFONT,"</td>";
          WRITE     HTMLFILE;"<td>&nbsp;",SETFONT,DIM3A,ENDFONT,"</td>";
          WRITE     HTMLFILE;"<td>&nbsp;",SETFONT,KEY3,ENDFONT,"</td>";
          WRITE     HTMLFILE;"<td>&nbsp;",SETFONT,DIM12,ENDFONT,"</td>";
          WRITE     HTMLFILE;"</tr>"
.
SPTIKA80  ADD       ONE,DISNUMB
          COMPARE   NORECORD,DISNUMB
          GOTO      SPTIKA15 IF NOT EQUAL
          GOTO      SPTIKA99
.
SPTIKA90  CALL      NOMORE00       * Display No More Records Message
.
SPTIKA99  RETURN
.------------------------------------------------------------
. Check MBS Record
.------------------------------------------------------------
SPTIKB00  MATCH     KEYWRD01,PTIKKWD
          GOTO      SPTIKB92 IF NOT EQUAL
          IF        KEYWRDNO>1
            PACK      SAVKEY24,PTIKKWD,PTIKITM
            CALL      SPTIKC00
            BRANCH    EXIT,SPTIKB91
            MOVE      SAVKEY24,KEY24
            CALL      RDPTIK2
          ENDIF
.
.ITEMSTAT -  Set to 0 - Show All Active MBS Items Only
.                   1 - Show All MBS Item
.
SPTIKB10  BRANCH    ITEMSTAT,SPTIKB90
          MATCH     "I",PTITACTV 
          GOTO      SPTIKB91 IF EQUAL
.
SPTIKB90  MOVE      ZERO,OVRCD
          GOTO      SPTIKB99
SPTIKB91  MOVE      ONE,OVRCD
          GOTO      SPTIKB99
SPTIKB92  MOVE      TWO,OVRCD
SPTIKB99  RETURN
.------------------------------------------------------------
. Check for Matching MBS Words
.------------------------------------------------------------
SPTIKC00  MOVE      ONE,F2
          MOVE      ZERO,EXIT
          PACK      SAVKEY9,PTIKITM,SP70
.
SPTIKC10  COMPARE   KEYWRDNO,F2           * Loop through each Key Word in Search
          GOTO      SPTIKC99 IF EQUAL     * Exit OK
          ADD       ONE,F2
          LOAD      KEYWRDXX,F2,KEYWRD01,KEYWRD02,KEYWRD03,KEYWRD04,KEYWRD05:
                             KEYWRD06,KEYWRD07,KEYWRD08,KEYWRD09,KEYWRD10
          PACK      KEY24,PTIKITM,KEYWRDXX
          CALL      RDPTIK1               * Check for Exact Match
          COMPARE   ZERO,OVRCD            * Ok so Continue Loop
          GOTO      SPTIKC10 IF EQUAL
          CALL      RKPTIK1               * Not Exact so Read Next Record
          BRANCH    OVRCD,SPTIKC90        * No Match So Exit No Match
.
          PACK      KEY9,PTIKITM,SP70
          MATCH     SAVKEY9,KEY9          * Match Key Fields
          GOTO      SPTIKC90 IF NOT EQUAL * No Match So Exit
          STRIP     KEYWRDXX
          MATCH     PTIKKWD,KEYWRDXX         * Check Key Word
          GOTO      SPTIKC90 IF NOT EQUAL * No Match So Exit
          GOTO      SPTIKC10              * Check Next Search Word
.
SPTIKC90  MOVE      ONE,EXIT
SPTIKC99  RETURN
.------------------------------------------------------------
. Get Code Description
.------------------------------------------------------------
CODDES00  MOVE      SP70,TDESC
          MATCH     SP70,CODE
          GOTO      CODDES99 IF EQUAL
          PACK      KEY5,CATEGORY,CODE
          CALL      RDCODE1
          IF        OVRCD=1
            MOVE      SP70,TDESC
          ENDIF
CODDES99  RETURN
.-------------------------------------------------------------
. DRG Code Search Results
.-------------------------------------------------------------
DRGS0000  BRANCH    FLDITMNO,DRGS0100,DRGS0200,DRGS0300,DRGS0400,DRGS0500:
                             DRGS0600,DRGS0700,DRGS0800	
.
DRGS0100  CALL      NXGR0000 
          GOTO      DRGS9999
.
DRGS0200  CALL      LTGR0000 
          GOTO      DRGS9999
.
DRGS0300  MOVE      ZERO,LINK2PRT
          CALL      SPTKDA00
          GOTO      DRGS9999
.
DRGS0400  MOVE      ONE,LINK2PRT
          CALL      SPTKDA00
          GOTO      DRGS9999
.
DRGS0500  MOVE      TWO,LINK2PRT
          CALL      SPTKDA00
          GOTO      DRGS9999
.
DRGS0600  WRITE     HTMLFILE;DRGVERZ;
          GOTO      DRGS9999
.
DRGS0700  WRITE     HTMLFILE;KEYWORDS;
          GOTO      DRGS9999
.
DRGS0800  MOVE      THREE,LINK2PRT
          CALL      SPTKDA00
          GOTO      DRGS9999
.
DRGS9999  RETURN
.-----------------------------------------------------------
. DRG Code Search Table
.-----------------------------------------------------------
SPTKDA00  WRITE     HTMLFILE;"<tr align=center>":
                             "<td class=HeadingCell colspan=3><b>":
                             "You Searched for ":
                               KEYWORDS,"</td>":
                             "</tr>":
                             "<tr>":
                             "<td class=HeadingCell><b>DRG Code</b></td>":
                             "<td class=HeadingCell><b>Description</b></td>":
                             "<td class=HeadingCell><b>Version</b></td>":
                             "</tr>"
.
          CALL      GETWRD00
.
          IF        LINK2PRT<>1
            UNPACK    DIM127,D1,LINKPRG,DIM127
            UNPACK    DIM127,D1,LINKREP,DIM127
            UNPACK    DIM127,D1,LINKTEM,DIM127
          ENDIF
.
          IF        NORECORD=0
            MOVE      PTCNNRTD,NORECORD      * Set Default No Records to Display
          ENDIF
          MOVE      ZERO,RECNUMB
          MOVE      ZERO,DISNUMB
.
          STRIP     KEYWRD01
          PACK      KEY19,KEYWRD01,SP70
          CALL      RSPTKD2
SPTKDA10  CALL      RKPTKD2
          BRANCH    OVRCD,SPTKDA90
.
.                                                                     *I-137125
          MOVE      PTKDITM,KEY4
          PACK      DRGVERZ,DRGVERZ,SP3
          MATCH     SP3,DRGVERZ
          IF        @EQUAL
            PACK      KEY7,KEY4,SP10        * list all DRG versions
            CALL      RSPTDGW1
SPTKDA15    CALL      RKPTDGW1
            BRANCH    OVRCD,SPTKDA10
            MATCH     PTDWDRGC,KEY4         * same DRG code ?
            GOTO      SPTKDA10 IF NOT EQUAL
          ELSE                              * list selected DRG version
            PACK      KEY7,KEY4,DRGVERZ,SP10                          *C-137125
            CALL      RDPTDGW1
            BRANCH    OVRCD,SPTKDA10
          ENDIF
.
          CALL      SPTKDB00
          BRANCH    OVRCD,SPTKDA10,SPTKDA90
.
          ADD       ONE,RECNUMB
          IF        STARTNUM>=RECNUMB
            GOTO      SPTKDA10
          ENDIF
.
          UNPACK    PTDWDRGV,ANS,DV1,DV2
          MATCH     "0",ANS
          IF        @EQUAL
            PACK      DRGVDESZ,DV1,DOT,DV2,SP70
          ELSE
            UNPACK    PTDWDRGV,DIM2,DV2 
            PACK      DRGVDESZ,DIM2,DOT,DV2,SP70
          ENDIF
.
          BRANCH    LINK2PRT,SPTKDA20,SPTKDA30,SPTKDA40
.
          WRITE     HTMLFILE;"<tr valign=top>":
                              "<td><a href=",LINKPRG,".pbl?":
                               "&reportno=",LINKREP:
                               "&template=",LINKTEM:
                               "&itemkeys=",KEY4,">":
                               PTDWDRGC,"</a></td>":          
                               "<td>",PTDWDESC,"</td>":
                               "<td>",DRGVDESZ,"</td>":
                             "</tr>"                        
.                                                           
          GOTO      SPTKDA80                                
.                                                           
SPTKDA20  WRITE     HTMLFILE;"<tr valign=top>":             
                              "<td><a href=#"":          
                              "javascript:updateParent('",PTDWDESC:
                              "','",PTDWDRGC,"')#">":         
                              PTDWDRGC,"</a></td>":           
                              "<td>",PTDWDESC,"</td>":
                              "<td>",DRGVDESZ,"</td>":
                             "</tr>"
.
          GOTO      SPTKDA80                                
. 
SPTKDA30  WRITE     HTMLFILE;"<tr valign=top>":
                             "<td><a href='":
                             "javascript:showDrg02(#"":
                              LINKPRG,".pbl?":
                              "&reportno=",LINKREP:
                              "&template=",LINKTEM:
                              "&drgcodes=",KEY4:
                              "&drgversn=",PTDWDRGV:
                              "#");'>":
                              "<img src=../images/MaintenanceIcon.gif hspace=4":
                              " border=0 align=absmiddle></a>":
                              PTDWDRGC,"</a></td>":
                              "<td>",PTDWDESC,"</td>":
                              "<td>",DRGVDESZ,"</td>":
                             "</tr>"
.
          GOTO      SPTKDA80
.
SPTKDA40  WRITE     HTMLFILE;"<tr valign=top>":
                              "<td><a href=#"":
                              "javascript:updateParent('",PTDWDESC:
                              "','",PTDWDRGC:
                              "','",DRGVDESZ:
                              "','",PTDWDRGV,"')#">":
                              PTDWDRGC,"</a></td>":
                              "<td>",PTDWDESC,"</td>":
                              "<td>",DRGVDESZ,"</td>":
                             "</tr>"
.
          GOTO      SPTKDA80

.
SPTKDA80  ADD       ONE,DISNUMB
          COMPARE   NORECORD,DISNUMB
....      GOTO      SPTKDA10 IF NOT EQUAL
....      GOTO      SPTKDA15 IF NOT EQUAL                             *C-137125
          IF        !@EQUAL
            MATCH     SP3,DRGVERZ
            GOTO      SPTKDA10 IF NOT EQUAL
            GOTO      SPTKDA15
          ENDIF
          GOTO      SPTKDA99 
.
SPTKDA90  CALL      NOMORE00         * Display No More Records Message
. 
SPTKDA99  RETURN
.------------------------------------------------------------
. Check DRG Record
.------------------------------------------------------------
SPTKDB00  MATCH     KEYWRD01,PTKDKWD
          GOTO      SPTKDB92 IF NOT EQUAL
          IF        KEYWRDNO>1
            PACK      SAVKEY19,PTKDKWD,PTKDITM
            CALL      SPTKDC00
            BRANCH    EXIT,SPTKDB91
            MOVE      SAVKEY19,KEY19
            CALL      RDPTKD2
          ENDIF
.
. Insert Other Check for Valid Record Here i.e. Suspended or In Active
.   eg    COMPARE    ONE,INACTIVE
.         GOTO       SPTKDB91 IF EQUAL
.
          GOTO      SPTKDB90
.
SPTKDB90  MOVE      ZERO,OVRCD
          GOTO      SPTKDB99
SPTKDB91  MOVE      ONE,OVRCD
          GOTO      SPTKDB99
SPTKDB92  MOVE      TWO,OVRCD
SPTKDB99  RETURN
.------------------------------------------------------------
. Check for Matching DRG Words
.------------------------------------------------------------
SPTKDC00  MOVE      ONE,F2
          MOVE      ZERO,EXIT
          PACK      SAVKEY4,PTKDITM,SP70
.
SPTKDC10  COMPARE   KEYWRDNO,F2           * Loop through each Key Word in Search
          GOTO      SPTKDC99 IF EQUAL     * Exit OK
          ADD       ONE,F2
          LOAD      KEYWRDXX,F2,KEYWRD01,KEYWRD02,KEYWRD03,KEYWRD04,KEYWRD05:
                             KEYWRD06,KEYWRD07,KEYWRD08,KEYWRD09,KEYWRD10
          PACK      KEY19,PTKDITM,KEYWRDXX
          CALL      RDPTKD1               * Check for Exact Match
          COMPARE   ZERO,OVRCD            * Ok so Continue Loop
          GOTO      SPTKDC10 IF EQUAL
.
          CALL      RKPTKD1               * Not Exact so Read Next Record
          BRANCH    OVRCD,SPTKDC90        * No Match So Exit No Match
          PACK      KEY4,PTKDITM,SP70
          MATCH     SAVKEY4,KEY4        * Match Key Fields
          GOTO      SPTKDC90 IF NOT EQUAL * No Match So Exit
          STRIP     KEYWRDXX      
          MATCH     PTKDKWD,KEYWRDXX         * Check Key Word
          GOTO      SPTKDC90 IF NOT EQUAL * No Match So Exit
          GOTO      SPTKDC10              * Check Next Search Word
.
SPTKDC90  MOVE      ONE,EXIT
SPTKDC99  RETURN
.
.

.-------------------------------------------------------------
. Diagnosis Code Search Results
.-------------------------------------------------------------
ICDS0000  BRANCH    FLDITMNO,ICDS0100,ICDS0200,ICDS0300,ICDS0400,ICDS0500:
                             ICDS0600
.
ICDS0100  CALL      NXGR0000 
          GOTO      ICDS9999
.
ICDS0200  CALL      LTGR0000 
          GOTO      ICDS9999
.
ICDS0300  MOVE      ZERO,LINK2PRT
          CALL      SRDIAG00
          GOTO      ICDS9999
.
ICDS0400  MOVE      ONE,LINK2PRT
          CALL      SRDIAG00
          GOTO      ICDS9999
.
ICDS0500  MOVE      TWO,LINK2PRT
          CALL      SRDIAG00
          GOTO      ICDS9999
.
ICDS0600  MOVE      THREE,LINK2PRT   * JSON Response
          CALL      SRDIAG00
          GOTO      ICDS9999
.
ICDS9999  RETURN
.------------------------------------------------------------
. Diagnosis Code Search
.------------------------------------------------------------
SRDIAG00  MATCH     "1",USNGICD9   * Search ICD9 Code?
          IF        @EQUAL
            CALL      SPTDIA00     * Search ICD9 
          ELSE
            CALL      SPTDCA00     * Search ICD10
          ENDIF
.
SRDIAG99  RETURN
.------------------------------------------------------------
. Display ICD9 Diagnosis Code Search
.------------------------------------------------------------
SPTDIA00  IF        LINK2PRT=3
            WRITE     HTMLFILE;"[";
          ELSE
            WRITE     HTMLFILE;"<tr align=center>":
                               "<td class=HeadingCell colspan=2><b>":
                               "You Searched for ":
                               KEYWORDS,"</td>":
                               "</tr>":
                               "<tr>":
                               "<td class=HeadingCell><b>ICD Code</b></td>":
                               "<td class=HeadingCell><b>Description</b></td>":
                               "</tr>"
          ENDIF
.
          CALL      GETWRD00
.
          IF        LINK2PRT<>1
            UNPACK    DIM127,D1,LINKPRG,DIM127
            UNPACK    DIM127,D1,LINKREP,DIM127
            UNPACK    DIM127,D1,LINKTEM,DIM127
          ENDIF
.
          IF        NORECORD=0
            MOVE      "10",NORECORD       * Set Default No Records to Display
          ENDIF
          MOVE      ZERO,RECNUMB
          MOVE      ZERO,DISNUMB
.
          STRIP     KEYWRD01
          PACK      KEY24,KEYWRD01,SP70
          CALL      RSPTDI2               * Read ICD9 Keyword File
SPTDIA10  CALL      RKPTDI2
          BRANCH    OVRCD,SPTDIA90
.
          MOVE      PTDIICD,KEY9
          MOVE      SP70,PT0DDESC
          CALL      RD10T9D1              * Read ICD9 File
          BRANCH    OVRCD,SPTDIA10
.
          MATCH     "P",DFLAG
          GOTO      SPTDIA10 IF NOT EQUAL  * Only viewing Posting Records
.
          CALL      SPTDIB00
          BRANCH    OVRCD,SPTDIA10,SPTDIA90
.
          ADD       ONE,RECNUMB
          IF        STARTNUM>=RECNUMB
            GOTO      SPTDIA10
          ENDIF
.
          BRANCH    LINK2PRT,SPTDIA20,SPTDIA30,SPTDIA40
.
          WRITE     HTMLFILE;"<tr valign=top>":
                              "<td><a href=",LINKPRG,".pbl?":
                               "&reportno=",LINKREP:
                               "&template=",LINKTEM:
                               "&itemkeys=",KEY9,">":
                               DPCODE,"</a></td>";
          MATCH     SP70,PT0DDESC
          IF        !@EQUAL
            WRITE     HTMLFILE;"<td>",PT0DDESC,"</td></tr>";
          ELSE
            WRITE     HTMLFILE;"<td>",DDESC,"</td>":
                             "</tr>"
          ENDIF
.
          GOTO      SPTDIA80
.
SPTDIA20  PACK      DISPDESC,DDESC,SP70,SP70,SP70
          MATCH     SP70,PT0DDSC2
          IF        @EQUAL
            MOVE      PT0DDESC,DISPDESC
          ELSE
            MOVE      PT0DDSC2,DISPDESC
          ENDIF
          REP       "'`",DISPDESC
.
          WRITE     HTMLFILE;"<tr valign=top>":
                              "<td><a href=#"":
                              "javascript:updateParent('",DISPDESC:
                              "','",DPCODE,"','",USNGICD9,"')#">":
                              DPCODE,"</a></td>";
.       
          WRITE     HTMLFILE;"<td>",DISPDESC,"</td></tr>";
.
          GOTO      SPTDIA80
.
SPTDIA30  PACK      DISPDESC,DDESC,SP70,SP70,SP70
          MATCH     SP70,PT0DDSC2
          IF        @EQUAL
            MOVE      PT0DDESC,DISPDESC
          ELSE
            MOVE      PT0DDSC2,DISPDESC
          ENDIF
          REP       "'`",DISPDESC
.
          WRITE     HTMLFILE;"<tr valign=top>":
                             "<td><a href='":
                             "javascript:showICD03(#"":
                              LINKPRG,".pbl?":
                              "&reportno=",LINKREP:
                              "&template=",LINKTEM:
                              "&icddcode=",KEY9:
                              "#");'>":
                              DPCODE,"</a></td>";
.
          WRITE     HTMLFILE;"<td>",DISPDESC,"</td></tr>";
.
          GOTO      SPTDIA80
.
SPTDIA40  MOVE      PT0DDESC,KEY60
          MATCH     SP70,PT0DDESC
          IF        @EQUAL
            MOVE      DDESC,KEY60
          ENDIF
          WRITE     HTMLFILE;"{#"code#":#"",KEY9,"#",":
                             "#"value#":#"",KEY60,"#",":
                             "#"subtext#":#"",SP1,"#"},"
.
SPTDIA80  ADD       ONE,DISNUMB
          COMPARE   NORECORD,DISNUMB
          GOTO      SPTDIA10 IF NOT EQUAL
SPTDIA90  IF        LINK2PRT=3
            WRITE     HTMLFILE;"]"
          ENDIF
SPTDIA99  RETURN
.------------------------------------------------------------
. Check ICD9 Diagnosis Record
.------------------------------------------------------------
SPTDIB00  MATCH     KEYWRD01,PTDIKWD
          GOTO      SPTDIB92 IF NOT EQUAL
          IF        KEYWRDNO>1
            PACK      SAVKEY24,PTDIKWD,PTDIICD
            CALL      SPTDIC00
            BRANCH    EXIT,SPTDIB91
            MOVE      SAVKEY24,KEY24
            CALL      RDPTDI2
          ENDIF
.
SPTDIB90  MOVE      ZERO,OVRCD
          GOTO      SPTDIB99
SPTDIB91  MOVE      ONE,OVRCD
          GOTO      SPTDIB99
SPTDIB92  MOVE      TWO,OVRCD
SPTDIB99  RETURN
.------------------------------------------------------------
. Check for Matching ICD9 Diagnosis Words
.------------------------------------------------------------
SPTDIC00  MOVE      ONE,F2
          MOVE      ZERO,EXIT
          PACK      SAVKEY9,PTDIICD,SP70
.
SPTDIC10  COMPARE   KEYWRDNO,F2           * Loop through each Key Word in Search
          GOTO      SPTDIC99 IF EQUAL     * Exit OK
          ADD       ONE,F2
          LOAD      KEYWRDXX,F2,KEYWRD01,KEYWRD02,KEYWRD03,KEYWRD04,KEYWRD05:
                             KEYWRD06,KEYWRD07,KEYWRD08,KEYWRD09,KEYWRD10
          PACK      KEY24,PTDIICD,KEYWRDXX
          CALL      RDPTDI1               * Check for Exact Match
          COMPARE   ZERO,OVRCD            * Ok so Continue Loop
          GOTO      SPTDIC10 IF EQUAL
.
          CALL      RKPTDI1               * Not Exact so Read Next Record
          BRANCH    OVRCD,SPTDIC90        * No Match So Exit No Match
          PACK      KEY9,PTDIICD,SP70
          MATCH     SAVKEY9,KEY9        * Match Key Fields
          GOTO      SPTDIC90 IF NOT EQUAL * No Match So Exit
          STRIP     KEYWRDXX    
          MATCH     PTDIKWD,KEYWRDXX         * Check Key Word
          GOTO      SPTDIC90 IF NOT EQUAL * No Match So Exit
          GOTO      SPTDIC10              * Check Next Search Word
.
SPTDIC90  MOVE      ONE,EXIT
SPTDIC99  RETURN
.
.------------------------------------------------------------
. Display ICD10 Diagnosis Code Search
.------------------------------------------------------------
SPTDCA00  IF        LINK2PRT=3
            WRITE     HTMLFILE;"[";
          ELSE
            WRITE     HTMLFILE;"<tr align=center>":
                               "<td class=HeadingCell colspan=2><b>":
                               "You Searched for ":
                               KEYWORDS,"</td>":
                               "</tr>":
                               "<tr>":
                               "<td class=HeadingCell><b>ICD Code</b></td>":
                               "<td class=HeadingCell><b>Description</b></td>":
                               "</tr>"
          ENDIF
.
          CALL      GETWRD00
.
          IF        LINK2PRT<>1
            UNPACK    DIM127,D1,LINKPRG,DIM127
            UNPACK    DIM127,D1,LINKREP,DIM127
            UNPACK    DIM127,D1,LINKTEM,DIM127
          ENDIF
.
          IF        NORECORD=0
            MOVE      "10",NORECORD       * Set Default No Records to Display
          ENDIF
          MOVE      ZERO,RECNUMB
          MOVE      ZERO,DISNUMB
.
          STRIP     KEYWRD01
          PACK      KEY24,KEYWRD01,SP70
          CALL      RSPTKCD2              * Read ICD10 Keyword File
SPTDCA10  CALL      RKPTKCD2
          BRANCH    OVRCD,SPTDCA90
.
          MOVE      PTCDITM,KEY9
          PACK      PT0DDESC,SP70,SP70
          PACK      PT0DDSC2,SP70,SP70,SP70
          CALL      RDPTICD1              * Read ICD10 File
          BRANCH    OVRCD,SPTDCA10
          COMPARE   ONE,ICDRDVER          * ICD9?
          GOTO      SPTDCA10 IF EQUAL     * Yes, skip this record
.
          MATCH     "P",DFLAG
          GOTO      SPTDCA10 IF NOT EQUAL  * Only viewing Posting Records
.
          CALL      SPTDCB00
          BRANCH    OVRCD,SPTDCA10,SPTDCA90
.
          ADD       ONE,RECNUMB
          IF        STARTNUM>=RECNUMB
            GOTO      SPTDCA10
          ENDIF
.
SPTDCA13  BRANCH    LINK2PRT,SPTDCA20,SPTDCA30,SPTDCA40
.
          WRITE     HTMLFILE;"<tr valign=top>":
                              "<td><a href=",LINKPRG,".pbl?":
                               "&reportno=",LINKREP:
                               "&template=",LINKTEM:
                               "&itemkeys=",KEY9,">":
                               DPCODE,"</a></td>";
          MATCH     SP70,PT0DDESC
          IF        !@EQUAL
            WRITE     HTMLFILE;"<td>",PT0DDESC,"</td>":
                             "</tr>"
          ELSE
            WRITE     HTMLFILE;"<td>",DDESC,"</td>":
                             "</tr>"
          ENDIF
.
          GOTO      SPTDCA80
.
SPTDCA20  PACK      DISPDESC,DDESC,SP70,SP70,SP70
          MATCH     SP70,PT0DDSC2
          IF        @EQUAL
            MOVE      PT0DDESC,DISPDESC
          ELSE
            MOVE      PT0DDSC2,DISPDESC
          ENDIF
          REP       "'`",DISPDESC
.
          WRITE     HTMLFILE;"<tr valign=top>":
                              "<td><a href=#"":
                              "javascript:updateParent('",DISPDESC:
                              "','",DPCODE,"')#">":
                              DPCODE,"</a></td>";
.
          WRITE     HTMLFILE;"<td>",DISPDESC,"</td></tr>"
.
          GOTO      SPTDCA80
.
SPTDCA30  PACK      DISPDESC,DDESC,SP70,SP70,SP70
          MATCH     SP70,PT0DDSC2
          IF        @EQUAL
            MOVE      PT0DDESC,DISPDESC
          ELSE
            MOVE      PT0DDSC2,DISPDESC
          ENDIF
          REP       "'`",DISPDESC
.
          WRITE     HTMLFILE;"<tr valign=top>":
                             "<td><a href='":
                             "javascript:showICD03(#"":
                              LINKPRG,".pbl?":
                              "&reportno=",LINKREP:
                              "&template=",LINKTEM:
                              "&icddcode=",KEY9:
                              "#");'>":
                              DPCODE,"</a></td>";
.
          WRITE     HTMLFILE;"<td>",DISPDESC,"</td></tr>"
.
          GOTO      SPTDCA80
.
SPTDCA40  MOVE      PT0DDESC,KEY60
          MATCH     SP70,PT0DDESC
          IF        @EQUAL
            MOVE      DDESC,KEY60
          ENDIF
          WRITE     HTMLFILE;"{#"code#":#"",KEY9,"#",":
                             "#"value#":#"",KEY60,"#",":
                             "#"subtext#":#"",SP1,"#"},"
.
SPTDCA80  ADD       ONE,DISNUMB
          COMPARE   NORECORD,DISNUMB
          GOTO      SPTDCA10 IF NOT EQUAL
.
SPTDCA90  IF        LINK2PRT=3
            WRITE     HTMLFILE;"]"
          ENDIF
SPTDCA99  RETURN
.------------------------------------------------------------
. Check ICD10 Diagnosis Record
.------------------------------------------------------------
SPTDCB00  MATCH     KEYWRD01,PTCDKWD
          GOTO      SPTDCB92 IF NOT EQUAL
          IF        KEYWRDNO>1
            PACK      SAVKEY24,PTCDKWD,PTCDITM
            CALL      SPTDCC00
            BRANCH    EXIT,SPTDCB91
            MOVE      SAVKEY24,KEY24
            CALL      RDPTKCD2
          ENDIF
.
SPTDCB90  MOVE      ZERO,OVRCD
          GOTO      SPTDCB99
SPTDCB91  MOVE      ONE,OVRCD
          GOTO      SPTDCB99
SPTDCB92  MOVE      TWO,OVRCD
SPTDCB99  RETURN
.------------------------------------------------------------
. Check for Matching ICD10 Diagnosis Words
.------------------------------------------------------------
SPTDCC00  MOVE      ONE,F2
          MOVE      ZERO,EXIT
          PACK      SAVKEY9,PTCDITM,SP70
.
SPTDCC10  COMPARE   KEYWRDNO,F2           * Loop through each Key Word in Search
          GOTO      SPTDCC99 IF EQUAL     * Exit OK
          ADD       ONE,F2
          LOAD      KEYWRDXX,F2,KEYWRD01,KEYWRD02,KEYWRD03,KEYWRD04,KEYWRD05:
                             KEYWRD06,KEYWRD07,KEYWRD08,KEYWRD09,KEYWRD10
          PACK      KEY24,PTCDITM,KEYWRDXX
          CALL      RDPTKCD1              * Check for Exact Match
          COMPARE   ZERO,OVRCD            * Ok so Continue Loop
          GOTO      SPTDCC10 IF EQUAL
.
          CALL      RKPTKCD1              * Not Exact so Read Next Record
          BRANCH    OVRCD,SPTDCC90        * No Match So Exit No Match
          PACK      KEY9,PTCDITM,SP70
          MATCH     SAVKEY9,KEY9          * Match Key Fields
          GOTO      SPTDCC90 IF NOT EQUAL * No Match So Exit
          STRIP     KEYWRDXX    
          MATCH     PTCDKWD,KEYWRDXX      * Check Key Word
          GOTO      SPTDCC90 IF NOT EQUAL * No Match So Exit
          GOTO      SPTDCC10              * Check Next Search Word
.
SPTDCC90  MOVE      ONE,EXIT
SPTDCC99  RETURN
.
.-------------------------------------------------------------
. ICD9 Operation Code Search Results
.-------------------------------------------------------------
ICOS0000  BRANCH    FLDITMNO,ICOS0100,ICOS0200,ICOS0300,ICOS0400,ICOS0500
.
ICOS0100  CALL      NXGR0000
          GOTO      ICOS9999
.
ICOS0200  CALL      LTGR0000
          GOTO      ICOS9999
.
ICOS0300  MOVE      ZERO,LINK2PRT
          CALL      SROPER00
          GOTO      ICOS9999
.
ICOS0400  MOVE      ONE,LINK2PRT
          CALL      SROPER00
          GOTO      ICOS9999
.
ICOS0500  MOVE      TWO,LINK2PRT
          CALL      SROPER00
          GOTO      ICOS9999
.
ICOS9999  RETURN
.------------------------------------------------------------
. Procedure Code Search
.------------------------------------------------------------
SROPER00  MATCH     "1",USNGICD9   * Search ICD9 Code?
          IF        @EQUAL
            CALL      SPTOIA00     * Search ICD9 
          ELSE
            CALL      SPTOCA00     * Search ICD10
          ENDIF
.
SROPER99  RETURN
.------------------------------------------------------------
. ICD9 Operation Code Search
.------------------------------------------------------------
SPTOIA00  WRITE     HTMLFILE;"<tr align=center>":
                             "<td class=HeadingCell colspan=2><b>":
                             "You Searched for ":
                               KEYWORDS,"</td>":
                             "</tr>":
                             "<tr>":
                             "<td class=HeadingCell><b>ICD Code</b></td>":
                             "<td class=HeadingCell><b>Description</b></td>":
                             "</tr>"
.
          CALL      GETWRD00
.
          IF        LINK2PRT<>1
            UNPACK    DIM127,D1,LINKPRG,DIM127
            UNPACK    DIM127,D1,LINKREP,DIM127
            UNPACK    DIM127,D1,LINKTEM,DIM127
          ENDIF
.
.
          IF        NORECORD=0
            MOVE      "10",NORECORD       * Set Default No Records to Display
          ENDIF
          MOVE      ZERO,RECNUMB
          MOVE      ZERO,DISNUMB
.
          STRIP     KEYWRD01
          PACK      KEY24,KEYWRD01,SP70
          CALL      RSPTOI2
SPTOIA10  CALL      RKPTOI2
          BRANCH    OVRCD,SPTOIA90
.
          MOVE      PTOIICD,KEY9                                               
          CALL      RD10T9O1              * Read ICD9 Procedure File
          BRANCH    OVRCD,SPTOIA10                                             
.
          CALL      SPTOIB00
          BRANCH    OVRCD,SPTOIA10,SPTOIA90
.
          ADD       ONE,RECNUMB
          IF        STARTNUM>=RECNUMB
            GOTO      SPTOIA10
          ENDIF
.
          BRANCH    LINK2PRT,SPTOIA20,SPTOIA30
.
          WRITE     HTMLFILE;"<tr valign=top>":
                              "<td><a href=",LINKPRG,".pbl?":
                               "&reportno=",LINKREP:
                               "&template=",LINKTEM:
                               "&itemkeys=",KEY9,">":
                               OPCODE,"</a></td>":
                               "<td>",ODESC,"</td>":
                             "</tr>"
.
          GOTO      SPTOIA80
.
SPTOIA20  MOVE      ODESC,JAVSNAME   * String to Convert
          CALL      JAVDES00         * Remove "'" replace with "%60"
.
          WRITE     HTMLFILE;"<tr valign=top>":
                              "<td><a href=#"":
                              "javascript:updateParent('",JAVSNAME:
                              "','",OPCODE,"','",USNGICD9,"')#">":
                              OPCODE,"</a></td><td>",ODESC,"</td></tr>"; 
.
          GOTO      SPTOIA80
.
SPTOIA30  WRITE     HTMLFILE;"<tr valign=top>":
                             "<td><a href='":
                             "javascript:showICO04(#"":
                              LINKPRG,".pbl?":
                              "&reportno=",LINKREP:
                              "&template=",LINKTEM:
                              "&icdocode=",KEY9:
                              "#");'>":
                              OPCODE,"</a></td>":
                              "<td>",ODESC,"</td>":
                             "</tr>"
.
SPTOIA80  ADD       ONE,DISNUMB
          COMPARE   NORECORD,DISNUMB
          GOTO      SPTOIA10 IF NOT EQUAL
SPTOIA90  
SPTOIA99  RETURN
.------------------------------------------------------------
. Check ICD9 Operation Record
.------------------------------------------------------------
SPTOIB00  MATCH     KEYWRD01,PTOIKWD
          GOTO      SPTOIB92 IF NOT EQUAL
          IF        KEYWRDNO>1
            PACK      SAVKEY24,PTOIKWD,PTOIICD
            CALL      SPTOIC00
            BRANCH    EXIT,SPTOIB91
            MOVE      SAVKEY24,KEY24
            CALL      RDPTOI2
          ENDIF
.
SPTOIB90  MOVE      ZERO,OVRCD
          GOTO      SPTOIB99
SPTOIB91  MOVE      ONE,OVRCD
          GOTO      SPTOIB99
SPTOIB92  MOVE      TWO,OVRCD
SPTOIB99  RETURN
.------------------------------------------------------------
. Check for Matching ICD9 Operation Words
.------------------------------------------------------------
SPTOIC00  MOVE      ONE,F2
          MOVE      ZERO,EXIT
          PACK      SAVKEY9,PTOIICD,SP70
.
SPTOIC10  COMPARE   KEYWRDNO,F2           * Loop through each Key Word in Search
          GOTO      SPTOIC99 IF EQUAL     * Exit OK
          ADD       ONE,F2
          LOAD      KEYWRDXX,F2,KEYWRD01,KEYWRD02,KEYWRD03,KEYWRD04,KEYWRD05:
                             KEYWRD06,KEYWRD07,KEYWRD08,KEYWRD09,KEYWRD10
          PACK      KEY24,PTOIICD,KEYWRDXX
          CALL      RDPTOI1               * Check for Exact Match
          COMPARE   ZERO,OVRCD            * Ok so Continue Loop
          GOTO      SPTOIC10 IF EQUAL
.
          CALL      RKPTOI1               * Not Exact so Read Next Record
          BRANCH    OVRCD,SPTOIC90        * No Match So Exit No Match
          PACK      KEY9,PTOIICD,SP70
          MATCH     SAVKEY9,KEY9        * Match Key Fields
          GOTO      SPTOIC90 IF NOT EQUAL * No Match So Exit
          STRIP     KEYWRDXX
          MATCH     PTOIKWD,KEYWRDXX         * Check Key Word
          GOTO      SPTOIC90 IF NOT EQUAL * No Match So Exit
          GOTO      SPTOIC10              * Check Next Search Word
.
SPTOIC90  MOVE      ONE,EXIT
SPTOIC99  RETURN
.------------------------------------------------------------
. ICD10 Operation Code Search
.------------------------------------------------------------
SPTOCA00  WRITE     HTMLFILE;"<tr align=center>":
                             "<td class=HeadingCell colspan=2><b>":
                             "You Searched for ":
                               KEYWORDS,"</td>":
                             "</tr>":
                             "<tr>":
                             "<td class=HeadingCell><b>ICD Code</b></td>":
                             "<td class=HeadingCell><b>Description</b></td>":
                             "</tr>"
.
          CALL      GETWRD00
.
          IF        LINK2PRT<>1
            UNPACK    DIM127,D1,LINKPRG,DIM127
            UNPACK    DIM127,D1,LINKREP,DIM127
            UNPACK    DIM127,D1,LINKTEM,DIM127
          ENDIF
.
.
          IF        NORECORD=0
            MOVE      "10",NORECORD       * Set Default No Records to Display
          ENDIF
          MOVE      ZERO,RECNUMB
          MOVE      ZERO,DISNUMB
.
          STRIP     KEYWRD01
          PACK      KEY24,KEYWRD01,SP70
          CALL      RSPTKCO2
SPTOCA10  CALL      RKPTKCO2
          BRANCH    OVRCD,SPTOCA90
.
          MOVE      PTCOITM,KEY9                                               
          MOVE      SP70,PT0ODESC
          CALL      RDPTICO1                * Read ICD10 Procedure File
          BRANCH    OVRCD,SPTOCA10                                             
.
          CALL      SPTOCB00
          BRANCH    OVRCD,SPTOCA10,SPTOCA90
.
          ADD       ONE,RECNUMB
          IF        STARTNUM>=RECNUMB
            GOTO      SPTOCA10
          ENDIF
.
          BRANCH    LINK2PRT,SPTOCA20,SPTOCA30
.
          WRITE     HTMLFILE;"<tr valign=top>":
                              "<td><a href=",LINKPRG,".pbl?":
                               "&reportno=",LINKREP:
                               "&template=",LINKTEM:
                               "&itemkeys=",KEY9,">":
                               OPCODE,"</a></td>";
          MATCH     SP70,PT0ODESC
          IF        !@EQUAL
            WRITE     HTMLFILE;"<td>",PT0ODESC,"</td>":
                             "</tr>"
          ELSE
            WRITE     HTMLFILE;"<td>",ODESC,"</td>":
                             "</tr>"
          ENDIF
.
          GOTO      SPTOCA80
.
SPTOCA20  PACK      DISPDESC,ODESC,SP70,SP70,SP70
.
          PACK      PT0ODSC2,PT0ODSC2,SP70,SP70,SP70
          MATCH     SP70,PT0ODSC2
          IF        !@EQUAL
            MOVE      PT0ODSC2,DISPDESC
            GOTO      SPTOCA25
          ENDIF
.
          PACK      PT0ODESC,PT0ODESC,SP70,SP70
          MATCH     SP70,PT0ODESC
          IF        !@EQUAL
            MOVE      PT0ODESC,DISPDESC
          ENDIF
.
SPTOCA25  REP       "'`",DISPDESC
.
          WRITE     HTMLFILE;"<tr valign=top>":
                              "<td><a href=#"":
                              "javascript:updateParent('",DISPDESC:
                              "','",OPCODE,"')#">":
                              OPCODE,"</a></td>";
.
          WRITE     HTMLFILE;"<td>",DISPDESC,"</td></tr>"
.
          GOTO      SPTOCA80
.
SPTOCA30  PACK      DISPDESC,ODESC,SP70,SP70,SP70
.
          PACK      PT0ODSC2,PT0ODSC2,SP70,SP70,SP70
          MATCH     SP70,PT0ODSC2
          IF        !@EQUAL
            MOVE      PT0ODSC2,DISPDESC
            GOTO      SPTOCA35
          ENDIF
.
          PACK      PT0ODESC,PT0ODESC,SP70,SP70
          MATCH     SP70,PT0ODESC
          IF        !@EQUAL
            MOVE      PT0ODESC,DISPDESC
          ENDIF
.
SPTOCA35  REP       "'`",DISPDESC
.
          WRITE     HTMLFILE;"<tr valign=top>":
                             "<td><a href='":
                             "javascript:showICO04(#"":
                              LINKPRG,".pbl?":
                              "&reportno=",LINKREP:
                              "&template=",LINKTEM:
                              "&icdocode=",KEY9:
                              "#");'>":
                              OPCODE,"</a></td>";
.
          WRITE     HTMLFILE;"<td>",DISPDESC,"</td></tr>"
.
SPTOCA80  ADD       ONE,DISNUMB
          COMPARE   NORECORD,DISNUMB
          GOTO      SPTOCA10 IF NOT EQUAL
SPTOCA90  
SPTOCA99  RETURN
.------------------------------------------------------------
. Check ICD10 Operation Record
.------------------------------------------------------------
SPTOCB00  MATCH     KEYWRD01,PTCOKWD
          GOTO      SPTOCB92 IF NOT EQUAL
          IF        KEYWRDNO>1
            PACK      SAVKEY24,PTCOKWD,PTCOITM
            CALL      SPTOCC00
            BRANCH    EXIT,SPTOCB91
            MOVE      SAVKEY24,KEY24
            CALL      RDPTKCO2
          ENDIF
.
SPTOCB90  MOVE      ZERO,OVRCD
          GOTO      SPTOCB99
SPTOCB91  MOVE      ONE,OVRCD
          GOTO      SPTOCB99
SPTOCB92  MOVE      TWO,OVRCD
SPTOCB99  RETURN
.------------------------------------------------------------
. Check for Matching ICD10 Operation Words
.------------------------------------------------------------
SPTOCC00  MOVE      ONE,F2
          MOVE      ZERO,EXIT
          PACK      SAVKEY9,PTCOITM,SP70
.
SPTOCC10  COMPARE   KEYWRDNO,F2           * Loop through each Key Word in Search
          GOTO      SPTOCC99 IF EQUAL     * Exit OK
          ADD       ONE,F2
          LOAD      KEYWRDXX,F2,KEYWRD01,KEYWRD02,KEYWRD03,KEYWRD04,KEYWRD05:
                             KEYWRD06,KEYWRD07,KEYWRD08,KEYWRD09,KEYWRD10
          PACK      KEY24,PTCOITM,KEYWRDXX
          CALL      RDPTKCO1              * Check for Exact Match
          COMPARE   ZERO,OVRCD            * Ok so Continue Loop
          GOTO      SPTOCC10 IF EQUAL
.
          CALL      RKPTKCO1              * Not Exact so Read Next Record
          BRANCH    OVRCD,SPTOCC90        * No Match So Exit No Match
          PACK      KEY9,PTCOITM,SP70
          MATCH     SAVKEY9,KEY9          * Match Key Fields
          GOTO      SPTOCC90 IF NOT EQUAL * No Match So Exit
          STRIP     KEYWRDXX
          MATCH     PTCOKWD,KEYWRDXX      * Check Key Word
          GOTO      SPTOCC90 IF NOT EQUAL * No Match So Exit
          GOTO      SPTOCC10              * Check Next Search Word
.
SPTOCC90  MOVE      ONE,EXIT
SPTOCC99  RETURN
.------------------------------------------------------------
. Format Doctors Name (for Javascript)
.*** format the surname and given name by changing any ' to %60
.---------------------------------------------------------------
JAVDES00  SCAN      "'",JAVSNAME             * find any apostrophies
          GOTO      JAVDES99 IF NOT EQUAL
.
          MOVE      JAVSNAME,ENDNAME
          REP       "' ",ENDNAME             * remove the apostrophy
.
          LENSET    JAVSNAME
          RESET     JAVSNAME                 * get all characters before '
          MOVE      JAVSNAME,STRTNAME
.
          REP       "'%",STRTNAME
          STRIP     STRTNAME
          PACK      JAVSNAME,STRTNAME,SIXTY,ENDNAME,SP70 * formatted surname
.
JAVDES99  RETURN
.------------------------------------------------------------
. Link to Next Group   
.------------------------------------------------------------
NXGR0000  MOVE      SP70,KEY12
          MATCH     SP70,EFFDATES
          IF        !@EQUAL
            UNPACK    EFFDATES,CCENT,CYEAR,CMON,CDAY
            MOVE      CMON,F2
            LOAD      MTHNAM3,F2,JAN,FEB,MAR,APR,MAY,JUN,JUL,AUG,SEP,OCT,NOV,DEC
            PACK      KEY12,CDAY,SP1,MTHNAM3,SP1,CCENT,CYEAR
            REP       " +",KEY12
          ENDIF
.
          MOVE      NORECORD,KEY2
          REP       " +",KEY2
          ASSIGN    STARTNUM+NORECORD,F3
          MOVE      F3,KEY3
          REP       " +",KEY3
          MOVE      ITEMSTAT,KEY1
          UNPACK    DIM127,D1,FLDPARA,DIM127
          MOVE      REPORTNO,F2
.
          REP       " +",KEYWORDS
          REP       " +",MULTHOSP
          REP       " +",USNGICD9
.
          WRITE     HTMLFILE;"patweb94.pbl":
                                 "?reportno=",F2:
                                 "&template=",FLDPARA:
                                 "&startnum=",KEY3:
                                 "&norecord=",KEY2:
                                 "&itemstat=",KEY1:     
                                 "&keywords=",KEYWORDS:
                                 "&multhosp=",MULTHOSP:
                                 "&usngicd9=",USNGICD9:
                                 "&srchhosp=",SRCHHOSP:
                                 "&srchclam=",SRCHCLAM:
                                 "&srchcntr=",SRCHCNTR:
                                 "&srchtabl=",SRCHTABL:
                                 "&effdates=",KEY12;
.
          REP       "+ ",KEYWORDS
          REP       "+ ",MULTHOSP
          REP       "+ ",USNGICD9
.
NXGR9999  RETURN
.
.------------------------------------------------------------
. Link to Last Group
.------------------------------------------------------------
LTGR0000  MOVE      SP70,KEY12
          MATCH     SP70,EFFDATES
          IF        !@EQUAL
            UNPACK    EFFDATES,CCENT,CYEAR,CMON,CDAY
            MOVE      CMON,F2
            LOAD      MTHNAM3,F2,JAN,FEB,MAR,APR,MAY,JUN,JUL,AUG,SEP,OCT,NOV,DEC
            PACK      KEY12,CDAY,SP1,MTHNAM3,SP1,CCENT,CYEAR
            REP       " +",KEY12
          ENDIF
.
          MOVE      NORECORD,KEY2                                              
          REP       " +",KEY2
          ASSIGN    STARTNUM-NORECORD,F3
          IF        F3<0
            MOVE    ZERO,F3
          ENDIF
          MOVE      F3,KEY3
          REP       " +",KEY3
          MOVE      ITEMSTAT,KEY1
          UNPACK    DIM127,D1,FLDPARA,DIM127
          MOVE      REPORTNO,F2
.
          REP       " +",KEYWORDS
          REP       " +",MULTHOSP
          REP       " +",USNGICD9
.
          WRITE     HTMLFILE;"patweb94.pbl":
                                 "?reportno=",F2:
                                 "&template=",FLDPARA:
                                 "&startnum=",KEY3:
                                 "&norecord=",KEY2:
                                 "&itemstat=",KEY1:     
                                 "&keywords=",KEYWORDS:
                                 "&multhosp=",MULTHOSP:
                                 "&usngicd9=",USNGICD9:
                                 "&srchhosp=",SRCHHOSP:
                                 "&srchclam=",SRCHCLAM:
                                 "&srchcntr=",SRCHCNTR:
                                 "&srchtabl=",SRCHTABL:
                                 "&effdates=",KEY12;
.
          REP       "+ ",KEYWORDS
          REP       "+ ",MULTHOSP
          REP       "+ ",USNGICD9
.
LTGR9999  RETURN
.------------------------------------------------------------
. MBS Code Search Server
.------------------------------------------------------------
MCSS0000  BRANCH    FLDITMNO,MCSS0100,MCSS0200,MCSS0300,MCSS0400,MCSS0500:
                             MCSS0600,MCSS0700,MCSS0800,MCSS0900,MCSS1000:  
                             MCSS1100,MCSS1200,MCSS1300,MCSS1400,MCSS1500: 
                             MCSS1600,MCSS1700,MCSS1800,MCSS1900,MCSS2000:
                             MCSS2100,MCSS2200,MCSS2300,MCSS2400,MCSS2500:
                             MCSS2600,MCSS2700,MCSS2800,MCSS2900,MCSS3000
          GOTO      MCSS9999
.
MCSS0100  REP       " +",MBSITEMN
          REP       " +",MBSEFFDT
          UNPACK    DIM127,D1,LINKPRG,DIM127
          UNPACK    DIM127,D1,LINKREP,DIM127
          UNPACK    DIM127,D1,LINKTEM,DIM127
          WRITE     HTMLFILE;LINKPRG,".pbl?":
                             "&reportno=",LINKREP:
                             "&template=",LINKTEM:
                             "&mbsitemn=",MBSITEMN:
                             "&mbseffdt=",MBSEFFDT;
          REP       "+ ",MBSITEMN
          REP       "+ ",MBSEFFDT
          GOTO      MCSS9999
.
MCSS0200  WRITE     HTMLFILE;ITEMNO;
          GOTO      MCSS9999
.
MCSS0300  WRITE     HTMLFILE;IALPHA;
          GOTO      MCSS9999
.
MCSS0400  WRITE     HTMLFILE;IDESC;
          GOTO      MCSS9999
.
MCSS0500  WRITE     HTMLFILE;QIAMT;
          GOTO      MCSS9999
.
MCSS0600  MOVE      "FI",CATEGORY
          MOVE      IMISGRP,CODE
          CALL      CODDES00
          WRITE     HTMLFILE;TDESC;
          GOTO      MCSS9999
.
MCSS0700  MOVE      "A ",CATEGORY
          MOVE      ICLSS,CODE
          CALL      CODDES00
          WRITE     HTMLFILE;TDESC;
          GOTO      MCSS9999
.
MCSS0800  MOVE      "TB",CATEGORY
          MOVE      IBAND1,CODE
          CALL      CODDES00
          WRITE     HTMLFILE;TDESC;
          GOTO      MCSS9999
.
MCSS0900  MOVE      "TB",CATEGORY
          MOVE      IBAND2,CODE
          CALL      CODDES00
          WRITE     HTMLFILE;TDESC;
          GOTO      MCSS9999
.
MCSS1000  MOVE      "TB",CATEGORY
          MOVE      IBAND3,CODE
          CALL      CODDES00
          WRITE     HTMLFILE;TDESC;
          GOTO      MCSS9999
.
MCSS1100  MOVE      "TB",CATEGORY
          MOVE      IBAND4,CODE
          CALL      CODDES00
          WRITE     HTMLFILE;TDESC;
          GOTO      MCSS9999
.
MCSS1200  MOVE      "TB",CATEGORY
          MOVE      IBAND5,CODE
          CALL      CODDES00
          WRITE     HTMLFILE;TDESC;
          GOTO      MCSS9999
.
MCSS1300  MOVE      "TB",CATEGORY
          MOVE      IBAND6,CODE
          CALL      CODDES00
          WRITE     HTMLFILE;TDESC;
          GOTO      MCSS9999
.
MCSS1400  MOVE      "TB",CATEGORY
          MOVE      IBAND7,CODE
          CALL      CODDES00
          WRITE     HTMLFILE;TDESC;
          GOTO      MCSS9999
.
MCSS1500  MOVE      "TB",CATEGORY
          MOVE      IBAND8,CODE
          CALL      CODDES00
          WRITE     HTMLFILE;TDESC;
          GOTO      MCSS9999
.
MCSS1600  MOVE      "TB",CATEGORY
          MOVE      IBAND9,CODE
          CALL      CODDES00
          WRITE     HTMLFILE;TDESC;
          GOTO      MCSS9999
.
MCSS1700  MOVE      "TB",CATEGORY
          MOVE      IBAND10,CODE
          CALL      CODDES00
          WRITE     HTMLFILE;TDESC;
          GOTO      MCSS9999
.
MCSS1800  MOVE      "TB",CATEGORY
          MOVE      IBAND11,CODE
          CALL      CODDES00
          WRITE     HTMLFILE;TDESC;
          GOTO      MCSS9999
.
MCSS1900  MOVE      "TB",CATEGORY
          MOVE      IBAND12,CODE
          CALL      CODDES00
          WRITE     HTMLFILE;TDESC;
          GOTO      MCSS9999
.
MCSS2000  MOVE      "TB",CATEGORY
          MOVE      IBAND13,CODE
          CALL      CODDES00
          WRITE     HTMLFILE;TDESC;
          GOTO      MCSS9999
.
MCSS2100  MOVE      "TB",CATEGORY
          MOVE      IBAND14,CODE
          CALL      CODDES00
          WRITE     HTMLFILE;TDESC;
          GOTO      MCSS9999
.
MCSS2200  MOVE      "TB",CATEGORY
          MOVE      IBAND15,CODE
          CALL      CODDES00
          WRITE     HTMLFILE;TDESC;
          GOTO      MCSS9999
.
MCSS2300  MOVE      "TB",CATEGORY
          MOVE      IBAND16,CODE
          CALL      CODDES00
          WRITE     HTMLFILE;TDESC;
          GOTO      MCSS9999
.
MCSS2400  MATCH     "I",PTITACTV
          IF        @EQUAL
            WRITE     HTMLFILE;"Inactive";
          ELSE
            WRITE     HTMLFILE;"Active";
          ENDIF 
          GOTO      MCSS9999
.
MCSS2500  WRITE     HTMLFILE;PTITLINK;
          GOTO      MCSS9999
.
MCSS2600  IF        PTITEXCL=1
            WRITE     HTMLFILE;"Yes";
          ELSE
            WRITE     HTMLFILE;"No";
          ENDIF 
          GOTO      MCSS9999
.
MCSS2700  MATCH     "1",PTITIWRN
          IF        @EQUAL
            WRITE     HTMLFILE;"Yes";
          ELSE
            WRITE     HTMLFILE;"No";
          ENDIF
          GOTO      MCSS9999
.
MCSS2800  MOVE      "A ",CATEGORY
          MOVE      PTITDCSC,CODE
          CALL      CODDES00
          WRITE     HTMLFILE;TDESC;
          GOTO      MCSS9999
.
MCSS2900  MOVE      GSTFREE,TDESC
          LOAD      TDESC,PTITGSTA,GSTPAYBL,GSTEITHR
          WRITE     HTMLFILE;TDESC;
          GOTO      MCSS9999
.
MCSS3000  PACK      KEY6,PTITGSTC,SP10
          CALL      RDIBGS1
          BRANCH    OVRCD,MCSS9999
          WRITE     HTMLFILE;IBGSDESC;
          GOTO      MCSS9999
.
MCSS9999  RETURN
.------------------------------------------------------------
. DRG Code Search Server
.------------------------------------------------------------
DCSS0000  BRANCH    FLDITMNO,DCSS0100,DCSS0200,DCSS0300,DCSS0400,DCSS0500:
                             DCSS0600,DCSS0700,DCSS0800
          GOTO      DCSS9999
.
DCSS0100  REP       " +",DRGCODES
          UNPACK    DIM127,D1,LINKPRG,DIM127
          UNPACK    DIM127,D1,LINKREP,DIM127
          UNPACK    DIM127,D1,LINKTEM,DIM127
          WRITE     HTMLFILE;LINKPRG,".pbl?":
                             "&reportno=",LINKREP:
                             "&template=",LINKTEM:
                             "&drgcodes=",DRGCODES;
          REP       "+ ",DRGCODES
          GOTO      DCSS9999
.
DCSS0200  WRITE     HTMLFILE;PTDWDRGC;
          GOTO      DCSS9999
.
DCSS0300  WRITE     HTMLFILE;PTDWMDCC;
          GOTO      DCSS9999
.
DCSS0400  WRITE     HTMLFILE;PTDWDESC;
          GOTO      DCSS9999
.
DCSS0500  WRITE     HTMLFILE;PTDWLOWT;
          GOTO      DCSS9999
.
DCSS0600  WRITE     HTMLFILE;PTDWHIGH;
          GOTO      DCSS9999
.
DCSS0700  WRITE     HTMLFILE;PTDWRWGT;
          GOTO      DCSS9999
.
DCSS0800  WRITE     HTMLFILE;PTDWCLSP;
          GOTO      DCSS9999
.
DCSS9999  RETURN
.------------------------------------------------------------
. ICD Diagnosis Code Search Server
.------------------------------------------------------------
ICSS0000  BRANCH    FLDITMNO,ICSS0100,ICSS0200,ICSS0300,ICSS0400,ICSS0500:
                             ICSS0600,ICSS0700,ICSS0800,ICSS0900,ICSS1000:
                             ICSS1100
.
ICSS0100  REP       " +",ICDDCODE
          UNPACK    DIM127,D1,LINKPRG,DIM127
          UNPACK    DIM127,D1,LINKREP,DIM127
          UNPACK    DIM127,D1,LINKTEM,DIM127
          WRITE     HTMLFILE;LINKPRG,".pbl?":
                             "&reportno=",LINKREP:
                             "&template=",LINKTEM:
                             "&icddcode=",ICDDCODE;
          REP       "+ ",ICDDCODE
          GOTO      ICSS9999
.       
ICSS0200  WRITE     HTMLFILE;DPCODE;
          GOTO      ICSS9999
.
ICSS0300  WRITE     HTMLFILE;DDESC;
          GOTO      ICSS9999
.
ICSS0400  WRITE     HTMLFILE;DGPCODE;
          GOTO      ICSS9999
.
ICSS0500  WRITE     HTMLFILE;DKEYWD;
          GOTO      ICSS9999
.
ICSS0600  WRITE     HTMLFILE;DFLAG;
          GOTO      ICSS9999
.
ICSS0700  MOVE      ZERO,F1
          MOVE      DAGEGP,F1
          BRANCH    F1,ICSS0710,ICSS0720,ICSS0730,ICSS0740,ICSS0750:
                       ICSS0760,ICSS0770,ICSS0780	
          WRITE     HTMLFILE;"No Age Restriction";
          GOTO      ICSS9999
.
ICSS0710  WRITE     HTMLFILE;"Age must be <",DLOW," or >",DHIGH," Months"; 
          GOTO      ICSS9999
.
ICSS0720  WRITE     HTMLFILE;"Age should be <",DLOW," or >",DHIGH," Months"; 
          GOTO      ICSS9999
.
ICSS0730  WRITE     HTMLFILE;"Age must be <",DLOW," or >",DHIGH," Years"; 
          GOTO      ICSS9999
.
ICSS0740  WRITE     HTMLFILE;"Age should be <",DLOW," or >",DHIGH," Years"; 
          GOTO      ICSS9999
.
ICSS0750  WRITE     HTMLFILE;"Age must between ",DLOW," and ",DHIGH," Years"; 
          GOTO      ICSS9999
.
ICSS0760  WRITE     HTMLFILE;"Age should between ",DLOW," and ",DHIGH," Years"; 
          GOTO      ICSS9999
.
ICSS0770  WRITE     HTMLFILE;"Age must between ",DLOW," and ",DHIGH," Months"; 
          GOTO      ICSS9999
.
ICSS0780  WRITE     HTMLFILE;"Age should between ",DLOW," and ",DHIGH," Months";
          GOTO      ICSS9999
.
ICSS0800  MOVE      ZERO,F1
          MOVE      DSEX,F1
          BRANCH    F1,ICSS0810,ICSS0820,ICSS0830,ICSS0840,ICSS0850:
                       ICSS0860 
          WRITE     HTMLFILE;"No Sex Restriction";
          GOTO      ICSS9999
.
ICSS0810  WRITE     HTMLFILE;"Must be Female";
          GOTO      ICSS9999
.
ICSS0820  WRITE     HTMLFILE;"Should be Female";
          GOTO      ICSS9999
.
ICSS0830  WRITE     HTMLFILE;"Must be Male";
          GOTO      ICSS9999
.
ICSS0840  WRITE     HTMLFILE;"Should be Male";
          GOTO      ICSS9999
.
ICSS0850  WRITE     HTMLFILE;"Reject Female with no Explanation code";
          GOTO      ICSS9999
.
ICSS0860  WRITE     HTMLFILE;"Reject Male with no Explanation code";
          GOTO      ICSS9999
.
ICSS0900  WRITE     HTMLFILE;DDAGGER;
          GOTO      ICSS9999
.
ICSS1000  WRITE     HTMLFILE;DAREA;
          GOTO      ICSS9999
.
ICSS1100  WRITE     HTMLFILE;DDIGITS;
          GOTO      ICSS9999
.
ICSS9999  RETURN 
.------------------------------------------------------------
. ICD Operation Code Search Server
.------------------------------------------------------------
OCSS0000  BRANCH    FLDITMNO,OCSS0100,OCSS0200,OCSS0300,OCSS0400,OCSS0500:
                             OCSS0600,OCSS0700,OCSS0800,OCSS0900,OCSS1000:
                             OCSS1100,OCSS1200
.
OCSS0100  REP       " +",ICDOCODE
          UNPACK    DIM127,D1,LINKPRG,DIM127
          UNPACK    DIM127,D1,LINKREP,DIM127
          UNPACK    DIM127,D1,LINKTEM,DIM127
          WRITE     HTMLFILE;LINKPRG,".pbl?":
                             "&reportno=",LINKREP:
                             "&template=",LINKTEM:
                             "&icdocode=",ICDOCODE;
          REP       "+ ",ICDOCODE
          GOTO      OCSS9999
.       
OCSS0200  WRITE     HTMLFILE;OPCODE;
          GOTO      OCSS9999
.
OCSS0300  WRITE     HTMLFILE;ODESC;
          GOTO      OCSS9999
.
OCSS0400  WRITE     HTMLFILE;OGPCODE;
          GOTO      OCSS9999
.
OCSS0500  WRITE     HTMLFILE;OKEYWD;
          GOTO      OCSS9999
.
OCSS0600  WRITE     HTMLFILE;OFLAG;
          GOTO      OCSS9999
.
OCSS0700  MOVE      ZERO,F1
          MOVE      OAGEGP,F1
          BRANCH    F1,OCSS0710,OCSS0720,OCSS0730,OCSS0740,OCSS0750:
                           OCSS0760,OCSS0770,OCSS0780	
          WRITE     HTMLFILE;"No Age Restriction";
          GOTO      OCSS9999
.
OCSS0710  WRITE     HTMLFILE;"Age must be <",OLOW," or >",OHIGH," Months"; 
          GOTO      OCSS9999
.
OCSS0720  WRITE     HTMLFILE;"Age should be <",OLOW," or >",OHIGH," Months"; 
          GOTO      OCSS9999
.
OCSS0730  WRITE     HTMLFILE;"Age must be <",OLOW," or >",OHIGH," Years"; 
          GOTO      OCSS9999
.
OCSS0740  WRITE     HTMLFILE;"Age should be <",OLOW," or >",OHIGH," Years"; 
          GOTO      OCSS9999
.
OCSS0750  WRITE     HTMLFILE;"Age must between ",OLOW," and ",OHIGH," Years"; 
          GOTO      OCSS9999
.
OCSS0760  WRITE     HTMLFILE;"Age should between ",OLOW," and ",OHIGH," Years"; 
          GOTO      OCSS9999
.
OCSS0770  WRITE     HTMLFILE;"Age must between ",OLOW," and ",OHIGH," Months"; 
          GOTO      OCSS9999
.
OCSS0780  WRITE     HTMLFILE;"Age should between ",OLOW," and ",OHIGH," Months";
          GOTO      OCSS9999
.
OCSS0800  MOVE      ZERO,F1
          MOVE      OSEX,F1
          BRANCH    F1,OCSS0810,OCSS0820,OCSS0830,OCSS0840,OCSS0850:
                       OCSS0860
          WRITE     HTMLFILE;"No Sex Restriction";          
          GOTO      OCSS9999                                
.                                                           
OCSS0810  WRITE     HTMLFILE;"Must be Female";
          GOTO      OCSS9999
.
OCSS0820  WRITE     HTMLFILE;"Should be Female";
          GOTO      OCSS9999
.
OCSS0830  WRITE     HTMLFILE;"Must be Male";
          GOTO      OCSS9999
.
OCSS0840  WRITE     HTMLFILE;"Should be Male";
          GOTO      OCSS9999
.
OCSS0850  WRITE     HTMLFILE;"Reject Female with no Explanation code"; 
          GOTO      OCSS9999                                          
.
OCSS0860  WRITE     HTMLFILE;"Reject Male with no Explanation code"; 
          GOTO      OCSS9999                                  
.
OCSS0900  WRITE     HTMLFILE;ODAGGER;
          GOTO      OCSS9999
.
OCSS1000  WRITE     HTMLFILE;OAREA;
          GOTO      OCSS9999
.
OCSS1100  WRITE     HTMLFILE;ODIGITS;
          GOTO      OCSS9999
.
OCSS1200  WRITE     HTMLFILE;OFEE;
          GOTO      OCSS9999
.
OCSS9999  RETURN 
.------------------------------------------------------------
. DRG Code Search Server
.------------------------------------------------------------
CCSS0000  BRANCH    FLDITMNO,CCSS0100,CCSS0200,CCSS0300,CCSS0400,CCSS0500:
                             CCSS0600
          GOTO      CCSS9999
.
CCSS0100  REP       " +",CASECODE
          UNPACK    DIM127,D1,LINKPRG,DIM127
          UNPACK    DIM127,D1,LINKREP,DIM127
          UNPACK    DIM127,D1,LINKTEM,DIM127
          WRITE     HTMLFILE;LINKPRG,".pbl?":
                             "&reportno=",LINKREP:
                             "&template=",LINKTEM:
                             "&casecode=",CASECODE;
          REP       "+ ",CASECODE
          GOTO      CCSS9999
.
CCSS0200  WRITE     HTMLFILE;PTCACODE;
          GOTO      CCSS9999
.
CCSS0300  WRITE     HTMLFILE;PTCADES1;
          GOTO      CCSS9999
.
CCSS0400  WRITE     HTMLFILE;PTCADES2;
          GOTO      CCSS9999
.
CCSS0500  WRITE     HTMLFILE;PTCAELOS;
          GOTO      CCSS9999
.
CCSS0600  COMPARE   ONE,PTCAACTV
          IF   @EQUAL
              WRITE     HTMLFILE;"Active";
            ELSE
              WRITE     HTMLFILE;"Inactive";
          ENDIF
          GOTO      CCSS9999
.
CCSS9999  RETURN
.------------------------------------------------------------
. Onlne Code Validation
.------------------------------------------------------------
VALCOD00  MOVE      SP70,VALDNAME
          MATCH     SP70,VALDCODE
          GOTO      VALCOD90 IF EQUAL
          GOTO      VALCOD90 IF EOS
.
          MOVE      VALDCODE,SAVECODE             * save code incase its invalid
          MOVE      "Invalid Code Entered",VALDNAME
          BRANCH    VALDTYPE,VALCOD10,VALCOD20,VALCOD30,VALCOD40,VALCOD50:
                             VALCOD60
          MOVE      "Invalid Validation Type",VALDNAME
          GOTO      VALCOD90
.
VALCOD10  PACK      KEY17,VALDCODE,SP70
          CALL      PATITMRD
          IF        OVRCD=0
            MOVE      IDESC,VALDNAME
          ENDIF
          GOTO      VALCOD90
.
VALCOD20  MOVE      VALDCODE,KEY4
          MOVE      "999",KEY3
          PACK      KEY7,KEY4,KEY3,SP10   * last DRG version          *I-137125
          CALL      RSPTDGW1
          CALL      RPPTDGW1
          IF        OVRCD=0
            MATCH     PTDWDRGC,KEY4         * same DRG code ?         *I-137125
            GOTO      VALCOD90 IF NOT EQUAL                           *I-137125
            MOVE      PTDWDESC,VALDNAME
          ENDIF
          GOTO      VALCOD90
.
VALCOD30  MOVE      VALDCODE,KEY9
          CALL      RDPTICD1 
          IF        OVRCD=0
            MOVE      DDESC,VALDNAME
          ENDIF
          GOTO      VALCOD90
.
VALCOD40  MOVE      VALDCODE,KEY9
          CALL      RDPTICO1 
          IF        OVRCD=0
            MOVE      ODESC,VALDNAME
          ENDIF
          GOTO      VALCOD90
.
VALCOD50  PACK      KEY5,VALCATEG,VALDCODE
          CALL      RDCODE1 
          IF        OVRCD=0
            MOVE      TDESC,VALDNAME
          ENDIF
          GOTO      VALCOD90
.
VALCOD60  PACK      KEY6,VALDCODE,SP70
          CALL      RDDOCT1 
          IF        OVRCD=0
            MOVE      DCODE,DOCTCODE
            MOVE      DTITL,FMTTITLE
            MOVE      DGNAME,FMTGNAME
            MOVE      DSNAME,FMTSNAME
            CALL      DOCNM000
            MOVE      DOCFNAME,VALDNAME
          ENDIF
          GOTO      VALCOD90
.
VALCOD90  CALL      OPENHTML
          BRANCH    EXIT,VALCOD99
.
          WRITE     HTMLFILE;"<h3 align=center>Checking Database</h3>":
                             "<script type=#"text/javascript#">":
                             "{ opener.ValidateName.value=#"",VALDNAME,"#";";
.
          MATCH     "Invalid",VALDNAME
          IF        @EQUAL
            MOVE      SAVECODE,VALDCODE
            WRITE     HTMLFILE;"opener.ValidateCode.value=#"",SAVECODE,"#";"
            WRITE     HTMLFILE;"opener.ValidateName.value=#"#";"
            WRITE     HTMLFILE;"opener.ValidateCode.select();"
            WRITE     HTMLFILE;"  alert(#"Invalid Code Entered#");"
            WRITE     HTMLFILE;"opener.ValidateCode.focus();"
          ELSE
            WRITE     HTMLFILE;"opener.ValidateCode.value=#"",VALDCODE,"#";"
          ENDIF
.
          WRITE     HTMLFILE;"  close(); } </script>"
          CALL      CLOSHTML
.
VALCOD99  RETURN
.                                           *** HPS Code Starts Here
.******************************************************************************
.*        Search frame For Miscellaneous Charge code                          * 
.******************************************************************************
MISC0000  BRANCH    FLDITMNO,MISC0100,MISC0200,MISC0300,MISC0400,MISC0500:
                             MISC0600,MISC0700,MISC0800,MISC0900
          GOTO      MISC9999
.
MISC0100  CALL      MSCSRH00                * Default Misc Search
          GOTO      MISC9999
.
MISC0200  CALL      LTGR0000                * Prev set of records
          GOTO      MISC9999
.
MISC0300  CALL      NXGR0000                * Next set of records
          GOTO      MISC9999
.
MISC0400  MOVE      NORECORD,KEY2           * I SRF 33349
          REP       " +",KEY2
          ASSIGN    STARTNUM+NORECORD,F3
          MOVE      F3,KEY3
          REP       " +",KEY3
          REP       " +",MULTHOSP
          UNPACK    DIM127,D1,FLDPARA,DIM127
          WRITE     HTMLFILE;"patweb94.pbl?reportno=10":
                                 "&template=",FLDPARA:
                                 "&startnum=",KEY3:
                                 "&norecord=",KEY2:
                                 "&multhosp=",MULTHOSP:
                                 "&keywords=",KEYWORDS;
          REP       "+ ",MULTHOSP
          GOTO      MISC9999

MISC0500  MOVE      NORECORD,KEY2
          REP       " +",KEY2
          ASSIGN    STARTNUM-NORECORD,F3
          IF        F3<0
            MOVE      ZERO,F3
          ENDIF
          MOVE      F3,KEY3
          REP       " +",KEY3
          REP       " +",MULTHOSP
          UNPACK    DIM127,D1,FLDPARA,DIM127
          WRITE     HTMLFILE;"patweb94.pbl?reportno=10":
                                 "&template=",FLDPARA:
                                 "&startnum=",KEY3:
                                 "&norecord=",KEY2:
                                 "&multhosp=",MULTHOSP:
                                 "&keywords=",KEYWORDS;
          REP       "+ ",MULTHOSP
          GOTO      MISC9999
.
MISC0600  MOVE      ZERO,LNK2PRT   * Link to alternate Program
          CALL      SPTNKA00
          GOTO      MISC9999
.
MISC0700  MOVE      ONE,LNK2PRT    * Link to Parent
          CALL      SPTNKA00
          GOTO      MISC9999
.
MISC0800  WRITE     HTMLFILE;SP10;
          GOTO      MISC9999
.
MISC0900  MOVE      TWO,LNK2PRT    * Link to Window
          CALL      SPTNKA00
          GOTO      MISC9999                           * end I SRF 33349
.
MISC9999  RETURN
+                                           *** HPS Code Ends Here
.------------------------------------------------------------
. Display Default Misc. Change Search 
.------------------------------------------------------------
MSCSRH00  CALL      DMSCHD00             * Heading
.
          RESET     KEYWORDS
          MATCH     KEYWORDS,SP70
          GOTO      MSCSRH99 IF EQUAL
.
          IF        NORECORD=0
            MOVE      "10",NORECORD       * Set Default No Records to Display
          ENDIF
          MOVE      ZERO,RECNUMB
          MOVE      ZERO,DISNUMB
.
          CALL      GETWRD00       * This routine Splits the KEYWORDS field
                                  * into KEYWRD01 to KEYWRD10
          STRIP     KEYWRD01
.
          IF        IBCNMHOS=1
            IF        CFEETYP<>5
              MATCH     SP10,PTHSDCLM
              GOTO      MSCSRH50 IF NOT EQUAL
            ENDIF
          ENDIF
          
          PACK      KEY56,KEYWRD01,SP70
          CALL      RSPTMKI2
MSCSRH10  CALL      RKPTMKI2
          BRANCH    OVRCD,MSCSRH99
.
          IF        CFEETYP=5
            MATCH     KEYWRD01,PTMKKKWD
            GOTO      MSCSRH99 IF NOT EQUAL
            CALL      NZPMSC00
            BRANCH    EXIT,MSCSRH10
.
            MOVE      NZMCCLMC,MCLMCOD
            MOVE      NZMCCNTR,MHFUND
            MOVE      NZMCMCHG,MCHARGE
            MOVE      NZMCEFDT,PTMCEFDT
            MOVE      NZMCDESC,MDESC
.
          ELSE
            PACK      KEY29,PTMKCODE,SP70
            CALL      PATMCHRD                * read Misc.Charges file 
            BRANCH    EXIT,MSCSRH10           * if not valid
          ENDIF
.
MSCSRH20  IF        CFEETYP<>5
            MATCH     SP70,MHFUND
            GOTO      MSCSRH10 IF NOT EQUAL
          ENDIF
.
.         ADD       ONE,RECNUMB
.         IF        STARTNUM>=RECNUMB
.           GOTO      MSCSRH10
.         ENDIF
.
.         Replace characters # " , with spaces
.
          REP       "## #' #" #, ",MDESC
.
          CALL      ADDMSC00
          BRANCH    EXIT,MSCSRH10          * not unique misc charge
.
          ADD       ONE,RECNUMB
          IF        STARTNUM>=RECNUMB
            GOTO      MSCSRH10
          ENDIF
.
          CALL      DMSCRW00               * Rows
          ADD       ONE,DISNUMB
          COMPARE   NORECORD,DISNUMB
          GOTO      MSCSRH10 IF NOT EQUAL
          GOTO      MSCSRH99
.
.         Multi Hospital with known Default claim code
.
MSCSRH50  PACK      KEY59,PTHSDCLM,KEYWRD01,SP70
          CALL      RSPTMKI3
MSCSRH60  CALL      RKPTMKI3
          BRANCH    OVRCD,MSCSRH99
.           
          IF        CFEETYP=5
            MATCH     KEYWRD01,PTMKKKWD
            GOTO      MSCSRH99 IF NOT EQUAL
            CALL      NZPMSC00
            BRANCH    EXIT,MSCSRH60
.
            MOVE      NZMCCLMC,MCLMCOD
            MOVE      NZMCCNTR,MHFUND
            MOVE      NZMCMCHG,MCHARGE
            MOVE      NZMCEFDT,PTMCEFDT
            MOVE      NZMCDESC,MDESC

          ELSE
            MATCH     PTMKDCLM,PTHSDCLM
            GOTO      MSCSRH99 IF NOT EQUAL
            PACK      KEY29,PTMKCODE,SP70
            CALL      PATMCHRD                * read Misc.Charges file 
            BRANCH    EXIT,MSCSRH60           * if not valid
          ENDIF
.
MSCSRH70  MATCH     SP70,MHFUND
          GOTO      MSCSRH60 IF NOT EQUAL
.
.         ADD       ONE,RECNUMB
.         IF        STARTNUM>=RECNUMB
.           GOTO      MSCSRH60
.         ENDIF
.
.         Replace characters # " , with spaces
.
          REP       "## #' #" #, ",MDESC
.
          CALL      ADDMSC00
          BRANCH    EXIT,MSCSRH60          * not unique misc charge
.
          ADD       ONE,RECNUMB
          IF        STARTNUM>=RECNUMB
            GOTO      MSCSRH60
          ENDIF
.
          CALL      DMSCRW00               * Rows
          ADD       ONE,DISNUMB
          COMPARE   NORECORD,DISNUMB
          GOTO      MSCSRH60 IF NOT EQUAL
          GOTO      MSCSRH99
.
MSCSRH99  RETURN
+
.------------------------------------------------------------
. Display Default Misc. Change Search Headings
.------------------------------------------------------------
DMSCHD00  IF        CFEETYP<>5
            BRANCH    IBCNMHOS,DMSCHD20
          ENDIF
          MATCH     SP70,SRCHHOSP
          IF        !@EQUAL
            PACK      KEY3,SRCHHOSP,SP10
            CALL      RDPTHSP1              
            IF        OVRCD=1
              MOVE      SP10,PTHSHOSP
            ENDIF
          ENDIF
.
          WRITE     HTMLFILE;"<tr><td class=HeadingCell>Code</td>":
                             "<td class=HeadingCell>Description</td></tr>";
          GOTO      DMSCHD99
.
.         Multi Hospital - Unknown default claim code
.
DMSCHD20  MATCH     SP10,MULTHOSP
          GOTO      DMSCHD30 IF NOT EQUAL
          MOVE      SP10,PTHSDCLM
.
          WRITE     HTMLFILE;"<tr><td class=HeadingCell>":
                             "Default Claim Code</td>":
                             "<td class=HeadingCell>Code</td>":
                             "<td class=HeadingCell>":
                             "Description</td></tr>";
          GOTO      DMSCHD99
.
.         Multi Hospital - known default claim code
.
DMSCHD30  PACK      KEY3,MULTHOSP,SP10
          CALL      RDPTHSP1              
          IF        OVRCD=1
            MOVE      SP10,MULTHOSP
            GOTO      DMSCHD20
          ENDIF
.
          MATCH     SP10,PTHSDCLM
          GOTO      DMSCHD20 IF EQUAL
.
          WRITE     HTMLFILE;"<tr><td class=HeadingCell colspan=2 ":
                             "align=center>":
                             PTHSNAME," - Default Claim Code: ",PTHSDCLM:
                             "</td>":
                             "<tr><td class=HeadingCell>Code</td>":
                             "<td class=HeadingCell>":
                             "Description</td></tr>";
          GOTO      DMSCHD99
.
DMSCHD99  RETURN
+
.-------------------------------------------------------------------------------
. Adds a MCHARGE to our array (MSCARRAY) if it's not already in there
.-------------------------------------------------------------------------------
ADDMSC00  MOVE      ZERO,EXIT
          MOVE      ONE,F3                  * loop from 1st item in array
.
ADDMSC10  IF        F3<=COUNT
            MATCH     MCHARGE,MSCARRAY[F3]
            GOTO      ADDMSC91 IF EQUAL     * misc charge already exists
.
            ADD       ONE,F3                * increment array index
            GOTO      ADDMSC10
          ENDIF
.
          COMPARE   NINTY9,COUNT
          GOTO      ADDMSC99 IF NOT LESS    * already reached max array size
.
          ADD       ONE,COUNT
.
          MOVE      MCHARGE,MSCARRAY[COUNT]      * add misc charge to array
          GOTO      ADDMSC99                     * bail
.
ADDMSC91  MOVE      ONE,EXIT                     * duplicate
ADDMSC99  RETURN
+
.------------------------------------------------------------
. Display Default Misc. Change Search Rows        
.------------------------------------------------------------
DMSCRW00  WRITE     HTMLFILE;"<tr>";
.
          IF        IBCNMHOS=1        
            MATCH     SP10,PTHSDCLM
            IF        @EQUAL
              PACK      KEY5,ANSC,ANSL,MCLMCOD,SP10
              CALL      RDCODE1
              IF        OVRCD=1
                MOVE      MCLMCOD,TDESC
              ENDIF
              WRITE     HTMLFILE;"<td>",TDESC,"</td>";
            ENDIF
          ENDIF
.
          IF        CFEETYP<>5
            WRITE     HTMLFILE;"<td><img src=../images/MaintenanceIcon.gif ":
                               " class=ListIcon onclick='updateParent(#"":
                               MCHARGE,"#",#"",MDESC,"#");'> ":
                               MCHARGE,"</td><td>",MDESC,"</td>":
                               "</tr>"
          ELSE
            WRITE     HTMLFILE;"<td><img src=../images/MaintenanceIcon.gif ":
                               " class=ListIcon onclick='updateParent(#"":
                               MCHARGE,"#",#"",MDESC,"#");'> ":
                               MCHARGE,"</td><td>",NZMCDESC,"</td>":
                               "</tr>"
          ENDIF
.
DMSCRW99  RETURN
.------------------------------------------------------------
. Display Miscellaneous  Results                     * I SRF 33349
.------------------------------------------------------------
.
SPTNKA00  WRITE     HTMLFILE;"<tr align=center>":
                             "<td class=HeadingCell colspan=4><b>":
                             "You Searched for ":
                               KEYWORDS,"</td>":
                             "</tr>";
.
          CALL      DMSCHD00
.
          CALL      GETWRD00       * This routine Splits the KEYWORDS field
.                                  * into KEYWRD01 to KEYWRD10
.
          IF        LNK2PRT<>1
            UNPACK    DIM127,D1,LINKPRG,DIM127
            UNPACK    DIM127,D1,LINKREP,DIM127
            UNPACK    DIM127,D1,LINKTEM,DIM127
          ENDIF
.
          IF        NORECORD=0
            MOVE      "10",NORECORD       * Set Default No Records to Display
          ENDIF
          MOVE      ZERO,RECNUMB
          MOVE      ZERO,DISNUMB
.
          MOVE      ZERO,DEFCLMFL
          IF        IBCNMHOS=1
            MATCH     SP10,PTHSDCLM
            IF        !@EQUAL
              MOVE      ONE,DEFCLMFL
            ENDIF
.
            IF        CFEETYP=5
              MATCH     "1",OPCNPTMC
              IF        @EQUAL
                MOVE      ZERO,DEFCLMFL
              ENDIF
            ENDIF
.
          ENDIF
.
          STRIP     KEYWRD01
.
SPTNKA05  IF        DEFCLMFL=1
            PACK      KEY59,PTHSDCLM,KEYWRD01,SP70  * Multi Hospital Def Claim
            CALL      RSPTMKI3
          ELSE
            PACK      KEY56,KEYWRD01,SP70
            CALL      RSPTMKI2
          ENDIF
.
SPTNKA10  IF        DEFCLMFL=1
            CALL      RKPTMKI3                      * Multi Hospital Def Claim
            BRANCH    OVRCD,SPTNKA90
            MATCH     PTMKDCLM,PTHSDCLM
            GOTO      SPTNKA90 IF NOT EQUAL
          ELSE
            CALL      RKPTMKI2
            BRANCH    OVRCD,SPTNKA90
          ENDIF
.
          IF        CFEETYP=5
.
            PACK      KEY37,MULTHOSP,PTMKCODE,SP70
            CALL      RSNZMCH1
            CALL      RKNZMCH1
            BRANCH    OVRCD,SPTNKA13
            MOVE      NZMCEFDT,PTMCEFDT
            MOVE      NZMCMCHG,MCHARGE
.           MOVE      NZMCDESC,MDESC
.
            PACK      KEY26,NZMCCLMC,NZMCCNTR,NZMCFTAB,NZMCMCHG,SP70
            MATCH     PTMKCODE,KEY26
            GOTO      SPTNKA13 IF NOT EQUAL
            MATCH     SP70,NZMCCNTR
            GOTO      SPTNKA13 IF NOT EQUAL
            MATCH     SP70,NZMCFTAB
            GOTO      SPTNKA13 IF NOT EQUAL
            MATCH     "1",NZMCACFL                * Inactive?
            GOTO      SPTNKA13 IF EQUAL
.
            GOTO      SPTNKA17
.
SPTNKA13    PACK      KEY37,SP3,PTMKCODE,SP70
            CALL      RSNZMCH1
            CALL      RKNZMCH1
            BRANCH    OVRCD,SPTNKA10
            MOVE      NZMCEFDT,PTMCEFDT
            MOVE      NZMCMCHG,MCHARGE
            MOVE      NZMCDESC,MDESC
.
            PACK      KEY26,NZMCCLMC,NZMCCNTR,NZMCFTAB,NZMCMCHG,SP70
            MATCH     PTMKCODE,KEY26
            GOTO      SPTNKA10 IF NOT EQUAL
            MATCH     SP70,NZMCCNTR
            GOTO      SPTNKA10 IF NOT EQUAL
            MATCH     SP70,NZMCFTAB
            GOTO      SPTNKA10 IF NOT EQUAL
            MATCH     "1",NZMCACFL                * Inactive?
            GOTO      SPTNKA10 IF EQUAL           * Yes
          ELSE
            PACK      KEY29,PTMKCODE,SP70
            CALL      PATMCHRD                * read Misc.Charges file 
            BRANCH    EXIT,SPTNKA10           * if not valid
            MATCH     SP70,MHFUND
            GOTO      SPTNKA10 IF NOT EQUAL
            MATCH     SP70,PTMCHFTT
            GOTO      SPTNKA10 IF NOT EQUAL
          ENDIF
.
SPTNKA17  CALL      ADDMSC00
          BRANCH    EXIT,SPTNKA10
.
          CALL      SOPNKB00
          BRANCH    OVRCD,SPTNKA10,SPTNKA90
.
          ADD       ONE,RECNUMB
          IF        STARTNUM>=RECNUMB
            GOTO      SPTNKA10
          ENDIF
.
          IF        CFEETYP=5
            REP       "## #' #" #, ",NZMCDESC 
          ELSE
            REP       "## #' #" #, ",MDESC
          ENDIF
.
          BRANCH    LNK2PRT,SPTNKA20,SPTNKA30
.
          WRITE     HTMLFILE;"<tr valign=top>";
.
          IF        IBCNMHOS=1
            MATCH     SP10,PTHSDCLM
            IF        @EQUAL
              PACK      KEY5,ANSC,ANSL,MCLMCOD,SP10
              CALL      RDCODE1
              IF        OVRCD=1
                MOVE      MCLMCOD,TDESC
              ENDIF
              WRITE     HTMLFILE;"<td>",TDESC,"</td>";
            ENDIF
          ENDIF
.
          IF        CFEETYP<>5
            WRITE     HTMLFILE;"<td><a href=",LINKPRG,".pbl?":
                               "&reportno=",LINKREP:
                               "&template=",LINKTEM:
                               "&itemkeys=",KEY9,">":
                               MCHARGE,"</a></td>":
                               "<td>",MDESC,"</td></font>":
                               "</tr>"
          ELSE
            WRITE     HTMLFILE;"<td><a href=",LINKPRG,".pbl?":
                               "&reportno=",LINKREP:
                               "&template=",LINKTEM:
                               "&itemkeys=",KEY9,">":
                               MCHARGE,"</a></td>":
                               "<td>",NZMCDESC,"</td></font>":
                               "</tr>"
          ENDIF
.
          GOTO      SPTNKA80
.
SPTNKA20  
.          REP       "#', ",OPNRSNAM
.          REP       "#", ",OPNRGNAM
.          RESET     OPNRSNAM
.
          WRITE     HTMLFILE;"<tr valign=top>";
.
          IF        IBCNMHOS=1
            MATCH     SP10,PTHSDCLM
            IF        @EQUAL
              PACK      KEY5,ANSC,ANSL,MCLMCOD,SP10
              CALL      RDCODE1
              IF        OVRCD=1
                MOVE      MCLMCOD,TDESC
              ENDIF
              WRITE     HTMLFILE;"<td>",TDESC,"</td>";
            ENDIF
          ENDIF
.
          IF        CFEETYP<>5
            WRITE     HTMLFILE;"<td><a href=#"":
                               "javascript:updateParent('",MCHARGE:
                               "','",MDESC,"')#">":
                              "<img src=../images/MaintenanceIcon.gif hspace=4":
                               " border=0 align=absmiddle></a>":
                               MCHARGE,"</td>":
                               "<td>",MDESC,"</td>":
                               "</tr>"
          ELSE
            WRITE     HTMLFILE;"<td><a href=#"":
                               "javascript:updateParent('",MCHARGE:
                               "','",MDESC,"')#">":
                              "<img src=../images/MaintenanceIcon.gif hspace=4":
                               " border=0 align=absmiddle></a>":
                               MCHARGE,"</td>":
                               "<td>",NZMCDESC,"</td>":
                               "</tr>"
          ENDIF
.
          GOTO      SPTNKA80
.
SPTNKA30  WRITE     HTMLFILE;"<tr valign=top>";
.
          IF        IBCNMHOS=1
            MATCH     SP10,PTHSDCLM
            IF        @EQUAL
              PACK      KEY5,ANSC,ANSL,MCLMCOD,SP10
              CALL      RDCODE1
              IF        OVRCD=1
                MOVE      MCLMCOD,TDESC
              ENDIF
              WRITE     HTMLFILE;"<td>",TDESC,"</td>";
            ENDIF
          ENDIF
.
          IF        CFEETYP<>5
            WRITE     HTMLFILE;"<td><a href='":
                               "javascript:showMbs01(#"":
                                LINKPRG,".pbl?":
                                "&reportno=",LINKREP:
                                "&template=",LINKTEM:
                                "&mbsitemn=",KEY9:
                                "&mbseffdt=",PTITEFDT,"#");'>":
                              "<img src=../images/MaintenanceIcon.gif hspace=4":
                                " border=0 align=absmiddle></a>":
                                MCHARGE,"</td>":
                                "<td>",MDESC,"</td>":
                                "</tr>"
          ELSE
            WRITE     HTMLFILE;"<td><a href='":
                               "javascript:showMbs01(#"":
                                LINKPRG,".pbl?":
                                "&reportno=",LINKREP:
                                "&template=",LINKTEM:
                                "&mbsitemn=",KEY9:
                                "&mbseffdt=",PTITEFDT,"#");'>":
                              "<img src=../images/MaintenanceIcon.gif hspace=4":
                                " border=0 align=absmiddle></a>":
                                MCHARGE,"</td>":
                                "<td>",NZMCDESC,"</td>":
                                "</tr>"
          ENDIF
.
SPTNKA80  ADD       ONE,DISNUMB
          COMPARE   NORECORD,DISNUMB
          GOTO      SPTNKA10 IF NOT EQUAL
SPTNKA90
SPTNKA99  RETURN
.
.------------------------------------------------------------
. Check Miscellaneous Record
.------------------------------------------------------------
SOPNKB00  MATCH     KEYWRD01,PTMKKKWD
          GOTO      SOPNKB92 IF NOT EQUAL
          IF        KEYWRDNO>1
            PACK      SAVKEY56,PTMKKKWD,PTMKCODE
            CALL      SOPNKC00
            BRANCH    EXIT,SOPNKB91
            MOVE      SAVKEY56,KEY56
            CALL      RDPTMKI2
          ENDIF
.
SOPNKB90  MOVE      ZERO,OVRCD
          GOTO      SOPNKB99
SOPNKB91  MOVE      ONE,OVRCD
          GOTO      SOPNKB99
SOPNKB92  MOVE      TWO,OVRCD
SOPNKB99  RETURN
.
.------------------------------------------------------------
. Check for Matching Miscellaneous Codes
.------------------------------------------------------------
SOPNKC00  MOVE      ONE,F2
          MOVE      ZERO,EXIT
          PACK      SAVKEY34,PTMKCODE,SP70
.
SOPNKC10  COMPARE   KEYWRDNO,F2           * Loop through each Key Word in Search
          GOTO      SOPNKC99 IF EQUAL     * Exit OK
          ADD       ONE,F2
          LOAD      KEYWRDXX,F2,KEYWRD01,KEYWRD02,KEYWRD03,KEYWRD04,KEYWRD05:
                             KEYWRD06,KEYWRD07,KEYWRD08,KEYWRD09,KEYWRD10
          PACK      KEY56,PTMKCODE,KEYWRDXX
          CALL      RDPTMKI1              * Check for Exact Match
          COMPARE   ZERO,OVRCD            * Ok so Continue Loop
          GOTO      SOPNKC10 IF EQUAL
.
          CALL      RKPTMKI1              * Not Exact so Read Next Record
          BRANCH    OVRCD,SOPNKC90        * No Match So Exit No Match
          PACK      KEY34,PTMKCODE,SP70
          MATCH     SAVKEY34,KEY34          * Match Key Fields
          GOTO      SOPNKC90 IF NOT EQUAL * No Match So Exit
          STRIP     KEYWRDXX
          MATCH     PTMKKKWD,KEYWRDXX         * Check Key Word
          GOTO      SOPNKC90 IF NOT EQUAL * No Match So Exit
          GOTO      SOPNKC10              * Check Next Search Word
.
SOPNKC90  MOVE      ONE,EXIT
SOPNKC99  RETURN                          * end I SRF 33349
.---------------------------------------------------------------
.      Option - 11 Item Code Search
.---------------------------------------------------------------
OPRITM00  BRANCH    FLDITMNO,OPRITM10,OPRITM20,OPRITM30,OPRITM40:
                             OPRITM50,OPRITM60
.
          WRITE     HTMLFILE;"Invalid IBA Tag";
          GOTO      OPRITM99
.
OPRITM10  MOVE      ZERO,LINK2PRT           * Link to alternate Program
          CALL      ITMTAB00                * Table of item code
          GOTO      OPRITM99
.
OPRITM20  MOVE      ONE,LINK2PRT            * Link to Parent
          CALL      ITMTAB00                * Table of item code
          GOTO      OPRITM99
.
OPRITM30  MOVE      TWO,LINK2PRT            * Link to Window
          CALL      ITMTAB00                * Table of item code
          GOTO      OPRITM99
.
OPRITM40  CALL      PREVIT00                * Link to Prev Set of Codes
          GOTO      OPRITM99
.
OPRITM50  CALL      NEXTIT00                * Link to Next Set of Codes
          GOTO      OPRITM99
.
OPRITM60  WRITE     HTMLFILE;KEYWORDS;  
          GOTO      OPRITM99
.
OPRITM99  RETURN
.-------------------------------------------------------------
.        Table of Item Code
.-------------------------------------------------------------
ITMTAB00  IF        LINK2PRT<>1
            UNPACK    DIM127,D1,LINKPRG,DIM127
            UNPACK    DIM127,D1,LINKREP,DIM127
            UNPACK    DIM127,D1,LINKTEM,DIM127
          ENDIF
.
          IF        NORECORD=0
            MOVE      "10",NORECORD         * Set Default No Records to Display
          ENDIF
          MOVE      ZERO,RECNUMB
          MOVE      ZERO,DISNUMB
.
          MATCH     "4",OPRITM01
          GOTO      ITMTAB50 IF NOT EQUAL
          CALL      ITMALL00
          GOTO      ITMTAB99
.
ITMTAB50  CALL      ITMSPC00
          GOTO      ITMTAB99
.
ITMTAB99  RETURN
.------------------------------------------------------------------------
ITMALL00  PACK      KEY15,KEYWORDS,SP70
          CALL      RDOPITE1                * display code first if it exists
          BRANCH    OVRCD,ITMALL05
.
          MATCH     OPRITM01,OPITINDC
          GOTO      ITMALL05 IF NOT EQUAL
.
          MATCH     "4",OPITCRST
          GOTO      ITMALL05 IF EQUAL       * Expired
.
          ADD       ONE,RECNUMB
          IF        STARTNUM>=RECNUMB
            GOTO     ITMALL05
          ENDIF
.
          CALL      ITMROW00    * Display Table Details Row
          ADD       ONE,DISNUMB
          COMPARE   NORECORD,DISNUMB
          GOTO      ITMALL99 IF EQUAL
.
ITMALL05  PACK      KEY65,KEYWORDS,SP70
          CALL      RSOPITE2
ITMALL10  CALL      RKOPITE2
          BRANCH    OVRCD,ITMALL99
.
          MATCH     OPITCODE,KEY15
          GOTO      ITMALL10 IF EQUAL       * already displayed
.
          MATCH     "4",OPITCRST
          GOTO      ITMALL10 IF EQUAL       * Expired
.
          ADD       ONE,RECNUMB
          IF        STARTNUM>=RECNUMB
            GOTO     ITMALL10
          ENDIF
.
          CALL      ITMROW00    * Display Table Details Row
          ADD       ONE,DISNUMB
          COMPARE   NORECORD,DISNUMB
          GOTO      ITMALL10 IF NOT EQUAL
ITMALL99  RETURN
.------------------------------------------------------------------------
ITMSPC00  PACK      KEY15,KEYWORDS,SP70
          CALL      RDOPITE1                * display code first if it exists
          BRANCH    OVRCD,ITMSPC05
.
          MATCH     OPRITM01,OPITINDC
          GOTO      ITMSPC05 IF NOT EQUAL
.
          MATCH     "4",OPITCRST
          GOTO      ITMSPC05 IF EQUAL       * Expired
.
          ADD       ONE,RECNUMB
          IF        STARTNUM>=RECNUMB
            GOTO     ITMSPC05
          ENDIF
.
          CALL      ITMROW00    * Display Table Details Row
          ADD       ONE,DISNUMB
          COMPARE   NORECORD,DISNUMB
          GOTO      ITMSPC99 IF EQUAL
.
ITMSPC05  PACK      KEY66,OPRITM01,KEYWORDS,SP70
          CALL      RSOPITE4
ITMSPC10  CALL      RKOPITE4
          BRANCH    OVRCD,ITMSPC99
.
          MATCH     OPRITM01,OPITINDC
          GOTO      ITMSPC99 IF NOT EQUAL
.
          MATCH     OPITCODE,KEY15
          GOTO      ITMSPC10 IF EQUAL       * already displayed
.
          MATCH     "4",OPITCRST
          GOTO      ITMSPC10 IF EQUAL       * Expired
.
          ADD       ONE,RECNUMB
          IF        STARTNUM>=RECNUMB
            GOTO     ITMSPC10
          ENDIF
.
          CALL      ITMROW00    * Display Table Details Row
          ADD       ONE,DISNUMB
          COMPARE   NORECORD,DISNUMB
          GOTO      ITMSPC10 IF NOT EQUAL
ITMSPC99  RETURN
.------------------------------------------------------------
.  Item Code Row (TABLE ROW)
.------------------------------------------------------------
ITMROW00  STRIP     OPITDESC
          BRANCH    LINK2PRT,ITMROW10,ITMROW20
.
          WRITE     HTMLFILE;"<tr valign=top>":
                                "<td nowrap><a href=",LINKPRG,".pbl?":
                                "&reportno=",LINKREP:
                                "&template=",LINKTEM:
                                "&=opritm01",OPITCODE,">":
                                OPITCODE,"</a></td>":
                                "<td>",OPITDESC,"</td>":
                              "</tr>";
          GOTO      ITMROW99
.
ITMROW10  WRITE     HTMLFILE;"<tr><td nowrap>":
                               "<A HREF='javascript:updateParent":
                               "(#"",OPITCODE,"#",#"":
                               OPITDESC,"#")'>":
                               OPITCODE,"</a></td>":
                               "<td>",OPITDESC,"</td>":
                             "</tr>";
          GOTO      ITMROW99
.
ITMROW20  WRITE     HTMLFILE;"<tr valign=top>":
                               "<td nowrap><a href=#"":
                               "javascript:ShowDetail('":
                               LINKPRG,".pbl?":
                               "&reportno=",LINKREP:
                               "&template=",LINKTEM:
                               "&=opritm01",OPITCODE:
                               "');#">":
                               OPITCODE,"</a></td>":
                               "<td>",OPITDESC,"</td>":
                             "</tr>";
          GOTO      ITMROW99
.
ITMROW99  RETURN
.-----------------------------------------------------------
. Link to Next Group option 11
.-----------------------------------------------------------
NEXTIT00  MOVE      NORECORD,KEY2
          REP       " +",KEY2
          ASSIGN    STARTNUM+NORECORD,F3
          MOVE      F3,KEY3
          REP       " +",KEY3
          UNPACK    DIM127,D1,D3,DIM127
          MOVE      REPORTNO,F2
.
          REPLACE    " +",KEYWORDS
          REPLACE    " +",OPRITM01
.
          WRITE     HTMLFILE;"patweb94.pbl":
                                 "?reportno=",F2:
                                 "&template=",D3:
                                 "&startnum=",KEY3:
                                 "&norecord=",KEY2:
                                 "&opritm01=",OPRITM01:
                                 "&keywords=",KEYWORDS;
.
          REPLACE    "+ ",OPRITM01
          REP       "+ ",KEYWORDS
.
NEXTIT99  RETURN
.-------------------------------------------------------------
. Link to Prev Group option 11
.-------------------------------------------------------------
PREVIT00  MOVE      NORECORD,KEY2
          REP       " +",KEY2
          ASSIGN    STARTNUM-NORECORD,F3
          IF        F3<0
            MOVE      ZERO,F3
          ENDIF
          MOVE      F3,KEY3
          REP       " +",KEY3
          UNPACK    DIM127,D1,FLDPARA,DIM127
          MOVE      REPORTNO,F2
.
          REP       " +",OPRITM01
          REP       " +",KEYWORDS
.
          WRITE     HTMLFILE;"patweb94.pbl":
                                "?reportno=",F2:
                                "&template=",FLDPARA:
                                "&startnum=",KEY3:
                                "&norecord=",KEY2:
                                "&opritm01=",OPRITM01:
                                 "&keywords=",KEYWORDS;
.
          REPLACE    "+ ",OPRITM01
          REP       "+ ",KEYWORDS
.
PREVIT99  RETURN
.------------------------------------------------------------
. NOMORE00 - Display "No more records" at end of list
.------------------------------------------------------------
NOMORE00  WRITE     HTMLFILE;"<tr>":
                             "<td class=RedCell colspan=20 align=center>":
                             "No more records</td>"
.
NOMORE99  RETURN
.
.-------------------------------------------------------------
. Casemix Code Search Results
.-------------------------------------------------------------
CMCS0000  BRANCH    FLDITMNO,CMCS0100,CMCS0200,CMCS0300,CMCS0400,CMCS0500
.
CMCS0100  MOVE      CASESTAT,ITEMSTAT
          CALL      NXGR0000
          GOTO      CMCS9999
.
CMCS0200  MOVE      CASESTAT,ITEMSTAT
          CALL      LTGR0000
          GOTO      CMCS9999
.
CMCS0300  MOVE      ZERO,LINK2PRT
          CALL      SPTCMA00
          GOTO      CMCS9999
.
CMCS0400  MOVE      ONE,LINK2PRT
          CALL      SPTCMA00
          GOTO      CMCS9999
.
CMCS0500  MOVE      TWO,LINK2PRT
          CALL      SPTCMA00
          GOTO      CMCS9999
.
CMCS9999  RETURN
.------------------------------------------------------------
. Display Casemix Code Results
.------------------------------------------------------------
.
SPTCMA00  WRITE     HTMLFILE;"<tr align=center>":
                             "<td class=HeadingCell colspan=4><b>":
                             "You Searched for ":
                               KEYWORDS,"</td>":
                             "</tr>":
                             "<tr>":
                             "<td class=HeadingCell><b>Casemix Code</b></td>":
                             "<td class=HeadingCell><b>Description</b></td>":
                             "</td></tr>"
.
          CALL      GETWRD00       * This routine Splits the KEYWORDS field
.                                  * into KEYWRD01 to KEYWRD10
.
          IF        LINK2PRT<>1
            UNPACK    DIM127,D1,LINKPRG,DIM127
            UNPACK    DIM127,D1,LINKREP,DIM127
            UNPACK    DIM127,D1,LINKTEM,DIM127
          ENDIF
.
          IF        NORECORD=0
            MOVE      "10",NORECORD       * Set Default No Records to Display
          ENDIF
          MOVE      ZERO,RECNUMB
          MOVE      ZERO,DISNUMB
.
          STRIP     KEYWRD01
          PACK      KEY24,KEYWRD01,SP70
          CALL      RSPTKCM2
SPTCMA10  CALL      RKPTKCM2
          BRANCH    OVRCD,SPTCMA90
.
          MOVE      PTCMITM,KEY9
          CALL      RDPTCMC1
          BRANCH    OVRCD,SPTCMA10
.
          CALL      SPTCMB00
          BRANCH    OVRCD,SPTCMA10,SPTCMA90
.
          ADD       ONE,RECNUMB
          IF        STARTNUM>=RECNUMB
            GOTO      SPTCMA10
          ENDIF
.
.         MOVE      SP70,SETFONT
.         MOVE      SP70,ENDFONT
.         MOVE      "<font color=#FF0000>",SETFONT
.         MOVE      "</font>",ENDFONT
.
          PACK      DIM60,PTCADES1,PTCADES2,SP70
          MATCH     SP70,DIM60
          IF        @EQUAL
            MOVE      "&nbsp;",DIM60
          ENDIF
.
          BRANCH    LINK2PRT,SPTCMA20,SPTCMA30                   
.
          WRITE     HTMLFILE;"<tr valign=top>":
                              "<td><a href=",LINKPRG,".pbl?":
                               "&reportno=",LINKREP:
                               "&template=",LINKTEM:
                               "&itemkeys=",KEY9,">":
                               PTCACODE,"</a></td>":
                               "<td>",DIM60,"</td>":
.                              "<td>",SETFONT,DIM60,ENDFONT,"</td></font>":
                             "</tr>"
.
          GOTO      SPTCMA80
.
SPTCMA20  REP       "#', ",DIM60 
          REP       "#", ",DIM60 
          RESET     DIM60
.
          MOVE      SP70,KEY4
          MOVE      PTCAELOS,KEY4
          SQUEEZE   KEY4
.
          WRITE     HTMLFILE;"<tr valign=top>":
                              "<td><a href=#"":
                              "javascript:updateParent('",DIM60:  
                              "','",PTCACODE,"','",*+,KEY4,"')#">":
                              "<img src=../images/MaintenanceIcon.gif hspace=4":
                              " border=0 align=absmiddle></a>": 
                              PTCACODE,"</td>":
                              "<td>",DIM60,"</td>":
.                             "<td>",SETFONT,DIM60,ENDFONT,"</td>":
                             "</tr>"
.
          GOTO      SPTCMA80
.
SPTCMA30  WRITE     HTMLFILE;"<tr valign=top>":
                             "<td><a href='":
                             "javascript:showMbs01(#"":
                              LINKPRG,".pbl?":
                              "&reportno=",LINKREP:
                              "&template=",LINKTEM:
                              "&casecode=",KEY9,"#");'>":
                              "<img src=../images/MaintenanceIcon.gif hspace=4":
                              " border=0 align=absmiddle></a>": 
                              PTCACODE,"</td>":
                              "<td>",DIM60,"</td>":
.                             "<td>",SETFONT,DIM60,ENDFONT,"</td>":
                             "</tr>"
.
SPTCMA80  ADD       ONE,DISNUMB
          COMPARE   NORECORD,DISNUMB
          GOTO      SPTCMA10 IF NOT EQUAL
SPTCMA90  
SPTCMA99  RETURN
.------------------------------------------------------------
. Check Casemix Record
.------------------------------------------------------------
SPTCMB00  MATCH     KEYWRD01,PTCMKWD
          GOTO      SPTCMB92 IF NOT EQUAL
          IF        KEYWRDNO>1
            PACK      SAVKEY24,PTCMKWD,PTCMITM
            CALL      SPTCMC00
            BRANCH    EXIT,SPTCMB91
            MOVE      SAVKEY24,KEY24
            CALL      RDPTKCM1
          ENDIF
.
.CASESTAT -  Set to 0 - Show All Active MBS Items Only
.                   1 - Show All MBS Item
.
SPTCMB10  BRANCH    CASESTAT,SPTCMB90
          COMPARE   ONE,PTCAACTV
          GOTO      SPTCMB91 IF NOT EQUAL
.
SPTCMB90  MOVE      ZERO,OVRCD
          GOTO      SPTCMB99
SPTCMB91  MOVE      ONE,OVRCD
          GOTO      SPTCMB99
SPTCMB92  MOVE      TWO,OVRCD
SPTCMB99  RETURN
.
.------------------------------------------------------------
. Check for Matching MBS Words
.------------------------------------------------------------
SPTCMC00  MOVE      ONE,F2
          MOVE      ZERO,EXIT
          PACK      SAVKEY9,PTCMITM,SP70
.
SPTCMC10  COMPARE   KEYWRDNO,F2           * Loop through each Key Word in Search
          GOTO      SPTCMC99 IF EQUAL     * Exit OK
          ADD       ONE,F2
          LOAD      KEYWRDXX,F2,KEYWRD01,KEYWRD02,KEYWRD03,KEYWRD04,KEYWRD05:
                             KEYWRD06,KEYWRD07,KEYWRD08,KEYWRD09,KEYWRD10
          PACK      KEY24,PTCMITM,KEYWRDXX
          CALL      RDPTKCM1              * Check for Exact Match
          COMPARE   ZERO,OVRCD            * Ok so Continue Loop
          GOTO      SPTCMC10 IF EQUAL
.
          CALL      RKPTKCM1              * Not Exact so Read Next Record
          BRANCH    OVRCD,SPTCMC90        * No Match So Exit No Match
          PACK      KEY9,PTCMITM,SP70
          MATCH     SAVKEY9,KEY9          * Match Key Fields
          GOTO      SPTCMC90 IF NOT EQUAL * No Match So Exit
          STRIP     KEYWRDXX
          MATCH     PTCMKWD,KEYWRDXX         * Check Key Word
          GOTO      SPTCMC90 IF NOT EQUAL * No Match So Exit
          GOTO      SPTCMC10              * Check Next Search Word
.
SPTCMC90  MOVE      ONE,EXIT
SPTCMC99  RETURN
.-------------------------------------------------------------
. LGA search
.-------------------------------------------------------------
LGAS0000  BRANCH    FLDITMNO,LGAS0100,LGAS0200,LGAS0300
          GOTO      LGAS9999
.
LGAS0100  CALL      NXGR0000
          GOTO      LGAS9999
.
LGAS0200  CALL      LTGR0000
          GOTO      LGAS9999
.
LGAS0300  CALL      SPTLGA00
          GOTO      LGAS9999
.
LGAS9999  RETURN
.
.------------------------------------------------------------
. Display LGA Code Results
.------------------------------------------------------------
.
SPTLGA00  WRITE     HTMLFILE;"<tr align=center>":
                             "<td class=HeadingCell colspan=4><b>":
                             "You Searched for ":
                               KEYWORDS,"</td>":
                             "</tr>":
                             "<tr>":
                             "<td class=HeadingCell><b>LGA Code</b></td>":
                             "<td class=HeadingCell><b>Description</b></td>":
                             "</td></tr>"
.
          CALL      GETWRD00       * This routine Splits the KEYWORDS field
.                                  * into KEYWRD01 to KEYWRD10
          IF        NORECORD=0
            MOVE      "10",NORECORD       * Set Default No Records to Display
          ENDIF
          MOVE      ZERO,RECNUMB
          MOVE      ZERO,DISNUMB
.
          STRIP     KEYWRD01
          PACK      KEY19,KEYWRD01,SP70
          CALL      RSPTKLG2
SPTLGA10  CALL      RKPTKLG2
          BRANCH    OVRCD,SPTLGA99
.
          MOVE      PTLGCODE,KEY4
          CALL      RDLGAA1
          BRANCH    OVRCD,SPTLGA10
.
          CALL      CHKLGA00
          BRANCH    OVRCD,SPTLGA10,SPTLGA99
.
          ADD       ONE,RECNUMB
          IF        STARTNUM>=RECNUMB
            GOTO      SPTLGA10
          ENDIF
.
          WRITE     HTMLFILE;"<tr valign=top>":
                              "<td><a href=#"":
                              "javascript:updateParent('",LGADESC:
                              "','",LGACODE,"')#">":
                              "<img src=../images/MaintenanceIcon.gif hspace=4":
                              " border=0 align=absmiddle></a>":
                              LGACODE,"</td>":
                              "<td>&nbsp;",LGADESC,"</td>":
.                             "<td>&nbsp;",SETFONT,LGADESC,ENDFONT,"</td>":
                             "</tr>"
.
SPTLGA80  ADD       ONE,DISNUMB
          COMPARE   NORECORD,DISNUMB
          GOTO      SPTLGA10 IF NOT EQUAL
SPTLGA99  RETURN
.
.------------------------------------------------------------
. Check LGA Record
.------------------------------------------------------------
CHKLGA00  MATCH     KEYWRD01,PTLGKWRD
          GOTO      CHKLGA92 IF NOT EQUAL
          IF        KEYWRDNO>1
            PACK      SAVKEY19,PTLGKWRD,PTLGCODE
            CALL      MTCHLG00
            BRANCH    EXIT,CHKLGA91
            MOVE      SAVKEY19,KEY19
            CALL      RDPTKLG1
          ENDIF
.
CHKLGA90  MOVE      ZERO,OVRCD
          GOTO      CHKLGA99
CHKLGA91  MOVE      ONE,OVRCD
          GOTO      CHKLGA99
CHKLGA92  MOVE      TWO,OVRCD
CHKLGA99  RETURN
.
.------------------------------------------------------------
. Checking for matching LGA code
.------------------------------------------------------------
MTCHLG00  MOVE      ONE,F2
          MOVE      ZERO,EXIT
          PACK      SAVKEY4,PTLGCODE,SP70
.
MTCHLG10  COMPARE   KEYWRDNO,F2           * Loop through each Key Word in Search
          GOTO      SPTCMC99 IF EQUAL     * Exit OK
          ADD       ONE,F2
          LOAD      KEYWRDXX,F2,KEYWRD01,KEYWRD02,KEYWRD03,KEYWRD04,KEYWRD05:
                             KEYWRD06,KEYWRD07,KEYWRD08,KEYWRD09,KEYWRD10
          PACK      KEY19,PTLGCODE,KEYWRDXX
          CALL      RDPTKLG1              * Check for Exact Match
          COMPARE   ZERO,OVRCD            * Ok so Continue Loop
          GOTO      MTCHLG10 IF EQUAL
.
          CALL      RKPTKLG1              * Not Exact so Read Next Record
          BRANCH    OVRCD,MTCHLG90        * No Match So Exit No Match
          PACK      KEY4,PTLGCODE,SP70
          MATCH     SAVKEY4,KEY4          * Match Key Fields
          GOTO      MTCHLG90 IF NOT EQUAL * No Match So Exit
          STRIP     KEYWRDXX
          MATCH     PTLGKWRD,KEYWRDXX     * Check Key Word
          GOTO      MTCHLG90 IF NOT EQUAL * No Match So Exit
          GOTO      MTCHLG10              * Check Next Search Word
.
MTCHLG90  MOVE      ONE,EXIT
MTCHLG99  RETURN
+
.-------------------------------------------------------------------
. Checking if miscellaneous charge should be available in the search
.-------------------------------------------------------------------
NZPMSC00  UNPACK    PTMKCODE,DIM3,DIM6,DIM8,KEY9
          MATCH     SP70,SRCHHOSP
          IF        @EQUAL
            PACK      KEY37,KEY9,SP70
            CALL      RSNZMCH3
            CALL      RKNZMCH3
            BRANCH    OVRCD,NZPMSC90
            MATCH     KEY9,NZMCMCHG
            GOTO      NZPMSC90 IF NOT EQUAL
            MATCH     "1",NZMCACFL                * Inactive?
            GOTO      NZPMSC90 IF EQUAL           * Yes
            GOTO      NZPMSC80
          ENDIF
.
          CALL      IBACLOCK
          PACK      KEY8,CCC,CYY,CMM,CDD
          REP       " 0",KEY8
          UNPACK    PTMKCODE,DIM3,DIM6,DIM8,KEY9
NZPMSC05  PACK      KEY29,SRCHHOSP,SRCHCLAM,SRCHCNTR,SRCHTABL,KEY9,SP70
          PACK      KEY37,SRCHHOSP,SRCHCLAM,SRCHCNTR,SRCHTABL,KEY9,KEY8,SP70
          CALL      RDNZMCH1
          IF        OVRCD=0
            MATCH     "1",NZMCACFL                * Inactive?
            GOTO      NZPMSC80 IF NOT EQUAL       * No
          ENDIF
.
NZPMSC10  CALL      RPNZMCH1
          BRANCH    OVRCD,NZPMSC20
.
          PACK      KEY29A,NZMCHOSP,NZMCCLMC,NZMCCNTR,NZMCFTAB,NZMCMCHG,SP70
          MATCH     KEY29,KEY29A
          GOTO      NZPMSC20 IF NOT EQUAL
          MATCH     "1",NZMCACFL                * Inactive?
          GOTO      NZPMSC10 IF EQUAL           * Yes
          MATCH     SP70,NZMCEEDT
          IF        !@EQUAL
            MATCH     KEY8,NZMCEEDT
            GOTO      NZPMSC20 IF LESS
          ENDIF
          GOTO      NZPMSC80
.
.         No record with health fund details - try a blank health fund
.
NZPMSC20  PACK      KEY29,SRCHHOSP,SRCHCLAM,SP10,SP2,SP2,KEY9
          PACK      KEY37,SRCHHOSP,SRCHCLAM,SP10,SP2,SP2,KEY9,KEY8
          CALL      RDNZMCH1
          IF        OVRCD=0
            MATCH     "1",NZMCACFL                * Inactive?
            GOTO      NZPMSC80 IF NOT EQUAL       * No
          ENDIF
.
NZPMSC22  CALL      RPNZMCH1
          BRANCH    OVRCD,NZPMSC30
.
          PACK      KEY29A,NZMCHOSP,NZMCCLMC,NZMCCNTR,NZMCFTAB,NZMCMCHG,SP70
          MATCH     KEY29,KEY29A
          GOTO      NZPMSC30 IF NOT EQUAL
          MATCH     "1",NZMCACFL                * Inactive?
          GOTO      NZPMSC22 IF EQUAL           * Yes
          MATCH     SP70,NZMCEEDT
          IF        !@EQUAL
            MATCH     KEY8,NZMCEEDT
            GOTO      NZPMSC30 IF LESS
          ENDIF
          GOTO      NZPMSC80
.
.         No record with health fund details - try default claim, blank hf
.
NZPMSC30  IF        IBCNMHOS=1
            PACK      KEY29,SRCHHOSP,PTHSDCLM,SP10,SP2,SP2,KEY9,SP70
            PACK      KEY37,SRCHHOSP,PTHSDCLM,SP10,SP2,SP2,KEY9,KEY8,SP70
          ELSE
            PACK      KEY29,SRCHHOSP,PTCNDCLM,SP10,SP2,SP2,KEY9,SP70
            PACK      KEY37,SRCHHOSP,PTCNDCLM,SP10,SP2,SP2,KEY9,KEY8,SP70
          ENDIF
.
          CALL      RDNZMCH1
          IF        OVRCD=0
            MATCH     "1",NZMCACFL                * Inactive?
            GOTO      NZPMSC80 IF NOT EQUAL       * No
          ENDIF
.
NZPMSC32  CALL      RPNZMCH1
          BRANCH    OVRCD,NZPMSC90
.
          PACK      KEY29A,NZMCHOSP,NZMCCLMC,NZMCCNTR,NZMCFTAB,NZMCMCHG,SP70
          MATCH     KEY29,KEY29A
          GOTO      NZPMSC40 IF NOT EQUAL
          MATCH     "1",NZMCACFL                * Inactive?
          GOTO      NZPMSC32 IF EQUAL           * Yes
          MATCH     SP70,NZMCEEDT
          IF        !@EQUAL
            MATCH     KEY8,NZMCEEDT
            GOTO      NZPMSC40 IF LESS
          ENDIF
          GOTO      NZPMSC80
.
.         No record for the hosp.- try with blank hosp,claim,hf
.
NZPMSC40  PACK      KEY29,SP3,SRCHCLAM,SRCHCNTR,SRCHTABL,KEY9,SP70
          PACK      KEY37,SP3,SRCHCLAM,SRCHCNTR,SRCHTABL,KEY9,KEY8,SP70
          CALL      RDNZMCH1
          IF        OVRCD=0
            MATCH     "1",NZMCACFL                * Inactive?
            GOTO      NZPMSC80 IF NOT EQUAL       * No
          ENDIF
.
NZPMSC42  CALL      RPNZMCH1
          BRANCH    OVRCD,NZPMSC50
.
          PACK      KEY29A,NZMCHOSP,NZMCCLMC,NZMCCNTR,NZMCFTAB,NZMCMCHG,SP70
          MATCH     KEY29,KEY29A
          GOTO      NZPMSC50 IF NOT EQUAL
          MATCH     "1",NZMCACFL                * Inactive?
          GOTO      NZPMSC42 IF EQUAL           * Yes
          MATCH     SP70,NZMCEEDT
          IF        !@EQUAL
            MATCH     KEY8,NZMCEEDT
            GOTO      NZPMSC50 IF LESS
          ENDIF
          GOTO      NZPMSC80
.
.
.         No record for the hosp.- try with blank hosp,claim,blank hf
.
NZPMSC50  PACK      KEY29,SP3,SRCHCLAM,SP10,SP2,SP2,KEY9,SP70
          PACK      KEY37,SP3,SRCHCLAM,SP10,SP2,SP2,KEY9,KEY8,SP70
          CALL      RDNZMCH1
          IF        OVRCD=0
            MATCH     "1",NZMCACFL                * Inactive?
            GOTO      NZPMSC80 IF NOT EQUAL       * No
          ENDIF
.
NZPMSC52  CALL      RPNZMCH1
          BRANCH    OVRCD,NZPMSC70
.
          PACK      KEY29A,NZMCHOSP,NZMCCLMC,NZMCCNTR,NZMCFTAB,NZMCMCHG,SP70
          MATCH     KEY29,KEY29A
          GOTO      NZPMSC70 IF NOT EQUAL
          MATCH     "1",NZMCACFL                * Inactive?
          GOTO      NZPMSC52 IF EQUAL           * Yes
          MATCH     SP70,NZMCEEDT
          IF        !@EQUAL
            MATCH     KEY8,NZMCEEDT
            GOTO      NZPMSC70 IF LESS
          ENDIF
          GOTO      NZPMSC80
.
.         No record for the hosp.- try with blank hosp,default claim,blank hf
.
NZPMSC70  IF        IBCNMHOS=1
            PACK      KEY29,SP3,PTHSDCLM,SP10,SP2,SP2,KEY9,SP70
            PACK      KEY37,SP3,PTHSDCLM,SP10,SP2,SP2,KEY9,KEY8,SP70
          ELSE
            PACK      KEY29,SP3,PTCNDCLM,SP10,SP2,SP2,KEY9,SP70
            PACK      KEY37,SP3,PTCNDCLM,SP10,SP2,SP2,KEY9,KEY8,SP70
          ENDIF
          CALL      RDNZMCH1
          IF        OVRCD=0
            MATCH     "1",NZMCACFL                * Inactive?
            GOTO      NZPMSC80 IF NOT EQUAL       * No
          ENDIF
.
NZPMSC72  CALL      RPNZMCH1
          BRANCH    OVRCD,NZPMSC90
.
          PACK      KEY29A,NZMCHOSP,NZMCCLMC,NZMCCNTR,NZMCFTAB,NZMCMCHG,SP70
          MATCH     KEY29,KEY29A
          GOTO      NZPMSC90 IF NOT EQUAL
          MATCH     "1",NZMCACFL                * Inactive?
          GOTO      NZPMSC72 IF EQUAL           * Yes
.
          MATCH     SP70,NZMCEEDT
          IF        !@EQUAL
            MATCH     KEY8,NZMCEEDT
            GOTO      NZPMSC90 IF LESS
          ENDIF
.
NZPMSC80  MOVE      NZMCDESC,MDESC
          MOVE      MDESC,IDESC
          MOVE      NZMCKPRI,PTMCKREB
.
          MOVE      NZMCCLMC,MCLMCOD
          MOVE      NZMCCNTR,MHFUND
          MOVE      NZMCMCHG,MCHARGE
          MOVE      NZMCEFDT,PTMCEFDT
          MOVE      NZMCPATP,MPATPOR
          MOVE      NZMCREBP,MHFPOR
          MOVE      NZMCINDC,MINDIC
.
NZPMSC82  MOVE      MPATPOR,QIAMT
          ADD       MHFPOR,QIAMT
          MOVE      ZERO,EXIT
          GOTO      NZPMSC99
.
NZPMSC90  MOVE      ONE,EXIT
NZPMSC99  RETURN
+
.------------------------------------------------------------
          INC       IBAGSTIO/INC   * GST master file
          INC       NZPMCHIO/INC
          INC       PATKDRIO/INC
          INC       PATDGWIO/INC
          INC       PATHSPIO/INC
          INC       PATIKIIO/INC
          INC       PATIK1IO/INC
          INC       PATKCMIO/INC
          INC       PATDO1IO/INC
          INC       PATITMIO/INC        
          INC       PATLGAIO/INC        
          INC       PATKLGIO/INC        
          INC       PATOICIO/INC
          INC       PATKCDIO/INC
          INC       PATKCOIO/INC
          INC       PATDICIO/INC
          INC       PATICOIO/INC
          INC       PATICDIO/INC
          INC       PATMCHIO/INC            * HPS CODE
          INC       PATMKIIO/INC
          INC       PATCMCIO/INC                         
          INC       OPRITEIO/INC
          INC       PATITMRD
          INC       PATDOCTM
          INC       PATDOCCD
          INC       PATMCHRD                * Miscellaneous Charges read routine
          INC       NAMSTRCD
          INC       IBAWEBCD    



