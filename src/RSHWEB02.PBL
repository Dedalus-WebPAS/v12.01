.---------------------------------------------------------------------- 
. Program       : RSHWEB02 
.
. Function      : Reporting Enquiries
.
. Modifications : 
.---------------------------------------------------------------------- 
. V11.05.02 09/12/2024  PJ Le Febour  TSK 0836234
.           added variable CONFLD16 CWEBPAED display Paediatric icon
.           18/12/2024  J.Tan         TSK 0945920
.           Added tag for Cat FA and w0
. V11.05.01 27/11/2024  Ebon Clements TSK 0954576
.           Recompiled for PATCODTM
. V11.04.15 12/09/2024  Alina Bhari   TSK 0951557 
.           Added description Failed PID for status 6 - STATUS60
. V11.04.14 20/08/2024  PJ Le Febour  TSK 0950635a
.           new cgi variable SHOWQUED to determine
.           when to show only queued reports
. V11.04.13 20/08/2024  PJ Le Febour  TSK 0950635
.           ALLREP00 ONLY show Queued(Awaiting Processing)
.                              webschaf.wbscstat = 1
. V11.04.12 19/08/2024  Jacob Jackson TSK 0911895
.           Ensure only active booking types are shown
. V11.04.11 05/08/2024  PJ Le Febour  TSK 0948308
.           Add DISCANCL ind to display Cancel button              
.           Add EXTN1000 new DISCANCL tag
. V11.04.10 05/08/2024  Jacob Jackson TSK 0911895
.           Add BSMS0000 and SUCOLS00 
. V11.04.09 17/05/2024  Sunny         TSK 0946649
.           Fixed WEBSCH70, and changed user id to user name
. V11.04.08 07/05/2024  Ebon Clements TSK 0937359
.           Increased SUBSYARR to DIM 28
. V11.04.07 30/04/2024  PJ Le Febour  0945350b 
.           WBSEUID(websecaf) is NOT VALID display message using WBSENAM
. V11.04.06 26/04/2024  PJ Le Febour  0945350a 
.           When WBSEUID(websecaf) is NOT VALID display message
.           Invalid Web User ID amended WBSENAM to WBSCUSER         
. V11.04.05 26/04/2024  PJ Le Febour  0945350 
.           When WBSEUID(websecaf) is NOT VALID display message
.           Invalid Web User ID          
. V11.04.04 08/03/2024  J.Tan     TSK 0919335
.           Mod checking for HF History file
. V11.04.03 30/01/2024  Sunny          TSK 0911988
.           Added security level functionality in REPHED00,
.           WSCH3300,LREP2200,NSPROW00
. V11.04.02 29/01/2024  Jacob Jackson  TSK 0919335
.           Add new local variable and recompile for GETTFEES
. V11.04.01 11/01/2024 Ebon Clements     TSK 0941629
.           Recompiled for WEBPRTCD - Inactive printers
. V11.03.07 31/08/2023 Jacob Jackson     TSK 0925706
.           Add new parameter EXPORTDE for extended desc option
. V11.03.06 06/07/2023 J.Tan             TSK 0932182
.           Mod to delete the 'L' schedule txt file
. V11.03.05 23/06/2023 Ebon Clements     TSK 0934167
.           Increased SUBSYARR to DIM 26
. V11.03.04 15/03/2023 PJ Le Febour      TSK 0923333
.           Default DOB no longer mandatory defaults to 19200101 if blank
. V11.03.02 24/02/2023 PJ Le Febour      TSK 0923333
.           Added parameter CONFLD15 for Default DOB
. V11.03.01 03/02/2023 Ebon Clements     TSK 0928557
.           Fixed issue with removal of control M line feed from spool file
.           output. Used a temp var to remove the control M as it was
.           cutting off the last character. REPT0000 - DISPLINX
. V11.03.01 23/12/2022 J.Tan             TSK 0920195
.           Mod to set KEY40 for Payment type code indicators (PTYP2000)
. V11.02.09 08/11/2022 J.Tan             TSK 0922608
.           Added selection register (SELREG00) checking for Hospital id
. V11.02.08 01.09.2022 DA Sarkies        TSK 0923013
.           Added trap around ALLVREA1 and added checks where reference to
.           DB occurs.
. V11.02.07 26/07/2022 Ebon Clements     TSK 0921427
.           Set OVRCD to zero prior to trap - WSCH2700
. V11.02.06 14/07/2022 Ebon Clements     TSK 0919769
.           Added unprocessed VINAH E052/E061 tag - EXTN0500
. V11.02.05 13/05/2022  Alina Bhari    Task 0899310
.           Display Active Clinic ID's - EXTN0400,SELCLA00                  
. V11.02.05 13/05/2022  Alina Bhari    Task 0899310
.           Display Active Clinic ID's - EXTN0400,SELCLA00                  
. V11.02.04 05/04/2022  Ebon Clements  Task 0899288
.           Populate scheduler users current OP site and hospital - SAVPRO00
. V11.02.03 05/04/2022  Ebon Clements  Task 0911828
.           Added WBSCCDAT and WBSCCTIM to file clear - CLRSCS00
. V11.02.02 01.04.2022  DA Sarkies     TSK 0906511
.           Added parameter CONFLD14 to determine which gender code to display
. V11.02.01 07/02/2022  Thanh T        TSK 0896905
.           Recompiled for ALLDEPFD changes
. V11.01.03 26/04/2021  Ebon Clements  Task 0899288
.           Added WBSCHOSP and WBSCSITE to file clear - CLRSCS00
. V11.01.02 16/04/2021  Ebon Clements  TSK 0904815
.           Cross Browser quotes PROLKP00
. V11.01.01 16/02/2021  Ebon Clements  TSK 0892103
.           Added multipl2, multipl3, multipl4 and multipl5 selection
.           list processing
. V11.00.06 12/01/2021  Ebon Clements  TSK 0900781
.           Increased KEYSTARR from 95 to 150 keystrokes
. V11.00.05 10/09/2020  Tracey Nguyen  TSK 0888555
.           Added multipl1 for multi selection list processing
. V11.00.04 17/06/2020  Ebon Clements  TSK 0893198
.           Only write ACC print audit if ACC number populated - MVACCPRN
. V11.00.03 20/03/2020  Peter Vela     TSK 0889143
.           Fixed OUTLET IO calls
.           Fixed WATLET IO calls
. V11.00.02 18/03/2020  Peter Vela     TSK 0889143
.           Recompiled for OUTLETFD
.           Recompiled for WATLETFD
. V11.00.01 04/03/2020  J.Tan          TSK 0838262
.           Added Effective from and to date to MBS Item file
. V10.15.03 03/02/2020  Sunny          TSK 0885656
.           1) Added HFCODDSP as menu parameter to display 
.              Health Fund Contract Code
.           2) Changed 'SELHFN00' to cater for sites who want contract code 
.              and health fund description in drop down list
. V10.15.02 04/12/2019  Ebon Clements  TSK 0857392
.           Added OP site selection list tag with a default - DSLSIT00
. V10.15.01 28/11/2019  Ebon Clements  TSK 0861253
.           Changed spool file display to display 1200 characters wide
.           and user STRIP and WRITE *+ instead of SFORMAT - REPT0000
. V10.14.04 22/08/2019  Don Nguyen     TSK 0875542
.           Added 'SMS' Output Type (WBSCOTYP=3)
. V10.14.03 21/08/2019  Thanh T.       TSK 0867186
.           Added WSCH2900, EXTN0200 to cater for the sms printer type 
. V10.14.02 02/08/2019  Peter Vela     TSK 0852803
.           Handle empty admission number in WEBSCH50 to stop 
.           "Visit not found"
. V10.14.01 12/03/2019  Richa Phogat   TSK 0869550
.           Added ACCAUDFD/IO, PTCLM011, PTCNHDPS, MVACCPRN, CLACCAUD to add a 
.           record when 'ACC Forms' is printed via 'Injury / Accident Data'
. V10.13.06 16/01/2019  Don Nguyen     TSK 0868740
.           Added array bounds checking for keystrokes array (KEYSTARR)
. V10.13.05 04/12/2018  Davin          TSK 0860198
.           Changed KEY6 to KEY8 to fix read on patdrgaf (RDSDRGA2 @ PRS2RS00)
. V10.13.04 14/11/2018  Don Nguyen     TSK 0863187
.           Added additional field tags (OPTN9800-OPTN9900)
. V10.13.03 31/10/2018  Ebon Clements  TSK 0865679
.           Fixed max 95 array test for admission in SETPAR00 ADMISARR[]
. V10.13.02 11/10/2018  Ebon Clements  TSK 0839963
.           Added excelcsv cgi to view csv spooled file
. V10.13.01 26/07/2018  J.Tan            TSK 0848506
.           Changed PP Doctor from DIM6 to DIM10
. V10.12.03 06/07/2018  Jill Parkinson Tsk 0859091
.           Added checks for SCHDPCNT to zero in SETPAR00 to stop U*R
. V10.12.02 14/02/2018  Ebon Clements     TSK 0852705
.           Use TBSPOOL for PHP spool file path  - SHWREP30
.           14/01/2018  J.Tan             TSK 0848146
.           Added CFEEDT - from date for Fees Invoice report
. V10.12.01 24/01/2018  Richa Phogat      TSK 0844685
.           Added  PTCNEPMI/CONFLD12 - Using External PMI
.           PATCNESBT/CONFLD13 - External Search Button Text
. V10.11.04 04/11/2017  Peter Vela     TSK 0847061
.           Added further unpacking of DISPLINA to allow shrink to fit
.           printing REPT0000
. V10.11.03 Ebon Clements              TSK 0841419                             
.           Added VIEWTYPE to show report spool file via php - SHWREP30
. V10.11.02 08/08/2017  Tracey Nguyen  TSK 0299206
.           Added PTCSXOFF/CONFLD11 (PARC1100) for Do not show Soundex in HCP, 
.           Practice and Doctor searches indicator
. V10.11.01 28/07/2017  Jill Parkinson TSK 0842203
.           Removed changed made in 10.10.03 as it stops html format working
. V10.10.03 05/07/2017  Jill Parkinson TSK 0841419
.           Added rep < with spaces when outputting spool file to stop ending
.           of page
. V10.10.02 16/05/2017  Thanht T.      TSK 0837928
.           Changed to print all the labels starting with LABELPMInn
.           instead of LABELPMI01 only for patient without visit no.    
. V10.10.01 28/03/2017  J.Tan          TSK 0822482
.           Mod SINREG00 to check for Inactive Register
. V10.09.03 21/02/2017  Thanh Tieu     TSK 0831324
.           Fixed the Permanent Red/Underline color
. V10.09.02 05/01/2017  Don Nguyen     TSK 0814332
.           Added PATCOD00 - remote script to return Category Code
.           Indicators and Associate Field values (pipe-delimited)
. V10.09.01 29/12/2016 Ania P          CAR 829941
.           Added remote scripting output
. V10.08.03 14/11/2016 Ebon Clements   TSK 0819770
.           Added subscript <=95 test to ADMISARR array - SETPAR00
.           11/11/2016 J.Tan           TSK 0302781
.           Added Selection of Journal type
. V10.08.02 15/07/2015 J.Tan           TSK 0822064
.           Modified size of DISPLINA and DISPLINB from 227 to 327 characters
.           for Export Full ATB report
. V10.08.01 30/03/2016  J.Tan          TSK 0313425
.           Added Menuflag
.           Modified size of DISPLINA and DISPLINB from 127 to 227 characters
. V10.07.09 11/03/2016  Ebon Clements  TSK 0294154
.           Added SMS selection lists to OPTN0000
. V10.07.08 10/03/2016  Ebon Clements  TSK 0321541
.           Added OPTN9300 - Cat code selection list including inactive codes
. V10.07.07 02/03/2016  Don Nguyen     TSK 0303887
.           Added OPTN9100 & OPTN9200
.           21/01/2016  Ebon Clements  TSK 0294154
.           Added OP SMS message selection list - SMSOLT00
. V10.07.06 06/01/2016  Ebon Clements  TSK 0294154
.           Added WL SMS message selection list - SMSSEL00
. V10.07.05 22/12/2015  J.Tan          CAR 0303942
.           Mods for additional payment types
. V10.07.04 17/12/2015  Ebon Clements  CAR 294154
.           Added SMS notification functionality
. V10.07.03 16/11/2015  J.Tan          CAR 303942
.           Added Payment code
.           27/11/2015  J.Tan          CAR 321534
.           Added SINREG00 - Register selection
. V10.07.02 12/11/2015  J.Tan          CAR 321534
.           Added OPTN8600 - Claim code selection with non blank Assoc.field 5
. V10.07.01 23/10/2015  Ebon Clements  CAR 320819
.           Added Inactive test to letter selection lists
. V10.06.04 03/09/2015  J.Tan          CAR 317216
.           Added OPTN8500 - for Public Claim code selection
. V10.06.03 14/08/2015  Ebon Clements  CAR 316175
.           Recompiled for IBALPCCD - schedule number 
. V10.06.02 13/08/2015  Don Nguyen     CAR 308621
.           Modified ALLROW00 to output Status string according for PATSCH88
.           Added validation for fltprgid=PATSCH88
. V10.06.01 11/06/2015  Don Nguyen     CAR 303887
.           Added OPTN8400 - Directory for NZ EDI file (PTCNNZED)
.           04/03/2015  B.G.Ackland    CAR 
.           Added output type PDF
. V10.05.02 16/10/2014  Don Nguyen     CAR 306865
.           Added PARC0900 (CONFLD09) & PARC1000 (CONFLD10) for
.           CSRCHDRG & CSRCHYRG respectively.
. V10.05.01 06/10/2014  Ebon Clements  CAR 268970
.           Change to use OUTCLIFD index 1 instead of index 2
. V10.04.04 04.04.2014  J.Tan          CAR 297283
.           Added Preferred Language for PAT93 Report Selection list
. V10.04.03 31.03.2014  B.G.Ackland    CAR 299363
.           Replace META Tag Redirect with Javascript in Common RDIREC00
.           Routine
. V10.04.02 04/03/2014  Ania P         CAR 275582
.           Added EMR88FLG, LREP1800, LREP1900
. V10.04.01 31/12/2013  Don Nguyen     CAR 294389
.           Recompiled for changes to WATLETFD and WATLETIO
.---------------------------------------------------------------------- 
. V10.03.11 11/11/2013  Ania P         CAR 208177
.           Added Tag %RSHWEB02.02.027 - Keystroke File Contents
. V10.03.10 01/08/2013  Ebon Clements  CAR 289242
.           Added management analysis hospital selection list tag - MANG1500
. V10.03.09 03/07/2013  J.Tan          CAR 287902
.           Fixed default printers (SETDFPR2,SETDFPR3) to DIM6
. V10.03.08 12/04/2013  Ania P         CAR 280425
.           Added Tag %RSHWEB02.01.17 - Storage Location
. V10.03.07 22/02/2013  Ebon Clements  CAR 277862
.           Added AH department selection list
. V10.03.06 16/10/2012  Ebon Clements  CAR 266929
.           Added emr locations tag
. V10.03.05 01/03/2012  Ebon Clements  CAR 261063
.           Added inactive test to WL letter selections - LETSEL00
. V10.03.04 02.02.2012  J.Tan            CAR 246107
.           Mods checking for inactive cash drawers
. V10.03.03 22.12.2011  Saroeun Soeur    CAR 253297
.            added make perm. and description WEBSCH10,DESCCHNG
. V10.03.02 06.12.2011  Saroeun Soeur    CAR 253297
.           change description of spool file
. V10.03.01 24/11/2011  J.Tan            CAR 255151
.           Recompiled for GETTFEES - get theatre fees after invalid Contract
. V10.02.08 12/07/2011  Mike Laming    CAR 240716
.           Mods for WA Health MED1 - Pulling List IBAHOS77
. V10.02.07 05/07/2011  Ebon Clements  CAR 240724
.           Mods for MRT hospital/location - Added hospital to location key
. V10.02.06 29/06/2011  J.Tan          CAR 239592
.           Mods printer to dim6 instead of dim3
. V10.02.05 27/06/2011  Peter McMullen CAR 240725
.           Change ward selection list to sort by name, not code
. V10.02.04 07/06/2011  Peter Vela     CAR 239583
.           Added Disaster Selection List
. V10.02.03 30/05/2011  Ebon Clements  CAR 239552
.           Fixed OP letter slection tag - SELOLT00 
. V10.02.02 23/05/2011  Davin          CAR 239540
.           Added Alert Category (H1-H9) selection list tag (alcat000)
. V10.02.01 07/04/2011  Jill Parkinson CAR 239574
.           Increased printers and departments to 6 characters
. V10.01.02 27/01/2011  Ebon Clements  CAR 233050
.           Removed casemix funding new file
. V10.01.01 14/01/2011  J.Tan          CAR 233048
.           Mods PATTFEFD to use HF Table type
. V10.00.01 06/04/2010  Jill Parkinson CAR 209751
.           Added multiple cgi
. V9.12.08  20/01/2010  Mike Laming    CAR 157391
.           Added 14 Options to IBAPAT93 - for User Defined fields that are now
.           permanent fields in PMSVX1af
. V9.12.07  04/01/2010  Saroeun Soeur  CAR 212610
.           SELTHE00 - added flag on tag to check for active theatre
. V9.12.06  28/09/2009  Davin          CAR 203011
.           Added docodflt - save default document code
. V9.12.05  08/09/2009  WeeLee Koo    CAR 205303
.           Added Contract ID Selection List (CNID0000)
. V9.12.04  02/09/2009  Mike Laming    CAR 167649
.           Added PRS2RS00 to PROFLD for PRS2 EOY Reset
. V9.12.03  31/07/2009  Ebon Clements  CAR 202625
.           Added superlev
. V9.12.02  23/06/2009  WeeLee Koo  CAR 197930
.           Added Reason for Diversion list  (RESNDV00)
. V9.12.02  23/06/2009  WeeLee Koo  CAR 197930
.           Added Reason for Diversion list  (RESNDV00)
. V9.12.01  12/06/2009  Saroeun Soeur  CAR 198035
.           stationery code list
. V9.11.11  29/04/2009  Jill Habasque  CAR 194418
.           Mods to output html or text flag
. V9.11.10  02/04/2009  Jill Habasque  CAR 193772
.           Added trap around WRWBSC1
. V9.11.09  25/03/2009  J.Tan          CAR 187083
.           Fixed Cash Drawers selection list for Multi Hospital
. V9.11.08  23/03/2009  Peter McMullen CAR 190945
.           Added tag for CWEBGFIL (Apache web group file)                    
. V9.11.07  15/01/2009  Ebon Clements  CAR 175204
.           Added document number IBPDNUM to default printer save - UPDEFP00
. V9.11.06  06/01/2009  Mike Laming    CAR 166690
.           Add PathName for PRIMHD (MHCNEDIR) from MEHCONFD in PROFLD
. V9.11.05  11/12/2008  Ebon Clements  CAR 174080
.           Removed ward only edit from the ward selection list - WSLL0000
. V9.11.04  07/10/2008  J.Tan          CAR 181267
.           Added tag for Category HT
.           Extended length of KEYSTARR (key strokes array) to 120
. V9.11.03  06/11/2008  Peter McMullen CAR 174725
.           convert internal javascript to W3C standards
. V9.11.02  24/10/2008  Ebon Clements  CAR 181583
.           Recompiled for IBALPCCD - Added trap
. V9.11.01  02/10/2008  Ebon Clements  CAR 174035
.           Added WSLL0000 - ward selection list with hospital security test
. V9.10.02  26/08/2008  Peter Vela     CAR 176904
.           Move CWEBPSAR to Sector 101 Pos 54 DIM 2
. V9.10.01  19/08/2008  Peter Vela     CAR 169918
.           Added tags for - Hospital Id with selectedindex
.                          - Ward Option value
.                          - Ward with Hospital Id validation
. V9.09.10  07/02/2008  Peter Vela     CAR 155334
.           Added tag for Prosthetic Tracking lookup screen.
. V9.09.09  16/12/2007  Mike Laming    CAR 158013
.           Minor change to routine CHQSLT00 (in OPTN0000) to add password flag
. V9.09.08  07/12/2007  Mike Laming    CAR 150425
.           Add Cheque Acct List for Receipting - routine CHQSLT00 (in OPTN0000)
. V9.09.07  03/01/2008  Peter Vela     CAR 156195
.           Added tag for CHSCED (End date for current HCS run) Month and Year
.           only.
. V9.09.06  18/12/2007  Ebon Clements  CAR 155123
.           Recompiled for WEBCONFD - CWEBDNAI - Display doctors name case as is
. V9.09.05  18/10/2007  Davin          CAR 151903
.           Save new fields default no. of copies & default document code when
.           saving default printer - UPDEFP00
. V9.09.04  10/10/2007  Ebon Clements  CAR 151948
.           Added my occupational group scheduled task list - OCCREP00
. V9.09.03  07.09.2007  Jill Habasque  CAR 135539
.           Mods for printing of forms for outpatients
. V9.09.02  28/08/2007  Jill Habasque  CAR 135539
.           Added printing of allied health forms
. V9.09.01  06/07/2007  Mike Laming    CAR 142507
.           Added RPTSEL00 to Report selection routine LREP0000 (for IBAPAT93)
. V9.08.04  22/05/2007  Jill Habasque  CAR 139238
.           Added UPDEFP00 - save multiple default printers
. V9.08.03  22/03/2007  Jill Habasque CAR 135514
.           Added schedule of medication keyword generation
. V9.08.02  21/02/2007  Jill Habasque CAR 134162
.           Added filters for user and progam
. V9.08.01  31/01/2007  Peter Vela    CAR 127930
.           Recompled for MRTCONFD
. V9.05.03  17/03/2006  Ebon Clements CAR 89155
.           Mods for multi hospital medical record locations
. V9.05.02  09/03/2006  Ebon Clements CAR 78533
.           Mods for PATCODTM - Hospital specific category codes
. V9.05.01  06/03/2006  Mike Laming   CAR 62306
.           Add REPSEL00 - pull down list for IBAPAT93 Report Options
. V9.05.B03 02/03/2006  J.Tan            CAR 96072
.           Recompiled for IBAWEBCD - added new tag for yesterday date
. V9.05.B02 23/02/2005  J.Tan            CAR 96067
.           Added Med Prac. selection to display description only (no code)
. V9.05.B01 30/01/2006  Ebon Clements CAR 93186
.           Mods for REDIRECT length change. Recompiled for IBAWEBDF
. V9.04.15  18/10/2005  J.Tan            CAR 52606
.           Fixed generating C/P theatre fees
. V9.04.14  06/10/2005  Peter Vela       CAR 78674
.           Added WINPAR00 to NXTPAG00
. V9.04.13  29/04/2005  Peter Vela       CAR 55214
.           Recompiled for MRTCONFD
. V9.04.12  20/04/2005  Ebon Clements CAR 56701
.           Added private practice selection list that checks security
. V9.04.11  21/03/2005  Mike Laming   CAR 59171
.           Add SELREG00 - pull down list for Registers (as OPTN6000)
. V9.04.10  20/01/2005  Lina Vo    CAR 55909
.           Added OPCNODSC and OPCNCDSC tags
. V9.04.09  15/12.2004  Peter Vela CAR 53346
.           Fixed Final Admission printer functionality patweb9801043.html kids
. V9.04.08  20/12/2004  Ebon Clements CAR 55406
.           Added Asset label printing
. V9.04.07  07/12/2004  Jill Habasque CAR 55627
.           Added LOCSIT00 - output of EMR site                    
. V9.04.06  23/11/2004  Peter Vela CAR 53346
.           Added functionality to retain printer assignment in
.           patweb9801043.html kids
. V9.04.05  03/11/2004  J.Tan   CAR 53821
.           Fixed setup financial year for current date
. V9.04.04  26/10/2004  Ebon Clements    CAR  54583
.           Allow emr visits to print labels in WEBSCH45
. V9.04.03  01/10/2004  Ebon Clements    CAR  52623
.           Added tag for casmix types OPTN5700
. V9.04.02  28/09/2004  Davin             CAR   53266
.           Removed control file parameter routine (now in ibawebcd)
.           15/09/2004  Jill Habasque
.           Added check for LABELOUT99
. V9.04.01  20/08/2004  Lina Vo           CAR   52901
.           Put Mult-Hospital changes on Hospital Selection List (HOSPID00).
. V9.03.22  10/08/2004  Lina Vo           CAR   51011
.           Fixed casemix validate in CHKTFE00
. V9.03.21  30/07/2004  Pat Dirito        CAR   50673
.           Added ouput tag for CNDOCLB - Number of Doctors Labels to print
. V9.03.20  14/07/2004  Steve Armstrong   CAR   51766
.           Change WRITE to CONTROLF to a WRITAB     
. V9.03.19  07/07/2004  Ebon Clements   CAR 51065
.           Moved remote script CHKPRD00 to COMWEB80
. V9.03.18  18/06/2004  Sylvek Litewka  CAR 50774
.           Added procedure DFTPRD00 to obtain the default period from 
.           PATDRGFD. Also added remote script CHKPRD00 to validate the period
.           entered against periods defined on PATDRGFD.
. V9.03.17  28/05/2004  Peter Vela      CAR 48921
.           Now able to print PMI Labels (LABELPMI01) without focussing on a
.           visit.
. V9.03.16  07/05/2004  Pat Dirito    CAR 49842      
.           Added BASLST00 - BAS Code Selection List
. V9.03.15  25/05/2004  Jill Habasque CAR 48414      
.           Added update of PTCNSTGV
.           28/05/2004  Lina Vo                      
.           Fixed GETIMP00 & GETMP100 to exit if filename is blank. 
. V9.03.14  19/05/2004  Lina Vo                      
.           Fixed GETIMP00 to not exit when no extension found. 
. V9.03.13  28/04/2004  Lina Vo         CAR 48475
.           Added PTCNLPRO tag.                     
. V9.03.12  07/04/2004  Lina Vo         CAR 47832
.           Fixed CHKTFE00. 
. V9.03.11  01/04/2004  Lina Vo         CAR 47832
.           Added CHKTFE00 (Report 11) - Remote Script, check Theatre Fee
.           30/03/2004  Ebon Clements   CAR 48405
.           Fixed open of prefixed outpatient files
. V9.03.10  17/03/2004  Lina Vo         CAR 44110
.           Added PRCNCADM tag.                     
. V9.03.09  01/03/2004  Lina Vo         CAR 47921
.           Removed use of PRIDBTFD & IO.           
.           Removed Report 9 - PP Debtor Search        
. V9.03.08  27/02/2004  Lina Vo         CAR 44151
.           Added Audit Tags - PRCNAUDA to PRCNAUDI.
.           Added remote-script to check for empty audit files 
.           (Report 10 - CHKAUD00).
. V9.03.07  23/02/2004  Lina Vo         CAR 44144
.           Put Private Practice Doctor Selection list back.
. V9.03.06  16/02/2004  Lina Vo         CAR 44134
.           Put Private Practice Medical Practice Selection list back.
. V9.03.05  14/11/2003  Henry Son       CAR 43467
.           Keep the Last printer selected for Label Forms.
. V9.03.04  18/12/2003  Peter Vela      CAR 43134
.           Recompiled for MRTCONFD
. V9.03.03  13/08/2003  Sylvek Litewka  CAR 41293
.           Removed FD, IO and OPENS of webschaf. These are now included in
.           IBAWEBDF.PBL and IBAWEBCD.PBL.
. V9.03.02  04/08/2003  Sylvek Litewka  CAR 21003
.           Modified size of DISPLINA and DISPLINB from 80 to 127 characters
.           in order to correctly display reports with more than 160 columns.
. V9.03.01  04/06/2003  J.Tan   CAR 36503
.           Added code category "A" - admission type
. V9.02.25  04/04/2003  Ebon Clements SRF 37705
.           Added RSCNTIMD - Time to run auto delete of spool files
.           02/04/2003  Lina Vo       CAR 37660
.           Fixed PTCNI10D tag.                                           
. V9.02.24  02/04/2003  Lina Vo       CAR 37660
.           Added PTCNI10D tag.                                           
.           20/03/2003  Dean Cramer   CAR 36516
.           Added selection list for GST Codes                            
. V9.02.23  08/01/2003  Peter Vela    SRF 23145
.           Added validation for Current Event Patient - Label and Forms
. V9.02.22  05/12/2002  Lina Vo       SRF 22709  
.           Added OPNOUT00 to open outpatient file.         
. V9.02.21  25/10/2002  Ebon Clements SRF 22413  
.           Removed old timeout code. CWEBTIMO and RSHCTR18
. V9.02.20  07/10/2002  Dean Cramer              
.           Include tag loadfnm1 for theatre upload file transfers
. V9.02.19  24/08/2002  Jill Habasque SRF 21337
.           Fixed selection list for Waiting List Extracts
. V9.02.18  29/06/2002  Ebon Clements SRF 19105
.           Recompiled for sigpipe trap
. V9.02.17  31/05/2002  Ebon Clements 18229
.           Added trap if sigpipe
. V9.02.16  08/04/2002  Dean Cramer   
.           Removed REP "0 " on printer and replaced with leading zeroes
.           replaced with spaces only code.
. V9.02.15  18/02/2002  Bronko Sosic  
.           Added a REP "0 " on printer                               
. V9.02.14  14/02/2002  Ebon Clements 
.           Read all control file fields for display of patient search
.           parameter screen. These fields were not read CWEBDNAM,CWEBSDAY
. V9.02.13  10/02/2002  Sandra Barcham
.           Check controlf reads and writes                    
. V9.02.12  22.01.2002  Ebon Clements 
.           Added parent redirect                              
. V9.02.11  08.01.2002  Dean Cramer 
.           Site tests for SELCLI and SELCLD                   
. V9.02.10  06.12.2001  B.G.Ackland
.           Enable Exclusion of Public Holidays & Days of Week
. V9.02.09  02/11/2001  Greg Horvat
.           Added xtra option to the parameter PTCNADMT
. V9.02.08  25.10.2001 Bronko Sosic
.           Added a check for Zero Admission number for printing        
. V9.02.07  25.10.2001 Dean Cramer
.           Make clinic name selection list.                            
. V9.02.06  24.10.2001 Dean Cramer
.           Fix overlay problem.                                        
. V9.02.05  15.10.2001 Dean Cramer
.           Fix incomplete Waiting List Extract File Selection List.
. V9.02.04  02.10.2001 Dean Cramer
.           Add Private Practice Doctors selection list.   
.           02.10.2001 Kuldeep Singh
.           Add the Debtors Search Frame
.           01.10.2001 Dean Cramer 
.           Add Private Practice Financial Letter Type selection list.     
.           28.09.2001 Dean Cramer 
.           Add Patient Invoice Messages selection list.  
.           Add Private Practice Medical Practice selection list.  
. V9.02.03  24.09.2001 Dean Cramer 
.           Add Procedure Group selection list.                    
.           Add Waiting List Patient Extract selection list.                    
.           Add Patient Financial Letter Type selection list.                   
. V9.02.02  04.09.2001 Dean Cramer 
.           Add Outpatients Letter Type selection list.                       
. V9.02.01  14.08.2001 Dean Cramer 
.           Remove Theatre Item Selection List due to list to large           
. V9.00.02  09.08.2001 Dean Cramer 
.           Add Theatre Nurses Selection List                                
. V9.00.01  27.07.2001 Dean Cramer 
.           Add Cashier ID Selection List                                   
. V9.00.B07 04.07.2001 Dean Cramer 
.           Add Theatre Selection List                        
. V9.00.B06 29.06.2001 B.G.Ackland
.           Change to WEBSCHFD to allow for TRU64 Cluster
. V9.00.B05 25/06/2001 J.GUNN
.           Change WRITE to WRITAB for CONTROLF/ORACLE ISSUE
. V9.00.B04 21/06/2001 B.G.Ackland
.           Fixed Table Outputs
. V9.00.B03 21/05/2001 B.G.Ackland
.           Enable a Import File to be Sent to a Program
. V9.00.B02 14/05/2001 Ebon Clements
.           Added New parameter to WEBCONFD and update function.
.           For default number of days in current patient search
.---------------------------------------------------------------------- 
. V5.09.B04 21/02/2001 Bronko sosic
.           Added New parameter to WEBCONFD and update function from MAIN1800
.           new parameter - For Format of Patient Name,format of doctors name
. V5.09.B03 WEB19/01/2001 J.Tan
.           Mods to unit to use category "P" instead of "DT" 
. V5.09.B02 20.12.2000 B.G.Ackland
.           Added New Option for General Parameter Maintenance
.           Added Parameters for Patient Search Age Range & Type Defaults
.
. V5.09.01 15.09.2000 Sandra Barcham
.          Replace RSHCONFD with WEBCONFD
.
. V6.07.00 19.04.2000 Pat Dirito  
.          Created Program
.
.----------------------------------------------------------------------
          INC       IBAWEBDF    
          INC       ALLDEPFD/INC
          INC       ALLREFFD/INC   * Allied health
          INC       ALLVREFD/INC
          INC       ACCAUDFD/INC   * ACC Audit File
          INC       BOKRC1FD/INC   * Booking File
          INC       BOKLETFD/INC   * Booking Letters
          INC       DISMASFD/INC  
          INC       EMRLOCFD/INC
          INC       EMRSITFD/INC
          INC       FMSCHQFD/INC   * (FMS) Cheque Account Master
          INC       MEHCONFD/INC   * Mental Health Parameters
          INC       MLTSECFD/INC
          INC       MLTSITFD/INC
          INC       OBSPCTFD/INC
          INC       MRTCONFD/INC   * Parameters
          INC       MRTLOCFD/INC   * Locations
          INC       MRTSTFFD/INC   * Staff
          INC       IBAGSTFD/INC   * GST Codes
          INC       IBALPCFD/INC   * Print file for labels and forms
          INC       IBADPTFD/INC
          INC       IBABASFD/INC   * BAS Code Table
          INC       OUTBOAFD/INC
          INC       OUTSITFD/INC   * Site file
          INC       OUTCLIFD/INC   * Clinic file
          INC       OUTCTYFD/INC   * Clinic type file
          INC       OUTLETFD/INC   * Outpatients Letters File 
          INC       OPRCONFD/INC   * Parameters  
          INC       OPRNURFD/INC   * Theatre Nurses File  
          INC       OPROPRFD/INC   * Operating Romm File  
          INC       ALLCONFD/INC
          INC       PATCONFD/INC   * Inpatient Control File
          INC       PATCMXFD/INC            * Casemix funding file
          INC       PATCTFFD/INC            * DRG/MBS theatre fee file
          INC       PMSCIDFD/INC   * Contract ID file
          INC       PATCFAFD/INC   * Claim code Contract effective date
          INC       PATDO1FD/INC   * Doctor file
          INC       PATFN1FD/INC   * Health fund file
          INC       PATFX1FD/INC   * Health fund file
          INC       PATFLTFD/INC   * Patient Financial Letters
          INC       PATHGPFD/INC   * Health fund groups file
          INC       PATHSPFD/INC   * Hospital code file
          INC       PATICGFD/INC   * Procedure Group Codes
          INC       PATILTFD/INC   * IP Letters
          INC       PATIN1FD/INC   * Insurance file
          INC       PATITMFD/INC   * Item file
          INC       PATMESFD/INC   * Patient Invoice Messages 
          INC       PATMI1FD/INC   * Patient Admission file
          INC       PATNURFD/INC   * Nursing Station File
          INC       PATTFEFD/INC            * Theatre fee file
          INC       PATVISFD/INC   * Visit File
          INC       PATWR1FD/INC   * Ward Bed File
.
          INC       PMSVX1FD/INC   * Visit Extension File
          INC       PMSEVTFD/INC   * Events File
          INC       PMSHCPFD/INC   
          INC       PMSPTHFD/INC
.
          INC       PRIAUDFD/INC
          INC       PRIAUIFD/INC
          INC       PRIAURFD/INC
          INC       PRICONFD/INC
...          INC       PRIDBTFD/INC   * Private Practice Debtors Details
          INC       PRIDOCFD/INC
          INC       PRIEXCFD/INC
          INC       PRIITMFD/INC
          INC       PRISPTFD/INC
          INC       PRIALSFD/INC
          INC       PRISECFD/INC
.          INC       PRIFLTFD/INC   * Private Practice Financial Letters
          INC       PRIPRAFD/INC   * Private Practice Medical Practice
          INC       PATDRGFD/INC
          INC       PATDDHFD/INC
          INC       CCSSTYFD/INC   * Casemix types
.
          INC       MRTMASFD/INC   * MRT master file
          INC       RCPCIDFD/INC   * Receipting Cashier Details 
          INC       RCPREGFD/INC   * Register Details                  *I-59171
          INC       WATEXTFD/INC   * Waiting List Patient Extract
          INC       WATLETFD/INC   * Waiting List Letters
          INC       WEBRDTFD/INC   * Report group details
          INC       WEBRGMFD/INC   * Report group master
          INC       WEBRTMFD/INC   * Report template master
          INC       WEBRURFD/INC   * User report group
          INC       WEBDATDF       * Web Systems Control File 
.
.         CGI Variables
.
ADMSDATE  DIM       8       * Admission Date
ALLACCES  FORM      1       * All access
ALLVRINC  FORM      1       * Is allvreaf available
CCSSTINC  FORM      1
ADMTCODE  DIM       3       * Admission Type
ACCGFLAG  DIM       3       * Accommodation GST Flag
BEDTCODE  DIM       3       * Bed Type
CLMTCODE  DIM       3       * Claim Type
CHQACCNT  DIM       15      * Cheque Account code (FMSCHQFD)
CHCKUSL   DIM       2       
CHCKTSL   FORM      2       
COUNT     FORM      3
CSMXCODE  DIM       9
CLINICTY  DIM       6
CNTRCEFR  FORM      1
CONTRCID  DIM       6
DCASEFLG  DIM       1       * Daycase Flag
DCFLAG    FORM      1
DISCANCL  FORM      1       * Display Cancel Button              . 0 948308
DFLTWARD  DIM       3
DIM3      DIM       3
DIM5      DIM       5
DIM8      DIM       8
DIM18     DIM       18
DIM18A    DIM       18
DOCODFLT  DIM       8
DZERO     INIT      "00"
EMRSCH88  INIT      "EMRSCH88"
EXCELCSV  FORM      1
MINUS2    FORM      "-2"
MINUS3    FORM      "-3"
HLTHFUND  DIM       6       * Health Fund
HLTHTABL  DIM       8       * Health Fund Table
KEY13A    DIM       13
KEY18A    DIM       18
NEWYR     DIM       4
OLDYR     DIM       4
OCCUPGRP  DIM       3
PRINTDPT  DIM       6
TSRVDATE  DIM       8
TABTYPE   DIM       3       * Table type
TRNSDATE  DIM       6
TFEECODE  DIM       9       * Theatre Fee Code
WATLETFL  FORM      1
EXTRNO    FORM      2
FORM3     FORM      3
FORM8     FORM      8
GENDAT    DIM       8
SHOWSITE  DIM       1
SPOOLDIR  DIM       70
STRDAT    DIM       8
STRING1   DIM       6
SUPERLEV  DIM       1
ENDDAT    DIM       8
ENDSTR    FORM      2
EXTRCTID  DIM       4
EXCDATE   DIM       10
EXFDATE   DIM       10
EXTDATE   DIM       10
FILENAM   DIM       15
FLTUSRID  DIM       10
FLTPRGID  DIM       10
HOSPCODE  DIM       3
OPRNUM    FORM      6
NUMADM    FORM      6
CURRPERD  FORM      1
PRIOPS    FORM      1
PRIDIS    FORM      1
NUMBDY    FORM      6
NUMCAS    FORM      5
NUMAMT    FORM      12.2
SAEID     DIM       4
SETDEFPN  DIM       10[95]
SETDFPRG  DIM       8
SETDFPG2  DIM       8                                                  *I-53346
SETDFREP  DIM       8
SETDFPR2  DIM       6                                                  *I-53346
SETDFPR3  DIM       6                                                  *I-53346
STATCODE  DIM       1
SKEY18    DIM       18
LABELNUM  FORM      3
DIM1A     DIM       1
DIM1B     DIM       1
DIM1C     DIM       1
DIM1D     DIM       1
DIM1E     DIM       1
DIM1F     DIM       1
DIM11     DIM       11
DIM187    DIM       187
DISPLINE  DIM       1200
DISPLNAA  DIM       127
DISPLNAB  DIM       127
DISPLNAC  DIM       73
DISPLINA  DIM       327
DISPLINB  DIM       327
DISPLINX  DIM       1200
FORM5     FORM      5
ARRCNT    FORM      3
CFILEPRE  DIM       3       * site prefix
EXTNUMBR  DIM       2       * Extract Number
NEXTPAGE  DIM       1       * Nextpage parameter CGI parameter
CMDLINE   DIM       127     * Redirect URL
TEXTLINE  DIM       100     * Temp var for .cfg file read
UPDTTYPE  DIM       1       * Update Type
VALDOPTN  FORM      2
VALDFRDT  DIM       8
VALDTODT  DIM       8
WARDOPTN  DIM       1
WARDCODE  DIM       3
DESCCHNG  DIM       1
TXTCOLOR  DIM       20
PTCLM011  DIM       20      * PATWC1FD-WCCLMNO   INSURANCE CLAIM NUMBER
.
CEFFDATE  DIM       8
CURRDATE  DIM       8
FNPERIOD  DIM       6
.
FIRST12   DIM       12
TEST12    DIM       12
SEC       FORM      2
STARTSTR  FORM      2
STATDESC  DIM       20
STATDES0  INIT      "Executing "
STATDES1  INIT      "Queued    "
STATDES2  INIT      "          "
STATDES3  INIT      "          "
STATDES4  INIT      "          "
STATDES5  INIT      "          "
STATDES6  INIT      "Failed PID"
STATDES7  INIT      "No Output "
STATDES8  INIT      "Spooled   "
STATDES9  INIT      "Printed   "
.
TEMPFILE  FILE   ASCII, FIXED=256
OUTPTFLG  FORM      1       * Flag for OutPatient Labels
DELTEREP  DIM       1       * Flag for New Scheduled Process List
SHOWFUTR  DIM       1       * Flag for All Future Dates Reports  
SHOWQUED  DIM       1       * Flag for List only queued Reports  
ARRPT     DIM       8[999]  * Array to remove selected reports 
COUNTITM  FORM      3        
SCHDLENO  DIM       8       * Schedule Number
.
SITECODE  DIM       6       * Site code
SCHDCODE  DIM       8       * Schedule Number
SCHDDATE  DIM       8       * Schedule Date
SCHDTIME  DIM       8       * Schedule Time
SCHDPRNT  DIM       6       * Printer No
SCHDCMLN  DIM       50      * Unix Command to initialise program
SCHDDESC  DIM       50      * Report Program Description
SCHDPGID  DIM       8       * Report Program ID
SCHDTYPE  FORM      1       * Output Type 0=Text 1=Html
SCHDSPLN  DIM       50      * Spool File 
SCHDCOPY  FORM      3       * No of Copies
SCHDPRIN  DIM       1       * Print Report 0=No 1=Yes 
SCHDRDAT  DIM       12      * Re-schedule Encoded Date 
SCHDREND  DIM       8       * Re-Schedule End Date
SCHDPERM  DIM       1       * Save as Permanent Spool File
EXCEPTPB  DIM       1       * Exclude Public Holidays
EXCEPTMO  DIM       1       * Exclude Mon
EXCEPTTU  DIM       1       * Exclude Tue
EXCEPTWE  DIM       1       * Exclude Wed
EXCEPTTH  DIM       1       * Exclude Thu
EXCEPTFR  DIM       1       * Exclude Fri
EXCEPTSA  DIM       1       * Exclude Sat
EXCEPTSU  DIM       1       * Exclude Sun
.
SCHCLP01  DIM       1       * Unix Command Line Parameter 1  (1=Active) 
SCHCLP02  DIM       1       * Unix Command Line Parameter 2  (1=Active) 
SCHCLP03  DIM       1       * Unix Command Line Parameter 3  (1=Active) 
SCHCLP04  DIM       1       * Unix Command Line Parameter 4  (1=Active) 
SCHCLP05  DIM       1       * Unix Command Line Parameter 5  (1=Active) 
SCHCLP06  DIM       1       * Unix Command Line Parameter 6  (1=Active) 
SCHCLP07  DIM       1       * Unix Command Line Parameter 7  (1=Active) 
SCHCLP08  DIM       1       * Unix Command Line Parameter 8  (1=Active) 
SCHCLP09  DIM       1       * Unix Command Line Parameter 9  (1=Active) 
.
RSHCTR01  FORM      4       * Number of Concurrent Processes
RSHCTR02  FORM      2       * Sleep Time
RSHCTR03  DIM       60      * Report Configuration File Directory
RSHCTR04  DIM       60      * Report Output Directory
RSHCTR05  DIM       60      * Execute Command
RSHCTR06  DIM       10      * Optional Command Line Parameter 1
RSHCTR07  DIM       10      * Optional Command Line Parameter 2
RSHCTR08  DIM       10      * Optional Command Line Parameter 3
RSHCTR09  DIM       10      * Optional Command Line Parameter 4
RSHCTR10  DIM       10      * Optional Command Line Parameter 5
RSHCTR11  DIM       3       * Auto Delete Spool Files X Days
RSHCTR12  DIM       3       * Auto Delete Comp/Fail Files X Days
RSHCTR13  DIM       60      * Extract Output directory          
RSHCTR14  DIM       40      * Remote Password Command
RSHCTR15  DIM       40      * Remote Password File
RSHCTR16  DIM       40      * HTML Root Directory
RSHCTR17  DIM       4       * Current Storage Location
RSHCTR18  DIM       5       * Time of Day to Run Auto Delete Spool Files
RSHCTR19  DIM       40      * Remote (Apache) Group File         
.
CONFLD01  DIM       1       * Patient Search Type Default
CONFLD02  DIM       2       * Patient Search Age Default
CONFLD03  DIM       2       * Patient Search Age Range Default
CONFLD04  DIM       2       * Patient List Name Format
CONFLD05  DIM       2       * Doctors List Name Format
CONFLD06  FORM      4       * Day range for current admissions
CONFLD07  DIM       1       * Soundex search order
CONFLD08  DIM       1       * Display doctors name case as is
CONFLD09  DIM       2       * Day Range for D.O.B. in surname searches
CONFLD10  DIM       2       * Year Range for D.O.B. in surname searches
CONFLD11  DIM       1       * Do not show Soundex in HCP/Practice/Dr. searches 
CONFLD12  DIM       1       * Using External PMI
CONFLD13  DIM       15      * External Search Button Text 
CONFLD14  DIM       2       * Gender Value to Display in Patient Name Format
CONFLD15  DIM       11      * Default Date Of Birth
CONFLD16  DIM       1       * Display Paediatric icon
.
IBAFLD01  DIM       8       * IBA password
IBAFLD02  FORM      8       * IBA key
.
RSHIBA01  DIM       8       * Password
.
REPORTID  DIM       8
UPPRPTID  DIM       8
.
KEYSTARR  DIM       120[150]  * Key Strokes Array
.KEYSTARR  DIM       50[95]  * Key Strokes Array
KEYSTCNT  FORM      3       * Key Strokes Counter
.
MULTCNT   FORM      2       * Key Strokes Counter
MULTCNT1  FORM      2       * Key Strokes Counter for multipl1
MULTCNT2  FORM      2       * Key Strokes Counter for multipl2
MULTCNT3  FORM      2       * Key Strokes Counter for multipl3
MULTCNT4  FORM      2       * Key Strokes Counter for multipl4
MULTCNT5  FORM      2       * Key Strokes Counter for multipl5
.
HTMLLNK1  DIM       55
HTMLLNK2  DIM       55
.
THCFLG    FORM      2
SUBSYSKY  DIM       50
LABELTYP  DIM       11
LABELDET  DIM       10
STATNCOD  DIM       6
FREETXT1  DIM       40
FREETXT2  DIM       40
FREETXT3  DIM       40
FREETXT4  DIM       40
FREETXT5  DIM       40
FREETXT6  DIM       40
FREETXT7  DIM       40
HFHIFUND  FORM      2
.
SCHDPARR  DIM       6[95]   * Array of selected Printer
SCHDPCNT  FORM      2
SCHDCARR  FORM      3[95]   * Number of Copies
SCHDCCNT  FORM      2       
SHOWEROR  FORM      1
URNUMARR  DIM       8[95]   * Array of Admission no
URNUMCNT  FORM      2
ADMISARR  DIM       8[95]   * Array of Admission no
ADMISCNT  FORM      2
SUBSYARR  DIM       28[95]  * Sub system key
SUBSYCNT  FORM      2
STATNARR  DIM       6[95]   * Stationary Code
STATNCNT  FORM      2
LABELARR  DIM       11[95]  * Label type
LABELCNT  FORM      2
FREEARR1  DIM       40[95]  * Free Text
FREECNT1  FORM      2
FREEARR2  DIM       40[95]  * Free Text
FREECNT2  FORM      2
FREEARR3  DIM       40[95]  * Free Text
FREECNT3  FORM      2
FREEARR4  DIM       40[95]  * Free Text
FREECNT4  FORM      2
FREEARR5  DIM       40[95]  * Free Text
FREECNT5  FORM      2
FREEARR6  DIM       40[95]  * Free Text
FREECNT6  FORM      2
FREEARR7  DIM       40[95]  * Free Text
FREECNT7  FORM      2
.
.   Variables
.
CATD1     INIT      "D1"
CATD2     INIT      "D2"
CATD3     INIT      "D3"
CATD4     INIT      "D4"
CATD5     INIT      "D5"
CATP1     INIT      "P1"
CATP2     INIT      "P2"
CATP3     INIT      "P3"
CATLA     INIT      "LA"
CATU1     INIT      "U1"
CATU2     INIT      "U2"
CATU3     INIT      "U3"
CATU4     INIT      "U4"
CATU5     INIT      "U5"
CATU6     INIT      "U6"
CATU7     INIT      "U7"
CATVR     INIT      "VR"
SCHDFLNO  FORM      8
HYPH      INIT      "-"
SLSH      INIT      "/"

KEYSTKFL  FILE      ASCII, FIXED=400   * Key Strokes File(Adjust Length to Suit)
KEYSTKNM  INIT      ".cfg"             * Key Strokes File Name Extension
.
CMDMV     INIT      "mv "
.
LOADFNAM  DIM       50                 * Load File Name 
LOADFNM1  DIM       50                 * Load File Name (non schedule format 1)
LOADFEXT  DIM       4                  * Load File Name Extension
LINK2PRT  FORM      1                  * Key for Keyword index
SAVDATE   DIM       8
SRNAME01  DIM       20                 * Surname
GNNAME01  DIM       25                 * Given Name
.
ACTIVE    DIM       1
.
WORKDATE  DATE      8
.
MBSCONTR  DIM       6
MENUFLAG  DIM       1                  * Menu Type
EXPORTDE  DIM       1                  * Export Description
.
PATCATGY  DIM       2                  * Patient Category
PATCODEV  DIM       3                  * Patient Code
.
HFCODDSP  DIM       1                  * Health Fund Code Display Parameter 
.
PIPE      INIT      "|"
.
MULTIPLE  INIT      "Multiple"
MULTIPL1  INIT      "Multipl1"
MULTIPL2  INIT      "Multipl2"
MULTIPL3  INIT      "Multipl3"
MULTIPL4  INIT      "Multipl4"
MULTIPL5  INIT      "Multipl5"
P9301     INIT      "Age"
P9302     INIT      "Age & Sex"
P9303     INIT      "Religion"
P9304     INIT      "Postcode"
P9305     INIT      "Disease Code"
P9306     INIT      "Primary Operation Code"
P9307     INIT      "Care Class"
P9308     INIT      "Claim Code"
P9309     INIT      "Country of Birth"
P9310     INIT      "Ward/Bed"
P9311     INIT      "Source of Referral"
P9312     INIT      "Marital Status"
P9313     INIT      "Resident Status"
P9314     INIT      "Operator"                              * start   *I-157391
P9315     INIT      "Record Location"
P9316     INIT      "Aboriginality"                         
P9317     INIT      "Admission Criterion"
P9318     INIT      "Intent to Readmit"
P9319     INIT      "Intend Stay Duration"
P9320     INIT      "Mental Health Legal Status"
P9321     INIT      "Service Unit Type"
P9322     INIT      "Elective Patient Status"
P9323     INIT      "Employment Status"
P9324     INIT      "ReAdmission in 28 Days"
P9325     INIT      "Discharge Intention"
P9326     INIT      "Unplanned Readmission"
P9327     INIT      "Unplanned Visit to Theatre"            * end     *I-157391

DOBZERO   INIT      "00000000"
DEFCCENT  INIT      "19"
DEFCYEAR  INIT      "20"
DEFCMON   INIT      "01"
DEFCDAY   INIT      "01"

.
THEALIT   INIT      "theatre"
INVUSERD  INIT      "Invalid Web User ID"
.
ZEROADMI  INIT      "       0"
ZERO8     INIT      "0000    "
CMDVIEW   INIT      "rshweb02.us1"
CMDVIEW2  INIT      "rshweb02.us2"
.
.-----------------------------------------------------------------------
PRGID     INIT      "RSHWEB02"
VERSION   INIT      "V12.01.00"
PRGNAM    INIT      "Web Report Scheduler Maintenance & Enquiries"
.-----------------------------------------------------------------------
          CALL      WEBINT00       * Initialise Fifo Etc.
          CALL      INIT0000       * Open Files
          CALL      REDPAR00       * Read in Parameter
.
MAIN1000  CALL      WEBRED00       * Read Fifo WEBPID and USERID
.
          COMPARE   "999",REPORTNO * End Server Process on Report Option 999
          GOTO      MAIN9999 IF EQUAL
.
          CALL      OUTFIL00       * Check Correct Site Files Are Open
          BRANCH    EXIT,MAIN1000
.
          BRANCH    REPORTNO,MAIN1100,MAIN1200,MAIN1300,MAIN1400,MAIN1500:
                             MAIN1600,MAIN1700,MAIN1800,MAIN1900,MAIN2000:
                             MAIN2100,MAIN2200,MAIN2300
.
          PACK      WEBTITLE,PRGID,SP1,VERSION,SP1,PRGNAM,SP70
          MOVE      "INVALID OPTION",WEBTITLE
          CALL      WEBERR00   * Create Output File and Write HTML Page Header
          GOTO      MAIN1000
.
MAIN1100  CALL      REPLST00        * List Schedule all or Current User
          GOTO      MAIN1000
.
MAIN1200  CALL      WEBSCH00        * Schedule Item Display & Maintenance
          BRANCH    EXIT,MAIN1000
          MOVE      "Update Complete",WEBTITLE
          CALL      NXTPAG00
          GOTO      MAIN1000
.
MAIN1300  CALL      RSHCON00        * Schedule Parameter Display & Maintenance
          BRANCH    EXIT,MAIN1000
          MOVE      "Update Complete",WEBTITLE
          CALL      NXTPAG00
          GOTO      MAIN1000
.
MAIN1400  CALL      SCHPRO00        * Add Program to Schedule
          BRANCH    EXIT,MAIN1000
          MOVE      "Report Scheduled",WEBTITLE
          CALL      NXTPAG00
          GOTO      MAIN1000
.
MAIN1500  CALL      SHWREP00
          GOTO      MAIN1000
.
MAIN1600  CALL      MANGEN00        * Management Analysis
          GOTO      MAIN1000
.
MAIN1700  CALL      RSHIBC00        * IBA Parameter Display & Maintenance
          BRANCH    EXIT,MAIN1000
          MOVE      "Update Complete",WEBTITLE
          CALL      NXTPAG00
          GOTO      MAIN1000
.
MAIN1800  CALL      PARAMC00        * Parameter Display & Maintenance
          GOTO      MAIN1000
.
MAIN1900  CALL      DEPR0000        * Scheduler delete routines
          BRANCH    EXIT,MAIN1000
          MOVE      "Delete Complete",WEBTITLE
          CALL      NXTPAG00
          GOTO      MAIN1000
.
MAIN2000  CALL      CHKAUD00        * Remote Script - check Audit Files
          GOTO      MAIN1000
.
MAIN2100  CALL      CHKTFE00        * Remote Script - check Theatre Fee
          GOTO      MAIN1000
.
MAIN2200  CALL      SCHMKI00        * Add Program to Schedule
          BRANCH    EXIT,MAIN1000
          MOVE      "Report Scheduled",WEBTITLE
          CALL      NXTPAG00   
          GOTO      MAIN1000
.
MAIN2300  CALL      PATCOD00        * Remote Script - get pat code output
          GOTO      MAIN1000
.
MAIN9999  MOVE      "SERVER SHUTDOWN COMPLETE",WEBTITLE
          CALL      WEBERR00
          STOP
.
MANGEN00  MATCH     SP70,EXTNUMBR
          GOTO      MANGEN50 IF EQUAL
          MOVE      EXTNUMBR,EXTRNO
          CALL      GETMPR00
.
MANGEN50  MOVE      "Management Analysis Generation",WEBTITLE
          CALL      WEBHED00
          BRANCH    EXIT,MANGEN99
          CALL      WEBBOD00
          CALL      WEBEND00
.
MANGEN99  RETURN
.------------------------------------------------------------
. Output Next Page Based on CGI Parameter nextpage
.------------------------------------------------------------
NXTPAG00  MOVE      ZERO,F1
          MOVE      NEXTPAGE,F1
          BRANCH    F1,NXTPAG10,NXTPAG20,NXTPAG30,NXTPAG40,NXTPAG50:
                       NXTPAG60,NXTPAG70,NXTPAG80
.
          CALL      WINCLS00
          GOTO      NXTPAG99
.
NXTPAG10  CALL      RDIREC00
          GOTO      NXTPAG99
.
NXTPAG20  CALL      GOBACK00      * Go Back 1 Html page
          GOTO      NXTPAG99
.
NXTPAG30  CALL      DAH20000      * Go Back 2 html pages
          GOTO      NXTPAG99
.
NXTPAG40  CALL      GOBACK00
          GOTO      NXTPAG99
.
NXTPAG50  CALL      PREDIR00
          GOTO      NXTPAG99
.
NXTPAG60  CALL      PPREDR00
          GOTO      NXTPAG99
.
NXTPAG70  CALL      WINPAR00
          GOTO      NXTPAG99
.
NXTPAG80  CALL      PARPAR00
          GOTO      NXTPAG99
.
NXTPAG99  RETURN
.*******************************************************************************
.                Close Window or Frame and Goto New Location
.*******************************************************************************
WINPAR00  CALL      OPENHTML
          BRANCH    EXIT,WINPAR99
          WRITE     HTMLFILE;"<script type=#"text/javascript#" ":
                             "src=#"../js/Standard.js#"></script>":
                             "<script type=#"text/javascript#" ":
                             "src=#"../js/Custom.js#"></script>":
                             "<script type=#"text/javascript#"> ":
                             " if (self.name==#"PopUpFrame#") {":
                             "  redirectParentFrame(#"",REDIRECT,"#"; }":
                             " else if (self.name==#"PopUpFrame1#") {":
                             "  reload2ParentFrame(#"",REDIRECT,"#"; }":
                             " else { ":
                             "  opener.location.href=#"",REDIRECT,"#";":
                             "  self.close(); }":
                             "</script>"
          CALL      CLOSHTML
WINPAR99  RETURN
.------------------------------------------------------------------------------
.  Redirect Parent URL
.------------------------------------------------------------------------------
PPREDR00  CALL      OPENHTML
          BRANCH    EXIT,PPREDR90
.
          WRITE     HTMLFILE;"<script type=#"text/javascript#"> {":
                             " parent.location.href=#"",REDIRECT,"#";":
                             "}":
                             "</script>"
          CALL      CLOSHTML
          GOTO      PPREDR99
.
PPREDR90  DISPLAY   "*** Fifo Not Found ***"
.
PPREDR99  RETURN
.------------------------------------------------------------------------------
.  Redirect Parent Parent URL
.------------------------------------------------------------------------------
PARPAR00  CALL      OPENHTML
          BRANCH    EXIT,PARPAR90
.
          WRITE     HTMLFILE;"<script type=#"text/javascript#"> {":
                             " parent.parent.location.href=#"",REDIRECT,"#";":
                             "}":
                             "</script>"
          CALL      CLOSHTML
          GOTO      PARPAR99
.
PARPAR90  DISPLAY   "*** Fifo Not Found ***"
.
PARPAR99  RETURN
.------------------------------------------------------------------------------
.  Redirect Parent URL
.------------------------------------------------------------------------------
PREDIR00  CALL      OPENHTML
          BRANCH    EXIT,PREDIR90
.
          WRITE     HTMLFILE;"<script type=#"text/javascript#"> {":
.                             " alert(#"",WEBTITLE,"#");":
                             " location.href=#"",REDIRECT,"#";":
                             "}":
                             "</script>"
          CALL      CLOSHTML
          GOTO      PREDIR99
.
PREDIR90  DISPLAY   "*** Fifo Not Found ***"
.
PREDIR99  RETURN
.-------------------------------------------------------------------------------
.  Goes back 1 page
.-------------------------------------------------------------------------------
GOBACK00  CALL      OPENHTML
          BRANCH    EXIT,GOBACK99
          WRITE     HTMLFILE;"<script type=#"text/javascript#"> {":
                             "    alert(#"",WEBTITLE,"#");":
                             "    self.close();":
                             "    opener.history.go(-1);":
                             "}":
                             "</script>"
          CALL      CLOSHTML
GOBACK99  RETURN
.------------------------------------------------------------
. Open Files and Initialize Variables
.------------------------------------------------------------
INIT0000  OPEN      WEBRDTA1,"webrdtaf"
          OPEN      WEBRGMA1,"webrgmaf"
          OPEN      EMRLOCA2,"emrlocaf"
          OPEN      EMRSITA1,"emrsitaf"
          OPEN      FMSCHQA1,"fmschqaf"
          OPEN      WEBRTMA1,"webrtmaf"
          OPEN      WEBRURA1,"webruraf"
          OPEN      ALLREFA1,"allrefaf"
          OPEN      ACCAUDA1,"accaudaf"
          OPEN      DISMASA1,"dismasaf"
          OPEN      ALLDEPA1,"alldepaf"
          OPEN      BOKRC1A1,"bokrc1af"
          OPEN      IBAGSTA1,"ibagstaf"
          OPEN      IBATMHA1,"ibatmhaf"           * CAR 198035
          OPEN      IBALPCA1,"ibalpcaf"
          OPEN      PATCODE1,"patcodes"
          OPEN      PATCODE2,"patcodes"
          OPEN      PATCODE3,"patcodes"
          OPEN      PATCMXA1,"patcmxaf"
          OPEN      PATCMXA2,"patcmxaf"
          OPEN      PATCTFA1,"patctfaf"
          OPEN      PATCTFA2,"patctfaf"
          OPEN      PATMESG1,"patmesgf"
          OPEN      PATMI1A1,"patmi1af"
          OPEN      PATLETR2,"patletrf"
          OPEN      CONTROLF,"controlf"
          OPEN      IBASPOL1,"ibaspolf"
          OPEN      IBAPRTA1,"ibaprtaf"
          OPEN      IBADPTA1,"ibadptaf"
          OPEN      IBAPDDA2,"ibapddaf"
          OPEN      IBAPDFA1,"ibapdfaf"
          OPEN      IBABASA1,"ibabasaf"
          OPEN      PATDO1A1,"patdo1af"
          OPEN      PATHGRP1,"pathgrpf"
          OPEN      PATFLET2,"patfltrf"
          OPEN      PATFN1A1,"patfn1af"
          OPEN      PATICDG1,"paticdgf"
          OPEN      PATITEM1,"patitemn"
          OPEN      PATIN1A1,"patin1af"
          OPEN      PATNURS1,"patnursm"
          OPEN      PATTFEE1,"pattfeef"
          OPEN      PATWR1A7,"patwr1af"
          OPEN      PATVISA1,"patvisaf"
          OPEN      PMSVX1A1,"pmsvx1af"
          OPEN      PMSEVTA1,"pmsevtaf"
          OPEN      PMSHCPA1,"pmshcpaf"
          OPEN      PMSPTHA1,"pmspthaf"
          OPEN      MLTSECA1,"mltsecaf"
          OPEN      MLTSITA1,"mltsitaf"
          OPEN      MRTLOCA1,"mrtlocaf"
          OPEN      MRTSTFA1,"mrtstfaf"
          OPEN      OUTSITA1,"outsitaf"
          OPEN      OPRNURA1,"oprnuraf"
          OPEN      OPROPRA1,"opropraf"
          OPEN      RCPCIDA1,"rcpcidaf"
          OPEN      RCPREGA1,"rcpregaf"                                *I-59171
          OPEN      WATEXTA1,"watextaf"
...          OPEN      PRIDEBT2,"pridebtf"
          OPEN      PRIDOCT2,"pridoctf"
.          OPEN      PRIFLTR2,"prifltrf"
          OPEN      PRIALSA1,"prialsaf"
          OPEN      PRISECA2,"prisecaf"
          OPEN      PRIPRAC1,"pripracf"
          OPEN      PRIPRAC2,"pripracf"
          OPEN      IBACODE1,"ibacodef"
          OPEN      IBACODE2,"ibacodef"
          OPEN      PATDRGA1,"patdrgaf"
          OPEN      PATDRGA2,"patdrgaf"
          OPEN      PATDRGA3,"patdrgaf"
          OPEN      OBSPCTA1,"obspctaf"
          OPEN      WEBSCHA5,"webschaf"
          OPEN      WEBSTEA1,"websteaf"
          OPEN      WEBTPLA1,"webtplaf"
          OPEN      BOKLETR1,"bokletrf"
.
          MOVE      ZERO,OVRCD
          MOVE      ZERO,ALLVRINC
          TRAP      OVERCOND IF IO
          OPEN      ALLVREA1,"allvreaf"
          TRAPCLR   IO
          IF        OVRCD=1
            MOVE      ONE,ALLVRINC
          ENDIF
.
          MOVE      ZERO,OVRCD
          MOVE      ZERO,CCSSTINC
          TRAP      OVERCOND IF IO
          OPEN      CCSSTYA1,"ccsstyaf"
          TRAPCLR   IO
          IF        OVRCD=1
            MOVE      ONE,CCSSTINC
          ENDIF
.
          READ      CONTROLF,ZERO;*43,IBCNMHOS
          READ      CONTROLF,TWENTY;*193,PTCNDCLM
          READ      CONTROLF,FIFTY9;*27,CPERMTH
          READ      CONTROLF,EIGHTY;*250,PTCNHDPS
.
          MOVE      ZERO,OVRCD
          TRAP      OVERCOND IF IO
          OPEN      WATLETR2,"watletrf"
          TRAPCLR   IO
          MOVE      OVRCD,WATLETFL
.
          MOVE      "out",CFILEPRE
          CALL      OPNOUT00
.
          IF        IBCNMHOS=1
            OPEN      MLTCODA1,"mltcodaf"
            OPEN      MLTCODA2,"mltcodaf"
          ENDIF
.
INIT9999  RETURN
.------------------------------------------------------------
. Open Outpatient Files
.------------------------------------------------------------
OPNOUT00  PACK      CFNAME,CFILEPRE,FILCLIA1  * Get the name of the CLIA1 file
          OPEN      OUTCLIA1,CFNAME    
.
          PACK      CFNAME,CFILEPRE,FILCTYA2  * Get the name of the CTYA2 file
          OPEN      OUTCTYA2,CFNAME
.
          PACK      CFNAME,CFILEPRE,FILBOKA1  * Get the name of the BOKA1 file
          CLOSE     OUTBOKA1
          OPEN      OUTBOKA1,CFNAME           * Open the file
          PACK      CFNAME,CFILEPRE,FILBOKA2  * Get the name of the BOKA2 file
          CLOSE     OUTBOKA2
          OPEN      OUTBOKA2,CFNAME           * Open the file
          PACK      CFNAME,CFILEPRE,FILBOKA3  * Get the name of the BOKA3 file
          CLOSE     OUTBOKA3
          OPEN      OUTBOKA3,CFNAME           * Open the file
          PACK      CFNAME,CFILEPRE,FILBOKA4  * Get the name of the BOKA4 file
          CLOSE     OUTBOKA4
          OPEN      OUTBOKA4,CFNAME           * Open the file
          PACK      CFNAME,CFILEPRE,FILBOKA6  * Get the name of the BOKA6 file
          CLOSE     OUTBOKA6
          OPEN      OUTBOKA6,CFNAME           * Open the file
.
          OPEN      OUTLETR2,"outletrf"
.
OPNOUT99  RETURN
.
.*******************************************************************************
. OUTFIL00 - Check if the user id has an outpatienty site. If they do open
.            the correct outpatient files according to the site. If they do not
.            have a site make sure the default prefix of out is used to open
.            the files.
.*******************************************************************************
OUTFIL00  MATCH     SP70,WBSESIT             * Does the user have a site
          GOTO      OUTFIL50 IF NOT EQUAL
.
OUTFIL10  MATCH     "out",CFILEPRE           * Is out currently open
          IF        !@EQUAL
            MOVE      "out",OSTFILE          * open default prefix of out
            MOVE      OSTFILE,CFILEPRE       * Save Current File Prefix
            CALL      OPNOUT00               * Open out Outpatient Files
          ENDIF
.
          MOVE      ZERO,EXIT
          GOTO      OUTFIL99
.
OUTFIL50  MOVE      WBSESIT,KEY6
          CALL      RDSITA1
          BRANCH    OVRCD,OUTFIL90           * error invalid site code
.
          MATCH     OSTFILE,CFILEPRE         * Save Current File Prefix
          IF        !@EQUAL
            MOVE      OSTFILE,CFILEPRE       * Save Current File Prefix
            CALL      OPNOUT00               * Open prefixed Outpatient Files
          ENDIF
.
          MOVE      ZERO,EXIT
          GOTO      OUTFIL99
.
OUTFIL90  MOVE      "Outpatient Site Invalid",WEBTITLE
          CALL      WEBERR00
          MOVE      ONE,EXIT
.
OUTFIL99  RETURN
.------------------------------------------------------------
. Clear Parameters
.------------------------------------------------------------
CLRPAR00  MOVE      ZERO,OUTPTFLG
          MOVE      ZERO,REPORTNO
          MOVE      SP70,FLTUSRID
          MOVE      SP70,FLTPRGID
          MOVE      SP70,TEMPLATE
          MOVE      SP70,PRINTDPT
          MOVE      SP70,CLINICTY
          MOVE      ZERO,DISCANCL
          MOVE      SP70,LOADFNAM
          MOVE      SP70,LOADFNM1
          MOVE      SP70,REPORTID
          MOVE      SP70,SETDFPRG
          MOVE      SP70,SETDFPG2                                      *I-53346
          MOVE      SP70,SETDFREP
          MOVE      SP70,SETDFPR2                                      *I-53346
          MOVE      SP70,SETDFPR3                                      *I-53346
          MOVE      SP70,NEXTPAGE
          MOVE      SP70,EXTNUMBR
          MOVE      SP70,EXTRCTID
          MOVE      SP70,STATCODE
          MOVE      ZERO,LABELNUM
          MOVE      SP70,DOCODFLT
          MOVE      ZERO,VIEWTYPE
          MOVE      SP70,FRSTDATE
          MOVE      SP70,LASTDATE
          MOVE      SP70,VYEARMTH
          MOVE      SP70,SITECODE
          PACK      REDIRECT,SP70,SP70,SP70,SP70
          MOVE      SP70,UPDTTYPE
          MOVE      ZERO,VALDOPTN
          MOVE      SP70,VALDFRDT
          MOVE      SP70,VALDTODT
          MOVE      ZERO,EXCELCSV
          MOVE      Z70,PTCLM011
          MOVE      SP70,DELTEREP 
          MOVE      SP70,SHOWFUTR 
          MOVE      SP70,SHOWQUED 
.
          MOVE      SP70,SCHDCODE 
          MOVE      SP70,SCHDPERM 
          MOVE      SP70,SCHDRDAT 
          MOVE      SP70,SCHDREND 
          MOVE      SP70,SCHDDATE 
          MOVE      SP70,SCHDTIME
          MOVE      SP70,SCHDDESC
          MOVE      SP70,SCHDPRNT 
          MOVE      SP70,SUPERLEV
          MOVE      SP70,SHOWSITE
.
          MOVE      SP70,EXCEPTPB
          MOVE      SP70,EXCEPTMO
          MOVE      SP70,EXCEPTTU
          MOVE      SP70,EXCEPTWE
          MOVE      SP70,EXCEPTTH
          MOVE      SP70,EXCEPTFR
          MOVE      SP70,EXCEPTSA
          MOVE      SP70,EXCEPTSU
          MOVE      SP70,SCHDCMLN 
          MOVE      SP70,SCHDPGID 
          MOVE      ZERO,SCHDTYPE
          MOVE      ZERO,SCHDCOPY
          MOVE      SP70,SCHDPRIN
          MOVE      SP70,SCHDSPLN
          MOVE      SP70,SCHCLP01
          MOVE      SP70,SCHCLP02
          MOVE      SP70,SCHCLP03
          MOVE      SP70,SCHCLP04
          MOVE      SP70,SCHCLP05
          MOVE      SP70,SCHCLP06
          MOVE      SP70,SCHCLP07
          MOVE      SP70,SCHCLP08
          MOVE      SP70,SCHCLP09
.
          MOVE      SP70,CONFLD01 
          MOVE      SP70,CONFLD02 
          MOVE      SP70,CONFLD03
          MOVE      SP70,CONFLD04
          MOVE      SP70,CONFLD05
          MOVE      ZERO,CONFLD06
          MOVE      Z70,CONFLD07
          MOVE      Z70,CONFLD08
          MOVE      SP70,CONFLD09
          MOVE      SP70,CONFLD10
          MOVE      Z70,CONFLD11
          MOVE      Z70,CONFLD12
          MOVE      Z70,CONFLD13
          MOVE      Z70,CONFLD14
          MOVE      SP70,CONFLD15
          MOVE      Z70,CONFLD16
.
          MOVE      ZERO,NORECORD
          MOVE      ZERO,STARTNUM
.
          MOVE      ZERO,RSHCTR01  
          MOVE      ZERO,RSHCTR02 
          MOVE      SP70,RSHCTR03 
          MOVE      SP70,RSHCTR04 
          MOVE      SP70,RSHCTR05 
          MOVE      SP70,RSHCTR06 
          MOVE      SP70,RSHCTR07 
          MOVE      SP70,RSHCTR08 
          MOVE      SP70,RSHCTR09 
          MOVE      SP70,RSHCTR10 
          MOVE      SP70,RSHCTR11 
          MOVE      SP70,RSHCTR12 
          MOVE      SP70,RSHCTR13 
          MOVE      SP70,RSHCTR14 
          MOVE      SP70,RSHCTR15 
          MOVE      SP70,RSHCTR16 
          MOVE      SP70,RSHCTR17 
          MOVE      SP70,RSHCTR18 
          MOVE      SP70,RSHCTR19 
          MOVE      SP70,URNUMBER
.
          MOVE      SP70,IBAFLD01
          MOVE      ZERO,IBAFLD02
.
          MOVE      SP70,RSHIBA01 
          MOVE      ZERO,PTCNEFLG
.
          MOVE      SP70,SRNAME01 
          MOVE      SP70,GNNAME01
.
          MOVE      SP70,DCASEFLG
          MOVE      SP70,ADMSDATE
          MOVE      SP70,HLTHFUND
          MOVE      SP70,HLTHTABL
          MOVE      SP70,TFEECODE
          MOVE      SP70,CSMXCODE
          MOVE      SP70,CLMTCODE
          MOVE      SP70,BEDTCODE
          MOVE      SP70,ADMTCODE
          MOVE      SP70,ACCGFLAG
          MOVE      SP70,HOSPCODE
          MOVE      SP70,WARDOPTN
          MOVE      SP70,WARDCODE
          MOVE      SP70,MENUFLAG
          MOVE      SP70,EXPORTDE
.
          MOVE      ZERO,HFCODDSP
.
          MOVE      ZERO,MULTCNT
          MOVE      ZERO,MULTCNT1
          MOVE      ZERO,MULTCNT2
          MOVE      ZERO,MULTCNT3
          MOVE      ZERO,MULTCNT4
          MOVE      ZERO,MULTCNT5
.
          MOVE      ONE,F3
          WHILE     F3 <= 100 
            MOVE      SP70,ARRPT[F3]
            ADD       ONE,F3
          DO
.
          MOVE      ZERO,KEYSTCNT
          MOVE      ZERO,F3
CLRPAR10  ADD       ONE,F3       * Clear Key Strokes Array
          IF        F3<=150
            PACK      KEYSTARR[F3],SP70,SP70
            GOTO      CLRPAR10
          ENDIF
.
          MOVE      ZERO,SCHDPCNT
          MOVE      ZERO,F3
CLRPAR20  ADD       ONE,F3       
          IF        F3<=95
            PACK      SCHDPARR[F3],SP70,SP70
            GOTO      CLRPAR20
          ENDIF
.
          MOVE      ZERO,F3
CLRPAR25  ADD       ONE,F3
          IF        F3<=95
            PACK      SETDEFPN[F3],SP70,SP70
            GOTO      CLRPAR25
          ENDIF
.
          MOVE      ZERO,SCHDCCNT
          MOVE      ZERO,F3
CLRPAR30  ADD       ONE,F3       
          IF        F3<=95
            MOVE      ZERO,SCHDCARR[F3]
            GOTO      CLRPAR30
          ENDIF
.
          MOVE      ZERO,ADMISCNT
          MOVE      ZERO,F3
CLRPAR40  ADD       ONE,F3       
          IF        F3<=95
            PACK      ADMISARR[F3],SP70,SP70
            GOTO      CLRPAR40
          ENDIF
.
          MOVE      ZERO,URNUMCNT
          MOVE      ZERO,F3
CLRPAR45  ADD       ONE,F3       
          IF        F3<=95
            PACK      URNUMARR[F3],SP70,SP70
            GOTO      CLRPAR45
          ENDIF
.
          MOVE      ZERO,SUBSYCNT
          MOVE      ZERO,F3
CLRPAR50  ADD       ONE,F3       
          IF        F3<=95
            PACK      SUBSYARR[F3],SP70,SP70
            GOTO      CLRPAR50
          ENDIF
.
          MOVE      ZERO,STATNCNT
          MOVE      ZERO,F3
CLRPAR55  ADD       ONE,F3       
          IF        F3<=95
            PACK      STATNARR[F3],SP70,SP70
            GOTO      CLRPAR55
          ENDIF
.
          MOVE      ZERO,LABELCNT
          MOVE      ZERO,F3
CLRPAR60  ADD       ONE,F3       
          IF        F3<=95
            PACK      LABELARR[F3],SP70,SP70
            GOTO      CLRPAR60
          ENDIF
.
          MOVE      ZERO,FREECNT1
          MOVE      ZERO,F3
CLRPAR65  ADD       ONE,F3       
          IF        F3<=95
            PACK      FREEARR1[F3],SP70,SP70
            GOTO      CLRPAR65
          ENDIF
.
          MOVE      ZERO,FREECNT2
          MOVE      ZERO,F3
CLRPAR70  ADD       ONE,F3       
          IF        F3<=95
            PACK      FREEARR2[F3],SP70,SP70
            GOTO      CLRPAR70
          ENDIF
.
          MOVE      ZERO,FREECNT3
          MOVE      ZERO,F3
CLRPAR75  ADD       ONE,F3       
          IF        F3<=95
            PACK      FREEARR3[F3],SP70,SP70
            GOTO      CLRPAR75
          ENDIF
.
          MOVE      ZERO,FREECNT4
          MOVE      ZERO,F3
CLRPAR80  ADD       ONE,F3       
          IF        F3<=95
            PACK      FREEARR4[F3],SP70,SP70
            GOTO      CLRPAR80
          ENDIF
.
          MOVE      ZERO,FREECNT5
          MOVE      ZERO,F3
CLRPAR85  ADD       ONE,F3       
          IF        F3<=95
            PACK      FREEARR5[F3],SP70,SP70
            GOTO      CLRPAR85
          ENDIF
.
          MOVE      ZERO,FREECNT6
          MOVE      ZERO,F3
CLRPAR90  ADD       ONE,F3       
          IF        F3<=95
            PACK      FREEARR6[F3],SP70,SP70
            GOTO      CLRPAR90
          ENDIF
.
          MOVE      ZERO,FREECNT7
          MOVE      ZERO,F3
CLRPAR95  ADD       ONE,F3       
          IF        F3<=95
            PACK      FREEARR7[F3],SP70,SP70
            GOTO      CLRPAR95
          ENDIF
.
          MOVE      SP70,PATCATGY
          MOVE      SP70,PATCODEV
.
CLRPAR99  RETURN
.------------------------------------------------------------
. Set Parameters
.------------------------------------------------------------
SETPAR00  MATCH     "fltusrid=",QRYNAME
          IF        @EQUAL
            PACK      FLTUSRID,QRYDATA,SP70
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "fltprgid=",QRYNAME
          IF        @EQUAL
            PACK      FLTPRGID,QRYDATA,SP70
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "keystr",QRYNAME
          IF        @EQUAL
            MATCH     "Ignore",QRYDATA
            GOTO      SETPAR99 IF EQUAL
.
            IF        KEYSTCNT < 150
              ADD       ONE,KEYSTCNT
              PACK      KEYSTARR[KEYSTCNT],QRYDATA,SP70
            ENDIF
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "multiple",QRYNAME
          IF        @EQUAL
            MATCH     "Ignore",QRYDATA
            GOTO      SETPAR99 IF EQUAL
.
            IF        KEYSTCNT < 150 & MULTCNT < 99
              ADD       ONE,MULTCNT
              ADD       ONE,KEYSTCNT
              PACK      KEYSTARR[KEYSTCNT],MULTIPLE,QRYDATA,SP70
            ENDIF
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "multipl1",QRYNAME
          IF        @EQUAL
            MATCH     "Ignore",QRYDATA
            GOTO      SETPAR99 IF EQUAL
.
            IF        KEYSTCNT < 150 & MULTCNT1 < 99
              ADD       ONE,MULTCNT1
              ADD       ONE,KEYSTCNT
              PACK      KEYSTARR[KEYSTCNT],MULTIPL1,QRYDATA,SP70
            ENDIF
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "multipl2",QRYNAME
          IF        @EQUAL
            MATCH     "Ignore",QRYDATA
            GOTO      SETPAR99 IF EQUAL
.
            IF        KEYSTCNT < 150 & MULTCNT2 < 99
              ADD       ONE,MULTCNT2
              ADD       ONE,KEYSTCNT
              PACK      KEYSTARR[KEYSTCNT],MULTIPL2,QRYDATA,SP70
            ENDIF
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "multipl3",QRYNAME
          IF        @EQUAL
            MATCH     "Ignore",QRYDATA
            GOTO      SETPAR99 IF EQUAL
.
            IF        KEYSTCNT < 150 & MULTCNT3 < 99
              ADD       ONE,MULTCNT3
              ADD       ONE,KEYSTCNT
              PACK      KEYSTARR[KEYSTCNT],MULTIPL3,QRYDATA,SP70
            ENDIF
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "multipl4",QRYNAME
          IF        @EQUAL
            MATCH     "Ignore",QRYDATA
            GOTO      SETPAR99 IF EQUAL
.
            IF        KEYSTCNT < 150 & MULTCNT4 < 99
              ADD       ONE,MULTCNT4
              ADD       ONE,KEYSTCNT
              PACK      KEYSTARR[KEYSTCNT],MULTIPL4,QRYDATA,SP70
            ENDIF
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "multipl5",QRYNAME
          IF        @EQUAL
            MATCH     "Ignore",QRYDATA
            GOTO      SETPAR99 IF EQUAL
.
            IF        KEYSTCNT < 150 & MULTCNT5 < 99
              ADD       ONE,MULTCNT5
              ADD       ONE,KEYSTCNT
              PACK      KEYSTARR[KEYSTCNT],MULTIPL5,QRYDATA,SP70
            ENDIF
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "reportno=",QRYNAME
          IF        @EQUAL
            MOVE      QRYDATA,REPORTNO
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "delterep=",QRYNAME
          IF        @EQUAL
            MOVE      QRYDATA,DELTEREP
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "showfutr=",QRYNAME
          IF        @EQUAL
            MOVE      QRYDATA,SHOWFUTR
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "showqued=",QRYNAME
          IF        @EQUAL
            MOVE      QRYDATA,SHOWQUED
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "outptflg=",QRYNAME
          IF        @EQUAL
            MOVE      QRYDATA,OUTPTFLG
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "loadfnam=",QRYNAME
          IF        @EQUAL
            MOVE      QRYDATA,LOADFNAM
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "loadfnm1=",QRYNAME
          IF        @EQUAL
            MOVE      QRYDATA,LOADFNM1
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "setdfprg=",QRYNAME
          IF        @EQUAL
            MOVE      QRYDATA,SETDFPRG
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "setdfrep=",QRYNAME
          IF        @EQUAL
            MOVE      QRYDATA,SETDFREP
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "setdfpg2=",QRYNAME                                *I-53346
          IF        @EQUAL
            MOVE      QRYDATA,SETDFPG2
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "setdfpr2=",QRYNAME                                *I-53346
          IF        @EQUAL
            MOVE      QRYDATA,SETDFPR2
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "setdfpr3=",QRYNAME                                *I-53346
          IF        @EQUAL
            MOVE      QRYDATA,SETDFPR3
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "confld",QRYNAME
          IF        @EQUAL
            CALL      SETCFL00
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "rpt",QRYNAME
          IF        @EQUAL
            CALL      STRPT000
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "reportid=",QRYNAME
          IF        @EQUAL
            MOVE      QRYDATA,REPORTID
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "updttype=",QRYNAME
          IF        @EQUAL
            MOVE      QRYDATA,UPDTTYPE
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "descchng=",QRYNAME
          IF        @EQUAL
            MOVE      QRYDATA,DESCCHNG
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "valdoptn=",QRYNAME
          IF        @EQUAL
            MOVE      QRYDATA,VALDOPTN
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "valdfrdt=",QRYNAME
          IF        @EQUAL
            MOVE      QRYDATA,VALDFRDT
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "valdtodt=",QRYNAME
          IF        @EQUAL
            MOVE      QRYDATA,VALDTODT
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "nextpage=",QRYNAME
          IF        @EQUAL
            MOVE      QRYDATA,NEXTPAGE
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "extnumbr=",QRYNAME
          IF        @EQUAL
            MOVE      QRYDATA,EXTNUMBR
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "redirect=",QRYNAME
          IF        @EQUAL
            MOVE      QRYDATA,REDIRECT
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "schdcode=",QRYNAME
          IF        @EQUAL
            MOVE      QRYDATA,SCHDCODE
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "schddate=",QRYNAME
          IF        @EQUAL
            PACK      QRYDATA,QRYDATA,SP70
            MATCH     SP70,QRYDATA
            IF        !@EQUAL
              UNPACK    QRYDATA,CDAY,KEY1,MTHNAM3,KEY1,CCENT,CYEAR
              CALL      SETMTH00        * Set CMON from MTHNAM3
              PACK      SCHDDATE,CCENT,CYEAR,CMON,CDAY
              REP       " 0",SCHDDATE
            ENDIF
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "schdperm=",QRYNAME
          IF        @EQUAL
            PACK      QRYDATA,QRYDATA,SP70
            MOVE      QRYDATA,SCHDPERM
          ENDIF
.
          MATCH     "schdrdat=",QRYNAME
          IF        @EQUAL
            PACK      QRYDATA,QRYDATA,SP70
            MATCH     SP70,QRYDATA
            IF        !@EQUAL
              MOVE      QRYDATA,SCHDRDAT
            ENDIF
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "schdrend=",QRYNAME
          IF        @EQUAL
            PACK      QRYDATA,QRYDATA,SP70
            MATCH     SP70,QRYDATA
            IF        !@EQUAL
              UNPACK    QRYDATA,CDAY,KEY1,MTHNAM3,KEY1,CCENT,CYEAR
              CALL      SETMTH00        * Set CMON from MTHNAM3
              PACK      SCHDREND,CCENT,CYEAR,CMON,CDAY
              REP       " 0",SCHDREND
            ENDIF
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "schdtime=",QRYNAME
          IF        @EQUAL
            PACK      QRYDATA,QRYDATA,SP70
            MATCH     SP70,QRYDATA
            IF        !@EQUAL
              MOVE      QRYDATA,SCHDTIME   * Schedule Time (Blank for Immediate)
            ENDIF
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "schddesc=",QRYNAME
          IF        @EQUAL
            MOVE      QRYDATA,SCHDDESC
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "schdtype=",QRYNAME
          IF        @EQUAL
            MOVE      QRYDATA,SCHDTYPE
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "schdcop",QRYNAME
          IF        @EQUAL
            SQUEEZE   QRYDATA
            MOVE      QRYDATA,SCHDCOPY
            COMPARE   ZERO,SCHDPCNT
            IF        @EQUAL
              ADD       ONE,SCHDPCNT
            ENDIF
.
            MOVE      QRYDATA,SCHDCARR[SCHDPCNT]
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "schdprin=",QRYNAME
          IF        @EQUAL
            MOVE      QRYDATA,SCHDPRIN
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "schdprn",QRYNAME
          IF        @EQUAL
            MOVE      QRYDATA,SCHDPRNT
            ADD       ONE,SCHDPCNT
            PACK      SCHDPARR[SCHDPCNT],QRYDATA,SP70
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "setdefp",QRYNAME
          IF        @EQUAL
            COMPARE   ZERO,SCHDPCNT
            IF        @EQUAL
              ADD       ONE,SCHDPCNT
            ENDIF
.
            PACK      SETDEFPN[SCHDPCNT],QRYDATA,SP70
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "schdcmln=",QRYNAME
          IF        @EQUAL
            MOVE      QRYDATA,SCHDCMLN
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "exceptpb=",QRYNAME
          IF        @EQUAL
            PACK      EXCEPTPB,QRYDATA,SP70
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "exceptmo=",QRYNAME
          IF        @EQUAL
            PACK      EXCEPTMO,QRYDATA,SP70
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "excepttu=",QRYNAME
          IF        @EQUAL
            PACK      EXCEPTTU,QRYDATA,SP70
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "exceptwe=",QRYNAME
          IF        @EQUAL
            PACK      EXCEPTWE,QRYDATA,SP70
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "exceptth=",QRYNAME
          IF        @EQUAL
            PACK      EXCEPTTH,QRYDATA,SP70
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "exceptfr=",QRYNAME
          IF        @EQUAL
            PACK      EXCEPTFR,QRYDATA,SP70
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "exceptsa=",QRYNAME
          IF        @EQUAL
            PACK      EXCEPTSA,QRYDATA,SP70
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "exceptsu=",QRYNAME
          IF        @EQUAL
            PACK      EXCEPTSU,QRYDATA,SP70
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "schdpgid=",QRYNAME
          IF        @EQUAL
            MOVE      QRYDATA,SCHDPGID
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "schdspln=",QRYNAME
          IF        @EQUAL
            MOVE      QRYDATA,SCHDSPLN
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "rshctr",QRYNAME
          IF        @EQUAL
            CALL      STSCH000
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "ibafld",QRYNAME
          IF        @EQUAL
            CALL      IBAFL000
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "rshiba",QRYNAME
          IF        @EQUAL
            CALL      STIBA000
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "schclp",QRYNAME
          IF        @EQUAL
            CALL      STUNX000
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "extrctid=",QRYNAME
          IF        @EQUAL
            MOVE      QRYDATA,EXTRCTID
            GOTO      SETPAR99
          ENDIF

          MATCH     "printdpt=",QRYNAME
          IF        @EQUAL
            MOVE      QRYDATA,PRINTDPT
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "clinicty=",QRYNAME
          IF        @EQUAL
            MOVE      QRYDATA,CLINICTY
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "statcode=",QRYNAME
          IF        @EQUAL
            MOVE      QRYDATA,STATCODE
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "labelnum=",QRYNAME
          IF        @EQUAL
            MOVE      QRYDATA,LABELNUM
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "docodflt=",QRYNAME
          IF        @EQUAL
            MOVE      QRYDATA,DOCODFLT
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "viewtype=",QRYNAME
          IF        @EQUAL
            MOVE      QRYDATA,VIEWTYPE
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "frstdate=",QRYNAME 
          IF        @EQUAL
            MOVE      QRYDATA,FRSTDATE
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "lastdate=",QRYNAME
          IF        @EQUAL
            MOVE      QRYDATA,LASTDATE
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "vyearmth=",QRYNAME
          IF        @EQUAL
            MOVE      QRYDATA,VYEARMTH
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "sitecode=",QRYNAME
          IF        @EQUAL
            MOVE      QRYDATA,SITECODE
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "ptcneflg=",QRYNAME
          IF        @EQUAL
            MOVE      QRYDATA,PTCNEFLG
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "urnumber=",QRYNAME
          IF        @EQUAL
            MOVE      QRYDATA,URNUMBER
            ADD       ONE,URNUMCNT
            PACK      URNUMARR[URNUMCNT],QRYDATA,SP70
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "admissno=",QRYNAME
          IF        @EQUAL
            IF        ADMISCNT<=94
              ADD       ONE,ADMISCNT
              PACK      ADMISARR[ADMISCNT],QRYDATA,SP70
            ENDIF
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "subsysky=",QRYNAME
          IF        @EQUAL
            PACK      SUBSYARR[ADMISCNT],QRYDATA,SP70
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "statnco",QRYNAME
          IF        @EQUAL
            COMPARE   ZERO,SCHDPCNT
            IF        @EQUAL
              ADD       ONE,SCHDPCNT
            ENDIF
.
            PACK      STATNARR[SCHDPCNT],QRYDATA,SP70
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "labelty",QRYNAME
          IF        @EQUAL
            COMPARE   ZERO,SCHDPCNT
            IF        @EQUAL
              ADD       ONE,SCHDPCNT
            ENDIF
.
            PACK      LABELARR[SCHDPCNT],QRYDATA,SP70
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "freetxt1=",QRYNAME
          IF        @EQUAL
            PACK      FREEARR1[ADMISCNT],QRYDATA,SP70
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "freetxt1=",QRYNAME
          IF        @EQUAL
            PACK      FREEARR2[ADMISCNT],QRYDATA,SP70
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "freetxt3=",QRYNAME
          IF        @EQUAL
            PACK      FREEARR3[ADMISCNT],QRYDATA,SP70
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "freetxt4=",QRYNAME
          IF        @EQUAL
            PACK      FREEARR4[ADMISCNT],QRYDATA,SP70
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "freetxt5=",QRYNAME
          IF        @EQUAL
            PACK      FREEARR5[ADMISCNT],QRYDATA,SP70
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "freetxt6=",QRYNAME
          IF        @EQUAL
            PACK      FREEARR6[ADMISCNT],QRYDATA,SP70
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "freetxt7=",QRYNAME
          IF        @EQUAL
            PACK      FREEARR7[ADMISCNT],QRYDATA,SP70
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "srname01=",QRYNAME
          IF        @EQUAL
            MOVE      QRYDATA,SRNAME01
            PACK      SRNAME01,SRNAME01,SP70
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "gnname01=",QRYNAME
          IF        @EQUAL
            MOVE      QRYDATA,GNNAME01
            PACK      GNNAME01,GNNAME01,SP70
            GOTO      SETPAR99
          ENDIF
.

          MATCH     "dcaseflg=",QRYNAME
          IF        @EQUAL
            MOVE      QRYDATA,DCASEFLG
            PACK      DCASEFLG,DCASEFLG,SP70
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "admsdate=",QRYNAME
          IF        @EQUAL
            MOVE      QRYDATA,ADMSDATE
            PACK      ADMSDATE,ADMSDATE,SP70
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "hlthfund=",QRYNAME
          IF        @EQUAL
            MOVE      QRYDATA,HLTHFUND
            PACK      HLTHFUND,HLTHFUND,SP70
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "hlthtabl=",QRYNAME
          IF        @EQUAL
            MOVE      QRYDATA,HLTHTABL
            PACK      HLTHTABL,HLTHTABL,SP70
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "tfeecode=",QRYNAME
          IF        @EQUAL
            MOVE      QRYDATA,TFEECODE
            PACK      TFEECODE,TFEECODE,SP70
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "csmxcode=",QRYNAME
          IF        @EQUAL
            MOVE      QRYDATA,CSMXCODE
            PACK      CSMXCODE,CSMXCODE,SP70
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "clmtcode=",QRYNAME
          IF        @EQUAL
            MOVE      QRYDATA,CLMTCODE
            PACK      CLMTCODE,CLMTCODE,SP70
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "bedtcode=",QRYNAME
          IF        @EQUAL
            MOVE      QRYDATA,BEDTCODE
            PACK      BEDTCODE,BEDTCODE,SP70
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "admtcode=",QRYNAME
          IF        @EQUAL
            MOVE      QRYDATA,ADMTCODE
            PACK      ADMTCODE,ADMTCODE,SP70
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "accgflag=",QRYNAME
          IF        @EQUAL
            MOVE      QRYDATA,ACCGFLAG
            PACK      ACCGFLAG,ACCGFLAG,SP70
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "norecord=",QRYNAME
          IF        @EQUAL
            MOVE      QRYDATA,NORECORD
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "startnum=",QRYNAME
          IF        @EQUAL
            MOVE      QRYDATA,STARTNUM
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "hospcode=",QRYNAME
          IF        @EQUAL
            PACK      HOSPCODE,QRYDATA,SP70
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "wardoptn=",QRYNAME
          IF        @EQUAL
            PACK      WARDOPTN,QRYDATA,SP70
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "wardcode=",QRYNAME
          IF        @EQUAL
            PACK      WARDCODE,QRYDATA,SP70
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "superlev=",QRYNAME
          IF        @EQUAL
            PACK      SUPERLEV,QRYDATA,SP70
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "showsite=",QRYNAME
          IF        @EQUAL
            PACK      SHOWSITE,QRYDATA,SP70
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "menuflag=",QRYNAME
          IF        @EQUAL
            MOVE      QRYDATA,MENUFLAG
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "exportde=",QRYNAME
          IF        @EQUAL
            MOVE      QRYDATA,EXPORTDE
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "labeldet=",QRYNAME
          IF        @EQUAL
            MOVE      QRYDATA,LABELDET
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "showeror=",QRYNAME
          IF        @EQUAL
            MOVE      QRYDATA,SHOWEROR
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "patcatgy=",QRYNAME
          IF        @EQUAL
            PACK      PATCATGY,QRYDATA,SP70
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "patcodev=",QRYNAME
          IF        @EQUAL
            PACK      PATCODEV,QRYDATA,SP70
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "excelcsv=",QRYNAME
          IF        @EQUAL
            MOVE      QRYDATA,EXCELCSV
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "ptclm011=",QRYNAME
          IF        @EQUAL
            MOVE      QRYDATA,PTCLM011
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "hfcoddsp=",QRYNAME    * Health Fund Contract Code Display         
          IF        @EQUAL
            MOVE      QRYDATA,HFCODDSP
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "discancl=",QRYNAME    * Display Cancel Button indicator           
          IF        @EQUAL
            MOVE      QRYDATA,DISCANCL
            GOTO      SETPAR99
          ENDIF
.

SETPAR99  RETURN
.-------------------------------------------------------------------------------
.   Set Parameters for Option 8 
.-------------------------------------------------------------------------------
SETCFL00  UNPACK    QRYNAME,KEY6,KEY2
          MOVE      ZERO,F2
          MOVE      KEY2,F2
          STORE     QRYDATA,F2,CONFLD01,CONFLD02,CONFLD03,CONFLD04,CONFLD05:
                               CONFLD06,CONFLD07,CONFLD08,CONFLD09,CONFLD10:
                               CONFLD11,CONFLD12,CONFLD13,CONFLD14,CONFLD15:
                               CONFLD16
          RETURN
.----------------------------------------------------------------
. Set parameters for reports to be removed                      
.----------------------------------------------------------------
STRPT000  MOVE      ZERO,EXIT
          UNPACK    QRYNAME,KEY5,KEY3
          MOVE      KEY3,F3
          RESET     QRYDATA
          MATCH     SP70,QRYDATA
          GOTO      STRPT999 IF EQUAL
          MOVE      QRYDATA,ARRPT[F3]
STRPT999  RETURN
+
.-------------------------------------------------------------------------------
.   Set Parameters for Option 2 - Schedule Item Display & Maintenance 
.-------------------------------------------------------------------------------
STSCH000  UNPACK    QRYNAME,KEY6,KEY2
          MOVE      ZERO,F2
          MOVE      KEY2,F2
          BRANCH    F2,STSCH001,STSCH002,STSCH003,STSCH004,STSCH005:
                       STSCH006,STSCH007,STSCH008,STSCH009,STSCH010:
                       STSCH011,STSCH012,STSCH013,STSCH014,STSCH015:
                       STSCH016,STSCH017,STSCH018,STSCH019
.
          GOTO      STSCH999
.
STSCH001  SQUEEZE   QRYDATA
          MOVE      QRYDATA,RSHCTR01
          GOTO      STSCH999
.
STSCH002  MOVE      QRYDATA,RSHCTR02
          GOTO      STSCH999
.
STSCH003  MOVE      QRYDATA,RSHCTR03
          GOTO      STSCH999
.
STSCH004  MOVE      QRYDATA,RSHCTR04
          GOTO      STSCH999
.
STSCH005  MOVE      QRYDATA,RSHCTR05
          GOTO      STSCH999
.
STSCH006  MOVE      QRYDATA,RSHCTR06
          GOTO      STSCH999
.
STSCH007  MOVE      QRYDATA,RSHCTR07
          GOTO      STSCH999
.
STSCH008  MOVE      QRYDATA,RSHCTR08
          GOTO      STSCH999
.
STSCH009  MOVE      QRYDATA,RSHCTR09
          GOTO      STSCH999
.
STSCH010  MOVE      QRYDATA,RSHCTR10
          GOTO      STSCH999
.
STSCH011  SQUEEZE   QRYDATA
          MOVE      QRYDATA,F3
          MOVE      F3,RSHCTR11
          GOTO      STSCH999
.
STSCH012  SQUEEZE   QRYDATA
          MOVE      QRYDATA,F3
          MOVE      F3,RSHCTR12
          GOTO      STSCH999
.
STSCH013  MOVE      QRYDATA,RSHCTR13
          GOTO      STSCH999
.
STSCH014  MOVE      QRYDATA,RSHCTR14
          GOTO      STSCH999
.
STSCH015  MOVE      QRYDATA,RSHCTR15
          GOTO      STSCH999
.
STSCH016  MOVE      QRYDATA,RSHCTR16
          GOTO      STSCH999
.
STSCH017  MOVE      QRYDATA,RSHCTR17
          GOTO      STSCH999
.
STSCH018  MOVE      QRYDATA,RSHCTR18
          GOTO      STSCH999
.
STSCH019  MOVE      QRYDATA,RSHCTR19
          GOTO      STSCH999
.
STSCH999  RETURN
.-------------------------------------------------------------------------------
.   Set Parameters for IBA Key field
.-------------------------------------------------------------------------------
IBAFL000  UNPACK    QRYNAME,KEY6,KEY2
          MOVE      ZERO,F2
          MOVE      KEY2,F2
          BRANCH    F2,IBAFL001,IBAFL002
.
IBAFL001  MOVE      QRYDATA,IBAFLD01       * IBA Password
          GOTO      STIBA999
.
IBAFL002  SQUEEZE   QRYDATA
          MOVE      QRYDATA,IBAFLD02       * IBA Key
          GOTO      STIBA999
.
IBAFL999  RETURN
.-------------------------------------------------------------------------------
.   Set Parameters for IBA parameter Item Display & Maintenance 
.-------------------------------------------------------------------------------
STIBA000  UNPACK    QRYNAME,KEY6,KEY2
          MOVE      ZERO,F2
          MOVE      KEY2,F2
          BRANCH    F2,STIBA001
.
STIBA001  MOVE      QRYDATA,RSHIBA01
          GOTO      STIBA999
.
STIBA999  RETURN
.-------------------------------------------------------------------------------
.   Set Unix Parameters for Option 4 - Add Program to Schedule 
.-------------------------------------------------------------------------------
STUNX000  UNPACK    QRYNAME,KEY6,KEY2
          MOVE      KEY2,F2
          BRANCH    F2,STUNX001,STUNX002,STUNX003,STUNX004,STUNX005,STUNX006:
                       STUNX007,STUNX008,STUNX009
.
          GOTO      STUNX999
.
STUNX001  MOVE      QRYDATA,SCHCLP01 
          GOTO      STUNX999
.
STUNX002  MOVE      QRYDATA,SCHCLP02
          GOTO      STUNX999
.
STUNX003  MOVE      QRYDATA,SCHCLP03
          GOTO      STUNX999
.
STUNX004  MOVE      QRYDATA,SCHCLP04
          GOTO      STUNX999
.
STUNX005  MOVE      QRYDATA,SCHCLP05
          GOTO      STUNX999
.
STUNX006  MOVE      QRYDATA,SCHCLP06
          GOTO      STUNX999
.
STUNX007  MOVE      QRYDATA,SCHCLP07
          GOTO      STUNX999
.
STUNX008  MOVE      QRYDATA,SCHCLP08
          GOTO      STUNX999
.
STUNX009  MOVE      QRYDATA,SCHCLP09
          GOTO      STUNX999
.
STUNX999  RETURN
.------------------------------------------------------------
. Output List of Reports for a User
.------------------------------------------------------------
REPLST00  CALL      CURPER00   * Current Date
          CALL      CALCDT00   * Calculate Next and Last Period Dates
.
          MATCH     SP70,REPORTID
          GOTO      REPLST80 IF EQUAL
.
          CALL      REPHED00    * Process Report Program Template
          BRANCH    EXIT,REPLST99
.
          GOTO      REPLST90
.
REPLST80  MATCH     "PATSCH88",FLTPRGID     * Filter by Program
          IF        @EQUAL
            MOVE      "Fax Process Schedule List",WEBTITLE
          ELSE
            MOVE      "Scheduled Process List",WEBTITLE
          ENDIF
.
          CALL      WEBHED00    * Heading
          BRANCH    EXIT,REPLST99
.
REPLST90  CALL      WEBBOD00    * Templated Results
.
          CALL      WEBEND00    * End of Page
.
REPLST99  RETURN
.------------------------------------------------------------
. Report Template Process
.------------------------------------------------------------
REPHED00  MOVE      REPORTID,UPPRPTID 
          REP       UPPLOW,UPPRPTID
.
          MOVE      TEMPLATE,F3
          MOVE      F3,KEY3
          REP       " 0",KEY3
.
REPHED10  PACK      KEY13,UPPRPTID,DZERO,KEY3,SP70
          CALL      RDWBTP1
          BRANCH    OVRCD,REPHED30
. 
          MATCH     SP70,WBTPLEV        * Check template security        
          GOTO      REPHED30 IF EQUAL   
.
          PACK      KEY18,WBSEUID,UPPRPTID,SP70
          CALL      RDWBST1
          BRANCH    OVRCD,REPHED80
.
          MOVE      WBSTLEV,CHCKUSL
          MATCH     SP70,CHCKUSL        * Check user security
          GOTO      REPHED80 IF EQUAL
.
          MOVE      WBTPLEV,CHCKTSL     * Compare User/Template SL 
          COMPARE   CHCKTSL,WBSTLEV
	  GOTO      REPHED90 IF LESS
.
REPHED30  CLEAR     WBTPFIL
          APPEND    REPORTID,WBTPFIL
          APPEND    KEY3,WBTPFIL
          APPEND    ".html",WBTPFIL
          RESET     WBTPFIL
          PACK      TEMPLFIL,TEMPCDIR,WBTPFIL,SP70
          MOVE      ONE,WRPTSECT
          MOVE      ZERO,EXIT
          CALL      WEBHED00
          GOTO      REPHED99
.
REPHED80  MOVE      "User Security Level not present",WEBTITLE
          CALL      WEBERR00
          MOVE      ONE,EXIT
          GOTO      REPHED99
.
REPHED90  CLEAR     WEBTITLE
          APPEND    "Security Inadequate",WEBTITLE
          CALL      WEBERR00
          MOVE      ONE,EXIT
.
REPHED99  RETURN
.------------------------------------------------------------
. Display Spool File
.------------------------------------------------------------
SHWREP00  PACK      KEY8,SCHDCODE,SP70     
          CALL      RDWBSC1
          BRANCH    OVRCD,SHWREP95
.
          MATCH     SP70,WBSCSPOO
          GOTO      SHWREP96 IF EQUAL
.
.  Using Viewtype to trigger display using PHP script
.
          MATCH     "1",VIEWTYPE
          GOTO      SHWREP30 IF EQUAL
.
          BRANCH    WBSCOTYP,SHWREP10,SHWREP20
.
SHWREP10  COMPARE   ZERO,EXCELCSV
          GOTO      SHWREP15 IF EQUAL
.
          UNPACK    WBSCSPOO,KEY8
          MOVE      ".csv",KEY4
          PACK      KEY12,KEY8,KEY4,SP70
.
          MOVE      ZERO,OVRCD
          TRAP      OVERCOND IF IO
          OPEN      SPLTFILE,KEY12
          TRAPCLR   IO
          BRANCH    OVRCD,SHWREP15
          MOVE      "005",TEMPLATE
          GOTO      SHWREP16
.
SHWREP15  MOVE      ZERO,OVRCD
          TRAP      OVERCOND IF IO
          OPEN      SPLTFILE,WBSCSPOO
          TRAPCLR   IO
          BRANCH    OVRCD,SHWREP96
.
SHWREP16  MOVE      WBSCDSRP,WEBTITLE
          CALL      WEBHED00
          BRANCH    EXIT,SHWREP99
          CALL      WEBBOD00
          CALL      WEBEND00
          GOTO      SHWREP99
.
SHWREP20  STRIP     RSCNROD
          STRIP     WBSCSPOO
          REP       "/.",WBSCSPOO
          PACK      FILNAM,HTMLDIR,WEBPID,HTMLEXT,SP70
          SQUEEZE   FILNAM
          PACK      CMDLINE,CMDVIEW,SP1,RSCNROD,WBSCSPOO,SP1,FILNAM,SP70
          EXECUTE   CMDLINE,TASKID
          MOVE      ZERO,EXIT               * To go to next page
          GOTO      SHWREP99
.
SHWREP30  MOVE      SP70,SPOOLDIR
          GETENV    "TBSPOOL",SPOOLDIR           * Get TBSPOOL
          PACK      SPOOLDIR,SPOOLDIR,SP70
.
          MATCH     SP70,SPOOLDIR
          IF        !@EQUAL
            STRIP     SPOOLDIR                   * Append / to TBSPOOL
            ENDSET    SPOOLDIR
            APPEND    SLASH,SPOOLDIR
            RESET     SPOOLDIR
          ELSE
            MOVE      RSCNROD,SPOOLDIR           * Use report output dir
          ENDIF
.
          STRIP     SPOOLDIR
          STRIP     WBSCSPOO
          REP       "/.",WBSCSPOO
          PACK      FILNAM,HTMLDIR,WEBPID,HTMLEXT,SP70
          SQUEEZE   FILNAM
          PACK      CMDLINE,CMDVIEW2,SP1,SPOOLDIR,WBSCSPOO,SP1,FILNAM,SP70
          EXECUTE   CMDLINE,TASKID
          MOVE      ZERO,EXIT               * To go to next page
          GOTO      SHWREP99
.
SHWREP95  MOVE      "Invalid Report Number",WEBTITLE
          CALL      WEBERR00
          GOTO      SHWREP99
.
SHWREP96  MOVE      "Spool File Not Available",WEBTITLE
          CALL      WEBERR00
          GOTO      SHWREP99
.
SHWREP99  RETURN
.
.------------------------------------------------------------
. Schedule Item: Display,Update,Delete
.------------------------------------------------------------
WEBSCH00  RESET     UPDTTYPE
          MATCH     SP1,UPDTTYPE
          GOTO      WEBSCH60 IF EQUAL
.
          MATCH     "U",UPDTTYPE    * Update
          GOTO      WEBSCH10 IF EQUAL
.
          MATCH     "D",UPDTTYPE    * Delete
          GOTO      WEBSCH20 IF EQUAL 
.
          MATCH     "P",UPDTTYPE    * Print 
          GOTO      WEBSCH30 IF EQUAL
.
          MATCH     "M",UPDTTYPE    * Mark As Permanent Spool File
          GOTO      WEBSCH40 IF EQUAL
.
          MATCH     "L",UPDTTYPE    * Label and Form Printing     
          GOTO      WEBSCH45 IF EQUAL
.
          MATCH     "B",UPDTTYPE    * Bulk remove reports    
          GOTO      WEBSCH70 IF EQUAL
.
          GOTO      WEBSCH90
.
.         ************ UPDATE FORMACTION **********
.
WEBSCH10  PACK      KEY8,SCHDCODE,SP70     
          CALL      RDWBSC1
          BRANCH    OVRCD,WEBSCH91
          CALL      CHKSCH00      * Checks mandatory fields
          BRANCH    EXIT,WEBSCH99
.
          PACK      KEY8,SCHDCODE,SP70  
          CALL      RLWBSC1      * Read lock record
.
          MATCH     "1",DESCCHNG
          IF        !@EQUAL
            CALL      SCHSAV00     * Sav data
            MOVE      SCHDDESC,WBSCDSRP
          ELSE
            MOVE      SCHDDESC,WBSCDSRP
            MOVE      SCHDPERM,WBSCPERM 
          ENDIF
.
          MOVE      SCHDCOPY,WBSCNCOP
.
          CALL      UPWBSC1      * Update Record
          CALL      UUWBSC1      * Unlock Record
.  
          MOVE      ZERO,EXIT
          GOTO      WEBSCH99
.
.         ************ DELETE FORMACTION **********
.
WEBSCH20  PACK      KEY8,SCHDCODE,SP70
          CALL      RDWBSC1
          BRANCH    OVRCD,WEBSCH91
          PACK      KEY8,SCHDCODE,SP70  
          CALL      DEWBSC1      * Delete Record
.
          PACK      KEY80,RSCNRCD,WBSCSCHD,KEYSTKNM 
          SQUEEZE   KEY80
          PREP      KEYSTKFL,KEY80     * Delete Key Strokes File
          CLOSE     KEYSTKFL
.
          MOVE      ZERO,OVRCD
          TRAP      OVERCOND IF IO
          OPEN      SPLTFILE,WBSCSPOO
          TRAPCLR   IO
          IF        OVRCD=0
            CLOSE     SPLTFILE,DELETE
          ENDIF
.
          UNPACK    WBSCSPOO,KEY8           * Delete spooled .csv
          MOVE      ".csv",KEY4
          PACK      KEY12,KEY8,KEY4,SP70
          MOVE      ZERO,OVRCD
          TRAP      OVERCOND IF IO
          OPEN      SPLTFILE,KEY12
          TRAPCLR   IO
          IF        OVRCD=0
            CLOSE     SPLTFILE,DELETE
          ENDIF
.
          MOVE      WBSCSPOO,KEY8
          CALL      RDSPOL1
          IF        OVRCD=0
            CALL      DESPOL1
          ENDIF
.
          MOVE      SP70,KEY60
          UNPACK    RSCNRCD,KEY60      * Report Configuration File Directory
          SQUEEZE   KEY60
.
          MOVE      SP70,KEY10
          UNPACK    WBSCSCHD,KEY10
          SQUEEZE   KEY10
.
          CLEAR     KEY70
          APPEND    KEY60,KEY70
          APPEND    "L",KEY70
          APPEND    KEY10,KEY70
          APPEND    ".txt",KEY70
          APPEND    SP70,KEY70
          RESET     KEY70
.
          MOVE      ZERO,OVRCD
          TRAP      OVERCOND IF IO
          OPEN      TEMPFILE,KEY70
          TRAPCLR   IO
          IF        OVRCD=0
            CLOSE     TEMPFILE,DELETE
          ENDIF
.
WEBSCH28  MOVE      ZERO,EXIT
          GOTO      WEBSCH99
.
.         ************ Print **********
.
WEBSCH30  PACK      KEY8,SCHDCODE,SP70
          CALL      RDWBSC1
          BRANCH    OVRCD,WEBSCH91
.
          MATCH     SP70,SCHDPRNT 
          GOTO      WEBSCH92 IF EQUAL
          MATCH     "S",SCHDPRNT 
          GOTO      WEBSCH92 IF EQUAL
.
          MOVE      WBSCSPOO,SPLFILE
          MOVE      SCHDCOPY,KEY3
          MOVE      ONE,CNOCOPY
          SQUEEZE   KEY3
          MOVE      ZERO,F3
          MOVE      KEY3,F3
          IF        F3<>0
            MOVE      F3,CNOCOPY
          ENDIF
          MOVE      SCHDPRNT,KEY6
.
          UNPACK    KEY6,DIM1A,DIM1B,DIM1C,DIM1D,DIM1E,DIM1F
          MATCH     "0",DIM1A
          GOTO      WEBSCH35 IF NOT EQUAL
. 
          MOVE      SP1,DIM1A
.
          MATCH     "0",DIM1B
          GOTO      WEBSCH34 IF NOT EQUAL
. 
          MOVE      SP1,DIM1B
.
          MATCH     "0",DIM1C
          GOTO      WEBSCH34 IF NOT EQUAL
. 
          MOVE      SP1,DIM1C
.
          MATCH     "0",DIM1D
          GOTO      WEBSCH34 IF NOT EQUAL
. 
          MOVE      SP1,DIM1D
.
          MATCH     "0",DIM1E
          GOTO      WEBSCH34 IF NOT EQUAL
. 
          MOVE      SP1,DIM1E
.
WEBSCH34  PACK      KEY6,DIM1A,DIM1B,DIM1C,DIM1D,DIM1E,DIM1F
.
WEBSCH35  CALL      RDPRTA1
          BRANCH    OVRCD,WEBSCH92
          COMPARE   ZERO,PRTAVAL
          GOTO      WEBSCH93 IF NOT EQUAL
.
          MOVE      ZERO,OVRCD
          TRAP      OVERCOND IF IO
          OPEN      SPLTFILE,WBSCSPOO
          TRAPCLR   IO
          BRANCH    OVRCD,WEBSCH95
          READ      SPLTFILE,ZERO;*1,ANS
          GOTO      WEBSCH94 IF OVER
          CLOSE     SPLTFILE
.
          MOVE      "SR ",KEY3
          PACK      COMMAND,KEY3,SCHDPRNT,SP1,SPLFILE,SP1,CNOCOPY:
                                           SP1,PASSCODE,SP30
          EXECUTE   COMMAND,TASKID
.
          MOVE      ZERO,EXIT
          GOTO      WEBSCH99

WEBSCH40  PACK      KEY8,SCHDCODE,SP70     
          CALL      RDWBSC1
          BRANCH    OVRCD,WEBSCH91
          PACK      KEY8,SCHDCODE,SP70  
          CALL      RLWBSC1      * Read lock record
          MOVE      ONE,WBSCPERM * Make Permanent Spool File
          CALL      UPWBSC1      * Update Record
          CALL      UUWBSC1      * Read lock record
          MOVE      ZERO,EXIT
          GOTO      WEBSCH99
.
.         ************ LABEL & FORMS FORMACTION **********
.
WEBSCH45  MOVE      ZERO,F3  
WEBSCH50  MOVE      ZERO,COUNT
          ADD       ONE,F3       * Clear Key Strokes Array
          IF        F3<=95
            MATCH     SP70,ADMISARR[F3]
            IF        @EQUAL
              MATCH     "LABELPMI",LABELARR[F3]
              IF        !@EQUAL
                MATCH     "LABELOUT99",LABELARR[F3]
                IF        @EQUAL
                  GOTO      WEBSCH52
                ELSE
                  MATCH     "LABELASS01",LABELARR[F3]
                  IF        @EQUAL
                    GOTO      WEBSCH52
                  ELSE
                    GOTO      WEBSCH54
                  ENDIF
                ENDIF
              ENDIF
            ENDIF
.
            MATCH     SP70,ADMISARR[F3]
            GOTO      WEBSCH54 IF EQUAL
            GOTO      WEBSCH54 IF EOS
.                            
            CALL      CLRALL00
.
            MATCH     ZEROADMI,ADMISARR[F3]
            IF        @EQUAL
              PACK      URNUMBER,URNUMARR[1]
              PACK      ADMISSNO,SP70 
              GOTO      WEBSCH52
            ENDIF
.
            MOVE      ADMISARR[F3],ADMISSNO     * Array of Admission no
            PACK      KEY8,ADMISSNO,SP70
            CALL      RDMISS1
            IF        OVRCD<>1
              MOVE      AURNO,URNUMBER
              GOTO      WEBSCH52
            ENDIF
.
            PACK      KEY8,ADMISSNO,SP70
            CALL      RDBKREC1                * Read booking file
            IF        OVRCD = 0
              PACK      URNUMBER,BKREURNO,SP70
              GOTO      WEBSCH52  
            ENDIF
            PACK      KEY8,ADMISSNO,SP70           * I SRF 23145
            CALL      RDPTVIS1                     
            IF        OVRCD=1
              GOTO      WEBSCH51
            ENDIF
            PACK      URNUMBER,PVIURNO,SP70
            COMPARE   ONE,PVITYPE                * Check for EMR visit type
            GOTO      WEBSCH52 IF EQUAL 
.
            COMPARE   NINE,PVITYPE               * Check for visit type
            IF        @EQUAL
              MATCH      " 1",PVISYST            * Current event vis type 
              IF        @EQUAL
                PACK      KEY8,ADMISSNO,SP70
                CALL      RDPMEVT1
                IF        OVRCD = 0
                  MOVE      "EV",CATEGORY        * Check the event cat
                  MOVE      PMEVEVNT,CODE        * indicator 1
                  CALL      GETCOD00
.
                  MATCH     "I",TCINDC1          * inpatient event
                  IF        @EQUAL
                    GOTO      WEBSCH52
                  ENDIF
                ENDIF
              ENDIF
              MATCH      " 2",PVISYST            * Allied Health
              IF        @EQUAL
                PACK      KEY8,ADMISSNO,SP70
                CALL      RDALREF1
                IF        OVRCD = 0
                  PACK      URNUMBER,ALREURNO,SP70
                  GOTO      WEBSCH52
                ENDIF                
              ENDIF                
            ENDIF                
.                                                     * end I SRF 23145
WEBSCH51    COMPARE   ONE,OUTPTFLG
            IF        @EQUAL
              PACK      URNUMBER,URNUMARR[1]
              GOTO      WEBSCH52  
            ENDIF
.
            CALL      OUTFIL00              * Check user id site files
            PACK      KEY36,ADMISSNO,SP70
            CALL      RDSBOKA6
            CALL      RDKBOKA6
            BRANCH    OVRCD,WEBSCH96
.         
            MATCH     ADMISSNO,DOBAOUTN
            GOTO      WEBSCH96 IF NOT EQUAL
            PACK      URNUMBER,OBAURNO,SP70
.
.
WEBSCH52    MOVE      SUBSYARR[F3],SUBSYSKY   * Sub system key
            MOVE      FREEARR1[F3],FREETXT1   * Free Text
            MOVE      FREEARR2[F3],FREETXT2   * Free Text
            MOVE      FREEARR3[F3],FREETXT3   * Free Text
            MOVE      FREEARR4[F3],FREETXT4   * Free Text
            MOVE      FREEARR5[F3],FREETXT5   * Free Text
            MOVE      FREEARR6[F3],FREETXT6   * Free Text
            MOVE      FREEARR7[F3],FREETXT7   * Free Text
.
WEBSCH53    ADD       ONE,COUNT
            IF        COUNT<=95
              MATCH     SP70,SCHDPARR[COUNT]
              GOTO      WEBSCH50 IF EQUAL
              MOVE      SCHDPARR[COUNT],SCHDPRNT   * Array of selected Printer
              MOVE      SCHDCARR[COUNT],SCHDCOPY   * Number of Copies
              MOVE      LABELARR[COUNT],LABELTYP   * Label type
              MOVE      STATNARR[COUNT],STATNCOD   * Stationary Code
              CALL      ADDPRN00
              CALL      UPDEFP00
              CALL      CLACCAUD
              IF        PTCNHDPS=1
                CALL      MVACCPRN                 * Write to acc audit file
              ENDIF
              GOTO      WEBSCH53
            ENDIF
.
            GOTO      WEBSCH50
          ENDIF
.
WEBSCH54  MOVE      ZERO,EXIT
.                                      * Remember the printer selected.*I-43467
.                                      * This is done here beacause in *I-43467
.                                      * PATWEB70 - CLSPRINT           *I-43467
.                                      * The program ID is changed to  *I-43467
.                                      * the label type selected.      *I-43467
.                                      * This means for an outpatient  *I-43467
.                                      * Label its written twice with  *I-43467
.
          MATCH     SP70,SETDFPRG                                      *I-43467
          IF        !@EQUAL
            PACK      KEY20,SETDFPRG,SETDFREP,WBSEUID,SP70             *I-43467
            UNPACK    KEY20,IBPDPID,IBPDREP,IBPDUID                    *I-43467
            MOVE      SCHDPRNT,IBPDPRT   * Printer                     *I-43467
            MOVE      SP70,IBPDSPA                                     *I-43467
            CALL      RAIBPD1                                          *I-43467
            IF        OVRCD=0
              CALL      UPIBPD1                                        *I-43467
            ELSE                                                       *I-43467
              CALL      WRIBPD1                                        *I-43467
            ENDIF                                                      *I-43467
.
            MATCH     SP70,SETDFPG2                                    *I-53346
            GOTO      WEBSCH57 IF EQUAL                                *I-53346
            GOTO      WEBSCH57 IF EOS                                  *I-53346
.
            PACK      KEY20,SETDFPRG,SETDFREP,WBSEUID,SP70             *I-53346
            UNPACK    KEY20,IBPDPID,IBPDREP,IBPDUID                    *I-53346
            MOVE      SETDFPR2,IBPDPRT                                 *I-53346
            MOVE      SP70,IBPDSPA                                     *I-53346
            CALL      RAIBPD1                                          *I-53346
            IF        OVRCD=0
              CALL      UPIBPD1                                        *I-53346
            ELSE                                                       *I-53346
              CALL      WRIBPD1                                        *I-53346
            ENDIF
.
            PACK      KEY20,SETDFPG2,SETDFREP,WBSEUID,SP70             *I-53346
            UNPACK    KEY20,IBPDPID,IBPDREP,IBPDUID                    *I-53346
            MOVE      SETDFPR3,IBPDPRT                                 *I-53346
            MOVE      SP70,IBPDSPA                                     *I-53346
            CALL      RAIBPD1                                          *I-53346
            IF        OVRCD=0
              CALL      UPIBPD1                                        *I-53346
            ELSE
              CALL      WRIBPD1                                        *I-53346
            ENDIF
          ENDIF                                                        *I-43467
.
WEBSCH57  GOTO      WEBSCH99
. 
.         ************ DISPLAY **********
.
WEBSCH60  PACK      KEY8,SCHDCODE,SP70
          CALL      RDWBSC1
          BRANCH    OVRCD,WEBSCH91
. 
          CLEAR     WEBTITLE
          MOVE      "Schedule Item Detail Maintenance",WEBTITLE
          RESET     WEBTITLE
.
          CALL      WEBHED00   * Create Output File and Write HTML Page Header
          BRANCH    EXIT,WEBSCH99
          CALL      WEBBOD00   * Process Web Body
          CALL      WEBEND00   * Process End of HTML File
          MOVE      ONE,EXIT
          GOTO      WEBSCH99
.
.         ************ BULK DELETE REPORTS FORMACTION **********
.
WEBSCH70  MOVE      ZERO,COUNTITM
WEBSCH75  ADD       ONE,COUNTITM
          COMPARE   "99",COUNTITM
          GOTO      WEBSCH79 IF NOT LESS
.
          MOVE      ARRPT[COUNTITM],SCHDLENO
          MATCH     SP70,ARRPT[COUNTITM]
          GOTO      WEBSCH75 IF EQUAL
.
          MOVE      SCHDLENO,KEY8
          CALL      RDWBSC1
          BRANCH    OVRCD,WEBSCH97
.
.         Check User Level Security against Report ID 
.
          MOVE      WBSCRPID,UPPRPTID
          REP       UPPLOW,UPPRPTID
.
          PACK      KEY13,UPPRPTID,DZERO,SP70
          CALL      RSWBTP1
          CALL      RKWBTP1
          BRANCH    OVRCD,WEBSCH97
.
          MATCH     WBTPPRG,WBSCRPID
          GOTO      WEBSCH97 IF NOT EQUAL
.
          MATCH     SP70,WBTPLEV        * Check template security
          GOTO      WEBSCH76  IF EQUAL
.
          PACK      KEY18,WBSEUID,UPPRPTID,SP70
          CALL      RDWBST1
          BRANCH    OVRCD,WEBSCH97
.
          MOVE      WBSTLEV,CHCKUSL
          MATCH     SP70,CHCKUSL        * Check user security
          GOTO      WEBSCH97 IF EQUAL
.
          MOVE      WBTPLEV,CHCKTSL     * Compare User/Template SL
          COMPARE   CHCKTSL,WBSTLEV
          GOTO      WEBSCH97 IF LESS
.
.         Delete the webschaf record and keystroke 
.
WEBSCH76  MOVE      SCHDLENO,KEY8      
          CALL      RDWBSC1
          BRANCH    OVRCD,WEBSCH91
          PACK      KEY8,SCHDLENO,SP70
          CALL      DEWBSC1      * Delete Record
.
          PACK      KEY80,RSCNRCD,WBSCSCHD,KEYSTKNM
          SQUEEZE   KEY80
          PREP      KEYSTKFL,KEY80     * Delete Key Strokes File
          CLOSE     KEYSTKFL
.
          MOVE      ZERO,OVRCD
          TRAP      OVERCOND IF IO
          OPEN      SPLTFILE,WBSCSPOO
          TRAPCLR   IO
          IF        OVRCD=0
            CLOSE     SPLTFILE,DELETE
          ENDIF
.
          UNPACK    WBSCSPOO,KEY8           * Delete spooled .csv
          MOVE      ".csv",KEY4
          PACK      KEY12,KEY8,KEY4,SP70
          MOVE      ZERO,OVRCD
          TRAP      OVERCOND IF IO
          OPEN      SPLTFILE,KEY12
          TRAPCLR   IO
          IF        OVRCD=0
            CLOSE     SPLTFILE,DELETE
          ENDIF
.
          MOVE      WBSCSPOO,KEY8
          CALL      RDSPOL1
          IF        OVRCD=0
            CALL      DESPOL1
          ENDIF
.
          MOVE      SP70,KEY60
          UNPACK    RSCNRCD,KEY60      * Report Configuration File Directory
          SQUEEZE   KEY60
.
          MOVE      SP70,KEY10
          UNPACK    WBSCSCHD,KEY10
          SQUEEZE   KEY10
.
          CLEAR     KEY70
          APPEND    KEY60,KEY70
          APPEND    "L",KEY70
          APPEND    KEY10,KEY70
          APPEND    ".txt",KEY70
          APPEND    SP70,KEY70
          RESET     KEY70
.
          MOVE      ZERO,OVRCD
          TRAP      OVERCOND IF IO
          OPEN      TEMPFILE,KEY70
          TRAPCLR   IO
          IF        OVRCD=0
            CLOSE     TEMPFILE,DELETE
          ENDIF
.
          GOTO      WEBSCH75
.
WEBSCH79  MOVE      ZERO,EXIT
          GOTO      WEBSCH99
.
.
WEBSCH90  MOVE      "Invalid Option.",WEBTITLE
          CALL      WEBERR00
          MOVE      ONE,EXIT
          GOTO      WEBSCH99
.
WEBSCH91  MOVE      "Scheduler Record does not exist",WEBTITLE
          CALL      WEBERR00
          MOVE      ONE,EXIT
          GOTO      WEBSCH99
.
WEBSCH92  MOVE      "Printer not selected.",WEBTITLE
          CALL      WEBERR00
          MOVE      ONE,EXIT
          GOTO      WEBSCH99
.
WEBSCH93  MOVE      "Printer not available.",WEBTITLE
          CALL      WEBERR00
          MOVE      ONE,EXIT
          GOTO      WEBSCH99
.
WEBSCH94  MOVE      "Spool File Empty.",WEBTITLE
          CALL      WEBERR00
          MOVE      ONE,EXIT
          GOTO      WEBSCH99
.
WEBSCH95  MOVE      "Spool File Does Not Exist.",WEBTITLE
          CALL      WEBERR00
          MOVE      ONE,EXIT
          GOTO      WEBSCH99
.
WEBSCH96  MOVE      "Visit not found.",WEBTITLE
          CALL      WEBERR00
          MOVE      ONE,EXIT
          GOTO      WEBSCH99
.
WEBSCH97  MOVE      "Security Inadequate",WEBTITLE
          CALL      WEBERR00
          MOVE      ONE,EXIT
          GOTO      WEBSCH99
.
WEBSCH99  RETURN
.-----------------------------------------------------------
. Update ACCAUDFD file for Print ACC Forms
.-----------------------------------------------------------
MVACCPRN  CALL      CLACCAUD
.
          MATCH     PTCLM011,Z70
          IF        !@EQUAL
            MOVE      PTCLM011,ACAUCLMN             * ACC Claim Number
          ENDIF
.
          MATCH     SP70,ACAUCLMN                   * Blank ACC Number
          GOTO      MVACCP99 IF EQUAL               * so exit
          GOTO      MVACCP99 IF EOS
.
          MATCH     ADMISSNO,Z70
          IF        !@EQUAL
            MOVE      ADMISSNO,ACAUADMN             * Visit Number
          ENDIF
.
          CALL      IBACLOCK
          PACK      ACAUDATE,CCC,CYY,CMM,CDD        * Current Date
          REP       " 0",ACAUDATE
          MOVE      CTIMEIS,ACAUTIME                * Current Time
          MOVE      USERID,ACAUWUID                 * Web UserId
.
          MOVE      "A",ACAUAUTY                    * Audit Type for Add
          MOVE      "P",ACAUTREC                    * ACC Type of Record
.
          MATCH     STATNCOD,SP70
          IF        !@EQUAL
            MOVE      STATNCOD,ACAUSATC          * Stationery Code (ibatmhaf)   
          ENDIF
.
MVACCP10  PACK      KEY54,ACAUCLMN,ACAUADMN,ACAUDATE,ACAUTIME,ACAUWUID
          CALL      RAACAUD1
          IF        OVRCD=1
            CALL      WRACAUD1
            GOTO      MVACCP99
          ELSE
            CALL      IBACLOCK                    * Set new date and time and
            PACK      ACAUDATE,CCC,CYY,CMM,CDD    * try write again
            REP       " 0",ACAUDATE
            CLOCK     TIME,CTIMEIS
            PACK      ACAUTIME,CTIMEIS
            REP       " 0",ACAUTIME
            GOTO      MVACCP10
          ENDIF
.
MVACCP99  RETURN
.
.-----------------------------------------------------------
. Clear routine 
.-----------------------------------------------------------
CLRALL00  MOVE      SP70,SCHDPRNT   * Array of selected Printer
          MOVE      ZERO,SCHDCOPY   * Number of Copies
          MOVE      SP70,LABELTYP   * Label type
          MOVE      SP70,LABELDET   * IBPDPID + IBPDREP
          MOVE      ZERO,SHOWEROR   * Show XML/Remote Error messages
          MOVE      SP70,STATNCOD   * Stationary Code
          MOVE      SP70,URNUMBER   * Array of Admission no
          MOVE      SP70,ADMISSNO   * Array of Admission no
          MOVE      SP70,SUBSYSKY   * Sub system key
          MOVE      SP70,FREETXT1   * Free Text
          MOVE      SP70,FREETXT2   * Free Text
          MOVE      SP70,FREETXT3   * Free Text
          MOVE      SP70,FREETXT4   * Free Text
          MOVE      SP70,FREETXT5   * Free Text
          MOVE      SP70,FREETXT6   * Free Text
          MOVE      SP70,FREETXT7   * Free Text
.
CLRALL99  RETURN
.-----------------------------------------------------------
. Save routine - move cgi parameters into file variables
.-----------------------------------------------------------
SCHSAV00  MOVE      SCHDDATE,WBSCSCDT    * Schedule Date
          MOVE      SCHDTIME,WBSCSCTM    * Schedule Time
          MOVE      SCHDPRNT,WBSCPRIN    * Printer No
          MOVE      SCHDRDAT,WBSCRDAT    * Printer No
          MOVE      SCHDREND,WBSCREND    * Printer No
          MOVE      SCHDPERM,WBSCPERM    * Printer No
          PACK      WBSCEXCP,EXCEPTPB,EXCEPTMO,EXCEPTTU,EXCEPTWE:
                             EXCEPTTH,EXCEPTFR,EXCEPTSA,EXCEPTSU
          REP       " 0",WBSCEXCP
.
SCHSAV99  RETURN
.------------------------------------------------------------
. * Checks mandatory fields
.------------------------------------------------------------
CHKSCH00  MATCH     "U",UPDTTYPE 
          IF        @EQUAL
.
            MATCH     "1",DESCCHNG      * update if description is changed
            GOTO      CHKSCH98 IF EQUAL
.  
            MATCH     "1",WBSCSTAT      * Can only Update if Status=1      
            GOTO      CHKSCH93 IF NOT EQUAL
          ENDIF
.
          MATCH     "D",UPDTTYPE 
          IF        @EQUAL
            MATCH     "0",WBSCSTAT      * Can only Delete if Status is not =0
            GOTO      CHKSCH94 IF EQUAL
          ENDIF
.
          RESET     SCHDPRNT
          MATCH     SP70,SCHDPRNT
          GOTO      CHKSCH90 IF EQUAL
.
          GOTO      CHKSCH98
.
CHKSCH90  MOVE      "Printer No. is mandatory!",WEBTITLE
          CALL      WEBERR00
          MOVE      ONE,EXIT
          GOTO      CHKSCH99
.
CHKSCH93  MOVE      "Can Only Update if ",WEBTITLE
          ENDSET    WEBTITLE
          APPEND    "Status: 1 - Awaiting Processing ",WEBTITLE
          CALL      WEBERR00
          MOVE      ONE,EXIT
          GOTO      CHKSCH99
.
CHKSCH94  CLEAR     WEBTITLE 
          MOVE      "Can Only Delete if Status: 0 - Current Execution",WEBTITLE 
          CALL      WEBERR00
          MOVE      ONE,EXIT
          GOTO      CHKSCH99
.
CHKSCH98  MOVE      ZERO,EXIT
CHKSCH99  RETURN
.------------------------------------------------------------
. Schedule Parameter: Display,Update
.------------------------------------------------------------
RSHCON00  RESET     UPDTTYPE
          MATCH     SP1,UPDTTYPE
          GOTO      RSHCON30 IF EQUAL
.
          MATCH     "U",UPDTTYPE    * Update formaction
          GOTO      RSHCON10 IF EQUAL
.
          GOTO      RSHCON90
.
.         ************ UPDATE FORMACTION **********
.
RSHCON10  CALL      RSHSAV00     * Sav control file variables
.
          MOVE      ZERO,EXIT
          GOTO      RSHCON99
.
.         ************ DISPLAY FORMACTION **********
.
RSHCON30  CLEAR     WEBTITLE
          MOVE      "Schedule Parameter Maintenance",WEBTITLE
          RESET     WEBTITLE
.
          CALL      WEBHED00   * Create Output File and Write HTML Page Header
          BRANCH    EXIT,RSHCON99
          CALL      WEBBOD00   * Process Web Body
          CALL      WEBEND00   * Process End of HTML File
          MOVE      ONE,EXIT
          GOTO      RSHCON99
.
RSHCON90  MOVE      "Invalid Option.",WEBTITLE
          CALL      WEBERR00
          MOVE      ONE,EXIT
          GOTO      RSHCON99
.
RSHCON99  RETURN
.-----------------------------------------------------------
. Save routine - move cgi parameters into file variables
.-----------------------------------------------------------
RSHSAV00  WRITAB    CONTROLF,NINTY1;*19,RSHCTR14,RSHCTR15,*179,RSHCTR16:
                                       RSHCTR17
.
          WRITAB    CONTROLF,HUND01;*56,RSHCTR19
.
          WRITAB    CONTROLF,HUND02;*1,RSHCTR01,RSHCTR02,RSHCTR03,RSHCTR04:
                                      RSHCTR05,RSHCTR06,RSHCTR07,RSHCTR08:
                                      RSHCTR09,RSHCTR10,RSHCTR11,RSHCTR12:
                                      RSHCTR18
.
          WRITAB    CONTROLF,HUND04;*1,RSHCTR13
.
RSHSAV99  RETURN
.------------------------------------------------------------
. IBA Parameter: Display,Update
.------------------------------------------------------------
RSHIBC00  RESET     UPDTTYPE
          MATCH     SP1,UPDTTYPE
          GOTO      RSHIBC30 IF EQUAL
.
          MATCH     "O",UPDTTYPE    * OK formaction
          GOTO      RSHIBC10 IF EQUAL
.
          MATCH     "U",UPDTTYPE    * Update formaction
          GOTO      RSHIBC20 IF EQUAL
.
          GOTO      RSHIBC90
.
.         ************ UPDATE FORMACTION **********
.
RSHIBC10  CALL      VPAS0000     * validate password
          BRANCH    EXIT,RSHIBC99
          GOTO      RSHIBC30
.
RSHIBC20  CALL      RSHSIB00     * Sav control file variables
          MOVE      ZERO,EXIT
          GOTO      RSHIBC99
.
.         ************ DISPLAY FORMACTION **********
.
RSHIBC30  CLEAR     WEBTITLE
          MOVE      "IBA Parameter Maintenance",WEBTITLE
          RESET     WEBTITLE
.
          CALL      WEBHED00   * Create Output File and Write HTML Page Header
          BRANCH    EXIT,RSHIBC99
          CALL      WEBBOD00   * Process Web Body
          CALL      WEBEND00   * Process End of HTML File
.
          MOVE      ONE,EXIT
          GOTO      RSHIBC99
.
RSHIBC90  MOVE      "Invalid Option.",WEBTITLE
          CALL      WEBERR00
          MOVE      ONE,EXIT
          GOTO      RSHIBC99
.
RSHIBC99  RETURN
.-----------------------------------------------------------
. Save routine - move cgi parameters into file variables
.-----------------------------------------------------------
RSHSIB00  WRITAB    CONTROLF,NINTY1;*11,RSHIBA01
.
RSHSIB99  RETURN
.------------------------------------------------------------
. Add Program to Schedule: Add 
.------------------------------------------------------------
SCHPRO00  RESET     UPDTTYPE
          MATCH     SP1,UPDTTYPE
          GOTO      SCHPRO30 IF EQUAL
.
          MATCH     "A",UPDTTYPE    * Add Program to Schedule formaction
          GOTO      SCHPRO10 IF EQUAL
.
          GOTO      SCHPRO90
.
.         ************ ADD FORMACTION **********
.
SCHPRO10  CALL      CHKPRO00        * Check Mandatory Fields
          BRANCH    EXIT,SCHPRO99 
.
          CALL      SAVPRO00        * Set up Schedule Record  
          MOVE      ZERO,EXIT
          GOTO      SCHPRO99
.
.         ************ DISPLAY FORMACTION **********
.
SCHPRO30  CLEAR     WEBTITLE
          MOVE      "Add Program To Schedule",WEBTITLE
          RESET     WEBTITLE
.
          CALL      WEBHED00   * Create Output File and Write HTML Page Header
          BRANCH    EXIT,SCHPRO99
          CALL      WEBBOD00   * Process Web Body
          CALL      WEBEND00   * Process End of HTML File
          MOVE      ONE,EXIT
          GOTO      SCHPRO99
.
SCHPRO90  MOVE      "Invalid Option.",WEBTITLE
          CALL      WEBERR00
          MOVE      ONE,EXIT
          GOTO      SCHPRO99
.
SCHPRO99  RETURN
.------------------------------------------------------------
. * Checks mandatory fields
.------------------------------------------------------------
CHKPRO00  RESET     SCHDPRNT
          MATCH     SP70,SCHDPRNT
          GOTO      CHKPRO92 IF EQUAL
.
          GOTO      CHKPRO98
.
CHKPRO92  MOVE      "Printer Selection is mandatory!",WEBTITLE
          CALL      WEBERR00
          MOVE      ONE,EXIT
          GOTO      CHKPRO99
.
CHKPRO98  MOVE      ZERO,EXIT
CHKPRO99  RETURN
.------------------------------------------------------------
. Add Program to Schedule: Add
.------------------------------------------------------------
SCHMKI00  RESET     UPDTTYPE
          MATCH     SP1,UPDTTYPE
          GOTO      SCHMKI30 IF EQUAL
.
          MATCH     "A",UPDTTYPE    * Add Program to Schedule formaction
          GOTO      SCHMKI10 IF EQUAL
.
          GOTO      SCHMKI90
.
.         ************ ADD FORMACTION **********
.
SCHMKI10  CALL      CHKPRO00        * Check Mandatory Fields
          BRANCH    EXIT,SCHMKI99
.
          CALL      SAVPRO00        * Set up Schedule Record
          MOVE      ZERO,EXIT
          GOTO      SCHMKI99
.
.         ************ DISPLAY FORMACTION **********
.
SCHMKI30  CLEAR     WEBTITLE
          MOVE      "Add Program To Schedule",WEBTITLE
          RESET     WEBTITLE
.
          CALL      WEBHED00   * Create Output File and Write HTML Page Header
          BRANCH    EXIT,SCHMKI99
          CALL      WEBBOD00   * Process Web Body
          CALL      WEBEND00   * Process End of HTML File
          MOVE      ONE,EXIT
          GOTO      SCHMKI99
.
SCHMKI90  MOVE      "Invalid Option.",WEBTITLE
          CALL      WEBERR00
          MOVE      ONE,EXIT
          GOTO      SCHMKI99
.
SCHMKI99  RETURN
.------------------------------------------------------------
. Read Schedule Parameters
.------------------------------------------------------------
REDPAR00  MOVE      ZERO,OVRCD
          TRAP      OVERCOND IF FORMAT
          READ      CONTROLF,HUND01;*56,CWEBGFIL
          TRAPCLR   FORMAT
          IF        OVRCD=1
            MOVE      SP70,CWEBGFIL
            WRITAB     CONTROLF,HUND01;*56,CWEBGFIL
            READ       CONTROLF,HUND01;*56,CWEBGFIL
          ENDIF
.                          
          MOVE      ZERO,OVRCD
          TRAP      OVERCOND IF FORMAT
          READ      CONTROLF,HUND02;RSCNCCP,RSCNSLP,RSCNRCD,RSCNROD:
                                    RSCNCMD,RSCNCLP1,RSCNCLP2,RSCNCLP3:
                                    RSCNCLP4,RSCNCLP5,RSCNSPDL,RSCNCMDL:
                                    RSCNTIMD
          TRAPCLR   FORMAT
          IF        OVRCD=1
            MOVE       "20",RSCNCCP
            MOVE       "10",RSCNSLP
            MOVE       SP70,RSCNRCD
            MOVE       SP70,RSCNROD
            MOVE       SP70,RSCNCMD
            MOVE       SP70,RSCNCLP1 
            MOVE       SP70,RSCNCLP2 
            MOVE       SP70,RSCNCLP3 
            MOVE       SP70,RSCNCLP4 
            MOVE       SP70,RSCNCLP5 
            MOVE       SP70,RSCNSPDL 
            MOVE       SP70,RSCNCMDL 
            MOVE       SP70,RSCNTIMD 
            WRITAB     CONTROLF,HUND02;RSCNCCP,RSCNSLP,RSCNRCD,RSCNROD:
                                       RSCNCMD,RSCNCLP1,RSCNCLP2,RSCNCLP3:
                                       RSCNCLP4,RSCNCLP5,RSCNSPDL,RSCNCMDL:
                                       RSCNTIMD
            READ       CONTROLF,HUND02;RSCNCCP,RSCNSLP,RSCNRCD,RSCNROD:
                                       RSCNCMD,RSCNCLP1,RSCNCLP2,RSCNCLP3:
                                       RSCNCLP4,RSCNCLP5,RSCNSPDL,RSCNCMDL:
                                       RSCNTIMD
          ENDIF
.
.  * Read Extract Parameters sector 104
.
          MOVE      ZERO,OVRCD
          TRAP      OVERCOND IF FORMAT
          READ      CONTROLF,HUND04;RSCNEXT
          TRAPCLR   FORMAT
          IF        OVRCD=1
            MOVE       SP70,RSCNEXT  
            WRITAB     CONTROLF,HUND04;RSCNEXT
            READ       CONTROLF,HUND04;RSCNEXT
          ENDIF
.
.  * Read Web Systems Control sector 91 
.
          MOVE      ZERO,OVRCD
          TRAP      OVERCOND IF FORMAT
          READ      CONTROLF,NINTY1;*19,CWEBPCMD,CWEBPFIL,*179,CWEBROOT:
                                         CWEBCLOC          
          TRAPCLR   FORMAT
          IF        OVRCD=1
            MOVE       SP70,CWEBPCMD
            MOVE       SP70,CWEBPFIL
            MOVE       SP70,CWEBROOT
            MOVE       SP70,CWEBCLOC          
            WRITAB    CONTROLF,NINTY1;*19,CWEBPCMD,CWEBPFIL,*179,CWEBROOT:
                                           CWEBCLOC          
            READ      CONTROLF,NINTY1;*19,CWEBPCMD,CWEBPFIL,*179,CWEBROOT:
                                           CWEBCLOC          
          ENDIF
.
          RETURN
.
.------------------------------------------------------------
. Read IBA Screen Parameters
.------------------------------------------------------------
RIBPAR00  MOVE      ZERO,OVRCD
          TRAP      OVERCOND IF FORMAT
          READ      CONTROLF,NINTY1;*11,CWEBPASS
          TRAPCLR   FORMAT
          IF        OVRCD=1
            MOVE      SP70,CWEBPASS
            WRITAB    CONTROLF,NINTY1;*11,CWEBPASS
            READ      CONTROLF,NINTY1;*11,CWEBPASS
          ENDIF
RIBPAR99  RETURN
.------------------------------------------------------------
. * Set Up Schedule Record 
.------------------------------------------------------------
SAVPRO00  CALL      IBACLOCK 
          CALL      REDPAR00 
.   
          CALL      NXTSCH00         * Get Next Report Schedule Number 
          MOVE      "1",WBSCSTAT     * Status 1 = Awaiting Processing
.
          MOVE      SCHDDATE,WBSCSCDT
          MOVE      SCHDTIME,WBSCSCTM 
          MOVE      SCHDPERM,WBSCPERM 
          PACK      WBSCEXCP,EXCEPTPB,EXCEPTMO,EXCEPTTU,EXCEPTWE:
                             EXCEPTTH,EXCEPTFR,EXCEPTSA,EXCEPTSU
          REP       " 0",WBSCEXCP
          MOVE      SCHDRDAT,WBSCRDAT 
          MOVE      SCHDREND,WBSCREND 
          MOVE      SP70,WBSCACTV   * Active Process ID 
.
          CALL      SETCMD00        * Set up Unix Command
.
          MOVE      SCHDDESC,WBSCDSRP   * Description of Report      
          MOVE      SCHDPGID,WBSCRPID   * Report Program ID
          MOVE      USERID,WBSCUSER     * User ID
          PACK      WBSCRDTE,CCC,CYY,CMM,CDD  * Request Date
          REP       " 0",WBSCRDTE
          MOVE      CTIMEIS,WBSCRTIM    * Request Time
          MOVE      SP70,WBSCSDAT       * Start Date
          MOVE      SP70,WBSCSTIM       * Start Time
          MOVE      ZERO,WBSCSFLG       * Start Flag
          MOVE      SCHDTYPE,WBSCOTYP   * Output Type 0=Text 1=HTML 2=PDF 3=SMS
          MOVE      ZERO,WBSCNREC       * Expected no of records
          MOVE      ZERO,WBSCRPRO       * Records Processed
          MOVE      SP70,WBSCUTIM       * Last Update Time 
          MOVE      SCHDPRNT,WBSCPRIN   * Printer
          MOVE      SCHDSPLN,WBSCSPOO   * Spool File
          MOVE      SCHDCOPY,WBSCNCOP   * No of Copies
          MOVE      SCHDPRIN,WBSCPREP   * Print Report 0=No 1=Yes
.
          PACK      KEY10,USERID,SP70
          CALL      RDWBSE1
          IF        OVRCD<>1
            MOVE      WBSEHOSP,WBSCHOSP * Logged in Hospital ID (pathspaf)
            MOVE      WBSESIT,WBSCSITE  * Logged in Outpatient Site (outsitaf)
          ENDIF
.
          CALL      UPWBSC1             * Update Schedule
.
          CALL      MAKKEY00            * Make Key Strokes File
.
          MATCH     SP70,SETDFPRG
          IF        !@EQUAL
            PACK      KEY20,SETDFPRG,SETDFREP,WBSEUID,SP70
            UNPACK    KEY20,IBPDPID,IBPDREP,IBPDUID
            MOVE      SCHDPRNT,IBPDPRT   * Printer
            PACK      IBPDDOC,DOCODFLT,SP70   * save default document code
            MOVE      SP70,IBPDNUM
            MOVE      SP70,IBPDSPA
            CALL      RAIBPD1
            IF        OVRCD=0
              CALL      UPIBPD1
            ELSE
              CALL      WRIBPD1
            ENDIF
          ENDIF
.
          CALL      UUWBSC1             * Unlock record
.
SAVPRO99  RETURN
.----------------------------------------------------------------------
. Set Unix Command Line..  packed with Command String, Schedule No &
.                         command line parameters that are switched on. 
.----------------------------------------------------------------------
SETCMD00  STRIP     SCHDCMLN
          MOVELPTR  SCHDCMLN,F3
          SFORMAT   VAR,127
          SFORMAT   VAR,F3
          MOVE      SCHDCMLN,VAR
          CLEAR     WBSCUNIX
          APPEND    VAR,WBSCUNIX    * Unix Command line
          APPEND    SP1,WBSCUNIX    
          APPEND    WBSCSCHD,WBSCUNIX

          MOVE      ONE,F1
SETCMD10  LOAD      ANS,F1,SCHCLP01,SCHCLP02,SCHCLP03,SCHCLP04,SCHCLP05
          MATCH     "1",ANS
          IF        @EQUAL
            LOAD      KEY10,F1,RSCNCLP1,RSCNCLP2,RSCNCLP3,RSCNCLP4,RSCNCLP5
            STRIP     KEY10
            MOVELPTR  KEY10,F3
            SFORMAT   VAR,127
            SFORMAT   VAR,F3
            MOVE      KEY10,VAR
            APPEND    SP1,WBSCUNIX
            APPEND    VAR,WBSCUNIX
          ENDIF
          IF         F1<5
            ADD        ONE,F1
            GOTO       SETCMD10
          ENDIF
          APPEND    SP70,WBSCUNIX
          RESET     WBSCUNIX
          RETURN
.------------------------------------------------------------
.  * Create a Key Strokes File
.------------------------------------------------------------
MAKKEY00  PACK      KEY80,RSCNRCD,WBSCSCHD,KEYSTKNM 
          SQUEEZE   KEY80
          PREP      KEYSTKFL,KEY80     * Create Key Strokes File
.
.       Write Schedule Number as first key stroke
.
          WRITE     KEYSTKFL,SEQ;WBSCSCHD    * Schedule No : First Key Stroke
          COMPARE   ZERO,KEYSTCNT
          GOTO      MAKKEY90 IF EQUAL
.
          MOVE      ZERO,ARRCNT
MAKKEY10  ADD       ONE,ARRCNT
.
          IF        ARRCNT <= 150
            MOVE      KEYSTARR[ARRCNT],KEY120    * Key Stroke Variable
          ENDIF
.
          MATCH     "Import File Name",KEY120
          CALL      GETIMP00 IF EQUAL
.
          MATCH     "Import File Name 1",KEY120
          CALL      GETMP100 IF EQUAL
.
          MATCH     "Multiple",KEY120
          IF        @EQUAL
            MOVE      ZERO,COUNT
            WRITE     KEYSTKFL,SEQ;MULTCNT       * Write count
            WHILE     COUNT < MULTCNT
              IF        COUNT>0
                ADD       ONE,ARRCNT
                IF        ARRCNT <= 150
                  MOVE      KEYSTARR[ARRCNT],KEY120    * Key Stroke Variable
                ENDIF
              ENDIF
              UNPACK    KEY120,DIM8,KEY120
              STRIP     KEY120
              MOVELPTR  KEY120,F3
              SFORMAT   VAR,127
              SFORMAT   VAR,F3
              MOVE      KEY120,VAR
              WRITE     KEYSTKFL,SEQ;VAR      * Write Key Stroke Variable     
              ADD       ONE,COUNT
            DO
            IF        ARRCNT<KEYSTCNT
              GOTO      MAKKEY10              * Get Next Key Stroke
            ENDIF         
          ENDIF
.
          MATCH     "Multipl1",KEY120
          IF        @EQUAL
            MOVE      ZERO,COUNT
            WRITE     KEYSTKFL,SEQ;MULTCNT1      * Write count
            WHILE     COUNT < MULTCNT1
              IF        COUNT>0
                ADD       ONE,ARRCNT
                IF        ARRCNT <= 150
                  MOVE      KEYSTARR[ARRCNT],KEY120    * Key Stroke Variable
                ENDIF
              ENDIF
              UNPACK    KEY120,DIM8,KEY120
              STRIP     KEY120
              MOVELPTR  KEY120,F3
              SFORMAT   VAR,127
              SFORMAT   VAR,F3
              MOVE      KEY120,VAR
              WRITE     KEYSTKFL,SEQ;VAR      * Write Key Stroke Variable
              ADD       ONE,COUNT
            DO
            IF        ARRCNT<KEYSTCNT
              GOTO      MAKKEY10              * Get Next Key Stroke
            ENDIF
          ENDIF
.
          MATCH     "Multipl2",KEY120
          IF        @EQUAL
            MOVE      ZERO,COUNT
            WRITE     KEYSTKFL,SEQ;MULTCNT2      * Write count
            WHILE     COUNT < MULTCNT2
              IF        COUNT>0
                ADD       ONE,ARRCNT
                IF        ARRCNT <= 150
                  MOVE      KEYSTARR[ARRCNT],KEY120    * Key Stroke Variable
                ENDIF
              ENDIF
              UNPACK    KEY120,DIM8,KEY120
              STRIP     KEY120
              MOVELPTR  KEY120,F3
              SFORMAT   VAR,127
              SFORMAT   VAR,F3
              MOVE      KEY120,VAR
              WRITE     KEYSTKFL,SEQ;VAR      * Write Key Stroke Variable
              ADD       ONE,COUNT
            DO
            IF        ARRCNT<KEYSTCNT
              GOTO      MAKKEY10              * Get Next Key Stroke
            ENDIF
          ENDIF
.
          MATCH     "Multipl3",KEY120
          IF        @EQUAL
            MOVE      ZERO,COUNT
            WRITE     KEYSTKFL,SEQ;MULTCNT3      * Write count
            WHILE     COUNT < MULTCNT3
              IF        COUNT>0
                ADD       ONE,ARRCNT
                IF        ARRCNT <= 150
                  MOVE      KEYSTARR[ARRCNT],KEY120    * Key Stroke Variable
                ENDIF
              ENDIF
              UNPACK    KEY120,DIM8,KEY120
              STRIP     KEY120
              MOVELPTR  KEY120,F3
              SFORMAT   VAR,127
              SFORMAT   VAR,F3
              MOVE      KEY120,VAR
              WRITE     KEYSTKFL,SEQ;VAR      * Write Key Stroke Variable
              ADD       ONE,COUNT
            DO
            IF        ARRCNT<KEYSTCNT
              GOTO      MAKKEY10              * Get Next Key Stroke
            ENDIF
          ENDIF
.
          MATCH     "Multipl4",KEY120
          IF        @EQUAL
            MOVE      ZERO,COUNT
            WRITE     KEYSTKFL,SEQ;MULTCNT4      * Write count
            WHILE     COUNT < MULTCNT4
              IF        COUNT>0
                ADD       ONE,ARRCNT
                IF        ARRCNT <= 150
                  MOVE      KEYSTARR[ARRCNT],KEY120    * Key Stroke Variable
                ENDIF
              ENDIF
              UNPACK    KEY120,DIM8,KEY120
              STRIP     KEY120
              MOVELPTR  KEY120,F3
              SFORMAT   VAR,127
              SFORMAT   VAR,F3
              MOVE      KEY120,VAR
              WRITE     KEYSTKFL,SEQ;VAR      * Write Key Stroke Variable
              ADD       ONE,COUNT
            DO
            IF        ARRCNT<KEYSTCNT
              GOTO      MAKKEY10              * Get Next Key Stroke
            ENDIF
          ENDIF
.
          MATCH     "Multipl5",KEY120
          IF        @EQUAL
            MOVE      ZERO,COUNT
            WRITE     KEYSTKFL,SEQ;MULTCNT5      * Write count
            WHILE     COUNT < MULTCNT5
              IF        COUNT>0
                ADD       ONE,ARRCNT
                IF        ARRCNT <= 150
                  MOVE      KEYSTARR[ARRCNT],KEY120    * Key Stroke Variable
                ENDIF
              ENDIF
              UNPACK    KEY120,DIM8,KEY120
              STRIP     KEY120
              MOVELPTR  KEY120,F3
              SFORMAT   VAR,127
              SFORMAT   VAR,F3
              MOVE      KEY120,VAR
              WRITE     KEYSTKFL,SEQ;VAR      * Write Key Stroke Variable
              ADD       ONE,COUNT
            DO
            IF        ARRCNT<KEYSTCNT
              GOTO      MAKKEY10              * Get Next Key Stroke
            ENDIF
          ENDIF
.
          STRIP     KEY120
          MOVELPTR  KEY120,F3
          IF        F3=0
            WRITE     KEYSTKFL,SEQ;""      * Write Key Stroke Variable     
          ELSE
            SFORMAT   VAR,127
            SFORMAT   VAR,F3
            MOVE      KEY120,VAR
            WRITE     KEYSTKFL,SEQ;VAR      * Write Key Stroke Variable     
          ENDIF
          IF        ARRCNT<KEYSTCNT
            GOTO      MAKKEY10              * Get Next Key Stroke
          ENDIF         
.
MAKKEY90  CLOSE     KEYSTKFL
.      
MAKKEY99  RETURN
.------------------------------------------------------------
. Get the Import File and Move to a Schedule Based File Name
.   - Return KEY120 with File Name
.------------------------------------------------------------
GETIMP00  MATCH     SP70,LOADFNAM
          GOTO      GETIMP99 IF EQUAL
.
          SCAN      ".",LOADFNAM
          IF        @EQUAL
            MOVE      LOADFNAM,LOADFEXT
          ELSE
            MOVE      ".txt",LOADFEXT
          ENDIF
          RESET     LOADFNAM
          STRIP     RSCNRCD
          PACK      KEY120,RSCNRCD,ANSL,WBSCSCHD,LOADFEXT,SP70
          PACK      DIM187,CMDMV,LOADFNAM,SP1,KEY120,SP70
          EXECUTE   DIM187,TASKID
.
GETIMP99  RETURN
.------------------------------------------------------------
. Get the Import File and Move to a Schedule Based Directory 
. but keep original file name - Return KEY120 with File Name
.------------------------------------------------------------
GETMP100  MATCH     SP70,LOADFNM1
          GOTO      GETMP199 IF EQUAL
.
          RESET     LOADFNM1
          STRIP     RSCNRCD
          PACK      KEY120,RSCNRCD,THEALIT,SP70
          PACK      DIM187,CMDMV,LOADFNM1,SP1,KEY120,SP70
          EXECUTE   DIM187,TASKID
.
GETMP199  RETURN
.------------------------------------------------------------
. Get Next Report Schedule Number
.------------------------------------------------------------
NXTSCH00  PACK      KEY8,Z70
          CALL      RSWBSC1
NXTSCH10  CALL      RPWBSC1
          BRANCH    OVRCD,NXTSCH90
          MOVE      WBSCSCHD,SCHDFLNO
          ADD       ONE,SCHDFLNO
          GOTO      NXTSCH95
.
NXTSCH90  MOVE      ONE,SCHDFLNO
.
NXTSCH95  CALL      CLRSCS00    * Clear All Fields   
          MOVE      SCHDFLNO,WBSCSCHD
          REP       " 0",WBSCSCHD
          MOVE      WBSCSCHD,KEY8
          CALL      RAWBSC1
          IF        OVRCD=1
            MOVE      ZERO,OVRCD
            TRAP      OVERCOND IF IO
            CALL      WRWBSC1
            TRAPCLR   IO
            BRANCH    OVRCD,NXTSCH98
            CALL      RLWBSC1
          ELSE
            GOTO      NXTSCH98
          ENDIF
          GOTO      NXTSCH99
.
NXTSCH98  ADD       ONE,SCHDFLNO
          GOTO      NXTSCH95
.
NXTSCH99  RETURN
.------------------------------------------------------------
. Clear Server Schedule Table Variables 
.------------------------------------------------------------
CLRSCS00  MOVE      SP70,WBSCSCHD   * Schedule No  
          MOVE      SP70,WBSCSTAT   * Status  
          MOVE      SP70,WBSCSCDT   * Schedule Date 
          MOVE      SP70,WBSCSCTM   * Schedule Time 
          MOVE      SP70,WBSCACTV   * Active Process ID
          MOVE      SP70,WBSCUNIX   * Unix Command
          MOVE      SP70,WBSCDSRP   * Description of report
          MOVE      SP70,WBSCRPID   * Report Program ID
          MOVE      SP70,WBSCUSER   * Web User
          MOVE      SP70,WBSCRDTE   * Request Date
          MOVE      SP70,WBSCRTIM   * Request Time
          MOVE      SP70,WBSCSDAT   * Started Date
          MOVE      SP70,WBSCSTIM   * Started Time
          MOVE      ZERO,WBSCSFLG   * Start Flag :Set to 1 by Report Program
          MOVE      ZERO,WBSCOTYP   * Output Type : 0=Text 1=HTML 2=PDF 3=SMS
          MOVE      ZERO,WBSCNREC   * Expected No. of records
          MOVE      ZERO,WBSCNREC   * Expected No. of records
          MOVE      ZERO,WBSCRPRO   * Records Processed
          MOVE      SP70,WBSCUTIM   * Last Update Time
          MOVE      SP70,WBSCPRIN   * Printer
          MOVE      SP70,WBSCSPOO   * Spool File
          MOVE      ZERO,WBSCNCOP   * No of Copies
          MOVE      SP70,WBSCPREP   * Print Report 0=No 1=Yes
          MOVE      SP70,WBSCRDAT   * Re-Schedule Encoded Date String
          MOVE      SP70,WBSCREND   * Re-Schedule End Date
          MOVE      SP70,WBSCPERM   * Save as Permanent Spool File 1=Yes
          MOVE      SP70,WBSCEXCP   * Exclusion Flags - Hols, Mon-Sun
          MOVE      SP70,WBSCHOSP   * Hospital ID (pathspaf)
          MOVE      SP70,WBSCSITE   * Outpatient Site (outsitaf)
          MOVE      SP70,WBSCCDAT   * Completed Date (CCYYMMDD)
          MOVE      SP70,WBSCCTIM   * Completed Time (HH:MM:SS)
          MOVE      SP70,WBSCSPAR   * Spare
.
CLRSCS99  RETURN
.------------------------------------------------------------
. Process Template Fields
.------------------------------------------------------------
PROFLD00  BRANCH    REPORTNO,PROFLD10,PROFLD20,PROFLD30,PROFLD99,PROFLD50:
                             PROFLD60,PROFLD70,PROFLD80,PROFLD90
          GOTO      PROFLD99
.
PROFLD10  BRANCH    FLDSETNO,PROFLD11,PROFLD12
.
PROFLD11  CALL      LREP0000     * List Reports
          GOTO      PROFLD99
.
PROFLD12  CALL      OPTN0000     * Select Options
          GOTO      PROFLD99
.
PROFLD20  CALL      WSCH0000     * Scheduler Item Display 
          GOTO      PROFLD99
.
PROFLD30  CALL      PARM0000     * Scheduler Parameter Display 
          GOTO      PROFLD99
.
PROFLD50  CALL      OUTR0000     * Output Spool File
          GOTO      PROFLD99
.
PROFLD60  CALL      MANG0000     * Output Spool File
          GOTO      PROFLD99
.
PROFLD70  CALL      WEBS0000     * WEB parameter maintenance
          GOTO      PROFLD99
.
PROFLD80  CALL      PARC0000     * Parameter maintenance
          GOTO      PROFLD99
.
PROFLD90  
..        CALL      PRSH0000     * Private Practice Debtors Details Search 
          GOTO      PROFLD99
.
PROFLD99  RETURN
.------------------------------------------------------------
. Management Analysis Generation
.------------------------------------------------------------
MANG0000  BRANCH    FLDITMNO,MANG0100,MANG0200,MANG0300,MANG0400,MANG0500:
                             MANG0600,MANG0700,MANG0800,MANG0900,MANG1000:
                             MANG1100,MANG1200,MANG1300,MANG1400,MANG1500
          GOTO      MANG9999
.
MANG0100  CALL      MANTAB00     * Table of Management Extracts
          GOTO      MANG9999
.
MANG0200  WRITE     HTMLFILE;EXTNUMBR;
          GOTO      MANG9999
.
MANG0300  MATCH     SP70,GENDAT
          GOTO      MANG9999 IF EQUAL
          UNPACK    GENDAT,CCENT,CYEAR,CMON,CDAY
          MOVE      CMON,F2
          LOAD      MTHNAM3,F2,JAN,FEB,MAR,APR,MAY,JUN,JUL,AUG,SEP,OCT,NOV,DEC
          PACK      KEY11,CDAY,SP1,MTHNAM3,SP1,CCENT,CYEAR
          WRITE     HTMLFILE;KEY11;  
          GOTO      MANG9999
.
MANG0400  MATCH     SP70,STRDAT
          GOTO      MANG9999 IF EQUAL
          UNPACK    STRDAT,CCENT,CYEAR,CMON,CDAY
          MOVE      CMON,F2
          LOAD      MTHNAM3,F2,JAN,FEB,MAR,APR,MAY,JUN,JUL,AUG,SEP,OCT,NOV,DEC
          PACK      KEY11,CDAY,SP1,MTHNAM3,SP1,CCENT,CYEAR
          WRITE     HTMLFILE;KEY11;  
          GOTO      MANG9999
.
MANG0500  MATCH     SP70,ENDDAT
          GOTO      MANG9999 IF EQUAL
          UNPACK    ENDDAT,CCENT,CYEAR,CMON,CDAY
          MOVE      CMON,F2
          LOAD      MTHNAM3,F2,JAN,FEB,MAR,APR,MAY,JUN,JUL,AUG,SEP,OCT,NOV,DEC
          PACK      KEY11,CDAY,SP1,MTHNAM3,SP1,CCENT,CYEAR
          WRITE     HTMLFILE;KEY11;  
          GOTO      MANG9999
MANG0600  WRITE     HTMLFILE;OPRNUM;  
          GOTO      MANG9999
MANG0700  WRITE     HTMLFILE;NUMADM;  
          GOTO      MANG9999
MANG0800  WRITE     HTMLFILE;NUMCAS;  
          GOTO      MANG9999
MANG0900  WRITE     HTMLFILE;NUMBDY;  
          GOTO      MANG9999
MANG1000  WRITE     HTMLFILE;NUMAMT;  
          GOTO      MANG9999
MANG1100  WRITE     HTMLFILE;PRIOPS;  
          GOTO      MANG9999
MANG1200  WRITE     HTMLFILE;PRIDIS;  
          GOTO      MANG9999
MANG1300  READ      CONTROLF,FIFTY9;*174,PTCNNDAT
          UNPACK    PTCNNDAT,CCENT,CYEAR,CMON,CDAY
          MOVE      CMON,F2
          LOAD      MTHNAM3,F2,JAN,FEB,MAR,APR,MAY,JUN,JUL,AUG,SEP,OCT,NOV,DEC
          PACK      KEY11,CDAY,SP1,MTHNAM3,SP1,CCENT,CYEAR
          WRITE     HTMLFILE;KEY11;  
          GOTO      MANG9999
.
MANG1400  CALL      RPTSEL00     * PAT93 Analysis Reports list
          GOTO      MANG9999
.
MANG1500  CALL      HOSPID00     * Hospital ID
          GOTO      MANG9999
.
MANG9999  RETURN
.------------------------------------------------------------
. Table of Management Extracts
.------------------------------------------------------------
MANTAB00  MOVE      ZERO,EXTRNO
MANTAB10  ADD       ONE,EXTRNO
          IF        EXTRNO>16
            GOTO      MANTAB99
          ENDIF
          CALL      GETMPR00
          MOVE      EXTRNO,KEY2
          REP       " 0",KEY2
          WRITE     HTMLFILE;"t.addRow(#"":
                             "javascript:ExtractLink('",KEY2,"')#",":
                             "#"",KEY2,"#",":
                             "#"",GENDAT,"#",":
                             "#"",STRDAT,"#",":
                             "#"",ENDDAT,"#",":
                             "#"",OPRNUM,"#",":
                             "#"",NUMADM,"#",":
                             "#"",NUMCAS,"#",":
                             "#"",NUMBDY,"#",":
                             "#"",NUMAMT,"#",":
                             "#"",PRIOPS,"#",":
                             "#"",PRIDIS,"#");"
          GOTO      MANTAB10
.
MANTAB99  RETURN
.
GETMPR00  IF        EXTRNO<9
            MOVE      "11",SECTOR
            ASSIGN    (EXTRNO*30)-29,F3
          ELSE
            MOVE      "12",SECTOR
            ASSIGN    ((EXTRNO-8)*30)-29,F3
          ENDIF
          READ      CONTROLF,SECTOR;*F3,GENDAT,STRDAT,ENDDAT,OPRNUM
          IF        EXTRNO<8
            MOVE      "93",SECTOR
            ASSIGN    (EXTRNO*34)-33,F3
          ELSE
           IF        EXTRNO<15
             MOVE      "94",SECTOR
             ASSIGN    ((EXTRNO-7)*34)-33,F3
           ELSE
             MOVE      "95",SECTOR
             ASSIGN    ((EXTRNO-14)*34)-33,F3
           ENDIF
          ENDIF
          MOVE      ZERO,NUMADM               control file
          MOVE      ZERO,PRIOPS
          MOVE      ZERO,PRIDIS
          MOVE      ZERO,NUMBDY
          MOVE      ZERO,NUMCAS
          MOVE      ZERO,NUMAMT
          READ      CONTROLF,SECTOR;*F3,NUMADM,PRIOPS,PRIDIS,NUMBDY:
                                        NUMCAS,NUMAMT
          RETURN

.------------------------------------------------------------
. Output Report
.------------------------------------------------------------
OUTR0000  BRANCH    FLDITMNO,OUTR0100,OUTR0200
          GOTO      OUTR9999
.
OUTR0100  CALL      REPT0000
          GOTO      OUTR9999
.
OUTR0200  CALL      OUTF0000
          GOTO      OUTR9999
.
OUTR9999  RETURN
.
REPT0000  MOVE      ZERO,CPAGENO
.
REPT1000  READ      SPLTFILE,SEQ;DISPLINE
          GOTO      REPT9999 IF OVER
.
          CMATCH    CPRTFF,DISPLINE                * check for a ^L (form feed)
          GOTO      REPT1100 IF NOT EQUAL
.
          ADD       ONE,CPAGENO
          WRITE     HTMLFILE;"<p class=PageSection>"
.
          BUMP      DISPLINE           * Bump past ^L (form feed)
          MOVE      DISPLINE,DISPLINX
          MOVE      DISPLINX,DISPLINE  * Actually Remove ^L from variable
          STRIP     DISPLINE
.         
REPT1100  WRITE     HTMLFILE;*+,DISPLINE
          GOTO      REPT1000
.
REPT9999  RETURN
.-----------------------------------------------------------------------------
. Dump Raw File
.-----------------------------------------------------------------------------
OUTF0000  READ      SPLTFILE,SEQ;ANS;
          GOTO      OUTF9999 IF OVER
          WRITE     HTMLFILE;ANS;
          GOTO      OUTF0000 
OUTF9999  RETURN
.------------------------------------------------------------
. Report List
.------------------------------------------------------------
LREP0000  BRANCH    FLDITMNO,LREP0100,LREP0200,LREP0300,LREP0400,LREP0500:
                             LREP0600,LREP0700,LREP0800,LREP0900,LREP1000:
                             LREP1100,LREP1200,LREP1300,LREP1400,LREP1500:
                             LREP1600,LREP1700,LREP1800,LREP1900,LREP2000:
                             LREP2100,LREP2200          
          GOTO      LREP9999
.
LREP0100  CALL      USRREP00     * Table of Reports for User 
          GOTO      LREP9999
.
LREP0200  MATCH     "1",SHOWFUTR
          IF        @EQUAL
            CALL      FUTREP00
          ELSE
            CALL      ALLREP00   * Table of Reports (ALL)
          ENDIF

.         CALL      ALLREP00     * Table of Reports (ALL)
          GOTO      LREP9999
.
LREP0300  CALL      USROUT00     * Table of Reports for User Outstanding
          GOTO      LREP9999
.
LREP0400  CALL      OUTREP00     * Table of Reports (ALL) Outstanding
          GOTO      LREP9999
.
LREP0500  CALL      SELV0000     * Current Date
          GOTO      LREP9999
.
LREP0600  WRITE     HTMLFILE;VIEWTYPE;
          GOTO      LREP9999
.
LREP0700  CALL      NEXT0000
          GOTO      LREP9999
.
LREP0800  CALL      PREV0000
          GOTO      LREP9999
.
LREP0900  CALL      RMEN0000
          GOTO      LREP9999
.
LREP1000  CALL      SELSTA00  * Select Status
          GOTO      LREP9999
.
LREP1100  CALL      SELDPT00  * Select Department
          GOTO      LREP9999
.
LREP1200  CALL      PRTTAB00  * Printer Table by Department
          GOTO      LREP9999
.
LREP1300  CALL      RPTSEL00  * list of reports for IBAPAT93
          GOTO      LREP9999
.
LREP1400  PACK      KEY10,USERID,SP70
          CALL      RDWBSE1
          BRANCH    OVRCD,LREP9999
.
          MATCH     SP70,WBSEOCG
          GOTO      LREP9999 IF EQUAL
.
          MOVE      "w0",CATEGORY
          MOVE      WBSEOCG,CODE
          CALL      GETCOD00
          WRITE     HTMLFILE;TDESC;
          GOTO      LREP9999
.
LREP1500  CALL      OCCREP00     * Table of Reports (My Occupational Group)
          GOTO      LREP9999
.
LREP1600  WRITE     HTMLFILE;SHOWSITE;
          GOTO      LREP9999
.
LREP1700  CALL      REDPAR00
          MATCH     SP70,CWEBCLOC         * Storage Location Key from controlf
          GOTO      LREP9999 IF EQUAL
          PACK      KEY4,CWEBCLOC,SP70    * Current Storage Location Details
          CALL      RDOBPT1
          IF        OVRCD=1
            WRITE     HTMLFILE;"Location Not Found";
          ELSE
            WRITE     HTMLFILE;OBPTSDIR;
          ENDIF
          GOTO      LREP9999
.
LREP1800  CALL      UEMREP00
          GOTO      LREP9999
.
LREP1900  CALL      AEMREP00
          GOTO      LREP9999
.
LREP2000  WRITE     HTMLFILE;MENUFLAG;
          GOTO      LREP9999
.
LREP2100  WRITE     HTMLFILE;EXPORTDE;
          GOTO      LREP9999
.
LREP2200  WRITE     HTMLFILE;SHOWFUTR;
          GOTO      LREP9999
.
LREP9999  RETURN
.------------------------------------------------------------
. List ED Discharge Summary Reports by User
.------------------------------------------------------------
UEMREP00  PACK      KEY34,EMRSCH88,FRSTDATE,USERID,SP70
          CALL      RSWBSC5
UEMREP10  CALL      RKWBSC5
          BRANCH    OVRCD,UEMREP99
.
          MATCH     EMRSCH88,WBSCRPID
          GOTO      UEMREP99 IF NOT EQUAL
.
          MATCH     WBSCSCDT,LASTDATE
          GOTO      UEMREP99 IF LESS
.
          MATCH     USERID,WBSCUSER
          GOTO      UEMREP10 IF NOT EQUAL
.
          CALL      USRROW00
          GOTO      UEMREP10
.
UEMREP99  RETURN
.------------------------------------------------------------
. List All ED Discharge Summary Reports 
.------------------------------------------------------------
AEMREP00  PACK      KEY34,EMRSCH88,FRSTDATE,SP70
          CALL      RSWBSC5
AEMREP10  CALL      RKWBSC5
          BRANCH    OVRCD,AEMREP99
.
          MATCH     EMRSCH88,WBSCRPID
          GOTO      AEMREP99 IF NOT EQUAL
.
          MATCH     WBSCSCDT,LASTDATE
          GOTO      AEMREP99 IF LESS
.
          CALL      ALLROW00
          GOTO      AEMREP10
.
AEMREP99  RETURN
.------------------------------------------------------------
. Select Printer Department
.------------------------------------------------------------
SELDPT00  MOVE      SP70,KEY6
          CALL      RSIBDPT1
SELDPT10  CALL      RKIBDPT1
          BRANCH    OVRCD,SELDPT99
.
          MATCH     PRINTDPT,IBDPDEPT
          IF        @EQUAL
            WRITE     HTMLFILE;"<option value=#"",IBDPDEPT,"#" selected>":
                               IBDPDESC,"</option>"
          ELSE
            WRITE     HTMLFILE;"<option value=#"",IBDPDEPT,"#">":
                               IBDPDESC,"</option>"
          ENDIF
          GOTO      SELDPT10
.
SELDPT99  RETURN
.------------------------------------------------------------
. Printers by Department
.------------------------------------------------------------
PRTTAB00  PACK      KEY15,PRINTDPT,SP70
          CALL      RSIBCOD2
PRTTAB10  CALL      RKIBCOD2
          BRANCH    OVRCD,PRTTAB99
          MATCH     IBPDDEPT,PRINTDPT
          GOTO      PRTTAB99 IF NOT EQUAL
.
          MOVE      IBPDPRTR,KEY6
.
          UNPACK    KEY6,DIM1A,DIM1B,DIM1C,DIM1D,DIM1E,DIM1F
          MATCH     "0",DIM1A
          GOTO      PRTTAB30 IF NOT EQUAL
. 
          MOVE      SP1,DIM1A
.
          MATCH     "0",DIM1B
          GOTO      PRTTAB20 IF NOT EQUAL
. 
          MOVE      SP1,DIM1B
.
          MATCH     "0",DIM1C
          GOTO      PRTTAB20 IF NOT EQUAL
. 
          MOVE      SP1,DIM1C
.
          MATCH     "0",DIM1D
          GOTO      PRTTAB20 IF NOT EQUAL
. 
          MOVE      SP1,DIM1D
.
          MATCH     "0",DIM1E
          GOTO      PRTTAB20 IF NOT EQUAL
. 
          MOVE      SP1,DIM1E
.
PRTTAB20  PACK      KEY6,DIM1A,DIM1B,DIM1C,DIM1D,DIM1E,DIM1F
.
PRTTAB30  CALL      RDPRTA1
          BRANCH    OVRCD,PRTTAB10
.
          CLEAR     HTMLLINK
          APPEND    "javascript:UpdatePrinter('",HTMLLINK
          APPEND    PRXCODE,HTMLLINK
          APPEND    "','",HTMLLINK
          APPEND    PRXDESC,HTMLLINK
          APPEND    "');",HTMLLINK
          RESET     HTMLLINK
.
          WRITE     HTMLFILE;"t.addRow(#"",HTMLLINK,"#",":
                             "#"",IBPDPRTR,"#",":
                             "#"",PRTDESC,"#");"
          GOTO      PRTTAB10
PRTTAB99  RETURN
.------------------------------------------------------------
. Generate Status Select List
.------------------------------------------------------------
SELSTA00  MATCH     SP1,STATCODE
          IF        @EQUAL
            WRITE     HTMLFILE;"<option value=#" #" selected>All</option>"
          ELSE
            WRITE     HTMLFILE;"<option value=#" #">All</option>"
          ENDIF
.
          MATCH     "0",STATCODE
          IF        @EQUAL
            WRITE     HTMLFILE;"<option value=#"0#" selected>Executing</option>"
          ELSE
            WRITE     HTMLFILE;"<option value=#"0#">Executing</option>"
          ENDIF
.
          MATCH     "1",STATCODE
          IF        @EQUAL
            WRITE     HTMLFILE;"<option value=#"1#" selected>Queued</option>"
          ELSE
            WRITE     HTMLFILE;"<option value=#"1#">Queued</option>"
          ENDIF
.
          MATCH     "6",STATCODE
          IF        @EQUAL
            WRITE     HTMLFILE;"<option value=#"6#" selected>Failed</option>"
          ELSE
            WRITE     HTMLFILE;"<option value=#"6#">Failed</option>"
          ENDIF
.
          MATCH     "7",STATCODE
          IF        @EQUAL
            WRITE     HTMLFILE;"<option value=#"7#" selected>No Output</option>"
          ELSE
            WRITE     HTMLFILE;"<option value=#"7#">No Output</option>"
          ENDIF
.
          MATCH     "8",STATCODE
          IF        @EQUAL
            WRITE     HTMLFILE;"<option value=#"8#" selected>Spooled</option>"
          ELSE
            WRITE     HTMLFILE;"<option value=#"8#">Spooled</option>"
          ENDIF
.
          MATCH     "9",STATCODE
          IF        @EQUAL
            WRITE     HTMLFILE;"<option value=#"9#" selected>Printed</option>"
          ELSE
            WRITE     HTMLFILE;"<option value=#"9#">Printed</option>"
          ENDIF
.
SELSTA99  RETURN
.------------------------------------------------------------
. Generate Report Menu 
.------------------------------------------------------------
RMEN0000  PACK      KEY15,USERID,SP70
          CALL      RSWBRUR1
RMEN1000  CALL      RKWBRUR1
          BRANCH    OVRCD,RMEN9999
.
          MATCH     USERID,WBRUUSID
          GOTO      RMEN9999 IF NOT EQUAL
.
          PACK      KEY5,WBRUGRID,SP70      * get group id description
          CALL      RDWBRGM1
          BRANCH    OVRCD,RMEN1000
.
          WRITE     HTMLFILE;"<select class=MenuSelectList ":
                             "onchange='MenuLinkTo(this);' ":
                             "onmouseover='MenuOver(this)'>"
.
          WRITE     HTMLFILE;"<option value=0>",WBRGDESC,"</option>"
.
          WRITE     HTMLFILE;"<option value='../cgi-bin/rshweb02.pbl?":
                             "reportno=1&template=1|content'>":
                             "View Scheduled Reports</option>"
.
.         Get programs id for the group id
.
          PACK      KEY16,WBRUGRID,SP20
          CALL      RSWBRDT1
RMEN2000  CALL      RKWBRDT1
          BRANCH    OVRCD,RMEN2900
.
          MATCH     WBRUGRID,WBRDGRID      * Same report group id ?
          GOTO      RMEN2900 IF NOT EQUAL
.
          PACK      KEY11,WBRDPRID,WBRDTMID  * program id, template no.
          CALL      RDWBRTM1                 * get program description
          BRANCH    OVRCD,RMEN2000
.
          REP       DOWNCASE,WBRDPRID
          WRITE     HTMLFILE;"<option value='../cgi-bin/rshweb02.pbl?":
                             "reportno=1&template=",WBRDTMID:
                             "&reportid=",WBRDPRID,"|content'>":
                             WBRTDESC,"</option>"
.
          GOTO      RMEN2000     * get next program id
.
RMEN2900  WRITE     HTMLFILE;"</select>"
          GOTO      RMEN1000     * get next 
.
RMEN9999  RETURN
.
.------------------------------------------------------------
. Next Day, Week, Month
.------------------------------------------------------------
NEXT0000  MOVE      VIEWTYPE,F1 
          BRANCH    F1,NEXT0100,NEXT0200
          WRITE     HTMLFILE;"SelectNextDay();";
          GOTO      NEXT9999
NEXT0100  WRITE     HTMLFILE;"SelectNextWeek();";
          GOTO      NEXT9999
NEXT0200  WRITE     HTMLFILE;"SelectNextMonth();";
          GOTO      NEXT9999
NEXT9999  RETURN
.------------------------------------------------------------
. Last Day, Week, Month
.------------------------------------------------------------
PREV0000  MOVE      VIEWTYPE,F1
          BRANCH    F1,PREV0100,PREV0200
          WRITE     HTMLFILE;"SelectLastDay();";
          GOTO      PREV9999
PREV0100  WRITE     HTMLFILE;"SelectLastWeek();";
          GOTO      PREV9999
PREV0200  WRITE     HTMLFILE;"SelectLastMonth();";
          GOTO      PREV9999
PREV9999  RETURN
.------------------------------------------------------------
. Scheduler Item Display & Maintenance
.------------------------------------------------------------
WSCH0000  BRANCH    FLDITMNO,WSCH0100,WSCH0200,WSCH0300,WSCH0400,WSCH0500:
                             WSCH0600,WSCH0700,WSCH0800,WSCH0900,WSCH1000:
                             WSCH1100,WSCH1200,WSCH1300,WSCH1400,WSCH1500:
                             WSCH1600,WSCH1700,WSCH1800,WSCH1900,WSCH2000:
                             WSCH2100,WSCH2200,WSCH2300,WSCH2400,WSCH2500:
                             WSCH2600,WSCH2700,WSCH2800,WSCH2900,WSCH3000:
                             WSCH3100,WSCH3200,WSCH3300
          GOTO      WSCH9999
.
WSCH0100  WRITE     HTMLFILE;WBSCSCHD;    * Scheduler No
          GOTO      WSCH9999
.
WSCH0200  CALL      STATUS00              * Displays Current Status
          GOTO      WSCH9999
.
WSCH0300  MATCH     SP70,WBSCSCDT      * Scheduler Date   
          GOTO      WSCH9999 IF EQUAL
          UNPACK    WBSCSCDT,CCENT,CYEAR,CMON,CDAY  
          MOVE      CMON,F2
          LOAD      MTHNAM3,F2,JAN,FEB,MAR,APR,MAY,JUN,JUL,AUG,SEP,OCT,NOV,DEC
          PACK      KEY11,CDAY,SP1,MTHNAM3,SP1,CCENT,CYEAR
          WRITE     HTMLFILE;KEY11;  
          GOTO      WSCH9999
.
WSCH0400  MATCH     SP70,WBSCSCTM
          GOTO      WSCH9999 IF EQUAL
          WRITE     HTMLFILE;WBSCSCTM;    * Scheduler Time
          GOTO      WSCH9999
.
WSCH0500  MATCH     SP70,WBSCACTV
          GOTO      WSCH9999 IF EQUAL
          WRITE     HTMLFILE;WBSCACTV;    * Active Process ID
          GOTO      WSCH9999
.
WSCH0600  MATCH     SP70,WBSCUNIX 
          GOTO      WSCH9999 IF EQUAL
          WRITE     HTMLFILE;WBSCUNIX;    * Unix Command
          GOTO      WSCH9999
.
WSCH0700  MATCH     SP70,WBSCDSRP
          GOTO      WSCH9999 IF EQUAL
          WRITE     HTMLFILE;WBSCDSRP;    * Description of Report
          GOTO      WSCH9999
.
WSCH0800  MATCH     SP70,WBSCRPID
          GOTO      WSCH9999 IF EQUAL
          WRITE     HTMLFILE;WBSCRPID;    * Report Program ID
          GOTO      WSCH9999
.
WSCH0900  MATCH     SP70,WBSCUSER 
          GOTO      WSCH9999 IF EQUAL
          WRITE     HTMLFILE;WBSCUSER;    * Web User
          GOTO      WSCH9999
.
WSCH1000  MATCH     SP70,WBSCRDTE         * Request Date
          GOTO      WSCH9999 IF EQUAL
          UNPACK    WBSCRDTE,CCENT,CYEAR,CMON,CDAY  
          MOVE      CMON,F2
          LOAD      MTHNAM3,F2,JAN,FEB,MAR,APR,MAY,JUN,JUL,AUG,SEP,OCT,NOV,DEC
          PACK      KEY11,CDAY,SP1,MTHNAM3,SP1,CCENT,CYEAR
          WRITE     HTMLFILE;KEY11;   
          GOTO      WSCH9999
.
WSCH1100  MATCH     SP70,WBSCRTIM  
          GOTO      WSCH9999 IF EQUAL
          WRITE     HTMLFILE;WBSCRTIM;    * Request Time
          GOTO      WSCH9999
.
WSCH1200  MATCH     SP70,WBSCSDAT         * Started Date
          GOTO      WSCH9999 IF EQUAL
          UNPACK    WBSCSDAT,CCENT,CYEAR,CMON,CDAY  
          MOVE      CMON,F2
          LOAD      MTHNAM3,F2,JAN,FEB,MAR,APR,MAY,JUN,JUL,AUG,SEP,OCT,NOV,DEC
          PACK      KEY11,CDAY,SP1,MTHNAM3,SP1,CCENT,CYEAR
          WRITE     HTMLFILE;KEY11;   
          GOTO      WSCH9999
.
WSCH1300  MATCH     SP70,WBSCSTIM
          GOTO      WSCH9999 IF EQUAL
          WRITE     HTMLFILE;WBSCSTIM;    * Started Time
          GOTO      WSCH9999
.
WSCH1400  COMPARE   ZERO,WBSCSFLG
          GOTO      WSCH9999 IF EQUAL
          WRITE     HTMLFILE;WBSCSFLG;    * Started Flag
          GOTO      WSCH9999
.
WSCH1500  BRANCH    WBSCOTYP,WSCH1510,WSCH1520,WSCH1530
.
          WRITE     HTMLFILE;"Text";      * Output Type=0
          GOTO      WSCH9999
.
WSCH1510  WRITE     HTMLFILE;"HTML";      * Output Type=1
          GOTO      WSCH9999
.
WSCH1520  WRITE     HTMLFILE;"PDF";       * Output Type=2
          GOTO      WSCH9999
.
WSCH1530  WRITE     HTMLFILE;"SMS";       * Output Type=3
          GOTO      WSCH9999
.
WSCH1600  COMPARE   ZERO,WBSCNREC
          GOTO      WSCH9999 IF EQUAL
          WRITE     HTMLFILE;WBSCNREC;    * Expected No. of Records
          GOTO      WSCH9999
.
WSCH1700  COMPARE   ZERO,WBSCRPRO
          GOTO      WSCH9999 IF EQUAL
          WRITE     HTMLFILE;WBSCRPRO;    * Records processed
          GOTO      WSCH9999
.
WSCH1800  MATCH     SP70,WBSCUTIM
          GOTO      WSCH9999 IF EQUAL
          WRITE     HTMLFILE;WBSCUTIM;    * Last Update Time          
          GOTO      WSCH9999
.
WSCH1900  MOVE      WBSCPRIN,CDEFPRT
          CALL      SELPRT00
          GOTO      WSCH9999
.
WSCH2000  MATCH     SP70,WBSCSPOO
          GOTO      WSCH9999 IF EQUAL
          WRITE     HTMLFILE;WBSCSPOO;    * Spool File             
          GOTO      WSCH9999
.
WSCH2100  COMPARE   ZERO,WBSCNCOP
          GOTO      WSCH9999 IF EQUAL
          WRITE     HTMLFILE;WBSCNCOP;    * No of Copies           
          GOTO      WSCH9999
.
WSCH2200  MOVE      WBSCPREP,F1           * Print Report 
          IF        F1=1
            WRITE     HTMLFILE;"Yes";   * 1=Yes
          ELSE
            WRITE     HTMLFILE;"No";    * 0=No 
          ENDIF
          GOTO      WSCH9999
.
WSCH2300  WRITE     HTMLFILE;WBSCRDAT; 
          GOTO      WSCH9999
.
WSCH2400  MATCH     SP70,WBSCREND         * End of Re-schedule
          GOTO      WSCH9999 IF EQUAL
          UNPACK    WBSCREND,CCENT,CYEAR,CMON,CDAY  
          MOVE      CMON,F2
          LOAD      MTHNAM3,F2,JAN,FEB,MAR,APR,MAY,JUN,JUL,AUG,SEP,OCT,NOV,DEC
          PACK      KEY11,CDAY,SP1,MTHNAM3,SP1,CCENT,CYEAR
          WRITE     HTMLFILE;KEY11;   
          GOTO      WSCH9999
.
WSCH2500  MOVE      ZERO,F1
          MOVE      WBSCPERM,F1       
          IF        F1=1
            WRITE     HTMLFILE;"Yes";   * 1=Yes
          ELSE
            WRITE     HTMLFILE;"No";    * 0=No 
          ENDIF
          GOTO      WSCH9999
.
WSCH2600  WRITE     HTMLFILE;WBSCEXCP;
          GOTO      WSCH9999
.
WSCH2700  READ      CONTROLF,HUND02;*7,RSCNRCD
          PACK      KEY80,RSCNRCD,WBSCSCHD,KEYSTKNM
          SQUEEZE   KEY80
.
          MOVE      ZERO,OVRCD
          TRAP      OVERCOND IF ALL
          OPEN      KEYSTKFL,KEY80
          TRAPCLR   ALL
          BRANCH    OVRCD,WSCH2730
.
WSCH2710  READ      KEYSTKFL,SEQ;TEXTLINE
          GOTO      WSCH2720 IF OVER
.
          WRITE     HTMLFILE;*+,TEXTLINE,"\n";
          GOTO      WSCH2710
.
WSCH2720  CLOSE     KEYSTKFL
          GOTO      WSCH9999
.
WSCH2730  WRITE     HTMLFILE;"";
          GOTO      WSCH9999
.
WSCH2800  READ      CONTROLF,EIGHTY8;*102,CFEEDT
          UNPACK    CFEEDT,CCENT,CYEAR,CMON,CDAY
          MOVE      CMON,F2
          LOAD      MTHNAM3,F2,JAN,FEB,MAR,APR,MAY,JUN,JUL,AUG,SEP,OCT,NOV,DEC
          WRITE     HTMLFILE;CDAY,SP1,MTHNAM3,SP1,CCENT,CYEAR;
          GOTO      WSCH9999
.
WSCH2900  UNPACK    DIM127,D1,KEY1,DIM127
          MOVE      ZERO,F1
          MOVE      KEY1,F1
          BRANCH    F1,WSCH2910
. 
          MATCH     SP70,WBSCPRIN
          GOTO      WSCH9999 IF EQUAL
          WRITE     HTMLFILE;WBSCPRIN;    * Printer             
          GOTO      WSCH9999
.
WSCH2910  MATCH     SP70,WBSCPRIN
          GOTO      WSCH9999 IF EQUAL
.
          MOVE      WBSCPRIN,KEY6 
          CALL      RDPRTA1
          BRANCH    OVRCD,WSCH9999
.
          WRITE     HTMLFILE;PRTDESC;    * Printer description
          GOTO      WSCH9999
.
WSCH3000  MATCH     SP70,WBSCCDAT         * Completed Date
          GOTO      WSCH9999 IF EQUAL
.
          UNPACK    WBSCCDAT,CCENT,CYEAR,CMON,CDAY
          MOVE      CMON,F2
          LOAD      MTHNAM3,F2,JAN,FEB,MAR,APR,MAY,JUN,JUL,AUG,SEP,OCT,NOV,DEC
          PACK      KEY11,CDAY,SP1,MTHNAM3,SP1,CCENT,CYEAR
          WRITE     HTMLFILE;KEY11;
          GOTO      WSCH9999
.
WSCH3100  MATCH     SP70,WBSCCTIM
          GOTO      WSCH9999 IF EQUAL
.
          WRITE     HTMLFILE;WBSCCTIM;    * Completed Time
          GOTO      WSCH9999
.
WSCH3200  MOVE      TEMPLATE,F3
          MOVE      F3,KEY3
          REP       " 0",KEY3
.
          MATCH     SP70,WBSCRPID
          GOTO      WSCH9999 IF EQUAL
          PACK      KEY13,WBSCRPID,DZERO,KEY3,SP70
          CALL      RDWBTP1
          BRANCH    OVRCD,WSCH9999
.
          WRITE     HTMLFILE;WBTPLEV;    * Template Security Level
          GOTO      WSCH9999
.
WSCH3300  PACK      KEY18,WBSEUID,WBSCRPID,SP70
          CALL      RDWBST1
          BRANCH    OVRCD,WSCH9999
.
          WRITE     HTMLFILE;WBSTLEV;    * User Security Level
          GOTO      WSCH9999
.
WSCH9999  RETURN
.------------------------------------------------------------
. Scheduler Parameters 
.------------------------------------------------------------
PARM0000  CALL      REDPAR00
          BRANCH    FLDITMNO,PARM0100,PARM0200,PARM0300,PARM0400,PARM0500:
                             PARM0600,PARM0700,PARM0800,PARM0900,PARM1000:
                             PARM1100,PARM1200,PARM1300,PARM1400,PARM1500:
                             PARM1600,PARM1700,PARM1800,PARM1900
          GOTO      PARM9999
.
PARM0100  COMPARE   ZERO,RSCNCCP
          GOTO      PARM9999 IF EQUAL
          WRITE     HTMLFILE;RSCNCCP;     * Number of Concurrent Processes 
          GOTO      PARM9999
.
PARM0200  COMPARE   ZERO,RSCNSLP
          GOTO      PARM9999 IF EQUAL
          WRITE     HTMLFILE;RSCNSLP;     * Sleep Time 
          GOTO      PARM9999
.
PARM0300  MATCH     SP70,RSCNRCD
          GOTO      PARM9999 IF EQUAL
          WRITE     HTMLFILE;RSCNRCD;     * Report Configuration File Directory
          GOTO      PARM9999
.
PARM0400  MATCH     SP70,RSCNROD
          GOTO      PARM9999 IF EQUAL
          WRITE     HTMLFILE;RSCNROD;     * Report Output Directory
          GOTO      PARM9999
.
PARM0500  MATCH     SP70,RSCNCMD 
          GOTO      PARM9999 IF EQUAL
          WRITE     HTMLFILE;RSCNCMD;    * Optional Command Line Parameter 1
          GOTO      PARM9999
.
PARM0600  MATCH     SP70,RSCNCLP1
          GOTO      PARM9999 IF EQUAL
          WRITE     HTMLFILE;RSCNCLP1;    * Optional Command Line Parameter 1
          GOTO      PARM9999
.
PARM0700  MATCH     SP70,RSCNCLP2
          GOTO      PARM9999 IF EQUAL
          WRITE     HTMLFILE;RSCNCLP2;    * Optional Command Line Parameter 2
          GOTO      PARM9999
.
PARM0800  MATCH     SP70,RSCNCLP3
          GOTO      PARM9999 IF EQUAL
          WRITE     HTMLFILE;RSCNCLP3;    * Optional Command Line Parameter 3
          GOTO      PARM9999
.
PARM0900  MATCH     SP70,RSCNCLP4
          GOTO      PARM9999 IF EQUAL
          WRITE     HTMLFILE;RSCNCLP4;    * Optional Command Line Parameter 4
          GOTO      PARM9999
.
PARM1000  MATCH     SP70,RSCNCLP5
          GOTO      PARM9999 IF EQUAL
          WRITE     HTMLFILE;RSCNCLP5;    * Optional Command Line Parameter 5
          GOTO      PARM9999
.
PARM1100  MATCH     SP70,RSCNSPDL
          GOTO      PARM9999 IF EQUAL
          WRITE     HTMLFILE;RSCNSPDL;    * Auto Delete Spool X Days
          GOTO      PARM9999
.
PARM1200  MATCH     SP70,RSCNCMDL
          GOTO      PARM9999 IF EQUAL
          WRITE     HTMLFILE;RSCNCMDL;    * Auto Delete Comp/Fail X Days
          GOTO      PARM9999
.
PARM1300  MATCH     SP70,RSCNEXT 
          GOTO      PARM9999 IF EQUAL
          WRITE     HTMLFILE;RSCNEXT;     * Report Extract output directory
          GOTO      PARM9999
.
PARM1400  MATCH     SP70,CWEBPCMD
          GOTO      PARM9999 IF EQUAL
          WRITE     HTMLFILE;CWEBPCMD;    * Remote Password Command         
          GOTO      PARM9999
.
PARM1500  MATCH     SP70,CWEBPFIL
          GOTO      PARM9999 IF EQUAL
          WRITE     HTMLFILE;CWEBPFIL;    * Remote Password File         
          GOTO      PARM9999
.
PARM1600  MATCH     SP70,CWEBROOT
          GOTO      PARM9999 IF EQUAL
          WRITE     HTMLFILE;CWEBROOT;    * HTML Root Directory          
          GOTO      PARM9999
.
PARM1700  MATCH     SP70,CWEBCLOC
          GOTO      PARM9999 IF EQUAL
          WRITE     HTMLFILE;CWEBCLOC;    * Current Storage Location     
          GOTO      PARM9999
.
PARM1800  MATCH     SP70,RSCNTIMD
          GOTO      PARM9999 IF EQUAL
          WRITE     HTMLFILE;RSCNTIMD;    * Time of day to run auto delete spool
          GOTO      PARM9999              * files
.
PARM1900  MATCH     SP70,CWEBGFIL
          GOTO      PARM9999 IF EQUAL
          WRITE     HTMLFILE;CWEBGFIL;    * Remote Group File            
          GOTO      PARM9999
.
PARM9999  RETURN
.------------------------------------------------------------
. WEB Parameter screen 
.------------------------------------------------------------
WEBS0000  CALL      RIBPAR00
          BRANCH    FLDITMNO,WEBS0100
          GOTO      WEBS9999
.
WEBS0100  MATCH     SP70,CWEBPASS
          GOTO      WEBS9999 IF EQUAL
          WRITE     HTMLFILE;CWEBPASS;     * Password
          GOTO      WEBS9999
.
WEBS9999  RETURN
.------------------------------------------------------------
. Validate password and key
.------------------------------------------------------------
VPAS0000  CALL      RIBPAR00
          MOVE      ZERO,EXIT
          MATCH     IBAFLD01,CWEBPASS
          GOTO      VPAS8000 IF NOT EQUAL
.
          MOVE      IBAFLD02,FORM8
          SUB       CDD,FORM8
          SUB       CMM,FORM8
          SUB       CYY,FORM8
          COMPARE   ZERO,FORM8
          GOTO      VPAS9999 IF EQUAL
.
          PACK      WEBTITLE,PRGID,SP1,VERSION,SP1,PRGNAM,SP70
          MOVE      "INVALID KEY FIELD",WEBTITLE
          CALL      WEBERR00   * Create Output File and Write HTML Page Header
          MOVE      ONE,EXIT
          GOTO      VPAS9999
.
VPAS8000  PACK      WEBTITLE,PRGID,SP1,VERSION,SP1,PRGNAM,SP70
          MOVE      "INVALID PASSWORD",WEBTITLE
          CALL      WEBERR00   * Create Output File and Write HTML Page Header
          MOVE      ONE,EXIT
          GOTO      VPAS9999
.
VPAS9999  RETURN
.------------------------------------------------------------
. Display Status Description
.------------------------------------------------------------
STATUS00  MOVE      WBSCSTAT,F1
          BRANCH    F1,STATUS10,STATUS20,STATUS30,STATUS40,STATUS50,STATUS60:
                       STATUS70,STATUS80,STATUS90 
.          
          WRITE     HTMLFILE;F1," - Current Execution";       * Status=0
          GOTO      STATUS99
.
STATUS10  WRITE     HTMLFILE;F1," - Awaiting Execution";      * Status=1
          GOTO      STATUS99
.
STATUS20  
          GOTO      STATUS99
.
STATUS30  
          GOTO      STATUS99
.
STATUS40  
          GOTO      STATUS99
.
STATUS50 
          GOTO      STATUS99
.
STATUS60  WRITE     HTMLFILE;F1," - Failed PID";               * Status=67 
          GOTO      STATUS99
.
STATUS70  WRITE     HTMLFILE;F1," - Completed & No Output";   * Status=7
          GOTO      STATUS99
.
STATUS80  WRITE     HTMLFILE;F1," - Completed & Spooled";     * Status=8
          GOTO      STATUS99
.
STATUS90  WRITE     HTMLFILE;F1," - Completed & Printed";     * Status=9
          GOTO      STATUS99
.
STATUS99  RETURN
.------------------------------------------------------------
. Output a Table of Scheduled Reports for a User
.------------------------------------------------------------
USRREP00  PACK      KEY26,WBSEUID,FRSTDATE,SP70
          CALL      RSWBSC3
USRREP10  CALL      RKWBSC3
          BRANCH    OVRCD,USRREP99
          MATCH     WBSCUSER,WBSEUID
          GOTO      USRREP99 IF NOT EQUAL
.
          MATCH     WBSCSCDT,LASTDATE
          GOTO      USRREP99 IF LESS
.
          MATCH     SP70,STATCODE
          IF        !@EQUAL
            MATCH     STATCODE,WBSCSTAT
            GOTO      USRREP10 IF NOT EQUAL
          ENDIF
.
          CALL      USRROW00
          GOTO      USRREP10    * Read next Record
.
USRREP99  RETURN
.------------------------------------------------------------
. Output a Table of Scheduled Reports for a User
.------------------------------------------------------------
USROUT00  PACK      KEY26,WBSEUID,Z70
          CALL      RSWBSC3
USROUT10  CALL      RPWBSC3
          BRANCH    OVRCD,USROUT99
          MATCH     WBSCUSER,WBSEUID
          GOTO      USROUT99 IF NOT EQUAL
          MATCH     "0",WBSCSTAT  
          GOTO      USROUT20 IF EQUAL
          MATCH     "1",WBSCSTAT 
          GOTO      USROUT10 IF NOT EQUAL
.
USROUT20  CALL      USRROW00
          GOTO      USROUT10    * Read next Record
.
USROUT99  RETURN
.
USRROW00  CLEAR     HTMLLNK1
          MATCH     "1",WBSCSTAT,F1
          IF        @EQUAL
            APPEND    "javascript:EditSchedule('",HTMLLNK1
          ELSE
            MATCH     "8",WBSCSTAT
            IF        @EQUAL
              APPEND    "javascript:EditReport('",HTMLLNK1
            ELSE
              APPEND    "javascript:EditProcess('",HTMLLNK1
            ENDIF
          ENDIF
          APPEND    WBSCSCHD,HTMLLNK1
          APPEND    "')",HTMLLNK1
          RESET     HTMLLNK1
          CLEAR     HTMLLNK2
          MATCH     "8",WBSCSTAT
          IF        @EQUAL
            APPEND    "javascript:ViewReport('",HTMLLNK2
            APPEND    WBSCSCHD,HTMLLNK2
            APPEND    "','",HTMLLNK2
            APPEND    WBSCOTYP,HTMLLNK2
            APPEND    "')",HTMLLNK2
          ELSE
            APPEND    "javascript:alert('No Spool File.')",HTMLLNK2
          ENDIF
          RESET     HTMLLNK2
          MOVE      ZERO,F1
          MOVE      WBSCSTAT,F1
          MOVE      STATDES0,STATDESC
          LOAD      STATDESC,F1,STATDES1,STATDES2,STATDES3,STATDES4,STATDES5:
                                STATDES6,STATDES7,STATDES8,STATDES9
          MOVE      SP70,PRTDESC
          MATCH     "S  ",WBSCPRIN
          GOTO      USRROW30 IF EQUAL
.
          MOVE      WBSCPRIN,KEY6
          UNPACK    KEY6,DIM1A,DIM1B,DIM1C,DIM1D,DIM1E,DIM1F
          MATCH     "0",DIM1A
          GOTO      USRROW20 IF NOT EQUAL
. 
          MOVE      SP1,DIM1A
.
          MATCH     "0",DIM1B
          GOTO      USRROW10 IF NOT EQUAL
. 
          MOVE      SP1,DIM1B
.
          MATCH     "0",DIM1C
          GOTO      USRROW10 IF NOT EQUAL
. 
          MOVE      SP1,DIM1C
.
          MATCH     "0",DIM1D
          GOTO      USRROW10 IF NOT EQUAL
. 
          MOVE      SP1,DIM1D
.
          MATCH     "0",DIM1E
          GOTO      USRROW10 IF NOT EQUAL
. 
          MOVE      SP1,DIM1E
.
USRROW10  PACK      KEY6,DIM1A,DIM1B,DIM1C,DIM1D,DIM1E,DIM1F
.
USRROW20  CALL      RDPRTA1
.
USRROW30  MOVE      SP70,TXTCOLOR
          MATCH     "1",WBSCPERM
          IF        @EQUAL
            MOVE      "UnderlineRed",TXTCOLOR
          ENDIF
.
          WRITE     HTMLFILE;"t.addRow(#"",HTMLLNK1,"#",":
                             "#"",HTMLLNK2,"#",":
                             "#"",WBSCSCHD,"#",":
                             "#"",WBSCDSRP,"#",":
                             "#"",WBSCSCDT,WBSCSCTM,"#",":
                             "#"",WBSCSDAT,WBSCSTIM,"#",":
                             "#"",STATDESC,"#",":
                             "#"",PRTDESC,"#",":
                             "#"",WBSCSPOO,"#",":
                             "#"",WBSCPERM,"#",":
                             "#"",TXTCOLOR,"#",":
                             "#"",WBSCCDAT,WBSCCTIM,"#");"
          RETURN
.
.----------------------------------------------------------------
. Output a Table of Waiting and Processing Reports for all Users
.----------------------------------------------------------------
ALLREP00  MOVE      ZERO,DISNUMB  
          PACK      KEY16,FRSTDATE,SP70
          CALL      RSWBSC4
ALLREP10  CALL      RKWBSC4
          BRANCH    OVRCD,ALLREP99
.
          MATCH     WBSCSCDT,LASTDATE
          GOTO      ALLREP99 IF LESS
.
          MATCH     "1",SHOWQUED             * Filter Status Reports   
          IF        @EQUAL
            MATCH     "1",WBSCSTAT
            GOTO      ALLREP10 IF NOT EQUAL
          ENDIF
.
ALLREP30  MATCH     SP70,FLTUSRID             * Filter by User
          IF        !@EQUAL
            MATCH     FLTUSRID,WBSCUSER
            GOTO      ALLREP10 IF NOT EQUAL
          ENDIF
.
          MATCH     SP70,FLTPRGID             * Filter by Program
          IF        !@EQUAL
            MATCH     FLTPRGID,WBSCRPID
            GOTO      ALLREP10 IF NOT EQUAL
          ENDIF
.
          MATCH     "1",DELTEREP
          IF        @EQUAL
            CALL      NSPROW00
          ELSE
            CALL      ALLROW00
          ENDIF
.
          GOTO      ALLREP10       * Read next record
.
ALLREP99  RETURN
.
.----------------------------------------------------------------
. Output a Table of Waiting and Processing Reports for all Users
.----------------------------------------------------------------
FUTREP00  MOVE      ZERO,DISNUMB
          PACK      KEY16,FRSTDATE,SP70
          CALL      RSWBSC4
FUTREP10  CALL      RKWBSC4
          BRANCH    OVRCD,FUTREP99
.
          MATCH     "1",SHOWQUED             * Filter Status Reports   
          IF        @EQUAL
            MATCH     "1",WBSCSTAT
            GOTO      FUTREP10 IF NOT EQUAL
          ENDIF
.
FUTREP30  MATCH     SP70,FLTUSRID             * Filter by User
          IF        !@EQUAL
            MATCH     FLTUSRID,WBSCUSER
            GOTO      FUTREP10 IF NOT EQUAL
          ENDIF
.
          MATCH     SP70,FLTPRGID             * Filter by Program
          IF        !@EQUAL
            MATCH     FLTPRGID,WBSCRPID
            GOTO      FUTREP10 IF NOT EQUAL
          ENDIF
.
          CALL      NSPROW00
.
          GOTO      FUTREP10       * Read next record
.
FUTREP99  RETURN
.
.----------------------------------------------------------------
. Output a Table of Waiting and Processing Reports for my         
. Occupational Group
.----------------------------------------------------------------
OCCREP00  PACK      KEY10,USERID,SP70
          CALL      RDWBSE1
          BRANCH    OVRCD,OCCREP99
.
          MOVE      WBSEOCG,OCCUPGRP
.
          PACK      KEY16,FRSTDATE,SP70
          CALL      RSWBSC4
OCCREP10  CALL      RKWBSC4
          BRANCH    OVRCD,OCCREP99
.
          MATCH     WBSCSCDT,LASTDATE
          GOTO      OCCREP99 IF LESS
.
          PACK      KEY10,WBSCUSER,SP70
          CALL      RDWBSE1   
          BRANCH    OVRCD,OCCREP10
.
          MATCH     OCCUPGRP,WBSEOCG          * Filter by Occupational Group
          GOTO      OCCREP10 IF NOT EQUAL
.
          MATCH     SP70,FLTUSRID             * Filter by User
          IF        !@EQUAL
            MATCH     FLTUSRID,WBSCUSER
            GOTO      OCCREP10 IF NOT EQUAL
          ENDIF
.
          MATCH     SP70,FLTPRGID             * Filter by Program
          IF        !@EQUAL
            MATCH     FLTPRGID,WBSCRPID
            GOTO      OCCREP10 IF NOT EQUAL
          ENDIF
.
          CALL      ALLROW00
          GOTO      OCCREP10       * Read next record
.
OCCREP99  RETURN
.----------------------------------------------------------------
. Output a Table of Waiting and Processing Reports for all Users
.----------------------------------------------------------------
OUTREP00  PACK      KEY25,SP70
          CALL      RSWBSC2
OUTREP10  CALL      RKWBSC2
          BRANCH    OVRCD,OUTREP99
          MATCH     "0",WBSCSTAT  
          GOTO      OUTREP20 IF EQUAL
          MATCH     "1",WBSCSTAT 
          GOTO      OUTREP99 IF NOT EQUAL
.
OUTREP20  CALL      ALLROW00
          GOTO      OUTREP10       * Read next record
.
OUTREP99  RETURN
.-----------------------------------------------------------------------------
NSPROW00  ADD       ONE,DISNUMB
          MOVE      SP70,DIM5
          MOVE      ZERO,FORM5
          MOVE      DISNUMB,FORM5
          MOVE      FORM5,DIM5
          REP       " 0",DIM5
.
          CLEAR     HTMLLNK1
          MATCH     "1",WBSCSTAT,F1
          IF        @EQUAL
            APPEND    "javascript:EditSchedule('",HTMLLNK1
          ELSE
            MATCH     "8",WBSCSTAT
            IF        @EQUAL
              APPEND    "javascript:EditReport('",HTMLLNK1
            ELSE
              APPEND    "javascript:EditProcess('",HTMLLNK1
            ENDIF
          ENDIF
.
          APPEND    WBSCSCHD,HTMLLNK1
          APPEND    "')",HTMLLNK1
          RESET     HTMLLNK1
          CLEAR     HTMLLNK2
          APPEND    "javascript:ViewReport('",HTMLLNK2
          APPEND    WBSCSCHD,HTMLLNK2
          APPEND    "','",HTMLLNK2
          APPEND    WBSCOTYP,HTMLLNK2
          APPEND    "')",HTMLLNK2
          RESET     HTMLLNK2
.
          MOVE      ZERO,F1
          MOVE      WBSCSTAT,F1
          MOVE      STATDES0,STATDESC
          LOAD      STATDESC,F1,STATDES1,STATDES2,STATDES3,STATDES4,STATDES5:
                                STATDES6,STATDES7,STATDES8,STATDES9
.
          MATCH     "PATSCH88",FLTPRGID
          GOTO      NSPROW01 IF NOT EQUAL
.
          MATCH     "7",WBSCSTAT            * Completed & No Output?
          GOTO      NSPROW01 IF NOT EQUAL
.
          MATCH     SP70,WBSCACTV           * Active Process ID?
          GOTO      NSPROW01 IF EQUAL
.
          MOVE      "Printed",STATDESC      * Active Process ID exists
.
NSPROW01  MOVE      WBSCUSER,KEY10
          CALL      RDWBSE1
          IF        OVRCD=1
            PACK      WBSENAM,KEY10,SP1,INVUSERD,SP70
          ENDIF
.
          MOVE      SP70,PRTDESC
          MATCH     "S  ",WBSCPRIN
          GOTO      NSPROW30 IF EQUAL
.
          MOVE      WBSCPRIN,KEY6
          UNPACK    KEY6,DIM1A,DIM1B,DIM1C,DIM1D,DIM1E,DIM1F
          MATCH     "0",DIM1A
          GOTO      NSPROW20 IF NOT EQUAL
.
          MOVE      SP1,DIM1A
.
          MATCH     "0",DIM1B
          GOTO      NSPROW10 IF NOT EQUAL
.
          MOVE      SP1,DIM1B
.
          MATCH     "0",DIM1C
          GOTO      NSPROW10 IF NOT EQUAL
.
          MOVE      SP1,DIM1C
.
          MATCH     "0",DIM1D
          GOTO      NSPROW10 IF NOT EQUAL
.
          MOVE      SP1,DIM1D
.
          MATCH     "0",DIM1E
          GOTO      NSPROW10 IF NOT EQUAL
.
          MOVE      SP1,DIM1E
.
NSPROW10  PACK      KEY6,DIM1A,DIM1B,DIM1C,DIM1D,DIM1E,DIM1F
.
NSPROW20  CALL      RDPRTA1
.
NSPROW30  MOVE      SP70,TXTCOLOR
          MATCH     "1",WBSCPERM
          IF        @EQUAL
            MOVE      "UnderlineRed",TXTCOLOR
          ENDIF
.
          WRITE     HTMLFILE;"t.addRow(#"",HTMLLNK1,"#",":                * 0
                             "#"",HTMLLNK2,"#",":
                             "#"",WBSCSCHD,"#",":
                             "#"",WBSCDSRP,"#",":
                             "#"",WBSENAM,"#",":
                             "#"",WBSCSCDT,WBSCSCTM,"#",":                * 5
                             "#"",WBSCSDAT,WBSCSTIM,"#",":
                             "#"",STATDESC,"#",":
                             "#"",WBSCACTV,"#",":
                             "#"",PRTDESC,"#",":
                             "#"",WBSCSPOO,"#",":                         * 10
                             "#"",WBSCPERM,"#",":
                             "#"",TXTCOLOR,"#",":
                             "#"",WBSCCDAT,WBSCCTIM,"#",";
.
          MOVE      "rpt",KEY3                                            * 14
          PACK      KEY8,KEY3,DIM5
          WRITE     HTMLFILE;"#"<input type=checkbox name=rpt",DIM5:  
                             " value='",WBSCSCHD,"' onclick=NotCheck();>#",":
                             "#"#");" 

.
NSPROW99  RETURN

.-----------------------------------------------------------------------------
ALLROW00  CLEAR     HTMLLNK1
          MATCH     "1",WBSCSTAT,F1
          IF        @EQUAL
            APPEND    "javascript:EditSchedule('",HTMLLNK1
          ELSE
            MATCH     "8",WBSCSTAT
            IF        @EQUAL
              APPEND    "javascript:EditReport('",HTMLLNK1
            ELSE
              APPEND    "javascript:EditProcess('",HTMLLNK1
            ENDIF
          ENDIF
          APPEND    WBSCSCHD,HTMLLNK1
          APPEND    "')",HTMLLNK1
          RESET     HTMLLNK1
          CLEAR     HTMLLNK2
          APPEND    "javascript:ViewReport('",HTMLLNK2
          APPEND    WBSCSCHD,HTMLLNK2
          APPEND    "','",HTMLLNK2
          APPEND    WBSCOTYP,HTMLLNK2
          APPEND    "')",HTMLLNK2
          RESET     HTMLLNK2
.
          MOVE      ZERO,F1
          MOVE      WBSCSTAT,F1
          MOVE      STATDES0,STATDESC
          LOAD      STATDESC,F1,STATDES1,STATDES2,STATDES3,STATDES4,STATDES5:
                                STATDES6,STATDES7,STATDES8,STATDES9
.
          MATCH     "PATSCH88",FLTPRGID
          GOTO      ALLROW01 IF NOT EQUAL
.
          MATCH     "7",WBSCSTAT            * Completed & No Output?
          GOTO      ALLROW01 IF NOT EQUAL
.
          MATCH     SP70,WBSCACTV           * Active Process ID?
          GOTO      ALLROW01 IF EQUAL
.
          MOVE      "Printed",STATDESC      * Active Process ID exists
.
ALLROW01  MOVE      WBSCUSER,KEY10
          CALL      RDWBSE1
          IF        OVRCD=1
            PACK      WBSENAM,KEY10,SP1,INVUSERD,SP70
          ENDIF

ALLROW05  MOVE      SP70,PRTDESC
          MATCH     "S  ",WBSCPRIN
          GOTO      ALLROW30 IF EQUAL
.
          MOVE      WBSCPRIN,KEY6
          UNPACK    KEY6,DIM1A,DIM1B,DIM1C,DIM1D,DIM1E,DIM1F
          MATCH     "0",DIM1A
          GOTO      ALLROW20 IF NOT EQUAL
. 
          MOVE      SP1,DIM1A
.
          MATCH     "0",DIM1B
          GOTO      ALLROW10 IF NOT EQUAL
. 
          MOVE      SP1,DIM1B
.
          MATCH     "0",DIM1C
          GOTO      ALLROW10 IF NOT EQUAL
. 
          MOVE      SP1,DIM1C
.
          MATCH     "0",DIM1D
          GOTO      ALLROW10 IF NOT EQUAL
. 
          MOVE      SP1,DIM1D
.
          MATCH     "0",DIM1E
          GOTO      ALLROW10 IF NOT EQUAL
. 
          MOVE      SP1,DIM1E
.
ALLROW10  PACK      KEY6,DIM1A,DIM1B,DIM1C,DIM1D,DIM1E,DIM1F
.
ALLROW20  CALL      RDPRTA1
.
ALLROW30  MOVE      SP70,TXTCOLOR
          MATCH     "1",WBSCPERM
          IF        @EQUAL
            MOVE      "UnderlineRed",TXTCOLOR
          ENDIF
.
          WRITE     HTMLFILE;"t.addRow(#"",HTMLLNK1,"#",":                * 0
                             "#"",HTMLLNK2,"#",":
                             "#"",WBSCSCHD,"#",":
                             "#"",WBSCDSRP,"#",":
                             "#"",WBSENAM,"#",":
                             "#"",WBSCSCDT,WBSCSCTM,"#",":                * 5
                             "#"",WBSCSDAT,WBSCSTIM,"#",":
                             "#"",STATDESC,"#",":
                             "#"",WBSCACTV,"#",":
                             "#"",PRTDESC,"#",":
                             "#"",WBSCSPOO,"#",":                         * 10
                             "#"",WBSCPERM,"#",":
                             "#"",TXTCOLOR,"#",":
                             "#"",WBSCCDAT,WBSCCTIM,"#");"
          RETURN
.------------------------------------------------------------
. Select Options
.------------------------------------------------------------
OPTN0000  BRANCH    FLDITMNO,OPTN0100,OPTN0200,OPTN0300,OPTN0400,OPTN0500:
                             OPTN0600,OPTN0700,OPTN0800,OPTN0900,OPTN1000:
                             OPTN1100,OPTN1200,OPTN1300,OPTN1400,OPTN1500:
                             OPTN1600,OPTN1700,OPTN1800,OPTN1900,OPTN2000:
                             OPTN2100,OPTN2200,OPTN2300,OPTN2400,OPTN2500:
                             OPTN2600,OPTN2700,OPTN2800,OPTN2900,OPTN3000:      
                             OPTN3100,OPTN3200,OPTN3300,OPTN3400,OPTN3500:
                             OPTN3600,OPTN3700,OPTN3800,OPTN3900,OPTN4000:
                             OPTN4100,OPTN4200,OPTN4300,OPTN4400,OPTN4500:
                             OPTN4600,OPTN4700,OPTN4800,OPTN4900,OPTN5000:
                             OPTN5100,OPTN5200,OPTN5300,OPTN5400,OPTN5500:
                             OPTN5600,OPTN5700,OPTN5800,OPTN5900,OPTN6000:
                             OPTN6100,OPTN6200,OPTN6300,OPTN6400,OPTN6500:
                             OPTN6600,OPTN6700,OPTN6800,OPTN6900,OPTN7000:
                             OPTN7100,OPTN7200,OPTN7300,OPTN7400,OPTN7500:
                             OPTN7600,OPTN7700,OPTN7800,OPTN7900,OPTN8000:
                             OPTN8100,OPTN8200,OPTN8300,OPTN8400,OPTN8500:
                             OPTN8600,OPTN8700,OPTN8800,OPTN8900,OPTN9000:
                             OPTN9100,OPTN9200,OPTN9300,OPTN9400,OPTN9500:
                             OPTN9600,OPTN9700,OPTN9800,OPTN9900
.      
          GOTO      OPTN9999
.
OPTN0100  CALL      WSEL0000     * Patient Ward Selection List
          GOTO      OPTN9999
.
OPTN0200  CALL      NSEL0000     * Patient Nursing Station Selection List
          GOTO      OPTN9999
.
OPTN0300  CALL      SELCOD00     * Patient Category Selection List
          GOTO      OPTN9999
.
OPTN0400  BRANCH    WATLETFL,OPTN9980
          CALL      LETSEL00     * Waiting List Letter Selection List
          GOTO      OPTN9999
.
OPTN0500  WRITE     HTMLFILE;EXTRCTID;  * Extract ID
          GOTO      OPTN9999
.
OPTN0600  CALL      SELLOC00     * Medical Records Locations Selction List
          GOTO      OPTN9999
.
OPTN0700  CALL      SELSTF00     * Medical Records Staff Selection List
          GOTO      OPTN9999
.
OPTN0800  CALL      RLABEL00     * read no of labels to print
          GOTO      OPTN9999
.
OPTN0900  CALL      SELSIT00     * Sites Selection List
          GOTO      OPTN9999
.
OPTN1000  CALL      SELCLI00     * Clinics Selection List - Doctor Name
          GOTO      OPTN9999
.
OPTN1100  CALL      SELCDT00     * Unit category DT
          GOTO      OPTN9999
.
OPTN1200  CALL      SELCCP00     * Status category CP
          GOTO      OPTN9999
.
OPTN1300  CALL      SELHFG00     * Health fund group
          GOTO      OPTN9999
.
OPTN1400  CALL      SELHFN00     * Health fund
          GOTO      OPTN9999
.
OPTN1500  CALL      SELCCL00     * Claim code category CL
          GOTO      OPTN9999
.
OPTN1600  CALL      SELATY00     * Admission Type category A
          GOTO      OPTN9999
.
OPTN1700  CALL      SELRAD00     * Intent Re-admit
          GOTO      OPTN9999
.
OPTN1800  CALL      CONFLP00     * get value of a control file parameter
          GOTO      OPTN9999
.
OPTN1900  CALL      STRCHC00     * Start Date for HDP
          GOTO      OPTN9999
.
OPTN2000  CALL      ENDCHC00     * Start Date for HDP
          GOTO      OPTN9999
.
OPTN2100  CALL      NSTRCH00     * Start Date for new run
          GOTO      OPTN9999
.
OPTN2200  CALL      HOSPID00     * Hospital ID
          GOTO      OPTN9999
.
OPTN2300  CALL      MRTMAS00     * List of mrt master record
          GOTO      OPTN9999
.
OPTN2400  CALL      SELCLT00     * Clinic Type Selection List
          GOTO      OPTN9999
.
OPTN2500  CALL      SELTHE00     * Theatre Selection List
          GOTO      OPTN9999
.
OPTN2600  CALL      SELCSH00     * Cashier Selection List
          GOTO      OPTN9999
.
OPTN2700  CALL      SELNUR00     * Theatre Nurse Selection List
          GOTO      OPTN9999
.
OPTN2800  CALL      SELOLT00     * Outpatient Letter Type       
          GOTO      OPTN9999
.
OPTN2900  CALL      SELFLT00     * Patient Financial Letter Type
          GOTO      OPTN9999
.
OPTN3000  CALL      SELWPE00     * Waiting List Patient Extract 
          GOTO      OPTN9999
.
OPTN3100  CALL      SELPGP00     * Procedure Groups             
          GOTO      OPTN9999
.
OPTN3200  CALL      SELPPP00     * Private Practice Medical Practices
          GOTO      OPTN9999
.
OPTN3300  CALL      SELPIM00     * Patient Invoice Messages    
          GOTO      OPTN9999
.
OPTN3400  CALL      SELPPD00     * Private Practice Doctors     
          GOTO      OPTN9999
.
OPTN3500  
.          CALL      SELPPF00     * Private Practice Financial Letter TYpe
          GOTO      OPTN9999
.
OPTN3600  CALL      SELEXT00     * Extraction file details selection list
          GOTO      OPTN9999
.
OPTN3700  CALL      SELCLD00     * Clinic Name Selection List             
          GOTO      OPTN9999
.
OPTN3800  CALL      SELGST00     * GST Codes Selection List             
          GOTO      OPTN9999
.
OPTN3900  READ      CONTROLF,EIGHTY8;*59,PTCNI10D
          WRITE     HTMLFILE;PTCNI10D;   * Start date of Go-Live         
          GOTO      OPTN9999
.
OPTN4000  READ      CONTROLF,THIRTY3;*51,PRCNAUDA
          WRITE     HTMLFILE;PRCNAUDA;            
          GOTO      OPTN9999
.
OPTN4100  READ      CONTROLF,THIRTY3;*52,PRCNAUDB
          WRITE     HTMLFILE;PRCNAUDB;            
          GOTO      OPTN9999
.
OPTN4200  READ      CONTROLF,THIRTY3;*53,PRCNAUDC
          WRITE     HTMLFILE;PRCNAUDC;            
          GOTO      OPTN9999
.
OPTN4300  READ      CONTROLF,THIRTY3;*54,PRCNAUDD
          WRITE     HTMLFILE;PRCNAUDD;            
          GOTO      OPTN9999
.
OPTN4400  READ      CONTROLF,THIRTY3;*55,PRCNAUDE
          WRITE     HTMLFILE;PRCNAUDE;            
          GOTO      OPTN9999
.
OPTN4500  READ      CONTROLF,THIRTY3;*56,PRCNAUDF
          WRITE     HTMLFILE;PRCNAUDF;            
          GOTO      OPTN9999
.
OPTN4600  READ      CONTROLF,THIRTY3;*57,PRCNAUDG
          WRITE     HTMLFILE;PRCNAUDG;            
          GOTO      OPTN9999
.
OPTN4700  READ      CONTROLF,THIRTY3;*58,PRCNAUDH
          WRITE     HTMLFILE;PRCNAUDH;            
          GOTO      OPTN9999
.
OPTN4800  READ      CONTROLF,THIRTY3;*59,PRCNAUDI
          WRITE     HTMLFILE;PRCNAUDI;            
          GOTO      OPTN9999
.
OPTN4900  READ      CONTROLF,THIRTY4;*205,PRCNCADM
          WRITE     HTMLFILE;PRCNCADM;            
          GOTO      OPTN9999
.
OPTN5000  READ      CONTROLF,HUND05;*67,PTCNLPRO  
          WRITE     HTMLFILE;PTCNLPRO;            
          GOTO      OPTN9999
.
OPTN5100  CALL      BASLST00     * BAS Codes Selection List             
          GOTO      OPTN9999
.
OPTN5200  WRITE     HTMLFILE;CPERMTH;
          GOTO      OPTN9999
.
OPTN5300  MOVE      ZERO,CURRPERD
          CALL      DFTPRD00           * Default previous period (from PATDRGFD)
          WRITE     HTMLFILE;FNPERIOD;
          GOTO      OPTN9999
.
OPTN5400  MOVE      ONE,CURRPERD
          CALL      DFTPRD00           * Default current period (from PATDRGFD)
          WRITE     HTMLFILE;FNPERIOD;
          GOTO      OPTN9999
.
OPTN5500  MOVE      ONE,CURRPERD
          CALL      DFTPRD00           * Default current fin year(from PATDRGFD)
          WRITE     HTMLFILE;DRGYR;
          GOTO      OPTN9999
.
OPTN5600  READ      CONTROLF,TEN3;*201,CNDOCLB
          WRITE     HTMLFILE;CNDOCLB;            
          GOTO      OPTN9999
.
OPTN5700  COMPARE   ONE,CCSSTINC
          GOTO      OPTN9999 IF EQUAL
          PACK      KEY3,SP10
          CALL      RSCCST1
OPTN5710  CALL      RKCCST1
          BRANCH    OVRCD,OPTN9999
          WRITE     HTMLFILE;"<option value=",CCSTSTY,">":
                               CCSTDES,"</option>"
          GOTO      OPTN5710
.
OPTN5800  CALL      LOCSIT00      * EMR Site code
          GOTO      OPTN9999
.
OPTN5900  UNPACK    DIM127,D1,KEY1,DIM127
          MOVE      ZERO,F1
          MOVE      KEY1,F1
          READ      CONTROLF,FORTY;*81,OPCNODSC,OPCNCDSC
          BRANCH    F1,OPTN5910,OPTN5920
          GOTO      OPTN9999
.          
OPTN5910  WRITE     HTMLFILE;OPCNCDSC;   * Clinic/Surgeon Description 
          GOTO      OPTN9999
.
OPTN5920  WRITE     HTMLFILE;OPCNODSC;   * Operating Room/Theatre Description
          GOTO      OPTN9999
.
OPTN6000  MOVE      SP70,KEY1
          CALL      SELREG00     * Register Selection List             *I-59171
          GOTO      OPTN9999                                           *I-59171
.
OPTN6100  MOVE      ZERO,FORM1
          CALL      SELPPS00     * Private Practice Medical Practices security
          GOTO      OPTN9999
.
OPTN6200  MOVE      ONE,FORM1
          CALL      SELPPS00     * Private Practice Medical Practices security
          GOTO      OPTN9999
.
OPTN6300  MATCH     SP70,FLTUSRID
          GOTO      OPTN9999 IF EQUAL
          WRITE     HTMLFILE;FLTUSRID;
          GOTO      OPTN9999
.
OPTN6400  MATCH     SP70,FLTPRGID
          GOTO      OPTN9999 IF EQUAL
          WRITE     HTMLFILE;FLTPRGID;
          GOTO      OPTN9999
.
OPTN6500  MOVE      SP15,CHQACCNT           * cheque account selection list
          CALL      CHQSLT00
          GOTO      OPTN9999
.
OPTN6600  CALL      MONCHC00
          GOTO      OPTN9999
.
OPTN6700  CALL      PROLKP00
          GOTO      OPTN9999
.
OPTN6800  CALL      NXTPRO00
          GOTO      OPTN9999
.
OPTN6900  CALL      PRVPRO00
          GOTO      OPTN9999
.
OPTN7000  CALL      HOSIDS00
          GOTO      OPTN9999
.
OPTN7100  CALL      WSEL0000
          GOTO      OPTN9999
.
OPTN7200  WRITE     HTMLFILE;WARDOPTN;
          GOTO      OPTN9999
.
OPTN7300  CALL      WSEL0000
          GOTO      OPTN9999
.
OPTN7400  CALL      SECHOS00     * Hospital ID
          GOTO      OPTN9999
.
OPTN7500  READ      CONTROLF,SIXTY9;*137,MHCNEDIR
          WRITE     HTMLFILE;MHCNEDIR;
          GOTO      OPTN9999
.
OPTN7600  CALL      RESNDV00     * Reason for Division Patient
          GOTO      OPTN9999
.
OPTN7700  WRITE     HTMLFILE;SUPERLEV;
          GOTO      OPTN9999
.
OPTN7800  CALL      PRS2RS00     * PRS2 End of Year Reset
          GOTO      OPTN9999
.
OPTN7900  CALL      ALCAT000     * Alert Category (H1-H9) selection list
          GOTO      OPTN9999
.
OPTN8000  CALL      DISSEL00     * Disaster Codes Selection List
          GOTO      OPTN9999
.
OPTN8100  CALL      LOCSEL00     * Emergency Location Code Selection List
          GOTO      OPTN9999
.
OPTN8200  CALL      ARFD0000     * AH Department Selection List
          GOTO      OPTN9999
.
OPTN8300  CALL      MLTSIT00     * Sites Selection List - Multi Hospital
          GOTO      OPTN9999
.
OPTN8400  READ      CONTROLF,SEVENTY7;*45,PTCNNZED
          WRITE     HTMLFILE;PTCNNZED;      * Directory for NZ EDI file
          GOTO      OPTN9999
.
OPTN8500  MOVE      "CL",CATEGORY           * Selection List of Claimcode
          MOVE      SP70,CODE
          CALL      CODITM00
          GOTO      OPTN9999
.
OPTN8600  MOVE      "CL",CATEGORY
          CALL      CLASC000                * Code Cat 'CL' with Assc.5 <>blank
          GOTO      OPTN9999
.
OPTN8700  MOVE      "Py",CATEGORY
          CALL      PTYP0000
          GOTO      OPTN9999
.
OPTN8800  MOVE      SP70,KEY1
          CALL      SINREG00     * Register List for system code 1,2,5 ,99
          GOTO      OPTN9999
.
OPTN8900  BRANCH    WATLETFL,OPTN9980
          CALL      SMSSEL00     * Waiting List Letter Selection List
          GOTO      OPTN9999
.
OPTN9000  CALL      SMSOLT00     * Outpatient SMS Selection List     
          GOTO      OPTN9999
.
OPTN9100  READ      CONTROLF,HUND24;*1,PTCNNMED
          WRITE     HTMLFILE;PTCNNMED;      * NMDS Extracts Directory
          GOTO      OPTN9999
.
OPTN9200  READ      CONTROLF,HUND24;*51,PTCNNBED
          WRITE     HTMLFILE;PTCNNBED;      * NBRS Extracts Directory
          GOTO      OPTN9999
.
OPTN9300  UNPACK    DIM127,D1,CATEGORY,DIM127
          CALL      SELCDA00     * Category Selection List (including inactive)
          GOTO      OPTN9999
.
OPTN9400  CALL      ISMS0000                * IP SMS Selection list
          GOTO      OPTN9999
.
OPTN9500  CALL      OSMS0000                * OP SMS Selection list
          GOTO      OPTN9999
.
OPTN9600  CALL      WSMS0000                * WL SMS Selection list
          GOTO      OPTN9999
.
OPTN9700  MOVE      "J ",CATEGORY            * Code Cat 'J ' with Indic5=W or C
          MOVE      SP70,CODE
          CALL      CODEXC00
          GOTO      OPTN9999
.
OPTN9800  MOVE      "A ",CATEGORY           * Selection List of Admission Type
          MOVE      SP70,CODE
          CALL      CODITM00
          GOTO      OPTN9999
.
OPTN9900  UNPACK    DIM127,D1,KEY3,DIM127
          MOVE      KEY3,FLDITMNO
          CALL      EXTN0000                * process other fields
          GOTO      OPTN9999
.
OPTN9980  WRITE     HTMLFILE;"<option>Error Waiting List Letters":
                             " System Not Found</option>"
          GOTO      OPTN9999
.
OPTN9999  RETURN
+
.------------------------------------------------------------
.         Extension of Fields Processing
.------------------------------------------------------------
EXTN0000  BRANCH    FLDITMNO,EXTN0100,EXTN0200,EXTN0300,EXTN0400,EXTN0500:
                             EXTN0600,EXTN0700,EXTN0800,EXTN0900,EXTN1000:
                             EXTN1100,EXTN1200,EXTN1300
          GOTO      EXTN9999

EXTN0100  MOVE      "CC",CATEGORY      * Selection List of Care Type
          MOVE      SP70,CODE
          CALL      CODITM00
          GOTO      EXTN9999
.
EXTN0200  READ      CONTROLF,HUND24;*105,PTCNSMSP
          MATCH     SP70,PTCNSMSP
          GOTO      EXTN9999 IF EQUAL
          MOVE      PTCNSMSP,KEY6
          CALL      RDPRTA1
          BRANCH    OVRCD,EXTN9999
          WRITE     HTMLFILE;PRTDESC;    * Printer description
          GOTO      EXTN9999
.
EXTN0300  CALL      DSLSIT00             * Sites Selection List - With default
          GOTO      EXTN9999
.
EXTN0400  CALL      SELCLA00             * Active Clinical List 
          GOTO      EXTN9999
.
EXTN0500  CALL      CHKV0000             * Unprocess VINAH E502/E602 errors
          GOTO      EXTN9999
.
EXTN0600  MOVE      "1",KEY1             * check hospital id
          CALL      SELREG00             * Register Selection List
          GOTO      EXTN9999
.
EXTN0700  MOVE      "1",KEY1             * check hospital id
          CALL      SINREG00     * Register List for system code 1,5 ,99
          GOTO      EXTN9999
.
EXTN0800  CALL      SUCOLS00             * Surgeon/Clinical list
          GOTO      EXTN9999
.
EXTN0900  CALL      BSMS0000             * BK SMS Selection list
          GOTO      EXTN9999
.
EXTN1000  WRITE     HTMLFILE;DISCANCL;   * Display Cancel button ind 
          GOTO      EXTN9999                                         
.
EXTN1100  WRITE     HTMLFILE;SHOWQUED;   * Only show Queued Status   
          GOTO      EXTN9999                                         
.
EXTN1200  MOVE      "FA",CATEGORY      * Selection List of Future Action
          MOVE      SP70,CODE
          CALL      CODITM00
          GOTO      EXTN9999
.
EXTN1300  MOVE      "w0",CATEGORY      * Selection List of Occapational group
          MOVE      SP70,CODE
          CALL      CODITM00
          GOTO      EXTN9999
.
EXTN9999  RETURN
+
.*****************************************************************************
.*                               CHKV0000                                    *
.*      Check if there are any records in allvreaf that are waiting          *
.*      for processing. These must be processed by running VINAHERR          *
.*      Process VINAH XML E052/E061 Response Errors before prceeding         *
.*      with the next extract.                                               *
.*      These records are created by the load VINAH XML response VINAHRES    *
.*      finding E052 or E061 errors                                          *
.*                                                                           *
.*      ALVRSTAT = 0 -  Waiting for processing                               *
.*                                                                           *
.*****************************************************************************
.
CHKV0000  COMPARE   ONE,ALLVRINC                 * Is allvreaf available
          GOTO      CHKV9999 IF EQUAL
          PACK      KEY17,ZERO,SP70
          CALL      RSALVRE1                     * position on status
CHKV1000  CALL      RKALVRE1                     * read next record
          BRANCH    OVRCD,CHKV9000               * eof - finished
.
          MATCH     "0",ALVRSTAT                 * Waiting for processing
          GOTO      CHKV9100 IF EQUAL            * check next status
.
CHKV9000  WRITE     HTMLFILE;ZERO;               * No errors
          GOTO      CHKV9999
.
CHKV9100  WRITE     HTMLFILE;ONE;                * Yes errors 
          GOTO      CHKV9999
.
CHKV9999  RETURN
+
.------------------------------------------------------------
. Register Selection List
.------------------------------------------------------------
SINREG00  PACK      KEY3,SP70
          CALL      RDSREGA1
SINREG10  CALL      RDKREGA1
          BRANCH    OVRCD,SINREG99
.
          MATCH     "1",REGACTIV
          GOTO      SINREG10 IF EQUAL       * Inactive
.
          IF        IBCNMHOS=1
            MATCH     "1",KEY1
            IF        @EQUAL
              MATCH     WBSEHOSP,REGHOSP
              GOTO      SINREG10 IF NOT EQUAL    * different hospital
            ENDIF
          ENDIF
.
          COMPARE   "1",REGIBACD
          GOTO      SINREG20 IF EQUAL      * patient billing
.
          COMPARE   "5",REGIBACD
          GOTO      SINREG20 IF EQUAL      * sundry
          COMPARE   "99",REGIBACD
          GOTO      SINREG10 IF NOT EQUAL  * suspense
.
SINREG20  PACK      KEY35,REGDESC,SP30
          PACK      KEY5,QUOTE,REGCODE,QUOTE
.
          WRITE     HTMLFILE;"<option value=",KEY5,">":
                    "(",REGCODE,") ",KEY35,"</option>"
.
          GOTO      SINREG10
.
SINREG99  RETURN
.
.------------------------------------------------------------
.         Payment Code Cat 'Py' with PTCDNHCP=2 or 4
.------------------------------------------------------------
PTYP0000  PACK      KEY5,CATEGORY,SP70
          CALL      RDSCODE1
PTYP1000  CALL      RDKCODE1
          BRANCH    OVRCD,PTYP9999
          MATCH     CATEGORY,TCODE
          GOTO      PTYP9999 IF NOT EQUAL
.
          MATCH     "I",PTCOACTV
          GOTO      PTYP1000 IF EQUAL       * Inactive
.
          MATCH     "2",PTCDNHCP
          GOTO      PTYP2000 IF EQUAL     * Cheque
          MATCH     "4",PTCDNHCP
          GOTO      PTYP1000 IF NOT EQUAL * direct deposit
.
PTYP2000  PACK      KEY40,TCINDC1,TCINDC2,TCINDC3,TCINDC4,TCINDC5:
                          TCINDC6,TCINDC7,TCINDC8,TCINDC9,TCINDC10:
                          TCINDC11,THCSCOD,PTCDNHCP,TCFORM6:
                          TCINDC12,TCINDC13,TCINDC14,TCINDC15,TCINDC16:
                          TCINDC17,TCINDC18,TCINDC19,TCINDC20,TCINDC21:
                          PTCOACTV
.
          WRITE     HTMLFILE;"<option value=#"",ACODE,KEY40,"#">",TDESC:
                             "</option>"
          GOTO      PTYP1000
.
PTYP9999  RETURN
.------------------------------------------------------------
.         Code Cat 'CL' with Assc.5 <>blank
.------------------------------------------------------------
CLASC000  PACK      KEY5,CATEGORY,SP70
          CALL      RDSCODE1
CLASC100  CALL      RDKCODE1
          BRANCH    OVRCD,CLASC999
          MATCH     CATEGORY,TCODE
          GOTO      CLASC999 IF NOT EQUAL
.
          MATCH     SP70,ACODE
          GOTO      CLASC100 IF EQUAL
.
          MATCH     SP70,PTCDASC5
          GOTO      CLASC100 IF EQUAL       * Blank code
.
          MOVE      PTCDASC5,KEY6
          CALL      RDINSR1
          BRANCH    OVRCD,CLASC100          * Invalid Insurance
.
          MATCH     "I",PTCOACTV
          GOTO      CLASC100 IF EQUAL       * Inactive
.
          IF        IBCNMHOS=1
            MATCH    "1",PTCDHOSS
            IF       @EQUAL
              PACK     KEY8,WBSEHOSP,TCODE,ACODE,SP70
              CALL     RDMLCOD1
              BRANCH   OVRCD,CLASC100
            ENDIF
          ENDIF
.
          PACK      KEY40,TCINDC1,TCINDC2,TCINDC3,TCINDC4,TCINDC5:
                          TCINDC6,TCINDC7,TCINDC8,TCINDC9,TCINDC10:
                          TCINDC11,THCSCOD,PTCDNHCP,TCFORM6:
                          TCINDC12,TCINDC13,TCINDC14,TCINDC15,TCINDC16:
                          TCINDC17,TCINDC18,TCINDC19,TCINDC20,TCINDC21:
                          PTCOACTV
.
          WRITE     HTMLFILE;"<option value=#"",ACODE,KEY40,"#">",TDESC:
                             "</option>"
          GOTO      CLASC100
.
CLASC999  RETURN
+
.------------------------------------------------------------
. Category el Selection List (Reason for Division Patient)
.------------------------------------------------------------
RESNDV00  MOVE      "el",CATEGORY
          MOVE      SP70,CODE
          CALL      CODSEL00
RESNDV99  RETURN
.
.------------------------------------------------------------
.  Location Site code
.  Parameter : 0=Description, 1=Code, 2=Selection List
.------------------------------------------------------------
LOCSIT00  UNPACK    DIM127,D1,KEY1,DIM127
          MOVE      ZERO,F1
          MOVE      KEY1,F1
          BRANCH    F1,LOCSIT10,LOCSIT20
.
          PACK      KEY3,WBSEESC,SP70       * description
          CALL      RDEMSIT1
          IF        OVRCD=1
            MOVE      SP70,EMSTDESC
          ENDIF
.
          WRITE     HTMLFILE;EMSTDESC;
          GOTO      LOCSIT99
.
LOCSIT10  WRITE     HTMLFILE;WBSEESC;       * code
          GOTO      LOCSIT99
.
LOCSIT20  PACK      KEY3,SP70                * selection list
          CALL      RSEMSIT1
LOCSIT30  CALL      RKEMSIT1
          BRANCH    OVRCD,LOCSIT99
          MATCH     SP70,EMSTSCOD
          GOTO      LOCSIT30 IF EQUAL
          PACK      KEY5,QUOTE,EMSTSCOD,QUOTE
          MATCH     WBSEESC,EMSTSCOD
          IF        @EQUAL
            WRITE     HTMLFILE;"<option value=",KEY5," selected>":
                               EMSTDESC,"</option>"
          ELSE
            WRITE     HTMLFILE;"<option value=",KEY5,">",EMSTDESC,"</option>"
          ENDIF
          GOTO      LOCSIT30
.
LOCSIT99  RETURN
.-------------------------------------------------
. BAS Selection List
.-------------------------------------------------
BASLST00  PACK      KEY3,SP70
          CALL      RSIBBA1
BASLST10  CALL      RKIBBA1
          BRANCH    OVRCD,BASLST99
.
          COMPARE   ONE,IBBAACTV          * Active Indicator
          GOTO      BASLST10 IF EQUAL
.
          WRITE     HTMLFILE;"<option value=#"",IBBABASC,"#">":
                             IBBADESC,"</option>"
          GOTO      BASLST10
.
BASLST99  RETURN
+
.------------------------------------------------------------------------------
. Get Default period from PATDRGFD
. The default period is one period prior to the current period.
.------------------------------------------------------------------------------
DFTPRD00  MOVE      SP70,FNPERIOD      * Initialize Financial Period
          PACK      CURRDATE,CCC,CYY,CMM,CDD
          REP       " 0",CURRDATE
          PACK      KEY14,CURRDATE,SP70
          CALL      RDSDRGA2
          CALL      RDKDRGA2
          BRANCH    OVRCD,DFTPRD99
.
          MATCH     DRGFDTE,CURRDATE   * Is the given date before this period?
          GOTO      DFTPRD99 IF LESS   * Yes, period for date not in file
.
          BRANCH    CURRPERD,DFTPRD90  * Use current period not previous
.
.         Current Period has been found. Get previous period.
.
          PACK      KEY6,DRGCYR,DRGCNUM,SP70
          CALL      RDSDRGA3
          CALL      RDPDRGA3
          BRANCH    OVRCD,DFTPRD99
.
.         Set Default Financial Period (CCYYMM) - where MM is the period
.         number - it doesn not have to correspond to the Month number.
.
DFTPRD90  PACK      FNPERIOD,DRGCYR,DRGCNUM,SP70 
.
DFTPRD99  RETURN
+
.------------------------------------------------------------
. Start date of HDP
.------------------------------------------------------------
STRCHC00  READ      CONTROLF,EIGHTY8;*124,CHCSST
          UNPACK    CHCSST,CCENT,CYEAR,CMON,CDAY
          MOVE      CMON,F2
          LOAD      MTHNAM3,F2,JAN,FEB,MAR,APR,MAY,JUN,JUL,AUG,SEP,OCT,NOV,DEC
          WRITE     HTMLFILE;CDAY,SP1,MTHNAM3,SP1,CCENT,CYEAR;
STRCHC99  RETURN
.
.------------------------------------------------------------
. End date of HDP
.------------------------------------------------------------
ENDCHC00  READ      CONTROLF,EIGHTY8;*132,CHCSED
          UNPACK    CHCSED,CCENT,CYEAR,CMON,CDAY
          MOVE      CMON,F2
          LOAD      MTHNAM3,F2,JAN,FEB,MAR,APR,MAY,JUN,JUL,AUG,SEP,OCT,NOV,DEC
          WRITE     HTMLFILE;CDAY,SP1,MTHNAM3,SP1,CCENT,CYEAR;
ENDCHC99  RETURN
.
.------------------------------------------------------------
. End date of HDP Month and Year only
.------------------------------------------------------------
MONCHC00  READ      CONTROLF,EIGHTY8;*132,CHCSED
.         UNPACK    CHCSED,CCENT,CYEAR,CMON,CDAY
          MOVE      CHCSED,WORKDATE
          ADD       ONE,WORKDATE
          MOVE      WORKDATE,SAVDATE
          UNPACK    SAVDATE,CCENT,CYEAR,CMON,CDAY
          MOVE      CMON,F2
          LOAD      MTHNAM3,F2,JAN,FEB,MAR,APR,MAY,JUN,JUL,AUG,SEP,OCT,NOV,DEC
          WRITE     HTMLFILE;MTHNAM3,SP1,CCENT,CYEAR;
MONCHC99  RETURN
.
.------------------------------------------------------------
. Start date of new run 
.------------------------------------------------------------
NSTRCH00  READ      CONTROLF,EIGHTY8;*132,CHCSED
          UNPACK    CHCSED,CCENT,CYEAR,CMON,CDAY
          MOVE      CCENT,CC
          MOVE      CYEAR,YY
          MOVE      CMON,MM
          MOVE      CDAY,DD
          CALL      DMYCON
          ADD       ONE,JULDAY         * add one day to end of last run
          MOVE      JULDAY,JWKDAY
          MOVE      JULYR,JWKYER
          MOVE      JULCC,JWKCC
          CALL      JULCON
          PACK      CHCSED,CC,YY,MM,DD
          REP       " 0",CHCSED
          UNPACK    CHCSED,CCENT,CYEAR,CMON,CDAY
.
          MOVE      CMON,F2
          LOAD      MTHNAM3,F2,JAN,FEB,MAR,APR,MAY,JUN,JUL,AUG,SEP,OCT,NOV,DEC
          WRITE     HTMLFILE;CDAY,SP1,MTHNAM3,SP1,CCENT,CYEAR;
NSTRCH99  RETURN
.
.------------------------------------------------------------
. Hospital ID
.------------------------------------------------------------
HOSPID00  OPEN      PATHSPA1,"pathspaf"
.
          PACK      KEY3,SP10       
          CALL      RSPTHSP1
HOSPID10  CALL      RKPTHSP1
          BRANCH    OVRCD,HOSPID90
.
          PACK      KEY13,USERID,SP70                * All hospital access
          CALL      RDMLSEC1
          IF        OVRCD=1
            PACK      KEY13,USERID,PTHSHOSP,SP70     * This hospital access
            CALL      RDMLSEC1
            BRANCH    OVRCD,HOSPID10
          ENDIF
.
          PACK      KEY5,QUOTE,PTHSHOSP,QUOTE
....      BRANCH    IBCNMHOS,HOSPID20
....      WRITE     HTMLFILE;"<option value=",KEY5,">":
....                         PTHSNAME,"</option>"
....      GOTO      HOSPID10
.
.         Mult-Hospital
.
HOSPID20  MATCH     WBSEHOSP,PTHSHOSP
          IF        @EQUAL
            WRITE     HTMLFILE;"<option value=",KEY5," selected>":
                               PTHSNAME,"</option>"
          ELSE
            WRITE     HTMLFILE;"<option value=",KEY5,">":
                               PTHSNAME,"</option>"
          ENDIF
          GOTO      HOSPID10
.
HOSPID90  CLOSE     PATHSPA1
HOSPID99  RETURN
+
.------------------------------------------------------------
. Hospital ID selection list with hospital security test
.------------------------------------------------------------
SECHOS00  OPEN      PATHSPA1,"pathspaf"
.
          PACK      KEY3,SP10
          CALL      RSPTHSP1
SECHOS10  CALL      RKPTHSP1
          BRANCH    OVRCD,SECHOS90
.
          PACK      KEY13,USERID,SP70                * All hospital access
          CALL      RDMLSEC1
          IF        OVRCD=1
            PACK      KEY13,USERID,PTHSHOSP,SP70     * This hospital access
            CALL      RDMLSEC1
            BRANCH    OVRCD,SECHOS10
          ENDIF
.
          PACK      KEY5,QUOTE,PTHSHOSP,QUOTE
          BRANCH    IBCNMHOS,SECHOS20
          WRITE     HTMLFILE;"<option value=",KEY5,">":
                             PTHSNAME,"</option>"
          GOTO      SECHOS10
.
.         Mult-Hospital
.
SECHOS20  MATCH     WBSEHOSP,PTHSHOSP
          IF        @EQUAL
            WRITE     HTMLFILE;"<option value=",KEY5," selected>":
                               PTHSNAME,"</option>"
          ELSE
            WRITE     HTMLFILE;"<option value=",KEY5,">":
                               PTHSNAME,"</option>"
          ENDIF
          GOTO      SECHOS10
.
SECHOS90  CLOSE     PATHSPA1
SECHOS99  RETURN
+
.------------------------------------------------------------
. MRT master record for the U/R
.------------------------------------------------------------
MRTMAS00  MOVE      ZERO,FORM3
          OPEN      MRTMASA1,"mrtmasaf"
          OPEN      MRTLOCA1,"mrtlocaf"
.
          PACK      KEY20,URNUMBER,SP20
          CALL      RSMRMAS1
MRTMAS10  CALL      RKMRMAS1
          BRANCH    OVRCD,MRTMAS99
.
          MATCH     MRMAURNO,URNUMBER     * Same U/R ?
          GOTO      MRTMAS99 IF NOT EQUAL
.
          MOVE      SP30,MRLODESC
.
          PACK      KEY7,MRMAHHOS,MRMAHLOC,SP70
          CALL      RDMRLOC1
          MOVE      MRLODESC,KEY18
.
          MOVE      SP30,TDESC
          PACK      KEY5,ANST,ANSY,MRMADOTY
          CALL      RDCODE1
          MOVE      TDESC,KEY15
.
          ADD       ONE,FORM3
          PACK      KEY39,QUOTE,KEY18,SLASH,KEY15,SLASH,MRMAVOLN,QUOTE
          WRITE     HTMLFILE;"<option value=",FORM3,">":
                             KEY39,"</option>"
          GOTO      MRTMAS10
.
MRTMAS99  RETURN
+
.------------------------------------------------------------
. PRS2 End of year Reset
.------------------------------------------------------------
PRS2RS00  READ      CONTROLF,EIGHTY8;*116,CHCSDTE
          READ      CONTROLF,SEVENTY7;*1,PTCNDPRS
.
          IF        PTCNDPRS=1
            OPEN      PATDRGA1,"patdprsf" * Open the PRS2 date range file
            OPEN      PATDRGA2,"patdprsf"
          ELSE
            OPEN      PATDRGA1,"patdrgaf" * Open the date range file
            OPEN      PATDRGA2,"patdrgaf"
          ENDIF
.
          UNPACK    CHCSDTE,OLDYR,CMON,CDAY
          PACK      KEY12,CDAY,SLSH,CMON,SLSH,OLDYR
.                                         
          PACK      KEY8,CCC,CYY,CMM,CDD
          REP       " 0",KEY8
          PACK      KEY14,KEY8,SP6        * Key for to find this date in file
          CALL      RDSDRGA2              * Position in Date range file
          CALL      RDKDRGA2              * Get the first record from given date
          BRANCH    OVRCD,PRS2RS90        * No record found in file
.
          UNPACK    DRGFDTE,NEWYR,CMON,CDAY
.                                         * check that CHCSDTE is not the same
.                                         * year as Current Date stuff
          MATCH     NEWYR,OLDYR
          GOTO      PRS2RS90 IF NOT LESS
.                                         * get Start of Fin. Year for NEWYR
          PACK      KEY6,DRGYR,SP2
          CALL      RDSDRGA1                * get the first record for the
          CALL      RDKDRGA1                  current financial year as the
          BRANCH    OVRCD,PRS2RS90            fromdate will be the new start
.                                             date
          CLEAR     FREETXT1
          APPEND    KEY12,FREETXT1
          APPEND    "  to  ",FREETXT1
          UNPACK    DRGFDTE,NEWYR,CMON,CDAY
          PACK      KEY12,CDAY,SLSH,CMON,SLSH,NEWYR
          APPEND    KEY12,FREETXT1
          RESET     FREETXT1
          WRITE     HTMLFILE;"Start of Financial Year will be updated from  ":
                             FREETXT1;

          GOTO      PRS2RS99
.
PRS2RS90  MOVE      "Dates cannot be identified",FREETXT1
          WRITE     HTMLFILE;FREETXT1;
.          
PRS2RS99  RETURN
+
.------------------------------------------------------------
. MR Location Selection
.------------------------------------------------------------
SELLOC00  UNPACK    DIM127,D1,ANS,DIM127
          MOVE      ZERO,F1
          MOVE      ANS,F1
          IF        F1=1
            READ      CONTROLF,SIXTY;*105,MRCNHMTY
          ENDIF
          PACK      KEY7,SP70
          CALL      RDMRLOC1
SELLOC10  CALL      RKMRLOC1
          BRANCH    OVRCD,SELLOC99
          IF        F1=1
            MATCH     MRCNHMTY,MRLOTYPE
            GOTO      SELLOC10 IF NOT EQUAL
          ENDIF
          IF        F1=2
            MATCH     "1",MRLOINDC
            GOTO      SELLOC10 IF NOT EQUAL
            COMPARE   ZERO,MRLOSTAT
            GOTO      SELLOC10 IF NOT EQUAL
          ENDIF
          IF        F1=3
            MATCH     "2",MRLOINDC
            GOTO      SELLOC10 IF NOT EQUAL
            COMPARE   ZERO,MRLOSTAT
            GOTO      SELLOC10 IF NOT EQUAL
          ENDIF
.
          IF        IBCNMHOS=1
            MATCH     WBSEHOSP,MRLOHOSP
            GOTO      SELLOC10 IF NOT EQUAL
          ENDIF
.
          PACK      KEY9,QUOTE,MRLOHOSP,MRLOCODE,QUOTE
          PACK      KEY25,MRLODESC,SP70
          WRITE     HTMLFILE;"<option value=",KEY9,">":
                    "(",MRLOHOSP," - ",MRLOCODE,") ",MRLODESC,"</option>"
          GOTO      SELLOC10
SELLOC99  RETURN
.------------------------------------------------------------
. MR Staff Selection
.------------------------------------------------------------
SELSTF00  PACK      KEY6,SP70
          CALL      RDMRSTF1
SELSTF10  CALL      RKMRSTF1
          BRANCH    OVRCD,SELSTF99
          PACK      KEY25,MRSTTITL,SP1,MRSTSNAM,SP1,MRSTGNAM
          PACK      KEY8,QUOTE,MRSTCODE,QUOTE
          WRITE     HTMLFILE;"<option value=",KEY8,">":
                    "(",MRSTCODE,") ",KEY25,"</option>"
          GOTO      SELSTF10
SELSTF99  RETURN
.
.------------------------------------------------------------
. Number of labels to print
.------------------------------------------------------------
RLABEL00  READ      CONTROLF,SIXTY;*111,HTLNUM
          WRITE     HTMLFILE;HTLNUM
.
RLABEL99  RETURN
.
.------------------------------------------------------------
. Sites Selection
.------------------------------------------------------------
SELSIT00  PACK      KEY6,SP70
          CALL      RDSSITA1
SELSIT10  CALL      RDKSITA1
          BRANCH    OVRCD,SELSIT99
.
          PACK      KEY25,OSTDESC,SP20
          PACK      KEY8,QUOTE,OSTSITE,QUOTE
.
          WRITE     HTMLFILE;"<option value=",KEY8,">":
                    "(",OSTSITE,") ",KEY25,"</option>"
.
          GOTO      SELSIT10
.
SELSIT99  RETURN
.
.------------------------------------------------------------
. Op site selection list with default to user logged in site.
. If the user is not logged into a site and only one site
. exists use it as the default
.------------------------------------------------------------
DSLSIT00  MOVE      SP70,D6
          PACK      KEY10,USERID,SP70
          CALL      RDWBSE1                 * Read user id to get site
          IF        OVRCD<>1
            MOVE      WBSESIT,D6
          ENDIF
.
          MATCH     SP70,D6                 * Use logged in site as the default
          GOTO      DSLSIT05 IF NOT EQUAL
.
          PACK      KEY6,SP70
          CALL      RDSSITA1
          CALL      RDKSITA1                * If only one site code
          BRANCH    OVRCD,DSLSIT99          * exists use it as the default
.
          CALL      RDKSITA1
          IF        OVRCD=1
            MOVE     OSTSITE,D6
          ENDIF
.
DSLSIT05  PACK      KEY6,SP70
          CALL      RDSSITA1
DSLSIT10  CALL      RDKSITA1
          BRANCH    OVRCD,DSLSIT99
.
          PACK      KEY25,OSTDESC,SP20
          PACK      KEY8,QUOTE,OSTSITE,QUOTE
.
          MATCH     OSTSITE,D6
          IF        @EQUAL
            WRITE     HTMLFILE;"<option value=",KEY8," selected>":
                      "(",OSTSITE,") ",KEY25,"</option>"
          ELSE
            WRITE     HTMLFILE;"<option value=",KEY8,">":
                      "(",OSTSITE,") ",KEY25,"</option>"
          ENDIF
.
          GOTO      DSLSIT10
.
DSLSIT99  RETURN
.
.------------------------------------------------------------
. Sites Selection - Multi Hospital Security Test
.------------------------------------------------------------
MLTSIT00  PACK      KEY6,SP70
          CALL      RDSSITA1
MLTSIT10  CALL      RDKSITA1
          BRANCH    OVRCD,MLTSIT99
.
          IF        IBCNMHOS=1
            PACK      KEY16,USERID,SP70
            CALL      RDMLSIT1
            IF        OVRCD=1
              PACK      KEY16,USERID,OSTSITE,SP70
              CALL      RDMLSIT1
              BRANCH    OVRCD,MLTSIT10
            ENDIF
          ENDIF
.
          PACK      KEY25,OSTDESC,SP20
          PACK      KEY8,QUOTE,OSTSITE,QUOTE
.
          WRITE     HTMLFILE;"<option value=",KEY8,">":
                    "(",OSTSITE,") ",KEY25,"</option>"
.
          GOTO      MLTSIT10
.
MLTSIT99  RETURN
.
.------------------------------------------------------------
. Clinic Selection - Doctor Name - Include Active & Inactive
.------------------------------------------------------------
SELCLI00  PACK      KEY20,WBSESIT,SP70
          CALL      RDSCLIA1
SELCLI10  CALL      RDKCLIA1
          BRANCH    OVRCD,SELCLI99
.
          MATCH     WBSESIT,OCASITE            * Check site
          GOTO      SELCLI99 IF NOT EQUAL
.
.         A clinic id has been found, so get the latest record to display
.
          PACK      KEY20,OCASITE,OCACLIN,Z70
          CALL      RDSCLIA1
SELCLI20  CALL      RDPCLIA1
          BRANCH    OVRCD,SELCLI99
.
          MOVE      SP30,KEY25           * initialise doctor name
          MATCH     SP6,OCADOCT
          IF        @EQUAL
            MOVE      OCACLIN,DCODE
            PACK      KEY25,OCADESC
            GOTO      SELCLI30
          ENDIF
.
          MOVE      OCADOCT,KEY6
          CALL      RDDOCT1
          BRANCH    OVRCD,SELCLI30
.
          MOVE      DTITL,PACTITLE
          MOVE      DGNAME,PACGNAME
          MOVE      DSNAME,PACSNAME
          MOVE      ONE,PACFRMT
          CALL      PACNAME
          PACK      KEY25,PACFNAME
.
SELCLI30  PACK      KEY8,QUOTE,OCACLIN,QUOTE
.
          WRITE     HTMLFILE;"<option value=",KEY8,">":
                    "(",OCACLIN,") ",KEY25,"</option>"
          GOTO      SELCLI10
.
SELCLI99  RETURN
.
.------------------------------------------------------------
. Active Clinic Selection - Doctor Name
.------------------------------------------------------------
SELCLA00  PACK      KEY20,WBSESIT,SP70
          CALL      RDSCLIA1
SELCLA10  CALL      RDKCLIA1
          BRANCH    OVRCD,SELCLA99
.
          MATCH     WBSESIT,OCASITE            * Check site
          GOTO      SELCLA99 IF NOT EQUAL
.
.         A clinic id has been found, so get the latest record to display
.
          PACK      KEY20,OCASITE,OCACLIN,Z70
          CALL      RDSCLIA1
SELCLA20  CALL      RDPCLIA1
          BRANCH    OVRCD,SELCLA99
.         Check If Clinic Id is inactive
          MATCH      "1",OTCLIACT
          GOTO      SELCLA10 IF EQUAL
.
          MOVE      SP30,KEY25           * initialise doctor name
          MATCH     SP6,OCADOCT
          IF        @EQUAL
            MOVE      OCACLIN,DCODE
            PACK      KEY25,OCADESC
            GOTO      SELCLA30
          ENDIF
.
          MOVE      OCADOCT,KEY6
          CALL      RDDOCT1
          BRANCH    OVRCD,SELCLA30
.
          MOVE      DTITL,PACTITLE
          MOVE      DGNAME,PACGNAME
          MOVE      DSNAME,PACSNAME
          MOVE      ONE,PACFRMT
          CALL      PACNAME
          PACK      KEY25,PACFNAME
.
SELCLA30  PACK      KEY8,QUOTE,OCACLIN,QUOTE
.
          WRITE     HTMLFILE;"<option value=",KEY8,">":
                    "(",OCACLIN,") ",KEY25,"</option>"
          GOTO      SELCLA10
.
SELCLA99  RETURN
.------------------------------------------------------------
. Clinic Option List
.------------------------------------------------------------
SELCLT00  PACK      KEY42,WBSESIT,SP70
          CALL      RDSCTYA2
SELCLT10  CALL      RDKCTYA2
          BRANCH    OVRCD,SELCLT99
          MATCH     OCTSITE,WBSESIT
          GOTO      SELCLT99 IF NOT EQUAL
          MATCH     "1",OCTACT
          GOTO      SELCLT10 IF EQUAL
          MATCH     CLINICTY,OCTCTYP
          IF        @EQUAL
            WRITE     HTMLFILE;"<option value=#"",OCTCTYP,"#" selected>":
                               OCTDESC,"</option>";
          ELSE
            WRITE     HTMLFILE;"<option value=#"",OCTCTYP,"#">":
                               OCTDESC,"</option>";
          ENDIF
          GOTO      SELCLT10
.
SELCLT99  RETURN
.
.------------------------------------------------------------
. Operating Room List 
.------------------------------------------------------------
SELTHE00  UNPACK    DIM127,DIM1,ACTIVE
          MOVE      ACTIVE,FORM1
.
          PACK      KEY6,SP70
          CALL      RSOPOPR1
SELTHE10  CALL      RKOPOPR1
          BRANCH    OVRCD,SELTHE99
.
          PACK      KEY25,OPRMDESC,SP20
          PACK      KEY8,QUOTE,OPRMROOM,QUOTE
.
          COMPARE     FORM1,ONE
          IF        @EQUAL
            COMPARE   OPRMSTAT,ZERO       * active theatre
            IF      !@EQUAL
              GOTO    SELTHE10
            ENDIF
          ENDIF
.
          WRITE     HTMLFILE;"<option value=",KEY8,">":
                    "(",OPRMROOM,") ",KEY25,"</option>"
.
          GOTO      SELTHE10
.
SELTHE99  RETURN
.
.------------------------------------------------------------
. Receipting Cashier List
.------------------------------------------------------------
SELCSH00  PACK      KEY6,SP70
          CALL      RDSCIDA1
SELCSH10  CALL      RDKCIDA1
          BRANCH    OVRCD,SELCSH99
.
          MATCH     "1",RCCIACTV
          GOTO      SELCSH10 IF EQUAL      * Inactive
.
          PACK      KEY25,RCPGIVEN,SP1,RCPSUR,SP20
.
          MOVE      ZERO,DIM1      * No password flag
          MATCH     SP10,RCPPASS
          IF        !@EQUAL
            MOVE      ONE,DIM1     * Password found flag
          ENDIF
.
          PACK      KEY9,QUOTE,RCPCASH,DIM1,QUOTE
          IF        IBCNMHOS=1
            MATCH     SP70,RCCIHOSP
            IF        !@EQUAL
              MATCH     WBSEHOSP,RCCIHOSP
              GOTO      SELCSH10 IF NOT EQUAL
            ENDIF
          ENDIF
.
          WRITE     HTMLFILE;"<option value=",KEY9,">":
                    "(",RCPCASH,") ",KEY25,"</option>"
.
          GOTO      SELCSH10
.
SELCSH99  RETURN
.
.------------------------------------------------------------
. Theatre Nurse List
.------------------------------------------------------------
SELNUR00  PACK      KEY6,SP70
          CALL      RSOPNUR1
SELNUR10  CALL      RKOPNUR1
          BRANCH    OVRCD,SELNUR99
.
          PACK      PACTITLE,SP70
          MOVE      OPNRGNAM,PACGNAME
          MOVE      OPNRSNAM,PACSNAME
          MOVE      ONE,PACFRMT
          CALL      PACNAME
          PACK      KEY25,PACFNAME

          PACK      KEY8,QUOTE,OPNRCODE,QUOTE
.
          WRITE     HTMLFILE;"<option value=",KEY8,">":
                    "(",OPNRCODE,") ",KEY25,"</option>"
.
          GOTO      SELNUR10
.
SELNUR99  RETURN
.------------------------------------------------------------
. Outpatient Letter Types 
.------------------------------------------------------------
SELOLT00  MOVE      ZERO,OTLTLINO
          PACK      KEY6,OTLTLINO,SP70
          CALL      RSOTLET2
SELOLT10  CALL      RKOTLET2
          BRANCH    OVRCD,SELOLT99
.
          COMPARE   ZERO,OTLTLINO
          GOTO      SELOLT99 IF NOT EQUAL
.
          MATCH     "1",OTLTACTV                 * Skip Inactive 
          GOTO      SELOLT10 IF EQUAL
.
          MATCH     "1",OTLTCOMM                 * Skip if SMS 
          GOTO      SELOLT10 IF EQUAL
.
          PACK      KEY25,OTLTTEXT,SP30
          PACK      KEY8,QUOTE,DOTLTLTN,QUOTE
.
          WRITE     HTMLFILE;"<option value=",KEY8,">":
                    "(",DOTLTLTN,") ",KEY25,"</option>"
.
          GOTO      SELOLT10
.
SELOLT99  RETURN
.
.------------------------------------------------------------
. Outpatient SMS Selection List
.------------------------------------------------------------
SMSOLT00  MOVE      ZERO,OTLTLINO
          PACK      KEY6,OTLTLINO,SP70
          CALL      RSOTLET2
SMSOLT10  CALL      RKOTLET2
          BRANCH    OVRCD,SMSOLT99
.
          COMPARE   ZERO,OTLTLINO
          GOTO      SMSOLT99 IF NOT EQUAL
.
          MATCH     "1",OTLTACTV                 * Skip Inactive
          GOTO      SMSOLT10 IF EQUAL
.
          MATCH     "1",OTLTCOMM                 * Skip if NOT SMS
          GOTO      SMSOLT10 IF NOT EQUAL
.
          PACK      KEY25,OTLTTEXT,SP30
          PACK      KEY8,QUOTE,DOTLTLTN,QUOTE
.
          WRITE     HTMLFILE;"<option value=",KEY8,">":
                    "(",DOTLTLTN,") ",KEY25,"</option>"
.
          GOTO      SMSOLT10
.
SMSOLT99  RETURN
.
.------------------------------------------------------------
. Patient Financial Letters Type
.------------------------------------------------------------
SELFLT00  PACK      KEY6,SP2,ZERO,SP3 
          CALL      RSPTFL2 
SELFLT10  CALL      RKPTFL2 
          BRANCH    OVRCD,SELFLT99
.
          MATCH "EW",PTFLTEXT
          GOTO SELFLT10 IF EQUAL
.
          COMPARE   ZERO,PTFLLINO               * header line ?
          GOTO      SELFLT10 IF NOT EQUAL       * no
.
          MATCH     "1",PTFLACTV                 * Skip Inactive
          GOTO      SELFLT10 IF EQUAL
.
          PACK      KEY25,PTFLTEXT,SP30
          PACK      KEY8,QUOTE,DPTFLLTN,QUOTE
.
          WRITE     HTMLFILE;"<option value=",KEY8,">":
                    "(",DPTFLLTN,") ",KEY25,"</option>"
.
          GOTO      SELFLT10
.
SELFLT99  RETURN
.
.------------------------------------------------------------
. Waiting List Patient Extract   
.------------------------------------------------------------
SELWPE00  PACK      KEY4,SP70          
          CALL      RSWTEXT1
SELWPE10  CALL      RKWTEXT1
          BRANCH    OVRCD,SELWPE99
.
SELWPE20  PACK      KEY8,QUOTE,WTEXCODE,QUOTE
.
          WRITE     HTMLFILE;"<option value=",KEY8,">":
                    "(",WTEXCODE,") ",WTEXDESC,"</option>"
.
          GOTO      SELWPE10
.
SELWPE99  RETURN
.
.------------------------------------------------------------
. Procedure Groups Selevction List 
.------------------------------------------------------------
SELPGP00  PACK      KEY5,SP10         
          CALL      RDSICG1 
SELPGP10  CALL      RDKICG1 
          BRANCH    OVRCD,SELPGP99
.
          MATCH     ANSO,GIDCODE                * operation   ?
          GOTO      SELPGP10 IF NOT EQUAL       * no
.
          PACK      KEY25,GDESC,SP30
          PACK      KEY8,QUOTE,GGPCODE,QUOTE
.
          WRITE     HTMLFILE;"<option value=",KEY8,">":
                    "(",GGPCODE,") ",KEY25,"</option>"
.
          GOTO      SELPGP10
.
SELPGP99  RETURN
.
.------------------------------------------------------------
. Private Practice Medical Practice  
.------------------------------------------------------------
SELPPP00  PACK      KEY6,SP10         
          CALL      RSPRPR1 
SELPPP10  CALL      RKPRPR1 
          BRANCH    OVRCD,SELPPP99
.
          PACK      KEY25,PRPRDESC,SP30
          PACK      KEY8,QUOTE,PRPRCODE,QUOTE
.
          WRITE     HTMLFILE;"<option value=",KEY8,">":
                    "(",PRPRCODE,") ",KEY25,"</option>"
.
          GOTO      SELPPP10
.
SELPPP99  RETURN
.
.------------------------------------------------------------
. Private Practice Medical Practice - with security checks
.------------------------------------------------------------
SELPPS00  MOVE      ZERO,ALLACCES 

          PACK      KEY10,WBSEUID,SP70
          CALL      RDPRALS1
          BRANCH    OVRCD,SELPPS05
.
          MOVE      ONE,ALLACCES       * User has access to all practices
          IF        FORM1=1
            WRITE     HTMLFILE;"<option></option>"
          ENDIF
.
SELPPS05  IF        FORM1=1
            PACK      KEY36,SP70
            CALL      RSPRPR2
          ELSE
            PACK      KEY6,SP10
            CALL      RSPRPR1
          ENDIF
SELPPS10  IF        FORM1=1
            CALL      RKPRPR2
          ELSE
            CALL      RKPRPR1
          ENDIF
          BRANCH    OVRCD,SELPPS99
.
          IF        ALLACCES=0
            PACK      KEY16,WBSEUID,PRPRCODE,SP70
            CALL      RDPRSEC2
            BRANCH    OVRCD,SELPPS10
          ENDIF
.
          PACK      KEY25,PRPRDESC,SP30
          PACK      KEY8,QUOTE,PRPRCODE,QUOTE
.
          IF        FORM1=1
            WRITE     HTMLFILE;"<option value=",KEY8,">":
                      KEY25,"</option>"
          ELSE
            WRITE     HTMLFILE;"<option value=",KEY8,">":
                      "(",PRPRCODE,") ",KEY25,"</option>"
          ENDIF
.
          GOTO      SELPPS10
.
SELPPS99  RETURN
.
.
.------------------------------------------------------------
. Patient Invoice Messages              
.------------------------------------------------------------
SELPIM00  PACK      KEY3,SP10         
          CALL      RDSMESG1 
SELPIM10  CALL      RDKMESG1 
          BRANCH    OVRCD,SELPIM99
.
          PACK      KEY25,PMLINE1,SP30
          PACK      KEY8,QUOTE,PMCODE,QUOTE
.
          WRITE     HTMLFILE;"<option value=",KEY8,">":
                    "(",PMCODE,") ",KEY25,"</option>"
.
          GOTO      SELPIM10
.
SELPIM99  RETURN
.
.------------------------------------------------------------
. Private Practice Doctors within Practice
.------------------------------------------------------------
SELPPD00  PACK      FIRST12,SP70
          PACK      KEY22,SP70
          CALL      RSPRDO2
SELPPD10  CALL      RKPRDO2
          BRANCH    OVRCD,SELPPD99
.
          MATCH     SP10,PRDODOCT
          GOTO      SELPPD10 IF EQUAL
.
          MATCH     SP70,FIRST12
          GOTO      SELPPD20 IF NOT EQUAL
.
          GOTO      SELPPD30
.
SELPPD20  PACK      TEST12,PRDODOCT,SP10
          MATCH     FIRST12,TEST12
          GOTO      SELPPD10 IF EQUAL
.
SELPPD30  PACK      FIRST12,PRDODOCT,SP10
          MOVE      SP25,KEY25
          MOVE      PRDODOCT,DCODE
          PACK      KEY10,PRDODOCT,SP10
          CALL      RDPMHCP1
          BRANCH    OVRCD,SELPPD40
.
          MOVE      "1",PACFRMT
          MOVE      PMHCTITL,PACTITLE
          MOVE      PMHCSNAM,PACSNAME
          MOVE      PMHCGNAM,PACGNAME
          CALL      PACNAME
          MOVE      PACFNAME,KEY25
.
SELPPD40  PACK      KEY14,QUOTE,PRDODOCT,QUOTE
.
          WRITE     HTMLFILE;"<option value=",KEY14,">":
                      "(",PRDODOCT,") ",KEY25,"</option>"
.
          GOTO      SELPPD10
.
SELPPD99  RETURN
.
.------------------------------------------------------------
. Private Practice Doctors within Practice
.------------------------------------------------------------
.SELPPD00  PACK      KEY22,SP70         
.          PACK      FIRST12,SP20
.          CALL      RSPRDO1 
.SELPPD10  CALL      RKPRDO1 
.          BRANCH    OVRCD,SELPPD99
.
.          MATCH     SP70,FIRST12
.          GOTO      SELPPD20 IF NOT EQUAL
.
.          GOTO      SELPPD30
.
.SELPPD20  PACK      TEST12,PRDOPRAC,PRDODOCT,SP10
.          MATCH     FIRST12,TEST12
.          GOTO      SELPPD10 IF EQUAL
.   
.SELPPD30  PACK      FIRST12,PRDOPRAC,PRDODOCT,SP10
.          MOVE      SP25,KEY25
.          MOVE      PRDODOCT,DCODE
.          PACK      KEY6,PRDODOCT
.          CALL      RDDOCT1
.          BRANCH    OVRCD,SELPPD40
.
.          MOVE      "1",PACFRMT
.          MOVE      DTITL,PACTITLE
.          MOVE      DSNAME,PACSNAME
.          MOVE      DGNAME,PACGNAME
.          CALL      PACNAME
.          MOVE      PACFNAME,KEY25
.
.SELPPD40  PACK      KEY14,QUOTE,PRDOPRAC,PRDODOCT,QUOTE
.
.          WRITE     HTMLFILE;"<option value=",KEY14,">":
.                    "(",PRDOPRAC,"-",PRDODOCT,") ",KEY25,"</option>"
.
.          GOTO      SELPPD10
.
.SELPPD99  RETURN
.
.------------------------------------------------------------
. Private Practice Financial Letters Type
.------------------------------------------------------------
.SELPPF00  PACK      KEY6,SP10          
.          CALL      RSPRFL2 
.SELPPF10  CALL      RKPRFL2 
.          BRANCH    OVRCD,SELPPF99
.
.          MATCH "EW",PRFLTEXT
.          GOTO SELPPF10 IF EQUAL
.          COMPARE   ZERO,PRFLLINE               * header line ?
.          GOTO      SELPPF10 IF NOT EQUAL       * no
.
.          PACK      KEY25,PRFLTEXT,SP30
.          PACK      KEY8,QUOTE,DPRFLNUM,QUOTE
.
.          WRITE     HTMLFILE;"<option value=",KEY8,">":
.                    "(",DPRFLNUM,") ",KEY25,"</option>"
.
.          GOTO      SELPPF10
.
.SELPPF99  RETURN
.
.------------------------------------------------------------
. Extraction Files selection list
.------------------------------------------------------------
SELEXT00  MOVE       ONE,OPTION
.
SELEXT10  COMPARE    "17",OPTION
          GOTO       SELEXT99 IF EQUAL
.
          CALL       SECPOS00
          READ       CONTROLF,SEC;*ETABPS,EDATE,EFDATE,ETDATE
          MATCH      SP8,EDATE
          GOTO       SELEXT20 IF EQUAL
.
          UNPACK     EDATE,CCENT,CYEAR,CMON,CDAY
          CALL       PACDATE                  * pack the date
          MOVE       CPCDATE,EXCDATE
          UNPACK     EFDATE,CCENT,CYEAR,CMON,CDAY
          CALL       PACDATE                  * pack the date
          MOVE       CPCDATE,EXFDATE
          UNPACK     ETDATE,CCENT,CYEAR,CMON,CDAY
          CALL       PACDATE                  * pack the date
          MOVE       CPCDATE,EXTDATE
.
          PACK       KEY25,EXFDATE,HYPH,EXTDATE,SP10
          PACK       KEY8,QUOTE,OPTION,QUOTE
          WRITE      HTMLFILE;"<option value=",KEY8,">":
                     "(",OPTION,") ",KEY25,"</option>"
.          
          ADD        ONE,OPTION
          GOTO       SELEXT10
.
SELEXT20  ADD        ONE,OPTION
          GOTO       SELEXT10
.
SELEXT99  RETURN
.
.------------------------------------------------------------
. Clinic Name Selection
.------------------------------------------------------------
SELCLD00  PACK      KEY20,WBSESIT,SP70
          CALL      RDSCLIA1
SELCLD10  CALL      RDKCLIA1
          BRANCH    OVRCD,SELCLD99
.
          MATCH     WBSESIT,OCASITE           * Check site
          GOTO      SELCLD99 IF NOT EQUAL
.
.         A clinic id has been found, so get the latest record to display
.
          PACK      KEY20,OCASITE,OCACLIN,Z70
          CALL      RDSCLIA1
SELCLD20  CALL      RDPCLIA1
          BRANCH    OVRCD,SELCLD99
.
          PACK      KEY25,OCADESC
.
          PACK      KEY8,QUOTE,OCACLIN,QUOTE
.
          WRITE     HTMLFILE;"<option value=",KEY8,">":
                    "(",OCACLIN,") ",KEY25,"</option>"
          GOTO      SELCLD10
.
SELCLD99  RETURN
.------------------------------------------------------------
. Clinic Option List
.
.       CALCULATE SECTOR AND TAB POSITION FOR DATES
.
SECPOS00  MOVE       OPTION,ETABPS
          MOVE       TEN1,SEC       ***** SECTOR 11 & 12
          COMPARE    "9",ETABPS
          GOTO       SECPOS10 IF LESS
          SUB        "8",ETABPS
          ADD        ONE,SEC
.
SECPOS10  MULT       "30",ETABPS
          SUB        "29",ETABPS
.
SECPOS99  RETURN
.
.------------------------------------------------------------
. Ward selection
.------------------------------------------------------------
WSEL0000  PACK      KEY29,SP70
          IF        IBCNMHOS = 1
            PACK      KEY29,SP3,HOSPCODE,SP70
          ENDIF
          CALL      RDSWARD7
WSEL0100  CALL      RDKWARD7
          BRANCH    OVRCD,WSEL9999
.
.                         if we have a bed number we have passed all the ward
.                         master records, so exit
          MATCH     SP70,WBED
          GOTO      WSEL9999 IF NOT EQUAL
.
          COMPARE   WACTIVE,ZERO                 *List only active wards
          GOTO      WSEL0100 IF NOT EQUAL
.
          IF        IBCNMHOS = 1
            MATCH      SP3,HOSPCODE
            IF        !@EQUAL
              MATCH     HOSPCODE,PTWDHOSN
              GOTO      WSEL9999 IF NOT EQUAL
              GOTO      WSEL9999 IF EOS
            ENDIF
          ENDIF
.
.                       write the select option.
          WRITE     HTMLFILE;"<option value=#"",WWARD,"#">",WBDESC;
.
          IF        IBCNMHOS = 1
            MATCH      SP3,HOSPCODE
            IF        @EQUAL
              WRITE     HTMLFILE;" - ",PTWDHOSN;
            ENDIF
          ENDIF
.
          WRITE     HTMLFILE;"</option>"
          GOTO      WSEL0100
.
WSEL9999  RETURN
.
.------------------------------------------------------------
. Nursing Station selection
.------------------------------------------------------------
NSEL0000  PACK      KEY6,SP70
          CALL      RDSNURS1
NSEL1000  CALL      RDKNURS1
          BRANCH    OVRCD,NSEL9999
          MATCH     SP70,NWARD
          GOTO      NSEL1000 IF NOT EQUAL
          PACK      KEY5,QUOTE,NSTAT,QUOTE
          WRITE     HTMLFILE;"<option value=",KEY5,">",NSDESC,"   (",NSTAT:
                             ")</option>";
          GOTO      NSEL1000
NSEL9999  RETURN
.------------------------------------------------------------
. Category Selection List                     
.------------------------------------------------------------
SELCOD00  PACK      KEY5,SP70 
          CALL      RDSCODE3
SELCOD10  CALL      RDKCODE3
          BRANCH    OVRCD,SELCOD99
          MATCH     SP70,ACODE
          GOTO      SELCOD99 IF NOT EQUAL
          MATCH     "I",PTCOACTV
          GOTO      SELCOD10 IF EQUAL
.
          PACK      KEY4,QUOTE,TCODE,QUOTE
          WRITE     HTMLFILE;"<option value=",KEY4,">(",TCODE,") ":
                             TDESC,"</option>"
          GOTO      SELCOD10
.
SELCOD99  RETURN
.
.-------------------------------------------------------------------------
. Category Selection List. All hospitals and all codes (Included inactive)
.-------------------------------------------------------------------------
SELCDA00  PACK      PTCDKEY2,CATEGORY,SP70
          CALL      RDSCODE2
SELCDA10  CALL      RDKCODE2
          BRANCH    OVRCD,SELCDA99
.
          MATCH     CATEGORY,TCODE
          GOTO      SELCDA99 IF NOT EQUAL
.
          MATCH     SP70,ACODE
          GOTO      SELCDA10 IF EQUAL
.
          PACK      KEY40,TCINDC1,TCINDC2,TCINDC3,TCINDC4,TCINDC5:
                          TCINDC6,TCINDC7,TCINDC8,TCINDC9,TCINDC10:
                          TCINDC11,THCSCOD,PTCDNHCP,TCFORM6:
                          TCINDC12,TCINDC13,TCINDC14,TCINDC15,TCINDC16:
                          TCINDC17,TCINDC18,TCINDC19,TCINDC20,TCINDC21:
                          PTCOACTV
.
          WRITE     HTMLFILE;"<option value=#"",ACODE,KEY40,"#">",TDESC:
                               "</option>"
          GOTO      SELCDA10
.
SELCDA99  RETURN
.
.------------------------------------------------------------
. Category DT Selection List                     
.------------------------------------------------------------
SELCDT00  MOVE      "DT",CATEGORY
          MOVE      SP70,CODE
          CALL      CODSEL00
SELCDT99  RETURN
.------------------------------------------------------------
. Category CP Selection List                     
.------------------------------------------------------------
SELCCP00  MOVE      "CP",CATEGORY
          MOVE      SP70,CODE
          CALL      CODSEL00
SELCCP99  RETURN
.------------------------------------------------------------
. Category CL Selection List                     
.------------------------------------------------------------
SELCCL00  MOVE      "CL",CATEGORY
          MOVE      SP70,CODE
          CALL      CODSEL00
SELCCL99  RETURN
.
.------------------------------------------------------------
. Category A  Selection List                     
.------------------------------------------------------------
SELATY00  MOVE      "A ",CATEGORY
          MOVE      SP70,CODE
          CALL      CODSEL00
SELATY99  RETURN
.
.------------------------------------------------------------
.------------------------------------------------------------
. Select Intent Re-admit
.------------------------------------------------------------
SELRAD00  READ      CONTROLF,TWENTY1;*209,PTCNADMT
          IF        PTCNADMT=0
            MOVE      ONE,PTCNADMT           * default to User defined field 1
          ENDIF
          LOAD      CATEGORY,PTCNADMT,CATD1,CATD2,CATD3,CATD4:
                                      CATD5,CATU6,CATU7,CATVR
          MOVE      SP70,CODE
          CALL      CODSEL00
SELRAD99  RETURN
.
.------------------------------------------------------------
. Health fund group Selection
.------------------------------------------------------------
SELHFG00  PACK      KEY6,SP70
          CALL      RSPAHGP1
SELHFG10  CALL      RKPAHGP1
          BRANCH    OVRCD,SELHFG99
          PACK      KEY8,QUOTE,PTHGCODE,QUOTE
          WRITE     HTMLFILE;"<option value=",KEY8,">":
                             PTHGDESC,"</option>"
          GOTO      SELHFG10
SELHFG99  RETURN
.
.------------------------------------------------------------
. Health fund Selection
.------------------------------------------------------------
SELHFN00  PACK      KEY14,SP70
          CALL      RDSFUND1
SELHFN10  CALL      RDKFUND1
          BRANCH    OVRCD,SELHFN99
.
          MATCH     SP8,HFTABL           * Check health fund table
          GOTO      SELHFN10 IF EQUAL
.
          MATCH     "0000    ",HFTABL
          GOTO      SELHFN10 IF NOT EQUAL
.
          BRANCH    PHFTACT,SELHFN10     * ignore inactive HF
.
          PACK      KEY8,QUOTE,HCODE,QUOTE
          MATCH     "1",HFCODDSP
          IF        @EQUAL
            WRITE     HTMLFILE;"<option value=",KEY8,">":
                            HCODE,": ",HFNAME,"</option>" 
          ELSE
            WRITE     HTMLFILE;"<option value=",KEY8,">":
                             HFNAME,"</option>"          
          ENDIF
          GOTO      SELHFN10
.
SELHFN99  RETURN
.
.------------------------------------------------------------
. Waiting List Letters Selection
.------------------------------------------------------------
LETSEL00  MOVE      ZERO,F3
          PACK      KEY6,F3,SP70
          CALL      RDSLET2
LETSEL10  CALL      RDKLET2
          BRANCH    OVRCD,LETSEL99
.
          COMPARE   ZERO,WLINNO
          GOTO      LETSEL99 IF NOT EQUAL
.
          MATCH     "1",WLETACTV            * Skip if inactive
          GOTO      LETSEL10 IF EQUAL
.
          MATCH     "1",WLETCOMM            * Skip if SMS
          GOTO      LETSEL10 IF EQUAL
.
          WRITE     HTMLFILE;"<option value=",WLETNO,">":
                             WLTEXT,"</option>"
          GOTO       LETSEL10
.
LETSEL99 RETURN
.
.------------------------------------------------------------
. Waiting List SMS Selection
.------------------------------------------------------------
SMSSEL00  MOVE      ZERO,F3
          PACK      KEY6,F3,SP70
          CALL      RDSLET2
SMSSEL10  CALL      RDKLET2
          BRANCH    OVRCD,SMSSEL99
.
          COMPARE   ZERO,WLINNO
          GOTO      SMSSEL99 IF NOT EQUAL
.
          MATCH     "1",WLETACTV            * Skip if inactive
          GOTO      SMSSEL10 IF EQUAL
.
          MATCH     "1",WLETCOMM            * Skip if NOT SMS
          GOTO      SMSSEL10 IF NOT EQUAL
.
          WRITE     HTMLFILE;"<option value=",WLETNO,">":
                             WLTEXT,"</option>"
          GOTO      SMSSEL10
.
SMSSEL99 RETURN
.
.------------------------------------------------------------
. GST Code Selection
.------------------------------------------------------------
SELGST00  PACK      KEY6,SP70
          CALL      RAIBGS1 
SELGST10  CALL      RKIBGS1  
          BRANCH    OVRCD,SELGST99
          PACK      KEY8,QUOTE,IBGSCODE,QUOTE
          WRITE     HTMLFILE;"<option value=",KEY8,">":
                             IBGSDESC,"</option>"
          GOTO      SELGST10
SELGST99  RETURN
.
.******************************************** Start of addition        *I-59171
.------------------------------------------------------------
. Register Selection List
.------------------------------------------------------------
SELREG00  PACK      KEY3,SP70
          CALL      RDSREGA1
SELREG10  CALL      RDKREGA1
          BRANCH    OVRCD,SELREG99
.
          PACK      KEY35,REGDESC,SP30
          PACK      KEY5,QUOTE,REGCODE,QUOTE
.
          IF        IBCNMHOS=1
            MATCH     "1",KEY1
            IF        @EQUAL
              MATCH     WBSEHOSP,REGHOSP
              GOTO      SELREG10 IF NOT EQUAL    * different hospital
            ENDIF
          ENDIF
.
          WRITE     HTMLFILE;"<option value=",KEY5,">":
                    "(",REGCODE,") ",KEY35,"</option>"
.
          GOTO      SELREG10
.
SELREG99  RETURN
+
.-----------------------------------------------------------
.  Cheque Account Selection List - fmschqaf
.-----------------------------------------------------------
CHQSLT00  PACK      KEY15,SP70
          CALL      RSFMCH1
CHQSLT10  CALL      RKFMCH1
          BRANCH    OVRCD,CHQSLT99
.
          PACK      KEY17,QUOTE,FMCHCHQ,QUOTE
          MATCH     CHQACCNT,FMCHCHQ
          IF        @EQUAL
            WRITE     HTMLFILE;"<option value=",KEY17,"selected>":
                               FMCHDES,"</option>"
          ELSE
            WRITE     HTMLFILE;"<option value=",KEY17,">":
                               FMCHDES,"</option>"
          ENDIF
          GOTO      CHQSLT10
.
CHQSLT99  RETURN
+
.------------------------------------------------------------------------------
. List all HCPs based on pmhchcst for <select>
.------------------------------------------------------------------------------
SUCOLS00  PACK      KEY10,SP70
          CALL      RSPMHCP1
SUCOLS10  CALL      RKPMHCP1
          BRANCH    OVRCD,SUCOLS99
.
          MATCH     "1",PMHCSTTS
          GOTO      SUCOLS10 IF EQUAL
.
          COMPARE   "0",PMHCHCST
          GOTO      SUCOLS20 IF EQUAL
.
          COMPARE   "2",PMHCHCST
          GOTO      SUCOLS20 IF EQUAL
.
          COMPARE   "4",PMHCHCST
          GOTO      SUCOLS20 IF EQUAL
.
          COMPARE   "6",PMHCHCST
          GOTO      SUCOLS20 IF EQUAL
.
          COMPARE   "8",PMHCHCST
          GOTO      SUCOLS20 IF EQUAL
.
          COMPARE   "10",PMHCHCST
          GOTO      SUCOLS20 IF EQUAL
.
          COMPARE   "11",PMHCHCST
          GOTO      SUCOLS20 IF EQUAL
.
          COMPARE   "13",PMHCHCST
          GOTO      SUCOLS20 IF EQUAL
.
          GOTO      SUCOLS10
.
SUCOLS20  WRITE     HTMLFILE;"<option value=#"",PMHCHCPC,"#">":
                             PMHCGNAM," ",PMHCSNAM,"</option>";
          GOTO      SUCOLS10
.
SUCOLS99  RETURN
+
.------------------------------------------------------------------------------
. List all Booking Letters for <select>
.------------------------------------------------------------------------------
BSMS0000  PACK      KEY6,SP70
          CALL      BRDSLET1
BSMS0010  CALL      BRDKLET1
          BRANCH    OVRCD,BSMS9999
.
          MATCH     "1",BLETACTV
          GOTO      BSMS0010 IF EQUAL         * Skip if not active
.
          MATCH     "1",BLETCOMM              * Skip if not SMS
          GOTO      BSMS0010 IF NOT EQUAL
.
          MATCH     "  0",DBLINNO             * Skip if not name
          GOTO      BSMS0010 IF NOT EQUAL
.
          WRITE     HTMLFILE;"<option value=#"",DBLETNO,"#">":
                             BLTEXT,"</option>";
          GOTO      BSMS0010
.
BSMS9999  RETURN
+
.------------------------------------------------------------
. BOKLETIO table reads (that don't interfere)
.------------------------------------------------------------
BRDSLET1
         MOVE     ZERO,OVRCD
         RESET    KEY6
         READ     BOKLETR1,KEY6;;
         RETURN
.
BRDKLET1
         MOVE     ZERO,OVRCD
         READKS   BOKLETR1;DBLETNO,DBLINNO,BLTEXT,BLVAR,BLETPBOT,BLETPTOP:
                           BLETPPAG,BLETPTAB,BLETACTV,BLETCOMM,BLETSPAR
         GOTO     OVERCOND IF OVER
         MOVE     DBLETNO,BLETNO
         MOVE     DBLINNO,BLINNO
         RETURN
+
.------------------------------------------------------------
. PAT93 Report Selection List
.------------------------------------------------------------
RPTSEL00  MOVE      ZERO,FORM2
          READ      CONTROLF,TEN3;*216,CUSR1,*229,CUSR2
          READ      CONTROLF,TEN5;*191,CMUSR1,*204,CMUSR2:
                                  *217,CMUSR3,*233,CUSR3
          READ      CONTROLF,TEN8;*17,CUSR4,*31,CUSR5:
                                  *45,CUSR6,*59,CUSR7
.
RPTSEL10  ADD       ONE,FORM2
          COMPARE   "28",FORM2                             * was 14   *C-157391
          GOTO      RPTSEL50 IF NOT LESS
.
          LOAD      KEY25,FORM2,P9301,P9302,P9303,P9304,P9305,P9306,P9307:
                                P9308,P9309,P9310,P9311,P9312,P9313,P9314:
                                P9315,P9316,P9317,P9318,P9319,P9320,P9321:
                                P9322,P9323,P9324,P9325,P9326,P9327
.
          WRITE     HTMLFILE;"<option value=",FORM2,">",KEY25,"</option>"
          GOTO      RPTSEL10
.
RPTSEL50  MOVE      ONE,COUNT
.
.------ test the user defined fields ------
.
RPTSEL60  LOAD      FORM1,COUNT,CUSR1,CUSR2,CUSR3,CUSR4,CUSR5,CUSR6,CUSR7:
                                CMUSR1,CMUSR2,CMUSR3,ONE
.
          COMPARE   ONE,FORM1               * see if the user defined field
          GOTO      RPTSEL80 IF NOT EQUAL     is turned on
.
          LOAD      CATEGORY,COUNT,CATU1,CATU2,CATU3,CATU4,CATU5,CATU6:
                                   CATU7,CATP1,CATP2,CATP3,CATLA
.
          MOVE      SP20,TDESC
          PACK      KEY5,CATEGORY,SP3
          CALL      RDCODE1                 * read the patient codes file
          MOVE      TDESC,KEY25
.
          WRITE     HTMLFILE;"<option value=",FORM2,">",KEY25,"</option>"
.
          ADD       ONE,FORM2
.
.------ increment the counter and see if there are no more user defined ------
.------ fields ------
.
RPTSEL80  ADD       ONE,COUNT
          COMPARE   TEN2,COUNT              * try next user defined field if
          GOTO      RPTSEL60 IF NOT EQUAL     appropriate
.
RPTSEL99  RETURN
.
.------------------------------------------------------------
. IBA Parameter: Display,Update
.------------------------------------------------------------
PARAMC00  RESET     UPDTTYPE
          MATCH     SP1,UPDTTYPE
          GOTO      PARAMC20 IF EQUAL
.
          MATCH     "U",UPDTTYPE    * Update formaction
          GOTO      PARAMC10 IF EQUAL
.
          GOTO      PARAMC90
.
.         ************ UPDATE FORMACTION **********
.
PARAMC10  READ      CONTROLF,HUND01;*41,CWEBPSTY,CWEBPSAG,*45,CWEBPNAM:
                                        CWEBDNAM,CWEBSDAY,CWEBDNAI,CWEBPSAR:
                                    *96,CWEBGVTD,*98,CWEBDDOB,*106,CWEBPAED
          READ      CONTROLF,HUND09;*160,PTCNSTGV
          READ      CONTROLF,HUND25;*155,PTCNEPMI,*156,PTCNESBT
.
          MATCH     SP70,CONFLD01
          IF        !@EQUAL
            MOVE      CONFLD01,CWEBPSTY
          ENDIF
.
          MATCH     SP70,CONFLD02
          IF        !@EQUAL
            MOVE      CONFLD02,CWEBPSAG
          ENDIF
.
          MATCH     SP70,CONFLD03
          IF        !@EQUAL
            MOVE      CONFLD03,CWEBPSAR
          ENDIF
.
          MATCH     SP70,CONFLD04
          IF        !@EQUAL
            MOVE      CONFLD04,CWEBPNAM
          ENDIF
.
          MATCH     SP70,CONFLD05
          IF        !@EQUAL
            MOVE      CONFLD05,CWEBDNAM
          ENDIF
.
          COMPARE   ZERO,CONFLD06
          IF        !@EQUAL
            MOVE      CONFLD06,CWEBSDAY
          ENDIF
.
          MATCH     Z70,CONFLD07
          IF        !@EQUAL
            MOVE      CONFLD07,PTCNSTGV
          ENDIF
.
          MATCH     Z70,CONFLD08
          IF        !@EQUAL
            MOVE      CONFLD08,CWEBDNAI
          ENDIF
.
          MATCH     Z70,CONFLD14
          IF        !@EQUAL
            MOVE      CONFLD14,CWEBGVTD
          ENDIF
.
          MATCH     SP70,CONFLD15
          IF        !@EQUAL
            UNPACK    CONFLD15,CDAY,KEY1,MTHNAM3,KEY1,CCENT,CYEAR
            CALL      SETMTH00
            PACK      CWEBDDOB,CCENT,CYEAR,CMON,CDAY
            REP       " 0",CWEBDDOB
          ENDIF
.
          MATCH     Z70,CONFLD16
          IF        !@EQUAL
            MOVE      CONFLD16,CWEBPAED
          ENDIF
.
          WRITAB    CONTROLF,HUND01;*41,CWEBPSTY,CWEBPSAG,*45,CWEBPNAM:
                                        CWEBDNAM,CWEBSDAY,CWEBDNAI,CWEBPSAR:
                                    *96,CWEBGVTD,*98,CWEBDDOB,*106,CWEBPAED
.
          WRITAB    CONTROLF,HUND09;*160,PTCNSTGV
.
          MATCH     SP70,CONFLD09
          IF        !@EQUAL
            MOVE      CONFLD09,CSRCHDRG
          ENDIF
.
          MATCH     SP70,CONFLD10
          IF        !@EQUAL
            MOVE      CONFLD10,CSRCHYRG
          ENDIF
.
          WRITAB    CONTROLF,TEN;*246,CSRCHDRG,CSRCHYRG
.
          MATCH     Z70,CONFLD11
          IF        !@EQUAL
            MOVE      CONFLD11,PTCSXOFF
          ENDIF
.
          WRITAB    CONTROLF,HUND19;*248,PTCSXOFF
.
          MATCH     Z70,CONFLD12
          IF        !@EQUAL
            MOVE      CONFLD12,PTCNEPMI
          ENDIF
.
          MATCH     Z70,CONFLD13
          IF        !@EQUAL
            MOVE      CONFLD13,PTCNESBT
          ENDIF
.
          WRITAB    CONTROLF,HUND25;*155,PTCNEPMI,*156,PTCNESBT
.
          MOVE      "Update Complete",WEBTITLE
          CALL      WEBERR00
          GOTO      PARAMC99

.         ************ DISPLAY FORMACTION **********

PARAMC20  CLEAR     WEBTITLE
          MOVE      "Parameter Maintenance",WEBTITLE
          RESET     WEBTITLE
.
          READ      CONTROLF,HUND01;*41,CWEBPSTY,CWEBPSAG,*45,CWEBPNAM:
                                        CWEBDNAM,CWEBSDAY,CWEBDNAI,CWEBPSAR:
                                    *96,CWEBGVTD,*98,CWEBDDOB,*106,CWEBPAED
          READ      CONTROLF,HUND09;*160,PTCNSTGV
.
          READ      CONTROLF,HUND19;*248,PTCSXOFF
.
          READ      CONTROLF,HUND25;*155,PTCNEPMI,*156,PTCNESBT
.
          CALL      WEBHED00   * Create Output File and Write HTML Page Header
          BRANCH    EXIT,PARAMC99
          CALL      WEBBOD00   * Process Web Body
          CALL      WEBEND00   * Process End of HTML File
          GOTO      RSHIBC99
.
PARAMC90  MOVE      "Invalid Option.",WEBTITLE
          CALL      WEBERR00
          GOTO      RSHIBC99

PARAMC99  RETURN
.------------------------------------------------------------
. Parameter screen 
.------------------------------------------------------------
PARC0000  BRANCH    FLDITMNO,PARC0100,PARC0200,PARC0300,PARC0400,PARC0500:
                             PARC0600,PARC0700,PARC0800,PARC0900,PARC1000:
                             PARC1100,PARC1200,PARC1300,PARC1400,PARC1500:
                             PARC1600
          WRITE     HTMLFILE;"Invalid IBA Tag";
          GOTO      WEBS9999
.
PARC0100  MATCH     SP70,CWEBPSTY
          GOTO      PARC9999 IF EQUAL
          WRITE     HTMLFILE;CWEBPSTY;     * Search Type Default
          GOTO      PARC9999
.
PARC0200  MATCH     SP70,CWEBPSAG
          GOTO      PARC9999 IF EQUAL
          WRITE     HTMLFILE;CWEBPSAG;     * Search Age Default
          GOTO      PARC9999
.
PARC0300  MATCH     SP70,CWEBPSAR
          GOTO      PARC9999 IF EQUAL
          WRITE     HTMLFILE;CWEBPSAR;     * Search Age Default
          GOTO      PARC9999
.
PARC0400  MATCH     SP70,CWEBPNAM
          GOTO      PARC9999 IF EQUAL
          WRITE     HTMLFILE;CWEBPNAM;     * Patient Name format
          GOTO      PARC9999
.
PARC0500  MATCH     SP70,CWEBDNAM
          GOTO      PARC9999 IF EQUAL
          WRITE     HTMLFILE;CWEBDNAM;     * Doctors Name format
          GOTO      PARC9999

PARC0600  WRITE     HTMLFILE;CWEBSDAY;     * Number of Days For Search
          GOTO      PARC9999
.
PARC0700  WRITE     HTMLFILE;PTCNSTGV;     * Strict given in soundex (0=No
.                                            1=Yes surname 1st 2=Yes given 1st
          GOTO      PARC9999
.
PARC0800  WRITE     HTMLFILE;CWEBDNAI;     * Display doctors name case as is
          GOTO      PARC9999
.
PARC0900  READ      CONTROLF,TEN;*246,CSRCHDRG
          WRITE     HTMLFILE;CSRCHDRG;     * Day Range for D.O.B. in
                                           * surname searches
          GOTO      PARC9999
.
PARC1000  READ      CONTROLF,TEN;*248,CSRCHYRG
          WRITE     HTMLFILE;CSRCHYRG;     * Year Range for D.O.B. in
                                           * surname searches
          GOTO      PARC9999
.
PARC1100  WRITE     HTMLFILE;PTCSXOFF;     * Do not show Soundex in HCP,
                                           * Practice and Doctor searches
          GOTO      PARC9999
.
PARC1200  WRITE     HTMLFILE;PTCNEPMI;     * Using External PMMI        
          GOTO      PARC9999
.
PARC1300  WRITE     HTMLFILE;PTCNESBT;     * External Search Button Text 
          GOTO      PARC9999
.
PARC1400  WRITE     HTMLFILE;CWEBGVTD;     * Gender variable to display  
          GOTO      PARC9999
.
PARC1500  CALL      DEFDOB00               * Default date of birth
          GOTO      PARC9999
.
PARC1600  WRITE     HTMLFILE;CWEBPAED;     * Paediatric icon to display  
          GOTO      PARC9999
.
PARC9999  RETURN
.
.------------------------------------------------------------
. default date of birth (ddob)
.------------------------------------------------------------
DEFDOB00  READ      CONTROLF,HUND01;*98,CWEBDDOB
      
          REP       " 0",CWEBDDOB 
          MATCH     DOBZERO,CWEBDDOB
          IF        @EQUAL
            PACK      CWEBDDOB,DEFCCENT,DEFCYEAR,DEFCMON,DEFCDAY
            GOTO      DEFDOB40
         ENDIF 

DEFDOB20  MATCH     SP70,CWEBDDOB
          IF        @EQUAL
            PACK      CWEBDDOB,DEFCCENT,DEFCYEAR,DEFCMON,DEFCDAY
         ENDIF 

DEFDOB40  UNPACK    CWEBDDOB,CCENT,CYEAR,CMON,CDAY
          MOVE      CMON,F2
          LOAD      MTHNAM3,F2,JAN,FEB,MAR,APR,MAY,JUN,JUL,AUG,SEP,OCT,NOV,DEC
          WRITE     HTMLFILE;CDAY,SP1,MTHNAM3,SP1,CCENT,CYEAR;
DEFDOB99  RETURN
.
.------------------------------------------------------------
.  Private Practice Debtors Code Search - Option 9
.------------------------------------------------------------
..PRIDSH00  MOVE      "Debtors Code Search",WEBTITLE
..          CALL      WEBHED00   * Create Output File and Write HTML Page Header
..          BRANCH    EXIT,PRIDSH99
.
..          CALL      WEBBOD00   * Process Web Body
.
..          CALL      WEBEND00   * Process End of HTML File
.
..PRIDSH99  RETURN
.
.---------------------------------------------------------------
.      Option - 9 Debtors Code Search
.---------------------------------------------------------------
..PRSH0000  BRANCH    FLDITMNO,PRSH0100,PRSH0200,PRSH0300,PRSH0400:
..                             PRSH0500
.
..          WRITE     HTMLFILE;"Invalid IBA Tag";
..          GOTO      PRSH9999
.
..PRSH0100  MOVE      ZERO,LINK2PRT           * Link to alternate Program
..          CALL      PRTAB000                * Table of item code
..          GOTO      PRSH9999
.
..PRSH0200  MOVE      ONE,LINK2PRT            * Link to Parent
..          CALL      PRTAB000                * Table of item code
..          GOTO      PRSH9999
.
..PRSH0300  MOVE      TWO,LINK2PRT            * Link to Window
..          CALL      PRTAB000                * Table of item code
..          GOTO      PRSH9999
.
..PRSH0400  CALL      PREVPR00                * Link to Prev Set of Codes
..          GOTO      PRSH9999
.
..PRSH0500  CALL      NEXTPR00                * Link to Next Set of Codes
..          GOTO      PRSH9999
.
..PRSH9999  RETURN
.
.-------------------------------------------------------------
.        Table of Debtors Code
.-------------------------------------------------------------
..PRTAB000  IF        LINK2PRT<>1
..            UNPACK    DIM127,D1,LINKPRG,DIM127
..            UNPACK    DIM127,D1,LINKREP,DIM127
..            UNPACK    DIM127,D1,LINKTEM,DIM127
..          ENDIF
.
..          CALL      PRHED000                 * Table heading
.
..          MATCH     SP70,SRNAME01
..          GOTO      PRTAB999  IF EQUAL
..          IF        NORECORD=0
..            MOVE      "10",NORECORD         * Set Default No Records to Display
..          ENDIF
..          MOVE      ZERO,RECNUMB
..          MOVE      ZERO,DISNUMB
.
..          PACK      KEY53,SRNAME01,GNNAME01,SP70
..          CALL      RSPRDB2
..PRTAB100  CALL      RKPRDB2
..          BRANCH    OVRCD,PRTAB999
.
.          MATCH     SRNAME01,PRDBSNAM
.          GOTO      PRTAB999 IF NOT EQUAL
.
.          MATCH     SP70,GNNAME01
.          IF        !@EQUAL
.            MATCH     GNNAME01,PRDBGNAM
.            GOTO      PRTAB999 IF NOT EQUAL
.          ENDIF
.
..          ADD       ONE,RECNUMB
..          IF        STARTNUM>=RECNUMB
..            GOTO     PRTAB100
..          ENDIF
.
..          CALL      PRROW000    * Display Table Details Row
..          ADD       ONE,DISNUMB
..          COMPARE   NORECORD,DISNUMB
..          GOTO      PRTAB100 IF NOT EQUAL
.
..PRTAB999  RETURN
.
.------------------------------------------------------------
.  Debtors Code Table Details (TABLE HEADING)  
.------------------------------------------------------------
..PRHED000   WRITE     HTMLFILE;"<tr>":
..                              "<td colspan=3 class=HeadingCell align=center>":
..                              " You Searched for ":
..                              SRNAME01," ",GNNAME01,"</td></tr>";
.
..           WRITE     HTMLFILE;"<tr>":
..                               "<td class=HeadingCell width=30%>":
..                               "Debtors Code</td>":
..                               "<td class=HeadingCell width=40%>":
..                               "Patient's Name</td>":
..                               "<td class=HeadingCell width=30%>":
..                               "Claim Code</td>":
..                               "</tr>";
.
..PRHED999  RETURN
.
.------------------------------------------------------------
..PRROW000  BRANCH    LINK2PRT,PRROW010,PRROW020
.
..          WRITE     HTMLFILE;"<tr valign=top>":
..                                "<td nowrap><a href=",LINKPRG,".pbl?":
..                                "&reportno=",LINKREP:
..                                "&template=",LINKTEM:
..                                "&debtor=",PRDBDEBT,">":
..                                PRDBDEBT,"</a></td>":
..                                "<td><b>",PRDBTITL," ",PRDBSNAM," ",PRDBGNAM:
..                                "</b></td>":
..                                "<td>",PRDBFUND,"&nbsp</td>":
..                              "</tr>";
..          GOTO      PRROW999
.
..PRROW010  WRITE     HTMLFILE;"<tr><td nowrap>":
..                               "<A HREF='javascript:updateParent":
..                               "(#"",PRDBDEBT,"#")'>":
..                               PRDBDEBT,"</a></td>":
..                               "<td><b>",PRDBTITL," ",PRDBSNAM," ",PRDBGNAM:
..                               "</b></td>":
..                               "<td>",PRDBFUND,"&nbsp</td>":
..                             "</tr>";
..          GOTO      PRROW999
.
..PRROW020  WRITE     HTMLFILE;"<tr valign=top>":
..                               "<td nowrap><a href=#"":
..                               "javascript:ShowDetail('":
..                               LINKPRG,".pbl?":
..                               "&reportno=",LINKREP:
..                               "&template=",LINKTEM:
..                               "&debtor=",PRDBDEBT:
..                               "');#">":
..                               PRDBDEBT,"</a></td>":
..                               "<td><b>",PRDBTITL," ",PRDBSNAM," ",PRDBGNAM:
..                               "</b></td>":
..                               "<td>",PRDBFUND,"&nbsp</td>":
..                             "</tr>";
..          GOTO      PRROW999
.
..PRROW999  RETURN
.
.-------------------------------------------------------------
. Link to Prev Group option 9
.-------------------------------------------------------------
..PREVPR00  MOVE      NORECORD,KEY2
..          REP       " +",KEY2
..          ASSIGN    STARTNUM-NORECORD,F3
..          IF        F3<0
..            MOVE      ZERO,F3
..          ENDIF
..          MOVE      F3,KEY3
..          REP       " +",KEY3
..          UNPACK    DIM127,D1,FLDPARA,DIM127
..          MOVE      REPORTNO,F1
.
..          REP       " +",SRNAME01
..          REP       " +",GNNAME01
.
..          WRITE     HTMLFILE;"rshweb02.pbl":
..                                "?reportno=",F1:
..                                "&template=",FLDPARA:
..                                "&startnum=",KEY3:
..                                "&norecord=",KEY2:
..                                "&srname01=",SRNAME01:
..                                "&gnname01=",GNNAME01;
.
..          REP       "+ ",SRNAME01
..          REP       "+ ",GNNAME01
.
..PREVPR99  RETURN
.
.-----------------------------------------------------------
. Link to Next Group option 9
.-----------------------------------------------------------
..NEXTPR00  MOVE      NORECORD,KEY2
..          REP       " +",KEY2
..          ASSIGN    STARTNUM+NORECORD,F3
..          MOVE      F3,KEY3
..          REP       " +",KEY3
..          UNPACK    DIM127,D1,D3,DIM127
..          MOVE      REPORTNO,F1
.
..          REP       " +",SRNAME01
..          REP       " +",GNNAME01
.
..          WRITE     HTMLFILE;"rshweb02.pbl":
..                                 "?reportno=",F1:
..                                 "&template=",D3:
..                                 "&startnum=",KEY3:
..                                 "&norecord=",KEY2:
..                                 "&srname01=",SRNAME01:
..                                 "&gnname01=",GNNAME01;
.
..          REP       "+ ",SRNAME01
..          REP       "+ ",GNNAME01
.
..NEXTPR99  RETURN
.
.*******************************************************************************
.
.         DEPR0000 - Scheduler Remote Delete Functions
.
********************************************************************************
DEPR0000  CALL      XMLHED00
          BRANCH    EXIT,DEPR9999
.
DEPR0010  PACK      KEY20,LABELDET,WBSEUID,SP70
          CALL      RDIBPD1
          IF        OVRCD=0
            CALL      DEIBPD1
            WRITE     HTMLFILE;"<RETURN_VALUE TYPE=SIMPLE>0</RETURN_VALUE>"
          ELSE
            IF          SHOWEROR
              WRITE     HTMLFILE;"<RETURN_VALUE TYPE=WARNING>":
                                 "Could not clear default value</RETURN_VALUE>"
            ENDIF
          ENDIF
.
DEPR9000  CALL      XMLEND00
.
DEPR9999  RETURN
.-------------------------------------------------------------------------------
. Check Audit Files          
.-------------------------------------------------------------------------------
CHKAUD00  CALL      XMLHED00
.
          CALL      READ0000                * read the appropriate audit file
          BRANCH    EXIT,CHKAUD90
.
          WRITE     HTMLFILE;"<RETURN_VALUE TYPE=SIMPLE>":
                             SP1:
                             "</RETURN_VALUE>"
.
          GOTO      CHKAUD98
.
CHKAUD90  UNPACK    KEY5,KEY2,KEY3
          WRITE     HTMLFILE;"<RETURN_VALUE TYPE=ERROR>":
                             "Blank Audit file.  ":
                             "</RETURN_VALUE>"
          GOTO      CHKAUD98
.
CHKAUD98  CALL      XMLEND00
CHKAUD99  RETURN
.
.**********************************************************************
.*                               READ0000                             *
.*      Routine to read a record from the appropriate audit file.     *
.*      This includes getting the first record (READ0000) and         *
.*      getting any subsequent records (READ5000).                    *
.*      SRF 612675 - Mods to set exit flag to 2 if audit is not in use*
.**********************************************************************
READ0000  MOVE      ZERO,EXIT
          BRANCH    VALDOPTN,READ9500,READ9500,READ0300,READ9500,READ0500:
                             READ9500,READ0700,READ0800,READ0900,READ1000:
                             READ1100,READ1200
.
.------ we are processing the doctor audit file ------
.
READ0300  OPEN      PRIAUDDO,"priauddo"
          PACK      KEY19,VALDFRDT,SP20
          CALL      ASPRDO                  * get the first doctor audit file
          CALL      AKPRDO                    record
          BRANCH    OVRCD,READ9000
          MATCH     PRDOAUDD,VALDTODT
          GOTO      READ9000 IF LESS
          GOTO      READ9999
.
.------ we are processing the debtor audit file ------
.
...READ0400  OPEN      PRIAUDDB,"priauddb"
...          PACK      KEY19,VALDFRDT,SP20
...          CALL      ASPRDB                  * get the first debtor audit file
...          CALL      AKPRDB                    record
...          BRANCH    OVRCD,READ9000
...          MATCH     PRDBAUDD,VALDTODT
...          GOTO      READ9000 IF LESS
...          GOTO      READ9999
.
.------ we are processing the medical practice audit file ------
.
READ0500  OPEN      PRIAUDPR,"priaudpr"
          PACK      KEY19,VALDFRDT,SP20
          CALL      ASPRPR                  * get the first medical practice
          CALL      AKPRPR                    audit file record
          BRANCH    OVRCD,READ9000
          MATCH     PRPRAUDD,VALDTODT
          GOTO      READ9000 IF LESS
          GOTO      READ9999
.
.------ we are processing the special pathology test audit file ------
.
READ0700  OPEN      PRIAUDSP,"priaudsp"
          PACK      KEY19,VALDFRDT,SP20
          CALL      ASPRSP                  * get the first item audit file
          CALL      AKPRSP                    record
          BRANCH    OVRCD,READ9000
          MATCH     PRSPAUDD,VALDTODT
          GOTO      READ9000 IF LESS
          GOTO      READ9999
.
.------ we are processing the exception charging audit file ------
.
READ0800  OPEN      PRIAUDEX,"priaudex"
          PACK      KEY19,VALDFRDT,SP20
          CALL      ASPREX                  * get the first item audit file
          CALL      AKPREX                    record
          BRANCH    OVRCD,READ9000
          MATCH     PREXAUDD,VALDTODT
          GOTO      READ9000 IF LESS
          GOTO      READ9999
.
.------ we are processing the item audit file ------
.
READ0900  OPEN      PRIAUDIT,"priaudit"
          PACK      KEY19,VALDFRDT,SP20
          CALL      ASPRIT                  * get the first item audit file
          CALL      AKPRIT                    record
          BRANCH    OVRCD,READ9000
          MATCH     PRITAUDD,VALDTODT
          GOTO      READ9000 IF LESS
          GOTO      READ9999
.
. ----- we are processing priaudaf -------
.
READ1000  OPEN      PRIAUDA1,"priaudaf"
          PACK      KEY31,SP20,SP20
          CALL      RSPRAD1
          CALL      RKPRAD1
          BRANCH    OVRCD,READ9000
          GOTO      READ9999
.
. ----- we are processing priauiaf -------
.
READ1100  OPEN      PRIAUIA1,"priauiaf"
          MOVE      SP20,KEY18
          CALL      RSPRAI1
          CALL      RKPRAI1
          BRANCH    OVRCD,READ9000
          GOTO      READ9999
.
. ----- we are processing priauraf -------
.
READ1200  OPEN      PRIAURA1,"priauraf"
          MOVE      SP20,KEY13
          CALL      RSPRAR1
          CALL      RKPRAR1
          BRANCH    OVRCD,READ9000
          GOTO      READ9999
.
.------ we have reached the end of file ------
.
READ9000  MOVE      ONE,EXIT
          GOTO      READ9999
.
READ9500  MOVE      TWO,EXIT
.
READ9999  RETURN
.------------------------------------------------------------
. Check Theatre Fee for Fee Estimation
.------------------------------------------------------------
CHKTFE00  CALL      XMLHED00
.
          MATCH     SP9,CSMXCODE
          GOTO      CHKTFE20 IF EQUAL
.
          PACK      KEY18,CLMTCODE,HLTHFUND,CSMXCODE,SP70
          MOVE      ADMSDATE,CEFFDATE       * Use admission date for effec.date
          CALL      VALCMXFN                * Check Casemix funding
          BRANCH    EXIT,CHKTFE20           * Non-casemix
.
          CALL      CTHF0000                * Get casemix theatre fees       
          BRANCH    EXIT,CHKTFE90
          GOTO      CHKTFE80
.
CHKTFE20  CALL      NTHF0000                * Get non-casemix theatre fees   
          BRANCH    EXIT,CHKTFE90
          GOTO      CHKTFE80
.
CHKTFE80  WRITE     HTMLFILE;"<RETURN_VALUE TYPE=SIMPLE>":
                             SP1:
                             "</RETURN_VALUE>"
.
          GOTO      CHKTFE98
.
CHKTFE90  WRITE     HTMLFILE;"<RETURN_VALUE TYPE=ERROR>":
                             "Unable to get theatre fee details for ":
                             TFEECODE:
                             "</RETURN_VALUE>"
          GOTO      CHKTFE98
.
CHKTFE98  CALL      XMLEND00
CHKTFE99  RETURN
.
.------------------------------------------------------------
.       Get Non Casemix Theatre Fee                         
.------------------------------------------------------------
NTHF0000  MOVE      DCASEFLG,KEY1
.
. ----- Get the item details -----
.
          MOVE      TFEECODE,KEY9
          PACK      KEY17,KEY9,ADMSDATE,SP70
          CALL      PATITMRD                * Read the item file
          BRANCH    OVRCD,NTHF9000
.
. ----- Get the default theatre classification -----
.
          MOVE      ZERO,CNTRCEFR
          MOVE      ADMSDATE,CEFFDATE
          MOVE      ADMSDATE,TSRVDATE       * Service date
          PACK      KEY18,CLMTCODE,HLTHFUND,HLTHTABL,KEY1,SP20
          CALL      GETTFEES
          GOTO      NTHF9999
.
NTHF9000  MOVE      ONE,EXIT
NTHF9999  RETURN
+
.******************************************************************************
.*                                  CTHF0000              Called by: ML0000   *
.*                          Get Casemix Theatre Fee                           *
.******************************************************************************
CTHF0000  MOVE      ZERO,TCFORM6
          MOVE      SP10,TABTYPE
          PACK      KEY5,ANSC,ANSL,CLMTCODE
          CALL      RDCODE1                 * Read the codes file
          BRANCH    OVRCD,CTHF9999
.
          MOVE      TCFORM6,HFBAND
          MATCH     SP6,HLTHFUND
          GOTO      CTHF0500 IF EQUAL
.
.         Get Health fund table - table type
.
          PACK      KEY14,HLTHFUND,HLTHTABL,SP70
          CALL      RDFUND1               * Read the health fund file
          BRANCH    OVRCD,CTHF0200
.
          MATCH     SP3,PTHFBCAT
          GOTO      CTHF0200 IF EQUAL       * Blank table type
.
          PACK      KEY5,ANSH,ANST,PTHFBCAT
          CALL      RDCODE1                 * Read the codes file
          BRANCH    OVRCD,CTHF0200
          MOVE      PTHFBCAT,TABTYPE        * Table type
.
.         Get Health Fund - banding
.
CTHF0200  PACK      KEY14,HLTHFUND,ZERO8,SP70
          CALL      RDFUND1               * Read the health fund file
          BRANCH    OVRCD,CTHF9999
.
          MOVE      "03",KEY2      * check HF history for Theatre charging ind.
          PACK      KEY17,HLTHFUND,KEY2,ADMSDATE,SP70
          CALL      PATDDHRD
.
. ----- Get the item details -----
.
CTHF0500  MOVE      ZERO,FORM2
          MOVE      SP10,KEY9
          MOVE      TFEECODE,KEY9
          PACK      KEY17,KEY9,ADMSDATE,SP70
          CALL      PATITMRD                * Read the item file
          BRANCH    OVRCD,CTHF9999
.
          MOVE      SP5,KEY3
          LOAD      KEY3,HFBAND,IBAND1,IBAND2,IBAND3,IBAND4,IBAND5:
                                IBAND6,IBAND7,IBAND8,IBAND9,IBAND10:
                                IBAND11,IBAND12,IBAND13,IBAND14,IBAND15:
                                IBAND16
.
          MOVE      ONE,FORM2               * Default to first sequence number
.     
          MOVE      ZERO,FORM1
          MOVE      ZERO,DCFLAG
          MOVE      DCASEFLG,DCFLAG
          PACK      KEY33,PTCMCNID,CLMTCODE,HLTHFUND,TABTYPE:
                          KEY3,SP9,DCFLAG,FORM2
CTHF4500  CALL      RDPTCTF2                * Read the DRG/MBS theatre fee file
          COMPARE   ZERO,OVRCD
          GOTO      CTHF9999 IF EQUAL       * Valid record found, print details
.
. ----- Combination not setup, try with different defaults -----
.
          ADD       ONE,FORM1
          BRANCH    FORM1,CTHF5000,CTHF5500
          GOTO      CTHF7000
.
. ----- Try combination without health fund code -----
.
CTHF5000  PACK      KEY33,PTCMCNID,CLMTCODE,SP6,SP3,KEY3,SP9,DCFLAG,FORM2
          GOTO      CTHF4500
.
. ----- Try combination with default claim type & no health code -----
.
CTHF5500  PACK      KEY33,PTCMCNID,PTCNDCLM,SP6,SP3,KEY3,SP9,DCFLAG,FORM2
          GOTO      CTHF4500
.
. ----- Error -----
.
CTHF7000  MOVE      ONE,EXIT
          GOTO      CTHF9999
.
CTHF9999  RETURN
+
.**********************************************************************
.         Update Default Printer File for User
.**********************************************************************
UPDEFP00  MATCH     SP70,SETDEFPN[COUNT]
          IF        !@EQUAL
            PACK      KEY20,SETDEFPN[COUNT],WBSEUID,SP70
            GOTO      UPDEFP10
          ENDIF
          GOTO      UPDEFP99
UPDEFP10  UNPACK    KEY20,IBPDPID,IBPDREP,IBPDUID
          MOVE      SCHDPRNT,IBPDPRT
          MOVE      SCHDCOPY,IBPDCOP        * no of copies
          MATCH     SP70,LABELTYP
          IF        !@EQUAL
            UNPACK    LABELTYP,IBPDDOC,IBPDNUM   * save label type and number
          ELSE
            MOVE      STATNCOD,IBPDDOC        * save stat code to document code
            MOVE      SP70,IBPDNUM
          ENDIF
          MOVE      SP70,IBPDSPA
          CALL      RAIBPD1
          IF        OVRCD=0
            CALL      UPIBPD1
          ELSE
            CALL      WRIBPD1
          ENDIF
UPDEFP99  RETURN
.**********************************************************************
.         Prosthetic Tracking Lookup
.**********************************************************************
PROLKP00  IF        NORECORD=0
            MOVE      "20",NORECORD       * Set Default No Records to Display
          ENDIF
          MOVE      ZERO,RECNUMB
          MOVE      ZERO,DISNUMB
.
          PACK      KEY16,Z70
          CALL      RSPMPTH1
PROLKP10  CALL      RPPMPTH1
          BRANCH    OVRCD,PROLKP99
.
          ADD       ONE,RECNUMB
          IF        STARTNUM>=RECNUMB
            GOTO      PROLKP10
          ENDIF
.
          UNPACK    PMPTEXDT,CCENT,CYEAR,CMON,CDAY
          MOVE      CMON,F2
          LOAD      MTHNAM3,F2,JAN,FEB,MAR,APR,MAY,JUN,JUL,AUG,SEP,OCT,NOV,DEC
          PACK      DIM11,CDAY,SP1,MTHNAM3,SP1,CCENT,CYEAR
.
          WRITE     HTMLFILE;"<tr><td>":
                    "<img src=../images/MaintenanceIcon.gif ":
                    " class=ListIcon onclick='updateParent(#"":
                    PMPTFLNM,"#");'>":
                    PMPTFLNM,"</td><td>&nbsp ",DIM11,"</td>":
                    "<td>&nbsp ",PMPTEXTM,"</td>":
                    "<td>&nbsp ",PMPTRCCT,"</td>":
                    "</tr>"
.
          ADD       ONE,DISNUMB
          COMPARE   NORECORD,DISNUMB
          GOTO      PROLKP10 IF NOT EQUAL
.
PROLKP99  RETURN
.**********************************************************************
.         Prosthetic Tracking Lookup Next Screen
.**********************************************************************
NXTPRO00  MOVE      NORECORD,KEY2
          REP       " +",KEY2
          ASSIGN    STARTNUM+NORECORD,F3
          MOVE      F3,KEY3
          REP       " +",KEY3
          UNPACK    DIM127,D1,FLDPARA,DIM127
          WRITE     HTMLFILE;"rshweb02.pbl?reportno=1":
                                 "&template=",FLDPARA:
                                 "&startnum=",KEY3:
                                 "&norecord=",KEY2;
.
NXTPRO99  RETURN
.
.**********************************************************************
.         Prosthetic Tracking Lookup Previous Screen
.**********************************************************************
PRVPRO00  MOVE      NORECORD,KEY2
          REP       " +",KEY2
          ASSIGN    STARTNUM-NORECORD,F3
          IF        F3<0
            MOVE      ZERO,F3
          ENDIF
          MOVE      F3,KEY3
          REP       " +",KEY3
          UNPACK    DIM127,D1,FLDPARA,DIM127
          WRITE     HTMLFILE;"rshweb02.pbl?reportno=1":
                                 "&template=",FLDPARA:
                                 "&startnum=",KEY3:
                                 "&norecord=",KEY2;
.
PRVPRO99  RETURN
.------------------------------------------------------------
. Hospital ID with SelectedIndex
.------------------------------------------------------------
HOSIDS00  OPEN      PATHSPA1,"pathspaf"
.
          PACK      KEY3,SP10
          CALL      RSPTHSP1
HOSIDS10  CALL      RKPTHSP1
          BRANCH    OVRCD,HOSIDS90
.
          PACK      KEY5,QUOTE,PTHSHOSP,QUOTE
          BRANCH    IBCNMHOS,HOSIDS20
          WRITE     HTMLFILE;"<option value=",KEY5,">":
                             PTHSNAME,"</option>"
          GOTO      HOSIDS10
.
.         Mult-Hospital
.
HOSIDS20  MATCH     SP70,HOSPCODE
          IF        @EQUAL|@EOS
            MATCH     WBSEHOSP,PTHSHOSP
          ELSE
            MATCH     HOSPCODE,PTHSHOSP
          ENDIF
.
          IF        @EQUAL
            WRITE     HTMLFILE;"<option value=",KEY5," selected>":
                               PTHSNAME,"</option>"
          ELSE
            WRITE     HTMLFILE;"<option value=",KEY5,">":
                               PTHSNAME,"</option>"
          ENDIF
          GOTO      HOSIDS10
.
HOSIDS90  CLOSE     PATHSPA1
HOSIDS99  RETURN
+
.-------------------------------------------------------------------------------
.                           ALCAT000
. Displays Selection List of Categories H1-H9 to view alerts based on categories
.-------------------------------------------------------------------------------
ALCAT000  MOVE      ONE,F1
.
ALCAT100  PACK      KEY5,ANSH,F1,SP70
          CALL      RDCODE1
          BRANCH    OVRCD,ALCAT200
.
          MOVE      TDESC,KEY20
          PACK      KEY4,QUOTE,TCODE,QUOTE
.
          WRITE     HTMLFILE;"<option value=",KEY4,">",KEY20,"</option>"
.
ALCAT200  COMPARE   NINE,F1
          GOTO      ALCAT999 IF EQUAL
          ADD       ONE,F1
          GOTO      ALCAT100
.
ALCAT999  RETURN
+
.------------------------------------------------------------
. Disaster Selection List
.------------------------------------------------------------
DISSEL00  PACK      KEY9,SP70
          CALL      RSDSMAS1
DISSEL10  CALL      RKDSMAS1
          BRANCH    OVRCD,DISSEL99
.
          WRITE     HTMLFILE;"<option value=",DSMACODE,">",DSMADESC,"</option>"
.
          GOTO      DISSEL10
.
DISSEL99  RETURN
+
.------------------------------------------------------------
. Emergency Location Code Selection List
.------------------------------------------------------------
LOCSEL00  PACK      KEY28,SP70
          CALL      RSEMLOC2
LOCSEL10  CALL      RKEMLOC2
          BRANCH    OVRCD,LOCSEL99
.
          MATCH     "1",EMLOACTV
          GOTO      LOCSEL10 IF EQUAL
.
          MATCH     EMLOSCOD,WBSEESC
          GOTO      LOCSEL10 IF NOT EQUAL
.
          PACK      KEY5,QUOTE,EMLOLOCA,QUOTE
          WRITE     HTMLFILE;"<option value=",KEY5,">",EMLODESC,"</option>"
          GOTO      LOCSEL10
.
LOCSEL99  RETURN
.
.-------------------------------------------------------------------
.     writing here for allied health department drop down
.-------------------------------------------------------------------
ARFD0000  PACK      PTCDKEY2,ANSC,ANSG,SP70
          CALL      RDSCODE2                      * positional read
ARFD0100  CALL      RDKCODE2                      * read a record
          BRANCH    OVRCD,ARFD9999
.
          MATCH     "CG",TCODE
          GOTO      ARFD9999 IF NOT EQUAL
.
          PACK      KEY3,ACODE,SP70
          CALL      RDALDEP1                      * Read department table
          BRANCH    OVRCD,ARFD0100
.
          MATCH     "1",ALDEACTV
          GOTO      ARFD0100 IF EQUAL       * Skip Inactive
.
          IF        IBCNMHOS=1
            MATCH     SP70,ALDEHOSP
            IF        !@EQUAL
              MATCH     WBSEHOSP,ALDEHOSP
              GOTO      ARFD0100 IF NOT EQUAL
            ENDIF
          ENDIF
          WRITE     HTMLFILE;"<option value=",ALDEDEPT,">":
                               TDESC,"</option>"
          GOTO      ARFD0100
.
ARFD9999  RETURN
.
.------------------------------------------------------------
. Waiting List SMS Selection
.------------------------------------------------------------
WSMS0000  MOVE      ZERO,F3
          PACK      KEY6,F3,SP70
          CALL      RDSLET2
WSMS1000  CALL      RDKLET2
          BRANCH    OVRCD,WSMS9999
.
          COMPARE   ZERO,WLINNO
          GOTO      WSMS9999 IF NOT EQUAL
.
          MATCH     "1",WLETACTV            * Skip if inactive
          GOTO      WSMS1000 IF EQUAL
.
          MATCH     "1",WLETCOMM            * Skip if not SMS
          GOTO      WSMS1000 IF NOT EQUAL
.
          WRITE     HTMLFILE;"<option value=",WLETNO,">":
                             WLTEXT,"</option>"
          GOTO      WSMS1000
.
WSMS9999 RETURN
.
.------------------------------------------------------------
. Outpatient SMS Selection
.------------------------------------------------------------
OSMS0000  MOVE      ZERO,OTLTLINO
          PACK      KEY6,OTLTLINO,SP70
          CALL      RSOTLET2
OSMS1000  CALL      RKOTLET2
          BRANCH    OVRCD,OSMS9999
.
          COMPARE   ZERO,OTLTLINO
          GOTO      OSMS9999 IF NOT EQUAL
.
          MATCH     "1",OTLTACTV                 * Skip Inactive
          GOTO      OSMS1000 IF EQUAL
.
          MATCH     "1",OTLTCOMM                 * Skip if not SMS
          GOTO      OSMS1000 IF NOT EQUAL
.
          WRITE     HTMLFILE;"<option value=",DOTLTLTN,">":
                             OTLTTEXT,"</option>"
.
          GOTO      OSMS1000
.
OSMS9999  RETURN
.
.------------------------------------------------------------
. IP SMS Selection
.------------------------------------------------------------
ISMS0000  MOVE      ZERO,PTLELINO
          PACK      KEY6,PTLELINO,SP70
          CALL      RSPTLET2
ISMS1000  CALL      RKPTLET2
          BRANCH    OVRCD,ISMS9999
.
          COMPARE   ZERO,PTLELINO
          GOTO      ISMS9999 IF NOT EQUAL
.
          MATCH     "1",PTLEACTV                 * Skip Inactive
          GOTO      ISMS1000 IF EQUAL
.
          MATCH     "1",PTLECOMM                 * Skip if not SMS
          GOTO      ISMS1000 IF NOT EQUAL
.
          WRITE     HTMLFILE;"<option value=",DPTLELNO,">":
                             PTLETEXT,"</option>"
.
          GOTO      ISMS1000
.
ISMS9999  RETURN
.
.------------------------------------------------------------
. Remote Script to output Category Code indicator values and
. Associate Fields 1-5 (same as CODITM30 but pipe-delimited)
.------------------------------------------------------------
PATCOD00  CALL      XMLHED00
.
          MATCH     SP2,PATCATGY
          GOTO      PATCOD91 IF EQUAL
.
          MATCH     SP3,PATCODEV
          GOTO      PATCOD91 IF EQUAL
.
          MOVE      PATCATGY,CATEGORY
          MOVE      PATCODEV,CODE
          CALL      GETCOD00
          PACK      KEY100,TCINDC1,PIPE,TCINDC2,PIPE,TCINDC3,PIPE:
                           TCINDC4,PIPE,TCINDC5,PIPE,TCINDC6,PIPE:
                           TCINDC7,PIPE,TCINDC8,PIPE,TCINDC9,PIPE:
                           TCINDC10,PIPE,TCINDC11,PIPE,THCSCOD,PIPE:
                           PTCDNHCP,PIPE,TCFORM6,PIPE,TCINDC12,PIPE:
                           TCINDC13,PIPE,TCINDC14,PIPE,TCINDC15,PIPE:
                           TCINDC16,PIPE,TCINDC17,PIPE,TCINDC18,PIPE:
                           TCINDC19,PIPE,TCINDC20,PIPE,TCINDC21,PIPE:
                           PTCOACTV,PIPE,PTCDASC1,PIPE,PTCDASC2,PIPE:
                           PTCDASC3,PIPE,PTCDASC4,PIPE,PTCDASC5,SP70
.
PATCOD90  WRITE     HTMLFILE;"<RETURN_VALUE TYPE=SIMPLE>":
                             KEY100:
                             "</RETURN_VALUE>"
.
          GOTO      PATCOD98
.
PATCOD91  WRITE     HTMLFILE;"<RETURN_VALUE TYPE=ERROR>":
                             "Invalid Category/Code":
                             "</RETURN_VALUE>"
          GOTO      PATCOD98
.
PATCOD98  CALL      XMLEND00
PATCOD99  RETURN
+
.-------------------------------------------------------------
          INC       IBAWEBCD
          INC       GETTFEES
          INC       VALCONTR
          INC       VALCMXFN
          INC       CLACCAUD                    * Clear ACC Audit file variables
          INC       PATITMRD
          INC       PATDDHRD
          INC       ALLDEPIO/INC
          INC       ALLVREIO/INC
          INC       PATDO1IO/INC
          INC       EMRLOCIO/INC
          INC       EMRSITIO/INC
          INC       FMSCHQIO/INC   * (FMS) Cheque Account Master
          INC       DISMASIO/INC
          INC       WEBRDTIO/INC   * Report group details
          INC       WEBRGMIO/INC   * Report group master
          INC       WEBRTMIO/INC   * Report template master
          INC       WEBRURIO/INC   * User report group
          INC       IBAGSTIO/INC   * GST Codes
          INC       IBABASIO/INC   * BAS Code Table
          INC       IBALPCIO/INC   * Print file for labels and forms
          INC       OBSPCTIO/INC
          INC       IBADPTIO/INC
          INC       PATCMXIO/INC            * Casemix funding file
          INC       PATCTFIO/INC            * DRG/MBS theatre fee file
          INC       PMSCIDIO/INC   * Contract ID file
          INC       PATCFAIO/INC   * Claim code Contract effective date
          INC       PATHGPIO/INC   * Health fund groups file
          INC       PATHSPIO/INC   * Hospital code file
          INC       PATICGIO/INC   * Procedure Group Codes
          INC       PATIN1IO/INC   * Insurance file
          INC       PATILTIO/INC   * IP Letters
          INC       PATITMIO/INC   * Item file
          INC       PATFLTIO/INC   * Patient Financial Letters
          INC       PATFN1IO/INC   * Health fund file
          INC       PATFX1IO/INC   * Health fund file
          INC       PATNURIO/INC   * Nursing Station File IO
          INC       PATWR1IO/INC   * Ward Bed File IO
          INC       PATMESIO/INC   * Patient Admission file
          INC       PATMI1IO/INC   * Patient Invoice Messages 
          INC       PATTFEIO/INC            * Theatre fee file
          INC       PATVISIO/INC   * Visit File
          INC       PMSVX1IO/INC   * Visit Extension File
          INC       PMSEVTIO/INC   * Events File
          INC       PMSHCPIO/INC   
          INC       PMSPTHIO/INC
.
          INC       PRIAUDIO/INC
          INC       PRIAUIIO/INC
          INC       PRIAURIO/INC
...          INC       PRIDBTIO/INC   * Private Practice Debtors Details 
          INC       PRIDOCIO/INC
          INC       PRIEXCIO/INC
          INC       PRIITMIO/INC
          INC       PRISPTIO/INC
.          INC       PRIFLTIO/INC   * Private Practice Financial Letters
          INC       PRIPRAIO/INC   * Private Practice Medical Practice
.
          INC       MLTSECIO/INC
          INC       MLTSITIO/INC
          INC       MRTMASIO/INC   * MRT master file
          INC       WATEXTIO/INC   * Waiting List Patient Extract
          INC       WATLETIO/INC   * Waiting List Letters
          INC       MRTLOCIO/INC   * Locations
          INC       MRTSTFIO/INC   * Staff
          INC       RCPCIDIO/INC   * Receipting Cashier Details 
          INC       RCPREGIO/INC   * Register Details                  *I-59171
          INC       OUTSITIO/INC   * Site file
          INC       OUTCLIIO/INC   * Clinic file
          INC       OUTCTYIO/INC   * Clinic type  file
          INC       OUTLETIO/INC   * Outpatient Letters file 
          INC       OPRNURIO/INC   * Theatre Nurses File  
          INC       OPROPRIO/INC   * Operating Room File 
          INC       ALLREFIO/INC   * Allied Health
          INC       ACCAUDIO/INC   * ACC Audit File
          INC       BOKRC1IO/INC   * Booking File
          INC       PATDRGIO/INC
          INC       PATDDHIO/INC
          INC       CCSSTYIO/INC   * Casemix types
          INC       PRIALSIO/INC
          INC       PRISECIO/INC
          INC       OUTBOAIO/INC
.
          INC       IBALPCCD
          INC       WEBDATCD     
          INC       DAYOFWEK     
