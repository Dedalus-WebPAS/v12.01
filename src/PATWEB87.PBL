. Program       : PATWEB87
.
. Function      : Health Fund / Table Maintenance Server
.
. Modifications : 
.----------------------------------------------------------------------
. V12.00.03 31/07/2025  Jacob Jackson  TSK 0964160
.           Fix logic which allowed a duplicate 'Effective To' date when
.           existing record containing it was deleted.
.           Stop "delete" of HF History record if duplicate date found.
. V12.00.02 25/07/2025  Zumin Yu       TSK 0964186
.           Modified OTALLP50 to update the page title.
. V12.00.01 30/05/2025  Don Nguyen     TSK 0955096
.           Alphanumeric visit number changes
. V11.05.03 09/04/2025  J.Tan           TSK 0946490
.           Fixed displaying EPM/CWO payment model
. V11.05.02 27/03/2025  Davin         TSK 0956210
.           Added DRG Version 12.0 in DRGVER00/HFND2900
. V11.05.01 20/01/2025  J.Tan           TSK 0946490
.           Mod for CWO payment model
. V11.04.10 15/10/2024  J.Tan           TSK 0951331
.           Mod PTLET010 for Letter Type
. V11.04.09 23/09/2024  J.Tan           TSK 0950577
.           Mod updating HF to set Hold invoice details
. V11.04.08 16/08/2024  Jacob Jackson   TSK 0911895
.           Add "SMS Message" option to Booking Letter templates
. V11.04.07 20/05/2024  Jacob Jackson   TSK 0946875
.           Fix problem where past 'Effective To' dates could be entered.
. V11.04.06 09/05/2024  Nikitha B       TSK 0945225
.           Increased array length of PTLECOMN from 70[99] to 70[999].
.           Replaced F2 variable to F3 variable to hold 3 digit array in
.           DELLET00, FLTDET00, BKLTDT00, PRLDET00 & PRFDET00. 
.           Increased length of PTLEEND from Form 2 to Form 3.
. V11.04.05 15/04/2024  Jacob Jackson   TSK 0919335
.           Add check for PTDDDLEN=1 when validating 'Effective To'
. V11.04.04 15/04/2024  Jacob Jackson   TSK 0919335 
.           Add remote call function to validate 'Effective To' date
. V11.04.03 14/03/2024  Jacob Jackson   TSK 0919335
.           Refactor code for striking records and filtering by field type 
.           to not use REMOTE00/RSExecute, fixing an issue where trying to 
.           filter by type would remove all records
.           Add tag to determine if patddhaf has records
. V11.04.02 05/03/2024  Jacob Jackson   TSK 0919335
.           Add WRITE for PTCNHFED tag
. V11.04.01 05/12/2023  Sunny           TSK 0933071
.           Strip STARTKEY in ISTABK00 and Changed ISROWK00
.           04/03/2024  Jacob Jackson   TSK 0919335
.           Add health fund history variables, routines and templates
.           Generate history table for each health fund
. V11.03.09 14/06/2023 Bella Turco      TSK 0933691
.           Fixed misspelling of Attendence                                 
. V11.03.08 19/05/2023 Ebon Clements    TSK 0932677
.           New hospital selection list tag without an all option - GTAG2300
. V11.03.07 08/05/2023 J.Tan            TSK 0911166
.           Mod updating reason for hold in patfx1af 
. V11.03.06 05/04/2023 J.Tan            TSK 0911166
.           Recompiled for IBAADT62 - Hold invoice audit
. V11.03.05 20/03/2023  Peter Vela        0911166
.           Added clear of new variables in PATFX1FD
. V11.03.04 14/02/2023  Sunny         TSK 0816724
.           - Added ISTABK00, NEXTIN00, and PREVIN00
.           - Changed STARTKEY to DIM 15         
. V11.03.03 10/01/2023  Bella Turco   TSK 0921957
.           Continued adding PTCNNRTD & NOMORE00 to maintenance lists
. V11.03.02 15/12/2022  Jacob Jackson TSK 0927846
.           Add checks to Health Fund Table Maintenace and Health
.           Fund Table Maintenance to see if they contain data
. V11.03.01 15.11.2022  DA Sarkies    TSK 0925502  
.           Added check for Multi-hospital in HSPSEL00
. V11.02.14 06/09/2022  Bella Turco   TSK 0921957  
.           Continued adding PTCNNRTD & NOMORE00 to maintenance lists
. V11.02.13 12/08/2022  Sunny         TSK 0922644
.           Added check for All Hospital access in HSPSEL00        
. V11.02.12 28/07/2022  Sunny         TSK 0922644
.           Fixed HSEL0000 - Hospital selection for on-hold invoice 
. V11.02.11 25/07/2022  Sunny         TSK 0900447
.           Fixed CHKDED00 - for date range overlap validation
. V11.02.10 18/07/2022  Bella Turco   TSK 0921957
.           Added NOMORE00 - Display "No more records" at end of list
.           Added PTCNNRTD - Displays number of rows set by parameter value
. V11.02.09 07/07/2022  Davin         TSK 0921708
.           Fixed inability to add drg date range (CHKDED00)
. V11.02.08 26/05/2022  J.Tan         TSK 0814566 
.           Added flag for opening patfn2af file
. V11.02.07 20/05/2022  J.Tan         TSK 0814566 
.           Added TRAP opening patfn2af file
. V11.02.06 04/05/2022  J.Tan         TSK 0814566 
.           Fixed adding mutliple MV hours records for Multi hospital
. V11.02.05 22/04/2022  Sunny         TSK 0900447 
.           Fixed CHKDED00 - for date range overlap validation  
. V11.02.04 21/04/2022  Davin         TSK 0917793 (0882260)
.           Added DRG Version 11.0 in DRGVER00/HFND2900
. V11.02.03 11/04/2022  J.Tan         TSK 0814566 
.           Added HF Mechanical Ventilation new option
. V11.02.02 15/03/2022  Thanh T       TSK 0818139 
.           Clear Is GST applicable flag (PTFXGSTA) and GST payable code
.           (PTFXGSTC) fields from patfx1af.
.           15/03/2022  Thanh T       TSK 0911895
.           Clear Communication Method (BLETCOMM) from bokletrf
. V11.02.01 10/02/2022  Thanh T       TSK 0905641
.           Recompiled as OUTMA1FD (PATMASTM) changes
. V11.01.05 15.12.2021  J.Tan          Task 0880410
.           Fixed Selection of Hospitals for use with No access to All hospital
. V11.01.04 14.10.2021  J.Tan          Task 0880410
.           Added System Health Fund On Hold invoice functionality
. V11.01.03 27.10.2021  Peter Vela     Task 0902857
.           Added WebServices functionality for ECLPAR00 
. V11.01.02 09.09.2021  DA Sarkies     Task 0905305
.           Made changes to PMSVSCTM so will recompile as well
. V11.01.01 23/04/2021  Ebon Clements  Task 0904815
.           Cross browser missing <tr> - GLSROW00
. V11.00.08 21/12/2020  Tracey Nguyen  Task 0888079
.           Recompiled for PMSVSCTM
. V11.00.07 10/11/2020  Tracey Nguyen  Task 0888079
.           Recompiled for PMSVSCTM
. V11.00.06 04/11/2020  Ebon Clements  Task 0897862
.           Added extra keystroke to allow for all hospitals keyin - RUNADH00
. V11.00.05 02/09/2020  Jill Parkinson Task 0894534
.           Recompiled for OUTADLTM - sms select list to use 3 characters 
. V11.00.04 14/08/2020  Jill Parkinson Task 0892293
.           Fixed add of allowance codes
. V11.00.03 06/07/2020  Jill Parkinson Task 0893883
.           Mods to only count rows displayed for insurance lookup search
. V11.00.02 11/06/2020  J.Tan          TSK  0892858
.           Mod Updating HF to write HF extension record if missing
. V11.00.01 18/03/2020  Peter Vela     TSK 0889143
.           Recompiled for OUTLETFD
. V10.15.01 12/02/2020  Sunny          TSK  0882791
.           Added HFUND029 to display and record the Health Fund 
.           Contact Email Address (PATFN1AF.PTHFCEML)
.----------------------------------------------------------------------
. V10.14.02 02/10/2019  Thanh T        TSK  0882260
.           Added DRG Version 11.0 in DRGVER00/HFND2900
. V10.14.01 28/04/2019  Richa Phogat   TSK  0870439
.           Added DRG Version 10.0 in DRGVER00/HFND2900
.----------------------------------------------------------------------
. V10.13.03 29/10/2018  Ebon Clements  TSK  0856616
.           Fixed PMEGRTYP record type test - DRGVMT00
. V10.13.02 29/10/2018  Ebon Clements  TSK  0856616
.           Allow DRG version to have multiple effective dates - DRGVMT00
. V10.13.01 01/08/2018  J.Tan          TSK 0848506
.           Changed PP Doctor from DIM6 to DIM10
. V10.12.01 22/03/2018  Tracey Nguyen  TSK  0852793
.           Added DRG Version 9.0 in DRGVER00/HFND2900
. V10.11.05 27/11/2017  Thanh Tieu     Task 0821710
.           Recompiled as PATMASTM changed
. V10.11.04 14/11/2017  Don Nguyen     TSK 0816814
.           Added new maintenance functions for Value Set ID table (pmsvstaf),
.           Value Set Codes table (pmsvscaf), Value Mapping table (pmsvmtaf).
. V10.11.03 26/09/2017  Peter Vela     TSK 0845865
.           Added HFEXT021
. V10.11.02 30/07/2017  Thanh T.       TSK 0821710
.           Audit admission/outpatient/UR comments. changed PATMASTM/PMSPX2TM.
. V10.11.01 25/07/2017  Don Nguyen     TSK 0839906
.           Modified LSTBLS00 to also output start/end date values for sorting
.----------------------------------------------------------------------
. V10.10.01 29/06/2017  Richa Phogat   TSK 0841179
.           Removed code setting FMTSNAME from FANROW00. It is done in PATLN000
. V10.08.03 27/09/2016  Don Nguyen     TSK 0312570
.           Modified SETPAR00 to pack DRGKYVAL with spaces; for CHKDED00
. V10.08.02 26/08/2016  Don Nguyen     TSK 0312570
.           Modified HFHED000 & HFROWA00 to not output Grouper Version column
.           when PTCNDGED=1 or NZ.
.           Added CHKDED00 - Check DRG Effective Dates routine
.           Added REMCDE00 (report 47) - Remote script to check DRG Dates
.           Added GTAG1100-GTAG2200
.           Added DRGVMT00 (report 46) - DRG Version Maintenance
. V10.08.01 04/04/2016  Peter Vela     TSK 0816405
.           Added PTHFIMCD PTHFDPRI to Health Fund maintenance
.           24/03/2016 Steve Armstrong TSK 0294177
.           Added Added PTHFIMCD & PTHFDPRI to CLRHLT00
.----------------------------------------------------------------------
. V10.07.06 05/01/2016  Ebon Clements  TSK 0294154
.           Added SMS message  selection list - SMSSNC00
. V10.07.05 16/12/2015  Ebon Clements  CAR 294154
.           Added SMS message notifications to letter maintenance
. V10.07.04 13/11/2015  Ebon Clements  CAR 320819
.           Fixed Inactive test to letter selection lists
. V10.07.03 23/10/2015  Ebon Clements  CAR 320819
.           Added Inactive test to letter selection lists
. V10.07.02 22.10.2015  Ebon Clements  CAR 320819
.           Added active/inactive indicator to letter maintenance
. V10.07.01 21/10/2015  J.Tan            CAR 315453
.           Added HFEXT020 - 'Make Primary based on MBS Fee' to patfx1af file
. V10.06.05 02/07/2015  Ebon Clements    CAR 318452
.           Fixed DRG Ver 8.0 display (hfnd2900)
. V10.06.04 26/06/2015  Ebon Clements    CAR 313597
.           Update keyword for all associalted H/F tables when updating 
.           a H/F  - HLTFND00
. V10.06.03 29/05/2015  Ebon Clements    CAR 317094
.           Added DRG Ver 8.0 (hfnd2900)
. V10.06.02 30/03/2015  Peter Vela     CAR 314605
.           Fixed RA read around WRPMHPG1 to check ovrcd=1 not 0
. V10.06.01 30/03/2015  Peter Vela     CAR 314605
.           Added RA read around WRPMHPG1
. V10.05.04 01/12/2014  Peter Vela     CAR 306070
.           Added LOOPCNTR to DISTFA000
. V10.05.03 27/10/2014  Peter Vela     CAR 306070
.           Added limit for DISTFA00
. V10.05.02 06/10/2014  Ebon Clements  CAR 268970
.           Change to use OUTCLIFD index 1 instead of index 2
. V10.05.01 29/08/2014  J.Tan             CAR 298984
.           Recompiled for PMSLTFFD 
. V10.04.02 07/04/2014  Peter Vela      CAR 286258
.           Recompiled for PATMASTM
. V10.04.01 31.03.2014  B.G.Ackland  CAR 299363
.           Replace META Tag Redirect with Javascript in Common RDIREC00
.           Routine
.----------------------------------------------------------------------
. V10.03.10 09/07/2013  Peter Vela       CAR 287592
.           Recompiled for PMSLTFTD PMSLTFTM
. V10.03.09 23/05/2013  Davin            CAR 284669 HDP 2013 DRG 7.0
.           Added DRG Ver 7.0 (hfnd2900)
. V10.03.08 25/02/2013 Ania P         CAR 281021
.           Removed unnecessary modification of constants.
. V10.03.07 10/10/2012  Patrick Adair     CAR 273294
.           Added Health Fund AROC equivalent field PTHFARCE
. V10.03.06 19/09/2012  Patrick Adair     CAR 273332
.           Added Grouper Version 6.2 to HFND2900 and corrected Grouper version
.           table display in HFROWA00
. V10.03.05 05/06/2012  J.Tan          CAR 255708
.           Mods Changing Free text HF reason for Hold Inv to update Inv.Pending
. V10.03.04 01/06/2012  J.Tan             CAR 255708
.           Mods Changing HF Hold Inv.Fromdate to update Inv.Pending file
. V10.03.03 14/04/2012  J.Tan             CAR 255708
.           Added hfext019 - Hold Invoice from date
. V10.03.02 27.02.2012  Peter McMullen    CAR 259857
.           Remove maintenance for file patyears                        
. V10.03.01 05.12.2011  Ebon Clements     CAR 248529
.           Recompiled for IBAWEBCD - Clear of ADMISSNO and URNUMBER
. V10.02.04 07.09.2011  Saroeun Soeur     CAR 243942
.            added IACTIVE - to display active insurance code only if indicator 
.            of tag is set to 1
. V10.02.03 30/05/2011  Ebon Clements     CAR 239552
.           Added printed by to OP letter history
. V10.02.02 27/05/2011  J.Tan             CAR 239592
.           Added new fields to patin1af (email, fax no, service code,claim)
. V10.02.01 30/03/2011  Peter Vela        CAR Billing Changes
.           Changed table display to table type and desc in SPTHFA00 for
.           LNK2PRT = 4
. V10.01.03 03/12/2010  Mike Laming       CAR 233046
.           Mods to "patmchgf" - use "Table Type" (PTMCHFTT) replacing
.           "H/F Table" (MHFTAB)
. V10.01.02 26/11/2010  Ebon Clements     CAR 234288          
.           Schedule update health fund reason for hold inv
.           30/11/2010  Davin             CAR 234050          
.           Added fields to the HF Maintenance list table (hfrowa00)
. V10.01.01 04/10/2010  Peter Vela        CAR 233037          
.           Added new fields for Health Fund Extension file:
.           PTFXCEFR,PTFXRHCD,PTFXRHFT
.           Added tags to PTCNUEDI and PTCNMVCP to HTAB0000
. V10.00.10 23/08/2010  Steve Armstrong   CAR 228847
.           Recompiled for changes to PATIN1IO
. V10.00.09 09/08/2010  J.Tan          CAR 218426
.           Mods to display Claim code and health for Financial letter extract
. V10.00.08 16/07/2010  Davin          CAR 226354
.           Added versions 5.2 & 6.0 to grouper drop down in hf maintenance
. V10.00.07 13/07/2010  J.Tan          CAR 213817
.           Fixed ADMISSNO for Financial letter list
. V10.00.06 08/06/2010  Ebon Clements  CAR 207040
.           Recompiled for PMSHPGTM - Manage programs
. V10.00.05 24/05/2010  Mike Laming    CAR 169939
.           Added PTINACTV (PTINS016) Active Flag for Insurance Coy. Details
. V10.00.04 21/05/2010  Ebon Clements  CAR 207040
.           Recompiled for PMSHPGTM - Manage programs
. V10.00.03 20/05/2010  J.Tan          CAR 220995 
.           Mods for Health Fund enquiry
. V10.00.02 30/04/2010  J.Tan         CAR 220887
.           Mods checking for Active/Inactive of Misc.charge
. V10.00.01 12/04/2010  J.Tan          CAR 218426
.           Recompiled for PMSLTFTM - added Extract ID to pmsltfaf
. V9.12.08  09/02/2010  Ebon Clements  CAR 207040 
.           Added report 44 health fund program maintenance
. V9.12.07  17/12/2009  Peter McMullen CAR 210130
.           Convert to newer Dr name format routine DOCNM000
. V9.12.06  25/11/2009  Jill Parkinson CAR 174079
.           Mods to output PTHFFACD,PTHFNDFP,PTHFOCGR
. V9.12.05  01/10/2009  Jill Habasque CAR 174079
.           Added PTHFFACD and PTHFNDFP
. V9.12.04  08/09/2009  Peter Vela    CAR 187022
.           Initialise Contact variables to SP70 before write to patfn1af
. V9.12.03  07/09/2009  J.Tan         CAR 205303
.           Added Contract ID to Casemix files
. V9.12.02  13/08/2009  Peter Vela     CAR 203723
.           Added Eclipse Participant functionality to patfx1af.
. V9.12.01  17/08/2009  J.Tan          CAR 202941
.           Added Health Fund Group tag for HF Enquiry
. V9.11.03  16/12/2008  Ebon Clements  CAR 183976
.           Added Eclipse fields to insurance file
. V9.11.02  21/11/2008  Ebon Clements  CAR 183976
.           Added Eclipse fields to health fund file
. V9.11.01  06/11/2008  Peter McMullen CAR 174725
.           convert internal javascript to W3C standards
. V9.10.01  06/08/2008  J.Tan          CAR 167967
.           Recompiled for PMSLTFTM - Checking Multi hospital table
. V9.09.05  03/01/2008  Davin          CAR 153384
.           Added Default Fee Information Code (pthfdfic - Stationery Type 3)
. V9.09.04  25/10/2007  J.Tan          CAR 151803
.           Added report 43 Emergency Triage Fee 
. V9.09.03  12/10/2007  Ebon Clements  CAR 151931
.           Added report 40 and 41 HCP letter selections
. V9.09.02  24/09/2007  Jill Habasque  CAR 150322
.           Added "Code all records" field - PTHFCARC
. V9.09.01  10/09/2007  Ebon Clements  CAR 149753
.           Recompiled for PMSLTFTM
. V9.08.04  31/01/2007  Peter Vela     CAR 127930
.           Recompiled for MRTMASFD
. V9.08.03  27/12/2006  Jill Habasque CAR 129247
.           Mods to output Contract instead of Health fund if NZ
. V9.08.02  06/11/2006  Mike Laming   CAR 103368
.           Added PTCNUCCP for CCPS EDI - same functionallity as PTCNUEDI
. V9.08.01  03/10/2006  Jill Habasque  CAR 119998
.           Added new fields to health fund table - billing name and full desc
.           Mods 'Fund' to 'Contract' for NZ Private
. V9.07.03  21/08/2006  Davin S       CAR 117071
.           Added new option for EDI - 'extract zero invoices' 
. V9.07.02  18/07/2006  Peter Vela    CAR 112256
.           Added Grouper Version 5.1 to HFND2900
. V9.07.01  12/07/2006  Ebon Clements CAR 103368
.           Added foreign address to health fund extension file
. V9.05.02  18/04/2006  Ebon Clements CAR 72172
.           Added check for cancelled bookings in ADHROW00
. V9.05.01  09/03/2006  Ebon Clements CAR 78533
.           Mods for PATCODTM - Hospital specific category codes
. V9.05.B01 30/01/2006  Ebon Clements CAR 93186
.           Mods for REDIRECT length change. Recompiled for IBAWEBDF
. V9.04.09  12/10/2005  Peter Vela    CAR 79262
.           Fixed tag for Health Fund Table active indicator FTROW000
.           Fixed list display for Health Fund Table active indicator HTAB0900
. V9.04.08   04/08/2005  J.Tan        CAR 62750
.           Mods not to use the redefined amount variables
. V9.04.07  13/07/2005  Peter Vela     CAR 63400
.           Recompiled for OUTADLTM
. V9.04.06  08/07/2005  Ebon Clements  CAR 65523
.           Added edits and copy function to period date range maintenance 
. V9.04.05  18/06/2005  Jill Habasque
.           Fixed outladaf
. V9.04.04  17/06/2005  Peter Vela    CAR 63400
.           Modified Keystrokes for Ad Hoc Letters
. V9.04.03  06/01/2005  Lina Vo       CAR 54686
.           Fixed FANROW00 to read emergency discharge date.        
. V9.04.02  04/09/2004  Lina Vo       CAR 53798
.           Changed program to use PTHSDCLM instead of PTCNDCLM for 
.           Multi Hospital
. V9.04.01  30/08/2004  Jill Habasque CAR 52930
.           Added hospital code for financial letters
. V9.03.28  29/07/2004  Pat Dirito    CAR 52153
.           Added Grouper Ver 5.0 to HFND2900
. V9.03.27  16/07/2004  Lina Vo       CAR 50424
.           Remove calculation of RECTOTAL from DISFAL00. There is now a new
.           field in the header file.  Changed Financial Letter Next and 
.           Previous to now use the table key rather than go though the whole
.           table to get to the next pages. 
. V9.03.26  16/06/2004  Lina Vo       CAR 50424
.           Added Print Booking Letters (Report 38) 
.           Added Remote script - Delete Booking letters (Report 39) 
. V9.03.25  10/06/2004  Lina Vo       CAR 50424
.           Added Setup Booking Letters Maintenance (Report 37) 
. V9.03.24  08/06/2004  Lina Vo       CAR 50536
.           Recompile for PMSLTFTD & PMSLTFTM                      
.           Fixed display of Financial Letter List (DISTFA00)                
.           21/05/2004  Pat Dirito    CAR 50035
.           Added Mech. Vent. fields to Health Fund Maintenance.
. V9.03.23  07/04/2004  Lina Vo       CAR 78897
.           Added HosClaims EDI fields to Health Fund Maintenance.
. V9.03.22  26/03/2004  Jill Habasque CAR 48470
.           Added output of PTHFGRPV        
. V9.03.21  01/03/2004  Lina Vo       CAR 47921
.           Removed use of PRIDBTFD & IO.
. V9.03.20  06/02/2004  Lina Vo       CAR 44133
.           Fixed PP Financial Letters.
. V9.03.19  06/02/2004  Lina Vo       CAR 44132
.           Fixed PP General Letters.
. V9.03.18  11/12/2003  Peter Vela    CAR 40355
.           Recompiled for PATNAMCD
. V9.03.17  20/11/2003  J.Tan  
.           Fixed set up admission number for financial letter list
. V9.03.16  29/10/2003  Lina Vo       CAR 44126
.           Added Private Practice Set Up Financial Letters Maintenance
.           (Report 36 - PRIFLT00).
. V9.03.15  14/10/2003  Pat Dirito    CAR 44236
.           Added NEXTHG00 & PREVHG00 to include STARTKEY
. V9.03.14  13/10/2003  Tracey Nguyen CAR 44125
.           Added Private Practice Set Up General Letters Maintenance
. V9.03.13  02/10/2003  Pat Dirito    CAR 36492
.           Fixed SPTHFA00 to use javascript instead of HREF for UpdateParent.
.           HREF cuased stop wait/posting bar icon to display.
. V9.03.12  25/09/2003  Tracey Nguyen CAR 36511
.           Modified FANROW00 to display all rows.
. V9.03.11  16/09/2003  Tracey Nguyen CAR 36494
.           Added Financial Letter Maintenance
. V9.03.10  21/08/2003  Lina Vo       CAR 36528
.           Removed PATKHFUP from HLTFND52.                                   
. V9.03.09  13/08/2003  Tracey Nguyen CAR 41169
.           Fixed Claim Code field to look at category "CL" instead of   
.           being a free format field for Patient Invoice Message Per Claim
.           Code Maintenance (report 33).
. V9.03.08  11/08/2003  Tracey Nguyen CAR 41656
.           Called proc PATKHFUP to update the health fund keywords search
.           table for the health fund maintenance in report 2.
. V9.03.07  24/07/2003  Lina Vo       CAR 41324
.           Mod. FTTAB000 Health Fund Table List to include HDP Eq & Active.
. V9.03.06  21/07/2003  Tracey Nguyen CAR 40588
.           Added Health Fund Search without tables
. V9.03.05  17/07/2003  Lina Vo        CAR 41537
.           Changed FUNDNAME from DIM 30 to 40.
. V9.03.04  19/06/2003  Tracey Nguyen  CAR 40466
.           Moved Description column next to Charge column for Outpatients
.           charge listing (report 30) and Emergency Charge listing (report 31).
.           19/06/2003  Tracey Nguyen  CAR 40470
.           Moved "&nbsp;" to description field if it is left blank for
.           Outpatient Charge and Emergency Charge listings.
.           18/06/2003  Tracey Nguyen  CAR 39867
.           Added Update All Tables formaction to Health Fund Maintenance
.           (report 2) and modified Health Fund Table Search to display only
.           active health fund tables.
. V9.03.03  12/06/2003  Tracey Nguyen  CAR 39843 & 40258
.           Added Moeity Delete formaction and modified Health Fund Delete
.           formaction to delete all Moeity details attached to the health
.           fund being deleted.
. V9.03.02  0/06/2003  Tracey Nguyen  CAR 39577
.           Added filters on Resident Status and Claim Code for Outpatient
.           Charges Maintenance (report 30) and Emergency Charges Maintenance
.           (report 31).
. V9.03.01  14/05/2003  Dean Cramer   CAR 38995
.           Included code for Invoice Message by Claim Code Maintenance.
. V9.02.15  15/04/2003  Tonii  CAR 37591
.           Fixed display of extracted patient letters 
.           Fixed printing of letters
.           15/04/2003  Jill Habasque SRF 36487           
.           Added update of patient moeity                             
.           11/04/2003  Tonii  CAR 35446
.           Fixed code for Adhoc letter print
.           - Added in Generate button to extract letters
.           - Changed header format for Patient list display
.           - Fixed display of patient list                   
.           - Mods to delete extracted records from outladaf if the extract 
.             is delete
. V9.02.14  21.01.2003  Ebon Clements            SRF 35446
.           Changed Key size to 17 not 34 on reads to OUTLADFD         
.           26/02/2003 J.Tan     SRF 20178
.           Added view insurance details
. V9.02.13  29.11.2002  Lina Vo                  SRF 22709
.           Changed program to open outpatient files with site prefix.
. V9.02.12  24.09.2002  Pat Dirito               SRF 21510
.           Added UpdateParent() to ISTAB000                        
. V9.02.11  12/06/2002  J.Tan
.           Fixed 'Use Matrix default' & 'Use matrix indicator'
. V9.02.10  08/04/2002  J.Tan
.           Added 'Use Matrix default' & 'Use matrix indicator'
. V9.02.09  19.02.2002  Kuldeep Singh 
.           Modify Health fund for theatre charging indicator 
. V9.02.08  05.02.2002  Ebon Clements 
.           Recompiled for file changes to OUTLADFD
. V9.02.07  29.01.2002  Asif Malik 
.           Added Emergency Charges Maintenance
.           Fixed Outpatient Charges Maintenance display
. V9.02.06  08.01.2002  Asif Malik  
.           Fixed Outpat Charges Maintenance update/delete
. V9.02.05  02.01.2002  Asif Malik  
.           Added Outpatient Charges Maintenance
. V9.02.04  13.10.2001  Kuldeep Singh 
.           Additional Letter changes              
. V9.02.03  03.10.2001  Kuldeep Singh 
.           Add coding for Financial Letter Print  
.           Add Coding for Adhoc Letter Print 
.           Add Coding for Reminder A/c Letter Print 
.           Add Coding for Private Practice General letter 
.           Add Coding for Private Practice Financial letter
. V9.02.02  18.09.2001  Glenn Saunders
.           Add coding for invoice message templates [report 14]
. V9.02.01  24.08.2001  Ebon Clements
.           Changed LETDET00 to update variable PTLELVAR
.----------------------------------------------------------------------
. V5.09.B02 29.12.2000  B.G.Ackland    
.           Casemix Billing Options
. V5.08.04  16/08/2000  Caleb Sharman
.           Changed Health Fund variables to be 8 chars
. V5.08.03  30.06.2000  Katie Nelson 
.           Changed KEY10 to KEY14 for Health Fund key change
. V5.08.02  26.06.2000  Bronko Sosic
.           Added option 8 Period Date Range Maintenance
.           Added option 9 Start of Year Maintenance
. V5.08.01  19.04.2000  B.G.Ackland
.           Added option 7 Patient Letter Maintenance
.           19.04.2000  Bronko Sosic
.           Added option 5 and 6
.----------------------------------------------------------------------
.                 V5.07.06 23.03.2000 Bronko Sosic
.                          Added startkey for GOTO button
.                 V5.07.05 16.02.2000 Pat Dirito       
.                          Added javascript control to ShowDetail
.                 V5.07.04 13.01.2000 Pat Dirito       
.                          Modified routine COMSAV00        
.                 V5.07.03 20.12.1999 Katie Nelson     
.                          Recompiled for IBAWEBCD/IBAWEBDF
.                 V5.07.02 01.12.1999 Nicole Harrington
.                          Changed index on patkhfaf
.                 V5.07.01 03.11.1999 Katie Nelson 
.                          Recompiled for WEDATCD/DAYOFWEK
.                 V5.07.00 29.07.1999 Pat Dirito
.                          Ported from V6.06 
.----------------------------------------------------------------------
.                 V6.06.00 23.06.1999 Pat Dirito 
.                          Created Program
.----------------------------------------------------------------------
          INC       IBAWEBDF    

          INC       WEBDATDF
          INC       RSHWEBDF
.
          INC       BOKLETFD/INC   * Booking Letter
          INC       BOKLTLFD/INC   * Booking Letter List Index
          INC       BOKLTSFD/INC   * Booking Letter Selection Criteria
          INC       BOKRC1FD/INC   * Booking Table
.
          INC       EMRVISFD/INC   * Emergency Visit Table
          INC       EMRTRFFD/INC   * Emergency Triage Fee Table
.
          INC       PRIFSLFD/INC   * Private Practice Financial Selection List 
          INC       PRIFLSTD/INC   * Private Practice Financial Letter
          INC       PRIFLSFD/INC   * Private Practice Financial Letter
.
          INC       PRIGLSTD/INC   * Private Practice General Letter
          INC       PRIGLSFD/INC   * Private Practice General Letter
          INC       PRIGSLFD/INC   * Private Practice General Selection List
          INC       PRIDOCFD/INC   * Private Practice Doctors
.          INC       PRIDBTFD/INC   * Private Practice Debtor
          INC       PRIFLTFD/INC   * Private Practice Financial Letters
          INC       PRIHDBFD/INC   * Private Practice Holding Header
.
          INC       PRIRELFD/INC   * Reminder Accounts Selection List
          INC       PRIREMFD/INC   * Reminder Accounts Select Criteria
          INC       PRIREMTD/INC
          INC       PATMESFD/INC   * Invoice Messages file (patmesgf)
          INC       PATINMFD/INC   * Invoice Messages file (patinmaf)
          INC       PATPARFD/INC
          INC       PRIPRAFD/INC   * Private Practice Medical Practice
          INC       OUTLETFD/INC   * Outpatients Letters File
          INC       OUTCANFD/INC
          INC       OUTCLIFD/INC   * Clinic file
          INC       RCPCIDFD/INC   * Receipting Cashier Details
          INC       OUTBOAFD/INC  
          INC       OUTBB1FD/INC  
          INC       OUTCONFD/INC
          INC       OUTCTYFD/INC   * Clinic type file
          INC       OUTADLTD/INC
          INC       PMSDLTTD/INC
          INC       PMSDLTFD/INC
          INC       PMSDSLFD/INC
          INC       PMSHPGFD/INC
          INC       PMSHPOFD/INC
          INC       PMSUPGFD/INC
          INC       PMSUPOFD/INC
          INC       PMSLETTD/INC
          INC       PMSLTFTD/INC
          INC       OUTADLFD/INC   * Adhoc Letters
          INC       OUTLADFD/INC   * Adhoc Letters List
          INC       PATFLTFD/INC   * Financial Letters
          INC       PATALWFD/INC   * Patient Allowance File
          INC       PATHGPFD/INC   * Patient Health Fund Group File FD
          INC       PATIN1FD/INC   * Patient Insurance File FD
          INC       PATFMOFD/INC   * Patient Moeity
          INC       PATFN1FD/INC   * Patient Health Fund File FD
          INC       PATFX1FD/INC   * Patient Health Fund Extension File FD
          INC       PATFN2FD/INC   * Patient Health Fund Extension File FD
          INC       PATFN2TD/INC   * Patient Health Fund Extension File FD
          INC       PATFCMFD/INC   * Patient Health Fund Comments FD
          INC       PATKHFFD/INC   * Health Fund Tables Key Words 
          INC       PATKICFD/INC   * Insurance Key Words table
          INC       PATILTFD/INC   * Inpatient Letters
          INC       PATDRGFD/INC   * Period Date Range FD
          INC       PATASDFD/INC 
          INC       PATCMCFD/INC 
          INC       PATHLFFD/INC 
          INC       PATHDFFD/INC
          INC       PATINVFD/INC
          INC       PATSRBFD/INC
          INC       PMSSINFD/INC
          INC       PATBFEFD/INC
          INC       PMSLETFD/INC
          INC       PMSLSTFD/INC
          INC       PATFHIFD/INC
          INC       PATFHITD/INC
          INC       PATLHIFD/INC
          INC       PATMA1FD/INC
          INC       PATHSPFD/INC
          INC       PMSHATFD/INC
          INC       PMSHATTD/INC
          INC       PATMI1FD/INC
          INC       PATDSCFD/INC
          INC       PATCALAG/INC
          INC       PATCONFD/INC
          INC       PATDLTFD/INC
          INC       PATVISFD/INC
          INC       PMSPX2FD/INC
          INC       PATDO1FD/INC
          INC       OUTSITFD/INC
          INC       PATWR1FD/INC
          INC       PATALRFD/INC
          INC       MRTMASFD/INC
          INC       PMSUCHFD/INC
          INC       PMSUCDFD/INC
          INC       PMSVSCFD/INC
          INC       PMSVSCTD/INC
          INC       PMSVMTFD/INC
          INC       PMSVMTTD/INC
          INC       PMSVSTFD/INC
          INC       PMSVSTTD/INC
          INC       PMSUKIFD/INC       * Key Words file for Value Set ID
          INC       PATMASTD/INC
          INC       PATPR1FD/INC
          INC       PATMCHFD/INC
          INC       PMSLLFFD/INC
          INC       PMSLTFFD/INC
          INC       PMSHCPFD/INC
          INC       NHIMASFD/INC
          INC       NHIETHFD/INC
          INC       PATNIPFD/INC
          INC       PATDDHFD/INC
          INC       PATDDHTD/INC
          INC       AAECONFD/INC
          INC       PRILETFD/INC                  * Letter file
          INC       MLTSECFD/INC
          INC       PMSVX1FD/INC
          INC       PMSEDGFD/INC       * Effective DRG
          INC       PMSEDGTD/INC       * Effective DRG (cgi vars)
          INC       WEBGRPVA/INC       * DRG vars
          INC       WEBPARFD/INC
.
. Variable Declarations
.
CHGFLAG   FORM      1
HOSPCNTR  FORM      2
CLRHLINV  DIM       1
DOCTCODE  DIM       6
PSAGETYP  DIM       6                        * age type description
PSAGECON  DIM       3                        * age converted value
PATLINK   DIM       127
LETTDESC  DIM       20
DATFIELD  DATE      8
DIMCHECK  DIM       1
DIM3      DIM       3
DIM8      DIM       8
DIM11     DIM       11
DISPDATE  DIM       11
DISPDAT2  DIM       11
DDRGCODE  DIM       4
EXTRTYPE  FORM      1
EDIREQD   FORM      1
KEY21A    DIM       21
KEY26A    DIM       26
KEY31A    DIM       31
SETHLINV  DIM       1
SAVEREAS  DIM       3
SAVKEY12  DIM       12
SAVKEY14  DIM       14
SAVKEY15  DIM       15
SAVKEY29  DIM       29
SAVKEY30  DIM       30
SMSSDESC  DIM       3
FORM3     FORM      3
FORM8     FORM      8
FORM1P1   FORM      1.1
DIM1P1    DIM       3
FILTACTV  DIM       1
FILTHGRP  DIM       6
F12P2     FORM      12.2
INCRYEAR  FORM      1
IACTIVE   DIM       1
LETTNUMB  FORM      3
LOOPCNTR  FORM      8
NOALLOPT  FORM      1
NOPROGRM  FORM      1
NOPMSHAT  FORM      1
NEXTFKEY  DIM       12
PREVFKEY  DIM       12
PRVFFLAG  FORM      1
NEXTPAGE  FORM      1         * Nextpage parameter
UPDTTYPE  DIM       1         * Update Type (A)dd,(U)pdate,(D)elete,Blank=disp
DIM42     DIM       42        * Used in CHKDED00                              
DIM42A    DIM       42        * Used in CHKDED00                              
DIM60A    DIM       60        * Used in ISROWK00 
USEFHINV  FORM      1
STARTKEY  DIM       15        * Starting Key
STNTYPE   DIM       3       * Stationery Type
STNCODE   DIM       6       * Stationery Code
VYEARCHO  DIM       4
VALFDATE  DIM        8      * From Date for Validation
VALTDATE  DIM        8      * To Date for Validation
RECTOTAL  FORM      5          * Total rexords 
RECCNT    FORM      3
JAVSNAME  DIM       80
ENDNAME   DIM       80
STRTNAME  DIM       80
LINK2PRT  FORM      1
CFILEPRE  DIM       3
CODECL    INIT      "CL"
FIVEHUND  FORM      "500"
EFFTDATE  DIM       8
.
FDRGYEAR  DIM       4         * From DRG Year
TDRGYEAR  DIM       4         * To DRG Year
FUNDCODE  DIM       6         * Fund Number
FUNDNAME  DIM       40        * Fund Name
.
HFGRP001  DIM       6         * Health Fund Group Code
HFGRP002  DIM       50        * Health Fund Group Description
HFGRP003  DIM       6         * Default Fee Information Code
.
VIEWOPTS  DIM       1
INSURANC  DIM       6         * Insurance Code
.
INVMSGCD  DIM       3         * Invoice Message Code       (patmesgf)
INVMSGL1  DIM       65        * Invoice Message Line 1     (patmesgf)
INVMSGL2  DIM       65        * Invoice Message Line 2     (patmesgf)
.
INCMSGSY  FORM      1         * Invoice Message System     (patinmaf)
INCMSGCD  DIM       3         * Invoice Message Claim Code (patinmaf)
INCMSGL1  DIM       60        * Invoice Message Line 1     (patinmaf)
INCMSGL2  DIM       60        * Invoice Message Line 2     (patinmaf)
.
ALLHFLAG  FORM      1
ACTIDESC  DIM       8   * Active or Inactive Description
ADDNEWPG  FORM      1
ADMISSTY  DIM       3
ATYPDESC  DIM       20
BEDTYPES  DIM       3
CLAMDESC  DIM       20
CONTRCOD  DIM       6
CLAIMCOD  DIM       3
CURRDATE  DIM       8
TABLETYP  DIM       3
.
WSININDC  DIM       1
.
HCPTDESC  DIM       25        * HCP Type Description
HFUND001  DIM       6         * Fund Number
HFUND002  DIM       40        * Fund Name
HFUND003  DIM       35        * Health Fund Address 1
HFUND004  DIM       35        * Health Fund Address 2
HFUND005  DIM       20        * Health Fund Telephone
HFUND006  FORM      2         * Theatre charging indicator
HFUND007  DIM       4         * HDP Equivalent
HFUND008  DIM       20        * Fax Number
HFUND009  DIM       6         * Health Fund Group
HFUND010  DIM       6         * HCP Equivalent
HFUND011  DIM       1         * Active Indicator  0=Active 1=Inactive
HFUND012  DIM       70[99]    * Health Fund Maintenance Comment 
HFUND013  DIM       35        * Health Fund Address 3  (Added for 5.07)
HFUND014  DIM       35        * Health Fund Address 3  (Added for 5.07)
HFUND015  DIM       8         * Post Code  (Added for 5.07)
HFUND016  DIM       1         * Use matrix default indicator
HFUND017  DIM       1         * Use casemix matrix indicator
HFUND018  DIM       3         * Grouper version (031 041 or 042)
HFUND019  DIM       40        * Billing Name
HFUND020  DIM       70        * Full Description
HFUND021  DIM       1         * Code all records
HFUND022  DIM       6         * Default Fee Information Code
HFUND023  DIM       3         * Future Action Code Code
HFUND024  DIM       3         * No of Days for Payment
HFUND025  DIM       3         * Occupational Group
HFUND026  DIM       3         * AROC Equivalent Code              * Car 273294
HFUND027  DIM       3         * Type of IMC Default
HFUND028  DIM       1         * Default to Sub Item in PRI
HFUND029  DIM       80        * Fund Email                        * TSK 0882791
.
HFEXT001  DIM       6         * Fund Number
HFEXT002  FORM      2         * EDI Extract Flag 0=No 1=Running EDI
HFEXT003  DIM       1         * EDI Test Flag T=Test P=Production 
HFEXT004  DIM       60        * EDI Address
HFEXT005  DIM       30        * EDI Subject
HFEXT006  DIM       35        * Foreign Address Line 1
HFEXT007  DIM       35        * Foreign Address Line 2
HFEXT008  DIM       35        * Foreign Address Line 3
HFEXT009  DIM       35        * Foreign Address Line 4
HFEXT010  DIM       8         * Foreign Post Code
HFEXT011  DIM       1         * EDI Zero Invoice Flag (0=No 1=Yes)
HFEXT012  DIM      80         * Eclipse Sender Contact Email
HFEXT013  DIM      40         * Eclipse Sender Contact Name
HFEXT014  DIM      20         * Eclipse Sender Contact Phone
HFEXT015  DIM       3         * Eclipse Participant
HFEXT016  DIM       1         * Contracts effective from
HFEXT017  DIM       3         * Reason for Hold Code
HFEXT018  DIM      80         * Reason for Hold Free Text
HFEXT019  DIM       8         * Hold invoices From date
HFEXT020  DIM       1         * Make Primary Based on MBS Fee
HFEXT021  DIM       1         * Sending Eclipse IHC MOR
.                               segment
.                               0 or Blank = No
.                               1 = Yes
.
HFTAB001  DIM       6         * Fund Number
HFTAB002  DIM       8         * Fund Table
HFTAB003  DIM       40        * Fund Name
HFTAB004  DIM       4         * HDP Equivalent
HFTAB005  DIM       3         * Table Type (CAT HT)
HFTAB006  DIM       1         * Active Indicator  0=Active 1=Inactive    
HFTAB007  FORM      12.2      * Maximum patient moeity
HFTAB008  DIM       30        * patient moeity description 1
HFTAB009  DIM       35        * patient moeity description 2
.
PTFMO001  DIM       3         * Bed type
PTFMO002  FORM      12.2      * Sameday amount
PTFMO003  FORM      12.2      * Overnight amount
.
PMHPG001  DIM       3         * Admission Type (Cat A)
PMHPG002  DIM       3         * Claim Code (Cat CL)
PMHPG003  DIM       6         * Health Fund
PMHPG004  DIM       3         * Health Fund Table Type (Cat HT)
PMHPG005  DIM       8         * Effective Date (CCYYMMDD)
PMHPG006  DIM       3         * Maximum Number of IP Visits
PMHPG007  DIM       3         * Warn at X Number of IP Visits
PMHPG008  DIM       3         * Maximum Number of OP Visits
PMHPG009  DIM       3         * Warn at X Number of OP Visits
PMHPG010  DIM       1         * Breakdown of OP Visits
.
PMHPO001  DIM       3         * Admission Type (Cat A)
PMHPO002  DIM       3         * Claim Code     (Cat CL)
PMHPO003  DIM       6         * Health Fund
PMHPO004  DIM       3         * Health Fund Table Type (Cat HT
PMHPO005  DIM       8         * Effective Date (CCYYMMDD)
PMHPO006  DIM       3         * Visit Type (Cat CV)
PMHPO007  DIM       3         * Maximum Number of OP Visits
PMHPO008  DIM       3         * Warn at X Number of OP Visits
.
PMSLS001  DIM       4         * Selection ID
PMSLS002  DIM       8         * Admission Number
PMSLS003  DIM       1         * Deleted 1=Yes 0=No
.
BOKLS001  DIM       4         * Selection ID 
BOKLS002  DIM       35        * Description   
BOKLS003  DIM       1         * Deposit Paid
BOKLS004  DIM       8         * Start Date 
BOKLS005  DIM       8         * End Date 
BOKLS006  DIM       8         * Booking number
BOKLS007  DIM       1         * Deleted 1=Yes 0=No
.
PMLLS001  DIM       4         * Selection ID
PMLLS002  DIM       8         * Admission Number
PMLLS003  DIM       1         * Deleted 1=Yes 0=No
.
PMDSL001  DIM       4         * Selection ID
PMDSL002  DIM       10        * HCP
PMDSL003  DIM       1         * Deleted 1=Yes 0=No
.
PRIRL001  DIM       4         * Selection ID
PRIRL002  DIM       77          
PRIRL003  DIM       1         * Deleted 1=Yes 0=No
.
PRIGL001  DIM       4         * Selection ID
PRIGL002  DIM       8         * Debtor Number 
PRIGL003  DIM       1         * Deleted 1=Yes 0=No
PRIGL004  DIM       2         * Scan Flag (0= Debtor 1=U/R) 
PRIGL005  DIM       8         * Unique ID 
.
PRIFL001  DIM       4         * Selection ID
PRIFL002  DIM       8         * Debtor Number 
PRIFL003  DIM       1         * Deleted 1=Yes 0=No
PRIFL004  DIM       2         * Scan Flag (0= Debtor 1=U/R) 
PRIFL005  DIM       8         * Unique ID 
.
PTALW001  DIM       2         * Allowance Code
PTALW002  DIM       20        * Allowance Description
PTALW003  FORM      6.2       * Allowance Amount
.
PTINS001  DIM       6         * Insurance Number
PTINS002  DIM       30        * Insurance Name
PTINS003  DIM       35        * Insurance Address Line 1
PTINS004  DIM       35        * Insurance Address Line 2
PTINS005  DIM       35        * Insurance Address Line 3
PTINS006  DIM       35        * Insurance Address Line 4
PTINS007  DIM       8         * Insurance Postcode
PTINS008  DIM       30        * Insurance Contact
PTINS009  DIM       20        * Telephone - Business
PTINS010  FORM      8.2       * Amount to be billed
PTINS011  FORM      8.2       * Amount Outstanding 
PTINS012  DIM       6         * Sort Key
PTINS013  DIM      80         * Eclipse Sender Contact Email
PTINS014  DIM      40         * Eclipse Sender Contact Name
PTINS015  DIM      20         * Eclipse Sender Contact Phone
PTINS016  DIM       1         * Insurance Details Active (0=active, 1=inactive)
PTINS017  DIM      20         * Fax Number
PTINS018  DIM      80         * Email Address
PTINS019  DIM       3         * Service code (catg Ve)
PTINS020  DIM       3         * Claim code (catg CL)
PTINS021  DIM       3         * AROC Equivalent Code                  Car 273294    
.
PTLET001  DIM       3       3         1  Letter Number
PTLET002  DIM       70      70        7  Line of letter
PTLET003  DIM       2       2        79  Letter bottom margin
PTLET004  DIM       2       2        81  Letter top margin
PTLET005  DIM       3       3        83  Physical paper length (no. of lines)
PTLET006  DIM       2       2        86  Letter left margin
PTLET007  DIM       8       8        88  Mail Merge File Name
PTLET008  DIM       1       1        86  Active
PTLET009  DIM       1       1        97  Communication Method
PTLET010  DIM       1       1        98  Letter Type
.
PTYER001  DIM       4         * Year Number
PTYER002  FORM      1         * Starting weekday as 1/1/year
.
PTDRG001  DIM       8         * From date for Period (CCYYMMDD)
PTDRG002  DIM       8         * To date for Period (CCYYMMDD)
PTDRG003  DIM       4         * Financial Year (CCYY)
PTDRG004  DIM       2         * Financial Period Code (MM)
PTDRG005  DIM       4         * Calendar Year (CCYY)
PTDRG006  DIM       2         * Calendar Period Code (MM)
PTDRG007  DIM       20        * Long Description
PTDRG008  DIM       9         * Medium Description
PTDRG009  DIM       3         * Short Description
.
. Casemix 
.
CMXFKEYS  DIM       27
.
. Casemix Same Day Fees Tables
.
CMXLS001    DIM     30       * Description 1
CMXLS002    DIM     35       * Description 2
CMXLS003    DIM     15       * Lumpsum rebate portion
CMXLS004    DIM     15       * Lumpsum patient portion
CMXLS005    DIM     5        * Low Outlier Cut off Day
.
CMXAD001    DIM      3        * Bed type
CMXAD002    DIM     30        * Description 1
CMXAD003    DIM     35        * Description 2
CMXAD004    DIM     15        * Additional Daily rebate portion
CMXAD005    DIM     15        * Additional Daily patient portion
.
PTLEEND   FORM      3
PTLECOMN  DIM       70[999]                Comments 
.
TXTLEN    FORM      3         * Text Length
LASTITEM  FORM      3         * Last Item of Health Fund Comments 
ENDYEAR   FORM      4         * Save for drop down list of Fin Years
TABTDESC  DIM       20
.
LNK2PRT   FORM      1
NBSP      INIT      "&nbsp;"
ZERO8     INIT      "0000    "
SPECCHAR  INIT      "%"
.
PMLDAT01  DIM       11
PMLDAT02  DIM       11
CLINICTY  DIM       6
OUTSIT01  DIM       6
OUTCLI01  DIM       6
PRRMMP01  DIM       6
PRGLSD01  DIM       6
PRLLTYP1  DIM       3
FIRST12   DIM       12
TEST12    DIM       12
SP12      DIM       12
DOCTMP01  DIM       6
SYSDESC   DIM       20
TMDOPR01  DIM       12
MVHRFLAG  FORM      "0"
MULTHCNT  FORM      2
MULTHOSP  DIM       3[99]
MISCCODE  DIM       9
MENUFLAG  DIM       1        * Menu Type (Maintenance/Enquiry)
VISITDSC  DIM       15
VISTYINP  INIT      "Inpatient"
VISTYOUT  INIT      "Outpatient"
VISTYEMR  INIT      "Emergency"
VISTYPPR  INIT      "Private Pract."
VISTYDAY  INIT      "Day Centre"
VISTYUNK  INIT      "Unknown"
VISTYALL  INIT      "Allied Health"
VISTYEVT  INIT      "Event"
FLDNUMNA  FORM      2
NUMFLTYP  FORM      1
RMRHFTBL  FORM      1
REMOTENO  FORM      2
HFFLDTYP  DIM       2
HFNAMEDP  DIM       6
COMMDESC  DIM       3
.
.
. DRG Versions Maintenance variables
.
PAGETITL  DIM       80       * Page title
DRGRTYPE  DIM       1        * DRG Record Type
DRGKYVAL  DIM       30       * DRG Key Value
DRGVERNO  DIM       3        * DRG Version Number
DRGVERST  DIM       4        * DRG Version Number string
DRGFRDAT  DIM       8        * DRG From Date
DRGTODAT  DIM       8        * DRG To Date
DRGHFCOD  DIM       6        * DRG Health Fund Code
DRGCLCOD  DIM       3        * DRG Claim Code
DRGSTCOD  DIM       1        * DRG State Code
DRGUPDAT  DIM       1        * DRG Update Indicator  
DSPDATFR  DIM       12       * Display From Date (DD MON CCYY)
DSPDATTO  DIM       12       * Display To Date (DD MON CCYY)
DSPDSTAT  DIM       10       * Display State Name

STATNONE  INIT      "Not Aust"
STATENZ   INIT      "NZ"
STATENSW  INIT      "NSW"
STATEVIC  INIT      "VIC"
STATEQLD  INIT      "QLD"
STATESA   INIT      "SA"
STATEWA   INIT      "WA"
STATETAS  INIT      "TAS"
STATENT   INIT      "NT"
STATEACT  INIT      "ACT"
.
.
.
. Outpatient charges table
.
PTNIP001  DIM       1         * System Code (PATVISFD)
PTNIP002  DIM       3         * Clinic Indicator (category CI)
PTNIP003  DIM       3         * Resident Status (category T or EL)_
PTNIP004  DIM       3         * Compensation Code (categ. CL or EM)
PTNIP005  DIM       3         * Visit Type (category CV)
PTNIP006  DIM       30        * Description
PTNIP007  DIM       3         * Item Group (category FI)
PTNIP008  FORM      12.2      * Amount
.
CATDESC1  DIM       20        * description for Clinic Indicator
CATDESC2  DIM       20        * description for Resident Status
CATDESC3  DIM       20        * description for Compensation Code
CATDESC4  DIM       20        * description for Visit Type
CATDESC5  DIM       20        * description for Item Group
CATDESC6  DIM       30        * description for charge item
.
FILTATYP  DIM       3         * Admission type filter
FILTCLAM  DIM       3         * Claim code filter
FILTFUND  DIM       6         * Health fund filter
FILTTABT  DIM       3         * Health fund table type filter
FLTCLNIC  DIM       3         * filter for Clinic Indicator
FLTRESID  DIM       3         * filter for Resident Status
FLTCOMPE  DIM       3         * filter for Compensation Code
.
. Adhoc letter print          * I-90215
.
ADHCCLIN  DIM       30        * Clinic description
ADHCBOOK  DIM       25        * Booking Date and Time
.
OTLA0001  DIM       8         * Outpatient Number
OTLA0002  DIM       1         * Delete status
.
. ******* Patient Financial Letters ********
.
PTFLT001  DIM       3       3         1  Letter Number
PTFLT002  DIM       70      70        7  Line of letter
PTFLT003  FORM      2       2        79  Letter bottom margin
PTFLT004  FORM      2       2        81  Letter top margin
PTFLT005  FORM      3       3        83  Physical paper length (no. of lines)
PTFLT006  FORM      2       2        86  Letter left margin
PTFLT007  DIM       1       1        88  Active
.
. ******* Private Practice General Letters ********
.
PRLET001  DIM       3       3         1  Letter Number
PRLET002  DIM       70      70        7  Line of letter
PRLET003  FORM      2       2        79  Letter bottom margin
PRLET004  FORM      2       2        81  Letter top margin
PRLET005  FORM      3       3        83  Physical paper length (no. of lines)
PRLET006  FORM      2       2        86  Letter left margin
.
. ******* Private Practice Financial Letters ********
.
PRFLT001  DIM       3       3         1  Letter Number
PRFLT002  DIM       70      70        7  Line of letter
PRFLT003  FORM      2       2        79  Letter bottom margin
PRFLT004  FORM      2       2        81  Letter top margin
PRFLT005  FORM      3       3        83  Physical paper length (no. of lines)
PRFLT006  FORM      2       2        86  Letter left margin
.
. ******* Booking Letters ********
.
BKLET001  DIM       3       3         1  Letter Number
BKLET002  DIM       70      70        7  Description   
BKLET003  FORM      2       2        79  Letter bottom margin
BKLET004  FORM      2       2        81  Letter top margin
BKLET005  FORM      3       3        83  Physical paper length (no. of lines)
BKLET006  FORM      2       2        86  Letter left margin
BKLET007  DIM       1       1        88  Active
BKLET008  DIM       1       1        89  Communication Method
.
. Emergency Triage Fee table
.
EMTRF001  DIM       3         * Triage Code (category AA)
EMTRF002  DIM       3         * Attendance Type (category ee)
EMTRF003  DIM       8         * Effective Date
EMTRF004  DIM       30        * Description
EMTRF005  FORM      12.2      * Amount
EMTRF006  DIM       3         * Set Code (category PG)
EMTRF007  DIM       1         * Active
.
FLTTRIAG  DIM       3         * filter for Triage code
FLTATTND  DIM       3         * filter for Attendance Type
+
.-----------------------------------------------------------
PRGID     INIT      "PATWEB87"
VERSION   INIT      "V12.01.00"
PRGNAM    INIT      "Health Fund Table Maintenance Server"
.-----------------------------------------------------------
          CALL      WEBINT00       * Initialise Fifo Etc.
          CALL      INIT0000       * Open Files
.
MAIN1000  CALL      WEBRED00       * Read Fifo WEBPID and USERID
.
          COMPARE   "999",REPORTNO * End Server Process on Report Option 999
          GOTO      MAIN9999 IF EQUAL
.
          PACK      CURRDATE,CCC,CYY,CMM,CDD,SP10
          REP       " 0",CURRDATE
.
          BRANCH    REPORTNO,MAIN1100,MAIN1200,MAIN1300,MAIN1400,MAIN1500:
                             MAIN1600,MAIN1700,MAIN1800,MAIN1900,MAIN2000:
                             MAIN2100,MAIN2200,MAIN2300,MAIN2400,MAIN2500:
                             MAIN2600,MAIN2700,MAIN2800,MAIN2900,MAIN3000:
                             MAIN3100,MAIN3200,MAIN3300,MAIN3400,MAIN3500:
                             MAIN3600,MAIN3700,MAIN3800,MAIN3900,MAIN4000:
                             MAIN4100,MAIN4200,MAIN4300,MAIN4400,MAIN4500:
                             MAIN4600,MAIN4700,MAIN4800,MAIN4900,MAIN5000:
                             MAIN5100,MAIN5200,MAIN5300,MAIN5400,MAIN5500:
                             MAIN5600,MAIN5700,MAIN5800,MAIN5900,MAIN6000:
                             MAIN6100,MAIN6200,MAIN6300,MAIN6400,MAIN6500:
                             MAIN6600
.
          PACK      WEBTITLE,PRGID,SP1,VERSION,SP1,PRGNAM,SP70
          MOVE      "Invalid Option",WEBTITLE
          CALL      WEBERR00   * Create Output File and Write HTML Page Header
          GOTO      MAIN1000
.
MAIN1100  CALL      GRPFND00           * Health Fund Group Maintenance
          BRANCH    EXIT,MAIN1000
          CALL      NXTPG000           * next page
          GOTO      MAIN1000
.
MAIN1200  CALL      HLTFND00           * Health Fund Maintenance
          BRANCH    EXIT,MAIN1000
          CALL      NXTPG000           * next page
          GOTO      MAIN1000
.
MAIN1300  CALL      HTBFND00           * Health Fund Table Maintenance
          BRANCH    EXIT,MAIN1000
          CALL      NXTPG000           * next page
          GOTO      MAIN1000
.
MAIN1400  CALL      TABSRC00           * Health Fund Table Search 
          BRANCH    EXIT,MAIN1000
          CALL      NXTPG000           * next page
          GOTO      MAIN1000
.
MAIN1500  CALL      PATALW00           * Allowance Code Maintenance
          BRANCH    EXIT,MAIN1000
          CALL      NXTPG000           * next page
          GOTO      MAIN1000
.
MAIN1600  CALL      PATINS00           * Insurance Code Maintenance
          BRANCH    EXIT,MAIN1000
          CALL      NXTPG000           * next page
          GOTO      MAIN1000
.
MAIN1700  CALL      PATLET00           * Patient Letter Maintenance
          GOTO      MAIN1000
.
MAIN1800  CALL      PATDRG00           * Period Date Ranges Maintenance
          BRANCH    EXIT,MAIN1000
          MOVE      "Update Complete",WEBTITLE
          CALL      NXTPG000
          GOTO      MAIN1000
.
MAIN1900  MOVE      "Year Maintenance  no longer required or supported",WEBTITLE
          CALL      WEBERR00   * Create Output File and Write HTML Page Header
          GOTO      MAIN1000
.
MAIN2000  CALL      CMXSDY00
          BRANCH    EXIT,MAIN1000
          MOVE      "Update Complete",WEBTITLE
          CALL      NXTPG000
          GOTO      MAIN1000
.
MAIN2100  CALL      PMSSEL00           * Print Patient letters
          BRANCH    EXIT,MAIN1000
          MOVE      "Update Complete",WEBTITLE
          CALL      NXTPG000
          GOTO      MAIN1000
.
MAIN2200  CALL      DISSEL00           * Display Selected Patients
          BRANCH    EXIT,MAIN1000
          CALL      NXTPG000
          GOTO      MAIN1000
.
MAIN2300  CALL      DELPAT00           * Delete Patient From List
          GOTO      MAIN1000
.
MAIN2400  CALL      INVMSG00           * Display Invoice Messages (patmesgf)
          BRANCH    EXIT,MAIN1000
          CALL      NXTPG000           * next page
          GOTO      MAIN1000
.
MAIN2500  CALL      PMSFIL00           * Print Financial letters
          BRANCH    EXIT,MAIN1000
          MOVE      "Update Complete",WEBTITLE
          CALL      NXTPG000
          GOTO      MAIN1000
.
MAIN2600  CALL      DISFAL00           * Display Selected Financial letters 
          BRANCH    EXIT,MAIN1000
          CALL      NXTPG000
          GOTO      MAIN1000
.
MAIN2700  CALL      DELFAL00           * Delete Financial letters From List
          GOTO      MAIN1000
.
MAIN2800  CALL      OTALLP00           * Adhoc Letter Print 
          BRANCH    EXIT,MAIN1000
          MOVE      "Update Complete",WEBTITLE
          CALL      NXTPG000
          GOTO      MAIN1000
.
MAIN2900  CALL      DISADH00           * Display Adhoc Letter List 
          BRANCH    EXIT,MAIN1000
          CALL      NXTPG000
          GOTO      MAIN1000
.
MAIN3000  CALL      DELADH00           * Delete Adhoc Letter 
          GOTO      MAIN1000
.
MAIN3100  CALL      PRIREM00           * Private Practice Reminder letter 
          BRANCH    EXIT,MAIN1000
          MOVE      "Update Complete",WEBTITLE
          CALL      NXTPG000
          GOTO      MAIN1000
.
MAIN3200  CALL      DISREL00           * Display Reminder list
          BRANCH    EXIT,MAIN1000
          CALL      NXTPG000
          GOTO      MAIN1000
.
MAIN3300  CALL      DELREL00 
          GOTO      MAIN1000
.
MAIN3400  CALL      PRIGLS00           * Private Practice General letter 
          BRANCH    EXIT,MAIN1000
          MOVE      "Update Complete",WEBTITLE
          CALL      NXTPG000
          GOTO      MAIN1000
.
MAIN3500  CALL      DISGSL00           * Display selected Pri. Pvt. GLS. Letter
          BRANCH    EXIT,MAIN1000
          CALL      NXTPG000
          GOTO      MAIN1000
.
MAIN3600  CALL      DELGSL00           * Delete elected Pri. Pvt. GLS. Letter 
          GOTO      MAIN1000
.
MAIN3700  CALL      PRIFLS00            * Private Practice Financial Letter 
          BRANCH    EXIT,MAIN1000
          MOVE      "Update Complete",WEBTITLE
          CALL      NXTPG000
          GOTO      MAIN1000
.
MAIN3800  CALL      DISFLI00            * Display selected Pri. Pvt. Fin. Letter
          BRANCH    EXIT,MAIN1000
          CALL      NXTPG000
          GOTO      MAIN1000
.
MAIN3900  CALL      DELFLI00            * Delete Pri. pvt. Fin.letters From List
          GOTO      MAIN1000
.
MAIN4000  CALL      PATNIP00            * Outpatient charges maintenance
          BRANCH    EXIT,MAIN1000
          CALL      NXTPG000
          GOTO      MAIN1000
.
MAIN4100  CALL      EMRNIP00            * Emergency charges maintenance
          BRANCH    EXIT,MAIN1000
          CALL      NXTPG000
          GOTO      MAIN1000
.
MAIN4200  
.         CALL      HFMOI000            * Health fund moeity
          BRANCH    EXIT,MAIN1000
          CALL      NXTPG000
          GOTO      MAIN1000
.
MAIN4300  CALL      INCMSG00           * Display Invoice Messages (patinmaf)
          BRANCH    EXIT,MAIN1000
          CALL      NXTPG000           * next page
          GOTO      MAIN1000
.
MAIN4400  CALL      PATFLT00           * Financial Letters Maintenance
          GOTO      MAIN1000
.
MAIN4500  CALL      PRILET00           * Private Practice Set Up General Letter
          GOTO      MAIN1000
.
MAIN4600  CALL      PRIFLT00           * Privt. Practice Set Up Financial Letter
          GOTO      MAIN1000
.
MAIN4700  CALL      BOKLET00           * Booking Letters Maintenance
          BRANCH    EXIT,MAIN1000
          CALL      NXTPG000
          GOTO      MAIN1000
.
MAIN4800  CALL      BOKLTS00           * Print Booking letters
          BRANCH    EXIT,MAIN1000
          MOVE      "Update Complete",WEBTITLE
          CALL      NXTPG000
          GOTO      MAIN1000
.
MAIN4900  CALL      DELBLL00           * Remote script - Delete Booking letters
          GOTO      MAIN1000
.
MAIN5000  CALL      HCPSEL00           * HCP letter selections
          BRANCH    EXIT,MAIN1000
          MOVE      "Doctors Letter Selections",WEBTITLE
          CALL      NXTPG000
          GOTO      MAIN1000
.
MAIN5100  CALL      DISHCP00           * HCP selection - HCP List
          BRANCH    EXIT,MAIN1000
          MOVE      "Doctors Letter Selected HCP Details",WEBTITLE
          CALL      NXTPG000
          GOTO      MAIN1000
.
MAIN5200  CALL      REMHCP00           * Delete HCP From List
          GOTO      MAIN1000
.
MAIN5300  CALL      EMRTRF00            * Emergency Triage Fee maintenance
          BRANCH    EXIT,MAIN1000
          CALL      NXTPG000
          GOTO      MAIN1000
.
MAIN5400  CALL      FNDPRG00            * Health Fund Program maintenance 
          BRANCH    EXIT,MAIN1000
          CALL      NXTPG000
          GOTO      MAIN1000
.
MAIN5500  CALL      FNDOPG00            * Health Fund OP Program maintenance 
          BRANCH    EXIT,MAIN1000
          CALL      NXTPG000
          GOTO      MAIN1000
.
MAIN5600  CALL      DRGVMT00           * DRG Versions maintenance
          BRANCH    EXIT,MAIN1000
          CALL      NXTPG000
          GOTO      MAIN1000
.
MAIN5700  CALL      REMCDE00           * Remote script - Check DRG Efft. Date
          GOTO      MAIN1000
.
MAIN5800  CALL      VALSET00           * Value Set ID Maintenance
          BRANCH    EXIT,MAIN1000
          CALL      NXTPG000           * next page
          GOTO      MAIN1000
.
MAIN5900  CALL      VALCOD00           * Value Set ID Code Maintenance
          BRANCH    EXIT,MAIN1000
          CALL      NXTPG000           * next page
          GOTO      MAIN1000
.
MAIN6000  CALL      VALMAP00           * Value Mapping Maintenance
          BRANCH    EXIT,MAIN1000
          CALL      NXTPG000           * next page
          GOTO      MAIN1000
.
MAIN6100  CALL      HLDINV00           * HF On Hold Inv. Maintenance
          BRANCH    EXIT,MAIN1000
          CALL      NXTPG000
          GOTO      MAIN1000
.
MAIN6200  CALL      MVHOUR00           * Mechanical Vent.hours Maintenance
          BRANCH    EXIT,MAIN1000
          CALL      NXTPG000
          GOTO      MAIN1000
.
MAIN6300  CALL      HFDDHT00           * HF Date History Maintenance
          BRANCH    EXIT,MAIN1000
          CALL      NXTPG000           * next page
          GOTO      MAIN1000
.
MAIN6400  CALL      REMCED00           * Remote script - ensure no future 
          GOTO      MAIN1000           * effective dates
.
MAIN6500                               * SMS Booking
          GOTO      MAIN1000
.
MAIN6600  CALL      PCWOMV00           * CWO MV DRG
          BRANCH    EXIT,MAIN1000
          CALL      NXTPG000           * next page
          GOTO      MAIN1000
.
MAIN9999  MOVE      "SERVER SHUTDOWN COMPLETE",WEBTITLE
          CALL      WEBERR00
          STOP
.-------------------------------------------------------------------------------
.  Next Page URL
.-------------------------------------------------------------------------------
NXTPG000  IF        NEXTPAGE=0
            CALL      WINCLS00      * Refresh parent and close window
.            CALL      DBGCLS00      * Refresh parent and close window
          ENDIF

          IF        NEXTPAGE=1
            CALL      RSAVED00      * Redirect URL
          ENDIF
.
          IF        NEXTPAGE=2
            CALL      GOBACK00      * Go Back 1 html page
          ENDIF
.
          IF        NEXTPAGE=3
            CALL      DAH20000      * Go Back 2 html pages
          ENDIF
.
          IF        NEXTPAGE=4
            CALL      PREDIR00      * Redirect Parent
          ENDIF
.
NXTPG999  RETURN
.
DBGCLS00  CALL      OPENHTML
          BRANCH    EXIT,DBGCLS90
.
          WRITE     HTMLFILE;"<script type=#"text/javascript#" ":
                             "src=#"../js/Standard.js#"></script>":
                             "<script type=#"text/javascript#" ":
                             "src=#"../js/Custom.js#"></script>":
                             "<script type=#"text/javascript#"> ":
                             " if (self.name==#"PopUpFrame#") {":
                             "  reloadParentFrame();}":
                             " else { ":
                             "  window.history.go(-1);":
                             "  self.close(); }":
                             "</script>"
          CALL      CLOSHTML
          GOTO      DBGCLS99
.
DBGCLS90  DISPLAY   "*** Fifo Not Found *** Rep:",REPORTNO
.
DBGCLS99  RETURN
.-------------------------------------------------------------------------------
.  Goes back 1 page
.-------------------------------------------------------------------------------
GOBACK00  CALL      OPENHTML
          BRANCH    EXIT,GOBACK99
          WRITE     HTMLFILE;"<script type=#"text/javascript#"> {":
                             "    alert(#"",WEBTITLE,"#");":
                             "    self.close();":
                             "    opener.history.go(-1);":
                             "}":
                             "</script>"
          CALL      CLOSHTML
GOBACK99  RETURN
+
.------------------------------------------------------------------------------
.  Redirect Parent URL
.------------------------------------------------------------------------------
PREDIR00  CALL      OPENHTML
          BRANCH    EXIT,PREDIR90
.
PRTEST    WRITE     HTMLFILE;"<script type=#"text/javascript#" ":
                             "src=#"../js/Standard.js#"></script>":
                             "<script type=#"text/javascript#" ":
                             "src=#"../js/Custom.js#"></script>":
                             "<script type=#"text/javascript#"> {":
.                             " alert(#"",WEBTITLE,"#");":
                             " if (self.name.match(/PopUpFrame/)) {":
                          "  redirectParentFrame(#"",REDIRECT,"#");":
                             "} else {":
                             " parent.location.href=#"",REDIRECT,"#";":
                             "}}":
                             "</script>"
          CALL      CLOSHTML
          GOTO      PREDIR99
.
PREDIR90  DISPLAY   "*** Fifo Not Found ***"
.
PREDIR99  RETURN
+
.------------------------------------------------------------
. Open Files and Initialize Variables
.------------------------------------------------------------
INIT0000  OPEN      PATHGRP1,"pathgrpf" 
          OPEN      PATALLW1,"patallw"
          OPEN      PATFCMM1,"patfcmmf"
          OPEN      PATCODE1,"patcodes"
          OPEN      PATCODE2,"patcodes"
          OPEN      PATIN1A1,"patin1af"      * Open Insurance File
          OPEN      PATKHFA1,"patkhfaf"
          OPEN      PATKHFA2,"patkhfaf"
          OPEN      PATKICA2,"patkicaf"      * Open Insurance keyword file
          OPEN      PATFN1A1,"patfn1af"      * Open Health Fund File        
          OPEN      PATFN1A3,"patfn1af"      * Open Health Fund File        
          OPEN      PATFX1A1,"patfx1af"
          OPEN      PATFMOA1,"patfmoaf"
          OPEN      PATLETR1,"patletrf"      * Open patient letter file     
          OPEN      PATLETR2,"patletrf"      * Open patient letter file     
          OPEN      PATFLET1,"patfltrf"      * Open financial letter file   
          OPEN      PATFLET2,"patfltrf"      * Open financial letter file   
          OPEN      PATDRGA1,"patdrgaf"
          OPEN      PATDRGA2,"patdrgaf"
          OPEN      PATASDA1,"patasdaf"
          OPEN      PATCMCA1,"patcmcaf"
          OPEN      PATDLTA1,"patdltaf"
          OPEN      PATHLFA1,"pathlfaf"
          OPEN      PATHDFA1,"pathdfaf"
          OPEN      PATINVR3,"patinvrf"
          OPEN      PATSRBA1,"patsrbaf"
          OPEN      PATHSPA1,"pathspaf"
          OPEN      PATMA1A1,"patma1af"
          OPEN      PATMX1A1,"patmx1af"
          OPEN      PMSSINA1,"pmssinaf"
          OPEN      PATBFEE1,"patbfeef"
          OPEN      PATBFEE2,"patbfeef"
          OPEN      PMSLSTA1,"pmslstaf"
          OPEN      PMSLETA1,"pmsletaf"
          OPEN      PATMI1A1,"patmi1af"
          OPEN      PATDSCH1,"patdschf"
          OPEN      PATDSCH2,"patdschf"
          OPEN      PATVISA1,"patvisaf"
          OPEN      PMSPX2A1,"pmspx2af"
          OPEN      PMSDLTA1,"pmsdltaf"
          OPEN      PMSDSLA1,"pmsdslaf"
          OPEN      PATDO1A1,"patdo1af"
          OPEN      PATWR1A1,"patwr1af"
          OPEN      PATALRT1,"patalrtf"
          OPEN      MRTMASA1,"mrtmasaf"
          OPEN      PATPR1A1,"patpr1af"
          OPEN      PATMESG1,"patmesgf"
          OPEN      PATINMA1,"patinmaf"
          OPEN      PATPARA1,"patparaf"
          OPEN      PATFLET2,"patfltrf"
          OPEN      PMSLTFA1,"pmsltfaf"
          OPEN      RCPCIDA1,"rcpcidaf" 
          OPEN      PRIPRAC1,"pripracf" 
          OPEN      PRIREMA1,"priremaf" 
          OPEN      PRIRELA1,"prirelaf" 
          OPEN      PRIDOCT1,"pridoctf" 
          OPEN      PRIDOCT2,"pridoctf" 
.          OPEN      PRIDEBT1,"pridebtf" 
          OPEN      PRIFLTR1,"prifltrf" 
          OPEN      PRIFLTR2,"prifltrf" 
          OPEN      PRIHDBT2,"prihdbtf" 
          OPEN      PRIGLSA1,"priglsaf" 
          OPEN      PRIGSLA1,"prigslaf" 
          OPEN      PRIFLSA1,"priflsaf" 
          OPEN      PMSLLFA1,"pmsllfaf" 
          OPEN      PRIFSLA1,"prifslaf" 
          OPEN      PMSHCPA1,"pmshcpaf"
          OPEN      PATNIPB1,"patnipbf"
          OPEN      PATMCHG1,"patmchgf"
          OPEN      PATMCHG4,"patmchgf"
          OPEN      PATLHIS1,"patlhisf"
          OPEN      PATDDHA1,"patddhaf"
.
          OPEN      PRILETR1,"priletaf"
          OPEN      PRILETR2,"priletaf"
.
          OPEN      BOKLETR1,"bokletrf"
          OPEN      BOKLETR2,"bokletrf"
          OPEN      BOKLTLA1,"bokltlaf"
          OPEN      BOKLTSA1,"bokltsaf"
          OPEN      BOKRC1A1,"bokrc1af"
.
          OPEN      EMRVISA1,"emrvisaf"
          OPEN      EMRTRFA1,"emrtrfaf"
.
          OPEN      IBATMHA1,"ibatmhaf"
          OPEN      PMSVX1A1,"pmsvx1af"
.
          CALL      INTMAS00
.
. Reading control file for displaying discharge status in emergeny charges
. maintenance
.
          READ      CONTROLF,ZERO;*43,IBCNMHOS
          READ      CONTROLF,TEN9;*212,CFEETYP
          READ      CONTROLF,TWENTY;*193,PTCNDCLM
          READ      CONTROLF,THIRTY;*196,AECNCHRS
          READ      CONTROLF,EIGHTY;*250,PTCNHDPS
          READ      CONTROLF,HUND03;*218,PTCNUCCP                     *I-103368
          READ      CONTROLF,HUND10;*115,PTCNUEDI,*229,PTCNMVCP,PTCNMVBC
          READ      CONTROLF,HUND24;*105,PTCNSMSP,*121,PTCNDGED
          READ      CONTROLF,HUND29;*61,PTCNWSIN
          READ      CONTROLF,HUND25;*238,PTCNNRTD
          READ      CONTROLF,HUND28;*250,PTCNHFED
.                                               * Using EDI Module
.         MOVE      PTCNUEDI,EDIREQD                                  *I-103368
.         MATCH     "1",PTCNUCCP            * check PTCNUEDI and PTCNUCCP
.         IF        @EQUAL
.           MOVE      ONE,EDIREQD
.         ENDIF
.         COMPARE   ONE,EDIREQD
.         IF        @EQUAL
.           OPEN      PATFX1A1,"patfx1af"      * Open Health Fund Extension File
.         ENDIF
.
          IF        IBCNMHOS=1
            OPEN      MLTCODA1,"mltcodaf"
            OPEN      MLTCODA2,"mltcodaf"
            OPEN      MLTSECA1,"mltsecaf"
          ENDIF
.
          MOVE      ZERO,F2
          MOVE      PTCNNRTD,F2
          IF        F2 = 0
            MOVE      "10",PTCNNRTD
          ENDIF
.
          OPEN      PMSEDGA1,"pmsedgaf"
          OPEN      PMSEDGA2,"pmsedgaf"
.
.
. Open outpatient programs with site prefix
.
          MOVE      "out",CFILEPRE
          CALL      OPNOUT00
.
          MOVE      ZERO,NOPROGRM
          MOVE      ZERO,OVRCD
          TRAP      OVERCOND IF IO
          OPEN      PMSHPGA1,"pmshpgaf"
          TRAPCLR   IO
          IF        OVRCD<>1
            OPEN      PMSHPOA1,"pmshpoaf"
          ELSE
            MOVE      ONE,NOPROGRM
          ENDIF
.
          MOVE      ZERO,NOPMSHAT
          MOVE      ZERO,OVRCD
          TRAP      OVERCOND IF IO
          OPEN      PMSHATA1,"pmshataf"
          TRAPCLR   IO
          IF        OVRCD<>1
            OPEN      PMSHATA1,"pmshataf"
          ELSE
            MOVE      ONE,NOPMSHAT
          ENDIF
.
          OPEN      PMSVSCA1,"pmsvscaf"
          OPEN      PMSVSTA1,"pmsvstaf"
          OPEN      PMSVMTA1,"pmsvmtaf"
          OPEN      PMSUKIA1,"pmsukiaf"
          OPEN      PMSUKIA2,"pmsukiaf"
.
          MOVE      ZERO,OVRCD               * assume file exists
          TRAP      OVERCOND IF IO           * trap for error openning file
          OPEN      PATFHIA1,"patfhiaf"      * open HF On Hold Invoice file
          TRAPCLR   IO
          MOVE      OVRCD,USEFHINV
.
          MOVE      ONE,WSININDC
          MATCH     "1",PTCNWSIN
          IF         @EQUAL
.
            MOVE      ZERO,OVRCD
            TRAP      OVERCOND IF IO
            OPEN      WEBPARA1,"webparaf"
            TRAPCLR   IO
            IF        OVRCD=1
              MOVE      ZERO,WSININDC
            ENDIF
.
          ENDIF
.
.         Check if HF Extension file for Mech Vent in Billing exists
.
          MOVE      ONE,MVHRFLAG
          MOVE      ZERO,OVRCD
          TRAP      OVERCOND IF IO          * trap for error opening file
          OPEN      PATFN2A1,"patfn2af"   * Open Health Fund Extension File
          TRAPCLR   IO
          MOVE      OVRCD,MVHRFLAG
.
INIT9999  RETURN
.------------------------------------------------------------
. Open Outpatient Files
.------------------------------------------------------------
OPNOUT00  PACK      CFNAME,CFILEPRE,FILCLIA1
          OPEN      OUTCLIA1,CFNAME     
.
          PACK      CFNAME,CFILEPRE,FILCTYA2
          OPEN      OUTCTYA2,CFNAME 
.
          PACK      CFNAME,CFILEPRE,FILADLA1
          OPEN      OUTADLA1,CFNAME 
.
          OPEN      OUTLETR2,"outletrf" 
.
          PACK      CFNAME,CFILEPRE,FILLADA1
          OPEN      OUTLADA1,CFNAME
.
          PACK      CFNAME,CFILEPRE,FILBOKA6
          OPEN      OUTBOKA6,CFNAME
.
          PACK       CFNAME,CFILEPRE,FILBB1A1  * Set up physical filename
          CLOSE      OUTBB1A1
          CALL       OPOTBB11
.
          PACK      CFNAME,CFILEPRE,FILCANA1
          OPEN      OUTCANA1,CFNAME
.
          READ      CONTROLF,THIRTY1;*225,OTCNSLET       * I-90215
.
OPNOUT99  RETURN
.------------------------------------------------------------
. Clear Parameters
.------------------------------------------------------------
CLRPAR00  MOVE      ZERO,REPORTNO
          MOVE      SP70,TEMPLATE
          MOVE      SP70,UPDTTYPE
          MOVE      ZERO,NEXTPAGE
          PACK      REDIRECT,SP70,SP70,SP70,SP70
          MOVE      ZERO,STARTNUM
          MOVE      ZERO,NORECORD
          MOVE      SP70,STARTKEY
          MOVE      ZERO,LASTITEM
          MOVE      SP70,KEYWORDS
          MOVE      SP70,VYEARCHO
          MOVE      SP70,FRSTDATE
          MOVE      SP70,INSURANC
          MOVE      SP70,VIEWOPTS
          MOVE      SP70,FILTATYP
          MOVE      SP70,FILTCLAM
          MOVE      SP70,FILTTABT
          MOVE      SP70,FILTFUND
          MOVE      SP70,FILTVACT
          MOVE      SP70,FILTVSID
          MOVE      SP70,FILTVSCD
          MOVE      SP70,FILTVSPT
          MOVE      SP70,MENUFLAG
.
          MOVE      SP70,HFGRP001 
          MOVE      SP70,HFGRP002          
          MOVE      SP70,HFGRP003          
.
          MOVE      SP70,INVMSGCD          
          MOVE      SP70,INVMSGL1          
          MOVE      SP70,INVMSGL2          
.
          MOVE      ZERO,INCMSGSY
          MOVE      SP70,INCMSGCD
          MOVE      SP70,INCMSGL1
          MOVE      SP70,INCMSGL2
.
          MOVE      SP70,BEDTYPES  
          MOVE      SP70,ADMISSTY  
          MOVE      SP70,CONTRCOD
          MOVE      SP70,CLAIMCOD  
          MOVE      SP70,TABLETYP  
.
          MOVE      SP70,HFUND001  
          MOVE      SP70,HFUND002  
          MOVE      SP70,HFUND003  
          MOVE      SP70,HFUND004 
          MOVE      SP70,HFUND005  
          MOVE      ZERO,HFUND006 
          MOVE      SP70,HFUND007  
          MOVE      SP70,HFUND008  
          MOVE      SP70,HFUND009  
          MOVE      SP70,HFUND010  
          MOVE      SP70,HFUND011  
          MOVE      SP70,HFUND013  
          MOVE      SP70,HFUND014  
          MOVE      SP70,HFUND015  
          MOVE      SP70,HFUND016  
          MOVE      SP70,HFUND017  
          MOVE      SP70,HFUND018  
          MOVE      SP70,HFUND019 
          MOVE      SP70,HFUND020 
          MOVE      SP70,HFUND021 
          MOVE      SP70,HFUND022 
          MOVE      SP70,HFUND023 
          MOVE      SP70,HFUND024 
          MOVE      SP70,HFUND025 
          MOVE      SP70,HFUND026                                   * Car 273294
          MOVE      SP70,HFUND027
          MOVE      SP70,HFUND028
          MOVE      SP70,HFUND029
.  
          MOVE      SP70,HFEXT001  
          MOVE      ZERO,HFEXT002  
          MOVE      SP70,HFEXT003  
          MOVE      SP70,HFEXT004 
          MOVE      SP70,HFEXT005  
          MOVE      SP70,HFEXT006  
          MOVE      SP70,HFEXT007  
          MOVE      SP70,HFEXT008  
          MOVE      SP70,HFEXT009  
          MOVE      SP70,HFEXT010  
          MOVE      SP70,HFEXT011  
          MOVE      SP70,HFEXT012  
          MOVE      SP70,HFEXT013  
          MOVE      SP70,HFEXT014  
          MOVE      SP70,HFEXT015
          MOVE      SP70,HFEXT016
          MOVE      SP70,HFEXT017
          PACK      HFEXT018,SP70,SP70
          PACK      HFEXT019,SP70,SP70
          MOVE      SP70,HFEXT020
          MOVE      SP70,HFEXT021
.
          MOVE      SP70,HFTAB001  
          MOVE      SP70,HFTAB002  
          MOVE      SP70,HFTAB003  
          MOVE      SP70,HFTAB004 
          MOVE      SP70,HFTAB005  
          MOVE      SP70,HFTAB006 
          MOVE      ZERO,HFTAB007 
          MOVE      SP70,HFTAB008 
          MOVE      SP70,HFTAB009 
.
          MOVE      SP70,PTFMO001
          MOVE      ZERO,PTFMO002
          MOVE      ZERO,PTFMO003
.
          MOVE      Z70,PMSLS001
          MOVE      Z70,PMSLS002
          MOVE      Z70,PMSLS003
.
          MOVE      Z70,PMHPG001
          MOVE      Z70,PMHPG002
          MOVE      Z70,PMHPG003
          MOVE      Z70,PMHPG004
          MOVE      Z70,PMHPG005
          MOVE      Z70,PMHPG006
          MOVE      Z70,PMHPG007
          MOVE      Z70,PMHPG008
          MOVE      Z70,PMHPG009
          MOVE      Z70,PMHPG010
.
          MOVE      Z70,PMHPO001
          MOVE      Z70,PMHPO002
          MOVE      Z70,PMHPO003
          MOVE      Z70,PMHPO004
          MOVE      Z70,PMHPO005
          MOVE      Z70,PMHPO006
          MOVE      Z70,PMHPO007
          MOVE      Z70,PMHPO008
.
          MOVE      Z70,PMLLS001
          MOVE      Z70,PMLLS002
          MOVE      Z70,PMLLS003
.
          MOVE      Z70,PMDSL001
          MOVE      Z70,PMDSL002
          MOVE      Z70,PMDSL003
.
          MOVE      Z70,PRIGL001
          MOVE      Z70,PRIGL002
          MOVE      Z70,PRIGL003
          MOVE      Z70,PRIGL004
          MOVE      Z70,PRIGL005
.
          MOVE      Z70,PRIRL001
          MOVE      Z70,PRIRL002
          MOVE      Z70,PRIRL003
.
          MOVE      Z70,PRIFL001
          MOVE      Z70,PRIFL002
          MOVE      Z70,PRIFL003
          MOVE      Z70,PRIFL004
          MOVE      Z70,PRIFL005
.
          MOVE      ONE,MULTHCNT
          WHILE     MULTHCNT <= 98
            MOVE      SP70,MULTHOSP[MULTHCNT]
            ADD       ONE,MULTHCNT
          DO
          MOVE      ZERO,MULTHCNT
.
          MOVE      ZERO,F3
CLRPAR50  ADD       ONE,F3       * Clear Patient Health Comments Array
          IF        F3<=99
            PACK      HFUND012[F3],SP70,SP70
            GOTO      CLRPAR50
          ENDIF
.
          MOVE      SP70,PTALW001 
          MOVE      SP70,PTALW002 
          MOVE      ZERO,PTALW003 
.
          MOVE      SP70,PTINS001
          MOVE      SP70,PTINS002
          MOVE      SP70,PTINS003
          MOVE      SP70,PTINS004
          MOVE      SP70,PTINS005
          MOVE      SP70,PTINS006
          MOVE      SP70,PTINS007
          MOVE      SP70,PTINS008
          MOVE      SP70,PTINS009
          MOVE      ZERO,PTINS010
          MOVE      ZERO,PTINS011
          MOVE      SP70,PTINS012
          MOVE      SP70,PTINS013
          MOVE      SP70,PTINS014
          MOVE      SP70,PTINS015
          MOVE      SP70,PTINS016
          MOVE      SP70,PTINS017
          MOVE      SP70,PTINS018
          MOVE      SP70,PTINS019
          MOVE      SP70,PTINS020
          MOVE      SP70,PTINS021                                   * Car 273294
.
          MOVE      Z70,PTLET001
          MOVE      Z70,PTLET002
          MOVE      Z70,PTLET003
          MOVE      Z70,PTLET004
          MOVE      Z70,PTLET005
          MOVE      Z70,PTLET006
          MOVE      Z70,PTLET007
          MOVE      Z70,PTLET008
          MOVE      Z70,PTLET009
          MOVE      Z70,PTLET010
          MOVE      ZERO,PTLEEND
.
          MOVE      SP70,PTYER001
          MOVE      SP70,PTYER002
.
          MOVE      SP70,PTDRG001          * From date for Period (CCYYMMDD)
          MOVE      SP70,PTDRG002          * To date for Period (CCYYMMDD)
          MOVE      SP70,PTDRG003          * Financial Year (CCYY)
          MOVE      SP70,PTDRG004          * Financial Period Code (MM)
          MOVE      SP70,PTDRG005          * Calendar Year (CCYY)
          MOVE      SP70,PTDRG006          * Calendar Period Code (MM)
          MOVE      SP70,PTDRG007          * Long Description
          MOVE      SP70,PTDRG008          * Medium Description
          MOVE      SP70,PTDRG009          * Short Description
.
          MOVE      SP70,CMXFKEYS  
          MOVE      SP70,CMXLS001  
          MOVE      SP70,CMXLS002  
          MOVE      SP70,CMXLS003  
          MOVE      SP70,CMXLS004 
          MOVE      SP70,CMXLS005 
.
          MOVE      SP70,CMXAD001  
          MOVE      SP70,CMXAD002  
          MOVE      SP70,CMXAD003  
          MOVE      SP70,CMXAD004 
          MOVE      SP70,CMXAD005 
.
          MOVE      SP70,PMLDAT01
          MOVE      SP70,PMLDAT02
          MOVE      SP70,CLINICTY
          MOVE      SP70,OUTSIT01
          MOVE      SP70,OUTCLI01
.
          CALL      CPPMDS00
          CALL      CPPMLE00
          CALL      CPPMFL00
          CALL      CPOTAL00
          CALL      CPPRRM00
          CALL      CPPRGL00
          CALL      CPPRFL00
.
          MOVE      SP70,PRRMMP01
          MOVE      SP70,PRGLSD01
          MOVE      SP70,PRLLTYP1
          MOVE      SP70,DOCTMP01
          MOVE      SP70,TMDOPR01
          MOVE      SP70,HFFLDTYP
.
. variables for outpatient charges maintenance
.
          MOVE      SP70,PTNIP001
          MOVE      SP70,PTNIP002
          MOVE      SP70,PTNIP003
          MOVE      SP70,PTNIP004
          MOVE      SP70,PTNIP005
          MOVE      SP70,PTNIP006
          MOVE      SP70,PTNIP007
          MOVE      ZERO,PTNIP008
.
          MOVE      SP70,FLTCLNIC
          MOVE      SP70,FLTRESID
          MOVE      SP70,FLTCOMPE
          MOVE      SP70,FLTTRIAG
          MOVE      SP70,FLTATTND
          MOVE      SP70,OTLA0001
          MOVE      SP70,OTLA0002
.
          MOVE      Z70,PTFLT001
          MOVE      Z70,PTFLT002
          MOVE      ZERO,PTFLT003
          MOVE      ZERO,PTFLT004
          MOVE      ZERO,PTFLT005
          MOVE      ZERO,PTFLT006
          MOVE      Z70,PTFLT007
.
          MOVE      Z70,PRLET001
          MOVE      Z70,PRLET002
          MOVE      ZERO,PRLET003
          MOVE      ZERO,PRLET004
          MOVE      ZERO,PRLET005
          MOVE      ZERO,PRLET006
.
          MOVE      Z70,PRFLT001
          MOVE      Z70,PRFLT002
          MOVE      ZERO,PRFLT003
          MOVE      ZERO,PRFLT004
          MOVE      ZERO,PRFLT005
          MOVE      ZERO,PRFLT006
.
          MOVE      Z70,BKLET001
          MOVE      Z70,BKLET002
          MOVE      ZERO,BKLET003
          MOVE      ZERO,BKLET004
          MOVE      ZERO,BKLET005
          MOVE      ZERO,BKLET006
          MOVE      Z70,BKLET007
          MOVE      Z70,BKLET008
.
          MOVE      Z70,BOKLS001
          MOVE      Z70,BOKLS002
          MOVE      Z70,BOKLS003
          MOVE      Z70,BOKLS004
          MOVE      Z70,BOKLS005
          MOVE      Z70,BOKLS006
          MOVE      Z70,BOKLS007
.
          MOVE      Z70,EMTRF001
          MOVE      Z70,EMTRF002
          MOVE      Z70,EMTRF003
          MOVE      Z70,EMTRF004
          MOVE      ZERO,EMTRF005
          MOVE      Z70,EMTRF006
          MOVE      Z70,EMTRF007
.
          MOVE      SP70,NEXTFKEY
          MOVE      SP70,PREVFKEY
          MOVE      ZERO,PRVFFLAG
          MOVE      SP70,FDRGYEAR
          MOVE      ZERO,INCRYEAR
          MOVE      SP70,FILTACTV
          MOVE      SP70,FILTHGRP
          MOVE      SP70,SETHLINV
          MOVE      SP70,CLRHLINV
          MOVE      ZERO,HOSPCNTR
          MOVE      ZERO,ALLHFLAG
          MOVE      SP70,EFFTDATE
.
          PACK      PAGETITL,SP70,SP70
          MOVE      SP70,DRGRTYPE
          MOVE      SP70,DRGKYVAL
          MOVE      SP70,DRGVERNO
          MOVE      SP70,DRGVERST
          MOVE      SP70,DRGFRDAT
          MOVE      SP70,DRGTODAT
          MOVE      SP70,DRGHFCOD
          MOVE      SP70,DRGCLCOD
          MOVE      SP70,DRGSTCOD
          MOVE      SP70,DRGUPDAT
          CALL      CPWL0000           * Effective DRG Version
          CALL      CPTFHI00           * HF On Hold Invoice
          CALL      CPTFNX00           * HF MV hours
.
          CALL      CPVSC000
          CALL      CPVST000       
          CALL      CPVSM000
          CALL      CPPMHA00
. 
          MOVE      ZERO,NOALLOPT      * Dispaly all option
          MOVE      SP70,DDRGCODE
.
CLRPAR99  RETURN
+
.------------------------------------------------------------
. Set Parameters
.------------------------------------------------------------
SETPAR00  MATCH     "reportno=",QRYNAME
          IF        @EQUAL
            MOVE      QRYDATA,REPORTNO
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "template=",QRYNAME
          IF        @EQUAL
            MOVE      QRYDATA,TEMPLATE
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "updttype=",QRYNAME
          IF        @EQUAL
            MOVE      QRYDATA,UPDTTYPE
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "viewopts=",QRYNAME
          IF        @EQUAL
            MOVE      QRYDATA,VIEWOPTS
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "insuranc=",QRYNAME
          IF        @EQUAL
            MOVE      QRYDATA,INSURANC
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "contrcod=",QRYNAME
          IF        @EQUAL
            MOVE      QRYDATA,CONTRCOD
            PACK      CONTRCOD,CONTRCOD,SP70
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "claimcod=",QRYNAME
          IF        @EQUAL
            MOVE      QRYDATA,CLAIMCOD
            PACK      CLAIMCOD,CLAIMCOD,SP70
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "bedtypes=",QRYNAME
          IF        @EQUAL
            MOVE      QRYDATA,BEDTYPES
            PACK      BEDTYPES,BEDTYPES,SP70
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "admissty=",QRYNAME
          IF        @EQUAL
            MOVE      QRYDATA,ADMISSTY
            PACK      ADMISSTY,ADMISSTY,SP70
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "tabletyp=",QRYNAME
          IF        @EQUAL
            MOVE      QRYDATA,TABLETYP
            PACK      TABLETYP,TABLETYP,SP70
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "nextpage=",QRYNAME
          IF        @EQUAL
            MOVE      QRYDATA,NEXTPAGE
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "startkey=",QRYNAME
          IF        @EQUAL
            MOVE      QRYDATA,STARTKEY
            PACK      STARTKEY,STARTKEY,SP70
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "keywords=",QRYNAME
          IF        @EQUAL
            MOVE      QRYDATA,KEYWORDS
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "redirect=",QRYNAME
          IF        @EQUAL
            MOVE      QRYDATA,REDIRECT
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "norecord=",QRYNAME
          IF        @EQUAL
            MOVE      QRYDATA,NORECORD
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "startnum=",QRYNAME
          IF        @EQUAL
            MOVE      QRYDATA,STARTNUM
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "hfgrp001=",QRYNAME
          IF        @EQUAL
            MOVE      QRYDATA,HFGRP001
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "hfgrp002=",QRYNAME
          IF        @EQUAL
            MOVE      QRYDATA,HFGRP002
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "hfgrp003=",QRYNAME
          IF        @EQUAL
            MOVE      QRYDATA,HFGRP003
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "hfund",QRYNAME
          IF        @EQUAL
            CALL      STHFND00
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "fnext",QRYNAME
          IF        @EQUAL
            CALL      STHFNX00
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "hfext",QRYNAME
          IF        @EQUAL
            CALL      STHFEX00
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "pmsle",QRYNAME
          IF        @EQUAL
            CALL      SPPMLE00
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "pmdlt",QRYNAME
          IF        @EQUAL
            CALL      SPPMD000
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "pmsfl",QRYNAME
          IF        @EQUAL
            CALL      SPPMFL00
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "otal0",QRYNAME
          IF        @EQUAL
            CALL      SPOTAL00
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "prrm0",QRYNAME
          IF        @EQUAL
            CALL      SPPRRM00    
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "prgl0",QRYNAME
          IF        @EQUAL
            CALL      SPPRGL00    
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "prfl0",QRYNAME
          IF        @EQUAL
            CALL      SPPRFL00    
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "hftab",QRYNAME
          IF        @EQUAL
            CALL      STBFND00
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "ptfmo",QRYNAME
          IF        @EQUAL
            CALL      STFMO000
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "ptalw",QRYNAME
          IF        @EQUAL
            CALL      STALW000
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "ptvst",QRYNAME
          IF        @EQUAL
            CALL      STVST000
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "ptvsc",QRYNAME
          IF        @EQUAL
            CALL      STVSC000
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "ptvmt",QRYNAME
          IF        @EQUAL
            CALL      STVMT000
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "ptins",QRYNAME
          IF        @EQUAL
            CALL      STINS000
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "ptlecomm=",QRYNAME
          IF        @EQUAL
            CALL      GLTEXT00
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "ptlet",QRYNAME
          IF        @EQUAL
            CALL      STLET000
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "ptdrg",QRYNAME
          IF        @EQUAL
            CALL      STDRG000
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "ptyer",QRYNAME
          IF        @EQUAL
            CALL      STYER000
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "vyearcho=",QRYNAME
          IF        @EQUAL
            MOVE      QRYDATA,VYEARCHO
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "frstdate=",QRYNAME
          IF        @EQUAL
            MOVE      QRYDATA,FRSTDATE
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "cmxfkeys=",QRYNAME
          IF        @EQUAL
            MOVE      QRYDATA,CMXFKEYS
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "cmxls",QRYNAME
          IF        @EQUAL
            UNPACK    QRYNAME,KEY5,KEY3
            MOVE      ZERO,F3
            MOVE      KEY3,F3
            STORE     QRYDATA,F3,CMXLS001,CMXLS002,CMXLS003,CMXLS004,CMXLS005
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "cmxad",QRYNAME
          IF        @EQUAL
            UNPACK    QRYNAME,KEY5,KEY3
            MOVE      ZERO,F3
            MOVE      KEY3,F3
            STORE     QRYDATA,F3,CMXAD001,CMXAD002,CMXAD003,CMXAD004,CMXAD005
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "pmsls001=",QRYNAME
          IF        @EQUAL
            SQUEEZE   QRYDATA
            MOVE      QRYDATA,PMSLS001
            PACK      PMSLS001,PMSLS001,SP70
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "pmsls002=",QRYNAME
          IF        @EQUAL
            MOVE      QRYDATA,PMSLS002
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "pmsls003=",QRYNAME
          IF        @EQUAL
            MOVE      QRYDATA,PMSLS003
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "pmlls001=",QRYNAME
          IF        @EQUAL
            SQUEEZE   QRYDATA
            MOVE      QRYDATA,PMLLS001
            PACK      PMLLS001,PMLLS001,SP70
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "pmlls002=",QRYNAME
          IF        @EQUAL
            MOVE      QRYDATA,PMLLS002
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "pmlls003=",QRYNAME
          IF        @EQUAL
            MOVE      QRYDATA,PMLLS003
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "prigl001=",QRYNAME
          IF        @EQUAL
            SQUEEZE   QRYDATA
            MOVE      QRYDATA,PRIGL001
            PACK      PRIGL001,PRIGL001,SP70
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "prigl002=",QRYNAME
          IF        @EQUAL
            MOVE      QRYDATA,PRIGL002
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "prigl003=",QRYNAME
          IF        @EQUAL
            MOVE      QRYDATA,PRIGL003
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "prigl004=",QRYNAME
          IF        @EQUAL
            MOVE      QRYDATA,PRIGL004
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "prigl005=",QRYNAME
          IF        @EQUAL
            MOVE      QRYDATA,PRIGL005
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "prirl001=",QRYNAME
          IF        @EQUAL
            MOVE      QRYDATA,PRIRL001
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "prirl002=",QRYNAME
          IF        @EQUAL
            MOVE      QRYDATA,PRIRL002
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "prirl003=",QRYNAME
          IF        @EQUAL
            MOVE      QRYDATA,PRIRL003
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "prifl001=",QRYNAME
          IF        @EQUAL
            SQUEEZE   QRYDATA
            MOVE      QRYDATA,PRIFL001
            PACK      PRIFL001,PRIFL001,SP70
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "prifl002=",QRYNAME
          IF        @EQUAL
            MOVE      QRYDATA,PRIFL002
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "prifl003=",QRYNAME
          IF        @EQUAL
            MOVE      QRYDATA,PRIFL003
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "prifl004=",QRYNAME
          IF        @EQUAL
            MOVE      QRYDATA,PRIFL004
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "prifl005=",QRYNAME
          IF        @EQUAL
            MOVE      QRYDATA,PRIFL005
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "invmsgcd=",QRYNAME
          IF        @EQUAL
            MOVE      QRYDATA,INVMSGCD
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "invmsgl1=",QRYNAME
          IF        @EQUAL
            MOVE      QRYDATA,INVMSGL1
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "invmsgl2=",QRYNAME
          IF        @EQUAL
            MOVE      QRYDATA,INVMSGL2
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "incmsgsy=",QRYNAME
          IF        @EQUAL
            MOVE      QRYDATA,INCMSGSY
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "incmsgcd=",QRYNAME
          IF        @EQUAL
            MOVE      QRYDATA,INCMSGCD
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "incmsgl1=",QRYNAME
          IF        @EQUAL
            MOVE      QRYDATA,INCMSGL1
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "incmsgl2=",QRYNAME
          IF        @EQUAL
            MOVE      QRYDATA,INCMSGL2
            GOTO      SETPAR99
          ENDIF
.
. outpatient charges maintenance
.
          MATCH     "ptnip001=",QRYNAME
          IF        @EQUAL
            MOVE      QRYDATA,PTNIP001
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "ptnip002=",QRYNAME
          IF        @EQUAL
            MOVE      QRYDATA,PTNIP002
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "ptnip003=",QRYNAME
          IF        @EQUAL
            MOVE      QRYDATA,PTNIP003
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "ptnip004=",QRYNAME
          IF        @EQUAL
            MOVE      QRYDATA,PTNIP004
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "ptnip005=",QRYNAME
          IF        @EQUAL
            MOVE      QRYDATA,PTNIP005
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "ptnip006=",QRYNAME
          IF        @EQUAL
            MOVE      QRYDATA,PTNIP006
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "ptnip007=",QRYNAME
          IF        @EQUAL
            MOVE      QRYDATA,PTNIP007
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "ptnip008=",QRYNAME
          IF        @EQUAL
            MOVE      QRYDATA,PTNIP008
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "fltclnic=",QRYNAME
          IF        @EQUAL
            MOVE      QRYDATA,FLTCLNIC
            PACK      FLTCLNIC,FLTCLNIC,SP70
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "fltresid=",QRYNAME
          IF        @EQUAL
            MOVE      QRYDATA,FLTRESID
            PACK      FLTRESID,FLTRESID,SP70
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "fltcompe=",QRYNAME
          IF        @EQUAL
            MOVE      QRYDATA,FLTCOMPE
            PACK      FLTCOMPE,FLTCOMPE,SP70
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "flttriag=",QRYNAME
          IF        @EQUAL
            MOVE      QRYDATA,FLTTRIAG
            PACK      FLTTRIAG,FLTTRIAG,SP70
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "fltattnd=",QRYNAME
          IF        @EQUAL
            MOVE      QRYDATA,FLTATTND
            PACK      FLTATTND,FLTATTND,SP70
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "otla0001=",QRYNAME
          IF        @EQUAL
            MOVE      QRYDATA,OTLA0001
            GOTO      SETPAR99
          ENDIF

          MATCH     "otla0002=",QRYNAME
          IF        @EQUAL
            MOVE      QRYDATA,OTLA0002
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "ptflt",QRYNAME
          IF        @EQUAL
            CALL      STFLT000
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "prlet",QRYNAME
          IF        @EQUAL
            UNPACK    QRYNAME,KEY5,KEY3
            MOVE      ZERO,F3
            MOVE      KEY3,F3
            STORE     QRYDATA,F3,PRLET001,PRLET002,PRLET003,PRLET004,PRLET005:
                                 PRLET006
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "prflt",QRYNAME
          IF        @EQUAL
            CALL      STPRF000
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "bklet",QRYNAME
          IF        @EQUAL
            CALL      STBLT000
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "bokls",QRYNAME
          IF        @EQUAL
            CALL      STBLS000
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "emtrf",QRYNAME
          IF        @EQUAL
            CALL      STTRF000
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "nextfkey=",QRYNAME
          IF        @EQUAL
            MOVE      QRYDATA,NEXTFKEY
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "prevfkey=",QRYNAME
          IF        @EQUAL
            MOVE      QRYDATA,PREVFKEY
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "prvfflag=",QRYNAME
          IF        @EQUAL
            MOVE      QRYDATA,PRVFFLAG
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "fdrgyear=",QRYNAME
          IF        @EQUAL
            MOVE      QRYDATA,FDRGYEAR
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "incryear=",QRYNAME
          IF        @EQUAL
            MOVE      QRYDATA,INCRYEAR
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "pmdsl001=",QRYNAME
          IF        @EQUAL
            PACK      PMDSL001,QRYDATA,SP70
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "pmdsl002=",QRYNAME
          IF        @EQUAL
            PACK      PMDSL002,QRYDATA,SP70
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "pmdsl003=",QRYNAME
          IF        @EQUAL
            PACK      PMDSL003,QRYDATA,SP70
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "filtatyp=",QRYNAME
          IF        @EQUAL
            PACK      FILTATYP,QRYDATA,SP70
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "filtclam=",QRYNAME
          IF        @EQUAL
            PACK      FILTCLAM,QRYDATA,SP70
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "filttabt=",QRYNAME
          IF        @EQUAL
            PACK      FILTTABT,QRYDATA,SP70
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "filtfund=",QRYNAME
          IF        @EQUAL
            PACK      FILTFUND,QRYDATA,SP70
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "menuflag=",QRYNAME
          IF        @EQUAL
            PACK      MENUFLAG,QRYDATA,SP70
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "pmhpg",QRYNAME
          IF        @EQUAL
            CALL      STHPG000
            GOTO      SETPAR99
          ENDIF     
.
          MATCH     "pmhpo",QRYNAME
          IF        @EQUAL
            CALL      STHPO000
            GOTO      SETPAR99
          ENDIF     
.
          MATCH     "filtactv=",QRYNAME
          IF        @EQUAL
            PACK      FILTACTV,QRYDATA,SP70
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "filthgrp=",QRYNAME
          IF        @EQUAL
            PACK      FILTHGRP,QRYDATA,SP70
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "drgrtype=",QRYNAME
          IF        @EQUAL
            MOVE      QRYDATA,DRGRTYPE
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "drgkyval=",QRYNAME
          IF        @EQUAL
            PACK      DRGKYVAL,QRYDATA,SP70
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "drgverno=",QRYNAME
          IF        @EQUAL
            MOVE      QRYDATA,DRGVERNO
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "drgfrdat=",QRYNAME
          IF        @EQUAL
            MOVE      QRYDATA,DRGFRDAT
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "drgtodat=",QRYNAME
          IF        @EQUAL
            MOVE      QRYDATA,DRGTODAT
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "drghfcod=",QRYNAME
          IF        @EQUAL
            PACK      DRGHFCOD,QRYDATA,SP70
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "drgclcod=",QRYNAME
          IF        @EQUAL
            PACK      DRGCLCOD,QRYDATA,SP70
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "drgstcod=",QRYNAME
          IF        @EQUAL
            PACK      DRGSTCOD,QRYDATA,SP70
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "drgupdat=",QRYNAME
          IF        @EQUAL
            PACK      DRGUPDAT,QRYDATA,SP70
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "pmsed",QRYNAME
          IF        @EQUAL
            CALL      SPMED000
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "filtvact=",QRYNAME
          IF        @EQUAL
            PACK      FILTVACT,QRYDATA,SP70
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "filtvsid=",QRYNAME
          IF        @EQUAL
            PACK      FILTVSID,QRYDATA,SP70
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "filtvscd=",QRYNAME
          IF        @EQUAL
            PACK      FILTVSCD,QRYDATA,SP70
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "filtvspt=",QRYNAME
          IF        @EQUAL
            PACK      FILTVSPT,QRYDATA,SP70
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "maptbnam=",QRYNAME
          IF        @EQUAL
            PACK      MAPTBNAM,QRYDATA,SP70
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "maptbind=",QRYNAME
          IF        @EQUAL
            PACK      MAPTBIND,QRYDATA,SP70
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "maptbvsi=",QRYNAME
          IF        @EQUAL
            PACK      MAPTBVSI,QRYDATA,SP70
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "sethlinv=",QRYNAME
          IF        @EQUAL
            PACK      SETHLINV,QRYDATA,SP70
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "clrhlinv=",QRYNAME
          IF        @EQUAL
            PACK      CLRHLINV,QRYDATA,SP70
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "ptfhi",QRYNAME
          IF        @EQUAL
            CALL      SPTFHI00
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "efftdate=",QRYNAME
          IF        @EQUAL
            UNPACK    QRYDATA,CDAY,KEY1,MTHNAM3,KEY1,CCENT,CYEAR
            CALL      SETMTH00            * Set CMON from MTHNAM3
            PACK      EFFTDATE,CCENT,CYEAR,CMON,CDAY,SP70
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "multhosp=",QRYNAME
          IF        @EQUAL
            ADD       ONE,MULTHCNT
            PACK      MULTHOSP[MULTHCNT],QRYDATA,SP70
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "ptddh",QRYNAME
          IF        @EQUAL
            CALL      SPPTD000
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "hffldtyp=",QRYNAME
          IF        @EQUAL
            MOVE      QRYDATA,HFFLDTYP
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "remoteno=",QRYNAME
          IF        @EQUAL
            MOVE      QRYDATA,REMOTENO
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "pmhat",QRYNAME
          IF        @EQUAL
            CALL      SPHAT000
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "ddrgcode=",QRYNAME
          IF        @EQUAL
            MOVE      QRYDATA,DDRGCODE
            GOTO      SETPAR99
          ENDIF
.
SETPAR99  RETURN
+
.------------------------------------------------------------
. Get Text 
.------------------------------------------------------------
GLTEXT00  ADD       ONE,PTLEEND
          PACK      PTLECOMN[PTLEEND],QRYDATA,SP70 * Input Note to Array
.
GLTEXT10  READ      CONFFILE,SEQ;QRYNAME,QRYDATA * Read CONFFILE sequentially
          GOTO      GLTEXT99 IF OVER             * If end of file
          MATCH     SP70,QRYNAME                 * If next CGI parameter
          GOTO      GLTEXT80 IF NOT EQUAL
          ADD       ONE,PTLEEND                    * Increment Array Counter
          PACK      PTLECOMN[PTLEEND],QRYDATA,SP70 * Input Note to Array
          GOTO      GLTEXT10
.
GLTEXT80  MOVE      ONE,TEXTAREA                 * Flag for Next CGI Parameter
.
GLTEXT99  RETURN
.-------------------------------------------------------------------------------
.  Set Parameters Patient Letters
.-------------------------------------------------------------------------------
STLET000  UNPACK    QRYNAME,KEY5,KEY3
          MOVE      ZERO,F3
          MOVE      KEY3,F3
          STORE     QRYDATA,F3,PTLET001,PTLET002,PTLET003,PTLET004,PTLET005:
                               PTLET006,PTLET007,PTLET008,PTLET009,PTLET010
          RETURN
.-------------------------------------------------------------------------------
.  Set Parameters for Health Fund Maintenance 
.-------------------------------------------------------------------------------
STHFND00  MOVE      ZERO,EXIT
          UNPACK    QRYNAME,KEY5,KEY3
          MOVE      KEY3,F3
          BRANCH    F3,STHFND01,STHFND02,STHFND03,STHFND04,STHFND05,STHFND06:
                       STHFND07,STHFND08,STHFND09,STHFND10,STHFND11,STHFND12:
                       STHFND13,STHFND14,STHFND15,STHFND16,STHFND17,STHFND18:
                       STHFND19,STHFND20,STHFND21,STHFND22,STHFND23,STHFND24:
                       STHFND25,STHFND26,STHFND27,STHFND28,STHFND29
.
          GOTO      STHFND99
.
STHFND01  SQUEEZE   QRYDATA
          MOVE      QRYDATA,HFUND001
          PACK      HFUND001,HFUND001,SP70
          GOTO      STHFND99
.
STHFND02  MOVE      QRYDATA,HFUND002
          GOTO      STHFND99
.
STHFND03  MOVE      QRYDATA,HFUND003
          GOTO      STHFND99
.
STHFND04  MOVE      QRYDATA,HFUND004
          GOTO      STHFND99
.
STHFND05  MOVE      QRYDATA,HFUND005
          GOTO      STHFND99
.
STHFND06  MOVE      QRYDATA,HFUND006
          GOTO      STHFND99
.
STHFND07  MOVE      QRYDATA,HFUND007
          GOTO      STHFND99
.
STHFND08  MOVE      QRYDATA,HFUND008
          GOTO      STHFND99
.
STHFND09  MOVE      QRYDATA,HFUND009
          GOTO      STHFND99
.
STHFND10  MOVE      QRYDATA,HFUND010
          GOTO      STHFND99
.
STHFND11  MOVE      QRYDATA,HFUND011
          GOTO      STHFND99
.
STHFND12  CALL      GETEXT00 
          GOTO      STHFND99
.
STHFND13  MOVE      QRYDATA,HFUND013
          GOTO      STHFND99
.
STHFND14  MOVE      QRYDATA,HFUND014
          GOTO      STHFND99
.
STHFND15  MOVE      QRYDATA,HFUND015
          GOTO      STHFND99
.
STHFND16  MOVE      QRYDATA,HFUND016
          GOTO      STHFND99
.
STHFND17  MOVE      QRYDATA,HFUND017
          GOTO      STHFND99
.
STHFND18  MOVE      QRYDATA,HFUND018
          GOTO      STHFND99
.
STHFND19  MOVE      QRYDATA,HFUND019
          GOTO      STHFND99
.
STHFND20  MOVE      QRYDATA,HFUND020
          GOTO      STHFND99
.
STHFND21  MOVE      QRYDATA,HFUND021
          GOTO      STHFND99
.
STHFND22  MOVE      QRYDATA,HFUND022
          GOTO      STHFND99
.
STHFND23  MOVE      QRYDATA,HFUND023
          GOTO      STHFND99
.
STHFND24  MOVE      QRYDATA,HFUND024
          GOTO      STHFND99
.
STHFND25  MOVE      QRYDATA,HFUND025
          GOTO      STHFND99
.                                                                   Car 273294
STHFND26  MOVE      QRYDATA,HFUND026
          GOTO      STHFND99
.
STHFND27  MOVE      QRYDATA,HFUND027
          GOTO      STHFND99
.
STHFND28  MOVE      QRYDATA,HFUND028
          GOTO      STHFND99
.
STHFND29  MOVE      QRYDATA,HFUND029
          GOTO      STHFND99
.
STHFND99  RETURN
+
.-------------------------------------------------------------------------------
.  Set Parameters for Health Fund Maintenance 
.-------------------------------------------------------------------------------
STHFEX00  MOVE      ZERO,EXIT
          UNPACK    QRYNAME,KEY5,KEY3
          MOVE      KEY3,F3
          BRANCH    F3,STHFEX01,STHFEX02,STHFEX03,STHFEX04,STHFEX05:
                       STHFEX06,STHFEX07,STHFEX08,STHFEX09,STHFEX10:
                       STHFEX11,STHFEX12,STHFEX13,STHFEX14,STHFEX15:
                       STHFEX16,STHFEX17,STHFEX18,STHFEX19,STHFEX20:
                       STHFEX21
.
          GOTO      STHFEX99
.
STHFEX01  SQUEEZE   QRYDATA
          MOVE      QRYDATA,HFEXT001
          PACK      HFEXT001,HFEXT001,SP70
          GOTO      STHFEX99
.
STHFEX02  MOVE      QRYDATA,HFEXT002
          GOTO      STHFEX99
.
STHFEX03  MOVE      QRYDATA,HFEXT003
          GOTO      STHFEX99
.
STHFEX04  MOVE      QRYDATA,HFEXT004
          PACK      HFEXT004,HFEXT004,SP70
          GOTO      STHFEX99
.
STHFEX05  MOVE      QRYDATA,HFEXT005
          PACK      HFEXT005,HFEXT005,SP70
          GOTO      STHFEX99
.
STHFEX06  MOVE      QRYDATA,HFEXT006
          GOTO      STHFEX99
.
STHFEX07  MOVE      QRYDATA,HFEXT007
          GOTO      STHFEX99
.
STHFEX08  MOVE      QRYDATA,HFEXT008
          GOTO      STHFEX99
.
STHFEX09  MOVE      QRYDATA,HFEXT009
          GOTO      STHFEX99
.
STHFEX10  MOVE      QRYDATA,HFEXT010
          GOTO      STHFEX99
.
STHFEX11  MOVE      QRYDATA,HFEXT011
          GOTO      STHFEX99
.
STHFEX12  MOVE      QRYDATA,HFEXT012
          GOTO      STHFEX99
.
STHFEX13  MOVE      QRYDATA,HFEXT013
          GOTO      STHFEX99
.
STHFEX14  MOVE      QRYDATA,HFEXT014
          GOTO      STHFEX99
.
STHFEX15  MOVE      QRYDATA,HFEXT015
          GOTO      STHFEX99
.
STHFEX16  MOVE      QRYDATA,HFEXT016
          GOTO      STHFEX99
.
STHFEX17  MOVE      QRYDATA,HFEXT017
          GOTO      STHFEX99
.
STHFEX18  MOVE      QRYDATA,HFEXT018
          GOTO      STHFEX99
.
STHFEX19  UNPACK    QRYDATA,CDAY,KEY1,MTHNAM3,KEY1,CCENT,CYEAR
          CALL      SETMTH00            * Set CMON from MTHNAM3
          PACK      HFEXT019,CCENT,CYEAR,CMON,CDAY,SP70
          GOTO      STHFEX99
.
STHFEX20  MOVE      QRYDATA,HFEXT020
          GOTO      STHFEX99
.
STHFEX21  MOVE      QRYDATA,HFEXT021
          GOTO      STHFEX99
.
STHFEX99  RETURN
.-------------------------------------------------------------------------------
.  Set Parameters for Financial Letters
.-------------------------------------------------------------------------------
STFLT000  UNPACK    QRYNAME,KEY5,KEY3
          MOVE      ZERO,F3
          MOVE      KEY3,F3
          STORE     QRYDATA,F3,PTFLT001,PTFLT002,PTFLT003,PTFLT004,PTFLT005:
                               PTFLT006,PTFLT007
          RETURN
+
.-------------------------------------------------------------------------------
.  Set Parameters for Private Practice Financial Letters
.-------------------------------------------------------------------------------
STPRF000  UNPACK    QRYNAME,KEY5,KEY3
          MOVE      ZERO,F3
          MOVE      KEY3,F3
          STORE     QRYDATA,F3,PRFLT001,PRFLT002,PRFLT003,PRFLT004,PRFLT005:
                               PRFLT006
STPRF999  RETURN
+
.-------------------------------------------------------------------------------
.  Set Parameters for Booking Letters
.-------------------------------------------------------------------------------
STBLT000  UNPACK    QRYNAME,KEY5,KEY3
          MOVE      ZERO,F3
          MOVE      KEY3,F3
          STORE     QRYDATA,F3,BKLET001,BKLET002,BKLET003,BKLET004,BKLET005:
                               BKLET006,BKLET007,BKLET008
STBLT999  RETURN
+
.-------------------------------------------------------------------------------
.  Set Parameters for Booking Letters Selection Criteria
.-------------------------------------------------------------------------------
STBLS000  UNPACK    QRYNAME,KEY5,KEY3
          MOVE      ZERO,F3
          MOVE      KEY3,F3
          BRANCH    F3,STBLS010,STBLS020,STBLS030,STBLS040,STBLS050:
                       STBLS060,STBLS070
          GOTO      STBLS999
.
STBLS010  PACK      BOKLS001,QRYDATA,SP70
          GOTO      STBLS999
.
STBLS020  PACK      BOKLS002,QRYDATA,SP70
          GOTO      STBLS999
.
STBLS030  PACK      BOKLS003,QRYDATA,SP70
          GOTO      STBLS999
.
STBLS040  MATCH     SP70,QRYDATA    
          IF        @EQUAL
            MOVE      SP70,BOKLS004
          ELSE
            UNPACK    QRYDATA,CDAY,KEY1,MTHNAM3,KEY1,CCENT,CYEAR
            CALL      SETMTH00
            PACK      BOKLS004,CCENT,CYEAR,CMON,CDAY
            REP       " 0",BOKLS004
          ENDIF
          GOTO      STBLS999
.
STBLS050  MATCH     SP70,QRYDATA
          IF        @EQUAL
            MOVE      SP70,BOKLS005
          ELSE
            UNPACK    QRYDATA,CDAY,KEY1,MTHNAM3,KEY1,CCENT,CYEAR
            CALL      SETMTH00
            PACK      BOKLS005,CCENT,CYEAR,CMON,CDAY
            REP       " 0",BOKLS005
          ENDIF
          GOTO      STBLS999
.
STBLS060  PACK      BOKLS006,QRYDATA,SP70
          GOTO      STBLS999
.
STBLS070  PACK      BOKLS007,QRYDATA,SP70
          GOTO      STBLS999
.
STBLS999  RETURN
+
.-------------------------------------------------------------------------------
.  Set Parameters for Emergency Triage Fee
.-------------------------------------------------------------------------------
STTRF000  UNPACK    QRYNAME,KEY5,KEY3
          MOVE      ZERO,F3
          MOVE      KEY3,F3
          BRANCH    F3,STTRF010,STTRF020,STTRF030,STTRF040,STTRF050:
                       STTRF060,STTRF070
          GOTO      STTRF999
.
STTRF010  PACK      EMTRF001,QRYDATA,SP70
          GOTO      STTRF999
.
STTRF020  PACK      EMTRF002,QRYDATA,SP70
          GOTO      STTRF999
.
STTRF030  UNPACK    QRYDATA,CDAY,KEY1,MTHNAM3,KEY1,CCENT,CYEAR
          CALL      SETMTH00            * Set CMON from MTHNAM3
          PACK      EMTRF003,CCENT,CYEAR,CMON,CDAY
          GOTO      STTRF999
.
STTRF040  PACK      EMTRF004,QRYDATA,SP70
          GOTO      STTRF999
.
STTRF050  MOVE      QRYDATA,EMTRF005
          GOTO      STTRF999
.
STTRF060  PACK      EMTRF006,QRYDATA,SP70
          GOTO      STTRF999
.
STTRF070  PACK      EMTRF007,QRYDATA,SP70
          GOTO      STTRF999
.
STTRF999  RETURN
.------------------------------------------------------------
. Get Text from New Note 
.------------------------------------------------------------
GETEXT00  MOVE      ZERO,F3
          MOVE      ONE,F3
          MOVE      QRYDATA,HFUND012[F3]
          RESET     HFUND012[F3]
.
GETEXT10  READ      CONFFILE,SEQ;QRYNAME,QRYDATA * Read CONFFILE sequentially
          GOTO      GETEXT90 IF OVER             * If end of file
          MATCH     SP70,QRYNAME                 * If next CGI parameter
          GOTO      GETEXT80 IF NOT EQUAL
          ADD       ONE,F3                       * Increment Array Counter
          MOVE      QRYDATA,HFUND012[F3]         * Input Note to Array
          GOTO      GETEXT10
.
GETEXT80  MOVE      ONE,TEXTAREA                 * Flag for Next CGI Parameter
GETEXT90  MOVE      F3,LASTITEM                  * Set length of FF Note
GETEXT99  RETURN
.-------------------------------------------------------------------------------
.  Set Parameters for Health Fund Table Maintenance  
.-------------------------------------------------------------------------------
STBFND00  MOVE      ZERO,EXIT
          UNPACK    QRYNAME,KEY5,KEY3
          MOVE      KEY3,F3
          BRANCH    F3,STBFND01,STBFND02,STBFND03,STBFND04,STBFND05,STBFND06:
                       STBFND07,STBFND08,STBFND09
.
          GOTO      STBFND99
.
STBFND01  SQUEEZE   QRYDATA
          MOVE      QRYDATA,HFTAB001
          REP       "+ ",HFTAB001
          PACK      HFTAB001,HFTAB001,SP70
          GOTO      STBFND99
.
STBFND02  SQUEEZE   QRYDATA
          MOVE      QRYDATA,HFTAB002
          PACK      HFTAB002,HFTAB002,SP70
          GOTO      STBFND99
.
STBFND03  MOVE      QRYDATA,HFTAB003
          GOTO      STBFND99
.
STBFND04  MOVE      QRYDATA,HFTAB004
          GOTO      STBFND99
.
STBFND05  MOVE      QRYDATA,HFTAB005
          GOTO      STBFND99
.
STBFND06  MOVE      QRYDATA,HFTAB006
          GOTO      STBFND99
.
STBFND07  MOVE      QRYDATA,HFTAB007
          GOTO      STBFND99
.
STBFND08  MOVE      QRYDATA,HFTAB008
          GOTO      STBFND99
.
STBFND09  MOVE      QRYDATA,HFTAB009
          GOTO      STBFND99
.
STBFND99  RETURN
.-------------------------------------------------------------------------------
.  Set Parameters for Patient Moeity Table Maintenance
.-------------------------------------------------------------------------------
STFMO000  MOVE      ZERO,EXIT
          UNPACK    QRYNAME,KEY5,KEY3
          MOVE      KEY3,F3
          BRANCH    F3,STFMO001,STFMO002,STFMO003
          GOTO      STFMO999
.
STFMO001  MOVE      QRYDATA,PTFMO001
          GOTO      STFMO999
.
STFMO002  MOVE      QRYDATA,PTFMO002
          GOTO      STFMO999
.
STFMO003  MOVE      QRYDATA,PTFMO003
          GOTO      STFMO999
.
STFMO999  RETURN
+
.-------------------------------------------------------------------------------
.  Set Parameters for Allowance Code Maintenance  
.-------------------------------------------------------------------------------
STALW000  MOVE      ZERO,EXIT
          UNPACK    QRYNAME,KEY5,KEY3
          MOVE      KEY3,F3
          BRANCH    F3,STALW001,STALW002,STALW003
.
          GOTO      STALW999
.
STALW001  SQUEEZE   QRYDATA
          MOVE      QRYDATA,PTALW001
          PACK      PTALW001,PTALW001,SP70
          GOTO      STALW999
.
STALW002  MOVE      QRYDATA,PTALW002
          GOTO      STALW999
.
STALW003  SQUEEZE   QRYDATA
          MOVE      QRYDATA,PTALW003
          GOTO      STALW999
.
STALW999  RETURN
.-------------------------------------------------------------------------------
.  Set Parameters for Insurance Code Maintenance  
.-------------------------------------------------------------------------------
STINS000  MOVE      ZERO,EXIT
          UNPACK    QRYNAME,KEY5,KEY3
          MOVE      KEY3,F3
          BRANCH    F3,STINS001,STINS002,STINS003,STINS004,STINS005,STINS006:
                       STINS007,STINS008,STINS009,STINS010,STINS011,STINS012:
                       STINS013,STINS014,STINS015,STINS016,STINS017,STINS018:
                       STINS019,STINS020,STINS021
.
          GOTO      STINS999
.
STINS001  SQUEEZE   QRYDATA
          MOVE      QRYDATA,PTINS001
          REP       "+ ",PTINS001
          PACK      PTINS001,PTINS001,SP70
          GOTO      STINS999
.
STINS002  MOVE      QRYDATA,PTINS002
          GOTO      STINS999
.
STINS003  MOVE      QRYDATA,PTINS003
          GOTO      STINS999
.
STINS004  MOVE      QRYDATA,PTINS004
          GOTO      STINS999
.
STINS005  MOVE      QRYDATA,PTINS005
          GOTO      STINS999
.
STINS006  MOVE      QRYDATA,PTINS006
          GOTO      STINS999
.
STINS007  MOVE      QRYDATA,PTINS007
          GOTO      STINS999
.
STINS008  MOVE      QRYDATA,PTINS008
          GOTO      STINS999
.
STINS009  MOVE      QRYDATA,PTINS009
          GOTO      STINS999
.
STINS010  MOVE      QRYDATA,PTINS010
          GOTO      STINS999
.
STINS011  MOVE      QRYDATA,PTINS011
          GOTO      STINS999
.
STINS012  MOVE      QRYDATA,PTINS012
          GOTO      STINS999
.
STINS013  MOVE      QRYDATA,PTINS013
          GOTO      STINS999
.
STINS014  MOVE      QRYDATA,PTINS014
          GOTO      STINS999
.
STINS015  MOVE      QRYDATA,PTINS015
          GOTO      STINS999
.
STINS016  MOVE      QRYDATA,PTINS016
          GOTO      STINS999
.
STINS017  MOVE      QRYDATA,PTINS017
          GOTO      STINS999
.
STINS018  MOVE      QRYDATA,PTINS018
          GOTO      STINS999
.
STINS019  MOVE      QRYDATA,PTINS019
          GOTO      STINS999
.
STINS020  MOVE      QRYDATA,PTINS020
          GOTO      STINS999
.                                                                   * Car 273294
STINS021  MOVE      QRYDATA,PTINS021
          GOTO      STINS999
.
STINS999  RETURN
.-------------------------------------------------------------------------------
.   Set Parameters - Start of Year Maintanance
.-------------------------------------------------------------------------------
STYER000  MOVE      ZERO,EXIT
          UNPACK    QRYNAME,KEY5,KEY3
          MOVE      KEY3,F3
          BRANCH    F3,STYER001,STYER002
.
          GOTO      STYER999
.
STYER001  SQUEEZE   QRYDATA
          MOVE      QRYDATA,PTYER001
          PACK      PTYER001,PTYER001,SP70
          GOTO      STYER999
STYER002  MOVE      QRYDATA,PTYER002
          GOTO      STYER999
.
STYER999  RETURN
.-------------------------------------------------------------------------------
.   Set Parameters - Period Date Ranges Maintanance
.-------------------------------------------------------------------------------
STDRG000  MOVE      ZERO,EXIT
          UNPACK    QRYNAME,KEY5,KEY3
          MOVE      KEY3,F3
          BRANCH    F3,STDRG001,STDRG002,STDRG003,STDRG004,STDRG005,STDRG006:
                       STDRG007,STDRG008,STDRG009
          GOTO      STDRG999
.
STDRG001  PACK      QRYDATA,QRYDATA,SP30
          UNPACK    QRYDATA,KEY8,KEY3 * Check for formatted or unformatted date
          MATCH     SP70,KEY3
          IF        @EQUAL
            MOVE      QRYDATA,PTDRG001 * Do not change date format = (CCYYMMDD)
          ELSE
            MOVE      QRYDATA,KEY11   * Change Date as format is (DD MON CCYY)
            PACK      KEY11,KEY11,SP70
            MATCH     SP70,KEY11
            IF        !@EQUAL
              UNPACK    QRYDATA,CDAY,KEY1,MTHNAM3,KEY1,CCENT,CYEAR
              CALL      SETMTH00
              PACK      PTDRG001,CCENT,CYEAR,CMON,CDAY
              REP       " 0",PTDRG001
            ENDIF
          ENDIF
          GOTO      STDRG999
.
STDRG002  PACK      QRYDATA,QRYDATA,SP30
          UNPACK    QRYDATA,KEY8,KEY3 * Check for formatted or unformatted date
          MATCH     SP70,KEY3
          IF        @EQUAL
            MOVE      QRYDATA,PTDRG002 * Do not change date format = (CCYYMMDD)
          ELSE
            MOVE      QRYDATA,KEY11   * Change Date as format is (DD MON CCYY)
            PACK      KEY11,KEY11,SP70
            MATCH     SP70,KEY11
            IF        !@EQUAL
              UNPACK    QRYDATA,CDAY,KEY1,MTHNAM3,KEY1,CCENT,CYEAR
              CALL      SETMTH00
              PACK      PTDRG002,CCENT,CYEAR,CMON,CDAY
              REP       " 0",PTDRG002
            ENDIF
          ENDIF
          GOTO      STDRG999
.
STDRG003  MOVE      QRYDATA,PTDRG003
          GOTO      STDRG999
.
STDRG004  MOVE      QRYDATA,PTDRG004
          GOTO      STDRG999
.
STDRG005  MOVE      QRYDATA,PTDRG005
          GOTO      STDRG999
.
STDRG006  MOVE      QRYDATA,PTDRG006
          GOTO      STDRG999
.
STDRG007  MOVE      QRYDATA,PTDRG007
          GOTO      STDRG999
.
STDRG008  MOVE      QRYDATA,PTDRG008
          GOTO      STDRG999
.
STDRG009  MOVE      QRYDATA,PTDRG009
          GOTO      STDRG999
.
STDRG999  RETURN
.-------------------------------------------------------------------------------
. Process Fields called from WEBBOD00
.-------------------------------------------------------------------------------
PROFLD00  BRANCH    REPORTNO,PROFLD10,PROFLD20,PROFLD30,PROFLD40,PROFLD50:
                             PROFLD60,PROFLD70,PROFLD80,PROFLD90,PROFL100:
                             PROFL110,PROFL120,PROFLD99,PROFL140,PROFL150:
                             PROFL160,PROFLD99,PROFL180,PROFL190,PROFLD99:
                             PROFL210,PROFL220,PROFLD99,PROFL240,PROFL250:
                             PROFLD99,PROFL270,PROFL280,PROFLD99,PROFL290:
                             PROFL300,PROFL310,PROFL320,PROFL340,PROFL350:
                             PROFL360,PROFL370,PROFL380,PROFLD99,PROFL400:
                             PROFL410,PROFLD99,PROFL430,PROFL440,PROFL450:
                             PROFL460,PROFLD99,PROFL480,PROFL490,PROFL500:
                             PROFL510,PROFL520,PROFL530,PROFLD99,PROFLD99:
                             PROFL560
.
          GOTO      PROFLD99
.
. Health Fund Group Maintenance
.
PROFLD10  BRANCH    FLDSETNO,PROFLD11,PROFLD12
          GOTO      PROFLD99
.
PROFLD11  CALL      HGRP0000      * Health Fund Group Maintenance
          GOTO      PROFLD99
.
PROFLD12  CALL      DFHI0000      * Health Fund On Hold invoice
          GOTO      PROFLD99
.
. Health Fund Maintenance
.
PROFLD20  CALL      HFND0000      * Health Fund Maintenance
          GOTO      PROFLD99
.
. Health Fund Table Maintenance
.
PROFLD30  CALL      HTAB0000      * Health Fund Table Maintenance
          GOTO      PROFLD99
.
. Health Fund Table Search
.
PROFLD40  CALL      SHFT0000      * Health Fund Table Search
          GOTO      PROFLD99
.
. Allowance Code Maintenance
.
PROFLD50  CALL      PALW0000      * Allowance Code Maintanance
          GOTO      PROFLD99
.
. Insurance Code Maintenance
.
PROFLD60  CALL      PINS0000      * Insurance Code Maintenance
          GOTO      PROFLD99
.
PROFLD70  CALL      LETF0000      * Letter Details
          GOTO      PROFLD99
.
. Period Date Range Maintenance
.
PROFLD80  BRANCH    FLDSETNO,PROFLD81,PROFLD82
          GOTO      PROFLD99
.
PROFLD81  CALL      DRGD0000      * Period Date Range Details
          GOTO      PROFLD99
.
PROFLD82  CALL      DRGP0000      * Period Date Range Table
          GOTO      PROFLD99
.
. Year Maintanance now redundant
. 
PROFLD90  GOTO      PROFLD99
.
. Casemix Fees
.
PROFL100  BRANCH    FLDSETNO,PROFL101
          GOTO      PROFLD99
.
PROFL101  CALL      CMXA0000      * Casemix Fees
          GOTO      PROFLD99
.
PROFL110  BRANCH    FLDSETNO,PROFL111
          GOTO      PROFLD99
.
PROFL111  CALL      PMLE0000      * Patient letter selection 
          GOTO      PROFLD99
.
PROFL120  BRANCH    FLDSETNO,PROFL121,PROFL122
          GOTO      PROFLD99
.
PROFL121  CALL      PMLE0000      * Patient letter selection
          GOTO      PROFLD99
.
PROFL122  CALL      LSTLTT00      * Patient letter list
          GOTO      PROFLD99
.
. Invoice Message Maintenance
.
PROFL140  CALL      IMSG0000      * Invoice Message Maintenance (patmesgf)
          GOTO      PROFLD99
.
PROFL150  BRANCH    FLDSETNO,PROFL151,PROFL152
          GOTO      PROFLD99
.
PROFL151  CALL      PMFL0000      * Financial letters Maintenance
          GOTO      PROFLD99
.
PROFL152  CALL      MISN0000      * Miscellaneous outputs
          GOTO      PROFLD99
.
PROFL160  BRANCH    FLDSETNO,PROFL161,PROFL162
          GOTO      PROFLD99
.
PROFL161  CALL      PMFL0000      * Financial letter selection
          GOTO      PROFLD99
.
PROFL162  CALL      FANLST00      * Financial letter list
          GOTO      PROFLD99
.
PROFL180  CALL      OTAL0000      * Adhoc Letter Fields 
          GOTO      PROFLD99
.
PROFL190  BRANCH    FLDSETNO,PROFL191,PROFL192
          GOTO      PROFLD99
.
PROFL191  CALL      OTAL0000      * Outpatient Adhoc Letter selection
          GOTO      PROFLD99
.
PROFL192  CALL      OUTADL00      * Outpatient Adhoc Letter Selection list
          GOTO      PROFLD99
.
PROFL210  CALL      PRRM0000      * Reminder Accounts Fields 
          GOTO      PROFLD99
.
PROFL220  BRANCH    FLDSETNO,PROFL221,PROFL222
          GOTO      PROFLD99
.
PROFL221  CALL      PRRM0000      * Private Practice Reminder Account sselection
          GOTO      PROFLD99
.
PROFL222  CALL      PRRLST00      * Pri. Prac. Reminder Account Selection list
          GOTO      PROFLD99
.
PROFL240  CALL      PRGL0000      * General Letter Fields 
          GOTO      PROFLD99
.
PROFL250  BRANCH    FLDSETNO,PROFL251,PROFL252
          GOTO      PROFLD99
.
PROFL251  CALL      PRGL0000      * Private Practice General letter selection
          GOTO      PROFLD99
.
PROFL252  CALL      PRGLST00      * Pri. Prac. General letter Selection list
          GOTO      PROFLD99
.
PROFL270  CALL      PRFL0000      * Private Practice Financial Letter Fields 
          GOTO      PROFLD99
.
PROFL280  BRANCH    FLDSETNO,PROFL281,PROFL282
          GOTO      PROFLD99
.
PROFL281  CALL      PRFL0000      * Private Practice Financial letter selection
          GOTO      PROFLD99
.
PROFL282  CALL      PRFLST00      * Pri. Prac. Financial letter Selection list
          GOTO      PROFLD99
.
.
. Outpatient Charges Maintenance
.
PROFL290  CALL      PNIP0000      * Outpatient Charges Maintenance
          GOTO      PROFLD99
.
. Emergency Charges Maintenance
.
PROFL300  CALL      PNIP0000      * Emergency Charges Maintenance
          GOTO      PROFLD99
.
PROFL310  GOTO      PROFLD99
.
PROFL320  CALL      ICMG0000      * Invoice Message Maintenance (patinmaf)
          GOTO      PROFLD99
.
PROFL340  CALL      PTFL0000      * Financial Letter Maintenance 
          GOTO      PROFLD99
.
PROFL350  CALL      PRLE0000      * Private Practice Set Up General Letter Maint
          GOTO      PROFLD99
.
PROFL360  CALL      PPFL0000      * Private Practice Set Up Financ. Letter Maint
          GOTO      PROFLD99
.
PROFL370  CALL      BKLT0000      * Booking Letter Maintenance 
          GOTO      PROFLD99
.
PROFL380  CALL      BKLS0000      * Print Booking Letter Selection  
          GOTO      PROFLD99
.
PROFL400  CALL      PMDS0000      * Doctors letter selections
          GOTO      PROFLD99
.
PROFL410  BRANCH    FLDSETNO,PROFL411,PROFL412
          GOTO      PROFLD99
.
PROFL411  CALL      PMDS0000      * Doctors letter selections
          GOTO      PROFLD99
.
PROFL412  CALL      PMDL0000      * List Selection hcp details
          GOTO      PROFLD99
.
PROFL430  CALL      EMTF0000      * Emergency Triage Fee
          GOTO      PROFLD99
.
PROFL440  BRANCH    FLDSETNO,PROFL441,PROFL442
          GOTO      PROFLD99
.
PROFL441  CALL      PMHP0000      * Program Management
          GOTO      PROFLD99
.
PROFL442  CALL      GTAG0000      * General Tags
          GOTO      PROFLD99
.
PROFL450  BRANCH    FLDSETNO,PROFL451,PROFL452,PROFL453
          GOTO      PROFLD99
.
PROFL451  CALL      PMHP0000      * Program Management
          GOTO      PROFLD99
.
PROFL452  CALL      PMHO0000      * OP Program Management
          GOTO      PROFLD99
.
PROFL453  CALL      GTAG0000      * General Tags
          GOTO      PROFLD99
.
PROFL460  BRANCH    FLDSETNO,PROFL461,PROFL462
          GOTO      PROFLD99
.
PROFL461  CALL      GTAG0000
          GOTO      PROFLD99
.
PROFL462  CALL      PMED0000
          GOTO      PROFLD99
.
PROFL480  CALL      VSTD0000       * Value Set ID Maintenance
          GOTO      PROFLD99
.
PROFL490  CALL      VSCD0000       * Value Set ID Codes Maintenance
          GOTO      PROFLD99
.
PROFL500  BRANCH    FLDSETNO,PROFL501,PROFL502
          GOTO      PROFLD99
.
PROFL501  CALL      VMPD0000       * Value Mapping Maintenance
          GOTO      PROFLD99
.
PROFL502  CALL      VSCD0000       * Value Set ID Codes Maintenance
          GOTO      PROFLD99
.
PROFL510  BRANCH    FLDSETNO,PROFL511,PROFL512
          GOTO      PROFLD99
.
PROFL511  CALL      DFHI0000
          GOTO      PROFLD99
.
PROFL512  CALL      HLDI0000       * HF On Hold invoice
          GOTO      PROFLD99
.
PROFL520  BRANCH    FLDSETNO,PROFL521,PROFL522
          GOTO      PROFLD99
.
PROFL521  CALL      DFNX0000
          GOTO      PROFLD99
.
PROFL522  CALL      MVHR0000       * HF On Hold invoice
          GOTO      PROFLD99
.
PROFL530  BRANCH    FLDSETNO,PROFL531,PROFL532
          GOTO      PROFLD99
.
PROFL531  CALL      PTDH0000
          GOTO      PROFLD99
.
PROFL532  CALL      HFHT0000
          GOTO      PROFLD99
.
PROFL560  BRANCH    FLDSETNO,PROFL561,PROFL562,PROFL563
          GOTO      PROFLD99
.
PROFL561  CALL      DFNX0000
          GOTO      PROFLD99
.
PROFL562  CALL      PMHA0000             * Hospital Attrivute for CWO MV DRG
          GOTO      PROFLD99
.
PROFL563  CALL      CWOM0000             * CWO MV DRG
          GOTO      PROFLD99
.
PROFLD99  RETURN
+
.------------------------------------------------------------
. Casemix Fees
.------------------------------------------------------------
CMXA0000  BRANCH    FLDITMNO,CMXA0100,CMXA0200,CMXA0300,CMXA0400,CMXA0500:
                             CMXA0600,CMXA0700,CMXA0800,CMXA0900,CMXA1000:
                             CMXA1100,CMXA1200,CMXA1300,CMXA1400,CMXA1500:
                             CMXA1600,CMXA1700,CMXA1800,CMXA1900,CMXA2000
          GOTO      CMXA9999
.
CMXA0100  MOVE      "CL",CATEGORY
          MOVE      PTHLCLMN,CODE
          CALL      CODITM00
          GOTO      HGRP9999
.
CMXA0200  MOVE      PTHLHFND,HFUND001
          CALL      HFNITM00
          GOTO      CMXA9999
.
CMXA0300  MOVE      "HT",CATEGORY
          MOVE      PTHLTABT,CODE
          CALL      CODITM00
          GOTO      CMXA9999
.
CMXA0400  UNPACK    DIM127,ANS,KEY1,DIM127
          MOVE      ZERO,F1
          MOVE      KEY1,F1
          MATCH     SP70,PTHLCASM
          GOTO      CMXA9999 IF EQUAL
          BRANCH    F1,CMXA0410
          PACK      KEY9,PTHLCASM
          CALL      RDPTCMC1
          BRANCH    OVRCD,CMXA9999
          WRITE     HTMLFILE;PTCADES1;
          GOTO      CMXA9999
.
CMXA0410  WRITE     HTMLFILE;PTHLCASM;
          GOTO      CMXA9999
.
CMXA0500  MATCH     SP70,PTHLDES1
          GOTO      CMXA9999 IF EQUAL
          WRITE     HTMLFILE;PTHLDES1;
          GOTO      CMXA9999
.         
CMXA0600  MATCH     SP70,PTHLDES2
          GOTO      CMXA9999 IF EQUAL
          WRITE     HTMLFILE;PTHLDES2;
          GOTO      CMXA9999
.         
CMXA0700  WRITE     HTMLFILE;PTHLLREB;
          GOTO      CMXA9999
.         
CMXA0800  WRITE     HTMLFILE;PTHLLPAT;
          GOTO      CMXA9999
.         
CMXA0900  WRITE     HTMLFILE;PTHLCOFF;
          GOTO      CMXA9999
.         
CMXA1000  WRITE     HTMLFILE;PTHLINVB;
          GOTO      CMXA9999
.         
CMXA1100  WRITE     HTMLFILE;PTHLINVI;
          GOTO      CMXA9999
.
CMXA1200  CALL      CMXAD000
          GOTO      CMXA9999
.         
CMXA1300  MOVE      "BT",CATEGORY
          MOVE      PTADBTYP,CODE
          CALL      CODITM00
          GOTO      HGRP9999
.
CMXA1400  MATCH     SP70,PTADDES1
          GOTO      CMXA9999 IF EQUAL
          WRITE     HTMLFILE;PTADDES1;
          GOTO      CMXA9999
.
CMXA1500  MATCH     SP70,PTADDES2
          GOTO      CMXA9999 IF EQUAL
          WRITE     HTMLFILE;PTADDES2;
          GOTO      CMXA9999
.
CMXA1600  WRITE     HTMLFILE;PTADDREB;
          GOTO      CMXA9999
.         
CMXA1700  WRITE     HTMLFILE;PTADDPAT;
          GOTO      CMXA9999
.
CMXA1800  CALL      PTASD000
          GOTO      CMXA9999
.         
CMXA1900  CALL      PTSRB000
          GOTO      CMXA9999
.         
CMXA2000  CALL      PMSIN000
          GOTO      CMXA9999
.         
CMXA9999  RETURN
.------------------------------------------------------------
. Invoice Message Maintenance (patmesgf) 
.------------------------------------------------------------
IMSG0000  BRANCH    FLDITMNO,IMSG0100,IMSG0200,IMSG0300,IMSG0400,IMSG0500:
                             IMSG0600
          GOTO      IMSG9999
.
IMSG0100  CALL      NEXTMG00      * Link to Next Message
          GOTO      IMSG9999
.
IMSG0200  CALL      PREVMG00      * Link to Last Message
          GOTO      IMSG9999
.
IMSG0300  CALL      IMTAB000      * Table of Invoice Messages   
          GOTO      IMSG9999
.
IMSG0400  WRITE     HTMLFILE;PMCODE;
          GOTO      IMSG9999
.
IMSG0500  WRITE     HTMLFILE;PMLINE1;
          GOTO      IMSG9999
.
IMSG0600  WRITE     HTMLFILE;PMLINE2;
          GOTO      IMSG9999
.
IMSG9999  RETURN
.------------------------------------------------------------
. Invoice Message Maintenance (patinmaf)
.------------------------------------------------------------
ICMG0000  BRANCH    FLDITMNO,ICMG0100,ICMG0200,ICMG0300,ICMG0400,ICMG0500:
                             ICMG0600,ICMG0700,ICMG0800
          GOTO      ICMG9999
.
ICMG0100  CALL      NEXTCM00      * Link to Next Message
          GOTO      ICMG9999
.
ICMG0200  CALL      PREVCM00      * Link to Last Message
          GOTO      ICMG9999
.
ICMG0300  CALL      ICMTB000      * Table of Invoice Messages
          GOTO      ICMG9999
.
ICMG0400  UNPACK    DIM127,D1,KEY1,DIM127
          MOVE      ZERO,F1
          MOVE      KEY1,F1
          BRANCH    F1,ICMG0401
.
          WRITE     HTMLFILE;PTIMSYS;
          GOTO      ICMG9999
.
ICMG0401  IF        PTIMSYS=ONE
            MOVE      "Accident & Emergency",SYSDESC
            WRITE     HTMLFILE;SYSDESC;
            GOTO      ICMG9999
          ENDIF

          IF        PTIMSYS=TWO
            MOVE      "Outpatients         ",SYSDESC
            WRITE     HTMLFILE;SYSDESC;
            GOTO      ICMG9999
          ENDIF
.
          IF        PTIMSYS=THREE
            MOVE      "Inpatients          ",SYSDESC
	    WRITE     HTMLFILE;SYSDESC;
	    GOTO      ICMG9999
          ENDIF
.
          IF        PTIMSYS=FOUR
            MOVE      "Other Financial     ",SYSDESC
            WRITE     HTMLFILE;SYSDESC;
            GOTO      ICMG9999
          ENDIF

          MOVE    "Invalid System      ",SYSDESC
          WRITE     HTMLFILE;SYSDESC;
          GOTO      ICMG9999
.   
ICMG0500  MOVE      "CL",CATEGORY      
          MOVE      PTIMCLM,CODE
          CALL      CODITM00
          GOTO      ICMG9999
.
ICMG0600  WRITE     HTMLFILE;PTIMMES1;
          GOTO      ICMG9999
.
ICMG0700  WRITE     HTMLFILE;PTIMMES2;
          GOTO      ICMG9999
.
ICMG0800  WRITE     HTMLFILE;INCMSGSY;
          GOTO      ICMG9999
.
ICMG9999  RETURN
.------------------------------------------------------------
. Miscellaneous
.------------------------------------------------------------
MISN0000  BRANCH    FLDITMNO,MISN0100
          GOTO      MISN9999
.
MISN0100  READ      CONTROLF,ZERO;*43,IBCNMHOS
          WRITE     HTMLFILE;IBCNMHOS;
          GOTO      MISN9999
.
MISN9999  RETURN
.------------------------------------------------------------
. Health Fund Group Maintenance 
.------------------------------------------------------------
HGRP0000  BRANCH    FLDITMNO,HGRP0100,HGRP0200,HGRP0300,HGRP0400,HGRP0500:
                             HGRP0600
          GOTO      HGRP9999
.
HGRP0100  CALL      NEXTHG00      * Link to Next Group
          GOTO      HGRP9999
.
HGRP0200  CALL      PREVHG00      * Link to Last Group
          GOTO      HGRP9999
.
HGRP0300  CALL      GPTAB000      * Table of Health Fund Groups 
          GOTO      HGRP9999
.
HGRP0400  WRITE     HTMLFILE;PTHGCODE;
          GOTO      HGRP9999
.
HGRP0500  WRITE     HTMLFILE;PTHGDESC;
          GOTO      HGRP9999
.
HGRP0600  MOVE      "  3",STNTYPE        * Stationery Type 3
          MOVE      PTHGDFIC,STNCODE     * Default Fee Information Form
          CALL      STNCOD00
          GOTO      HGRP9999
.
HGRP9999  RETURN
+
.------------------------------------------------------------
. Health Fund Maintenance 
.------------------------------------------------------------
HFND0000  BRANCH    FLDITMNO,HFND0100,HFND0200,HFND0300,HFND0400,HFND0500:
                             HFND0600,HFND0700,HFND0800,HFND0900,HFND1000:
                             HFND1100,HFND1200,HFND1300,HFND1400,HFND1500:
                             HFND1600,HFND1700,HFND1800,HFND1900,HFND2000:
                             HFND2100,HFND2200,HFND2300,HFND2400,HFND2500:
                             HFND2600,HFND2700,HFND2800,HFND2900,HFND3000:
                             HFND3100,HFND3200,HFND3300,HFND3400,HFND3500:
                             HFND3600,HFND3700,HFND3800,HFND3900,HFND4000:
                             HFND4100,HFND4200,HFND4300,HFND4400,HFND4500:
                             HFND4600,HFND4700,HFND4800,HFND4900,HFND5000:
                             HFND5100,HFND5200,HFND5300,HFND5400,HFND5500:
                             HFND5600,HFND5700,HFND5800,HFND5900,HFND6000:
                             HFND6100,HFND6200,HFND6300,HFND6400,HFND6500:
                             HFND6600,HFND6700,HFND6800,HFND6900,HFND7000:
                             HFND7100,HFND7200,HFND7300,HFND7400,HFND7500:
                             HFND7600
          GOTO      HFND9999
.
HFND0100  CALL      NEXTHG00      * Link to Next Fund 
          GOTO      HFND9999
.
HFND0200  CALL      PREVHG00      * Link to Last Fund 
          GOTO      HFND9999
.
HFND0300  CALL      HFTAB000      * Table of Health Funds 
          GOTO      HFND9999
.
HFND0400  WRITE     HTMLFILE;HCODE;
          GOTO      HFND9999
.
HFND0500  WRITE     HTMLFILE;HFNAME;
          GOTO      HFND9999
.
HFND0600  MATCH     SP70,HFADD1
          GOTO      HFND9999 IF EQUAL
          WRITE     HTMLFILE;HFADD1;
          GOTO      HFND9999
.
HFND0700  MATCH     SP70,HFADD2
          GOTO      HFND9999 IF EQUAL
          WRITE     HTMLFILE;HFADD2;
          GOTO      HFND9999
.
HFND0800  MATCH     SP70,HFTELE
          GOTO      HFND9999 IF EQUAL
          WRITE     HTMLFILE;HFTELE;
          GOTO      HFND9999
.
HFND0900  COMPARE   ZERO,HFBAND
          IF        @EQUAL
            WRITE     HTMLFILE;" 0";   * just in case old junk data
          ELSE 
            WRITE     HTMLFILE;HFBAND;
          ENDIF
          GOTO      HFND9999
.
HFND1000  MATCH     SP70,HFHDPE 
          GOTO      HFND9999 IF EQUAL
          WRITE     HTMLFILE;HFHDPE;
          GOTO      HFND9999
.
HFND1100  MATCH     SP70,HFFAXN
          GOTO      HFND9999 IF EQUAL
          WRITE     HTMLFILE;HFFAXN;
          GOTO      HFND9999
.
HFND1200  CALL      FNDGRP00            *Health Fund Group Selection List 
          GOTO      HFND9999
.
HFND1300  MATCH     SP70,PTHFHCPE 
          GOTO      HFND9999 IF EQUAL
          WRITE     HTMLFILE;PTHFHCPE;
          GOTO      HFND9999
.
HFND1400  MATCH     SP70,DHFTACT
          IF        @EQUAL
           WRITE     HTMLFILE;"1";   * Just in case old junk data     
          ELSE
           WRITE     HTMLFILE;DHFTACT;
          ENDIF
          GOTO      HFND9999
.
HFND1500  CALL      FCOMNT00
          GOTO      HFND9999
.
HFND1600  MATCH     SP70,HFADD3
          GOTO      HFND9999 IF EQUAL
          WRITE     HTMLFILE;HFADD3;
          GOTO      HFND9999 
.
HFND1700  MATCH     SP70,HFADD4
          GOTO      HFND9999 IF EQUAL
          WRITE     HTMLFILE;HFADD4;
          GOTO      HFND9999 
.
HFND1800  MATCH     SP70,HFPCODE
          GOTO      HFND9999 IF EQUAL
          WRITE     HTMLFILE;HFPCODE;
          GOTO      HFND9999 
.
HFND1900  CALL      DFND0000
          GOTO      HFND9999 
.
HFND2000  MOVE      "CL",CATEGORY
          MOVE      CLAIMCOD,CODE
          CALL      CODITM00
          GOTO      HFND9999 
.
HFND2100  MOVE      "HT",CATEGORY
          MOVE      TABLETYP,CODE
          CALL      CODITM00
          GOTO      HFND9999 
.
HFND2200  CALL      CMXSD000   * Same Day Casemix Fees
          GOTO      HFND9999 
.
HFND2300  CALL      CMXON000   * Overnight Casemix Fees
          GOTO      HFND9999 
.
HFND2400  MOVE      "BT",CATEGORY
          MOVE      BEDTYPES,CODE
          CALL      CODITM00
          GOTO      HFND9999 
.
HFND2500  MOVE      "A ",CATEGORY
          MOVE      ADMISSTY,CODE
          CALL      CODITM00
          GOTO      HFND9999 
.
HFND2600  CALL      BFETB000   * Overnight Fees
          GOTO      HFND9999 
.
HFND2700  MATCH     SP70,DTHFUMTD
          IF        @EQUAL
           WRITE     HTMLFILE;"0";  
          ELSE
           WRITE     HTMLFILE;DTHFUMTD;
          ENDIF
          GOTO      HFND9999
.
HFND2800  MATCH     SP70,DTHFUCMX
          IF        @EQUAL
           WRITE     HTMLFILE;"0";  
          ELSE
           WRITE     HTMLFILE;DTHFUCMX;
          ENDIF
          GOTO      HFND9999
.
HFND2900  MATCH     "031",PTHFGRPV
          IF        @EQUAL
            WRITE     HTMLFILE;"<option value=#"031#" selected> ":
                                 "3.1 </option>"
          ELSE
            WRITE     HTMLFILE;"<option value=#"031#"> ":
                                 "3.1 </option>"
          ENDIF
.
          MATCH     "041",PTHFGRPV
          IF        @EQUAL
            WRITE     HTMLFILE;"<option value=#"041#" selected> ":
                                 "4.1 </option>"
          ELSE
            WRITE     HTMLFILE;"<option value=#"041#"> ":
                                 "4.1 </option>"
          ENDIF
.
          MATCH     "042",PTHFGRPV
          IF        @EQUAL
            WRITE     HTMLFILE;"<option value=#"042#" selected> ":
                                 "4.2 </option>"
          ELSE
            WRITE     HTMLFILE;"<option value=#"042#"> ":
                                 "4.2 </option>"
          ENDIF
.
          MATCH     "050",PTHFGRPV
          IF        @EQUAL
            WRITE     HTMLFILE;"<option value=#"050#" selected> ":
                                 "5.0 </option>"
          ELSE
            WRITE     HTMLFILE;"<option value=#"050#"> ":
                                 "5.0 </option>"
          ENDIF
.
          MATCH     "051",PTHFGRPV
          IF        @EQUAL
            WRITE     HTMLFILE;"<option value=#"051#" selected> ":
                                 "5.1 </option>"
          ELSE      
            WRITE     HTMLFILE;"<option value=#"051#"> ":
                                 "5.1 </option>"
          ENDIF
.
          MATCH     "052",PTHFGRPV
          IF        @EQUAL
            WRITE     HTMLFILE;"<option value=#"052#" selected> ":
                                 "5.2 </option>"
          ELSE      
            WRITE     HTMLFILE;"<option value=#"052#"> ":
                                 "5.2 </option>"
          ENDIF
.
          MATCH     "060",PTHFGRPV
          IF        @EQUAL
            WRITE     HTMLFILE;"<option value=#"060#" selected> ":
                                 "6.0 </option>"
          ELSE      
            WRITE     HTMLFILE;"<option value=#"060#"> ":
                                 "6.0 </option>"
          ENDIF
.
          MATCH     "062",PTHFGRPV
          IF        @EQUAL
            WRITE     HTMLFILE;"<option value=#"062#" selected> ":
                                 "6.2 </option>"
          ELSE      
            WRITE     HTMLFILE;"<option value=#"062#"> ":
                                 "6.2 </option>"
          ENDIF
.
          MATCH     "070",PTHFGRPV
          IF        @EQUAL
            WRITE     HTMLFILE;"<option value=#"070#" selected> ":
                                 "7.0 </option>"
          ELSE      
            WRITE     HTMLFILE;"<option value=#"070#"> ":
                                 "7.0 </option>"
          ENDIF
.
          MATCH     "080",PTHFGRPV
          IF        @EQUAL
            WRITE     HTMLFILE;"<option value=#"080#" selected> ":
                                 "8.0 </option>"
          ELSE
            WRITE     HTMLFILE;"<option value=#"080#"> ":
                                 "8.0 </option>"
          ENDIF
.
          MATCH     "090",PTHFGRPV
          IF        @EQUAL
            WRITE     HTMLFILE;"<option value=#"090#" selected> ":
                                 "9.0 </option>"
          ELSE
            WRITE     HTMLFILE;"<option value=#"090#"> ":
                                 "9.0 </option>"
          ENDIF
.
          MATCH     "100",PTHFGRPV
          IF        @EQUAL
            WRITE     HTMLFILE;"<option value=#"100#" selected> ":
                                 "10.0 </option>"
          ELSE
            WRITE     HTMLFILE;"<option value=#"100#"> ":
                                 "10.0 </option>"
          ENDIF
.
          MATCH     "110",PTHFGRPV
          IF        @EQUAL
            WRITE     HTMLFILE;"<option value=#"110#" selected> ":
                                 "11.0 </option>"
          ELSE
            WRITE     HTMLFILE;"<option value=#"110#"> ":
                                 "11.0 </option>"
          ENDIF
.
          MATCH     "120",PTHFGRPV
          IF        @EQUAL
            WRITE     HTMLFILE;"<option value=#"120#" selected> ":
                                 "12.0 </option>"
          ELSE
            WRITE     HTMLFILE;"<option value=#"120#"> ":
                                 "12.0 </option>"
          ENDIF
.
          GOTO      HFND9999
.
HFND3000  WRITE     HTMLFILE;PTCNUEDI;
          GOTO      HFND9999
.
HFND3100  WRITE     HTMLFILE;PTFXEXTR;
          GOTO      HFND9999
.
HFND3200  WRITE     HTMLFILE;PTFXTFLG;
          GOTO      HFND9999
.
HFND3300  WRITE     HTMLFILE;PTFXADDR;
          GOTO      HFND9999
.
HFND3400  WRITE     HTMLFILE;PTFXSUBJ;
          GOTO      HFND9999
.
HFND3500  WRITE     HTMLFILE;PTCNMVCP;  * Using Mechanical Ventilation in 
          GOTO      HFND9999            * Casepayement Billing 0=No 1=Yes
.
HFND3600  WRITE     HTMLFILE;PTFNBMVH;  * Billing Mech. Vent Hrs 0=No 1=Yes
          GOTO      HFND9999
.
HFND3700  COMPARE   ZERO,PTFNMVRT
          GOTO      HFND9999 IF EQUAL  
          WRITE     HTMLFILE;PTFNMVRT;  * Mech. Ventilation Daily Rate
          GOTO      HFND9999
.
HFND3800  COMPARE   ZERO,PTFNHRMV
          GOTO      HFND9999 IF EQUAL  
          WRITE     HTMLFILE;PTFNHRMV;  * Hours for MV Additional Day
          GOTO      HFND9999
.
HFND3900  MOVE      PTFNMVBC,MISCCODE   * Extn. file Misc. code for Mech vent
          CALL      MISC0000            * Get Miscellanous Code & Desc
          GOTO      HFND9999
.
HFND4000  MOVE      PTCNMVBC,MISCCODE * Misc.Charge code for Mech.Vent Parameter
          CALL      MISC0000          * Get Miscellanous Code & Desc
          GOTO      HFND9999
.
HFND4100  WRITE     HTMLFILE;PTFXADD1;
          GOTO      HFND9999
.
HFND4200  WRITE     HTMLFILE;PTFXADD2;
          GOTO      HFND9999
.
HFND4300  WRITE     HTMLFILE;PTFXADD3;
          GOTO      HFND9999
.
HFND4400  WRITE     HTMLFILE;PTFXADD4;
          GOTO      HFND9999
.
HFND4500  WRITE     HTMLFILE;PTFXPOST;
          GOTO      HFND9999
.
HFND4600  WRITE     HTMLFILE;PTFXZINV;
          GOTO      HFND9999
.
HFND4700  WRITE     HTMLFILE;PTHFBILN;
          GOTO      HFND9999
.
HFND4800  WRITE     HTMLFILE;PTHFFULD;
          GOTO      HFND9999
.
HFND4900  WRITE     HTMLFILE;PTHFCARC;
          GOTO      HFND9999
.
HFND5000  MOVE      "  3",STNTYPE        * Stationery Type 3
          MOVE      PTHFDFIC,STNCODE     * Default Fee Information Form
          CALL      STNCOD00
          GOTO      HFND9999
.
HFND5100  WRITE     HTMLFILE;PTFXSCEM;
          GOTO      HFND9999
.
HFND5200  WRITE     HTMLFILE;PTFXSCPN;
          GOTO      HFND9999
.
HFND5300  WRITE     HTMLFILE;PTFXSCPP;
          GOTO      HFND9999
.
HFND5400  CALL      ECLPAR00
          GOTO      HFND9999 
.
HFND5500  MOVE      SP70,PTHGDESC
          MATCH     SP70,PTHFHGRP
          GOTO      HFND5520 IF EQUAL
          PACK      KEY6,PTHFHGRP
          CALL      RDPAHGP1
.
HFND5520  WRITE     HTMLFILE;PTHGDESC;
          GOTO      HFND9999
.
HFND5600  MOVE      "FA",CATEGORY
          MOVE      PTHFFACD,CODE
          CALL      CODITM00
          GOTO      HFND9999
.
HFND5700  WRITE     HTMLFILE;PTHFNDFP;
          GOTO      HFND9999
.
HFND5800  MOVE      "w0",CATEGORY
          MOVE      PTHFOCGR,CODE
          CALL      CODITM00
          GOTO      HFND9999
.
HFND5900  WRITE     HTMLFILE;PTFXCEFR;
          GOTO      HFND9999
.
HFND6000  MOVE      "rh",CATEGORY
          MOVE      PTFXRHCD,CODE
          CALL      CODITM00
          GOTO      HFND9999
.
HFND6100  WRITE     HTMLFILE;PTFXRHFT;
          GOTO      HFND9999
.
HFND6200  MATCH     PTFXHDAT,SP70
          GOTO      HFND9999 IF EQUAL
          UNPACK    PTFXHDAT,CCENT,CYEAR,CMON,CDAY
          MOVE      CMON,F2
          LOAD      MTHNAM3,F2,JAN,FEB,MAR,APR,MAY,JUN,JUL,AUG,SEP,OCT,NOV,DEC
          WRITE     HTMLFILE;CDAY,SP1,MTHNAM3,SP1,CCENT,CYEAR;
          GOTO      HFND9999
.                                                                   * Car 273294
HFND6300  WRITE     HTMLFILE;PTHFARCE;
          GOTO      HFND9999
.
HFND6400  WRITE     HTMLFILE;PTFXMFEE;
          GOTO      HFND9999
.
HFND6500  MOVE      "ta",CATEGORY
          MOVE      PTHFIMCD,CODE
          CALL      CODITM00
          GOTO      HFND9999
.
HFND6600  WRITE     HTMLFILE;PTHFDPRI;
          GOTO      HFND9999
.
HFND6700  WRITE     HTMLFILE;PTFXSMOR;
          GOTO      HFND9999
.
HFND6800  WRITE     HTMLFILE;PTHFCEML;
          GOTO      HFND9999
.
HFND6900  CALL      SELACT00               * Select Active status
          GOTO      HFND9999
.
HFND7000  WRITE     HTMLFILE;USEFHINV;
          GOTO      HFND9999
.
HFND7100  CALL      CHOLD000
          WRITE     HTMLFILE;F1;
          GOTO      HFND9999
.
HFND7200  CALL      CMVH0000
          WRITE     HTMLFILE;F1;
          GOTO      HFND9999
.
HFND7300  PACK      KEY6,HFUND001
          CALL      RDPTFX11
          IF        OVRCD=0
            WRITE     HTMLFILE;ONE;
          ELSE
            WRITE     HTMLFILE;ZERO;
          ENDIF
          GOTO      HFND9999
.
HFND7400  CALL      CDRGFL00
          WRITE     HTMLFILE;F1;
          GOTO      HFND9999
.
HFND7500  WRITE     HTMLFILE;PTCNHFED;
          GOTO      HFND9999
.
HFND7600  CALL      HFVR0000
          WRITE     HTMLFILE;F1;
          GOTO      HFND9999
.
HFND9999  RETURN
+
.-------------------------------------------------------------------
. Check if Health Fund DRG Maintenance has Data
.-------------------------------------------------------------------
CDRGFL00  MOVE      ZERO,F1
          PACK      KEY42,SP70
          CALL      RSPMEDG2
CDRGFL10  CALL      RKPMEDG2
          BRANCH    OVRCD,CDRGFL99
          UNPACK    PMEGKEYV,D3,D6
          MATCH     D6,HFUND001
          IF        @EQUAL
            MOVE      ONE,F1
            GOTO      CDRGFL99
          ENDIF
          GOTO      CDRGFL10
.
CDRGFL99  RETURN
+
.-------------------------------------------------------------------
.* Check if any Invoice on hold
.-------------------------------------------------------------------
CHOLD000  MOVE      ZERO,F1
          MOVE      ZERO,OVRCD               * assume file exists
          TRAP      OVERCOND IF IO           * trap for error openning file
          OPEN      PATFHIA3,"patfhiaf"      * open HF On Hold Invoice file
          TRAPCLR   IO
          BRANCH    OVRCD,CHOLD999
.
          PACK      KEY11,HFUND001,SP70
          CALL      RSPTFHI3
          CALL      RKPTFHI3
          BRANCH    OVRCD,CHOLD999
.
          MATCH     PTFHHFND,HFUND001
          GOTO      CHOLD999 IF NOT EQUAL
.
          MOVE      ONE,F1
CHOLD999  RETURN
+
.-------------------------------------------------------------------
.* MV hours records
.-------------------------------------------------------------------
CMVH0000  MOVE      ZERO,F1
          BRANCH    MVHRFLAG,CMVH9999
.
          PACK      KEY17,HFUND001,SP70
          CALL      RDPTFN21
          COMPARE   ZERO,OVRCD
          GOTO      CMVH2000 IF EQUAL             * Check payment model
.
          CALL      RSPTFN21
          CALL      RKPTFN21
          BRANCH    OVRCD,CMVH9999
.
          MATCH     PTFNHFND,HFUND001
          GOTO      CMVH9999 IF NOT EQUAL
.
CMVH2000  BRANCH    PTFNBMVH,CMVH9000,CMVH9000    * EPM/CWO Payment model
          GOTO      CMVH9999
.
CMVH9000  MOVE      ONE,F1
CMVH9999  RETURN
+
.-------------------------------------------------------------------
.* Check if any HF History records exist
.-------------------------------------------------------------------
HFVR0000  MOVE      ZERO,F1
          MATCH     "0",PTCNHFED
          GOTO      HFVR9999 IF EQUAL
.
          PACK      KEY17,HFUND001,SP70
          CALL      RDPTDDH1
          COMPARE   ZERO,OVRCD
          GOTO      HFVR9000 IF EQUAL
.
          CALL      RSPTDDH1
          CALL      RKPTDDH1
          BRANCH    OVRCD,HFVR9999
.
          MATCH     PTDDFUND,HFUND001
          GOTO      HFVR9999 IF NOT EQUAL
.
HFVR9000  MOVE      ONE,F1
HFVR9999  RETURN
.-------------------------------------------------------------------
.* Active/Inactive status
.-------------------------------------------------------------------
SELACT00  WRITE     HTMLFILE;"<option value=#" #"";
          MATCH     SP70,FILTACTV
          IF        @EQUAL
            WRITE     HTMLFILE;" selected";
          ENDIF
          WRITE     HTMLFILE;*+,">All</option>";
.
          WRITE     HTMLFILE;"<option value=#"0#"";
          MATCH     "0",FILTACTV
          IF        @EQUAL
            WRITE     HTMLFILE;" selected";
          ENDIF
          WRITE     HTMLFILE;*+,">Active</option>";
.
          WRITE     HTMLFILE;"<option value=#"1#"";
          MATCH     "1",FILTACTV
          IF        @EQUAL
            WRITE     HTMLFILE;" selected";
          ENDIF
          WRITE     HTMLFILE;*+,">Inactive</option>"
.
SELACT99  RETURN
+
.-------------------------------------------------------------------
.* Misc. Charge code for Mech. Vent Parameter
.-------------------------------------------------------------------
MISC0000  UNPACK    DIM127,ANS,KEY1,DIM127
          MOVE      ZERO,F1
          MOVE      KEY1,F1
.
          MATCH     SP70,MISCCODE
          GOTO      MISC9999 IF EQUAL
.
          BRANCH    F1,MISC2000
.
          IF        IBCNMHOS=1
            MOVE      SP10,KEY3
            CALL      RSPTHSP1
            CALL      RKPTHSP1
            BRANCH    OVRCD,MISC0900
            PACK      KEY29,PTHSDCLM,SP6,SP3,MISCCODE,CURRDATE,SP10
          ELSE
            PACK      KEY29,PTCNDCLM,SP6,SP3,MISCCODE,CURRDATE,SP10
          ENDIF
.
MISC0500  CALL      PATMCHRD                * read Misc.Charges file 
          COMPARE   ZERO,EXIT
          GOTO      MISC1000 IF EQUAL
.
MISC0600  IF         IBCNMHOS=1
            CALL      RKPTHSP1
            BRANCH    OVRCD,MISC0900
            PACK      KEY29,PTHSDCLM,SP6,SP3,MISCCODE,CURRDATE,SP10
            GOTO      MISC0500
          ENDIF
.
MISC0900  MOVE      "INVALID CODE",MDESC
.
MISC1000  WRITE     HTMLFILE;MDESC;     * Misc. Charge code Description
          GOTO      MISC9999
.
MISC2000  WRITE     HTMLFILE;MISCCODE;  * Misc. Charge code for Mech. Vent
          GOTO      MISC9999
.
MISC9999  RETURN
.------------------------------------------------------------
. Same Day Casemix Fees Table
.------------------------------------------------------------
CMXSD000  PACK      KEY27,CONTRCOD,CLAIMCOD,HFUND001,TABLETYP,SP70
          CALL      RSPTHLF1
CMXSD100  CALL      RKPTHLF1
          BRANCH    OVRCD,CMXSD900
          MATCH     PTHLCNID,CONTRCOD
          GOTO      CMXSD900 IF NOT EQUAL
          MATCH     PTHLCLMN,CLAIMCOD
          GOTO      CMXSD900 IF NOT EQUAL
          MATCH     PTHLHFND,HFUND001
          GOTO      CMXSD900 IF NOT EQUAL
          MATCH     PTHLTABT,TABLETYP
          GOTO      CMXSD900 IF NOT EQUAL
          PACK      KEY27,PTHLCNID,PTHLCLMN,PTHLHFND,PTHLTABT,PTHLCASM,SP70
          CLEAR     HTMLLINK
          APPEND    "javascript:Update('",HTMLLINK
          APPEND    KEY27,HTMLLINK
          APPEND    "')",HTMLLINK
          RESET     HTMLLINK
          ASSIGN    PTHLLREB+PTHLLPAT,F12P2
          WRITE     HTMLFILE;"t.addRow(#"",HTMLLINK,"#",":
                             "#"",PTHLCASM,"#",":
                             "#"",PTHLDES1,PTHLDES2,"#",":
                             "#"",PTHLLREB,"#",":
                             "#"",PTHLLPAT,"#",":
                             "#"",F12P2,"#",":
                             "#"",PTHLCOFF,"#",":
                             "#"",PTHLINVB,"#",":
                             "#"",PTHLINVI,"#");"
          GOTO      CMXSD100
.
CMXSD900
.
CMXSD999  RETURN
.------------------------------------------------------------
. Overnight Casemix Fees Table
.------------------------------------------------------------
CMXON000  PACK      KEY31,CONTRCOD,CLAIMCOD,HFUND001,TABLETYP,SP70
          CALL      RSPTHDF1
CMXON100  CALL      RKPTHDF1
          BRANCH    OVRCD,CMXON900
          MATCH     PTHDCNID,CONTRCOD
          GOTO      CMXON900 IF NOT EQUAL
          MATCH     PTHDCLMN,CLAIMCOD
          GOTO      CMXON900 IF NOT EQUAL
          MATCH     PTHDHFND,HFUND001
          GOTO      CMXON900 IF NOT EQUAL
          MATCH     PTHDTABT,TABLETYP
          GOTO      CMXON900 IF NOT EQUAL
          PACK      KEY31,PTHDCNID,PTHDCLMN,PTHDHFND,PTHDTABT,PTHDCASM:
                          PTHDEDAY,SP70
          CLEAR     HTMLLINK
          APPEND    "javascript:Update('",HTMLLINK
          APPEND    KEY31,HTMLLINK
          APPEND    "')",HTMLLINK
          RESET     HTMLLINK
          IF        PTHDDTYP=1
            MOVE      "Inlier ",KEY7
          ELSE
            MOVE      "Outlier",KEY7
          ENDIF
          ASSIGN    PTHDDREB+PTHDDPAT,F12P2
          WRITE     HTMLFILE;"t.addRow(#"",HTMLLINK,"#",":
                             "#"",PTHDCASM,"#",":
                             "#"",PTHDDES1,PTHDDES2,"#",":
                             "#"",PTHDDREB,"#",":
                             "#"",PTHDDPAT,"#",":
                             "#"",F12P2,"#",":
                             "#"",PTHDEDAY,"#",":
                             "#"",KEY7,"#");"
          GOTO      CMXON100
.
CMXON900
.
CMXON999  RETURN
.------------------------------------------------------------
. Health Fund Option
.------------------------------------------------------------
HFNITM00  UNPACK    DIM127,ANS,KEY1,DIM127
          MOVE      ZERO,F1
          MOVE      KEY1,F1
          MATCH     SP70,HFUND001
          GOTO      HFNITM99 IF EQUAL
          BRANCH    F1,HFNITM10,HFNITM20
          PACK      KEY14,PTHLHFND,SP70
          CALL      RDSFUND1
          CALL      RDKFUND1
          BRANCH    OVRCD,HFNITM99
          MATCH     "0000",HFTABL
          IF        @EQUAL
            WRITE     HTMLFILE;HFNAME;
          ENDIF
          GOTO      HFNITM99
.
HFNITM10  WRITE     HTMLFILE;HFUND001;
          GOTO      HFNITM99
.
HFNITM20  MOVE      PTHLHFND,HFUND001
          CALL      DFND0000
          GOTO      HFNITM99
.
HFNITM99  RETURN
.------------------------------------------------------------
.   Display Selection List for health fund
.------------------------------------------------------------
DFND0000  PACK      KEY14,SP70
          CALL      RDSFUND1
DFND0010  CALL      RDKFUND1
          BRANCH    OVRCD,DFND9999
          MATCH     "0000",HFTABL
          IF        @EQUAL
            MATCH     HCODE,HFUND001
            IF        @EQUAL
              WRITE     HTMLFILE;"<option value=#"",HCODE,"#" selected> ":
                                 HCODE,": ",HFNAME,"</option>"
            ELSE
              WRITE     HTMLFILE;"<option value=#"",HCODE,"#"> ":
                                 HCODE,": ",HFNAME,"</option>"
            ENDIF
          ELSE
            PACK      KEY14,HCODE,Z70
            CALL      RDSFUND1
          ENDIF
          GOTO      DFND0010
DFND9999  RETURN
.------------------------------------------------------------
. Health Fund Group Selection List
.------------------------------------------------------------
FNDGRP00  UNPACK    DIM127,D1,KEY1,DIM127
          MOVE      ZERO,F1
          MOVE      KEY1,F1
          COMPARE   THREE,F1
          GOTO      FNDGRP30 IF EQUAL        * HF Group status
          COMPARE   FOUR,F1
          GOTO      FNDGRP40 IF EQUAL
.
          MATCH     SP70,PTHFHGRP 
          GOTO      FNDGRP20 IF EQUAL
          PACK      KEY6,PTHFHGRP
          CALL      RDPAHGP1
          BRANCH    OVRCD,FNDGRP20
          BRANCH    F1,FNDGRP10,FNDGRP20
          WRITE     HTMLFILE;PTHGCODE;
          GOTO      FNDGRP99
.
FNDGRP10  WRITE     HTMLFILE;PTHGDESC;
          GOTO      FNDGRP99
.
FNDGRP20  CALL      HSEL0000
          GOTO      FNDGRP99
.
FNDGRP30  MOVE      FILTHGRP,PTHFHGRP
          CALL      HSEL0000
          GOTO      FNDGRP99
.
FNDGRP40  MATCH     SP70,PTHFHGRP
          GOTO      FNDGRP99 IF EQUAL
.
          PACK      KEY6,PTHFHGRP
          CALL      RDPAHGP1
.
          WRITE     HTMLFILE;PTHGCODE;
          GOTO      FNDGRP99
.
FNDGRP99  RETURN
.------------------------------------------------------------
. Health Fund Group Selection 
.------------------------------------------------------------
HSEL0000  PACK      KEY6,SP70
          CALL      RSPAHGP1
HSEL0100  CALL      RKPAHGP1
          BRANCH    OVRCD,HSEL9999
.
          MOVE      PTHGDESC,KEY50
          PACK      KEY8,QUOTE,PTHGCODE,QUOTE
          MATCH     PTHFHGRP,PTHGCODE
          IF        @EQUAL
            WRITE     HTMLFILE;"<option value=",KEY8," selected>":
                               KEY50,"</option>"
          ELSE
            WRITE     HTMLFILE;"<option value=",KEY8,">",KEY50,"</option>"
          ENDIF
          GOTO      HSEL0100
.
HSEL9999  RETURN
.------------------------------------------------------------
. Output Health Comment Text Area
.------------------------------------------------------------
FCOMNT00  PACK      KEY8,HCODE,SP20     * Key is Fund Number 
          CALL      RDSFCMM1            * Positional Read
FCOMNT10  CALL      RDKFCMM1            * Sequential Read
          BRANCH    OVRCD,FCOMNT99      * If not found ?
          MATCH     HCODE,FUNDCOD
          IF        @EQUAL
            STRIP     FTEXT
            MOVELPTR  FTEXT,TXTLEN
            IF        TXTLEN>0
              SFORMAT   VAR,TXTLEN
            ELSE
              SFORMAT   VAR,ONE
            ENDIF
            MOVE      FTEXT,VAR
            WRITE     HTMLFILE;VAR      * Line Details
            SFORMAT   VAR,127
          ENDIF
          GOTO      FCOMNT10
.
FCOMNT99  RETURN
.------------------------------------------------------------
. Health Fund Table Maintenance 
.------------------------------------------------------------
HTAB0000  BRANCH    FLDITMNO,HTAB0100,HTAB0200,HTAB0300,HTAB0400,HTAB0500:
                             HTAB0600,HTAB0700,HTAB0800,HTAB0900,HTAB1000:
                             HTAB1100,HTAB1200,HTAB1300,HTAB1400,HTAB1500:
                             HTAB1600,HTAB1700,HTAB1800,HTAB1900,HTAB2000
          GOTO      HTAB9999
.
HTAB0100  CALL      NEXTGR00      * Link to Next Fund 
          GOTO      HTAB9999
.
HTAB0200  CALL      PREVGR00      * Link to Last Fund 
          GOTO      HTAB9999
.
HTAB0300  CALL      FTTAB000      * Table of Health Fund Tables 
          GOTO      HTAB9999
.
HTAB0400  WRITE     HTMLFILE;HCODE;
          GOTO      HTAB9999
.
HTAB0500  WRITE     HTMLFILE;HFTABL;
          GOTO      HTAB9999
.
HTAB0600  WRITE     HTMLFILE;HFNAME;
          GOTO      HTAB9999
.
HTAB0700  MATCH     SP70,HFHDPE 
          GOTO      HTAB9999 IF EQUAL
          WRITE     HTMLFILE;HFHDPE;
          GOTO      HTAB9999
.
HTAB0800  MOVE      "HT",CATEGORY
          MOVE      PTHFBCAT,CODE
          CALL      CODITM00
          GOTO      HTAB9999
.
HTAB0900  MATCH     SP70,DHFTACT
          IF        @EQUAL
           WRITE     HTMLFILE;"0";   * Just in case old junk data     
          ELSE
           WRITE     HTMLFILE;DHFTACT;
          ENDIF
          GOTO      HTAB9999
.
HTAB1000  WRITE     HTMLFILE;FUNDCODE;         
          GOTO      HTAB9999
.
HTAB1100  WRITE     HTMLFILE;FUNDNAME;         
          GOTO      HTAB9999
.
HTAB1200  CALL      CHTAB000      * Table of Charges
          GOTO      HTAB9999
.
HTAB1300  WRITE     HTMLFILE;PTHFMAXM;  * maximum patient moeity
          GOTO      HTAB9999
.
HTAB1400  WRITE     HTMLFILE;PTHFDSC1;  * patient moeity description 1
          GOTO      HTAB9999
.
HTAB1500  WRITE     HTMLFILE;PTHFDSC2;  * patient moeity description 2
          GOTO      HTAB9999
.
HTAB1600  MOVE      "BT",CATEGORY
          MOVE      PTFMBTYP,CODE
          CALL      CODITM00            * patient moeity bed type
          GOTO      HTAB9999
.
HTAB1700  WRITE     HTMLFILE;PTFMSDAM;  * patient moeity same day amount
          GOTO      HTAB9999
.
HTAB1800  WRITE     HTMLFILE;PTFMOVAM;  * patient moeity overnight amount
          GOTO      HTAB9999
.
HTAB1900  WRITE     HTMLFILE;PTCNUEDI;  * Use HOSClaims EDI module
          GOTO      HTAB9999
.
HTAB2000  WRITE     HTMLFILE;PTCNMVCP;  * Using Mechanical Ventilation in CaseP
          GOTO      HTAB9999
.
HTAB9999  RETURN
.------------------------------------------------------------
. Charges Table
.------------------------------------------------------------
CHTAB000  UNPACK    DIM127,D1,LINKPRG,DIM127
          UNPACK    DIM127,D1,LINKREP,DIM127
          UNPACK    DIM127,D1,LINKTEM,DIM127
.
          WRITE     HTMLFILE;"<tr align=center>":
                               "<td class=HeadingCell width=30%>":
                               "<b>Bed Type</b></td>":
                               "<td class=HeadingCell width=40%>":
                               "<b>Same-Day Amount</b></td>":
                               "<td class=HeadingCell width=40%>":
                               "<b>Overnight Amount</b></td>":
                             "</tr>"
.
          PACK      KEY17,HFTAB001,HFTAB002,SP70
          CALL      RSPTFMO1
CHTAB100  CALL      RKPTFMO1
          BRANCH    OVRCD,CHTAB999
.
          MATCH     HFTAB001,PTFMHFCD
          GOTO      CHTAB999 IF NOT EQUAL
.
          MATCH     HFTAB002,PTFMHFTB
          GOTO      CHTAB999 IF NOT EQUAL
.
          PACK      KEY5,ANSB,ANST,PTFMBTYP,SP70
          CALL      rDCODE1
          BRANCH    OVRCD,CHTAB100
.
          WRITE     HTMLFILE;"<tr><td nowrap><A HREF='javascript:ShowMoeity":
                             "(#"",LINKPRG,"#.pbl":
                             "?reportno=",LINKREP:
                             "&template=",LINKTEM:
                             "&hftab001=",PTFMHFCD:
                             "&hftab002=",PTFMHFTB:
                             "&ptfmo001=",PTFMBTYP,"#")'>":
                             "<img src=../images/MaintenanceIcon.gif hspace=4":
                             " border=0 align=absmiddle></a>":
                             TDESC,"</td>":
                             "<td>",PTFMSDAM,"</td>":
                             "<td>",PTFMOVAM,"</td>":
                             "</tr>"
.
          GOTO      CHTAB100
.
CHTAB999  RETURN
.------------------------------------------------------------
. Health Fund Table Search 
.------------------------------------------------------------
SHFT0000  BRANCH    FLDITMNO,SHFT0100,SHFT0200,SHFT0300,SHFT0400,SHFT0500:
                             SHFT0600,SHFT0700
          GOTO      SHFT9999
.
SHFT0100  CALL      NEXTGR00      * Link to Next Fund
          GOTO      SHFT9999
.
SHFT0200  CALL      PREVGR00      * Link to Last Fund
          GOTO      SHFT9999
.
SHFT0300  MOVE      ZERO,LNK2PRT  * Display Table row with link
          CALL      SPTHFA00      * Table of Health Fund Tables
          GOTO      SHFT9999
.
SHFT0400  MOVE      ONE,LNK2PRT   * Update Parent (link to parent form)
          CALL      SPTHFA00      * Table of Health Fund Tables
          GOTO      SHFT9999
.
SHFT0500  MOVE      TWO,LNK2PRT   * Update Parent (link to parent form)
          CALL      SPTHFA00      * Table of Health Fund Tables
          GOTO      SHFT9999
.
SHFT0600  MOVE      THREE,LNK2PRT * Update Parent (link to parent form)
          CALL      SPTHFA00      * Table of Health Funds only
          GOTO      SHFT9999
.
SHFT0700  MOVE      FOUR,LNK2PRT  * Update Parent (link to parent form)        
          CALL      SPTHFA00      * Table of Health Funds & Table Type
          GOTO      SHFT9999
.
SHFT9999  RETURN
.------------------------------------------------------------
. Allowance Code Maintenance
.------------------------------------------------------------
PALW0000  BRANCH    FLDITMNO,PALW0100,PALW0200,PALW0300,PALW0400,PALW0500:
                             PALW0600
          GOTO      PALW9999
.
PALW0100  WRITE     HTMLFILE;ALWCODE;
          GOTO      PALW9999
.
PALW0200  WRITE     HTMLFILE;ALWDESC;
          GOTO      PALW9999
.
PALW0300  WRITE     HTMLFILE;ALWAMT;
          GOTO      PALW9999
.
PALW0400  CALL      ALTAB000      * Table of Allowance Codes   
          GOTO      PALW9999
.
PALW0500  CALL      NEXTGR00      * Link to Next Group
          GOTO      PALW9999
.
PALW0600  CALL      PREVGR00      * Link to Last Group
          GOTO      PALW9999
.
PALW9999  RETURN 
.------------------------------------------------------------
. Insurance Code Maintenance
.------------------------------------------------------------
PINS0000  BRANCH    FLDITMNO,PINS0100,PINS0200,PINS0300,PINS0400,PINS0500:
                             PINS0600,PINS0700,PINS0800,PINS0900,PINS1000:
                             PINS1100,PINS1200,PINS1300,PINS1400,PINS1500:
                             PINS1600,PINS1700,PINS1800,PINS1900,PINS2000:
                             PINS2100,PINS2200,PINS2300,PINS2400,PINS2500:
                             PINS2600,PINS2700,PINS2800 
          GOTO      PINS9999
.
PINS0100  WRITE     HTMLFILE;ICODE;
          GOTO      PINS9999
.
PINS0200  WRITE     HTMLFILE;INAME;
          GOTO      PINS9999
.
PINS0300  WRITE     HTMLFILE;IADD1;
          GOTO      PINS9999
.
PINS0400  WRITE     HTMLFILE;IADD2;
          GOTO      PINS9999
.
PINS0500  WRITE     HTMLFILE;IADD3;
          GOTO      PINS9999
.
PINS0600  WRITE     HTMLFILE;IADD4;
          GOTO      PINS9999
.
PINS0700  WRITE     HTMLFILE;IPOST;
          GOTO      PINS9999
.
PINS0800  WRITE     HTMLFILE;ICONT;
          GOTO      PINS9999
.
PINS0900  WRITE     HTMLFILE;ITELEB;
          GOTO      PINS9999
.
PINS1000  WRITE     HTMLFILE;IBILL;
          GOTO      PINS9999
.
PINS1100  WRITE     HTMLFILE;IAOUT;
          GOTO      PINS9999
.
PINS1200  WRITE     HTMLFILE;ISORT;
          GOTO      PINS9999
.
PINS1300  MOVE      ZERO,LINK2PRT 
          CALL      ISTAB000      * Table of Insurance Codes   
          GOTO      PINS9999
.
PINS1400  CALL      NEXTGR00      * Link to Next Group
          GOTO      PINS9999
.
PINS1500  CALL      PREVGR00      * Link to Last Group
          GOTO      PINS9999
.
PINS1600  MOVE      ONE,LINK2PRT  * Set for UpdateParent 
          CALL      ISTAB000      * Table of Insurance Codes   
          GOTO      PINS9999
.
PINS1700  MATCH     SP70,PTINSCEM
          GOTO      PINS9999 IF EQUAL
.
          WRITE     HTMLFILE;PTINSCEM;
          GOTO      PINS9999 
. 
PINS1800  MATCH     SP70,PTINSCPN
          GOTO      PINS9999 IF EQUAL
.
          WRITE     HTMLFILE;PTINSCPN;
          GOTO      PINS9999 
. 
PINS1900  MATCH     SP70,PTINSCPP
          GOTO      PINS9999 IF EQUAL
.
          WRITE     HTMLFILE;PTINSCPP;
          GOTO      PINS9999 
. 
PINS2000  MATCH     SP70,PTINACTV                                     *I-169939
          GOTO      PINS9999 IF EQUAL
.
          WRITE     HTMLFILE;PTINACTV;
          GOTO      PINS9999 
. 
PINS2100  MATCH     SP70,PTINFAXN
          GOTO      PINS9999 IF EQUAL
.
          WRITE     HTMLFILE;PTINFAXN;
          GOTO      PINS9999 
.
PINS2200  MATCH     SP70,PTINEMAI
          GOTO      PINS9999 IF EQUAL
.
          WRITE     HTMLFILE;PTINEMAI;
          GOTO      PINS9999 
.
PINS2300  MOVE      "Ve",CATEGORY
          MOVE      PTINSERV,CODE
          CALL      CODITM00
          GOTO      PINS9999 
.
PINS2400  MOVE      "CL",CATEGORY
          MOVE      PTINCLAI,CODE
          CALL      CODITM00
          GOTO      PINS9999 
.                                                                   * Car 273294
PINS2500  MATCH     SP70,PTINARCE
          GOTO      PINS9999 IF EQUAL
.
          WRITE     HTMLFILE;PTINARCE;
          GOTO      PINS9999 
.
PINS2600  CALL      NEXTIN00      * Link to Next Insurance Keyword 
          GOTO      PINS9999
.
PINS2700  CALL      PREVIN00      * Link to Last Insurance Keyword
          GOTO      PINS9999
.
PINS2800  MOVE      ZERO,LINK2PRT
          CALL      ISTABK00      * Table of Insurance Code Keyword Search List
          GOTO      PINS9999
.
PINS9999  RETURN 
.
.------------------------------------------------------------
. Option 8 : Period Date Range Details
.------------------------------------------------------------
DRGD0000  BRANCH    FLDITMNO,DRGD0100,DRGD0200,DRGD0300,DRGD0400,DRGD0500:
                             DRGD0600,DRGD0700,DRGD0800,DRGD0900
          GOTO      DRGD9999
.

DRGD0100  MATCH     SP70,DRGFDTE
          IF        @EQUAL
            MOVE      SP70,DRGFDTE
            WRITE     HTMLFILE;DRGFDTE;
            GOTO      DRGD9999
          ELSE
            UNPACK    DIM127,D1,KEY1,DIM127
            MOVE      ZERO,F1
            MOVE      KEY1,F1
            BRANCH    F1,DRGD0150
            UNPACK    DRGFDTE,CCENT,CYEAR,CMON,CDAY   * To Date in (DD MON CCYY)
            MOVE      CMON,F2
            LOAD      MTHNAM3,F2,JAN,FEB,MAR,APR,MAY,JUN,JUL,AUG,SEP,OCT,NOV,DEC
            PACK      KEY12,CDAY,SP1,MTHNAM3,SP1,CCENT,CYEAR
            WRITE     HTMLFILE;KEY12;
            GOTO      DRGD9999
          ENDIF
.
DRGD0150  WRITE     HTMLFILE;DRGFDTE;
          GOTO      DRGD9999
.
DRGD0200  MATCH     SP70,DRGTDTE
          IF        @EQUAL
            MOVE      SP70,DRGTDTE
            WRITE     HTMLFILE;DRGTDTE;
            GOTO      DRGD9999
          ELSE
            UNPACK    DIM127,D1,KEY1,DIM127
            MOVE      ZERO,F1
            MOVE      KEY1,F1
            BRANCH    F1,DRGD0250
            UNPACK    DRGTDTE,CCENT,CYEAR,CMON,CDAY   * To Date in (DD MON CCYY)
            MOVE      CMON,F2
            LOAD      MTHNAM3,F2,JAN,FEB,MAR,APR,MAY,JUN,JUL,AUG,SEP,OCT,NOV,DEC
            PACK      KEY12,CDAY,SP1,MTHNAM3,SP1,CCENT,CYEAR
            WRITE     HTMLFILE;KEY12;
            GOTO      DRGD9999
          ENDIF
.
DRGD0250  WRITE     HTMLFILE;DRGTDTE;
          GOTO      DRGD9999
.
DRGD0300  WRITE     HTMLFILE;DRGYR;
          GOTO      DRGD9999
.
DRGD0400  WRITE     HTMLFILE;DRGNUM;
          GOTO      DRGD9999
.
DRGD0500  WRITE     HTMLFILE;DRGCYR;
          GOTO      DRGD9999
.
DRGD0600  WRITE     HTMLFILE;DRGCNUM;
          GOTO      DRGD9999
.
DRGD0700  WRITE     HTMLFILE;DRGLDSC;
          GOTO      DRGD9999
.
DRGD0800  WRITE     HTMLFILE;DRGMDSC;
          GOTO      DRGD9999
.
DRGD0900  WRITE     HTMLFILE;DRGSDSC;
          GOTO      DRGD9999
.
DRGD9999  RETURN
.------------------------------------------------------------
. Option 8 : Period Date Range Maintanance
.------------------------------------------------------------
DRGP0000  BRANCH    FLDITMNO,DRGP0100,DRGP0200,DRGP0300,DRGP0400,DRGP0500
          GOTO      DRGP9999
.
DRGP0100  CALL      DRGTAB00     * Table of Period Date Range by Year
          GOTO      DRGP9999
.
DRGP0200  CALL      YEROPT00     * Year Selection List
          GOTO      DRGP9999
.
DRGP0300  CALL      NEXT0000     * Next Year
          GOTO      DRGP9999
.
DRGP0400  CALL      LAST0000     * Previous Year
          GOTO      DRGP9999
.
DRGP0500  CALL      CURR0000     * Current Year
          GOTO      DRGP9999
.
DRGP9999  RETURN
.------------------------------------------------------------
. Next Year
.------------------------------------------------------------
NEXT0000  UNPACK    FRSTDATE,KEY4
          MOVE      KEY4,F4
          ADD       ONE,F4
          PACK      KEY4,F4
          WRITE     HTMLFILE;KEY4;
.
NEXT9999  RETURN
.------------------------------------------------------------
. Last Year
.------------------------------------------------------------
LAST0000  UNPACK    FRSTDATE,KEY4
          MOVE      KEY4,F4
          SUB       ONE,F4
          PACK      KEY4,F4
          WRITE     HTMLFILE;KEY4;
.
LAST9999  RETURN
.------------------------------------------------------------
. Current Year
.------------------------------------------------------------
CURR0000  UNPACK    FRSTDATE,KEY4
          WRITE     HTMLFILE;KEY4;
.
CURR9999  RETURN
.------------------------------------------------------------
. Output Options for Year Selection
.------------------------------------------------------------
YEROPT00  UNPACK    FRSTDATE,KEY4
          MOVE      KEY4,F4
          MOVE      F4,ENDYEAR
          SUB       FIVE,F4
          ADD       SIX,ENDYEAR
.
YEROPT10  PACK      KEY4,F4
          MATCH     KEY4,FRSTDATE
          IF        @EQUAL
            WRITE     HTMLFILE;"<option value=",KEY4," selected>":
                               F4,"</option>"
          ELSE
            WRITE     HTMLFILE;"<option value=",KEY4,">":
                               F4,"</option>"
          ENDIF
          ADD       ONE,F4
          COMPARE   ENDYEAR,F4
          GOTO      YEROPT10 IF NOT EQUAL
.
YEROPT99  RETURN
.
.------------------------------------------------------------
. Link to Next set of Health Funds 
.------------------------------------------------------------
NEXTGR00  MOVE      NORECORD,KEY2
          REP       " +",KEY2
          ASSIGN    STARTNUM+NORECORD,F3
          IF        F3<0
            MOVE      ZERO,F3
          ENDIF
          MOVE      F3,KEY3
          REP       " +",KEY3
          UNPACK    DIM127,D1,FLDPARA,DIM127
          MOVE      REPORTNO,F2
          REP       " +",FUNDCODE 
.
          WRITE     HTMLFILE;"patweb87.pbl":
                                 "?reportno=",F2:
                                 "&template=",FLDPARA:
                                 "&startnum=",KEY3:
                                 "&norecord=",KEY2:
                                 "&hftab001=",FUNDCODE: 
                                 "&keywords=",KEYWORDS;
.
          MATCH     "1",MENUFLAG
          IF        @EQUAL
            WRITE     HTMLFILE;"&menuflag=1";
          ENDIF
.
          REP       "+ ",FUNDCODE 
.
NEXTGR99  RETURN
.-------------------------------------------------------------------------------
. Link to previous set of Health Funds
.-------------------------------------------------------------------------------
PREVGR00  MOVE      NORECORD,KEY2
          REP       " +",KEY2
          ASSIGN    STARTNUM-NORECORD,F3
          IF        F3<0
            MOVE    ZERO,F3
          ENDIF
          MOVE      F3,KEY3
          REP       " +",KEY3
          UNPACK    DIM127,D1,FLDPARA,DIM127
          MOVE      REPORTNO,F2
          REP       " +",FUNDCODE 
.
          WRITE     HTMLFILE;"patweb87.pbl":
                                 "?reportno=",F2:
                                 "&template=",FLDPARA:
                                 "&startnum=",KEY3:
                                 "&norecord=",KEY2:
                                 "&hftab001=",FUNDCODE: 
                                 "&keywords=",KEYWORDS;
.
          MATCH     "1",MENUFLAG
          IF        @EQUAL
            WRITE     HTMLFILE;"&menuflag=1";
          ENDIF
.
          REP       "+ ",FUNDCODE 
.
PREVGR99  RETURN
.-----------------------------------------------------------
. Link to Next Insurance Company Keyword Search List 
.-----------------------------------------------------------
NEXTIN00  MOVE      NORECORD,KEY2
          REP       " +",KEY2
          ASSIGN    STARTNUM+NORECORD,F3
          IF        F3<0
            MOVE      ZERO,F3
          ENDIF
          MOVE      F3,KEY3
          REP       " +",KEY3
          UNPACK    DIM127,D1,FLDPARA,DIM127
          MOVE      REPORTNO,F2
          REP       " +",STARTKEY 
.
          WRITE     HTMLFILE;"patweb87.pbl":
                                 "?reportno=",F2:
                                 "&template=",FLDPARA:
                                 "&startnum=",KEY3:
                                 "&norecord=",KEY2: 
                                 "&startkey=",STARTKEY;
.
          REP       "+ ",STARTKEY
.
NEXTIN99  RETURN
.-----------------------------------------------------------
. Link to Prev Insurance Company Keyword Search List 
.----------------------------------------------------------- 
PREVIN00  MOVE      NORECORD,KEY2
          REP       " +",KEY2
          ASSIGN    STARTNUM-NORECORD,F3
          IF        F3<0
            MOVE    ZERO,F3
          ENDIF
          MOVE      F3,KEY3
          REP       " +",KEY3
          UNPACK    DIM127,D1,FLDPARA,DIM127
          MOVE      REPORTNO,F2 
          REP       " +",STARTKEY
.
          WRITE     HTMLFILE;"patweb87.pbl":
                                 "?reportno=",F2:
                                 "&template=",FLDPARA:
                                 "&startnum=",KEY3:
                                 "&norecord=",KEY2: 
                                 "&startkey=",STARTKEY;
. 
          REP       "+ ",STARTKEY
.
PREVIN99  RETURN
.
.------------------------------------------------------------
. Link to Next set of Health Funds 
.------------------------------------------------------------
NEXTHG00  MOVE      NORECORD,KEY2
          REP       " +",KEY2
          ASSIGN    STARTNUM+NORECORD,F3
          MOVE      F3,KEY3
          REP       " +",KEY3
          UNPACK    DIM127,D1,FLDPARA,DIM127
          MOVE      REPORTNO,F1
          REP       " +",STARTKEY 
          REP       " +",FILTHGRP
          REP       " +",FILTACTV
.
          WRITE     HTMLFILE;"patweb87.pbl":
                                 "?reportno=",F1:
                                 "&template=",FLDPARA:
                                 "&startnum=",KEY3:
                                 "&norecord=",KEY2:
                                 "&startkey=",STARTKEY:
                                 "&filthgrp=",FILTHGRP:
                                 "&filtactv=",FILTACTV;
.
          MATCH     "1",MENUFLAG
          IF        @EQUAL
            WRITE     HTMLFILE;"&menuflag=1";
          ENDIF
.
          REP       "+ ",STARTKEY 
          REP       "+ ",FILTHGRP
          REP       "+ ",FILTACTV
.
NEXTHG99  RETURN
.-------------------------------------------------------------------------------
. Link to previous set of Health Funds
.-------------------------------------------------------------------------------
PREVHG00  MOVE      NORECORD,KEY2
          REP       " +",KEY2
          ASSIGN    STARTNUM-NORECORD,F3
          IF        F3<0
            MOVE    ZERO,F3
          ENDIF
          MOVE      F3,KEY3
          REP       " +",KEY3
          UNPACK    DIM127,D1,FLDPARA,DIM127
          MOVE      REPORTNO,F1
          REP       " +",STARTKEY 
          REP       " +",FILTHGRP
          REP       " +",FILTACTV
.
          WRITE     HTMLFILE;"patweb87.pbl":
                                 "?reportno=",F1:
                                 "&template=",FLDPARA:
                                 "&startnum=",KEY3:
                                 "&norecord=",KEY2:
                                 "&startkey=",STARTKEY:
                                 "&filthgrp=",FILTHGRP:
                                 "&filtactv=",FILTACTV;
.
          MATCH     "1",MENUFLAG
          IF        @EQUAL
            WRITE     HTMLFILE;"&menuflag=1";
          ENDIF
.
          REP       "+ ",STARTKEY 
          REP       "+ ",FILTHGRP
          REP       "+ ",FILTACTV
.
PREVHG99  RETURN
.
.------------------------------------------------------------
. Health Fund Group Table
.------------------------------------------------------------
GPTAB000  UNPACK    DIM127,D1,LINKPRG,DIM127
          UNPACK    DIM127,D1,LINKREP,DIM127
          UNPACK    DIM127,D1,LINKTEM,DIM127
.
          CALL      GPHED000      * Output Table Heading
.
          IF        NORECORD=0
            MOVE      PTCNNRTD,NORECORD     * Set Default No Records to Display
          ENDIF
          MOVE      ZERO,RECNUMB
          MOVE      ZERO,DISNUMB
.
          PACK      KEY6,STARTKEY,SP70
          CALL      RSPAHGP1
          IF        OVRCD=0
            CALL      RPPAHGP1
          ENDIF
GPTAB100  CALL      RKPAHGP1
          BRANCH    OVRCD,GPTAB900
.
          ADD       ONE,RECNUMB
          IF        STARTNUM>=RECNUMB
            GOTO      GPTAB100
          ENDIF
.
          CALL      GPROWA00      * Health Fund Group Row
          ADD       ONE,DISNUMB
          COMPARE   NORECORD,DISNUMB
          GOTO      GPTAB100 IF NOT EQUAL
          GOTO      GPTAB999
.
GPTAB900  CALL      NOMORE00      * Display No More Records Message
.
GPTAB999  RETURN
.------------------------------------------------------------
. Health Fund Group (TABLE HEADING)
.------------------------------------------------------------
GPHED000  WRITE     HTMLFILE;"<tr>":
                               "<td class=HeadingCell width=25%>":
                               "<b>Group Code</b></td>":
                               "<td class=HeadingCell>":
                               "<b>Group Description</b></td>":
                             "</tr>"
.
GPHED999  RETURN
.------------------------------------------------------------
. Health Fund Group (TABLE ROW)
.------------------------------------------------------------
GPROWA00  WRITE     HTMLFILE;"<tr><td nowrap><A HREF='javascript:ShowDetail01":
                             "(#"",LINKPRG,"#.pbl":
                             "?reportno=",LINKREP:
                             "&template=",LINKTEM:
                             "&hfgrp001=",PTHGCODE,"#")'>":
                             "<img src=../images/MaintenanceIcon.gif hspace=4":
                             " border=0 align=absmiddle></a>":
                             PTHGCODE,"</td>":
                             "<td>",PTHGDESC,"</td>":
                             "</tr>"
.
GPROWA99 RETURN
.------------------------------------------------------------
. Health Fund Maintenance 
.------------------------------------------------------------
HFTAB000  UNPACK    DIM127,D1,LINKPRG,DIM127
          UNPACK    DIM127,D1,LINKREP,DIM127
          UNPACK    DIM127,D1,LINKTEM,DIM127
.
          CALL      HFHED000      * Output Table Heading
.
          IF        NORECORD=0
            MOVE      PTCNNRTD,NORECORD     * Set Default No Records to Display
          ENDIF
          MOVE      ZERO,RECNUMB
          MOVE      ZERO,DISNUMB
.
          PACK      KEY14,STARTKEY,ZERO8,SP70
          CALL      RDSFUND1
          IF        OVRCD=0
            CALL      RDPFUND1
          ENDIF 
HFTAB100  CALL      RDKFUND1
          BRANCH    OVRCD,HFTAB900
.
          MATCH     ZERO8,HFTABL
          GOTO      HFTAB100 IF NOT EQUAL
.
          MATCH     SP70,FILTHGRP           * HF Group Filter use?
          IF        !@EQUAL
            MATCH     "All",FILTHGRP
            IF        !@EQUAL
              MATCH     FILTHGRP,PTHFHGRP     * Same HF Group?
              GOTO      HFTAB100 IF NOT EQUAL * No, read next record
            ENDIF
          ENDIF
.
          MATCH     SP70,FILTACTV           * Active status Filter use?
          IF        !@EQUAL
            MATCH     FILTACTV,DHFTACT      * Same Active status ?
            GOTO      HFTAB100 IF NOT EQUAL * No, read next record
          ENDIF
.
          ADD       ONE,RECNUMB
          IF        STARTNUM>=RECNUMB
            GOTO      HFTAB100
          ENDIF
.
          PACK      KEY6,HCODE,SP70
          CALL      RDPTFX11
          IF        OVRCD=1
            CALL      CLRHFX00     * Clear all the ext file variables
          ENDIF
.
          CALL      HFROWA00      * Health Fund Row
          ADD       ONE,DISNUMB
          COMPARE   NORECORD,DISNUMB
          GOTO      HFTAB100 IF NOT EQUAL
          GOTO      HFTAB999
.
HFTAB900  CALL      NOMORE00       * Display No More Records Message
.
HFTAB999  RETURN
.------------------------------------------------------------
. Health Fund Maintenance (TABLE HEADING)
.------------------------------------------------------------
HFHED000  WRITE     HTMLFILE;"<tr>":
                               "<td class=HeadingCell>";
.
          IF        CFEETYP<>5
            WRITE     HTMLFILE;"<b>Fund Code</b></td>";
          ELSE
            WRITE     HTMLFILE;"<b>Contract Code</b></td>";
          ENDIF
.
          WRITE     HTMLFILE;"<td class=HeadingCell>":
                               "<b>Description</b></td>":
                             "<td class=HeadingCell>":
                               "<b>HF Group</b></td>";
.
          MATCH     "1",PTCNDGED       * DRG Effective Dates enabled?
          GOTO      HFHED100 IF EQUAL
.
          COMPARE   ONE,PTCNHDPS       * New Zealand?
          GOTO      HFHED100 IF EQUAL
.
          WRITE     HTMLFILE;"<td class=HeadingCell>":
                               "<b>Grouper Version</b></td>";
.
HFHED100  WRITE     HTMLFILE;"<td class=HeadingCell>":
                               "<b>Theatre Charging</b></td>":
                             "<td class=HeadingCell>":
                               "<b>On Hold Description</b></td>":
                             "<td class=HeadingCell>":
                               "<b>Active/Inactive</b></td>":
                             "</tr>"
.
HFHED999  RETURN
.------------------------------------------------------------
. Health Fund Maintenance (TABLE ROW)
.------------------------------------------------------------
HFROWA00  BRANCH    USEFHINV,HFROWA20
.
          MOVE      ZERO,OVRCD               * assume file exists
          TRAP      OVERCOND IF IO           * trap for error openning file
          OPEN      PATFHIA3,"patfhiaf"      * open HF On Hold Invoice file
          TRAPCLR   IO
          BRANCH    OVRCD,HFROWA20
.
          PACK      KEY11,HCODE,SP70
          CALL      RSPTFHI3
HFROWA10  CALL      RKPTFHI3
          BRANCH    OVRCD,HFROWA20
.
          MATCH     HCODE,PTFHHFND
          GOTO      HFROWA20 IF NOT EQUAL
.
          MOVE      PTFHHREA,PTFXRHCD        * reason for Hold invoice
.
HFROWA20  MOVE      "rh",CATEGORY
          MOVE      PTFXRHCD,CODE
          CALL      GETCOD00
          MATCH     SP70,TDESC
          IF        @EQUAL
            MOVE      "&nbsp;",TDESC        * description for on hold reason
          ENDIF
.
          PACK      DIM1P1,SP70
          MATCH     SP70,PTHFGRPV
          IF        !@EQUAL
            MOVE      PTHFGRPV,FORM3
            ASSIGN    (FORM3/10),FORM1P1
            MOVE      FORM1P1,DIM1P1
          ENDIF
.
          MOVE      "Active",KEY8
          MATCH     "1",DHFTACT
          IF        @EQUAL
            MOVE      "Inactive",KEY8
          ENDIF
.
          WRITE     HTMLFILE;"<tr><td nowrap><A HREF='javascript:ShowDetail02":
                             "(#"",LINKPRG,"#.pbl":
                             "?reportno=",LINKREP:
                             "&template=",LINKTEM;
.
          MATCH     "1",MENUFLAG
          IF        @EQUAL
            WRITE     HTMLFILE;"&menuflag=1";
          ENDIF
.
          WRITE     HTMLFILE;"&hfund001=",HCODE,"#")'>":
                             "<img src=../images/MaintenanceIcon.gif hspace=4":
                             " border=0 align=absmiddle></a>":
                             HCODE,"</td>":
                             "<td>&nbsp;",HFNAME,"</td>":
                             "<td>&nbsp;",PTHFHGRP,"</td>";
.
          MATCH     "1",PTCNDGED       * DRG Effective Dates enabled?
          GOTO      HFROWA40 IF EQUAL
.
          COMPARE   ONE,PTCNHDPS       * New Zealand?
          GOTO      HFROWA40 IF EQUAL
.
          WRITE     HTMLFILE;"<td>&nbsp;",DIM1P1,"</td>";
.
HFROWA40  WRITE     HTMLFILE;"<td>&nbsp;Class.",HFBAND,"</td>":
                             "<td>&nbsp;",TDESC,"<br>&nbsp;",PTFXRHFT,"</td>":
                             "<td>&nbsp;",KEY8,"</td>":
                             "</tr>"
.
HFROWA99 RETURN
.------------------------------------------------------------
. Health Fund Table Maintenance 
.------------------------------------------------------------
FTTAB000  UNPACK    DIM127,D1,LINKPRG,DIM127
          UNPACK    DIM127,D1,LINKREP,DIM127
          UNPACK    DIM127,D1,LINKTEM,DIM127
.
          CALL      FTHED000      * Output Table Heading
.
          IF        NORECORD=0
            MOVE      PTCNNRTD,NORECORD     * Set Default No Records to Display
          ENDIF
          MOVE      ZERO,RECNUMB
          MOVE      ZERO,DISNUMB
.
          PACK      KEY14,FUNDCODE,STARTKEY,SP70
          CALL      RDSFUND1
          IF        OVRCD=0
            CALL      RDPFUND1
          ENDIF 
FTTAB100  CALL      RDKFUND1
          BRANCH    OVRCD,FTTAB900
.
          MATCH     FUNDCODE,HCODE
          GOTO      FTTAB900 IF NOT EQUAL
          MATCH     HFTABL,ZERO8
          GOTO      FTTAB100 IF EQUAL
.
          ADD       ONE,RECNUMB
          IF        STARTNUM>=RECNUMB
            GOTO      FTTAB100
          ENDIF
.
          CALL      FTROWA00      * Health Fund Table Row
          ADD       ONE,DISNUMB
          COMPARE   NORECORD,DISNUMB
          GOTO      FTTAB100 IF NOT EQUAL
          GOTO      FTTAB999
.
FTTAB900  CALL      NOMORE00      * Display No More Records Message
.
FTTAB999  RETURN
.------------------------------------------------------------
. Health Fund Table Maintenance (TABLE HEADING)
.------------------------------------------------------------
FTHED000  WRITE     HTMLFILE;"<tr>":
                               "<td class=HeadingCell width=15%>":
                               "<b>Table Code</b></td>":
                               "<td class=HeadingCell>":
                               "<b>Table Description</b></td>":
                               "<td class=HeadingCell>":
                               "<b>Table Type</b></td>":
                               "<td class=HeadingCell>":
                               "<b>HDP Equivalent</b></td>":
                               "<td class=HeadingCell>":
                               "<b>Active</b></td>":
                             "</tr>"
.
FTHED999  RETURN
.------------------------------------------------------------
. Health Fund Table Maintenance (TABLE ROW)
.------------------------------------------------------------
FTROWA00  MOVE      "HT",CATEGORY  * get Cat description  
          MOVE      PTHFBCAT,CODE
          CALL      GETCOD00
          MATCH     SP70,TDESC
          IF        @EQUAL
            MOVE      "&nbsp;",TDESC
          ENDIF 
.
          MATCH     SP70,HFNAME
          IF        @EQUAL 
            MOVE      "&nbsp;",HFNAME
          ENDIF 
.
          MATCH     SP70,HFHDPE
          IF        @EQUAL 
            MOVE      "&nbsp;",KEY6
          ELSE
            MOVE      HFHDPE,KEY6
          ENDIF 
.
          MATCH     "1",DHFTACT
          IF        @EQUAL 
            MOVE      "No",KEY3
          ELSE
            MOVE      "Yes",KEY3
          ENDIF 
.
          WRITE     HTMLFILE;"<tr><td nowrap><A HREF='javascript:ShowDetail03":
                             "(#"",LINKPRG,"#.pbl":
                             "?reportno=",LINKREP:
                             "&template=",LINKTEM;
.
          MATCH     "1",MENUFLAG
          IF        @EQUAL
            WRITE     HTMLFILE;"&menuflag=1";
          ENDIF
.
          WRITE     HTMLFILE;"&hftab001=",HCODE:
                             "&hftab002=",HFTABL,"#")'>":
                             "<img src=../images/MaintenanceIcon.gif hspace=4":
                             " border=0 align=absmiddle></a>":
                             HFTABL,"</td>":
                             "<td>",HFNAME,"</td>":
                             "<td>",TDESC,"</td>":
                             "<td>",KEY6,"</td>":
                             "<td>",KEY3,"</td>":
                             "</tr>"
.
FTROWA99 RETURN
.-----------------------------------------------------------
. Health Fund Table: Search 
.-----------------------------------------------------------
SPTHFA00  IF        LNK2PRT = THREE
            WRITE     HTMLFILE;"<tr align=center>":
                               "<td class=HeadingCell colspan=2>":
                               "<b>You Searched for ",KEYWORDS,"</td>":
                               "</tr>":
                               "<tr>":
                               "<td class=HeadingCell width=30%>";
            IF        PTCNHDPS=1
              WRITE     HTMLFILE;"<b>Contract</b></td>";
            ELSE
              WRITE     HTMLFILE;"<b>Health Fund</b></td>";
            ENDIF
            WRITE     HTMLFILE;"<td class=HeadingCell width=70%>":
                               "<b>Fund Description</b></td>":
                             "</tr>"
          ELSE
            IF        LNK2PRT = FOUR
              WRITE     HTMLFILE;"<tr align=center>":
                                 "<td class=HeadingCell colspan=4>":
                                 "<b>You Searched for ",KEYWORDS,"</td>":
                                 "</tr>":
                                 "<tr>":
                                 "<td class=HeadingCell width=13%>";
              IF        PTCNHDPS=1
                WRITE     HTMLFILE;"<b>Contract</b></td>";
              ELSE
                WRITE     HTMLFILE;"<b>Health Fund</b></td>";
              ENDIF
              WRITE     HTMLFILE;"<td class=HeadingCell width=40%>":
                                 "<b>Fund Description</b></td>":
                                 "<td class=HeadingCell width=10%>":
                                 "<b>Table Type</b></td>":
                                 "<td class=HeadingCell width=35%>":
                                 "<b>Table Type Description</b></td>":
                               "</tr>"
            ELSE
              WRITE     HTMLFILE;"<tr align=center>":
                                 "<td class=HeadingCell colspan=4>":
                                 "<b>You Searched for ",KEYWORDS,"</td>":
                                 "</tr>": 
                                 "<tr>":
                                 "<td class=HeadingCell width=13%>";
              IF        PTCNHDPS=1
                WRITE     HTMLFILE;"<b>Contract</b></td>";
              ELSE
                WRITE     HTMLFILE;"<b>Health Fund</b></td>";
              ENDIF
              WRITE     HTMLFILE;"<td class=HeadingCell width=40%>":
                                 "<b>Fund Description</b></td>":
                                 "<td class=HeadingCell width=10%>":
                                 "<b>Table Code</b></td>":
                                 "<td class=HeadingCell width=35%>":
                                 "<b>Table Description</b></td>":
                               "</tr>"
            ENDIF
          ENDIF
.
          CALL      GETWRD00
.
          UNPACK    DIM127,D1,LINKPRG,DIM127
          UNPACK    DIM127,D1,LINKREP,DIM127
          UNPACK    DIM127,D1,LINKTEM,DIM127
.
          IF        NORECORD=0
            MOVE      PTCNNRTD,NORECORD     * Set Default No Records to Display
          ENDIF
          MOVE      ZERO,RECNUMB
          MOVE      ZERO,DISNUMB
.
          STRIP     KEYWRD01
          PACK      KEY29,KEYWRD01,SP70
          CALL      RSPTHF2
SPTHFA10  CALL      RKPTHF2
          BRANCH    OVRCD,SPTHFA90
.
          IF        LNK2PRT = THREE
            MATCH     ZERO8,PTHFTAB
            GOTO      SPTHFA10 IF NOT EQUAL
          ELSE
            MATCH     ZERO8,PTHFTAB
            GOTO      SPTHFA10 IF EQUAL
          ENDIF
.
          CALL      SPTHFB00
          BRANCH    OVRCD,SPTHFA10,SPTHFA90
.
          PACK      KEY14,PTHFFUN,ZERO8,SP70
          CALL      RDFUND1
          MOVE      HFNAME,FUNDNAME

          COMPARE   ONE,PHFTACT             * Health fund table inactive?
          GOTO      SPTHFA10 IF EQUAL       * Yes, read next record
.
          PACK      KEY14,PTHFFUN,PTHFTAB,SP70
          CALL      RDFUND1
          IF        PTCNHDPS=1
            BRANCH    OVRCD,SPTHFA15
          ELSE
            BRANCH    OVRCD,SPTHFA10
          ENDIF
.
          COMPARE   ONE,PHFTACT             * Health fund table inactive?
          GOTO      SPTHFA10 IF EQUAL       * Yes, read next record
.
SPTHFA15  ADD       ONE,RECNUMB
          IF        STARTNUM>=RECNUMB
            GOTO      SPTHFA10
          ENDIF
.
          MATCH     SP70,FUNDNAME
          IF        @EQUAL
            MOVE      "&nbsp;",FUNDNAME
          ENDIF
          MATCH     SP70,HFNAME
          IF        @EQUAL
            MOVE      "&nbsp;",HFNAME
          ENDIF
.
          BRANCH    LNK2PRT,SPTHFA20,SPTHFA30,SPTHFA40,SPTHFA50
.
          WRITE     HTMLFILE;"<tr><td nowrap><A HREF='javascript:showFund(#"":
                              LINKPRG,"#.pbl":
                              "?reportno=",LINKREP:
                              "&template=",LINKTEM:
                              "&hfund001=",HCODE:
                              "&hfund002=",FUNDNAME:
                              "&hftab002=",HFTABL:
                              "&hftab003=",HFNAME,"#")'>":
                              "<img src=../images/MaintenanceIcon.gif hspace=4":
                              " border=0 align=absmiddle></a>":
                              HCODE,"<td>",FUNDNAME,"</td>":
                              "<td>",HFTABL,"</td>","<td>",HFNAME,"</td>":
                              "</tr>"
.
          GOTO      SPTHFA80
.
SPTHFA20  WRITE     HTMLFILE;"<tr><td nowrap>":
                             "<A HREF=#"javascript:updateParent(#'":
                              HCODE,"','",FUNDNAME:
                              "','",HFTABL,"','",HFNAME,"')#">":
                              "<img src=../images/MaintenanceIcon.gif hspace=4":
                              " border=0 align=absmiddle></a>":
                              HCODE,"<td>",FUNDNAME,"</td>":
                              "<td>",HFTABL,"</td>","<td>",HFNAME,"</td>":
                              "</tr>"
.
          GOTO      SPTHFA80
.
SPTHFA30  WRITE     HTMLFILE;"<tr><td nowrap>":
                             "<A HREF=#"javascript:updateParent(#'":
                              HCODE,"','",FUNDNAME:
                              "','",HFTABL,"','",HFNAME,"','",HFBAND,"')#">":
                              "<img src=../images/MaintenanceIcon.gif hspace=4":
                              " border=0 align=absmiddle></a>":
                              HCODE,"<td>",FUNDNAME,"</td>":
                              "<td>",HFTABL,"</td>","<td>",HFNAME,"</td>":
                              "</tr>"
          GOTO      SPTHFA80
.
SPTHFA40  WRITE     HTMLFILE;"<tr><td nowrap>":
                             "<A HREF=#"javascript:updateParent(#'":
                              HCODE,"','",FUNDNAME:
                              "')#">":
                              "<img src=../images/MaintenanceIcon.gif hspace=4":
                              " border=0 align=absmiddle></a>":
                              HCODE,"<td>",FUNDNAME,"</td>":
                              "</tr>"
.
          GOTO      SPTHFA80
.
SPTHFA50  MOVE      SP70,TDESC
.
          MATCH     SP70,PTHFBCAT
          IF        !@EQUAL & !@EOS
            MOVE      "HT",CATEGORY
            MOVE      PTHFBCAT,CODE
            CALL      GETCOD00
          ENDIF
.
          WRITE     HTMLFILE;"<tr><td nowrap>":
                             "<A HREF=#"javascript:updateParent(#'":
                              HCODE,"','",FUNDNAME,"','",HFTABL,"','",HFNAME:
                              "','",HFBAND,"','",PTHFBCAT,"')#">":
                              "<img src=../images/MaintenanceIcon.gif hspace=4":
                              " border=0 align=absmiddle></a>":
                              HCODE,"<td>",FUNDNAME,"</td>";
.
          MATCH     SP70,PTHFBCAT
          IF        @EQUAL|@EOS
            WRITE     HTMLFILE;"<td>&nbsp;</td>","<td>&nbsp;</td>":
                               "</tr>";
          ELSE
            WRITE     HTMLFILE;"<td>",PTHFBCAT,"</td>","<td>",TDESC,"</td>":
                               "</tr>";
          ENDIF
          GOTO      SPTHFA80
.
SPTHFA80  ADD       ONE,DISNUMB
          COMPARE   NORECORD,DISNUMB
          GOTO      SPTHFA10 IF NOT EQUAL
.
SPTHFA90
.
SPTHFA99  RETURN
.------------------------------------------------------------
. Check Health Fund Table Record
.------------------------------------------------------------
SPTHFB00  MATCH     KEYWRD01,PTHFKWD
          GOTO      SPTHFB92 IF NOT EQUAL
          IF        KEYWRDNO>1
            PACK      SAVKEY29,PTHFKWD,PTHFFUN,PTHFTAB
            CALL      SPTHFC00
            BRANCH    EXIT,SPTHFB91
            MOVE      SAVKEY29,KEY29
            CALL      RDPTHF2
          ENDIF
.
. Insert Other Check for Valid Record Here i.e. Suspended or In Active
.   eg    COMPARE    ONE,INACTIVE
.         GOTO       SPTHFB91 IF EQUAL
.
          GOTO      SPTHFB90
.
.
SPTHFB90  MOVE      ZERO,OVRCD
          GOTO      SPTHFB99
SPTHFB91  MOVE      ONE,OVRCD
          GOTO      SPTHFB99
SPTHFB92  MOVE      TWO,OVRCD
SPTHFB99  RETURN
.------------------------------------------------------------
. Check for Matching Health Fund Table Words
.------------------------------------------------------------
SPTHFC00  MOVE      ONE,F2
          MOVE      ZERO,EXIT
          PACK      SAVKEY14,PTHFFUN,PTHFTAB,SP70
.
SPTHFC10  COMPARE   KEYWRDNO,F2           * Loop through each Key Word in Search
          GOTO      SPTHFC99 IF EQUAL     * Exit OK
          ADD       ONE,F2
          LOAD      KEYWRDXX,F2,KEYWRD01,KEYWRD02,KEYWRD03,KEYWRD04,KEYWRD05:
                             KEYWRD06,KEYWRD07,KEYWRD08,KEYWRD09,KEYWRD10
          PACK      KEY29,PTHFFUN,PTHFTAB,KEYWRDXX
          CALL      RDPTHF1               * Check for Exact Match
          COMPARE   ZERO,OVRCD            * Ok so Continue Loop
          GOTO      SPTHFC10 IF EQUAL
.
          CALL      RKPTHF1               * Not Exact so Read Next Record
          BRANCH    OVRCD,SPTHFC90        * No Match So Exit No Match
          PACK      KEY14,PTHFFUN,PTHFTAB,SP70
          MATCH     SAVKEY14,KEY14        * Match Key Fields
          GOTO      SPTHFC90 IF NOT EQUAL * No Match So Exit
          STRIP     KEYWRDXX
          MATCH     PTHFKWD,KEYWRDXX         * Check Key Word
          GOTO      SPTHFC90 IF NOT EQUAL * No Match So Exit
          GOTO      SPTHFC10              * Check Next Search Word
.
SPTHFC90  MOVE      ONE,EXIT
SPTHFC99  RETURN
.------------------------------------------------------------
. Allowance Code Maintenance 
.------------------------------------------------------------
ALTAB000  UNPACK    DIM127,D1,LINKPRG,DIM127
          UNPACK    DIM127,D1,LINKREP,DIM127
          UNPACK    DIM127,D1,LINKTEM,DIM127
.
          CALL      ALHED000      * Output Table Heading
.
          IF        NORECORD=0
            MOVE      PTCNNRTD,NORECORD     * Set Default No Records to Display
          ENDIF
          MOVE      ZERO,RECNUMB
          MOVE      ZERO,DISNUMB
.
          PACK      KEY2,STARTKEY,PTALW001,SP70
          CALL      RDALLW1
          IF        OVRCD=0
            CALL      RDPALLW1
          ENDIF 
ALTAB100  CALL      RDKALLW1
          BRANCH    OVRCD,ALTAB900
.
          ADD       ONE,RECNUMB
          IF        STARTNUM>=RECNUMB
            GOTO      ALTAB100
          ENDIF
.
          CALL      ALROWA00      *  Table Row
          ADD       ONE,DISNUMB
          COMPARE   NORECORD,DISNUMB
          GOTO      ALTAB100 IF NOT EQUAL
          GOTO      ALTAB999
.
ALTAB900  CALL      NOMORE00      * Display No More Records Message
.
ALTAB999  RETURN
.------------------------------------------------------------
. Allowance Code Maintenance (TABLE HEADING)
.------------------------------------------------------------
ALHED000  WRITE     HTMLFILE;"<tr>":
                               "<td class=HeadingCell width=15%>":
                               "<b>Allowance Code</b></td>":
                               "<td class=HeadingCell>":
                               "<b>Description</b></td>":
                               "<td class=HeadingCell>":
                               "<b>Amount</b></td>":
                             "</tr>"
.
ALHED999  RETURN
.------------------------------------------------------------
. Allowance Code Maintenance (TABLE ROW)
.------------------------------------------------------------
ALROWA00  MATCH     SP70,ALWDESC
          IF        @EQUAL
            MOVE      "&nbsp;",ALWDESC
          ENDIF 
.
          WRITE     HTMLFILE;"<tr><td nowrap><A HREF='javascript:ShowDetail05":
                             "(#"",LINKPRG,"#.pbl":
                             "?reportno=",LINKREP:
                             "&template=",LINKTEM:
                             "&ptalw001=",ALWCODE,"#")'>":
                             "<img src=../images/MaintenanceIcon.gif hspace=4":
                             " border=0 align=absmiddle></a>":
                             ALWCODE,"</td>":
                             "<td>",ALWDESC,"</td>":
                             "<td>",ALWAMT,"</td>":
                             "</tr>"
.
ALROWA99 RETURN
.------------------------------------------------------------
. Insurance Code Maintenance 
.------------------------------------------------------------
ISTAB000  UNPACK    DIM127,D1,LINKPRG,DIM127
          UNPACK    DIM127,D1,LINKREP,DIM127
          UNPACK    DIM127,D1,LINKTEM,DIM127
          UNPACK    DIM127,D1,IACTIVE,DIM127   * indicator to show inactives
.
          CALL      ISHED000      * Output Table Heading   
.
          IF        NORECORD=0
            MOVE      PTCNNRTD,NORECORD     * Set Default No Records to Display
          ENDIF
          MOVE      ZERO,RECNUMB
          MOVE      ZERO,DISNUMB
.
          PACK      KEY6,STARTKEY,PTINS001,SP70
          CALL      RDINSR1
          IF        OVRCD=0
            CALL      RDPINSR1
          ENDIF 
ISTAB100  CALL      RDKINSR1
          BRANCH    OVRCD,ISTAB900
.
          ADD       ONE,RECNUMB
          IF        STARTNUM>=RECNUMB
            GOTO      ISTAB100
          ENDIF
.
          CALL      ISROWA00      *  Table Row
          COMPARE   NORECORD,DISNUMB
          GOTO      ISTAB100 IF NOT EQUAL
          GOTO      ISTAB999
.
ISTAB900  CALL      NOMORE00      * Display No More Records Message
.
ISTAB999  RETURN
.------------------------------------------------------------
. Insurance Code Keyword Search list 
.------------------------------------------------------------
ISTABK00  UNPACK    DIM127,D1,LINKPRG,DIM127
          UNPACK    DIM127,D1,LINKREP,DIM127
          UNPACK    DIM127,D1,LINKTEM,DIM127 
.
          CALL      ISHEDK00               * Output Table Heading
.          
          IF        NORECORD=0
            MOVE      PTCNNRTD,NORECORD    * Set Default No Records to Display
          ENDIF  
          MOVE      ZERO,RECNUMB
          MOVE      ZERO,DISNUMB
.
          STRIP     STARTKEY
          PACK      KEY21,STARTKEY,SP70
          CALL      RSPTKIC2
          IF        OVRCD = 0
            CALL     RPPTKIC2
          ENDIF
ISTABK10  CALL      RKPTKIC2
          BRANCH    OVRCD,ISTABK90 
.
          PACK      KEY6,PTKICODE
          CALL      RDINSR1
          BRANCH    OVRCD,ISTABK10
          MATCH     STARTKEY,PTKIKWRD
          GOTO      ISTABK99 IF NOT EQUAL          
.
          ADD       ONE,RECNUMB
          IF        STARTNUM>=RECNUMB
            GOTO      ISTABK10
          ENDIF
.
          CALL      ISROWK00                  *  Table Row
          COMPARE   NORECORD,DISNUMB
          GOTO      ISTABK10 IF NOT EQUAL
          GOTO      ISTABK99
.
ISTABK90  CALL      NOMORE00                  * Display No More Records Message
.
ISTABK99  RETURN
.------------------------------------------------------------
. Insurance Code Maintenance (TABLE HEADING)
.------------------------------------------------------------
ISHED000  WRITE     HTMLFILE;"<tr>":
                               "<td class=HeadingCell width=15%>":
                               "<b>Insurance Code</b></td>":
                               "<td class=HeadingCell>":
                               "<b>Description</b></td>":
                               "<td class=HeadingCell width=5%>":
                               "<b>Active</b></td>":
                             "</tr>"
.
ISHED999  RETURN
.------------------------------------------------------------
. Insurance Code Keyword Search list (TABLE HEADING)
.------------------------------------------------------------
ISHEDK00  WRITE     HTMLFILE;"<tr>":
                               "<td class=HeadingCell width=8%>":
                               "Insurance Code</td>":
                               "<td class=HeadingCell width=22%>":
                               "Insurance Name</td>":
                               "<td class=HeadingCell width=25%>":
                               "Address</td>":
                               "<td class=HeadingCell width=15%>":
                               "Contact</td>":
                               "<td class=HeadingCell width=15%>":
                               "Phone</td>":
                               "<td class=HeadingCell width=5%>":
                               "Status</td>":
                             "</tr>"
.
ISHEDK99  RETURN
.------------------------------------------------------------
. Insurance Code Maintenance (TABLE ROW)
.------------------------------------------------------------
ISROWA00  MATCH     SP70,INAME  
          IF        @EQUAL
            MOVE      "&nbsp;",INAME  
          ENDIF 
.
          MOVE      "Yes",KEY3
          MATCH     "1",PTINACTV
          IF        @EQUAL
            MOVE      "No ",KEY3
          ENDIF

.
          BRANCH    LINK2PRT,ISROWA10
.
          WRITE     HTMLFILE;"<tr><td nowrap><A HREF='javascript:ShowDetail06":
                             "(#"",LINKPRG,"#.pbl":
                             "?reportno=",LINKREP:
                             "&template=",LINKTEM:
                             "&ptins001=",ICODE,"#")'>":
                             "<img src=../images/MaintenanceIcon.gif hspace=4":
                             " border=0 align=absmiddle></a>":
                             ICODE,"</td>":
                             "<td>",INAME,"</td>":
                             "<td>",KEY3,"</td>":
                             "</tr>"
          ADD       ONE,DISNUMB
          GOTO      ISROWA99
.
ISROWA10  MOVE      INAME,JAVSNAME   * String to Convert
          CALL      JAVDES00         * Remove "'" replace with "%60"
.
          MATCH     "1",IACTIVE      * indicator to show inactives 
          IF        @EQUAL
            MATCH     "1",PTINACTV
            IF        @EQUAL
              GOTO      ISROWA99
            ENDIF
          ENDIF
.
          WRITE     HTMLFILE;"<tr valign=top>":
                              "<td><a href=#"":
                              "javascript:UpdateParent('",ICODE:
                              "','",JAVSNAME,"')#">":
                              ICODE,"</a></td><td>",INAME,"</td>":
                              "<td>",KEY3,"</td></tr>";
          ADD       ONE,DISNUMB
.
ISROWA99 RETURN
.------------------------------------------------------------
. Insurance Code Keyword Search (TABLE ROW)
.------------------------------------------------------------
ISROWK00  MATCH     SP70,INAME
          IF        @EQUAL
            MOVE      "&nbsp;",INAME
          ENDIF
.
          MOVE      INAME,JAVSNAME   * String to Convert
          CALL      JAVDES00         * Remove "'" replace with "%60"
.
          MOVE      SP70,DIM60A
          REP       "' , ",IADD1
          STRIP     IADD1
          STRIP     IADD2
          STRIP     IADD3
          STRIP     IADD4
          STRIP     IPOST
          PACK      DIM60A,IADD1,SP2,IADD2,SP2,IADD3,SP2,IADD4,SP2,IPOST
.
          WRITE     HTMLFILE;"<tr valign=top>":
                              "<td><a href=#"":
                              "javascript:updateParent('",ICODE:
                              "','",JAVSNAME,"','",PTINACTV,"')#">":
                              "<img src=../images/MaintenanceIcon.gif hspace=4":
                             " border=0 align=absmiddle></a>":
                              ICODE,"</a></td><td>",INAME,"</td>":
                              "<td>&nbsp;",DIM60A,"</td>": 
                              "<td>&nbsp;",ICONT,"</td>": 
                              "<td>&nbsp;",ITELEB,"</td>"; 
.
          MATCH     "1",PTINACTV
          IF        @EQUAL
            WRITE     HTMLFILE;"<td class=RedText>Inactive</td></tr>";
          ELSE
            WRITE     HTMLFILE;"<td>Active</td></tr>";
          ENDIF
.
          ADD       ONE,DISNUMB
.
ISROWK99 RETURN
.------------------------------------------------------------
. Format Description/Name (for Javascript)
.*** format the surname and given name by changing any ' to %60
.---------------------------------------------------------------
JAVDES00  SCAN      "'",JAVSNAME             * find any apostrophies
          GOTO      JAVDES99 IF NOT EQUAL
.
          MOVE      JAVSNAME,ENDNAME
          REP       "' ",ENDNAME             * remove the apostrophy
.
          LENSET    JAVSNAME
          RESET     JAVSNAME                 * get all characters before '
          MOVE      JAVSNAME,STRTNAME
.
          REP       "'%",STRTNAME
          STRIP     STRTNAME
          PACK      JAVSNAME,STRTNAME,SIXTY,ENDNAME,SP70 * formatted string
.
JAVDES99  RETURN
.
.------------------------------------------------------------
. Health Fund Group Maintenance
.------------------------------------------------------------
GRPFND00  RESET     UPDTTYPE
          MATCH     SP1,UPDTTYPE
          GOTO      GRPFND40 IF EQUAL
.
          MATCH     "A",UPDTTYPE    * Add formaction
          GOTO      GRPFND10 IF EQUAL
.
          MATCH     "U",UPDTTYPE    * Update formaction
          GOTO      GRPFND20 IF EQUAL
.
          MATCH     "D",UPDTTYPE    * Delete formaction
          GOTO      GRPFND30 IF EQUAL
.
          GOTO      GRPFND93
.
GRPFND10  RESET     HFGRP001
          PACK      KEY6,HFGRP001,SP70
          CALL      RDPAHGP1
          COMPARE   ZERO,OVRCD
          GOTO      GRPFND92 IF EQUAL
          CALL      CHKGRP00      * Checks mandatory fields
          BRANCH    EXIT,GRPFND99
          CALL      GRPSAV00      * Moves input variables to file variables
          PACK      KEY6,HFGRP001,SP70
          CALL      WRPAHGP1       * Writes away the data
.
          MOVE      ZERO,EXIT
          GOTO      GRPFND99
.
GRPFND20  PACK      KEY6,HFGRP001,SP70
          CALL      RDPAHGP1
          BRANCH    OVRCD,GRPFND91
          CALL      CHKGRP00      * Checks mandatory fields
          BRANCH    EXIT,GRPFND99
          CALL      GRPSAV00      * Moves input variables to file variables
          CALL      UPPAHGP1      * Writes away the data
.
          CALL      UPHLD0000      * Update HF On Hold invoice
          BRANCH    EXIT,GRPFND94
.
          MOVE      ZERO,EXIT
          GOTO      GRPFND99
.
GRPFND30  PACK      KEY6,HFGRP001,SP70
          CALL      RDPAHGP1
          BRANCH    OVRCD,GRPFND91
          CALL      DEPAHGP1       * Deletes the data
          MOVE      ZERO,EXIT
          GOTO      GRPFND99
.
GRPFND40  PACK      KEY6,HFGRP001,SP70
          CALL      RDPAHGP1
          IF        OVRCD=1
            CALL      CLRGRP00     * Clear all the file variables
          ENDIF
.
          CLEAR     WEBTITLE
          MOVE      "Health Fund Group Maintenance",WEBTITLE
          RESET     WEBTITLE
.
          CALL      WEBHED00   * Create Output File and Write HTML Page Header
          BRANCH    EXIT,GRPFND99
.
          CALL      WEBBOD00   * Process Web Body
.
          CALL      WEBEND00   * Process End of HTML File
.
          MOVE      ONE,EXIT
          GOTO      GRPFND99
.
GRPFND91  MOVE      "Health Fund Group record does not exist",WEBTITLE
          CALL      WEBERR00
          MOVE      ONE,EXIT
          GOTO      GRPFND99
.
GRPFND92  MOVE      "Health Fund Group record exists",WEBTITLE
          CALL      WEBERR00
          MOVE      ONE,EXIT
          GOTO      GRPFND99
.
GRPFND93  MOVE      "Invalid Form Action.",WEBTITLE
          CALL      WEBERR00
          MOVE      ONE,EXIT
          GOTO      GRPFND99
.
GRPFND94  MOVE      "Health Fund On Hold Invoice file does not exist.",WEBTITLE
          CALL      WEBERR00
          MOVE      ONE,EXIT
          GOTO      GRPFND99
.
GRPFND99  RETURN
+
.------------------------------------------------------------
. Update HF On Hold Invoice for each health fund in the group
.------------------------------------------------------------
UPHLD000  BRANCH    USEFHINV,UPHLD999        * HF On Hold inv. doesn't exist
.
          MOVE      ZERO,OVRCD               * assume file exists
          TRAP      OVERCOND IF IO           * trap for error openning file
          OPEN      PATFHIA3,"patfhiaf"      * open HF On Hold Invoice file
          TRAPCLR   IO
          BRANCH    OVRCD,UPHLD999
.
.         Check if 'All Hospital' is selected
.
          MOVE      ZERO,ALLHFLAG
          IF        IBCNMHOS=1
            PACK      KEY3,MULTHOSP[1],SP70
            MATCH     "All",KEY3
            IF        @EQUAL
              MOVE      ONE,ALLHFLAG
            ENDIF
          ENDIF
.
          MOVE      ZERO,CHGFLAG            * Set change flag
          PACK      KEY20,PTHGCODE,SP70
          CALL      RDSFUND3
UPHLD200  CALL      RDKFUND3
          BRANCH    OVRCD,UPHLD999
.
          MATCH     PTHGCODE,PTHFHGRP       * Same group ?
          GOTO      UPHLD999 IF NOT EQUAL
.
          MOVE      ZERO,HOSPCNTR
          PACK      PTFHI001,SP70
          COMPARE   ONE,IBCNMHOS
          GOTO      UPHLD320 IF NOT EQUAL   * not multi hospital
.
.         if 'All Hospital' is selected, loop through Hospital file to get
.         hospital code
.
          IF        ALLHFLAG=1
            MOVE      SP70,KEY3
            CALL      RSPTHSP1
          ENDIF
.
UPHLD300  IF        ALLHFLAG=1
            CALL      RKPTHSP1
            BRANCH    OVRCD,UPHLD800
            PACK      PTFHI001,PTHSHOSP,SP70
          ELSE
            ADD       ONE,HOSPCNTR
            COMPARE   HOSPCNTR,MULTHCNT
            GOTO      UPHLD800 IF LESS
            PACK      PTFHI001,MULTHOSP[HOSPCNTR],SP70
          ENDIF
.
UPHLD320  MATCH     "1",SETHLINV
          GOTO      UPHLD600 IF NOT EQUAL
.
.         Set Inv On Hold for health fund is selected
.         Check if record exists for the Hosp id,HF and System
.
          PACK      KEY11,HCODE,PTFHI001,PTFHI003,SP70
          CALL      RDPTFHI3
          BRANCH    OVRCD,UPHLD400
.
          MOVE      PTFHHREA,SAVEREAS       * save reason for hold
          MOVE      ONE,CHGFLAG
.
          PACK      PTFHHDAT,PTFHI004,SP70
          PACK      PTFHHREA,PTFHI005,SP70    * on hold reason
          PACK      PTFHDESC,PTFHI006,SP70    * Description
          PACK      PTFHUDAT,CURRDATE,SP10
          CLOCK     TIME,PTFHUTIM
          MOVE      USERID,PTFHUUID
          CALL      UPPTFHI3
.
          GOTO      UPHLD500
.
.         Write a new record with New Hold invoice from date
.
UPHLD400  CALL      CLPATFHI
.
          MOVE      SP70,SAVEREAS       * set old reason for hold to blank
          MOVE      ONE,CHGFLAG
.
          UNPACK    KEY11,PTFHHFND,PTFHHOSP,PTFHSYST
          PACK      PTFHHDAT,PTFHI004,SP70
          PACK      PTFHHREA,PTFHI005,SP70    * on hold reason
          PACK      PTFHDESC,PTFHI006,SP70    * Description
.
          PACK      PTFHCDAT,CURRDATE,SP10
          CLOCK     TIME,PTFHCTIM
          MOVE      USERID,PTFHCUID
          PACK      KEY11,PTFHHFND,PTFHHOSP,PTFHSYST,SP70
          CALL      WRPTFHI3
.
UPHLD500  PACK      KEY6,PTFHHFND,SP70
          CALL      RDPTFX11
          IF        OVRCD=0
            MOVE      PTFHHDAT,PTFXHDAT
            MOVE      PTFHHREA,PTFXRHCD
            MOVE      PTFHDESC,PTFXRHFT
            MOVE      USERID,PTFXOHUI
            PACK      PTFXOHDT,CCC,CYY,CMM,CDD
            REP       " 0",PTFXOHDT
            CLOCK     TIME,PTFXOHTM
            CALL      UPPTFX11
          ENDIF
          GOTO      UPHLD700
.
.         Clear Inv On Hold for health fund, hospital and system
.
UPHLD600  MATCH     "1",CLRHLINV
          GOTO      UPHLD999 IF NOT EQUAL
.
          PACK      KEY11,HCODE,PTFHI001,PTFHI003,SP70
          CALL      RDPTFHI3
          BRANCH    OVRCD,UPHLD620
.
          MOVE      PTFHHREA,SAVEREAS       * save reason for hold
          MOVE      ONE,CHGFLAG
.
          PACK      KEY11,PTFHHFND,PTFHHOSP,PTFHSYST,SP70
          CALL      DEPTFHI3
.
UPHLD620  PACK      KEY6,HCODE,SP70
          CALL      RDPTFX11
          IF        OVRCD=0
            UNPACK    SP70,PTFXRHCD,PTFXRHFT,PTFXHDAT
            MOVE      USERID,PTFXOHUI
            PACK      PTFXOHDT,CCC,CYY,CMM,CDD
            REP       " 0",PTFXOHDT
            CLOCK     TIME,PTFXOHTM
            CALL      UPPTFX11
          ENDIF
.
UPHLD700  BRANCH    IBCNMHOS,UPHLD300
.
UPHLD800  IF        CHGFLAG=1
            CALL      RUNHLD00
            MOVE      ZERO,CHGFLAG
          ENDIF
.
          GOTO      UPHLD200
.
UPHLD999  RETURN
+
.-----------------------------------------------------------
. Initialize's file data (Health Fund Group Maintenace)
.-----------------------------------------------------------
CLRGRP00  MOVE      SP70,PTHGCODE
          MOVE      SP70,PTHGDESC
          MOVE      SP70,PTHGDFIC
          MOVE      SP70,PTHGSPAR
.
CLRGRP99  RETURN
.-----------------------------------------------------------------
. Moves cgi variables into file variables (Health Fund Group Maintenance)
.-----------------------------------------------------------------
GRPSAV00  MOVE      HFGRP001,KEY6
          SQUEEZE   KEY6
          MOVE      KEY6,PTHGCODE
          MOVE      HFGRP002,PTHGDESC
          MOVE      HFGRP003,PTHGDFIC
          MOVE      SP70,PTHGSPAR
.
GRPSAV99  RETURN
.------------------------------------------------------------
. * Checks mandatory fields (Health Fund Group Maintenance)
.------------------------------------------------------------
CHKGRP00  RESET     HFGRP001
          MATCH     SP70,HFGRP001
          GOTO      CHKGRP90 IF EQUAL
.
          RESET     HFGRP002
          MATCH     SP70,HFGRP002
          GOTO      CHKGRP92 IF EQUAL
.
          GOTO      CHKGRP98
.
CHKGRP90  MOVE      "Health Fund Group Code is mandatory",WEBTITLE
          CALL      WEBERR00
          MOVE      ONE,EXIT
          GOTO      CHKGRP99
.
CHKGRP92  MOVE      "Health Fund Group Description is mandatory!",WEBTITLE
          CALL      WEBERR00
          MOVE      ONE,EXIT
          GOTO      CHKGRP99
.
CHKGRP93  MOVE      "Health Fund Group Description is mandatory!",WEBTITLE
          CALL      WEBERR00
          MOVE      ONE,EXIT
          GOTO      CHKGRP99
.
CHKGRP98  MOVE      ZERO,EXIT
CHKGRP99  RETURN
.------------------------------------------------------------
. Invoice Message Maintenance (patmesgf)
.------------------------------------------------------------
INVMSG00  RESET     UPDTTYPE
          MATCH     SP1,UPDTTYPE
          GOTO      INVMSG40 IF EQUAL
.
          MATCH     "A",UPDTTYPE    * Add formaction
          GOTO      INVMSG10 IF EQUAL
.
          MATCH     "U",UPDTTYPE    * Update formaction
          GOTO      INVMSG20 IF EQUAL
.
          MATCH     "D",UPDTTYPE    * Delete formaction
          GOTO      INVMSG30 IF EQUAL
.
          GOTO      INVMSG93
.
INVMSG10  RESET     INVMSGCD
          PACK      KEY3,INVMSGCD,SP70
          CALL      RDMESG1 
          COMPARE   ZERO,OVRCD
          GOTO      INVMSG92 IF EQUAL
          CALL      CHKIMG00        * Checks mandatory fields
          BRANCH    EXIT,INVMSG99
          CALL      IMGSAV00        * Moves input variables to file variables
          PACK      KEY3,INVMSGCD,SP70
          CALL      WRMESG1         * Writes away the data
          MOVE      ZERO,EXIT
          GOTO      INVMSG99
.
INVMSG20  PACK      KEY3,INVMSGCD,SP70
          CALL      RDMESG1 
          BRANCH    OVRCD,INVMSG91
          CALL      CHKIMG00        * Checks mandatory fields
          BRANCH    EXIT,INVMSG99
          CALL      IMGSAV00        * Moves input variables to file variables
          CALL      UPMESG1         * Writes away the data
          MOVE      ZERO,EXIT
          GOTO      INVMSG99
.
INVMSG30  PACK      KEY3,INVMSGCD,SP70
          CALL      RDMESG1 
          BRANCH    OVRCD,INVMSG91
          CALL      DEMESG1         * Deletes the data
          MOVE      ZERO,EXIT
          GOTO      INVMSG99
.
INVMSG40  PACK      KEY3,INVMSGCD,SP70
          CALL      RDMESG1 
          IF        OVRCD=1
            CALL      CLRIMG00      * Clear all the file variables
          ENDIF
.
          CLEAR     WEBTITLE
          MOVE      "Invoice Message Maintenance",WEBTITLE
          RESET     WEBTITLE
.
          CALL      WEBHED00   * Create Output File and Write HTML Page Header
          BRANCH    EXIT,INVMSG99
.
          CALL      WEBBOD00   * Process Web Body
.
          CALL      WEBEND00   * Process End of HTML File
.
          MOVE      ONE,EXIT
          GOTO      INVMSG99
.
INVMSG91  MOVE      "Invoice Message record does not exist",WEBTITLE
          CALL      WEBERR00
          MOVE      ONE,EXIT
          GOTO      INVMSG99
.
INVMSG92  MOVE      "Invoice Message record exists",WEBTITLE
          CALL      WEBERR00
          MOVE      ONE,EXIT
          GOTO      INVMSG99
.
INVMSG93  MOVE      "Invalid Form Action.",WEBTITLE
          CALL      WEBERR00
          MOVE      ONE,EXIT
          GOTO      INVMSG99
.
INVMSG99  RETURN
.-------------------------------------------------------------
. Initialize's file data (Invoice Message Maintenace patmegf)
.-------------------------------------------------------------
CLRIMG00  MOVE      SP70,PMCODE  
          MOVE      SP70,PMLINE1 
          MOVE      SP70,PMLINE2 
          MOVE      SP70,PMSPARE 
.
CLRIMG99  RETURN
.------------------------------------------------------------------
. * Checks mandatory fields (Invoice Message Maintenance patmesgf)
.------------------------------------------------------------------
CHKIMG00  RESET     INVMSGCD
          MATCH     SP70,INVMSGCD
          GOTO      CHKIMG90 IF EQUAL
.
          RESET     INVMSGL1
          MATCH     SP70,INVMSGL1
          GOTO      CHKIMG92 IF EQUAL
.
          GOTO      CHKIMG98
.
CHKIMG90  MOVE      "Invoice Message Code is mandatory!",WEBTITLE
          CALL      WEBERR00
          MOVE      ONE,EXIT
          GOTO      CHKIMG99
.
CHKIMG92  MOVE      "Invoice Message Line 1 is mandatory!",WEBTITLE
          CALL      WEBERR00
          MOVE      ONE,EXIT
          GOTO      CHKIMG99
.
CHKIMG98  MOVE      ZERO,EXIT
CHKIMG99  RETURN
.--------------------------------------------------------------------------
. Cgi variables into file variables (Invoice Message Maintenance patmesgf)
.--------------------------------------------------------------------------
IMGSAV00  MOVE      INVMSGCD,KEY3
          SQUEEZE   KEY3
          MOVE      KEY3,PMCODE  
          MOVE      INVMSGL1,PMLINE1 
          MOVE      INVMSGL2,PMLINE2 
          MOVE      SP70,PMSPARE 
.
IMGSAV99  RETURN
.------------------------------------------------------------
. Link to Next set of Invoice Messages (patmesgf)
.------------------------------------------------------------
NEXTMG00  MOVE      NORECORD,KEY2
          REP       " +",KEY2
          ASSIGN    STARTNUM+NORECORD,F3
          MOVE      F3,KEY3
          REP       " +",KEY3
          UNPACK    DIM127,D1,FLDPARA,DIM127
          MOVE      REPORTNO,F2
.
          WRITE     HTMLFILE;"patweb87.pbl":
                                 "?reportno=",F2:
                                 "&template=",FLDPARA:
                                 "&startnum=",KEY3:
                                 "&norecord=",KEY2:
                                 "&keywords=",KEYWORDS;
.
NEXTMG99  RETURN
.-------------------------------------------------------------------------------
. Link to previous set of Invoice Messages (patmesgf)
.-------------------------------------------------------------------------------
PREVMG00  MOVE      NORECORD,KEY2
          REP       " +",KEY2
          ASSIGN    STARTNUM-NORECORD,F3
          IF        F3<0
            MOVE    ZERO,F3
          ENDIF
          MOVE      F3,KEY3
          REP       " +",KEY3
          UNPACK    DIM127,D1,FLDPARA,DIM127
          MOVE      REPORTNO,F2
.
          WRITE     HTMLFILE;"patweb87.pbl":
                                 "?reportno=",F2:
                                 "&template=",FLDPARA:
                                 "&startnum=",KEY3:
                                 "&norecord=",KEY2:
                                 "&keywords=",KEYWORDS;
.
PREVMG99  RETURN
.------------------------------------------------------------
. Health Fund Maintenance
.------------------------------------------------------------
HLTFND00  RESET     UPDTTYPE
          MATCH     SP1,UPDTTYPE
          GOTO      HLTFND40 IF EQUAL
.
          MATCH     "A",UPDTTYPE    * Add formaction
          GOTO      HLTFND10 IF EQUAL
.
          MATCH     "U",UPDTTYPE    * Update formaction
          GOTO      HLTFND20 IF EQUAL
.
          MATCH     "D",UPDTTYPE    * Delete formaction
          GOTO      HLTFND30 IF EQUAL
.
          MATCH     "E",UPDTTYPE    * Update all tables formaction
          GOTO      HLTFND50 IF EQUAL
.
          GOTO      HLTFND93
.
.         ******** ADD FORMACTION ********
.
HLTFND10  RESET     HFUND001
          PACK      KEY14,HFUND001,ZERO8,SP70
          CALL      RDFUND1
          COMPARE   ZERO,OVRCD
          GOTO      HLTFND92 IF EQUAL
          CALL      CHKHLT00      * Checks mandatory fields
          BRANCH    EXIT,HLTFND99
          CALL      HLTSAV00      * Moves input variables to file variables
          RESET     HCODE,6
          RESET     HCODE
.
          MOVE      SP70,PTHFCNAM
          MOVE      SP70,PTHFCTTL
          MOVE      SP70,PTHFCMOB
.
          PACK      KEY14,HCODE,HFTABL,SP70
          CALL      WRFUND1       * Writes away the data
.
          MOVE      "HT",CATEGORY  * Get Cat description string for Key Word
          MOVE      PTHFBCAT,CODE  * Indexes. This code seg must be done here
          CALL      GETCOD00       * cannot be done in the Procedure, as the
.                                  * Procedure is also used by FXPATKHF.
          PROC      PATKHFUP      * Update Keyword Search
.
....      COMPARE   ONE,PTCNUEDI            * Using EDI module on?
.         COMPARE   ONE,EDIREQD             * Using EDI module on?
.         IF        @EQUAL
            PACK      KEY6,HFUND001,SP70           
            CALL      RDPTFX11
            COMPARE   ZERO,OVRCD
            GOTO      HLTFND95 IF EQUAL
            MOVE      HCODE,PTFXHFND          
            MOVE      HFEXT002,PTFXEXTR      
            MOVE      HFEXT003,PTFXTFLG     
            MOVE      HFEXT004,PTFXADDR    
            MOVE      HFEXT005,PTFXSUBJ   
            MOVE      HFEXT006,PTFXADD1   
            MOVE      HFEXT007,PTFXADD2   
            MOVE      HFEXT008,PTFXADD3   
            MOVE      HFEXT009,PTFXADD4   
            MOVE      HFEXT010,PTFXPOST   
            MOVE      HFEXT011,PTFXZINV   
            MOVE      HFEXT012,PTFXSCEM   
            MOVE      HFEXT013,PTFXSCPN   
            MOVE      HFEXT014,PTFXSCPP   
            MOVE      HFEXT015,PTFXECLP
            MOVE      HFEXT016,PTFXCEFR
            MOVE      HFEXT017,PTFXRHCD
            MOVE      HFEXT018,PTFXRHFT
            MATCH     Z70,HFEXT019
            IF        !@EQUAL
              MOVE      HFEXT019,PTFXHDAT
            ENDIF
            MATCH     SP70,HFEXT020
            IF        @EQUAL
              MOVE      "0",PTFXMFEE
            ELSE
              MOVE      HFEXT020,PTFXMFEE
            ENDIF
            MOVE      HFEXT021,PTFXSMOR
            MOVE      SP70,PTFXGSTA
            MOVE      SP70,PTFXGSTC
            MOVE      SP70,PTFXOHDT
            MOVE      SP70,PTFXOHTM
            MOVE      SP70,PTFXOHUI
            PACK      PTFXSPAR,SP70,SP70
            CALL      WRPTFX11                * Write to PATFX1FD
.         ENDIF
.
          MOVE      ZERO,EXIT
          GOTO      HLTFND99
.
.         ********* UPDATE FORMACTION ********
.
HLTFND20  PACK      KEY14,HFUND001,ZERO8,SP70
          CALL      RDFUND1
          BRANCH    OVRCD,HLTFND91
          CALL      CHKHLT00      * Checks mandatory fields
          BRANCH    EXIT,HLTFND99
          CALL      HLTSAV00      * Moves input variables to file variables
          CALL      UPFUND1       * Writes away the data
.
          MOVE      "HT",CATEGORY  * Get Cat description string for Key Word
          MOVE      PTHFBCAT,CODE  * Indexes. This code seg must be done here
          CALL      GETCOD00       * cannot be done in the Procedure, as the
.                                  * Procedure is also used by FXPATKHF.
          PROC      PATKHFUP      * Update Keyword Search
.
          MOVE      HCODE,PTFXHFND
          PACK      KEY6,HFUND001,SP70           
          CALL      RDPTFX11
          IF        OVRCD=0
            MOVE      PTFXCEFR,KEY1           * Save old Contract Eff.From
            MOVE      PTFXRHCD,SAVEREAS       * Save old reason for hold inv
            PACK      DIM8,PTFXHDAT,SP70      * Save Hold Inv From date
            PACK      KEY80,PTFXRHFT,SP70     * Save old hold inv.free text
          ENDIF
.
          MOVE      HFEXT002,PTFXEXTR      
          MOVE      HFEXT003,PTFXTFLG     
          MOVE      HFEXT004,PTFXADDR    
          MOVE      HFEXT005,PTFXSUBJ   
          MOVE      HFEXT006,PTFXADD1
          MOVE      HFEXT007,PTFXADD2
          MOVE      HFEXT008,PTFXADD3
          MOVE      HFEXT009,PTFXADD4
          MOVE      HFEXT010,PTFXPOST
          MOVE      HFEXT011,PTFXZINV
          MOVE      HFEXT012,PTFXSCEM
          MOVE      HFEXT013,PTFXSCPN
          MOVE      HFEXT014,PTFXSCPP
          MOVE      HFEXT015,PTFXECLP
.
          MOVE      HFEXT016,PTFXCEFR
          MOVE      HFEXT017,PTFXRHCD
          MOVE      HFEXT018,PTFXRHFT
          MOVE      HFEXT019,PTFXHDAT
          MATCH     SP70,HFEXT020
          IF        @EQUAL
            MOVE      "0",PTFXMFEE
          ELSE
            MOVE      HFEXT020,PTFXMFEE
          ENDIF
          MOVE      HFEXT021,PTFXSMOR
.
          IF        OVRCD=0
            CALL      UPPTFX11                * Update to PATFX1FD
          ELSE
            MOVE      SP70,PTFXGSTA
            MOVE      SP70,PTFXGSTC
            MOVE      SP70,PTFXOHDT
            MOVE      SP70,PTFXOHTM
            MOVE      SP70,PTFXOHUI
            PACK      PTFXSPAR,SP70,SP70
            CALL      WRPTFX11
            GOTO      HLTFND27
          ENDIF
.
          MATCH     PTFXCEFR,KEY1
          GOTO      HLTFND26 IF NOT EQUAL   * Contract Eff.From has changed
.
          COMPARE   ZERO,USEFHINV
          GOTO      HLTFND27 IF EQUAL       * Using On Hold invoice file
.
          MATCH     PTFXRHCD,SAVEREAS
          GOTO      HLTFND26 IF NOT EQUAL   * Reason for hold has changed
.
          MATCH     PTFXHDAT,DIM8
          GOTO      HLTFND26 IF NOT EQUAL   * Hold Inv From date hold changed
.
          MATCH     PTFXRHFT,KEY80
          GOTO      HLTFND26 IF NOT EQUAL   * Hold Inv free text changed
.
          GOTO      HLTFND27
.
HLTFND26  CALL      RUNHLD00
.
.  --------- update keyword file for all tables attached to this health fund
.
HLTFND27  PACK      KEY14,HFUND001,SP70
          CALL      RDSFUND1
HLTFND28  CALL      RDKFUND1
          BRANCH    OVRCD,HLTFND29
.
          MATCH     HCODE,HFUND001
          GOTO      HLTFND29 IF NOT EQUAL
.
          MATCH     HFTABL,ZERO8
          GOTO      HLTFND28 IF EQUAL
.
          MOVE      "HT",CATEGORY  * Get Cat description string for Key Word
          MOVE      PTHFBCAT,CODE  * Indexes. This code seg must be done here
          CALL      GETCOD00       * cannot be done in the Procedure, as the
.                                  * Procedure is also used by FXPATKHF.
.
          PACK      SAVKEY14,HCODE,HFTABL,SP70
          PROC      PATKHFUP       * Update Key Word Search
.
          PACK      KEY14,SAVKEY14
          CALL      RDFUND1
          GOTO      HLTFND28
.
HLTFND29  PACK      KEY14,HFUND001,ZERO8,SP70
          CALL      RDFUND1
.
          MOVE      ZERO,EXIT
          GOTO      HLTFND99
.
.         ********* DELETE FORMACTION **********
.
HLTFND30  PACK      KEY14,HFUND001,ZERO8,SP70
          CALL      RDFUND1
          BRANCH    OVRCD,HLTFND91
.     * Drill down one level delete tables   
          CALL      DELTAB00      * Deletes the data
          CALL      DELCOM00      * Deletes Health Fund Comment 
          PROC      PATKHFUP      * Update Keyword Search
.
....      COMPARE   ONE,PTCNUEDI            * Using EDI module on?
HLTFND31  
....      COMPARE   ONE,EDIREQD             * Using EDI module on?
.         IF        @EQUAL
            PACK      KEY6,HFUND001,SP70           
            CALL      RDPTFX11
            IF        OVRCD=0
              CALL      DEPTFX11                * Delete to PATFX1FD
            ENDIF
.         ENDIF
.
          MOVE      ZERO,EXIT
          GOTO      HLTFND99
.
.         ********* DISPLAY FORMACTION **********
.
HLTFND40  PACK      KEY14,HFUND001,ZERO8,SP70
          CALL      RDFUND1
          IF        OVRCD=1
            CALL      CLRHLT00     * Clear all the file variables
          ENDIF
.
....      COMPARE   ONE,PTCNUEDI            * Using EDI module on?
....      COMPARE   ONE,EDIREQD             * Using EDI module on?
.         IF        @EQUAL
            PACK      KEY6,HFUND001,SP70           
            CALL      RDPTFX11
            IF        OVRCD=1
              CALL      CLRHFX00     * Clear all the file variables
            ENDIF
.         ENDIF
.
          MATCH     "1",MENUFLAG
          IF        @EQUAL
            CLEAR     WEBTITLE
            MOVE      "Health Fund Enquiry",WEBTITLE
            RESET     WEBTITLE
          ELSE
            CLEAR     WEBTITLE
            MOVE      "Health Fund Maintenance",WEBTITLE
            RESET     WEBTITLE
          ENDIF
.
          CALL      WEBHED00   * Create Output File and Write HTML Page Header
          BRANCH    EXIT,HLTFND99
.
          CALL      WEBBOD00   * Process Web Body
.
          CALL      WEBEND00   * Process End of HTML File
.
          MOVE      ONE,EXIT
          GOTO      HLTFND99
.
.         ********* UPDATE ALL TABLES FORMACTION ********
.
HLTFND50  PACK      KEY14,HFUND001,ZERO8,SP70
          CALL      RDFUND1
          BRANCH    OVRCD,HLTFND91
          CALL      CHKHLT00      * Checks mandatory fields
          BRANCH    EXIT,HLTFND99
          CALL      HLTSAV00      * Moves input variables to file variables
          CALL      UPFUND1       * Writes away the data
.
          MOVE      "HT",CATEGORY  * Get Cat description string for Key Word
          MOVE      PTHFBCAT,CODE  * Indexes. This code seg must be done here
          CALL      GETCOD00       * cannot be done in the Procedure, as the
.                                  * Procedure is also used by FXPATKHF.
          PROC      PATKHFUP      * Update Keyword Search
.
          PACK      KEY6,HFUND001,SP70
          CALL      RDPTFX11
          BRANCH    OVRCD,HLTFND52
.
          MOVE      HFEXT002,PTFXEXTR
          MOVE      HFEXT003,PTFXTFLG
          MOVE      HFEXT004,PTFXADDR
          MOVE      HFEXT005,PTFXSUBJ
          MOVE      HFEXT006,PTFXADD1
          MOVE      HFEXT007,PTFXADD2
          MOVE      HFEXT008,PTFXADD3
          MOVE      HFEXT009,PTFXADD4
          MOVE      HFEXT010,PTFXPOST
          MOVE      HFEXT011,PTFXZINV
          MOVE      HFEXT012,PTFXSCEM
          MOVE      HFEXT013,PTFXSCPN
          MOVE      HFEXT014,PTFXSCPP
          MOVE      HFEXT015,PTFXECLP
.
          MOVE      PTFXCEFR,KEY1           * Save old Contract Eff.From
          MOVE      PTFXRHCD,SAVEREAS       * Save old reason for hold inv
          PACK      DIM8,PTFXHDAT,SP70      * Save Hold Inv From date
          PACK      KEY80,PTFXRHFT,SP70     * Save old hold inv.free text
.
          MOVE      HFEXT016,PTFXCEFR
          MOVE      HFEXT017,PTFXRHCD
          MOVE      HFEXT018,PTFXRHFT
          MOVE      HFEXT019,PTFXHDAT
          MATCH     SP70,HFEXT020
          IF        @EQUAL
            MOVE      "0",PTFXMFEE
          ELSE
            MOVE      HFEXT020,PTFXMFEE
          ENDIF
          MOVE      HFEXT021,PTFXSMOR
.
          CALL      UPPTFX11                * Update to PATFX1FD
.
          MATCH     PTFXCEFR,KEY1
          GOTO      HLTFND51 IF NOT EQUAL   * Contract Eff.From has changed
.
          COMPARE   ZERO,USEFHINV
          GOTO      HLTFND52 IF EQUAL       * Using On Hold invoice file
.
          MATCH     PTFXRHCD,SAVEREAS
          GOTO      HLTFND51 IF NOT EQUAL   * Reason for hold has changed
.
          MATCH     PTFXHDAT,DIM8
          GOTO      HLTFND51 IF NOT EQUAL   * Hold Inv From date hold changed
.
          MATCH     PTFXRHFT,KEY80
          GOTO      HLTFND51 IF NOT EQUAL   * Hold Inv free text changed
.
          GOTO      HLTFND52
.
HLTFND51  CALL      RUNHLD00
.
.  --------- update all tables attached to this health fund ---------
HLTFND52  PACK      KEY14,HFUND001,SP70
          CALL      RDSFUND1
HLTFND53  CALL      RDKFUND1
          BRANCH    OVRCD,HLTFND55
.
          MATCH     HCODE,HFUND001
          GOTO      HLTFND55 IF NOT EQUAL
.
          MATCH     HFTABL,ZERO8
          GOTO      HLTFND53 IF EQUAL
.
          MATCH     SP70,HFUND011
          IF        @EQUAL
            MOVE      "1",DHFTACT
          ELSE
            MOVE      HFUND011,DHFTACT
          ENDIF
.
          CALL      UPFUND1
.
          MOVE      "HT",CATEGORY  * Get Cat description string for Key Word
          MOVE      PTHFBCAT,CODE  * Indexes. This code seg must be done here
          CALL      GETCOD00       * cannot be done in the Procedure, as the
.                                  * Procedure is also used by FXPATKHF.
.
          PACK      SAVKEY14,HCODE,HFTABL,SP70
.
          PROC      PATKHFUP       * Update Key Word Search
.
          PACK      KEY14,SAVKEY14
          CALL      RDFUND1
          GOTO      HLTFND53
.
HLTFND55  MOVE      ZERO,EXIT
          GOTO      HLTFND99
.
.         ********* DISPLAY ERROR MESSAGES **********
.
HLTFND91  MOVE      "Health Fund record does not exist",WEBTITLE
          CALL      WEBERR00
          MOVE      ONE,EXIT
          GOTO      HLTFND99
.
HLTFND92  MOVE      "Health Fund record exists",WEBTITLE
          CALL      WEBERR00
          MOVE      ONE,EXIT
          GOTO      HLTFND99
.
HLTFND93  MOVE      "Invalid Form Action.",WEBTITLE
          CALL      WEBERR00
          MOVE      ONE,EXIT
          GOTO      HLTFND99
.
HLTFND94  MOVE      "Health Fund extension record does not exist",WEBTITLE
          CALL      WEBERR00
          MOVE      ONE,EXIT
          GOTO      HLTFND99
.
HLTFND95  MOVE      "Health Fund extension record exists",WEBTITLE
          CALL      WEBERR00
          MOVE      ONE,EXIT
          GOTO      HLTFND99
.
HLTFND99  RETURN
.-----------------------------------------------------------
. Initialize's file data (Health Fund Maintenace)
.-----------------------------------------------------------
CLRHLT00  MOVE      SP70,HCODE    
          MOVE      SP70,HFTABL   
          MOVE      SP70,HFNAME   
          MOVE      SP70,HFADD1   
          MOVE      SP70,HFADD2   
          MOVE      SP70,HFADD3   * Added for 5.07 
          MOVE      SP70,HFADD4   * Added for 5.07 
          MOVE      SP70,HFPCODE  * Added for 5.07 
          MOVE      SP70,HFTELE  
          MOVE      ZERO,HFBAND 
          MOVE      SP70,HFHDPE 
          MOVE      SP70,HFFAXN   
          MOVE      SP70,PTHFBCAT 
          MOVE      SP70,PTHFHGRP 
          MOVE      SP70,PTHFHCPE 
          MOVE      ZERO,DHFTACT  
          MOVE      SP70,PTHFGRPV
          MOVE      ZERO,PTHFMAXM
          MOVE      ZERO,PTHFUMTD
          MOVE      ZERO,PTHFUCMX
          MOVE      ZERO,DTHFUMTD
          MOVE      ZERO,DTHFUCMX
          PACK      PTHFDSC1,SP70
          PACK      PTHFDSC2,SP70
          PACK      PTHFBILN,SP70
          PACK      PTHFFULD,SP70
          PACK      PTHFCARC,SP70
          PACK      PTHFFACD,SP70
          MOVE      ZERO,PTHFNDFP
          PACK      PTHFOCGR,SP70
          PACK      PTHFARCE,SP70                                   * Car 273294
          PACK      PTHFIMCD,SP70
          PACK      PTHFDPRI,SP70
          MOVE      SP70,PTFNSPAR   
.
.  Health Fund Comments 
.
          MOVE      SP70,FUNDCOD
          MOVE      SP70,DFCOUNT
          MOVE      SP70,FTEXT
          MOVE      SP70,FSPARES
. 
CLRHLT99  RETURN
.-----------------------------------------------------------
. Initialize's extension file data (Health Fund Maintenace)
.-----------------------------------------------------------
CLRHFX00  MOVE      SP70,PTFXHFND    
          MOVE      ZERO,PTFXEXTR   
          MOVE      SP70,PTFXTFLG   
          MOVE      SP70,PTFXADDR   
          MOVE      SP70,PTFXSUBJ   
          MOVE      SP70,PTFXZINV 
          MOVE      SP70,PTFXSCEM
          MOVE      SP70,PTFXSCPN
          MOVE      SP70,PTFXSCPP
          MOVE      SP70,PTFXECLP
          MOVE      SP70,PTFXCEFR
          MOVE      SP70,PTFXRHCD
          PACK      PTFXRHFT,SP70,SP70
          MOVE      SP70,PTFXHDAT 
          MOVE      SP70,PTFXMFEE 
          MOVE      SP70,PTFXSMOR 
          MOVE      SP70,PTFXGSTA 
          MOVE      SP70,PTFXGSTC
          MOVE      SP70,PTFXOHDT
          MOVE      SP70,PTFXOHTM
          MOVE      SP70,PTFXOHUI
          PACK      PTFXSPAR,SP70,SP70
. 
CLRHFX99  RETURN
.-----------------------------------------------------------
. Initialize's extension file data (Health Fund Maintenace)
.-----------------------------------------------------------
CLRFNX00  MOVE      SP70,PTFNHFND
          MOVE      ZERO,PTFNBMVH
          MOVE      ZERO,PTFNMVRT
          MOVE      ZERO,PTFNHRMV
          MOVE      SP70,PTFNMVBC
          MOVE      SP70,PTFNHOSP
          MOVE      SP70,PTFNEDAT
          MOVE      SP70,PTFNSPRE
CLRHFN99  RETURN
.-----------------------------------------------------------------
. Moves cgi variables into file variables (Health Fund Maintenance)
.-----------------------------------------------------------------
HLTSAV00  MOVE      HFUND001,KEY6
          SQUEEZE   KEY6
          MOVE      KEY6,HCODE
          MOVE      ZERO8,HFTABL 
          MOVE      HFUND002,HFNAME
          MOVE      HFUND003,HFADD1
          MOVE      HFUND004,HFADD2
          MOVE      HFUND005,HFTELE
          MOVE      HFUND006,HFBAND
          MOVE      HFUND007,HFHDPE
          MOVE      HFUND008,HFFAXN
          MOVE      SP70,PTHFBCAT
          MOVE      HFUND009,PTHFHGRP
          MOVE      HFUND010,PTHFHCPE
          MOVE      HFUND018,PTHFGRPV
          MOVE      HFUND019,PTHFBILN
          MOVE      HFUND020,PTHFFULD
          MOVE      HFUND021,PTHFCARC
          MOVE      HFUND022,PTHFDFIC
          MOVE      HFUND023,PTHFFACD
          MOVE      HFUND024,PTHFNDFP
          MOVE      HFUND025,PTHFOCGR
          MOVE      HFUND026,PTHFARCE                             * Car 273294
          MOVE      HFUND027,PTHFIMCD
          MOVE      HFUND028,PTHFDPRI 
          MOVE      HFUND029,PTHFCEML                             * TSK 0882791

.
          MATCH     SP70,HFUND011
          IF        @EQUAL
            MOVE      "1",DHFTACT
          ELSE
            MOVE      HFUND011,DHFTACT
          ENDIF
          MOVE      HFUND013,HFADD3    * Added for 5.07 
          MOVE      HFUND014,HFADD4    * Added for 5.07 
          MOVE      HFUND015,HFPCODE   * Added for 5.07 
          MATCH     SP70,HFUND016
          IF        @EQUAL
            MOVE      "0",PTHFUMTD
            MOVE      "0",DTHFUMTD
          ELSE
            MOVE      HFUND016,PTHFUMTD
            MOVE      HFUND016,DTHFUMTD
          ENDIF
          MATCH     SP70,HFUND017
          IF        @EQUAL
            MOVE      "0",PTHFUCMX
            MOVE      "0",DTHFUCMX
          ELSE
            MOVE      HFUND017,PTHFUCMX
            MOVE      HFUND017,DTHFUCMX
          ENDIF
.
          PACK      PTHFDSC1,SP70
          PACK      PTHFDSC2,SP70
          MOVE      SP70,PTFNSPAR
.
.  Health Fund Comment
.
          CALL      COMSAV00    * Health Fund Comment
.
HLTSAV99  RETURN
.-----------------------------------------------------------------
. Moves cgi variables into file variables (Patient Moeity Maintenance)
.-----------------------------------------------------------------
FMOSAV00  MOVE      HFTAB001,PTFMHFCD
          MOVE      HFTAB002,PTFMHFTB
          MOVE      PTFMO001,PTFMBTYP
          MOVE      PTFMO002,PTFMSDAM
          MOVE      PTFMO003,PTFMOVAM 
          MOVE      SP70,PTFMSPAR
.
FMOSAV99  RETURN
+
.------------------------------------------------------------
. Save Health Fund Comment
.------------------------------------------------------------
COMSAV00  PACK      KEY8,HFUND001,SP70    * Delete all coments for this Fund
          CALL      RDSFCMM1               
COMSAV10  CALL      RDKFCMM1         
          BRANCH    OVRCD,COMSAV20  * Empty file
          MATCH     HFUND001,FUNDCOD
          GOTO      COMSAV20 IF NOT EQUAL 
          PACK      KEY8,FUNDCOD,FCOUNT,SP70
          CALL      DEFCMM1
          GOTO      COMSAV10 
.
COMSAV20  MOVE      ZERO,F3
COMSAV30  ADD       ONE,F3
          IF        F3<=LASTITEM
            RESET     HFUND012[F3]
            MATCH     HFUND012[F3],SP70
            GOTO      COMSAV30 IF EQUAL     * Blank line, read next(or delete)
            MOVE      HFUND001,FUNDCOD      * Health Fund 
            MOVE      F3,FCOUNT             * Line No.
            MOVE      HFUND012[F3],FTEXT    * Line Details
            MOVE      SP70,FSPARES          * Spare 
            PACK      KEY8,FUNDCOD,FCOUNT,SP70
            CALL      WRFCMM1  * If Update type = Add Write Health Comment 
            GOTO      COMSAV30
          ENDIF
.
COMSAV99  RETURN
.------------------------------------------------------------
. * Delete Fund Tables(Health Fund Maintenance)
.------------------------------------------------------------
DELTAB00  PACK      KEY14,HFUND001
          CALL      RDSFUND1
DELTAB10  CALL      RDKFUND1
          BRANCH    OVRCD,DELTAB99
          MATCH     HFUND001,HCODE
          GOTO      DELTAB99 IF NOT EQUAL
          PACK      KEY14,HCODE,HFTABL
          CALL      DEFUND1       * Does Cascading delete on Codes
          PROC      PATKHFUP      * Update Key Word Search          
          GOTO      DELTAB10
.
DELTAB99  RETURN
.------------------------------------------------------------
. * Delete Health Fund Comment (Health Fund Maintenance)
.------------------------------------------------------------
DELCOM00  PACK      KEY8,HFUND001,SP70
          CALL      RDSFCMM1
DELCOM10  CALL      RDKFCMM1
          BRANCH    OVRCD,DELCOM99
          MATCH     HFUND001,FUNDCOD
          GOTO      DELCOM99 IF NOT EQUAL 
          PACK      KEY8,FUNDCOD,DFCOUNT
          CALL      DEFCMM1
          GOTO      DELCOM10
.
DELCOM99  RETURN
.------------------------------------------------------------
. * Checks mandatory fields (Health Fund Maintenance)
.------------------------------------------------------------
CHKHLT00  RESET     HFUND001
          MATCH     SP70,HFUND001
          GOTO      CHKHLT90 IF EQUAL
.
          RESET     HFUND002
          MATCH     SP70,HFUND002
          GOTO      CHKHLT92 IF EQUAL
.
          GOTO      CHKHLT98
.
CHKHLT90  MOVE      "Health Fund Number is mandatory",WEBTITLE
          CALL      WEBERR00
          MOVE      ONE,EXIT
          GOTO      CHKHLT99
.
CHKHLT92  MOVE      "Health Fund Name is mandatory!",WEBTITLE
          CALL      WEBERR00
          MOVE      ONE,EXIT
          GOTO      CHKHLT99
.
CHKHLT98  MOVE      ZERO,EXIT
CHKHLT99  RETURN
.------------------------------------------------------------
. Health Fund Table Maintenance
.------------------------------------------------------------
HTBFND00  RESET     UPDTTYPE
          MATCH     SP1,UPDTTYPE    * Display formaction
          GOTO      HTBFND40 IF EQUAL
.
          MATCH     "A",UPDTTYPE    * Add formaction
          GOTO      HTBFND10 IF EQUAL
.
          MATCH     "U",UPDTTYPE    * Update formaction
          GOTO      HTBFND20 IF EQUAL
.
          MATCH     "D",UPDTTYPE    * Delete formaction
          GOTO      HTBFND30 IF EQUAL
.
          MATCH     "M",UPDTTYPE    * Add patient moeity
          GOTO      HTBFND50 IF EQUAL
.
          MATCH     "N",UPDTTYPE    * Update patient moeity
          GOTO      HTBFND60 IF EQUAL
.
          MATCH     "O",UPDTTYPE    * Delete patient moeity
          GOTO      HTBFND70 IF EQUAL
.
          GOTO      HTBFND93
.
.         ********* HEALTH FUND ADD FORMACTION *********
.
HTBFND10  RESET     HFTAB001
          PACK      KEY14,HFTAB001,HFTAB002,SP70
          CALL      RDFUND1
          COMPARE   ZERO,OVRCD
          GOTO      HTBFND92 IF EQUAL
          CALL      CHKHTB00      * Checks mandatory fields
          BRANCH    EXIT,HTBFND99
          CALL      HTBSAV00      * Moves input variables to file variables
          RESET     HCODE,6
          RESET     HCODE
.
          MOVE      SP70,PTHFCNAM
          MOVE      SP70,PTHFCTTL
          MOVE      SP70,PTHFCEML
          MOVE      SP70,PTHFCMOB
.
          PACK      KEY14,HCODE,HFTABL,SP70
          CALL      WRFUND1       * Writes away the data
.
          MOVE      "HT",CATEGORY  * Get Cat description string for Key Word
          MOVE      PTHFBCAT,CODE  * Indexes. This code seg must be done here
          CALL      GETCOD00       * cannot be done in the Procedure, as the  
.                                  * Procedure is also used by FXPATKHF. 
.
          PROC      PATKHFUP       * Update Key Word Search 
          MOVE      ZERO,EXIT
          GOTO      HTBFND99
.
.         ********* HEALTH FUND UPDATE FORMACTION *********
.
HTBFND20  PACK      KEY14,HFTAB001,HFTAB002,SP70
          CALL      RDFUND1
          BRANCH    OVRCD,HTBFND91
          CALL      CHKHTB00     * Checks mandatory fields
          BRANCH    EXIT,HTBFND99
          CALL      HTBSAV00     * Moves input variables to file variables
          CALL      UPFUND1      * Writes away the data
.
          MOVE      "HT",CATEGORY  * Get Cat description string for Key Word
          MOVE      PTHFBCAT,CODE  * Indexes. This code seg must be done here
          CALL      GETCOD00       * cannot be done in the Procedure, as the  
.                                  * Procedure is also used by FXPATKHF. 
.
          PROC      PATKHFUP     * Update Key Word Search
          MOVE      ZERO,EXIT
          GOTO      HTBFND99
.
.         ********* HEALTH FUND DELETE FORMACTION *********
.
HTBFND30  PACK      KEY14,HFTAB001,HFTAB002,SP70
          CALL      RDFUND1
          BRANCH    OVRCD,HTBFND91
          CALL      DEFUND1       * Deletes the data
          PROC      PATKHFUP      * Update Keyword Search
.
          PACK      KEY17,HFTAB001,HFTAB002,SP70
HTBFND32  CALL      RSPTFMO1
          CALL      RKPTFMO1
          BRANCH    OVRCD,HTBFND36
.
          MATCH     HFTAB001,PTFMHFCD
          GOTO      HTBFND36 IF NOT EQUAL
.
          MATCH     HFTAB002,PTFMHFTB
          GOTO      HTBFND36 IF NOT EQUAL
.
          PACK      KEY17,PTFMHFCD,PTFMHFTB,PTFMBTYP
          CALL      DEPTFMO1     * Delete a Moeity record
          GOTO      HTBFND32
.
HTBFND36  MOVE      ZERO,EXIT
          GOTO      HTBFND99
.
.         ********* DISPLAY FORMACTION *********
.
HTBFND40  PACK      KEY14,HFTAB001,ZERO8,SP70
          CALL      RDFUND1
          BRANCH    OVRCD,HTBFND94
          MOVE      HCODE,FUNDCODE
          MOVE      HFNAME,FUNDNAME
.
          PACK      KEY14,HFTAB001,HFTAB002,SP70
          CALL      RDFUND1
          IF        OVRCD=1
            CALL      CLRHTB00     * Clear all the file variables
          ENDIF
.
          MATCH     SP70,PTFMO001
          IF        !@EQUAL
            PACK      KEY17,HFTAB001,HFTAB002,PTFMO001,SP70
            CALL      RDPTFMO1
            IF        OVRCD=1
              MOVE      SP70,PTFMBTYP
              MOVE      ZERO,PTFMSDAM
              MOVE      ZERO,PTFMOVAM
            ENDIF
          ENDIF
.
          MATCH     "1",MENUFLAG
          IF        @EQUAL
            CLEAR     WEBTITLE
            MOVE      "Health Fund Table Enquiry",WEBTITLE
            RESET     WEBTITLE
          ELSE
            CLEAR     WEBTITLE
            MOVE      "Health Fund Table Maintenance",WEBTITLE
            RESET     WEBTITLE
          ENDIF
.
          CALL      WEBHED00   * Create Output File and Write HTML Page Header
          BRANCH    EXIT,HTBFND99
.
          CALL      WEBBOD00   * Process Web Body
.
          CALL      WEBEND00   * Process End of HTML File
.
          MOVE      ONE,EXIT
          GOTO      HTBFND99
.
.         ********* MOEITY ADD FORMACTION *********
.
HTBFND50  RESET     HFTAB001
          PACK      KEY14,HFTAB001,HFTAB002,SP70
          CALL      RDFUND1
          COMPARE   ZERO,OVRCD
          GOTO      HTBFND91 IF NOT EQUAL
          PACK      KEY17,HFTAB001,HFTAB002,PTFMO001,SP70
          CALL      RDPTFMO1
          COMPARE   ZERO,OVRCD
          GOTO      HTBFND95 IF EQUAL
          CALL      FMOSAV00      * Moves input variables to file variables
          PACK      KEY17,PTFMHFCD,PTFMHFTB,PTFMBTYP,SP70
          CALL      WRPTFMO1      * Writes away the data
          MOVE      ZERO,EXIT
          GOTO      HTBFND99
.
.         ********* MOEITY UPDATE FORMACTION *********
.
HTBFND60  PACK      KEY17,HFTAB001,HFTAB002,PTFMO001,SP70
          CALL      RDPTFMO1
          BRANCH    OVRCD,HTBFND96
          CALL      FMOSAV00     * Moves input variables to file variables
          CALL      UPPTFMO1     * Writes away the data
.
          MOVE      ZERO,EXIT
          GOTO      HTBFND99
.
.         ********* MOEITY DELETE FORMACTION *********
.
HTBFND70  PACK      KEY17,HFTAB001,HFTAB002,PTFMO001,SP70
          CALL      RDPTFMO1
          BRANCH    OVRCD,HTBFND96
          CALL      DEPTFMO1     * Delete a Moeity record
.
          MOVE      ZERO,EXIT
          GOTO      HTBFND99
.
.         ********* DISPLAY ERROR MESSAGES *********
.
HTBFND91  MOVE      "Health Fund Table record does not exist",WEBTITLE
          CALL      WEBERR00
          MOVE      ONE,EXIT
          GOTO      HTBFND99
.
HTBFND92  MOVE      "Health Fund Table record exists",WEBTITLE
          CALL      WEBERR00
          MOVE      ONE,EXIT
          GOTO      HTBFND99
.
HTBFND93  MOVE      "Invalid Form Action.",WEBTITLE
          CALL      WEBERR00
          MOVE      ONE,EXIT
          GOTO      HTBFND99
.
HTBFND94  MOVE      "Invalid Fund.",WEBTITLE
          CALL      WEBERR00
          MOVE      ONE,EXIT
          GOTO      HTBFND99
.
HTBFND95  MOVE      "Record already exists",WEBTITLE
          CALL      WEBERR00
          MOVE      ONE,EXIT
          GOTO      HTBFND99
.
HTBFND96  MOVE      "Invalid patient moeity record",WEBTITLE
          CALL      WEBERR00
          MOVE      ONE,EXIT
          GOTO      HTBFND99
.
HTBFND99  RETURN
.-----------------------------------------------------------
. Initialize's file data (Health Fund Table Maintenace)
.-----------------------------------------------------------
CLRHTB00  MOVE      SP70,HCODE    
          MOVE      SP70,HFTABL   
          MOVE      SP70,HFNAME   
          MOVE      SP70,HFADD1   
          MOVE      SP70,HFADD2   
          MOVE      SP70,HFADD3   * Added for 5.07
          MOVE      SP70,HFADD4   * Added for 5.07
          MOVE      SP70,HFPCODE  * Added for 5.07
          MOVE      SP70,HFTELE  
          MOVE      ZERO,HFBAND 
          MOVE      SP70,HFHDPE 
          MOVE      SP70,HFFAXN   
          MOVE      SP70,PTHFBCAT 
          MOVE      SP70,PTHFHGRP 
          MOVE      SP70,PTHFHCPE 
          MOVE      SP70,DHFTACT  
          MOVE      SP70,PTHFGRPV
          MOVE      ZERO,PTHFMAXM
          MOVE      ZERO,PTHFUMTD
          MOVE      ZERO,PTHFUCMX
          MOVE      SP70,DTHFUMTD
          MOVE      SP70,DTHFUCMX
          PACK      PTHFDSC1,SP70
          PACK      PTHFDSC2,SP70
          PACK      PTHFBILN,SP70
          PACK      PTHFFULD,SP70
          PACK      PTHFCARC,SP70
          PACK      PTHFDFIC,SP70
          PACK      PTHFFACD,SP70
          MOVE      ZERO,PTHFNDFP
          PACK      PTHFOCGR,SP70
          PACK      PTHFARCE,SP70                                   * Car 273294
          MOVE      SP70,PTFNSPAR   
.
CLRHTB99  RETURN
.-----------------------------------------------------------------
. Moves cgi variables into file variables (Health Fund Table Maintenance)
.-----------------------------------------------------------------
HTBSAV00  MOVE      HFTAB001,KEY6
          SQUEEZE   KEY6
          MOVE      KEY6,HCODE
.
          MOVE      HFTAB002,KEY8
          SQUEEZE   KEY8
          MOVE      KEY8,HFTABL 
.
          MOVE      HFTAB003,HFNAME
          MOVE      SP70,HFADD1
          MOVE      SP70,HFADD2
          MOVE      SP70,HFADD3   * Added for 5.07
          MOVE      SP70,HFADD4   * Added for 5.07
          MOVE      SP70,HFPCODE  * Added for 5.07
          MOVE      SP70,HFTELE
          MOVE      ZERO,HFBAND
          MOVE      HFTAB004,HFHDPE
          MOVE      SP70,HFFAXN
          MOVE      HFTAB005,PTHFBCAT
          MOVE      SP70,PTHFHGRP
          MOVE      SP70,PTHFHCPE
          MATCH     SP70,HFTAB006
          IF        @EQUAL
            MOVE      "1",DHFTACT
          ELSE
            MOVE      HFTAB006,DHFTACT
          ENDIF
          MOVE      SP70,PTHFGRPV
          MOVE      HFTAB007,PTHFMAXM
          MOVE      ZERO,PTHFUMTD
          MOVE      ZERO,PTHFUCMX
          MOVE      SP70,DTHFUMTD
          MOVE      SP70,DTHFUCMX
          PACK      PTHFDSC1,HFTAB008,SP70
          PACK      PTHFDSC2,HFTAB009,SP70
          PACK      PTHFBILN,SP70
          PACK      PTHFFULD,SP70
          PACK      PTHFCARC,SP70
          PACK      PTHFDFIC,SP70
          MOVE      SP70,PTHFFACD
          MOVE      ZERO,PTHFNDFP
          MOVE      SP70,PTHFOCGR
          PACK      PTHFARCE,SP70                                   * Car 273294
          MOVE      SP70,PTFNSPAR
.
HTBSAV99  RETURN
.------------------------------------------------------------
. * Checks mandatory fields (Health Fund Table Maintenance)
.------------------------------------------------------------
CHKHTB00  RESET     HFTAB002
          MATCH     SP70,HFTAB002
          GOTO      CHKHTB90 IF EQUAL
.
          RESET     HFTAB003
          MATCH     SP70,HFTAB003
          GOTO      CHKHTB92 IF EQUAL
.
          GOTO      CHKHTB98
.
CHKHTB90  MOVE      "Health Fund Table Code is mandatory",WEBTITLE
          CALL      WEBERR00
          MOVE      ONE,EXIT
          GOTO      CHKHTB99
.
CHKHTB92  MOVE      "Health Fund Table Name is mandatory!",WEBTITLE
          CALL      WEBERR00
          MOVE      ONE,EXIT
          GOTO      CHKHTB99
.
CHKHTB98  MOVE      ZERO,EXIT
CHKHTB99  RETURN
.------------------------------------------------------------
. Health Fund Table Search
.------------------------------------------------------------
TABSRC00  CLEAR     WEBTITLE
          MOVE      "Health Fund Table Search",WEBTITLE
          RESET     WEBTITLE
.
          CALL      WEBHED00   * Create Output File and Write HTML Page Header
          BRANCH    EXIT,TABSRC99
.
          CALL      WEBBOD00   * Process Web Body
.
          CALL      WEBEND00   * Process End of HTML File
.
          MOVE      ONE,EXIT
          GOTO      TABSRC99
.
TABSRC99  RETURN
.------------------------------------------------------------
. Allowance Code Maintenance
.------------------------------------------------------------
PATALW00  RESET     UPDTTYPE
          MATCH     SP1,UPDTTYPE
          GOTO      PATALW40 IF EQUAL
.
          MATCH     "A",UPDTTYPE    * Add formaction
          GOTO      PATALW10 IF EQUAL
.
          MATCH     "U",UPDTTYPE    * Update formaction
          GOTO      PATALW20 IF EQUAL
.
          MATCH     "D",UPDTTYPE    * Delete formaction
          GOTO      PATALW30 IF EQUAL
.
          GOTO      PATALW93
.
.
.         ************ ADD FORMACTION ***********
.
PATALW10  CALL      CHKALW00      * Checks mandatory fields
          BRANCH    EXIT,PATALW99
          PACK      KEY2,PTALW001,SP70
          CALL      RDALLW1
          COMPARE   ONE,OVRCD
          GOTO      PATALW92 IF NOT EQUAL
.
          CALL      ALWSAV00      * Moves input variables to file variables
          PACK      KEY2,PTALW001,SP70
          CALL      WRALLW1       * Writes away the data
.
          MOVE      ZERO,EXIT
          GOTO      PATALW99
.
.         ************ UPDATE FORMACTION **********
.
PATALW20  PACK      KEY2,PTALW001,SP70
          CALL      RDALLW1
          BRANCH    OVRCD,PATALW91
          CALL      CHKALW00      * Checks mandatory fields
          BRANCH    EXIT,PATALW99
.
          CALL      RDLALLW1
          CALL      ALWSAV00      * Moves input variables to file variables
          PACK      KEY2,PTALW001,SP70
          CALL      UPALLW1       * Writes away the data
          CALL      ULALLW1       * Unlocks Record
.
          MOVE      ZERO,EXIT
          GOTO      PATALW99
.
.         ************ DELETE FORMACTION **********
.
PATALW30  PACK      KEY2,PTALW001,SP70
          CALL      RDALLW1
          BRANCH    OVRCD,PATALW91
          CALL      DEALLW1
.
          MOVE      ZERO,EXIT
          GOTO      PATALW99
.
.         ************ DISPLAY FORMACTION **********
.
PATALW40  PACK      KEY2,PTALW001,SP70
          CALL      RDALLW1
          IF        OVRCD=1
            CALL      CLRALW00    * Clear all the file variables
          ENDIF
.
          CLEAR     WEBTITLE
          MOVE      "Allowance Code Maintenance",WEBTITLE
          RESET     WEBTITLE
.
          CALL      WEBHED00   * Create Output File and Write HTML Page Header
          BRANCH    EXIT,PATALW99
          CALL      WEBBOD00   * Process Web Body
          CALL      WEBEND00   * Process End of HTML File
          MOVE      ONE,EXIT
          GOTO      PATALW99
.
PATALW91  MOVE      "Allowance Code does not exist",WEBTITLE
          CALL      WEBERR00
          MOVE      ONE,EXIT
          GOTO      PATALW99
.
PATALW92  MOVE      "Allowance Code exists",WEBTITLE
          CALL      WEBERR00
          MOVE      ONE,EXIT
          GOTO      PATALW99
.
PATALW93  MOVE      "Invalid Form Action.",WEBTITLE
          CALL      WEBERR00
          MOVE      ONE,EXIT
          GOTO      PATALW99
.
PATALW99  RETURN
.-----------------------------------------------------------
. Initialize's file data (Allowance Code Maintenace)
.-----------------------------------------------------------
CLRALW00  MOVE      SP70,ALWCODE    
          MOVE      SP70,ALWDESC   
          MOVE      ZERO,ALWAMT   
.
CLRALW99  RETURN
.-----------------------------------------------------------------
. Moves cgi variables into file variables (Allowance Code Maintenance)
.-----------------------------------------------------------------
ALWSAV00  MOVE      PTALW001,ALWCODE
          MOVE      PTALW002,ALWDESC
          MOVE      PTALW003,ALWAMT
.
ALWSAV99  RETURN
.------------------------------------------------------------
. * Checks mandatory fields (Allowance Code Maintenance)
.------------------------------------------------------------
CHKALW00  RESET     PTALW001
          MATCH     SP70,PTALW001
          GOTO      CHKALW90 IF EQUAL
.
          GOTO      CHKALW98
.
CHKALW90  MOVE      "Allowance Code is mandatory",WEBTITLE
          CALL      WEBERR00
          MOVE      ONE,EXIT
          GOTO      CHKALW99
.
CHKALW98  MOVE      ZERO,EXIT
CHKALW99  RETURN
.------------------------------------------------------------
. Value Set ID Maintenance
.------------------------------------------------------------
VALSET00  RESET     UPDTTYPE
          MATCH     SP1,UPDTTYPE
          GOTO      VALSET40 IF EQUAL
.
          MATCH     "A",UPDTTYPE    * Add formaction
          GOTO      VALSET10 IF EQUAL
.
          MATCH     "U",UPDTTYPE    * Update formaction
          GOTO      VALSET20 IF EQUAL
.
          MATCH     "D",UPDTTYPE    * Delete formaction
          GOTO      VALSET30 IF EQUAL
.
          GOTO      VALSET93
.
.
.         ************ ADD FORMACTION ***********
.
VALSET10  CALL      CHKVST00      * Checks mandatory fields
          BRANCH    EXIT,VALSET99
          PACK      KEY3,PTVST001,SP70
          CALL      RDPMVST1
          COMPARE   ONE,OVRCD
          GOTO      VALSET92 IF NOT EQUAL
.
          CALL      VSTSAV00      * Moves input variables to file variables
          PACK      KEY3,PTVST001,SP70
          CALL      WRPMVST1      * Writes away the data
.
          MOVE      ZERO,EXIT
          GOTO      VALSET99
.
.         ************ UPDATE FORMACTION **********
.
VALSET20  PACK      KEY3,PTVST001,SP70
          CALL      RDPMVST1
          BRANCH    OVRCD,VALSET91
          CALL      CHKVST00      * Checks mandatory fields
          BRANCH    EXIT,VALSET99
.
          CALL      RLPMVST1
          CALL      VSTSAV00      * Moves input variables to file variables
          PACK      KEY3,PTVST001,SP70
          CALL      UPPMVST1      * Writes away the data
          CALL      UUPMVST1      * Unlocks Record
.
          MOVE      ZERO,EXIT
          GOTO      VALSET99
.
.         ************ DELETE FORMACTION **********
.
VALSET30  PACK      KEY3,PTVST001,SP70
          CALL      RDPMVST1
          BRANCH    OVRCD,VALSET91
          CALL      DEPMVST1
.
          MOVE      ZERO,EXIT
          GOTO      VALSET99
.
.         ************ DISPLAY FORMACTION **********
.
VALSET40  PACK      KEY3,PTVST001,SP70
          CALL      RDPMVST1
          IF        OVRCD=1
            CALL      CLRVST00    * Clear all the file variables
          ENDIF
.
          CLEAR     WEBTITLE
          MOVE      "Value Set ID Maintenance",WEBTITLE
          RESET     WEBTITLE
.
          CALL      WEBHED00   * Create Output File and Write HTML Page Header
          BRANCH    EXIT,VALSET99
          CALL      WEBBOD00   * Process Web Body
          CALL      WEBEND00   * Process End of HTML File
          MOVE      ONE,EXIT
          GOTO      VALSET99
.
VALSET91  MOVE      "Value Set ID does not exist",WEBTITLE
          CALL      WEBERR00
          MOVE      ONE,EXIT
          GOTO      VALSET99
.
VALSET92  MOVE      "Value Set ID already exists",WEBTITLE
          CALL      WEBERR00
          MOVE      ONE,EXIT
          GOTO      VALSET99
.
VALSET93  MOVE      "Invalid Form Action.",WEBTITLE
          CALL      WEBERR00
          MOVE      ONE,EXIT
          GOTO      VALSET99
.
VALSET99  RETURN
+
.-----------------------------------------------------------
. Value Set ID Code Maintenance
.------------------------------------------------------------
VALCOD00  RESET     UPDTTYPE
          MATCH     SP1,UPDTTYPE
          GOTO      VALCOD40 IF EQUAL
.
          MATCH     "A",UPDTTYPE    * Add formaction
          GOTO      VALCOD10 IF EQUAL
.
          MATCH     "U",UPDTTYPE    * Update formaction
          GOTO      VALCOD20 IF EQUAL
.
          MATCH     "D",UPDTTYPE    * Delete formaction
          GOTO      VALCOD30 IF EQUAL
.
          GOTO      VALCOD93
.
.
.         ************ ADD FORMACTION ***********
.
VALCOD10  CALL      CHKVSC00      * Checks mandatory fields
          BRANCH    EXIT,VALCOD99
          PACK      KEY33,PTVSC001,PTVSC002,SP70
          CALL      RDPMVSC1
          COMPARE   ONE,OVRCD
          GOTO      VALCOD92 IF NOT EQUAL
.
          CALL      VSCSAV00      * Moves input variables to file variables
          PACK      KEY33,PTVSC001,PTVSC002,SP70
          CALL      WRPMVSC1      * Writes away the data
.
          PROC      PMSUKIUP      * Updates keyword index
.
          MOVE      ZERO,EXIT
          GOTO      VALCOD99
.
.         ************ UPDATE FORMACTION **********
.
VALCOD20  PACK      KEY33,PTVSC001,PTVSC002,SP70
          CALL      RDPMVSC1
          BRANCH    OVRCD,VALCOD91
          CALL      CHKVSC00      * Checks mandatory fields
          BRANCH    EXIT,VALCOD99
.
          CALL      VSCSAV00      * Moves input variables to file variables
          PACK      KEY33,PTVSC001,PTVSC002,SP70
          CALL      UPPMVSC1      * Writes away the data
.
          PROC      PMSUKIUP      * Updates keyword index
.
          MOVE      ZERO,EXIT
          GOTO      VALCOD99
.
.         ************ DELETE FORMACTION **********
.
VALCOD30  PACK      KEY33,PTVSC001,PTVSC002,SP70
          CALL      RDPMVSC1
          BRANCH    OVRCD,VALCOD91
.
          CALL      DEPMVSC1
.
          PROC      PMSUKIUP      * Updates keyword index
.
          MOVE      ZERO,EXIT
          GOTO      VALCOD99
.
.         ************ DISPLAY FORMACTION **********
.
VALCOD40  PACK      KEY33,PTVSC001,PTVSC002,SP70
          CALL      RDPMVSC1
          IF        OVRCD=1
            CALL      CLRCOD00    * Clear all the file variables
          ENDIF
.
          CLEAR     WEBTITLE
          MOVE      "Value Set Code Maintenance",WEBTITLE
          RESET     WEBTITLE
.
          CALL      WEBHED00   * Create Output File and Write HTML Page Header
          BRANCH    EXIT,VALCOD99
          CALL      WEBBOD00   * Process Web Body
          CALL      WEBEND00   * Process End of HTML File
          MOVE      ONE,EXIT
          GOTO      VALCOD99
.
VALCOD91  MOVE      "Value Set ID Code does not exist",WEBTITLE
          CALL      WEBERR00
          MOVE      ONE,EXIT
          GOTO      VALCOD99
.
VALCOD92  MOVE      "Value Set ID Code already exists",WEBTITLE
          CALL      WEBERR00
          MOVE      ONE,EXIT
          GOTO      VALCOD99
.
VALCOD93  MOVE      "Invalid Form Action.",WEBTITLE
          CALL      WEBERR00
          MOVE      ONE,EXIT
          GOTO      VALCOD99
.
VALCOD99  RETURN
+
.-----------------------------------------------------------
. Clinical Codes Value Mapping Maintenance
.------------------------------------------------------------
VALMAP00  RESET     UPDTTYPE
          MATCH     SP1,UPDTTYPE
          GOTO      VALMAP40 IF EQUAL
.
          MATCH     "A",UPDTTYPE    * Add formaction
          GOTO      VALMAP10 IF EQUAL
.
.         MATCH     "U",UPDTTYPE    * Update formaction
.         GOTO      VALMAP20 IF EQUAL
.
          MATCH     "D",UPDTTYPE    * Delete formaction
          GOTO      VALMAP30 IF EQUAL
.
          GOTO      VALMAP93
.
.
.         ************ ADD FORMACTION ***********
.
VALMAP10  PACK      KEY41,PTVMT001,PTVMT002,PTVMT003,SP70
          CALL      RAPMVMT1
          COMPARE   ONE,OVRCD
          GOTO      VALMAP92 IF NOT EQUAL
.
          CALL      VMTSAV00      * Moves input variables to file variables
.
          PACK      KEY41,PTVMT001,PTVMT002,PTVMT003,SP70
          CALL      WRPMVMT1      * Writes away the data
.
          MOVE      ZERO,EXIT
          GOTO      VALMAP99
.
.
.         ************ DELETE FORMACTION **********
.
VALMAP30  PACK      KEY41,PTVMT001,PTVMT002,PTVMT003,SP70
          CALL      RDPMVMT1
          BRANCH    OVRCD,VALMAP91
.
          CALL      DEPMVMT1
.
          MOVE      ZERO,EXIT
          GOTO      VALMAP99
.
.
.         ************ DISPLAY FORMACTION **********
.
VALMAP40  PACK      KEY41,PTVMT001,PTVMT002,PTVMT003,SP70
          CALL      RDPMVMT1
          IF        OVRCD=1
            CALL      CLRVMT00    * Clear all the file variables
          ENDIF
.
          CLEAR     WEBTITLE
          MOVE      "Clinical Codes Value Mapping Maintenance",WEBTITLE
          RESET     WEBTITLE
.
          CALL      WEBHED00   * Create Output File and Write HTML Page Header
          BRANCH    EXIT,VALMAP99
          CALL      WEBBOD00   * Process Web Body
          CALL      WEBEND00   * Process End of HTML File
          MOVE      ONE,EXIT
          GOTO      VALMAP99
.
VALMAP91  MOVE      "Clinical Coding System Mapping does not exist",WEBTITLE
          CALL      WEBERR00
          MOVE      ONE,EXIT
          GOTO      VALMAP99
.
VALMAP92  MOVE      "Clinical Coding System Mapping already exists",WEBTITLE
          CALL      WEBERR00
          MOVE      ONE,EXIT
          GOTO      VALMAP99
.
VALMAP93  MOVE      "Invalid Form Action.",WEBTITLE
          CALL      WEBERR00
          MOVE      ONE,EXIT
          GOTO      VALMAP99
.
VALMAP99  RETURN
+
.------------------------------------------------------------
. Insurance Code Maintenance
.------------------------------------------------------------
PATINS00  RESET     UPDTTYPE
          MATCH     "V",VIEWOPTS    * View formaction
          GOTO      PATINS50 IF EQUAL
.
          MATCH     SP1,UPDTTYPE
          GOTO      PATINS40 IF EQUAL
.
          MATCH     "A",UPDTTYPE    * Add formaction
          GOTO      PATINS10 IF EQUAL
.
          MATCH     "U",UPDTTYPE    * Update formaction
          GOTO      PATINS20 IF EQUAL
.
          MATCH     "D",UPDTTYPE    * Delete formaction
          GOTO      PATINS30 IF EQUAL
.
          GOTO      PATINS93
.
.
.         ************ ADD FORMACTION ***********
.
PATINS10  CALL      CHKINS00      * Checks mandatory fields
          BRANCH    EXIT,PATINS99
          PACK      KEY6,PTINS001,SP70
          CALL      RDINSR1
          COMPARE   ZERO,OVRCD
          GOTO      PATINS92 IF EQUAL
.
          CALL      INSSAV00      * Moves input variables to file variables
          PACK      KEY6,PTINS001,SP70
          CALL      WRINSR1       * Writes away the data
.
          PROC      PATKIOUP                * write Keyword file
.
          MOVE      ZERO,EXIT
          GOTO      PATINS99
.
.         ************ UPDATE FORMACTION **********
.
PATINS20  PACK      KEY6,PTINS001,SP70
          CALL      RDINSR1
          BRANCH    OVRCD,PATINS91
          CALL      CHKINS00      * Checks mandatory fields
          BRANCH    EXIT,PATINS99
.
          CALL      RLINSR1
          CALL      INSSAV00      * Moves input variables to file variables
          PACK      KEY6,PTINS001,SP70
          CALL      UPINSR1       * Writes away the data
          CALL      ULINSR1       * Unlocks Record
.
          PROC      PATKIOUP                * write Keyword file
.
          MOVE      ZERO,EXIT
          GOTO      PATINS99
.
.         ************ DELETE FORMACTION **********
.
PATINS30  PACK      KEY6,PTINS001,SP70
          CALL      RDINSR1
          BRANCH    OVRCD,PATINS91
          CALL      DEINSR1
.
          PROC      PATKIOUP                * write Keyword file
.
          MOVE      ZERO,EXIT
          GOTO      PATINS99
.
.         ************ DISPLAY FORMACTION **********
.
PATINS40  PACK      KEY6,PTINS001,SP70
          CALL      RDINSR1
          IF        OVRCD=1
            CALL      CLRINS00    * Clear all the file variables
          ENDIF
.
          CLEAR     WEBTITLE
          MOVE      "Insurance Code Maintenance",WEBTITLE
          RESET     WEBTITLE
.
          CALL      WEBHED00   * Create Output File and Write HTML Page Header
          BRANCH    EXIT,PATINS99
          CALL      WEBBOD00   * Process Web Body
          CALL      WEBEND00   * Process End of HTML File
          MOVE      ONE,EXIT
          GOTO      PATINS99
.
PATINS50  PACK      KEY6,INSURANC,SP70
          CALL      RDINSR1
          BRANCH    OVRCD,PATINS91
.
          MOVE      "Insurance Details",WEBTITLE
          RESET     WEBTITLE
.
          CALL      WEBHED00   * Create Output File and Write HTML Page Header
          BRANCH    EXIT,PATINS99
          CALL      WEBBOD00   * Process Web Body
          CALL      WEBEND00   * Process End of HTML File
          MOVE      ONE,EXIT
          GOTO      PATINS99
.
PATINS91  MOVE      "Insurance Code does not exist",WEBTITLE
          CALL      WEBERR00
          MOVE      ONE,EXIT
          GOTO      PATINS99
.
PATINS92  MOVE      "Insurance Code exists",WEBTITLE
          CALL      WEBERR00
          MOVE      ONE,EXIT
          GOTO      PATINS99
.
PATINS93  MOVE      "Invalid Form Action.",WEBTITLE
          CALL      WEBERR00
          MOVE      ONE,EXIT
          GOTO      PATINS99
.
PATINS99  RETURN
.-----------------------------------------------------------
. Initialize's file data (Insurance Code Maintenace)
.-----------------------------------------------------------
CLRINS00  MOVE      SP70,ICODE    
          MOVE      SP70,INAME   
          MOVE      SP70,IADD1   
          MOVE      SP70,IADD2   
          MOVE      SP70,IADD3   
          MOVE      SP70,IADD4   
          MOVE      SP70,IPOST   
          MOVE      SP70,ICONT   
          MOVE      SP70,ITELEB   
          MOVE      ZERO,IBILL   
          MOVE      ZERO,IAOUT   
          MOVE      SP70,ISORT   
          MOVE      SP70,PTINSCEM
          MOVE      SP70,PTINSCPN
          MOVE      SP70,PTINSCPP
          MOVE      SP70,PTINACTV
          MOVE      SP70,PTINFAXN
          MOVE      SP70,PTINEMAI
          MOVE      SP70,PTINSERV
          MOVE      SP70,PTINCLAI
          MOVE      SP70,PTINARCE                                   * Car 273294
.
CLRINS99  RETURN
.-----------------------------------------------------------------
. Moves cgi variables into file variables (Insurance Code Maintenance)
.-----------------------------------------------------------------
INSSAV00  MOVE      PTINS001,ICODE
          MOVE      PTINS002,INAME   
          MOVE      PTINS003,IADD1   
          MOVE      PTINS004,IADD2   
          MOVE      PTINS005,IADD3   
          MOVE      PTINS006,IADD4   
          MOVE      PTINS007,IPOST   
          MOVE      PTINS008,ICONT   
          MOVE      PTINS009,ITELEB   
          MOVE      PTINS010,IBILL   
          MOVE      PTINS011,IAOUT   
          MOVE      PTINS012,ISORT   
          MOVE      PTINS013,PTINSCEM
          MOVE      PTINS014,PTINSCPN
          MOVE      PTINS015,PTINSCPP
          MOVE      PTINS016,PTINACTV
          MOVE      PTINS017,PTINFAXN
          MOVE      PTINS018,PTINEMAI
          MOVE      PTINS019,PTINSERV
          MOVE      PTINS020,PTINCLAI
          MOVE      PTINS021,PTINARCE                               * Car 273294
.
INSSAV99  RETURN
.------------------------------------------------------------
. * Checks mandatory fields (Insurance Code Maintenance)
.------------------------------------------------------------
CHKINS00  RESET     PTINS001
          MATCH     SP70,PTINS001
          GOTO      CHKINS90 IF EQUAL
.
          GOTO      CHKINS98
.
CHKINS90  MOVE      "Insurance Code is mandatory",WEBTITLE
          CALL      WEBERR00
          MOVE      ONE,EXIT
          GOTO      CHKINS99
.
CHKINS98  MOVE      ZERO,EXIT
CHKINS99  RETURN
.------------------------------------------------------------
. Period Date Ranges Maintanence: Display,Add,Update,Delete
.------------------------------------------------------------
PATDRG00  RESET     UPDTTYPE
          MATCH     SP1,UPDTTYPE
          GOTO      PATDRG80 IF EQUAL
.
          MATCH     "A",UPDTTYPE    * Add formaction
          GOTO      PATDRG10 IF EQUAL
.
          MATCH     "U",UPDTTYPE    * Update formaction
          GOTO      PATDRG20 IF EQUAL
.
          MATCH     "D",UPDTTYPE    * Delete formaction
          GOTO      PATDRG30 IF EQUAL
.
          MATCH     "C",UPDTTYPE    * Delete formaction
          GOTO      PATDRG40 IF EQUAL
.
          GOTO      PATDRG93
.
.         ************ ADD FORMACTION ***********
.
PATDRG10  CALL      CHKDRG00  * Checks mandatory fields & checks for blank
          BRANCH    EXIT,PATDRG99
.                                                           
          PACK      KEY6,PTDRG003,PTDRG004,SP70             
          CALL      RDDRGA1                                 
          COMPARE   ZERO,OVRCD                              
          GOTO      PATDRG92 IF EQUAL                       
.                                                           
          CALL      VDAT0000      * Validate date ranges
          BRANCH    EXIT,PATDRG99
.
          CALL      DRGSAV00      * Moves input variables to file variables
.
          PACK      KEY6,PTDRG003,PTDRG004,SP70             
          CALL      WRDRGA1       * Writes away the data    
.                                                           
          MOVE      ZERO,EXIT                               
          GOTO      PATDRG99                                
.                                                           
.         ************ UPDATE FORMACTION **********         
.                                                           
PATDRG20  PACK      KEY6,PTDRG003,PTDRG004,SP70             
          CALL      RDDRGA1                                 
          BRANCH    OVRCD,PATDRG91                          
.                                                           
          CALL      CHKDRG00      * Checks mandatory fields 
          BRANCH    EXIT,PATDRG99                           
.                                                           
          CALL      VDAT0000      * Validate date ranges
          BRANCH    EXIT,PATDRG99
.
          PACK      KEY6,PTDRG003,PTDRG004,SP70    * Restore original record
          CALL      RDDRGA1                                 
          BRANCH    OVRCD,PATDRG91                          
.                                                           
          CALL      DRGSAV00      * Moves input variables to file variables
.
          PACK      KEY6,PTDRG003,PTDRG004,SP70             
          CALL      UPDRGA1       * Writes away the data    
.                                                           
          MOVE      ZERO,EXIT                               
          GOTO      PATDRG99                                
.                                                           
.         ************ DELETE FORMACTION **********         
.                                                           
PATDRG30  PACK      KEY6,PTDRG003,PTDRG004,SP70             
          CALL      RDDRGA1                                 
          BRANCH    OVRCD,PATDRG91                          
          CALL      DEDRGA1       * Deletes the data        
.                                                           
          MOVE      ZERO,EXIT                               
          GOTO      PATDRG99                                
.                                                           
.         ************ COPY FORMACTION **********         
.                                                           
PATDRG40  CALL      VCOP0000              * Validate copy
          BRANCH    EXIT,PATDRG99

          CALL      COPY0000              * Copy the years data
.                                                           
          MOVE      ZERO,EXIT                               
          GOTO      PATDRG99                                
.                                                           
.         ************ DISPLAY FORMACTION **********        
.                                                           
PATDRG80  RESET     FRSTDATE                                
          MATCH     SP70,FRSTDATE                           
          IF        @EQUAL                                  
            MATCH     SP70,VYEARCHO                         
            IF        @EQUAL                                
              PACK      FRSTDATE,CCC,CYY                    
              REP       " 0",FRSTDATE                       
            ELSE                                            
              PACK      FRSTDATE,VYEARCHO                   
              REP       " 0",FRSTDATE                       
            ENDIF                                           
          ENDIF                                             
                                                            
          PACK      KEY6,PTDRG003,PTDRG004,SP70             
          CALL      RDDRGA1                                 
          IF        OVRCD=1                                 
            CALL      CLRDRG00    * Clear all the file variables
          ENDIF                                             
.                                                           
          CLEAR     WEBTITLE                                
          MOVE      "Period Date Ranges Maintenance",WEBTITLE
          RESET     WEBTITLE                                
.                                                           
          CALL      WEBHED00   * Create Output File and Write HTML Page Header
          BRANCH    EXIT,PATDRG99                           
          CALL      WEBBOD00   * Process Web Body           
          CALL      WEBEND00   * Process End of HTML File   
          MOVE      ONE,EXIT                                
          GOTO      PATDRG99                                
.                                                           
PATDRG91  MOVE      "Record does not exist",WEBTITLE        
          CALL      WEBERR00                                
          MOVE      ONE,EXIT                                
          GOTO      PATDRG99                                
.                                                           
PATDRG92  MOVE      "Record exists",WEBTITLE                
          CALL      WEBERR00                                
          MOVE      ONE,EXIT                                
          GOTO      PATDRG99                                
.                                                           
PATDRG93  MOVE      "Invalid Form Action.",WEBTITLE         
          CALL      WEBERR00                                
          MOVE      ONE,EXIT                                
          GOTO      PATDRG99                                
.                                                           
PATDRG99  RETURN                                            
.-----------------------------------------------------------
. Initialize's file data                                    
.-----------------------------------------------------------
CLRDRG00  MOVE      SP70,DRGFDTE      * From date for period (CCYYMMDD)
          MOVE      SP70,DRGTDTE      * To date for periods (CCYYMMDD)
          MOVE      SP70,DRGYR        * Financial Year (CCYY)
          MOVE      SP70,DRGNUM       * Financial Period Code (MM)
          MOVE      SP70,DRGCYR       * Calendar Year (CCYY)
          MOVE      SP70,DRGCNUM      * Calendar Period Code(MM)
          MOVE      SP70,DRGLDSC      * Long Description    
          MOVE      SP70,DRGMDSC      * Medium Description  
          MOVE      SP70,DRGSDSC      * Short Description   
.                                                           
CLRDRG99  RETURN                                            
.------------------------------------------------------------
. Moves cgi variables into file variables                   
.------------------------------------------------------------
DRGSAV00  MOVE      PTDRG001,DRGFDTE                        
          MOVE      PTDRG002,DRGTDTE                        
          MOVE      PTDRG003,DRGYR                          
          MOVE      PTDRG004,DRGNUM                         
          MOVE      PTDRG005,DRGCYR                         
          MOVE      PTDRG006,DRGCNUM                        
          MOVE      PTDRG007,DRGLDSC                        
          MOVE      PTDRG008,DRGMDSC                        
          MOVE      PTDRG009,DRGSDSC                        
.                                                           
DRGSAV99  RETURN                                            
.------------------------------------------------------------------
. * Checks mandatory fields                                 
.------------------------------------------------------------------
CHKDRG00  RESET     PTDRG003                                
          MATCH     SP70,PTDRG003                           
          GOTO      CHKDRG90 IF EQUAL                       
.                                                           
          RESET     PTDRG004                                
          MATCH     SP70,PTDRG004                           
          GOTO      CHKDRG91 IF EQUAL                       
.                                                           
          GOTO      CHKDRG98                                
.                                                           
CHKDRG90  MOVE      "Financial Year cannot be blank!",WEBTITLE
          CALL      WEBERR00                                
          MOVE      ONE,EXIT                                
          GOTO      CHKDRG99                                
.                                                           
CHKDRG91  MOVE      "Financial Period Code cannot be blank!",WEBTITLE
          CALL      WEBERR00                                
          MOVE      ONE,EXIT                                
          GOTO      CHKDRG99                                
.                                                           
CHKDRG98  MOVE      ZERO,EXIT                               
CHKDRG99  RETURN    
.                                                           
.--------------------------------------------------------------
. Table of Date Range Maintanance
.--------------------------------------------------------------
DRGTAB00  UNPACK    DIM127,D1,LINKPRG,DIM127
          UNPACK    DIM127,D1,LINKREP,DIM127
          UNPACK    DIM127,D1,LINKTEM,DIM127
.
          CALL      DRGHD000      * Display Table Heading
.
          PACK      KEY6,FRSTDATE,PTDRG004,SP70
          CALL      RDSDRGA1
DRGTAB10  CALL      RDKDRGA1
          BRANCH    OVRCD,DRGTAB99
.
          MATCH     DRGYR,FRSTDATE
          GOTO      DRGTAB99 IF LESS
.
          CALL      DRGRW000     * Display Table Row
          GOTO      DRGTAB10
.
DRGTAB99  RETURN
.-----------------------------------------------------------------------
.  Period Date Range Details (TABLE HEADING)
.-----------------------------------------------------------------------
DRGHD000  WRITE     HTMLFILE;"<tr>":
                             "<td class=HeadingCell width=20%>":
                             "Financial Period</td>":
                             "<td class=HeadingCell width=20%>":
                             "From</td>":
                             "<td class=HeadingCell width=20%>":
                             "To</td>":
                             "<td class=HeadingCell>Description</td>":
                             "</tr>"
.
DRGHD999  RETURN
.-----------------------------------------------------------------------
.  Period Date Range Details (TABLE ROW)
.-----------------------------------------------------------------------
DRGRW000  MATCH     SP70,DRGNUM
          IF        @EQUAL
            MOVE      "&nbsp;",DRGNUM
          ENDIF

          MATCH     SP70,DRGLDSC
          IF        @EQUAL
            MOVE      "&nbsp;",DRGLDSC
          ENDIF
.
          MATCH     SP70,DRGFDTE
          IF        @EQUAL
            MOVE      "&nbsp;",KEY20
          ELSE
            UNPACK    DRGFDTE,KEY4,CMON,CDAY
            MOVE      KEY4,F4
            MOVE      CMON,F2
            LOAD      MTHNAM3,F2,JAN,FEB,MAR,APR,MAY,JUN,JUL,AUG,SEP,OCT,NOV,DEC
            PACK      KEY20,CDAY,SP1,MTHNAM3,SP1,F4
          ENDIF
.
          MATCH     SP70,DRGTDTE
          IF        @EQUAL
            MOVE      "&nbsp;",KEY21
          ELSE
            UNPACK    DRGTDTE,KEY4,CMON,CDAY
            MOVE      KEY4,F4
            MOVE      CMON,F2
            LOAD      MTHNAM3,F2,JAN,FEB,MAR,APR,MAY,JUN,JUL,AUG,SEP,OCT,NOV,DEC
            PACK      KEY21,CDAY,SP1,MTHNAM3,SP1,F4
          ENDIF
.
          WRITE     HTMLFILE;"<tr><td nowrap><A HREF='javascript:ShowDetail08":
                             "(#"",LINKPRG,"#.pbl":
                             "?reportno=",LINKREP:
                             "&template=",LINKTEM:
                             "&ptdrg003=",DRGYR:
                             "&ptdrg004=",DRGNUM,"#")'>":
                             "<img src=../images/MaintenanceIcon.gif hspace=4":
                             " border=0 align=absmiddle></a>":
                             DRGNUM,"</td>":
                             "<td>",KEY20,"</td><td>",KEY21,"</td>":
                             "<td>",DRGLDSC,"</td>":
                             "</tr>"
.
DRGRW999  RETURN
.
.------------------------------------------------------------
. Move in Letter Details
.------------------------------------------------------------
MVLET000  MATCH     Z70,PTLET001
          IF        !@EQUAL
            SQUEEZE    PTLET001
            MOVE       PTLET001,PTLELTNO
          ENDIF
          MATCH     Z70,PTLET002
          IF        !@EQUAL
            MOVE       PTLET002,PTLETEXT
          ENDIF
          MATCH     Z70,PTLET003
          IF        !@EQUAL
            SQUEEZE    PTLET003
            MOVE       PTLET003,PTLEPBOT
          ENDIF
          MATCH     Z70,PTLET004
          IF        !@EQUAL
            SQUEEZE    PTLET004
            MOVE       PTLET004,PTLEPTOP
          ENDIF
          MATCH     Z70,PTLET005
          IF        !@EQUAL
            SQUEEZE    PTLET005
            MOVE       PTLET005,PTLEPPAG
          ENDIF
          MATCH     Z70,PTLET006
          IF        !@EQUAL
            SQUEEZE    PTLET006
            MOVE       PTLET006,PTLEPTAB
          ENDIF
          MATCH     Z70,PTLET007
          IF        !@EQUAL
            MOVE       PTLET007,PTLEMMFN
          ENDIF
.
          MATCH     Z70,PTLET008
          IF        !@EQUAL
            MOVE       PTLET008,PTLEACTV
          ENDIF
.
          MATCH     Z70,PTLET009
          IF        !@EQUAL
            MOVE       PTLET009,PTLECOMM
          ENDIF
.
          MATCH     Z70,PTLET010
          IF        !@EQUAL
            MOVE       PTLET010,PTLECONF
          ENDIF
.
          RETURN
.
.------------------------------------------------------------
. Patient Letters Details
.------------------------------------------------------------
PATLET00  CALL      CLPATLET
          MATCH     SP70,UPDTTYPE      * Display
          GOTO      PATLET50 IF EQUAL
          MATCH     "A",UPDTTYPE       * Add New
          GOTO      PATLET10 IF EQUAL
          MATCH     "U",UPDTTYPE       * Update
          GOTO      PATLET20 IF EQUAL
          MATCH     "D",UPDTTYPE       * Delete
          GOTO      PATLET30 IF EQUAL
          MOVE      "Invalid Update Type",WEBTITLE
          CALL      WEBERR00
          GOTO      PATLET99
.
PATLET10  CALL      ADDLET00
          GOTO      PATLET99
.
PATLET20  CALL      UPDLET00
          GOTO      PATLET99
.
PATLET30  CALL      DELLET00
          GOTO      PATLET99
.
PATLET50  SQUEEZE   PTLET001
          MOVE      PTLET001,F3
          MOVE      F3,KEY3
          MOVE      ZERO,F3
          PACK      KEY6,KEY3,F3
          CALL      RDPTLET1
          IF        OVRCD=1
            CALL      CLPATLET
          ENDIF
          MOVE      "Inpatient Letters",WEBTITLE
          CALL      WEBHED00
          BRANCH    EXIT,PATLET99
          CALL      WEBBOD00
          CALL      WEBEND00
.
PATLET99  RETURN
.
CLPATLET  MOVE      ZERO,PTLELTNO
          MOVE      ZERO,PTLELINO
          MOVE      SP70,PTLETEXT
          MOVE      ZERO,PTLEPBOT
          MOVE      ZERO,PTLEPTOP
          MOVE      ZERO,PTLEPPAG
          MOVE      ZERO,PTLEPTAB
          MOVE      SP70,PTLEMMFN
          MOVE      SP70,PTLEACTV
          MOVE      SP70,PTLECOMM
          MOVE      SP70,PTLECONF
          MOVE      SP70,PTLESPAR
          RETURN
.------------------------------------------------------------
. Add Letter
.------------------------------------------------------------
ADDLET00  CALL      CLPATLET
          SQUEEZE   PTLET001
          MOVE      PTLET001,PTLELTNO
          MOVE      ZERO,PTLELINO
          PACK      KEY6,PTLELTNO,PTLELINO,SP70
          CALL      RDPTLET1
          IF        OVRCD=1
            CALL      MVLET000
            CALL      WRPTLET1
            CALL      LETDET00  * Update Letter Details
            CALL      WINCLS00
          ELSE
            MOVE      "Letter Already on File",WEBTITLE
            CALL      WEBERR00
          ENDIF
          RETURN
.------------------------------------------------------------
. Update Extract
.------------------------------------------------------------
UPDLET00  CALL      CLPATLET
          SQUEEZE   PTLET001
          MOVE      PTLET001,PTLELTNO
          MOVE      ZERO,PTLELINO
          PACK      KEY6,PTLELTNO,PTLELINO,SP70
          CALL      RDPTLET1
          IF        OVRCD=0
            CALL      MVLET000
            CALL      UPPTLET1
            CALL      LETDET00  * Update Letter Details
            CALL      WINCLS00
          ELSE
            MOVE      "Extract Not On File",WEBTITLE
            CALL      WEBERR00
          ENDIF
          RETURN
.------------------------------------------------------------
. Delete Extract
.------------------------------------------------------------
DELLET00  SQUEEZE   PTLET001
          MOVE      PTLET001,PTLELTNO
          MOVE      ZERO,PTLELINO
          PACK      KEY6,PTLELTNO,PTLELINO,SP70
          CALL      RDPTLET1
          IF        OVRCD=0
            CALL      DEPTLET1
            CALL      LETDET00
            CALL      WINCLS00
          ELSE
            MOVE      "Extract Not On File",WEBTITLE
            CALL      WEBERR00
          ENDIF
          RETURN
.
LETDET00  SQUEEZE   PTLET001
          MOVE      PTLET001,PTLELTNO
          MOVE      PTLET001,LETTNUMB
          MOVE      ZERO,PTLELINO
          PACK      KEY6,PTLELTNO,PTLELINO,SP70
          CALL      RDPTLET1
LETDET10  CALL      RKPTLET1
          BRANCH    OVRCD,LETDET20
          COMPARE   PTLELTNO,LETTNUMB
          GOTO      LETDET20 IF NOT EQUAL
          PACK      KEY6,PTLELTNO,PTLELINO,SP70
          CALL      DEPTLET1
          CALL      RSPTLET1
          GOTO      LETDET10
.
LETDET20  MATCH     "D",UPDTTYPE
          GOTO      LETDET99 IF EQUAL
          COMPARE   ZERO,PTLEEND
          GOTO      LETDET99 IF EQUAL
          CALL      CLPATLET
          MOVE      ZERO,F3
LETDET30  ADD       ONE,F3
          MOVE      LETTNUMB,PTLELTNO
          MOVE      F3,PTLELINO
          PACK      KEY6,PTLELTNO,PTLELINO,SP70
          CALL      RDPTLET1
          IF        OVRCD=0
            MOVE      ZERO,PTLELVAR
            SCAN      SPECCHAR,PTLECOMN[F3]
            IF        @EQUAL
              MOVE      ONE,PTLELVAR
            ENDIF
            RESET     PTLECOMN[F3]
            MOVE      PTLECOMN[F3],PTLETEXT
            CALL      UPPTLET1
          ELSE
            MOVE      ZERO,PTLELVAR
            SCAN      SPECCHAR,PTLECOMN[F3]
            IF        @EQUAL
              MOVE      ONE,PTLELVAR
            ENDIF
            RESET     PTLECOMN[F3]
            MOVE      PTLECOMN[F3],PTLETEXT
            CALL      WRPTLET1
          ENDIF
          COMPARE   F3,PTLEEND
          GOTO      LETDET30 IF NOT EQUAL
LETDET99  RETURN
.------------------------------------------------------------
. Letter Variables
.------------------------------------------------------------
LETF0000  BRANCH    FLDITMNO,LETF0100,LETF0200,LETF0300,LETF0400,LETF0500:
                             LETF0600,LETF0700,LETF0800,LETF0900,LETF1000:
                             LETF1100,LETF1200,LETF1300
          WRITE     HTMLFILE;"Invalid Tag";
          GOTO      LETF9999
.
LETF0100  COMPARE   ZERO,PTLELTNO
          GOTO      LETF0110 IF EQUAL
          WRITE     HTMLFILE;PTLELTNO;
          GOTO      LETF9999
.
LETF0110  MOVE      ZERO,F3
          PACK      KEY6,F3,Z70
          CALL      RSPTLET2
          CALL      RPPTLET2
          IF        OVRCD=1
            WRITE     HTMLFILE;"  1";
          ELSE
            ADD       ONE,PTLELTNO
            WRITE     HTMLFILE;PTLELTNO;
            CALL      CLPATLET
          ENDIF
          GOTO      LETF9999
.
LETF0200  MATCH     SP70,PTLETEXT
          GOTO      LETF9999 IF EQUAL
          WRITE     HTMLFILE;PTLETEXT;
          GOTO      LETF9999
.
LETF0300  WRITE     HTMLFILE;PTLEPBOT;
          GOTO      LETF9999
.
LETF0400  WRITE     HTMLFILE;PTLEPTOP;
          GOTO      LETF9999
.
LETF0500  WRITE     HTMLFILE;PTLEPPAG;
          GOTO      LETF9999
.
LETF0600  WRITE     HTMLFILE;PTLEPTAB;
          GOTO      LETF9999
.
LETF0700  WRITE     HTMLFILE;PTLEMMFN;
          GOTO      LETF9999
.
LETF0800  CALL      LETTAB00
          GOTO      LETF9999
.
LETF0900  SQUEEZE   PTLET001
          MOVE      ZERO,LETTNUMB
          MOVE      PTLET001,LETTNUMB
          COMPARE   ZERO,LETTNUMB
          GOTO      LETF9999 IF EQUAL
          PACK      KEY6,LETTNUMB,SP2,ZERO
          CALL      RDPTLET1
LETF0910  CALL      RKPTLET1
          BRANCH    OVRCD,LETF0990
          COMPARE   LETTNUMB,PTLELTNO
          GOTO      LETF0990 IF NOT EQUAL
.
          STRIP     PTLETEXT
          MOVELPTR  PTLETEXT,F3
          IF        F3>0
            SFORMAT   VAR,F3
          ELSE
            SFORMAT   VAR,1
          ENDIF
          MOVE      PTLETEXT,VAR
          WRITE     HTMLFILE;VAR
          SFORMAT   VAR,127
.
          GOTO      LETF0910
LETF0990  PACK      KEY6,LETTNUMB,SP2,ZERO
          CALL      RDPTLET1
          GOTO      LETF9999
.
LETF1000  WRITE     HTMLFILE;PTLEACTV;
          GOTO      LETF9999
.
LETF1100  WRITE     HTMLFILE;FILTACTV;
          GOTO      LETF9999
.
LETF1200  WRITE     HTMLFILE;PTLECOMM;
          GOTO      LETF9999
.
LETF1300  WRITE     HTMLFILE;PTLECONF;
          GOTO      LETF9999
.
LETF9999  RETURN
.------------------------------------------------------------
. Output Table of Letter Headers Details
.------------------------------------------------------------
LETTAB00  MOVE      ZERO,F3
          PACK      KEY6,F3,SP70
          CALL      RSPTLET2
LETTAB10  CALL      RKPTLET2
          BRANCH    OVRCD,LETTAB99
          COMPARE   ZERO,PTLELINO
          GOTO      LETTAB99 IF NOT EQUAL
.
          MATCH     "0",FILTACTV            * Active Only
          IF        @EQUAL
            MATCH     "1",PTLEACTV
            GOTO      LETTAB10 IF EQUAL
          ENDIF
.
          MATCH     "1",FILTACTV            * Inactive Only
          IF        @EQUAL
            MATCH     "1",PTLEACTV
            GOTO      LETTAB10 IF NOT EQUAL
          ENDIF
.
          CLEAR     HTMLLINK
          APPEND    "javascript:UpdateLetter('",HTMLLINK
          APPEND    PTLELTNO,HTMLLINK
          APPEND    "')",HTMLLINK
          RESET     HTMLLINK
.
          MATCH     "1",PTLEACTV
          IF        @EQUAL
            MOVE    "Inactive  ",ACTIDESC
          ELSE
            MOVE    "Active",ACTIDESC
          ENDIF
.
          MATCH     "1",PTLECOMM
          IF        @EQUAL
            MOVE    DYES,SMSSDESC
          ELSE
            MOVE    DNO,SMSSDESC
          ENDIF
.
          MOVE      SP70,LETTDESC
          MATCH     "1",PTLECONF
          IF        @EQUAL
            MOVE    "Eligiblity Letter",LETTDESC
          ENDIF
.
          WRITE     HTMLFILE;"t.addRow(#"",HTMLLINK,"#",":
                             "#"",PTLELTNO,"#",":
                             "#"",PTLETEXT,"#",":
                             "#"",PTLEPBOT,"#",":
                             "#"",PTLEPTOP,"#",":
                             "#"",PTLEPPAG,"#",":
                             "#"",PTLEPTAB,"#",":
                             "#"",PTLEMMFN,"#",":
                             "#"",ACTIDESC,"#",":
                             "#"",SMSSDESC,"#",":
                             "#"",LETTDESC,"#");"
.
          GOTO      LETTAB10
.
LETTAB99  RETURN
.
.------------------------------------------------------------
. Casemix Same Day
.------------------------------------------------------------
CMXSDY00  RESET     UPDTTYPE
          MATCH     SP1,UPDTTYPE
          GOTO      CMXSDY40 IF EQUAL
.
          MATCH     "A",UPDTTYPE    * Add formaction
          GOTO      CMXSDY10 IF EQUAL
.
          MATCH     "U",UPDTTYPE    * Update formaction
          GOTO      CMXSDY20 IF EQUAL
.
          MATCH     "D",UPDTTYPE    * Delete formaction
          GOTO      CMXSDY30 IF EQUAL
.
          GOTO      CMXSDY90
.
CMXSDY10  
          GOTO      CMXSDY99
.
CMXSDY20  
          GOTO      CMXSDY99
.
CMXSDY30  
          GOTO      CMXSDY99
.
CMXSDY40  MATCH     SP70,CMXFKEYS
          GOTO      CMXSDY50 IF NOT EQUAL
          CALL      CLRHLF00
          CALL      CLRASD00
          GOTO      CMXSDY60
CMXSDY50  PACK      KEY27,CMXFKEYS,SP70
          CALL      RDPTHLF1
          BRANCH    OVRCD,CMXSDY91
          PACK      KEY30,CMXFKEYS,CMXAD001,SP70
          CALL      RDPTASD1
          IF        OVRCD=1
            CALL      CLRASD00
          ENDIF
.
CMXSDY60  MOVE      "Same Day Casemix Fees",WEBTITLE
          CALL      WEBHED00
          BRANCH    EXIT,CMXSDY99
          CALL      WEBBOD00
          CALL      WEBEND00
          MOVE      ONE,EXIT
          GOTO      CMXSDY99
.  
CMXSDY90  MOVE      "Invalid Update Type",WEBTITLE
          CALL      WEBERR00
          MOVE      ONE,EXIT
          GOTO      CMXSDY99
.
CMXSDY91  MOVE      "Invalid Record Key",WEBTITLE
          CALL      WEBERR00
          MOVE      ONE,EXIT
          GOTO      CMXSDY99
.
CMXSDY99  RETURN
.
CLRHLF00  MOVE        SP70,PTHLCLMN
          MOVE        SP70,PTHLHFND
          MOVE        SP70,PTHLTABT
          MOVE        SP70,PTHLCASM
          MOVE        SP70,PTHLDES1
          MOVE        SP70,PTHLDES2
          MOVE        ZERO,PTHLLREB
          MOVE        ZERO,PTHLLPAT
          MOVE        ZERO,PTHLCOFF
          MOVE        ZERO,PTHLINVB
          MOVE        ZERO,PTHLINVI
          MOVE        SP70,PTHLSPAR
          RETURN
.
CLRASD00  MOVE       SP70,PTADCLMN
          MOVE       SP70,PTADHFND
          MOVE       SP70,PTADTABT
          MOVE       SP70,PTADCASM
          MOVE       SP70,PTADBTYP
          MOVE       SP70,PTADDES1
          MOVE       SP70,PTADDES2
          MOVE       ZERO,PTADDREB
          MOVE       ZERO,PTADDPAT
          MOVE       SP70,PTADSPAR
          RETURN
.
.------------------------------------------------------------
. Additional Charges Same Day Casemix Fees Table
.------------------------------------------------------------
CMXAD000  PACK      KEY30,CMXFKEYS,SP70
          CALL      RSPTASD1
CMXAD100  CALL      RKPTASD1
          BRANCH    OVRCD,CMXAD900
          PACK      KEY27,PTADCNID,PTADCLMN,PTADHFND,PTADTABT,PTADCASM,SP70
          MATCH     KEY27,CMXFKEYS
          GOTO      CMXAD900 IF NOT EQUAL
          PACK      KEY30,PTHLCNID,PTHLCLMN,PTHLHFND,PTHLTABT,PTHLCASM:
                          PTADBTYP,SP70
          CLEAR     HTMLLINK
          APPEND    "javascript:Update('",HTMLLINK
          APPEND    KEY30,HTMLLINK
          APPEND    "')",HTMLLINK
          RESET     HTMLLINK
          ASSIGN    PTADDREB+PTADDPAT,F12P2
          MOVE      "BT",CATEGORY
          MOVE      PTADBTYP,CODE
          CALL      GETCOD00
          WRITE     HTMLFILE;"t.addRow(#"",HTMLLINK,"#",":
                             "#"",TDESC,"#",":
                             "#"",PTADDES1,PTADDES2,"#",":
                             "#"",PTADDREB,"#",":
                             "#"",PTADDPAT,"#",":
                             "#"",F12P2,"#");"
          GOTO      CMXAD100
CMXAD900
CMXAD999  RETURN
.------------------------------------------------------------
. Additional Charges Same Day Casemix Fees Table
.------------------------------------------------------------
PMSIN000  WRITE     HTMLFILE;"<tr><td class=HeadingCell>Breakdown</td>":
                             "<td class=HeadingCell align=right>Amount</td>":
                             "</tr>"
          PACK      KEY30,CMXFKEYS,SP70
          CALL      RSPMSIN1
PMSIN100  CALL      RKPMSIN1
          BRANCH    OVRCD,PMSIN900
          PACK      KEY27,PMSICNID,PMSICODE,PMSIFUND,PMSITBLT,PMSICSCD,SP70
          MATCH     KEY27,CMXFKEYS
          GOTO      PMSIN900 IF NOT EQUAL
          PACK      KEY30,PMSICNID,PMSICODE,PMSIFUND,PMSITBLT,PMSICSCD:
                          PMSIBKCD,SP70
          CLEAR     HTMLLINK
          APPEND    "'InvoiceBreak(#"",HTMLLINK
          APPEND    KEY30,HTMLLINK
          APPEND    "#");'",HTMLLINK
          RESET     HTMLLINK
          MOVE      "FI",CATEGORY
          MOVE      PMSIBKCD,CODE
          CALL      GETCOD00
          WRITE     HTMLFILE;"<tr><td>":
                             "<img src=../images/EditIcon.gif class=Icon ":
                             "onclick=",HTMLLINK,">":
                             TDESC,"</td>":
                             "<td align=right>",PMSIAMNT,"</td></tr>"
          GOTO      PMSIN100
PMSIN900
PMSIN999  RETURN
.------------------------------------------------------------
. Additional Charges Same Day Casemix Fees Table
.------------------------------------------------------------
PTSRB000  WRITE     HTMLFILE;"<tr><td class=HeadingCell>Breakdown</td>":
                             "<td class=HeadingCell align=right>Amount</td>":
                             "</tr>"
          PACK      KEY30,CMXFKEYS,SP70
          CALL      RSPTSRB1
PTSRB100  CALL      RKPTSRB1
          BRANCH    OVRCD,PTSRB900
          PACK      KEY27,PTSBCNID,PTSBCODE,PTSBFUND,PTSBTBLT,PTSBCSCD,SP70
          MATCH     KEY27,CMXFKEYS
          GOTO      PTSRB900 IF NOT EQUAL
          PACK      KEY30,PTSBCNID,PTSBCODE,PTSBFUND,PTSBTBLT,PTSBCSCD:
                          PTSBBRCD,SP70
          CLEAR     HTMLLINK
          APPEND    "'RevenueBreak(#"",HTMLLINK
          APPEND    KEY30,HTMLLINK
          APPEND    "#");'",HTMLLINK
          RESET     HTMLLINK
          MOVE      "FI",CATEGORY
          MOVE      PTSBBRCD,CODE
          CALL      GETCOD00
          WRITE     HTMLFILE;"<tr><td>":
                             "<img src=../images/EditIcon.gif class=Icon ":
                             "onclick=",HTMLLINK,">":
                             TDESC,"</td>":
                             "<td align=right>",PTSBAMNT,"</td></tr>"
          GOTO      PTSRB100
PTSRB900
PTSRB999  RETURN
.------------------------------------------------------------
. Additional Charges Same Day Casemix Fees Table
.------------------------------------------------------------
PTASD000  WRITE     HTMLFILE;"<tr><td class=HeadingCell>Bed Type</td>":
                             "<td class=HeadingCell>Description</td>":
                             "<td class=HeadingCell align=right>Patient</td>":
                             "<td class=HeadingCell align=right>Rebate</td>":
                             "</tr>"
          PACK      KEY30,CMXFKEYS,SP70
          CALL      RSPTASD1
PTASD100  CALL      RKPTASD1
          BRANCH    OVRCD,PTASD900
          PACK      KEY27,PTADCNID,PTADCLMN,PTADHFND,PTADTABT,PTADCASM,SP70
          MATCH     KEY27,CMXFKEYS
          GOTO      PTASD900 IF NOT EQUAL
          PACK      KEY30,PTADCNID,PTADCLMN,PTADHFND,PTADTABT,PTADCASM:
                          PTADBTYP,SP70
          CLEAR     HTMLLINK
          APPEND    "'AdditionalCharge(#"",HTMLLINK
          APPEND    KEY30,HTMLLINK
          APPEND    "#");'",HTMLLINK
          RESET     HTMLLINK
          MOVE      "BT",CATEGORY
          MOVE      PTADBTYP,CODE
          CALL      GETCOD00
          WRITE     HTMLFILE;"<tr><td>":
                             "<img src=../images/EditIcon.gif class=Icon ":
                             "onclick=",HTMLLINK,">":
                             TDESC,"</td>":
                             "<td>",PTADDES1,"</td>":
                             "<td align=right>",PTADDPAT,"</td>":
                             "<td align=right>",PTADDREB,"</td></tr>"
          GOTO      PTASD100
PTASD900
PTASD999  RETURN
.
.------------------------------------------------------------
. Bed Fees Table
.------------------------------------------------------------
BFETB000  PACK      KEY27,CLAIMCOD,HFUND001,ADMISSTY,BEDTYPES,SP70
          PACK      SAVKEY15,CLAIMCOD,HFUND001,ADMISSTY,BEDTYPES,SP70
          CALL      RDSBFEE2
BFETB100  CALL      RDKBFEE2
          BRANCH    OVRCD,BFETB999
          PACK      KEY15,BFCLM,BFHFUND,BFATYPE,BFBTYPE,SP70
          MATCH     KEY15,SAVKEY15
          GOTO      BFETB999 IF NOT EQUAL
.
          PACK      KEY27,BFCLM,BFHFUND,PTBFHTYP,BFATYPE,BFBTYPE,BFENDDY:
                          PTBFCNID,SP70
          CLEAR     HTMLLINK
          APPEND    "javascript:UpdateBedFee('",HTMLLINK
          APPEND    KEY27,HTMLLINK
          APPEND    "')",HTMLLINK
          RESET     HTMLLINK
.
          PACK      KEY14,BFHFUND,ZERO,ZERO,ZERO,ZERO,SP10
          CALL      RDFUND1
          IF        OVRCD=1
            PACK      HFNAME,PFUNDH,SP70
          ENDIF      
.
          ASSIGN    BFPAT+BFHF,F12P2
          WRITE     HTMLFILE;"t.addRow(#"",HTMLLINK,"#",":
                             "#"",HFNAME,"#",":
                             "#"",BFENDDY,"#",":
                             "#"",BFDESC,"#",":
                             "#"",BFHF,"#",":
                             "#"",BFPAT,"#",":
                             "#"",F12P2,"#",":
                             "#"",BFNINV,"#");"
          GOTO      BFETB100
.
BFETB999  RETURN
.
.------------------------------------------------------------
. Private Practice Financial letter Print 
.------------------------------------------------------------
PRIFLS00  CALL      CLPRFL00                * Clear Selection Variables
          MATCH     SP70,UPDTTYPE           * Dislay
          GOTO      PRIFLS50 IF EQUAL
.
          MATCH     "A",UPDTTYPE            * Add
          GOTO      PRIFLS10 IF EQUAL
.
          MATCH     "U",UPDTTYPE            * Update
          GOTO      PRIFLS20 IF EQUAL
.
          MATCH     "D",UPDTTYPE            * Delete
          GOTO      PRIFLS30 IF EQUAL
.
          MOVE      "Invalid Update Type",WEBTITLE
          CALL      WEBERR00
          GOTO      PRIFLS99
.
PRIFLS10  CALL      ADDFLS00 
          GOTO      PRIFLS99
.
PRIFLS20  CALL      UPDFLS00
          GOTO      PRIFLS99
.
PRIFLS30  CALL      DELFLS00
          GOTO      PRIFLS99
.
PRIFLS50  PACK      KEY4,PRFL0001,SP70
          CALL      RDPRFLS1
          IF        OVRCD=1
            CALL     CLPRFL00 
          ENDIF
          MOVE      "Private Practice Financial Letter Selection List",WEBTITLE
          CALL      WEBHED00
          BRANCH    EXIT,PRIFLS99
          CALL      WEBBOD00
          CALL      WEBEND00
          MOVE      ONE,EXIT
.
PRIFLS99  RETURN
.
.------------------------------------------------------------
. Add Private Practice Financial Letter Selection 
.------------------------------------------------------------
ADDFLS00  CALL      CLPRFL00
          PACK      KEY4,PRFL0001,SP30
          CALL      RAPRFLS1
          COMPARE   ZERO,OVRCD
          GOTO      ADDFLS90 IF EQUAL
.
          CALL      MVPRFL00
          CALL      WRPRFLS1
          CALL      RUNFLA00      * Schedule Extract
          MOVE      ZERO,EXIT
          GOTO      ADDFLS99
.
ADDFLS90  MOVE      "Selection Already on File",WEBTITLE
          CALL      WEBERR00
          MOVE      ONE,EXIT
.
ADDFLS99  RETURN
.------------------------------------------------------------
. Update Private Practice Financial Letter Selection 
.------------------------------------------------------------
UPDFLS00  CALL      CLPRFL00 
          PACK      KEY4,PRFL0001,SP30
          CALL      RDPRFLS1
          IF        OVRCD=0
            CALL      MVPRFL00
            CALL      UPPRFLS1
            CALL      RUNFLA00       * Schedule Extract
            MOVE      ZERO,EXIT
          ELSE
            MOVE      "Selection Not On File",WEBTITLE
            CALL      WEBERR00
            MOVE      ONE,EXIT
          ENDIF
.
UPDFLS99  RETURN
.------------------------------------------------------------
. Delete Private Practice Financial Letter Selection 
.------------------------------------------------------------
DELFLS00  PACK      KEY4,PRFL0001,SP30
          CALL      RAPRFLS1
          IF        OVRCD=0
            CALL      DEPRFLS1
            CALL      RUNFLD00      * Schedule Extract Delete
            MOVE      ZERO,EXIT
          ELSE
            MOVE      "Selection Not On File",WEBTITLE
            CALL      WEBERR00
            MOVE      ONE,EXIT
          ENDIF
.
DELFLS99  RETURN
.
.------------------------------------------------------------
. General Letter Print 
.------------------------------------------------------------
PRIGLS00  CALL      CLPRGL00                * Clear Selection Variables
          MATCH     SP70,UPDTTYPE           * Dislay
          GOTO      PRIGLS50 IF EQUAL
.
          MATCH     "A",UPDTTYPE            * Add
          GOTO      PRIGLS10 IF EQUAL
.
          MATCH     "U",UPDTTYPE            * Update
          GOTO      PRIGLS20 IF EQUAL
.
          MATCH     "D",UPDTTYPE            * Delete
          GOTO      PRIGLS30 IF EQUAL
.
          MOVE      "Invalid Update Type",WEBTITLE
          CALL      WEBERR00
          GOTO      PRIGLS99
.
PRIGLS10  CALL      ADDGLS00 
          GOTO      PRIGLS99
.
PRIGLS20  CALL      UPDGLS00
          GOTO      PRIGLS99
.
PRIGLS30  CALL      DELGLS00
          GOTO      PRIGLS99
.
PRIGLS50  PACK      KEY4,PRGL0001,SP70
          CALL      RDPRGLS1
          IF        OVRCD=1
            CALL     CLPRGL00 
          ENDIF
          MOVE      "General Letter Selection List",WEBTITLE
          CALL      WEBHED00
          BRANCH    EXIT,PRIGLS99
          CALL      WEBBOD00
          CALL      WEBEND00
          MOVE      ONE,EXIT
.
PRIGLS99  RETURN
.
.------------------------------------------------------------
. Add General Letter Selection 
.------------------------------------------------------------
ADDGLS00  CALL      CLPRGL00
          PACK      KEY4,PRGL0001,SP30
          CALL      RAPRGLS1
          COMPARE   ZERO,OVRCD
          GOTO      ADDGLS90 IF EQUAL
.
          CALL      MVPRGL00
          CALL      WRPRGLS1
          CALL      RUNGLS00      * Schedule Extract
          MOVE      ZERO,EXIT
          GOTO      ADDGLS99
.
ADDGLS90  MOVE      "Selection Already on File",WEBTITLE
          CALL      WEBERR00
          MOVE      ONE,EXIT
.
ADDGLS99  RETURN
.------------------------------------------------------------
. Update General Letter Selection 
.------------------------------------------------------------
UPDGLS00  CALL      CLPRGL00 
          PACK      KEY4,PRGL0001,SP30
          CALL      RDPRGLS1
          IF        OVRCD=0
            CALL      MVPRGL00
            CALL      UPPRGLS1
            CALL      RUNGLS00       * Schedule Extract
            MOVE      ZERO,EXIT
          ELSE
            MOVE      "Selection Not On File",WEBTITLE
            CALL      WEBERR00
            MOVE      ONE,EXIT
          ENDIF
.
UPDGLS99  RETURN
.------------------------------------------------------------
. Delete General Letter Selection 
.------------------------------------------------------------
DELGLS00  PACK      KEY4,PRGL0001,SP30
          CALL      RAPRGLS1
          IF        OVRCD=0
            CALL      DEPRGLS1
.            CALL      RUNGLD00      * Schedule Extract Delete
            MOVE      ZERO,EXIT
          ELSE
            MOVE      "Selection Not On File",WEBTITLE
            CALL      WEBERR00
            MOVE      ONE,EXIT
          ENDIF
.
DELGLS99  RETURN
.
.------------------------------------------------------------
. Reminder Accounts  Print 
.------------------------------------------------------------
PRIREM00  CALL      CLPRRM00                * Clear Selection Variables
          MATCH     SP70,UPDTTYPE           * Dislay
          GOTO      PRIREM50 IF EQUAL
.
          MATCH     "A",UPDTTYPE            * Add
          GOTO      PRIREM10 IF EQUAL
.
          MATCH     "U",UPDTTYPE            * Update
          GOTO      PRIREM20 IF EQUAL
.
          MATCH     "D",UPDTTYPE            * Delete
          GOTO      PRIREM30 IF EQUAL
.
          MOVE      "Invalid Update Type",WEBTITLE
          CALL      WEBERR00
          GOTO      PRIREM99
.
PRIREM10  CALL      ADDREM00 
          GOTO      PRIREM99
.
PRIREM20  CALL      UPDREM00
          GOTO      PRIREM99
.
PRIREM30  CALL      DELREM00
          GOTO      PRIREM99
.
PRIREM50  PACK      KEY4,PRRM0001,SP70
          CALL      RDPRREM1
          IF        OVRCD=1
            CALL     CLPRRM00 
          ENDIF
          MOVE      "Reminder Accounts Selection List",WEBTITLE
          CALL      WEBHED00
          BRANCH    EXIT,PRIREM99
          CALL      WEBBOD00
          CALL      WEBEND00
          MOVE      ONE,EXIT
.
PRIREM99  RETURN
.
.------------------------------------------------------------
. Add Reminder Accounts Selection 
.------------------------------------------------------------
ADDREM00  CALL      CLPRRM00
          PACK      KEY4,PRRM0001,SP30
          CALL      RAPRREM1
          COMPARE   ZERO,OVRCD
          GOTO      ADDREM90 IF EQUAL
.
          CALL      MVPRRM00
          CALL      WRPRREM1
          CALL      RUNREM00      * Schedule Extract
          MOVE      ZERO,EXIT
          GOTO      ADDREM99
.
ADDREM90  MOVE      "Selection Already on File",WEBTITLE
          CALL      WEBERR00
          MOVE      ONE,EXIT
.
ADDREM99  RETURN
.------------------------------------------------------------
. Update Reminder Accounts Selection 
.------------------------------------------------------------
UPDREM00  CALL      CLPRRM00 
          PACK      KEY4,PRRM0001,SP30
          CALL      RDPRREM1
          IF        OVRCD=0
            CALL      MVPRRM00
            CALL      UPPRREM1
            CALL      RUNREM00       * Schedule Extract
            MOVE      ZERO,EXIT
          ELSE
            MOVE      "Selection Not On File",WEBTITLE
            CALL      WEBERR00
            MOVE      ONE,EXIT
          ENDIF
.
UPDREM99  RETURN
.------------------------------------------------------------
. Delete Reminder Accounts Selection 
.------------------------------------------------------------
DELREM00  PACK      KEY4,PRRM0001,SP30
          CALL      RAPRREM1
          IF        OVRCD=0
            CALL      DEPRREM1
            CALL      RUNRED00      * Schedule Extract Delete
            MOVE      ZERO,EXIT
          ELSE
            MOVE      "Selection Not On File",WEBTITLE
            CALL      WEBERR00
            MOVE      ONE,EXIT
          ENDIF
.
DELREM99  RETURN
.
.------------------------------------------------------------
. Adhoc Letter Print 
.------------------------------------------------------------
OTALLP00  CALL      CLOTAL00                * Clear Selection Variables
          MATCH     SP70,UPDTTYPE           * Dislay
          GOTO      OTALLP50 IF EQUAL
.
          MATCH     "A",UPDTTYPE            * Add
          GOTO      OTALLP10 IF EQUAL
.
          MATCH     "U",UPDTTYPE            * Update
          GOTO      OTALLP20 IF EQUAL
.
          MATCH     "D",UPDTTYPE            * Delete
          GOTO      OTALLP30 IF EQUAL
.
          MATCH     "G",UPDTTYPE            * Generate  I-90215
          GOTO      OTALLP40 IF EQUAL
.
          MOVE      "Invalid Update Type",WEBTITLE
          CALL      WEBERR00
          GOTO      OTALLP99
.
OTALLP10  CALL      ADDOTA00 
          GOTO      OTALLP99
.
OTALLP20  CALL      UPDOTA00
          GOTO      OTALLP99
.
OTALLP30  CALL      DELOTA00
          GOTO      OTALLP99
.
OTALLP40  CALL      GENOTA00         * I-90215
          GOTO      OTALLP99
.
OTALLP50  PACK      KEY4,OTAL0001,SP70
          CALL      RDOTADL1
          IF        OVRCD=1
            CALL      CLOTAL00
          ENDIF
          MOVE      "Ad Hoc Outpatient Letters Selection List",WEBTITLE
          CALL      WEBHED00
          BRANCH    EXIT,OTALLP99
          CALL      WEBBOD00
          CALL      WEBEND00
          MOVE      ONE,EXIT
.
OTALLP99  RETURN
.------------------------------------------------------------
. Add  Adhoc Letter Print
.------------------------------------------------------------
ADDOTA00  CALL      CLOTAL00
          PACK      KEY4,OTAL0001,SP30
          CALL      RAOTADL1
          COMPARE   ZERO,OVRCD
          GOTO      ADDOTA90 IF EQUAL
.
          CALL      MVOTAL00
          CALL      WROTADL1
          CALL      RUNADH00       * Schedule Extract
          MOVE      ZERO,EXIT
          GOTO      ADDOTA99
.
ADDOTA90  MOVE      "Selection Already on File",WEBTITLE
          CALL      WEBERR00
          MOVE      ONE,EXIT
.
ADDOTA99  RETURN
.------------------------------------------------------------
. Update Adhoc Letter Print
.------------------------------------------------------------
UPDOTA00  CALL      CLOTAL00
          PACK      KEY4,OTAL0001,SP30
          CALL      RDOTADL1
          IF        OVRCD=0
            CALL      MVOTAL00
            CALL      UPOTADL1
            MOVE      ZERO,EXIT
          ELSE
            MOVE      "Selection Not On File",WEBTITLE
            CALL      WEBERR00
            MOVE      ONE,EXIT
          ENDIF
.
UPDOTA99  RETURN
.------------------------------------------------------------
. Delete Adhoc Letter Print
.------------------------------------------------------------
DELOTA00  PACK      KEY4,OTAL0001,SP30
          CALL      RAOTADL1
          IF        OVRCD=0
            CALL      DEOTADL1
            CALL      RUNAHD00      * Schedule Extract Delete
            MOVE      ZERO,EXIT
          ELSE
            MOVE      "Selection Not On File",WEBTITLE
            CALL      WEBERR00
            MOVE      ONE,EXIT
          ENDIF
.
DELOTA99  RETURN
.------------------------------------------------------------
. Generate Scheduling for Adhoc Letter Print    * I-90215
.------------------------------------------------------------
GENOTA00  CALL      CLOTAL00
          PACK      KEY4,OTAL0001,SP30
          CALL      RDOTADL1
          IF        OVRCD=0
            CALL      MVOTAL00
            CALL      UPOTADL1       * update first
            CALL      RUNADH00       * Schedule Extract
            MOVE      ZERO,EXIT
          ELSE
            MOVE      "Selection Not On File",WEBTITLE
            CALL      WEBERR00
            MOVE      ONE,EXIT
          ENDIF
.
GENOTA99  RETURN
.------------------------------------------------------------
. Financial Letter Print 
.------------------------------------------------------------
PMSFIL00  CALL      CLPMSF00                * Clear Selection Variables
          MATCH     SP70,UPDTTYPE           * Dislay
          GOTO      PMSFIL50 IF EQUAL
.
          MATCH     "A",UPDTTYPE            * Add
          GOTO      PMSFIL10 IF EQUAL
.
          MATCH     "U",UPDTTYPE            * Update
          GOTO      PMSFIL20 IF EQUAL
.
          MATCH     "D",UPDTTYPE            * Delete
          GOTO      PMSFIL30 IF EQUAL
.
          MOVE      "Invalid Update Type",WEBTITLE
          CALL      WEBERR00
          GOTO      PMSFIL99
.
PMSFIL10  CALL      ADDFIL00
          GOTO      PMSFIL99
.
PMSFIL20  CALL      UPDFIL00
          GOTO      PMSFIL99
.
PMSFIL30  CALL      DELFIL00
          GOTO      PMSFIL99
.
PMSFIL50  MOVE      PMSFL001,KEY4
          CALL      RDPMLTF1
          IF        OVRCD=1
            CALL      CLPMSF00
          ENDIF
          MOVE      "Financial Letters Selection List",WEBTITLE
          CALL      WEBHED00
          BRANCH    EXIT,PMSFIL99
          CALL      WEBBOD00
          CALL      WEBEND00
          MOVE      ONE,EXIT
.
PMSFIL99  RETURN
.------------------------------------------------------------
. Add  Financial Letter Print Extract
.------------------------------------------------------------
ADDFIL00  CALL      CLPMSF00
          PACK      KEY4,PMSFL001,SP30
          CALL      RAPMLTF1
          COMPARE   ZERO,OVRCD
          GOTO      ADDFIL90 IF EQUAL
.
          CALL      MVPMFL00
          CALL      WRPMLTF1
          CALL      RUNLTF00      * Schedule Extract
          MOVE      ZERO,EXIT
          GOTO      ADDFIL99
.
ADDFIL90  MOVE      "Selection Already on File",WEBTITLE
          CALL      WEBERR00
          MOVE      ONE,EXIT
.
ADDFIL99  RETURN
.------------------------------------------------------------
. Update Financial Letter Print
.------------------------------------------------------------
UPDFIL00  CALL      CLPMSF00
          PACK      KEY4,PMSFL001,SP30
          CALL      RDPMLTF1
          IF        OVRCD=0
            CALL      MVPMFL00
            CALL      UPPMLTF1
            CALL      RUNLTF00       * Schedule Extract 
            MOVE      ZERO,EXIT
          ELSE
            MOVE      "Selection Not On File",WEBTITLE
            CALL      WEBERR00
            MOVE      ONE,EXIT
          ENDIF
.
UPDFIL99  RETURN
.------------------------------------------------------------
. Delete Financial Letter Print Extract
.------------------------------------------------------------
DELFIL00  PACK      KEY4,PMSFL001
          CALL      RAPMLTF1
          IF        OVRCD=0
            CALL      DEPMLTF1
            CALL      RUNLTD00      * Schedule Extract Delete
            MOVE      ZERO,EXIT
          ELSE
            MOVE      "Selection Not On File",WEBTITLE
            CALL      WEBERR00
            MOVE      ONE,EXIT
          ENDIF
.
DELFIL99  RETURN
.
.------------------------------------------------------------
. Patient Letter Selection 
.------------------------------------------------------------
PMSSEL00  CALL      CLPMSL00                * Clear Selection Variables
          MATCH     SP70,UPDTTYPE           * Dislay
          GOTO      PMSSEL50 IF EQUAL
.
          MATCH     "A",UPDTTYPE            * Add
          GOTO      PMSSEL10 IF EQUAL
.
          MATCH     "U",UPDTTYPE            * Update
          GOTO      PMSSEL20 IF EQUAL
.
          MATCH     "D",UPDTTYPE            * Delete
          GOTO      PMSSEL30 IF EQUAL
.
          MOVE      "Invalid Update Type",WEBTITLE
          CALL      WEBERR00
          GOTO      PMSSEL99
.
PMSSEL10  CALL      ADDSEL00
          GOTO      PMSSEL99
.
PMSSEL20  CALL      UPDSEL00
          GOTO      PMSSEL99
.
PMSSEL30  CALL      DELSEL00
          GOTO      PMSSEL99
.
PMSSEL50  MOVE      PMSLE001,KEY4
          CALL      RDPMLET1
          IF        OVRCD=1
            CALL      CLPMSL00
          ENDIF
          MOVE      "Patient Letters Selection List",WEBTITLE
          CALL      WEBHED00
          BRANCH    EXIT,PMSSEL99
          CALL      WEBBOD00
          CALL      WEBEND00
          MOVE      ONE,EXIT
          GOTO      PMSSEL99
.
PMSSEL99  RETURN
.------------------------------------------------------------
. Add  Extract
.------------------------------------------------------------
ADDSEL00  CALL      CLPMSL00
          PACK      KEY4,PMSLE001,SP30
          CALL      RAPMLET1
          COMPARE   ZERO,OVRCD
          GOTO      ADDSEL90 IF EQUAL
.
          CALL      MVPMLE00
          CALL      WRPMLET1
          CALL      RUNSEL00      * Schedule Extract
          MOVE      ZERO,EXIT
          GOTO      ADDSEL99
.
ADDSEL90  MOVE      "Selection Already on File",WEBTITLE
          CALL      WEBERR00
          MOVE      ONE,EXIT
.
ADDSEL99  RETURN
.------------------------------------------------------------
. Update Extract
.------------------------------------------------------------
UPDSEL00  CALL      CLPMSL00
          PACK      KEY4,PMSLE001,SP30
          CALL      RDPMLET1
          IF        OVRCD=0
            CALL      MVPMLE00
            CALL      UPPMLET1
            CALL      RUNSEL00      * Schedule Extract
            MOVE      ZERO,EXIT
          ELSE
            MOVE      "Selection Not On File",WEBTITLE
            CALL      WEBERR00
            MOVE      ONE,EXIT
          ENDIF
.
UPDSEL99  RETURN
.------------------------------------------------------------
. Delete Extract
.------------------------------------------------------------
DELSEL00  PACK      KEY4,PMSLE001
          CALL      RAPMLET1
          IF        OVRCD=0
            CALL      DEPMLET1
            CALL      RUNSED00      * Schedule Extract Delete
            MOVE      ZERO,EXIT
          ELSE
            MOVE      "Selection Not On File",WEBTITLE
            CALL      WEBERR00
            MOVE      ONE,EXIT
          ENDIF
.
DELSEL99  RETURN
.------------------------------------------------------------
. Display Outpatient Adhoc Letter Extract List
.------------------------------------------------------------
DISADH00  PACK      KEY4,OTAL0001,SP70
          CALL      RDOTADL1
          BRANCH    OVRCD,DISADH90
.
          MOVE      ZERO,RECTOTAL
          PACK      KEY25,OTAL0001,SP70
          CALL      RSOTLAD1
DISADH10  CALL      RKOTLAD1
          BRANCH    OVRCD,DISADH20

          MATCH     OTAL0001,OTLASEID
          GOTO      DISADH20 IF NOT EQUAL
.
          ADD       ONE,RECTOTAL
          GOTO      DISADH10
.
DISADH20  CLEAR     WEBTITLE
          APPEND    "Outpatients Adhoc Letters List - ",WEBTITLE
          APPEND    OTALSEDC,WEBTITLE
          RESET     WEBTITLE
          CALL      WEBHED00
          BRANCH    EXIT,DISADH99
          CALL      WEBBOD00
          CALL      WEBEND00
          MOVE      ONE,EXIT
          GOTO      DISADH99
.
DISADH90  MOVE      "Invalid Selection ID",WEBTITLE
          CALL      WEBERR00
          MOVE      ONE,EXIT
          GOTO      DISADH99
.
DISADH99  RETURN
.
.------------------------------------------------------------
. Display Private Practice Reminder Accounts Letter Extract List
.------------------------------------------------------------
DISREL00  PACK      KEY4,PRRM0001,SP70
          CALL      RDPRREM1
          BRANCH    OVRCD,DISREL90
.
          MOVE      ZERO,RECTOTAL
          PACK      KEY81,PRRM0001,SP70
          CALL      RSPRREL1
DISREL10  CALL      RKPRREL1
          BRANCH    OVRCD,DISREL20

          MATCH     PRFL0001,PRGSSEID
          GOTO      DISREL20 IF NOT EQUAL

          ADD       ONE,RECTOTAL
          GOTO      DISREL10
.
DISREL20  CLEAR     WEBTITLE
          APPEND    "Private Practice Reminder Letters List - ",WEBTITLE
          APPEND    PRRMSEDC,WEBTITLE
          RESET     WEBTITLE
          CALL      WEBHED00
          BRANCH    EXIT,DISREL99
          CALL      WEBBOD00
          CALL      WEBEND00
          MOVE      ONE,EXIT
          GOTO      DISREL99
.
DISREL90  MOVE      "Invalid Selection ID",WEBTITLE
          CALL      WEBERR00
          MOVE      ONE,EXIT
          GOTO      DISREL99
.
DISREL99  RETURN
.------------------------------------------------------------
. Display Private Practice General Letter Extract List
.------------------------------------------------------------
DISGSL00  PACK      KEY4,PRGL0001,SP70
          CALL      RDPRGLS1
          BRANCH    OVRCD,DISGSL90
.
          MOVE      ZERO,RECTOTAL
          PACK      KEY22,PRGL0001,SP70
          CALL      RSPRGSL1
DISGSL10  CALL      RKPRGSL1
          BRANCH    OVRCD,DISGSL20

          MATCH     PRGL0001,PRGSSEID
          GOTO      DISGSL20 IF NOT EQUAL

          ADD       ONE,RECTOTAL
          GOTO      DISGSL10
.
DISGSL20  CLEAR     WEBTITLE
          APPEND    "Private Practice General Letters List - ",WEBTITLE
          APPEND    PRGLSEDC,WEBTITLE
          RESET     WEBTITLE
          CALL      WEBHED00
          BRANCH    EXIT,DISGSL99
          CALL      WEBBOD00
          CALL      WEBEND00
          MOVE      ONE,EXIT
          GOTO      DISGSL99
.
DISGSL90  MOVE      "Invalid Selection ID",WEBTITLE
          CALL      WEBERR00
          MOVE      ONE,EXIT
          GOTO      DISGSL99
.
DISGSL99  RETURN
.------------------------------------------------------------
.                       RUNAHD00
.   Schedule Adhoc List Delete to be run via Program Scheduler
.------------------------------------------------------------
RUNAHD00  MOVE      "IBAOUT71",SCHDPGID
          MOVE      "Delete Adhoc Letter List",SCHDDESC
          PACK      SCHDDATE,CURRDATE,SP10
          CLOCK     TIME,SCHDTIME
          MOVE      "S",SCHDPRNT             * Spool File
.
.         Write Keyin parameters for Extract
.
.  ** I-90215
.
          MOVE      THREE,KEYSTARR[1]
          MOVE      OTAL0001,KEYSTARR[2]       * Selection ID
          MOVE      SP70,KEYSTARR[3]
          MOVE      SP70,KEYSTARR[4]
          MOVE      FOUR,KEYSTCNT               * Number of Keyins
.
          CALL      SCHPRO00   * Schedule Extract
.
RUNAHD99  RETURN
.------------------------------------------------------------
.                       RUNADH00
.   Schedule Selection to be run via Program Scheduler
.------------------------------------------------------------
RUNADH00  MOVE      "IBAOUT71",SCHDPGID
          MOVE      "Run Adhoc Letter List",SCHDDESC
          PACK      SCHDDATE,CURRDATE,SP10
          CLOCK     TIME,SCHDTIME
.
.         Write Keyin parameters for Extract
.
.  ** I-90215
.
          MOVE      TWO,KEYSTARR[1]
.
          MOVE      OTAL0001,KEYSTARR[2]       * Selection ID
          MOVE      USERID,KEYSTARR[3]         * Printed By
          MOVE      SP1,KEYSTARR[4]
          MOVE      SP1,KEYSTARR[5]
          MOVE      FIVE,KEYSTCNT              * Number of Keyins
.
          CALL      SCHPRO00   * Schedule Extract
.
RUNADH99  RETURN
.------------------------------------------------------------
.                       RUNGLD00
.   Schedule General List Delete to be run via Program Scheduler
.------------------------------------------------------------
RUNGLD00  MOVE      "IBAPRI71",SCHDPGID
          MOVE      "Delete General Letter List",SCHDDESC
          PACK      SCHDDATE,CURRDATE,SP10
          CLOCK     TIME,SCHDTIME
          MOVE      "S",SCHDPRNT             * Spool File
.
.         Write Keyin parameters for Extract
.
          MOVE      THREE,KEYSTARR[1]          * Option
          MOVE      PRGL0001,KEYSTARR[2]     * Extract ID
          MOVE      TWO,KEYSTCNT             * Number of Keyins
.
          CALL      SCHPRO00   * Schedule Extract
.
RUNGLD99  RETURN
.------------------------------------------------------------
.                       RUNGLS00
.   Schedule Extract to be run via Program Scheduler
.------------------------------------------------------------
RUNGLS00  MOVE      "IBAPRI71",SCHDPGID
          MOVE      "Run General Letter List",SCHDDESC
          PACK      SCHDDATE,CURRDATE,SP10
          CLOCK     TIME,SCHDTIME
.
.         Write Keyin parameters for Extract
.
          MOVE      ONE,KEYSTARR[1]          * Option
          MOVE      PRGL0001,KEYSTARR[2]     * Extract ID
          MOVE      SP10,KEYSTARR[3]         * Space 
          MOVE      SP10,KEYSTARR[4]         * Space 
          MOVE      FOUR,KEYSTCNT             * Number of Keyins
.
          CALL      SCHPRO00   * Schedule Extract
.
RUNGLS99  RETURN
.------------------------------------------------------------
.                       RUNRED00
.   Schedule Reminder List Delete to be run via Program Scheduler
.------------------------------------------------------------
RUNRED00  MOVE      "IBAPRI25",SCHDPGID
          MOVE      "Delete Reminder Letter List",SCHDDESC
          PACK      SCHDDATE,CURRDATE,SP10
          CLOCK     TIME,SCHDTIME
          MOVE      "S",SCHDPRNT             * Spool File
.
.         Write Keyin parameters for Extract
.
          MOVE      THREE,KEYSTARR[1]          * Option
          MOVE      PRRM0001,KEYSTARR[2]     * Extract ID
          MOVE      TWO,KEYSTCNT             * Number of Keyins
.
          CALL      SCHPRO00   * Schedule Extract
.
RUNRED99  RETURN
.------------------------------------------------------------
.                       RUNREM00
.   Schedule Extract to be run via Program Scheduler
.------------------------------------------------------------
RUNREM00  MOVE      "IBAPRI25",SCHDPGID
          MOVE      "Run Reminder Letter List",SCHDDESC
          PACK      SCHDDATE,CURRDATE,SP10
          CLOCK     TIME,SCHDTIME
.
.         Write Keyin parameters for Extract
.
          MOVE      ONE,KEYSTARR[1]          * Option
          MOVE      PRRM0001,KEYSTARR[2]     * Extract ID
          MOVE      TWO,KEYSTCNT             * Number of Keyins
.
          CALL      SCHPRO00   * Schedule Extract
.
RUNREM99  RETURN
.------------------------------------------------------------
.                       RUNSED00
.   Schedule Patient List Delete to be run via Program Scheduler
.------------------------------------------------------------
RUNSED00  MOVE      "IBAPMS89",SCHDPGID
          MOVE      "Delete Patient Letter List",SCHDDESC
          PACK      SCHDDATE,CURRDATE,SP10
          CLOCK     TIME,SCHDTIME
          MOVE      "S",SCHDPRNT             * Spool File
.
.         Write Keyin parameters for Extract
.
          MOVE      THREE,KEYSTARR[1]          * Option
          MOVE      PMSLE001,KEYSTARR[2]     * Extract ID
          MOVE      TWO,KEYSTCNT             * Number of Keyins
.
          CALL      SCHPRO00   * Schedule Extract
.
RUNSED99  RETURN
.------------------------------------------------------------
.                       RUNSEL00
.   Schedule Extract to be run via Program Scheduler
.------------------------------------------------------------
RUNSEL00  MOVE      "IBAPMS89",SCHDPGID
          MOVE      "Run Patient Letter List",SCHDDESC
          PACK      SCHDDATE,CURRDATE,SP10
          CLOCK     TIME,SCHDTIME
.
.         Write Keyin parameters for Extract
.
          MOVE      ONE,KEYSTARR[1]          * Option
          MOVE      PMSLE001,KEYSTARR[2]     * Extract ID
          MOVE      TWO,KEYSTCNT             * Number of Keyins
.
          CALL      SCHPRO00   * Schedule Extract
.
RUNSEL99  RETURN
.------------------------------------------------------------
.                       RUNFLA00
.   Schedule Extract to be run via Program Scheduler
.------------------------------------------------------------
RUNFLA00  MOVE      "IBAPRI70",SCHDPGID
          MOVE      "Run Private Practice Financial Letter List",SCHDDESC
          PACK      SCHDDATE,CURRDATE,SP10  
          CLOCK     TIME,SCHDTIME
.
.         Write Keyin parameters for Extract
.
          MOVE      ONE,KEYSTARR[1]          * Option
          MOVE      PRFL0001,KEYSTARR[2]     * Extract ID
          MOVE      TWO,KEYSTCNT             * Number of Keyins
.
          CALL      SCHPRO00   * Schedule Extract
.
RUNFLA99  RETURN
.------------------------------------------------------------
.                       RUNFLD00
.   Schedule Patient List Delete to be run via Program Scheduler
.------------------------------------------------------------
RUNFLD00  MOVE      "IBAPRI70",SCHDPGID
          MOVE      "Delete Private Practice Financial Letter List",SCHDDESC
          PACK      SCHDDATE,CURRDATE,SP10  
          CLOCK     TIME,SCHDTIME
          MOVE      "S",SCHDPRNT             * Spool File
.
.         Write Keyin parameters for Extract
.
          MOVE      THREE,KEYSTARR[1]          * Option
          MOVE      PMSFL001,KEYSTARR[2]     * Extract ID
          MOVE      TWO,KEYSTCNT             * Number of Keyins
.
          CALL      SCHPRO00   * Schedule Extract
.
RUNFLD99  RETURN
.------------------------------------------------------------
. Display Private Practice Financial Letter Extract List
.------------------------------------------------------------
DISFLI00  PACK      KEY4,PRFL0001,SP70
          CALL      RDPRFLS1
          BRANCH    OVRCD,DISFLI90
.
          MOVE      ZERO,RECTOTAL
          PACK      KEY22,PRFL0001,SP70
          CALL      RSPRFSL1
DISFLI10  CALL      RKPRFSL1
          BRANCH    OVRCD,DISFLI20

          MATCH     PRFL0001,PRFSSEID
          GOTO      DISFLI20 IF NOT EQUAL

          ADD       ONE,RECTOTAL
          GOTO      DISFLI10
.
DISFLI20  CLEAR     WEBTITLE
          APPEND    "Private Practice Finance Letters List - ",WEBTITLE
          APPEND    PRFLSEDC,WEBTITLE
          RESET     WEBTITLE
          CALL      WEBHED00
          BRANCH    EXIT,DISFLI99
          CALL      WEBBOD00
          CALL      WEBEND00
          MOVE      ONE,EXIT
          GOTO      DISFLI99
.
DISFLI90  MOVE      "Invalid Selection ID",WEBTITLE
          CALL      WEBERR00
          MOVE      ONE,EXIT
          GOTO      DISFLI99
.
DISFLI99  RETURN
.------------------------------------------------------------
.                       RUNLTF00
.   Schedule Extract to be run via Program Scheduler
.------------------------------------------------------------
RUNLTF00  MOVE      "IBABIL22",SCHDPGID
          MOVE      "Run Financial Letter List",SCHDDESC
          PACK      SCHDDATE,CURRDATE,SP10  
          CLOCK     TIME,SCHDTIME
.
.         Write Keyin parameters for Extract
.
          MOVE      ONE,KEYSTARR[1]          * Option
          MOVE      PMSFL001,KEYSTARR[2]     * Extract ID
          MOVE      TWO,KEYSTCNT             * Number of Keyins
.
          CALL      SCHPRO00   * Schedule Extract
.
RUNLTF99  RETURN
.------------------------------------------------------------
.                       RUNLTD00
.   Schedule Patient List Delete to be run via Program Scheduler
.------------------------------------------------------------
RUNLTD00  MOVE      "IBABIL22",SCHDPGID
          MOVE      "Delete Financial Letter List",SCHDDESC
          PACK      SCHDDATE,CURRDATE,SP10  
          CLOCK     TIME,SCHDTIME
          MOVE      "S",SCHDPRNT             * Spool File
.
.         Write Keyin parameters for Extract
.
          MOVE      THREE,KEYSTARR[1]          * Option
          MOVE      PMSFL001,KEYSTARR[2]     * Extract ID
          MOVE      TWO,KEYSTCNT             * Number of Keyins
.
          CALL      SCHPRO00   * Schedule Extract
.
RUNLTD99  RETURN
.------------------------------------------------------------
. Display  Extract List
.------------------------------------------------------------
DISSEL00  PACK      KEY4,PMSLE001,SP70
          CALL      RDPMLET1
          BRANCH    OVRCD,DISSEL90
          CALL      DISLTT00                * Total selected patients
.
DISSEL10  CLEAR     WEBTITLE
          APPEND    "Patient Letters List - ",WEBTITLE
          APPEND    PMLESEDC,WEBTITLE
          RESET     WEBTITLE
          CALL      WEBHED00
          BRANCH    EXIT,DISSEL99
          CALL      WEBBOD00
          CALL      WEBEND00
          MOVE      ONE,EXIT
          GOTO      DISSEL99
.
DISSEL90  MOVE      "Invalid Selection ID",WEBTITLE
          CALL      WEBERR00
          MOVE      ONE,EXIT
          GOTO      DISSEL99
.
DISSEL99  RETURN
.
.------------------------------------------------------------
. Display  Financial letter Extract List
.------------------------------------------------------------
DISFAL00  CALL      CLPMSF00             * clear fields
          PACK      KEY4,PMSFL001,SP70
          CALL      RDPMLTF1
          BRANCH    OVRCD,DISFAL90
.
          PACK      KEY12,PMSFL001,SP70
          CALL      RSPMLLF1
          CALL      RKPMLLF1
          BRANCH    OVRCD,DISFAL91

          MATCH     PMSFL001,PMLLSEID
          GOTO      DISFAL91 IF NOT EQUAL
.
DISFAL20  CLEAR     WEBTITLE
          APPEND    "Finance Letters List - ",WEBTITLE
          APPEND    PMLTSEDC,WEBTITLE
          RESET     WEBTITLE
          CALL      WEBHED00
          BRANCH    EXIT,DISFAL99
          CALL      WEBBOD00
          CALL      WEBEND00
          MOVE      ONE,EXIT
          GOTO      DISFAL99
.
DISFAL90  MOVE      "Invalid Selection ID",WEBTITLE
          CALL      WEBERR00
          MOVE      ONE,EXIT
          GOTO      DISFAL99
.
DISFAL91  MOVE      "No Records found",WEBTITLE
          CALL      WEBERR00
          MOVE      ONE,EXIT
          GOTO      DISFAL99
.
DISFAL99  RETURN
.
.-------------------------------------------------------------
. Total number of selected patients in extract
.-------------------------------------------------------------
DISLTT00  MOVE      ZERO,RECTOTAL
          PACK      KEY12,PMSLE001,SP70
          CALL      RSPMLST1
DISLTT10  CALL      RKPMLST1
          BRANCH    OVRCD,DISLTT99
.
          MATCH     PMSLE001,PMLSSEID
          GOTO      DISLTT99 IF NOT EQUAL
.
          ADD       ONE,RECTOTAL
          GOTO      DISLTT10
.
DISLTT99  RETURN
.------------------------------------------------------------
. Patient List
.------------------------------------------------------------
LSTLTT00  BRANCH    FLDITMNO,LSTLTT10,LSTLTT20,LSTLTT30,LSTLTT40:
                             LSTLTT50,LSTLTT60
.
          WRITE     HTMLFILE;"Invalid Tag";
          GOTO      LSTLTT99
.
LSTLTT10  CALL      DISLST00                * Patient Edit List
          GOTO      LSTLTT99
.
LSTLTT20  CALL      NEXTRS00                * next set of patients
          GOTO      LSTLTT99
.
LSTLTT30  CALL      PREVRS00                * previous set of patients
          GOTO      LSTLTT99
.
LSTLTT40  WRITE     HTMLFILE;RECTOTAL;
          GOTO      LSTLTT99
.
LSTLTT50  CALL      LETSNC00                * Selection list of letters
          GOTO      LSTLTT99
.
LSTLTT60  CALL      SMSSNC00                * Selection list of letters
          GOTO      LSTLTT99
.
LSTLTT99  RETURN
.------------------------------------------------------------
. Selection list of letters send
.------------------------------------------------------------
LETSNC00  PACK      KEY6,SP70
          CALL      RSPTLET1
LETSNC10  CALL      RKPTLET1
          BRANCH    OVRCD,LETSNC99
.
          COMPARE   ZERO,PTLELINO
          GOTO      LETSNC10 IF NOT EQUAL
.
          MATCH     "1",PTLEACTV                 * Skip Inactive
          GOTO      LETSNC10 IF EQUAL
.
          MATCH     "1",PTLECOMM                 * Skip if SMS Message
          GOTO      LETSNC10 IF EQUAL
.
          WRITE     HTMLFILE;"<option value=",PTLELTNO,">",PTLETEXT:
                               "</option>";
          GOTO      LETSNC10
.
LETSNC99  RETURN
.
.------------------------------------------------------------
. Selection list of SMS messages to send
.------------------------------------------------------------
SMSSNC00  PACK      KEY6,SP70
          CALL      RSPTLET1
SMSSNC10  CALL      RKPTLET1
          BRANCH    OVRCD,SMSSNC99

          COMPARE   ZERO,PTLELINO
          GOTO      SMSSNC10 IF NOT EQUAL
.
          MATCH     "1",PTLEACTV                 * Skip Inactive
          GOTO      SMSSNC10 IF EQUAL
.
          MATCH     "1",PTLECOMM                 * Skip if NOT SMS 
          GOTO      SMSSNC10 IF NOT EQUAL
.
          WRITE     HTMLFILE;"<option value=",PTLELTNO,">",PTLETEXT:
                               "</option>";
          GOTO      SMSSNC10
.
SMSSNC99  RETURN
.------------------------------------------------------------
. Private Practice Reminder Letter List
.------------------------------------------------------------
PRRLST00  BRANCH    FLDITMNO,PRRLST10,PRRLST20,PRRLST30,PRRLST40
.
          WRITE     HTMLFILE;"Invalid Tag";
          GOTO      PRRLST99
.
PRRLST10  CALL      DISTRL00 
          GOTO      PRRLST99
.
PRRLST20  CALL      NEXTRL00                * next set of General Letter  
          GOTO      PRRLST99
.
PRRLST30  CALL      PREVRL00                * previous set of General Letter
          GOTO      PRRLST99
.
PRRLST40  WRITE     HTMLFILE;RECTOTAL;
          GOTO      PRRLST99
.
PRRLST99  RETURN
.------------------------------------------------------------
. Selected Reminder Letter List
.------------------------------------------------------------
DISTRL00  UNPACK    DIM127,D1,LINKPRG,DIM127
          UNPACK    DIM127,D1,LINKREP,DIM127
          UNPACK    DIM127,D1,LINKTEM,DIM127
.
          CALL      DIRLHD00              * General Letter List Table Heading
.
          IF        NORECORD=0
            MOVE      PTCNNRTD,NORECORD     * Set Default No Records to Display
          ENDIF
          MOVE      ZERO,RECNUMB
          MOVE      ZERO,DISNUMB
.
          MOVE      PRRM0001,KEY4
          CALL      RDPRREM1
          BRANCH    OVRCD,DISTRL90
.
          PACK      KEY50,PRRM0001,SP70
          CALL      RSPRREL1
DISTRL10  CALL      RKPRREL1
          BRANCH    OVRCD,DISTRL99
.
          MATCH     PRRM0001,PRRLSEID
          GOTO      DISTRL99 IF NOT EQUAL
.
          ADD       ONE,RECNUMB
          IF        STARTNUM>=RECNUMB
            GOTO      DISTRL10
          ENDIF
.
          CALL      RLSROW00
          ADD       ONE,DISNUMB
          COMPARE   NORECORD,DISNUMB
          GOTO      DISTRL10 IF NOT EQUAL
          GOTO      DISTRL99
.
DISTRL90  MOVE      "Invalid Selection ID",WEBTITLE
          CALL      WEBERR00
          MOVE      ONE,EXIT
.
DISTRL99  RETURN
.------------------------------------------------------------
.  Table Selected Reminder Letter (TABLE HEADING)
.------------------------------------------------------------
DIRLHD00  WRITE     HTMLFILE;"<tr>":
                            "<td class=HeadingCell width=15%>Extract ID.</td>":
                   "<td class=HeadingCell width=15%>Debtor Name</td>":
                   "<td class=HeadingCell width=15%>Debtor Number</td>":
                   "<td class=HeadingCell width=15%>Invoice Number</td>":
                              "<td class=HeadingCell width=8%>Deleted</td>":
                             "</tr>";
DIRLHD999  RETURN
.--------------------------------------------------------------------------
. Read Selected Private Practice Reminder Letter details and write the 
. Selected Private Practice Reminder letter row to HTMLFILE
.--------------------------------------------------------------------------
RLSROW00  PACK      PRIRL002,PRRLNAME,PRRLDEBT,PRRLIVNO,SP70
.
          WRITE     HTMLFILE;"<td nowrap>",PRRLSEID,"</td>":
                               "<td>",PRRLNAME,"</td>":
                               "<td>",PRRLDEBT,"</td>":
                               "<td>",PRRLIVNO,"</td>";

          MATCH     "1",PRRLSTAT
          IF        @EQUAL
            WRITE     HTMLFILE;"<td><input type=checkbox name=prirl003":
                               " value=1 onclick=#"DeletePatient26(this":
                               ",'",PRRLSEID,"','",PRIRL002,"'":
                               ");#" checked></td>";
          ELSE
            WRITE     HTMLFILE;"<td><input type=checkbox name=prirl003":
                               " value=1 onclick=#"DeletePatient26(this":
                               ",'",PRRLSEID,"','",PRIRL002,"'":
                               ");#"></td>";
          ENDIF

          WRITE     HTMLFILE;"</tr>";
.
RLSROW99  RETURN
.-----------------------------------------------------------
. Link to Next Group of patients
.-----------------------------------------------------------
NEXTRL00  MOVE      NORECORD,KEY2
          REP       " +",KEY2
          ASSIGN    STARTNUM+NORECORD,F3
          MOVE      F3,KEY3
          REP       " +",KEY3
          UNPACK    DIM127,D1,FLDPARA,DIM127
          MOVE      REPORTNO,F2
          REP       " +",PRRM0001
.
          WRITE     HTMLFILE;"patweb87.pbl":
                                 "?reportno=",F2:
                                 "&template=",FLDPARA:
                                 "&startnum=",KEY3:
                                 "&norecord=",KEY2:
                                 "&prrm0001=",PRRM0001;
.
          REP       "+ ",PRRM0001
.
NEXTRL99  RETURN
.-------------------------------------------------------------
. Link to Prev Group of patients
.-------------------------------------------------------------
PREVRL00  MOVE      NORECORD,KEY2
          REP       " +",KEY2
          ASSIGN    STARTNUM-NORECORD,F3
          IF        F3<0
            MOVE      ZERO,F3
          ENDIF
          MOVE      F3,KEY3
          REP       " +",KEY3
          UNPACK    DIM127,D1,FLDPARA,DIM127
          MOVE      REPORTNO,F2
          REP       " +",PRRM0001
.
          WRITE     HTMLFILE;"patweb87.pbl":
                                 "?reportno=",F2:
                                 "&template=",FLDPARA:
                                 "&startnum=",KEY3:
                                 "&norecord=",KEY2:
                                 "&prrm0001=",PRRM0001;
.
          REP       "+ ",PRRM0001
.
PREVRL99  RETURN
.------------------------------------------------------------
. Private Practice General Letter List
.------------------------------------------------------------
PRGLST00  BRANCH    FLDITMNO,PRGLST10,PRGLST20,PRGLST30,PRGLST40:
                             PRGLST50
.
          WRITE     HTMLFILE;"Invalid Tag";
          GOTO      PRGLST99
.
PRGLST10  CALL      DISTGL00 
          GOTO      PRGLST99
.
PRGLST20  CALL      NEXTGL00                * next set of General Letter  
          GOTO      PRGLST99
.
PRGLST30  CALL      PREVGL00                * previous set of General Letter
          GOTO      PRGLST99
.
PRGLST40  WRITE     HTMLFILE;RECTOTAL;
          GOTO      PRGLST99
.
PRGLST50  MOVE      PRGLLTYP,PRLLTYP1
          CALL      SELPPL00                * Private Practice General Letter
          GOTO      PRGLST99
.
PRGLST99  RETURN
.------------------------------------------------------------
. Selected General Letter List
.------------------------------------------------------------
DISTGL00  UNPACK    DIM127,D1,LINKPRG,DIM127
          UNPACK    DIM127,D1,LINKREP,DIM127
          UNPACK    DIM127,D1,LINKTEM,DIM127
.
          CALL      DIGLHD00              * General Letter List Table Heading
.
          IF        NORECORD=0
            MOVE      PTCNNRTD,NORECORD     * Set Default No Records to Display
          ENDIF
          MOVE      ZERO,RECNUMB
          MOVE      ZERO,DISNUMB
.
          MOVE      PRGL0001,KEY4
          CALL      RDPRGLS1
          BRANCH    OVRCD,DISTGL90
.
          PACK      KEY22,PRGL0001,SP70
          CALL      RSPRGSL1
DISTGL10  CALL      RKPRGSL1
          BRANCH    OVRCD,DISTGL99
.
          MATCH     PRGL0001,PRGSSEID
          GOTO      DISTGL99 IF NOT EQUAL
.
          ADD       ONE,RECNUMB
          IF        STARTNUM>=RECNUMB
            GOTO      DISTGL10
          ENDIF
.
          CALL      GLSROW00
          ADD       ONE,DISNUMB
          COMPARE   NORECORD,DISNUMB
          GOTO      DISTGL10 IF NOT EQUAL
          GOTO      DISTGL99
.
DISTGL90  MOVE      "Invalid Selection ID",WEBTITLE
          CALL      WEBERR00
          MOVE      ONE,EXIT
.
DISTGL99  RETURN
.------------------------------------------------------------
.  Table Selected General Letter (TABLE HEADING)
.------------------------------------------------------------
DIGLHD00  WRITE     HTMLFILE;"<tr>":
                             "<td class=HeadingCell width=15%>Extract ID.</td>":
       "<td class=HeadingCell width=15%>Debtor Number</td>":
       "<td class=HeadingCell width=15%>Patient's Name</td>":
       "<td class=HeadingCell width=15%>Claim Code</td>":
       "<td class=HeadingCell width=15%>Medical Practitioner</td>":
       "<td class=HeadingCell width=15%>Service Doctor</td>":
                              "<td class=HeadingCell width=8%>Deleted</td>":
                             "</tr>"
DIGLHD999  RETURN
.--------------------------------------------------------------------------
. Read Selected Private Practice General Letter details and write the 
. Selected Private Practice General letter row to HTMLFILE
.--------------------------------------------------------------------------
GLSROW00  IF        PRGSSCAN=0
.            MOVE      PRGSDEBT,KEY8
.            CALL      RDPRDB1
.            BRANCH    OVRCD,GLSROW99
.            MOVE      PRDBSNAM,PSNAME
.            MOVE      PRDBGNAM,PGNAME
.            MOVE      PRDBTITL,PTITL
.            CALL      PATNAA00
            MOVE      "Unknown PP Debtor",PATFNAME
          ELSE
            MOVE      PRGSDEBT,KEY8
            CALL      RDMAST1
            BRANCH    OVRCD,GLSROW99
            CALL      PATNAA00
          ENDIF
.
          MOVE      PRGSUNIQ,KEY8
          CALL      RDPRHD2
          BRANCH    OVRCD,GLSROW99
.
          PACK      KEY5,CODECL,PRHDCLAM
          CALL      RDCODE1
          IF        OVRCD=1
            MOVE      "Unknown Desc",TDESC
          ENDIF
                    
          PACK      KEY6,PRGSPRAC,SP70
          CALL      RDPRPR1  
          IF        OVRCD=1
            MOVE      "Unknown Prac.",PRPRDESC
          ENDIF
.
          PACK      KEY10,PRGSSDOC,SP70
          CALL      RDPMHCP1  
          IF        OVRCD=0
            MOVE      PMHCTITL,FMTTITLE
            MOVE      PMHCGNAM,FMTGNAME
            MOVE      PMHCSNAM,FMTSNAME
            CALL      DOCNM000
          ELSE
            MOVE      "&nbsp",DOCFNAME
          ENDIF
.
          WRITE     HTMLFILE;"<tr><td nowrap>",PRGSSEID,"</td>":
                              "<td>",PRGSDEBT,"</td>":
                              "<td>",PATFNAME,"</td>":
                              "<td>",TDESC,"</td>":
                              "<td>",PRPRDESC,"</td>":
                              "<td>",DOCFNAME,"</td>";
.
          MATCH     "1",PRGSSTAT
          IF        @EQUAL
            WRITE     HTMLFILE;"<td><input type=checkbox name=prigl003":
                               " value=1 onclick=#"DeletePatient26(this":
                               ",'",PRGSSEID,"','",PRGSDEBT,"'":
                               ",'",PRGSSCAN,"','",PRGSUNIQ,"'":
                               ");#" checked></td>";
          ELSE
            WRITE     HTMLFILE;"<td><input type=checkbox name=prigl003":
                               " value=1 onclick=#"DeletePatient26(this":
                               ",'",PRGSSEID,"','",PRGSDEBT,"'":
                               ",'",PRGSSCAN,"','",PRGSUNIQ,"'":
                               ");#"></td>";
          ENDIF
.
          WRITE     HTMLFILE;"</tr>"
.
GLSROW99  RETURN
.-----------------------------------------------------------
. Link to Next Group of patients
.-----------------------------------------------------------
NEXTGL00  MOVE      NORECORD,KEY2
          REP       " +",KEY2
          ASSIGN    STARTNUM+NORECORD,F3
          MOVE      F3,KEY3
          REP       " +",KEY3
          UNPACK    DIM127,D1,FLDPARA,DIM127
          MOVE      REPORTNO,F2
          REP       " +",PRGL0001
.
          WRITE     HTMLFILE;"patweb87.pbl":
                                 "?reportno=",F2:
                                 "&template=",FLDPARA:
                                 "&startnum=",KEY3:
                                 "&norecord=",KEY2:
                                 "&prgl0001=",PRGL0001;
.
          REP       "+ ",PRGL0001
.
NEXTGL99  RETURN
.-------------------------------------------------------------
. Link to Prev Group of patients
.-------------------------------------------------------------
PREVGL00  MOVE      NORECORD,KEY2
          REP       " +",KEY2
          ASSIGN    STARTNUM-NORECORD,F3
          IF        F3<0
            MOVE      ZERO,F3
          ENDIF
          MOVE      F3,KEY3
          REP       " +",KEY3
          UNPACK    DIM127,D1,FLDPARA,DIM127
          MOVE      REPORTNO,F2
          REP       " +",PRGL0001
.
          WRITE     HTMLFILE;"patweb87.pbl":
                                 "?reportno=",F2:
                                 "&template=",FLDPARA:
                                 "&startnum=",KEY3:
                                 "&norecord=",KEY2:
                                 "&prgl0001=",PRGL0001;
.
          REP       "+ ",PRGL0001
.
PREVGL99  RETURN
.------------------------------------------------------------
. Private Practice Finance Letter List
.------------------------------------------------------------
PRFLST00  BRANCH    FLDITMNO,PRFLST10,PRFLST20,PRFLST30,PRFLST40:
                             PRFLST50
.
          WRITE     HTMLFILE;"Invalid Tag";
          GOTO      PRFLST99
.
PRFLST10  CALL      DISTFL00 
          GOTO      PRFLST99
.
PRFLST20  CALL      NEXTFL00                * next set of patients
          GOTO      PRFLST99
.
PRFLST30  CALL      PREVFL00                * previous set of patients
          GOTO      PRFLST99
.
PRFLST40  WRITE     HTMLFILE;RECTOTAL;
          GOTO      PRFLST99
.
PRFLST50  MOVE      PRFLLTYP,PRLLTYP1
          CALL      SELPPF00                * Private Practice Financial Letter
          GOTO      PRFLST99
.
PRFLST99  RETURN
.------------------------------------------------------------
. Selected Finance Letter List
.------------------------------------------------------------
DISTFL00  UNPACK    DIM127,D1,LINKPRG,DIM127
          UNPACK    DIM127,D1,LINKREP,DIM127
          UNPACK    DIM127,D1,LINKTEM,DIM127
.
          CALL      DIFLHD00              * Finance Letter List Table Heading
.
          IF        NORECORD=0
            MOVE      PTCNNRTD,NORECORD     * Set Default No Records to Display
          ENDIF
          MOVE      ZERO,RECNUMB
          MOVE      ZERO,DISNUMB
.
          MOVE      PRFL0001,KEY4
          CALL      RDPRFLS1
          BRANCH    OVRCD,DISTFL90
.
          PACK      KEY22,PRFL0001,SP70
          CALL      RSPRFSL1
DISTFL10  CALL      RKPRFSL1
          BRANCH    OVRCD,DISTFL99
.
          MATCH     PRFL0001,PRFSSEID
          GOTO      DISTFL99 IF NOT EQUAL
.
          ADD       ONE,RECNUMB
          IF        STARTNUM>=RECNUMB
            GOTO      DISTFL10
          ENDIF
.
          CALL      FLSROW00
          ADD       ONE,DISNUMB
          COMPARE   NORECORD,DISNUMB
          GOTO      DISTFL10 IF NOT EQUAL
          GOTO      DISTFL99
.
DISTFL90  MOVE      "Invalid Selection ID",WEBTITLE
          CALL      WEBERR00
          MOVE      ONE,EXIT
.
DISTFL99  RETURN
.------------------------------------------------------------
.  Table Selected Finance Letter (TABLE HEADING)
.------------------------------------------------------------
DIFLHD00  WRITE     HTMLFILE;"<tr>":
                             "<td class=HeadingCell width=10%>Extract ID.</td>":
       "<td class=HeadingCell width=10%>Debtor Number</td>":
       "<td class=HeadingCell width=15%>Patient's Name</td>":
       "<td class=HeadingCell width=15%>Claim Code</td>":
       "<td class=HeadingCell width=15%>Medical Practitioner</td>":
       "<td class=HeadingCell width=15%>Service Doctor</td>":
       "<td class=HeadingCell width=15% align=right>Outstanding Amount</td>":
                              "<td class=HeadingCell width=5%>Deleted</td>":
                             "</tr>"
DIFLHD999  RETURN
.--------------------------------------------------------------------------
. Read Selected Private Practice Finance  Letter details and write the 
. Selected Private Practice Finance letter row to HTMLFILE
.--------------------------------------------------------------------------
FLSROW00  IF        PRFSSCAN=0
.            MOVE      PRFSDEBT,KEY8
.            CALL      RDPRDB1
.            BRANCH    OVRCD,FLSROW99
.            MOVE      PRDBSNAM,PSNAME
.            MOVE      PRDBGNAM,PGNAME
.            MOVE      PRDBTITL,PTITL
.            CALL      PATNAA00
            MOVE      "Unknown PP Debtor",PATFNAME
          ELSE
            MOVE      PRFSDEBT,KEY8
            CALL      RDMAST1
            BRANCH    OVRCD,FLSROW99
            CALL      PATNAA00
          ENDIF
.
          MOVE      PRFSUNIQ,KEY8
          CALL      RDPRHD2
          BRANCH    OVRCD,FLSROW99
.
          PACK      KEY5,CODECL,PRHDCLAM
          CALL      RDCODE1
          IF        OVRCD=1
            MOVE      "Unknown Desc",TDESC
          ENDIF
.
          PACK      KEY6,PRFSPRAC,SP70
          CALL      RDPRPR1
          IF        OVRCD=1
            MOVE      "Unknown Prac.",PRPRDESC
          ENDIF
.
          PACK      KEY10,PRFSSDOC,SP70
          CALL      RDPMHCP1  
          IF        OVRCD=0
           MOVE      PMHCTITL,FMTTITLE
           MOVE      PMHCGNAM,FMTGNAME
           MOVE      PMHCSNAM,FMTSNAME
           CALL      DOCNM000
          ELSE
           MOVE      "&nbsp",DOCFNAME
          ENDIF
.
          WRITE     HTMLFILE;"<tr><td nowrap>",PRFSSEID,"</td>":
                              "<td>",PRFSDEBT,"</td>":
                              "<td>",PATFNAME,"</td>":
                              "<td>",TDESC,"</td>":
                              "<td>",PRPRDESC,"</td>":
                              "<td>",DOCFNAME,"</td>":
                              "<td align=right>",PRFSOSMT,"</td>"; 
.
          MOVE      TWO,EXTRTYPE
          MATCH     "1",PRFSSTAT
          IF        @EQUAL
            WRITE     HTMLFILE;"<td><input type=checkbox name=prifl003":
                               " value=1 onclick=#"DeletePatient29(this":
                               ",'",PRFSSEID,"','",PRFSDEBT,"'":
                               ",'",DPRFSSCA,"','",DPRFSUNI,"'":
                               ");#" checked></td>";
          ELSE
            WRITE     HTMLFILE;"<td><input type=checkbox name=prifl003":
                               " value=1 onclick=#"DeletePatient29(this":
                               ",'",PRFSSEID,"','",PRFSDEBT,"'":
                               ",'",DPRFSSCA,"','",DPRFSUNI,"'":
                               ");#"></td>";
          ENDIF
.
          WRITE     HTMLFILE;"</tr>"
.
FLSROW99  RETURN
.
.-----------------------------------------------------------
. Link to Next Group of patients
.-----------------------------------------------------------
NEXTFL00  MOVE      NORECORD,KEY2
          REP       " +",KEY2
          ASSIGN    STARTNUM+NORECORD,F3
          MOVE      F3,KEY3
          REP       " +",KEY3
          UNPACK    DIM127,D1,FLDPARA,DIM127
          MOVE      REPORTNO,F2
          REP       " +",PRFL0001
.
          WRITE     HTMLFILE;"patweb87.pbl":
                                 "?reportno=",F2:
                                 "&template=",FLDPARA:
                                 "&startnum=",KEY3:
                                 "&norecord=",KEY2:
                                 "&prfl0001=",PRFL0001;
.
          REP       "+ ",PRFL0001
.
NEXTFL99  RETURN
.-------------------------------------------------------------
. Link to Prev Group of patients
.-------------------------------------------------------------
PREVFL00  MOVE      NORECORD,KEY2
          REP       " +",KEY2
          ASSIGN    STARTNUM-NORECORD,F3
          IF        F3<0
            MOVE      ZERO,F3
          ENDIF
          MOVE      F3,KEY3
          REP       " +",KEY3
          UNPACK    DIM127,D1,FLDPARA,DIM127
          MOVE      REPORTNO,F2
          REP       " +",PRFL0001
.
          WRITE     HTMLFILE;"patweb87.pbl":
                                 "?reportno=",F2:
                                 "&template=",FLDPARA:
                                 "&startnum=",KEY3:
                                 "&norecord=",KEY2:
                                 "&prfl0001=",PRFL0001;
.
          REP       "+ ",PRFL0001
.
PREVFL99  RETURN
.------------------------------------------------------------
. Finance Letter List
.------------------------------------------------------------
FANLST00  BRANCH    FLDITMNO,FANLST10,FANLST20,FANLST30,FANLST40:
                             FANLST50
.
          WRITE     HTMLFILE;"Invalid Tag";
          GOTO      FANLST99
.
FANLST10  CALL      DISTFA00 
          GOTO      FANLST99
.
FANLST20  CALL      NEXTFA00                * next set of patients
          GOTO      FANLST99
.
FANLST30  CALL      PREVFA00                * previous set of patients
          GOTO      FANLST99
.
FANLST40  
          GOTO      FANLST99
.
FANLST50  MOVE      PMLTLCOD,CODE
          CALL      SELFLT00 
          GOTO      FANLST99
.
FANLST99  RETURN
.------------------------------------------------------------
. Selected Finance Letter List
.------------------------------------------------------------
DISTFA00  UNPACK    DIM127,D1,LINKPRG,DIM127
          UNPACK    DIM127,D1,LINKREP,DIM127
          UNPACK    DIM127,D1,LINKTEM,DIM127
.
          MOVE      ZERO,LOOPCNTR
.
          MOVE      ZERO,RECCNT
.
          MOVE      PMSFL001,KEY4
          CALL      RDPMLTF1
          BRANCH    OVRCD,DISTFA90
.
          PACK      KEY12,PMSFL001,SP70
          CALL      RSPMLLF1
DISTFA10  CALL      RKPMLLF1
          BRANCH    OVRCD,DISTFA99
.
.------------------------------------------------------
. Loop counter to prevent timeout internal server error
.
          ADD       ONE,LOOPCNTR
.
          IF        (LOOPCNTR = 200)
            WRITE     HTMLFILE;"// ",LOOPCNTR
            MOVE      ZERO,LOOPCNTR
          ENDIF
.
. -----------------------------------------------------
.
          MATCH     PMSFL001,PMLLSEID
          GOTO      DISTFA99 IF NOT EQUAL
.
          CALL      FANROW00
.
          MOVE      PMLLVISN,KEY8
          REP       " +",KEY8
          REP       " +",URNUMBER
.
          CLEAR     PATLINK                 * Link for Patient Folder
          APPEND    LINKPRG,PATLINK
          APPEND    ".pbl?reportno=",PATLINK
          APPEND    LINKREP,PATLINK
          APPEND    "&template=",PATLINK
          APPEND    LINKTEM,PATLINK
          APPEND    "&urnumber=",PATLINK
          APPEND    URNUMBER,PATLINK
          APPEND    "&admissno=",PATLINK
          APPEND    KEY8,PATLINK
          RESET     PATLINK
.
          CALL      PRVL0000              * Check for any previous letter
.
          PACK      KEY14,PFUNDH,ZERO,ZERO,ZERO,ZERO,SP10
          CALL      RDFUND1
          IF        OVRCD=1
            PACK      HFNAME,PFUNDH,SP70
          ENDIF      
.
          PACK      TDESC,ACLAIM,SP70
          MATCH     SP70,ACLAIM
          IF        !@EQUAL
            PACK      KEY5,ANSC,ANSL,ACLAIM
            CALL      RDCODE1
          ENDIF
.
          WRITE     HTMLFILE;"t.addRow(#"",PATLINK,"#",":
                             "#"",FORMATNM,"#",":
                             "#"",VISITDSC,"#",":
                             "#"",PMLLVISN,"#",":
                             "#"",ADATE,"#",":
                             "#"",DDATE,"#",":
                             "#"",PMLLOSMT,"#",":
                             "#"",KEY25,"#",":
                             "#"",KEY17,"#",":
                             "#"",TDESC,"#",":
                             "#"",HFNAME,"#",";
.
          REP       "+ ",URNUMBER
          MOVE      TWO,EXTRTYPE
          MOVE      PMLLSEID,KEY4
          REP       " +",KEY4
          MOVE      PMLLVISN,KEY8
          REP       " +",KEY8
.
          MATCH     "1",PMLLSTAT
          IF        @EQUAL
            WRITE     HTMLFILE;"#"<input type=checkbox":
                               " name=pmlls003 value='1":
                               "' onclick=DeletePatient17(this":
                               ",'",KEY4,"','",KEY8,"'":
                               "); checked>":
                               "#");";
          ELSE
            WRITE     HTMLFILE;"#"<input type=checkbox":
                               " name=pmlls003 value='1":
                               "' onclick=DeletePatient17(this":
                               ",'",KEY4,"','",KEY8,"'":
                               ");>":
                               "#");"
          ENDIF
.
          ADD       ONE,RECCNT
          COMPARE   FIVEHUND,RECCNT
          IF        @EQUAL
            WRITE     HTMLFILE;"alert('Limit Reached.');"
            GOTO      DISTFA99
          ENDIF
.
          GOTO      DISTFA10
.
DISTFA90  MOVE      "Invalid Selection ID",WEBTITLE
          CALL      WEBERR00
          MOVE      ONE,EXIT
.
DISTFA99  RETURN
.
.------------------------------------------------------------
.         Check for any previous letter
.------------------------------------------------------------
PRVL0000  MOVE      SP70,KEY25
          PACK      KEY19,PMLLVISN,Z70
          CALL      RSPTLH1
          CALL      RPPTLH1
          BRANCH    OVRCD,PRVL9999
          MATCH     PMLLVISN,DPTLHADM
          GOTO      PRVL9999 IF NOT EQUAL
.
          CLEAR     KEY25
          MATCH     SP70,PTLHDATE          * Check date letter printed
          GOTO      PRVL2000 IF EQUAL
.
          UNPACK    PTLHDATE,CCENT,CYEAR,CMON,CDAY
          MOVE      CMON,F2
          LOAD      MTHNAM3,F2,JAN,FEB,MAR,APR,MAY,JUN,JUL,AUG,SEP,OCT,NOV,DEC
          PACK      DISPDAT2,CDAY,SP1,MTHNAM3,SP1,CCENT,CYEAR
          APPEND    DISPDAT2,KEY25
.
PRVL2000  MATCH     SP70,DPTLHLCO           * Check letter code
          GOTO      PRVL4000 IF EQUAL
.
          MOVE      ZERO,F3
          PACK      KEY6,DPTLHLCO,F3
          CALL      RDPTFL1
          BRANCH    OVRCD,PRVL4000
          APPEND    "-",KEY25
          APPEND    PTFLTEXT,KEY25
.
PRVL4000  APPEND    SP70,KEY25
          RESET     KEY25
.
PRVL9999  RETURN
+
.------------------------------------------------------------
. Read Selected Finance  Letter details and write the
. Selected Finance letter row to HTMLFILE
.------------------------------------------------------------
FANROW00  PACK      KEY8,PMLLVISN,SP70
          CALL      RDVISA1                      * read visit record
          BRANCH    OVRCD,FANROW99
.
          MOVE      PVIDATE,ADATE
          MOVE      PVIURNO,AURNO
          MOVE      PMLLVISN,AADMNO
.
          MOVE      "&nbsp;",VISITDSC
          LOAD      VISITDSC,PVITYPE,VISTYEMR,VISTYOUT,VISTYINP,VISTYPPR:
                                     VISTYDAY,VISTYUNK,VISTYUNK,VISTYUNK:
                                     VISTYEVT,VISTYALL
.
          UNPACK    SP70,ACLAIM,PFUNDH,DDATE
          PACK      KEY8,AURNO,SP70
          CALL      RDMAST1
          IF        OVRCD=1
            MOVE      "Invalid U/R",FORMATNM
          ELSE
            MOVE      AURNO,URNUMBER
            IF        PCEASE=1
              MOVE      PDECDTE,AGEDATE            * Date of Death
            ELSE
              PACK      AGEDATE,CURRDATE,SP10      * Today's date
            ENDIF
            REP       " 0",AGEDATE
            CALL      CALCAGE
            CALL      PATLN000
          ENDIF
.
          MOVE      PVIBILL,KEY8
          BRANCH    PVITYPE,FANROW10,FANROW20,FANROW30
          GOTO      FANROW60
.
FANROW10  CALL      RDEMVIS1
          IF        OVRCD=0
            MOVE      EMVICOMP,ACLAIM
            MOVE      EMVIFUND,PFUNDH
            MOVE      EMVIDDAT,DDATE
          ENDIF
          GOTO      FANROW60
.
FANROW20  CALL      RDBOKB1
          IF        OVRCD=0
            MOVE      OBACOMP,ACLAIM
            MOVE      OTBBFUND,PFUNDH
          ENDIF
          GOTO      FANROW60
.
FANROW30  PACK      KEY8,PMLLVISN,SP70
          CALL      RDMISS1
          IF        OVRCD=0
            MOVE      AFUNDH,PFUNDH
            IF        ASTAT=3
              CALL      RDDSCH1
            ENDIF
          ENDIF
.
FANROW60  CALL      GINV0000     * Get the last two invoice no. for the visit
.
FANROW99  RETURN
.
.-----------------------------------------------------------
.         Get the last two invoice numbers for the visit
.-----------------------------------------------------------
GINV0000  MOVE      SP70,KEY17
          MOVE      ZERO,F1
          CLEAR     KEY17
          PACK      KEY16,AADMNO,Z70
          CALL      RDSINV3
GINV2000  CALL      RDPINV3
          BRANCH    OVRCD,GINV9000
.
          MATCH     AADMNO,PINVADM
          GOTO      GINV9000 IF NOT EQUAL
.
          COMPARE   ZERO,F1
          GOTO      GINV4000 IF EQUAL
          APPEND    " ",KEY17
.
GINV4000  APPEND    PINVNO,KEY17
          ADD       ONE,F1
          BRANCH    F1,GINV2000
.
GINV9000  APPEND    SP70,KEY17
          RESET     KEY17
GINV9999  RETURN

.-----------------------------------------------------------
. Link to Next Group of patients
.-----------------------------------------------------------
NEXTFA00  MOVE      NORECORD,KEY2
          REP       " +",KEY2
          ASSIGN    STARTNUM+NORECORD,F3
          MOVE      F3,KEY3
          REP       " +",KEY3
          UNPACK    DIM127,D1,FLDPARA,DIM127
          MOVE      REPORTNO,F2
          REP       " +",PMSFL001
          REP       " +",NEXTFKEY
.
          WRITE     HTMLFILE;"patweb87.pbl":
                                 "?reportno=",F2:
                                 "&template=",FLDPARA:
                                 "&startnum=",KEY3:
                                 "&norecord=",KEY2:
                                 "&nextfkey=",NEXTFKEY:
                                 "&pmsfl001=",PMSFL001;
.
          REP       "+ ",PMSFL001
          REP       "+ ",NEXTFKEY
.
NEXTFA99  RETURN
.-------------------------------------------------------------
. Link to Prev Group of patients
.-------------------------------------------------------------
PREVFA00  MOVE      NORECORD,KEY2
          REP       " +",KEY2
          ASSIGN    STARTNUM-NORECORD,F3
          IF        F3<0
            MOVE      ZERO,F3
          ENDIF
          MOVE      F3,KEY3
          REP       " +",KEY3
          UNPACK    DIM127,D1,FLDPARA,DIM127
          MOVE      REPORTNO,F2
          REP       " +",PMSFL001
          REP       " +",PREVFKEY
.
          WRITE     HTMLFILE;"patweb87.pbl":
                                 "?reportno=",F2:
                                 "&template=",FLDPARA:
                                 "&startnum=",KEY3:
                                 "&norecord=",KEY2:
                                 "&prvfflag=",ONE:
                                 "&prevfkey=",PREVFKEY:
                                 "&pmsfl001=",PMSFL001;
.
          REP       "+ ",PMSFL001
          REP       "+ ",PREVFKEY
.
PREVFA99  RETURN
.------------------------------------------------------------
. Patient List
.------------------------------------------------------------
DISLST00  UNPACK    DIM127,D1,LINKPRG,DIM127
          UNPACK    DIM127,D1,LINKREP,DIM127
          UNPACK    DIM127,D1,LINKTEM,DIM127
.
          CALL      DISHD000                * Patient List Table Heading
.
          IF        NORECORD=0
            MOVE      PTCNNRTD,NORECORD     * Set Default No Records to Display
          ENDIF
          MOVE      ZERO,RECNUMB
          MOVE      ZERO,DISNUMB
.
          MOVE      PMSLE001,KEY4
          CALL      RDPMLET1
          BRANCH    OVRCD,DISLST90
.
          PACK      KEY12,PMSLE001,SP70
          CALL      RSPMLST1
DISLST10  CALL      RKPMLST1
          BRANCH    OVRCD,DISLST99
.
          MATCH     PMSLE001,PMLSSEID
          GOTO      DISLST99 IF NOT EQUAL
.
          ADD       ONE,RECNUMB
          IF        STARTNUM>=RECNUMB
            GOTO      DISLST10
          ENDIF
.
          CALL      RESROW00
          ADD       ONE,DISNUMB
          COMPARE   NORECORD,DISNUMB
          GOTO      DISLST10 IF NOT EQUAL
          GOTO      DISLST99
.
DISLST90  MOVE      "Invalid Selection ID",WEBTITLE
          CALL      WEBERR00
          MOVE      ONE,EXIT
.
DISLST99  RETURN
.------------------------------------------------------------
.  Table Patient Extract Tables (TABLE HEADING)
.------------------------------------------------------------
DISHD000  WRITE     HTMLFILE;"<tr>":
                              "<td class=HeadingCell>Patient</td>":
       "<td class=HeadingCell width=15%>Admission</td>":
       "<td class=HeadingCell width=15%>Admission Date</td>":
       "<td class=HeadingCell width=15%>Discharge Date</td>":
                              "<td class=HeadingCell width=8%>Deleted</td>":
                             "</tr>"
DISHD999  RETURN
.------------------------------------------------------------
. Read patient details and write the patient row to HTMLFILE
.------------------------------------------------------------
RESROW00  PACK      KEY8,PMLSADMN,SP70
          CALL      RDMISS1
          IF        OVRCD=1
            MOVE      "Invalid Admission",FORMATNM
          ENDIF
.
          UNPACK    ADATE,CCENT,CYEAR,CMON,CDAY
          MOVE      CMON,F2
          LOAD      MTHNAM3,F2,JAN,FEB,MAR,APR,MAY,JUN,JUL,AUG,SEP,OCT,NOV,DEC
          PACK      DISPDAT2,CDAY,SP1,MTHNAM3,SP1,CCENT,CYEAR
.
          PACK      KEY8,AURNO,SP70
          CALL      RDMAST1
          IF        OVRCD=1
            MOVE      "Invalid U/R",FORMATNM
          ELSE
          MOVE      AURNO,URNUMBER
            IF        PCEASE=1
              MOVE      PDECDTE,AGEDATE            * Date of Death
            ELSE
              PACK      AGEDATE,CURRDATE,SP10      * Today's date
            ENDIF
            REP       " 0",AGEDATE
            CALL      CALCAGE
            CALL      PATLN000
          ENDIF
.
          PACK      KEY8,AADMNO,SP70
          CALL      RDDSCH1
          IF        OVRCD=1
            MOVE      SP70,DISPDATE
          ELSE
            UNPACK    DDATE,CCENT,CYEAR,CMON,CDAY
            MOVE      CMON,F2
            LOAD      MTHNAM3,F2,JAN,FEB,MAR,APR,MAY,JUN,JUL,AUG,SEP,OCT,NOV,DEC
            PACK      DISPDATE,CDAY,SP1,MTHNAM3,SP1,CCENT,CYEAR
          ENDIF
.
          MOVE      PMLSADMN,ADMISSNO
          REP       " +",ADMISSNO
          REP       " +",URNUMBER
.
          WRITE     HTMLFILE;"<td nowrap><A HREF=",LINKPRG,".pbl":
                             "?reportno=",LINKREP:
                             "&template=",LINKTEM:
                             "&urnumber=",URNUMBER:
                             "&admissno=",ADMISSNO,">":
                              "<img src=../images/MaintenanceIcon.gif hspace=4":
                              " border=0 align=absmiddle></a>":
                              FORMATNM,"</td>":
                              "<td>",PMLSADMN,"</td>":
                              "<td>",DISPDAT2,"</td><td nowrap>":
                              DISPDATE,"</td>";
.
          REP       "+ ",URNUMBER
          REP       "+ ",ADMISSNO
          MOVE      TWO,EXTRTYPE
          MATCH     "1",PMLSDLST
          IF        @EQUAL
            WRITE     HTMLFILE;"<td><input type=checkbox name=pmsls003":
                               " value=1 onclick=#"DeletePatient13(this":
                               ",'",PMLSSEID,"','",PMLSADMN,"'":
                               ");#" checked></td>";
          ELSE
            WRITE     HTMLFILE;"<td><input type=checkbox name=pmsls003":
                               " value=1 onclick=#"DeletePatient13(this":
                               ",'",PMLSSEID,"','",PMLSADMN,"'":
                               ");#"></td>";
          ENDIF
.
          WRITE     HTMLFILE;"</tr>"
.
RESROW99  RETURN
.-----------------------------------------------------------
. Link to Next Group of patients
.-----------------------------------------------------------
NEXTRS00  MOVE      NORECORD,KEY2
          REP       " +",KEY2
          ASSIGN    STARTNUM+NORECORD,F3
          MOVE      F3,KEY3
          REP       " +",KEY3
          UNPACK    DIM127,D1,FLDPARA,DIM127
          MOVE      REPORTNO,F2
          REP       " +",PMSLE001
          REP       " +",PMDLT001
.
          WRITE     HTMLFILE;"patweb87.pbl":
                                 "?reportno=",F2:
                                 "&template=",FLDPARA:
                                 "&startnum=",KEY3:
                                 "&norecord=",KEY2:
                                 "&pmsle001=",PMSLE001:
                                 "&pmdlt001=",PMDLT001;
.
          REP       "+ ", PMSLE001
          REP       "+ ", PMDLT001
.
NEXTRS99  RETURN
.-------------------------------------------------------------
. Link to Prev Group of patients
.-------------------------------------------------------------
PREVRS00  MOVE      NORECORD,KEY2
          REP       " +",KEY2
          ASSIGN    STARTNUM-NORECORD,F3
          IF        F3<0
            MOVE      ZERO,F3
          ENDIF
          MOVE      F3,KEY3
          REP       " +",KEY3
          UNPACK    DIM127,D1,FLDPARA,DIM127
          MOVE      REPORTNO,F2
          REP       " +",PMSLE001
          REP       " +",PMDLT001
.
          WRITE     HTMLFILE;"patweb87.pbl":
                                 "?reportno=",F2:
                                 "&template=",FLDPARA:
                                 "&startnum=",KEY3:
                                 "&norecord=",KEY2:
                                 "&pmsle001=",PMSLE001:
                                 "&pmdlt001=",PMDLT001;
.
          REP       "+ ",PMSLE001
          REP       "+ ",PMDLT001
.
PREVRS99  RETURN
.------------------------------------------------------------
. Invoice Message Table (patmesgf)
.------------------------------------------------------------
IMTAB000  UNPACK    DIM127,D1,LINKPRG,DIM127
          UNPACK    DIM127,D1,LINKREP,DIM127
          UNPACK    DIM127,D1,LINKTEM,DIM127
.
          CALL      IMHED000              * Output Table Heading
.
          IF        NORECORD=0
            MOVE      PTCNNRTD,NORECORD     * Set Default No Records to Display
          ENDIF
          MOVE      ZERO,RECNUMB
          MOVE      ZERO,DISNUMB
.
          PACK      KEY3,STARTKEY,SP70
          CALL      RDSMESG1
          IF        OVRCD=0
            CALL      RDPMESG1
          ENDIF
IMTAB100  CALL      RDKMESG1
          BRANCH    OVRCD,IMTAB900
.
          ADD       ONE,RECNUMB
          IF        STARTNUM>=RECNUMB
            GOTO      IMTAB100
          ENDIF
.
          CALL      IMROWA00               * Invoice Message Row  
          ADD       ONE,DISNUMB
          COMPARE   NORECORD,DISNUMB
          GOTO      IMTAB100 IF NOT EQUAL
          GOTO      IMTAB999
.
IMTAB900  CALL      NOMORE00     * Display No More Records Message
.
IMTAB999  RETURN
.------------------------------------------------------------
. Invoice Messages  (TABLE HEADING) (patmesgf)
.------------------------------------------------------------
IMHED000  WRITE     HTMLFILE;"<tr>":
                               "<td class=HeadingCell width=20%>":
                               "<b>Message Code</b></td>":
                               "<td class=HeadingCell width=40%>":
                               "<b>Message Line 1</b></td>":
                               "<td class=HeadingCell>":
                               "<b>Message Line 2</b></td>":
                             "</tr>"
.
IMHED999  RETURN
.------------------------------------------------------------
. Innvoice Message  (TABLE ROW) (patmesgf)
.------------------------------------------------------------
IMROWA00  MATCH     PMLINE2,SP70 
          GOTO      IMROWA10 IF NOT EQUAL 
          MOVE      NBSP,PMLINE2
.
IMROWA10  WRITE     HTMLFILE;"<tr><td nowrap><A HREF='javascript:ShowDetail14":
                             "(#"",LINKPRG,"#.pbl":
                             "?reportno=",LINKREP:
                             "&template=",LINKTEM:
                             "&invmsgcd=",PMCODE,"#")'>":
                             "<img src=../images/MaintenanceIcon.gif hspace=4":
                             " border=0 align=absmiddle></a>":
                             PMCODE,"</td>":
                             "<td>",PMLINE1,"</td>":
                             "<td>",PMLINE2,"</td>":
                             "</tr>"
.
IMROWA80  MATCH     PMLINE2,NBSP 
          GOTO      IMROWA99 IF NOT EQUAL 
          MOVE      SP70,PMLINE2
.
IMROWA99 RETURN
.------------------------------------------------------------
. Invoice Message Per Claim Code Table (patinmaf)
.------------------------------------------------------------
ICMTB000  UNPACK    DIM127,D1,LINKPRG,DIM127
          UNPACK    DIM127,D1,LINKREP,DIM127
          UNPACK    DIM127,D1,LINKTEM,DIM127
.
          CALL      ICMHD000              * Output Table Heading
.
          IF        NORECORD=0
            MOVE      PTCNNRTD,NORECORD     * Set Default No Records to Display
          ENDIF
          MOVE      ZERO,RECNUMB
          MOVE      ZERO,DISNUMB
.
          PACK      KEY4,INCMSGSY,SP70
          CALL      RSPTINM1
ICMTB100  CALL      RKPTINM1
          BRANCH    OVRCD,ICMTB900
.
          ADD       ONE,RECNUMB
          IF        STARTNUM>=RECNUMB
            GOTO      ICMTB100
          ENDIF
.
          COMPARE   ZERO,INCMSGSY                * Is system filter used? 
          IF        !@EQUAL
            COMPARE   INCMSGSY,PTIMSYS           * Same system code as filter? 
            GOTO      ICMTB900 IF NOT EQUAL      * No, exit
          ENDIF
.
          CALL      ICMRWA00                * Invoice Message Row
          ADD       ONE,DISNUMB
          COMPARE   NORECORD,DISNUMB
          GOTO      ICMTB100 IF NOT EQUAL
          GOTO      ICMTB999
.
ICMTB900  CALL      NOMORE00      * Display No More Records Message
.
ICMTB999  RETURN
.------------------------------------------------------------
. Invoice Messages Per Claim Code Maintenance  (TABLE HEADING) (patinmaf)
.------------------------------------------------------------
ICMHD000  WRITE     HTMLFILE;"<tr>":
                               "<td class=HeadingCell width=16%>":
                               "<b>System</b></td>":
                               "<td class=HeadingCell width=20%>":
                               "<b>Claim Code</b></td>":
                               "<td class=HeadingCell width=32%>":
                               "<b>Message Line 1</b></td>":
                               "<td class=HeadingCell width=32%>":
                               "<b>Message Line 2</b></td>":
                             "</tr>"
.
ICMHD999  RETURN
.------------------------------------------------------------
. Invoice Messages Per Claim Code Maintenance (TABLE ROW) (patinmaf)
.------------------------------------------------------------
ICMRWA00  MOVE      SP70,SYSDESC            * Populate system description
          IF        PTIMSYS=ONE
            MOVE      "Accident & Emergency",SYSDESC
            GOTO      ICMRWA10
          ENDIF
.
          IF        PTIMSYS=TWO
            MOVE      "Outpatients         ",SYSDESC
            GOTO      ICMRWA10
          ENDIF
.
          IF        PTIMSYS=THREE
            MOVE      "Inpatients          ",SYSDESC
            GOTO      ICMRWA10
          ENDIF
.
          IF        PTIMSYS=FOUR 
            MOVE      "Other Financial     ",SYSDESC
            GOTO      ICMRWA10
          ENDIF
.
          MOVE      "Invalid System      ",SYSDESC
          GOTO      ICMRWA10
.
ICMRWA10  MOVE      SP10,KEY5
          PACK      KEY5,ANSC,ANSL,PTIMCLM
          CALL      RDCODE1                 * Get description for claim code
          MATCH     SP70,TDESC
          IF        @EQUAL
            MOVE      "&nbsp;",TDESC
          ENDIF   
.
          MATCH     SP70,PTIMMES1            * Message line 1
          IF        @EQUAL
            MOVE      "&nbsp;",PTIMMES1
          ENDIF
.
          MATCH     SP70,PTIMMES2            * Message line 2
          IF        @EQUAL
            MOVE      "&nbsp;",PTIMMES2
          ENDIF
.
          WRITE     HTMLFILE;"<tr><td nowrap><A HREF='javascript:ShowDetail33":
                             "(#"",LINKPRG,"#.pbl":
                             "?reportno=",LINKREP:
                             "&template=",LINKTEM:
                             "&incmsgsy=",PTIMSYS:
                             "&incmsgcd=",PTIMCLM,"#")'>":
                             "<img src=../images/MaintenanceIcon.gif hspace=4":
                             " border=0 align=absmiddle></a>":
                             SYSDESC,"</td>":
                             "<td>",TDESC,"</td>":
                             "<td>",PTIMMES1,"</td>":
                             "<td>",PTIMMES2,"</td>":
                             "</tr>"
.
ICMRWA99 RETURN
.------------------------------------------------------------
. Delete Patient Indicator Update
.------------------------------------------------------------
DELPAT00  CALL      XMLHED00
          BRANCH    EXIT,DELPAT99
.
DELPAT10  PACK      KEY4,PMSLS001,SP70
          CALL      RDPMLET1
          BRANCH    OVRCD,DELPAT90
.
          PACK      KEY12,PMSLS001,PMSLS002,SP70
          CALL      RDPMLST1
          BRANCH    OVRCD,DELPAT90
.
          MOVE      PMSLS003,PMLSDLST
          CALL      UPPMLST1
.
          WRITE     HTMLFILE;"<RETURN_VALUE TYPE=SIMPLE>":
                             "Update Complete":
                             "</RETURN_VALUE>"
          GOTO      DELPAT95
.
DELPAT90  WRITE     HTMLFILE;"<RETURN_VALUE TYPE=ERROR>":
                             "Invalid Patient":
                             "</RETURN_VALUE>"
.
DELPAT95  CALL      XMLEND00
.
DELPAT99  RETURN
.------------------------------------------------------------
. Delete Financial Letter Indicator Update
.------------------------------------------------------------
DELFAL00  CALL      XMLHED00
          BRANCH    EXIT,DELFAL99
.
DELFAL10  PACK      KEY4,PMLLS001,SP70
          CALL      RDPMLTF1
          BRANCH    OVRCD,DELFAL90
.
          PACK      KEY12,PMLLS001,PMLLS002,SP70
          CALL      RDPMLLF1
          BRANCH    OVRCD,DELFAL90
.
          MOVE      PMLLS003,PMLLSTAT
          CALL      UPPMLLF1
.
          WRITE     HTMLFILE;"<RETURN_VALUE TYPE=SIMPLE>":
                             "Update Complete":
                             "</RETURN_VALUE>"
          GOTO      DELFAL95
.
DELFAL90  WRITE     HTMLFILE;"<RETURN_VALUE TYPE=ERROR>":
                             "Invalid Patient":
                             "</RETURN_VALUE>"
.
DELFAL95  CALL      XMLEND00
.
DELFAL99  RETURN
.
.------------------------------------------------------------
. Delete Private Practice Financial Letter Indicator Update
.------------------------------------------------------------
DELFLI00  CALL      XMLHED00
          BRANCH    EXIT,DELFLI99
.
DELFLI10  PACK      KEY4,PRIFL001,SP70
          CALL      RDPRFLS1
          BRANCH    OVRCD,DELFLI90
.
          PACK      KEY22,PRIFL001,PRIFL002,PRIFL004,PRIFL005,SP70
          CALL      RDPRFSL1
          BRANCH    OVRCD,DELFLI90
.
          MOVE      PRIFL003,PRFSSTAT
          CALL      UPPRFSL1
.
          WRITE     HTMLFILE;"<RETURN_VALUE TYPE=SIMPLE>":
                             "Update Complete":
                             "</RETURN_VALUE>"
          GOTO      DELFLI95
.
DELFLI90  WRITE     HTMLFILE;"<RETURN_VALUE TYPE=ERROR>":
                             "Invalid Financial Selection":
                             "</RETURN_VALUE>"
.
DELFLI95  CALL      XMLEND00
.
DELFLI99  RETURN
.
.------------------------------------------------------------
. Delete Private Practice General Letter Indicator Update
.------------------------------------------------------------
DELGSL00  CALL      XMLHED00
          BRANCH    EXIT,DELGSL99
.
DELGSL10  PACK      KEY4,PRIGL001,SP70
          CALL      RDPRGLS1
          BRANCH    OVRCD,DELGSL90
.
          PACK      KEY22,PRIGL001,PRIGL002,PRIGL004,PRIGL005,SP70
          CALL      RDPRGSL1
          BRANCH    OVRCD,DELGSL90
.
          MOVE      PRIGL003,PRGSSTAT
          CALL      UPPRGSL1
.
          WRITE     HTMLFILE;"<RETURN_VALUE TYPE=SIMPLE>":
                             "Update Complete":
                             "</RETURN_VALUE>"
          GOTO      DELGSL95
.
DELGSL90  WRITE     HTMLFILE;"<RETURN_VALUE TYPE=ERROR>":
                             "Invalid General Letter Selection":
                             "</RETURN_VALUE>"
.
DELGSL95  CALL      XMLEND00
.
DELGSL99  RETURN
.
.------------------------------------------------------------
. Delete Outpatients Adhoc Letter Indicator Update
.------------------------------------------------------------
DELADH00  CALL      XMLHED00
          BRANCH    EXIT,DELADH99
.
DELADH10  PACK      KEY4,OTAL0001,SP70
          CALL      RDOTADL1
          BRANCH    OVRCD,DELADH90
.
          PACK      KEY25,OTALSEID,SP70
          CALL      RSOTLAD1
DELADH20  CALL      RKOTLAD1
          BRANCH    OVRCD,DELADH90
.
          MATCH     OTLASEID,OTLASEID
          GOTO      DELADH90 IF NOT EQUAL
.
          MATCH     OTLAOUTN,OTLA0001
          GOTO      DELADH20 IF NOT EQUAL
.
          MOVE      OTLA0002,OTLADLST
          CALL      UPOTLAD1
.
          WRITE     HTMLFILE;"<RETURN_VALUE TYPE=SIMPLE>":
                             "Update Complete":
                             "</RETURN_VALUE>"
          GOTO      DELADH95
.
DELADH90  WRITE     HTMLFILE;"<RETURN_VALUE TYPE=ERROR>":
                             "Invalid Outpatient Adhoc Letter Selection":
                             "</RETURN_VALUE>"
.
DELADH95  CALL      XMLEND00
.
DELADH99  RETURN
.
.------------------------------------------------------------
. Delete Private Practice Reminder Letter Indicator Update
.------------------------------------------------------------
DELREL00  CALL      XMLHED00
          BRANCH    EXIT,DELREL99
.
DELREL10  PACK      KEY4,PRIRL001,SP70
          CALL      RDPRREM1
          BRANCH    OVRCD,DELREL90
.
          PACK      KEY50,PRIRL001,PRIRL002,SP70
          CALL      RDPRREL1
          BRANCH    OVRCD,DELREL90
.
          MOVE      PRIRL003,PRRLSTAT
          CALL      UPPRREL1
.
          WRITE     HTMLFILE;"<RETURN_VALUE TYPE=SIMPLE>":
                             "Update Complete":
                             "</RETURN_VALUE>"
          GOTO      DELREL95
.
DELREL90  WRITE     HTMLFILE;"<RETURN_VALUE TYPE=ERROR>":
                             "Invalid Reminder Letter Selection":
                             "</RETURN_VALUE>"
.
DELREL95  CALL      XMLEND00
.
DELREL99  RETURN
.
.------------------------------------------------------------
. Outpatient Adhoc Letter List
.------------------------------------------------------------
OUTADL00  BRANCH    FLDITMNO,OUTADL10,OUTADL20,OUTADL30,OUTADL40:
                    OUTADL50
.
          WRITE     HTMLFILE;"Invalid Tag";
          GOTO      OUTADL99
.
OUTADL10  CALL      DISTAD00 
          GOTO      OUTADL99
.
OUTADL20  CALL      NEXTAD00                * next set of General Letter  
          GOTO      OUTADL99
.
OUTADL30  CALL      PREVAD00                * previous set of General Letter
          GOTO      OUTADL99
.
OUTADL40  WRITE     HTMLFILE;RECTOTAL;
          GOTO      OUTADL99
.
OUTADL50  CALL      SELOLT00                * Letter type 
          GOTO      OUTADL99
.
OUTADL99  RETURN
.------------------------------------------------------------
. Selected Outpatient Adhoc  Letter List
.------------------------------------------------------------
DISTAD00  UNPACK    DIM127,D1,LINKPRG,DIM127
          UNPACK    DIM127,D1,LINKREP,DIM127
          UNPACK    DIM127,D1,LINKTEM,DIM127
.
          CALL      DIADHD00              * Adhoc Letter List Table Heading
.
          IF        NORECORD=0
            MOVE      PTCNNRTD,NORECORD     * Set Default No Records to Display
          ENDIF
          MOVE      ZERO,RECTOTAL
          MOVE      ZERO,RECNUMB 
          MOVE      ZERO,DISNUMB
.
          MOVE      OTAL0001,KEY4
          CALL      RDOTADL1
          BRANCH    OVRCD,DISTAD90
.
          PACK      KEY25,OTAL0001,SP70
          CALL      RSOTLAD1
DISTAD10  CALL      RKOTLAD1
          BRANCH    OVRCD,DISTAD99
.
          MATCH     OTAL0001,OTLASEID
          GOTO      DISTAD99 IF NOT EQUAL
.
          ADD       ONE,RECNUMB 
          IF        STARTNUM>=RECNUMB 
            GOTO      DISTAD10
          ENDIF
.
          CALL      ADHROW00
.
          ADD       ONE,DISNUMB
          COMPARE   NORECORD,DISNUMB
          GOTO      DISTAD10 IF NOT EQUAL
          GOTO      DISTAD99
.
DISTAD90  MOVE      "Invalid Selection ID",WEBTITLE
          CALL      WEBERR00
          MOVE      ONE,EXIT
.
DISTAD99  RETURN
.------------------------------------------------------------
.  Table Selected Adhoc Letter (TABLE HEADING)
.------------------------------------------------------------
DIADHD00  WRITE     HTMLFILE;"<tr>":
                            "<td class=HeadingCell width=12%>U/R Number</td>":
                   "<td class=HeadingCell width=30%>Patient</td>":
                   "<td class=HeadingCell width=30%>Clinic</td>":
                   "<td class=HeadingCell width=20%>Booking Date & Time</td>":
                   "<td class=HeadingCell width=8%>Delete</td>":
                             "</tr>";
DIADHD999  RETURN
.
. I-90215 
.--------------------------------------------------------------------------
. Read Selected Outpatient Adhoc Letter details and write the 
. Selected Outpatient Adhoc letter row to HTMLFILE
.--------------------------------------------------------------------------
ADHROW00  PACK      KEY8,OTLAOUTN,SP70
          CALL      RDOTCAN1
          BRANCH    OVRCD,ADHROW08
.
          MOVE      OTLAOUTN,OBAOUTNO
          MOVE      OTLAURNO,OBAURNO
          GOTO      ADHROW20
.
ADHROW08  PACK      KEY36,OTLAOUTN,OTLADATE,OTLASTRT,OTLASLOT,SP20
          CALL      RDSBOKA6
ADHROW10  CALL      RDKBOKA6
          BRANCH    OVRCD,ADHROW99
.
          MATCH     DOBAOUTN,OTLAOUTN
          GOTO      ADHROW99 IF NOT EQUAL
.
          MATCH     OBADATE,OTLADATE
          GOTO      ADHROW99 IF NOT EQUAL
.
          MATCH     OBASTRT,OTLASTRT
          GOTO      ADHROW99 IF NOT EQUAL
.
          MOVE      OBASLOT,DIM3
          MATCH     DIM3,OTLASLOT
          GOTO      ADHROW99 IF NOT EQUAL
.
..          PACK      KEY6,OBASITE,SP10
..          CALL      RDSITA1
..          IF        OVRCD = 0
..            MATCH     OSTDESC,OTLASITE
..            GOTO      ADHROW10 IF NOT EQUAL
..          ENDIF
.
..          MATCH     OBACLIN,OTLACLID
..          GOTO      ADHROW10 IF NOT EQUAL
.
ADHROW20  PACK      KEY8,OBAURNO,SP10
          CALL      RDMAST1
          IF        OVRCD = 1
            MOVE      "Invalid U/R",FORMATNM
          ELSE
            IF        PCEASE = 1
              MOVE      PDECDTE,AGEDATE            * Date of Death
            ELSE
              PACK      AGEDATE,CURRDATE,SP10      * Today's date
            ENDIF
            REP       " 0",AGEDATE
            CALL      CALCAGE
            CALL      PATLN000
          ENDIF
.
          PACK      ADHCCLIN,OTLACLID,SP70
.
          UNPACK    OTLADATE,CCENT,CYEAR,CMON,CDAY
          MOVE      CMON,F2
          LOAD      MTHNAM3,F2,JAN,FEB,MAR,APR,MAY,JUN,JUL,AUG,SEP,OCT,NOV,DEC
          PACK      ADHCBOOK,CDAY,SP1,MTHNAM3,SP1,CCENT,CYEAR,SP2,OTLASTIM,SP20
          MATCH     SP20,ADHCBOOK
          IF        @EQUAL
            MOVE     "&nbsp;",ADHCBOOK
          ENDIF
.
          MOVE      OBAURNO,URNUMBER
          REP       " +",URNUMBER
.
          MOVE      OBAOUTNO,OTLA0001
          MOVE      OBAOUTNO,ADMISSNO
          REP       " +",ADMISSNO
.
          WRITE     HTMLFILE;"<tr><td nowrap><A HREF=",LINKPRG,".pbl?":
                              "&reportno=",LINKREP:
                              "&template=",LINKTEM:
                              "&urnumber=",URNUMBER:
                              "&admissno=",ADMISSNO,">":
                             "<img src=../images/PatientFolder000.gif":
                             " class=Icon border=0 align=absmiddle></a>":
                              OBAURNO,"</td>":
                              "<td>",OTLA0001," - ",FORMATNM,"</td>":
                              "<td>",ADHCCLIN,"</td><td nowrap>":
                              ADHCBOOK,"</td>";
.
          MOVE      OTLADLST,OTLA0002
          MATCH     "1",OTLADLST
          IF        @EQUAL
            WRITE     HTMLFILE;"<td><input type=checkbox name=otla0002":
                               " value=1 onclick=#"DeletePatient19(this":
                               ",'",OTAL0001,"','",OTLA0001,"'":
                               ");#" checked></td>";
          ELSE
            WRITE     HTMLFILE;"<td><input type=checkbox name=otla0002":
                               " value=0 onclick=#"DeletePatient19(this":
                               ",'",OTAL0001,"','",OTLA0001,"'":
                               ");#"></td>";
          ENDIF
.
          WRITE     HTMLFILE;"</tr>";
.
ADHROW99  RETURN
.-----------------------------------------------------------
. Link to Next Group of patients
.-----------------------------------------------------------
NEXTAD00  MOVE      NORECORD,KEY2
          REP       " +",KEY2
          ASSIGN    STARTNUM+NORECORD,F3
          MOVE      F3,KEY3
          REP       " +",KEY3
          UNPACK    DIM127,D1,FLDPARA,DIM127
          MOVE      REPORTNO,F2
          REP       " +",OTAL0001
.
          WRITE     HTMLFILE;"patweb87.pbl":
                                 "?reportno=",F2:
                                 "&template=",FLDPARA:
                                 "&startnum=",KEY3:
                                 "&norecord=",KEY2:
                                 "&otal0001=",OTAL0001;
.
          REP       "+ ",OTAL0001
.
NEXTAD99  RETURN
.-------------------------------------------------------------
. Link to Prev Group of patients
.-------------------------------------------------------------
PREVAD00  MOVE      NORECORD,KEY2
          REP       " +",KEY2
          ASSIGN    STARTNUM-NORECORD,F3
          IF        F3<0
            MOVE      ZERO,F3
          ENDIF
          MOVE      F3,KEY3
          REP       " +",KEY3
          UNPACK    DIM127,D1,FLDPARA,DIM127
          MOVE      REPORTNO,F2
          REP       " +",OTAL0001
.
          WRITE     HTMLFILE;"patweb87.pbl":
                                 "?reportno=",F2:
                                 "&template=",FLDPARA:
                                 "&startnum=",KEY3:
                                 "&norecord=",KEY2:
                                 "&otal0001=",OTAL0001;
.
          REP       "+ ",OTAL0001
.
PREVAD99  RETURN
.------------------------------------------------------------
. Outpatient Charge Code Maintenance
.------------------------------------------------------------
PATNIP00  RESET     UPDTTYPE
          MATCH     SP1,UPDTTYPE
          GOTO      PATNIP40 IF EQUAL
.
          MATCH     "A",UPDTTYPE    * Add formaction
          GOTO      PATNIP10 IF EQUAL
.
          MATCH     "U",UPDTTYPE    * Update formaction
          GOTO      PATNIP20 IF EQUAL
.
          MATCH     "D",UPDTTYPE    * Delete formaction
          GOTO      PATNIP30 IF EQUAL
.
          GOTO      PATNIP93
.
.         ************ ADD FORMACTION ***********
.
PATNIP10  MOVE      TWO,PTNIP001  * system code has to be 2 for Outpatient
          CALL      CHKNIP00      * Checks mandatory fields
          BRANCH    EXIT,PATNIP99
          PACK      KEY13,PTNIP001,PTNIP002,PTNIP003,PTNIP004,PTNIP005,SP70
          CALL      RDNIPB1
          COMPARE   ONE,OVRCD
          GOTO      PATNIP92 IF NOT EQUAL
.
          CALL      NIPSAV00      * Moves input variables to file variables
          MOVE      TWO,PTNIP001  * system code has to be 2 for Outpatient
          PACK      KEY13,PTNIP001,PTNIP002,PTNIP003,PTNIP004,PTNIP005,SP70
          CALL      WRNIPB1       * Writes away the data
.
          MOVE      ZERO,EXIT
          GOTO      PATNIP99
.
.         ************ UPDATE FORMACTION **********
.
PATNIP20  MOVE      TWO,PTNIP001  * system code has to be 2 for Outpatient
          PACK      KEY13,PTNIP001,PTNIP002,PTNIP003,PTNIP004,PTNIP005,SP70
          CALL      RDNIPB1
          BRANCH    OVRCD,PATNIP91
          CALL      CHKNIP00      * Checks mandatory fields
          BRANCH    EXIT,PATNIP99
.
          CALL      RDSNIPB1
          CALL      NIPSAV00      * Moves input variables to file variables
          MOVE      TWO,PTNIP001  * system code has to be 2 for Outpatient
          PACK      KEY13,PTNIP001,PTNIP002,PTNIP003,PTNIP004,PTNIP005,SP70
          CALL      UPNIPB1       * Writes away the data
.
          MOVE      ZERO,EXIT
          GOTO      PATNIP99
.
.         ************ DELETE FORMACTION **********
.
PATNIP30  MOVE      TWO,PTNIP001  * system code has to be 2 for Outpatient
          PACK      KEY13,PTNIP001,PTNIP002,PTNIP003,PTNIP004,PTNIP005,SP70
          CALL      RDNIPB1
          BRANCH    OVRCD,PATNIP91
          CALL      DENIPB1
.
          MOVE      ZERO,EXIT
          GOTO      PATNIP99
.
.         ************ DISPLAY FORMACTION **********
.
PATNIP40  MOVE      TWO,PTNIP001  * system code has to be 2 for Outpatient
          PACK      KEY13,PTNIP001,PTNIP002,PTNIP003,PTNIP004,PTNIP005,SP70
          CALL      RDNIPB1
          IF        OVRCD=1
            CALL      CLRNIP00    * Clear all the file variables
          ENDIF
.
          CLEAR     WEBTITLE
          MOVE      "Outpatients Charge",WEBTITLE
          RESET     WEBTITLE
.
          CALL      WEBHED00   * Create Output File and Write HTML Page Header
          BRANCH    EXIT,PATNIP99
          CALL      WEBBOD00   * Process Web Body
          CALL      WEBEND00   * Process End of HTML File
          MOVE      ONE,EXIT
          GOTO      PATNIP99
.
PATNIP91  MOVE      "Outpatient Attendance Charge does not exist",WEBTITLE
          CALL      WEBERR00
          MOVE      ONE,EXIT
          GOTO      PATNIP99
.
PATNIP92  MOVE      "Outpatient Attendance Charge exists",WEBTITLE
          CALL      WEBERR00
          MOVE      ONE,EXIT
          GOTO      PATNIP99
.
PATNIP93  MOVE      "Invalid Form Action.",WEBTITLE
          CALL      WEBERR00
          MOVE      ONE,EXIT
          GOTO      PATNIP99
.
PATNIP99  RETURN
.-----------------------------------------------------------
. Initialize's file data (Outpatient Charge Code Maintenace)
.-----------------------------------------------------------
CLRNIP00  MOVE      SP70,DNBSYST
          MOVE      SP70,NBINDC
          MOVE      SP70,NBRESD
          MOVE      SP70,NBCOMP
          MOVE      SP70,NBINDV
          MOVE      SP70,NBDESC
          MOVE      SP70,NBITEM
          MOVE      ZERO,NBAMT
          MOVE      SP70,NBSPARX
.
CLRNIP99  RETURN
.-----------------------------------------------------------------------------
. Moves cgi variables into file variables (Outpatient Charge Code Maintenance)
.-----------------------------------------------------------------------------
NIPSAV00  MOVE      PTNIP001,DNBSYST
          MOVE      PTNIP002,NBINDC
          MOVE      PTNIP003,NBRESD
          MOVE      PTNIP004,NBCOMP
          MOVE      PTNIP005,NBINDV
          MOVE      PTNIP006,NBDESC
          MOVE      PTNIP007,NBITEM
          MOVE      PTNIP008,NBAMT
          MOVE      NBAMT,NBAMNT
          MOVE      SP70,NBSPARX
.
NIPSAV99  RETURN
.------------------------------------------------------------
. Checks mandatory fields (Outpatient Charges Maintenance)
.------------------------------------------------------------
CHKNIP00  MATCH    "2",PTNIP001
          IF       @EQUAL
            RESET     PTNIP002
            MATCH     SP70,PTNIP002
            GOTO      CHKNIP50 IF EQUAL
          ENDIF
.
CHKNIP10  RESET     PTNIP003
          MATCH     SP70,PTNIP003
          GOTO      CHKNIP60 IF EQUAL
.
CHKNIP20  RESET     PTNIP004
          MATCH     SP70,PTNIP004
          GOTO      CHKNIP70 IF EQUAL
.
CHKNIP30  MATCH    "2",PTNIP001
          IF       @EQUAL
            RESET     PTNIP005
            MATCH     SP70,PTNIP005
            GOTO      CHKNIP80 IF EQUAL
          ENDIF
.
          GOTO      CHKNIP90
.
CHKNIP50  MOVE      "Clinic Indicator is mandatory",WEBTITLE
          CALL      WEBERR00
          MOVE      ONE,EXIT
          GOTO      CHKNIP99
.
CHKNIP60  MOVE      "Resident Status is mandatory",WEBTITLE
          CALL      WEBERR00
          MOVE      ONE,EXIT
          GOTO      CHKNIP99
.
CHKNIP70  MOVE      "Compensation Code is mandatory",WEBTITLE
          CALL      WEBERR00
          MOVE      ONE,EXIT
          GOTO      CHKNIP99
.
CHKNIP80  MOVE      "Visit Type is mandatory",WEBTITLE
          CALL      WEBERR00
          MOVE      ONE,EXIT
          GOTO      CHKNIP99
.
CHKNIP90  MOVE      ZERO,EXIT
CHKNIP99  RETURN
.------------------------------------------------------------
. Outpatient Charges Maintenance
.------------------------------------------------------------
PNIP0000  BRANCH    FLDITMNO,PNIP0100,PNIP0200,PNIP0300,PNIP0400,PNIP0500:
                             PNIP0600,PNIP0700,PNIP0800,PNIP0900,PNIP1000:
                             PNIP1100,PNIP1200,PNIP1300,PNIP1400,PNIP1500:
                             PNIP1600,PNIP1700,PNIP1800,PNIP1900
          GOTO      PNIP9999
.
PNIP0100  WRITE     HTMLFILE;DNBSYST;
          GOTO      PNIP9999
.
PNIP0200  MOVE      "CI",CATEGORY
          MOVE      NBINDC,CODE
          CALL      CODITM00
          GOTO      PNIP9999
.
PNIP0300  MOVE      "T ",CATEGORY
          MOVE      NBRESD,CODE
          CALL      CODITM00
          GOTO      PNIP9999
.
PNIP0400  MOVE      "CL",CATEGORY
          MOVE      NBCOMP,CODE
          CALL      CODITM00
          GOTO      PNIP9999
.
PNIP0500  MOVE      "CV",CATEGORY
          MOVE      NBINDV,CODE
          CALL      CODITM00
          GOTO      PNIP9999
.
PNIP0600  WRITE     HTMLFILE;NBDESC;
          GOTO      PNIP9999
.
PNIP0700  MOVE      "FI",CATEGORY
          MOVE      NBITEM,CODE
          CALL      CODITM00
          GOTO      PNIP9999
.
PNIP0800  WRITE     HTMLFILE;NBAMT;
          GOTO      PNIP9999
.
PNIP0900  CALL      PTTAB000      * Table of Outpatient Charges Codes
          GOTO      PNIP9999
.
PNIP1000  CALL      NEXTOC00      * Link to Next Group for Outpatient
          GOTO      PNIP9999
.
PNIP1100  CALL      PREVOC00      * Link to Last Group for Outpatient
          GOTO      PNIP9999
.
PNIP1200  MOVE      "CI",CATEGORY
          MOVE      FLTCLNIC,CODE
          CALL      CODITM00
          GOTO      PNIP9999
.
PNIP1300  MOVE      "ED",CATEGORY
          MOVE      NBINDV,CODE
          CALL      CODITM00
          GOTO      PNIP9999
.
PNIP1400  WRITE     HTMLFILE;AECNCHRS;
          GOTO      PNIP9999
.
PNIP1500  CALL      EMRTAB00      * Table of Emergency Charges Codes
          GOTO      PNIP9999
.
PNIP1600  CALL      NEXTER00      * Link to Next Group for emergency
          GOTO      PNIP9999
.
PNIP1700  CALL      PREVER00      * Link to Last Group for emergency
          GOTO      PNIP9999
.
PNIP1800  MOVE      "T ",CATEGORY
          MOVE      FLTRESID,CODE
          CALL      CODITM00
          GOTO      PNIP9999
.
PNIP1900  MOVE      "CL",CATEGORY
          MOVE      FLTCOMPE,CODE
          CALL      CODITM00
          GOTO      PNIP9999
.
PNIP9999  RETURN
.------------------------------------------------------------
. Outpatient Charges Maintenance
.------------------------------------------------------------
PTTAB000  UNPACK    DIM127,D1,LINKPRG,DIM127
          UNPACK    DIM127,D1,LINKREP,DIM127
          UNPACK    DIM127,D1,LINKTEM,DIM127
.
          CALL      PTHED000      * Output Table Heading
.
          IF        NORECORD=0
            MOVE      PTCNNRTD,NORECORD     * Set Default No Records to Display
          ENDIF
          MOVE      ZERO,RECNUMB
          MOVE      ZERO,DISNUMB
.
          MOVE      TWO,PTNIP001  * system code has to be 2 for Outpatient
          PACK      KEY13,PTNIP001,PTNIP002,PTNIP003,PTNIP004,PTNIP005,SP70
          CALL      RDSNIPB1
PTTAB100  CALL      RDKNIPB1
          BRANCH    OVRCD,PTTAB900
.
          COMPARE   TWO,NBSYST              * Ouptatient system code?
          GOTO      PTTAB900 IF NOT EQUAL   * No, exit
.
          MATCH     SP70,FLTCLNIC           * Clinic Id filter use?
          IF        !@EQUAL
            MATCH     FLTCLNIC,NBINDC       * Same clinic id?
            GOTO      PTTAB100 IF NOT EQUAL * No, read next record
          ENDIF
.
          MATCH     SP70,FLTRESID           * Resident Status Filter use?
          IF        !@EQUAL
            MATCH     FLTRESID,NBRESD       * Same resident status?
            GOTO      PTTAB100 IF NOT EQUAL * No, read next record
          ENDIF
.
          MATCH     SP70,FLTCOMPE           * Compensation Type Filter use?
          IF        !@EQUAL
            MATCH     FLTCOMPE,NBCOMP       * Same compensation type?
            GOTO      PTTAB100 IF NOT EQUAL * No, read next record
          ENDIF
.
          ADD       ONE,RECNUMB
          IF        STARTNUM>=RECNUMB
            GOTO      PTTAB100
          ENDIF
.
          CALL      PTROWA00                * Table Row
          ADD       ONE,DISNUMB
          COMPARE   NORECORD,DISNUMB
          GOTO      PTTAB100 IF NOT EQUAL
          GOTO      PTTAB999
.
PTTAB900  CALL      NOMORE00       * Display No More Records Message
.
PTTAB999  RETURN
.------------------------------------------------------------
. Outpatient Charges Maintenance (TABLE HEADING)
.------------------------------------------------------------
PTHED000  WRITE     HTMLFILE;"<tr>":
                               "<td class=HeadingCell width=15%>":
                               "<b>Clinic Indicator </b></td>":
                               "<td class=HeadingCell width=15%>":
                               "<b>Resident Status</b></td>":
                               "<td class=HeadingCell width=15%>":
                               "<b>Compensation Code</b></td>":
                               "<td class=HeadingCell width=15%>":
                               "<b>Visit Type</b></td>":
                               "<td class=HeadingCell width=15%>":
                               "<b>Item Group</b></td>":
                               "<td class=HeadingCell width=15%>":
                               "<b>Description</b></td>":
                               "<td class=HeadingCell width=10% align=right>":
                               "<b>Charge</b></td>":
                             "</tr>"
.
PTHED999  RETURN
.------------------------------------------------------------
. Outpatient Charges Maintenance (TABLE ROW)
.------------------------------------------------------------
PTROWA00  MOVE      SP70,CATDESC1
          MOVE      SP70,CATDESC2
          MOVE      SP70,CATDESC3
          MOVE      SP70,CATDESC4
          MOVE      SP70,CATDESC5
          MOVE      SP70,CATDESC6
.
          MATCH     SP70,NBINDC
          IF        @EQUAL
             MOVE      "&nbsp;",CATDESC1   * for Clinic Indicator
          ELSE
             MOVE      "CI",CATEGORY
             MOVE      NBINDC,CODE
             CALL      GETCOD00
             MOVE      TDESC,CATDESC1
          ENDIF
.
          MATCH     SP70,NBRESD
          IF        @EQUAL
             MOVE      "&nbsp;",CATDESC2   * for Resident Status
          ELSE
             MOVE      "T ",CATEGORY
             MOVE      NBRESD,CODE
             CALL      GETCOD00
             MOVE      TDESC,CATDESC2
          ENDIF
.
          MATCH     SP70,NBCOMP
          IF        @EQUAL
             MOVE      "&nbsp;",CATDESC3   * for Compensation Code
          ELSE
             MOVE      "CL",CATEGORY
             MOVE      NBCOMP,CODE
             CALL      GETCOD00
             MOVE      TDESC,CATDESC3
          ENDIF
.
          MATCH     SP70,NBINDV
          IF        @EQUAL
             MOVE      "&nbsp;",CATDESC4   * for Visit Type
          ELSE
             MOVE      "CV",CATEGORY
             MOVE      NBINDV,CODE
             CALL      GETCOD00
             MOVE      TDESC,CATDESC4
          ENDIF
.
          MATCH     SP70,NBITEM
          IF        @EQUAL
             MOVE      "&nbsp;",CATDESC5   * for Item Group
          ELSE
             MOVE      "FI",CATEGORY
             MOVE      NBITEM,CODE
             CALL      GETCOD00
             MOVE      TDESC,CATDESC5
          ENDIF
.
          MATCH     SP70,NBDESC
          IF        @EQUAL
            MOVE      "&nbsp;",CATDESC6     * for charge description
          ELSE
            MOVE      NBDESC,CATDESC6
          ENDIF
.
          WRITE     HTMLFILE;"<tr><td nowrap><A HREF='javascript:SD30":
                             "(#"",LINKPRG,"#.pbl":
                             "?reportno=",LINKREP:
                             "&template=",LINKTEM:
                             "&ptnip001=",DNBSYST:
                             "&ptnip002=",NBINDC:
                             "&ptnip003=",NBRESD:
                             "&ptnip004=",NBCOMP:
                             "&ptnip005=",NBINDV,"#")'>":
                             "<img src=../images/MaintenanceIcon.gif hspace=4":
                             " border=0 align=absmiddle></a>":
                             CATDESC1,"</td>":
                             "<td>",CATDESC2,"</td>":
                             "<td>",CATDESC3,"</td>":
                             "<td>",CATDESC4,"</td>":
                             "<td>",CATDESC5,"</td>":
                             "<td>",CATDESC6,"</td>":
                             "<td align=right>",NBAMT,"</td>":
                             "</tr>"
.
PTROWA99 RETURN
.------------------------------------------------------------
. Link to Next set of Outpatient Charges
.------------------------------------------------------------
NEXTOC00  MOVE      NORECORD,KEY2
          REP       " +",KEY2
          ASSIGN    STARTNUM+NORECORD,F3
          MOVE      F3,KEY3
          REP       " +",KEY3
          UNPACK    DIM127,D1,FLDPARA,DIM127
          MOVE      REPORTNO,F2
.
          REP       " +",FLTCLNIC
          REP       " +",FLTRESID
          REP       " +",FLTCOMPE
.
          WRITE     HTMLFILE;"patweb87.pbl":
                                 "?reportno=",F2:
                                 "&template=",FLDPARA:
                                 "&startnum=",KEY3:
                                 "&norecord=",KEY2:
                                 "&fltclnic=",FLTCLNIC:
                                 "&fltresid=",FLTRESID:
                                 "&fltcompe=",FLTCOMPE;
.
          REP       "+ ",FLTCLNIC
          REP       "+ ",FLTRESID
          REP       "+ ",FLTCOMPE
.
NEXTOC99  RETURN
.-------------------------------------------------------------------------------
. Link to previous set of Outpatient Charges
.-------------------------------------------------------------------------------
PREVOC00  MOVE      NORECORD,KEY2
          REP       " +",KEY2
          ASSIGN    STARTNUM-NORECORD,F3
          IF        F3<0
            MOVE    ZERO,F3
          ENDIF
          MOVE      F3,KEY3
          REP       " +",KEY3
          UNPACK    DIM127,D1,FLDPARA,DIM127
          MOVE      REPORTNO,F2
.
          REP       " +",FLTCLNIC
          REP       " +",FLTRESID
          REP       " +",FLTCOMPE
.
          WRITE     HTMLFILE;"patweb87.pbl":
                                 "?reportno=",F2:
                                 "&template=",FLDPARA:
                                 "&startnum=",KEY3:
                                 "&norecord=",KEY2:
                                 "&fltclnic=",FLTCLNIC:
                                 "&fltresid=",FLTRESID:
                                 "&fltcompe=",FLTCOMPE;
.
          REP       "+ ",FLTCLNIC
          REP       "+ ",FLTRESID
          REP       "+ ",FLTCOMPE
.
PREVOC99  RETURN
.------------------------------------------------------------
. Emergency Charge Code Maintenance
.------------------------------------------------------------
EMRNIP00  RESET     UPDTTYPE
          MATCH     SP1,UPDTTYPE
          GOTO      EMRNIP40 IF EQUAL
.
          MATCH     "A",UPDTTYPE    * Add formaction
          GOTO      EMRNIP10 IF EQUAL
.
          MATCH     "U",UPDTTYPE    * Update formaction
          GOTO      EMRNIP20 IF EQUAL
.
          MATCH     "D",UPDTTYPE    * Delete formaction
          GOTO      EMRNIP30 IF EQUAL
.
          GOTO      EMRNIP93
.
.
.         ************ ADD FORMACTION ***********
.
EMRNIP10  MOVE      ONE,PTNIP001  * system code has to be 1 for A&E
          MOVE      SP70,PTNIP002 * clinic indicator is blank in case of A&E
          CALL      CHKNIP00      * Checks mandatory fields
          BRANCH    EXIT,EMRNIP99
          PACK      KEY13,PTNIP001,PTNIP002,PTNIP003,PTNIP004,PTNIP005,SP70
          CALL      RDNIPB1
          COMPARE   ONE,OVRCD
          GOTO      EMRNIP92 IF NOT EQUAL
.
          CALL      NIPSAV00      * Moves input variables to file variables
          MOVE      ONE,PTNIP001  * system code has to be 1 for A&E
          MOVE      SP70,PTNIP002 * clinic indicator is blank in case of A&E
          PACK      KEY13,PTNIP001,PTNIP002,PTNIP003,PTNIP004,PTNIP005,SP70
          CALL      WRNIPB1       * Writes away the data
.
          MOVE      ZERO,EXIT
          GOTO      EMRNIP99
.
.         ************ UPDATE FORMACTION **********
.
EMRNIP20  MOVE      ONE,PTNIP001  * system code has to be 1 for A&E
          MOVE      SP70,PTNIP002 * clinic indicator is blank in case of A&E
          PACK      KEY13,PTNIP001,PTNIP002,PTNIP003,PTNIP004,PTNIP005,SP70
          CALL      RDNIPB1
          BRANCH    OVRCD,EMRNIP91
          CALL      CHKNIP00      * Checks mandatory fields
          BRANCH    EXIT,EMRNIP99
.
          CALL      RDSNIPB1
          CALL      NIPSAV00      * Moves input variables to file variables
          MOVE      ONE,PTNIP001  * system code has to be 1 for A&E
          MOVE      SP70,PTNIP002 * clinic indicator is blank in case of A&E
          PACK      KEY13,PTNIP001,PTNIP002,PTNIP003,PTNIP004,PTNIP005,SP70
          CALL      UPNIPB1       * Writes away the data
.
          MOVE      ZERO,EXIT
          GOTO      EMRNIP99
.
.         ************ DELETE FORMACTION **********
.
EMRNIP30  MOVE      ONE,PTNIP001  * system code has to be 1 for A&E
          MOVE      SP70,PTNIP002 * clinic indicator is blank in case of A&E
          PACK      KEY13,PTNIP001,PTNIP002,PTNIP003,PTNIP004,PTNIP005,SP70
          CALL      RDNIPB1
          BRANCH    OVRCD,EMRNIP91
          CALL      DENIPB1
.
          MOVE      ZERO,EXIT
          GOTO      EMRNIP99
.
.         ************ DISPLAY FORMACTION **********
.
EMRNIP40  MOVE      ONE,PTNIP001  * system code has to be 1 for A&E
          MOVE      SP70,PTNIP002 * clinic indicator is blank in case of A&E
          PACK      KEY13,PTNIP001,PTNIP002,PTNIP003,PTNIP004,PTNIP005,SP70
          CALL      RDNIPB1
          IF        OVRCD=1
            CALL      CLRNIP00    * Clear all the file variables
          ENDIF
.
          CLEAR     WEBTITLE
          MOVE      "Emergency Charge",WEBTITLE
          RESET     WEBTITLE
.
          CALL      WEBHED00   * Create Output File and Write HTML Page Header
          BRANCH    EXIT,EMRNIP99
          CALL      WEBBOD00   * Process Web Body
          CALL      WEBEND00   * Process End of HTML File
          MOVE      ONE,EXIT
          GOTO      EMRNIP99
.
EMRNIP91  MOVE      "Emergency Attendance Charge does not exist",WEBTITLE
          CALL      WEBERR00
          MOVE      ONE,EXIT
          GOTO      EMRNIP99
.
EMRNIP92  MOVE      "Emergency Attendance Charge exists",WEBTITLE
          CALL      WEBERR00
          MOVE      ONE,EXIT
          GOTO      EMRNIP99
.
EMRNIP93  MOVE      "Invalid Form Action.",WEBTITLE
          CALL      WEBERR00
          MOVE      ONE,EXIT
          GOTO      EMRNIP99
.
EMRNIP99  RETURN
.------------------------------------------------------------
. Emergency Charges Maintenance Table
.------------------------------------------------------------
EMRTAB00  UNPACK    DIM127,D1,LINKPRG,DIM127
          UNPACK    DIM127,D1,LINKREP,DIM127
          UNPACK    DIM127,D1,LINKTEM,DIM127
.
          CALL      EMRHED00      * Output Table Heading
.
          IF        NORECORD=0
            MOVE      PTCNNRTD,NORECORD     * Set Default No Records to Display
          ENDIF
          MOVE      ZERO,RECNUMB
          MOVE      ZERO,DISNUMB
.
          MOVE      ONE,PTNIP001  * system code has to be 1 for A&E
          MOVE      SP70,PTNIP002 * clinic indicator is blank in case of A&E
          PACK      KEY13,PTNIP001,PTNIP002,PTNIP003,PTNIP004,PTNIP005,SP70
.
          CALL      RDSNIPB1
EMRTAB10  CALL      RDKNIPB1
          BRANCH    OVRCD,EMRTAB90
.
          COMPARE   ONE,NBSYST              * AAE system code?
          GOTO      EMRTAB90 IF NOT EQUAL   * No, exit

          MATCH     SP70,NBINDC
          GOTO      EMRTAB10 IF NOT EQUAL
.
          MATCH     SP70,FLTRESID           * Resident Status Filter use?
          IF        !@EQUAL
            MATCH     FLTRESID,NBRESD       * Same resident status?
            GOTO      EMRTAB10 IF NOT EQUAL * No, read next record
          ENDIF
.
          MATCH     SP70,FLTCOMPE           * Compensation Type Filter use?
          IF        !@EQUAL
            MATCH     FLTCOMPE,NBCOMP       * Same compensation type?
            GOTO      EMRTAB10 IF NOT EQUAL * No, read next record
          ENDIF
.
          ADD       ONE,RECNUMB
          IF        STARTNUM>=RECNUMB
            GOTO      EMRTAB10
          ENDIF
.
          CALL      EMRROW00                * Table Row
          ADD       ONE,DISNUMB
          COMPARE   NORECORD,DISNUMB
          GOTO      EMRTAB10 IF NOT EQUAL
          GOTO      EMRTAB99
.
EMRTAB90  CALL      NOMORE00     * Display No More Records Message
.
EMRTAB99  RETURN
.------------------------------------------------------------
. Emergency Charges Maintenance (TABLE HEADING)
.------------------------------------------------------------
EMRHED00  IF AECNCHRS = 1
            WRITE     HTMLFILE;"<tr>":
                               "<td class=HeadingCell width=20%>":
                               "<b>Resident Status</b></td>":
                               "<td class=HeadingCell width=15%>":
                               "<b>Compensation Code</b></td>":
                               "<td class=HeadingCell width=15%>":
                               "<b>Discharge Status</b></td>":
                               "<td class=HeadingCell width=20%>":
                               "<b>Item Group</b></td>":
                               "<td class=HeadingCell width=20%>":
                               "<b>Description</b></td>":
                               "<td class=HeadingCell width=10% align=right>":
                               "<b>Charge</b></td>":
                               "</tr>"
          ELSE
            WRITE     HTMLFILE;"<tr>":
                               "<td class=HeadingCell width=20%>":
                               "<b>Resident Status</b></td>":
                               "<td class=HeadingCell width=20%>":
                               "<b>Compensation Code</b></td>":
                               "<td class=HeadingCell width=20%>":
                               "<b>Item Group</b></td>":
                               "<td class=HeadingCell width=25%>":
                               "<b>Description</b></td>":
                               "<td class=HeadingCell width=15% align=right>":
                               "<b>Charge</b></td>":
                               "</tr>"
          ENDIF
.
EMRHED99  RETURN
.------------------------------------------------------------
. Emergency Charges Maintenance (TABLE ROW)
.------------------------------------------------------------
EMRROW00  MOVE      SP70,CATDESC1
          MOVE      SP70,CATDESC2
          MOVE      SP70,CATDESC3
          MOVE      SP70,CATDESC4
          MOVE      SP70,CATDESC5
          MOVE      SP70,CATDESC6
.
          MATCH     SP70,NBRESD
          IF        @EQUAL
             MOVE      "&nbsp;",CATDESC2   * for Resident Status
          ELSE
             MOVE      "T ",CATEGORY
             MOVE      NBRESD,CODE
             CALL      GETCOD00
             MOVE      TDESC,CATDESC2
          ENDIF
.
          MATCH     SP70,NBCOMP
          IF        @EQUAL
             MOVE      "&nbsp;",CATDESC3   * for Compensation Code
          ELSE
             MOVE      "CL",CATEGORY
             MOVE      NBCOMP,CODE
             CALL      GETCOD00
             MOVE      TDESC,CATDESC3
          ENDIF
.
          MATCH     SP70,NBINDV
          IF        @EQUAL
             MOVE      "&nbsp;",CATDESC4   * for Discharge Status
          ELSE
             MOVE      "ED",CATEGORY
             MOVE      NBINDV,CODE
             CALL      GETCOD00
             MOVE      TDESC,CATDESC4
          ENDIF
.
          MATCH     SP70,NBITEM
          IF        @EQUAL
             MOVE      "&nbsp;",CATDESC5   * for Item Group
          ELSE
             MOVE      "FI",CATEGORY
             MOVE      NBITEM,CODE
             CALL      GETCOD00
             MOVE      TDESC,CATDESC5
          ENDIF
.
          MATCH     SP70,NBDESC
          IF        @EQUAL
            MOVE      "&nbsp;",CATDESC6     * for charge description
          ELSE
            MOVE      NBDESC,CATDESC6
          ENDIF
.
          WRITE     HTMLFILE;"<tr><td nowrap><A HREF='javascript:ShowDetail31":
                             "(#"",LINKPRG,"#.pbl":
                             "?reportno=",LINKREP:
                             "&template=",LINKTEM:
                             "&ptnip001=",DNBSYST:
                             "&ptnip002=",NBINDC:
                             "&ptnip003=",NBRESD:
                             "&ptnip004=",NBCOMP:
                             "&ptnip005=",NBINDV,"#")'>":
                             "<img src=../images/MaintenanceIcon.gif hspace=4":
                             " border=0 align=absmiddle></a>":
                             CATDESC2,"</td>":
                             "<td>",CATDESC3,"</td>"
.
          IF AECNCHRS = 1
            WRITE     HTMLFILE;"<td>",CATDESC4,"&nbsp;</td>"
          ENDIF
.
          WRITE     HTMLFILE;"<td>",CATDESC5,"</td>":
                             "<td>",CATDESC6,"</td>":
                             "<td align=right>",NBAMT,"</td>":
                             "</tr>"
.
EMRROW99 RETURN
.------------------------------------------------------------
. Link to Next set of Emergency Charges
.------------------------------------------------------------
NEXTER00  MOVE      NORECORD,KEY2
          REP       " +",KEY2
          ASSIGN    STARTNUM+NORECORD,F3
          MOVE      F3,KEY3
          REP       " +",KEY3
          UNPACK    DIM127,D1,FLDPARA,DIM127
          MOVE      REPORTNO,F2
.
          REP       " +",FLTRESID
          REP       " +",FLTCOMPE
.
          WRITE     HTMLFILE;"patweb87.pbl":
                                 "?reportno=",F2:
                                 "&template=",FLDPARA:
                                 "&startnum=",KEY3:
                                 "&norecord=",KEY2:
                                 "&fltresid=",FLTRESID:
                                 "&fltcompe=",FLTCOMPE;
.
          REP       "+ ",FLTRESID
          REP       "+ ",FLTCOMPE
.
NEXTER99  RETURN
.-------------------------------------------------------------------------------
. Link to previous set of Emergency Charges
.-------------------------------------------------------------------------------
PREVER00  MOVE      NORECORD,KEY2
          REP       " +",KEY2
          ASSIGN    STARTNUM-NORECORD,F3
          IF        F3<0
            MOVE    ZERO,F3
          ENDIF
          MOVE      F3,KEY3
          REP       " +",KEY3
          UNPACK    DIM127,D1,FLDPARA,DIM127
          MOVE      REPORTNO,F2
.
          REP       " +",FLTRESID
          REP       " +",FLTCOMPE
.
          WRITE     HTMLFILE;"patweb87.pbl":
                                 "?reportno=",F2:
                                 "&template=",FLDPARA:
                                 "&startnum=",KEY3:
                                 "&norecord=",KEY2:
                                 "&fltresid=",FLTRESID:
                                 "&fltcompe=",FLTCOMPE;
.
          REP       "+ ",FLTRESID
          REP       "+ ",FLTCOMPE
.
PREVER99  RETURN
+
.------------------------------------------------------------
. Emergency Triage Fee Maintenance
.------------------------------------------------------------
EMRTRF00  RESET     UPDTTYPE
          MATCH     SP1,UPDTTYPE
          GOTO      EMRTRF40 IF EQUAL
.
          MATCH     "A",UPDTTYPE    * Add formaction
          GOTO      EMRTRF10 IF EQUAL
.
          MATCH     "U",UPDTTYPE    * Update formaction
          GOTO      EMRTRF20 IF EQUAL
.
          MATCH     "D",UPDTTYPE    * Delete formaction
          GOTO      EMRTRF30 IF EQUAL
.
          GOTO      EMRTRF93
.
.
.         ************ ADD FORMACTION ***********
.
EMRTRF10  PACK      KEY14,EMTRF001,EMTRF002,EMTRF003,SP70
          CALL      RDEMTRF1
          COMPARE   ONE,OVRCD
          GOTO      EMRTRF92 IF NOT EQUAL
.
          CALL      CLRTRF00      * Clear all the file variables
          CALL      TRFSAV00      * Moves input variables to file variables
.
          PACK      EMTFCDAT,CURRDATE,SP10  
          CLOCK     TIME,EMTFCTIM
          MOVE      USERID,EMTFCUID
          PACK      KEY14,EMTRF001,EMTRF002,EMTRF003,SP70
          CALL      WREMTRF1      * Writes away the data
.
          MOVE      ZERO,EXIT
          GOTO      EMRTRF99
.
.         ************ UPDATE FORMACTION **********
.
EMRTRF20  PACK      KEY14,EMTRF001,EMTRF002,EMTRF003,SP70
          CALL      RDEMTRF1
          BRANCH    OVRCD,EMRTRF91
.
          CALL      TRFSAV00      * Moves input variables to file variables
.
          PACK      EMTFUDAT,CURRDATE,SP10  
          CLOCK     TIME,EMTFUTIM
          MOVE      USERID,EMTFUUID
          CALL      UPEMTRF1      * Writes away the data
.
          MOVE      ZERO,EXIT
          GOTO      EMRTRF99
.
.         ************ DELETE FORMACTION **********
.
EMRTRF30  PACK      KEY14,EMTRF001,EMTRF002,EMTRF003,SP70
          CALL      RDEMTRF1
          BRANCH    OVRCD,EMRTRF91
          CALL      DEEMTRF1
.
          MOVE      ZERO,EXIT
          GOTO      EMRTRF99
.
.         ************ DISPLAY FORMACTION **********
.
EMRTRF40  PACK      KEY14,EMTRF001,EMTRF002,EMTRF003,SP70
          CALL      RDEMTRF1
          IF        OVRCD=1
            CALL      CLRTRF00    * Clear all the file variables
          ENDIF
.
          CLEAR     WEBTITLE
          MOVE      "Emergency Triage Fee",WEBTITLE
          RESET     WEBTITLE
.
          CALL      WEBHED00   * Create Output File and Write HTML Page Header
          BRANCH    EXIT,EMRTRF99
          CALL      WEBBOD00   * Process Web Body
          CALL      WEBEND00   * Process End of HTML File
          MOVE      ONE,EXIT
          GOTO      EMRTRF99
.
EMRTRF91  MOVE      "Emergency Triage Fee does not exist",WEBTITLE
          CALL      WEBERR00
          MOVE      ONE,EXIT
          GOTO      EMRTRF99
.
EMRTRF92  MOVE      "Emergency Triage Fee exists",WEBTITLE
          CALL      WEBERR00
          MOVE      ONE,EXIT
          GOTO      EMRTRF99
.
EMRTRF93  MOVE      "Invalid Form Action.",WEBTITLE
          CALL      WEBERR00
          MOVE      ONE,EXIT
          GOTO      EMRTRF99
.
EMRTRF99  RETURN
.-----------------------------------------------------------
. Initialize's file data (Emergency Triage Fee Maintenace)
.-----------------------------------------------------------
CLRTRF00  MOVE      SP70,EMTFTRIG
          MOVE      SP70,EMTFATTD
          MOVE      SP70,EMTFEFDA
          MOVE      SP70,EMTFDESC
          MOVE      ZERO,EMTFAMNT
          MOVE      SP70,EMTFSCOD
          MOVE      SP70,EMTFACTV
          MOVE      SP70,EMTFCDAT
          MOVE      SP70,EMTFCTIM
          MOVE      SP70,EMTFCUID
          MOVE      SP70,EMTFUDAT
          MOVE      SP70,EMTFUTIM
          MOVE      SP70,EMTFUUID
          PACK      EMTFSPAR,SP70,SP70
.
CLRTRF99  RETURN
.-----------------------------------------------------------------------------
. Moves cgi variables into file variables (Outpatient Charge Code Maintenance)
.-----------------------------------------------------------------------------
TRFSAV00  MOVE      EMTRF001,EMTFTRIG
          MOVE      EMTRF002,EMTFATTD
          MOVE      EMTRF003,EMTFEFDA
          MOVE      EMTRF004,EMTFDESC
          MOVE      EMTRF005,EMTFAMNT
          MOVE      EMTRF006,EMTFSCOD
          MOVE      EMTRF007,EMTFACTV
TRFSAV99  RETURN
+
.------------------------------------------------------------
. Emergency Triage Fee Maintenance
.------------------------------------------------------------
EMTF0000  BRANCH    FLDITMNO,EMTF0100,EMTF0200,EMTF0300,EMTF0400,EMTF0500:
                             EMTF0600,EMTF0700,EMTF0800,EMTF0900,EMTF1000:
                             EMTF1100,EMTF1200
          GOTO      EMTF9999
.
EMTF0100  MOVE      "AA",CATEGORY
          MOVE      EMTFTRIG,CODE
          CALL      CODITM00
          GOTO      EMTF9999
.
EMTF0200  MOVE      "ee",CATEGORY
          MOVE      EMTFATTD,CODE
          CALL      CODITM00
          GOTO      EMTF9999
.
EMTF0300  UNPACK    DIM127,D1,KEY1,DIM127     * .0   Religious visit
          MOVE      ZERO,F1
          MOVE      KEY1,F1
          BRANCH    F1,EMTF0310
          WRITE     HTMLFILE;EMTFEFDA;
          GOTO      EMTF9999
.
EMTF0310  MATCH     EMTFEFDA,SP70
          GOTO      EMTF9999 IF EQUAL
          UNPACK    EMTFEFDA,CCENT,CYEAR,CMON,CDAY
          MOVE      CMON,F2
          LOAD      MTHNAM3,F2,JAN,FEB,MAR,APR,MAY,JUN,JUL,AUG,SEP,OCT,NOV,DEC
          WRITE     HTMLFILE;CDAY,SP1,MTHNAM3,SP1,CCENT,CYEAR;
          GOTO      EMTF9999
.
EMTF0400  WRITE     HTMLFILE;EMTFDESC;
          GOTO      EMTF9999
.
EMTF0500  WRITE     HTMLFILE;EMTFAMNT;
          GOTO      EMTF9999
.
EMTF0600  MOVE      "PG",CATEGORY
          MOVE      EMTFSCOD,CODE
          CALL      CODITM00
          GOTO      EMTF9999
.
EMTF0700  UNPACK    DIM127,D1,KEY1,DIM127     * .0   Religious visit
          MOVE      ZERO,F1
          MOVE      KEY1,F1
          BRANCH    F1,EMTF0710,EMTF0720
          WRITE     HTMLFILE;EMTFACTV;
          GOTO      EMTF9999
EMTF0710  IF        EMTFACTV=1
            WRITE     HTMLFILE;"Yes";
          ELSE
            WRITE     HTMLFILE;"No";
          ENDIF
          GOTO      EMTF9999
EMTF0720  IF        EMTFACTV=1
            WRITE     HTMLFILE;"<option value=",ONE," selected>Yes":
                               "</option>"
          ELSE
            WRITE     HTMLFILE;"<option value=",ONE,">Yes":
                               "</option>"
          ENDIF
.
          IF        EMTFACTV<>1
            WRITE     HTMLFILE;"<option value=",ZERO," selected>No":
                               "</option>"
          ELSE
            WRITE     HTMLFILE;"<option value=",ZERO,">No":
                               "</option>"
          ENDIF
          GOTO      EMTF9999
.
EMTF0800  CALL      EMRTFE00      * Table of Triage Fee
          GOTO      EMTF9999
.
EMTF0900  CALL      NEXTTF00      * Link to Next Group for Triage fee
          GOTO      EMTF9999
.
EMTF1000  CALL      PREVTF00      * Link to Last Group for Triage fee
          GOTO      EMTF9999
.
EMTF1100  MOVE      "AA",CATEGORY
          MOVE      FLTTRIAG,CODE
          CALL      CODITM00
          GOTO      EMTF9999
.
EMTF1200  MOVE      "ee",CATEGORY
          MOVE      FLTATTND,CODE
          CALL      CODITM00
          GOTO      EMTF9999
.
EMTF9999  RETURN
.------------------------------------------------------------
. Emergency Triage Fee Maintenance Table
.------------------------------------------------------------
EMRTFE00  UNPACK    DIM127,D1,LINKPRG,DIM127
          UNPACK    DIM127,D1,LINKREP,DIM127
          UNPACK    DIM127,D1,LINKTEM,DIM127
.
          CALL      EMRTHD00      * Output Table Heading
.
          IF        NORECORD=0
            MOVE      PTCNNRTD,NORECORD     * Set Default No Records to Display
          ENDIF
          MOVE      ZERO,RECNUMB
          MOVE      ZERO,DISNUMB
.
          PACK      KEY14,FLTTRIAG,FLTATTND,SP70
          CALL      RSEMTRF1
EMRTFE10  CALL      RKEMTRF1
          BRANCH    OVRCD,EMRTFE90
.
          MATCH     SP70,FLTTRIAG           * Triage code Filter use?
          IF        !@EQUAL
            MATCH     FLTTRIAG,EMTFTRIG     * Same Triage code?
            GOTO      EMRTFE10 IF NOT EQUAL * No, read next record
          ENDIF
.
          MATCH     SP70,FLTATTND           * Attendance type Filter use?
          IF        !@EQUAL
            MATCH     FLTATTND,EMTFATTD     * Same Attendance type?
            GOTO      EMRTFE10 IF NOT EQUAL * No, read next record
          ENDIF
.
          ADD       ONE,RECNUMB
          IF        STARTNUM>=RECNUMB
            GOTO      EMRTFE10
          ENDIF
.
          CALL      EMRTRW00                * Table Row
          ADD       ONE,DISNUMB
          COMPARE   NORECORD,DISNUMB
          GOTO      EMRTFE10 IF NOT EQUAL
          GOTO      EMRTFE99
.
EMRTFE90  CALL      NOMORE00       * Display No More Records Message
.
EMRTFE99  RETURN
.------------------------------------------------------------
. Emergency Charges Maintenance (TABLE HEADING)
.------------------------------------------------------------
EMRTHD00  WRITE     HTMLFILE;"<tr>":
                             "<td class=HeadingCell width=15%>":
                             "<b>Triage Code</b></td>":
                             "<td class=HeadingCell width=15%>":
                             "<b>Attendance Type</b></td>":
                             "<td class=HeadingCell width=10%>":
                             "<b>Effective Date</b></td>":
                             "<td class=HeadingCell width=20%>":
                             "<b>Description</b></td>":
                             "<td class=HeadingCell width=15%>":
                             "<b>Amount</b></td>":
                             "<td class=HeadingCell width=15%>":
                             "<b>Set Code</b></td>":
                             "<td class=HeadingCell width=10%>":
                             "<b>Active</b></td>":
                             "</tr>"
.
EMRTHD99  RETURN
.------------------------------------------------------------
. Emergency Triage Fee Maintenance (TABLE ROW)
.------------------------------------------------------------
EMRTRW00  MOVE      SP70,CATDESC1
          MOVE      SP70,CATDESC2
          MOVE      SP70,CATDESC3
          MOVE      SP70,CATDESC4
          MOVE      SP70,CATDESC5
          MOVE      SP70,CATDESC6
.
          MATCH     SP70,EMTFTRIG
          IF        @EQUAL
            MOVE      "&nbsp;",CATDESC1   * for Triage code
          ELSE
            MOVE      "AA",CATEGORY
            MOVE      EMTFTRIG,CODE
            CALL      GETCOD00
            MOVE      TDESC,CATDESC1
          ENDIF
.
          MATCH     SP70,EMTFATTD
          IF        @EQUAL
            MOVE      "&nbsp;",CATDESC2   * for Attendance Type
          ELSE
            MOVE      "ee",CATEGORY
            MOVE      EMTFATTD,CODE
            CALL      GETCOD00
            MOVE      TDESC,CATDESC2
          ENDIF
.
          MATCH     SP70,EMTFSCOD
          IF        @EQUAL
            MOVE      "&nbsp;",CATDESC3   * for Set Group
          ELSE
            MOVE      "PG",CATEGORY
            MOVE      EMTFSCOD,CODE
            CALL      GETCOD00
            MOVE      TDESC,CATDESC3
          ENDIF
.
          MOVE      SP20,KEY12
          UNPACK    EMTFEFDA,CCENT,CYEAR,CMON,CDAY
          MOVE      CMON,F2
          LOAD      MTHNAM3,F2,JAN,FEB,MAR,APR,MAY,JUN,JUL,AUG,SEP,OCT,NOV,DEC
          PACK      KEY12,CDAY,SP1,MTHNAM3,SP1,CCENT,CYEAR
.
          WRITE     HTMLFILE;"<tr><td nowrap><A HREF='javascript:ShowDetail43":
                             "(#"",LINKPRG,"#.pbl":
                             "?reportno=",LINKREP:
                             "&template=",LINKTEM:
                             "&emtrf001=",EMTFTRIG:
                             "&emtrf002=",EMTFATTD:
                             "&emtrf003=",KEY12,"#")'>":
                             "<img src=../images/MaintenanceIcon.gif hspace=4":
                             " border=0 align=absmiddle></a>":
                             CATDESC1,"</td>":
                             "<td>",CATDESC2,"</td>"
.
          MOVE      "No ",KEY3
          IF        EMTFACTV=1
            MOVE      "Yes",KEY3
          ENDIF
.
          WRITE     HTMLFILE;"<td>",KEY12,"</td>":
                             "<td>&nbsp;",EMTFDESC,"</td>":
                             "<td>",EMTFAMNT,"</td>":
                             "<td>&nbsp;",CATDESC3,"</td>":
                             "<td>",KEY3,"</td>":
                             "</tr>"
.
EMRTRW99 RETURN
.------------------------------------------------------------
. Link to Next set of Emergency Triage Fee
.------------------------------------------------------------
NEXTTF00  MOVE      NORECORD,KEY2
          REP       " +",KEY2
          ASSIGN    STARTNUM+NORECORD,F3
          MOVE      F3,KEY3
          REP       " +",KEY3
          UNPACK    DIM127,D1,FLDPARA,DIM127
          MOVE      REPORTNO,F2
.
          REP       " +",FLTTRIAG
          REP       " +",FLTATTND
.
          WRITE     HTMLFILE;"patweb87.pbl":
                                 "?reportno=",F2:
                                 "&template=",FLDPARA:
                                 "&startnum=",KEY3:
                                 "&norecord=",KEY2:
                                 "&flttriag=",FLTTRIAG:
                                 "&fltattnd=",FLTATTND;
.
          REP       "+ ",FLTTRIAG
          REP       "+ ",FLTATTND
.
NEXTTF99  RETURN
.-------------------------------------------------------------------------------
. Link to previous set of Emergency Triage Fee
.-------------------------------------------------------------------------------
PREVTF00  MOVE      NORECORD,KEY2
          REP       " +",KEY2
          ASSIGN    STARTNUM-NORECORD,F3
          IF        F3<0
            MOVE    ZERO,F3
          ENDIF
          MOVE      F3,KEY3
          REP       " +",KEY3
          UNPACK    DIM127,D1,FLDPARA,DIM127
          MOVE      REPORTNO,F2
.
          REP       " +",FLTTRIAG
          REP       " +",FLTATTND
.
          WRITE     HTMLFILE;"patweb87.pbl":
                                 "?reportno=",F2:
                                 "&template=",FLDPARA:
                                 "&startnum=",KEY3:
                                 "&norecord=",KEY2:
                                 "&flttriag=",FLTTRIAG:
                                 "&fltattnd=",FLTATTND;
.
          REP       "+ ",FLTTRIAG
          REP       "+ ",FLTATTND
.
PREVTF99  RETURN
.
.-------------------------------------------------------------------
. Invoice Message Per Claim Code Maintenance (patinmaf)
.------------------------------------------------------------
INCMSG00  RESET     UPDTTYPE
          MATCH     SP1,UPDTTYPE
          GOTO      INCMSG40 IF EQUAL
.
          MATCH     "A",UPDTTYPE    * Add formaction
          GOTO      INCMSG10 IF EQUAL
.
          MATCH     "U",UPDTTYPE    * Update formaction
          GOTO      INCMSG20 IF EQUAL
.
          MATCH     "D",UPDTTYPE    * Delete formaction
          GOTO      INCMSG30 IF EQUAL
.
          GOTO      INCMSG93
.
.         ********* ADD FORMACTION *********
.
INCMSG10  PACK      KEY4,INCMSGSY,INCMSGCD,SP70
          CALL      RDPTINM1
          COMPARE   ZERO,OVRCD
          GOTO      INCMSG92 IF EQUAL
          CALL      CHKICM00        * Checks mandatory fields
          BRANCH    EXIT,INCMSG99
          CALL      ICMSAV00        * Moves input variables to file variables
          PACK      KEY4,INCMSGSY,INCMSGCD,SP70
          CALL      WRPTINM1        * Writes away the data
          MOVE      ZERO,EXIT
          GOTO      INCMSG99
.
.         ********* UPDATE FORMACTION *********
.
INCMSG20  PACK      KEY4,INCMSGSY,INCMSGCD,SP70
          CALL      RDPTINM1
          BRANCH    OVRCD,INCMSG91
          CALL      CHKICM00        * Checks mandatory fields
          BRANCH    EXIT,INCMSG99
          CALL      ICMSAV00        * Moves input variables to file variables
          CALL      UPPTINM1        * Writes away the data
          MOVE      ZERO,EXIT
          GOTO      INCMSG99
.
.         ********* DELETE FORMACTION *********
.
INCMSG30  PACK      KEY4,INCMSGSY,INCMSGCD,SP70
          CALL      RDPTINM1
          BRANCH    OVRCD,INCMSG91
          CALL      DEPTINM1        * Deletes the data
          MOVE      ZERO,EXIT
          GOTO      INCMSG99
.
.         ********* DISPLAY FORMACTION *********
.
INCMSG40  PACK      KEY4,INCMSGSY,INCMSGCD,SP70
          CALL      RDPTINM1
          IF        OVRCD=1
            CALL      CLRICM00      * Clear all the file variables
          ENDIF
.
          CLEAR     WEBTITLE
          MOVE      "Invoice Message Per Claim Code Maintenance",WEBTITLE
          RESET     WEBTITLE
.
          CALL      WEBHED00   * Create Output File and Write HTML Page Header
          BRANCH    EXIT,INCMSG99
.
          CALL      WEBBOD00   * Process Web Body
.
          CALL      WEBEND00   * Process End of HTML File
.
          MOVE      ONE,EXIT
          GOTO      INCMSG99
.
.         ********* ERROR MESSAGES *********
.
INCMSG91  MOVE      "Invoice Message record does not exist",WEBTITLE
          CALL      WEBERR00
          MOVE      ONE,EXIT
          GOTO      INCMSG99
.
INCMSG92  MOVE      "Invoice Message record exists",WEBTITLE
          CALL      WEBERR00
          MOVE      ONE,EXIT
          GOTO      INCMSG99
.
INCMSG93  MOVE      "Invalid Form Action.",WEBTITLE
          CALL      WEBERR00
          MOVE      ONE,EXIT
          GOTO      INCMSG99
.
INCMSG99  RETURN
.--------------------------------------------------------------
. Initialize's file data (Invoice Message Maintenace patinmaf)
.--------------------------------------------------------------
CLRICM00  MOVE      SP70,DPTIMSYS
          MOVE      SP70,PTIMCLM
          MOVE      SP70,PTIMMES1
          MOVE      SP70,PTIMMES2
          MOVE      SP70,PTIMSPAR
.
CLRICM99  RETURN
.------------------------------------------------------------------
. * Checks mandatory fields (Invoice Message Maintenance patinmaf)
.------------------------------------------------------------------
CHKICM00  COMPARE   ZERO,INCMSGSY
          GOTO      CHKICM90 IF EQUAL
.
          MATCH     SP70,INCMSGCD
          GOTO      CHKICM91 IF EQUAL
.
          GOTO      CHKICM98
.
CHKICM90  MOVE      "Invoice Message System is mandatory!",WEBTITLE
          CALL      WEBERR00
          MOVE      ONE,EXIT
          GOTO      CHKICM99
.
CHKICM91  MOVE      "Invoice Message Claim Code is mandatory!",WEBTITLE
          CALL      WEBERR00
          MOVE      ONE,EXIT
          GOTO      CHKICM99
.
CHKICM98  MOVE      ZERO,EXIT
CHKICM99  RETURN
.--------------------------------------------------------------------------
. Cgi variables into file variables (Invoice Message Maintenance patinmaf)
.--------------------------------------------------------------------------
ICMSAV00  MOVE      INCMSGSY,PTIMSYS        * System Code
          MOVE      INCMSGCD,PTIMCLM        * Claim Code
          MOVE      INCMSGL1,PTIMMES1       * Message 1
          MOVE      INCMSGL2,PTIMMES2       * Message 2
          MOVE      SP70,PTIMSPAR
.
ICMSAV99  RETURN
.------------------------------------------------------------
. Link to Next set of Invoice Messages (patinmaf)
.------------------------------------------------------------
NEXTCM00  MOVE      NORECORD,KEY2
          REP       " +",KEY2
          ASSIGN    STARTNUM+NORECORD,F3
          MOVE      F3,KEY3
          REP       " +",KEY3
          UNPACK    DIM127,D1,FLDPARA,DIM127
          MOVE      REPORTNO,F2
.
          WRITE     HTMLFILE;"patweb87.pbl":
                                 "?reportno=",F2:
                                 "&template=",FLDPARA:
                                 "&startnum=",KEY3:
                                 "&norecord=",KEY2:
                                 "&incmsgsy=",INCMSGSY;
                               
.
NEXTCM99  RETURN
.-------------------------------------------------------------------------------
. Link to previous set of Invoice Messages (patinmaf)
.-------------------------------------------------------------------------------
PREVCM00  MOVE      NORECORD,KEY2
          REP       " +",KEY2
          ASSIGN    STARTNUM-NORECORD,F3
          IF        F3<0
            MOVE    ZERO,F3
          ENDIF
          MOVE      F3,KEY3
          REP       " +",KEY3
          UNPACK    DIM127,D1,FLDPARA,DIM127
          MOVE      REPORTNO,F2
.
          WRITE     HTMLFILE;"patweb87.pbl":
                                 "?reportno=",F2:
                                 "&template=",FLDPARA:
                                 "&startnum=",KEY3:
                                 "&norecord=",KEY2:
                                 "&incmsgsy=",INCMSGSY;
.
PREVCM99  RETURN
.
.------------------------------------------------------------
. Patient Financial Letters Maintenance 
.------------------------------------------------------------
.
PATFLT00  CALL      CLPATFLT
          MATCH     SP70,UPDTTYPE      * Display formactn
          GOTO      PATFLT40 IF EQUAL
.
          MATCH     "A",UPDTTYPE       * Add formactn
          GOTO      PATFLT10 IF EQUAL
.
          MATCH     "U",UPDTTYPE       * Update formactn
          GOTO      PATFLT20 IF EQUAL
.
          MATCH     "D",UPDTTYPE       * Delete formactn
          GOTO      PATFLT30 IF EQUAL
.
          MOVE      "Invalid Update Type",WEBTITLE
          CALL      WEBERR00
          GOTO      PATFLT99
.
.         ********* ADD FORMACTN *********
.
PATFLT10  CALL      ADDFLT00
          GOTO      PATFLT99
.
.         ********* UPDATE FORMACTN *********
.
PATFLT20  CALL      UPDFLT00
          GOTO      PATFLT99
.
.         ********* DELETE FORMACTN *********
.
PATFLT30  CALL      DELFLT00
          GOTO      PATFLT99
.
.         ********* DISPLAY FORMACTN *********
.
PATFLT40  SQUEEZE   PTFLT001
          MOVE      PTFLT001,F3
          MOVE      F3,KEY3
          MOVE      ZERO,F3
          PACK      KEY6,KEY3,F3
          CALL      RDPTFL1 
          IF        OVRCD=1
            CALL      CLPATFLT         * Clear variables
          ENDIF
.
          MOVE      "Financial Letters",WEBTITLE
          CALL      WEBHED00
          BRANCH    EXIT,PATFLT99
          CALL      WEBBOD00
          CALL      WEBEND00
.
PATFLT99  RETURN
.
.----------------------------------------------------------------
. Clear patient financial letter variables
.----------------------------------------------------------------
.
CLPATFLT  MOVE      ZERO,PTFLLTNO      * Letter number
          MOVE      ZERO,PTFLLINO      * Line number for letter
          MOVE      SP70,PTFLTEXT      * Line of letter
          MOVE      ZERO,PTFLLVAR      * Variable present 1=yes 2=no
          MOVE      ZERO,PTFLPBOT      * Letter bottom margin
          MOVE      ZERO,PTFLPTOP      * Letter top margin
          MOVE      ZERO,PTFLPPAG      * Physical pager length (no. of lines)
          MOVE      ZERO,PTFLPTAB      * Letter left margin
          MOVE      SP70,PTFLACTV      * Active
          MOVE      SP70,PTFLSPAR      * Spare variable
          RETURN
+
.------------------------------------------------------------
. Add Letter
.------------------------------------------------------------
ADDFLT00  CALL      CLPATFLT
          SQUEEZE   PTFLT001
          MOVE      PTFLT001,PTFLLTNO
          MOVE      ZERO,PTFLLINO
          PACK      KEY6,PTFLLTNO,PTFLLINO,SP70
          CALL      RDPTFL1 
          IF        OVRCD=1
            CALL      MVFLT000
            CALL      WRPTFL1 
            CALL      FLTDET00  * Update Letter Details
            CALL      WINCLS00
          ELSE
            MOVE      "Letter Already on File",WEBTITLE
            CALL      WEBERR00
          ENDIF
          RETURN
.------------------------------------------------------------
. Update Extract
.------------------------------------------------------------
UPDFLT00  CALL      CLPATFLT
          SQUEEZE   PTFLT001
          MOVE      PTFLT001,PTFLLTNO
          MOVE      ZERO,PTFLLINO
          PACK      KEY6,PTFLLTNO,PTFLLINO,SP70
          CALL      RDPTFL1 
          IF        OVRCD=0
            CALL      MVFLT000
            CALL      UPPTFL1 
            CALL      FLTDET00  * Update Letter Details
            CALL      WINCLS00
          ELSE
            MOVE      "Extract Not On File",WEBTITLE
            CALL      WEBERR00
          ENDIF
          RETURN
.------------------------------------------------------------
. Delete Extract
.------------------------------------------------------------
DELFLT00  SQUEEZE   PTFLT001
          MOVE      PTFLT001,PTFLLTNO
          MOVE      ZERO,PTFLLINO
          PACK      KEY6,PTFLLTNO,PTFLLINO,SP70
          CALL      RDPTFL1 
          IF        OVRCD=0
            CALL      DEPTFL1 
            CALL      FLTDET00
            CALL      WINCLS00
          ELSE
            MOVE      "Extract Not On File",WEBTITLE
            CALL      WEBERR00
          ENDIF
          RETURN
.
.------------------------------------------------------------
. Move in Financial Letter Details
.------------------------------------------------------------
MVFLT000  MATCH     Z70,PTFLT001
          IF        !@EQUAL
            SQUEEZE    PTFLT001
            MOVE       PTFLT001,PTFLLTNO
          ENDIF
.
          MATCH     Z70,PTFLT002
          IF        !@EQUAL
            MOVE       PTFLT002,PTFLTEXT
          ENDIF
.
          COMPARE   ZERO,PTFLT003
          IF        !@EQUAL
            MOVE       PTFLT003,PTFLPBOT
          ENDIF
.
          COMPARE   ZERO,PTFLT004
          IF        !@EQUAL
            MOVE       PTFLT004,PTFLPTOP
          ENDIF
.
          COMPARE   ZERO,PTFLT005
          IF        !@EQUAL
            MOVE       PTFLT005,PTFLPPAG
          ENDIF
.
          COMPARE   ZERO,PTFLT006
          IF        !@EQUAL
            MOVE       PTFLT006,PTFLPTAB
          ENDIF
.
          MATCH     Z70,PTFLT007
          IF        !@EQUAL
            MOVE       PTFLT007,PTFLACTV
          ENDIF
.
          RETURN
.------------------------------------------------------------
. Financial Letter Maintenance details
.------------------------------------------------------------
FLTDET00  SQUEEZE   PTFLT001
          MOVE      PTFLT001,PTFLLTNO
          MOVE      PTFLT001,LETTNUMB
          MOVE      ZERO,PTFLLINO
          PACK      KEY6,PTFLLTNO,PTFLLINO,SP70
          CALL      RDPTFL1 
FLTDET10  CALL      RKPTFL1 
          BRANCH    OVRCD,FLTDET20
.
          COMPARE   PTFLLTNO,LETTNUMB
          GOTO      FLTDET20 IF NOT EQUAL
.
          PACK      KEY6,PTFLLTNO,PTFLLINO,SP70
          CALL      DEPTFL1 
          CALL      RSPTFL1 
          GOTO      FLTDET10
.
FLTDET20  MATCH     "D",UPDTTYPE
          GOTO      FLTDET99 IF EQUAL
.
          COMPARE   ZERO,PTLEEND
          GOTO      FLTDET99 IF EQUAL
.
          CALL      CLPATFLT
          MOVE      ZERO,F3
FLTDET30  ADD       ONE,F3
          MOVE      LETTNUMB,PTFLLTNO
          MOVE      F3,PTFLLINO
          PACK      KEY6,PTFLLTNO,PTFLLINO,SP70
          CALL      RDPTFL1 
          IF        OVRCD=0
            MOVE      ZERO,PTFLLVAR
            SCAN      SPECCHAR,PTLECOMN[F3]
            IF        @EQUAL
              MOVE      ONE,PTFLLVAR
            ENDIF
            RESET     PTLECOMN[F3]
            MOVE      PTLECOMN[F3],PTFLTEXT
            CALL      UPPTFL1  
          ELSE
            MOVE      ZERO,PTFLLVAR
            SCAN      SPECCHAR,PTLECOMN[F3]
            IF        @EQUAL
              MOVE      ONE,PTFLLVAR
            ENDIF
            RESET     PTLECOMN[F3]
            MOVE      PTLECOMN[F3],PTFLTEXT
            CALL      WRPTFL1 
          ENDIF
.
          COMPARE   F3,PTLEEND
          GOTO      FLTDET30 IF NOT EQUAL
.
FLTDET99  RETURN
+
.------------------------------------------------------------
. Financial Letter Maintenance Field items
.------------------------------------------------------------
PTFL0000  BRANCH    FLDITMNO,PTFL0100,PTFL0200,PTFL0300,PTFL0400,PTFL0500:
                             PTFL0600,PTFL0700,PTFL0800,PTFL0900,PTFL1000
          WRITE     HTMLFILE;"Invalid Tag";
          GOTO      PTFL9999
.
PTFL0100  COMPARE   ZERO,PTFLLTNO
          GOTO      PTFL0110 IF EQUAL
          WRITE     HTMLFILE;PTFLLTNO;
          GOTO      PTFL9999
.
PTFL0110  MOVE      ZERO,F3
          PACK      KEY6,F3,Z70
          CALL      RSPTFL2 
          CALL      RPPTFL2 
          IF        OVRCD=1
            WRITE     HTMLFILE;"  1";
          ELSE
            ADD       ONE,PTFLLTNO
            WRITE     HTMLFILE;PTFLLTNO;
            CALL      CLPATFLT
          ENDIF
          GOTO      PTFL9999
.
PTFL0200  MATCH     SP70,PTFLTEXT
          GOTO      PTFL9999 IF EQUAL
          WRITE     HTMLFILE;PTFLTEXT;
          GOTO      PTFL9999
.
PTFL0300  WRITE     HTMLFILE;PTFLPBOT;
          GOTO      PTFL9999
.
PTFL0400  WRITE     HTMLFILE;PTFLPTOP;
          GOTO      PTFL9999
.
PTFL0500  WRITE     HTMLFILE;PTFLPPAG;
          GOTO      PTFL9999
.
PTFL0600  WRITE     HTMLFILE;PTFLPTAB;
          GOTO      PTFL9999
.
PTFL0700  CALL      FLTTAB00
          GOTO      PTFL9999
.
PTFL0800  SQUEEZE   PTFLT001
          MOVE      ZERO,LETTNUMB
          MOVE      PTFLT001,LETTNUMB
.
          COMPARE   ZERO,LETTNUMB
          GOTO      PTFL9999 IF EQUAL
.
          PACK      KEY6,LETTNUMB,SP2,ZERO
          CALL      RDPTFL1 
PTFL0810  CALL      RKPTFL1 
          BRANCH    OVRCD,PTFL0890
.
          COMPARE   LETTNUMB,PTFLLTNO
          GOTO      PTFL0890 IF NOT EQUAL
.
          STRIP     PTFLTEXT
          MOVELPTR  PTFLTEXT,F3
          IF        F3>0
            SFORMAT   VAR,F3
          ELSE
            SFORMAT   VAR,1
          ENDIF
          MOVE      PTFLTEXT,VAR
          WRITE     HTMLFILE;VAR
          SFORMAT   VAR,127
.
          GOTO      PTFL0810
.
PTFL0890  PACK      KEY6,LETTNUMB,SP2,ZERO
          CALL      RDPTFL1 
          GOTO      PTFL9999
.
PTFL0900  WRITE     HTMLFILE;PTFLACTV;
          GOTO      PTFL9999
.
PTFL1000  WRITE     HTMLFILE;FILTACTV;
          GOTO      PTFL9999
.
PTFL9999  RETURN
+
.------------------------------------------------------------
. Output Table of Financial Letter Headers Details
.------------------------------------------------------------
FLTTAB00  MOVE      ZERO,F3
          PACK      KEY6,F3,SP70
          CALL      RSPTFL2 
FLTTAB10  CALL      RKPTFL2 
          BRANCH    OVRCD,FLTTAB99
.
          COMPARE   ZERO,PTFLLINO
          GOTO      FLTTAB99 IF NOT EQUAL
.
          MATCH     "0",FILTACTV            * Active Only
          IF        @EQUAL
            MATCH     "1",PTFLACTV
            GOTO      FLTTAB10 IF EQUAL
          ENDIF
.
          MATCH     "1",FILTACTV            * Inactive Only
          IF        @EQUAL
            MATCH     "1",PTFLACTV
            GOTO      FLTTAB10 IF NOT EQUAL
          ENDIF
.
          CLEAR     HTMLLINK
          APPEND    "javascript:UpdateLetter('",HTMLLINK
          APPEND    PTFLLTNO,HTMLLINK
          APPEND    "')",HTMLLINK
          RESET     HTMLLINK
.
          MATCH     "1",PTFLACTV
          IF        @EQUAL
            MOVE    "Inactive  ",ACTIDESC
          ELSE
            MOVE    "Active",ACTIDESC
          ENDIF

.
          WRITE     HTMLFILE;"t.addRow(#"",HTMLLINK,"#",":
                             "#"",PTFLLTNO,"#",":     * Letter number
                             "#"",PTFLTEXT,"#",":     * Line of letter
                             "#"",PTFLPBOT,"#",":     * Bottom margin
                             "#"",PTFLPTOP,"#",":     * Top margin
                             "#"",PTFLPPAG,"#",":     * Page length
                             "#"",PTFLPTAB,"#",":     * Page length
                             "#"",ACTIDESC,"#");"     * Active
.
          GOTO      FLTTAB10
.
FLTTAB99  RETURN
+
.------------------------------------------------------------
. Booking Letters Maintenance 
.------------------------------------------------------------
.
BOKLET00  MATCH     SP70,UPDTTYPE      * Display formactn
          GOTO      BOKLET40 IF EQUAL
.
          MATCH     "A",UPDTTYPE       * Add formactn
          GOTO      BOKLET10 IF EQUAL
.
          MATCH     "U",UPDTTYPE       * Update formactn
          GOTO      BOKLET20 IF EQUAL
.
          MATCH     "D",UPDTTYPE       * Delete formactn
          GOTO      BOKLET30 IF EQUAL
.
          GOTO      BOKLET90
.
.         ********* ADD FORMACTN *********
.
BOKLET10  CALL      CLBKLT00
          SQUEEZE   BKLET001
          MOVE      BKLET001,BLETNO
          MOVE      ZERO,BLINNO
          PACK      KEY6,BLETNO,BLINNO,SP70
          CALL      RDLET1
          COMPARE   ZERO,OVRCD
          GOTO      BOKLET91 IF EQUAL
.
          CALL      MVBKLT00  * Move Letter variables
          CALL      WRLET1    * Write Letter Header Record
          CALL      BKLTDT00  * Write Letter Detail Records
          MOVE      ZERO,EXIT
          GOTO      BOKLET99
.
.         ********* UPDATE FORMACTN *********
.
BOKLET20  CALL      CLBKLT00
          SQUEEZE   BKLET001
          MOVE      BKLET001,BLETNO
          MOVE      ZERO,BLINNO
          PACK      KEY6,BLETNO,BLINNO,SP70
          CALL      RDLET1
          BRANCH    OVRCD,BOKLET92
.
          CALL      MVBKLT00  * Move Letter variables
          CALL      UPLET1    * Update Letter Header Record
          CALL      BKLTDT00  * Update Letter Detail Records
          MOVE      ZERO,EXIT
          GOTO      BOKLET99
.
.         ********* DELETE FORMACTN *********
.
BOKLET30  SQUEEZE   BKLET001
          MOVE      BKLET001,BLETNO
          MOVE      ZERO,BLINNO
          PACK      KEY6,BLETNO,BLINNO,SP70
          CALL      RDLET1
          BRANCH    OVRCD,BOKLET92
.
          CALL      DELLET1    * Delete Letter Header Record
          CALL      BKLTDT00   * Delete Letter Detail Records
          MOVE      ZERO,EXIT
          GOTO      BOKLET99
.
.         ********* DISPLAY FORMACTN *********
.
BOKLET40  SQUEEZE   BKLET001
          MOVE      BKLET001,F3
          MOVE      F3,KEY3
          MOVE      ZERO,F3
          PACK      KEY6,KEY3,F3
          CALL      RDLET1 
          IF        OVRCD=1
            CALL      CLBKLT00         * Clear variables
          ENDIF
.
          MOVE      "Booking Letters",WEBTITLE
          CALL      WEBHED00
          BRANCH    EXIT,BOKLET99
          CALL      WEBBOD00
          CALL      WEBEND00
          MOVE      ONE,EXIT
          GOTO      BOKLET99
.
BOKLET90  MOVE      "Invalid Update Type",WEBTITLE
          MOVE      ONE,EXIT
          CALL      WEBERR00
          GOTO      BOKLET99
.
BOKLET91  MOVE      "Letter Already on File",WEBTITLE
          MOVE      ONE,EXIT
          CALL      WEBERR00
          GOTO      BOKLET99
.
BOKLET92  MOVE      "Letter Not On File",WEBTITLE
          MOVE      ONE,EXIT
          CALL      WEBERR00
          GOTO      BOKLET99
.
BOKLET99  RETURN
.
.----------------------------------------------------------------
. Clear booking letter variables
.----------------------------------------------------------------
.
CLBKLT00  MOVE      ZERO,BLETNO        * Letter number
          MOVE      ZERO,BLINNO        * Line number for letter
          MOVE      SP70,BLTEXT        * Line of letter
          MOVE      ZERO,BLVAR         * Variable present 1=yes 2=no
          MOVE      ZERO,BLETPBOT      * Letter bottom margin
          MOVE      ZERO,BLETPTOP      * Letter top margin
          MOVE      ZERO,BLETPPAG      * Physical pager length (no. of lines)
          MOVE      ZERO,BLETPTAB      * Letter left margin
          MOVE      SP70,BLETACTV      * Active
          MOVE      SP70,BLETSPAR      * Spare variable
.
CLBKLT99  RETURN
+
.------------------------------------------------------------
. Move in Booking Letter Details
.------------------------------------------------------------
MVBKLT00  MATCH     Z70,BKLET001
          IF        !@EQUAL
            SQUEEZE    BKLET001
            MOVE       BKLET001,BLETNO
          ENDIF
.
          MATCH     Z70,BKLET002
          IF        !@EQUAL
            MOVE       BKLET002,BLTEXT
          ENDIF
.
          COMPARE   ZERO,BKLET003
          IF        !@EQUAL
            MOVE       BKLET003,BLETPBOT
          ENDIF
.
          COMPARE   ZERO,BKLET004
          IF        !@EQUAL
            MOVE       BKLET004,BLETPTOP
          ENDIF
.
          COMPARE   ZERO,BKLET005
          IF        !@EQUAL
            MOVE       BKLET005,BLETPPAG
          ENDIF
.
          COMPARE   ZERO,BKLET006
          IF        !@EQUAL
            MOVE       BKLET006,BLETPTAB
          ENDIF
.
          MATCH     Z70,BKLET007
          IF        !@EQUAL
            MOVE       BKLET007,BLETACTV
          ENDIF
.
          MATCH     Z70,BKLET008
          IF        !@EQUAL
            MOVE       BKLET008,BLETCOMM
          ENDIF
.
MVBKLT99  RETURN
+
.------------------------------------------------------------
. Booking Letter Maintenance details
.------------------------------------------------------------
BKLTDT00  SQUEEZE   BKLET001
          MOVE      BKLET001,BLETNO
          MOVE      BKLET001,LETTNUMB
          MOVE      ZERO,BLINNO
          PACK      KEY6,BLETNO,BLINNO,SP70
          CALL      RDLET1
BKLTDT10  CALL      RDKLET1
          BRANCH    OVRCD,BKLTDT20
.
          COMPARE   BLETNO,LETTNUMB
          GOTO      BKLTDT20 IF NOT EQUAL
.
          PACK      KEY6,BLETNO,BLINNO,SP70
          CALL      DELLET1
          CALL      RDSLET1
          GOTO      BKLTDT10
.
BKLTDT20  MATCH     "D",UPDTTYPE
          GOTO      BKLTDT99 IF EQUAL
.
          COMPARE   ZERO,PTLEEND
          GOTO      BKLTDT99 IF EQUAL
.
          CALL      CLBKLT00
          MOVE      ZERO,F3
BKLTDT30  ADD       ONE,F3
          MOVE      LETTNUMB,BLETNO
          MOVE      F3,BLINNO   
          PACK      KEY6,BLETNO,BLINNO,SP70
          CALL      RDLET1
          IF        OVRCD=0
            MOVE      ZERO,BLVAR
            SCAN      SPECCHAR,PTLECOMN[F3]
            IF        @EQUAL
              MOVE      ONE,BLVAR
            ENDIF
            RESET     PTLECOMN[F3]
            MOVE      PTLECOMN[F3],BLTEXT
            CALL      UPLET1
          ELSE
            MOVE      ZERO,BLVAR
            SCAN      SPECCHAR,PTLECOMN[F3]
            IF        @EQUAL
              MOVE      ONE,BLVAR
            ENDIF
            RESET     PTLECOMN[F3]
            MOVE      PTLECOMN[F3],BLTEXT
            CALL      WRLET1
          ENDIF
.
          COMPARE   F3,PTLEEND
          GOTO      BKLTDT30 IF NOT EQUAL
.
BKLTDT99  RETURN
+
.------------------------------------------------------------
. Booking Letter Maintenance Field items
.------------------------------------------------------------
BKLT0000  BRANCH    FLDITMNO,BKLT0100,BKLT0200,BKLT0300,BKLT0400,BKLT0500:
                             BKLT0600,BKLT0700,BKLT0800,BKLT0900,BKLT1000:
                             BKLT1100
          WRITE     HTMLFILE;"Invalid Tag";
          GOTO      BKLT9999
.
BKLT0100  COMPARE   ZERO,BLETNO          * Letter Number
          GOTO      BKLT0110 IF EQUAL
          WRITE     HTMLFILE;BLETNO;
          GOTO      BKLT9999
.
BKLT0110  MOVE      ZERO,F3
          PACK      KEY6,F3,Z70
          CALL      RDSLET2
          CALL      RDPLET2
          IF        OVRCD=1
            WRITE     HTMLFILE;"  1";
          ELSE
            ADD       ONE,BLETNO
            WRITE     HTMLFILE;BLETNO;
            CALL      CLBKLT00
          ENDIF
          GOTO      BKLT9999
.
BKLT0200  MATCH     SP70,BLTEXT          * Letter Description
          GOTO      BKLT9999 IF EQUAL
          WRITE     HTMLFILE;BLTEXT;
          GOTO      BKLT9999
.
BKLT0300  WRITE     HTMLFILE;BLETPBOT;   * Bottom Margin size
          GOTO      BKLT9999
.
BKLT0400  WRITE     HTMLFILE;BLETPTOP;   * Top Margin size
          GOTO      BKLT9999
.
BKLT0500  WRITE     HTMLFILE;BLETPPAG;   * Page length    
          GOTO      BKLT9999
.
BKLT0600  WRITE     HTMLFILE;BLETPTAB;   * Left Margin size
          GOTO      BKLT9999
.
BKLT0700  CALL      BLTTAB00             * List of Booking Letters
          GOTO      BKLT9999
.
BKLT0800  SQUEEZE   BKLET001             * Letter text
          MOVE      ZERO,LETTNUMB
          MOVE      BKLET001,LETTNUMB
.
          COMPARE   ZERO,LETTNUMB
          GOTO      BKLT9999 IF EQUAL
.
          PACK      KEY6,LETTNUMB,SP2,ZERO
          CALL      RDLET1
BKLT0810  CALL      RDKLET1
          BRANCH    OVRCD,BKLT0890
.
          COMPARE   LETTNUMB,BLETNO
          GOTO      BKLT0890 IF NOT EQUAL
.
          STRIP     BLTEXT
          MOVELPTR  BLTEXT,F3
          IF        F3>0
            SFORMAT   VAR,F3
          ELSE
            SFORMAT   VAR,1
          ENDIF
          MOVE      BLTEXT,VAR
          WRITE     HTMLFILE;VAR
          SFORMAT   VAR,127
.
          GOTO      BKLT0810
.
BKLT0890  PACK      KEY6,LETTNUMB,SP2,ZERO
          CALL      RDLET1
          GOTO      BKLT9999
.
BKLT0900  WRITE     HTMLFILE;BLETACTV;   * Active
          GOTO      BKLT9999
.
BKLT1000  WRITE     HTMLFILE;FILTACTV;   * Active filter
          GOTO      BKLT9999
.
BKLT1100  WRITE     HTMLFILE;BLETCOMM; 
          GOTO      BKLT9999
.
BKLT9999  RETURN
+
.------------------------------------------------------------
. Output Table of Booking Letter Headers Details
.------------------------------------------------------------
BLTTAB00  MOVE      ZERO,F3
          PACK      KEY6,F3,SP70
          CALL      RDSLET2
BLTTAB10  CALL      RDKLET2
          BRANCH    OVRCD,BLTTAB99
.
          COMPARE   ZERO,BLINNO
          GOTO      BLTTAB99 IF NOT EQUAL
.
          MATCH     "0",FILTACTV            * Active Only
          IF        @EQUAL
            MATCH     "1",BLETACTV
            GOTO      BLTTAB10 IF EQUAL
          ENDIF
.
          MATCH     "1",FILTACTV            * Inactive Only
          IF        @EQUAL
            MATCH     "1",BLETACTV
            GOTO      BLTTAB10 IF NOT EQUAL
          ENDIF
.
          CLEAR     HTMLLINK
          APPEND    "javascript:UpdateLetter('",HTMLLINK
          APPEND    BLETNO,HTMLLINK
          APPEND    "')",HTMLLINK
          RESET     HTMLLINK
.
          MATCH     "1",BLETACTV
          IF        @EQUAL
            MOVE    "Inactive  ",ACTIDESC
          ELSE
            MOVE    "Active",ACTIDESC
          ENDIF
.
          MATCH     "1",BLETCOMM
          IF        @EQUAL
            MOVE      "Yes",COMMDESC
          ELSE
            MOVE      "No",COMMDESC
          ENDIF
.
          WRITE     HTMLFILE;"t.addRow(#"",HTMLLINK,"#",":
                             "#"",BLETNO,"#",":     * Letter number
                             "#"",BLTEXT,"#",":     * Line of letter
                             "#"",BLETPBOT,"#",":     * Bottom margin
                             "#"",BLETPTOP,"#",":     * Top margin
                             "#"",BLETPPAG,"#",":     * Page length
                             "#"",BLETPTAB,"#",":     * Left margin
                             "#"",ACTIDESC,"#",":     * Active
                             "#"",COMMDESC,"#");"     * Communication Method
.
          GOTO      BLTTAB10
.
BLTTAB99  RETURN
+
.------------------------------------------------------------
. Booking Letter Selection
.------------------------------------------------------------
BOKLTS00  MATCH     SP70,UPDTTYPE           * Dislay
          GOTO      BOKLTS50 IF EQUAL
.
          MATCH     "A",UPDTTYPE            * Add
          GOTO      BOKLTS10 IF EQUAL
.
          MATCH     "U",UPDTTYPE            * Update
          GOTO      BOKLTS20 IF EQUAL
.
          MATCH     "D",UPDTTYPE            * Delete
          GOTO      BOKLTS30 IF EQUAL
.
          GOTO      BOKLTS92
.
BOKLTS10  CALL      CLBKLS00
          PACK      KEY4,BOKLS001,SP30
          CALL      RDBKLTS1
          COMPARE   ZERO,OVRCD
          GOTO      BOKLTS90 IF EQUAL
.
          CALL      MVBKLS00
          CALL      WRBKLTS1
          CALL      RUNBLS00      * Schedule Extract
          MOVE      ZERO,EXIT
          GOTO      BOKLTS99
.
BOKLTS20  CALL      CLBKLS00
          PACK      KEY4,BOKLS001,SP30
          CALL      RDBKLTS1
          BRANCH    OVRCD,BOKLTS91
.
          CALL      MVBKLS00
          CALL      UPBKLTS1
          CALL      RUNBLS00       * Schedule Extract
          MOVE      ZERO,EXIT
          GOTO      BOKLTS99
.
BOKLTS30  PACK      KEY4,BOKLS001
          CALL      RDBKLTS1
          BRANCH    OVRCD,BOKLTS91
.
          CALL      DEBKLTS1
          CALL      DEABLL00      * Delete All letters for Selection ID  
          MOVE      ZERO,EXIT
          GOTO      BOKLTS99
.
BOKLTS50  MOVE      BOKLS001,KEY4
          CALL      RDBKLTS1
          IF        OVRCD=1
            CALL      CLBKLT00
          ENDIF
          MOVE      "Booking Letters Selection List",WEBTITLE
          CALL      WEBHED00
          BRANCH    EXIT,BOKLTS99
          CALL      WEBBOD00
          CALL      WEBEND00
          MOVE      ONE,EXIT
          GOTO      BOKLTS99
.
BOKLTS90  MOVE      "Selection Already on File",WEBTITLE
          CALL      WEBERR00
          MOVE      ONE,EXIT
          GOTO      BOKLTS99
.
BOKLTS91  MOVE      "Selection Not On File",WEBTITLE
          CALL      WEBERR00
          MOVE      ONE,EXIT
          GOTO      BOKLTS99
.
BOKLTS92  MOVE      "Invalid Update Type",WEBTITLE
          CALL      WEBERR00
          MOVE      ONE,EXIT
          GOTO      BOKLTS99
.
BOKLTS99  RETURN
+
.------------------------------------------------------------
. Clear Booking Letter selection criteria fields
.------------------------------------------------------------
CLBKLS00  MOVE      SP70,BKLSSEID
          MOVE      SP70,BKLSDESC
          MOVE      SP70,BKLSDEPS
          MOVE      SP70,BKLSSTDT
          MOVE      SP70,BKLSENDT
          MOVE      SP70,BKLSSPAR
.
CLBKLS99  RETURN
+
.------------------------------------------------------------
. Move Booking Letter selection criteria fields
.------------------------------------------------------------
MVBKLS00  MATCH     Z70,BOKLS001
          IF        !@EQUAL
            MOVE      BOKLS001,BKLSSEID
          ENDIF
.
          MATCH     Z70,BOKLS002
          IF        !@EQUAL
            MOVE      BOKLS002,BKLSDESC
          ENDIF
.
          MATCH     Z70,BOKLS003
          IF        !@EQUAL
            MOVE      BOKLS003,BKLSDEPS
          ENDIF
.
          MATCH     Z70,BOKLS004
          IF        !@EQUAL
            MOVE      BOKLS004,BKLSSTDT
          ENDIF
.
          MATCH     Z70,BOKLS005
          IF        !@EQUAL
            MOVE      BOKLS005,BKLSENDT
          ENDIF
.
MVBKLS99  RETURN
+
.------------------------------------------------------------
.                       RUNBLS00
.   Schedule Extract to be run via Program Scheduler
.------------------------------------------------------------
RUNBLS00  MOVE      "IBABOK30",SCHDPGID
          MOVE      "Run Booking Letter List",SCHDDESC
          PACK      SCHDDATE,CURRDATE,SP10  
          CLOCK     TIME,SCHDTIME
.
.         Write Keyin parameters for Extract
.
          MOVE      ONE,KEYSTARR[1]          * Adhoc Letters Option
          MOVE      ONE,KEYSTARR[2]          * Selections Option
          MOVE      BOKLS001,KEYSTARR[3]     * Extract ID
          MOVE      SP70,KEYSTARR[4]         * Enter         
          MOVE      FOUR,KEYSTCNT            * Number of Keyins
.
          CALL      SCHPRO00   * Schedule Extract
.
RUNBLS99  RETURN
+
.------------------------------------------------------------
. Delete All Booking letter for Extract ID
.------------------------------------------------------------
DEABLL00  PACK      KEY12,BOKLS001,SP70
          CALL      RSBKLTL1
          CALL      RKBKLTL1
          BRANCH    OVRCD,DEABLL99
.
          MATCH     BKLLSEID,BOKLS001
          GOTO      DEABLL99 IF NOT EQUAL
.
          PACK      KEY12,BKLLSEID,BKLLBOOK,SP70
          CALL      DEBKLTL1
          GOTO      DEABLL00
.
DEABLL99  RETURN
+
.------------------------------------------------------------
. Print Booking Letter Selection Field items
.------------------------------------------------------------
BKLS0000  BRANCH    FLDITMNO,BKLS0100,BKLS0200,BKLS0300,BKLS0400,BKLS0500:
                             BKLS0600,BKLS0700,BKLS0800,BKLS0900,BKLS1000:
                             BKLS1100
          WRITE     HTMLFILE;"Invalid Tag";
          GOTO      BKLT9999
.
BKLS0100  MATCH     SP70,BKLSSEID         * Selection ID
          GOTO      BKLS9999 IF EQUAL
          WRITE     HTMLFILE;BKLSSEID;
          GOTO      BKLS9999
.
BKLS0200  MATCH     SP70,BKLSDESC         * Selection Description
          GOTO      BKLS9999 IF EQUAL
          WRITE     HTMLFILE;BKLSDESC;
          GOTO      BKLS9999
.
BKLS0300  MATCH     SP70,BKLSDEPS         * Deposit paid
          GOTO      BKLS9999 IF EQUAL
          WRITE     HTMLFILE;BKLSDEPS;
          GOTO      BKLS9999
.
BKLS0400  MATCH     SP70,BKLSSTDT         * Start date  
          GOTO      BKLS9999 IF EQUAL
          UNPACK    BKLSSTDT,CCENT,CYEAR,CMON,CDAY   * To Date in (DD MON CCYY)
          MOVE      CMON,F2
          LOAD      MTHNAM3,F2,JAN,FEB,MAR,APR,MAY,JUN,JUL,AUG,SEP,OCT,NOV,DEC
          PACK      KEY12,CDAY,SP1,MTHNAM3,SP1,CCENT,CYEAR
          WRITE     HTMLFILE;KEY12;
          GOTO      BKLS9999
.
BKLS0500  MATCH     Z70,BKLSENDT         * End date    
          GOTO      BKLS9999 IF EQUAL
          UNPACK    BKLSENDT,CCENT,CYEAR,CMON,CDAY   * To Date in (DD MON CCYY)
          MOVE      CMON,F2
          LOAD      MTHNAM3,F2,JAN,FEB,MAR,APR,MAY,JUN,JUL,AUG,SEP,OCT,NOV,DEC
          PACK      KEY12,CDAY,SP1,MTHNAM3,SP1,CCENT,CYEAR
          WRITE     HTMLFILE;KEY12;
          GOTO      BKLS9999
.
BKLS0600  CALL      LSTBLS00             * List of Selection Criteria
          GOTO      BKLS9999
.
BKLS0700  MOVE      ZERO,RECTOTAL        * Number of extracted records
          PACK      KEY12,BOKLS001,SP70
          CALL      RSBKLTL1
BKLS0710  CALL      RKBKLTL1
          BRANCH    OVRCD,BKLS0720

          MATCH     BOKLS001,BKLLSEID
          GOTO      BKLS0720 IF NOT EQUAL

          ADD       ONE,RECTOTAL
          GOTO      BKLS0710
.
BKLS0720  WRITE     HTMLFILE;RECTOTAL;
          GOTO      BKLS9999
.
BKLS0800  CALL      DISBLL00             * list of extract
          GOTO      BKLS9999
.
BKLS0900  CALL      PREVBL00             * previous page  
          GOTO      BKLS9999
.
BKLS1000  CALL      NEXTBL00             * Next page        
          GOTO      BKLS9999
.
BKLS1100  CALL      SELBLT00             * letter type selection list
          GOTO      BKLS9999
.
BKLS9999  RETURN
+
.------------------------------------------------------------
. List of Booking Letter Selection Criteria
.------------------------------------------------------------
LSTBLS00  MOVE      SP70,KEY4
          CALL      RSBKLTS1
LSTBLS10  CALL      RKBKLTS1
          BRANCH    OVRCD,LSTBLS99
.
          CLEAR     HTMLLINK
          APPEND    "javascript:UpdateItem('",HTMLLINK
          APPEND    BKLSSEID,HTMLLINK
          APPEND    "')",HTMLLINK
          RESET     HTMLLINK
.
          MOVE      SP70,KEY3
          MATCH     "N",BKLSDEPS
          IF        @EQUAL
            MOVE      "No",KEY3
          ENDIF
          MATCH     "Y",BKLSDEPS
          IF        @EQUAL
            MOVE      "Yes",KEY3
          ENDIF
.
          MATCH     BKLSSTDT,SP70
          IF        @EQUAL
            PACK      DISPDATE,SP1
          ELSE
            UNPACK    BKLSSTDT,CCENT,CYEAR,CMON,CDAY
            MOVE      CMON,F2
            LOAD      MTHNAM3,F2,JAN,FEB,MAR,APR,MAY,JUN,JUL,AUG,SEP,OCT,NOV,DEC
            PACK      DISPDATE,CDAY,SP1,MTHNAM3,SP1,CCENT,CYEAR
          ENDIF
.
          MATCH     BKLSENDT,SP70
          IF        @EQUAL
            PACK      DISPDAT2,SP1
          ELSE
            UNPACK    BKLSENDT,CCENT,CYEAR,CMON,CDAY
            MOVE      CMON,F2
            LOAD      MTHNAM3,F2,JAN,FEB,MAR,APR,MAY,JUN,JUL,AUG,SEP,OCT,NOV,DEC
            PACK      DISPDAT2,CDAY,SP1,MTHNAM3,SP1,CCENT,CYEAR
          ENDIF
.
          WRITE     HTMLFILE;"t.addRow(#"",HTMLLINK,"#",":
                             "#"",BKLSSEID,"#",":
                             "#"",BKLSDESC,"#",":
                             "#"",KEY3,"#",":
                             "#"",DISPDATE,"#",":
                             "#"",DISPDAT2,"#",":
                             "#"",BKLSSTDT,"#",":
                             "#"",BKLSENDT,"#");"
.
          GOTO      LSTBLS10
.
LSTBLS99  RETURN
+
.------------------------------------------------------------
. Selected Booking Letter List
.------------------------------------------------------------
DISBLL00  UNPACK    DIM127,D1,LINKPRG,DIM127
          UNPACK    DIM127,D1,LINKREP,DIM127
          UNPACK    DIM127,D1,LINKTEM,DIM127
.
          CALL      BLLHED00              * Booking Letter List Table Heading
.
          IF        NORECORD=0
            MOVE      PTCNNRTD,NORECORD     * Set Default No Records to Display
          ENDIF
          MOVE      ZERO,RECNUMB
          MOVE      ZERO,DISNUMB
.
          MOVE      BOKLS001,KEY4
          CALL      RDBKLTS1
          BRANCH    OVRCD,DISBLL90
.
          PACK      KEY12,BOKLS001,SP70
          CALL      RSBKLTL1
DISBLL10  CALL      RKBKLTL1
          BRANCH    OVRCD,DISBLL95
.
          MATCH     BOKLS001,BKLLSEID
          GOTO      DISBLL95 IF NOT EQUAL
.
          ADD       ONE,RECNUMB
          IF        STARTNUM>=RECNUMB
            GOTO      DISBLL10
          ENDIF
.
          CALL      BLLROW00
          ADD       ONE,DISNUMB
          COMPARE   NORECORD,DISNUMB
          GOTO      DISBLL10 IF NOT EQUAL
          GOTO      DISBLL99
.
DISBLL90  MOVE      "Invalid Selection ID",WEBTITLE
          CALL      WEBERR00
          MOVE      ONE,EXIT
          GOTO      DISBLL99
.
DISBLL95  CALL      NOMORE00          * Display No More Records Message
.
DISBLL99  RETURN
.------------------------------------------------------------
.  Table Selected Booking Letter (TABLE HEADING)
.------------------------------------------------------------
BLLHED00  WRITE     HTMLFILE;"<tr>":
                              "<td class=HeadingCell>Patient</td>":
       "<td class=HeadingCell width=15%>Booking Number</td>":
       "<td class=HeadingCell width=15%>Booking Date</td>":
       "<td class=HeadingCell width=15%>Deposit Paid</td>":
       "<td class=HeadingCell width=15% align=center>Deleted</td>":
                             "</tr>"
.
BLLHED999  RETURN
.------------------------------------------------------------
. Read Selected Booking Letter details and write the
. Selected Booking letter row to HTMLFILE
.------------------------------------------------------------
BLLROW00  PACK      KEY8,BKLLBOOK,SP70
          CALL      RDBKREC1                      * read booking record
          BRANCH    OVRCD,BLLROW99
.
          UNPACK    BKREEDAT,CCENT,CYEAR,CMON,CDAY
          MOVE      CMON,F2
          LOAD      MTHNAM3,F2,JAN,FEB,MAR,APR,MAY,JUN,JUL,AUG,SEP,OCT,NOV,DEC
          PACK      DISPDATE,CDAY,SP1,MTHNAM3,SP1,CCENT,CYEAR
.
          MOVE      NBSP,KEY6
          MATCH     "N",BKREPREA
          IF        @EQUAL
            MOVE      "No",KEY6
          ENDIF
          MATCH     "Y",BKREPREA
          IF        @EQUAL
            MOVE      "Yes",KEY6
          ENDIF
.
          PACK      KEY8,BKREURNO,SP70
          CALL      RDMAST1
          IF        OVRCD=1
            MOVE      "Invalid U/R",FORMATNM
          ELSE
            MOVE      BKREURNO,URNUMBER
            IF        PCEASE=1
              MOVE      PDECDTE,AGEDATE            * Date of Death
            ELSE
              PACK      AGEDATE,CURRDATE,SP10      * Today's date
            ENDIF
            REP       " 0",AGEDATE
            CALL      CALCAGE
            CALL      PATLN000
          ENDIF
.
BLLROW50  MOVE      BKREBOOK,ADMISSNO
          REP       " +",ADMISSNO
          REP       " +",URNUMBER
.
          WRITE     HTMLFILE;"<td nowrap><A HREF=",LINKPRG,".pbl":
                             "?reportno=",LINKREP:
                             "&template=",LINKTEM:
                             "&urnumber=",URNUMBER:
                             "&admissno=",ADMISSNO,">":
                              "<img src=../images/MaintenanceIcon.gif hspace=4":
                              " border=0 align=absmiddle></a>":
                              FORMATNM,"</td>":
                              "<td>",BKREBOOK,"</td>":
                              "<td>",DISPDATE,"</td>":
                              "<td align=right>",KEY6,"</td>";
.
          REP       "+ ",URNUMBER
          REP       "+ ",ADMISSNO
          MOVE      TWO,EXTRTYPE
          MATCH     "1",BKLLSTAT
          IF        @EQUAL
            WRITE     HTMLFILE;"<td  align=center><input type=checkbox":
                               " name=bokls007 value=1":
                               " onclick=#"DeletePatient39(this":
                               ",'",BKLLSEID,"','",BKLLBOOK,"'":
                               ");#" checked></td>";
          ELSE
            WRITE     HTMLFILE;"<td align=center><input type=checkbox":
                               " name=bokls007 value=1":
                               " onclick=#"DeletePatient39(this":
                               ",'",BKLLSEID,"','",BKLLBOOK,"'":
                               ");#"></td>";
          ENDIF
.
          WRITE     HTMLFILE;"</tr>"
.
BLLROW99  RETURN
+
.-----------------------------------------------------------
. Link to Next Group of booking letter
.-----------------------------------------------------------
NEXTBL00  MOVE      NORECORD,KEY2
          REP       " +",KEY2
          ASSIGN    STARTNUM+NORECORD,F3
          MOVE      F3,KEY3
          REP       " +",KEY3
          UNPACK    DIM127,D1,FLDPARA,DIM127
          MOVE      REPORTNO,F2
          REP       " +",BOKLS001
.
          WRITE     HTMLFILE;"patweb87.pbl":
                                 "?reportno=",F2:
                                 "&template=",FLDPARA:
                                 "&startnum=",KEY3:
                                 "&norecord=",KEY2:
                                 "&bokls001=",BOKLS001;
.
          REP       "+ ",BOKLS001
.
NEXTBL99  RETURN
+
.-------------------------------------------------------------
. Link to Prev Group of booking letter
.-------------------------------------------------------------
PREVBL00  MOVE      NORECORD,KEY2
          REP       " +",KEY2
          ASSIGN    STARTNUM-NORECORD,F3
          IF        F3<0
            MOVE      ZERO,F3
          ENDIF
          MOVE      F3,KEY3
          REP       " +",KEY3
          UNPACK    DIM127,D1,FLDPARA,DIM127
          MOVE      REPORTNO,F2
          REP       " +",BOKLS001
.
          WRITE     HTMLFILE;"patweb87.pbl":
                                 "?reportno=",F2:
                                 "&template=",FLDPARA:
                                 "&startnum=",KEY3:
                                 "&norecord=",KEY2:
                                 "&bokls001=",BOKLS001;
.
          REP       "+ ",BOKLS001
.
PREVBL99  RETURN
+
.------------------------------------------------------------
. Booking Letters Type
.------------------------------------------------------------
SELBLT00  PACK      KEY6,SP2,ZERO,SP3
          CALL      RDSLET2
SELBLT10  CALL      RDKLET2
          BRANCH    OVRCD,SELBLT99

          COMPARE   ZERO,BLINNO               * header line ?
          GOTO      SELBLT10 IF NOT EQUAL       * no
.
          PACK      KEY25,BLTEXT,SP30
          PACK      KEY8,QUOTE,DBLETNO,QUOTE
.
          MATCH     DBLETNO,CODE
          IF        @EQUAL
             WRITE     HTMLFILE;"<option value=",KEY8," selected>":
                    "(",DBLETNO,") ",KEY25,"</option>"
          ELSE
            MATCH     "1",BLETACTV                 * Skip Inactive
            GOTO      SELBLT10 IF EQUAL
.
             WRITE     HTMLFILE;"<option value=",KEY8,">":
                    "(",DBLETNO,") ",KEY25,"</option>"
          ENDIF
.
          GOTO      SELBLT10
.
SELBLT99  RETURN
.------------------------------------------------------------
. Delete Booking Letter Indicator Update
.------------------------------------------------------------
DELBLL00  CALL      XMLHED00
          BRANCH    EXIT,DELBLL99
.
DELBLL10  PACK      KEY4,BOKLS001,SP70
          CALL      RDBKLTS1
          BRANCH    OVRCD,DELBLL90
.
          PACK      KEY12,BOKLS001,BOKLS006,SP70
          CALL      RDBKLTL1
          BRANCH    OVRCD,DELBLL90
.
          MOVE      BOKLS007,BKLLSTAT
          CALL      UPBKLTL1
.
          WRITE     HTMLFILE;"<RETURN_VALUE TYPE=SIMPLE>":
                             "Update Complete":
                             "</RETURN_VALUE>"
          GOTO      DELBLL95
.
DELBLL90  WRITE     HTMLFILE;"<RETURN_VALUE TYPE=ERROR>":
                             "Invalid Booking Selection":
                             "</RETURN_VALUE>"
.
DELBLL95  CALL      XMLEND00
.
DELBLL99  RETURN
+
.------------------------------------------------------------
. Private Practice Set Up General Letters Maintenance 
.------------------------------------------------------------
.
PRILET00  CALL      CLPRILET
          MATCH     SP70,UPDTTYPE      * Display formactn
          GOTO      PRILET40 IF EQUAL
.
          MATCH     "A",UPDTTYPE       * Add formactn
          GOTO      PRILET10 IF EQUAL
.
          MATCH     "U",UPDTTYPE       * Update formactn
          GOTO      PRILET20 IF EQUAL
.
          MATCH     "D",UPDTTYPE       * Delete formactn
          GOTO      PRILET30 IF EQUAL
.
          MOVE      "Invalid Update Type",WEBTITLE
          CALL      WEBERR00
          GOTO      PRILET99
.
.         ********* ADD FORMACTN *********
.
PRILET10  CALL      APRLET00
          GOTO      PRILET99
.
.         ********* UPDATE FORMACTN *********
.
PRILET20  CALL      UPRLET00
          GOTO      PRILET99
.
.         ********* DELETE FORMACTN *********
.
PRILET30  CALL      DPRLET00
          GOTO      PRILET99
.
.         ********* DISPLAY FORMACTN *********
.
PRILET40  SQUEEZE   PRLET001
          MOVE      PRLET001,F3
          MOVE      F3,KEY3
          MOVE      ZERO,F3
          PACK      KEY6,KEY3,F3
          CALL      RDPRLE1 
          IF        OVRCD=1
            CALL      CLPRILET         * Clear variables
          ENDIF
.
          MOVE      "Private Practice Set Up General Letters",WEBTITLE
          CALL      WEBHED00
          BRANCH    EXIT,PRILET99
          CALL      WEBBOD00
          CALL      WEBEND00
.
PRILET99  RETURN
.
.----------------------------------------------------------------
. Clear Private Practice General Letter variables
.----------------------------------------------------------------
.
CLPRILET  MOVE      ZERO,PRLENUMB      * Letter number
          MOVE      ZERO,PRLELINE      * Line number for letter
          MOVE      SP70,PRLETEXT      * Line of letter
          MOVE      ZERO,PRLEVARB      * Variable present 1=yes 2=no
          MOVE      ZERO,PRLEMBOT      * Letter bottom margin
          MOVE      ZERO,PRLEMTOP      * Letter top margin
          MOVE      ZERO,PRLEPLEN      * Physical pager length (no. of lines)
          MOVE      ZERO,PRLELEFT      * Letter left margin
          MOVE      SP70,PRLETSPA      * Spare variable
          RETURN
+
.------------------------------------------------------------
. Add Letter
.------------------------------------------------------------
APRLET00  CALL      CLPRILET
          SQUEEZE   PRLET001
          MOVE      PRLET001,PRLENUMB
          MOVE      ZERO,PRLELINE
          PACK      KEY6,PRLENUMB,PRLELINE,SP70
          CALL      RDPRLE1 
          IF        OVRCD=1
            CALL      MVPRL000
            CALL      WRPRLE1 
            CALL      PRLDET00  * Update Letter Details
            CALL      WINCLS00
          ELSE
            MOVE      "Letter Already on File",WEBTITLE
            CALL      WEBERR00
          ENDIF
          RETURN
.------------------------------------------------------------
. Update Extract
.------------------------------------------------------------
UPRLET00  CALL      CLPRILET
          SQUEEZE   PRLET001
          MOVE      PRLET001,PRLENUMB
          MOVE      ZERO,PRLELINE
          PACK      KEY6,PRLENUMB,PRLELINE,SP70
          CALL      RDPRLE1 
          IF        OVRCD=0
            CALL      MVPRL000
            CALL      UPPRLE1 
            CALL      PRLDET00  * Update Letter Details
            CALL      WINCLS00
          ELSE
            MOVE      "Extract Not On File",WEBTITLE
            CALL      WEBERR00
          ENDIF
          RETURN
.------------------------------------------------------------
. Delete Extract
.------------------------------------------------------------
DPRLET00  SQUEEZE   PRLET001
          MOVE      PRLET001,PRLENUMB
          MOVE      ZERO,PRLELINE
          PACK      KEY6,PRLENUMB,PRLELINE,SP70
          CALL      RDPRLE1 
          IF        OVRCD=0
            CALL      DEPRLE1 
            CALL      PRLDET00
            CALL      WINCLS00
          ELSE
            MOVE      "Extract Not On File",WEBTITLE
            CALL      WEBERR00
          ENDIF
          RETURN
.
.------------------------------------------------------------
. Move in Private Practice Set Up General Letter Details
.------------------------------------------------------------
MVPRL000  MATCH     Z70,PRLET001
          IF        !@EQUAL
            SQUEEZE    PRLET001
            MOVE       PRLET001,PRLENUMB
          ENDIF
.
          MATCH     Z70,PRLET002
          IF        !@EQUAL
            MOVE       PRLET002,PRLETEXT
          ENDIF
.
          COMPARE   ZERO,PRLET003
          IF        !@EQUAL
            MOVE       PRLET003,PRLEMBOT
          ENDIF
.
          COMPARE   ZERO,PRLET004
          IF        !@EQUAL
            MOVE       PRLET004,PRLEMTOP
          ENDIF
.
          COMPARE   ZERO,PRLET005
          IF        !@EQUAL
            MOVE       PRLET005,PRLEPLEN
          ENDIF
.
          COMPARE   ZERO,PRLET006
          IF        !@EQUAL
            MOVE       PRLET006,PRLELEFT
          ENDIF
.
          RETURN
.------------------------------------------------------------
. Private Practice Set Up General Letter Maintenance details
.------------------------------------------------------------
PRLDET00  SQUEEZE   PRLET001
          MOVE      PRLET001,PRLENUMB
          MOVE      PRLET001,LETTNUMB
          MOVE      ZERO,PRLELINE
          PACK      KEY6,PRLENUMB,PRLELINE,SP70
          CALL      RDPRLE1 
PRLDET10  CALL      RKPRLE1 
          BRANCH    OVRCD,PRLDET20
.
          COMPARE   PRLENUMB,LETTNUMB
          GOTO      PRLDET20 IF NOT EQUAL
.
          PACK      KEY6,PRLENUMB,PRLELINE,SP70
          CALL      DEPRLE1 
          CALL      RSPRLE1 
          GOTO      PRLDET10
.
PRLDET20  MATCH     "D",UPDTTYPE
          GOTO      PRLDET99 IF EQUAL
.
          COMPARE   ZERO,PTLEEND
          GOTO      PRLDET99 IF EQUAL
.
          CALL      CLPRILET
          MOVE      ZERO,F3
PRLDET30  ADD       ONE,F3
          MOVE      LETTNUMB,PRLENUMB
          MOVE      F3,PRLELINE
          PACK      KEY6,PRLENUMB,PRLELINE,SP70
          CALL      RDPRLE1 
          IF        OVRCD=0
            MOVE      ZERO,PRLEVARB
            SCAN      SPECCHAR,PTLECOMN[F3]
            IF        @EQUAL
              MOVE      ONE,PRLEVARB
            ENDIF
            RESET     PTLECOMN[F3]
            MOVE      PTLECOMN[F3],PRLETEXT
            CALL      UPPRLE1  
          ELSE
            MOVE      ZERO,PRLEVARB
            SCAN      SPECCHAR,PTLECOMN[F3]
            IF        @EQUAL
              MOVE      ONE,PRLEVARB
            ENDIF
            RESET     PTLECOMN[F3]
            MOVE      PTLECOMN[F3],PRLETEXT
            CALL      WRPRLE1 
          ENDIF
.
          COMPARE   F3,PTLEEND
          GOTO      PRLDET30 IF NOT EQUAL
.
PRLDET99  RETURN
+
.------------------------------------------------------------
. Private Practice Set Up General Letter Maintenance Field items
.------------------------------------------------------------
PRLE0000  BRANCH    FLDITMNO,PRLE0100,PRLE0200,PRLE0300,PRLE0400,PRLE0500:
                             PRLE0600,PRLE0700,PRLE0800         
          WRITE     HTMLFILE;"Invalid Tag";
          GOTO      PRLE9999
.
PRLE0100  COMPARE   ZERO,PRLENUMB
          GOTO      PRLE0110 IF EQUAL
          WRITE     HTMLFILE;PRLENUMB;
          GOTO      PRLE9999
.
PRLE0110  MOVE      ZERO,F3
          PACK      KEY6,F3,Z70
          CALL      RSPRLE2 
          CALL      RPPRLE2 
          IF        OVRCD=1
            WRITE     HTMLFILE;"  1";
          ELSE
            ADD       ONE,PRLENUMB
            WRITE     HTMLFILE;PRLENUMB;
            CALL      CLPRILET
          ENDIF
          GOTO      PRLE9999
.
PRLE0200  MATCH     SP70,PRLETEXT
          GOTO      PRLE9999 IF EQUAL
          WRITE     HTMLFILE;PRLETEXT;
          GOTO      PRLE9999
.
PRLE0300  WRITE     HTMLFILE;PRLEMBOT;
          GOTO      PRLE9999
.
PRLE0400  WRITE     HTMLFILE;PRLEMTOP;
          GOTO      PRLE9999
.
PRLE0500  WRITE     HTMLFILE;PRLEPLEN;
          GOTO      PRLE9999
.
PRLE0600  WRITE     HTMLFILE;PRLELEFT;
          GOTO      PRLE9999
.
PRLE0700  CALL      PRLTAB00
          GOTO      PRLE9999
.
PRLE0800  SQUEEZE   PRLET001
          MOVE      ZERO,LETTNUMB
          MOVE      PRLET001,LETTNUMB
.
          COMPARE   ZERO,LETTNUMB
          GOTO      PRLE9999 IF EQUAL
.
          PACK      KEY6,LETTNUMB,SP2,ZERO
          CALL      RDPRLE1 
PRLE0810  CALL      RKPRLE1 
          BRANCH    OVRCD,PRLE0890
.
          COMPARE   LETTNUMB,PRLENUMB
          GOTO      PRLE0890 IF NOT EQUAL
.
          STRIP     PRLETEXT
          MOVELPTR  PRLETEXT,F3
          IF        F3>0
            SFORMAT   VAR,F3
          ELSE
            SFORMAT   VAR,1
          ENDIF
          MOVE      PRLETEXT,VAR
          WRITE     HTMLFILE;VAR
          SFORMAT   VAR,127
.
          GOTO      PRLE0810
.
PRLE0890  PACK      KEY6,LETTNUMB,SP2,ZERO
          CALL      RDPRLE1 
          GOTO      PRLE9999
.
PRLE9999  RETURN
+
.------------------------------------------------------------
. Output Table of Private Practice Set Up General Letter Headers Details
.------------------------------------------------------------
PRLTAB00  MOVE      ZERO,F3
          PACK      KEY6,F3,SP70
          CALL      RSPRLE2 
PRLTAB10  CALL      RKPRLE2 
          BRANCH    OVRCD,PRLTAB99
.
          COMPARE   ZERO,PRLELINE
          GOTO      PRLTAB99 IF NOT EQUAL
.
          CLEAR     HTMLLINK
          APPEND    "javascript:UpdateLetter('",HTMLLINK
          APPEND    PRLENUMB,HTMLLINK
          APPEND    "')",HTMLLINK
          RESET     HTMLLINK
          WRITE     HTMLFILE;"t.addRow(#"",HTMLLINK,"#",":
                             "#"",PRLENUMB,"#",":     * Letter number
                             "#"",PRLETEXT,"#",":     * Line of letter
                             "#"",PRLEMBOT,"#",":     * Bottom margin
                             "#"",PRLEMTOP,"#",":     * Top margin
                             "#"",PRLEPLEN,"#",":     * Page length
                             "#"",PRLELEFT,"#");"     * Left margin
.
          GOTO      PRLTAB10
.
PRLTAB99  RETURN
+
.------------------------------------------------------------
. Private Practice Set Up Financial Letters Maintenance 
.------------------------------------------------------------
.
PRIFLT00  CALL      CLPRIFLT
          MATCH     SP70,UPDTTYPE      * Display formactn
          GOTO      PRIFLT40 IF EQUAL
.
          MATCH     "A",UPDTTYPE       * Add formactn
          GOTO      PRIFLT10 IF EQUAL
.
          MATCH     "U",UPDTTYPE       * Update formactn
          GOTO      PRIFLT20 IF EQUAL
.
          MATCH     "D",UPDTTYPE       * Delete formactn
          GOTO      PRIFLT30 IF EQUAL
.
          MOVE      "Invalid Update Type",WEBTITLE
          CALL      WEBERR00
          GOTO      PRIFLT99
.
.         ********* ADD FORMACTN *********
.
PRIFLT10  CALL      APRFLT00
          GOTO      PRIFLT99
.
.         ********* UPDATE FORMACTN *********
.
PRIFLT20  CALL      UPRFLT00
          GOTO      PRIFLT99
.
.         ********* DELETE FORMACTN *********
.
PRIFLT30  CALL      DPRFLT00
          GOTO      PRIFLT99
.
.         ********* DISPLAY FORMACTN *********
.
PRIFLT40  SQUEEZE   PRFLT001
          MOVE      PRFLT001,F3
          MOVE      F3,KEY3
          MOVE      ZERO,F3
          PACK      KEY6,KEY3,F3
          CALL      RDPRFL1 
          IF        OVRCD=1
            CALL      CLPRIFLT         * Clear variables
          ENDIF
.
          MOVE      "Private Practice Set Up Financial Letters",WEBTITLE
          CALL      WEBHED00
          BRANCH    EXIT,PRIFLT99
          CALL      WEBBOD00
          CALL      WEBEND00
.
PRIFLT99  RETURN
.
.----------------------------------------------------------------
. Clear Private Practice Financial Letter variables
.----------------------------------------------------------------
.
CLPRIFLT  MOVE      ZERO,PRFLNUMB      * Letter number
          MOVE      ZERO,PRFLLINE      * Line number for letter
          MOVE      SP70,PRFLTEXT      * Line of letter
          MOVE      ZERO,PRFLVARB      * Variable present 1=yes 2=no
          MOVE      ZERO,PRFLMBOT      * Letter bottom margin
          MOVE      ZERO,PRFLMTOP      * Letter top margin
          MOVE      ZERO,PRFLPLEN      * Physical pager length (no. of lines)
          MOVE      ZERO,PRFLLEFT      * Letter left margin
          MOVE      SP70,PRLETSPA      * Spare variable
          RETURN
+
.------------------------------------------------------------
. Add Private Practice Financial Letter
.------------------------------------------------------------
APRFLT00  CALL      CLPRIFLT
          SQUEEZE   PRFLT001
          MOVE      PRFLT001,PRFLNUMB
          MOVE      ZERO,PRFLLINE
          PACK      KEY6,PRFLNUMB,PRFLLINE,SP70
          CALL      RDPRFL1 
          IF        OVRCD=1
            CALL      MVPRF000
            CALL      WRPRFL1 
            CALL      PRFDET00  * Update Letter Details
            CALL      WINCLS00
          ELSE
            MOVE      "Letter Already on File",WEBTITLE
            CALL      WEBERR00
          ENDIF
.
APRFLT99  RETURN
.------------------------------------------------------------
. Update Private Practice Financial Letter
.------------------------------------------------------------
UPRFLT00  CALL      CLPRIFLT
          SQUEEZE   PRFLT001
          MOVE      PRFLT001,PRFLNUMB
          MOVE      ZERO,PRFLLINE
          PACK      KEY6,PRFLNUMB,PRFLLINE,SP70
          CALL      RDPRFL1 
          IF        OVRCD=0
            CALL      MVPRF000
            CALL      UPPRFL1 
            CALL      PRFDET00  * Update Letter Details
            CALL      WINCLS00
          ELSE
            MOVE      "Extract Not On File",WEBTITLE
            CALL      WEBERR00
          ENDIF
.
UPRFLT99  RETURN
.------------------------------------------------------------
. Delete Private Practice Financial Letter
.------------------------------------------------------------
DPRFLT00  SQUEEZE   PRFLT001
          MOVE      PRFLT001,PRFLNUMB
          MOVE      ZERO,PRFLLINE
          PACK      KEY6,PRFLNUMB,PRFLLINE,SP70
          CALL      RDPRFL1 
          IF        OVRCD=0
            CALL      DEPRFL1 
            CALL      PRFDET00
            CALL      WINCLS00
          ELSE
            MOVE      "Extract Not On File",WEBTITLE
            CALL      WEBERR00
          ENDIF
.
DPRFLT99  RETURN
.
.------------------------------------------------------------
. Move in Private Practice Set Up Financial Letter Details
.------------------------------------------------------------
MVPRF000  MATCH     Z70,PRFLT001
          IF        !@EQUAL
            SQUEEZE    PRFLT001
            MOVE       PRFLT001,PRFLNUMB
          ENDIF
.
          MATCH     Z70,PRFLT002
          IF        !@EQUAL
            MOVE       PRFLT002,PRFLTEXT
          ENDIF
.
          COMPARE   ZERO,PRFLT003
          IF        !@EQUAL
            MOVE       PRFLT003,PRFLMBOT
          ENDIF
.
          COMPARE   ZERO,PRFLT004
          IF        !@EQUAL
            MOVE       PRFLT004,PRFLMTOP
          ENDIF
.
          COMPARE   ZERO,PRFLT005
          IF        !@EQUAL
            MOVE       PRFLT005,PRFLPLEN
          ENDIF
.
          COMPARE   ZERO,PRFLT006
          IF        !@EQUAL
            MOVE       PRFLT006,PRFLLEFT
          ENDIF
.
MVPRF999  RETURN
.------------------------------------------------------------
. Private Practice Set Up Financial Letter Maintenance details
.------------------------------------------------------------
PRFDET00  SQUEEZE   PRFLT001
          MOVE      PRFLT001,PRFLNUMB
          MOVE      PRFLT001,LETTNUMB
          MOVE      ZERO,PRFLLINE
          PACK      KEY6,PRFLNUMB,PRFLLINE,SP70
          CALL      RDPRFL1 
PRFDET10  CALL      RKPRFL1 
          BRANCH    OVRCD,PRFDET20
.
          COMPARE   PRFLNUMB,LETTNUMB
          GOTO      PRFDET20 IF NOT EQUAL
.
          PACK      KEY6,PRFLNUMB,PRFLLINE,SP70
          CALL      DEPRFL1 
          CALL      RSPRFL1 
          GOTO      PRFDET10
.
PRFDET20  MATCH     "D",UPDTTYPE
          GOTO      PRFDET99 IF EQUAL
.
          COMPARE   ZERO,PTLEEND
          GOTO      PRFDET99 IF EQUAL
.
          CALL      CLPRIFLT
          MOVE      ZERO,F3
PRFDET30  ADD       ONE,F3
          MOVE      LETTNUMB,PRFLNUMB
          MOVE      F3,PRFLLINE
          PACK      KEY6,PRFLNUMB,PRFLLINE,SP70
          CALL      RDPRFL1 
          IF        OVRCD=0
            MOVE      ZERO,PRFLVARB
            SCAN      SPECCHAR,PTLECOMN[F3]
            IF        @EQUAL
              MOVE      ONE,PRFLVARB
            ENDIF
            RESET     PTLECOMN[F3]
            MOVE      PTLECOMN[F3],PRFLTEXT
            CALL      UPPRFL1  
          ELSE
            MOVE      ZERO,PRFLVARB
            SCAN      SPECCHAR,PTLECOMN[F3]
            IF        @EQUAL
              MOVE      ONE,PRFLVARB
            ENDIF
            RESET     PTLECOMN[F3]
            MOVE      PTLECOMN[F3],PRFLTEXT
            CALL      WRPRFL1 
          ENDIF
.
          COMPARE   F3,PTLEEND
          GOTO      PRFDET30 IF NOT EQUAL
.
PRFDET99  RETURN
+
.------------------------------------------------------------
. Private Practice Set Up Financial Letter Maintenance Field items
.------------------------------------------------------------
PPFL0000  BRANCH    FLDITMNO,PPFL0100,PPFL0200,PPFL0300,PPFL0400,PPFL0500:
                             PPFL0600,PPFL0700,PPFL0800         
          WRITE     HTMLFILE;"Invalid Tag";
          GOTO      PPFL9999
.
PPFL0100  COMPARE   ZERO,PRFLNUMB
          GOTO      PPFL0110 IF EQUAL
          WRITE     HTMLFILE;PRFLNUMB;
          GOTO      PPFL9999
.
PPFL0110  MOVE      ZERO,F3
          PACK      KEY6,F3,Z70
          CALL      RSPRFL2 
          CALL      RPPRFL2 
          IF        OVRCD=1
            WRITE     HTMLFILE;"  1";
          ELSE
            ADD       ONE,PRFLNUMB
            WRITE     HTMLFILE;PRFLNUMB;
            CALL      CLPRIFLT
          ENDIF
          GOTO      PPFL9999
.
PPFL0200  MATCH     SP70,PRFLTEXT
          GOTO      PPFL9999 IF EQUAL
          WRITE     HTMLFILE;PRFLTEXT;
          GOTO      PPFL9999
.
PPFL0300  WRITE     HTMLFILE;PRFLMBOT;
          GOTO      PPFL9999
.
PPFL0400  WRITE     HTMLFILE;PRFLMTOP;
          GOTO      PPFL9999
.
PPFL0500  WRITE     HTMLFILE;PRFLPLEN;
          GOTO      PPFL9999
.
PPFL0600  WRITE     HTMLFILE;PRFLLEFT;
          GOTO      PPFL9999
.
PPFL0700  CALL      PPFTAB00
          GOTO      PPFL9999
.
PPFL0800  SQUEEZE   PRFLT001
          MOVE      ZERO,LETTNUMB
          MOVE      PRFLT001,LETTNUMB
.
          COMPARE   ZERO,LETTNUMB
          GOTO      PPFL9999 IF EQUAL
.
          PACK      KEY6,LETTNUMB,SP2,ZERO
          CALL      RDPRFL1 
PPFL0810  CALL      RKPRFL1 
          BRANCH    OVRCD,PPFL0890
.
          COMPARE   LETTNUMB,PRFLNUMB
          GOTO      PPFL0890 IF NOT EQUAL
.
          STRIP     PRFLTEXT
          MOVELPTR  PRFLTEXT,F3
          IF        F3>0
            SFORMAT   VAR,F3
          ELSE
            SFORMAT   VAR,1
          ENDIF
          MOVE      PRFLTEXT,VAR
          WRITE     HTMLFILE;VAR
          SFORMAT   VAR,127
.
          GOTO      PPFL0810
.
PPFL0890  PACK      KEY6,LETTNUMB,SP2,ZERO
          CALL      RDPRFL1 
          GOTO      PPFL9999
.
PPFL9999  RETURN
+
.------------------------------------------------------------
. Output Table of Private Practice Set Up Financial Letter Headers Details
.------------------------------------------------------------
PPFTAB00  MOVE      ZERO,F3
          PACK      KEY6,F3,SP70
          CALL      RSPRFL2 
PPFTAB10  CALL      RKPRFL2 
          BRANCH    OVRCD,PPFTAB99
.
          COMPARE   ZERO,PRFLLINE
          GOTO      PPFTAB99 IF NOT EQUAL
.
          CLEAR     HTMLLINK
          APPEND    "javascript:UpdateLetter('",HTMLLINK
          APPEND    PRFLNUMB,HTMLLINK
          APPEND    "')",HTMLLINK
          RESET     HTMLLINK
          WRITE     HTMLFILE;"t.addRow(#"",HTMLLINK,"#",":
                             "#"",PRFLNUMB,"#",":     * Letter number
                             "#"",PRFLTEXT,"#",":     * Line of letter
                             "#"",PRFLMBOT,"#",":     * Bottom margin
                             "#"",PRFLMTOP,"#",":     * Top margin
                             "#"",PRFLPLEN,"#",":     * Page length
                             "#"",PRFLLEFT,"#");"     * Left margin
.
          GOTO      PPFTAB10
.
PPFTAB99  RETURN
.
.***************************************************************************
.*                               COPY0000                                  *
.*                          Copy data for Year FDRGYEAR                    *
.***************************************************************************
COPY0000  PACK      KEY6,FDRGYEAR,SP2
          CALL      RDSDRGA1
COPY1000  CALL      RDKDRGA1
          BRANCH    OVRCD,COPY9999
.
          MATCH     DRGYR,FDRGYEAR
          GOTO      COPY9999 IF NOT EQUAL
.
.         Increment all the dates
.
          UNPACK    DRGFDTE,CCENT,CYEAR,CMON,CDAY
          CALL      ADDY0000
          PACK      DRGFDTE,CCENT,CYEAR,CMON,CDAY
.
          UNPACK    DRGTDTE,CCENT,CYEAR,CMON,CDAY
          CALL      ADDY0000
          PACK      DRGTDTE,CCENT,CYEAR,CMON,CDAY
.
          UNPACK    DRGYR,CCENT,CYEAR
          CALL      ADDY0000
          PACK      DRGYR,CCENT,CYEAR
.
          UNPACK    DRGCYR,CCENT,CYEAR
          CALL      ADDY0000
          PACK      DRGCYR,CCENT,CYEAR
.
          PACK      KEY6,DRGYR,DRGNUM
          CALL      WRDRGA1
.
          PACK      KEY6,FDRGYEAR,DRGNUM  * Reposition back on original record
          CALL      RDDRGA1
          GOTO      COPY1000
.
COPY9999  RETURN
.***************************************************************************
.*                               ADDY0000                                  *
.*                          Add INCRYEAR to CCENT,CYEAR                       *
.***************************************************************************
ADDY0000  MOVE      CYEAR,IYEAR
          ADD       INCRYEAR,IYEAR
          MOVE      IYEAR,XYEAR
          REP       " 0",XYEAR
.
.         Check if we have moved into a new century
.
          MATCH     XYEAR,CYEAR
          GOTO      ADDY8000 IF LESS
.
.         A New Century
.
          MOVE      CCENT,ICENT
          ADD       ONE,ICENT
          MOVE      ICENT,CCENT
          REP       " 0",CCENT
.
.         Finished
.
ADDY8000  MOVE      XYEAR,CYEAR
ADDY9999  RETURN
.
.***************************************************************************
.*                               VCOP0000                                  *
.*                          Validate copy before processing                *
.***************************************************************************
VCOP0000  PACK      KEY6,FDRGYEAR,SP2     * Check for a valid year
          CALL      RDSDRGA1
          CALL      RDKDRGA1
          BRANCH    OVRCD,VCOP9000        * Invalid year.
.
          MATCH     FDRGYEAR,DRGYR        * Found the correct year ?
          GOTO      VCOP9000 IF NOT EQUAL
. 
          UNPACK    FDRGYEAR,CCENT,CYEAR
          CALL      ADDY0000            * Add YRINC to CCENT,CYEAR
          PACK      TDRGYEAR,CCENT,CYEAR * Use this just to save new year

          PACK      KEY6,TDRGYEAR,SP2     * Check for a valid year
          CALL      RDSDRGA1
          CALL      RDKDRGA1
          BRANCH    OVRCD,VCOP8000        * Invalid year.
.
          MATCH     TDRGYEAR,DRGYR        * Found the correct year ?
          GOTO      VCOP9100 IF EQUAL
.
VCOP8000  MOVE      ZERO,EXIT
          GOTO      VCOP9999
.
VCOP9000  CLEAR     WEBTITLE
          APPEND    "No Periods for the copy from Year - ",WEBTITLE
          APPEND    FDRGYEAR,WEBTITLE
          RESET     WEBTITLE
          CALL      WEBERR00
          MOVE      ONE,EXIT
          GOTO      VCOP9999
.
VCOP9100  CLEAR     WEBTITLE
          APPEND    "There is already data for the copy to Year - ",WEBTITLE
          APPEND    TDRGYEAR,WEBTITLE
          RESET     WEBTITLE
          CALL      WEBERR00
          MOVE      ONE,EXIT
          GOTO      VCOP9999
.
VCOP9999  RETURN
.
.**************************************************************************
.*                                   VDAT0000                              *
.*                         select field to modify or post                 *
.**************************************************************************
VDAT0000  MATCH     PTDRG001,PTDRG002   
          GOTO      VDAT1100 IF NOT LESS
.
          GOTO      VDAT9000
.
.         Check that this range does not overlap any other ranges
.
.         We want a record that doesn't overlap any other range.
.
.
.         We want a record that doesn't overlap any other range.
.
VDAT1100  PACK      KEY14,PTDRG001,SP6            * Check the from date
          CALL      RDSDRGA2
          CALL      RDKDRGA2
          BRANCH    OVRCD,VDAT8900                 * Valid date range
.
.         We have a record whose to date >= the from date. Check that we
.         don't have an overlap
.
          MATCH     DRGFDTE,PTDRG002
          GOTO      VDAT8900 IF LESS              * To date before record found
.
          MATCH     DRGYR,PTDRG003                 * Check if we found the orig.
          GOTO      VDAT9100 IF NOT EQUAL
.
          MATCH     DRGNUM,PTDRG004               * Check if we found the orig.
          GOTO      VDAT8200 IF EQUAL
.
.         Check the to date against the report file
.
VDAT8200  PACK      KEY14,PTDRG002,SP6            * Check the to date
          CALL      RDSDRGA2
          CALL      RDKDRGA2
          BRANCH    OVRCD,VDAT8900                 * Valid date range
.
.         We have a record whose to date >= the from date. Check that we
.         don't have an overlap
.
          MATCH     DRGFDTE,PTDRG002
          GOTO      VDAT8900 IF LESS              * From date before rec found
.
          MATCH     DRGYR,PTDRG003                 * Check if we found the orig.
          GOTO      VDAT9100 IF NOT EQUAL
.
          MATCH     DRGNUM,PTDRG004               * Check if we found the orig.
          GOTO      VDAT8900 IF EQUAL
          GOTO      VDAT9100
.
VDAT8900  MOVE      ZERO,EXIT
          GOTO      VDAT9999
.
VDAT9000  MOVE     "To Date must be Greater or equal to From Date. ",WEBTITLE
          CALL      WEBERR00
          MOVE      ONE,EXIT
          GOTO      VDAT9999
.
VDAT9100  CLEAR     WEBTITLE
          APPEND    "Date range overlaps with Period ",WEBTITLE
          APPEND    DRGNUM,WEBTITLE
          APPEND    " / ",WEBTITLE
          APPEND    DRGYR,WEBTITLE
          CALL      WEBERR00
          MOVE      ONE,EXIT
          GOTO      VDAT9999
.
VDAT9999  RETURN
.
.*****************************************************************************
.*  GETALTID
.*  Procedure to get an alternate ID
.*  Exit=0  No alternate ID
.*       1  Alternate ID's exist
.*****************************************************************************
          DEFPROC   GETALIDS
.
          INC       PMSAIDFD/INC
.
          MOVE      ZERO,EXIT
          PACK      KEY20,SP70
          OPEN      PMSAIDA1,"pmsaidaf"
.
          PACK      KEY31,PURNO,SP70
          CALL      RSPMAID1           * Read alternate id Table
GETALI10  CALL      RKPMAID1
          BRANCH    OVRCD,GETALI99
.
          MATCH     PURNO,PMAIURNO     * Check same UR
          GOTO      GETALI99 IF NOT EQUAL
.
          MATCH     "1",PMAIDISU
          GOTO      GETALI10 IF NOT EQUAL
.
          PACK      KEY20,PMAIALID,SP70
          MOVE      ONE,EXIT
          GOTO      GETALI99
.
          INC       PMSAIDIO/INC
          INC       IBAOVRIO/INC
.
GETALI99  CLOSE     PMSAIDA1
.
          ENDPROC
+
.------------------------------------------------------------
. HCP Letter Selections
.------------------------------------------------------------
HCPSEL00  MATCH     SP70,UPDTTYPE
          GOTO      HCPSEL70 IF EQUAL
.           
          MATCH     "A",UPDTTYPE            * Add
          GOTO      HCPSEL10 IF EQUAL
.         
          MATCH     "U",UPDTTYPE            * Update
          GOTO      HCPSEL20 IF EQUAL
.         
          MATCH     "D",UPDTTYPE            * Delete
          GOTO      HCPSEL30 IF EQUAL
.         
          GOTO      HCPSEL90
.           
HCPSEL10  PACK      KEY4,PMDLT001,SP70
          CALL      RDPMDLT1
          COMPARE   ZERO,OVRCD
          GOTO      HCPSEL91 IF EQUAL
.
          CALL      CLPMDS00
          CALL      MVPMDS00
.         
          PACK      KEY4,PMDSSELI,SP70
          CALL      WRPMDLT1
.
          CALL      RUNHCP00 
.
          MOVE      ZERO,EXIT
          GOTO      HCPSEL99
.
HCPSEL20  PACK      KEY4,PMDLT001,SP70
          CALL      RDPMDLT1
          BRANCH    OVRCD,HCPSEL92
.
          CALL      MVPMDS00
.         
          CALL      UPPMDLT1
.         
          CALL      RUNHCP00 
.
          MOVE      ZERO,EXIT
          GOTO      HCPSEL99
.
HCPSEL30  PACK      KEY4,PMDLT001,SP70
          CALL      RDPMDLT1
          BRANCH    OVRCD,HCPSEL92
.         
          CALL      DEPMDLT1
.         
          CALL      DELHCP00
.
          MOVE      ZERO,EXIT
          GOTO      HCPSEL99
.           
HCPSEL70  PACK      KEY4,PMDLT001,SP70
          CALL      RDPMDLT1
          IF        OVRCD=1
            CALL      CLPMDS00
          ENDIF
.
          MOVE      ZERO,EXIT
.
          CLEAR     WEBTITLE
          MOVE      "Doctors Letter Selections",WEBTITLE
          RESET     WEBTITLE
.
          CALL      WEBHED00   * Create Output File and Write HTML Page Header
          BRANCH    EXIT,HCPSEL99
          CALL      WEBBOD00   * Process Web Body
          CALL      WEBEND00   * Process End of HTML File
.
          MOVE      ONE,EXIT
          GOTO      HCPSEL99
.
HCPSEL90  MOVE      "Invalid Form Action.",WEBTITLE
          CALL      WEBERR00
          MOVE      ONE,EXIT
          GOTO      HCPSEL99
.
HCPSEL91  MOVE      "Letter Selection Exists.",WEBTITLE
          CALL      WEBERR00
          MOVE      ONE,EXIT
          GOTO      HCPSEL99
.
HCPSEL92  MOVE      "Invalid Letter Selection.",WEBTITLE
          CALL      WEBERR00
          MOVE      ONE,EXIT
          GOTO      HCPSEL99
.
HCPSEL99  RETURN
+
.------------------------------------------------------------
.                       RUNHCP00
.   Schedule Doctors Letter Extract to be run via Program Scheduler
.------------------------------------------------------------
RUNHCP00  MOVE      "IBAPMS87",SCHDPGID
          MOVE      "Run Doctors Letter List",SCHDDESC
          PACK      SCHDDATE,CURRDATE,SP10  
          CLOCK     TIME,SCHDTIME
.
.         Write Keyin parameters for Extract
.
          MOVE      ONE,KEYSTARR[1]          * Option
          MOVE      PMDLT001,KEYSTARR[2]     * Extract ID
          MOVE      TWO,KEYSTCNT             * Number of Keyins
.
          CALL      SCHPRO00   * Schedule Extract
.
RUNHCP99  RETURN
+
.------------------------------------------------------------
. HCP Selection - List selected HCP details
.------------------------------------------------------------
DISHCP00  MATCH     SP70,UPDTTYPE
          GOTO      DISHCP70 IF EQUAL
.
          GOTO      DISHCP90
.
DISHCP70  PACK      KEY4,PMDLT001,SP70
          CALL      RDPMDLT1
          BRANCH    OVRCD,DISHCP91
.
          CALL      DISHTT00                * Total selected hcp codes
.
          CLEAR     WEBTITLE
          MOVE      "Doctors Letter Selected HCP Details",WEBTITLE
          RESET     WEBTITLE
.
          CALL      WEBHED00   * Create Output File and Write HTML Page Header
          BRANCH    EXIT,DISHCP99
          CALL      WEBBOD00   * Process Web Body
          CALL      WEBEND00   * Process End of HTML File
.
          MOVE      ONE,EXIT
          GOTO      DISHCP99
.
DISHCP90  MOVE      "Invalid Form Action.",WEBTITLE
          CALL      WEBERR00
          MOVE      ONE,EXIT
          GOTO      DISHCP99
.
DISHCP91  MOVE      "Invalid Letter Selection.",WEBTITLE
          CALL      WEBERR00
          MOVE      ONE,EXIT
          GOTO      DISHCP99
.
DISHCP99  RETURN
+
.-------------------------------------------------------------
. Total number of selected hcp codes in extract
.-------------------------------------------------------------
DISHTT00  MOVE      ZERO,RECTOTAL
          PACK      KEY14,PMDLT001,SP70
          CALL      RSPMDSL1
DISHTT10  CALL      RKPMDSL1
          BRANCH    OVRCD,DISHTT99
.
          MATCH     PMDLT001,PMDLSELI
          GOTO      DISHTT99 IF NOT EQUAL
.
          ADD       ONE,RECTOTAL
          GOTO      DISHTT10
.
DISHTT99  RETURN
.-------------------------------------------------------------
. Delete hcp codes in extract
.-------------------------------------------------------------
DELHCP00  PACK      KEY14,PMDLT001,SP70
          CALL      RSPMDSL1
          CALL      RKPMDSL1
          BRANCH    OVRCD,DISHTT99
.
          MATCH     PMDLT001,PMDLSELI
          GOTO      DELHCP99 IF NOT EQUAL
.
          PACK      KEY14,PMDLSELI,PMDLHCPC,SP70
          CALL      DEPMDSL1
.
          GOTO      DISHTT10
.
DELHCP99  RETURN
.
.------------------------------------------------------------
. Patient List
.------------------------------------------------------------
PMDL0000  BRANCH    FLDITMNO,PMDL0100,PMDL0200,PMDL0300,PMDL0400:
                             PMDL0500
.
          WRITE     HTMLFILE;"Invalid Tag";
          GOTO      PMDL9999
.
PMDL0100  CALL      HCPLST00                * Patient HCP List
          GOTO      PMDL9999
.
PMDL0200  CALL      NEXTRS00                * next
          GOTO      PMDL9999
.
PMDL0300  CALL      PREVRS00                * previous
          GOTO      PMDL9999
.
PMDL0400  WRITE     HTMLFILE;RECTOTAL;
          GOTO      PMDL9999
.
PMDL0500  CALL      HCPLET00                * Selection list of letters
          GOTO      PMDL9999
.
PMDL9999  RETURN
+
.------------------------------------------------------------
. Selection list of hcp letters send
.------------------------------------------------------------
HCPLET00  PACK      KEY6,SP70
          CALL      RSPTDLT1
HCPLET10  CALL      RKPTDLT1
          BRANCH    OVRCD,HCPLET99
.
          COMPARE   ZERO,PTDLLINO
          GOTO      HCPLET10 IF NOT EQUAL
.
          MATCH     "1",PTDLACTV                 * Skip Inactive
          GOTO      HCPLET10 IF EQUAL
.
          WRITE     HTMLFILE;"<option value=",PTDLLTNO,">",PTDLTEXT:
                               "</option>";
          GOTO      HCPLET10
.
HCPLET99  RETURN
+
.------------------------------------------------------------
. Selection HCP List
.------------------------------------------------------------
HCPLST00  UNPACK    DIM127,D1,LINKPRG,DIM127
          UNPACK    DIM127,D1,LINKREP,DIM127
          UNPACK    DIM127,D1,LINKTEM,DIM127
.         
          CALL      HCPHD000                * HCP List Table Heading
.         
          IF        NORECORD=0
            MOVE      PTCNNRTD,NORECORD     * Set Default No Records to Display
          ENDIF
          MOVE      ZERO,RECNUMB
          MOVE      ZERO,DISNUMB
.
          MOVE      PMDLT001,KEY4
          CALL      RDPMDLT1
          BRANCH    OVRCD,HCPLST90
.
          PACK      KEY14,PMDLT001,SP70
          CALL      RSPMDSL1
HCPLST10  CALL      RKPMDSL1
          BRANCH    OVRCD,HCPLST95
.
          MATCH     PMDLT001,PMDLSELI
          GOTO      HCPLST95 IF NOT EQUAL
.
          ADD       ONE,RECNUMB
          IF        STARTNUM>=RECNUMB
            GOTO      HCPLST10
          ENDIF
.
          CALL      HCPROW00
          ADD       ONE,DISNUMB
          COMPARE   NORECORD,DISNUMB
          GOTO      HCPLST10 IF NOT EQUAL
          GOTO      HCPLST99
.
HCPLST90  MOVE      "Invalid Selection ID",WEBTITLE
          CALL      WEBERR00
          MOVE      ONE,EXIT
          GOTO      HCPLST99
.
HCPLST95  CALL      NOMORE00            * Display No More Records Message
.
HCPLST99  RETURN
.------------------------------------------------------------
.  HCP Letter List (TABLE HEADING)
.------------------------------------------------------------
HCPHD000  WRITE     HTMLFILE;"<tr><td class=HeadingCell>Name</td>":
                             "<td class=HeadingCell>Type</td>":
                             "<td class=HeadingCell>Status</td>":
                             "<td class=HeadingCell>Primary Speciality</td>":
                             "<td class=HeadingCell width=8%>Deleted</td>":
                             "</tr>"
HCPHD999  RETURN
.------------------------------------------------------------
. Read patient details and write the patient row to HTMLFILE
.------------------------------------------------------------
HCPROW00  PACK      KEY10,PMDLHCPC,SP70
          CALL      RDPMHCP1
          IF        OVRCD=1
            MOVE      PMDLHCPC,DOCFNAME
            GOTO      HCPROW10
          ENDIF
.
          MOVE      PMHCTITL,FMTTITLE
          MOVE      PMHCGNAM,FMTGNAME
          MOVE      PMHCSNAM,FMTSNAME
          CALL      DOCNM000
.
          MATCH     "0",PMHCSTTS 
          IF        @EQUAL
            MOVE      "Active",KEY8
          ELSE
            MOVE      "Inactive",KEY8
          ENDIF     
.           
          MOVE      "&nbsp;",HCPTDESC
          IF        PMHCHCST = 0
            MOVE      "Attending",HCPTDESC
          ENDIF
          IF        PMHCHCST = 1
            MOVE      "Referring",HCPTDESC
          ENDIF
          IF        PMHCHCST = 2
            MOVE      "Attending & Referring",HCPTDESC
          ENDIF
          IF        PMHCHCST = 3
            MOVE      "GP",HCPTDESC
          ENDIF
          IF        PMHCHCST = 4
            MOVE      "Attending and GP",HCPTDESC
          ENDIF
          IF        PMHCHCST = 5
            MOVE      "Referring and GP",HCPTDESC
          ENDIF
          IF        PMHCHCST = 6
            MOVE      "Attending Referring and GP",HCPTDESC
          ENDIF
          IF        PMHCHCST = 7
            MOVE      "Other",HCPTDESC
          ENDIF
          IF        PMHCHCST = 8
            MOVE      "Other Attending",HCPTDESC
          ENDIF
          IF        PMHCHCST = 9
            MOVE      "Other Referring",HCPTDESC
          ENDIF
          IF        PMHCHCST = 10
            MOVE      "Other Attending & Referring",HCPTDESC
          ENDIF
.
          MOVE     "DT",CATEGORY
          MOVE     PMHCSPC1,CODE
          CALL     GETCOD00
.
HCPROW10  WRITE     HTMLFILE;"<tr><td nowrap><A HREF='javascript:HCPViewFrame":
                             "(#"",PMDLHCPC,"#")'>":
                             "<img src=../images/MaintenanceIcon.gif hspace=4":
                             " border=0 align=absmiddle></a>":
                             DOCFNAME,"&nbsp;</td>":
                             "<td>",HCPTDESC,"&nbsp;</td>":
                             "<td>",KEY8,"&nbsp;</td>":
                             "<td>",TDESC,"&nbsp;</td>";
.
          MATCH     "1",PMDLDLST
          IF        @EQUAL
            WRITE     HTMLFILE;"<td><input type=checkbox name=pmdls003":
                               " value=1 onclick=#"DeleteHCP41(this":
                               ",'",PMDLSELI,"','",PMDLHCPC,"'":
                               ");#" checked></td>";
          ELSE
            WRITE     HTMLFILE;"<td><input type=checkbox name=pmdsl003":
                               " value=1 onclick=#"DeleteHCP41(this":
                               ",'",PMDLSELI,"','",PMDLHCPC,"'":
                               ");#"></td>";
          ENDIF
.
          WRITE     HTMLFILE;"</tr>"
.
HCPROW99  RETURN
+
.------------------------------------------------------------
. Delete HCP Indicator Update
.------------------------------------------------------------
REMHCP00  CALL      XMLHED00
          BRANCH    EXIT,REMHCP99
.
REMHCP10  PACK      KEY14,PMDSL001,PMDSL002,SP70
          CALL      RDPMDSL1
          BRANCH    OVRCD,REMHCP90
.
          MOVE      PMDSL003,PMDLDLST
          CALL      UPPMDSL1
.
          WRITE     HTMLFILE;"<RETURN_VALUE TYPE=SIMPLE>":
                             "Update Complete":
                             "</RETURN_VALUE>"
          GOTO      REMHCP95
.
REMHCP90  WRITE     HTMLFILE;"<RETURN_VALUE TYPE=ERROR>":
                             "Invalid HCP":
                             "</RETURN_VALUE>"
.
REMHCP95  CALL      XMLEND00
.
REMHCP99  RETURN
+
.------------------------------------------------------------
. Stationery Codes
.------------------------------------------------------------
STNCOD00  MOVE      ZERO,KEY6
          CALL      RSIBTH1
STNCOD20  CALL      RKIBTH1
          BRANCH    OVRCD,STNCOD99
.
          MATCH     "1",IBTHACTV
          GOTO      STNCOD20 IF NOT EQUAL
.
          MATCH     STNTYPE,IBTHSTYP        * Stationery Type
          GOTO      STNCOD20 IF NOT EQUAL
.
          MATCH     STNCODE,IBTHSCOD        * Stationery Code
          IF        @EQUAL
            WRITE     HTMLFILE;"<option value=#"",IBTHSCOD,"#" selected>":
                               IBTHDESC,"</option>"
          ELSE
            WRITE     HTMLFILE;"<option value=#"",IBTHSCOD,"#">",IBTHDESC:
                               "</option>"
          ENDIF
          GOTO      STNCOD20
.
STNCOD99  RETURN
+
.------------------------------------------------------------
. Eclipse/WebServices Participant Selection List
.------------------------------------------------------------
ECLPAR00  MATCH     "1",PTCNWSIN
          GOTO      ECLPAR50 IF EQUAL
.
          UNPACK    DIM127,D1,KEY1,DIM127
          MOVE      ZERO,F1
          MOVE      KEY1,F1
          MATCH     SP70,PTFXECLP
          GOTO      ECLPAR20 IF EQUAL
          PACK      KEY3,PTFXECLP,SP70
          CALL      RDPTPAR1
          BRANCH    OVRCD,ECLPAR20
          BRANCH    F1,ECLPAR10,ECLPAR20
          WRITE     HTMLFILE;PTPRCODE;
          GOTO      ECLPAR99
.
ECLPAR10  WRITE     HTMLFILE;PTPRCODE;
          GOTO      ECLPAR99
.
ECLPAR20  CALL      PSEL0000
          GOTO      ECLPAR99
.
ECLPAR50  MATCH     "1",WSININDC
          GOTO      ECLPAR99 IF NOT EQUAL
.
          UNPACK    DIM127,D1,KEY1,DIM127
          MOVE      ZERO,F1
          MOVE      KEY1,F1
          MATCH     SP70,PTFXECLP
          GOTO      ECLPAR70 IF EQUAL
          PACK      KEY3,PTFXECLP,SP70
          CALL      RDWBPAR1
          BRANCH    OVRCD,ECLPAR70
          BRANCH    F1,ECLPAR60,ECLPAR70
          WRITE     HTMLFILE;WBPRCODE;
          GOTO      ECLPAR99
.
ECLPAR60  WRITE     HTMLFILE;WBPRCODE;
          GOTO      ECLPAR99
.
ECLPAR70  CALL      WSEL0000
          GOTO      ECLPAR99
.
ECLPAR99  RETURN
.------------------------------------------------------------
. Eclipse Participant Selection
.------------------------------------------------------------
PSEL0000  PACK      KEY3,SP70
          CALL      RSPTPAR1
PSEL0100  CALL      RKPTPAR1
          BRANCH    OVRCD,PSEL9999
.
          MOVE      PTPRNAME,KEY40
          PACK      KEY5,QUOTE,PTPRCODE,QUOTE
          MOVE      SP70,DIM3
          MOVE      PTFXECLP,DIM3
          MATCH     DIM3,PTPRCODE
          IF        @EQUAL
            WRITE     HTMLFILE;"<option value=",KEY5," selected>":
                               KEY40,"</option>"
          ELSE
            WRITE     HTMLFILE;"<option value=",KEY5,">",KEY40,"</option>"
          ENDIF
          GOTO      PSEL0100
.
PSEL9999  RETURN
.
.------------------------------------------------------------
. WebServices Participant Selection
.------------------------------------------------------------
WSEL0000  PACK      KEY3,SP70
          CALL      RSWBPAR1
WSEL0100  CALL      RKWBPAR1
          BRANCH    OVRCD,WSEL9999
.
          MOVE      WBPRNAME,KEY40
          PACK      KEY5,QUOTE,WBPRCODE,QUOTE
          MOVE      SP70,DIM3
          MOVE      PTFXECLP,DIM3
          MATCH     DIM3,WBPRCODE
          IF        @EQUAL
            WRITE     HTMLFILE;"<option value=",KEY5," selected>":
                               KEY40,"</option>"
          ELSE
            WRITE     HTMLFILE;"<option value=",KEY5,">",KEY40,"</option>"
          ENDIF
          GOTO      WSEL0100
.
WSEL9999  RETURN
.
.------------------------------------------------------------
. Health Fund Program Maintenance  
.------------------------------------------------------------
FNDPRG00  RESET     UPDTTYPE
          MATCH     SP1,UPDTTYPE
          GOTO      FNDPRG40 IF EQUAL
.
          MATCH     "A",UPDTTYPE    * Add formaction
          GOTO      FNDPRG10 IF EQUAL
.
          MATCH     "U",UPDTTYPE    * Update formaction
          GOTO      FNDPRG20 IF EQUAL
.
          MATCH     "D",UPDTTYPE    * Delete formaction
          GOTO      FNDPRG30 IF EQUAL
.
          GOTO      FNDPRG93
.
.         ************ ADD FORMACTION ***********
.
FNDPRG10  PACK      KEY23,PMHPG001,PMHPG002,PMHPG003,PMHPG004,PMHPG005,SP70
          CALL      RDPMHPG1
          COMPARE   ONE,OVRCD
          GOTO      FNDPRG92 IF NOT EQUAL
.
          CALL      CLPMSHPG      * Clear all the file variables
          CALL      MVHPG000      * Moves input variables to file variables
.
          PACK      PMHPCDAT,CURRDATE,SP10  
          CLOCK     TIME,PMHPCTIM
          MOVE      USERID,PMHPCUID
.
          PACK      KEY23,PMHPATYP,PMHPCLAM,PMHPFUND,PMHPTABT,PMHPEDAT,SP70
          CALL      RAPMHPG1
          IF        OVRCD=1
            CALL      WRPMHPG1      * Writes away the data
          ENDIF
.
          MOVE      ZERO,EXIT
          GOTO      FNDPRG99
.
.         ************ UPDATE FORMACTION **********
.
FNDPRG20  PACK      KEY23,PMHPG001,PMHPG002,PMHPG003,PMHPG004,PMHPG005,SP70
          CALL      RDPMHPG1
          BRANCH    OVRCD,FNDPRG91
.
          CALL      MVHPG000      * Moves input variables to file variables
.
          PACK      PMHPUDAT,CURRDATE,SP10  
          CLOCK     TIME,PMHPUTIM
          MOVE      USERID,PMHPUUID
.
          CALL      UPPMHPG1      * Update the data
.
          MOVE      ZERO,EXIT
          GOTO      FNDPRG99
.
.         ************ DELETE FORMACTION **********
.
FNDPRG30  PACK      KEY23,PMHPG001,PMHPG002,PMHPG003,PMHPG004,PMHPG005,SP70
          CALL      RDPMHPG1 
          BRANCH    OVRCD,FNDPRG91
.
          MATCH     "1",PMHPBRKO            * Breakdown OP visits
          GOTO      FNDPRG94 IF EQUAL
.
          CALL      DEPMHPG1
.
          MOVE      ZERO,EXIT
          GOTO      FNDPRG99
.
.         ************ DISPLAY FORMACTION **********
.
FNDPRG40  PACK      KEY23,PMHPG001,PMHPG002,PMHPG003,PMHPG004,PMHPG005,SP70
          CALL      RDPMHPG1
          IF        OVRCD=1
            CALL      CLPMSHPG     * Clear all the file variables
          ENDIF
.
          CLEAR     WEBTITLE
          MOVE      "Program Maintenance",WEBTITLE
          RESET     WEBTITLE
.
          CALL      WEBHED00   * Create Output File and Write HTML Page Header
          BRANCH    EXIT,FNDPRG99
          CALL      WEBBOD00   * Process Web Body
          CALL      WEBEND00   * Process End of HTML File
          MOVE      ONE,EXIT
          GOTO      FNDPRG99
.
FNDPRG91  MOVE      "Program Record does not exist",WEBTITLE
          CALL      WEBERR00
          MOVE      ONE,EXIT
          GOTO      FNDPRG99
.
FNDPRG92  MOVE      "Program Details exists",WEBTITLE
          CALL      WEBERR00
          MOVE      ONE,EXIT
          GOTO      FNDPRG99
.
FNDPRG93  MOVE      "Invalid Form Action.",WEBTITLE
          CALL      WEBERR00
          MOVE      ONE,EXIT
          GOTO      FNDPRG99
.
FNDPRG94  CLEAR     WEBTITLE
          APPEND    "Invalid deletion - Breakdown of OP visit",WEBTITLE
          APPEND    " details exist.",WEBTITLE
          CALL      WEBERR00
          MOVE      ONE,EXIT
          GOTO      FNDPRG99
.
FNDPRG99  RETURN
.
.------------------------------------------------------------
. Health Fund OP Program Maintenance
.------------------------------------------------------------
FNDOPG00  RESET     UPDTTYPE
          MATCH     SP1,UPDTTYPE
          GOTO      FNDOPG40 IF EQUAL
.
          MATCH     "A",UPDTTYPE    * Add formaction
          GOTO      FNDOPG10 IF EQUAL
.
          MATCH     "U",UPDTTYPE    * Update formaction
          GOTO      FNDOPG20 IF EQUAL
.
          MATCH     "D",UPDTTYPE    * Delete formaction
          GOTO      FNDOPG30 IF EQUAL
.
          GOTO      FNDOPG93
.
.         ************ ADD FORMACTION ***********
.
FNDOPG10  PACK      KEY26,PMHPO001,PMHPO002,PMHPO003,PMHPO004,PMHPO005:
                          PMHPO006,SP70
          CALL      RDPMHPO1
          COMPARE   ONE,OVRCD
          GOTO      FNDOPG92 IF NOT EQUAL
.
          CALL      CLPMSHPO      * Clear all the file variables
          CALL      MVHPO000      * Moves input variables to file variables
.
          PACK      PMHOCDAT,CURRDATE,SP10  
          CLOCK     TIME,PMHOCTIM
          MOVE      USERID,PMHOCUID
.
          CALL      WRPMHPO1      * Writes away the data
.
          PACK      KEY23,PMHPG001,PMHPG002,PMHPG003,PMHPG004,PMHPG005,SP70
          CALL      RDPMHPG1
          BRANCH    OVRCD,FNDOPG94
.         
          PACK      PMHPMAXO,SP2,ZERO
          PACK      PMHPWARO,SP2,ZERO
          MOVE      ONE,PMHPBRKO
          CALL      UPPMHPG1      * Update breakdown OP visits  indicator
.
          MOVE      ZERO,EXIT
          GOTO      FNDOPG99
.
.         ************ UPDATE FORMACTION **********
.
FNDOPG20  PACK      KEY26,PMHPO001,PMHPO002,PMHPO003,PMHPO004,PMHPO005:
                          PMHPO006,SP70
          CALL      RDPMHPO1
          BRANCH    OVRCD,FNDOPG91
.
          CALL      MVHPO000      * Moves input variables to file variables
.
          PACK      PMHOUDAT,CURRDATE,SP10  
          CLOCK     TIME,PMHOUTIM
          MOVE      USERID,PMHOUUID
.
          CALL      UPPMHPO1      * Update the data
.
          MOVE      ZERO,EXIT
          GOTO      FNDOPG99
.
.         ************ DELETE FORMACTION **********
.
FNDOPG30  PACK      KEY26,PMHPO001,PMHPO002,PMHPO003,PMHPO004,PMHPO005:
                          PMHPO006,SP70
          CALL      RDPMHPO1
          BRANCH    OVRCD,FNDOPG91
.
          CALL      DEPMHPO1
.
          MOVE      ZERO,F1
          PACK      KEY26,PMHPO001,PMHPO002,PMHPO003,PMHPO004,PMHPO005,SP70
          CALL      RSPMHPO1
          CALL      RKPMHPO1
          BRANCH    OVRCD,FNDOPG35
.
          MATCH     PMHPO001,PMHOATYP
          GOTO      FNDOPG35 IF NOT EQUAL
.
          MATCH     PMHPO002,PMHOCLAM
          GOTO      FNDOPG35 IF NOT EQUAL
.
          MATCH     PMHPO003,PMHOFUND
          GOTO      FNDOPG35 IF NOT EQUAL
.
          MATCH     PMHPO004,PMHOTABT
          GOTO      FNDOPG35 IF NOT EQUAL
.
          MATCH     PMHPO005,PMHOEDAT
          GOTO      FNDOPG35 IF NOT EQUAL
.
          MOVE      ONE,F1
.
FNDOPG35  PACK      KEY23,PMHPG001,PMHPG002,PMHPG003,PMHPG004,PMHPG005,SP70
          CALL      RDPMHPG1
          BRANCH    OVRCD,FNDOPG94
.
          PACK      PMHPMAXO,SP2,ZERO
          PACK      PMHPWARO,SP2,ZERO
          MOVE      F1,PMHPBRKO
          CALL      UPPMHPG1      * Update breakdown OP visits  indicator
.
          MOVE      ZERO,EXIT
          GOTO      FNDOPG99
.
.         ************ DISPLAY FORMACTION **********
.
FNDOPG40  PACK      KEY23,PMHPG001,PMHPG002,PMHPG003,PMHPG004,PMHPG005,SP70
          CALL      RDPMHPG1
          BRANCH    OVRCD,FNDOPG94
.
          PACK      KEY26,PMHPO001,PMHPO002,PMHPO003,PMHPO004,PMHPO005:
                          PMHPO006,SP70
          CALL      RDPMHPO1
          IF        OVRCD=1
            CALL      CLPMSHPO     * Clear all the file variables
          ENDIF
.
          CLEAR     WEBTITLE
          MOVE      "OP Program Maintenance",WEBTITLE
          RESET     WEBTITLE
.
          CALL      WEBHED00   * Create Output File and Write HTML Page Header
          BRANCH    EXIT,FNDOPG99
          CALL      WEBBOD00   * Process Web Body
          CALL      WEBEND00   * Process End of HTML File
          MOVE      ONE,EXIT
          GOTO      FNDOPG99
.
FNDOPG91  MOVE      "OP Program Record does not exist",WEBTITLE
          CALL      WEBERR00
          MOVE      ONE,EXIT
          GOTO      FNDOPG99
.
FNDOPG92  MOVE      "OP Program Details exists",WEBTITLE
          CALL      WEBERR00
          MOVE      ONE,EXIT
          GOTO      FNDOPG99
.
FNDOPG93  MOVE      "Invalid Form Action.",WEBTITLE
          CALL      WEBERR00
          MOVE      ONE,EXIT
          GOTO      FNDOPG99
.
FNDOPG94  MOVE      "Program Record does not exist",WEBTITLE
          CALL      WEBERR00
          MOVE      ONE,EXIT
          GOTO      FNDOPG99
.
FNDOPG99  RETURN
+
.------------------------------------------------------------
.         DRG Versions Maintenance
.------------------------------------------------------------
DRGVMT00  RESET     UPDTTYPE
          MATCH     SP1,UPDTTYPE
          GOTO      DRGVMT40 IF EQUAL
.
          MATCH     "A",UPDTTYPE       * Add formaction
          GOTO      DRGVMT10 IF EQUAL
.
          MATCH     "U",UPDTTYPE       * Update formaction
          GOTO      DRGVMT20 IF EQUAL
.
          MATCH     "D",UPDTTYPE       * Delete formaction
          GOTO      DRGVMT30 IF EQUAL
.
          GOTO      DRGVMT98
.
.
.         ************ ADD FORMACTION ***********
.
DRGVMT10  CALL      MVPMED00
.
          MATCH     "1",PMEGRTYP           * Health Fund (patfn1af)
          IF        !@EQUAL
            MATCH     "4",PMEGRTYP         * Hospital(pathspaf)/Health Fund
            GOTO      DRGVMT12 IF NOT EQUAL
          ENDIF
.
.         Type 1 and 4 have a 2 character right justified counter at position
.         20 starting blank then 1 to 99
.
          MOVE      ZERO,F2                           * Check blacnk counter
          PACK      PMSED002,PMSED002,SP70
.
DRGVMT11  PACK      KEY34,PMSED001,PMSED002,PMSED003,SP70
          CALL      RAPMEDG1                          * File values have been
          BRANCH    OVRCD,DRGVMT12                    * populated above by cgi
.
          ADD       ONE,F2                            * Add one to counter
          UNPACK    PMSED002,KEY19,KEY11
          PACK      PMSED002,KEY19,F2,SP70
.
          COMPARE   NINTY9,F2                         * Max 99 reached
          GOTO      DRGVMT94 IF EQUAL
.
          GOTO      DRGVMT11
.
DRGVMT12  CLOCK     TIME,PMSED009
          CALL      MVPMED00
.
          PACK      KEY34,PMEGRTYP,PMEGKEYV,PMEGDRGV,SP70
          CALL      RAPMEDG1
          COMPARE   ZERO,OVRCD
          GOTO      DRGVMT91 IF EQUAL       * Record exists!
.
          CALL      WRPMEDG1
.
          MOVE      ZERO,EXIT
          GOTO      DRGVMT99
.
.
.         ************ UPDATE FORMACTION ***********
.
DRGVMT20  CLOCK     TIME,PMSED012      * Store update time
          CALL      MVPMED00           * Move cgi vars into file vars
.
          PACK      KEY34,PMEGRTYP,PMEGKEYV,PMEGDRGV,SP70
          CALL      RAPMEDG1
          BRANCH    OVRCD,DRGVMT92
.
          CALL      UPPMEDG1
          MOVE      ZERO,EXIT
          GOTO      DRGVMT99
.
.
.         ************ DELETE FORMACTION ***********
.
DRGVMT30  CALL      MVPMED00
          PACK      KEY34,PMEGRTYP,PMEGKEYV,PMEGDRGV,SP70
          CALL      RDPMEDG1
          BRANCH    OVRCD,DRGVMT92
.
          CALL      DEPMEDG1
          MOVE      ZERO,EXIT
          GOTO      DRGVMT99
.
.
.         ************ DISPLAY FORMACTION ***********
.
DRGVMT40  PACK      KEY34,DRGRTYPE,DRGKYVAL,DRGVERNO,SP70
          CALL      RDPMEDG1
          IF        OVRCD=1
            CALL      CLPMSEDG
          ENDIF

          CLEAR     WEBTITLE
          MOVE      "DRG Versions Maintenance",WEBTITLE
          RESET     WEBTITLE
.
          CALL      WEBHED00   * Create Output File and Write HTML Page Header
          BRANCH    EXIT,DRGVMT99
          CALL      WEBBOD00   * Process Web Body
          CALL      WEBEND00   * Process End of HTML File
          MOVE      ONE,EXIT
          GOTO      DRGVMT99
.
DRGVMT91  MOVE      "DRG record already exists for this version!",WEBTITLE
          CALL      WEBERR00
          MOVE      ONE,EXIT
          GOTO      DRGVMT99
.
DRGVMT92  MOVE      "DRG record not found!",WEBTITLE
          CALL      WEBERR00
          MOVE      ONE,EXIT
          GOTO      DRGVMT99
.
DRGVMT93  MOVE      "Invalid DRG Effective Dates",WEBTITLE
          CALL      WEBERR00
          MOVE      ONE,EXIT
          GOTO      DRGVMT99
.
DRGVMT94  MOVE      "DRG Effective Dates counter of 99 reached",WEBTITLE
          CALL      WEBERR00
          MOVE      ONE,EXIT
          GOTO      DRGVMT99
.
DRGVMT98  MOVE      "Invalid Form Action.",WEBTITLE
          CALL      WEBERR00
          MOVE      ONE,EXIT
          GOTO      DRGVMT99
.
DRGVMT99  RETURN
+
.------------------------------------------------------------
.         HF On Hold Invoice Maintenance
.------------------------------------------------------------
HLDINV00  BRANCH    USEFHINV,HLDINV98  * On Hold Invoice file not exists
.
          RESET     UPDTTYPE
          MATCH     SP1,UPDTTYPE
          GOTO      HLDINV40 IF EQUAL
.
          MOVE      ZERO,CHGFLAG
          MOVE      SP70,SAVEREAS
.
          MATCH     "A",UPDTTYPE       * Add formaction
          GOTO      HLDINV10 IF EQUAL
.
          MATCH     "U",UPDTTYPE       * Update formaction
          GOTO      HLDINV20 IF EQUAL
.
          MATCH     "D",UPDTTYPE       * Delete formaction
          GOTO      HLDINV30 IF EQUAL
.
          GOTO      HLDINV98
.
.         ************ ADD FORMACTION ***********
.
HLDINV10  MOVE      ZERO,ALLHFLAG
          MOVE      ZERO,HOSPCNTR
          PACK      PTFHI001,PTFHI001,SP70
.
          COMPARE   ONE,IBCNMHOS
          GOTO      HLDINV14 IF NOT EQUAL       * Not multi hospital
.
          PACK      KEY3,MULTHOSP[1],SP70
          MATCH     "All",KEY3
          IF        @EQUAL
            MOVE      ONE,ALLHFLAG
            MOVE      SP70,KEY3
            CALL      RSPTHSP1
          ENDIF
.
HLDINV12  IF        ALLHFLAG=1
            CALL      RKPTHSP1
            BRANCH    OVRCD,HLDINV18
            PACK      PTFHI001,PTHSHOSP,SP70
          ELSE
            ADD       ONE,HOSPCNTR
            COMPARE   HOSPCNTR,MULTHCNT
            GOTO      HLDINV18 IF LESS
            PACK      PTFHI001,MULTHOSP[HOSPCNTR],SP70
          ENDIF
.
HLDINV14  PACK      KEY11,PTFHI001,PTFHI002,PTFHI003,SP70
          CALL      RDPTFHI1
          IF        OVRCD=0
            MOVE      PTFHHREA,SAVEREAS       * save reason for hold
.
.         Update the existing record if it's already exist for Multiple 
.         Hospital selection or All Hospital
.
            IF        IBCNMHOS=1
              IF        MULTHCNT>1 | ALLHFLAG=1
                CALL      MVPFHI00
                PACK      PTFHUDAT,CURRDATE,SP10
                CLOCK     TIME,PTFHUTIM
                MOVE      USERID,PTFHUUID
                CALL      UPPTFHI1
.
                MOVE      ONE,CHGFLAG
                GOTO      HLDINV12  * Next hospital
              ENDIF
            ENDIF
            GOTO      HLDINV92
          ENDIF
.
          CALL      MVPFHI00           * Moves input variables to file variables
          PACK      PTFHCDAT,CURRDATE,SP10
          CLOCK     TIME,PTFHCTIM
          MOVE      USERID,PTFHCUID
          PACK      KEY11,PTFHHOSP,PTFHHFND,PTFHSYST,SP70
          CALL      WRPTFHI1
.
          MOVE      SP70,SAVEREAS       * set old reason for hold to blank
          MOVE      ONE,CHGFLAG
          BRANCH    IBCNMHOS,HLDINV12  * Next hospital
.
HLDINV18  IF        CHGFLAG=1
            MOVE      PTFHHFND,HCODE
            CALL      RUNHLD00
          ENDIF
          GOTO      HLDINV24
.
.         ************ UPDATE FORMACTION ***********
.
HLDINV20  PACK      PTFHI001,PTFHI001,SP70
          PACK      KEY11,PTFHI001,PTFHI002,PTFHI003,SP70
          CALL      RDPTFHI1                          * File values have been
          BRANCH    OVRCD,HLDINV91
.
          MOVE      PTFHHREA,SAVEREAS       * save reason for hold
.
          CALL      MVPFHI00           * Moves input variables to file variables
          PACK      PTFHUDAT,CURRDATE,SP10
          CLOCK     TIME,PTFHUTIM
          MOVE      USERID,PTFHUUID
          CALL      UPPTFHI1
.
          MOVE      PTFHHFND,HCODE
          CALL      RUNHLD00
.
HLDINV24  PACK      KEY6,PTFHI002,SP70
          CALL      RDPTFX11
          IF        OVRCD=0
            MOVE      PTFHHDAT,PTFXHDAT
            MOVE      PTFHHREA,PTFXRHCD
            MOVE      PTFHDESC,PTFXRHFT
            MOVE      USERID,PTFXOHUI
            PACK      PTFXOHDT,CCC,CYY,CMM,CDD
            REP       " 0",PTFXOHDT
            CLOCK     TIME,PTFXOHTM
            CALL      UPPTFX11
          ENDIF
.
          MOVE      ZERO,EXIT
          GOTO      HLDINV99
.
.         ************ DELETE FORMACTION ***********
.
HLDINV30  PACK      PTFHI001,PTFHI001,SP70
          PACK      KEY11,PTFHI001,PTFHI002,PTFHI003,SP70
          CALL      RDPTFHI1
          BRANCH    OVRCD,HLDINV91
.
          MOVE      PTFHHREA,SAVEREAS       * save reason for hold
          CALL      DEPTFHI1
.
          PACK      KEY6,PTFHHFND,SP70
          CALL      RDPTFX11
          IF        OVRCD=0
            UNPACK    SP70,PTFXRHCD,PTFXRHFT,PTFXHDAT
            MOVE      USERID,PTFXOHUI
            PACK      PTFXOHDT,CCC,CYY,CMM,CDD
            REP       " 0",PTFXOHDT
            CLOCK     TIME,PTFXOHTM
            CALL      UPPTFX11
          ENDIF
.
          MOVE      PTFHHFND,HCODE
          CALL      RUNHLD00
.
          MOVE      ZERO,EXIT
          GOTO      HLDINV99
.
.         ************ DISPLAY FORMACTION ***********
.
HLDINV40  PACK      KEY11,PTFHI001,PTFHI002,PTFHI003,SP70
          CALL      RDPTFHI1
          IF        OVRCD=1
            CALL      CLPATFHI
          ENDIF

          CLEAR     WEBTITLE
          MOVE      "HF On Hold Invoice Maintenance",WEBTITLE
          RESET     WEBTITLE
.
          CALL      WEBHED00   * Create Output File and Write HTML Page Header
          BRANCH    EXIT,HLDINV99
          CALL      WEBBOD00   * Process Web Body
          CALL      WEBEND00   * Process End of HTML File
          MOVE      ONE,EXIT
          GOTO      HLDINV99
.
HLDINV91  MOVE      "Health Fund On Hold record does not exist",WEBTITLE
          CALL      WEBERR00
          MOVE      ONE,EXIT
          GOTO      HLDINV99
.
HLDINV92  MOVE      "Health Fund is already On Hold",WEBTITLE
          CALL      WEBERR00
          MOVE      ONE,EXIT
          GOTO      HLDINV99
.
HLDINV98  MOVE      "Invalid Form Action.",WEBTITLE
          CALL      WEBERR00
          MOVE      ONE,EXIT
          GOTO      HLDINV99
.
HLDINV99  RETURN
+
.------------------------------------------------------------
.         HF Mechanical Ventilation hours Maintenance
.------------------------------------------------------------
MVHOUR00  BRANCH    MVHRFLAG,MVHOUR98
.
          PACK      FNEXT001,HFUND001,SP70
          PACK      FNEXT006,FNEXT006,SP70
.
          RESET     UPDTTYPE
          MATCH     SP1,UPDTTYPE
          GOTO      MVHOUR40 IF EQUAL
.
          MATCH     "A",UPDTTYPE       * Add formaction
          GOTO      MVHOUR10 IF EQUAL
          MATCH     "U",UPDTTYPE       * Update formaction
          GOTO      MVHOUR20 IF EQUAL
          MATCH     "D",UPDTTYPE       * Delete formaction
          GOTO      MVHOUR30 IF EQUAL
.
          GOTO      MVHOUR98
.
.         ************ ADD FORMACTION ***********
.
MVHOUR10  PACK      KEY17,FNEXT001,FNEXT006,SP70
          CALL      RDPTFN21
          IF        OVRCD=0
            COMPARE   ZERO,PTFNBMVH
            GOTO      MVHOUR20 IF EQUAL    * existing default record
            GOTO      MVHOUR93             * exist with blank effective date
          ENDIF
.
          PACK      KEY17,FNEXT001,FNEXT006,FNEXT007,SP70           
          CALL      RDPTFN21
          COMPARE   ZERO,OVRCD
          GOTO      MVHOUR92 IF EQUAL
.
MVHOUR18  CALL      CLRFNX00            * Clear all the file variables
.
          MOVE      FNEXT001,PTFNHFND   * Health Fund    
          MOVE      FNEXT002,PTFNBMVH   * Payment Model 0=No 1=EPM 2=CWO
          MOVE      FNEXT003,PTFNMVRT   * Mech. Ventilation Daily Rate
          MOVE      FNEXT004,PTFNHRMV   * Hours for MV Additional Day
          MOVE      FNEXT005,PTFNMVBC   * Misc. charge code for Mech vent
          MOVE      FNEXT006,PTFNHOSP   * Hospital code
          MOVE      FNEXT007,PTFNEDAT   * Effective todate
          CALL      WRPTFN21            * Write to PATFN2FD
.
          MOVE      ZERO,EXIT
          GOTO      MVHOUR99
.
.         ************ UPDATE FORMACTION ***********
.
MVHOUR20  MATCH     SP70,EFFTDATE
          GOTO      MVHOUR28 IF NOT EQUAL
.
          MATCH     SP70,FNEXT007
          GOTO      MVHOUR28 IF EQUAL
.
.         Updating a blank Effective todate, make sure record with new
.         Effective todate doesn't exist
.
          PACK      KEY17,FNEXT001,FNEXT006,FNEXT007,SP70           
          CALL      RDPTFN21
          COMPARE   ZERO,OVRCD
          GOTO      MVHOUR92 IF EQUAL
.
          PACK      KEY17,HFUND001,FNEXT006,EFFTDATE,SP70
          CALL      RDPTFN21
          BRANCH    OVRCD,MVHOUR91
.
.         Delete record with a blank Effective date & write with new Eff.todate
.
          PACK      KEY17,HFUND001,FNEXT006,EFFTDATE,SP70
          CALL      DEPTFN21
.
          PACK      FNEXT001,HFUND001   * Health Fund    
          PACK      KEY17,FNEXT001,FNEXT006,FNEXT007,SP70           
          GOTO      MVHOUR18
.
MVHOUR28  PACK      KEY17,HFUND001,FNEXT006,EFFTDATE,SP70
          CALL      RDPTFN21
          BRANCH    OVRCD,MVHOUR91
.
          MOVE      FNEXT002,PTFNBMVH * Payment Model 0=No 1=EPM 2=CWO
          MOVE      FNEXT003,PTFNMVRT * Mech. Ventilation Daily Rate
          MOVE      FNEXT004,PTFNHRMV * Hours for MV Additional Day
          MOVE      FNEXT005,PTFNMVBC * Misc. charge code for Mech vent
          CALL      UPPTFN21          * Update to PATFN2FD
.
          MOVE      ZERO,EXIT
          GOTO      MVHOUR99
.
.         ************ DELETE FORMACTION ***********
.
MVHOUR30  PACK      KEY17,HFUND001,FNEXT006,EFFTDATE,SP70           
          CALL      RDPTFN21
          BRANCH    OVRCD,MVHOUR91
.
          CALL      DEPTFN21
          MOVE      ZERO,EXIT
          GOTO      MVHOUR99
.
.         ************ DISPLAY FORMACTION ***********
.
MVHOUR40  PACK      KEY17,FNEXT001,FNEXT006,FNEXT007,SP70
          CALL      RDPTFN21
          IF        OVRCD=1
            CALL      CLRFNX00            * Clear all the file variables
          ENDIF
.
          CLEAR     WEBTITLE
          MOVE      "HF Mechanical Ventilation  hours Maintenance",WEBTITLE
          RESET     WEBTITLE
.
          CALL      WEBHED00   * Create Output File and Write HTML Page Header
          BRANCH    EXIT,MVHOUR99
          CALL      WEBBOD00   * Process Web Body
          CALL      WEBEND00   * Process End of HTML File
          MOVE      ONE,EXIT
          GOTO      MVHOUR99
.
MVHOUR91  MOVE      "HF MV Hours record does not exist",WEBTITLE
          CALL      WEBERR00
          MOVE      ONE,EXIT
          GOTO      MVHOUR99
.
MVHOUR92  MOVE      "HF MV hours already exists",WEBTITLE
          CALL      WEBERR00
          MOVE      ONE,EXIT
          GOTO      MVHOUR99
.
MVHOUR93  MOVE      "Current Payment Model is still valid.",WEBTITLE
          CALL      WEBERR00
          MOVE      ONE,EXIT
          GOTO      MVHOUR99
.
MVHOUR98  MOVE      "Invalid Form Action.",WEBTITLE
          CALL      WEBERR00
          MOVE      ONE,EXIT
          GOTO      MVHOUR99
.
MVHOUR99  RETURN
+
.------------------------------------------------------------------------------
. HF Date History Maintenance
.------------------------------------------------------------------------------
HFDDHT00  RESET     UPDTTYPE
          MATCH     SP1,UPDTTYPE       * Show history record
          GOTO      HFDDHT30 IF EQUAL
.
          MATCH     "A",UPDTTYPE       * Add new history record
          GOTO      HFDDHT10 IF EQUAL
.
          MATCH     "D",UPDTTYPE       * Mark history record as deleted
          GOTO      HFDDHT20 IF EQUAL
.
          GOTO      HFDDHT90
.
HFDDHT10  PACK      KEY14,PTDDH001,ZERO8,SP70 
          CALL      RDFUND1
.
          COMPARE   NINTY9,HFUND006
          IF        !@EQUAL
            MOVE      HFUND006,HFBAND
          ENDIF
.
          MATCH     SP70,HFUND009
          IF        !@EQUAL
            MOVE      HFUND009,PTHFHGRP
          ENDIF
.
          MATCH     SP70,HFUND010
          IF        !@EQUAL
            MOVE      HFUND010,PTHFHCPE
          ENDIF
.          
          CALL      UPFUND1
.  
          PACK      KEY17,PTDDH001,PTDDH002,PTDDH003,SP1
          CALL      RDPTDDH1
          IF        OVRCD=1
            CALL      CLPATDDH
            CALL      MVPTDH00
.
            MOVE      USERID,PTDDCRBY
            PACK      PTDDCRDT,CCC,CYY,CMM,CDD
            REP       " 0",PTDDCRDT
            CLOCK     TIME,PTDDCRTM
            PACK      KEY17,PTDDFUND,PTDDFTYP,PTDDDTTO,SP70
.
            CALL      WRPTDDH1
          ELSE
            MATCH     PTDDH001,PTDDFUND
            IF        @EQUAL
              MOVE      USERID,PTDDUPBY
              PACK      PTDDUPDT,CCC,CYY,CMM,CDD
              REP       " 0",PTDDUPDT
              CLOCK     TIME,PTDDUPTM
.
              CALL      UPPTDDH1
            ENDIF
          ENDIF
          GOTO      HFDDHT99
.
HFDDHT20  PACK      KEY17,PTDDH001,PTDDH002,PTDDH003,SP1
          CALL      RDPTDDH1
          BRANCH    OVRCD,HFDDHT31
.
          PACK      KEY17,PTDDH001,PTDDH002,PTDDH003,ONE
          CALL      RDPTDDH1
          BRANCH    OVRCD,HFDDHT25
.
          MATCH     "1",PTDDDLEN
          IF        @EQUAL
            GOTO      HFDDHT91
          ENDIF
.
HFDDHT25  MOVE      "1",PTDDDLEN
          CALL      UPPTDDH1
          GOTO      HFDDHT31
.
HFDDHT30  PACK      KEY14,HFUND001,ZERO8,SP70
          CALL      RDFUND1
          IF        OVRCD=1
            CALL      CLRHLT00     * Clear all the file variables
          ENDIF
.
          PACK      KEY6,HFUND001,SP70
          CALL      RDPTFX11
          IF        OVRCD=1
            CALL      CLRHFX00     * Clear all the file variables
          ENDIF
.
HFDDHT31  CLEAR     WEBTITLE
          APPEND    "Health Fund Fields History",WEBTITLE
          APPEND    " (",WEBTITLE
          MOVE      SP70,HFNAMEDP
          MOVE      HFUND001,HFNAMEDP
          SQUEEZE   HFNAMEDP
          APPEND    HFNAMEDP,WEBTITLE
          APPEND    ")",WEBTITLE
          RESET     WEBTITLE
.
          CALL      WEBHED00   * Create Output File and Write HTML Page Header
          BRANCH    EXIT,HFDDHT99
.
          CALL      WEBBOD00   * Process Web Body
.
          CALL      WEBEND00   * Process End of HTML File
.
          MOVE      ONE,EXIT
          GOTO      HFDDHT99
.
HFDDHT90  MOVE      "Invalid Form Action.",WEBTITLE
          CALL      WEBERR00
          MOVE      ONE,EXIT
          GOTO      HFDDHT99
.
HFDDHT91  CLEAR     WEBTITLE
          APPEND    "Duplicate 'Effective To' date entry found. ",WEBTITLE
          APPEND    "Cannot mark as deleted.",WEBTITLE
          CALL      WEBERR00
          MOVE      ONE,EXIT
          GOTO      HFDDHT99
.
HFDDHT99  RETURN
+
.------------------------------------------------------------------------------
. Remote call -> check health fund history fields, and compare entered 
. effective date to previous values 
.------------------------------------------------------------------------------
REMCED00  CALL      XMLHED00
          BRANCH    EXIT,REMCED99
.
          PACK      KEY17,HFUND001,HFFLDTYP,SP70
          CALL      RSPTDDH1
REMCED10  CALL      RKPTDDH1
          BRANCH    OVRCD,REMCED90
.
          MATCH     HFUND001,PTDDFUND
          GOTO      REMCED10 IF NOT EQUAL
.
          MATCH     HFFLDTYP,PTDDFTYP
          GOTO      REMCED10 IF NOT EQUAL
.
          MATCH     SP1,PTDDDLEN     * no future date validation if deleted
          IF        @EQUAL
            MATCH     PTDDDTTO,PTDDH003
            GOTO      REMCED91 IF LESS
          ENDIF
.
          MATCH     PTDDDTTO,PTDDH003
          GOTO      REMCED92 IF EQUAL
.
          GOTO      REMCED10          
.
REMCED90  WRITE     HTMLFILE;"<RETURN_VALUE TYPE=SIMPLE>0</RETURN_VALUE>"
          GOTO      REMCED98
.
REMCED91  WRITE     HTMLFILE;"<RETURN_VALUE TYPE=SIMPLE>1</RETURN_VALUE>"
          GOTO      REMCED98
.
REMCED92  WRITE     HTMLFILE;"<RETURN_VALUE TYPE=SIMPLE>2</RETURN_VALUE>"
.
REMCED98  CALL      XMLEND00
REMCED99  RETURN
+
.------------------------------------------------------------------------------
.         Check if DRG Effective Dates overlap an existing DRG record's dates
.
.           Test Algorithm: 
.             overlap IF ((a.start < b.end) && (b.start < a.end))
.              where a = NEW date range
.                    b = current (record) date range
.
.           Parameters:
.             DRGRTYPE - Record Type
.             DRGKYVAL - Record Key Value
.             DRGVERNO - DRG Version
.             DRGFRDAT - NEW From Date
.             DRGTODAT - NEW To Date 
.
.           Return:
.             EXIT - 0=No overlap; 1=Overlap
.------------------------------------------------------------------------------
CHKDED00  MOVE      ZERO,F1
          MOVE      DRGRTYPE,F1
.
          PACK      DIM42,DRGRTYPE,DRGKYVAL,DRGVERNO,SP70
.
          PACK      KEY42,DRGRTYPE,DRGKYVAL,SP70
          CALL      RSPMEDG2
CHKDED10  CALL      RKPMEDG2
          BRANCH    OVRCD,CHKDED99
.
          PACK      DIM42A,PMEGRTYP,PMEGKEYV,PMEGDRGV,SP70
.
          MATCH     SP70,DRGUPDAT
          IF        !@EQUAL
            MATCH     DIM42A,DIM42
            GOTO      CHKDED10 IF EQUAL
          ENDIF 
.
          MATCH     PMEGRTYP,DRGRTYPE       * Same record type?
          GOTO      CHKDED90 IF NOT EQUAL   * Finished loop; PASS
.
          MATCH     SP70,DRGKYVAL
          IF        @EOS
            MOVE      SP70,DRGKYVAL
          ENDIF
.
          IF        F1=1 | F1=4
            MATCH     PMEGKEYV,DRGKYVAL       * Same key value
            GOTO      CHKDED90 IF NOT EQUAL
.
            MATCH     PMEGDRGV,DRGVERNO
            GOTO      CHKDED20 IF EQUAL
          ELSE
            MATCH     PMEGKEYV,DRGKYVAL       * Same key value
            GOTO      CHKDED90 IF NOT EQUAL   * Finished loop; PASS
          ENDIF
.
          IF        F1<>1 & F1<>4
            MATCH     PMEGDRGV,DRGVERNO       * Same DRG?
            GOTO      CHKDED10 IF EQUAL       * Yes; skip record
          ENDIF
.
CHKDED20  MATCH     PMEGFDAT,DRGFRDAT
          GOTO      CHKDED91 IF EQUAL       * Same From Dates; ERROR
          IF        @LESS
.
.           NEW From Date < Record From Date...
.
            MATCH     SP70,DRGTODAT
            GOTO      CHKDED91 IF EQUAL
            GOTO      CHKDED91 IF EOS
.
            MATCH     PMEGFDAT,DRGTODAT
            GOTO      CHKDED91 IF NOT LESS
          ELSE
.
.           NEW From Date > Record From Date...
.
            MATCH     SP70,PMEGTDAT
            GOTO      CHKDED91 IF EQUAL
            GOTO      CHKDED91 IF EOS
.
            MATCH     PMEGTDAT,DRGFRDAT
            GOTO      CHKDED91 IF LESS
            GOTO      CHKDED91 IF EQUAL
          ENDIF
.
          GOTO      CHKDED10
.
CHKDED90  MOVE      ZERO,EXIT
          GOTO      CHKDED99
.
CHKDED91  MOVE      ONE,EXIT
CHKDED99  RETURN
+
.------------------------------------------------------------------------------
. Remote Script - Check DRG Version record against existing Effective Dates
.------------------------------------------------------------------------------
REMCDE00  CALL      XMLHED00
          BRANCH    EXIT,REMCDE99
.
REMCDE10  CALL      CHKDED00
          BRANCH    EXIT,REMCDE91
.
          WRITE     HTMLFILE;"<RETURN_VALUE TYPE=SIMPLE>0</RETURN_VALUE>"
          GOTO      REMCDE98
.
REMCDE91  WRITE     HTMLFILE;"<RETURN_VALUE TYPE=SIMPLE>1</RETURN_VALUE>"
.
REMCDE98  CALL      XMLEND00
REMCDE99  RETURN
+
.------------------------------------------------------------------------------
. CWO MV DRG Maintenance
.------------------------------------------------------------------------------
PCWOMV00  RESET     UPDTTYPE
          MATCH     SP1,UPDTTYPE       * Display
          GOTO      PCWOMV40 IF EQUAL
.
          MOVE      "001",PMHAT002     * CWO
          IF        IBCNMHOS=1
            MATCH     "All",PMHAT001
            IF        @EQUAL
              MOVE      SP70,PMHAT001  * All Hospital id
            ENDIF
          ELSE
            MOVE      SP70,PMHAT001    * Blank Hospital id
          ENDIF
.
          MATCH     "A",UPDTTYPE       * Add
          GOTO      PCWOMV10 IF EQUAL
.
          MATCH     "U",UPDTTYPE       * Update
          GOTO      PCWOMV20 IF EQUAL
.
          GOTO      PCWOMV90
.
.         Add
.
PCWOMV10  MATCH     SP70,DDRGCODE
          IF        !@EQUAL
            PACK      PMHAT003,HFUND001,DDRGCODE,SP70
          ENDIF
.
          PACK      KEY39,PMHAT001,PMHAT002,PMHAT003,PMHAT004,SP70
          CALL      RDPMHAT1
          COMPARE   ZERO,OVRCD
          GOTO      PCWOMV92 IF EQUAL
.
          MOVE      PMHAT004,VALFDATE
          MOVE      PMHAT005,VALTDATE
          CALL      PMSHATVL                * Validate Effective dates
          BRANCH    EXIT,PCWOMV93,PCWOMV94
.
          CALL      CLPMSHAT
          CALL      MVPMHA00                * move cgi variables
.
          PACK      PMHTCDAT,CURRDATE,SP10
          CLOCK     TIME,PMHTCTIM
          MOVE      USERID,PMHTCUSR
.
          CALL      WRPMHAT1
          MOVE      ZERO,EXIT
          GOTO      PCWOMV99
.
.         Update
.
PCWOMV20  PACK      KEY39,PMHAT001,PMHAT002,PMHAT003,PMHAT004,SP70
          CALL      RDPMHAT1
          BRANCH    OVRCD,PCWOMV91
.
          MOVE      PMHTIND1,KEY1           * Save Active/Inactive indicator
.
          MOVE      PMHAT004,VALFDATE
          MOVE      PMHAT005,VALTDATE
.
          CALL      PMSHATVL                * Validate Effective dates
          BRANCH    EXIT,PCWOMV93,PCWOMV94
.
          PACK      KEY39,PMHAT001,PMHAT002,PMHAT003,PMHAT004,SP70
          CALL      RDPMHAT1
.
          CALL      MVPMHA00                * move cgi variables
.
.         Check if Status has been changed to Inactive
.
          MATCH     PMHTIND1,KEY1
          IF        !@EQUAL
            MATCH     "1",PMHTIND1
            IF        !@EQUAL
              PACK      PMHTFDAT,CURRDATE,SP10    * Change to Inactive
              CLOCK     TIME,PMHTFTIM
              MOVE      USERID,PMHTFUSR
            ELSE
              UNPACK    SP70,PMHTFDAT,PMHTFTIM,PMHTFUSR
            ENDIF
          ENDIF
.
          PACK      PMHTUDAT,CURRDATE,SP10
          CLOCK     TIME,PMHTUTIM
          MOVE      USERID,PMHTUUSR
.
          CALL      UPPMHAT1
          MOVE      ZERO,EXIT
          GOTO      PCWOMV99
.
PCWOMV40  PACK      KEY39,PMHAT001,PMHAT002,PMHAT003,PMHAT004,SP70
          CALL      RDPMHAT1
          IF        OVRCD=1
            CALL      CLPMSHAT
          ENDIF
.
          CLEAR     WEBTITLE
          APPEND    "CWO MV DRG Maintenance",WEBTITLE
          APPEND    SP70,WEBTITLE
          RESET     WEBTITLE
.
          CALL      WEBHED00   * Create Output File and Write HTML Page Header
          BRANCH    EXIT,PCWOMV99
.
          CALL      WEBBOD00   * Process Web Body
          CALL      WEBEND00   * Process End of HTML File
          MOVE      ONE,EXIT
          GOTO      PCWOMV99
.
PCWOMV90  MOVE      "Invalid Form Action.",WEBTITLE
          CALL      WEBERR00
          MOVE      ONE,EXIT
          GOTO      PCWOMV99
.
PCWOMV91  MOVE      "CWO MV DRG record does not exist",WEBTITLE
          CALL      WEBERR00
          MOVE      ONE,EXIT
          GOTO      PCWOMV99
.
PCWOMV92  MOVE      "CWO MV DRG record exists",WEBTITLE
          CALL      WEBERR00
          MOVE      ONE,EXIT
          GOTO      PCWOMV99
.
PCWOMV93  MOVE      "Invalid Effective From/To Date (Overlap).",WEBTITLE
          CALL      WEBERR00
          MOVE      ONE,EXIT
          GOTO      PCWOMV99
.
PCWOMV94  MOVE      "Current MV DRG record is still valid.",WEBTITLE
          CALL      WEBERR00
          MOVE      ONE,EXIT
          GOTO      PCWOMV99
.
PCWOMV99  RETURN
+
.-------------------------------------------------------------------------------
.  Set Parameters for health fund program details
.-------------------------------------------------------------------------------
STHPG000  UNPACK    QRYNAME,KEY5,KEY3
          MOVE      ZERO,F3
          MOVE      KEY3,F3
.
          BRANCH    F3,STHPG010,STHPG020,STHPG030,STHPG040,STHPG050:
                       STHPG060,STHPG070,STHPG080,STHPG090,STHPG100
          GOTO      STHPG999
.
STHPG010  PACK      PMHPG001,QRYDATA,SP70
          GOTO      STHPG999
.
STHPG020  PACK      PMHPG002,QRYDATA,SP70
          GOTO      STHPG999
.
STHPG030  PACK      PMHPG003,QRYDATA,SP70
          GOTO      STHPG999
.
STHPG040  PACK      PMHPG004,QRYDATA,SP70
          GOTO      STHPG999
.
STHPG050  UNPACK    QRYDATA,CDAY,KEY1,MTHNAM3,KEY1,CCENT,CYEAR
          CALL      SETMTH00            * Set CMON from MTHNAM3
          PACK      PMHPG005,CCENT,CYEAR,CMON,CDAY,SP70
          GOTO      STHPG999
.
STHPG060  MOVE      QRYDATA,PMHPG006
          GOTO      STHPG999
.
STHPG070  MOVE      QRYDATA,PMHPG007
          GOTO      STHPG999
.
STHPG080  MOVE      QRYDATA,PMHPG008
          GOTO      STHPG999
.
STHPG090  MOVE      QRYDATA,PMHPG009
          GOTO      STHPG999
.
STHPG100  MOVE      QRYDATA,PMHPG010
          GOTO      STHPG999
.
STHPG999  RETURN
.
.-------------------------------------------------------------------------------
.  Set Parameters for health fund op program details
.-------------------------------------------------------------------------------
STHPO000  UNPACK    QRYNAME,KEY5,KEY3
          MOVE      ZERO,F3
          MOVE      KEY3,F3
.
          BRANCH    F3,STHPO010,STHPO020,STHPO030,STHPO040,STHPO050:
                       STHPO060,STHPO070,STHPO080
          GOTO      STHPO999
.
STHPO010  PACK      PMHPO001,QRYDATA,SP70
          GOTO      STHPO999
.
STHPO020  PACK      PMHPO002,QRYDATA,SP70
          GOTO      STHPO999
.
STHPO030  PACK      PMHPO003,QRYDATA,SP70
          GOTO      STHPO999
.
STHPO040  PACK      PMHPO004,QRYDATA,SP70
          GOTO      STHPO999
.
STHPO050  UNPACK    QRYDATA,CDAY,KEY1,MTHNAM3,KEY1,CCENT,CYEAR
          CALL      SETMTH00            * Set CMON from MTHNAM3
          PACK      PMHPO005,CCENT,CYEAR,CMON,CDAY,SP70
          GOTO      STHPO999
.
STHPO060  MOVE      QRYDATA,PMHPO006
          GOTO      STHPO999
.
STHPO070  MOVE      QRYDATA,PMHPO007
          GOTO      STHPO999
.
STHPO080  MOVE      QRYDATA,PMHPO008
          GOTO      STHPO999
.
STHPO999  RETURN
.
.-------------------------------------------------------------------------------
.  Move cgi to file vars for health fund program details
.-------------------------------------------------------------------------------
MVHPG000  MATCH     Z70,PMHPG001
          IF        !@EQUAL
            MOVE      PMHPG001,PMHPATYP
          ENDIF
.
          MATCH     Z70,PMHPG002
          IF        !@EQUAL
            MOVE      PMHPG002,PMHPCLAM
          ENDIF
.
          MATCH     Z70,PMHPG003
          IF        !@EQUAL
            MOVE      PMHPG003,PMHPFUND
          ENDIF
.
          MATCH     Z70,PMHPG004
          IF        !@EQUAL
            MOVE      PMHPG004,PMHPTABT
          ENDIF
.
          MATCH     Z70,PMHPG005
          IF        !@EQUAL
            MOVE      PMHPG005,PMHPEDAT
          ENDIF
.
          MATCH     Z70,PMHPG006
          IF        !@EQUAL
            MOVE      ZERO,F3
            SQUEEZE   PMHPG006
            MOVE      PMHPG006,F3
            MOVE      F3,PMHPMAXI
          ENDIF
.
          MATCH     Z70,PMHPG007
          IF        !@EQUAL
            MOVE      ZERO,F3
            SQUEEZE   PMHPG007
            MOVE      PMHPG007,F3
            MOVE      F3,PMHPWARI
          ENDIF
.
          MATCH     Z70,PMHPG008
          IF        !@EQUAL
            MOVE      ZERO,F3
            SQUEEZE   PMHPG008
            MOVE      PMHPG008,F3
            MOVE      F3,PMHPMAXO
          ENDIF
.
          MATCH     Z70,PMHPG009
          IF        !@EQUAL
            MOVE      ZERO,F3
            SQUEEZE   PMHPG009
            MOVE      PMHPG009,F3
            MOVE      F3,PMHPWARO
          ENDIF
.
          MATCH     Z70,PMHPG010
          IF        !@EQUAL
            MOVE      PMHPG010,PMHPBRKO
          ENDIF
.
MVHPG999  RETURN
.
.-------------------------------------------------------------------------------
.  Move cgi to file vars for health fund op program details
.-------------------------------------------------------------------------------
MVHPO000  MATCH     Z70,PMHPO001
          IF        !@EQUAL
            MOVE      PMHPO001,PMHOATYP
          ENDIF
.
          MATCH     Z70,PMHPO002
          IF        !@EQUAL
            MOVE      PMHPO002,PMHOCLAM
          ENDIF
.
          MATCH     Z70,PMHPO003
          IF        !@EQUAL
            MOVE      PMHPO003,PMHOFUND
          ENDIF
.
          MATCH     Z70,PMHPO004
          IF        !@EQUAL
            MOVE      PMHPO004,PMHOTABT
          ENDIF
.
          MATCH     Z70,PMHPO005
          IF        !@EQUAL
            MOVE      PMHPO005,PMHOEDAT
          ENDIF
.
          MATCH     Z70,PMHPO006
          IF        !@EQUAL
            MOVE      PMHPO006,PMHOVTYP
          ENDIF
.
          MATCH     Z70,PMHPO007
          IF        !@EQUAL
            MOVE      ZERO,F3
            SQUEEZE   PMHPO007
            MOVE      PMHPO007,F3
            MOVE      F3,PMHOMAXO
          ENDIF
.
          MATCH     Z70,PMHPO008
          IF        !@EQUAL
            MOVE      ZERO,F3
            SQUEEZE   PMHPO008
            MOVE      PMHPO008,F3
            MOVE      F3,PMHOWARO
          ENDIF
.
MVHPO999  RETURN
.
.------------------------------------------------------------
. Link to Next set of Programs
.------------------------------------------------------------
NEXTPR00  MOVE      NORECORD,KEY2
          REP       " +",KEY2
          ASSIGN    STARTNUM+NORECORD,F3
          MOVE      F3,KEY3
          REP       " +",KEY3
          UNPACK    DIM127,D1,FLDPARA,DIM127
          MOVE      REPORTNO,F2
.
          REP       " +",STARTKEY
          REP       " +",FILTATYP
          REP       " +",FILTCLAM
          REP       " +",FILTTABT
          REP       " +",FILTFUND
.
          WRITE     HTMLFILE;"patweb87.pbl":
                                 "?reportno=",F2:
                                 "&template=",FLDPARA:
                                 "&startnum=",KEY3:
                                 "&norecord=",KEY2:
                                 "&startkey=",STARTKEY:
                                 "&filtatyp=",FILTATYP:
                                 "&filtclam=",FILTCLAM:
                                 "&filtfund=",FILTFUND:
                                 "&filttabt=",FILTTABT;
.
          REP       "+ ",STARTKEY
          REP       "+ ",FILTATYP
          REP       "+ ",FILTCLAM
          REP       "+ ",FILTTABT
          REP       "+ ",FILTFUND
.
NEXTPR99  RETURN
.-------------------------------------------------------------------------------
. Link to previous set of Programs
.-------------------------------------------------------------------------------
PREVPR00  MOVE      NORECORD,KEY2
          REP       " +",KEY2
          ASSIGN    STARTNUM-NORECORD,F3
          IF        F3<0
            MOVE    ZERO,F3
          ENDIF
          MOVE      F3,KEY3
          REP       " +",KEY3
          UNPACK    DIM127,D1,FLDPARA,DIM127
          MOVE      REPORTNO,F2
.
          REP       " +",STARTKEY
          REP       " +",FILTATYP
          REP       " +",FILTCLAM
          REP       " +",FILTTABT
          REP       " +",FILTFUND
.
          WRITE     HTMLFILE;"patweb87.pbl":
                                 "?reportno=",F2:
                                 "&template=",FLDPARA:
                                 "&startnum=",KEY3:
                                 "&norecord=",KEY2:
                                 "&startkey=",STARTKEY:
                                 "&filtatyp=",FILTATYP:
                                 "&filtclam=",FILTCLAM:
                                 "&filtfund=",FILTFUND:
                                 "&filttabt=",FILTTABT;
.
          REP       "+ ",STARTKEY
          REP       "+ ",FILTATYP
          REP       "+ ",FILTCLAM
          REP       "+ ",FILTTABT
          REP       "+ ",FILTFUND
.
PREVPR99  RETURN
.
.------------------------------------------------------------
. Link to Next set of OP Programs   
.------------------------------------------------------------
NEXTPO00  MOVE      NORECORD,KEY2
          REP       " +",KEY2
          ASSIGN    STARTNUM+NORECORD,F3
          MOVE      F3,KEY3
          REP       " +",KEY3
          UNPACK    DIM127,D1,FLDPARA,DIM127
.
          REP       " +",STARTKEY
          REP       " +",PMHPATYP
          REP       " +",PMHPCLAM
          REP       " +",PMHPFUND
          REP       " +",PMHPTABT
.
          UNPACK    PMHPEDAT,CCENT,CYEAR,CMON,CDAY
          MOVE      CMON,F2
          LOAD      MTHNAM3,F2,JAN,FEB,MAR,APR,MAY,JUN,JUL,AUG,SEP,OCT,NOV,DEC
          PACK      DISPDATE,CDAY,SP1,MTHNAM3,SP1,CCENT,CYEAR
          REP       " +",DISPDATE
.
          MOVE      REPORTNO,F2
.
          WRITE     HTMLFILE;"patweb87.pbl":
                                 "?reportno=",F2:
                                 "&template=",FLDPARA:
                                 "&startnum=",KEY3:
                                 "&norecord=",KEY2:
                                 "&startkey=",STARTKEY:
                                 "&pmhpg001=",PMHPATYP:
                                 "&pmhpg002=",PMHPCLAM:
                                 "&pmhpg003=",PMHPFUND:
                                 "&pmhpg004=",PMHPTABT:
                                 "&pmhpg005=",DISPDATE;
.
          REP       "+ ",STARTKEY
          REP       "+ ",PMHPATYP
          REP       "+ ",PMHPCLAM
          REP       "+ ",PMHPFUND
          REP       "+ ",PMHPTABT
.
NEXTPO99  RETURN
.-------------------------------------------------------------------------------
. Link to previous set of OP Programs
.-------------------------------------------------------------------------------
PREVPO00  MOVE      NORECORD,KEY2
          REP       " +",KEY2
          ASSIGN    STARTNUM-NORECORD,F3
          IF        F3<0
            MOVE    ZERO,F3
          ENDIF
          MOVE      F3,KEY3
          REP       " +",KEY3
          UNPACK    DIM127,D1,FLDPARA,DIM127
.
          REP       " +",STARTKEY
          REP       " +",PMHPATYP
          REP       " +",PMHPCLAM
          REP       " +",PMHPFUND
          REP       " +",PMHPTABT
.
          UNPACK    PMHPEDAT,CCENT,CYEAR,CMON,CDAY
          MOVE      CMON,F2
          LOAD      MTHNAM3,F2,JAN,FEB,MAR,APR,MAY,JUN,JUL,AUG,SEP,OCT,NOV,DEC
          PACK      DISPDATE,CDAY,SP1,MTHNAM3,SP1,CCENT,CYEAR
          REP       " +",DISPDATE
.
          MOVE      REPORTNO,F2
.
          WRITE     HTMLFILE;"patweb87.pbl":
                                 "?reportno=",F2:
                                 "&template=",FLDPARA:
                                 "&startnum=",KEY3:
                                 "&norecord=",KEY2:
                                 "&startkey=",STARTKEY:
                                 "&pmhpg001=",PMHPATYP:
                                 "&pmhpg002=",PMHPCLAM:
                                 "&pmhpg003=",PMHPFUND:
                                 "&pmhpg004=",PMHPTABT:
                                 "&pmhpg005=",DISPDATE;
.
          REP       "+ ",STARTKEY
          REP       "+ ",PMHPATYP
          REP       "+ ",PMHPCLAM
          REP       "+ ",PMHPFUND
          REP       "+ ",PMHPTABT
.
PREVPO99  RETURN
.
.------------------------------------------------------------
. Program Maintenance
.------------------------------------------------------------
PRTAB000  UNPACK    DIM127,D1,LINKPRG,DIM127
          UNPACK    DIM127,D1,LINKREP,DIM127
          UNPACK    DIM127,D1,LINKTEM,DIM127
.
          CALL      PRHED000      * Output Table Heading
.
          IF        NORECORD=0
            MOVE      PTCNNRTD,NORECORD     * Set Default No Records to Display
          ENDIF
          MOVE      ZERO,RECNUMB
          MOVE      ZERO,DISNUMB
.
          PACK      KEY23,FILTATYP,SP70
          CALL      RSPMHPG1
PRTAB100  CALL      RKPMHPG1
          BRANCH    OVRCD,PRTAB900
.
          MATCH     SP70,FILTATYP
          IF        !@EQUAL
            MATCH     FILTATYP,PMHPATYP
            GOTO      PRTAB999 IF NOT EQUAL
          ENDIF
.
          MATCH     SP70,FILTCLAM
          IF        !@EQUAL
            MATCH     FILTCLAM,PMHPCLAM
            GOTO      PRTAB100 IF NOT EQUAL
          ENDIF
.
          MATCH     SP70,FILTFUND
          IF        !@EQUAL
            MATCH     FILTFUND,PMHPFUND
            GOTO      PRTAB100 IF NOT EQUAL
          ENDIF
.
          MATCH     SP70,FILTTABT
          IF        !@EQUAL
            MATCH     FILTTABT,PMHPTABT
            GOTO      PRTAB100 IF NOT EQUAL
          ENDIF
.
          ADD       ONE,RECNUMB
          IF        STARTNUM>=RECNUMB
            GOTO      PRTAB100
          ENDIF
.
          CALL      PRROWA00                * Program Row
.
          ADD       ONE,DISNUMB
          COMPARE   NORECORD,DISNUMB
          GOTO      PRTAB100 IF NOT EQUAL
          GOTO      PRTAB999
.
PRTAB900  CALL      NOMORE00      * Display No More Records Message
.
PRTAB999  RETURN
.------------------------------------------------------------
. Program Maintenance (TABLE HEADING)
.------------------------------------------------------------
PRHED000  PACK      KEY5,ANSA,SP70
          CALL      RDCODE1
          IF        OVRCD=1
            MOVE      "Admission Type",TDESC
          ENDIF
.
          WRITE     HTMLFILE;"<tr>":
                             "<td class=HeadingCell>":
                             TDESC,"</td>";
.
          PACK      KEY5,ANSC,ANSL,SP70
          CALL      RDCODE1
          IF        OVRCD=1
            MOVE      "Claim Code",TDESC
          ENDIF
.
          WRITE     HTMLFILE;"<td class=HeadingCell>":
                             TDESC,"</td>";
.
          WRITE     HTMLFILE;"<td class=HeadingCell>":
                             "Health Fund Code</td>":
                             "<td class=HeadingCell>":
                             "Health Fund Description</td>":
                             "<td class=HeadingCell>":
                             "Health Fund Table Type</td>":
                             "<td class=HeadingCell>":
                             "Effective Date</td>":
                             "<td class=HeadingCell>":
                             "Max IP Visits</td>":
                             "<td class=HeadingCell>":
                             "Warn IP Visits</td>":
                             "<td class=HeadingCell>":
                             "Breakdown OP Visits</td>":
                             "</tr>"
.
PRHED999  RETURN
.------------------------------------------------------------
. Program Maintenance (TABLE ROW)
.------------------------------------------------------------
PRROWA00  PACK      KEY14,PMHPFUND,ZERO,ZERO,ZERO,ZERO,SP10
          CALL      RDFUND1
          IF        OVRCD=1
            MOVE      PMHPFUND,HFNAME
          ENDIF      
.
          MOVE      SP70,ATYPDESC
          MATCH     SP70,PMHPATYP
          IF        !@EQUAL
            PACK      KEY5,ANSA,SP1,PMHPATYP,SP70
            CALL      RDCODE1
            IF        OVRCD=1
              MOVE      PMHPATYP,TDESC
            ENDIF
            MOVE      TDESC,ATYPDESC
          ENDIF
.
          MOVE      SP70,CLAMDESC
          MATCH     SP70,PMHPCLAM
          IF        !@EQUAL
            PACK      KEY5,ANSC,ANSL,PMHPCLAM,SP70
            CALL      RDCODE1
            IF        OVRCD=1
              MOVE      PMHPCLAM,TDESC
            ENDIF
            MOVE      TDESC,CLAMDESC
          ENDIF
.
          MOVE      SP70,TABTDESC
          MATCH     SP70,PMHPTABT
          IF        !@EQUAL
            PACK      KEY5,ANSH,ANST,PMHPTABT,SP70
            CALL      RDCODE1
            IF        OVRCD=1
              MOVE      PMHPTABT,TDESC
            ENDIF
            MOVE      TDESC,TABTDESC
          ENDIF
.         
          UNPACK    PMHPEDAT,CCENT,CYEAR,CMON,CDAY
          MOVE      CMON,F2
          LOAD      MTHNAM3,F2,JAN,FEB,MAR,APR,MAY,JUN,JUL,AUG,SEP,OCT,NOV,DEC
          PACK      DISPDATE,CDAY,SP1,MTHNAM3,SP1,CCENT,CYEAR
.
          MATCH     "1",PMHPBRKO
          IF        @EQUAL
            MOVE      DYES,KEY3
          ELSE
            MOVE      DNO,KEY3
          ENDIF
.
          WRITE     HTMLFILE;"<tr><td nowrap><A HREF='javascript:ShowDetail44":
                             "(#"",LINKPRG,"#.pbl":
                             "?reportno=",LINKREP:
                             "&template=",LINKTEM:
                             "&pmhpg001=",PMHPATYP:
                             "&pmhpg002=",PMHPCLAM:
                             "&pmhpg003=",PMHPFUND:
                             "&pmhpg004=",PMHPTABT:
                             "&pmhpg005=",DISPDATE,"#")'>":
                             "<img src=../images/MaintenanceIcon.gif hspace=4":
                             " border=0 align=absmiddle></a>":
                             ATYPDESC,"</td>":
                             "<td>",CLAMDESC,"&nbsp;</td>":
                             "<td>",PMHPFUND,"&nbsp;</td>":
                             "<td>",HFNAME,"&nbsp;</td>":
                             "<td>",TABTDESC,"&nbsp;</td>":
                             "<td>",DISPDATE,"&nbsp;</td>":
                             "<td>",PMHPMAXI,"&nbsp;</td>":
                             "<td>",PMHPWARI,"&nbsp;</td>":
                             "<td>",KEY3,"&nbsp;</td>":
                             "</tr>"
.
PRROWA99 RETURN
.
.------------------------------------------------------------
. OP Program Maintenance
.------------------------------------------------------------
PROTB000  UNPACK    DIM127,D1,LINKPRG,DIM127
          UNPACK    DIM127,D1,LINKREP,DIM127
          UNPACK    DIM127,D1,LINKTEM,DIM127
.
          CALL      PROHD000              * Output Table Heading
.
          IF        NORECORD=0
            MOVE      PTCNNRTD,NORECORD     * Set Default No Records to Display
          ENDIF
          MOVE      ZERO,RECNUMB
          MOVE      ZERO,DISNUMB
.
          PACK      KEY26,PMHPATYP,PMHPCLAM,PMHPFUND,PMHPTABT,PMHPEDAT,SP70
          CALL      RSPMHPO1
PROTB100  CALL      RKPMHPO1
          BRANCH    OVRCD,PROTB900
.
          MATCH     PMHPATYP,PMHOATYP
          GOTO      PROTB900 IF NOT EQUAL
.
          MATCH     PMHPCLAM,PMHOCLAM
          GOTO      PROTB900 IF NOT EQUAL
.
          MATCH     PMHPFUND,PMHOFUND
          GOTO      PROTB900 IF NOT EQUAL
.
          MATCH     PMHPTABT,PMHOTABT
          GOTO      PROTB900 IF NOT EQUAL
.
          MATCH     PMHPEDAT,PMHOEDAT
          GOTO      PROTB900 IF NOT EQUAL
.
          ADD       ONE,RECNUMB
          IF        STARTNUM>=RECNUMB
            GOTO      PROTB100
          ENDIF
.
          CALL      PROROW00                * OP Program Row
.
          ADD       ONE,DISNUMB
          COMPARE   NORECORD,DISNUMB
          GOTO      PROTB100 IF NOT EQUAL
          GOTO      PROTB999
.
PROTB900  CALL      NOMORE00           * Display No More Records Message
.
PROTB999  RETURN
.------------------------------------------------------------
. OP Program Maintenance (TABLE HEADING)
.------------------------------------------------------------
PROHD000  WRITE     HTMLFILE;"<tr>":
                             "<td class=HeadingCell>":
                             "Visit Type</td>":
                             "<td class=HeadingCell>":
                             "Max OP Visits</td>":
                             "<td class=HeadingCell>":
                             "Warn OP Visits</td>":
                             "</tr>"
.
PROHD999  RETURN
.------------------------------------------------------------
. OP Program Maintenance (TABLE ROW)
.------------------------------------------------------------
PROROW00  MOVE      SP70,TDESC
          MATCH     SP70,PMHOVTYP
          IF        !@EQUAL
            PACK      KEY5,ANSC,ANSV,PMHOVTYP,SP70
            CALL      RDCODE1
            IF        OVRCD=1
              MOVE      PMHOVTYP,TDESC
            ENDIF
          ENDIF
.
          UNPACK    PMHOEDAT,CCENT,CYEAR,CMON,CDAY
          MOVE      CMON,F2
          LOAD      MTHNAM3,F2,JAN,FEB,MAR,APR,MAY,JUN,JUL,AUG,SEP,OCT,NOV,DEC
          PACK      DISPDATE,CDAY,SP1,MTHNAM3,SP1,CCENT,CYEAR
.
          WRITE     HTMLFILE;"<tr><td nowrap><A HREF='javascript:ShowDetail45":
                             "(#"",LINKPRG,"#.pbl":
                             "?reportno=",LINKREP:
                             "&template=",LINKTEM:
                             "&pmhpg001=",PMHOATYP:
                             "&pmhpg002=",PMHOCLAM:
                             "&pmhpg003=",PMHOFUND:
                             "&pmhpg004=",PMHOTABT:
                             "&pmhpg005=",DISPDATE:
                             "&pmhpo001=",PMHOATYP:
                             "&pmhpo002=",PMHOCLAM:
                             "&pmhpo003=",PMHOFUND:
                             "&pmhpo004=",PMHOTABT:
                             "&pmhpo005=",DISPDATE:
                             "&pmhpo006=",PMHOVTYP,"#")'>":
                             "<img src=../images/MaintenanceIcon.gif hspace=4":
                             " border=0 align=absmiddle></a>":
                             TDESC,"</td>":
                             "<td>",PMHOMAXO,"&nbsp;</td>":
                             "<td>",PMHOWARO,"&nbsp;</td>":
                             "</tr>"
.
PROROW99 RETURN
.
.
.------------------------------------------------------------
. General tags
.------------------------------------------------------------
GTAG0000  BRANCH    FLDITMNO,GTAG0100,GTAG0200,GTAG0300,GTAG0400,GTAG0500:
                             GTAG0600,GTAG0700,GTAG0800,GTAG0900,GTAG1000:
                             GTAG1100,GTAG1200,GTAG1300,GTAG1400,GTAG1500:
                             GTAG1600,GTAG1700,GTAG1800,GTAG1900,GTAG2000:
                             GTAG2100,GTAG2200,GTAG2300
          GOTO      GTAG9999
.
GTAG0100  CALL      NEXTPR00      * Link to Next Program
          GOTO      GTAG9999
.
GTAG0200  CALL      PREVPR00      * Link to Prev Program
          GOTO      GTAG9999
.
GTAG0300  CALL      PRTAB000      * Table of programs
          GOTO      GTAG9999
.
GTAG0400  MOVE      "A ",CATEGORY
          MOVE      FILTATYP,CODE
          CALL      CODITM00
          GOTO      GTAG9999
.
GTAG0500  UNPACK    DIM127,D1,KEY1,DIM127
          MOVE      ZERO,F1
          MOVE      KEY1,F1
          BRANCH    F1,GTAG0510
          WRITE     HTMLFILE;FILTFUND;
          GOTO      PMHP9999
.
GTAG0510  PACK      KEY14,FILTFUND,ZERO,ZERO,ZERO,ZERO,SP10
          CALL      RDFUND1
          IF        OVRCD=0
            WRITE     HTMLFILE;HFNAME;
          ELSE
            WRITE     HTMLFILE;FILTFUND;
          ENDIF
          GOTO      GTAG9999
.
GTAG0600  MOVE      "HT",CATEGORY
          MOVE      FILTTABT,CODE
          CALL      CODITM00
          GOTO      GTAG9999
.
GTAG0700  MOVE      "CL",CATEGORY
          MOVE      FILTCLAM,CODE
          CALL      CODITM00
          GOTO      GTAG9999
.
GTAG0800  CALL      PROTB000      * Table of op programs
          GOTO      GTAG9999
.
GTAG0900  CALL      NEXTPO00      * Link to Next Program
          GOTO      GTAG9999
.
GTAG1000  CALL      PREVPO00      * Link to Prev Program
          GOTO      GTAG9999
.
GTAG1100  WRITE     HTMLFILE;DRGRTYPE;
          GOTO      GTAG9999
.
GTAG1200  WRITE     HTMLFILE;DRGKYVAL;
          GOTO      GTAG9999
.
GTAG1300  WRITE     HTMLFILE;DRGVERNO;
          GOTO      GTAG9999
.
GTAG1400  CLEAR     PAGETITL
          MOVE      DRGRTYPE,FORM1
.
          IF        FORM1=1
            MOVE      DRGHFCOD,D6
            STRIP     D6
            APPEND    "Health Fund DRG Maintenance (",PAGETITL
            APPEND    D6,PAGETITL
            APPEND    ")",PAGETITL
          ENDIF
.
          IF        FORM1=2
            MOVE      DRGCLCOD,D3
            STRIP     D3
            APPEND    "Claim Code DRG Maintenance (",PAGETITL
            APPEND    D3,PAGETITL
            APPEND    ")",PAGETITL
          ENDIF
.
          IF        FORM1=3
            APPEND    "State Default Grouper DRG Version",PAGETITL
          ENDIF
.
          RESET     PAGETITL
          WRITE     HTMLFILE;PAGETITL;
          GOTO      GTAG9999
.
GTAG1500  UNPACK    DIM127,D1,DIM1,DIM127
          MOVE      DIM1,F1
          CLEAR     PAGETITL
.
          IF        F1=1
            APPEND    "Add ",PAGETITL
          ENDIF
          IF        F1=2
            APPEND    "Update ",PAGETITL
          ENDIF
.
          MOVE      DRGRTYPE,FORM1
          IF        FORM1=1 | FORM1=4
            MOVE      DRGHFCOD,D6
            STRIP     D6
            APPEND    "Health Fund DRG (",PAGETITL
            APPEND    D6,PAGETITL
            APPEND    ")",PAGETITL
          ENDIF
.
          IF        FORM1=2 | FORM1=5
            MOVE      DRGCLCOD,D3
            STRIP     D3
            APPEND    "Claim Code DRG (",PAGETITL
            APPEND    D3,PAGETITL
            APPEND    ")",PAGETITL
          ENDIF
.
          IF        FORM1=3 | FORM1=6
            APPEND    "State Default DRG Grouper Version",PAGETITL
          ENDIF
.
          RESET     PAGETITL
          WRITE     HTMLFILE;PAGETITL;
          GOTO      GTAG9999
.
GTAG1600  WRITE     HTMLFILE;DRGHFCOD;      * Health Fund Code for DRG
          GOTO      GTAG9999
.
GTAG1700  WRITE     HTMLFILE;DRGCLCOD;      * Claim Code for DRG
          GOTO      GTAG9999
.
GTAG1800  WRITE     HTMLFILE;DRGSTCOD;      * State Code for DRG
          GOTO      GTAG9999
.
GTAG1900  MOVE      ZERO,F1
          CALL      HSPSEL00           * Hospital Selection List
          GOTO      GTAG9999
.
GTAG2000  CALL      DRGTBL00           * DRG versions table (by DRG version)
          GOTO      GTAG9999
.
GTAG2100  UNPACK    PMEGKEYV,DIM3
          PACK      KEY3,DIM3,SP10
          CALL      RDPTHSP1
          BRANCH    OVRCD,GTAG9999
.
          WRITE     HTMLFILE;PTHSNAME;
          GOTO      GTAG9999
.
GTAG2200  CALL      DRGSTN00
          WRITE     HTMLFILE;DSPDSTAT;
          GOTO      GTAG9999
.
GTAG2300  MOVE      ZERO,F1
          MOVE      ONE,NOALLOPT       * Don't dispaly all option
          CALL      HSPSEL00           * Hospital Selection List
          GOTO      GTAG9999
.
GTAG9999  RETURN
+
.------------------------------------------------------------
. HF On invoice
.------------------------------------------------------------
HLDI0000  BRANCH    FLDITMNO,HLDI0100,HLDI0200,HLDI0300,HLDI0400
          GOTO      HLDI9999
.
HLDI0100  CALL      HITAB000      * Table of HF On Hold Invoice
          GOTO      HLDI9999
.
HLDI0200  CALL      NEXTGR00      * Link to Next HF On hold Inv.
          GOTO      HLDI9999
.
HLDI0300  CALL      PREVGR00      * Link to Last HF On hold Inv.
          GOTO      HLDI9999
.
HLDI0400  UNPACK    DIM127,ANS,KEY1,DIM127
          MOVE      ZERO,F1
          MOVE      KEY1,F1
          BRANCH    F1,HLDI0410
.
          WRITE     HTMLFILE;HFUND001;
          GOTO      HLDI9999
.
HLDI0410  PACK      KEY14,HFUND001,ZERO8,SP70
          CALL      RDFUND1
          IF        OVRCD=0
            WRITE     HTMLFILE;HFNAME;
          ENDIF
          GOTO      HLDI9999
.
HLDI9999  RETURN
+
.------------------------------------------------------------
. Table of HF On Hold Invoice list
.------------------------------------------------------------
HITAB000  UNPACK    DIM127,D1,LINKPRG,DIM127
          UNPACK    DIM127,D1,LINKREP,DIM127
          UNPACK    DIM127,D1,LINKTEM,DIM127
.
          BRANCH    USEFHINV,HITAB999
.
          MOVE      ZERO,OVRCD               * assume file exists
          TRAP      OVERCOND IF IO           * trap for error openning file
          OPEN      PATFHIA3,"patfhiaf"      * open HF On Hold Invoice file
          TRAPCLR   IO
          BRANCH    OVRCD,HITAB999
.
          CALL      HINVHD00      * Output Table Heading (row)
.
          PACK      KEY11,HFUND001,SP70
          CALL      RSPTFHI3
HITAB100  CALL      RKPTFHI3
          BRANCH    OVRCD,HITAB999
.
          MATCH     HFUND001,PTFHHFND
          GOTO      HITAB999 IF NOT EQUAL
.
          UNPACK    PTFHHDAT,CCENT,CYEAR,CMON,CDAY   * To Date (DD MON CCYY)
          MOVE      CMON,F2
          LOAD      MTHNAM3,F2,JAN,FEB,MAR,APR,MAY,JUN,JUL,AUG,SEP,OCT,NOV,DEC
          PACK      DSPDATFR,CDAY,SP1,MTHNAM3,SP1,CCENT,CYEAR
.
          WRITE     HTMLFILE;"<tr>";
.
          IF        IBCNMHOS=1
            MOVE      SP70,PTHSNAME
            MATCH     SP70,PTFHHOSP
            IF        @EQUAL
              WRITE     HTMLFILE;"<td>&nbsp;All</td>";
            ELSE
              PACK      KEY3,PTFHHOSP,SP10
              CALL      RDPTHSP1
              WRITE     HTMLFILE;"<td>&nbsp;",PTHSNAME,"</td>";
            ENDIF
          ENDIF
.
          MOVE      ZERO,F2
          MOVE      PTFHSYST,F2
          MOVE      SP70,VISITDSC            * System indicator
          LOAD      VISITDSC,F2,VISTYEMR,VISTYOUT,VISTYINP
          IF        F2=4
            MOVE      VISTYPPR,VISITDSC
          ENDIF
          WRITE     HTMLFILE;"<td>&nbsp;",VISITDSC,"</td>";
.
          MOVE      "rh",CATEGORY
          MOVE      PTFHHREA,CODE
          CALL      GETCOD00
          MATCH     SP70,TDESC
          IF        @EQUAL
            MOVE      "&nbsp;",TDESC        * description for on hold reason
          ENDIF
          WRITE     HTMLFILE;"<td>&nbsp;",TDESC,"</td>";
.
          UNPACK    SP70,DSPDATFR
          MATCH     SP70,PTFHHDAT
          IF        !@EQUAL & !@EOS
            UNPACK    PTFHHDAT,CCENT,CYEAR,CMON,CDAY   * To Date (DD MON CCYY)
            MOVE      CMON,F2
            LOAD      MTHNAM3,F2,JAN,FEB,MAR,APR,MAY,JUN,JUL,AUG,SEP,OCT,NOV,DEC
            PACK      DSPDATFR,CDAY,SP1,MTHNAM3,SP1,CCENT,CYEAR
          ENDIF
.
          WRITE     HTMLFILE;"<td nowrap><a href='javascript:ShowDetails(":
                             "#"",LINKPRG,"#.pbl":
                             "?reportno=",LINKREP:
                             "&template=",LINKTEM:
                             "&ptfhi001=",PTFHHOSP:
                             "&ptfhi002=",PTFHHFND:
                             "&ptfhi003=",PTFHSYST:
                             "&ptfhi004=",DSPDATFR;
.
          WRITE     HTMLFILE;"#")'>";
.
          WRITE    HTMLFILE;"<img src=../images/MaintenanceIcon.gif hspace=4":
                           " border=0 align=absmiddle></a>":
                           DSPDATFR,"</td>":
                           "<td>&nbsp;",PTFHDESC,"</td>";
.
          WRITE     HTMLFILE;"</tr>";
          GOTO      HITAB100
.
HITAB999  RETURN
+
.------------------------------------------------------------------------------
.         Invoice on Hold Heading (TABLE ROW)
.------------------------------------------------------------------------------
HINVHD00  WRITE     HTMLFILE;"<tr>";
          IF         IBCNMHOS=1
            WRITE     HTMLFILE;"<td class=HeadingCell>&nbsp;Hospital</td>";
          ENDIF
.
          WRITE     HTMLFILE;"<td class=HeadingCell>&nbsp;":
                      "System</td>";
.
          WRITE     HTMLFILE;"<td class=HeadingCell>&nbsp;":
                      "Reason for Hold Invoice</td>":
                      "<td class=HeadingCell>&nbsp;":
                      "Hold Invoice From Date</td>":
                      "<td class=HeadingCell>&nbsp;":
                      "Description for Hold Invoices</td>":
                      "</tr>"
.
HINVHD99  RETURN
+
.------------------------------------------------------------
. Hospital Selection list - default WBSEHOSP
.------------------------------------------------------------
HSPSEL00  BRANCH    NOALLOPT,HSPSEL05
.
          IF        IBCNMHOS=1
            PACK      KEY13,WBSEUID,SP70        
            CALL      RDMLSEC1
            IF        OVRCD=0 
              WRITE     HTMLFILE;"<option value=#"All#">":
                                   "All Hospitals</option>" 
            ENDIF
          ENDIF
.
HSPSEL05  PACK      KEY3,SP70
          CALL      RSPTHSP1
HSPSEL10  CALL      RKPTHSP1
          BRANCH    OVRCD,HSPSEL99
.
          BRANCH    F1,HSPSEL20         
.
          WRITE     HTMLFILE;"<option value=#"",PTHSHOSP,"#"";
          MATCH     WBSEHOSP,PTHSHOSP
          IF        @EQUAL
            WRITE     HTMLFILE;" selected";
          ENDIF
          GOTO      HSPSEL40
.
.         Only display hospitals the User has access to
.
HSPSEL20  IF        IBCNMHOS=1 
            PACK      KEY13,WBSEUID,SP70              * All hospital access
            CALL      RDMLSEC1
            IF        OVRCD=1
              PACK      KEY13,WBSEUID,PTHSHOSP,SP70     * This hospital access
              CALL      RDMLSEC1
              BRANCH    OVRCD,HSPSEL10
            ENDIF
.
            WRITE     HTMLFILE;"<option value=#"",PTHSHOSP,"#"";
.
HSPSEL40    WRITE     HTMLFILE;">",PTHSNAME,"</option>"
            GOTO      HSPSEL10
          ENDIF
.
HSPSEL99  RETURN
+
.------------------------------------------------------------
. HF Mechanical Ventilation Hours
.------------------------------------------------------------
MVHR0000  BRANCH    FLDITMNO,MVHR0100,MVHR0200
          GOTO      MVHR9999
.
MVHR0100  CALL      MVTAB000      * Table of HF MV hours
          GOTO      MVHR9999
.
MVHR0200  UNPACK    DIM127,ANS,KEY1,DIM127
          MOVE      ZERO,F1
          MOVE      KEY1,F1
          BRANCH    F1,MVHR0210
.
          WRITE     HTMLFILE;HFUND001;
          GOTO      MVHR9999
.
MVHR0210  PACK      KEY14,HFUND001,ZERO8,SP70
          CALL      RDFUND1
          IF        OVRCD=0
            WRITE     HTMLFILE;HFNAME;
          ENDIF
          GOTO      MVHR9999
.
MVHR9999  RETURN
+
.------------------------------------------------------------
.         CWO MV DRG
.------------------------------------------------------------
CWOM0000  BRANCH    FLDITMNO,CWOM0100,CWOM0200,CWOM0300
          GOTO      CWOM9999
.
CWOM0100  CALL      CWODR000      * Table of CWO MV DRG
          GOTO      CWOM9999
.
CWOM0200  UNPACK    PMHTKVAL,KEY6,KEY4       * Health fund,DRG Code
.
          UNPACK    DIM127,D1,KEY1,DIM127
          MOVE      ZERO,F1
          MOVE      KEY1,F1
          BRANCH    F1,CWOM0210
.
          WRITE     HTMLFILE;KEY6;           * Health fund
          GOTO      CWOM9999
.
CWOM0210  WRITE     HTMLFILE;KEY4;           * DRG code
          GOTO      CWOM9999
.
CWOM0300  WRITE     HTMLFILE;HFUND001;
          GOTO      CWOM9999
.
CWOM9999  RETURN
+
.------------------------------------------------------------
. Set Discharge DRG Code
.------------------------------------------------------------
KVAL9999  RETURN
+
.------------------------------------------------------------
. Table of HF CWO MV DRG list
.------------------------------------------------------------
CWODR000  BRANCH    NOPMSHAT,CWODR999
.
          UNPACK    DIM127,D1,LINKPRG,DIM127
          UNPACK    DIM127,D1,LINKREP,DIM127
          UNPACK    DIM127,D1,LINKTEM,DIM127
.
          CALL      CWODHD00      * Output Table Heading (row)
.
          MOVE      "001",KEY3    * Discharged DRG code for CWO
          IF        IBCNMHOS=1
            PACK      KEY39,PMHAT001,KEY3,HFUND001,SP70
          ELSE
            PACK      KEY39,SP3,KEY3,HFUND001,SP70
          ENDIF
          CALL      RSPMHAT1
CWODR100  CALL      RKPMHAT1
          BRANCH    OVRCD,CWODR999
.
          IF        IBCNMHOS=1
            MATCH     PMHTHOSP,PMHAT001
            GOTO      CWODR999 IF NOT EQUAL     * different hospital
          ENDIF
.
          MATCH     "001",PMHTTYPE
          GOTO      CWODR999 IF NOT EQUAL
.
          UNPACK    PMHTKVAL,KEY6
          MATCH     HFUND001,KEY6
          GOTO      CWODR999 IF NOT EQUAL       * different health fund
.
          WRITE     HTMLFILE;"<tr>";
.
          IF        IBCNMHOS=1
            MOVE      SP70,PTHSNAME
            MATCH     SP70,PMHTHOSP
            IF        @EQUAL
              WRITE     HTMLFILE;"<td>&nbsp;All</td>";
            ELSE
              PACK      KEY3,PMHTHOSP,SP10
              CALL      RDPTHSP1
              WRITE     HTMLFILE;"<td>&nbsp;",PTHSNAME,"</td>";
            ENDIF
          ENDIF
.
          UNPACK    SP70,DSPDATFR,DSPDATTO
          MATCH     SP70,PMHTSDAT
          IF        !@EQUAL
            UNPACK    PMHTSDAT,CCENT,CYEAR,CMON,CDAY   * To Date (DD MON CCYY)
            MOVE      CMON,F2
            LOAD      MTHNAM3,F2,JAN,FEB,MAR,APR,MAY,JUN,JUL,AUG,SEP,OCT,NOV,DEC
            PACK      DSPDATFR,CDAY,SP1,MTHNAM3,SP1,CCENT,CYEAR
          ENDIF
.
          WRITE     HTMLFILE;"<td nowrap><a href='javascript:ShowDetails(":
                             "#"",LINKPRG,"#.pbl":
                             "?reportno=",LINKREP:
                             "&template=",LINKTEM:
                             "&hfund001=",PTFNHFND:
                             "&pmhat001=",PMHTHOSP:
                             "&pmhat002=",PMHTTYPE:
                             "&pmhat003=",PMHTKVAL:
                             "&pmhat004=",DSPDATFR;
.
          WRITE     HTMLFILE;"#")'>";
.
          MATCH     SP70,PMHTEDAT
          IF        !@EQUAL
            UNPACK    PMHTEDAT,CCENT,CYEAR,CMON,CDAY   * To Date (DD MON CCYY)
            MOVE      CMON,F2
            LOAD      MTHNAM3,F2,JAN,FEB,MAR,APR,MAY,JUN,JUL,AUG,SEP,OCT,NOV,DEC
            PACK      DSPDATTO,CDAY,SP1,MTHNAM3,SP1,CCENT,CYEAR
          ENDIF
.
          MOVE     "Active",KEY8
          MATCH    "1",PMHTIND1
          IF       !@EQUAL
            MOVE     "Inactive",KEY8
          ENDIF
          UNPACK   PMHTKVAL,KEY6,KEY4     * HF,DRG Code
.
          WRITE    HTMLFILE;"<img src=../images/MaintenanceIcon.gif hspace=4":
                           " border=0 align=absmiddle></a>":
                           "CWO</td>":
                           "<td>&nbsp;",KEY4,"</td>":
                           "<td>&nbsp;",DSPDATFR,"</td>":
                           "<td>&nbsp;",DSPDATTO,"</td>":
                           "<td>&nbsp;",KEY8,"</td>";
.
          WRITE     HTMLFILE;"</tr>";
.
          GOTO      CWODR100
.
CWODR999  RETURN
+
.------------------------------------------------------------------------------
.         HF CWO MV DRG Heading (TABLE ROW)
.------------------------------------------------------------------------------
CWODHD00  WRITE     HTMLFILE;"<tr>";
          IF         IBCNMHOS=1
            WRITE     HTMLFILE;"<td class=HeadingCell>&nbsp;Hospital</td>";
          ENDIF
.
          WRITE     HTMLFILE;"<td class=HeadingCell>&nbsp;":
                      "Payment Model</td>":
                      "<td class=HeadingCell>":
                      "Discharge DRG</td>":
                      "<td class=HeadingCell>":
                      "Effective From Date</td>":
                      "<td class=HeadingCell>":
                      "Effective To Date</td>":
                      "<td class=HeadingCell>":
                      "Active/Inactive</td>":
                      "</tr>"
.
CWODHD99  RETURN
+
.------------------------------------------------------------
. Table of HF Mechanical Ventilation hours list
.------------------------------------------------------------
MVTAB000  CALL      MVHRHD00      * Output Table Heading (row)
          BRANCH    MVHRFLAG,MVTAB999
.
          UNPACK    DIM127,D1,LINKPRG,DIM127
          UNPACK    DIM127,D1,LINKREP,DIM127
          UNPACK    DIM127,D1,LINKTEM,DIM127
.
.         Display blank Effective todate on top if exists
.
          MOVE      ZERO,RECCNT
          MOVE      ONE,F1
          PACK      KEY9,HFUND001,SP70
          PACK      KEY17,HFUND001,SP70
          MOVE      SP70,PTHSHOSP
.
.         Display default first (blank Hospital and blank Eff.todate)
.
          GOTO      MVTAB300
.
.         loop through hospital file to get hospital id.
.
MVTAB100  BRANCH    RECCNT,MVTAB200
          MOVE      SP70,KEY3
          CALL      RSPTHSP1
MVTAB200  CALL      RKPTHSP1
          BRANCH    OVRCD,MVTAB999
.
          MOVE      ONE,F1
          MOVE      ONE,RECCNT
          PACK      KEY9,HFUND001,PTHSHOSP,SP70
          PACK      KEY17,HFUND001,PTHSHOSP,SP70
.
MVTAB300  CALL      RDPTFN21
          IF        OVRCD=0
            COMPARE   ZERO,PTFNBMVH
            GOTO      MVTAB700 IF NOT EQUAL
          ENDIF
          MOVE      ZERO,F1
.
.         Display MV record from the latest Effective todate
.
MVTAB400  PACK      KEY17,KEY9,Z70
          CALL      RSPTFN21
MVTAB600  CALL      RPPTFN21
          BRANCH    OVRCD,MVTAB800
.
          MATCH     HFUND001,PTFNHFND
          GOTO      MVTAB800 IF NOT EQUAL       * different health fund
.
          IF        IBCNMHOS=1
            MATCH     PTFNHOSP,PTHSHOSP
            GOTO      MVTAB800 IF NOT EQUAL     * different hospital
          ENDIF
.
          BRANCH    PTFNBMVH,MVTAB620,MVTAB620        * EPM/CWO
          GOTO      MVTAB600
.
MVTAB620  MATCH     SP70,PTFNEDAT
          GOTO      MVTAB600 IF EQUAL          * Current record
.
MVTAB700  MOVE      SP70,DSPDATFR
          MATCH     SP70,PTFNEDAT
          IF        !@EQUAL
            UNPACK    PTFNEDAT,CCENT,CYEAR,CMON,CDAY   * To Date (DD MON CCYY)
            MOVE      CMON,F2
            LOAD      MTHNAM3,F2,JAN,FEB,MAR,APR,MAY,JUN,JUL,AUG,SEP,OCT,NOV,DEC
            PACK      DSPDATFR,CDAY,SP1,MTHNAM3,SP1,CCENT,CYEAR
          ENDIF
.
          WRITE     HTMLFILE;"<tr>";
.
          IF        IBCNMHOS=1
            MOVE      SP70,PTHSNAME
            MATCH     SP70,PTFNHOSP
            IF        @EQUAL
              WRITE     HTMLFILE;"<td>&nbsp;All</td>";
            ELSE
              PACK      KEY3,PTFNHOSP,SP10
              CALL      RDPTHSP1
              WRITE     HTMLFILE;"<td>&nbsp;",PTHSNAME,"</td>";
            ENDIF
          ENDIF
.
          WRITE     HTMLFILE;"<td nowrap><a href='javascript:ShowDetails(":
                             "#"",LINKPRG,"#.pbl":
                             "?reportno=",LINKREP:
                             "&template=",LINKTEM:
                             "&hfund001=",PTFNHFND:
                             "&fnext006=",PTFNHOSP:
                             "&fnext007=",DSPDATFR;
.
          WRITE     HTMLFILE;"#")'>";
.
          MOVE      SP70,KEY3
          IF        PTFNBMVH=1
            MOVE      "EPM",KEY3            * Payment Model
          ELSE
            IF        PTFNBMVH=2
              MOVE      "CWO",KEY3
            ENDIF
          ENDIF
.
          WRITE    HTMLFILE;"<img src=../images/MaintenanceIcon.gif hspace=4":
                           " border=0 align=absmiddle></a>":
                           KEY3,"</td>":
                           "<td>&nbsp;",PTFNHRMV,"</td>":
                           "<td>&nbsp;",PTFNMVRT,"</td>":
                           "<td>&nbsp;",PTFNMVBC,"</td>":
                           "<td>&nbsp;",DSPDATFR,"</td>";
.
          WRITE     HTMLFILE;"</tr>";
          IF        F1=1
            MOVE      ZERO,F1
            GOTO      MVTAB400
          ENDIF
          GOTO      MVTAB600
.
MVTAB8000 BRANCH    IBCNMHOS,MVTAB100     * try next hospital
.
MVTAB999  RETURN
+
.------------------------------------------------------------------------------
.         HF Mechanical Ventilation hours Heading (TABLE ROW)
.------------------------------------------------------------------------------
MVHRHD00  WRITE     HTMLFILE;"<tr>";
          IF         IBCNMHOS=1
            WRITE     HTMLFILE;"<td class=HeadingCell>&nbsp;Hospital</td>";
          ENDIF
.
          WRITE     HTMLFILE;"<td class=HeadingCell>&nbsp;":
                      "Payment Model</td>":
                      "<td class=HeadingCell>":
                      "Hours of Mech.Vent.Day</td>":
                      "<td class=HeadingCell>":
                      "MV Daily Rate</td>":
                      "<td class=HeadingCell>":
                      "MV Misc.Charge Code</td>":
                      "<td class=HeadingCell>":
                      "Effective To</td>":
                      "</tr>"
.
MVHRHD99  RETURN
+
.------------------------------------------------------------------------------
.         HF History Table Heading and Rows
.------------------------------------------------------------------------------
HFTBLS00  PACK      KEY17,HFUND001,HFFLDTYP,SP70
          CALL      RSPTDDH1
HFTBLS10  CALL      RKPTDDH1
          BRANCH    OVRCD,HFTBLS99
.
          MATCH     PTDDFUND,HFUND001
          GOTO      HFTBLS99 IF NOT EQUAL      * Different HF
.
          MATCH     HFFLDTYP,PTDDFTYP
          IF        !@EQUAL
            MATCH     SP70,HFFLDTYP
            IF        !@EQUAL
              GOTO      HFTBLS10
            ENDIF
          ENDIF     
.
          WRITE     HTMLFILE;"<tr><td>";
          MATCH     "1",PTDDDLEN
          IF        !@EQUAL
            WRITE     HTMLFILE;"<a href=#"javascript:deleteAudit('";
            WRITE     HTMLFILE;PTDDFUND;
            WRITE     HTMLFILE;"','";
            WRITE     HTMLFILE;PTDDFTYP;
            WRITE     HTMLFILE;"','";
            WRITE     HTMLFILE;PTDDDTTO;
            WRITE     HTMLFILE;"')#",>";
            WRITE     HTMLFILE;"<img src='../images/MaintenanceIcon.gif' ";
            WRITE     HTMLFILE;"class='Icon'></a>";
          ENDIF
.
          CALL      HFSTRK00
.
          MOVE      PTDDFTYP,NUMFLTYP
          BRANCH    NUMFLTYP,HFTBLS20,HFTBLS30,HFTBLS40
.
HFTBLS20  WRITE     HTMLFILE;"HCP Equivalent";
          GOTO      HFTBLS50
.
HFTBLS30  WRITE     HTMLFILE;"Health Fund Group";
          GOTO      HFTBLS50 
.
HFTBLS40  WRITE     HTMLFILE;"Theatre Charging Indicator";
          GOTO      HFTBLS50
.
HFTBLS50  CALL      HFSTRK50
.
          WRITE     HTMLFILE;"</td><td>";
.
          UNPACK    PTDDDTTO,CCENT,CYEAR,CMON,CDAY
          MOVE      CMON,F2
          LOAD      MTHNAM3,F2,JAN,FEB,MAR,APR,MAY,JUN,JUL,AUG,SEP,OCT,NOV,DEC
          CALL      HFSTRK00
          WRITE     HTMLFILE;CDAY,SP1,MTHNAM3,SP1,CCENT,CYEAR;
          CALL      HFSTRK50
.
          WRITE     HTMLFILE;"</td><td>";
          CALL      HFSTRK00
.          MATCH     "01",PTDDFTYP
.          IF        @EQUAL
.            WRITE     HTMLFILE;PTDDFLD1;
.          ELSE 
            WRITE     HTMLFILE;PTDDCFD1;
.          ENDIF
          CALL      HFSTRK50
          WRITE     HTMLFILE;"</td></tr>";
          GOTO      HFTBLS10
.
HFTBLS99  RETURN
+
.------------------------------------------------------------------------------
.         HF History Parameters
.------------------------------------------------------------------------------
HFHT0000  BRANCH    FLDITMNO,HFHT0010,HFHT0020,HFHT0030,HFHT0040,HFHT0050:
                             HFHT0060,HFHT0070,HFHT0080,HFHT0090,HFHT0100
          GOTO      HFHT9999
.
HFHT0010  WRITE     HTMLFILE;PTDDH002;
          GOTO      HFHT9999
.
HFHT0020  MOVE      PTDDH002,FLDNUMNA
          BRANCH    FLDNUMNA,HFHT0025,HFHT0026,HFHT0027
          GOTO      HFHT9999
.
HFHT0025  WRITE     HTMLFILE;"HCP Equivalent";
          GOTO      HFHT9999
.
HFHT0026  WRITE     HTMLFILE;"HF Group";
          GOTO      HFHT9999
.
HFHT0027  WRITE     HTMLFILE;"Theatre Charging Indicator";
          GOTO      HFHT9999
.
HFHT0030  WRITE     HTMLFILE;HCODE;
          GOTO      HFHT9999
.
HFHT0040  WRITE     HTMLFILE;PTDDH004;
          GOTO      HFHT9999
.
HFHT0050  WRITE     HTMLFILE;PTDDH006;
          GOTO      HFHT9999
.
HFHT0060  CALL      HFTBLS00
          GOTO      HFHT9999
.
HFHT0070  WRITE     HTMLFILE;HFUND006;
          GOTO      HFHT9999
.
HFHT0080  WRITE     HTMLFILE;HFUND009;
          GOTO      HFHT9999
.
HFHT0090  WRITE     HTMLFILE;HFUND010;
          GOTO      HFHT9999
.
HFHT0100  WRITE     HTMLFILE;HFFLDTYP;
          GOTO      HFHT9999
.
HFHT9999  RETURN
+
.------------------------------------------------------------------------------
. Function to allow striking of text
.------------------------------------------------------------------------------
HFSTRK00  MATCH     "1",PTDDDLEN
          IF        @EQUAL
            WRITE     HTMLFILE;"<s>";
          ENDIF
          GOTO      HFSTRK99
.
HFSTRK50  MATCH     "1",PTDDDLEN
          IF        @EQUAL
            WRITE     HTMLFILE;"</s>";
          ENDIF
          GOTO      HFSTRK99
.
HFSTRK99  RETURN
.------------------------------------------------------------------------------
.         Display Table of DRG Versions for corresponding Record Type
.------------------------------------------------------------------------------
DRGTBL00  UNPACK    DIM127,D1,LINKPRG,DIM127
          UNPACK    DIM127,D1,LINKREP,DIM127
          UNPACK    DIM127,D1,LINKTEM,DIM127
.
          CALL      DRGTHD00      * Output Table Heading (row)
.
          PACK      KEY42,SP70
          CALL      RSPMEDG2
DRGTBL10  CALL      RKPMEDG2
          BRANCH    OVRCD,DRGTBL99
.
          MOVE      PMEGRTYP,F1     * Record Type (Health Fund, Claim Code, etc)
.
          MOVE      DRGRTYPE,FORM1     * List Record Type
.
          IF        FORM1=1
            IF        F1=1 | F1=4
              UNPACK    PMEGKEYV,D3,D6      * Extract Health Fund code
              MATCH     D6,DRGHFCOD         * Match against the list HF Code
              GOTO      DRGTBL11 IF EQUAL
            ENDIF
          ENDIF
.
          IF        FORM1=2
            IF        F1=2 | F1=5
              UNPACK    PMEGKEYV,D3,DIM3    * Extract Claim Code
              MATCH     DIM3,DRGCLCOD       * Match against the list Claim Code
              GOTO      DRGTBL11 IF EQUAL
            ENDIF
          ENDIF
.
          IF        FORM1=3
            IF        F1=3 | F1=6
              GOTO      DRGTBL11
            ENDIF
          ENDIF
.
          GOTO      DRGTBL10
.
DRGTBL11 WRITE     HTMLFILE;"<tr><td nowrap><a href='javascript:ShowDetails(":
                             "#"",LINKPRG,"#.pbl":
                             "?reportno=",LINKREP:
                             "&template=",LINKTEM:
                             "&drgrtype=",PMEGRTYP:
                             "&drgkyval=",PMEGKEYV:
                             "&drgverno=",PMEGDRGV;
.
          IF        FORM1=1 | FORM1=4
            WRITE     HTMLFILE;"&drghfcod=",DRGHFCOD;
          ENDIF
.
          IF        FORM1=2 | FORM1=5
            WRITE     HTMLFILE;"&drgclcod=",DRGCLCOD;
          ENDIF
.
          WRITE     HTMLFILE;"#")'>";
.
          MOVE      PMEGDRGV,DRGVERS
          CALL      DRGVER00
          WRITE     HTMLFILE;"<img src=../images/MaintenanceIcon.gif hspace=4":
                             " border=0 align=absmiddle></a>",DRGVERST,"</td>";
.
          IF        F1=1 | F1=4
            MOVE      SP70,PTHSNAME
            UNPACK    PMEGKEYV,DIM3
            PACK      KEY3,DIM3,SP10
            CALL      RDPTHSP1
            WRITE     HTMLFILE;"<td>&nbsp;",PTHSNAME,"</td>";
          ENDIF
.
          IF        F1=3 | F1=6
            CALL      DRGSTN00
            WRITE     HTMLFILE;"<td>&nbsp;",DSPDSTAT,"</td>";
          ENDIF
.
          UNPACK    SP70,DSPDATFR,DSPDATTO
          MATCH     SP70,PMEGFDAT
          IF        !@EQUAL & !@EOS
            UNPACK    PMEGFDAT,CCENT,CYEAR,CMON,CDAY   * To Date (DD MON CCYY)
            MOVE      CMON,F2
            LOAD      MTHNAM3,F2,JAN,FEB,MAR,APR,MAY,JUN,JUL,AUG,SEP,OCT,NOV,DEC
            PACK      DSPDATFR,CDAY,SP1,MTHNAM3,SP1,CCENT,CYEAR
          ENDIF
.
          MATCH     SP70,PMEGTDAT
          IF        !@EQUAL & !@EOS
            UNPACK    PMEGTDAT,CCENT,CYEAR,CMON,CDAY   * To Date (DD MON CCYY)
            MOVE      CMON,F2
            LOAD      MTHNAM3,F2,JAN,FEB,MAR,APR,MAY,JUN,JUL,AUG,SEP,OCT,NOV,DEC
            PACK      DSPDATTO,CDAY,SP1,MTHNAM3,SP1,CCENT,CYEAR
          ENDIF
.
          WRITE     HTMLFILE;"<td>&nbsp;",DSPDATFR,"</td>":
                             "<td>&nbsp;",DSPDATTO,"</td>":
                             "<td>&nbsp;",PMEGPYCD,"</td>";
.
          WRITE     HTMLFILE;"</tr>";
          GOTO      DRGTBL10
.
DRGTBL99  RETURN
+
.------------------------------------------------------------------------------
.         DRG Versions Heading (TABLE ROW)
.------------------------------------------------------------------------------
DRGTHD00  WRITE     HTMLFILE;"<tr>":
                      "<td class=HeadingCell width=15%>&nbsp;DRG Version</td>";
.
          MOVE      DRGRTYPE,FORM1
          IF        FORM1=1
            WRITE     HTMLFILE;"<td class=HeadingCell>&nbsp;Hospital</td>";
          ENDIF
.
          IF        FORM1=3
            WRITE     HTMLFILE;"<td class=HeadingCell>&nbsp;State</td>";
          ENDIF
.
          WRITE     HTMLFILE;"<td class=HeadingCell>&nbsp;Effective From</td>":
                      "<td class=HeadingCell>&nbsp;Effective To</td>":
                      "<td class=HeadingCell>&nbsp;3M Pay Code</td>":
                      "</tr>"
.
DRGTHD99  RETURN
+
.------------------------------------------------------------------------------
.         Gets the matching DRG Version number from DRG Version Code (DRGVERS)
.
.         Parameters:
.           DRGVERS - DRG Version Code
.
.         Return:
.           DRGVERST - DRG Version number
.------------------------------------------------------------------------------
DRGVER00  MOVE      "N/A ",DRGVERST
.
          MATCH     DRG041,DRGVERS
          IF        @EQUAL
            MOVE      "4.1 ",DRGVERST
            GOTO      DRGVER99
          ENDIF
.
          MATCH     DRG042,DRGVERS
          IF        @EQUAL
            MOVE      "4.2 ",DRGVERST
            GOTO      DRGVER99
          ENDIF
.
          MATCH     DRG050,DRGVERS
          IF        @EQUAL
            MOVE      "5.0 ",DRGVERST
            GOTO      DRGVER99
          ENDIF
.
          MATCH     DRG051,DRGVERS
          IF        @EQUAL
            MOVE      "5.1 ",DRGVERST
            GOTO      DRGVER99
          ENDIF
.
          MATCH     DRG052,DRGVERS
          IF        @EQUAL
            MOVE      "5.2 ",DRGVERST
            GOTO      DRGVER99
          ENDIF
.
          MATCH     DRG060,DRGVERS
          IF        @EQUAL
            MOVE      "6.0 ",DRGVERST
            GOTO      DRGVER99
          ENDIF
.
          MATCH     DRG062,DRGVERS
          IF        @EQUAL
            MOVE      "6.2 ",DRGVERST
            GOTO      DRGVER99
          ENDIF
.
          MATCH     DRG070,DRGVERS
          IF        @EQUAL
            MOVE      "7.0 ",DRGVERST
            GOTO      DRGVER99
          ENDIF
.
          MATCH     DRG080,DRGVERS
          IF        @EQUAL
            MOVE      "8.0 ",DRGVERST
            GOTO      DRGVER99
          ENDIF
.
          MATCH     DRG090,DRGVERS
          IF        @EQUAL
            MOVE      "9.0 ",DRGVERST
            GOTO      DRGVER99
          ENDIF
.
          MATCH     DRG100,DRGVERS
          IF        @EQUAL
            MOVE      "10.0",DRGVERST
            GOTO      DRGVER99
          ENDIF
.
          MATCH     DRG110,DRGVERS
          IF        @EQUAL
            MOVE      "11.0",DRGVERST
            GOTO      DRGVER99
          ENDIF
.
          MATCH     DRG120,DRGVERS
          IF        @EQUAL
            MOVE      "12.0",DRGVERST
            GOTO      DRGVER99
          ENDIF
.
DRGVER99  RETURN
+
.------------------------------------------------------------------------------
.         Gets the State Name from the DRG Key Value (PMEGKEYV)
.
.         Parameters:
.           PMEGKEYV - DRG Key Value
.
.         Return:
.           DSPDSTAT - State Name (display)
.------------------------------------------------------------------------------
DRGSTN00  UNPACK    PMEGKEYV,DIM3,D1
          MOVE      SP70,DSPDSTAT
.
          MATCH     SP1,D1
          GOTO      DRGSTN99 IF EQUAL
.          
          MOVE      STATNONE,DSPDSTAT     * Default 'Not Aust' state
          MOVE      ZERO,F1
          MOVE      D1,F1
.
          LOAD      DSPDSTAT,F1,STATENZ,STATENSW,STATEVIC,STATEQLD,STATESA:
                                STATEWA,STATETAS,STATENT,STATEACT
.
DRGSTN99  RETURN
+
.------------------------------------------------------------
.                       RUNHLD00
.   Schedule update of health fund invoice pending on hold     
.------------------------------------------------------------
RUNHLD00  MOVE      "IBAADT62",SCHDPGID
          MOVE      "Update Health Fund Invoice Pending",SCHDDESC
          PACK      SCHDDATE,CURRDATE,SP10  
          CLOCK     TIME,SCHDTIME
          MOVE      "S",SCHDPRNT             * Spool File
.
.         Write Keyin parameters for Extract
.
          MOVE      ONE,KEYSTARR[1]
          MOVE      HCODE,KEYSTARR[2]    
          MOVE      SAVEREAS,KEYSTARR[3]
          MOVE      ANSY,KEYSTARR[4]
          MOVE      FOUR,KEYSTCNT               * Number of Keyins
.
          CALL      SCHPRO00   * Schedule Extract
.
RUNHLD99  RETURN
.
.------------------------------------------------------------
. NOMORE00 - Display "No more records" at end of list
.------------------------------------------------------------
NOMORE00  WRITE     HTMLFILE;"<tr>":
                             "<td class=RedCell colspan=20 align=center>":
                             "No more records</td>"
.
NOMORE99  RETURN
+
.------------------------------------------------------------
          INC       IBAWEBCD
          INC       PATKIOPR
.
          INC       BOKLETIO/INC   * Booking Letter
          INC       BOKLTLIO/INC   * Booking Letter List Index
          INC       BOKLTSIO/INC   * Booking Letter Selection Criteria
          INC       BOKRC1IO/INC   * Booking Table
.
          INC       EMRVISIO/INC   * Emergency Visit Table
          INC       EMRTRFIO/INC   * Emergency Triage Fee Table
.
          INC       PATALWIO/INC   * IO Allowance Code File
          INC       PATHGPIO/INC   * Patient Health Fund Group File IO
          INC       PATIN1IO/INC   * Patient Insurance File IO
          INC       PATFMOIO/INC   * Patient Moeity File IO
          INC       PATFN1IO/INC   * Patient Health Fund File IO
          INC       PATFX1IO/INC   * Patient Health Fund Extension File IO
          INC       PATFN2IO/INC   * Patient Health Fund Extension File IO
          INC       PATFCMIO/INC   * Patient Health Fund Comments IO
          INC       PATKHFIO/INC   * Health Fund Tables Key Words
          INC       PATKICIO/INC   * Insurance Key Words Table
          INC       PATILTIO/INC   * Inpatient Letters
          INC       PATDRGIO/INC   * Period Date Range IO
          INC       PATASDIO/INC
          INC       PATCMCIO/INC
          INC       PATHLFIO/INC
          INC       PATHDFIO/INC
          INC       PATINVIO/INC
          INC       PATSRBIO/INC
          INC       PMSSINIO/INC
          INC       PATBFEIO/INC
          INC       PMSLSTIO/INC
          INC       PMSLETIO/INC
          INC       PATMA1IO/INC
          INC       PATHSPIO/INC
          INC       PATMI1IO/INC
          INC       PATDSCIO/INC
          INC       PATVISIO/INC
          INC       PMSPX2IO/INC
          INC       PATDO1IO/INC
          INC       OUTSITIO/INC
          INC       PATWR1IO/INC
          INC       PATALRIO/INC
          INC       MRTMASIO/INC
          INC       PMSUCHIO/INC
          INC       PMSUCDIO/INC
          INC       PMSVSCIO/INC
          INC       PMSVSTIO/INC
          INC       PMSVMTIO/INC
          INC       PMSUKIIO/INC       * Key Words file for Value Set ID
          INC       PATDLTIO/INC
          INC       PATPR1IO/INC
          INC       PMSLLFIO/INC
          INC       PMSLTFIO/INC
          INC       PATFHIIO/INC
          INC       PATLHIIO/INC
          INC       PATFLTIO/INC   * Financial Letters
          INC       OUTADLIO/INC   * Adhoc Letters
          INC       OUTLADIO/INC   * Adhoc Letters List
          INC       RCPCIDIO/INC   * Receipting Cashier Details
          INC       OUTBOAIO/INC  
          INC       OUTBB1IO/INC  
          INC       OUTCANIO/INC
          INC       OUTCLIIO/INC   * Clinic file
          INC       OUTCTYIO/INC   * Clinic type  file
          INC       OUTLETIO/INC   * Outpatient Letters file
          INC       PRIPRAIO/INC   * Private Practice Medical Practice
          INC       PATMESIO/INC   * Patient Invoice Messages (patmesgf)
          INC       PATINMIO/INC   * Patient Invoice Messages (patinmaf)
          INC       PATPARIO/INC
          INC       PRIREMIO/INC   * Private Practice Reminder Accounts 
          INC       PRIRELIO/INC   * Private Practice ReminderSelection List 
.
          INC       PRIDOCIO/INC   * Private Practice Doctors
.          INC       PRIDBTIO/INC   * Private Practice Debtor
          INC       PRIFLTIO/INC   * Private Practice Financial Letters
          INC       PRIGLSIO/INC   * Private Practice General Letters
          INC       PRIGSLIO/INC   * Private Practice General Selection List
          INC       PRIFLSIO/INC   * Private Practice Financial Letters
          INC       PRIFSLIO/INC   * Private Practice Financial Selection List 
          INC       PMSDLTIO/INC
          INC       PMSDSLIO/INC
          INC       PMSHATIO/INC
          INC       PMSHPGIO/INC
          INC       PMSHPOIO/INC
          INC       PMSUPGIO/INC
          INC       PMSUPOIO/INC
          INC       PMSVX1IO/INC
          INC       PMSHCPIO/INC
          INC       PRIHDBIO/INC   * Private Practice Holding Header
          INC       NHIMASIO/INC
          INC       NHIETHIO/INC
          INC       PATNIPIO/INC   * Outpatient billing 
          INC       PATMCHIO/INC   
          INC       PATDDHIO/INC
          INC       PRILETIO/INC                  * Letter file
          INC       MLTSECIO/INC
          INC       PMSEDGIO/INC   * Effective DRG Versions
          INC       WEBPARIO/INC
          INC       CLNHIMAS
          INC       CLPMSHAT
          INC       CLPMSHPG
          INC       CLPMSHPO
          INC       CLPMSUPO
          INC       CLPMSEDG
	  INC       CLPATDDH
          INC       CLPATFHI
.
          INC       PATMASTM
          INC       PMSHATVL
.
          INC       PATKHFPR       * Health Fund Tables Key Word Pro-
          INC       DAYOFWEK
          INC       WEBDATCD
          INC       RSHWEBCD
          INC       PATDOCTM
          INC       PATDOCCD
          INC       PATMCHRD                * Miscellaneous Charges read routine
          INC       PMSDLTTM
          INC       PMSLETTM
          INC       PMSLTFTM
          INC       PMSHPGTM
          INC       PMSHPOTM
          INC       OUTADLTM
          INC       PRIREMTM
          INC       PRIGLSTM
          INC       PRIFLSTM
          INC       PMSEDGTM       * Effective DRG Versions
          INC       PMSVSCTM
          INC       PMSVSTTM
          INC       PMSVMTTM
          INC       PATFHITM
          INC       PATDDHTM
          INC       PMSUKIPR       * Value Set Code Key Word Proc
          INC       PATFN2RD
          INC       PATFN2TM
          INC       PMSHATTM
.
          INC       CALCAGE
          INC       PATNAMCD
          INC       NAMSTRCD
