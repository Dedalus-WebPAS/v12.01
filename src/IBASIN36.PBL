.-------------------------------------------------------
          INC       STDGENDF     * Required Include
.
VERSION   INIT      "V12.01.00"
.-------------------------------------------------------
. V10.02.01 19.05.2011 Sandra Barcham   239574
.           New printer/department table mods
.-------------------------------------------------------
. V9.04.01  08/04/2005  Peter Vela CAR 59696
.           Changed commodity group from DIM 5 to DIM 6
. V9.03.02  19.06.2003 Mike Laming CAR 40483
.           Add code to left align Catalogue No in Export file if
.           indicator SNCOCAT6 is on.
. V9.03.01  10.06.2003 Mike Laming CAR 39665
.           Add read to SINCIEFD to suppress printing by warehouse
.           where Ind. set (SUPCATYN) and Item is suspended (SIIESUS)
.-------------------------------------------------------
. V9.02.00  03.05.2002  Glenn Saunders
.           Export to new release i.e. v9.02 from vf.09
.-------------------------------------------------------
. VF.09.B01 15.11.2000 Charles Handaya
.           Modification of Warehouse Security
.-------------------------------------------------------
. VF.01.01  30.10.2000 Sandra Barcham
.           Recompiled for IBACODIO & IBAPRNIO
.-------------------------------------------------------
. VF.00.02  10.11.1999 Charles Handaya
.           Fix Y2K of Audit Files Date (CCYYMMDD)
. VF.00.01  02.11.1999 Sandra Barcham
.           Change locked message to use X
.-------------------------------------------------------
EXPORTFL  FILE      ASCII, FIXED=200
.
CHANGWAR  FORM      1
FORM7     FORM      7
.
PARTCUR   DIM       30
PARTDES   DIM       15
PARTN1    DIM       30
PARTN2    DIM       30
STRRAS    DIM       8
ENDRAS    DIM       8
.
GOTRECRD  FORM      1
TOTONSTK  FORM      10
CHKTOTAL  FORM      10
.
MULTIPLY  FORM      "2578498"
MODULUS   FORM      "7936453"
INCRMENT  FORM      "1328364"
INITSEED  FORM      7
.-------------------------------------------------------
.@@@@@ Start of Generated Code @@@@@
. NB - Code & Comments Included Before the above line 
.      will not be overwritten by the generation of a 
.      program. The STDGENDF file and VERSION must appear
.      before the line. 
.-----------------------------------------
.   Program       :   IBASIN36
.   Function      :   Print Stocktake Worksheets              
.   Generated  On :   19/05/2011
.-----------------------------------------
.=========================
.File Description Includes
.-------------------------
          INC       IBAPRNFD/INC
          INC       SINCGAFD/INC
          INC       SINCIAFD/INC
          INC       SINCICFD/INC
          INC       SINCIEFD/INC
          INC       SINCONFD/INC
          INC       SINNATFD/INC
          INC       SINRSTFD/INC
          INC       SINSUAFD/INC
          INC       SINTMPDF/INC
          INC       SINWARFD/INC
          INC       SINWRKDF    
          INC       SINWRKFD/INC
          INC       SINWSEFD/INC
.=========================
.Local Variable Definition
.-------------------------
PRTPART   FORM      1 * Scr 01 Fld     6
SUPCATYN  FORM      1 * Scr 01 Fld     7
FROMRAS   DIM       8 * Scr 05 Fld     4
TORAS     DIM       8 * Scr 05 Fld     5
.
ACCEPT    FORM      1
SACCEPT   FORM      1
.
PRGID     INIT      "IBASIN36"
PRGNAM    INIT      "Print Stocktake Worksheets              "
.
.--------------------------------
. MAINLINE - Controlling Logic
.--------------------------------
          TOPIC     PRGID
          MOVE      PORT,PARENTID
          CLOCK     PORT,DIM2
          MOVE      DIM2,PORT
ML0000
          CALL      INIT0000
          CALL      ONAT0000
          CALL      SC00L000
          CHAIN     PGM
.---------------------------------------
. INIT - Open Files & Display Heading
.---------------------------------------
INIT0000  CALL      DISPHEAD
          MOVE      ONE,CCENTRY
          MOVE      ONE,CCANLDTE
          MOVE      ONE,CDEFDTE
          MOVE      ZERO,CHIGHLT
          DISPLAY   *P56:24,"Opening controlf";
          OPEN      CONTROLF,"controlf"
          DISPLAY   *P56:24,"Opening scrsbga1";
          OPEN      SCRSBGA1,"scrsbgaf"
          DISPLAY   *P56:24,"Opening scrpsta1";
          OPEN      SCRPSTA1,"scrpstaf"
          DISPLAY   *P56:24,"Opening scrpsta1";
          OPEN      SCRPSTA2,"scrpstaf"
          DISPLAY   *P56:24,"Opening scrslta1";
          OPEN      SCRSLTA1,"scrsltaf"
          MOVE      "   24",AUDTSECT
          MOVE      "208",AUDTPOST
          READ      CONTROLF,AUDTSECT;*AUDTPOST,AUDTFLAG
          IF        AUDTFLAG=1
            DISPLAY   *P56:24,"Opening sinaudie";
            OPEN      SINAUDIE,"sinaudie"
          ENDIF
          DISPLAY   *P56:24,"Opening sincgaaf";
          OPEN      SINCGAA1,"sincgaaf"
          DISPLAY   *P56:24,"Opening sincgaaf";
          OPEN      SINCGAA2,"sincgaaf"
          DISPLAY   *P56:24,"Opening sinciaaf";
          OPEN      SINCIAA1,"sinciaaf"
          DISPLAY   *P56:24,"Opening sinciaaf";
          OPEN      SINCIAA2,"sinciaaf"
          DISPLAY   *P56:24,"Opening sinciaaf";
          OPEN      SINCIAA3,"sinciaaf"
          DISPLAY   *P56:24,"Opening sincicaf";
          OPEN      SINCICA1,"sincicaf"
          DISPLAY   *P56:24,"Opening sincicaf";
          OPEN      SINCICA2,"sincicaf"
          DISPLAY   *P56:24,"Opening sincicaf";
          OPEN      SINCICA3,"sincicaf"
          DISPLAY   *P56:24,"Opening sincicaf";
          OPEN      SINCICA4,"sincicaf"
          DISPLAY   *P56:24,"Opening sincieaf";
          OPEN      SINCIEA1,"sincieaf"
          DISPLAY   *P56:24,"Opening sincieaf";
          OPEN      SINCIEA2,"sincieaf"
          DISPLAY   *P56:24,"Opening sinrstaf";
          OPEN      SINRSTA1,"sinrstaf"
          DISPLAY   *P56:24,"Opening sinrstaf";
          OPEN      SINRSTA2,"sinrstaf"
          DISPLAY   *P56:24,"Opening sinsuaaf";
          OPEN      SINSUAA1,"sinsuaaf"
          DISPLAY   *P56:24,"Opening sinsuaaf";
          OPEN      SINSUAA2,"sinsuaaf"
          DISPLAY   *P56:24,"Opening sinsuaaf";
          OPEN      SINSUAA3,"sinsuaaf"
          DISPLAY   *P56:24,"Opening sinwaraf";
          OPEN      SINWARA1,"sinwaraf"
          DISPLAY   *P56:24,"Opening sinwaraf";
          OPEN      SINWARA2,"sinwaraf"
          DISPLAY   *P56:24,"Opening sinwseaf";
          OPEN      SINWSEA1,"sinwseaf"
          DISPLAY   *P56:24,"Opening sinwseaf";
          OPEN      SINWSEA2,"sinwseaf"
INIT9999  DISPLAY   *P1:24,*EL;
          RETURN
.
.------------------------------------
. Called for Print Screen Routine 
.------------------------------------
PRTSVARS
          MATCH     "00",SCRID
          IF         @EQUAL
            CALL       PS00L000   * Main Screen                        
          ENDIF
          MATCH     "01",SCRID
          IF         @EQUAL
            CALL       PS01L000   * Process Random Stocktake           
          ENDIF
          MATCH     "02",SCRID
          IF         @EQUAL
            CALL       PS02L000   * Process Stocktake by Product Group 
          ENDIF
          MATCH     "03",SCRID
          IF         @EQUAL
            CALL       PS03L000   * Process Full Stocktake             
          ENDIF
          MATCH     "04",SCRID
          IF         @EQUAL
            CALL       PS04L000   * Process Stocktake by Commodity     
          ENDIF
          MATCH     "05",SCRID
          IF         @EQUAL
            CALL       PS05L000   * Process Stocktake by Rack & Shelf  
          ENDIF
          RETURN
.--------------------------------
. Screen - Main Screen                        
.--------------------------------
SC00L000
SC00L100
          MOVE      "00",SCRID
          MOVE      ZERO,PRCOL
          MOVE      ZERO,PRVERT
          MOVE      "    1",FLDID
          CALL      GETPOSIT
          IF        EXIT=0
            MOVE     SCPSCOL,PRCOL
            MOVE     SCPSROW,PRVERT
          ENDIF
          CALL      SBACK000 * Display Background
.
SC00L200
          CALL      CF00L000 * Clear Fields
SC00L300
          CALL      KY00L000 * Enter Key Fields
          BRANCH    EXIT,SC00L999,SC00L999
SC00L400
          CALL      WP00L000 * Load any WP Details
SC00L500
          CALL      LM00L000 * Load any Batch Details
SC00L600
          CALL      DF00L000 * Display Fields
SC00L700
          CALL      SF00L000 * Select Fields
          BRANCH    EXIT,SC00L100,SC00L100,SC00L200
          IF        EXIT=4
            MOVE      ONE,EXIT
          ENDIF
SC00L800
SC00L900
SC00L999  RETURN
.--------------------------------------------------------
. Clear Fields for Screen : Main Screen                        
.-------------------------------------------------------
CF00L000
CF00L999  RETURN
.--------------------------------------------------------
. Enter Key Fields for Main Screen                        
.--------------------------------------------------------
KY00L000
          MOVE      ZERO,EXIT
          GOTO      KY00L999
.
KY00L900  MOVE      ONE,EXIT
KY00L999  RETURN
.---------------------------------------------------------
. Load WP files for : Main Screen                        
.---------------------------------------------------------
WP00L000
          RETURN
.---------------------------------------------------------
. Load Batch Screen for : Main Screen                        
.---------------------------------------------------------
LM00L000
          RETURN
.---------------------------------------------------------
. Display Fields for : Main Screen                        
.---------------------------------------------------------
DF00L000
          BRANCH   ACCEPT,DF00L999
          PACK     KEY15,PRGID,SCRID,SP70
          CALL     RSSCPS1
DF00L010
          CALL     RKSCPS1
          BRANCH   OVRCD,DF00L900
          MATCH    PRGID,SCPSPID
          GOTO     DF00L900 IF NOT EQUAL
          MATCH    SCRID,SCPSSID
          GOTO     DF00L900 IF NOT EQUAL
          MATCH    SP70,SCPSMTY
          GOTO     DF00L010 IF NOT EQUAL
.
          CALL     PS00L000 * Display Field
          GOTO     DF00L010
DF00L900
DF00L999
          RETURN
.---------------------------------------------------------
. Display/Print Fields for : Main Screen                        
.---------------------------------------------------------
PS00L000   PACK      VAR,SP70,SP70
          PACK     PRINTVAR,SP70,SP70
          MOVE     SCPSITM,FIELDNO
          BRANCH    FIELDNO,PS00L999,PS00L999,PS00L999,PS00L999:
                            PS00L999,PS00L999,PS00L999,PS00L999
          GOTO     PS00L999
PS00L999
          RETURN
.---------------------------------------------------------
. Selections for : Main Screen                        
.---------------------------------------------------------
SF00L000  PACK     KEY13,PRGID,SCRID,SP70
          CALL     RSSCSL1
SF00L001  BRANCH   ACCEPT,SF00L020
.
SF00L005  CALL     MTSTQ000
          MOVE     SCSLITM,FIELDNO
          BRANCH    FIELDNO,SF00L006,SF00L101,SF00L006,SF00L102:
                            SF00L103,SF00L104,SF00L105,SF00L106
SF00L006  BEEP
          GOTO     SF00L005
SF00L020  CALL     RKSCSL1
          BRANCH   OVRCD,SF00L090
          MATCH    PRGID,SCSLPID
          GOTO     SF00L090 IF NOT EQUAL
          MATCH    SCRID,SCSLSID
          GOTO     SF00L090 IF NOT EQUAL
          MOVE     SCSLITM,FIELDNO
          BRANCH    FIELDNO,SF00L020,SF00L020,SF00L020,SF00L020:
                            SF00L020,SF00L020,SF00L020,SF00L020
          GOTO     SF00L020
SF00L090  MOVE     ZERO,ACCEPT
          GOTO     SF00L001
.
SF00L101
          MOVE      ZERO,EXIT
          GOTO      SF00L999
.
SF00L102
          CALL      SC01L000
          MOVE      ONE,EXIT
          GOTO      SF00L999
.
SF00L103
          CALL      SC02L000
          MOVE      ONE,EXIT
          GOTO      SF00L999
.
SF00L104
          CALL      SC03L000
          MOVE      ONE,EXIT
          GOTO      SF00L999
.
SF00L105
          CALL      SC04L000
          MOVE      ONE,EXIT
          GOTO      SF00L999
.
SF00L106
          CALL      SC05L000
          MOVE      ONE,EXIT
          GOTO      SF00L999
SF00L990  MOVE      FOUR,EXIT * Exit Char Exit
SF00L999  RETURN
.--------------------------------
. Screen - Process Random Stocktake           
.--------------------------------
SC01L000
SC01L100
          MOVE      "01",SCRID
          MOVE      ZERO,PRCOL
          MOVE      ZERO,PRVERT
          MOVE      "    1",FLDID
          CALL      GETPOSIT
          IF        EXIT=0
            MOVE     SCPSCOL,PRCOL
            MOVE     SCPSROW,PRVERT
          ENDIF
          CALL      SBACK000 * Display Background
.
SC01L200
          CALL      CF01L000 * Clear Fields
          CALL      SETSCR00
SC01L300
          CALL      KY01L000 * Enter Key Fields
          BRANCH    EXIT,SC01L999,SC01L999
SC01L400
          CALL      WP01L000 * Load any WP Details
SC01L500
          CALL      LM01L000 * Load any Batch Details
SC01L600
          CALL      DF01L000 * Display Fields
SC01L700
          CALL      SF01L000 * Select Fields
          BRANCH    EXIT,SC01L100,SC01L100,SC01L200
          IF        EXIT=4
            MOVE      ONE,EXIT
          ENDIF
SC01L800
SC01L900
SC01L999  RETURN
.--------------------------------------------------------
. Clear Fields for Screen : Process Random Stocktake           
.-------------------------------------------------------
CF01L000
          MOVE      SP70,SIWAWAR 
          MOVE      SP70,SIWADES 
          MOVE      ZERO,PRTPART 
          MOVE      ZERO,SUPCATYN
CF01L999  RETURN
.--------------------------------------------------------
. Enter Key Fields for Process Random Stocktake           
.--------------------------------------------------------
KY01L000
          MOVE      ZERO,EXIT
          GOTO      KY01L999
.
KY01L900  MOVE      ONE,EXIT
KY01L999  RETURN
.---------------------------------------------------------
. Load WP files for : Process Random Stocktake           
.---------------------------------------------------------
WP01L000
          RETURN
.---------------------------------------------------------
. Load Batch Screen for : Process Random Stocktake           
.---------------------------------------------------------
LM01L000
          RETURN
.---------------------------------------------------------
. Display Fields for : Process Random Stocktake           
.---------------------------------------------------------
DF01L000
          BRANCH   ACCEPT,DF01L999
          PACK     KEY15,PRGID,SCRID,SP70
          CALL     RSSCPS1
DF01L010
          CALL     RKSCPS1
          BRANCH   OVRCD,DF01L900
          MATCH    PRGID,SCPSPID
          GOTO     DF01L900 IF NOT EQUAL
          MATCH    SCRID,SCPSSID
          GOTO     DF01L900 IF NOT EQUAL
          MATCH    SP70,SCPSMTY
          GOTO     DF01L010 IF NOT EQUAL
.
          CALL     PS01L000 * Display Field
          GOTO     DF01L010
DF01L900
DF01L999
          RETURN
.---------------------------------------------------------
. Display/Print Fields for : Process Random Stocktake           
.---------------------------------------------------------
PS01L000   PACK      VAR,SP70,SP70
          PACK     PRINTVAR,SP70,SP70
          MOVE     SCPSITM,FIELDNO
          BRANCH    FIELDNO,PS01L999,PS01L999,PS01L999,PS01L101:
                            PS01L102,PS01L103,PS01L104
          GOTO     PS01L999
.
PS01L101
          MOVE      SIWAWAR,VAR      
          CALL      DISPITEM
          GOTO     PS01L999
.
PS01L102
          MOVE      SIWADES,VAR      
          CALL      DISPITEM
          GOTO     PS01L999
.
PS01L103
          MOVE      NO,YESNO
          MOVE      ZERO,FORM2
          MOVE      PRTPART,FORM2    
          LOAD      YESNO,FORM2,YES
          MOVE      YESNO,VAR
          CALL      DISPITEM
          GOTO     PS01L999
.
PS01L104
          MOVE      YES,YESNO
          MOVE      ZERO,FORM2
          MOVE      SUPCATYN,FORM2   
          LOAD      YESNO,FORM2,NO
          MOVE      YESNO,VAR
          CALL      DISPITEM
          GOTO     PS01L999
PS01L999
          RETURN
.---------------------------------------------------------
. Selections for : Process Random Stocktake           
.---------------------------------------------------------
SF01L000  PACK     KEY13,PRGID,SCRID,SP70
          CALL     RSSCSL1
SF01L001  BRANCH   ACCEPT,SF01L020
.
SF01L005  CALL     MTSTQ000
          MOVE     SCSLITM,FIELDNO
          BRANCH    FIELDNO,SF01L006,SF01L101,SF01L102,SF01L103:
                            SF01L006,SF01L104,SF01L105
SF01L006  BEEP
          GOTO     SF01L005
SF01L020  CALL     RKSCSL1
          BRANCH   OVRCD,SF01L090
          MATCH    PRGID,SCSLPID
          GOTO     SF01L090 IF NOT EQUAL
          MATCH    SCRID,SCSLSID
          GOTO     SF01L090 IF NOT EQUAL
          MOVE     SCSLITM,FIELDNO
          BRANCH    FIELDNO,SF01L020,SF01L020,SF01L020,SF01L103:
                            SF01L020,SF01L104,SF01L105
          GOTO     SF01L020
SF01L090  MOVE     ZERO,ACCEPT
          GOTO     SF01L001
.
SF01L101
          MOVE      ZERO,EXIT
          GOTO      SF01L999
.
SF01L102
            MOVE      ZERO,HLEF
            CALL      GETSCR00
          CALL      POSTA000
          MOVE      EXIT,SECTOR
          IF        SECTOR=0
            CALL      FRESCR00
            GOTO      SF01L999
          ENDIF
          IF        SECTOR=1
            CALL      FRESCR00
            MOVE      ZERO,EXIT
            GOTO      SF01L001
          ENDIF
          IF        SECTOR=2
            CALL      FRESCR00
            MOVE      ONE,EXIT
            GOTO      SF01L999
          ENDIF
          MOVE      "01",SCRID
          MOVE      ZERO,PRCOL
          MOVE      ZERO,PRVERT
          MOVE      "    1",FLDID
          CALL      GETPOSIT
          IF        EXIT=0
            MOVE     SCPSCOL,PRCOL
            MOVE     SCPSROW,PRVERT
          ENDIF
          CALL      PUTSCR00
          IF        SECTOR=4
            CALL      DF01L000
          ENDIF
          GOTO      SF01L001
.
SF01L103
.
.
          MOVE      "    5",FLDID
          CALL      GETPOSIT
          IF        EXIT=0
            MOVE     SP70,SIWADES 
            PACK      VAR,SP70,SP70
            CALL      DISPITEM
          ENDIF
          CALL     SELECTED
          MOVE      "0",CKEYTYP
          CALL      KSIWSA00
          IF        SCPSMAN=1
            IF        EXIT=1
              MOVE      "Mandatory Field - ",DISPMSG
              BEEP
              CALL      MESSAGE1
              GOTO      SF01L103
            ENDIF
            BRANCH    EXIT,SF01L103,SF01L990
          ELSE
            COMPARE   TWO,EXIT
            GOTO      SF01L990 IF EQUAL
          ENDIF
          MOVE      SIWAWAR,VAR      
          CALL      DISPITEM
.
.
          MOVE      "    5",FLDID
          CALL      GETPOSIT
          IF        EXIT=0
            MOVE      SIWADES,VAR      
            CALL      DISPITEM
          ENDIF
          GOTO     SF01L001
.
SF01L104
          CALL     SELECTED
          CALL      YORN0000
          MOVE       FYESNO,PRTPART 
          MOVE      NO,YESNO
          MOVE      ZERO,FORM2
          MOVE      PRTPART,FORM2    
          LOAD      YESNO,FORM2,YES
          MOVE      YESNO,VAR
          CALL      DISPITEM
          GOTO     SF01L001
.
SF01L105
          CALL      DEFAULTY
          CALL     SELECTED
          CALL      YORN0000
          MOVE       FYESNO,ANS
          REP        "0A1B",ANS
          REP        "A1B0",ANS
          MOVE       ANS,SUPCATYN
          MOVE      YES,YESNO
          MOVE      ZERO,FORM2
          MOVE      SUPCATYN,FORM2   
          LOAD      YESNO,FORM2,NO
          MOVE      YESNO,VAR
          CALL      DISPITEM
          GOTO     SF01L001
SF01L990  MOVE      FOUR,EXIT * Exit Char Exit
SF01L999  RETURN
.--------------------------------
. Screen - Process Stocktake by Product Group 
.--------------------------------
SC02L000
SC02L100
          MOVE      "02",SCRID
          MOVE      ZERO,PRCOL
          MOVE      ZERO,PRVERT
          MOVE      "    1",FLDID
          CALL      GETPOSIT
          IF        EXIT=0
            MOVE     SCPSCOL,PRCOL
            MOVE     SCPSROW,PRVERT
          ENDIF
          CALL      SBACK000 * Display Background
.
SC02L200
          CALL      CF02L000 * Clear Fields
          CALL      SETSCR00
SC02L300
          CALL      KY02L000 * Enter Key Fields
          BRANCH    EXIT,SC02L999,SC02L999
SC02L400
          CALL      WP02L000 * Load any WP Details
SC02L500
          CALL      LM02L000 * Load any Batch Details
SC02L600
          CALL      DF02L000 * Display Fields
SC02L700
          CALL      SF02L000 * Select Fields
          BRANCH    EXIT,SC02L100,SC02L100,SC02L200
          IF        EXIT=4
            MOVE      ONE,EXIT
          ENDIF
SC02L800
SC02L900
SC02L999  RETURN
.--------------------------------------------------------
. Clear Fields for Screen : Process Stocktake by Product Group 
.-------------------------------------------------------
CF02L000
          MOVE      SP70,SIWAWAR 
          MOVE      SP70,SIWADES 
          MOVE      SP70,SISACODE
          MOVE      SP70,SISADESC
          MOVE      ZERO,PRTPART 
          MOVE      ZERO,SUPCATYN
CF02L999  RETURN
.--------------------------------------------------------
. Enter Key Fields for Process Stocktake by Product Group 
.--------------------------------------------------------
KY02L000
          MOVE      ZERO,EXIT
          GOTO      KY02L999
.
KY02L900  MOVE      ONE,EXIT
KY02L999  RETURN
.---------------------------------------------------------
. Load WP files for : Process Stocktake by Product Group 
.---------------------------------------------------------
WP02L000
          RETURN
.---------------------------------------------------------
. Load Batch Screen for : Process Stocktake by Product Group 
.---------------------------------------------------------
LM02L000
          RETURN
.---------------------------------------------------------
. Display Fields for : Process Stocktake by Product Group 
.---------------------------------------------------------
DF02L000
          BRANCH   ACCEPT,DF02L999
          PACK     KEY15,PRGID,SCRID,SP70
          CALL     RSSCPS1
DF02L010
          CALL     RKSCPS1
          BRANCH   OVRCD,DF02L900
          MATCH    PRGID,SCPSPID
          GOTO     DF02L900 IF NOT EQUAL
          MATCH    SCRID,SCPSSID
          GOTO     DF02L900 IF NOT EQUAL
          MATCH    SP70,SCPSMTY
          GOTO     DF02L010 IF NOT EQUAL
.
          CALL     PS02L000 * Display Field
          GOTO     DF02L010
DF02L900
DF02L999
          RETURN
.---------------------------------------------------------
. Display/Print Fields for : Process Stocktake by Product Group 
.---------------------------------------------------------
PS02L000   PACK      VAR,SP70,SP70
          PACK     PRINTVAR,SP70,SP70
          MOVE     SCPSITM,FIELDNO
          BRANCH    FIELDNO,PS02L999,PS02L999,PS02L999,PS02L101:
                            PS02L102,PS02L103,PS02L104,PS02L105:
                            PS02L106
          GOTO     PS02L999
.
PS02L101
          MOVE      SIWAWAR,VAR      
          CALL      DISPITEM
          GOTO     PS02L999
.
PS02L102
          MOVE      SIWADES,VAR      
          CALL      DISPITEM
          GOTO     PS02L999
.
PS02L103
          MOVE      SISACODE,VAR     
          CALL      DISPITEM
          GOTO     PS02L999
.
PS02L104
          MOVE      SISADESC,VAR     
          CALL      DISPITEM
          GOTO     PS02L999
.
PS02L105
          MOVE      NO,YESNO
          MOVE      ZERO,FORM2
          MOVE      PRTPART,FORM2    
          LOAD      YESNO,FORM2,YES
          MOVE      YESNO,VAR
          CALL      DISPITEM
          GOTO     PS02L999
.
PS02L106
          MOVE      YES,YESNO
          MOVE      ZERO,FORM2
          MOVE      SUPCATYN,FORM2   
          LOAD      YESNO,FORM2,NO
          MOVE      YESNO,VAR
          CALL      DISPITEM
          GOTO     PS02L999
PS02L999
          RETURN
.---------------------------------------------------------
. Selections for : Process Stocktake by Product Group 
.---------------------------------------------------------
SF02L000  PACK     KEY13,PRGID,SCRID,SP70
          CALL     RSSCSL1
SF02L001  BRANCH   ACCEPT,SF02L020
.
SF02L005  CALL     MTSTQ000
          MOVE     SCSLITM,FIELDNO
          BRANCH    FIELDNO,SF02L006,SF02L101,SF02L102,SF02L103:
                            SF02L006,SF02L104,SF02L006,SF02L105:
                            SF02L106
SF02L006  BEEP
          GOTO     SF02L005
SF02L020  CALL     RKSCSL1
          BRANCH   OVRCD,SF02L090
          MATCH    PRGID,SCSLPID
          GOTO     SF02L090 IF NOT EQUAL
          MATCH    SCRID,SCSLSID
          GOTO     SF02L090 IF NOT EQUAL
          MOVE     SCSLITM,FIELDNO
          BRANCH    FIELDNO,SF02L020,SF02L020,SF02L020,SF02L103:
                            SF02L020,SF02L104,SF02L020,SF02L105:
                            SF02L106
          GOTO     SF02L020
SF02L090  MOVE     ZERO,ACCEPT
          GOTO     SF02L001
.
SF02L101
          MOVE      ZERO,EXIT
          GOTO      SF02L999
.
SF02L102
          CALL      POSTB000
          MOVE      ZERO,EXIT
          GOTO      SF02L999
.
SF02L103
.
.
          MOVE      "    5",FLDID
          CALL      GETPOSIT
          IF        EXIT=0
            MOVE     SP70,SIWADES 
            PACK      VAR,SP70,SP70
            CALL      DISPITEM
          ENDIF
          CALL     SELECTED
          MOVE      "0",CKEYTYP
          CALL      KSIWSA00
          IF        SCPSMAN=1
            IF        EXIT=1
              MOVE      "Mandatory Field - ",DISPMSG
              BEEP
              CALL      MESSAGE1
              GOTO      SF02L103
            ENDIF
            BRANCH    EXIT,SF02L103,SF02L990
          ELSE
            COMPARE   TWO,EXIT
            GOTO      SF02L990 IF EQUAL
          ENDIF
          MOVE      SIWAWAR,VAR      
          CALL      DISPITEM
.
.
          MOVE      "    5",FLDID
          CALL      GETPOSIT
          IF        EXIT=0
            MOVE      SIWADES,VAR      
            CALL      DISPITEM
          ENDIF
          GOTO     SF02L001
.
SF02L104
.
.
          MOVE      "    7",FLDID
          CALL      GETPOSIT
          IF        EXIT=0
            MOVE     SP70,SISADESC
            PACK      VAR,SP70,SP70
            CALL      DISPITEM
          ENDIF
          CALL     SELECTED
          MOVE      "0",CKEYTYP
          CALL      KSISAA00
          IF        SCPSMAN=1
            IF        EXIT=1
              MOVE      "Mandatory Field - ",DISPMSG
              BEEP
              CALL      MESSAGE1
              GOTO      SF02L104
            ENDIF
            BRANCH    EXIT,SF02L104,SF02L990
          ELSE
            COMPARE   TWO,EXIT
            GOTO      SF02L990 IF EQUAL
          ENDIF
          MOVE      SISACODE,VAR     
          CALL      DISPITEM
.
.
          MOVE      "    7",FLDID
          CALL      GETPOSIT
          IF        EXIT=0
            MOVE      SISADESC,VAR     
            CALL      DISPITEM
          ENDIF
          GOTO     SF02L001
.
SF02L105
          CALL     SELECTED
          CALL      YORN0000
          MOVE       FYESNO,PRTPART 
          MOVE      NO,YESNO
          MOVE      ZERO,FORM2
          MOVE      PRTPART,FORM2    
          LOAD      YESNO,FORM2,YES
          MOVE      YESNO,VAR
          CALL      DISPITEM
          GOTO     SF02L001
.
SF02L106
          CALL      DEFAULTY
          CALL     SELECTED
          CALL      YORN0000
          MOVE       FYESNO,ANS
          REP        "0A1B",ANS
          REP        "A1B0",ANS
          MOVE       ANS,SUPCATYN
          MOVE      YES,YESNO
          MOVE      ZERO,FORM2
          MOVE      SUPCATYN,FORM2   
          LOAD      YESNO,FORM2,NO
          MOVE      YESNO,VAR
          CALL      DISPITEM
          GOTO     SF02L001
SF02L990  MOVE      FOUR,EXIT * Exit Char Exit
SF02L999  RETURN
.--------------------------------
. Screen - Process Full Stocktake             
.--------------------------------
SC03L000
SC03L100
          MOVE      "03",SCRID
          MOVE      ZERO,PRCOL
          MOVE      ZERO,PRVERT
          MOVE      "    1",FLDID
          CALL      GETPOSIT
          IF        EXIT=0
            MOVE     SCPSCOL,PRCOL
            MOVE     SCPSROW,PRVERT
          ENDIF
          CALL      SBACK000 * Display Background
.
SC03L200
          CALL      CF03L000 * Clear Fields
          CALL      SETSCR00
SC03L300
          CALL      KY03L000 * Enter Key Fields
          BRANCH    EXIT,SC03L999,SC03L999
SC03L400
          CALL      WP03L000 * Load any WP Details
SC03L500
          CALL      LM03L000 * Load any Batch Details
SC03L600
          CALL      DF03L000 * Display Fields
SC03L700
          CALL      SF03L000 * Select Fields
          BRANCH    EXIT,SC03L100,SC03L100,SC03L200
          IF        EXIT=4
            MOVE      ONE,EXIT
          ENDIF
SC03L800
SC03L900
SC03L999  RETURN
.--------------------------------------------------------
. Clear Fields for Screen : Process Full Stocktake             
.-------------------------------------------------------
CF03L000
          MOVE      SP70,SIWAWAR 
          MOVE      SP70,SIWADES 
          MOVE      ZERO,PRTPART 
          MOVE      ZERO,SUPCATYN
CF03L999  RETURN
.--------------------------------------------------------
. Enter Key Fields for Process Full Stocktake             
.--------------------------------------------------------
KY03L000
          MOVE      ZERO,EXIT
          GOTO      KY03L999
.
KY03L900  MOVE      ONE,EXIT
KY03L999  RETURN
.---------------------------------------------------------
. Load WP files for : Process Full Stocktake             
.---------------------------------------------------------
WP03L000
          RETURN
.---------------------------------------------------------
. Load Batch Screen for : Process Full Stocktake             
.---------------------------------------------------------
LM03L000
          RETURN
.---------------------------------------------------------
. Display Fields for : Process Full Stocktake             
.---------------------------------------------------------
DF03L000
          BRANCH   ACCEPT,DF03L999
          PACK     KEY15,PRGID,SCRID,SP70
          CALL     RSSCPS1
DF03L010
          CALL     RKSCPS1
          BRANCH   OVRCD,DF03L900
          MATCH    PRGID,SCPSPID
          GOTO     DF03L900 IF NOT EQUAL
          MATCH    SCRID,SCPSSID
          GOTO     DF03L900 IF NOT EQUAL
          MATCH    SP70,SCPSMTY
          GOTO     DF03L010 IF NOT EQUAL
.
          CALL     PS03L000 * Display Field
          GOTO     DF03L010
DF03L900
DF03L999
          RETURN
.---------------------------------------------------------
. Display/Print Fields for : Process Full Stocktake             
.---------------------------------------------------------
PS03L000   PACK      VAR,SP70,SP70
          PACK     PRINTVAR,SP70,SP70
          MOVE     SCPSITM,FIELDNO
          BRANCH    FIELDNO,PS03L999,PS03L999,PS03L999,PS03L101:
                            PS03L102,PS03L103,PS03L104
          GOTO     PS03L999
.
PS03L101
          MOVE      SIWAWAR,VAR      
          CALL      DISPITEM
          GOTO     PS03L999
.
PS03L102
          MOVE      SIWADES,VAR      
          CALL      DISPITEM
          GOTO     PS03L999
.
PS03L103
          MOVE      NO,YESNO
          MOVE      ZERO,FORM2
          MOVE      PRTPART,FORM2    
          LOAD      YESNO,FORM2,YES
          MOVE      YESNO,VAR
          CALL      DISPITEM
          GOTO     PS03L999
.
PS03L104
          MOVE      YES,YESNO
          MOVE      ZERO,FORM2
          MOVE      SUPCATYN,FORM2   
          LOAD      YESNO,FORM2,NO
          MOVE      YESNO,VAR
          CALL      DISPITEM
          GOTO     PS03L999
PS03L999
          RETURN
.---------------------------------------------------------
. Selections for : Process Full Stocktake             
.---------------------------------------------------------
SF03L000  PACK     KEY13,PRGID,SCRID,SP70
          CALL     RSSCSL1
SF03L001  BRANCH   ACCEPT,SF03L020
.
SF03L005  CALL     MTSTQ000
          MOVE     SCSLITM,FIELDNO
          BRANCH    FIELDNO,SF03L006,SF03L101,SF03L102,SF03L103:
                            SF03L006,SF03L104,SF03L105
SF03L006  BEEP
          GOTO     SF03L005
SF03L020  CALL     RKSCSL1
          BRANCH   OVRCD,SF03L090
          MATCH    PRGID,SCSLPID
          GOTO     SF03L090 IF NOT EQUAL
          MATCH    SCRID,SCSLSID
          GOTO     SF03L090 IF NOT EQUAL
          MOVE     SCSLITM,FIELDNO
          BRANCH    FIELDNO,SF03L020,SF03L020,SF03L020,SF03L103:
                            SF03L020,SF03L104,SF03L105
          GOTO     SF03L020
SF03L090  MOVE     ZERO,ACCEPT
          GOTO     SF03L001
.
SF03L101
          MOVE      ZERO,EXIT
          GOTO      SF03L999
.
SF03L102
          CALL      POSTC000
          MOVE      ZERO,EXIT
          GOTO      SF03L999
.
SF03L103
.
.
          MOVE      "    5",FLDID
          CALL      GETPOSIT
          IF        EXIT=0
            MOVE     SP70,SIWADES 
            PACK      VAR,SP70,SP70
            CALL      DISPITEM
          ENDIF
          CALL     SELECTED
          MOVE      "0",CKEYTYP
          CALL      KSIWSA00
          IF        SCPSMAN=1
            IF        EXIT=1
              MOVE      "Mandatory Field - ",DISPMSG
              BEEP
              CALL      MESSAGE1
              GOTO      SF03L103
            ENDIF
            BRANCH    EXIT,SF03L103,SF03L990
          ELSE
            COMPARE   TWO,EXIT
            GOTO      SF03L990 IF EQUAL
          ENDIF
          MOVE      SIWAWAR,VAR      
          CALL      DISPITEM
.
.
          MOVE      "    5",FLDID
          CALL      GETPOSIT
          IF        EXIT=0
            MOVE      SIWADES,VAR      
            CALL      DISPITEM
          ENDIF
          GOTO     SF03L001
.
SF03L104
          CALL     SELECTED
          CALL      YORN0000
          MOVE       FYESNO,PRTPART 
          MOVE      NO,YESNO
          MOVE      ZERO,FORM2
          MOVE      PRTPART,FORM2    
          LOAD      YESNO,FORM2,YES
          MOVE      YESNO,VAR
          CALL      DISPITEM
          GOTO     SF03L001
.
SF03L105
          CALL      DEFAULTY
          CALL     SELECTED
          CALL      YORN0000
          MOVE       FYESNO,ANS
          REP        "0A1B",ANS
          REP        "A1B0",ANS
          MOVE       ANS,SUPCATYN
          MOVE      YES,YESNO
          MOVE      ZERO,FORM2
          MOVE      SUPCATYN,FORM2   
          LOAD      YESNO,FORM2,NO
          MOVE      YESNO,VAR
          CALL      DISPITEM
          GOTO     SF03L001
SF03L990  MOVE      FOUR,EXIT * Exit Char Exit
SF03L999  RETURN
.--------------------------------
. Screen - Process Stocktake by Commodity     
.--------------------------------
SC04L000
SC04L100
          MOVE      "04",SCRID
          MOVE      ZERO,PRCOL
          MOVE      ZERO,PRVERT
          MOVE      "    1",FLDID
          CALL      GETPOSIT
          IF        EXIT=0
            MOVE     SCPSCOL,PRCOL
            MOVE     SCPSROW,PRVERT
          ENDIF
          CALL      SBACK000 * Display Background
.
SC04L200
          CALL      CF04L000 * Clear Fields
          CALL      SETSCR00
SC04L300
          CALL      KY04L000 * Enter Key Fields
          BRANCH    EXIT,SC04L999,SC04L999
SC04L400
          CALL      WP04L000 * Load any WP Details
SC04L500
          CALL      LM04L000 * Load any Batch Details
SC04L600
          CALL      DF04L000 * Display Fields
SC04L700
          CALL      SF04L000 * Select Fields
          BRANCH    EXIT,SC04L100,SC04L100,SC04L200
          IF        EXIT=4
            MOVE      ONE,EXIT
          ENDIF
SC04L800
SC04L900
SC04L999  RETURN
.--------------------------------------------------------
. Clear Fields for Screen : Process Stocktake by Commodity     
.-------------------------------------------------------
CF04L000
          MOVE      SP70,SIWAWAR 
          MOVE      SP70,SIGACOD 
          MOVE      ZERO,PRTPART 
          MOVE      ZERO,SUPCATYN
CF04L999  RETURN
.--------------------------------------------------------
. Enter Key Fields for Process Stocktake by Commodity     
.--------------------------------------------------------
KY04L000
          MOVE      ZERO,EXIT
          GOTO      KY04L999
.
KY04L900  MOVE      ONE,EXIT
KY04L999  RETURN
.---------------------------------------------------------
. Load WP files for : Process Stocktake by Commodity     
.---------------------------------------------------------
WP04L000
          RETURN
.---------------------------------------------------------
. Load Batch Screen for : Process Stocktake by Commodity     
.---------------------------------------------------------
LM04L000
          RETURN
.---------------------------------------------------------
. Display Fields for : Process Stocktake by Commodity     
.---------------------------------------------------------
DF04L000
          BRANCH   ACCEPT,DF04L999
          PACK     KEY15,PRGID,SCRID,SP70
          CALL     RSSCPS1
DF04L010
          CALL     RKSCPS1
          BRANCH   OVRCD,DF04L900
          MATCH    PRGID,SCPSPID
          GOTO     DF04L900 IF NOT EQUAL
          MATCH    SCRID,SCPSSID
          GOTO     DF04L900 IF NOT EQUAL
          MATCH    SP70,SCPSMTY
          GOTO     DF04L010 IF NOT EQUAL
.
          CALL     PS04L000 * Display Field
          GOTO     DF04L010
DF04L900
DF04L999
          RETURN
.---------------------------------------------------------
. Display/Print Fields for : Process Stocktake by Commodity     
.---------------------------------------------------------
PS04L000   PACK      VAR,SP70,SP70
          PACK     PRINTVAR,SP70,SP70
          MOVE     SCPSITM,FIELDNO
          BRANCH    FIELDNO,PS04L999,PS04L999,PS04L999,PS04L101:
                            PS04L102,PS04L103,PS04L104,PS04L105:
                            PS04L106
          GOTO     PS04L999
.
PS04L101
          MOVE      SIWAWAR,VAR      
          CALL      DISPITEM
          GOTO     PS04L999
.
PS04L102
          MOVE      SIWADES,VAR      
          CALL      DISPITEM
          GOTO     PS04L999
.
PS04L103
          MOVE      SIGACOD,VAR      
          CALL      DISPITEM
          GOTO     PS04L999
.
PS04L104
          MOVE      SIGADES,VAR      
          CALL      DISPITEM
          GOTO     PS04L999
.
PS04L105
          MOVE      NO,YESNO
          MOVE      ZERO,FORM2
          MOVE      PRTPART,FORM2    
          LOAD      YESNO,FORM2,YES
          MOVE      YESNO,VAR
          CALL      DISPITEM
          GOTO     PS04L999
.
PS04L106
          MOVE      YES,YESNO
          MOVE      ZERO,FORM2
          MOVE      SUPCATYN,FORM2   
          LOAD      YESNO,FORM2,NO
          MOVE      YESNO,VAR
          CALL      DISPITEM
          GOTO     PS04L999
PS04L999
          RETURN
.---------------------------------------------------------
. Selections for : Process Stocktake by Commodity     
.---------------------------------------------------------
SF04L000  PACK     KEY13,PRGID,SCRID,SP70
          CALL     RSSCSL1
SF04L001  BRANCH   ACCEPT,SF04L020
.
SF04L005  CALL     MTSTQ000
          MOVE     SCSLITM,FIELDNO
          BRANCH    FIELDNO,SF04L006,SF04L101,SF04L102,SF04L103:
                            SF04L006,SF04L104,SF04L006,SF04L105:
                            SF04L106
SF04L006  BEEP
          GOTO     SF04L005
SF04L020  CALL     RKSCSL1
          BRANCH   OVRCD,SF04L090
          MATCH    PRGID,SCSLPID
          GOTO     SF04L090 IF NOT EQUAL
          MATCH    SCRID,SCSLSID
          GOTO     SF04L090 IF NOT EQUAL
          MOVE     SCSLITM,FIELDNO
          BRANCH    FIELDNO,SF04L020,SF04L020,SF04L020,SF04L103:
                            SF04L020,SF04L104,SF04L020,SF04L105:
                            SF04L106
          GOTO     SF04L020
SF04L090  MOVE     ZERO,ACCEPT
          GOTO     SF04L001
.
SF04L101
          MOVE      ZERO,EXIT
          GOTO      SF04L999
.
SF04L102
          CALL      POSTD000
          MOVE      ZERO,EXIT
          GOTO      SF04L999
.
SF04L103
.
.
          MOVE      "    5",FLDID
          CALL      GETPOSIT
          IF        EXIT=0
            MOVE     SP70,SIWADES 
            PACK      VAR,SP70,SP70
            CALL      DISPITEM
          ENDIF
          CALL     SELECTED
          MOVE      "0",CKEYTYP
          CALL      KSIWSA00
          IF        SCPSMAN=1
            IF        EXIT=1
              MOVE      "Mandatory Field - ",DISPMSG
              BEEP
              CALL      MESSAGE1
              GOTO      SF04L103
            ENDIF
            BRANCH    EXIT,SF04L103,SF04L990
          ELSE
            COMPARE   TWO,EXIT
            GOTO      SF04L990 IF EQUAL
          ENDIF
          MOVE      SIWAWAR,VAR      
          CALL      DISPITEM
.
.
          MOVE      "    5",FLDID
          CALL      GETPOSIT
          IF        EXIT=0
            MOVE      SIWADES,VAR      
            CALL      DISPITEM
          ENDIF
          GOTO     SF04L001
.
SF04L104
.
.
          MOVE      "    7",FLDID
          CALL      GETPOSIT
          IF        EXIT=0
            MOVE     SP70,SIGADES 
            PACK      VAR,SP70,SP70
            CALL      DISPITEM
          ENDIF
          CALL     SELECTED
          MOVE      "0",CKEYTYP
          CALL      KSIGAA00
          IF        SCPSMAN=1
            IF        EXIT=1
              MOVE      "Mandatory Field - ",DISPMSG
              BEEP
              CALL      MESSAGE1
              GOTO      SF04L104
            ENDIF
            BRANCH    EXIT,SF04L104,SF04L990
          ELSE
            COMPARE   TWO,EXIT
            GOTO      SF04L990 IF EQUAL
          ENDIF
          MOVE      SIGACOD,VAR      
          CALL      DISPITEM
.
.
          MOVE      "    7",FLDID
          CALL      GETPOSIT
          IF        EXIT=0
            MOVE      SIGADES,VAR      
            CALL      DISPITEM
          ENDIF
          GOTO     SF04L001
.
SF04L105
          CALL     SELECTED
          CALL      YORN0000
          MOVE       FYESNO,PRTPART 
          MOVE      NO,YESNO
          MOVE      ZERO,FORM2
          MOVE      PRTPART,FORM2    
          LOAD      YESNO,FORM2,YES
          MOVE      YESNO,VAR
          CALL      DISPITEM
          GOTO     SF04L001
.
SF04L106
          CALL      DEFAULTY
          CALL     SELECTED
          CALL      YORN0000
          MOVE       FYESNO,ANS
          REP        "0A1B",ANS
          REP        "A1B0",ANS
          MOVE       ANS,SUPCATYN
          MOVE      YES,YESNO
          MOVE      ZERO,FORM2
          MOVE      SUPCATYN,FORM2   
          LOAD      YESNO,FORM2,NO
          MOVE      YESNO,VAR
          CALL      DISPITEM
          GOTO     SF04L001
SF04L990  MOVE      FOUR,EXIT * Exit Char Exit
SF04L999  RETURN
.--------------------------------
. Screen - Process Stocktake by Rack & Shelf  
.--------------------------------
SC05L000
SC05L100
          MOVE      "05",SCRID
          MOVE      ZERO,PRCOL
          MOVE      ZERO,PRVERT
          MOVE      "    1",FLDID
          CALL      GETPOSIT
          IF        EXIT=0
            MOVE     SCPSCOL,PRCOL
            MOVE     SCPSROW,PRVERT
          ENDIF
          CALL      SBACK000 * Display Background
.
SC05L200
          CALL      CF05L000 * Clear Fields
          CALL      SETSCR00
SC05L300
          CALL      KY05L000 * Enter Key Fields
          BRANCH    EXIT,SC05L999,SC05L999
SC05L400
          CALL      WP05L000 * Load any WP Details
SC05L500
          CALL      LM05L000 * Load any Batch Details
SC05L600
          CALL      DF05L000 * Display Fields
SC05L700
          CALL      SF05L000 * Select Fields
          BRANCH    EXIT,SC05L100,SC05L100,SC05L200
SC05L800
SC05L900
SC05L999  RETURN
.--------------------------------------------------------
. Clear Fields for Screen : Process Stocktake by Rack & Shelf  
.-------------------------------------------------------
CF05L000
          MOVE      SP70,FROMRAS 
          MOVE      SP70,TORAS   
          MOVE      ZERO,PRTPART 
          MOVE      SP70,SIWAWAR 
          MOVE      SP70,SIWADES 
          MOVE      ZERO,SUPCATYN
CF05L999  RETURN
.--------------------------------------------------------
. Enter Key Fields for Process Stocktake by Rack & Shelf  
.--------------------------------------------------------
KY05L000
          MOVE      ZERO,EXIT
          GOTO      KY05L999
.
KY05L900  MOVE      ONE,EXIT
KY05L999  RETURN
.---------------------------------------------------------
. Load WP files for : Process Stocktake by Rack & Shelf  
.---------------------------------------------------------
WP05L000
          RETURN
.---------------------------------------------------------
. Load Batch Screen for : Process Stocktake by Rack & Shelf  
.---------------------------------------------------------
LM05L000
          RETURN
.---------------------------------------------------------
. Display Fields for : Process Stocktake by Rack & Shelf  
.---------------------------------------------------------
DF05L000
          BRANCH   ACCEPT,DF05L999
          PACK     KEY15,PRGID,SCRID,SP70
          CALL     RSSCPS1
DF05L010
          CALL     RKSCPS1
          BRANCH   OVRCD,DF05L900
          MATCH    PRGID,SCPSPID
          GOTO     DF05L900 IF NOT EQUAL
          MATCH    SCRID,SCPSSID
          GOTO     DF05L900 IF NOT EQUAL
          MATCH    SP70,SCPSMTY
          GOTO     DF05L010 IF NOT EQUAL
.
          CALL     PS05L000 * Display Field
          GOTO     DF05L010
DF05L900
DF05L999
          RETURN
.---------------------------------------------------------
. Display/Print Fields for : Process Stocktake by Rack & Shelf  
.---------------------------------------------------------
PS05L000   PACK      VAR,SP70,SP70
          PACK     PRINTVAR,SP70,SP70
          MOVE     SCPSITM,FIELDNO
          BRANCH    FIELDNO,PS05L999,PS05L999,PS05L999,PS05L101:
                            PS05L102,PS05L999,PS05L999,PS05L103:
                            PS05L104,PS05L105,PS05L106
          GOTO     PS05L999
.
PS05L101
          MOVE      FROMRAS,VAR      
          CALL      DISPITEM
          GOTO     PS05L999
.
PS05L102
          MOVE      TORAS,VAR        
          CALL      DISPITEM
          GOTO     PS05L999
.
PS05L103
          MOVE      NO,YESNO
          MOVE      ZERO,FORM2
          MOVE      PRTPART,FORM2    
          LOAD      YESNO,FORM2,YES
          MOVE      YESNO,VAR
          CALL      DISPITEM
          GOTO     PS05L999
.
PS05L104
          MOVE      SIWAWAR,VAR      
          CALL      DISPITEM
          GOTO     PS05L999
.
PS05L105
          MOVE      SIWADES,VAR      
          CALL      DISPITEM
          GOTO     PS05L999
.
PS05L106
          MOVE      YES,YESNO
          MOVE      ZERO,FORM2
          MOVE      SUPCATYN,FORM2   
          LOAD      YESNO,FORM2,NO
          MOVE      YESNO,VAR
          CALL      DISPITEM
          GOTO     PS05L999
PS05L999
          RETURN
.---------------------------------------------------------
. Selections for : Process Stocktake by Rack & Shelf  
.---------------------------------------------------------
SF05L000  PACK     KEY13,PRGID,SCRID,SP70
          CALL     RSSCSL1
SF05L001  BRANCH   ACCEPT,SF05L020
.
SF05L005  CALL     MTSTQ000
          MOVE     SCSLITM,FIELDNO
          BRANCH    FIELDNO,SF05L006,SF05L101,SF05L102,SF05L103:
                            SF05L006,SF05L006,SF05L006,SF05L104:
                            SF05L105,SF05L006,SF05L106
SF05L006  BEEP
          GOTO     SF05L005
SF05L020  CALL     RKSCSL1
          BRANCH   OVRCD,SF05L090
          MATCH    PRGID,SCSLPID
          GOTO     SF05L090 IF NOT EQUAL
          MATCH    SCRID,SCSLSID
          GOTO     SF05L090 IF NOT EQUAL
          MOVE     SCSLITM,FIELDNO
          BRANCH    FIELDNO,SF05L020,SF05L020,SF05L020,SF05L103:
                            SF05L020,SF05L020,SF05L020,SF05L104:
                            SF05L105,SF05L020,SF05L106
          GOTO     SF05L020
SF05L090  MOVE     ZERO,ACCEPT
          GOTO     SF05L001
.
SF05L101
          MOVE      ZERO,EXIT
          GOTO      SF05L999
.
SF05L102
          CALL      POSTE000
          MOVE      ZERO,EXIT
          GOTO      SF05L999
.
SF05L103
.
.
          MOVE      "    5",FLDID
          CALL      GETPOSIT
          IF        EXIT=0
            MOVE     SP70,TORAS   
            PACK      VAR,SP70,SP70
            CALL      DISPITEM
          ENDIF
          CALL     SELECTED
          MOVE      "0",CKEYTYP
          CALL      RRAS0000
          IF        SCPSMAN=1
            IF        EXIT=1
              MOVE      "Mandatory Field - ",DISPMSG
              BEEP
              CALL      MESSAGE1
              GOTO      SF05L103
            ENDIF
            BRANCH    EXIT,SF05L103,SF05L990
          ELSE
            COMPARE   TWO,EXIT
            GOTO      SF05L990 IF EQUAL
          ENDIF
          MOVE      FROMRAS,VAR      
          CALL      DISPITEM
.
.
          MOVE      "    5",FLDID
          CALL      GETPOSIT
          IF        EXIT=0
            MOVE      TORAS,VAR        
            CALL      DISPITEM
          ENDIF
          GOTO     SF05L001
.
SF05L104
          CALL     SELECTED
          CALL      YORN0000
          MOVE       FYESNO,PRTPART 
          MOVE      NO,YESNO
          MOVE      ZERO,FORM2
          MOVE      PRTPART,FORM2    
          LOAD      YESNO,FORM2,YES
          MOVE      YESNO,VAR
          CALL      DISPITEM
          GOTO     SF05L001
.
SF05L105
.
.
          MOVE      "   10",FLDID
          CALL      GETPOSIT
          IF        EXIT=0
            MOVE     SP70,SIWADES 
            PACK      VAR,SP70,SP70
            CALL      DISPITEM
          ENDIF
          CALL     SELECTED
          MOVE      "0",CKEYTYP
          CALL      KSIWSA00
          IF        SCPSMAN=1
            IF        EXIT=1
              MOVE      "Mandatory Field - ",DISPMSG
              BEEP
              CALL      MESSAGE1
              GOTO      SF05L105
            ENDIF
            BRANCH    EXIT,SF05L105,SF05L990
          ELSE
            COMPARE   TWO,EXIT
            GOTO      SF05L990 IF EQUAL
          ENDIF
          MOVE      SIWAWAR,VAR      
          CALL      DISPITEM
.
.
          MOVE      "   10",FLDID
          CALL      GETPOSIT
          IF        EXIT=0
            MOVE      SIWADES,VAR      
            CALL      DISPITEM
          ENDIF
          GOTO     SF05L001
.
SF05L106
          CALL      DEFAULTY
          CALL     SELECTED
          CALL      YORN0000
          MOVE       FYESNO,ANS
          REP        "0A1B",ANS
          REP        "A1B0",ANS
          MOVE       ANS,SUPCATYN
          MOVE      YES,YESNO
          MOVE      ZERO,FORM2
          MOVE      SUPCATYN,FORM2   
          LOAD      YESNO,FORM2,NO
          MOVE      YESNO,VAR
          CALL      DISPITEM
          GOTO     SF05L001
SF05L990  MOVE      ONE,EXIT * Exit Char Restart
SF05L999  RETURN
.@@@@@ Function Restart Point @@@@@
.------------------------------------------------------------------------
. Open Nato X-Ref File if required
.------------------------------------------------------------------------
ONAT0000  OPEN      CONTROLF,"controlf"
.
          MOVE      ZERO,OVRCD
          TRAP      OVERCOND IF FORMAT
          READ      CONTROLF,SIXTY3;*143,HNONUSAG
          TRAPCLR   FORMAT
          IF        OVRCD=1
            MOVE      ONE,HNONUSAG
            WRITAB    CONTROLF,SIXTY3;*143,HNONUSAG
          ENDIF
.
          MOVE      ZERO,OVRCD
          TRAP      OVERCOND IF FORMAT
          READ      CONTROLF,SIXTY3;*141,INCNNATO
          TRAPCLR   FORMAT
          IF        OVRCD=1
            MOVE      ZERO,INCNNATO
            WRITAB    CONTROLF,SIXTY3;*141,INCNNATO
          ENDIF
.
          IF        INCNNATO=1
            MOVE      ZERO,OVRCD
            TRAP      OVERCOND IF IO
            OPEN      SINNATA1,"sinnataf"
            TRAPCLR   IO
            IF        OVRCD=1
              DISPLAY   *P1:24,*EL,*B,"Nato file does not exist. Run fixit.  ";
              CALL      HITENTER
              CHAIN     PGM
            ENDIF
.
            OPEN      SINNATA2,"sinnataf"
          ENDIF
.
ONAT9999  RETURN
.----------------------------------------------------------------------
. Set up screen 00
.----------------------------------------------------------------------
SETSCR00
          MOVE      ONE,ACCEPT              * set accept mode
          MOVE      ZERO,PRTPART            * set no part numbers
          MOVE      "Y",DEFYESNO
          RETURN
DEFAULTY    MOVE     ANSY,DEFYESNO
            RETURN
.----------------------------------------------------------------------
. Process Stocktake For Screen 01 - Random Stocktake
.----------------------------------------------------------------------
POSTA000  PACK      DISPMSG,SP70,SP70            * save line 24
          CALL      MESSAGE2
.
          READ      CONTROLF,SIXTY3;*146,INCOSTEX
          CALL      OPEN0000                * Open Export File
          BRANCH    EXIT,POSTA999           * Can't Open File
.
          MOVE      ZERO,CONTQTY
.
          CALL      CWARE000           * check warehouse
          BRANCH    EXIT,POSTA950
.
          OPEN      CONTROLF,"controlf"
          READ      CONTROLF,TWENTY3;*80,HFACTOR
.
          MOVE      HFACTOR,TOTONSTK
          CALL      RAND0000           * Perform Random Stocktake Generation
          BRANCH    EXIT,POSTA950
.
.--- count total number of records ----
.
          PACK      KEY12,SIWAWAR,SP70 * goto start of records
          CALL      RSSIIE2
.
POSTA100  CALL      RKSIIE2
          BRANCH    OVRCD,POSTA950     * any more records ?
.
          MATCH     SIIEWAR,SIWAWAR
          GOTO      POSTA950 IF NOT EQUAL
.
          PACK      KEY7,SIIECAT,SP70  * read catalog
          CALL      RDSIIA1
          BRANCH    OVRCD,POSTA100
.         srf 18093-Chk if catlg is susp. and supp. If yes, dont displ the rec.
          IF        SUPCATYN=0
            IF        SIIASUS=3
              GOTO      POSTA100            * Read next record
            ENDIF
          ENDIF
.                                           * srf 18093 - end
          BRANCH    SIIANON,POSTA100   * must be a stock item
.
          IF        SIIESTI=1
            CALL     PCATA000
          ENDIF
          GOTO      POSTA100
.
POSTA950  CALL      CNUMB000
          IF        EXIT<>1
            MOVE      ZERO,EXIT          * exit screen
          ENDIF
.
POSTA999  CALL      UUSIWA1
          CALL      MESSAGE3                     * restore line 24
          RETURN
.----------------------------------------------------------------------
. Process Stocktake For Random
.----------------------------------------------------------------------
RAND0000  CALL      ENOUGH00
          IF        CHKTOTAL < TOTONSTK
            MOVE      "Insufficient Stock for Random Stocktake - ",DISPMSG
            CALL      MESSAGE1
            MOVE      ONE,EXIT
            GOTO      RAND9999
          ENDIF
.
          CALL      MKSEED00
          IF        TOTONSTK>1
            PACK      KEY19,SIWAWAR,SP70
            CALL      RSSIRS1
            REPEAT
              CALL      GETRAN00
              SUB       ONE,TOTONSTK
            UNTIL     TOTONSTK=0
          ENDIF
          MOVE      ZERO,EXIT
.
RAND9999  RETURN
.----------------------------------------------------------------------
. Check if enough for a Random Stocktake in this warehouse
.----------------------------------------------------------------------
ENOUGH00  MOVE      ZERO,CHKTOTAL
          PACK      KEY12,SIWAWAR,SP70
          CALL      RSSIIE2
          REPEAT
            CALL      RKSIIE2
            MATCH     SIWAWAR,SIIEWAR
            IF        !@EQUAL | OVRCD<>0
              MOVE      ONE,OVRCD
            ELSE
              ADD       ONE,CHKTOTAL
            ENDIF
          UNTIL     OVRCD=1
.
ENOUGH99  RETURN
.----------------------------------------------------------------------
. Make Seed
.----------------------------------------------------------------------
MKSEED00  UNPACK    SP70,KEY2,KEY3,DIM2,KEY7
          CLOCK     TIME,CTIMEIS
          UNPACK    CTIMEIS,KEY2,ANS,DIM2,ANS,KEY3
          PACK      KEY3,KEY3,SP70
          PACK      KEY7,KEY2,DIM2,KEY3
          REP       " 0",KEY7
          MOVE     KEY7,INITSEED
          IF        INITSEED <= 999999
            UNPACK    KEY7,ANS,KEY6
            MOVE      "5",ANS
            PACK      KEY7,ANS,KEY6
            MOVE      KEY7,INITSEED
          ENDIF
.
MKSEED99  RETURN
.----------------------------------------------------------------------
. Get Next Random Record
.----------------------------------------------------------------------
GETRAN00  MOVE      FALSE,GOTRECRD
          REPEAT
            CALL      RKSIRS1
            MATCH     SIWAWAR,SIRSWAR
            IF        !@EQUAL | OVRCD=1
              CALL      CREAT000           * Create new Random File
              PACK      KEY19,SIWAWAR,SP70
              CALL      RSSIRS1
            ELSE
              MOVE      SIRSWAR,SIIEWAR
              MOVE      SIRSCAT,SIIECAT
              CALL      PCATA000
              PACK      KEY19,SIRSWAR,SIRSRAND,SIRSCAT,SP70
              CALL      DESIRS1
              CALL      RSSIRS1
            ENDIF
          UNTIL     GOTRECRD=TRUE
.
GETRAN99  RETURN
.----------------------------------------------------------------------
. Create new Random Stocktake Records for SIWAWAR
.----------------------------------------------------------------------
CREAT000  CALL      REMOV000           * Remove Old Ones
          MOVE      FALSE,CHANGWAR
          PACK      KEY12,SIWAWAR,SP70
          CALL      RSSIIE2
          REPEAT
            CALL      RKSIIE2
            MATCH     SIWAWAR,SIIEWAR
            IF        !@EQUAL | OVRCD<>0
              MOVE      TRUE,CHANGWAR
            ELSE
              CALL      RANDOM00            * Generate Random Number
              PACK      KEY19,SIIEWAR,SIRSRAND,SIIECAT,SP70
              UNPACK    KEY19,SIRSWAR,SIRSRAND,SIRSCAT
              PACK      KEY7,SIRSRAND
              REPEAT
                CALL      RASIRS2
                IF        OVRCD=0
                  MOVE      SIRSRAND,FORM7
                  ADD       ONE,FORM7
                  MOVE      FORM7,SIRSRAND
                  PACK      KEY7,SIRSRAND,SP70
                ENDIF
              UNTIL     OVRCD<>0
              PACK      KEY19,SIRSWAR,SIRSRAND,SIRSCAT
              CALL      WRSIRS1
            ENDIF
          UNTIL     CHANGWAR=TRUE
.
CREAT999  RETURN
.----------------------------------------------------------------------
. Generate Random Number
.----------------------------------------------------------------------
RANDOM00  ASSIGN    (MULTIPLY * INITSEED + INCRMENT)%MODULUS,INITSEED
          MOVE      INITSEED,SIRSRAND
.
RANDOM99  RETURN
.----------------------------------------------------------------------
. Remove Old Ones if they exist
.----------------------------------------------------------------------
REMOV000  MOVE      TRUE,GOTRECRD
          PACK      KEY19,SIWAWAR,SP70
          CALL      RSSIRS1
          REPEAT
            CALL      RKSIRS1
            MATCH     SIRSWAR,SIWAWAR
            IF        !@EQUAL | OVRCD<>0
              MOVE      FALSE,GOTRECRD
            ELSE
              PACK      KEY19,SIRSWAR,SIRSRAND,SIRSCAT,SP70
              CALL      DESIRS1
              CALL      RSSIRS1
            ENDIF
          UNTIL     GOTRECRD=FALSE
.
REMOV999  RETURN
.----------------------------------------------------------------------
. Process Stocktake For Screen 02 - Product Group Stocktake
.----------------------------------------------------------------------
POSTB000  PACK      DISPMSG,SP70,SP70            * save line 24
          CALL      MESSAGE2
.
          READ      CONTROLF,SIXTY3;*146,INCOSTEX
          CALL      OPEN0000                * Open Export File
          BRANCH    EXIT,POSTB950           * Can't Open File
.
          CALL      CPROD000           * check product group
          BRANCH    EXIT,POSTB950
.
          MOVE      ZERO,CONTQTY       * clear item count
          CALL      CWARE000           * check warehouse
          BRANCH    EXIT,POSTB950
.
          PACK      KEY12,SIWAWAR,SP70 * goto start of records
          CALL      RSSIIE2
.
POSTB100  CALL      RKSIIE2
          BRANCH    OVRCD,POSTB900     * any more records ?
          MATCH     SIIEWAR,SIWAWAR
          GOTO      POSTB900 IF NOT EQUAL
.
          PACK      KEY7,SIIECAT,SP70  * check product group
          CALL      RDSIIA1
          BRANCH    OVRCD,POSTB100
.         srf 18093-Chk if catlg is susp. and supp. If yes, dont displ the rec.
          IF        SUPCATYN=0
            IF        SIIASUS=3
              GOTO      POSTB100            * Read next record
            ENDIF
          ENDIF
.                                           * srf 18093 - end
          BRANCH    SIIANON,POSTB100   * must be a stock item
.
          MATCH     SISACODE,SIIASUB
          GOTO      POSTB100 IF NOT EQUAL
.
          CALL      PCATA000          * process catalog
          GOTO      POSTB100
.
POSTB900  CALL      CNUMB000           * check how many items selected
          BRANCH    EXIT,POSTB950
.
          MOVE      ZERO,EXIT          * exit screen
          GOTO      POSTB999
.
POSTB950  MOVE      ONE,EXIT           * return to prompt
.
POSTB999  CALL      MESSAGE3                     * restore line 24
          RETURN
.----------------------------------------------------------------------
. Process Stocktake For Screen 03 - Full Stocktake
.----------------------------------------------------------------------
POSTC000  PACK      DISPMSG,SP70,SP70            * save line 24
          CALL      MESSAGE2
.
          READ      CONTROLF,SIXTY3;*146,INCOSTEX
          CALL      OPEN0000                * Open Export File
          BRANCH    EXIT,POSTC950           * Can't Open File
.
          MOVE      ZERO,CONTQTY       * clear item count
          CALL      CWARE000           * check warehouse
          BRANCH    EXIT,POSTC950
.
          PACK      KEY12,SIWAWAR,SP70 * goto start of records
          CALL      RSSIIE2
.
POSTC100  CALL      RKSIIE2
          BRANCH    OVRCD,POSTC900     * any more records ?
          MATCH     SIIEWAR,SIWAWAR
          GOTO      POSTC900 IF NOT EQUAL
.
          PACK      KEY7,SIIECAT,SP70  * read catalog
          CALL      RDSIIA1
          BRANCH    OVRCD,POSTC100
.         srf 18093-Chk if catlg is susp. and supp. If yes, dont displ the rec.
          IF        SUPCATYN=0
            IF        SIIASUS=3
              GOTO      POSTC100            * Read next record
            ENDIF
          ENDIF
.                                           * srf 18093 - end
          BRANCH    SIIANON,POSTC100   * must be a stock item
.
          CALL      PCATA000          * process catalog
          GOTO      POSTC100
.
POSTC900  CALL      CNUMB000           * check how many items selected
          BRANCH    EXIT,POSTC950
.
          MOVE      ZERO,EXIT          * exit screen
          GOTO      POSTC999
.
POSTC950  MOVE      ONE,EXIT           * return to prompt
.
POSTC999  CALL      MESSAGE3                     * restore line 24
          RETURN
.----------------------------------------------------------------------
. Process Stocktake For Screen 04 - Commodity Group Stocktake
.----------------------------------------------------------------------
POSTD000  PACK      DISPMSG,SP70,SP70            * save line 24
          CALL      MESSAGE2
.
          READ      CONTROLF,SIXTY3;*146,INCOSTEX
          CALL      OPEN0000                * Open Export File
          BRANCH    EXIT,POSTD950           * Can't Open File
.
          CALL      CCOMM000           * check commodity group
          BRANCH    EXIT,POSTD950
.
          MOVE      ZERO,CONTQTY       * clear item count
          CALL      CWARE000           * check warehouse
          BRANCH    EXIT,POSTD950
.
          PACK      KEY12,SIWAWAR,SP70 * goto start of records
          CALL      RSSIIE2
.
POSTD100  CALL      RKSIIE2
          BRANCH    OVRCD,POSTD900     * any more records ?
          MATCH     SIIEWAR,SIWAWAR
          GOTO      POSTD900 IF NOT EQUAL
.
          PACK      KEY7,SIIECAT,SP70  * read catalog data
          CALL      RDSIIA1
          BRANCH    OVRCD,POSTD100
.         srf 18093-Chk if catlg is susp. and supp. If yes, dont displ the rec.
          IF        SUPCATYN=0
            IF        SIIASUS=3
              GOTO      POSTD100            * Read next record
            ENDIF
          ENDIF
.                                           * srf 18093 - end
          BRANCH    SIIANON,POSTD100   * must be a stock item
.
          PACK      KEY5,SIIASUB,SP70  * read product group
          CALL      RDSISA1
          BRANCH    OVRCD,POSTD100
.
          MATCH     SIGACOD,SISACOMM   * check commodity group
          GOTO      POSTD100 IF NOT EQUAL
.
          CALL      PCATA000          * process catalog
          GOTO      POSTD100
.
POSTD900  CALL      CNUMB000           * check how many items selected
          BRANCH    EXIT,POSTD950
.
          MOVE      ZERO,EXIT          * exit screen
          GOTO      POSTD999
.
POSTD950  MOVE      ONE,EXIT           * return to prompt
.
POSTD999  CALL      MESSAGE3                     * restore line 24
          RETURN
.----------------------------------------------------------------------
. Process Stocktake For Screen 04 - Commodity Group Stocktake
.----------------------------------------------------------------------
POSTE000  PACK      DISPMSG,SP70,SP70  * save line 24
          CALL      MESSAGE2
.
          READ      CONTROLF,SIXTY3;*146,INCOSTEX
          CALL      OPEN0000           * Open Export File
          BRANCH    EXIT,POSTE950      * Can't Open File
.
          MOVE      ZERO,CONTQTY       * clear item count
          CALL      CWARE000           * check warehouse
          BRANCH    EXIT,POSTE950
.
          PACK      KEY12,SIWAWAR,SP70 * goto start of records
          CALL      RSSIIE2
.
POSTE100  CALL      RKSIIE2
          BRANCH    OVRCD,POSTE900     * any more records ?
          MATCH     SIIEWAR,SIWAWAR
          GOTO      POSTE900 IF NOT EQUAL
.
          MATCH     STRRAS,SIIERAS     * Check Range
          GOTO      POSTE100 IF LESS
          MATCH     SIIERAS,ENDRAS
          GOTO      POSTE100 IF LESS
.
          PACK      KEY7,SIIECAT,SP70  * read catalog data
          CALL      RDSIIA1
          BRANCH    OVRCD,POSTE100
.         srf 18093-Chk if catlg is susp. and supp. If yes, dont displ the rec.
          IF        SUPCATYN=0
            IF        SIIASUS=3
              GOTO      POSTE100            * Read next record
            ENDIF
          ENDIF
.                                           * srf 18093 - end
          BRANCH    SIIANON,POSTE100   * must be a stock item
.
          PACK      KEY5,SIIASUB,SP70  * read product group
          CALL      RDSISA1
          BRANCH    OVRCD,POSTE100
.
          CALL      PCATA000           * process catalog
          GOTO      POSTE100
.
POSTE900  CALL      CNUMB000           * check how many items selected
          BRANCH    EXIT,POSTE950
.
          MOVE      ZERO,EXIT          * exit screen
          GOTO      POSTE999
.
POSTE950  MOVE      ONE,EXIT           * return to prompt
.
POSTE999  CALL      MESSAGE3           * restore line 24
          RETURN
.----------------------------------------------------------------------
. Check if warehouse ok for stocktake
.----------------------------------------------------------------------
CWARE000  PACK      KEY5,SIWAWAR,SP70            * lock warehouse
          REPEAT
            CALL      RLSIWA1
            IF        OVRCD=1
              CLEAR     DISPMSG
              APPEND    "Warehouse Missing - ",DISPMSG
              DISPLAY   *P1:24,*+,*EL,*B,DISPMSG;
              CALL      HITENTER
              GOTO      CWARE950
            ENDIF
            IF        OVRCD=2
              KEYIN     *P1:24,*EL,"Warehouse Locked - (":
                        *V2LON,"R",*HOFF,")etry or e(":
                        *V2LON,"X",*HOFF,")it ? ",*V2LON,ANS
              PACK      ANS,ANS,SP70
              REP       UPPLOW,ANS
              MATCH     "X",ANS
              GOTO      CWARE950 IF EQUAL
              MATCH     "E",ANS
              GOTO      CWARE950 IF EQUAL
            ENDIF
          UNTIL     OVRCD=0
.
          CALL      OPSIWK1            * check if stocktake file exists
          IF        OVRCD=0
            CLOSE     SINWRKA1
            CLEAR     DISPMSG
            APPEND    "Stocktake in Progress for this Warehouse - ",DISPMSG
            DISPLAY   *P1:24,*+,*EL,*B,DISPMSG;
            CALL      HITENTER
            GOTO      CWARE950
          ENDIF
.
          CALL      CRSIWK1            * create stocktake file
          IF        OVRCD=1
            CLOSE     SINWRKA1
            CLEAR     DISPMSG
            APPEND    "Could not create Work File - ",DISPMSG
            APPEND    KEY8,DISPMSG
            APPEND    " - ",DISPMSG
            DISPLAY   *P1:24,*+,*EL,*B,DISPMSG;
            CALL      HITENTER
            GOTO      CWARE950
          ENDIF
.
.
CWARE900  MOVE      ZERO,EXIT          * continue
          GOTO      CWARE999
.
CWARE950  MOVE      ONE,EXIT           * quit
          CALL      UUSIWA1
.
CWARE999  RETURN
.----------------------------------------------------------------------
. Check if product group ok for stocktake
.----------------------------------------------------------------------
CPROD000  PACK      KEY5,SISACODE,SP70           * read product group
          CALL      RDSISA1
          IF        OVRCD=1
            CLEAR     DISPMSG
            APPEND    "Product Group Missing - ",DISPMSG
            DISPLAY   *P1:24,*EL,*+,*B,DISPMSG;
            CALL      HITENTER
            GOTO      CPROD950
          ENDIF
.
.
CPROD900  MOVE      ZERO,EXIT          * continue
          GOTO      CPROD999
.
CPROD950  MOVE      ONE,EXIT           * quit
.
CPROD999  RETURN
.----------------------------------------------------------------------
. Check if commodity group ok for stocktake
.----------------------------------------------------------------------
CCOMM000  PACK      KEY6,SIGACOD,SP70  * read commodity group          *C-59696
          CALL      RDSIGA1
          IF        OVRCD=1
            CLEAR     DISPMSG
            APPEND    "Commodity Group Missing - ",DISPMSG
            DISPLAY   *P1:24,*EL,*+,*B,DISPMSG;
            CALL      HITENTER
            GOTO      CCOMM950
          ENDIF
.
.
CCOMM900  MOVE      ZERO,EXIT          * continue
          GOTO      CCOMM999
.
CCOMM950  MOVE      ONE,EXIT           * quit
.
CCOMM999  RETURN
.----------------------------------------------------------------------
. Check how many items processed
.----------------------------------------------------------------------
CNUMB000  IF        CONTQTY>0
            CALL      PRNA0000         * print worksheets
          ELSE
            CLEAR     DISPMSG
            APPEND    "No Catalogs Found - ",DISPMSG
            DISPLAY   *P1:24,*EL,*+,*B,DISPMSG;
            CALL      HITENTER
            CALL      ISSIWK1          * delete stocktake file
            GOTO      CNUMB950
          ENDIF
.
.
CNUMB900  MOVE      ZERO,EXIT          * continue
          GOTO      CNUMB999
.
CNUMB950  MOVE      ONE,EXIT           * quit
.
CNUMB999  RETURN
.----------------------------------------------------------------------
. Process Catalog
.----------------------------------------------------------------------
PCATA000  DISPLAY   *P1:24,"Processing : ",*V2LON,SIIECAT,*EL;
          ADD       ONE,CONTQTY                  * increment item count
.
          PACK      KEY7,SIIECAT,SP70            * lock catalog
          REPEAT
            CALL      RLSIIA1
            IF        OVRCD=1
              CLEAR     DISPMSG
              APPEND    "Catalog ",DISPMSG
              APPEND    KEY7,DISPMSG
              APPEND    " Missing - ",DISPMSG
              DISPLAY   *P1:24,*+,*EL,*B,DISPMSG;
              CALL      HITENTER
              GOTO      PCATA999
            ENDIF
            IF        OVRCD=2
              KEYIN     *P1:24,*EL,"Catalog ",*DV,KEY7," Locked - (":
                        *V2LON,"R",*HOFF,")etry or (":
                        *V2LON,"S",*HOFF,")kip ? ",*V2LON,ANS
              PACK      ANS,ANS,SP70
              REP       UPPLOW,ANS
              MATCH     "S",ANS
              GOTO      PCATA999 IF EQUAL
            ENDIF
          UNTIL     OVRCD=0
.
          PACK      KEY12,SIIECAT,SIIEWAR,SP70   * lock catalog
          REPEAT
            CALL      RLSIIE1
            IF        OVRCD=1
              CLEAR     DISPMSG
              APPEND    "Catalog/Warehouse ",DISPMSG
              APPEND    KEY7,DISPMSG
              APPEND    " Missing - ",DISPMSG
              DISPLAY   *P1:24,*+,*EL,*B,DISPMSG;
              CALL      HITENTER
              GOTO      PCATA999
            ENDIF
            IF        OVRCD=2
              KEYIN     *P1:24,*EL,"Catalog/Ware ",*DV,KEY12," Locked - (":
                        *V2LON,"R",*HOFF,")etry or (":
                        *V2LON,"S",*HOFF,")kip ? ",*V2LON,ANS
              PACK      ANS,ANS,SP70
              REP       UPPLOW,ANS
              MATCH     "S",ANS
              GOTO      PCATA999 IF EQUAL
            ENDIF
          UNTIL     OVRCD=0
.
          MOVE      "2",AUDTTYPE       * before audit
          CALL      WASIIE00
          MOVE      ONE,SIIESTI        * set for stocktake
          CALL      UPSIIE1
          MOVE      "3",AUDTTYPE       * after audit
          CALL      WASIIE00
.
          PACK      KEY20,SIIEWAR,SIIERAS,SIIECAT,SP70
          UNPACK    KEY20,SIWKWAR,SIWKRACK,SIWKCAT
          MOVE      ZERO,SIWKCNT
          MOVE      SIIESOH,SIWKSOH
          CALL      RASIWK1
          IF        OVRCD=1
            CALL      WRSIWK1
            MOVE      TRUE,GOTRECRD
          ENDIF
.
PCATA999  CALL      UUSIIA1
          CALL      UUSIIE1
          RETURN
.**********************************************************************
. PRNA - print routine
. Requires IBACODFD/INC IBAPRNFD/INC
.          IBAIOCOD/INC IBAIOPRN/INC IBAPRINT
.  Note : already includes IBAPASFD & IBAPASIO
.**********************************************************************
PRNA0000  OPEN      IBACODE1,"ibacodef"     * open files
.         OPEN      IBAPRNT1,"ibaprntf"
.
          READ      CONTROLF,SIXTY3;*233,SNCOCAT6                      *I-f0903
.
          CLOSE     SCRSBGA1                * close files to stop "S*O 024"
          CLOSE     SCRPSTA1
.
          CALL      OPNPRINT                * open spool file
.
          OPEN      SCRSBGA1,"scrsbgaf"     * re-open files
          OPEN      SCRPSTA1,"scrpstaf"
.
          CALL      REPA0000                * print routine
          BRANCH    EXIT,PRNA9000           * check if anything to print
.
          IF        CPAGENO>0
            CALL      TRAN0000                * Transfer Export File
            CALL      SELPRINT
          ELSE
            DISPLAY   *P1:24,*EL,"Nothing to Print !! - ";
            CALL      HITENTER
          ENDIF
          MOVE      ZERO,EXIT               * 0=printed ok
.
PRNA9000  CALL      CLSPRINT                * close spool file
          CLOSE     IBACODE1                * close files
.         CLOSE     IBAPRNT1
.
PRNA9999  RETURN
.********************************************************************
. REPA - print report for SIWK                      Called by ML
.         Returns  : EXIT            (1=illegal range entered)
.********************************************************************
REPA0000  DISPLAY   *P1:24,"Printing :   ";
          MOVE      ZERO,CPAGENO                 * reset page no.
          CLOCK     TIME,CTIMEIS                 * get current time
          MOVE      "999",CLNO                   * init last line number
          MOVE      ZERO,CONTQTY                 * clear item count
          MOVE      ONE,OPTIONA
.
          CALL      FILA0000                     * go to correct posit in file
.
REPA1000  CALL      NREA0000                     * get next record
          BRANCH    OVRCD,REPA8000               * end of file ?
.
          DISPLAY   *P12:24,*V2LON,SIWKCAT,*EL;
          ADD       ONE,CONTQTY                  * increment item count
.
          CALL      WRIA0000                     * print details
          GOTO      REPA1000                     * get next record
.
REPA8000  COMPARE   ZERO,CPAGENO
          CALL      HEAA0000 IF EQUAL            * print head if nothing printed
          CALL      UND132                       * print line
          PRINT     CONTQTY," Items Printed":
                    *N,*N,*N,*72,"C O U N T E D   B Y   :":
                    *96,"________________",*N:
                    "*** END OF REPORT ***"
.
.
REPA9000  MOVE      ZERO,EXIT                    * exit screen
          GOTO      REPA9999
.
REPA9500  MOVE      ONE,EXIT                     * continue
.
REPA9999  RETURN
.**********************************************************************
.  FILA - Set file pointer                             Called By PRNA
.**********************************************************************
FILA0000  BRANCH    OPTIONA,FILA0100,FILA9999,FILA9999,FILA9999:
                            FILA9999,FILA9999,FILA9999,FILA9999
.
.---- print by type 1 ----
.
FILA0100  PACK      KEY20,SIWAWAR,SP70
          CALL      RSSIWK1
          CALL      RPSIWK1
          GOTO      FILA9999
.
FILA9999  RETURN
.**********************************************************************
.  NREA - Get next record                              Called By PRNA
.**********************************************************************
NREA0000  BRANCH    OPTIONA,NREA0100,NREA9999,NREA9999,NREA9999:
                            NREA9999,NREA9999,NREA9999,NREA9999
.
.---- print by type 1 ----
.
NREA0100  CALL      RKSIWK1
          BRANCH    OVRCD,NREA9500
          MATCH     SIWAWAR,SIWKWAR
          GOTO      NREA9500 IF NOT EQUAL
.
          GOTO      NREA9000
.
NREA9000  MOVE      ZERO,OVRCD         * continue
          GOTO      NREA9999
.
NREA9500  MOVE      ONE,OVRCD          * quit
.
NREA9999  RETURN
.********************************************************************
. HEAA - print report                               Called by PRNA
.********************************************************************
HEAA0000  CALL      HEAD132                      * print heading
.
          ADD       "2",CLNO
          PRINT     *40,"Warehouse : ",SIWAWAR,SP2,SIWADES,*N
          CALL      UND132                       * print line
          PRINT     *1,"Catalog":
                    *79,"Rack & Shelf":
                    *98,"Counted Stock",*117,"Issue Unit"
          ADD       "1",CLNO
          CALL      UND132                       * print line
.
HEAA9999  RETURN
.********************************************************************
. WRIA - print data line                            Called by PRNA
.********************************************************************
WRIA0000  COMPARE   "54",CLNO                    * end of page ?
          CALL      HEAA0000 IF NOT LESS         * start new page
.
          UNPACK    SP70,SIIADES,SIIAISS
          PACK      KEY7,SIWKCAT,SP70
          CALL      RDSIIA1
.                                           * Suppress printing if     *I-f0902
.                                           * selected, and Item is suspended
          IF        SUPCATYN=0
            MOVE      ZERO,SIIESUS          * reset status             *I-f0902
            PACK      KEY12,SIWKCAT,SIWKWAR,SP20                       *I-f0902
            CALL      RDSIIE1               * read Cat./Warehouse dets *I-f0902
            IF        SIIESUS=3
              GOTO      WRIA9999            * bypass printing          *I-f0902
            ENDIF                                                      *I-f0902
          ENDIF                                                        *I-f0902
          PRINT     *1,SIWKCAT,SP2,SIIADES,*81,SIWKRACK:
                    *96,"|              |",*117,SIIAISS
          ADD       "1",CLNO           * add one to line number
.
          PACK      PARTN1,SP70        * clear save variables
          PACK      PARTN2,SP70
          PACK      PARTCUR,SP70
          PACK      PARTDES,SP70
.
          CALL      EXPLN000          * Export Detail Line to File
.
          COMPARE   ONE,PRTPART        * printing part numbers ?
          GOTO      WRIA9000 IF NOT EQUAL
.
          MOVE      "Part Numbers : ",PARTDES
          PACK      KEY27,SIWKCAT,SP70 * get part numbers
          CALL      RSSIIC1
.
WRIA1000  CALL      RKSIIC1
          BRANCH    OVRCD,WRIA9000
          MATCH     SIICCAT,SIWKCAT
          GOTO      WRIA9000 IF NOT EQUAL
.
          MATCH     SP70,SIICPNO
          GOTO      WRIA1000 IF EQUAL
          MATCH     PARTCUR,SIICPNO
          GOTO      WRIA1000 IF EQUAL
.
          PACK      PARTCUR,SIICPNO,SP70
.
          MATCH     SP70,PARTN1
          IF        @EQUAL
            PACK      PARTN1,SIICPNO,SP70
          ELSE
            MATCH     SP70,PARTN2
            IF        @EQUAL
              PACK      PARTN2,SIICPNO,SP70
            ELSE
              PRINT     *10,PARTDES,PARTN1,SP1,PARTN2,*96,"|              |"
              ADD       "1",CLNO       * add one to line number
              PACK      PARTN1,SIICPNO,SP70
              PACK      PARTN2,SP70
              PACK      PARTDES,SP70
            ENDIF
          ENDIF
          GOTO      WRIA1000
.
WRIA9000  PRINT     *10,PARTDES,PARTN1,SP1,PARTN2,*96,"*--------------*"
          ADD       "1",CLNO           * add one to line number
.
WRIA9999  RETURN
.------------------------------------------------------------
. Write Stocktake Details to Export File
.------------------------------------------------------------
EXPLN000  COMPARE   ONE,INCOSTEX
          GOTO      EXPLN999 IF NOT EQUAL
          PACK      KEY27,SIWKCAT,SIIAPSC,SP70 * get part numbers
          CALL      RSSIIC1
          CALL      RKSIIC1
          BRANCH    OVRCD,EXPLN100
          MATCH     SIICCAT,SIWKCAT
          GOTO      EXPLN100 IF NOT EQUAL
          MATCH     SIICSUP,SIIAPSC
          GOTO      EXPLN200 IF EQUAL
.
EXPLN100  MOVE      SP70,SIICPNO
          GOTO      EXPLN200
.
....EXPLN200  WRITE     EXPORTFL,SEQ;SIWKCAT,SIIADES,SIWKRACK,SIIAISS,SIICPNO
.
EXPLN200  MOVE      SIWKCAT,KEY7                                       *I-f0903
          IF        SNCOCAT6 = 1
            SQUEEZE   KEY7                                             *I-f0903
            PACK      DIM7,KEY7,SP7                                    *I-f0903
            MOVE      DIM7,KEY7                                        *I-f0903
          ENDIF                                                        *I-f0903
.
          WRITE     EXPORTFL,SEQ;KEY7,SIIADES,SIWKRACK,SIIAISS,SIICPNO *I-f0903
.
EXPLN999  RETURN
.
.------------------------------------------------------------
. Open/Create Downlaod File
.------------------------------------------------------------
OPEN0000  MOVE      ZERO,EXIT
          COMPARE   ONE,INCOSTEX
          GOTO      OPEN9999 IF NOT EQUAL
.
          MOVE      ZERO,OVRCD
          TRAP      OVERCOND IF IO
          OPEN      EXPORTFL,"ibasin36"
          TRAPCLR   IO
          BRANCH    OVRCD,OPEN1000
.
OPEN0100  BEEP
          KEYIN     *P1:24,*EL,"Stocktake File Already Exists. Overwrite (":
                    *V2LON,"Y",*HOFF,"/":
                    *V2LON,"N",*HOFF,") ? ",*V2LON,ANS
          REP       UPPLOW,ANS
          MOVE      ONE,EXIT
          MATCH     "N",ANS
          GOTO      OPEN9999 IF EQUAL
          MATCH     "Y",ANS
          GOTO      OPEN0100 IF NOT EQUAL
          CLOSE     EXPORTFL,DELETE
.
OPEN1000  MOVE      ZERO,OVRCD
          TRAP      OVERCOND IF IO
          PREP      EXPORTFL,"ibasin36"
          TRAPCLR   IO
          BRANCH    OVRCD,OPEN9100
          MOVE      ZERO,EXIT
          GOTO      OPEN9999
.
OPEN9100  BEEP
          MOVE      "Unable to Create Export File - ",DISPMSG
          CALL      MESSAGE1
          MOVE      ONE,EXIT
          GOTO      OPEN9999
.
OPEN9999  RETURN
.--------------------------------------------------------------------------
. Execute Transfer Script eg softerm
.--------------------------------------------------------------------------
TRAN0000  COMPARE  ONE,INCOSTEX
          GOTO     TRAN9999 IF NOT EQUAL
          MOVE     YES,DEFYESNO
          DISPLAY  *P1:23,*EL
          DISPLAY  *P1:24,*EL,"Transfer Stocktake Export File (":
                              *V2LON,"Y",*HOFF,"/":
                              *V2LON,"N",*HOFF,") ? "
          MOVE     "24",CVERT
          MOVE     "40",CCOL
          CALL     YORN0000
          COMPARE  ZERO,FYESNO,
          GOTO     TRAN9000 IF EQUAL   *  No Transfer
.
          MOVE     ZERO,HLEF
          CALL     GETSCR00
.
          EXECUTE  "ibasin36.us1 ibasin36.txt",TASKID
.
          CALL     PUTSCR00
.
          DISPLAY  *P1:24,*EL,"Transfer Completed Ok (":
                              *V2LON,"Y",*HOFF,"/":
                              *V2LON,"N",*HOFF,") ? "
          MOVE     "24",CVERT
          MOVE     "31",CCOL
          CALL     YORN0000
          COMPARE  ZERO,FYESNO,
          GOTO     TRAN0000 IF EQUAL   *  Not ok
.
TRAN9000  CLOSE    EXPORTFL
          PREPARE  EXPORTFL,"ibasin36"
          CLOSE    EXPORTFL
.
TRAN9999  RETURN
.
.--------------------------------------------------
. Enter Range
.--------------------------------------------------
RRAS0000   MOVE     "    4",FLDID
           CALL     GETPOSIT
           KEYIN    *PCCOL:CVERT,*V2LON,*RV,KEY8
           ENDSET   KEY8
           APPEND   SP70,KEY8
           RESET    KEY8
           MATCH    SP70,KEY8
           GOTO     RRAS0100 IF EQUAL
           MATCH    EXITCHAR,KEY8
           GOTO     RRAS0950 IF EQUAL
.
           MOVE     KEY8,STRRAS
           MOVE     KEY8,FROMRAS
           GOTO     RRAS0140
RRAS0100   MOVE     "Start             ",FROMRAS
           MOVE     SP70,STRRAS
.
RRAS0140   MOVE     FROMRAS,VAR
           CALL     DISPITEM
.
RRAS0150   MOVE     "    5",FLDID
           CALL     GETPOSIT
           KEYIN    *PCCOL:CVERT,*V2LON,*RV,KEY8
           ENDSET   KEY8
           APPEND   SP70,KEY8
           RESET    KEY8
           MATCH    SP70,KEY8
           GOTO     RRAS0200 IF EQUAL
           MATCH    EXITCHAR,KEY8
           GOTO     RRAS0950 IF EQUAL
           MOVE     KEY8,ENDRAS
           MOVE     KEY8,TORAS
           MATCH    STRRAS,ENDRAS
           GOTO     RRAS0999 IF EQUAL
           GOTO     RRAS0999 IF NOT LESS
           BEEP
           MOVE     "To Rack & Shelf Must Be > From Rack & Shelf - ",DISPMSG
           CALL     MESSAGE1
           GOTO     RRAS0000
.
RRAS0200   MOVE     "Finish             ",TORAS
           MOVE     Z70,ENDRAS
           GOTO     RRAS0999
.
RRAS0950   MOVE     "    4",FLDID
           CALL     GETPOSIT
           MOVE     TWO,EXIT
           GOTO     RRAS9999
.
RRAS0999   MOVE     "    4",FLDID
           CALL     GETPOSIT
.
RRAS9999   RETURN
.
.-------------------------------
. Includes for I/O and Keyins
.-------------------------------
          INC       IBAPRINT    
          INC       IBAPRNIO/INC
          INC       SINCGAIO/INC
          INC       SINCGAKY    
          INC       SINCIAIO/INC
          INC       SINCICIO/INC
          INC       SINCIEIO/INC
          INC       SINNATIO/INC
          INC       SINRSTIO/INC
          INC       SINSUAIO/INC
          INC       SINSUAKY    
          INC       SINWARIO/INC
          INC       SINWRKCD    
          INC       SINWRKIO/INC
          INC       SINWSEIO/INC
          INC       SINWSEKY    
.
          INC       STDGENCD
.
