.**********************************************************************
.* System   : Operating Room System                                   *
.* Program  : IBAOPR02                                                *
.* Desc     : Operating Room Maintenance                              *
.**********************************************************************
.* Date     :  23.11.89                                               *
.* Author   :  D.Di.Paola.                                            *
.* Comment  :                                                         *
.* Modifications  : 09/10/90.  Modified according to new file layout  *
.*                  OPROPRFD  ( J. Ceniza )                           *
.*       V5.01.01 : 21/01/91   Rod Knowles                            *
.*                  Converted back to version 5.01                    *
.*       V5.04.01 : 02/06/97   Possessed by the Devil (Joy)           *
.*                  added general ledger code                         *
.**********************************************************************
.
 INC FMSSTDDF
          INC       OPROPRFD/INC           * Operating Room File
          INC       OPRCONFD/INC           * Operating Room Control file
          INC       PATCODFD/INC           * patient codes file
          INC       FMSCONFD/INC
          INC       FMSLMAFD/INC
          INC       FMSCCAFD/INC
+
.**********************************************************************
.*                           CONSTANTS                                *
.**********************************************************************
.
TEN440    FORM      "1440"            
CODEY1    INIT      "Y1"                   * category for user def. 1
CODEY2    INIT      "Y2"                   * category for user def. 2 
CODEY3    INIT      "Y3"                   * category for user def. 3
CODEY4    INIT      "Y4"                   * category for user def. 4
CODEY5    INIT      "Y5"                   * category for user def. 5
.
STATUS1   INIT      "Active"
STATUS2   INIT      "Non Active"
.
+
.**********************************************************************
.*                       GLOBAL VARIABLES                             *
.**********************************************************************
.
.
DAYNUM    FORM      1
FRITIME   FORM      4
.
INXA      FORM      1
ITEM      FORM      2
GLVERT    FORM      2
GLITEM    FORM      2
MONTIME   FORM      4
ROWNUM    FORM      3
SATTIME   FORM      4
SP40      DIM       40
STATIND   DIM       1
SUNTIME   FORM      4
THUTIME   FORM      4
TIME      FORM      4
TUETIME   FORM      4
PTCNUFMS  FORM      1
.
USERDEF1  FORM      1 
USERDEF2  FORM      1 
USERDEF3  FORM      1 
USERDEF4  FORM      1 
USERDEF5  FORM      1 
.
USERDES1  DIM       20
USERDES2  DIM       20
USERDES3  DIM       20
USERDES4  DIM       20
USERDES5  DIM       20
UVERT1    FORM      2
.
WEDTIME   FORM      4
.
PRGNAM    DIM       50
PRGID     INIT      "IBAOPR02"
PRGNAM1   INIT      " Maintenance"
VERSION   INIT      "V12.01.00"
+
.**********************************************************************
.*                           MAINLINE                                 *
.**********************************************************************
.
ML0000    CALL      INIT0000               * initialization and open files
          CALL      STOR0000               * store user defined parameters
.
ML0100    CALL      OPTN0000               * select options
          BRANCH    EXIT,ML9999            * EXIT = 1 if 0 chosen in menu
          BRANCH    COPTION,ML1000,ML2000,ML3000
.
. ---- add a Theatre code ----
.
ML1000    CALL      CLR0000                * clear input variables
          CALL      SCR0000                * display screen format
          CALL      PROC0000               * input theatre code
          BRANCH    EXIT,ML0100 
          CALL      ACPT0000               * accept initial values
          CALL      SEL0000                * select field to modify
.                                          * or ok to post
          BRANCH    EXIT,ML1000
          CALL      WRT0000                * write to file
          GOTO      ML1000
.
. ---- modify a theatre code ----
.
ML2000    CALL      CLR0000                * clear input variables
          CALL      SCR0000                * display screen format 
          CALL      ENTR0000               * enter theatre code
          BRANCH    EXIT,ML0100
          CALL      DISP0000               * display details
          CALL      SEL0000                * select field to modify
.                                          * or ok to post
          BRANCH    EXIT,ML2000
          CALL      UPD0000                * update record
          GOTO      ML2000
.
. ---- delete a theatre code ----
.
ML3000    CALL      CLR0000                * clear input variables
          CALL      SCR0000                * display screen format 
          CALL      INPT0000               * enter theatre code
          BRANCH    EXIT,ML0100
          CALL      DISP0000               * display detail 
          CALL      CONT0000               * ok to delete ?
          BRANCH    EXIT,ML3000
          CALL      DEL0000                * delete this record
          GOTO      ML3000
.
ML9999    CHAIN     PGM                    * chain back to program
+
.**********************************************************************
.*                             INIT0000                               *
.*                      Initialization  Routine                       *
.**********************************************************************
.
INIT0000    
          DISPLAY   *P57:24,"Opening controlf";
          OPEN      CONTROLF,"controlf"
.
          READ      CONTROLF,FORTY;*81,OPCNODSC       * read system definition
          REP       UPPLOW,OPCNODSC
.
          RESET     OPCNODSC,15
INIT1000  CMATCH    SP1,OPCNODSC
          GOTO      INIT2000 IF NOT EQUAL
          BUMP      OPCNODSC BY -1
          GOTO      INIT2000 IF EOS
          GOTO      INIT1000
INIT2000  MOVEFPTR  OPCNODSC,FORM2
          RESET     OPCNODSC,FORM2
          LENSET    OPCNODSC
          RESET     OPCNODSC
.
          PACK      PRGNAM,OPCNODSC,PRGNAM1             * get system name
          PACK      KEY60,PRGNAM
          CALL      DISPLIN2
.
          CALL      DISPHEAD
          DISPLAY   *P57:24,"Opening opropraf";
          OPEN      OPROPRA1,"opropraf"
.
          DISPLAY   *P57:24,"Opening opropraf";
          OPEN      OPROPRA2,"opropraf"
.
          DISPLAY   *P57:24,"Opening patcodes";
          OPEN      PATCODE1,"patcodes"
.
          READ      CONTROLF,FIFTY1;*60,FMSUUD4A
.
          READ      CONTROLF,FORTY;*203,OPCNUOU1,OPCNUOM1,OPCNUOU2,OPCNUOM2:
                                        OPCNUOU3,OPCNUOM3,OPCNUOU4,OPCNUOM4:
                                        OPCNUOU5,OPCNUOM5
          READ      CONTROLF,FIFTY9;*60,PTCNUFMS
          READ      CONTROLF,FORTY;*62,OPCNAUDT
.
          IF        PTCNUFMS=1
            DISPLAY   *P57:24,"Opening fmsccaaf";
            OPEN      FMSCCAA1,"fmsccaaf"
.
            DISPLAY   *P57:24,"Opening fmslmaaf";
            OPEN      FMSLMAA1,"fmslmaaf"
          ENDIF
.
          BRANCH    OPCNAUDT,INIT9999
          DISPLAY   *P57:24,"Opening opraudrm";
          OPEN      OPRAUDRM,"opraudrm"
.        
INIT9999  RETURN
.
+
.**********************************************************************
.*                             STOR0000                               *
.*                   store user defined fields parameters             *
.**********************************************************************
STOR0000  MOVE      ONE,INXA                   * 1st index to loop thru 5 fields
          MOVE      ONE,FORM2                  * 2nd index for field no.
          MOVE      ZERO,FIELDNO               * clear field no. variable
.
          MOVE      ZERO,USERDEF1              * clear temp user def variables
          MOVE      ZERO,USERDEF2
          MOVE      ZERO,USERDEF3
          MOVE      ZERO,USERDEF4
          MOVE      ZERO,USERDEF5
.
.------- determine which user defined fields are switched on -----
.
STOR1000  ADD       ONE,FIELDNO                   * increment field no.
          COMPARE   SIX,FIELDNO                   * check index
          GOTO      STOR9999 IF EQUAL
          LOAD      FORM1,FIELDNO,OPCNUOU1,OPCNUOU2,OPCNUOU3,OPCNUOU4,OPCNUOU5
          COMPARE   ZERO,FORM1                    * if "0" = No, switched off
          GOTO      STOR1000 IF EQUAL
.
          STORE     FIELDNO,FORM2,USERDEF1,USERDEF2,USERDEF3,USERDEF4,USERDEF5
          ADD       ONE,FORM2         * One more field to be added
          GOTO      STOR1000
.
.
STOR9999  RETURN
+
.**********************************************************************
.*                             CLR0000                                *
.*                 Routine to Clear Local Variables                   *
.**********************************************************************
.
CLR0000
.
. ----- Clear the Operating Room File Variables -----
.
          MOVE      SP6,OPRMROOM
          PACK      OPRMDESC,SP20,SP20
          MOVE      SP20,OPRMLOC
          UNPACK    SP30,OPRMUSR1,OPRMUSR2,OPRMUSR3,OPRMUSR4,OPRMUSR5
          MOVE      ZERO,OPRMSTAT
          MOVE      ZERO,OPRMSUN
          MOVE      ZERO,OPRMMON
          MOVE      ZERO,OPRMTUE
          MOVE      ZERO,OPRMWED
          MOVE      ZERO,OPRMTHU
          MOVE      ZERO,OPRMFRI
          MOVE      ZERO,OPRMSAT
.
.------ clear working variables ----
.
          MOVE      SP20,USERDES1
          MOVE      SP20,USERDES2
          MOVE      SP20,USERDES3
          MOVE      SP20,USERDES4
          MOVE      SP20,USERDES5
.
          MOVE      SP4,SUNTIME
          MOVE      SP4,MONTIME
          MOVE      SP4,TUETIME
          MOVE      SP4,WEDTIME
          MOVE      SP4,THUTIME
          MOVE      SP4,FRITIME
          MOVE      SP4,SATTIME
.
          RETURN
+
.****************************************************************************
.*                                OPTN0000                                  *
.*                        get user options or exit                          *
.*                                                                          *
.*    valid options     --->  (0) Exit                                      *
.*                            (1) Add                                       *
.*                            (2) Modify                                    *
.*                            (3) Delete                                    *
.****************************************************************************
.
. ---- display option screen ----
.
OPTN0000    MOVE      FALSE,EXIT
.
            HLINE     *G37,2,68,80
.
            CALL      SELOPTN                        * select option
            COMPARE   ZERO,COPTION
            GOTO      OPTN9000 IF EQUAL              * exit      
            COMPARE   FOUR,COPTION
            GOTO      OPTN0000 IF NOT LESS           * invalid option, re-enter
            GOTO      OPTN9999
.
OPTN9000    MOVE      TRUE,EXIT                      * set EXIT = 1 
.
OPTN9999    RETURN
+
.**********************************************************************
.*                            SCRN0000                                *
.*                     Main Data Screen Display                       *
.**********************************************************************
.
SCR0000
          DISPLAY   *P1:3,*EF:
                    *P5:4,"Operating Room",*P25:4," : ":
                    *P2:6,*V2LON,ONE,*HOFF,". Description          : ":
                    *P2:7,*V2LON,TWO,*HOFF,". Location             : ":
                    *P2:8,*V2LON,THREE,*HOFF,". Status               : "
.
          DISPLAY   *P5:9,*EL,"Time Available"
          DISPLAY   *P2:10,*EL,*V2LON,FOUR,*HOFF,". Sunday",*P25:10," : ":
                    *P34:10,"mins":
                    *P2:11,*EL,*V2LON,FIVE,*HOFF,". Monday",*P25:11," : ":
                    *P34:11,"mins":
                    *P2:12,*EL,*V2LON,SIX,*HOFF,". Tuesday",*P25:12," : ":
                    *P34:12,"mins":
                    *P2:13,*EL,*V2LON,SEVEN,*HOFF,". Wednesday",*P25:13," : ":
                    *P34:13,"mins":
                    *P2:14,*EL,*V2LON,EIGHT,*HOFF,". Thursday",*P25:14," : ":
                    *P34:14,"mins":
                    *P2:15,*EL,*V2LON,NINE,*HOFF,". Friday",*P25:15," : ":
                    *P34:15,"mins":
                    *P1:16,*EL,*V2LON,TEN,*HOFF,". Saturday",*P25:16," : ":
                    *P34:16,"mins"
.
.------ process screen for user defined fields -----
.
          MOVE      TEN7,CVERT                       * set up line
          MOVE      TEN1,ITEM                        * set up item no.
          COMPARE   ONE,OPCNUOU1                    * "0" = No, "1" = Yes 
          GOTO      SCR1000 IF NOT EQUAL            * if No, get next user def
          PACK      KEY5,CODEY1,SP3                 * read codes file to get 
          CALL      RDCODE1                         * user def 1 description
          BRANCH    OVRCD,SCR1000
          DISPLAY   *P1:CVERT,*V2LON,ITEM,*HOFF,". ",TDESC,*P25:CVERT," : ";
          ADD       ONE,ITEM                        * increment item by 1.
          ADD       ONE,CVERT                       * increment line by 1.
.
.------ display user defined field 2, if valid -----
.
SCR1000   COMPARE   ONE,OPCNUOU2                    * "0" = No, "1" = Yes
          GOTO      SCR1100 IF NOT EQUAL            * if No, get next user def
          PACK      KEY5,CODEY2,SP3                 * read codes file to get
          CALL      RDCODE1                         * user def 2 description
          BRANCH    OVRCD,SCR1100
          DISPLAY   *P1:CVERT,*V2LON,ITEM,*HOFF,". ",TDESC,*P25:CVERT," : ";
          ADD       ONE,ITEM                        * increment item by 1.
          ADD       ONE,CVERT                       * increment line by 1.
.
.------ display user defined field 3, if valid ------
.
SCR1100   COMPARE   ONE,OPCNUOU3                    * "0" = No, "1" = Yes
          GOTO      SCR1200 IF NOT EQUAL            * if No, get next user def
          PACK      KEY5,CODEY3,SP3                 * read codes file to get 
          CALL      RDCODE1                         * user def 3 description
          BRANCH    OVRCD,SCR1200
          DISPLAY   *P1:CVERT,*V2LON,ITEM,*HOFF,". ",TDESC,*P25:CVERT," : ";
          ADD       ONE,ITEM                        * increment item by 1.
          ADD       ONE,CVERT                       * increment line by 1.
.
.------- display user defined field 4, if vaild -----
.
SCR1200   COMPARE   ONE,OPCNUOU4                    * "0" = No, "1" = Yes
          GOTO      SCR1300 IF NOT EQUAL            * if No, get next user def
          PACK      KEY5,CODEY4,SP3                 * read codes file to get 
          CALL      RDCODE1                         * user def 4 description
          BRANCH    OVRCD,SCR1300
          DISPLAY   *P1:CVERT,*V2LON,ITEM,*HOFF,". ",TDESC,*P25:CVERT," : ";
          ADD       ONE,ITEM                        * increment line by 1.
          ADD       ONE,CVERT                       * increment item by 1.
.
.------- display user defined field 5, if valid ------
.
SCR1300   COMPARE   ONE,OPCNUOU5                    * "0" = No, "1" = Yes
          GOTO      SCR1500 IF NOT EQUAL            * If No, get next user def.
          PACK      KEY5,CODEY5,SP3                 * read codes file to get 
          CALL      RDCODE1                         * user def 5 description
          BRANCH    OVRCD,SCR1500
          DISPLAY   *P1:CVERT,*V2LON,ITEM,*HOFF,". ",TDESC,*P25:CVERT," : ";
          ADD       ONE,ITEM                        * increment item by 1
          ADD       ONE,CVERT                       * increment line by 1
.
SCR1500   IF        PTCNUFMS=1
              DISPLAY   *P1:CVERT,*V2LON,ITEM,*HOFF,". GL & Cost":
                        " Centre code:   /"
          ENDIF
.
SCR9999   RETURN
+
.**********************************************************************
.*                            PROC0000                                *
.*                 Routine to Keyin theatre Codes                     *
.**********************************************************************
.
PROC0000
          MOVE      FALSE,EXIT                       * initialise exit flag
.
          DISPLAY   *P28:4,*EL,UNDLN6;
          KEYIN     *P28:4,*V2LON,OPRMROOM;
          ENDSET    OPRMROOM
          APPEND    SP6,OPRMROOM
          RESET     OPRMROOM
          DISPLAY   *P28:4,*V2LON,OPRMROOM;
.
          MATCH     SP6,OPRMROOM                   * check for spaces
          GOTO      PROC9000 IF EQUAL
.
.-------- read operating room file to see if code already exists -----
.
          PACK      KEY6,OPRMROOM
          CALL      RDOPOPR1
          BRANCH    OVRCD,PROC9999
.
.-------- Record already exists ------
.
          DISPLAY   *P1:24,*B,"Record Already Exists - Hit <",*V2LON,"ENTER":
                           *HOFF,"> to Continue";
          KEYIN     ANS;
          DISPLAY   *P1:24,*EL;
          GOTO      PROC0000
.
PROC9000
          MOVE      TRUE,EXIT                         * set exit flag
PROC9999
          RETURN
+
.**********************************************************************
.*                           ENTR00000                                *
.*                  Read theatre File for Record                      *
.**********************************************************************
.
ENTR0000
          MOVE      FALSE,EXIT                          * initialise flag
.
          DISPLAY   *P28:4,*EL,UNDLN6;
          KEYIN     *P28:4,*V2LON,OPRMROOM;
          ENDSET    OPRMROOM
          APPEND    SP6,OPRMROOM
          RESET     OPRMROOM
          DISPLAY   *P28:4,*V2LON,OPRMROOM;
.
          MATCH     SP6,OPRMROOM                        * check for spaces
          GOTO      ENTR9500 IF EQUAL
.
.-------- read operating room to see if code is on file -----
.
          PACK      KEY6,OPRMROOM
          CALL      RDOPOPR1
          BRANCH    OVRCD,ENTR9000
          MOVE      OPRMSTAT,STATIND
          MOVE      OPRMSUN,SUNTIME
          MOVE      OPRMMON,MONTIME
          MOVE      OPRMTUE,TUETIME
          MOVE      OPRMWED,WEDTIME
          MOVE      OPRMTHU,THUTIME
          MOVE      OPRMFRI,FRITIME
          MOVE      OPRMSAT,SATTIME
          GOTO      ENTR9999
.
.------ record not on file -----
.
ENTR9000  DISPLAY   *P1:24,"Record Not on File - Hit <",*V2LON,"ENTER":
                           *HOFF,"> to Continue";
          KEYIN     ANS
          DISPLAY   *P1:24,*EL;
          GOTO      ENTR0000
ENTR9500
          MOVE      TRUE,EXIT                    * nothing entered
ENTR9999
         RETURN
.
.**********************************************************************
.*                           INPT00000                                *
.*                  Read Operating Room File for record               *
.**********************************************************************
.
INPT0000
          MOVE      FALSE,EXIT
.
          DISPLAY   *P28:4,*EL,UNDLN6;
          KEYIN     *P28:4,*V2LON,OPRMROOM;
          ENDSET    OPRMROOM
          APPEND    SP6,OPRMROOM
          RESET     OPRMROOM
          DISPLAY   *P28:4,*V2LON,OPRMROOM;
.
          MATCH     SP6,OPRMROOM
          GOTO      INPT9500 IF EQUAL
.
.--------- check if operating room code exists on file -----
.
          PACK      KEY6,OPRMROOM
          CALL      RDOPOPR1
          BRANCH    OVRCD,INPT9000
          MOVE      OPRMSTAT,STATIND         * status indicator "0" = Active
.                                                               "1" = Non Active
          MOVE      OPRMSUN,SUNTIME
          MOVE      OPRMMON,MONTIME
          MOVE      OPRMTUE,TUETIME
          MOVE      OPRMWED,WEDTIME
          MOVE      OPRMTHU,THUTIME
          MOVE      OPRMFRI,FRITIME
          MOVE      OPRMSAT,SATTIME
          GOTO      INPT9999
.
.------- Operating Room code Not On File ----
.
INPT9000  DISPLAY   *P1:24,*B,"Record Not on File - Hit <",*V2LON,"ENTER":
                           *HOFF,"> to Continue";
          KEYIN     ANS
          DISPLAY   *P1:24,*EL;
          GOTO      INPT0000
.
INPT9500  MOVE      TRUE,EXIT                    * nothing entered
INPT9999  RETURN
+
.**********************************************************************
.*                           ACPT00000                                *
.*                      Accept Initial Values                         *
.**********************************************************************
.
ACPT0000
          CALL      DESC0000                    * keyin description
.
          CALL      LOCN0000                    * keyin location 
.
          CALL      STAT0000                    * keyin Status Indicator
.
          DISPLAY   *P1:24,*EL                  * clear line 24
          MOVE      TEN,UVERT1                  * initialize row for keying in
          MOVE      ONE,DAYNUM                  * initialize day number
.
ACPT1000  COMPARE   EIGHT,DAYNUM                * gone through all the days ?
          GOTO      ACPT2000 IF EQUAL           * yes
.
          CALL      KTIM0000                    * keyin time available
          ADD       ONE,UVERT1
          ADD       ONE,DAYNUM
          GOTO      ACPT1000
.
ACPT2000  CALL      USER0000                    * keyin user defined field 1
.
          CALL      USER1000                    * keyin user defined field 2
. 
          CALL      USER2000                    * keyin user defined field 3 
. 
          CALL      USER3000                    * keyin user defined field 4
.
          CALL      USER4000                    * keyin user defined field 5 
.
          IF        PTCNUFMS=1
              ASSIGN    (OPCNUOU1+OPCNUOU2+OPCNUOU3+OPCNUOU4+OPCNUOU5+17),GLVERT
              MOVE      GLVERT,CVERT
              CALL      GLDG0000                * keyin G/L & Cost Centre code
          ENDIF
          RETURN
+
.**************************************************************************
.*                                   SEL0000                              *
.*                         select field to modify or post                 *
.**************************************************************************
.
SEL0000   MOVE      FALSE,EXIT
          CALL      MAINQST
          COMPARE   ZERO,CCITEM                * ok to post
          GOTO      SEL9999 IF EQUAL
          COMPARE   "-1",CCITEM                * cancel option
          GOTO      SEL9000 IF EQUAL
          BRANCH    CCITEM,SEL1000,SEL2000,SEL3000,SEL4000,SEL4000,SEL4000:
                           SEL4000,SEL4000,SEL4000,SEL4000,SEL5000,SEL5000:
                           SEL5000,SEL5000,SEL5000
.
          BEEP
          GOTO      SEL0000
.
SEL1000   CALL      DESC0000                        * keyin description
          GOTO      SEL0000
.
SEL2000   CALL      LOCN0000                        * keyin locn indicator
          GOTO      SEL0000
.
SEL3000   CALL      STAT0000                        * keyin status indicator
          GOTO      SEL0000
.
.-------- keyin time available-------
.
SEL4000   MOVE      CCITEM,UVERT1
          ADD       SIX,UVERT1                     * calculate line no. for
.                                                  * keying in time avail.
          SUB       THREE,CCITEM                   * calculate day number
          MOVE      CCITEM,DAYNUM                
          CALL      KTIM0000
          GOTO      SEL0000
.
.------- process user defined field   ------
.
SEL5000   ASSIGN    (OPCNUOU1+OPCNUOU2+OPCNUOU3+OPCNUOU4+OPCNUOU5+11),GLITEM
          ASSIGN    (OPCNUOU1+OPCNUOU2+OPCNUOU3+OPCNUOU4+OPCNUOU5+17),GLVERT
          IF        CCITEM=GLITEM
            GOTO      SEL8500               * G/L & Cost Centre code selected
          ENDIF
.
          MOVE      CCITEM,UVERT1
          ADD       SIX,UVERT1                     * calculate line no. for
.                                                   * user defined field
          SUB       TEN,CCITEM
.
.  determine which user defined fields are switched on. FORM1 contains the
.  'current' user defined field that is switched on
.
          LOAD      FORM1,CCITEM,USERDEF1,USERDEF2,USERDEF3,USERDEF4,USERDEF5
          BRANCH    FORM1,SEL8000,SEL8100,SEL8200,SEL8300,SEL8400
          BEEP
          GOTO      SEL0000
.
.------ the following calls are to the various user defined fields ------
.------ process user defined field 1. -------
.
SEL8000   CALL      USER0100
          GOTO      SEL0000
.
.------ process user defined field 2. -------
.
SEL8100   CALL      USER1100
          GOTO      SEL0000
.
.------ process user defined field 3. -------
.
SEL8200   CALL      USER2100
          GOTO      SEL0000
.
.------ process user defined field 4. -------
.
SEL8300   CALL      USER3100
          GOTO      SEL0000
.
.------ process user defined field 5. -------
.
SEL8400   CALL      USER4100
          GOTO      SEL0000
.
.------ process G/L & Cost Centre code ------
.
SEL8500   MOVE      GLVERT,CVERT
          CALL      GLDG0000 
          GOTO      SEL0000
.
SEL9000   MOVE      TRUE,EXIT                          * set exit
.
SEL9999   RETURN
+
.************************************************************************
.*  GLDG0000  :  keyin G/L and Cost Centre codes                        *
.************************************************************************
GLDG0000  MOVE      "28",CCOL
          CALL      KLMAFM00
          MATCH     SP2,FMLALEDG
          GOTO      GLDG9999 IF EQUAL
          MOVE      "31",CCOL
          CALL      KCCAFM00
          PACK      OPRMGLDG,FMLALEDG,FMCCCOCE    * set up file var
.
GLDG9999  RETURN
+
.**************************************************************************
.*                               DISP0000                                 *
.*                   Display Data from the Operating room file            *
.**************************************************************************
.
DISP0000
.
.------- display details ----
.
          DISPLAY   *P28:4,*V2LON,OPRMROOM:
                    *P28:6,OPRMDESC:
                    *P28:7,OPRMLOC:
                    *P28:8,STATIND;
.
          MATCH     "1",STATIND
          GOTO      DISP1000 IF EQUAL
.
          DISPLAY   *P34:8,"Active"
          GOTO      DISP1500
DISP1000
          DISPLAY   *P34:8,"Non Active"
.
DISP1500  DISPLAY   *P28:10,*V2LON,SUNTIME:
                    *P28:11,*V2LON,MONTIME:
                    *P28:12,*V2LON,TUETIME:
                    *P28:13,*V2LON,WEDTIME:
                    *P28:14,*V2LON,THUTIME:
                    *P28:15,*V2LON,FRITIME:
                    *P28:16,*V2LON,SATTIME
.
.-------- get user def field 1. details ------
.
DISP2000  MOVE      TEN7,CVERT                       * set line no.
          COMPARE   ZERO,OPCNUOU1                   * check if user switched on
          GOTO      DISP2100 IF EQUAL
          MATCH     SP3,OPRMUSR1
          GOTO      DISP2050 IF EQUAL
          PACK      KEY5,CODEY1,OPRMUSR1
          CALL      RDCODE1
          BRANCH    OVRCD,DISP2100
          MOVE      TDESC,USERDES1                  * get user def description
DISP2050  DISPLAY   *P28:CVERT,*V2LON,OPRMUSR1,*HOFF:
                    *P34:CVERT,USERDES1;
          ADD       ONE,CVERT                       * increment line number
.
.-------- display user def field 2. details ------
.
DISP2100  COMPARE   ZERO,OPCNUOU2,                  * test if switched on
          GOTO      DISP2200 IF EQUAL               * goto next user def if not
          MATCH     SP3,OPRMUSR2
          GOTO      DISP2150 IF EQUAL
          PACK      KEY5,CODEY2,OPRMUSR2
          CALL      RDCODE1
          BRANCH    OVRCD,DISP2200
          MOVE      TDESC,USERDES2                  * get user def description
DISP2150  DISPLAY   *P28:CVERT,*V2LON,OPRMUSR2,*HOFF:
                    *P34:CVERT,USERDES2;
          ADD       ONE,CVERT                       * increment line number
.
.-------- display user def field 3. details ------
.
DISP2200  COMPARE   ZERO,OPCNUOU3,                  * check if switched on
          GOTO      DISP2300 IF EQUAL
          MATCH     SP3,OPRMUSR3                    * check for spaces
          GOTO      DISP2250 IF EQUAL
          PACK      KEY5,CODEY3,OPRMUSR3
          CALL      RDCODE1                         * read codes file
          BRANCH    OVRCD,DISP2300
          MOVE      TDESC,USERDES3                  * get user def description 
DISP2250  DISPLAY   *P28:CVERT,*V2LON,OPRMUSR3,*HOFF:
                    *P34:CVERT,USERDES3;
          ADD       ONE,CVERT                       * increment line number 
.
.-------- display user def field 4. details -------
.
DISP2300  COMPARE   ZERO,OPCNUOU4                   * check user def switched on
          GOTO      DISP2400 IF EQUAL
          MATCH     SP3,OPRMUSR4                    * check for spaces
          GOTO      DISP2350 IF EQUAL
          PACK      KEY5,CODEY4,OPRMUSR4
          CALL      RDCODE1                         * read codes file 
          BRANCH    OVRCD,DISP2400
          MOVE      TDESC,USERDES4                  * get user def description
DISP2350  DISPLAY   *P28:CVERT,*V2LON,OPRMUSR4,*HOFF:
                    *P34:CVERT,USERDES4;
          ADD       ONE,CVERT                       * increment line number
.
.-------- display user def field 5. details --------
.
DISP2400  COMPARE   ZERO,OPCNUOU5                   * check user def switched on
          GOTO      DISP3000 IF EQUAL
          MATCH     SP3,OPRMUSR5                    * check code for spaces
          GOTO      DISP2450 IF EQUAL
          PACK      KEY5,CODEY5,OPRMUSR5 
          CALL      RDCODE1                         * read codes file
          BRANCH    OVRCD,DISP2470
          MOVE      TDESC,USERDES5                  * get description
DISP2450  DISPLAY   *P28:CVERT,*V2LON,OPRMUSR5,*HOFF:
                    *P34:CVERT,USERDES5;
DISP2470  ADD       ONE,CVERT
.
DISP3000  IF        PTCNUFMS=1
              UNPACK    OPRMGLDG,KEY2,KEY12
              DISPLAY   *P28:CVERT,*V2LON,KEY2,*HOFF,"/",*V2LON,KEY12
          ENDIF
.
DISP9999  RETURN
+
.**************************************************************************
.*                              DESC0000                                  *
.*                       Keyin Operating Room Description                 *
.**************************************************************************
.
DESC0000  PACK      SP40,SP30,SP10
          DISPLAY   *P28:6,*EL,UNDLN30,UNDLN10;
          KEYIN     *P28:6,*V2LON,OPRMDESC;
          DISPLAY   *P28:6,*V2LON,OPRMDESC;
.
          ENDSET    OPRMDESC
          APPEND    SP40,OPRMDESC
          RESET     OPRMDESC
          GOTO      DESC9000 IF EOS                * check for e.o.s.
          MATCH     SP40,OPRMDESC                  * check for spaces
          GOTO      DESC9000 IF EQUAL
          GOTO      DESC9999
.
.--------- Description is mandatory -----
.
DESC9000  DISPLAY   *P1:24,*EL,*B,"Description Is Mandatory - Hit <":
                    *V2LON,"ENTER",*HOFF,"> To Continue ";
          KEYIN     ANS;
          DISPLAY   *P1:24,*EL;                   * re enter description
          GOTO      DESC0000       
.
DESC9999
          RETURN
+
.**************************************************************************
.*                              LOCN0000                                  *
.*                     Keyin the Location                                 *
.**************************************************************************
.
LOCN0000
          DISPLAY   *P28:7,*EL,UNDLN20;
          KEYIN     *P28:7,*V2LON,OPRMLOC;
          DISPLAY   *P28:7,*V2LON,OPRMLOC;
. 
LOCN9999  RETURN
.
.**************************************************************************
.*                              STAT0000                                  *
.*                          Input the Status Indicator                    *
.**************************************************************************
STAT0000  MOVE      SP1,STATIND 
          DISPLAY   *P1:24,*EL,*V2LON,"0 ",*HOFF,"= Active, ":
                               *V2LON,"1 ",*HOFF,"= Non Active":
                    *P28:8,*EL,UNDLN1;
          KEYIN     *P28:8,*V2LON,STATIND;
          DISPLAY   *P28:8,*V2LON,STATIND;
          RESET     STATIND  
          GOTO      STAT0500 IF EOS
          MATCH     SP1,STATIND
          GOTO      STAT8000 IF EQUAL
          MATCH     "0",STATIND                      * 0 = Active
          GOTO      STAT1000 IF EQUAL
          MATCH     "1",STATIND                      * 1 = Non Active
          GOTO      STAT2000 IF EQUAL
          BEEP 
          GOTO      STAT0000                         * invalid entry
.
STAT0500  MOVE      "0",STATIND                      * default to active
          DISPLAY   *P28:8,*EL,*V2LON,STATIND,*HOFF;
.
STAT1000  DISPLAY   *P34:8,*EL,STATUS1;             * 0 = Active
          GOTO      STAT9999
STAT2000  DISPLAY   *P34:8,*EL,STATUS2;             * 1 = Non Active
          GOTO      STAT9999
.
.-------- Status indicator is mandatory -----
.
STAT8000  DISPLAY   *P1:24,*B,*EL,"Status Indicator Is Mandatory ":
                                  "- Hit <",*V2LON,"ENTER",*HOFF,"> ":
                                  "To Continue ";
          KEYIN     ANS;
          DISPLAY   *P1:24,*EL;
          GOTO      STAT0000                         * re enter
.
STAT9999  RETURN
+
.**************************************************************************
.*                         USER0000                                       *
.*                     process user defined fields 1.                     *
.**************************************************************************
USER0000  
          MOVE      TEN7,UVERT1
          COMPARE   ONE,OPCNUOU1                  * check if user field 1 used
          GOTO      USER0900 IF NOT EQUAL         * "0" = No, "1" = Yes
.
.------- process user defined field 1. -----
.
USER0100  MOVE      SP3,OPRMUSR1                  * clear working variables 
          MOVE      SP20,TDESC
          DISPLAY   *P28:UVERT1,*EL,UNDLN3;
          KEYIN     *P28:UVERT1,*V2LON,OPRMUSR1,*HOFF;
          DISPLAY   *P28:UVERT1,*V2LON,OPRMUSR1,*HOFF;
          RESET     OPRMUSR1
          GOTO      USER0200 IF EOS               * if e.o.s. check if mandatory
          ENDSET    OPRMUSR1
          APPEND    SP3,OPRMUSR1
          RESET     OPRMUSR1
          MATCH     SP3,OPRMUSR1                  * if spaces check if mandatory
          GOTO      USER0200 IF EQUAL
.
.------- check if "?" entered ------
.
          MATCH     QUEST,OPRMUSR1
          GOTO      USER0500 IF NOT EQUAL
          MOVE      CODEY1,CODE
          CALL      PATCODDS                      * call codes summary screen 
          CALL      RDSP0000                      * call redisplay routine
          GOTO      USER0100
.
.------- if spaces or e.o.s. entered, check if field is mandatory -------
.
USER0200  COMPARE   ZERO,OPCNUOM1               * check if user 1 is mandatory
          GOTO      USER0800 IF EQUAL           * "0" = No, "1" = Yes
          CALL      USER8500                    * if mandatory warn user
          GOTO      USER0100
.
.------- Valid code entered, however check to see if exists in code file ------
.
USER0500  MOVE      SP20,USERDES1                 * clear description
          PACK      KEY5,CODEY1,OPRMUSR1
          CALL      RDCODE1                       * read patients codes file
          COMPARE   ONE,OVRCD
          GOTO      USER0700 IF NOT EQUAL
          CALL      USER8000                      * call error routine
          GOTO      USER0100                      * re enter
.
USER0700  MOVE      TDESC,USERDES1                * get description
          DISPLAY   *P34:UVERT1,USERDES1;
.
USER0800  ADD       ONE,UVERT1                    * increment line by one.
.
USER0900  RETURN
.
.
.**********************************************************************
.*                         USER1000                                   *
.*                  process user defined field 2.                     *
.**********************************************************************
.
USER1000  COMPARE   ONE,OPCNUOU2            * check if user def 2. is used
          GOTO      USER1900 IF NOT EQUAL
.
USER1100  MOVE      SP3,OPRMUSR2            * clear code
          MOVE      SP20,TDESC
          DISPLAY   *P28:UVERT1,*EL,UNDLN3;
          KEYIN     *P28:UVERT1,*V2LON,OPRMUSR2,*HOFF;
          DISPLAY   *P28:UVERT1,*V2LON,OPRMUSR2,*HOFF;
          RESET     OPRMUSR2
          GOTO      USER1200 IF EOS                    * check for e.o.s.
          ENDSET    OPRMUSR2
          APPEND    SP3,OPRMUSR2
          RESET     OPRMUSR2
          MATCH     SP3,OPRMUSR2                       * check for spaces
          GOTO      USER1200 IF EQUAL
.
          MATCH     QUEST,OPRMUSR2                     * check for "?"
          GOTO      USER1500 IF NOT EQUAL
          MOVE      CODEY2,CODE
          CALL      PATCODDS                           * call code "?" routine
          CALL      RDSP0000                           * redisplay details 
          GOTO      USER1100                           * re enter
.
.------- if e.o.s. or spaces entered, check if mandatory ------
.
USER1200  COMPARE   ZERO,OPCNUOM2                      * check if mandatory
          GOTO      USER1800 IF EQUAL                  * if not exit routine
          CALL      USER8500                           * if mandatory call error
          GOTO      USER1100                           * re enter
.
.------- valid code entered, however check if on file -------
.
USER1500  MOVE      SP20,USERDES2
          PACK      KEY5,CODEY2,OPRMUSR2
          CALL      RDCODE1                         * read codes file
          COMPARE   ONE,OVRCD
          GOTO      USER1700 IF NOT EQUAL
          CALL      USER8000                        * if doesn't exist warn user
          GOTO      USER1100                        * re enter
.
.------- get user def description -------
.
USER1700  MOVE      TDESC,USERDES2               * move description to temp var
          DISPLAY   *P34:UVERT1,USERDES2;        * display description
.
USER1800  ADD       ONE,UVERT1                   * increment line number
.
USER1900  RETURN
.
.************************************************************************
.*                            USER2000                                  *
.*                   process user defined field 3                       *
.************************************************************************
.
USER2000  COMPARE   ONE,OPCNUOU3                 * "0" = No, "1" = Yes
          GOTO      USER2900 IF NOT EQUAL
.
USER2100  MOVE      SP3,OPRMUSR3                 * clear code 
          MOVE      SP20,TDESC
          DISPLAY   *P28:UVERT1,*EL,UNDLN3;
          KEYIN     *P28:UVERT1,*V2LON,OPRMUSR3,*HOFF;
          DISPLAY   *P28:UVERT1,*V2LON,OPRMUSR3,*HOFF;
          RESET     OPRMUSR3
          GOTO      USER2200 IF EOS              * check for e.o.s.
          ENDSET    OPRMUSR3
          APPEND    SP3,OPRMUSR3
          RESET     OPRMUSR3
          MATCH     SP3,OPRMUSR3                 * check for spaces
          GOTO      USER2200 IF EQUAL
.
          MATCH     QUEST,OPRMUSR3               * check if "?" entered
          GOTO      USER2500 IF NOT EQUAL
          MOVE      CODEY3,CODE
          CALL      PATCODDS                     * call codes file "?" routine
          CALL      RDSP0000                     * redisplay details
          GOTO      USER2100                     * re enter 
.
.------- if e.o.s. or spaces entered, check to see if mandatory ------
.
USER2200  COMPARE   ZERO,OPCNUOM3                * if "0" = No, then exit 
          GOTO      USER2800 IF EQUAL
          CALL      USER8500                     * warn user that it's mandatory
          GOTO      USER2100                     * re enter code 
.
.------ valid code entered, however check to see if exists on file -----
.
USER2500  MOVE      SP20,USERDES3                * clear description
          PACK      KEY5,CODEY3,OPRMUSR3
          CALL      RDCODE1                      * read codes file
          COMPARE   ONE,OVRCD
          GOTO      USER2700 IF NOT EQUAL
          CALL      USER8000                     * warn user if doesn't exists
          GOTO      USER2100                     * re enter 
.
USER2700  MOVE      TDESC,USERDES3               * get description
          DISPLAY   *P34:UVERT1,USERDES3;        * display description
.
USER2800  ADD       ONE,UVERT1                   * increment line number
USER2900  RETURN
.
.**************************************************************************
.*                           USER3000                                     *
.*                  process user defined field 4.                         *
.**************************************************************************
.
USER3000  COMPARE   ONE,OPCNUOU4                 * "0" = No, "1" = Yes
          GOTO      USER3900 IF NOT EQUAL
.
USER3100  MOVE      SP3,OPRMUSR4                 * clear code   
          MOVE      SP20,TDESC
          DISPLAY   *P28:UVERT1,*EL,UNDLN3;
          KEYIN     *P28:UVERT1,*V2LON,OPRMUSR4,*HOFF;
          DISPLAY   *P28:UVERT1,*V2LON,OPRMUSR4,*HOFF;
          RESET     OPRMUSR4
          GOTO      USER3200 IF EOS              * check for e.o.s.
          ENDSET    OPRMUSR4
          APPEND    SP3,OPRMUSR4
          RESET     OPRMUSR4
          MATCH     SP3,OPRMUSR4                 * check for spaces
          GOTO      USER3200 IF EQUAL
.
          MATCH     QUEST,OPRMUSR4               * check if "?" entered
          GOTO      USER3500 IF NOT EQUAL
          MOVE      CODEY4,CODE
          CALL      PATCODDS                     * call codes "?" routine
          CALL      RDSP0000                     * redisplay details
          GOTO      USER3100                     * re enter
.
.-------- if e.o.s. or spaces entered, check if code is mandatory ------
.
USER3200  COMPARE   ZERO,OPCNUOM4                * check if code is mandatory
          GOTO      USER3800 IF EQUAL
          CALL      USER8500                     * warn user if code mandatory
          GOTO      USER3100                     * re enter code
.
.------- if valid code entered, check if exists on file ------
.
USER3500  MOVE      SP20,USERDES4                * clear description
          PACK      KEY5,CODEY4,OPRMUSR4
          CALL      RDCODE1                      * read codes file
          COMPARE   ONE,OVRCD
          GOTO      USER3700 IF NOT EQUAL
          CALL      USER8000                     * warn user, code not on file
          GOTO      USER3100                     * re enter code
.
USER3700  MOVE      TDESC,USERDES4               * move description
          DISPLAY   *P34:UVERT1,USERDES4;        * display description
USER3800  ADD       ONE,UVERT1                   * increment line number
.
USER3900  RETURN
.
.***********************************************************************
.*                         USER5000                                    *
.*               process user defined field 5                          *
.***********************************************************************
.
USER4000  COMPARE   ONE,OPCNUOU5                 * "0" = No, "1" = Yes
          GOTO      USER4900 IF NOT EQUAL
USER4100  MOVE      SP3,OPRMUSR5                 * clear code
          MOVE      SP20,TDESC
          DISPLAY   *P28:UVERT1,*EL,UNDLN3;
          KEYIN     *P28:UVERT1,*V2LON,OPRMUSR5,*HOFF;
          DISPLAY   *P28:UVERT1,*V2LON,OPRMUSR5,*HOFF;
          RESET     OPRMUSR5
          GOTO      USER4200 IF EOS              * check for e.o.s.
          ENDSET    OPRMUSR5
          APPEND    SP3,OPRMUSR5
          RESET     OPRMUSR5
          MATCH     SP3,OPRMUSR5                 * check for spaces
          GOTO      USER4200 IF EQUAL
.
          MATCH     QUEST,OPRMUSR5               * check if "?" entered
          GOTO      USER4500 IF NOT EQUAL
          MOVE      CODEY5,CODE                  * get category
          CALL      PATCODDS                     * call codes file "?" routine
          CALL      RDSP0000                     * redisplay details
          GOTO      USER4100                     * re enter code
.
.-------- e.o.s. or spaces entered, however check to see if mandatory -----
.
USER4200  COMPARE   ZERO,OPCNUOM5                * "0" = No, "1" = Yes
          GOTO      USER4900 IF EQUAL
          CALL      USER8500                     * warn user if mandatory 
          GOTO      USER4100                     * re enter code 
.
.-------- valid code entered, however check if exists ------
.
USER4500  MOVE      SP20,USERDES5                * clear description
          PACK      KEY5,CODEY5,OPRMUSR5
          CALL      RDCODE1                      * read codes file
          COMPARE   ONE,OVRCD
          GOTO      USER4700 IF NOT EQUAL
          CALL      USER8000                     * warn user if invalid code
          GOTO      USER4100                     * re enter
.
USER4700  MOVE      TDESC,USERDES5               * get description
          DISPLAY   *P34:UVERT1,USERDES5;
USER4900  RETURN
.
.************************************************************************
.*                       USER8000                                       *
.*        Error message to warn user if an invalid code entered         *
.************************************************************************
.
USER8000  DISPLAY   *P1:24,*B,*EL,"Code Does Not Exist - Hit <":
                    *V2LON,"ENTER",*HOFF,"> To Continue ";
          KEYIN     ANS;
          DISPLAY   *P1:24,*EL;
          RETURN
.
.************************************************************************
.*                          USER8500                                    *
.*        Message to warn user that Code is mandatory if applicable     *
.************************************************************************
.
USER8500  DISPLAY   *P1:24,*B,*EL,"Code Is Mandatory - Hit <":
                    *V2LON,"ENTER",*HOFF,"> To Continue ";
          KEYIN     ANS;
          DISPLAY   *P1:24,*EL;
          RETURN
.
.**************************************************************************
.*                             KTIM0000                                   *
.*                  Keyin time available                                  *
.**************************************************************************
KTIM0000  KEYIN     *P28:UVERT1,*DV,UNDLN4:
                    *P28:UVERT1,*V2LON,TIME:
                    *P28:UVERT1,*DV,TIME

          COMPARE   TIME,TEN440               * Input > 1440 ?
          GOTO      KTIM1000 IF LESS          * Yes, invalid input
.
          COMPARE   ZERO,TIME                 * -ve time ?
          GOTO      KTIM1000 IF LESS          * Yes, invalid input
          GOTO      KTIM2000
.
KTIM1000  BEEP
          GOTO      KTIM0000
.
KTIM2000  BRANCH    DAYNUM,KTIM2100,KTIM2200,KTIM2300,KTIM2400,KTIM2500:
                           KTIM2600,KTIM2700
.
KTIM2100  MOVE      TIME,SUNTIME
          GOTO      KTIM9999
.
KTIM2200  MOVE      TIME,MONTIME
          GOTO      KTIM9999
.
KTIM2300  MOVE      TIME,TUETIME
          GOTO      KTIM9999
.
KTIM2400  MOVE      TIME,WEDTIME
          GOTO      KTIM9999
.
KTIM2500  MOVE      TIME,THUTIME
          GOTO      KTIM9999
.
KTIM2600  MOVE      TIME,FRITIME
          GOTO      KTIM9999

KTIM2700  MOVE      TIME,SATTIME 
KTIM9999  RETURN
.**************************************************************************
.*                             RDSP0000                                   *
.*                  Redisplay the Screen After a "?"                      *
.**************************************************************************
.
RDSP0000
          CALL      SCR0000                          * call screen
.
          DISPLAY   *P28:4,*V2LON,OPRMROOM:
                    *P28:6,OPRMDESC:
                    *P28:7,OPRMLOC:
                    *P28:8,STATIND;
.
          MATCH     "1",STATIND                     * "1" = Non Active
          GOTO      RDSP1000 IF EQUAL
.
          DISPLAY   *P34:8,"Active";                * "0" = Active
          GOTO      RDSP1500
RDSP1000
          DISPLAY   *P34:8,"Non Active"
RDSP1500  DISPLAY   *P28:10,*V2LON,SUNTIME:
                    *P28:11,*V2LON,MONTIME:
                    *P28:12,*V2LON,TUETIME:
                    *P28:13,*V2LON,WEDTIME:
                    *P28:14,*V2LON,THUTIME:
                    *P28:15,*V2LON,FRITIME:
                    *P28:16,*V2LON,SATTIME
.
.-------- redisplay user defined fields ------
.
RDSP2000  MOVE      TEN7,CVERT                     * set first line number
          COMPARE   ZERO,OPCNUOU1                  * check if switched on
          GOTO      RDSP2100 IF EQUAL
          DISPLAY   *P28:CVERT,*V2LON,OPRMUSR1,*HOFF:
                    *P34:CVERT,USERDES1;
          ADD       ONE,CVERT                      * increment line number
.
.-------- redisplay user defined field 2. if switched on ------
.
RDSP2100  COMPARE   ZERO,OPCNUOU2                  * check if switched on
          GOTO      RDSP2200 IF EQUAL
          DISPLAY   *P28:CVERT,*V2LON,OPRMUSR2,*HOFF:
                    *P34:CVERT,USERDES2;
          ADD       ONE,CVERT                      * increment line number
.
.-------- redisplay user defined field 3. if switched on -------
.
RDSP2200  COMPARE   ZERO,OPCNUOU3                  * check if switched 
          GOTO      RDSP2300 IF EQUAL
          DISPLAY   *P28:CVERT,*V2LON,OPRMUSR3,*HOFF:
                    *P34:CVERT,USERDES3;
          ADD       ONE,CVERT                      * increment line number
.
.------- redisplay user defined field 4. if switched on ------
.
RDSP2300  COMPARE   ZERO,OPCNUOU4                  * check if switched on
          GOTO      RDSP2400 IF EQUAL
          DISPLAY   *P28:CVERT,*V2LON,OPRMUSR4,*HOFF:
                    *P34:CVERT,USERDES4;
          ADD       ONE,CVERT                      * increment line number
. 
.------- redisplay user defined field 5. if switched on ------
.
RDSP2400  COMPARE   ZERO,OPCNUOU5                  * check if switched on
          GOTO      RDSP9999 IF EQUAL
          DISPLAY   *P28:CVERT,*V2LON,OPRMUSR5,*HOFF:
                    *P34:CVERT,USERDES5;           * display details
RDSP9999
          RETURN
+
.**************************************************************************
.*                              WRT0000                                   *
.*                   Write Data to the Operating Room File                *
.**************************************************************************
.
WRT0000
          DISPLAY   *P1:24,"Writing to Operating File - ":
                           *V2LON,*BLINKON,"Please Wait ",*W:
                    *P1:24,*EL;
.
          MOVE      STATIND,OPRMSTAT                 * move temp indic to var.
          MOVE      SUNTIME,OPRMSUN
          MOVE      MONTIME,OPRMMON
          MOVE      TUETIME,OPRMTUE
          MOVE      WEDTIME,OPRMWED
          MOVE      THUTIME,OPRMTHU
          MOVE      FRITIME,OPRMFRI
          MOVE      SATTIME,OPRMSAT
          PACK      KEY6,OPRMROOM
          
          CALL      WROPOPR1                         * write to operating file
          BRANCH    OPCNAUDT,WRT9000
          MOVE      "A",OPRMAUDR
          CALL      IBACLOCK
          CALL      WRTA0000                        * write audits
WRT9000   DISPLAY   *P1:24,*EL
WRT9999   RETURN
.**************************************************************************
.*                            WRTA0000                 Called by: ML0000  *
.*                          write audits                                  *
.**************************************************************************
+
WRTA0000  MOVE      CTIMEIS,OPRMAUDT
          PACK      OPRMAUDD,CCC,CYY,CMM,CDD
          REP       " 0",OPRMAUDD
          MOVE      PORT,OPRMAUDP
          MOVE      PASSCODE,OPRMAUDO
          MOVE      ONE,OPRMAUDS
          PACK      KEY19,OPRMAUDD,OPRMAUDT,OPRMAUDP,OPRMAUDR
          CALL      AWOPOPR

WRTA9999  RETURN
.
+
.**************************************************************************
.*                              UPD0000                                   *
.*                   Update Data in the Operating Room File               *
.**************************************************************************
UPD0000   BRANCH    OPCNAUDT,UPD1000
          CALL      IBACLOCK
          MOVE      "B",OPRMAUDR
          CALL      WRTA0000
.
UPD1000
          DISPLAY   *P1:24,"Updating Operating File - ":
                           *V2LON,*BLINKON,"Please Wait",*W:
                    *P1:24,*EL;
.
          MOVE      STATIND,OPRMSTAT                 * move temp indic to var.
          MOVE      SUNTIME,OPRMSUN
          MOVE      MONTIME,OPRMMON
          MOVE      TUETIME,OPRMTUE
          MOVE      WEDTIME,OPRMWED
          MOVE      THUTIME,OPRMTHU
          MOVE      FRITIME,OPRMFRI
          MOVE      SATTIME,OPRMSAT
          CALL      UPOPOPR1                      * update operating room file
          BRANCH    OPCNAUDT,UPD9999
          MOVE      "C",OPRMAUDR
          CALL      WRTA0000
.
UPD9999  RETURN
+

.
.**************************************************************************
.*                              DEL0000                                   *
.*               Delete a Record from the Operating Room File             *
.**************************************************************************
.
DEL0000
          DISPLAY   *P1:24,"Deleting Operating Room File Record ":
                           *V2LON,*BLINKON,"- Please Wait",*W:
                    *P1:24,*EL;
.
          CALL      DEOPOPR1                      * delete record from 
          BRANCH    OPCNAUDT,DEL9000
          MOVE      "D",OPRMAUDR
          CALL      IBACLOCK
          CALL      WRTA0000
DEL9000   DISPLAY   *P1:24,*EL 
.                                                 * Operating Room file
          RETURN
+
.**************************************************************************
.*                             CONT0000                                   *
.*                      O.K. to Continue for Delete                       *
.**************************************************************************
.
CONT0000
          MOVE      FALSE,EXIT
.
          DISPLAY   *P1:24,"O.K. to Delete Record (",*V2LON,"Y",*HOFF:
                           "/",*V2LON,"N",*HOFF,") ";
          KEYIN     *V2LON,ANS;
.
          CMATCH    ANSY,ANS                        * Yes delete record 
          GOTO      CONT9999 IF EQUAL
.
          CMATCH    ANSN,ANS                        * No don't delete
          GOTO      CONT9000 IF EQUAL
.
          BEEP
          GOTO      CONT0000                        * invalid entry renter
CONT9000
          MOVE      TRUE,EXIT                       * set exit
CONT9999
          RETURN
+
.********************************************************************** 
.*              I/O INCLUDES FOR FILES AND GENERAL ROUTINES           *
.**********************************************************************
.
.
.
         INC       STDGENCD
         INC       PATCODKY                * patient codes file routine
....     INC       PATCODDS                * patient codes file routine
          INC       FMSCCAKY
          INC       FMSLMAKY
          INC       FMSCODCD
         INC       PATCODIO/INC            * patient i/o for codes
         INC       OPROPRIO/INC            * operating room i/o
         INC       FMSCCAIO/INC
         INC       FMSLMAIO/INC
.
