.----------------------------------------------------------------------
. Program       : PATWEB08
.
. Function      : Maternity Details
.
. Modifications  :
.----------------------------------------------------------------------
. V12.01.01 03/02/2026  PJ Le Febour   TSK 0972012
.           PMSPRG00 -  CatCode=G IND16=P Pregnancy Details allowed
.----------------------------------------------------------------------
. V11.02.02 31/10/2022  Bella Turco    TSK 0921957
.           Added NOMORE00 - Display "No more records" at end of list
.           Added PTCNNRTD - Displays number of rows set by parameter value.
. V11.02.01 10/02/2022  Thanh T       TSK 0905641
.           Recompiled as OUTMA1FD (PATMASTM) changes
. V11.00.01 09/12/2020  Thanh T        TSK 0872840
.           Added PMSCCDFD/PMSCCDIO as PMSPX2TM changes
. V10.11.02 27/11/2017  Thanh Tieu     Task 0821710
.           Recompiled as PATMASTM changed
. V10.11.01 30/07/2017  Thanh T.       TSK 0821710
.           Audit admission/outpatient/UR comments. changed PATMASTM/PMSPX2TM.
.----------------------------------------------------------------------
. V10.04.02 07/04/2014  Peter Vela      CAR 286258
.           Recompiled for PATMASTM
. V10.04.01 31.03.2014  B.G.Ackland  CAR 299363
.           Replace META Tag Redirect with Javascript in Common RDIREC00
.           Routine
.----------------------------------------------------------------------
. V10.03.05 19/06/2012  Saroeun Soeur  CAR 262307
.           added delete for labour and birth events
.           PMSLEV60, PMSBEV60
. V10.03.04 14/06/2012  Saroeun Soeur  CAR 263307
.           added LKBY0000 - link baby UR list
. V10.03.03 14/04/2012  Saroeun Soeur  CAR 262308
.           parametize mandatory fields, CMAN0000
.           Recompiled for PMSMANDF
. V10.03.02 21/02/2012  Jill Parkinson CAR 260559 
.           Recompiled for PMSBTHTM
. V10.03.01 16/01/2012  Sandra Barcham  CAR 256563
.           Recompiled for PATMASTM
. V10.00.02 10/08/2010  Jill Parkinson CAR 222551
.           Added Mandatory Field validation
. V10.00.01 10/08/2010  Jill Parkinson CAR 222551
.           Added audit functionality    
. V10.00.00 02/06/2010  Jill Parkinson CAR 222551
.           Created program              
.----------------------------------------------------------------------
          INC       IBAWEBDF    
.
          INC       APSMASFD/INC
          INC       PMSLBRTD/INC
          INC       PMSBTHTD/INC
          INC       PMSRGNTD/INC
          INC       PMSWFMFD/INC
          INC       WEBDATDF
          INC       BOKRC1FD/INC
          INC       OUTBOAFD/INC
          INC       OUTBB1FD/INC
          INC       PATCONFD/INC
          INC       PATCALAG/INC
          INC       PMSBTHFD/INC
          INC       PMSINCFD/INC
          INC       PMSBEVFD/INC
          INC       PMSLEVFD/INC
          INC       PMSPCTFD/INC
          INC       PMSLBRFD/INC
          INC       PMSRGNFD/INC
          INC       PATHSPFD/INC
          INC       PATPR1FD/INC
          INC       PATWR1FD/INC
          INC       MRTMASFD/INC
          INC       PATMI1FD/INC
          INC       PMSUCHFD/INC
          INC       PMSUCDFD/INC
          INC       PATMASTD/INC
          INC       OUTSITFD/INC
          INC       PATVISFD/INC
          INC       PATFN1FD/INC
          INC       PATIN1FD/INC
          INC       PATDO1FD/INC
          INC       PATALRFD/INC
          INC       PATMA1FD/INC
          INC       PATDSCFD/INC
          INC       PMSEVTFD/INC
          INC       PATICDFD/INC
          INC       PATICOFD/INC
          INC       PATDADFD/INC
.
          INC       PMSCCDFD/INC   * Concession Card Details
          INC       PMSDTCFD/INC
          INC       PMSHCPFD/INC
          INC       PMSHCGFD/INC
          INC       PMSUPGFD/INC
          INC       PMSUPOFD/INC
          INC       PMSHPGFD/INC
          INC       PMSHPOFD/INC
          INC       PATTRNFD/INC
          INC       PMSVX1FD/INC
          INC       PMSPX2FD/INC
          INC       PMSPX2TD/INC
          INC       PMSPRBFD/INC
          INC       PMSAUPFD/INC
.
          INC       PMSHCPTD/INC
          INC       PMSHCGTD/INC
          INC       NHIMASFD/INC
          INC       NHIETHFD/INC
          INC       PATLINFD/INC
.
ALLMANDF  FORM      1
BREAKLIN  INIT      "<br>"
COUNTER   FORM      3
CURRUNIQ  DIM       10
DIM10     DIM       10
DIM80     DIM       80
DIM600    DIM       600
DOCTCODE  DIM       10
FORM5     FORM      5
FORM8     FORM      8
HTMLLNK2  DIM       127
MANDA     FORM      5
MANDCNT   FORM      5
NEXTPAGE  DIM       1
PSAGECON  DIM       3  
PSAGETYP  DIM       6  
BRTHUNIQ  DIM       10
PREGUNIQ  DIM       10
STARTKEY  DIM       10      * Starting Key
UPDTTYPE  DIM       1
.
PMWFM001  DIM       5
PMWFM002  DIM       35
PMWFM003  DIM       35
PMWFM004  DIM       35
PMWFM005  DIM       1 
.
PMPCT001  DIM       10 * Pregnancy Unique Id
PMPCT002  DIM       8  * Admission Number
PMPCT003  DIM       8  * Event Date
PMPCT004  DIM       8  * Event Time
PMPCT005  DIM       3  * Record Type 001 - Complication
.                                    002 - Birth Event
.                                    003 - Labour Event
PMPCT006  DIM       3  * Event Type (Cat CK)
PMPCT007  DIM       3  * Event Status (Cat EK)
PMPCT008  DIM       50 * Free Format Description 1
PMPCT009  DIM       50 * Free Format Description 2
.
PMBEV001  DIM       10 * Pregnancy Unique Id
PMBEV002  DIM       10 * Birth Unique Id 
PMBEV003  DIM       8  * Event Date
PMBEV004  DIM       8  * Event Time
PMBEV005  DIM       3  * Record Type 001 - Complication
.                                    002 - Birth Event
.                                    003 - Labour Event
PMBEV006  DIM       3  * Event Type (Cat CK)
PMBEV007  DIM       3  * Event Status (Cat EK)
PMBEV008  DIM       50 * Free Format Description 1
PMBEV009  DIM       50 * Free Format Description 2
.
PMLEV001  DIM       10 * Pregnancy Unique Id
PMLEV002  DIM       8  * Admission Number
PMLEV003  DIM       8  * Event Date
PMLEV004  DIM       8  * Event Time
PMLEV005  DIM       2  * Category    AF,AG,AH,AJ
PMLEV006  DIM       3  * Event Type (Cat above)
PMLEV007  DIM       3  * Event Status (Cat AL)
PMLEV008  DIM       50 * Free Format Description 1
PMLEV009  DIM       50 * Free Format Description 2
PMBEVCNT  FORM      2
PMLEVCNT  FORM      2
BDEARRAY  DIM       50[99]
BEVARRAY  DIM       3[99]
BEVCATAR  DIM       3[99]
BEVTYPE   DIM       3
BEVCODE   DIM       3
BEVDESC   DIM       50
LEVARRAY  DIM       3[99]
LEVCATAR  DIM       2[99]
LEVTYPE   DIM       2
LEVCODE   DIM       3
FIELDLT   DIM       1
.
RECODESC  DIM       20
SAVECNTR  DIM       3
SUPERFLG  DIM       1
.
CATLU     INIT      "LU"
COMPLICN  INIT      "Complication"
CONGENTL  INIT      "Congenital"
BIRTHEVN  INIT      "Birth Event"
LABOUREV  INIT      "Labour Event"
RESUSITN  INIT      "Resuscitation"
.
.------------------------------------------------------------------------------
PRGID     INIT      "PATWEB08"
VERSION   INIT      "V12.01.01"
PRGNAM    INIT      "Maternity Details"
.------------------------------------------------------------------------------
.
          CALL      WEBINT00       * Initialise Fifo Etc.
          CALL      INIT0000       * Open Files
.
MAIN1000  CALL      WEBRED00       * Read Fifo WEBPID and USERID
.
          COMPARE   "999",REPORTNO * End Server Process on Report Option 999
          GOTO      MAIN9999 IF EQUAL
.
          BRANCH    REPORTNO,MAIN1100,MAIN1200,MAIN1300,MAIN1400,MAIN1500:
                             MAIN1600,MAIN1700
.
          PACK      WEBTITLE,PRGID,SP1,VERSION,SP1,PRGNAM,SP70
          MOVE      "Invalid Option",WEBTITLE
          CALL      WEBERR00   * Create Output File and Write HTML Page Header
          GOTO      MAIN1000
.
MAIN1100  CALL      PMSPRG00                * Pregnancy Details
          BRANCH    EXIT,MAIN1000
          MOVE      "Pregnancy Details",WEBTITLE
          CALL      NXTPAG00
          GOTO      MAIN1000
.
MAIN1200  CALL      PMSPCT00                * Complication/Treatment Details
          BRANCH    EXIT,MAIN1000
          MOVE      "Complication/Treatment Details",WEBTITLE
          CALL      NXTPAG00
          GOTO      MAIN1000
.
MAIN1300  CALL      PMSLBR00                * Labour Details
          BRANCH    EXIT,MAIN1000
          MOVE      "Labour Details",WEBTITLE
          CALL      NXTPAG00
          GOTO      MAIN1000
.
MAIN1400  CALL      PMSBTH00                * Birth Details
          BRANCH    EXIT,MAIN1000
          MOVE      "Birth Details",WEBTITLE
          CALL      NXTPAG00
          GOTO      MAIN1000
.
MAIN1500  CALL      PMSBEV00                * Birth Event Details
          BRANCH    EXIT,MAIN1000
          MOVE      "Birth Event Details",WEBTITLE
          CALL      NXTPAG00
          GOTO      MAIN1000
.
MAIN1600  CALL      PMSLEV00                * Labour Event Details
          BRANCH    EXIT,MAIN1000
          MOVE      "Labour Event Details",WEBTITLE
          CALL      NXTPAG00
          GOTO      MAIN1000
.
MAIN1700  CALL      MATMAN00        * Maternity Mandatory Fields Maintenance
          BRANCH    EXIT,MAIN1000
          MOVE      "Maternity Mandatory Fields",WEBTITLE
          CALL      NXTPAG00
          GOTO      MAIN1000
.
MAIN9999  MOVE      "SERVER SHUTDOWN COMPLETE",WEBTITLE
          CALL      WEBERR00
          STOP
.
+
.------------------------------------------------------------
. Clear Parameters
.------------------------------------------------------------
CLRPAR00  MOVE      ZERO,REPORTNO
          PACK      REDIRECT,SP70,SP70,SP70,SP70
          MOVE      SP70,TEMPLATE
          MOVE      SP70,UPDTTYPE
          MOVE      SP70,URNUMBER
          MOVE      SP70,ADMISSNO
          MOVE      ZERO,NEXTPAGE
          MOVE      ZERO,STARTNUM
          MOVE      ZERO,SUPERFLG
          MOVE      ZERO,NORECORD
          MOVE      SP70,FRSTDATE
          MOVE      ZERO,VIEWTYPE
          MOVE      SP70,LASTDATE
          MOVE      SP70,VYEARMTH
          MOVE      Z70,PREGUNIQ
          MOVE      Z70,BRTHUNIQ
          MOVE      ZERO,PMLEVCNT
          MOVE      ZERO,PMBEVCNT
          MOVE      Z70,PMWFM001
          MOVE      Z70,PMWFM002
          MOVE      Z70,PMWFM003
          MOVE      Z70,PMWFM004
          MOVE      Z70,PMWFM005
.
          MOVE      ZERO,ALLMANDF
.
          CALL      CPPMRG00
          CALL      CPPMPC00
          CALL      CPPMLB00
          CALL      CPPMBE00
          CALL      CPPMLE00
          CALL      CPPMBT00
.
          RETURN
+
.------------------------------------------------------------
. Clear pmsbevaf fields
.------------------------------------------------------------
CPPMBE00  MOVE      Z70,PMBEV001 
          MOVE      Z70,PMBEV002
          MOVE      Z70,PMBEV003
          MOVE      Z70,PMBEV004
          MOVE      Z70,PMBEV005
          MOVE      Z70,PMBEV006
          MOVE      Z70,PMBEV007
          MOVE      Z70,PMBEV008
          MOVE      Z70,PMBEV009
.
CPPMBE99  RETURN
+
.------------------------------------------------------------
. Clear pmslevaf fields
.------------------------------------------------------------
CPPMLE00  MOVE      Z70,PMLEV001 
          MOVE      Z70,PMLEV002
          MOVE      Z70,PMLEV003
          MOVE      Z70,PMLEV004
          MOVE      Z70,PMLEV005
          MOVE      Z70,PMLEV006
          MOVE      Z70,PMLEV007
          MOVE      Z70,PMLEV008
          MOVE      Z70,PMLEV009
.
CPPMLE99  RETURN
+
.------------------------------------------------------------
. Open Files and Initialize Variables
.------------------------------------------------------------
INIT0000  CALL      INTMAS00 
          OPEN      BOKRC1A1,"bokrc1af"
          OPEN      PMSRGNA1,"pmsrgnaf"
          OPEN      PMSRGNA2,"pmsrgnaf"
          OPEN      PMSPCTA1,"pmspctaf"
          OPEN      PMSBEVA1,"pmsbevaf"
          OPEN      PMSLEVA1,"pmslevaf"
          OPEN      PMSLBRA1,"pmslbraf"
          OPEN      PMSBTHA1,"pmsbthaf"
          OPEN      PMSBTHA4,"pmsbthaf"
          OPEN      PATTRAN2,"pattranf"
          OPEN      PMSVX1A1,"pmsvx1af"
          OPEN      PMSAUPA1,"pmsaupaf"
          OPEN      PATCODE1,"patcodes"
          OPEN      PATCODE2,"patcodes"
          OPEN      PATDADA1,"patdadaf"
          OPEN      PATDSCH1,"patdschf"
          OPEN      PATHSPA1,"pathspaf"
          OPEN      PMSINCA1,"pmsincaf"
          OPEN      PATVISA2,"patvisaf"
          OPEN      PMSEVTA1,"pmsevtaf"
          OPEN      PATICDO1,"paticdof"
          OPEN      PATI10O1,"pati10of"
.
          OPEN      PMSCCDA1,"pmsccdaf"
          OPEN      PMSDTCA1,"pmsdtcaf"
          OPEN      PMSHCPA1,"pmshcpaf"
          OPEN      PMSWFMA1,"pmswfmaf"
          OPEN      PMSWFMA2,"pmswfmaf"
          OPEN      PATLINK1,"patlinkf"
.
          READ      CONTROLF,ZERO;*43,IBCNMHOS
          READ      CONTROLF,HUND25;*238,PTCNNRTD
.
          MOVE      ZERO,F2
          MOVE      PTCNNRTD,F2
          IF        F2 = 0
            MOVE      "10",PTCNNRTD
          ENDIF
.
          IF        IBCNMHOS=1
            OPEN      MLTCODA1,"mltcodaf"
            OPEN      MLTCODA2,"mltcodaf"
          ENDIF
.
INIT9999  RETURN
+
.------------------------------------------------------------
. Output Next Page Based on CGI Parameter nextpage
.------------------------------------------------------------
NXTPAG00  MOVE      ZERO,F1
          MOVE      NEXTPAGE,F1
          BRANCH    F1,NXTPAG10,NXTPAG20,NXTPAG30,NXTPAG40
.
          CALL      WINCLS00
          GOTO      NXTPAG99
.
NXTPAG10  CALL      RDIREC00
          GOTO      NXTPAG99
.
NXTPAG20  CALL      GOBACK00      * Go Back 1 Html page
          GOTO      NXTPAG99
.
NXTPAG30  CALL      DAH20000      * Go Back 2 html pages
          GOTO      NXTPAG99
.
NXTPAG40  CALL      PREDIR00      * Redirect Parent
          GOTO      NXTPAG99
.
NXTPAG99  RETURN
.-------------------------------------------------------------------------------
.  Goes back 1 page
.-------------------------------------------------------------------------------
GOBACK00  CALL      OPENHTML
          BRANCH    EXIT,GOBACK99
          WRITE     HTMLFILE;"<script type=#"text/javascript#"> {":
                             "    alert(#"",WEBTITLE,"#");":
                             "    self.close();":
                             "    opener.history.go(-1);":
                             "}":
                             "</script>"
          CALL      CLOSHTML
GOBACK99  RETURN
.------------------------------------------------------------------------------
.  Redirect Parent URL
.------------------------------------------------------------------------------
PREDIR00  CALL      OPENHTML
          BRANCH    EXIT,PREDIR90
.
          WRITE     HTMLFILE;"<script type=#"text/javascript#"> {":
.                             " alert(#"",WEBTITLE,"#");":
                             " parent.location.href=#"",REDIRECT,"#";":
                             "}":
                             "</script>"
          CALL      CLOSHTML
          GOTO      PREDIR99
.
PREDIR90  DISPLAY   "*** Fifo Not Found ***"
.
PREDIR99  RETURN
+
.------------------------------------------------------------
. Set Parameters
.------------------------------------------------------------
SETPAR00  MATCH     "reportno=",QRYNAME
          IF        @EQUAL
            MOVE      QRYDATA,REPORTNO
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "template=",QRYNAME
          IF        @EQUAL
            MOVE      QRYDATA,TEMPLATE
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "startnum=",QRYNAME
          IF        @EQUAL
            MOVE      QRYDATA,STARTNUM
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "redirect=",QRYNAME
          IF        @EQUAL
            MOVE      QRYDATA,REDIRECT
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "updttype=",QRYNAME
          IF        @EQUAL
            MOVE      QRYDATA,UPDTTYPE
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "superflg=",QRYNAME
          IF        @EQUAL
            MOVE      QRYDATA,SUPERFLG
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "preguniq=",QRYNAME
          IF        @EQUAL
            MOVE      QRYDATA,PREGUNIQ
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "brthuniq=",QRYNAME
          IF        @EQUAL
            MOVE      QRYDATA,BRTHUNIQ
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "urnumber=",QRYNAME
          IF        @EQUAL
            MOVE      QRYDATA,URNUMBER
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "admissno=",QRYNAME
          IF        @EQUAL
            MOVE      QRYDATA,ADMISSNO
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "nextpage=",QRYNAME
          IF        @EQUAL
            MOVE      QRYDATA,NEXTPAGE
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "viewtype=",QRYNAME
          IF        @EQUAL
            MOVE      QRYDATA,VIEWTYPE
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "lastdate=",QRYNAME
          IF        @EQUAL
            MOVE      QRYDATA,LASTDATE
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "frstdate=",QRYNAME
          IF        @EQUAL
            MOVE      QRYDATA,FRSTDATE
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "vyearmth=",QRYNAME
          IF        @EQUAL
            MOVE      QRYDATA,VYEARMTH
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "pmrgn",QRYNAME
          IF        @EQUAL
            CALL      SPMRG000
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "pmlbr",QRYNAME
          IF        @EQUAL
            CALL      SPMLB000
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "pmpct",QRYNAME
          IF        @EQUAL
            CALL      SPMPC000
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "pmbth",QRYNAME
          IF        @EQUAL
            CALL      SPMBT000
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "pmbev",QRYNAME
          IF        @EQUAL
            CALL      SPMBV000
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "pmlev1",QRYNAME
          IF        @EQUAL
            CALL      SLEV1000
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "pmbex",QRYNAME
          IF        @EQUAL
            CALL      SBEV1000
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "d_pmb",QRYNAME
          IF        @EQUAL
            MATCH     SP70,QRYDATA
            GOTO      SETPAR99 IF EQUAL
            GOTO      SETPAR99 IF EOS
            MOVE      QRYDATA,BDEARRAY[PMBEVCNT]
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "pmlev",QRYNAME
          IF        @EQUAL
            CALL      SPMLV000
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "dmpct003=",QRYNAME
          IF        @EQUAL
            MOVE      QRYDATA,PMPCT003
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "pmwfm",QRYNAME
          IF        @EQUAL
            CALL      STMAN000
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "dmbev003=",QRYNAME
          IF        @EQUAL
            MOVE      QRYDATA,PMBEV003
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "dmlev003=",QRYNAME
          IF        @EQUAL
            MOVE      QRYDATA,PMLEV003
            GOTO      SETPAR99
          ENDIF
.
SETPAR99  RETURN
+
SLEV1000  COMPARE   NINTY9,PMLEVCNT
          GOTO      SETPAR99 IF EQUAL
          ADD       ONE,PMLEVCNT
          MOVE      QRYDATA,LEVARRAY[PMLEVCNT]
          MATCH     "pmlev10",QRYNAME
          IF        @EQUAL
            MOVE      "AG",LEVCATAR[PMLEVCNT]
          ENDIF
          MATCH     "pmlev11",QRYNAME
          IF        @EQUAL
            MOVE      "AH",LEVCATAR[PMLEVCNT]
          ENDIF
          MATCH     "pmlev12",QRYNAME
          IF        @EQUAL
            MOVE      "AJ",LEVCATAR[PMLEVCNT]
          ENDIF
          MATCH     "pmlev13",QRYNAME
          IF        @EQUAL
            MOVE      "AN",LEVCATAR[PMLEVCNT]
          ENDIF
.
SLEV1999  RETURN
+
SBEV1000  COMPARE   NINTY9,PMBEVCNT
          GOTO      SETPAR99 IF EQUAL
          ADD       ONE,PMBEVCNT
          MOVE      QRYDATA,BEVARRAY[PMBEVCNT]
          MOVE      SP70,BDEARRAY[PMBEVCNT]
          MATCH     "pmbex1",QRYNAME
          IF        @EQUAL
            MOVE      "001",BEVCATAR[PMBEVCNT]
          ENDIF
          MATCH     "pmbex2",QRYNAME
          IF        @EQUAL
            MOVE      "002",BEVCATAR[PMBEVCNT]
          ENDIF
.
SBEV1999  RETURN
+
.-------------------------------------------------------------------------------
.   Set Parameters for Emergency Doctor Codes Table
.-------------------------------------------------------------------------------
STMAN000  MOVE      ZERO,EXIT
          UNPACK    QRYNAME,KEY5,KEY3
          MOVE      KEY3,F3
          BRANCH    F3,STMAN001,STMAN002,STMAN003,STMAN004,STMAN005 
.
          MOVE      ONE,EXIT
          GOTO      STMAN999
.
STMAN001  RESET     QRYDATA
          MATCH     SP70,QRYDATA   * Checks Qrydata
          IF        !@EQUAL
            MOVE      QRYDATA,PMWFM001
            MOVE      PMWFM001,MANDA    * Make it a numeric
            MOVE      MANDA,PMWFM001
          ELSE
            MOVE      SP70,PMWFM001
          ENDIF
          GOTO      STMAN900
STMAN002  MOVE      QRYDATA,PMWFM002
          GOTO      STMAN900
STMAN003  MOVE      QRYDATA,PMWFM003
          GOTO      STMAN900
STMAN004  MOVE      QRYDATA,PMWFM004
          GOTO      STMAN900
STMAN005  MOVE      QRYDATA,PMWFM005
          GOTO      STMAN900
.
STMAN900  GOTO      STMAN999
.
STMAN999  RETURN
+

.------------------------------------------------------------
. Pregnancy Details Maintenance
.------------------------------------------------------------
PMSPRG00  PACK      KEY8,URNUMBER,SP70
          CALL      RDMAST1
          BRANCH    OVRCD,PMSPRG95
          CALL      RDPMPX21
          IF        OVRCD=1
            CALL      CLPMSPX2
          ENDIF
.
          MATCH     ANSF,PSEX
          GOTO      PMSPRG05 IF EQUAL
.
          PACK      KEY5,ANSG,SP1,PSEX,SP70
          CALL      RDCODE1
          BRANCH    OVRCD,PMSPRG93
          MATCH     ANSP,TCINDC16
          GOTO      PMSPRG93 IF NOT EQUAL
.
PMSPRG05  CALL      CLPATVIS
          CALL      CLPMSVX1
          PACK      KEY8,ADMISSNO,SP70
          CALL      RDPTVIS1
          BRANCH    OVRCD,PMSPRG10
          CALL      RDPMVX11
          BRANCH    OVRCD,PMSPRG97
.
          CALL      CLPATMIS
          PACK      KEY8,ADMISSNO,SP70
          CALL      RDMISS1
          BRANCH    OVRCD,PMSPRG10
.
          IF        ASTAT=3
            PACK      KEY8,ADMISSNO
            CALL      RDDSCH1
            BRANCH    OVRCD,PMSPRG94
          ENDIF
.
PMSPRG10  CALL      CLPMSRGN                * Clear Pregnancy Variables
          MATCH     "A",UPDTTYPE            * Add
          GOTO      PMSPRG30 IF EQUAL
.
          MATCH     Z70,PREGUNIQ
          GOTO      PMSPRG25 IF EQUAL
.
          MATCH     Z70,PMRGN003
          IF        !@EQUAL
            PACK      KEY21,URNUMBER,PREGUNIQ,PMRGN003,Z70
            CALL      RDPMRGN1
          ELSE
            PACK      KEY21,URNUMBER,PREGUNIQ,Z70
            CALL      RSPMRGN1
            CALL      RPPMRGN1
          ENDIF
          IF        OVRCD=1
            CALL      CLPMSRGN
          ENDIF
.
PMSPRG25  MATCH     SP70,UPDTTYPE           * Dislay
          GOTO      PMSPRG50 IF EQUAL
.
          MATCH     "U",UPDTTYPE            * Update
          GOTO      PMSPRG40 IF EQUAL
.
          MOVE      "Invalid Update Type",WEBTITLE
          CALL      WEBERR00
          GOTO      PMSPRG99
.
PMSPRG30  CALL      ADDRGN00
          CALL      CHKMAN00         * must be last - loops lbr and bth files
          GOTO      PMSPRG99
.
PMSPRG40  CALL      UPDRGN00
          CALL      CHKMAN00         * must be last - loops lbr and bth files
          GOTO      PMSPRG99
.
PMSPRG50  MOVE      "Pregnancy Details Maintenance",WEBTITLE
          CALL      WEBHED00
          BRANCH    EXIT,PMSPRG99
          CALL      WEBBOD00
          CALL      WEBEND00
          MOVE      ONE,EXIT
          GOTO      PMSPRG99
.
PMSPRG93  MOVE      "Invalid Sex",WEBTITLE
          CALL      WEBERR00
          MOVE      ONE,EXIT
          GOTO      PMSPRG99
.
PMSPRG94  MOVE      "Missing Discharge Record",WEBTITLE
          CALL      WEBERR00
          MOVE      ONE,EXIT
          GOTO      PMSPRG99
.
PMSPRG95  MOVE      "Invalid Patient U/R",WEBTITLE
          CALL      WEBERR00
          MOVE      ONE,EXIT
          GOTO      PMSPRG99
.
PMSPRG96  MOVE      "Invalid Admission Record",WEBTITLE
          CALL      WEBERR00
          MOVE      ONE,EXIT
          GOTO      PMSPRG99
.
PMSPRG97  MOVE      "Missing Visit Extension Record",WEBTITLE
          CALL      WEBERR00
          MOVE      ONE,EXIT
          GOTO      PMSPRG99
.
PMSPRG98  MOVE      "Invalid Doctor Care Record",WEBTITLE
          CALL      WEBERR00
          MOVE      ONE,EXIT
          GOTO      PMSPRG99
.
PMSPRG99  RETURN
+
.------------------------------------------------------------
. Add new pregnancy record
.------------------------------------------------------------
ADDRGN00  CALL      GENQ0000       * Generate next unique id
.
          PACK      PMRGN002,PTCNPUNQ,SP70
          MOVE      ZERO,F3
          MOVE      F3,PMRGN003
.
          PACK      KEY21,PMRGN001,PMRGN002,PMRGN003,SP70
          CALL      RDPMRGN1
          COMPARE   ZERO,OVRCD
          GOTO      ADDRGN00 IF EQUAL
.
          CALL      CLPMSRGN
          CALL      MVPMRG00
.
          PACK      PMRGDATC,CCC,CYY,CMM,CDD
          REP       " 0",PMRGDATC
          CLOCK     TIME,PMRGTIMC
          MOVE      USERID,PMRGWEBC
.
          PACK      KEY21,PMRGURNO,PMRGUNIQ,PMRGCNTR,SP70
          CALL      RAPMRGN1
          IF        OVRCD=1
            CALL      WRPMRGN1
          ENDIF
.
          PACK      KEY10,PMRGUNIQ,SP70
          CALL      RAPMINC1
          IF        OVRCD=1
            PACK      PMINUNIQ,PMRGUNIQ,SP70
            CALL      WRPMINC1
          ENDIF
.
          MOVE      ZERO,EXIT
          GOTO      ADDRGN99
.
ADDRGN99  RETURN
+
.------------------------------------------------------------
. Generate Next Pregnancy Unique ID
.------------------------------------------------------------
GENQ0000  MOVE      ZERO,F10
          READ      CONTROLF,HUND18;*61,PTCNPUNQ
          MOVE      PTCNPUNQ,F10
          ADD       ONE,F10
          MOVE      F10,PTCNPUNQ
          WRITAB    CONTROLF,HUND18;*61,PTCNPUNQ
.
GENQ9999  RETURN
+
.------------------------------------------------------------
. Generate Next Birth Unique ID
.------------------------------------------------------------
GENB0000  MOVE      ZERO,F10
          READ      CONTROLF,HUND18;*72,PTCNBUNQ
          MOVE      PTCNBUNQ,F10
          ADD       ONE,F10
          MOVE      F10,PTCNBUNQ
          WRITAB    CONTROLF,HUND18;*72,PTCNBUNQ
.
GENB9999  RETURN
+
.------------------------------------------------------------
. Update Existing Pregnancy Details
.------------------------------------------------------------
UPDRGN00  MOVE      ZERO,F3
          MOVE      F3,PMRGN003
.
          PACK      KEY21,PMRGN001,PREGUNIQ,Z70
          CALL      RSPMRGN1
          CALL      RPPMRGN1
          BRANCH    OVRCD,UPDRGN90
.
          MATCH     PREGUNIQ,PMRGUNIQ
          GOTO      UPDRGN90 IF NOT EQUAL
.
          CALL      CLPMSRGN
          CALL      MVPMRG00
.
          PACK      PMRGDATC,CCC,CYY,CMM,CDD
          REP       " 0",PMRGDATC
          CLOCK     TIME,PMRGTIMC
          MOVE      USERID,PMRGWEBC
.
UPDRGN10  ADD       ONE,F3
          MOVE      F3,PMRGCNTR
.
          PACK      KEY21,PMRGURNO,PMRGUNIQ,PMRGCNTR,SP70
          CALL      RAPMRGN1
          IF        OVRCD<>1
            GOTO      UPDRGN10
          ENDIF
          CALL      WRPMRGN1

          MOVE      ZERO,EXIT
          GOTO      UPDRGN99
.
UPDRGN90  MOVE      "Invalid Record",WEBTITLE
          CALL      WEBERR00
          MOVE      ONE,EXIT
          GOTO      UPDRGN99
.
UPDRGN99  RETURN
+
.------------------------------------------------------------
. Birth Event Maintenance
.------------------------------------------------------------
PMSBEV00  MATCH     Z70,PREGUNIQ
          GOTO      PMSBEV90 IF EQUAL
.
          PACK      KEY8,URNUMBER,SP70
          CALL      RDMAST1
          BRANCH    OVRCD,PMSBEV95
          CALL      RDPMPX21
          IF        OVRCD=1
            CALL      CLPMSPX2
          ENDIF
.
          PACK      KEY21,URNUMBER,PREGUNIQ,Z70
          CALL      RSPMRGN1
          CALL      RPPMRGN1
          BRANCH    OVRCD,PMSBEV90
.
          MATCH     PMRGUNIQ,PREGUNIQ
          GOTO      PMSBEV90 IF NOT EQUAL
.
          CALL      CLPATVIS
          CALL      CLPMSVX1
          PACK      KEY8,ADMISSNO,SP70
          CALL      RDPTVIS1
          BRANCH    OVRCD,PMSBEV10
          CALL      RDPMVX11
          BRANCH    OVRCD,PMSBEV97
.
          CALL      CLPATMIS
          PACK      KEY8,ADMISSNO,SP70
          CALL      RDMISS1
          BRANCH    OVRCD,PMSBEV10
.
          IF        ASTAT=3
            PACK      KEY8,ADMISSNO
            CALL      RDDSCH1
            BRANCH    OVRCD,PMSBEV94
          ENDIF
.
PMSBEV10  MATCH     SP70,UPDTTYPE           * Dislay
          GOTO      PMSBEV50 IF EQUAL
.
          MATCH     "A",UPDTTYPE            * Add
          GOTO      PMSBEV30 IF EQUAL
.
          MATCH     "U",UPDTTYPE            * Update
          GOTO      PMSBEV40 IF EQUAL
.
          MATCH     "D",UPDTTYPE            * Delete
          GOTO      PMSBEV60 IF EQUAL
.
          MOVE      "Invalid Update Type",WEBTITLE
          CALL      WEBERR00
          GOTO      PMSBEV99
.
PMSBEV30  CALL      ADDBEV00
          GOTO      PMSBEV99
.
PMSBEV40  CALL      UPDBEV00
          GOTO      PMSBEV99
.
PMSBEV50  PACK      KEY42,PMBEV001,PMBEV002,PMBEV003,PMBEV004,PMBEV005,PMBEV006,SP70
          CALL      RDPMBEV1
          IF        OVRCD=1
            CALL      CLPMBV00
          ENDIF
          GOTO      PMSBEV80
.
PMSBEV60  PACK      KEY42,PMBEV001,PMBEV002,PMBEV003,PMBEV004,PMBEV005,PMBEV006,SP70
          CALL      RDPMBEV1
          IF        OVRCD<>1
            CALL      DEPMBEV1
            MOVE      ZERO,EXIT
          ELSE
            GOTO    PMSBEV98
          ENDIF
          GOTO      PMSBEV99
.
PMSBEV80  MOVE      "Birth Event Maintenance",WEBTITLE
          CALL      WEBHED00
          BRANCH    EXIT,PMSBEV99
          CALL      WEBBOD00
          CALL      WEBEND00
          MOVE      ONE,EXIT
          GOTO      PMSBEV99
.
.
PMSBEV90  MOVE      "Invalid Pregnancy Detail Record",WEBTITLE
          CALL      WEBERR00
          MOVE      ONE,EXIT
          GOTO      PMSBEV99
.
PMSBEV94  MOVE      "Missing Discharge Record",WEBTITLE
          CALL      WEBERR00
          MOVE      ONE,EXIT
          GOTO      PMSBEV99
.
PMSBEV95  MOVE      "Invalid Patient U/R",WEBTITLE
          CALL      WEBERR00
          MOVE      ONE,EXIT
          GOTO      PMSBEV99
.
PMSBEV96  MOVE      "Invalid Admission Record",WEBTITLE
          CALL      WEBERR00
          MOVE      ONE,EXIT
          GOTO      PMSBEV99
.
PMSBEV97  MOVE      "Missing Visit Extension Record",WEBTITLE
          CALL      WEBERR00
          MOVE      ONE,EXIT
          GOTO      PMSBEV99
.
PMSBEV98  MOVE      "No Birth Event",WEBTITLE
          CALL      WEBERR00
          MOVE      ONE,EXIT
          GOTO      PMSBEV99
.
PMSBEV99  RETURN
+
.------------------------------------------------------------
. Add new pregnancy complication/treatment record
.------------------------------------------------------------
ADDPCT00  PACK      KEY40,PMPCT001,PMPCT002,PMPCT003,PMPCT004,PMPCT005,PMPCT006,SP70
          CALL      RDPMPCT1
          COMPARE   ZERO,OVRCD
          GOTO      ADDPCT90 IF EQUAL
.
          CALL      CLPMPC00
          CALL      MVPMPC00
.
          PACK      PMPCDATC,CCC,CYY,CMM,CDD
          REP       " 0",PMPCDATC
          CLOCK     TIME,PMPCTIMC
          MOVE      USERID,PMPCWEBC
.
          PACK      KEY40,PMPCUNIQ,PMPCADMN,PMPCDATE,PMPCTIME,PMPCTYPE,PMPCETYP,SP70
          CALL      RAPMPCT1
          IF        OVRCD=1
            CALL      WRPMPCT1
          ENDIF
.
          MOVE      ZERO,EXIT
          GOTO      ADDPCT99
.
ADDPCT90  MOVE      "Record already exists",WEBTITLE
          CALL      WEBERR00
          MOVE      ONE,EXIT
          GOTO      PMSPCT99
.
ADDPCT99  RETURN
+
.------------------------------------------------------------
. Update pregnancy complication/treatment record
.------------------------------------------------------------
UPDPCT00  CALL      CLPMPC00
          PACK      KEY40,PMPCT001,PMPCT002,PMPCT003,PMPCT004,PMPCT005,PMPCT006,SP70
          CALL      RDPMPCT1
          COMPARE   ZERO,OVRCD
          GOTO      UPDPCT90 IF NOT EQUAL
.
          CALL      MVPMPC00
.
          PACK      PMPCDATU,CCC,CYY,CMM,CDD
          REP       " 0",PMPCDATU
          CLOCK     TIME,PMPCTIMU
          MOVE      USERID,PMPCWEBU
.
          PACK      KEY40,PMPCUNIQ,PMPCADMN,PMPCDATE,PMPCTIME,PMPCTYPE,PMPCETYP,SP70
          CALL      RAPMPCT1
          IF        OVRCD=0
            CALL      UPPMPCT1
          ENDIF
.
          MOVE      ZERO,EXIT
          GOTO      UPDPCT99
.
UPDPCT90  MOVE      "Invalid record",WEBTITLE
          CALL      WEBERR00
          MOVE      ONE,EXIT
          GOTO      UPDPCT99
.
UPDPCT99  RETURN
+
.------------------------------------------------------------
. Pregnancy Complications/Treatment Details Maintenance
.------------------------------------------------------------
PMSPCT00  MATCH     Z70,PREGUNIQ
          GOTO      PMSPCT90 IF EQUAL
.
          PACK      KEY8,URNUMBER,SP70
          CALL      RDMAST1
          BRANCH    OVRCD,PMSPCT95
          CALL      RDPMPX21
          IF        OVRCD=1
            CALL      CLPMSPX2
          ENDIF
.
          PACK      KEY21,URNUMBER,PREGUNIQ,Z70
          CALL      RSPMRGN1
          CALL      RPPMRGN1
          BRANCH    OVRCD,PMSPCT90
.
          MATCH     PMRGUNIQ,PREGUNIQ
          GOTO      PMSPCT90 IF NOT EQUAL
.
          CALL      CLPATVIS
          CALL      CLPMSVX1
          PACK      KEY8,ADMISSNO,SP70
          CALL      RDPTVIS1
          BRANCH    OVRCD,PMSPCT10
          CALL      RDPMVX11
          BRANCH    OVRCD,PMSPCT97
.
          CALL      CLPATMIS
          PACK      KEY8,ADMISSNO,SP70
          CALL      RDMISS1
          BRANCH    OVRCD,PMSPCT10
.
          IF        ASTAT=3
            PACK      KEY8,ADMISSNO
            CALL      RDDSCH1
            BRANCH    OVRCD,PMSPCT94
          ENDIF
.
PMSPCT10  MATCH     SP70,UPDTTYPE           * Dislay
          GOTO      PMSPCT50 IF EQUAL
.
          MATCH     "A",UPDTTYPE            * Add
          GOTO      PMSPCT30 IF EQUAL
.
          MATCH     "U",UPDTTYPE            * Update
          GOTO      PMSPCT40 IF EQUAL
.
          MOVE      "Invalid Update Type",WEBTITLE
          CALL      WEBERR00
          GOTO      PMSPCT99
.
PMSPCT30  CALL      ADDPCT00
          GOTO      PMSPCT99
.
PMSPCT40  CALL      UPDPCT00
          GOTO      PMSPCT99
.
PMSPCT50  PACK      KEY40,PMPCT001,PMPCT002,PMPCT003,PMPCT004,PMPCT005,PMPCT006,SP70
          CALL      RDPMPCT1
          IF        OVRCD=1
            CALL      CLPMPC00
          ENDIF
.
          MOVE      "Pregnancy Complications Maintenance",WEBTITLE
          CALL      WEBHED00
          BRANCH    EXIT,PMSPCT99
          CALL      WEBBOD00
          CALL      WEBEND00
          MOVE      ONE,EXIT
          GOTO      PMSPCT99
.
PMSPCT90  MOVE      "Invalid Pregnancy Detail Record",WEBTITLE
          CALL      WEBERR00
          MOVE      ONE,EXIT
          GOTO      PMSPCT99
.
PMSPCT94  MOVE      "Missing Discharge Record",WEBTITLE
          CALL      WEBERR00
          MOVE      ONE,EXIT
          GOTO      PMSPCT99
.
PMSPCT95  MOVE      "Invalid Patient U/R",WEBTITLE
          CALL      WEBERR00
          MOVE      ONE,EXIT
          GOTO      PMSPCT99
.
PMSPCT96  MOVE      "Invalid Admission Record",WEBTITLE
          CALL      WEBERR00
          MOVE      ONE,EXIT
          GOTO      PMSPCT99
.
PMSPCT97  MOVE      "Missing Visit Extension Record",WEBTITLE
          CALL      WEBERR00
          MOVE      ONE,EXIT
          GOTO      PMSPCT99
.
PMSPCT99  RETURN
+
.------------------------------------------------------------
. Add new birth event record
.------------------------------------------------------------
ADDBEV00  PACK      KEY42,PMBEV001,PMBEV002,PMBEV003,PMBEV004,PMBEV005,PMBEV006,SP70
          CALL      RDPMBEV1
          COMPARE   ZERO,OVRCD
          GOTO      ADDBEV90 IF EQUAL
.
          CALL      CLPMBV00
          CALL      MVPMBV00
.
          PACK      PMBEDATC,CCC,CYY,CMM,CDD
          REP       " 0",PMBEDATC
          CLOCK     TIME,PMBETIMC
          MOVE      USERID,PMBEWEBC
.
          PACK      KEY42,PMBEUNIQ,PMBEBUNQ,PMBEEDAT,PMBEETIM,PMBETYPE,PMBEETYP,SP70
          CALL      RAPMBEV1
          IF        OVRCD=1
            CALL      WRPMBEV1
          ENDIF
.
          MOVE      ZERO,EXIT
          GOTO      ADDBEV99
.
ADDBEV90  MOVE      "Record already exists",WEBTITLE
          CALL      WEBERR00
          MOVE      ONE,EXIT
          GOTO      PMSBEV99
.
ADDBEV99  RETURN
+
.------------------------------------------------------------
. Update birth event record
.------------------------------------------------------------
UPDBEV00  CALL      CLPMBV00
          PACK      KEY42,PMBEV001,PMBEV002,PMBEV003,PMBEV004,PMBEV005,PMBEV006,SP70
          CALL      RDPMBEV1
          COMPARE   ZERO,OVRCD
          GOTO      UPDBEV90 IF NOT EQUAL
.
          CALL      MVPMBV00
.
          PACK      PMBEDATU,CCC,CYY,CMM,CDD
          REP       " 0",PMBEDATU
          CLOCK     TIME,PMBETIMU
          MOVE      USERID,PMBEWEBU
.
          PACK      KEY42,PMBEUNIQ,PMBEBUNQ,PMBEEDAT,PMBEETIM,PMBETYPE,PMBEETYP,SP70
          CALL      RAPMBEV1
          IF        OVRCD=0
            CALL      UPPMBEV1
          ENDIF
.
          MOVE      ZERO,EXIT
          GOTO      UPDBEV99
.
UPDBEV90  MOVE      "Invalid record",WEBTITLE
          CALL      WEBERR00
          MOVE      ONE,EXIT
          GOTO      UPDBEV99
.
UPDBEV99  RETURN
+
.------------------------------------------------------------
. Labour Event Maintenance
.------------------------------------------------------------
PMSLEV00  MATCH     Z70,PREGUNIQ
          GOTO      PMSLEV90 IF EQUAL
.
          PACK      KEY8,URNUMBER,SP70
          CALL      RDMAST1
          BRANCH    OVRCD,PMSLEV95
          CALL      RDPMPX21
          IF        OVRCD=1
            CALL      CLPMSPX2
          ENDIF
.
          PACK      KEY21,URNUMBER,PREGUNIQ,Z70
          CALL      RSPMRGN1
          CALL      RPPMRGN1
          BRANCH    OVRCD,PMSLEV90
.
          MATCH     PMRGUNIQ,PREGUNIQ
          GOTO      PMSLEV90 IF NOT EQUAL
.
          CALL      CLPATVIS
          CALL      CLPMSVX1
          PACK      KEY8,ADMISSNO,SP70
          CALL      RDPTVIS1
          BRANCH    OVRCD,PMSLEV10
          CALL      RDPMVX11
          BRANCH    OVRCD,PMSLEV97
.
          CALL      CLPATMIS
          PACK      KEY8,ADMISSNO,SP70
          CALL      RDMISS1
          BRANCH    OVRCD,PMSLEV10
.
          IF        ASTAT=3
            PACK      KEY8,ADMISSNO
            CALL      RDDSCH1
            BRANCH    OVRCD,PMSLEV94
          ENDIF
.
PMSLEV10  MATCH     SP70,UPDTTYPE           * Dislay
          GOTO      PMSLEV50 IF EQUAL
.
          MATCH     "A",UPDTTYPE            * Add
          GOTO      PMSLEV30 IF EQUAL
.
          MATCH     "U",UPDTTYPE            * Update
          GOTO      PMSLEV40 IF EQUAL
.
          MATCH     "D",UPDTTYPE            * Delete
          GOTO      PMSLEV60 IF EQUAL
.
          MOVE      "Invalid Update Type",WEBTITLE
          CALL      WEBERR00
          GOTO      PMSBEV99
.
PMSLEV30  CALL      ADDLEV00
          GOTO      PMSLEV99
.
PMSLEV40  CALL      UPDLEV00
          GOTO      PMSLEV99
.
PMSLEV50  PACK      KEY39,PMLEV001,PMLEV002,PMLEV003,PMLEV004,PMLEV005,PMLEV006,SP70
          CALL      RDPMLEV1
          IF        OVRCD=1
            CALL      CLPMLV00
          ENDIF
          GOTO      PMSLEV80
.          
PMSLEV60  PACK      KEY39,PMLEV001,PMLEV002,PMLEV003,PMLEV004,PMLEV005,PMLEV006,SP70
          CALL      RDPMLEV1
          IF        OVRCD<>1
            CALL      DEPMLEV1
            MOVE      ZERO,EXIT
          ELSE
            GOTO    PMSLEV98
          ENDIF
          GOTO      PMSLEV99
.
PMSLEV80  MOVE      "Labour Event Maintenance",WEBTITLE
          CALL      WEBHED00
          BRANCH    EXIT,PMSLEV99
          CALL      WEBBOD00
          CALL      WEBEND00
          MOVE      ONE,EXIT
          GOTO      PMSLEV99
.
PMSLEV90  MOVE      "Invalid Pregnancy Detail Record",WEBTITLE
          CALL      WEBERR00
          MOVE      ONE,EXIT
          GOTO      PMSLEV99
.
PMSLEV94  MOVE      "Missing Discharge Record",WEBTITLE
          CALL      WEBERR00
          MOVE      ONE,EXIT
          GOTO      PMSLEV99
.
PMSLEV95  MOVE      "Invalid Patient U/R",WEBTITLE
          CALL      WEBERR00
          MOVE      ONE,EXIT
          GOTO      PMSLEV99
.
PMSLEV96  MOVE      "Invalid Admission Record",WEBTITLE
          CALL      WEBERR00
          MOVE      ONE,EXIT
          GOTO      PMSLEV99
.
PMSLEV97  MOVE      "Missing Visit Extension Record",WEBTITLE
          CALL      WEBERR00
          MOVE      ONE,EXIT
          GOTO      PMSLEV99
.
PMSLEV98  MOVE      "No Labour Event",WEBTITLE
          CALL      WEBERR00
          MOVE      ONE,EXIT
          GOTO      PMSLEV99
.
PMSLEV99  RETURN
+
.------------------------------------------------------------
. Add new labour event record  from the labour details page
.------------------------------------------------------------
ADDEV000  MOVE      ZERO,COUNTER 
.
ADDEV100  ADD       ONE,COUNTER
          IF        COUNTER>PMLEVCNT
            GOTO      ADDEV999
          ENDIF
.
          PACK      LEVTYPE,LEVCATAR[COUNTER]
          PACK      LEVCODE,LEVARRAY[COUNTER]
.
          PACK    KEY39,PMLBUNIQ,PMLBADMN,PMLBDATL,PMLBTIML,LEVTYPE,LEVCODE,SP70
          CALL      RDPMLEV1
          COMPARE   ZERO,OVRCD
          GOTO      ADDLEV99 IF EQUAL
.
          CALL      CLPMLV00
          PACK      PMLVUNIQ,PMLBUNIQ,SP70
          PACK      PMLVADMN,PMLBADMN,SP70
          PACK      PMLVDATE,PMLBDATL,SP70
          PACK      PMLVTIME,PMLBTIML,SP70
          PACK      PMLVTYPE,LEVTYPE,SP70
          PACK      PMLVETYP,LEVCODE,SP70
          PACK      PMLVSTAT,SP70
          PACK      PMLVDES1,SP70
          PACK      PMLVDES2,SP70
.
          PACK      PMLVDATC,CCC,CYY,CMM,CDD
          REP       " 0",PMLVDATC
          CLOCK     TIME,PMLVTIMC
          MOVE      USERID,PMLVWEBC
.
          PACK  KEY39,PMLVUNIQ,PMLVADMN,PMLVDATE,PMLVTIME,PMLVTYPE,PMLVETYP,SP70
          CALL      RAPMLEV1
          IF        OVRCD=1
            CALL      WRPMLEV1
          ENDIF
.
          GOTO      ADDEV100
.
ADDEV999  RETURN
+
.------------------------------------------------------------
. Add new labour event record
.------------------------------------------------------------
ADDLEV00  PACK      KEY39,PMLEV001,PMLEV002,PMLEV003,PMLEV004,PMLEV005,PMLEV006,SP70
          CALL      RDPMLEV1
          COMPARE   ZERO,OVRCD
          GOTO      ADDLEV90 IF EQUAL
.
          CALL      CLPMLV00
          CALL      MVPMLV00
.
          PACK      PMLVDATC,CCC,CYY,CMM,CDD
          REP       " 0",PMLVDATC
          CLOCK     TIME,PMLVTIMC
          MOVE      USERID,PMLVWEBC
.
          PACK      KEY39,PMLVUNIQ,PMLVADMN,PMLVDATE,PMLVTIME,PMLVTYPE,PMLVETYP,SP70
          CALL      RAPMLEV1
          IF        OVRCD=1
            CALL      WRPMLEV1
          ENDIF
.
          MOVE      ZERO,EXIT
          GOTO      ADDLEV99
.
ADDLEV90  MOVE      "Record already exists",WEBTITLE
          CALL      WEBERR00
          MOVE      ONE,EXIT
          GOTO      ADDLEV99
.
ADDLEV99  RETURN
+
.------------------------------------------------------------
. Update labour event record
.------------------------------------------------------------
UPDLEV00  CALL      CLPMLV00
          PACK      KEY39,PMLEV001,PMLEV002,PMLEV003,PMLEV004,PMLEV005,PMLEV006,SP70
          CALL      RDPMLEV1
          COMPARE   ZERO,OVRCD
          GOTO      UPDLEV90 IF NOT EQUAL
.
          CALL      MVPMLV00
.
          PACK      PMLVDATU,CCC,CYY,CMM,CDD
          REP       " 0",PMLVDATU
          CLOCK     TIME,PMLVTIMU
          MOVE      USERID,PMLVWEBU
.
          PACK      KEY39,PMLVUNIQ,PMLVADMN,PMLVDATE,PMLVTIME,PMLVTYPE,PMLVETYP,SP70
          CALL      RAPMLEV1
          IF        OVRCD=0
            CALL      UPPMLEV1
          ENDIF
.
          MOVE      ZERO,EXIT
          GOTO      UPDLEV99
.
UPDLEV90  MOVE      "Invalid record",WEBTITLE
          CALL      WEBERR00
          MOVE      ONE,EXIT
          GOTO      UPDLEV99
.
UPDLEV99  RETURN
+

.------------------------------------------------------------
. Pregnancy Labour Details Maintenance
.------------------------------------------------------------
PMSLBR00  MATCH     Z70,PREGUNIQ
          GOTO      PMSLBR90 IF EQUAL
.
          PACK      KEY8,URNUMBER,SP70
          CALL      RDMAST1
          BRANCH    OVRCD,PMSLBR95
          CALL      RDPMPX21
          IF        OVRCD=1
            CALL      CLPMSPX2
          ENDIF
.
          PACK      KEY21,URNUMBER,PREGUNIQ,Z70
          CALL      RSPMRGN1
          CALL      RPPMRGN1
          BRANCH    OVRCD,PMSLBR90
.
          MATCH     PMRGUNIQ,PREGUNIQ
          GOTO      PMSLBR90 IF NOT EQUAL
.
          CALL      CLPATVIS
          CALL      CLPMSVX1
          PACK      KEY8,ADMISSNO,SP70
          CALL      RDPTVIS1
          BRANCH    OVRCD,PMSLBR10
          CALL      RDPMVX11
          BRANCH    OVRCD,PMSLBR97
.
          CALL      CLPATMIS
          PACK      KEY8,ADMISSNO,SP70
          CALL      RDMISS1
          BRANCH    OVRCD,PMSLBR10
.
          IF        ASTAT=3
            PACK      KEY8,ADMISSNO
            CALL      RDDSCH1
            BRANCH    OVRCD,PMSLBR94
          ENDIF
.
PMSLBR10  MATCH     SP70,UPDTTYPE           * Display
          GOTO      PMSLBR50 IF EQUAL
.
          MATCH     "A",UPDTTYPE            * Add
          GOTO      PMSLBR30 IF EQUAL
.
          MATCH     "U",UPDTTYPE            * Update
          GOTO      PMSLBR40 IF EQUAL
.
          MOVE      "Invalid Update Type",WEBTITLE
          CALL      WEBERR00
          GOTO      PMSLBR99
.
PMSLBR30  MATCH     SP70,ADMISSNO
          GOTO      PMSLBR96 IF EQUAL
.
          PACK      KEY8,ADMISSNO,SP70
          CALL      RDMISS1
          BRANCH    OVRCD,PMSLBR96
.
          IF        ASTAT<2|ASTAT>4
            GOTO      PMSLBR96
          ENDIF
.
          CALL      ADDLBR00
          CALL      CHKMAN00         * must be last - loops lbr and bth files
          GOTO      PMSLBR99
.
PMSLBR40  CALL      UPDLBR00
          CALL      CHKMAN00         * must be last - loops lbr and bth files
          GOTO      PMSLBR99
.
PMSLBR50  PACK      KEY24,PMLBR001,PMLBR002,PMLBR038,PMLBR039,SP70
          CALL      RDPMLBR1
          IF        OVRCD=1
            CALL      CLPMLB00
          ENDIF
.
          MOVE      "Labour Details Maintenance",WEBTITLE
          CALL      WEBHED00
          BRANCH    EXIT,PMSLBR99
          CALL      WEBBOD00
          CALL      WEBEND00
          MOVE      ONE,EXIT
          GOTO      PMSLBR99
.
PMSLBR90  MOVE      "Invalid Pregnancy Detail Record",WEBTITLE
          CALL      WEBERR00
          MOVE      ONE,EXIT
          GOTO      PMSLBR99
.
PMSLBR94  MOVE      "Missing Discharge Record",WEBTITLE
          CALL      WEBERR00
          MOVE      ONE,EXIT
          GOTO      PMSLBR99
.
PMSLBR95  MOVE      "Invalid Patient U/R",WEBTITLE
          CALL      WEBERR00
          MOVE      ONE,EXIT
          GOTO      PMSLBR99
.
PMSLBR96  MOVE      "Invalid Admission Record",WEBTITLE
          CALL      WEBERR00
          MOVE      ONE,EXIT
          GOTO      PMSLBR99
.
PMSLBR97  MOVE      "Missing Visit Extension Record",WEBTITLE
          CALL      WEBERR00
          MOVE      ONE,EXIT
          GOTO      PMSLBR99
.
PMSLBR99  RETURN
+
.------------------------------------------------------------
. Add new labour detail record
.------------------------------------------------------------
ADDLBR00  MOVE      ONE,COUNTER
.
          PACK      KEY24,PMLBR001,PMLBR002,SP70
          CALL      RSPMLBR1
ADDLBR10  CALL      RKPMLBR1
          BRANCH    OVRCD,ADDLBR20
.
          MATCH     PMLBR001,PMLBUNIQ
          GOTO      ADDLBR20 IF NOT EQUAL
.
          MATCH     PMLBR002,PMLBADMN
          GOTO      ADDLBR20 IF NOT EQUAL
.
          ADD       ONE,COUNTER
          GOTO      ADDLBR10
.
ADDLBR20  CALL      CLPMLB00
          CALL      MVPMLB00
.
          PACK      PMLBCNTR,COUNTER
          MOVE      "  0",PMLBAUDC
          PACK      PMLBDATC,CCC,CYY,CMM,CDD
          REP       " 0",PMLBDATC
          CLOCK     TIME,PMLBTIMC
          MOVE      USERID,PMLBWEBC
.
          PACK      KEY24,PMLBUNIQ,PMLBADMN,PMLBCNTR,PMLBAUDC,SP70
          CALL      RAPMLBR1
          IF        OVRCD=1
            CALL      WRPMLBR1
            CALL      ADDEV000    * Add labour event records
          ENDIF
.
          MOVE      ZERO,EXIT
          GOTO      ADDLBR99
.
ADDLBR99  RETURN
+
.------------------------------------------------------------
. Update Labour Details record
.------------------------------------------------------------
UPDLBR00  CALL      CLPMLB00
          PACK      KEY24,PMLBR001,PMLBR002,PMLBR038,PMLBR039,SP70
          CALL      RDPMLBR1
          COMPARE   ZERO,OVRCD
          GOTO      UPDLBR90 IF NOT EQUAL
.
          CALL      MVPMLB00
.
          PACK      PMLBDATU,CCC,CYY,CMM,CDD
          REP       " 0",PMLBDATU
          CLOCK     TIME,PMLBTIMU
          MOVE      USERID,PMLBWEBU
.
          MOVE      PMLBAUDC,F3
          ADD       ONE,F3
          MOVE      F3,PMLBAUDC
.
          PACK      KEY24,PMLBUNIQ,PMLBADMN,PMLBCNTR,PMLBAUDC,SP70
          CALL      RAPMLBR1
          IF        OVRCD=1
            CALL      WRPMLBR1
          ENDIF
          CALL      ADDEV000
.
          MOVE      ZERO,EXIT
          GOTO      UPDLBR99
.
UPDLBR90  MOVE      "Invalid record",WEBTITLE
          CALL      WEBERR00
          MOVE      ONE,EXIT
          GOTO      UPDLBR99
.
UPDLBR91  MOVE      "Record already updated",WEBTITLE
          CALL      WEBERR00
          MOVE      ONE,EXIT
          GOTO      UPDLBR99
.
UPDLBR99  RETURN
+
.------------------------------------------------------------
. Birth Details Maintenance
.------------------------------------------------------------
PMSBTH00  PACK      KEY8,URNUMBER,SP70
          CALL      RDMAST1
          BRANCH    OVRCD,PMSBTH95
          CALL      RDPMPX21
          IF        OVRCD=1
            CALL      CLPMSPX2
          ENDIF
.
          MATCH     Z70,PREGUNIQ
          IF        @EQUAL
            CALL      CLPMSRGN
            GOTO      PMSBTH10
          ENDIF
.
          PACK      KEY21,URNUMBER,PREGUNIQ,Z70
          CALL      RSPMRGN1
          CALL      RPPMRGN1
          BRANCH    OVRCD,PMSBTH90
.
          MATCH     PMRGUNIQ,PREGUNIQ
          GOTO      PMSBTH90 IF NOT EQUAL
.
          CALL      CLPATVIS
          CALL      CLPMSVX1
          PACK      KEY8,ADMISSNO,SP70
          CALL      RDPTVIS1
          BRANCH    OVRCD,PMSBTH10
          CALL      RDPMVX11
          BRANCH    OVRCD,PMSBTH97
.
          CALL      CLPATMIS
          PACK      KEY8,ADMISSNO,SP70
          CALL      RDMISS1
          BRANCH    OVRCD,PMSBTH10
.
          IF        ASTAT=3
            PACK      KEY8,ADMISSNO
            CALL      RDDSCH1
            BRANCH    OVRCD,PMSBTH94
          ENDIF
.
PMSBTH10  MATCH     SP70,UPDTTYPE           * Display
          GOTO      PMSBTH50 IF EQUAL
.
          MATCH     "A",UPDTTYPE            * Add
          GOTO      PMSBTH30 IF EQUAL
.
          MATCH     "U",UPDTTYPE            * Update
          GOTO      PMSBTH40 IF EQUAL
.
          MOVE      "Invalid Update Type",WEBTITLE
          CALL      WEBERR00
          GOTO      PMSBTH99
.
PMSBTH30  CALL      ADDBTH00
          CALL      CHKMAN00         * must be last - loops lbr and bth files
          GOTO      PMSBTH99
.
PMSBTH40  CALL      UPDBTH00
          CALL      CHKMAN00         * must be last - loops lbr and bth files
          GOTO      PMSBTH99
.
PMSBTH50  PACK      KEY23,PMBTH001,PMBTH002,PMBTH044,SP70
          CALL      RDPMBTH1
          IF        OVRCD=1
            CALL      CLPMBT00
          ENDIF
.
          MOVE      "Birth Details Maintenance",WEBTITLE
          CALL      WEBHED00
          BRANCH    EXIT,PMSBTH99
          CALL      WEBBOD00
          CALL      WEBEND00
          MOVE      ONE,EXIT
          GOTO      PMSBTH99
.
PMSBTH90  MOVE      "Invalid Pregnancy Detail Record",WEBTITLE
          CALL      WEBERR00
          MOVE      ONE,EXIT
          GOTO      PMSBTH99
.
PMSBTH94  MOVE      "Missing Discharge Record",WEBTITLE
          CALL      WEBERR00
          MOVE      ONE,EXIT
          GOTO      PMSBTH99
.
PMSBTH95  MOVE      "Invalid Patient U/R",WEBTITLE
          CALL      WEBERR00
          MOVE      ONE,EXIT
          GOTO      PMSBTH99
.
PMSBTH96  MOVE      "Invalid Admission Record",WEBTITLE
          CALL      WEBERR00
          MOVE      ONE,EXIT
          GOTO      PMSBTH99
.
PMSBTH97  MOVE      "Missing Visit Extension Record",WEBTITLE
          CALL      WEBERR00
          MOVE      ONE,EXIT
          GOTO      PMSBTH99
.
PMSBTH99  RETURN
+
.------------------------------------------------------------
. Add new birth detail record
.------------------------------------------------------------
ADDBTH00  CALL      GENB0000        * Generate next unique id
.
          PACK      PMBTH002,PTCNBUNQ,SP70
.
          PACK      KEY23,PMBTH001,PMBTH002,Z70
          CALL      RSPMBTH1
          CALL      RPPMBTH1
          BRANCH    OVRCD,ADDBTH20
.
          MATCH     PMBTH001,PMBTUNIQ
          GOTO      ADDBTH20 IF NOT EQUAL
.
          MATCH     PMBTH002,PMBTBUNQ
          GOTO      ADDBTH00 IF EQUAL
.
ADDBTH20  CALL      CLPMBT00
          CALL      MVPMBT00
.
          MOVE      "  0",PMBTAUDC
          PACK      PMBTDATC,CCC,CYY,CMM,CDD
          REP       " 0",PMBTDATC 
          CLOCK     TIME,PMBTTIMC
          MOVE      USERID,PMBTWEBC
.
          PACK      KEY23,PMBTUNIQ,PMBTBUNQ,PMBTAUDC,SP70
          CALL      RAPMBTH1
          IF        OVRCD=1
            CALL      WRPMBTH1
            CALL      ADDBV000
          ENDIF
.
          MOVE      ZERO,EXIT
          GOTO      ADDBTH99
.
ADDBTH90  MOVE      "Record Already Exists",WEBTITLE
          CALL      WEBERR00
          MOVE      ONE,EXIT
          GOTO      ADDBTH99 
.
ADDBTH99  RETURN
+
.------------------------------------------------------------
. Update Birth Details record
.------------------------------------------------------------
UPDBTH00  CALL      CLPMBT00
          PACK      KEY23,PMBTH001,PMBTH002,PMBTH044,SP70
          CALL      RDPMBTH1
          COMPARE   ZERO,OVRCD
          GOTO      UPDBTH90 IF NOT EQUAL
.
          CALL      MVPMBT00
.
          MOVE      PMBTAUDC,F3
          ADD       ONE,F3
          MOVE      F3,PMBTAUDC
.
          PACK      PMBTDATU,CCC,CYY,CMM,CDD
          REP       " 0",PMBTDATU
          CLOCK     TIME,PMBTTIMU
          MOVE      USERID,PMBTWEBU
.
          PACK      KEY23,PMBTUNIQ,PMBTBUNQ,PMBTAUDC,SP70
          CALL      RAPMBTH1
          IF        OVRCD=1
            CALL      WRPMBTH1
          ENDIF
.
          CALL      ADDBV000
.
          MOVE      ZERO,EXIT
          GOTO      UPDBTH99
.
UPDBTH90  MOVE      "Invalid record",WEBTITLE
          CALL      WEBERR00
          MOVE      ONE,EXIT
          GOTO      UPDBTH99
.
UPDBTH99  RETURN
+
.------------------------------------------------------------
. Add new birth event record  from the birth details page
.------------------------------------------------------------
ADDBV000  MOVE      ZERO,COUNTER
.
ADDBV100  ADD       ONE,COUNTER
          IF        COUNTER>PMBEVCNT
            GOTO      ADDBV999
          ENDIF
.
          PACK      BEVTYPE,BEVCATAR[COUNTER]
          PACK      BEVCODE,BEVARRAY[COUNTER]
          PACK      BEVDESC,BDEARRAY[COUNTER]
.
          PACK    KEY42,PMBTUNIQ,PMBTBUNQ,PMBTBDAT,PMBTBTIM,BEVTYPE,BEVCODE,SP70
          CALL      RDPMLEV1
          COMPARE   ZERO,OVRCD
          GOTO      ADDBV999 IF EQUAL
.
          CALL      CLPMLV00
          PACK      PMBEUNIQ,PMBTUNIQ,SP70
          PACK      PMBEBUNQ,PMBTBUNQ,SP70
          PACK      PMBEEDAT,PMBTBDAT,SP70
          PACK      PMBEETIM,PMBTBTIM,SP70
          PACK      PMBETYPE,BEVTYPE,SP70
          PACK      PMBEETYP,BEVCODE,SP70
          PACK      PMLVSTAT,SP70
          PACK      PMBEDES1,BEVDESC,SP70
          PACK      PMLVDES2,SP70
.
          PACK      PMBEDATC,CCC,CYY,CMM,CDD
          REP       " 0",PMBEDATC
          CLOCK     TIME,PMBETIMC
          MOVE      USERID,PMBEWEBC
.
          PACK  KEY42,PMBEUNIQ,PMBEBUNQ,PMBEEDAT,PMBEETIM,PMBETYPE,PMBEETYP,SP70
          CALL      RAPMBEV1
          IF        OVRCD=1
            CALL      WRPMBEV1
          ENDIF
.
          GOTO      ADDBV100
.
ADDBV999  RETURN
+
.------------------------------------------------------------
. Process Fields 
.------------------------------------------------------------
PROFLD00  BRANCH    REPORTNO,PROFLD10,PROFLD20,PROFLD30,PROFLD40,PROFLD50:
                             PROFLD60,PROFLD70
          GOTO      PROFLD99
.
PROFLD10  BRANCH    FLDSETNO,PROFLD11,PROFLD12,PROFLD13
          GOTO      PROFLD99
.
PROFLD11  CALL      MASF0000                * Master Details
          GOTO      PROFLD99
.
PROFLD12  CALL      PMRG0000                * Pregnancy Details
          GOTO      PROFLD99
.
PROFLD13  CALL      CMAN0000    
          GOTO      PROFLD99
.
PROFLD20  BRANCH    FLDSETNO,PROFLD21,PROFLD22,PROFLD23,PROFLD24
          GOTO      PROFLD99
.
PROFLD21  CALL      MASF0000                * Master Details
          GOTO      PROFLD99
.
PROFLD22  CALL      PMRG0000                * Pregnancy Details
          GOTO      PROFLD99
.
PROFLD23  CALL      PMPC0000                * Complications/Treatment
          GOTO      PROFLD99
.
PROFLD24  CALL      CMAN0000
          GOTO      PROFLD99
.
PROFLD30  BRANCH    FLDSETNO,PROFLD31,PROFLD32,PROFLD33,PROFLD34,PROFLD35
          GOTO      PROFLD99
.
PROFLD31  CALL      MASF0000                * Master Details
          GOTO      PROFLD99
.
PROFLD32  CALL      PMRG0000                * Pregnancy Details
          GOTO      PROFLD99
.
PROFLD33  CALL      PMLB0000                * Labour Details
          GOTO      PROFLD99
.
PROFLD34  CALL      LEVD0000                * Labour Event details
          GOTO      PROFLD99
.
PROFLD35  CALL      CMAN0000
          GOTO      PROFLD99
.
PROFLD40  BRANCH    FLDSETNO,PROFLD41,PROFLD42,PROFLD43,PROFLD44,PROFLD45:
                             PROFLD46
          GOTO      PROFLD99
.
PROFLD41  CALL      MASF0000                * Master Details
          GOTO      PROFLD99
.
PROFLD42  CALL      PMRG0000                * Pregnancy Details
          GOTO      PROFLD99
.
PROFLD43  CALL      PMBT0000                * Birth Details
          GOTO      PROFLD99
.
PROFLD44  CALL      BEVD0000                * Birth Event details
          GOTO      PROFLD99
.
PROFLD45  CALL      CMAN0000
          GOTO      PROFLD99
.
PROFLD46  CALL      LKBY0000                * Linked Babies
          GOTO      PROFLD99
.
PROFLD50  BRANCH    FLDSETNO,PROFLD51,PROFLD52,PROFLD53,PROFLD54
          GOTO      PROFLD99
.
PROFLD51  CALL      MASF0000                * Master Details
          GOTO      PROFLD99
.
PROFLD52  CALL      PMRG0000                * Pregnancy Details
          GOTO      PROFLD99
.
PROFLD53  CALL      PMBV0000                * Birth Event
          GOTO      PROFLD99
.
PROFLD54  CALL      CMAN0000
          GOTO      PROFLD99
.
PROFLD60  BRANCH    FLDSETNO,PROFLD61,PROFLD62,PROFLD63,PROFLD64
          GOTO      PROFLD99
.
PROFLD61  CALL      MASF0000                * Master Details
          GOTO      PROFLD99
.
PROFLD62  CALL      PMRG0000                * Pregnancy Details
          GOTO      PROFLD99
.
PROFLD63  CALL      PMLV0000                * Labour Event
          GOTO      PROFLD99
.
PROFLD64  CALL      CMAN0000
          GOTO      PROFLD99
.
PROFLD70  BRANCH    FLDSETNO,PROFLD71
          GOTO      PROFLD99
.
PROFLD71  CALL      MAND0000                * Mandatory Fields
          GOTO      PROFLD99
.
PROFLD99  RETURN
+
.------------------------------------------------------------
. Output labour event checkbox values
.------------------------------------------------------------
LEVD0000  PACK      KEY39,PMLBUNIQ,PMLBADMN,PMLBDATL,PMLBTIML,SP70
          CALL      RSPMLEV1
LEVD1000  CALL      RKPMLEV1
          BRANCH    OVRCD,LEVD9999
.
          MATCH     PMLBUNIQ,PMLVUNIQ
          GOTO      LEVD9999 IF NOT EQUAL
.
          MATCH     PMLBADMN,PMLVADMN
          GOTO      LEVD9999 IF NOT EQUAL
.
          MATCH     PMLBDATL,PMLVDATE
          GOTO      LEVD9999 IF NOT EQUAL
.
          MATCH     PMLBTIML,PMLVTIME
          GOTO      LEVD9999 IF NOT EQUAL
.
          WRITE     HTMLFILE;PMLVTYPE,PMLVETYP,"|";
          GOTO      LEVD1000
.
LEVD9999  RETURN
+
.------------------------------------------------------------
. Output birth event checkbox values
.------------------------------------------------------------
BEVD0000  PACK      KEY42,PMBTUNIQ,PMBTBUNQ,PMBTBDAT,PMBTBTIM,SP70
          CALL      RSPMBEV1
BEVD1000  CALL      RKPMBEV1
          BRANCH    OVRCD,BEVD9999
.
          MATCH     PMBEUNIQ,PMBTUNIQ
          GOTO      BEVD9999 IF NOT EQUAL
.
          MATCH     PMBEBUNQ,PMBTBUNQ
          GOTO      BEVD9999 IF NOT EQUAL
.
          MATCH     PMBEEDAT,PMBTBDAT
          GOTO      BEVD9999 IF NOT EQUAL
.
          MATCH     PMBEETIM,PMBTBTIM
          GOTO      BEVD9999 IF NOT EQUAL
.
          WRITE     HTMLFILE;PMBETYPE,PMBEETYP,PMBEDES1,"|";
          GOTO      BEVD1000
.
BEVD9999  RETURN
+
.------------------------------------------------------------
. Maternity Mandatory Field Maintenance
.------------------------------------------------------------
MATMAN00  RESET     UPDTTYPE
          MATCH     SP1,UPDTTYPE
          GOTO      MATMAN40 IF EQUAL
.
          MATCH     "A",UPDTTYPE    * Add formaction
          GOTO      MATMAN10 IF EQUAL
.
          MATCH     "U",UPDTTYPE    * Update formaction
          GOTO      MATMAN20 IF EQUAL
.
          MATCH     "D",UPDTTYPE    * Delete formaction
          GOTO      MATMAN30 IF EQUAL
.
          GOTO      MATMAN93
.
MATMAN10  PACK      KEY5,PMWFM001,SP70
          CALL      RDPMWFM1
          COMPARE   ZERO,OVRCD
          GOTO      MATMAN92 IF EQUAL
          CALL      MANSAV00      * Moves input variables to file variables
          PACK      KEY5,PMWFM001,SP70
          CALL      WRPMWFM1      * Writes away the data
          MOVE      ZERO,EXIT
          GOTO      MATMAN99
.
MATMAN20  PACK      KEY5,PMWFM001,SP70
          CALL      RDPMWFM1
          BRANCH    OVRCD,MATMAN91
          CALL      MANSAV00      * Moves input variables to file variables
          CALL      UPPMWFM1      * Writes away the data
          MOVE      ZERO,EXIT
          GOTO      MATMAN99
.
MATMAN30  PACK      KEY5,PMWFM001,SP70
          CALL      RDPMWFM1
          BRANCH    OVRCD,MATMAN91
          CALL      DEPMWFM1      * Writes away the data
          MOVE      ZERO,EXIT
          GOTO      MATMAN99
.
MATMAN40  PACK      KEY5,PMWFM001,SP70
          CALL      RDPMWFM1
          IF        OVRCD=1
            CALL      CLRMAN00    * Clear all the file variables
          ENDIF
.
          PACK      WEBTITLE,SP70,SP70
.
          CALL      WEBHED00   * Create Output File and Write HTML Page Header
          BRANCH    EXIT,MATMAN99
          CALL      WEBBOD00   * Process Web Body
          CALL      WEBEND00   * Process End of HTML File
.
          MOVE      ONE,EXIT
          GOTO      MATMAN99
.
MATMAN91  MOVE      "Mandatory record does not exist",WEBTITLE
          CALL      WEBERR00
          MOVE      ONE,EXIT
          GOTO      MATMAN99
.
MATMAN92  MOVE      "Mandatory record exists",WEBTITLE
          CALL      WEBERR00
          MOVE      ONE,EXIT
          GOTO      MATMAN99
.
MATMAN93  MOVE      "Invalid Form Action.",WEBTITLE
          CALL      WEBERR00
          MOVE      ONE,EXIT
          GOTO      MATMAN99
.
MATMAN99  RETURN
.-----------------------------------------------------------
. Initialize's file data
.-----------------------------------------------------------
CLRMAN00  MOVE      SP70,PMWFFLDN
          MOVE      SP70,PMWFIDES
          MOVE      SP70,PMWFSDES
          MOVE      SP70,PMWFSCDE
          MOVE      SP70,PMWFMAND
          MOVE      SP70,PMWFSPAR
.
CLRMAN99  RETURN
.------------------------------------------------------------
. Moves cgi variables into file variables
.------------------------------------------------------------
MANSAV00  MOVE      PMWFM001,MANDA
          MOVE      MANDA,KEY5
          MOVE      KEY5,PMWFFLDN
          MOVE      PMWFM002,PMWFIDES
          MOVE      PMWFM003,PMWFSDES
          MOVE      PMWFM004,PMWFSCDE
.
          RESET     PMWFM005
          MATCH     SP70,PMWFM005
          IF        @EQUAL
            MOVE      "0",PMWFMAND
          ELSE
            MOVE      PMWFM005,PMWFMAND
          ENDIF
.
          MOVE      SP70,PMWFSPAR
.
MANSAV99  RETURN
+
.------------------------------------------------------------
. Mandatory Field Maintenance
.------------------------------------------------------------
MAND0000  BRANCH    FLDITMNO,MAND0100,MAND0200,MAND0300,MAND0400,MAND0500:
                             MAND0600,MAND0700,MAND0800,MAND0900
          GOTO      MAND9999
.
MAND0100  WRITE     HTMLFILE;PMWFFLDN;  * mandatory no need to check for it
          GOTO      MAND9999
.
MAND0200  MATCH     SP70,PMWFIDES
          GOTO      MAND9999 IF EQUAL
          WRITE     HTMLFILE;PMWFIDES;
          GOTO      MAND9999
.
MAND0300  MATCH     SP70,PMWFSDES
          GOTO      MAND9999 IF EQUAL
          WRITE     HTMLFILE;PMWFSDES;
          GOTO      MAND9999
.
MAND0400  MATCH     SP70,PMWFSCDE
          GOTO      MAND9999 IF EQUAL
          WRITE     HTMLFILE;PMWFSCDE;
          GOTO      MAND9999
.
MAND0500  MATCH     SP70,PMWFMAND
          GOTO      MAND9999 IF EQUAL
          WRITE     HTMLFILE;PMWFMAND;
          GOTO      MAND9999
.
MAND0600  CALL      FLTAB000      * Table of Emergency Field Maintenance
          GOTO      MAND9999
.
MAND0700  CALL      NEXTMN00      * Link to Next Group
          GOTO      MAND9999
.
MAND0800  CALL      PREVMN00      * Link to Last Group
          GOTO      MAND9999
.
MAND0900  CALL      INCL0000      * Incomplete list
          GOTO      MAND9999
.
MAND9999  RETURN
+
.------------------------------------------------------------
. Mandatory Fields Table
.------------------------------------------------------------
FLTAB000  UNPACK    DIM127,D1,LINKPRG,DIM127
          UNPACK    DIM127,D1,LINKREP,DIM127
          UNPACK    DIM127,D1,LINKTEM,DIM127
.
          CALL      FLHED000      * Output Table Heading
.
          IF        NORECORD=0
            MOVE      PTCNNRTD,NORECORD      * Set Default No Records to Display
          ENDIF
          MOVE      ZERO,RECNUMB
          MOVE      ZERO,DISNUMB
.
          PACK      KEY5,STARTKEY,SP70
          CALL      RDPMWFM1
          IF        OVRCD=0
            CALL      RPPMWFM1
          ENDIF
FLTAB100  CALL      RKPMWFM1
          BRANCH    OVRCD,FLTAB900
.
          ADD       ONE,RECNUMB
          IF        STARTNUM>=RECNUMB
            GOTO      FLTAB100
          ENDIF
.
          CALL      FLROWA00      * Display Mandatory Fields Row
          ADD       ONE,DISNUMB
          COMPARE   NORECORD,DISNUMB
          GOTO      FLTAB100 IF NOT EQUAL
          GOTO      FLTAB999
.
FLTAB900  CALL      NOMORE00      * Display No More Records Message
.
FLTAB999  RETURN
.------------------------------------------------------------
. Mandatory Fields (TABLE HEADING)
.------------------------------------------------------------
FLHED000  WRITE     HTMLFILE;"<tr>":
                               "<td class=HeadingCell width=7%>Code</td>":
                               "<td class=HeadingCell width=20%>":
                               "IBA Description</td>":
                               "<td class=HeadingCell width=20%>":
                               "Site Description</td>":
                               "<td class=HeadingCell width=20%>":
                               "Screen Description</td>":
                               "<td class=HeadingCell width=7%>Mandatory</td>":
                             "</tr>"
.
FLHED999  RETURN
.------------------------------------------------------------
. Mandatory Fields (TABLE ROW)
.------------------------------------------------------------
FLROWA00  MATCH     SP70,PMWFIDES
          IF        @EQUAL
            MOVE      "&nbsp;",PMWFIDES
          ENDIF
.
          MATCH     SP70,PMWFSDES
          IF        @EQUAL
            MOVE      "&nbsp;",PMWFSDES
          ENDIF
.
          MATCH     SP70,PMWFSCDE
          IF        @EQUAL
            MOVE      "&nbsp;",PMWFSCDE
          ENDIF
.
          MOVE      "Yes",KEY3
          MATCH     "0",PMWFMAND
          IF        @EQUAL
            MOVE      "No ",KEY3
          ENDIF
.
            WRITE       HTMLFILE;"<tr><td nowrap><A HREF='javascript:ShowDetail04(#"":
                               LINKPRG,"#.pbl":
                               "?reportno=",LINKREP:
                               "&template=",LINKTEM:
                               "&pmwfm001=",PMWFFLDN,"#")'>":
                               "<img src=../images/MaintenanceIcon.gif hspace=4":
                               " border=0 align=absmiddle></a>":
                               PMWFFLDN,"</td>":
                               "<td>",PMWFIDES,"</td>":
                               "<td>",PMWFSDES,"</td>":
                               "<td>",PMWFSCDE,"</td>":
                               "<td>",KEY3,"</td>":
                               "</tr>"
.
FLROWA99 RETURN
+
.------------------------------------------------------------
. Link to Next set of Mandatory Fields
.------------------------------------------------------------
NEXTMN00  MOVE      NORECORD,KEY2
          REP       " +",KEY2
          ASSIGN    STARTNUM+NORECORD,F3
          MOVE      F3,KEY3
          REP       " +",KEY3
          UNPACK    DIM127,D1,FLDPARA,DIM127
          MOVE      REPORTNO,F1
.
          WRITE     HTMLFILE;"patweb08.pbl":
                                 "?reportno=",F1:
                                 "&template=",FLDPARA:
                                 "&startnum=",KEY3:
                                 "&norecord=",KEY2;
.
NEXTMN99  RETURN
+
.-------------------------------------------------------------------------------
. Link to previous set of Mandatory Fields Maintenance
.-------------------------------------------------------------------------------
PREVMN00  MOVE      NORECORD,KEY2
          REP       " +",KEY2
          ASSIGN    STARTNUM-NORECORD,F3
          IF        F3<0
            MOVE    ZERO,F3
          ENDIF
          MOVE      F3,KEY3
          REP       " +",KEY3
          UNPACK    DIM127,D1,FLDPARA,DIM127
          MOVE      REPORTNO,F1
.
          WRITE     HTMLFILE;"patweb08.pbl":
                                 "?reportno=",F1:
                                 "&template=",FLDPARA:
                                 "&startnum=",KEY3:
                                 "&norecord=",KEY2;
.
PREVMN99  RETURN
+
.------------------------------------------------------------
. List incomplete details - pmsincaf
.------------------------------------------------------------
INCL0000  PACK      KEY10,SP70
          CALL      RSPMINC1
INCL1000  CALL      RKPMINC1
          BRANCH    OVRCD,INCL9999
.
          PACK      KEY13,PMINUNIQ,Z70
          CALL      RSPMRGN2
          CALL      RPPMRGN2
          BRANCH    OVRCD,INCL1000
.
          MATCH     PMINUNIQ,PMRGUNIQ
          GOTO      INCL1000 IF NOT EQUAL
.
          PACK      KEY8,PMRGURNO,SP70
          CALL      RDMAST1
          BRANCH    OVRCD,INCL1000
.
          CALL      PATLN000       * Format Patient Name from System Parameter
          CALL      PATFLD00               *Returns KEY3 for folder colour code
.
          MOVE      ONE,ALLMANDF
          PACK      PREGUNIQ,PMRGUNIQ,SP70
          CALL      CHKMAN00
.
          CLEAR     HTMLLINK
          APPEND    "javascript:SelectPatient('",HTMLLINK
          APPEND    PMRGURNO,HTMLLINK
          APPEND    "','",HTMLLINK
          APPEND    PMRGUNIQ,HTMLLINK
          APPEND    "')",HTMLLINK
          RESET     HTMLLINK
.
          WRITE     HTMLFILE;"t.addRow(#"",HTMLLINK,"#",":              *0
                                      "#"",FORMATNM,"#",":              *1
                                      "#"",KEY3,"#",":                  *2
                                      "#"",PMRGUNIQ,"#",":              *3
                                      "#"",DIM600,"#");"                *4
.
          GOTO      INCL1000
.
INCL9999  RETURN
+
.------------------------------------------------------------
.  Linked Baby List
.------------------------------------------------------------
LKBY0000  WRITE     HTMLFILE;"[";
          PACK      KEY16,URNUMBER,SP70
          CALL      RDSLINK1
LKBY1000  CALL      RDKLINK1
          BRANCH    OVRCD,LKBY9000
.
          MATCH     URNUMBER,LINKFUR
          GOTO      LKBY1000 IF NOT EQUAL
.
          PACK      KEY5,CATLU,LINKREA
          CALL      RDCODE1
          BRANCH    OVRCD,LKBY1000
.          
          MATCH     ANSM,TCINDC1
          GOTO      LKBY1000 IF NOT EQUAL
.
          PACK      KEY8,LINKTUR,SP70
          CALL      RDMAST1
          BRANCH    OVRCD,LKBY1000
.
          MOVE      PSNAME,PACSNAME
          MOVE      PGNAME,PACGNAME
          MOVE      PTITL,PACTITLE
          MOVE      ONE,PACFRMT
          CALL      PACNAME                 * Format patients name
.
LKBY2000  WRITE     HTMLFILE;"{urnumber:'",LINKTUR,"',":
                             "name:'",PACFNAME,"'},";
          GOTO      LKBY1000
.
LKBY9000  WRITE     HTMLFILE;"]";
          GOTO      LKBY9999
.
LKBY9999  RETURN
.------------------------------------------------------------
CMAN0000  PACK      KEY5,SP70,SP70
          CALL      RDPMWFM1
CMAN1000  CALL      RKPMWFM1
          BRANCH    OVRCD,CMAN9999
.
          MOVE      "1",DIM1
          MATCH     "0",PMWFMAND
          IF        @EQUAL
            MOVE      "0",DIM1
          ENDIF

CMAN2000  WRITE       HTMLFILE;"mandatoryFields.push({field:'",PMWFSCDE:
                               "',name:'",PMWFSDES,"',isMandatory:'",DIM1,"'});"
          GOTO      CMAN1000
.
CMAN9999  RETURN
.------------------------------------------------------------
. NOMORE00 - Display "No more records" at end of list
.------------------------------------------------------------
NOMORE00  WRITE     HTMLFILE;"<tr>":
                             "<td class=RedCell colspan=20 align=center>":
                             "No more records</td>"
.
NOMORE99  RETURN
.
.------------------------------------------------------------
          INC       APSMASIO/INC
          INC       BOKRC1IO/INC
          INC       OUTBOAIO/INC
          INC       OUTBB1IO/INC
          INC       PATIN1IO/INC
          INC       PATPR1IO/INC
          INC       PATWR1IO/INC
          INC       MRTMASIO/INC
          INC       PATMI1IO/INC
          INC       PMSUCHIO/INC
          INC       PMSUCDIO/INC
          INC       OUTSITIO/INC
          INC       PATVISIO/INC
          INC       PATFN1IO/INC
          INC       PATDO1IO/INC
          INC       PATALRIO/INC
          INC       PATHSPIO/INC
          INC       PATMA1IO/INC
          INC       PMSEVTIO/INC
          INC       PATDSCIO/INC
          INC       PATICDIO/INC
          INC       PATICOIO/INC
          INC       PATDADIO/INC
.
          INC       PMSCCDIO/INC   * Concession Card Details
          INC       PMSDTCIO/INC
          INC       PMSHCPIO/INC
          INC       PMSHCGIO/INC
          INC       PMSINCIO/INC
          INC       PMSUPGIO/INC
          INC       PMSUPOIO/INC
          INC       PMSHPGIO/INC
          INC       PMSHPOIO/INC
          INC       PMSWFMIO/INC
          INC       PATTRNIO/INC
          INC       PMSVX1IO/INC
          INC       PMSPX2IO/INC
          INC       PMSPRBIO/INC
          INC       PMSBEVIO/INC
          INC       PMSLEVIO/INC
          INC       PMSBTHIO/INC
          INC       PMSPCTIO/INC
          INC       PMSLBRIO/INC
          INC       PMSRGNIO/INC
          INC       PMSAUPIO/INC
          INC       NHIMASIO/INC
          INC       NHIETHIO/INC
          INC       PATLINIO/INC
.
          INC       CLNHIMAS                   * Clear nhimasaf file variables
          INC       CLPATMIS
          INC       CLPATMAS
          INC       CLPATDSC
          INC       CLPMSUPG
          INC       CLPMSUPO
          INC       CLPMSRGN
          INC       IBAWEBCD
          INC       PATMASTM
          INC       PATNAMCD
          INC       CLPMSPX2
          INC       PMSPX2TM
          INC       PMSHCPTM
          INC       PMSHCGTM
          INC       PMSHPOTM
          INC       PMSMANDF
          INC       PMSUPGTM
          INC       PMSUPOTM
          INC       PATMSXTM
          INC       PATDOCTM
          INC       PATDOCCD
          INC       PMSRGNTM
          INC       PMSBEVTM
          INC       PMSLEVTM
          INC       PMSPCTTM
          INC       PMSBTHTM
          INC       PMSLBRTM
          INC       CALCAGE
          INC       CLPATVIS
          INC       CLPMSVX1
          INC       NAMSTRCD
          INC       WEBDATCD
          INC       DAYOFWEK
