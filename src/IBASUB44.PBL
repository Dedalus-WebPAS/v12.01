.-------------------------------------------------------
          INC       STDGENDF     * Required Include
.
VERSION   INIT      "V12.01.00"
.-------------------------------------------------------
. V9.03.01  02.03.2004 Sandra Barcham
.           Ported into V9.03.01
.-------------------------------------------------------
. VF.11.04  09/10.2003 Mike Laming CAR 44203
.           Remove "only Requisitions" test
. VF.11.03  03.10.2003 Mike Laming CAR 9375
.           1) Add "Warehouse" selection - add to screen, & logic to BODY0000
.           2) Add Export facility
. VF.11.02  15.09.2003 Mike Laming CAR 9375
.           Correct selection of Cost Centre & add "only Requisitions" test
. VF.11.01  11.09.2003 Mike Laming CAR 9375
.           Correct Date selection range
.-------------------------------------------------------
EXPORTFL  FILE      ASCII, FIXED=400     * Export File (Adjust to Suit)*I-f1103
EXPORTFN  DIM       8                    * Export File Name            *I-f1103
TABDELM   EQU       0x09                 * Tab Delimiter               *I-f1103
.
COSTCENT  DIM       5                                                  *I-f1102
DIM23     DIM       23
GSTAMT    FORM      6.2
GSTTOT    FORM      6.2
FROMDATE  DIM       8
NETTOT    FORM      12.2
TODATE    DIM       8
TOTPRGST  FORM      12.2
TPGSTTOT  FORM      12.2
UNITCOST  FORM      6.2
.-------------------------------------------------------
.@@@@@ Start of Generated Code @@@@@
. NB - Code & Comments Included Before the above line 
.      will not be overwritten by the generation of a 
.      program. The STDGENDF file and VERSION must appear
.      before the line. 
.-----------------------------------------
.   Program       :   IBASUB44
.   Function      :   GST - Goods Issued Report               
.   Generated  On :   13/12/2005
.-----------------------------------------
.=========================
.File Description Includes
.-------------------------
          INC       IBAGEDFD/INC
          INC       SINCCAFD/INC
          INC       SINCIAFD/INC
          INC       SINREAFD/INC
          INC       SINREBFD/INC
          INC       SINWARFD/INC
.=========================
.Local Variable Definition
.-------------------------
FROMDAT   DIM      10 * Scr 00 Fld     1
TODAT     DIM      10 * Scr 00 Fld     2
COSTCODE  DIM      46 * Scr 00 Fld     3
WAREDESC  DIM      40 * Scr 00 Fld     9
EXPORTYN  FORM      1 * Scr 00 Fld    10
.
ACCEPT    FORM      1
SACCEPT   FORM      1
.
PRGID     INIT      "IBASUB44"
PRGNAM    INIT      "GST - Goods Issued Report               "
.
.--------------------------------
. MAINLINE - Controlling Logic
.--------------------------------
          TOPIC     PRGID
          MOVE      PORT,PARENTID
          CLOCK     PORT,DIM2
          MOVE      DIM2,PORT
ML0000
          CALL      INIT0000
          CALL      SC00L000
          CHAIN     PGM
.---------------------------------------
. INIT - Open Files & Display Heading
.---------------------------------------
INIT0000  CALL      DISPHEAD
          MOVE      ONE,CCENTRY
          MOVE      ONE,CCANLDTE
          MOVE      ONE,CDEFDTE
          MOVE      ZERO,CHIGHLT
          DISPLAY   *P56:24,"Opening controlf";
          OPEN      CONTROLF,"controlf"
          DISPLAY   *P56:24,"Opening scrsbga1";
          OPEN      SCRSBGA1,"scrsbgaf"
          DISPLAY   *P56:24,"Opening scrpsta1";
          OPEN      SCRPSTA1,"scrpstaf"
          DISPLAY   *P56:24,"Opening scrpsta1";
          OPEN      SCRPSTA2,"scrpstaf"
          DISPLAY   *P56:24,"Opening scrslta1";
          OPEN      SCRSLTA1,"scrsltaf"
          DISPLAY   *P56:24,"Opening  ibagedaf           ";
          OPEN      IBAGEDA1,"ibagedaf"          
          MOVE      "   24",AUDTSECT
          MOVE      "202",AUDTPOST
          READ      CONTROLF,AUDTSECT;*AUDTPOST,AUDTFLAG
          IF        AUDTFLAG=1
            DISPLAY   *P56:24,"Opening sinaudca";
            OPEN      SINAUDCA,"sinaudca"
          ENDIF
          MOVE      "   24",AUDTSECT
          MOVE      "203",AUDTPOST
          READ      CONTROLF,AUDTSECT;*AUDTPOST,AUDTFLAG
          IF        AUDTFLAG=1
            DISPLAY   *P56:24,"Opening sinaudia";
            OPEN      SINAUDIA,"sinaudia"
          ENDIF
          MOVE      "   24",AUDTSECT
          MOVE      "223",AUDTPOST
          READ      CONTROLF,AUDTSECT;*AUDTPOST,AUDTFLAG
          IF        AUDTFLAG=1
            DISPLAY   *P56:24,"Opening sinaudwa";
            OPEN      SINAUDWA,"sinaudwa"
          ENDIF
          DISPLAY   *P56:24,"Opening sinccaaf";
          OPEN      SINCCAA1,"sinccaaf"
          DISPLAY   *P56:24,"Opening sinccaaf";
          OPEN      SINCCAA2,"sinccaaf"
          DISPLAY   *P56:24,"Opening sinciaaf";
          OPEN      SINCIAA1,"sinciaaf"
          DISPLAY   *P56:24,"Opening sinciaaf";
          OPEN      SINCIAA2,"sinciaaf"
          DISPLAY   *P56:24,"Opening sinciaaf";
          OPEN      SINCIAA3,"sinciaaf"
          DISPLAY   *P56:24,"Opening sinreaaf";
          OPEN      SINREAA1,"sinreaaf"
          DISPLAY   *P56:24,"Opening sinreaaf";
          OPEN      SINREAA2,"sinreaaf"
          DISPLAY   *P56:24,"Opening sinreaaf";
          OPEN      SINREAA3,"sinreaaf"
          DISPLAY   *P56:24,"Opening sinreaaf";
          OPEN      SINREAA4,"sinreaaf"
          DISPLAY   *P56:24,"Opening sinrebaf";
          OPEN      SINREBA1,"sinrebaf"
          DISPLAY   *P56:24,"Opening sinrebaf";
          OPEN      SINREBA2,"sinrebaf"
          DISPLAY   *P56:24,"Opening sinrebaf";
          OPEN      SINREBA3,"sinrebaf"
          DISPLAY   *P56:24,"Opening  sinrebaf           ";
          OPEN      SINREBA4,"sinrebaf"          
          DISPLAY   *P56:24,"Opening sinwaraf";
          OPEN      SINWARA1,"sinwaraf"
          DISPLAY   *P56:24,"Opening sinwaraf";
          OPEN      SINWARA2,"sinwaraf"
INIT9999  DISPLAY   *P1:24,*EL;
          RETURN
.
.------------------------------------
. Called for Print Screen Routine 
.------------------------------------
PRTSVARS
          MATCH     "00",SCRID
          IF         @EQUAL
            CALL       PS00L000   * Goods Issued Report                
          ENDIF
          RETURN
.--------------------------------
. Screen - Goods Issued Report                
.--------------------------------
SC00L000
SC00L100
          MOVE      "00",SCRID
          MOVE      ZERO,PRCOL
          MOVE      ZERO,PRVERT
          MOVE      "    5",FLDID
          CALL      GETPOSIT
          IF        EXIT=0
            MOVE     SCPSCOL,PRCOL
            MOVE     SCPSROW,PRVERT
          ENDIF
          CALL      SBACK000 * Display Background
.
SC00L200
          CALL      CF00L000 * Clear Fields
          CALL      SETSCR00
SC00L300
          CALL      KY00L000 * Enter Key Fields
          BRANCH    EXIT,SC00L999,SC00L999
SC00L400
          CALL      WP00L000 * Load any WP Details
SC00L500
          CALL      LM00L000 * Load any Batch Details
SC00L600
          CALL      DF00L000 * Display Fields
SC00L700
          CALL      SF00L000 * Select Fields
          BRANCH    EXIT,SC00L100,SC00L100,SC00L200
          IF        EXIT=4
            MOVE      ONE,EXIT
          ENDIF
SC00L800
SC00L900
SC00L999  RETURN
.--------------------------------------------------------
. Clear Fields for Screen : Goods Issued Report                
.-------------------------------------------------------
CF00L000  COMPARE   ZERO,ACCEPT
              GOTO      CF00L999 IF EQUAL
          MOVE      SP70,FROMDAT 
          MOVE      SP70,TODAT   
          MOVE      SP70,COSTCODE
          MOVE      SP70,SICADESC
          MOVE      SP70,SIWAWAR 
          MOVE      SP70,WAREDESC
          MOVE      ZERO,EXPORTYN
CF00L999  RETURN
.--------------------------------------------------------
. Enter Key Fields for Goods Issued Report                
.--------------------------------------------------------
KY00L000
          MOVE      ZERO,EXIT
          GOTO      KY00L999
.
KY00L900  MOVE      ONE,EXIT
KY00L999  RETURN
.---------------------------------------------------------
. Load WP files for : Goods Issued Report                
.---------------------------------------------------------
WP00L000
          RETURN
.---------------------------------------------------------
. Load Batch Screen for : Goods Issued Report                
.---------------------------------------------------------
LM00L000
          RETURN
.---------------------------------------------------------
. Display Fields for : Goods Issued Report                
.---------------------------------------------------------
DF00L000
          BRANCH   ACCEPT,DF00L999
          PACK     KEY15,PRGID,SCRID,SP70
          CALL     RSSCPS1
DF00L010
          CALL     RKSCPS1
          BRANCH   OVRCD,DF00L900
          MATCH    PRGID,SCPSPID
          GOTO     DF00L900 IF NOT EQUAL
          MATCH    SCRID,SCPSSID
          GOTO     DF00L900 IF NOT EQUAL
          MATCH    SP70,SCPSMTY
          GOTO     DF00L010 IF NOT EQUAL
.
          CALL     PS00L000 * Display Field
          GOTO     DF00L010
DF00L900
DF00L999
          RETURN
.---------------------------------------------------------
. Display/Print Fields for : Goods Issued Report                
.---------------------------------------------------------
PS00L000   PACK      VAR,SP70,SP70
          PACK     PRINTVAR,SP70,SP70
          MOVE     SCPSITM,FIELDNO
          BRANCH    FIELDNO,PS00L101,PS00L102,PS00L103,PS00L104:
                            PS00L999,PS00L999,PS00L999,PS00L105:
                            PS00L106,PS00L107
          GOTO     PS00L999
.
PS00L101
          MOVE      FROMDAT,VAR      
          CALL      DISPITEM
          GOTO     PS00L999
.
PS00L102
          MOVE      TODAT,VAR        
          CALL      DISPITEM
          GOTO     PS00L999
.
PS00L103
          MOVE      COSTCODE,VAR     
          CALL      DISPITEM
          GOTO     PS00L999
.
PS00L104
          MOVE      SICADESC,VAR     
          CALL      DISPITEM
          GOTO     PS00L999
.
PS00L105
          MOVE      SIWAWAR,VAR      
          CALL      DISPITEM
          GOTO     PS00L999
.
PS00L106
          CALL      WDESC000
          MOVE      WAREDESC,VAR     
          CALL      DISPITEM
          GOTO     PS00L999
.
PS00L107
          MOVE      NO,YESNO
          MOVE      ZERO,FORM2
          MOVE      EXPORTYN,FORM2   
          LOAD      YESNO,FORM2,YES
          MOVE      YESNO,VAR
          CALL      DISPITEM
          GOTO     PS00L999
PS00L999
          RETURN
.---------------------------------------------------------
. Selections for : Goods Issued Report                
.---------------------------------------------------------
SF00L000  PACK     KEY13,PRGID,SCRID,SP70
          CALL     RSSCSL1
SF00L001  BRANCH   ACCEPT,SF00L020
.
SF00L005  CALL     MTSTQ000
          MOVE     SCSLITM,FIELDNO
          BRANCH    FIELDNO,SF00L101,SF00L006,SF00L102,SF00L006:
                            SF00L006,SF00L103,SF00L104,SF00L105:
                            SF00L006,SF00L106
SF00L006  BEEP
          GOTO     SF00L005
SF00L020  CALL     RKSCSL1
          BRANCH   OVRCD,SF00L090
          MATCH    PRGID,SCSLPID
          GOTO     SF00L090 IF NOT EQUAL
          MATCH    SCRID,SCSLSID
          GOTO     SF00L090 IF NOT EQUAL
          MOVE     SCSLITM,FIELDNO
          BRANCH    FIELDNO,SF00L101,SF00L020,SF00L102,SF00L020:
                            SF00L020,SF00L020,SF00L020,SF00L105:
                            SF00L020,SF00L106
          GOTO     SF00L020
SF00L090  MOVE     ZERO,ACCEPT
          GOTO     SF00L001
.
SF00L101
.
.
          MOVE      "    2",FLDID
          CALL      GETPOSIT
          IF        EXIT=0
            MOVE     SP70,TODAT   
            PACK      VAR,SP70,SP70
            CALL      DISPITEM
          ENDIF
          CALL     SELECTED
          MOVE      "0",CKEYTYP
          CALL      EDAT0000
          IF        SCPSMAN=1
            IF        EXIT=1
              MOVE      "Mandatory Field - ",DISPMSG
              BEEP
              CALL      MESSAGE1
              GOTO      SF00L101
            ENDIF
            BRANCH    EXIT,SF00L101,SF00L990
          ELSE
            COMPARE   TWO,EXIT
            GOTO      SF00L990 IF EQUAL
          ENDIF
          MOVE      FROMDAT,VAR      
          CALL      DISPITEM
.
.
          MOVE      "    2",FLDID
          CALL      GETPOSIT
          IF        EXIT=0
            MOVE      TODAT,VAR        
            CALL      DISPITEM
          ENDIF
          GOTO     SF00L001
.
SF00L102
.
.
          MOVE      "    4",FLDID
          CALL      GETPOSIT
          IF        EXIT=0
            MOVE     SP70,SICADESC
            PACK      VAR,SP70,SP70
            CALL      DISPITEM
          ENDIF
          CALL     SELECTED
          MOVE      "0",CKEYTYP
          CALL      ECOS0000
          IF        SCPSMAN=1
            IF        EXIT=1
              MOVE      "Mandatory Field - ",DISPMSG
              BEEP
              CALL      MESSAGE1
              GOTO      SF00L102
            ENDIF
            BRANCH    EXIT,SF00L102,SF00L990
          ELSE
            COMPARE   TWO,EXIT
            GOTO      SF00L990 IF EQUAL
          ENDIF
          MOVE      COSTCODE,VAR     
          CALL      DISPITEM
.
.
          MOVE      "    4",FLDID
          CALL      GETPOSIT
          IF        EXIT=0
            MOVE      SICADESC,VAR     
            CALL      DISPITEM
          ENDIF
          GOTO     SF00L001
.
SF00L103
          CALL      PRNT0000
          GOTO      SF00L001
.
SF00L104
          MOVE      ZERO,EXIT
          GOTO      SF00L999
.
SF00L105
          CALL      WDESC000
.
.
          MOVE      "    9",FLDID
          CALL      GETPOSIT
          IF        EXIT=0
            MOVE     SP70,WAREDESC
            PACK      VAR,SP70,SP70
            CALL      DISPITEM
          ENDIF
          CALL     SELECTED
          MOVE      "0",CKEYTYP
          CALL      EWARH000
          IF        SCPSMAN=1
            IF        EXIT=1
              MOVE      "Mandatory Field - ",DISPMSG
              BEEP
              CALL      MESSAGE1
              GOTO      SF00L105
            ENDIF
            BRANCH    EXIT,SF00L105,SF00L990
          ELSE
            COMPARE   TWO,EXIT
            GOTO      SF00L990 IF EQUAL
          ENDIF
          MOVE      SIWAWAR,VAR      
          CALL      DISPITEM
          CALL      WDESC000
.
.
          MOVE      "    9",FLDID
          CALL      GETPOSIT
          IF        EXIT=0
            MOVE      WAREDESC,VAR     
            CALL      DISPITEM
          ENDIF
          GOTO     SF00L001
.
SF00L106
          CALL      DEFAULTN
          CALL     SELECTED
          CALL      YORN0000
          MOVE       FYESNO,EXPORTYN
          MOVE      NO,YESNO
          MOVE      ZERO,FORM2
          MOVE      EXPORTYN,FORM2   
          LOAD      YESNO,FORM2,YES
          MOVE      YESNO,VAR
          CALL      DISPITEM
          GOTO     SF00L001
SF00L990  MOVE      FOUR,EXIT * Exit Char Exit
SF00L999  RETURN
.@@@@@ Function Restart Point @@@@@
.----------------------------------------------------------------------
. Set up screen 00
.----------------------------------------------------------------------
SETSCR00
          MOVE      ONE,ACCEPT              * set accept mode
.
          RETURN

.--------------------------------------------------------------------------
. Warehouse Description                                                *I-f1103
.--------------------------------------------------------------------------
WDESC000  MATCH     SP70,SIWAWAR
          IF        @EQUAL
            MOVE      "All Warehouses",WAREDESC
          ELSE
            MATCH     SIWAWAR,Z70
            IF        @EQUAL
              MOVE      "All Warehouses",WAREDESC
            ELSE
              MOVE      SIWADES,WAREDESC
            ENDIF
          ENDIF
          RETURN
DEFAULTN    MOVE     ANSN,DEFYESNO
            RETURN
.------------------------------------------------------------
. Enter Date Range
.------------------------------------------------------------
EDAT0000  MOVE      "    1",FLDID
          CALL      GETPOSIT
.
          PACK      FROMDATE,CCC,CYY,CMM,SP70         * default to blank date
          UNPACK    FROMDATE,CCENT,CYEAR,CMON,CDAY    * set up date parameters
          CALL      KEYDATE                           * keyin date
.
          MATCH     SP70,CDAY
          GOTO      EDAT0100 IF EQUAL
          PACK      FROMDATE,CCENT,CYEAR,CMON,CDAY    * pack desired date
          CALL      PACDATE                           * get date description
          PACK      FROMDAT,CPCDATE,SP70
.
          GOTO      EDAT0140
.
EDAT0100  MOVE      "Start     ",FROMDAT
          PACK      FROMDATE,SP70
.
EDAT0140  MOVE      FROMDAT,VAR
          CALL      DISPITEM
.
EDAT0150  MOVE      "    2",FLDID
          CALL      GETPOSIT
.
          PACK      TODATE,CCC,CYY,CMM,SP70           * default to blank date
          UNPACK    TODATE,CCENT,CYEAR,CMON,CDAY      * set up date parameters
          CALL      KEYDATE                           * keyin date
.
          MATCH     SP70,CDAY
          GOTO      EDAT0200 IF EQUAL
          PACK      TODATE,CCENT,CYEAR,CMON,CDAY      * pack desired date
          CALL      PACDATE                           * get date description
          PACK      TODAT,CPCDATE,SP70
.
          MATCH     FROMDATE,TODATE
          GOTO      EDAT9000 IF EQUAL
          GOTO      EDAT9000 IF NOT LESS
          BEEP
          MOVE      "To Date Must Be > From Date - ",DISPMSG
          CALL      MESSAGE1
          GOTO      EDAT0000
.
EDAT0200  MOVE      "Finish    ",TODAT
          PACK      TODATE,Z70
.
EDAT9000  MOVE      "    1",FLDID
          CALL      GETPOSIT
.
          PACK      SICACODE,SICACODE,SP70
          MATCH     SP70,SICACODE
          GOTO      EDAT9999 IF NOT EQUAL
          MOVE      ONE,ACCEPT
.
          MOVE      ZERO,EXIT
EDAT9999  RETURN
.

ECOS0000
*          MOVE      "    3",FLDID
*          CALL      GETPOSIT
.
          CALL      KSICAA00
          BRANCH    EXIT,ECOS0000,ECOS9999
          PACK      COSTCODE,SICACODE,SP1,SICADESC
.
ECOS1140  MOVE      COSTCODE,VAR
          CALL      DISPITEM
ECOS9999  RETURN
*******************************************************************************
*                                 PRNT0000                                    *
*                               Print Report                                  *
*******************************************************************************
PRNT0000  DISPLAY   *P1:24,*EF,"Printing report..."
.
          MOVE      ZERO,NETTOT      * Clear totals
          MOVE      ZERO,GSTTOT
          MOVE      ZERO,TPGSTTOT
.
          CALL      MAKEXP00         * Make Export File                *I-f1103
.
          CALL      HEAD0000         * Print report
          CALL      BODY0000
          CALL      TAIL0000
.
          CALL      TRAN0000         * Close off Export file           *I-f1103
.
          DISPLAY   *P1:24,*EL,"Select, ",*V2LON,ANSP,*HOFF,"rint Report, ":
                           "e",*V2LON,ANSX,*HOFF,"it :"
.
PRNT9999  RETURN

*******************************************************************************
*                                 HEAD0000               Called by : PRNT0000 *
*                               Report Header                                 *
*******************************************************************************
HEAD0000  CALL      IBACLOCK
          CALL      HEAD132
.
          MOVE      FROMDAT,CPCDATE                                    *I-f1101
          MATCH     SP10,FROMDATE                                      *I-f1101
          GOTO      HEAD0100 IF EQUAL                                  *I-f1101
          UNPACK    FROMDATE,CCENT,CYEAR,CMON,CDAY
          CALL      PACDATE
HEAD0100  PRINT     *40,"From   : ",CPCDATE                * add label *C-f1101
.
          MOVE      TODAT,CPCDATE                                      *I-f1101
          MATCH     Z70,TODATE                                         *I-f1101
          GOTO      HEAD0200 IF EQUAL                                  *I-f1101
          UNPACK    TODATE,CCENT,CYEAR,CMON,CDAY
          CALL      PACDATE
HEAD0200  PRINT     *40,"To     : ",CPCDATE,*N:            * add label *C-f1101
                    *N,*1,"Cost Centre : ",SICACODE,SP2,SICADESC:
                    *N,*1,"Warehouse   : ",SIWAWAR,SP2,WAREDESC        *I-f1103
.
          CALL      UND132
          PRINT     *1,"|            |           | Catalog |":
                    "                        |          |   Unit    |":
                    "                 |           |  Total Price    |",*N:
                    *1,"|   Date     | Req. No.  | Number  |":
                    "   Description          | Quantity |   Cost    |":
                    "    Net Price    |    GST    |  Inc. of GST    |"
          CALL      UND132
          ADD       FIVE,CLNO                         * change 4 to 5  *C-f1103
.
HEAD9999  RETURN
+
*******************************************************************************
*                                 BODY0000               Called by : PRNT0000 *
*                                Report Body                                  *
*******************************************************************************
BODY0000  PACK      KEY28,FROMDATE,SP70
          UNPACK    COSTCODE,COSTCENT                                  *I-f1102
.
          CALL      RSSIRB4
BODY1000  CALL      RKSIRB4
          BRANCH    OVRCD,BODY9999
.
          MATCH     SIRBDAT,TODATE                * Equal or less than to date?
          GOTO      BODY9999 IF LESS              * No, finished report
.
.* ************************************************ Start of Addition  *I-f1103
          MATCH     SP5,SIWAWAR
          IF        !@EQUAL
            MATCH     SIWAWAR,SIRBWAR
            GOTO      BODY1000 IF NOT EQUAL
          ENDIF
.* ************************************************ End of Addition    *I-f1103
.
          PACK      KEY8,SIRBTYP,SIRBREQ,SP8      * Yes, continue
          CALL      RDSIRA1
          BRANCH    OVRCD,BODY1000
.
......    BRANCH    SIRAIND,BODY1000      * Only requisitions  *I-f1102 D-f1104
          MATCH     SIRACST,COSTCENT              * Only this Cost Centre
          GOTO      BODY1000 IF NOT EQUAL                              *I-f1102
.
          UNPACK    SIRBDAT,CCENT,CYEAR,CMON,CDAY
          CALL      PACDATE
.
          PACK      KEY7,SIRBCAT,SP8
          CALL      RDSIIA1                       * Get cost centre description
          MOVE      SIIADES,DIM23                 * Only use 1st 23 characters
.
          COMPARE   ZERO,SIRBIQT                                       *I-f1101
          GOTO      BODY1000 IF EQUAL                                  *I-f1101
.
          UNPACK    SIRBIQT,ANS,ANS,ANS,ANS,DIM8  * Format quantity to fit
          ASSIGN    SIRBAMT/SIRBIQT,UNITCOST      * Calculate unit cost
.
          PACK      KEY14,SIIAGST,SIRBDAT
          CALL      RDIBGE1                       * Get GST percentage
          BRANCH    OVRCD,BODY2000                * Nothing for current date
          GOTO      BODY3000
.
BODY2000  CALL      RPIBGE1                       * Last date GST item updated
          IF        OVRCD = ONE
            MOVE      ZERO,GSTAMT                 * GST item not found
            GOTO      BODY4000
          ENDIF
.
BODY3000  ASSIGN    SIRBAMT*IBGEAMNT,GSTAMT       * Calculate GST amount
          ASSIGN    GSTAMT/100,GSTAMT
.
BODY4000  ASSIGN    SIRBAMT+GSTAMT,TOTPRGST       * Total Price Inc. GST
.
          PRINT     *1,"| ",CPCDATE,*14,"| ",SIRBTYP,SP1,SIRBREQ,*26,"| ":
                    SIRBCAT,*36,"| ",DIM23,*61,"| ",DIM8,*72,"| ",UNITCOST:
                    *84,"| ",SIRBAMT,*102,"| ",GSTAMT,*114,"| ",TOTPRGST:
                    *132,"|"
          ADD       ONE,CLNO
          ADD       SIRBAMT,NETTOT                * Add to totals
          ADD       GSTAMT,GSTTOT
          ADD       TOTPRGST,TPGSTTOT
.
          CALL      WRTEXP00                      * write Export file  *I-f1103
.
          COMPARE  "55",CLNO                      * End of page
          CALL     HEAD0000 IF NOT LESS
.
          GOTO      BODY1000                      * Goto next record
.
BODY9999  RETURN
+
*******************************************************************************
*                                 TAIL0000               Called by : PRNT0000 *
*                                Report Tail                                  *
*******************************************************************************
TAIL0000  CALL      UND132
          PRINT     *1,"|",*72,"Totals:",*84,"|",*86,NETTOT,*102,"|",GSTTOT:
                    *114,"|",*116,TPGSTTOT,*132,"|"
          CALL      UND132
          ADD       THREE,CLNO
.
TAIL9999  RETURN
.* ****************************************** Start of Addition        *I-f1103
. File       : casetran
.
. Functions  : This file contains standard routines for
.              creating and transfering TAB delimited
.              export files to a PC using the unix script
.              keatran.
.
. Routines   : MAKEXP00  - Create the Export File and Headings
.              WRTEXP00  - Write Export Record to File
.              TRAN0000  - Transfer file to PC using script keatran
.
. Note       : The Variable EXPORTYN is used to determine if a
.              export file is to be created. 0=No, 1=Yes.
.
. Variables to be Declared
. ------------------------
. EXPORTFL  FILE      ASCII, FIXED=400     * Export File (Adjust Length to Suit)
. EXPORTFN  DIM       8                    * Export File Name
. TABDELM   EQU       0x09                 * Tab Delimiter
.------------------------------------------------------------
. Create Export File
.------------------------------------------------------------
MAKEXP00  COMPARE  ONE,EXPORTYN
          GOTO     MAKEXP99 IF NOT EQUAL
          MOVE     "EXPORT",KEY6
          PACK     EXPORTFN,KEY6,PORT
          REP      " 0",EXPORTFN
          PREP     EXPORTFL,EXPORTFN
          WRITE    EXPORTFL,SEQ;"Cost Centre",TABDELM:
                                "Description",TABDELM:
                                "Warehouse",TABDELM:
                                "Description",TABDELM:
                                "Date",TABDELM:
                                "Req.No.",TABDELM:
                                "Calalog No",TABDELM:
                                "Description",TABDELM:
                                "Quantity",TABDELM:
                                "Unit Cost",TABDELM:
                                "Net Price",TABDELM:
                                "GST",TABDELM:
                                "Tot.Price (Inc.GST)"
MAKEXP99  RETURN
.------------------------------------------------------------
. Write to Export File
.------------------------------------------------------------
WRTEXP00  COMPARE  ONE,EXPORTYN
          GOTO     WRTEXP99 IF NOT EQUAL
          WRITE    EXPORTFL,SEQ;SICACODE,TABDELM:
                                SICADESC,TABDELM:
                                SIWAWAR,TABDELM:
                                WAREDESC,TABDELM:
                                CPCDATE,TABDELM:
                                SIRBTYP,SIRBREQ,TABDELM:
                                SIRBCAT,TABDELM:
                                DIM23,TABDELM:
                                DIM8,TABDELM:
                                UNITCOST,TABDELM:
                                SIRBAMT,TABDELM:
                                GSTAMT,TABDELM:
                                TOTPRGST
WRTEXP99  RETURN
.------------------------------------------------------------
. Execute Transfer Script eg softerm
.------------------------------------------------------------
TRAN0000  COMPARE  ONE,EXPORTYN
          GOTO     TRAN9999 IF NOT EQUAL
          MOVE     YES,DEFYESNO
          CLOSE    EXPORTFL
          DISPLAY  *P1:24,*EL,"Execute Transfer Now (":
                              *V2LON,"Y",*HOFF,"/":
                              *V2LON,"N",*HOFF,") ? "
          MOVE     "24",CVERT
          MOVE     "30",CCOL
          CALL     YORN0000
          COMPARE  ZERO,FYESNO
          GOTO     TRAN9999 IF EQUAL   *  No Transfer
.
          MOVE     ZERO,HLEF
          CALL     GETSCR00
.
          CLEAR    KEY80
          APPEND   "keatran ",KEY80
          APPEND   EXPORTFN,KEY80
          APPEND   ".txt",KEY80
          RESET    KEY80
          EXECUTE  KEY80,TASKID
.
          CALL     PUTSCR00
.
          DISPLAY  *P1:24,*EL,"Transfer Completed Ok (":
                              *V2LON,"Y",*HOFF,"/":
                              *V2LON,"N",*HOFF,") ? "
          MOVE     "24",CVERT
          MOVE     "31",CCOL
          CALL     YORN0000
          COMPARE  ZERO,FYESNO
          GOTO     TRAN0000 IF EQUAL   *  Not ok
.
          PREP     EXPORTFL,EXPORTFN
          CLOSE    EXPORTFL
.
TRAN9999  RETURN
.* ****************************************** End of Addition          *I-f1103
.--------------------------------------------------------------------------
. Entry Handler for Warehouse Keyin                                    *I-f1103
.--------------------------------------------------------------------------
EWARH000  MOVE      ZERO,EXIT
.
          CALL      KSIWAA00                * in SINWARKY.INC
.
EWARH999  RETURN
.-------------------------------
. Includes for I/O and Keyins
.-------------------------------
          INC       IBAGEDIO/INC
          INC       SINCCAIO/INC
          INC       SINCCAKY    
          INC       SINCIAIO/INC
          INC       SINREAIO/INC
          INC       SINREBIO/INC
          INC       SINWARIO/INC
          INC       SINWARKY    
.
          INC       STDGENCD
.
