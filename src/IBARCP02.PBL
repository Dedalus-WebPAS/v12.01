.***************************************************************************
.* System   :   CASH RECEIPTING                                            *
.* Program  :   IBARCP02                                                   *
.* Desc     :   Bank Reconciliation/Deposit Listing                        *
.***************************************************************************
.* Comments :                                                              *
.* Mods     :                                                              *
.*        V12.01.01 03/06/2025  J.Tan           Task 0960533               *
.*                  Mod Money order to Patient Portal                      *
.*        V11.04.03 19/12/2024  J.Tan           Task 0955263               *
.*                  Mod WRDAT000 to check for 'Drawer From'                *
.*        V11.04.02 25/10/2023  J.Tan           Task 0951905               *
.*                  Mod WRDAT500 to check for Release date                 *
.*        V11.04.01 31/05/2022  J.Tan           Task 0947153               *
.*                  Mod to print 'Total Cheque' instead of 'Total'         *
.*                  31/05/2022  J.Tan           Task 0947341               *
.*                  Mod WRDAT000 -to speedup print receipt by released date*
.*                  31/05/2022  J.Tan           Task 0947149               *
.*                  Mod to print Medicare Reference for payment by Medicare*
.*        V11.02.02 08/11/2022  J.Tan           Task 0922608               *
.*                  Mod WRSYS000 to check hospital id for COPTION 7 or 8   *
.*        V11.02.01 02/03/2022  Jill Parkinson  Task 0916653               *
.*                  Moved hospital match in WRSYS000 to after key validate *
.*        V10.15.01 26/11/2019  Ebon Clements    TSK 0883592               *
.*                  Set exit to ZERO at the end of RECN0000 after the      *
.*                  report has run                                         *
.*        V10.14.01 21/03/2019  J.Tan            TSK 0857392               *
.*                  Changed RCP Transaction count from DIM3 to DIM5        *
.*        V10.13.04 30/10/2018  J.Tan         TASK 0816722                 *
.*                  Mod to print Cancelled receipts on Final Cash Reconc.  *
.*        V10.13.03 10/10/2018  Ebon Clements TASK 0839963                 *
.*                  Remove temp files FNAMEN and FNAMEO - KLAT0000         *
.*        V10.13.03 10/10/2018  Ebon Clements TASK 0839963                 *
.*                  Remove temp files FNAMEN and FNAMEO - KLAT0000         *
.*        V10.13.02 25/07/2018  J.Tan         TASK 0839963                 *
.*                  Removed extra line b/w Section 1 and Section 2 on CSV  *
.*        V10.13.01 23/07/2018  J.Tan         TASK 0851232                 *
.*                  Added locking for Final Cash Reconciliation            *
.*        V10.12.01 16/07/2018  J.Tan         TASK 0839963                 *
.*                  Added opt to output reconciliation data to a CSV file  *
.*        V10.08.01 23/06/2016  J.Tan          CAR 0820980                 *
.*                  Mods to check for Suspense Allococation (SUSA0000)     *
.*        V10.07.05 02/03/2016  J.Tan          CAR 303942                  *
.*                  Mods printing EFTPOS payment type                      *
.*        V10.07.04 01/03/2016  J.Tan          CAR 314900                  *
.*                  Mods Narrative field for record 0600 (Extended Integra)*
.*        V10.07.03 22/01/2016  J.Tan          CAR 303942                  *
.*                  Mods for Additional payment types                      *
.*        V10.07.02 12/01/2016  J.Tan          CAR 303942                  *
.*                  Mods for Additional payment types                      *
.*        V10.07.01 23/11/2015  J.Tan          CAR 303942                  *
.*                  Mods for Additional payment types                      *
.*        V10.06.02 12/08/2015  J.Tan          CAR 314900                  *
.*                  Added HSYS1=5 for Extended Integra interface           *
.*        V10.06.01 01/04/2015  J.Tan          CAR 314936                  *
.*                  Mods Calc.GST amt rectype 0800 for HSYS1=3 & RCCNEGST=1*
.*        V10.05.03 29/08/2014  J.Tan          CAR 305307                  *
.*                  Mods HSYS1=4 to print Allocated Suspense Register      *
.*        V10.05.02 06/08/2014  J.Tan          CAR 303627                  *
.*                  Fixed Account for HSYS1=4 G/L Interface comma delimeted*
.*        V10.05.01 24/07/2014  J.Tan          CAR 303627                  *
.*                  Added HSYS1=4 G/L Interface comma delimeted file       *
.*        V10.04.01 15/04/2014  J.Tan          CAR 261630                  *
.*                  Removed port number from temp file name                *
.*        V10.03.01 01/12/2011  J.Tan    CAR 252972                        *
.*                  Fixed option 8 for a negative receipt amount           *
.*        V10.02.02 28/07/2010  J.Tan    CAR 244159                        *
.*                  Mods for Credit Card Surchage                          *
.*        V10.02.01 13/04/2011  Mike Laming   CAR 233901                   *
.*                  Add "*" to Receipt No. if Suspence allocation Report 7 *
.*        V10.01.04 15/03/2011  Mike Laming   CAR 233901                   *
.*                  Add Suspense Allocation column in Report 9             *
.*        V10.01.03 26/11/2010  J.Tan    CAR 233919                        *
.*                  No Cash release if No Final cash Reconciliation record *
.*        V10.01.02 10/11/2010  Mike Laming   CAR 233235                   *
.*                  Added option to "Remove Page Breaks" in PRLIS000       *
.*        V10.01.01 29/10/2010  J.Tan    CAR 232320                        *
.*                  Mods checking for zero amount of receipt               *
.*        V10.00.11 14/10/2010  J.Tan                                      *
.*                  Mods to print header if no records print               *
.*        V10.00.10 14/10/2010  Mike Laming      CAR 230977                *
.*                  Change description to "Eftpos- Cash" & "Eftpos- Credit"*
.*        V10.00.09 07/10/2010  Mike Laming      CAR 230977                *
.*                  Changes to EFTPOS to split TNBEFTPO & TOTEFTPO into    *
.*                  Cr (Credit Card) & Db (Cash) values
.*        V10.00.08 25/08/2010  J.Tan            CAR 226379                *
.*                  Mods to set RCPTDETL to Inv.No,UR no and visit number  *
.*                  for deposits if RCDTREFR (reference) is blank          *
.*        V10.00.07 07/07/2010  J.Tan            CAR 225550                *
.*                  Fixed Integra 0300 record type - GST amount            *
.*        V10.00.06 18/06/2010  J.Tan            CAR 169968                *
.*                  Mods to print message - 'No Final Cash Reconciliation' *
.*        V10.00.05 07/06/2010  J.Tan            CAR 222746                *
.*                  Added Web user id to cash release                      *
.*        V10.00.04 11/05/2010  J.Tan            CAR 221526                *
.*                  Added parameter for G/L Integra cash interface HSYS1=3 *
.*        V10.00.03 19/04/2010  J.Tan            CAR 216328                *
.*                  Fixed Integra Interface -direct deposits               *
.*        V10.00.02 09/04/2010  J.Tan            CAR 216328                *
.*                  Fixed Integra Interface -receipt with multiple payments*
.*        V10.00.01 31/03/2010  Jill Parkinson   CAR 218988                *
.*                  Fixed output when no data                              *
.*        V9.12.09  15/02/2010  J.Tan            CAR 216328                *
.*                  Mods for Integra Cash Interface                        *
.*        V9.12.08  20/11/2009  J.Tan            CAR 210595                *
.*                  Fixed Bank Deposit - Keyin date must be greater or     *
.*                  equal to Reconciliation date                           *
.*        V9.12.07  13/11/2009  J.Tan            CAR 210106                *
.*                  Mods Bank Deposit to check for Reconciliation date     *
.*        V9.12.06  22/07/2009  J.Tan            CAR 201675                *
.*                  Added option Separate page for each register for       *
.*                  Option 7 and 9                                         *
.*        V9.12.05  21/07/2009  Mike Laming      CAR 187485                *
.*                  Change size of RCBDPAYD, RCBDDRAW, RCBDSTRF            *
.*        V9.12.04  20/07/2009  Mike Laming      CAR 187485                *
.*                 Changes to handle RCBDPAYD & RCBDDRAW becoming 50 chars *
.*        V9.12.03  08/07/2009  Ebon Clements    CAR 199592                *
.*                  Added register range test to WROP8000                  *
.*        V9.12.02  04/05/2009  J.Tan            CAR 194893                *
.*                  Added option 9 and 10                                  *
.*        V9.12.01  25/03/2009  J.Tan            CAR 187083                *
.*                  Fixed checking Cash Drawers Multi Hospital             *
.*        V9.11.01  28/01/2009  J.Tan            CAR 187715                *
.*                  Added option to print summary report                   *
.*        V9.10.04  02/09/2008  Peter Vela       CAR 175820                *
.*                  Added functionality to display payer header in system  *
.*                  recon report                                           *
.*        V9.10.03  14/08/2008  Peter Vela       CAR 175820                *
.*                  Added functionality to display System Reconcilation    *
.*                  in receipt number order. Parameter RCCNRCP2.RCPCONFD   *
.*        V9.10.02  05/08/2008  Mike Laming      CAR 175417                *
.*                  Correct Option 8 to read "rcpbdtaf" by Date/Receipt No.*
.*                  Modify report to prorate Payment Types across Registers*
.*        V9.10.01  08/07/2008  Mike Laming      CAR 172030                *
.*                  Added Option 8 - Receipts by Register Summary          *
.*             V9.09.06  22/04/2008  Ebon Clements    CAR 163254           *
.*                       Added reference & payer to receipt by reg report  *
.*             V9.09.05  03/12/2007  Peter Vela       CAR 154075           *
.*                       Fixed date comparison for COPTION=7 @ WRSYS00     *
.*             V9.09.04  01/11/2007  Steve Armstrong  CAR 153826           *
.*                       Removed semicolon in the PRINT statement for      *
.*                       credit card payments so that the print head is    *
.*                       not held on the same line resulting in the next   *
.*                       payment line overwriting the current one.         *
.*             V9.09.03  07/09/2007  Ebon Clements  CAR 149260             *
.*                       Changed Payee to Payer                            *
.*             V9.09.02  31/07/2007  J.Tan          CAR 140282             *
.*                       Fixed commission percentage                       *
.*             V9.09.01  14/05/2007  J.Tan          CAR 140282             *
.*                       Mods to print Commission Card detials             *
.*             V9.08.05  23/05/2007  J.Tan          CAR 139572             *
.*                       Mods us1/us2  - copy to .prt file                 *
.*             V9.08.04  22/05/2007  J.Tan                                 *
.*                       Mods to checking for transdate for WRSYS000       *
.*             V9.08.03  30/04/2007  J.Tan          CAR 139572             *
.*                       Mods to execute us1/us2 commands for the spoolfile*
.*             V9.08.02  30/03/2007  Mike Laming    CAR 126377             *
.*                       Moved Drawer Recon. header into Page Header - SSS *
.*             V9.08.01  09/11/2006 Sandra Barcham     123728              *
.*                       Fixed Cheque Account length S/B 15 not 14         *
.*             V9.07.01  31/07/2006  Peter Vela    CAR 113680              *
.*                       Fixed Cheque Account Totals display (PRLIS000)    *
.*             V9.06.01  08/06/2006  Ramaprasad    CAR 107723              *  
.*                       The report heading is made dynamic and is based   *
.*                       on the function selected                          *
.*             V9.05.B02 10/11/2005  Peter Vela    CAR 81402               *
.*                       Modified report format for Deposit listings       *
.*             V9.04.04  25/11/2005  J.Tan         CAR 85267               *
.*                       Mods to Reconciliation to include receipts up to  *
.*                       the keyindate                                     *
.*             V9.04.03  15/09/2005  J.Tan         CAR 66178               *
.*                       Mods to print total of register                   *
.*             V9.04.02  21/03/2005  Mike Laming   CAR 59171               *
.*                       Add Option 7 - Receipt by Register Report         *
.*             V9.04.01  28/02/2005  Mike Laming   CAR 58680               *
.*                       Add Date entered to all report headings           *
.*             V9.03.05  18/05/2003  Lina Vo       CAR 49781               *
.*                       Changed Deposit System descriptions               *
.*             V9.03.04  12/05/2003  Lina Vo       CAR 49813               *
.*                       Changed Money order to use cheque Number field    *
.*                       12/05/2003  Lina Vo       CAR 49738               *
.*                       Display missing Credit Card Total for Cash Drawer *
.*             V9.03.03  04/05/2003  Lina Vo       CAR 49530               *
.*                       Do not process cancelled receipts                 *
.*             V9.03.02  26/03/2003  Jill Habasque CAR 49163               *
.*                       Adding printing of headings                       *
.*             V9.03.01  22/03/2003  Jill Habasque CAR 44083               *
.*                       Mods to printing of suspense records              *
.*             V9.03.00  26/11/2003  Jill Habasque CAR 44083               *
.*                       Created program                                   *
.***************************************************************************
+
          INC       STD001FD
          INC       IBASEQFD/INC                 * Sequential Numbers File
          INC       TFILEVAR/INC                 * Generate Temp File Name
          INC       WEBERRFD/INC                 * Web Server Error Logging
          INC       IBAGINFD/INC
.
          INC       RSHWEBDF
          INC       WEBCONFD/INC
          INC       FMSCHQFD/INC
          INC       PATCODFD/INC
          INC       PATMA1FD/INC
          INC       PMSCMMFD/INC
          INC       DEBDBTFD/INC
          INC       RCPBNKFD/INC   * bank deposit header file
          INC       RCPBDTFD/INC   * bank deposit detail file
          INC       RCPDTEFD/INC   * receipt details file
          INC       RCPCIDFD/INC   * cash drawer file
          INC       RCPREGFD/INC   * register file
          INC       WEBSECFD/INC
          INC       WEBSCHFD/INC
          INC       RCPCONFD/INC
          INC       IBAGEDFD/INC
          INC       PATHSPFD/INC
.
AMTCASH   FORM      7.2
AMTCHEQ   FORM      7.2
AMTCRCD   FORM      7.2
AMTEFTPO  FORM      7.2
AMTDIRDE  FORM      7.2
AMTMONOR  FORM      7.2
AMTBPAY   FORM      7.2
AMTHICAP  FORM      7.2
AMTMEDIC  FORM      7.2
AMTOTHER  FORM      7.2
.
ARRNUMB   FORM      2
CREDCOL   FORM      2
EFTPCOL   FORM      2
CURCOLN   FORM      2
CSVCTIME  DIM       8
.
CODECR    INIT      "CR"
CODEPY    INIT      "Py"
CFEETYP   FORM      1
CMDLINE   DIM       127
COUNT     FORM      8
CNTTRN    FORM      8
CONTIN    DIM       8
CHQADESC  DIM       40
CURPMTYP  DIM       2
CSVFNAME  DIM       8 
CSVFLAG   FORM      1
CRECFLAG  FORM      1    * Flag for Printing cancelled recepts
.
DOLLAR    INIT      "$"
DIM2A     DIM       2
DIM5      DIM       5
DIM6      DIM       6
DIM7      DIM       7
DIM8      DIM       8
DIM10     DIM       10
DIM11A    DIM       11
DIM12     DIM       12
DIM15     DIM       15
DIM17     DIM       17
DIM20     DIM       20
DISPLDTE  DIM       10                                                 *I-58680
DISPLDT2  DIM       10                                                 *I-59171
DONE      FORM      1
DRAWCOL   FORM      2
DRAWNAME  DIM       40
DRAWER    DIM       40
DRAWERF   DIM       6
DRAWERT   DIM       6
ZEROFLD   INIT      "           0.00"
ZED40     INIT      "zzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzz"
ZDOLLAR   INIT      "$-"
.
EXPORTFL  FORM      1                  * Create Export File
ENDFLAG   FORM      1
EFTDESC   DIM       40
FPAYTYPE  FORM      2
FNAMEA    DIM       8
FNAMEB    DIM       8
FNAMEC    DIM       8
FNAMED    DIM       8
FNAMEE    DIM       8
FNAMEF    DIM       8
FNAMEG    DIM       8
FNAMEH    DIM       8
FNAMEI    DIM       8
FNAMEJ    DIM       8
FNAMEK    DIM       8
FNAMEL    DIM       8
FNAMEM    DIM       8
FNAMEN    DIM       8
FNAMEO    DIM       8
FRSTDATE  DIM       8
FORM12    FORM      12
FORM3P2   FORM      3.2
FORM4P2   FORM      4.2
FORM8P2A  FORM      8.2
FORM8P2B  FORM      8.2
FORM12P2  FORM      12.2
FORM12D2  FORM      12.2
FORM12X2  FORM      12.2
FORM15P2  FORM      15.2
GSTFLAG   FORM      1
GSTAMNT   FORM      12.2
GNDTOTAL  FORM      12.2
GNSTOTAL  FORM      12.2
HDTITLE   DIM       35                                      * was 28   *C-58680
HEADFLAG  FORM      1
IBCNMHOS  FORM      1
.
KEY24A    DIM       24
.
.  HSYS1=3 - Integra
.  1=Cash/Cheque/Money Order,2=Credit Card/EFTPOS,3=Amex,4=Direct Debit
.
.  For HSYS1=5 - Extended integra
.  1=Cash,2=Credit Card,3=Amex,4=Direct Debit,5=Visa,6=Master Card
.  7=Cheque 8=Money Order, 9=EFTPOS Cash, 10=EFTPOS Credit, 11=BPAY
.  12=Virtual Terminal, 13=Medicare,
.
LODGHREC  FORM      12.2[99]  * array 1=Cash,2=Credit Card,3=Amex,4=Direct Debit
LODGSREC  FORM      12.2[99]  * GST   1=Cash,2=Credit Card,3=Amex,4=Direct Debit
.
LASTDATE  DIM       8
FRSTFLAG  FORM      1
ENQDATE   DIM       8
MAXHREC   FORM      2
NPAGFLAG  FORM      1
NOPGOFLO  FORM      1                                                 *I-233235
HDBYPASS  FORM      1                                                 *I-233235
NEWGRP    FORM      1
NEWPTYP   FORM      1
NEWDRAWR  DIM       6
NEWCHQAC  DIM       15
OP8REGI   DIM       3[50]
OP8AMNT   FORM      12.2[50]
OP8TDATE  DIM       8
OTHRAMNT  FORM      12.2[99]
OTCOLNUM  FORM      2
.
OP8INAMT  FORM      12.2
PRTOTFLG  FORM      1
PAYMCOLN  DIM       5[99]    * Payment type/card type
DQUOTCHR  INIT      "#""
DPYAMNT   DIM       17
PHEDFLAG  FORM      1
PATNAM    DIM       26
PAYMINDC  FORM      2
PAYTYPE   DIM       12
PAYAMNT   FORM      12.2
PREVDRID  DIM       6                                                 *I-233235
PREVCHQN  DIM       15                                                *I-233235
PRINTBD   DIM       1
PRORATNO  FORM      2
RECFLAG   FORM      1
RECDATE   DIM       8
RECDATTO  DIM       8                                                  *I-59171
REGFROM   DIM       3                                                  *I-59171
REGTOTO   DIM       3                                                  *I-59171
REFRENC   DIM       50
RECNSAVE  DIM       12
SAVKEY1   DIM       1
SAVKEY2   DIM       2
SAVKEY12  DIM       12
SAVKEY14  DIM       14
SAVKEY17  DIM       17
SAVPDESC  DIM       20
SAVKEY26  DIM       26
SAVKEY29  DIM       29
SAVKEY41  DIM       41
SUMMFLAG  FORM      1
SPAGFLAG  FORM      1
SKIPFLAG  FORM      1
SAVERECN  DIM       12
SAVCCODE  DIM       3
SVCDNHCP  DIM       2
.
SAVRDATE  DIM       8
SAVDRWID  DIM       6
SAVREGIS  DIM       3
SAVRECNM  DIM       12
SAVINVCN  DIM       12
SAVCOUNT  DIM       8
SAVRECPT  DIM       12
.
SAVDSCRG  DIM       20
SAVSYDSC  DIM       21
SAVREFER  DIM       17
SAVINVCV  DIM       12
SAVPNAME  DIM       26
SAVPTNME  DIM       26
SAVINAMT  FORM      12.2
SAVDSAMT  FORM      12.2
SAVALAMT  FORM      12.2
.
SAVCSHDR  DIM       6
SAVPYFFG  FORM      1
SAVDRAWR  DIM       6
SAVCHQAC  DIM       15
SAVPMTYP  DIM       2
SAVHTYPE  DIM       1
SAVREG    DIM       3
SREGSTER  DIM       3
USERID    DIM       10
VAR       DIM       127
.
TOTCOLN  FORM      2
TOTAMNT  FORM         12.2
TOTSUSPN FORM         12.2
TOTDTAMT FORM         12.2
TOTLTRNL FORM         12.2
TXTFNAME DIM          17
TREGAMT  FORM         12.2
TREGDIS  FORM         12.2
TALOAMT  FORM         12.2
TOTAL1   FORM         9.2
TOTAL2   FORM         9.2
TOTOTHS  FORM         12.2
TOTCASH  FORM         12.2         * Total Cash
TOTCHQ   FORM         12.2         * Total Cheque
TOTCRED  FORM         12.2         * Total Credit
TOTDDBT  FORM         12.2         * Total Direct Deposit
TOTDIS   FORM         12.2
TOTMONOR FORM         12.2         * Total Money Order/Patient Portal
TOTBPAY  FORM         12.2         * Total BPAY
TOTHCAPS FORM         12.2         * Total HICAPS
TOTMDCAR FORM         12.2         * Total Medicare
TOTPAYMN FORM         12.2[99]
.
TOTEFTCR FORM         12.2         * Total EFTPOS  (Credit Card)      *I-230977
TOTEFTDB FORM         12.2         * Total EFTPOS  (Cash)             *I-230977
TTOTEFTP FORM         12.2         * Total EFTPOS
TTOTCASH FORM         12.2         * Total Cash
TTOTCHQ  FORM         12.2         * Total Cheque
TTOTDDBT FORM         12.2         * Total Direct Deposit
TTOTMONR FORM         12.2         * Total Money Order/Patient Portal
TTOTBPAY FORM         12.2         * Total BPAY
TTOTHCPS FORM         12.2         * Total HICAPS
TTOTMCAR FORM         12.2         * Total Medicare
TTOTPYMN FORM         12.2[99]
..TTOTEFTP FORM         12.2         * Total EFTPOS       
TTOTEFCR FORM         12.2         * Total EFTPOS  (Credit Card)      *I-230977
TTOTEFDB FORM         12.2         * Total EFTPOS  (Cash)             *I-230977
TOTTOTAL FORM         12.2
TOTAMT   FORM         12.2
TOTAAMT  FORM         12.2
TOTTOAMT FORM         12.2
TOTTODIS FORM         12.2
TOTALAMT FORM         12.2

.
. ----- Tempfile Definitions -----
.
.       Cash G/L Comma delimeted file
.
CASHLEDG  FILE      ASCII, FIXED=120
.
.Name    Type     Size    Start     Description
.----    ----     ----    -----     -----------
.IBGILEDG  DIM       2      2        1     Ledger
.IBGIACCT  DIM       12     12       3     Account
.IBGIDATE  DIM       8      8        15    Date (Optional)
.IBGISIGN  DIM       1      1        23    Sign
.IBGIVALU  FORM      12.2   15       31    Value
.IBGIDESC  DIM       30     30       39    Transaction Description (Optional)
.IBGIREF   DIM       15     15       69    Reference (Optional)
.IBGIDISS  DIM       5      5        84    Dissection (Optional)
.IBGIRESP  DIM       4      4        89    Responsibility (Optional)
.IBGICRAC  DIM       12     12       93    Credit Account - Cash (Optional)
.IBGICRAA  DIM       12     12       105   Credit Account - Accrual (Optional)
.IBGIBASC  DIM       3      3        117   BAS Code
.End of record                       120
.
.
CREDFIL1  IFILE     SQL, FIXED=26, KEY="U1-6,7-7,8-10"
CREDFIL2  IFILE     SQL, FIXED=26, KEY="U7-7,8-10,1-6"
.Name     Type   Length   Physical   Start   Description
.----     ----   ------   --------   -----   -----------
CREDDRAW  DIM       6         6        1     Cash Drawer
CREDINDC  DIM       1         1        7     Credit Card (Cat CR) indicator 1
.                                            1= Amex
.                                            2= Visa
.                                            3= Master
.                                            4= Diners
CREDCODE  DIM       3         3        8     Credit Card code
CREDAMNT  FORM      12.2      8       11     Amount
CREDSPAR  DIM       7         7       19     Spare
.
.End of Record                        26
.
EFTPFIL1  IFILE     SQL, FIXED=26, KEY="U1-6,7-7,8-10"
EFTPFIL2  IFILE     SQL, FIXED=26, KEY="U7-7,8-10,1-6"
.Name     Type   Length   Physical   Start   Description
.----     ----   ------   --------   -----   -----------
EFTPDRAW  DIM       6         6        1     Cash Drawer
EFTPINDC  DIM       1         1        7     Credit Card (Cat CR) indicator 1
.                                            1= Amex
.                                            2= Visa
.                                            3= Master
.                                            4= Diners
EFTPCODE  DIM       3         3        8     Credit Card code
EFTPAMNT  FORM      12.2      8       11     Amount
EFTSSPAR  DIM       7         7       19     Spare
.
.End of Record                        26
.
GNDTFIL1  IFILE     SQL, FIXED=24, KEY="U1-1,2-2,3-5"
.Name     Type   Length   Physical   Start   Description
.----     ----   ------   --------   -----   -----------
GNDTTYPE  DIM       1         1        1     Record type
.                                            0=Credit Card
.                                            1=EFTPOS
GNDTINDC  DIM       1         1        2     Credit Card (Cat CR) indicator 1
.                                            1= Amex
.                                            2= Visa
.                                            3= Master
.                                            4= Diners
GNDTCARD  DIM       3         3        3     Credit Card (Cat CR) code
GNDTAMNT  FORM      12.2      8        6     Amount
GNDTSPAR  DIM       10        10       14    Spare
.
.End of Record                         24
.
DRAWTMP1  IFILE     SQL, FIXED=22, KEY="U1-6,7-18"
.
.Name     Type   Length   Physical   Start   Description
.----     ----   ------   --------   -----   -----------
DRAWERID  DIM       6         6        1     Drawer ID
RECEIPTN  DIM       12        12       7     Receipt Number
.
.End of Record                         22
.
DRAWTMP2  IFILE     SQL, FIXED=118, KEY="U1-6,7-9,10-21,22-29"
DRAWTM12  IFILE     SQL, FIXED=118, KEY="U7-9,1-6,10-21,22-29"
DRAWTMP5  IFILE     SQL, FIXED=134, KEY="U1-6,7-9,30-41,10-21,22-29"
.
.Name     Type   Length   Physical   Start   Description
.----     ----   ------   --------   -----   -----------
.DRAWERID  DIM       6         6        1     Drawer ID
REGISTER  DIM       3         3        7     Register
INVOICEN  DIM       12        12       10    Invoice Number
COUNTREC  DIM       8         8        22    Counter
.RECEIPTN DIM       12        12       30    Receipt Number
INAMOUNT  FORM      12.2      8        42    Amount for this invoice
DSAMOUNT  FORM      12.2      8        50    Discount
VISNUMB   DIM       8         8        58    Visit Number
URNUMB    DIM       8         8        66    UR Number
SCFLAG    DIM       1         1        74    Scan flag - 0=Debtor 1=PMI
PNAME     DIM       26        26       75    Payer Name
REFERENC  DIM       17        17       101   Reference
.End of Record                         118
.                                   * extra fields for Temp 5 only
ALOCAMNT  FORM      12.2      8        118   Amount allocated from Suspense
ALOCDATE  DIM       8         8        126   Allocate from Suspense Date
.
.End of Record                         134
.
DRAWTMP3  IFILE     SQL, FIXED=222, KEY="U1-6,19-33,218-218,34-35,7-18,36-43"
DRAWTMP6  IFILE     SQL, FIXED=222, KEY="U19-33,218-218,34-35,7-18,36-43,1-6"
.
.Name     Type   Length   Physical   Start   Description
.----     ----   ------   --------   -----   -----------
.DRAWERID  DIM      6         6        1     Drawer ID
.RECEIPTN  DIM      12        12       7     Receipt Number
CHQACCNT  DIM       15        15       19    Cheque Account Number
PAYMTYPE  DIM       2         2        34    Payment Type
.                                         1 = CASH
.                                         2 = CHEQUE
.                                         3 = CREDIT CARD
.                                         4 = DIRECT DEPOSIT
.                                         5 = MONEY ORDER/Patient Portal
.                                         6 = EFTPOS
.                                         7 = BPAY
.                                         8 = Virtual Terminal (HICAPS)
.                                         9 = Medicare
.COUNTREC  DIM      8         8        36    Counter
CHQNUMB   DIM       12        12       44    Cheque Number
CHQDRAW   DIM       20        20       56    Cheque Drawer
CHQBANK   DIM       30        30       76    Cheque Bank
CHQBRNCH  DIM       30        30      106    Cheque Branch
CHQAMNT   FORM      12.2      8       136    Cheque Amount
DDREFER   DIM       20        20      144    Direct Deposit Reference
PAYEE     DIM       50        50      164    Payee
EFTTYPE   DIM       1         1       214    EFT Type (1=Cash, 2=Credit)
CARDTYPE  DIM       3         3       215    Card Type
PRNTORD   DIM       1         1       218    Print order
PAYMCODE  DIM       3         3       219    Payment Code
.
.End of Record                        222  
.
DRAWTMP4  IFILE     SQL, FIXED=19, KEY="U1-6,10-17,7-9"
.Name     Type   Length   Physical   Start   Description
.----     ----   ------   --------   -----   -----------
.DRAWERID  DIM       6         6        1     Drawer ID
.REGISTER  DIM       3         3        7     Register
RECPDATE   DIM       8         8       10     Receipt Date 
HEADTYPE   DIM       1         1       18     Heading type for this summary recd
.
.End of Record                         19
.
DRAWTM10  IFILE     SQL, FIXED=29, KEY="U1-6,10-17,7-9,18-19"
.
.Name     Type   Length   Physical   Start   Description
.----     ----   ------   --------   -----   -----------
.DRAWERID  DIM       6         6        1     Drawer ID
.REGISTER  DIM       3         3        7     Register
.RECPDATE  DIM       8         8       10     Receipt Date 
SUMRTYPE   DIM       2         2       18     Payment type (PTCDNHCP)
.                                             1 - Cash
.                                             2 - Cheque
.                                             3 - Cred.Card
.                                             4 - Money Ord/Patient Portal
.                                             5 - Dir.Depos.
.                                             6 - EFTPOS
.                                             7 - BPAY
.                                             8 - Vir.Terminl
.                                             9 - Medicare
SUMAMNT   FORM      12.2      8        20     Payment amount
.
.End of Record                         29
.
DRAWTM11  IFILE     SQL, FIXED=6, KEY="U1-2,3-5"
.
.Name     Type   Length   Physical   Start   Description
.----     ----   ------   --------   -----   -----------
SPAYTYPE  DIM       2         2         1     Other Payment Type
SPAYCODE  DIM       3         3         3     Other Payment code
.
.End of Record                          6
.
CSVCTMP1  IFILE     SQL, FIXED=23, KEY="U1-6,7-9,10-12"
CSVCTMP2  IFILE     SQL, FIXED=23, KEY="U7-9,10-12,1-6"
CSVCTMP3  IFILE     SQL, FIXED=23, KEY="U1-6,13-14,7-9,10-12"
.Name     Type   Length   Physical   Start   Description
.----     ----   ------   --------   -----   -----------
DTDRAWER  DIM       6         6        1     Drawer ID
DTPYTYPE  DIM       3         3        7     Payment type
DTCRTYPE  DIM       3         3        10    Card Type
DTCOLNUM  DIM       2         2        13    Payment colum number
DTAMOUNT  FORM      12.2      8        15    Amount
.
.End of Record                         23

SUMCASH   FORM      12.2       * Payment Amount type 1 - Cash
SUMCHEQ   FORM      12.2       * Payment Amount type 2 - Cheque
SUMCRCD   FORM      12.2       * Payment Amount type 3 - Cred.Card
SUMMONOR  FORM      12.2       * Payment Amount type 4 - MoneyOrd/Patient Portal
SUMDIRDE  FORM      12.2       * Payment Amount type 5 - Dir.Depos.
SUMEFTPO  FORM      12.2       * Payment Amount type 6 - EFTPOS
SUMBPAY   FORM      12.2       * Payment Amount type 7 - BPAY
SUMHICAP  FORM      12.2       * Payment Amount type 8 - Vir.Terminl
SUMMCARE  FORM      12.2       * Payment Amount type 9 - Medicare
.
DESCREG   DIM       20
DESCRE2   DIM       18
.
PIP       INIT      "|"
SYSDES0   INIT      "Invalid System Code  "
SYSDES1   INIT      "Patient Billing      "
SYSDES2   INIT      "Private Practice     "
SYSDES4   INIT      "Medical Services     "
SYSDES5   INIT      "Sundry Debtors       "
SYSDES6   INIT      "Nursing Home         "
SYSDES89  INIT      "Credit Card Surcharge"
SYSDES90  INIT      "EMR Deposits         "
SYSDES91  INIT      "OUT Deposits         "
SYSDES92  INIT      "GST Sundry Cash Sales"
SYSDES94  INIT      "Sundry Debtor Rec.   "
SYSDES95  INIT      "Sundry Cash Sales    "
SYSDES96  INIT      "PRI Deposits         "
SYSDES97  INIT      "IP Deposits          "
SYSDES98  INIT      "Internal Receipts    "
SYSDES99  INIT      "Suspense             "
SYSDESC   DIM       21
SHORTNAM  DIM       12         * Payee Short Name
TILD20    INIT      "~~~~~~~~~~~~~~~~~~~~"
TITLE1    INIT      "Interim Cash Reconciliation  - for "
TITLE2    INIT      "Final Cash Reconciliation    - for "
TITLE3    INIT      "Reprint Cash Reconciliation  - for "
TITLE4    INIT      "Interim Bank Deposit Listing - for "
TITLE5    INIT      "Final Bank Deposit Listing   - for "
TITLE6    INIT      "Reprint Bank Deposit Listing - for "
TITLE7    INIT      "Receipts by Register for "
TITLE8    INIT      "Summary Receipts by Register for "
TITLOPT1  INIT      "Interim Cash Reconciliation Report"
TITLOPT2  INIT      "Final Cash Reconciliation Report"
TITLOPT3  INIT      "Re-Print Cash Reconciliation Report"
TITLOPT4  INIT      "Interim Bank Deposit Listing"
TITLOPT5  INIT      "Final Bank Deposit Listing"
TITLOPT6  INIT      "Re-Print Bank Deposit Listing"
TITLOPT7  INIT      "Receipts by Register"
TITLOPT8  INIT      "Receipts by Register Summary"
TITLOPT9  INIT      "Receipts by Released Date"
TITLOP10  INIT      "Receipts by Released Date Summary"
.
.         Temporary file for Integra Cash Interface
.
DRAWTMP7  IFILE     SQL, FIXED=188, KEY="U34-35,7-18"
DRAWTMP8  IFILE     SQL, FIXED=188, KEY="U7-18,34-35"
.
.Name     Type   Length   Physical   Start   Description
.----     ----   ------   --------   -----   -----------
.DRAWERID  DIM      6         6        1     Drawer ID
.RECEIPTN  DIM      12        12       7     Receipt Number
.CHQACCNT  DIM       15        15       19    Cheque Account Number
IPAYTYPE   DIM       2         2        34    Payment Type
.                                         1 = CASH/CHEQUE/MONEY ORDER/Medicare
.                                             /BPAY/HICAPS
.                                         2 = CREDIT CARD(Cat CR Ind1<>1)/EFTPOS
.                                         3 = AMEX (Credit Card Cat CR Indic1=1)
.                                         4 = DIRECT DEPOSIT (4 on rcpbdtaf)
.                                         5.. = AMX,DINERS...
.                               
.  FOR EXTENDED INTEGRA (HSYS1=5)  Extra more payment types breakup
.
.                                         1 = CASH
.                                         2 = CREDIT CARD (Cat CR Ind1<>1,2,3)
.                                         3 = AMEX (Credit CARD Cat CR Ind1=1)
.                                         4 = DIRECT DEPOSIT (4 on rcpbdtaf)
.                                         5 = VISA (Credit CARD Cat CR Ind1=2)
.                                         6 = MASTER (Credit CARD Cat CR Ind1=3)
.                                         7 = CHEQUE
.                                         8 = MONEY ORDER
.                                         9 = EFTPOS (Cash)-  RCBDEFTT=1
.                                        10 = EFTPOS (Credit)
.                                        11 = BPAY
.                                        12 = Virtual Terminal/HICAPS
.                                        13 = Medicare
.                                        14.. = AMX,DINERS...
.
.DIM8     DIM      8         8        36    Counter
.CHQNUMB   DIM       12        12       44    Cheque Number
.CHQDRAW   DIM       20        20       56    Cheque Drawer
.CHQBANK   DIM       30        30       76    Cheque Bank
.CHQBRNCH  DIM       30        30      106    Cheque Branch
PAYMAMNT   FORM      12.2      8       136    Cheque Amount
.DDREFER   DIM       20        20      144    Direct Deposit Reference
.PAYEE     DIM       20        20      164    Payee
.EFTTYPE   DIM       1         1       184    EFT Type
.CARDTYPE  DIM       3         3       185    Card Type
.
.End of Record                        188
.
.         Temporary file for Integra Cash Interface Transaction
.
DRAWTMP9  IFILE     SQL, FIXED=157, KEY="U1-2,3-14,15-22"
.
.Name     Type   Length   Physical   Start   Description
.----     ----   ------   --------   -----   -----------
PAYCTYPE   DIM       2         2         1    Payment Type
.                                         1 = CASH/CHEQUE/MONEY ORDER
.                                         2 = CREDIT CARD/EFTPOS
.                                         3 = AMEX
.                                         4 = DIRECT DEPOSIT (4 on rcpbdtaf)
.  FOR EXTENDED INTEGRA (HSYS1=5)  Extra more payment types breakup
.
.                                         1 = CASH
.                                         2 = CREDIT CARD
.                                         3 = AMEX
.                                         4 = DIRECT DEPOSIT (4 on rcpbdtaf)
.                                         5 = VISA
.                                         6 = MASTER CARD
.                                         7 = CHEQUE
.                                         8 = MONEY ORDER/Patient Portal
.                                         9 = EFTPOS/Cash
.                                         10= EFTPOS/Credit
.                                         11= BPAY
.                                         12= Virtual Terminal
.                                         13= Medicare
.
.RCDTRECN  DIM      12        12       3     Receipt Number
COUNTTRN   DIM       8         8      15     Transaction number
.RCDTTDAT  DIM       8         8      23     Transaction date
.RCDTINVN  DIM      12        12      31     Invoice Number
.RCDTVIST  DIM       8         8      43     Visit Number
.RCDTURNO  DIM       8         8      51     U/R Number
.RCDTNAME  DIM      50        50      59     Name
.RCDTREFR  DIM      17        17     109     Reference
.RCDTINCA  DIM      14        14     126     Income Account
TRNLAMNT   FORM     12.2       8     140     Transaction Line Amount
.RCDTGSTC  DIM       6         6     148     GST Code
.RCDTREGI  DIM       3         3     154     Register Code
.
.End of Record                       157
.
.Name     Type   Length   Physical   Start   Description
. ----- Variable definitions for ASCII file bulkbill.txt -----
.
CASHINTR  FILE      ASCII, FIXED=250
.
.         Files format for Integra Cash Interface
.
. File Header record
.
.Name     Type   Length   Start   Description
.----     ----   ------   -----   -----------------------------
IRECTYPE  DIM        4      1     * Record Type (Hard Code 0000)
.         DIM        1      5     * Record Active (Hard Code Y)
.         DIM        16     6     * Who Set up (Pad with spaces)
.RECDATE  DIM        8      22    * Date of Bank Deposit (YYYYMMDD)
.         DIM        18     30    * Total Value of Transactions
ITOTLREC  FORM       8      48    * Number of Transactions
.         DIM        10     56    * Edition/Version Number (Pad with spaces)
.         DIM        8      66    * Edition/Version Date (Pad with spaces)
.EOR                        74
.
. Lodgement Header Record
.
.Name     Type   Length   Start   Description
.----     ----   ------   -----   -----------------------------
.IRECTYPE DIM        4      1     * Record Type (Hard Code 0300)
.         DIM        10     5     * Batch Number (Pad with spaces)
.         DIM        10     15    * Hard Code "WebPAS DEP"
.         DIM        10     25    * Filler - Pad with spaces
.         DIM        16     25    * Site Code - Pad with spaces
.         DIM        12     25    * Bank Account - Pad with spaces
.         DIM        6      25    * Lodgement Method - Pad with spaces
.         DIM        6      25    * Receipt Method - Pad with spaces
.         DIM        20     25    * Filler - Pad with spaces
.RECDATE  DIM        8      45    * Entry Date (Bank Deposit Date)
.         DIM        24     53    * Filler - Pad with spaces
.         DIM        3      77    * Currency Code - Pad with spaces
.         DIM        30     100   * Narrative (Hard Code - WebPAS Cash) + 
.                                 * Bank Deposit Date
.         DIM        60     130   * Filler (Pad with spaces)
.         DIM        15     190   * Total Value of receipts for payment type grp
.         DIM        15     205   * Total Value of GST Receipts for payment type
.         DIM        15     220   * Total Value of Receipts for payment type
.         DIM        15     235   * Bank Exchange Rate 1 ( Hard code 0.00)
.         DIM        15     235   * Bank Exchange Rate 2 ( Hard code 0.00)
.         DIM        15     235   * Bank Exchange Rate 3 ( Hard code 0.00)
.         DIM        15     250   * Total Bank value of recipts Inc GST
.         DIM        15     265   * Base Value 1 (Total Vlue of receipts GST)
.         DIM        15     280   * Base Value 1 (Hard Code 0.00)
.         DIM        15     295   * Base Value 2 (Hard Code 0.00)
.         DIM        15     310   * Base Value 3 (Hard Code 0.00)
.EOR                        325
.
. Receipt Lodgement line
.
.Name     Type   Length   Start   Description
.----     ----   ------   -----   -----------------------------
.IRECTYPE DIM        4      1     * Record Type (Hard Code 0600)
.         DIM        10     5     * Receipt Number with line number appended
.RCDTTDAT DIM        8      15    * Receipt Date
RCPTDETL  DIM        30     23    * Narrative
.         DIM        1      53    * Auto Disburse (Hard Code "Y")
.         DIM        3      54    * Receipt Transaction Type (Hard Code "N  ")
.         DIM        1      57    * If receipt has a GST value 
.                                   if System is 92 then should be Y else N
.RCDTAMNT DIM        15     58    * Receipt value (GST Inclusive)
.         DIM        16     73    * SLS Customer Code (Pad with spaces)
.         DIM        6      89    * SLS Company Code (Pad with spaces)
.         DIM        6      95    * Override Receipt Method (Pad with spaces)
.         DIM        10     101   * SLS Invoice Reference (Pad with spaces)
.EOR                        111
.
. Payee Details Address Record
.
.Name     Type   Length   Start   Description
.----     ----   ------   -----   -----------------------------
.IRECTYPE DIM        4      1     * Record Type (Hard Code 0700)
PAYENAME  DIM        40     5     * Payee Name
.         DIM        12     45    * Pad with spaces
.         DIM        30     57    * Pad with spaces
.         DIM        30     87    * Pad with spaces
.         DIM        30     117   * Pad with spaces
.         DIM        30     147   * Pad with spaces
.         DIM        30     177   * Pad with spaces
.         DIM        8      207   * Pad with spaces
.         DIM        1      215   * Pad with spaces
.         DIM        12     216   * Pad with spaces
.         DIM        12     228   * Pad with spaces
.         DIM        18     240   * Pad with spaces
.EOR                        258
.
. GL Account details
.
.Name     Type   Length   Start   Description
.----     ----   ------   -----   -----------------------------
.IRECTYPE DIM        4      1     * Record Type (Hard Code 0800)
.RCDTINCA DIM        24     5     * GL Code
.RCDTGSTC DIM        6      29    * GST Code
.         DIM        24     35    * GST GL Code (Pad with spaces)
.         DIM        6      59    * GST Rate (Pad with spaces)
.         DIM        15     65    * GST Value
.         DIM        15     80    * GST Exclusive Value of Receipt
.         DIM        40     95    * GL Narrative (Pad with spaces)
.EOR                        135
.
. File Trailer Record
.Name     Type   Length   Start   Description
.----     ----   ------   -----   -----------------------------
.IRECTYPE DIM        4      1     * Record Type (Hard Code 9999)
.
.
.       CSV output
.
CSVOFILE  FILE      ASCII, FIXED=120
.
. Heading format
.
.Name    Type     Size    Description
.----    ----     ----    -----------
XHDROW01  DIM      100    System Name ?? (Current Date and Time)
XHDROW02  DIM      50     Report Name
.XHDROW03                 Blank line
XHDROW04  DIM      50     Report parameter (Dates)
XHDROW05  DIM      50     Hospital name
.XHDROW06                 Blank line
.XHDROW07                 Blank line
.End of Record
XHDROW08  INIT     "Drawer Reconciliation"
XHDROW09  INIT     "Register Reconciliation"
.
PRGID     INIT      "IBARCP02"
PRGNAM    INIT      "Reconciliation/Bank Deposit Listing"
VERSION   INIT      "V12.01.00"
+
.**************************************************************************
.*                              ML0000                                    *
.*                      Controlling Logic (Mainline code)                 *
.**************************************************************************
.
ML0000    CALL      INIT0000               * initialisation and open files
.
ML0100    CALL      OPTN0000               * select options
          BRANCH    EXIT,ML9999            * EXIT = 1 if 0 chosen in menu
          BRANCH    COPTION,ML1000,ML1000,ML1000,ML1000,ML1000,ML1000:
                            ML1000,ML1000,ML1000,ML1000
          GOTO      ML9999
.
ML1000    MOVE      ZERO,EXPORTFL          * No to create export file
.
          CALL      RECN0000               * Bank reconciliation/Listing
          BRANCH    EXIT,ML0100
.                                          * Options 2 & 5 only
          BRANCH    COPTION,ML9999,ML2000,ML9999,ML9999,ML2000
          GOTO      ML9999
.
ML2000    CALL      EXCUS000               * Execute us1 command
          GOTO      ML9999
.
ML9999    CALL      KLAT0000
.
.         Clear locking for Final Reconciliation
.
          IF        COPTION=2
            PACK      RCCNRCNL,ZERO,ZERO
            MOVE      SP70,RCCNRCNW
            WRITAB    CONTROLF,HUND08;*112,RCCNRCNL,*114,RCCNRCNW
          ENDIF
.
          CHAIN     PGM                    * chain back to program
+
.****************************************************************************
.*                                OPTN0000             Called by: ML0000    *
.*                        get user options or exit                          *
.*                                                                          *
.*    Returns:  EXIT    = FALSE (0)  Run clean up                           *
.*                        TRUE  (1)  Exit option selected                   *
.****************************************************************************
.
OPTN0000  MOVE      ZERO,FRSTFLAG
          MOVE      ZERO,CRECFLAG      * Default to No Printing cancelled rec
.
          DISPLAY   *P1:3,*EF,*P1:4,*V2LON,ZERO,*HOFF,". Exit":
                    *P1:5,*V2LON,ONE,*HOFF,". Interim Bank Reconciliation":
                    *P1:6,*V2LON,TWO,*HOFF,". Final Bank Reconciliation":
                    *P1:7,*V2LON,THREE,*HOFF,". Reprint Bank Reconciliation":
                    *P1:8,*V2LON,FOUR,*HOFF,". Interim Bank Deposit Listing":
                    *P1:9,*V2LON,FIVE,*HOFF,". Final Bank Deposit Listing":
                    *P1:10,*V2LON,SIX,*HOFF,". Reprint Bank Deposit Listing":
                    *P1:11,*V2LON,SEVEN,*HOFF,". Receipts by Register Report":
                    *P1:12,*V2LON,EIGHT,*HOFF,". Receipts by Register Summary":
                  *P1:13,*V2LON,NINE,*HOFF,". Receipts by Released Date Report":
                  *P1:14,*V2LON,TEN,*HOFF,". Receipts by Released Date Summary"
.
OPTN0500  KEYIN     *P1:16,*EL,"Select Option : ",*DV,UNDLN1:
                    *P17:16,*V2LON,COPTION
.
          COMPARE   ZERO,COPTION                 * exit selected ?
          GOTO      OPTN9500 IF EQUAL            * yes
.
          BRANCH    COPTION,OPTN9000,OPTN9000,OPTN9000,OPTN9000,OPTN9000:
                            OPTN9000,OPTN9000,OPTN9000,OPTN9000,OPTN9000
.
          BEEP
          GOTO      OPTN0500
.
OPTN9000  MOVE      ZERO,EXIT
          GOTO      OPTN9999
.
OPTN9500  MOVE      ONE,EXIT
.
OPTN9999  RETURN
.****************************************************************************
.*                                INIT0000             Called by: ML0000    *
.*                             initialisation                               *
.*  The initialisation routine is used to display headings and open files.  *
.****************************************************************************
.
INIT0000  CALL      DISPHEAD                  * display heading
.
          DISPLAY   *P60:24,"opening controlf"
          OPEN      CONTROLF,"controlf"
          READ      CONTROLF,ZERO;*43,IBCNMHOS
          READ      CONTROLF,TEN9;*212,CFEETYP
          READ      CONTROLF,THIRTY6;*86,HSYS1:
                                     *228,RCCNRCP2,*246,RCCNEGST
          READ      CONTROLF,HUND08;*1,HDATARCP
          READ      CONTROLF,HUNDRED2;*67,RSCNROD
.
          OPEN      FMSCHQA1,"fmschqaf"
          OPEN      PATCODE1,"patcodes"
          OPEN      PATCODE5,"patcodes"
          OPEN      DEBDBTA1,"debdbtaf"
          OPEN      PATMA1A1,"patma1af"
          OPEN      PATMX1A1,"patmx1af"
          OPEN      RCPBNKA1,"rcpbnkaf"
          OPEN      RCPBNKA3,"rcpbnkaf"
          OPEN      RCPBNKA4,"rcpbnkaf"
          OPEN      RCPBDTA1,"rcpbdtaf"
          OPEN      RCPBDTA2,"rcpbdtaf"
          OPEN      RCPDTEA1,"rcpdteaf"
          OPEN      RCPDTEA2,"rcpdteaf"
          OPEN      RCPCIDA1,"rcpcidaf"
          OPEN      RCPREGA1,"rcpregaf"
          OPEN      WEBSECA1,"websecaf"
          OPEN      PATHSPA1,"pathspaf"
.
          CLOCK     TIME,CTIMEIS
          MOVE      "WPC",KEY3
          IF        HSYS1=4
            MOVE      "CSH",KEY3            * G/L Comma delimited file
          ENDIF
          UNPACK    CTIMEIS,KEY2,KEY1,DIM2,DIM1,DIM2A
          PACK      KEY8,KEY2,DIM2,DIM2A,SP70
          REP       " 0",KEY8
          PACK      TXTFNAME,KEY3,CCC,CYY,CMM,CDD,KEY8,SP70
          REP       " 0",TXTFNAME
.
          CALL      TFILENAM                * Get temp file name
          MOVE      TFILNAME,FNAMEA
.
          CALL      TFILENAM                * Get temp file name
          MOVE      TFILNAME,FNAMEB
.
          CALL      TFILENAM                * Get temp file name
          MOVE      TFILNAME,FNAMEC
.
          CALL      TFILENAM                * Get temp file name
          MOVE      TFILNAME,FNAMED
.
          CALL      TFILENAM                * Get temp file name
          MOVE      TFILNAME,FNAMEE
.
          CALL      TFILENAM                * Get temp file name
          MOVE      TFILNAME,FNAMEF
.
          CALL      TFILENAM                * Get temp file name
          MOVE      TFILNAME,FNAMEG
.
          CALL      TFILENAM                * Get temp file name
          MOVE      TFILNAME,FNAMEH
.
          CALL      TFILENAM                * Get temp file name
          MOVE      TFILNAME,FNAMEI
.
          CALL      TFILENAM                * Get temp file name
          MOVE      TFILNAME,FNAMEJ
.
          CALL      TFILENAM                * Get temp file name
          MOVE      TFILNAME,FNAMEK
.
          CALL      TFILENAM                * Get temp file name
          MOVE      TFILNAME,FNAMEL
.
          CALL      TFILENAM                * Get temp file name
          MOVE      TFILNAME,FNAMEM
.
          CALL      TFILENAM                * Get temp file name
          MOVE      TFILNAME,FNAMEN
.
          CALL      TFILENAM                * Get temp file name
          MOVE      TFILNAME,FNAMEO
.
INIT9999  RETURN
+
.****************************************************************************
.*                                CRTX0000             Called by: ML0000    *
.* Create export file for excel                                             *
.****************************************************************************
CRTX0000  DISPLAY   *P1:15,"Create Export file for Excel : "
          KEYIN     *P32:15,*V2LON,*RV,DIM1:
                    *P32:15,*DV,DIM1
          REP       UPPLOW,DIM1
          DISPLAY   *P32:15,*V2LON,DIM1
          MOVE      ONE,EXPORTFL
          MATCH     "Y",DIM1
          GOTO      CRTX9999 IF EQUAL
.
          MOVE      ZERO,EXPORTFL
.
CRTX9999  RETURN
+
.******************************************************************************
.*                                  CRAT0000                                  *
.*        create and open temp file                      called by : PRREC000 *
.******************************************************************************
CRAT0000  CALL      KLAT0000                     * delete temp Adm Nos file
.
          CLEAR     CMDLINE
          APPEND    "isbuild ",CMDLINE
          APPEND    FNAMEA,CMDLINE
          APPEND    " 22 U1-6,7-18",CMDLINE
          RESET     CMDLINE
          EXECUTE   CMDLINE,TASKID
          OPEN      DRAWTMP1,FNAMEA
.
          CLEAR     CMDLINE
          APPEND    "isbuild ",CMDLINE
          APPEND    FNAMEB,CMDLINE
          APPEND    " 118 U1-6,7-9,10-21,22-29 U7-9,1-6,10-21,22-29",CMDLINE
          RESET     CMDLINE
          EXECUTE   CMDLINE,TASKID
          OPEN      DRAWTMP2,FNAMEB
          OPEN      DRAWTM12,FNAMEB
.
          CLEAR     CMDLINE
          APPEND    "isbuild ",CMDLINE
          APPEND    FNAMEC,CMDLINE
          APPEND    " 222 U1-6,19-33,218-218,34-35,7-18,36-43",CMDLINE
          RESET     CMDLINE
          EXECUTE   CMDLINE,TASKID
          OPEN      DRAWTMP3,FNAMEC
.
          CLEAR     CMDLINE
          APPEND    "isbuild ",CMDLINE
          APPEND    FNAMED,CMDLINE
          APPEND    " 19 U1-6,10-17,7-9",CMDLINE
          RESET     CMDLINE
          EXECUTE   CMDLINE,TASKID
          OPEN      DRAWTMP4,FNAMED
.
          CLEAR     CMDLINE
          APPEND    "isbuild ",CMDLINE
          APPEND    FNAMEL,CMDLINE
          APPEND    " 29 U1-6,10-17,7-9,18-19",CMDLINE
          RESET     CMDLINE
          EXECUTE   CMDLINE,TASKID
          OPEN      DRAWTM10,FNAMEL
.
          CLEAR     CMDLINE
          APPEND    "isbuild ",CMDLINE
          APPEND    FNAMEM,CMDLINE
          APPEND    " 6 U1-2,3-5",CMDLINE
          RESET     CMDLINE
          EXECUTE   CMDLINE,TASKID
          OPEN      DRAWTM11,FNAMEM
.
          CLEAR     CMDLINE
          APPEND    "isbuild ",CMDLINE
          APPEND    FNAMEE,CMDLINE
          APPEND    " 134 U1-6,7-9,30-41,10-21,22-29",CMDLINE
          RESET     CMDLINE
          EXECUTE   CMDLINE,TASKID
          OPEN      DRAWTMP5,FNAMEE 
.
          CLEAR     CMDLINE
          APPEND    "isbuild ",CMDLINE
          APPEND    FNAMEF,CMDLINE
          APPEND    " 222 U19-33,218-218,34-35,7-18,36-43,1-6",CMDLINE
          RESET     CMDLINE
          EXECUTE   CMDLINE,TASKID
          OPEN      DRAWTMP6,FNAMEF
.
          CLEAR     CMDLINE
          APPEND    "isbuild ",CMDLINE
          APPEND    FNAMEN,CMDLINE
          APPEND    " 23 U1-6,7-9,10-12 U7-9,10-12,1-6 U1-6,13-14,7-9,10-12",CMDLINE
          RESET     CMDLINE
          EXECUTE   CMDLINE,TASKID
          OPEN      CSVCTMP1,FNAMEN
          OPEN      CSVCTMP2,FNAMEN
          OPEN      CSVCTMP3,FNAMEN
.
          COMPARE   THREE,HSYS1
          GOTO      CRAT2000 IF EQUAL           * Integra Cash interface
          COMPARE   FIVE,HSYS1
          GOTO      CRAT2000 IF EQUAL           * Extended Integra interface
.
          COMPARE   FOUR,HSYS1
          GOTO      CRAT6000 IF NOT EQUAL       * Not a Comma delimited G/L file
.
CRAT2000  COMPARE   FIVE,COPTION
          GOTO      CRAT6000 IF NOT EQUAL       * Not printing Final Bank Dep.
.
          CLEAR     CMDLINE
          APPEND    "isbuild ",CMDLINE
          APPEND    FNAMEG,CMDLINE
          APPEND    " 188 U34-35,7-18",CMDLINE
          APPEND    SP70,CMDLINE
          RESET     CMDLINE
          EXECUTE   CMDLINE,TASKID
.
          CLEAR     CMDLINE
          APPEND    "isadd ",CMDLINE
          APPEND    FNAMEG,CMDLINE
          APPEND    " U7-18,34-35",CMDLINE
          APPEND    SP70,CMDLINE
          RESET     CMDLINE
          EXECUTE   CMDLINE,TASKID
.
          OPEN      DRAWTMP7,FNAMEG
          OPEN      DRAWTMP8,FNAMEG
.
          COMPARE   FIVE,HSYS1
          GOTO      CRAT4000 IF EQUAL           * Extended Integra interface
          COMPARE   THREE,HSYS1
          GOTO      CRAT6000 IF NOT EQUAL       * Not for Integra
.
CRAT4000  CLEAR     CMDLINE
          APPEND    "isbuild ",CMDLINE
          APPEND    FNAMEH,CMDLINE
          APPEND    " 157 U1-2,3-14,15-22",CMDLINE
          APPEND    SP70,CMDLINE
          RESET     CMDLINE
          EXECUTE   CMDLINE,TASKID
          OPEN      DRAWTMP9,FNAMEH
.
CRAT6000  CLEAR     CMDLINE
          APPEND    "isbuild ",CMDLINE
          APPEND    FNAMEI,CMDLINE
          APPEND    " 26 U1-6,7-7,8-10 U7-7,8-10,1-6",CMDLINE
          APPEND    SP70,CMDLINE
          RESET     CMDLINE
          EXECUTE   CMDLINE,TASKID
          OPEN      CREDFIL1,FNAMEI
          OPEN      CREDFIL2,FNAMEI
.
          CLEAR     CMDLINE
          APPEND    "isbuild ",CMDLINE
          APPEND    FNAMEJ,CMDLINE
          APPEND    " 26 U1-6,7-7,8-10 U7-7,8-10,1-6",CMDLINE
          APPEND    SP70,CMDLINE
          RESET     CMDLINE
          EXECUTE   CMDLINE,TASKID
          OPEN      EFTPFIL1,FNAMEJ
          OPEN      EFTPFIL2,FNAMEJ
.
          CLEAR     CMDLINE
          APPEND    "isbuild ",CMDLINE
          APPEND    FNAMEK,CMDLINE
          APPEND    " 24 U1-1,2-2,3-5",CMDLINE
          APPEND    SP70,CMDLINE
          RESET     CMDLINE
          EXECUTE   CMDLINE,TASKID
          OPEN      GNDTFIL1,FNAMEK
.
          PREP      CSVOFILE,FNAMEO
.
CRAT9999  RETURN
+
.******************************************************************************
.*                                  KLAT0000                                  *
.*        routine to delete temp Adm Nos file            called by : CRAT0000 *
.******************************************************************************
KLAT0000  CLOSE     DRAWTMP1
          CLOSE     DRAWTMP2
          CLOSE     DRAWTMP3
          CLOSE     DRAWTMP4
          CLOSE     DRAWTMP5
          CLOSE     DRAWTMP6
          CLOSE     DRAWTMP7
          CLOSE     DRAWTMP8
          CLOSE     DRAWTMP9
          CLOSE     DRAWTM10
          CLOSE     DRAWTM11
          CLOSE     DRAWTM12
.
          CLOSE     CSVOFILE,DELETE
          CLOSE     CSVCTMP1
          CLOSE     CSVCTMP2
          CLOSE     CSVCTMP3
.
          CLOSE     CREDFIL1
          CLOSE     CREDFIL2
          CLOSE     EFTPFIL1
          CLOSE     EFTPFIL2
          CLOSE     GNDTFIL1
.
          CLEAR     CMDLINE
          APPEND    "iserase ",CMDLINE
          APPEND    FNAMEA,CMDLINE
          RESET     CMDLINE
          EXECUTE   CMDLINE,TASKID
.
          CLEAR     CMDLINE
          APPEND    "iserase ",CMDLINE
          APPEND    FNAMEB,CMDLINE
          RESET     CMDLINE
          EXECUTE   CMDLINE,TASKID
.
          CLEAR     CMDLINE
          APPEND    "iserase ",CMDLINE
          APPEND    FNAMEC,CMDLINE
          RESET     CMDLINE
          EXECUTE   CMDLINE,TASKID
.
          CLEAR     CMDLINE
          APPEND    "iserase ",CMDLINE
          APPEND    FNAMED,CMDLINE
          RESET     CMDLINE
          EXECUTE   CMDLINE,TASKID
.
          CLEAR     CMDLINE
          APPEND    "iserase ",CMDLINE
          APPEND    FNAMEE,CMDLINE
          RESET     CMDLINE
          EXECUTE   CMDLINE,TASKID
.
          CLEAR     CMDLINE
          APPEND    "iserase ",CMDLINE
          APPEND    FNAMEF,CMDLINE
          RESET     CMDLINE
          EXECUTE   CMDLINE,TASKID
.
          CLEAR     CMDLINE
          APPEND    "iserase ",CMDLINE
          APPEND    FNAMEG,CMDLINE
          RESET     CMDLINE
          EXECUTE   CMDLINE,TASKID
.
          CLEAR     CMDLINE
          APPEND    "iserase ",CMDLINE
          APPEND    FNAMEH,CMDLINE
          RESET     CMDLINE
          EXECUTE   CMDLINE,TASKID
.
          CLEAR     CMDLINE
          APPEND    "iserase ",CMDLINE
          APPEND    FNAMEI,CMDLINE
          RESET     CMDLINE
          EXECUTE   CMDLINE,TASKID
.
          CLEAR     CMDLINE
          APPEND    "iserase ",CMDLINE
          APPEND    FNAMEJ,CMDLINE
          RESET     CMDLINE
          EXECUTE   CMDLINE,TASKID
.
          CLEAR     CMDLINE
          APPEND    "iserase ",CMDLINE
          APPEND    FNAMEK,CMDLINE
          RESET     CMDLINE
          EXECUTE   CMDLINE,TASKID
.
          CLEAR     CMDLINE
          APPEND    "iserase ",CMDLINE
          APPEND    FNAMEL,CMDLINE
          RESET     CMDLINE
          EXECUTE   CMDLINE,TASKID
.
          CLEAR     CMDLINE
          APPEND    "iserase ",CMDLINE
          APPEND    FNAMEM,CMDLINE
          RESET     CMDLINE
          EXECUTE   CMDLINE,TASKID
.
          CLEAR     CMDLINE
          APPEND    "iserase ",CMDLINE
          APPEND    FNAMEN,CMDLINE
          RESET     CMDLINE
          EXECUTE   CMDLINE,TASKID
.
KLAT9999  RETURN
+
.****************************************************************************
.*                                RECN0000             Called by: ML0000    *
.*                        Bank Reconciliation/listing                       *
.****************************************************************************
RECN0000  LOAD      CPHDROP1,COPTION,TITLOPT1,TITLOPT2,TITLOPT3,TITLOPT4:
                                     TITLOPT5,TITLOPT6,TITLOPT7,TITLOPT8:
                                     TITLOPT9,TITLOP10
          MOVE      SP70,CPHDROP2
          MOVE      ZERO,SUMMFLAG      * Default to No Summary report
          MOVE      ZERO,SPAGFLAG      * Default to No Separatepage for each reg
          MOVE      ZERO,CRECFLAG      * Default to No Printing cancelled rec
.
          CALL      CDRF0000           * enter from cash drawer
          BRANCH    EXIT,RECN9999
.
          CALL      CDRT0000           * enter to cash drawer
          BRANCH    EXIT,RECN9999
.
          IF        COPTION = 7 | COPTION = 8 | COPTION=9 | COPTION =10
            CALL      REGFT000              * get Registers - from/to
            CALL      DATFT000              * get Rec. Date - from/to
            MOVE      "10",CVERT
          ELSE
            IF        COPTION=4 | COPTION=5 | COPTION=6
              CALL      KSUM0000            * Keyin summary option
            ENDIF
.
            MOVE      SP3,REGFROM
            PACK      REGTOTO,Z70
            DISPLAY   *P1:6,"Reconciliation Date :"
            MOVE      CDD,CDAY
            MOVE      CMM,CMON
            MOVE      CYY,CYEAR
            MOVE      CCC,CCENT
            MOVE      TWENTY3,CCOL
            MOVE      SIX,CVERT
            CALL      KEYDATE            * enter reconciliation date
            PACK      RECDATE,CCENT,CYEAR,CMON,CDAY
            CALL      PACDATE               * set up the Display date
            MOVE      CPCDATE,DISPLDTE
            MOVE      "7",CVERT
          ENDIF
.
          MOVE      ZERO,CSVFLAG
          IF        COPTION=1 | COPTION=2 | COPTION=3
            KEYIN     *P1:CVERT,"Generate Additional CSV output (Y/N) : ":
                      *P40:CVERT,*V2LON,ANS
            REP       "Y1y1",ANS
            MATCH     "1",ANS
            IF        @EQUAL
              MOVE      ONE,CSVFLAG        * Generate CSV output
              DISPLAY   *P40:CVERT,*V2LON,"Yes";
              CALL      CSVF0000           * Setup CSV file name
            ELSE
              DISPLAY   *P40:CVERT,*V2LON,"No";
            ENDIF
            ADD       ONE,CVERT
          ENDIF
.
          KEYIN     *P1:CVERT,*EF,*P1:CVERT,"WEB User ID: ",*V2LON,USERID
          PACK      KEY10,USERID,SP70
          CALL      RDWBSE1
          BRANCH    OVRCD,RECN9000
.
.         Lock Final Cash reconciliation
.
          IF        COPTION=2
            MOVE      PORT,RCCNRCNL
            PACK      RCCNRCNW,USERID,SP10
            WRITAB    CONTROLF,HUND08;*112,RCCNRCNL,*114,RCCNRCNW
          ENDIF
.                                                                     *I-233235
          IF        COPTION=4 | COPTION=5 | COPTION=6
            CALL      NOPAG000              * keyin "Remove Page Breaks"
          ENDIF
.
          IF        COPTION = 7 | COPTION=9
            CALL      SEPAG000              * Separate page for each register
          ENDIF
.
          IF        COPTION = 8 | COPTION=10
            CALL      CRTX0000              * Create Export File for Excel
          ENDIF
.
          PERFORM   COPTION,PRREC000,PRREC000,PRREC000:  * optns 1-3
                            DEPS0000,DEPS0000,DEPS0000:  * optns 4-6
                            RCREG000,RCREG000,RCREG000:  * optn  7,8,9
                            RCREG000
.
          IF        COPTION=1 | COPTION=2 | COPTION=3
            CALL      CCSV0000               * Copy .txt to .csv
          ENDIF
.
          MOVE      ZERO,EXIT
          GOTO      RECN9999
.
RECN9000 DISPLAY    *P1:24,"Invalid User ID";
         CALL       HITENTER
         MOVE       ONE,EXIT
.
RECN9999 RETURN
+
.****************************************************************************
.                                 CSVF0000                                  *
.                       Set up CSV file name                                *
.****************************************************************************
CSVF0000  MOVE      SPLFILE,CSVFNAME
.
CSVF9999  RETURN
+
.****************************************************************************
.                                 KSUM0000                                  *
.                         Keyin Summary Option                              *
.****************************************************************************
KSUM0000  MOVE      SP70,ANS
          KEYIN     *P1:5,"Summary Only    : ",*V2LON,ANS
          REP       "yY",ANS
          MATCH     "Y",ANS
          GOTO      KSUM9999 IF NOT EQUAL
.
          MOVE      ONE,SUMMFLAG
KSUM9999  RETURN
+
.****************************************************************************
.                                 SEPAG000                                  *
.                         Keyin Separate page option for each register      *
.****************************************************************************
SEPAG000  MOVE      SP70,ANS
          KEYIN     *P1:11,"Separate Page for each Register  : ",*V2LON,ANS
          REP       "yY",ANS
          MATCH     "Y",ANS
          GOTO      SEPAG999 IF NOT EQUAL
          MOVE      ONE,SPAGFLAG
SEPAG999  RETURN
+
.****************************************************************************
.                                 NOPAG000                        *I-233235 *
.                     Keyin "Remove Page Breaks" option for summary         *
.****************************************************************************
NOPAG000  MOVE      SP70,ANS
          MOVE      ZERO,NOPGOFLO
          MOVE      ZERO,HDBYPASS
          KEYIN     *P1:8,"Remove Page Breaks  : ",*V2LON,ANS
          REP       "y1Y1",ANS
          MATCH     "1",ANS
          GOTO      NOPAG999 IF NOT EQUAL
          MOVE      ONE,NOPGOFLO
NOPAG999  RETURN
+
.****************************************************************************
.*                                DEPSC000             Called by: RECN00000 *
.*                        Print deposit listing                             *
.****************************************************************************
DEPS0000  CALL      CRAT0000                     * create tempfiles
.
          CALL      WRLIS000                     * write receipts to tempfile
.                                                * for bank listing
          CALL      PRLIS000                   * print listing
.
          IF        CFEETYP=5
            CALL      PRCOM000                   * print Commission Card
          ENDIF
.
          COMPARE   FIVE,COPTION
          GOTO      DEPS9999 IF NOT EQUAL
.
.         HSYS1 =3 Integra, HSYS1= 4 Comma delimited, HSYS1=5 Extended Integra
.
          BRANCH    HSYS1,DEPS9999,DEPS9999,DEPS2000,DEPS3000,DEPS2000
          GOTO      DEPS9999
.
DEPS2000  CALL      STRN0000                   * Sort the transaction line
          CALL      CSIN0000                   * Integra Cash Interface
          GOTO      DEPS9999
.
DEPS3000  CALL      WGIN0000                   * Write to ibaginaf file
.
DEPS9999 RETURN
+
.****************************************************************************
.*                                CDRF0000             Called by: RECN00000 *
.*                        Key in cash drawer from                           *
.****************************************************************************
CDRF0000  KEYIN     *P1:3,*EF,*P1:3,"Cash Drawer From: ",*V2LON,DRAWERF
.
          ENDSET    DRAWERF
          APPEND    SP6,DRAWERF
          RESET     DRAWERF
.
          MATCH     SP6,DRAWERF
          GOTO      CDRF9000 IF EQUAL
.
          MOVE      DRAWERF,KEY6
          CALL      RDCIDA1
          BRANCH    OVRCD,CDRF1000
          GOTO      CDRF9000
.
CDRF1000  DISPLAY   *P1:24,"Invalid Cash Drawer";
          CALL      HITENTER
          MOVE      ONE,EXIT
          GOTO      CDRF9999
.
CDRF9000  MOVE      ZERO,EXIT
.
CDRF9999  RETURN
+
.****************************************************************************
.*                                CDRT0000             Called by: RECN00000 *
.*                        Key in cash drawer to                             *
.****************************************************************************
CDRT0000  KEYIN     *P1:4,"Cash Drawer To: ",*V2LON,DRAWERT
.
          ENDSET    DRAWERT
          APPEND    SP6,DRAWERT
          RESET     DRAWERT
.
          MATCH     SP6,DRAWERT
          IF        @EQUAL
            PACK      DRAWERT,Z70
            GOTO      CDRT9000
          ENDIF
.
          MOVE      DRAWERT,KEY6
          CALL      RDCIDA1
          BRANCH    OVRCD,CDRT1000
          MATCH     DRAWERF,DRAWERT
          GOTO      CDRT2000 IF LESS
          GOTO      CDRT9000
.
CDRT1000  DISPLAY   *P1:24,"Invalid Cash Drawer";
          CALL      HITENTER
          MOVE      ONE,EXIT
          GOTO      CDRT9999
.
CDRT2000  DISPLAY   *P1:24,"Cash Drawer from must be less than Cash Drawer to";
          CALL      HITENTER
          MOVE      ONE,EXIT
          GOTO      CDRT9999
.
CDRT9000  MOVE      ZERO,EXIT
.
CDRT9999  RETURN
+
.****************************************************************************
.*                                REGFT000             Called by: RECN00000 *
.*                        Key in register from/to                           *
.****************************************************************************
REGFT000  MOVE      ZERO,EXIT
          KEYIN     *P1:6,"Register  - From: ",*V2LON,REGFROM
.
          ENDSET    REGFROM
          APPEND    SP3,REGFROM
          RESET     REGFROM
.
          MATCH     SP3,REGFROM
          GOTO      REGFT200 IF EQUAL
.
          PACK      KEY3,REGFROM,SP3
          CALL      RDREGA1
          IF        OVRCD=1
            MOVE      "Invalid Register    ",DESCREG
          ELSE
            PACK      DESCREG,REGDESC,SP70
          ENDIF
          DISPLAY   *P24:6,DESCREG
.
.
REGFT200  KEYIN     *P11:7,"- To  : ",*V2LON,REGTOTO
.
          ENDSET    REGTOTO
          APPEND    SP3,REGTOTO
          RESET     REGTOTO
.
          MATCH     SP3,REGTOTO
          GOTO      REGFT800 IF EQUAL
.
          PACK      KEY3,REGTOTO,SP3
          CALL      RDREGA1
          IF        OVRCD=1
            MOVE      "Invalid Register    ",DESCREG
          ELSE
            PACK      DESCREG,REGDESC,SP70
          ENDIF
          DISPLAY   *P24:7,DESCREG
.
.
          MATCH     REGFROM,REGTOTO
          GOTO      REGFT300 IF LESS
          GOTO      REGFT999
.
.
REGFT300  DISPLAY   *P1:24,"Register from must be less than Register to";
          CALL      HITENTER
          MOVE      ONE,EXIT
.
.
REGFT800  PACK      REGTOTO,Z70
.
REGFT999  RETURN
+
.****************************************************************************
.*                                DATFT000             Called by: RECN00000 *
.*                  Key in reconciliation date from/to                      *
.****************************************************************************
DATFT000 
          IF        COPTION=9 | COPTION=10
            DISPLAY   *P1:8,"Released Date From :"
          ELSE
            DISPLAY   *P1:8,"Reconciliation Date From :"
          ENDIF
          MOVE      CDD,CDAY
          MOVE      CMM,CMON
          MOVE      CYY,CYEAR
          MOVE      CCC,CCENT
          MOVE      TWENTY8,CCOL
          MOVE      EIGHT,CVERT
          CALL      KEYDATE                 * enter reconciliation date
          PACK      RECDATE,CCENT,CYEAR,CMON,CDAY
          CALL      PACDATE                 * set up the Display date
          MOVE      CPCDATE,DISPLDTE
.
          DISPLAY   *P21:9,"To   :"
          MOVE      CDD,CDAY
          MOVE      CMM,CMON
          MOVE      CYY,CYEAR
          MOVE      CCC,CCENT
          MOVE      TWENTY8,CCOL
          MOVE      NINE,CVERT
          CALL      KEYDATE                 * enter reconciliation date
          PACK      RECDATTO,CCENT,CYEAR,CMON,CDAY
          CALL      PACDATE                 * set up the Display date
          MOVE      CPCDATE,DISPLDT2
.
DATFT999  RETURN
+
.****************************************************************************
.*                                PRREC000             Called by: RECN00000 *
.*                        Print reconciliation                              *
.****************************************************************************
PRREC000  CALL      CRAT0000                     * create tempfiles
          CALL      WRREC000                     * write receipts to tempfile
.                                                * for cash reconciliation
.
          CALL      WRSYS000                     * write receipts to tempfile
.                                                * for system reconciliation
.
          CALL      PRCRE000                     * print cash reconciliation
          CALL      PRCSV000                     * process CSV cash recon.
.
          CALL      PRSYS000                     * print system reconciliation
.
.         Print cancelled receipts and Update the reconciliation date/time
.
          IF        COPTION=2
            CALL      PCAN0000             * load Cancelled receipts
            MOVE      "1",RCCNRCP2
            MOVE      ONE,CRECFLAG         * Flag printing cancelled receipts
            CALL      PRSYS000             * print Cancelled receipts
          ENDIF
.
PRREC999  RETURN
+
.****************************************************************************
.*                                RCREG000             Called by: RECN0000  *
.*                        Write Receipt records to tempfile                 *
.****************************************************************************
.                                                * Options 7 and 8 
RCREG000  CALL      CRAT0000                     * create tempfiles
.
          COMPARE   NINE,COPTION
          GOTO      RCREG100 IF EQUAL
          COMPARE   TEN,COPTION
          GOTO      RCREG200 IF NOT EQUAL
.
.                                           * Options 9 and 10
RCREG100  CALL      WRDAT000                   * write receipts by rel.date
          COMPARE   "9",COPTION
          IF        @EQUAL
.
            CALL      PRSYS000                   * print system reconciliation
          ELSE
            CALL      SUMREC00
          ENDIF
          GOTO      RCREG999
.
.                                           * Options 7 and 8
RCREG200  CALL      WRSYS000                   * write TMP2 for system rec.
          COMPARE   "7",COPTION
          IF        @EQUAL
            CALL      PRSYS000                   * print system reconciliation
          ELSE
            CALL      SUMREC00
          ENDIF
.
RCREG999  RETURN
+
.****************************************************************************
.*                                WRDAT000             Called by: PRREC000  *
.*                 Write relased cash to tempfile                           *
.****************************************************************************
WRDAT000  MOVE      ZERO,COUNT
          MOVE      ZERO,OTCOLNUM
.
          PACK      KEY25,RECDATE,SP70
          CALL      RSRCDTE2
WRDAT100  CALL      RKRCDTE2
          BRANCH    OVRCD,WRDAT999
.
          MATCH     RCDTRELD,RECDATTO    * check Released date within date range
          GOTO      WRDAT999 IF LESS
.
          PACK      DIM20,RCDTRELD,RCDTRECN,SP70
          UNPACK    DIM20,SAVRDATE
.
          MOVE      RCDTRECN,KEY12
          CALL      RDRCBNK1
          BRANCH    OVRCD,WRDAT800
.
          IF        IBCNMHOS=1
            PACK      KEY6,RCBNCDRW,SP70
            CALL      RDCIDA1
            BRANCH    OVRCD,WRDAT800
            MATCH     RCCIHOSP,WBSEHOSP
            GOTO      WRDAT800 IF NOT EQUAL        * different hospital
          ENDIF
.
          MATCH     DRAWERF,RCBNCDRW      * check within Drawer range
          GOTO      WRDAT100 IF LESS
          MATCH     RCBNCDRW,DRAWERT
          GOTO      WRDAT800 IF LESS
.
          IF        COPTION = 10
            CALL      WROP8000            * write Option10 tempfile
            GOTO      WRDAT800
          ENDIF
.
.         Get all records for the same receipt and released date
.
          PACK      KEY17,RCBNRECN,SP70
          CALL      RSRCDTE1
WRDAT500  CALL      RKRCDTE1
          BRANCH    OVRCD,WRDAT800
.
          MATCH     RCDTRECN,RCBNRECN
          GOTO      WRDAT800 IF NOT EQUAL
.
          MATCH     RCDTRELD,SAVRDATE
          GOTO      WRDAT500 IF NOT EQUAL * different Release date
.
          MATCH     RECDATE,RCDTRELD
          GOTO      WRDAT500 IF LESS
          MATCH     RCDTRELD,RECDATTO     * check Reconcil. within date range
          GOTO      WRDAT500 IF LESS
.
          MATCH     REGFROM,RCDTREGI      * select Register range
          GOTO      WRDAT500 IF LESS
          MATCH     RCDTREGI,REGTOTO
          GOTO      WRDAT500 IF LESS
.
WRDAT600  ADD       ONE,COUNT
          MOVE      COUNT,COUNTREC
.
          MATCH     "1",RCCNRCP2
          IF        @EQUAL
            PACK      KEY41,RCBNCDRW,RCDTREGI,RCDTRECN,RCDTINVN,COUNTREC,SP70
            CALL      RDDRTMP5
          ELSE
            PACK      KEY29,RCBNCDRW,RCDTREGI,RCDTINVN,COUNTREC,SP70
            CALL      RDDRTMP2
          ENDIF
.
          IF        OVRCD=0
            GOTO      WRDAT500
          ENDIF
.
          MOVE      RCBNCDRW,DRAWERID
          MOVE      RCDTREGI,REGISTER                                  *I-59171
          MOVE      RCDTRECN,RECEIPTN
          MOVE      RCDTAMNT,INAMOUNT
          MOVE      RCDTDISC,DSAMOUNT
          MOVE      RCDTVIST,VISNUMB
          MOVE      RCDTURNO,URNUMB
          MOVE      RCDTSFLG,SCFLAG
          MOVE      RCDTNAME,PNAME
          MOVE      RCDTREFR,REFERENC
          MOVE      RCDTINVN,INVOICEN
.                                           * identify any Allocations from Sus-
.                                           * pense (Opn 9 & 10)      *I-233901
          MOVE      SP8,ALOCDATE
          MOVE      ZERO,ALOCAMNT
          IF        COPTION = 9
            MATCH     SP8,RCDTSPUI
            IF        !@EQUAL
              MOVE      RCDTSPUI,ALOCDATE
              MOVE      RCDTAMNT,ALOCAMNT
            ENDIF  
          ENDIF  
.
          MATCH     "1",RCCNRCP2
          IF        @EQUAL
            PACK      KEY41,RCBNCDRW,RCDTREGI,RCDTRECN,RCDTINVN,COUNT,SP70
            CALL      WRDRTMP5
          ELSE
            PACK      KEY29,RCBNCDRW,RCDTREGI,RCDTINVN,COUNT,SP70
            CALL      WRDRTMP2
          ENDIF
.
          GOTO      WRDAT500
.
WRDAT800  PACK      KEY25,DIM20,Z70
          CALL      RSRCDTE2
          GOTO      WRDAT100
.
WRDAT999  RETURN
+
.****************************************************************************
.*                                WRREC000             Called by: PRREC000  *
.*                        Write records to tempfile                         *
.****************************************************************************
WRREC000  PACK      KEY26,SP8,DRAWERF,SP70
          IF        COPTION = 3
            PACK      KEY26,RECDATE,DRAWERF,SP70
          ENDIF 
          CALL      RSRCBNK3
WRREC100  CALL      RKRCBNK3
          BRANCH    OVRCD,WRREC999
.
          MATCH     "1",RCBNSTAT            * skip Cancelled receipts
          GOTO      WRREC100 IF EQUAL
.
.         Only includes receipt up to the reconciliation date
.
          MATCH     RCBNTDAT,RECDATE
          GOTO      WRREC100 IF LESS
.
          IF        COPTION = 3
            MATCH     RECDATE,RCBNRDAT
            GOTO      WRREC999 IF NOT EQUAL
          ELSE
            MATCH     SP70,RCBNRDAT
            GOTO      WRREC999 IF NOT EQUAL
          ENDIF
.
          MATCH     RCBNCDRW,DRAWERT
          GOTO      WRREC999 IF LESS
.
          IF        IBCNMHOS=1
            PACK      KEY6,RCBNCDRW,SP70
            CALL      RDCIDA1
            BRANCH    OVRCD,WRREC100
            MATCH     RCCIHOSP,WBSEHOSP
            GOTO      WRREC100 IF NOT EQUAL        * different hospital
          ENDIF
.
          PACK      KEY18,RCBNCDRW,RCBNRECN,SP70
          CALL      RDDRTMP1
          IF        OVRCD=0
            GOTO      WRREC100
          ENDIF
.
          PACK      KEY18,RCBNCDRW,RCBNRECN,SP70
          CALL      WRDRTMP1
          GOTO      WRREC100
.
WRREC999  RETURN
+
.****************************************************************************
.*                                WRLIS000             Called by: PRREC000  *
.*               Write records to tempfile for bank listing                 *
.****************************************************************************
WRLIS000  MOVE      ZERO,MAXHREC
          MOVE      ZERO,F2
.
          REPEAT
            ADD       ONE,F2
            MOVE      ZERO,LODGHREC[F2]
            MOVE      ZERO,LODGSREC[F2]
          UNTIL     F2=98
.
          MOVE      ZERO,ITOTLREC           * number of Lodgement header record
          MOVE      ZERO,COUNT 
          PACK      KEY34,SP8,SP8,DRAWERF,SP70
          IF        COPTION=6
            PACK      KEY34,RECDATE,SP8,DRAWERF,SP70
          ENDIF
          CALL      RSRCBNK4
WRLIS100  CALL      RKRCBNK4
          BRANCH    OVRCD,WRLIS999
.
          MATCH     "1",RCBNSTAT            * skip Cancelled receipts
          GOTO      WRLIS100 IF EQUAL
.
          IF        COPTION=6
            MATCH     RECDATE,RCBNBDAT
            GOTO      WRLIS999 IF NOT EQUAL
          ELSE
            MATCH     SP70,RCBNBDAT
            GOTO      WRLIS999 IF NOT EQUAL
          ENDIF
.
          MATCH     SP70,RCBNRDAT          * not reconciled
          GOTO      WRLIS100 IF EQUAL
.
          MATCH     RCBNRDAT,RECDATE
          GOTO      WRLIS100 IF LESS       * skip
.
          MATCH     DRAWERF,RCBNCDRW
          GOTO      WRLIS100 IF LESS
.
          MATCH     RCBNCDRW,DRAWERT
          GOTO      WRLIS100 IF LESS
.
          IF        IBCNMHOS=1
            PACK      KEY6,RCBNCDRW,SP70
            CALL      RDCIDA1
            BRANCH    OVRCD,WRLIS100
            MATCH     RCCIHOSP,WBSEHOSP
            GOTO      WRLIS100 IF NOT EQUAL        * different hospital
          ENDIF
.
          MOVE      ZERO,GSTAMNT
          MOVE      RCBNRECN,RCBDRECN
          CALL      CGST0000                  * Check for GST (Register Sys=92)
          MOVE      FORM12P2,GSTAMNT
          PACK      KEY15,RCBNRECN,SP70
          CALL      RSRCBDT1
WRLIS200  CALL      RKRCBDT1
          BRANCH    OVRCD,WRLIS100
.
          MATCH     RCBDRECN,RCBNRECN
          GOTO      WRLIS100 IF NOT EQUAL
.
          ADD       ONE,COUNT
          MOVE      COUNT,COUNTREC
          PACK      DRAWERID,RCBNCDRW,SP70
          PACK      RECEIPTN,RCBNRECN,SP70
          PACK      CHQACCNT,RCBNCHQA,SP70
.
          MOVE      " 1",PAYMTYPE
          MOVE      "A",PRNTORD        * default to Cash
          PACK      KEY5,CODEPY,RCBDPCOD
          CALL      RDCODE1
          IF        OVRCD=0
            UNPACK    THCSCOD,PRNTORD    * Print order
            SQUEEZE   PTCDNHCP
            MOVE      ZERO,F2
            MOVE      PTCDNHCP,F2
            MOVE      F2,PAYMTYPE
          ENDIF
.
          PACK      CHQNUMB,RCBDCHQN,SP70
          PACK      CHQDRAW,RCBDDRAW,SP70
          PACK      CHQBANK,RCBDBANK,SP70
          PACK      CHQBRNCH,RCBDBRCH,SP70
          MOVE      RCBDPAMT,CHQAMNT
          MOVE      RCBDSTRF,DDREFER
          MOVE      RCBDPAYD,PAYEE
          MOVE      RCBDEFTT,EFTTYPE
          MOVE      RCBDCRDT,CARDTYPE
          MOVE      RCBDPCOD,PAYMCODE
.
          MOVE      SP70,IPAYTYPE
          MOVE      ZERO,FPAYTYPE
          IF        (HSYS1=3 | HSYS1=4 | HSYS1=5) & COPTION=5
            IF        HSYS1=5
              CALL      INEXT000      * Group payment type for Extended Integra 
            ELSE
              CALL      INTEP000      * Group payment type for Integra Interface
            ENDIF
.
            MOVE      ZERO,GSTAMNT
            MOVE      FPAYTYPE,IPAYTYPE
            PACK      KEY14,IPAYTYPE,RCBNRECN,SP70
            CALL      RDDRTMP7
            IF        OVRCD=1
              MOVE      RCBDPAMT,PAYMAMNT
              CALL      WRDRTMP7
            ELSE
              ADD       RCBDPAMT,PAYMAMNT
              CALL      UPDRTMP7
            ENDIF
          ENDIF
.
          BRANCH    SUMMFLAG,WRLIS6000
.
          PACK      KEY43,RCBNCDRW,RCBNCHQA,PRNTORD,RCBDPTYP,RCBNRECN,COUNTREC:
                          SP70
          CALL      RDDRTMP3
          IF        OVRCD=0
            GOTO      WRLIS200
          ENDIF
          CALL      WRDRTMP3
          GOTO      WRLIS200
.
WRLIS6000 PACK      KEY43,RCBNCHQA,PRNTORD,RCBDPTYP,RCBNRECN,COUNTREC:
                          RCBNCDRW,SP70
          CALL      RDDRTMP6
          IF        OVRCD=0
            GOTO      WRLIS200
          ENDIF
          CALL      WRDRTMP6
          GOTO      WRLIS200
.
WRLIS999  RETURN
+
.****************************************************************************
.*                                PRLIS000             Called by: DEPS0000  *
.*                        Process tempfile records                          *
.****************************************************************************
PRLIS000  MOVE      ZERO,CLNO
          MOVE      ONE,NPAGFLAG
          MOVE      ZERO,TOTCASH
          MOVE      ZERO,TOTCHQ
          MOVE      ZERO,TOTCRED
          MOVE      ZERO,TOTDDBT
          MOVE      ZERO,TOTMONOR
          MOVE      ZERO,TOTBPAY
          MOVE      ZERO,TOTHCAPS
          MOVE      ZERO,TOTMDCAR
          MOVE      ZERO,TOTEFTCR                                     *I-230977
          MOVE      ZERO,TOTEFTDB                                     *I-230977
          MOVE      ZERO,TOTTOTAL
          MOVE      ONE,F2
          WHILE     F2<99
            MOVE      ZERO,TOTPAYMN[F2]
            ADD       ONE,F2
          DO
. 
          MOVE      ZERO,PAYMINDC
          MOVE      SP70,SAVDRAWR
          MOVE      SP70,SAVCHQAC
          MOVE      SP70,SAVPMTYP
          MOVE      SP70,PRINTBD
          UNPACK    SP70,PREVDRID,PREVCHQN                            *I-233235
          MOVE      ZERO,HDBYPASS
          MOVE      ZERO,NEWGRP
          MOVE      ZERO,NEWPTYP
          MOVE      ZERO,RECFLAG
          PACK      KEY43,SP70
          IF        SUMMFLAG=1
            CALL      RSDRTMP6
          ELSE
            CALL      RSDRTMP3
          ENDIF
PRLIS100  IF        SUMMFLAG=1
            CALL      RKDRTMP6
          ELSE
            CALL      RKDRTMP3
          ENDIF
          IF        OVRCD=1
            CALL      PTOT0000               * Print Total
            MOVE      ONE,NEWGRP
            GOTO      PRLIS900
          ENDIF
          MOVE      ONE,RECFLAG
.
          IF        SUMMFLAG<>1
            MATCH     SAVDRAWR,DRAWERID
            IF        !@EQUAL
              MOVE      ONE,NEWGRP
              GOTO      PRLIS150
            ENDIF
          ENDIF
.
          MATCH     SAVCHQAC,CHQACCNT
          IF        !@EQUAL
            MOVE      ONE,NEWGRP
            GOTO      PRLIS150
          ENDIF
.
          MATCH     PAYMTYPE,SAVPMTYP
          IF        !@EQUAL
            MOVE      ONE,NEWPTYP
            GOTO      PRLIS150
          ENDIF
          GOTO      PRLIS200
.
PRLIS150  CALL      PTOT0000               * Print Total
          CALL      NEWPAG00
.
PRLIS200  MOVE      SP70,PAYTYPE
          MOVE      PAYMTYPE,F2
          CALL      RDPCOD00             * read payment type
.
          IF        F2=2
            PRINT     *1,CHQNUMB,*20,CHQDRAW,*45,CHQBANK,*80,CHQBRNCH:
                      *117,CHQAMNT
          ENDIF
          IF        F2=3
            PACK      KEY5,ANSC,ANSR,CARDTYPE,SP70
            CALL      RDCODE1
            IF        OVRCD=1
              MOVE      "Invalid Code",TDESC
            ENDIF
            PRINT     *1,TDESC,*40,PAYEE,*110,CHQAMNT
          ENDIF
          IF        F2=4 | F2=7 | F2=8 | F2=9
            UNPACK    PAYEE,KEY35
            PRINT     *1,DDREFER,*40,KEY35,*80,CHQAMNT
          ENDIF
          IF        F2=6
            PACK      EFTDESC,SP70 
            MATCH     "1",EFTTYPE
            IF        @EQUAL
              MOVE      "Chq/Savings",KEY11
              PACK      EFTDESC,KEY11,SP70
            ELSE
              MOVE      "Credit",KEY7
              PACK      EFTDESC,KEY7,SP70
              PACK      KEY5,ANSC,ANSR,CARDTYPE,SP70
              CALL      RDCODE1
              IF        OVRCD=0
                MOVE      "Credit-",KEY7
                PACK      EFTDESC,KEY7,TDESC,SP70
              ENDIF
            ENDIF
            UNPACK    PAYEE,KEY28
            PRINT     *1,DDREFER,*30,EFTDESC,*80,KEY28,*110,CHQAMNT
          ENDIF
.
          IF        F2>9
.           PRINT     *1,TDESC,*40,PAYEE,*110,CHQAMNT
            PRINT     *40,PAYEE,*110,CHQAMNT
          ENDIF
.
          ADD       ONE,CLNO
          COMPARE   "55",CLNO
          CALL      HEADX000 IF NOT LESS
.
          MOVE      ONE,PRINTBD
          BRANCH    F2,PRLIS300,PRLIS310,PRLIS320,PRLIS330,PRLIS340,PRLIS350:
                       PRLIS360,PRLIS370,PRLIS380
          SUB       NINE,F2
          COMPARE   ZERO,F2
          GOTO      PRLIS400 IF LESS
.
          ADD       CHQAMNT,TOTPAYMN[F2]
          ADD       CHQAMNT,TTOTPYMN[F2]
          ADD       CHQAMNT,TOTTOTAL
          GOTO      PRLIS400
.
PRLIS300  ADD       CHQAMNT,TOTCASH
          ADD       CHQAMNT,TTOTCASH
          ADD       CHQAMNT,TOTTOTAL
          GOTO      PRLIS400
.
PRLIS310  ADD       CHQAMNT,TOTCHQ
          ADD       CHQAMNT,TOTTOTAL
          GOTO      PRLIS400
.
PRLIS320  ADD       CHQAMNT,TOTCRED
          ADD       CHQAMNT,TOTTOTAL
          GOTO      PRLIS400
.
PRLIS330  ADD       CHQAMNT,TOTDDBT
          ADD       CHQAMNT,TOTTOTAL
          GOTO      PRLIS400
.
PRLIS340  ADD       CHQAMNT,TOTMONOR
          ADD       CHQAMNT,TOTTOTAL
          GOTO      PRLIS400
.
PRLIS350  MATCH     "1",EFTTYPE             * (1=Cash, 2=Credit Card) *C-230977
          IF        !@EQUAL
            ADD       CHQAMNT,TOTEFTCR
          ELSE  
            ADD       CHQAMNT,TOTEFTDB
          ENDIF                                                * end  *C-230977
          ADD       CHQAMNT,TOTTOTAL
          GOTO      PRLIS400
.
PRLIS360  ADD       CHQAMNT,TOTBPAY
          ADD       CHQAMNT,TOTTOTAL
          GOTO      PRLIS400
.
PRLIS370  ADD       CHQAMNT,TOTHCAPS
          ADD       CHQAMNT,TOTTOTAL
          GOTO      PRLIS400
.
PRLIS380  ADD       CHQAMNT,TOTMDCAR
          ADD       CHQAMNT,TOTTOTAL
          GOTO      PRLIS400
.
PRLIS400  IF        COPTION=5
            PACK      KEY12,RECEIPTN,SP70
            CALL      RDRCBNK1
            IF        OVRCD=0
              MOVE      RECDATE,RCBNBDAT
              MOVE      CTIMEIS,RCBNBTIM
              MOVE      "2",RCBNSTAT
              CALL      UPRCBNK1
            ENDIF
          ENDIF
.
          GOTO      PRLIS100
.
PRLIS900  CALL      LISTOT00
.
          IF        HDBYPASS = 1
            PRINT     *1,"-------------------------------------------------":
                         "-------------------------------------------------":
                         "----------------------------------",*N
          ENDIF
.
          CALL      PRTOT000               * print total for each drawer/chq ac
.
          IF        RECFLAG=0
            IF        COPTION=4 | COPTION=5
              PRINT     *1,"** No Final Cash Reconciliation ** "
.
              COMPARE   FIVE,COPTION
              GOTO      PRLIS9999 IF NOT EQUAL
              CALL      SUSA0000           * Check for Suspense Allocation
              BRANCH    EXIT,PRLIS999
            ENDIF
          ENDIF
.
          IF        COPTION=5
            CALL      RUNREL00             * run cash release
          ENDIF
PRLIS999  RETURN
+
.****************************************************************************
.         Check for Suspense allocation
.****************************************************************************
SUSA0000  MOVE      ONE,EXIT
          PACK      KEY25,SP70
          CALL      RSRCDTE2
SUSA1000  CALL      RKRCDTE2
          BRANCH    OVRCD,SUSA9999
.
          MATCH     SP70,RCDTRELD        * released ?
          GOTO      SUSA9999 IF NOT EQUAL
.
          PACK      KEY12,RCDTRECN,SP70
          CALL      RDRCBNK1
          BRANCH    OVRCD,SUSA1000
.
          MATCH     "2",RCBNSTAT          * check receipt status
          GOTO      SUSA1000 IF NOT EQUAL
.
          IF        IBCNMHOS=1
            PACK      KEY6,RCBNCDRW,SP70
            CALL      RDCIDA1
            BRANCH    OVRCD,SUSA1000
            MATCH     RCCIHOSP,WBSEHOSP
            GOTO      SUSA1000 IF NOT EQUAL        * different hospital
          ENDIF
.
          MATCH     SP70,RCBNBDAT
          GOTO      SUSA1000 IF EQUAL
.
          MATCH     RECDATE,RCDTTDAT
          GOTO      SUSA2000 IF EQUAL
          GOTO      SUSA2000 IF LESS
.
          GOTO      SUSA1000
.
SUSA2000  MATCH     DRAWERF,RCBNCDRW      * check drawer
          GOTO      SUSA1000 IF LESS
.
          MATCH     RCBNCDRW,DRAWERT
          GOTO      SUSA1000 IF LESS
.
          MOVE      ZERO,EXIT             * found a suspense allocation receipt
.
SUSA9999  RETURN
+
.****************************************************************************
.         Read payment code
.****************************************************************************
RDPCOD00  PACK      KEY5,CODEPY,PAYMCODE
          CALL      RDCODE1
          BRANCH    OVRCD,RDPCOD99
.
          PACK      PAYTYPE,TDESC,SP70
          SQUEEZE   PTCDNHCP
          MOVE      ZERO,F2
          MOVE      PTCDNHCP,F2
.
RDPCOD99  RETURN
+
.****************************************************************************
.         Print total for each payment type
.****************************************************************************
PTOT0000  MOVE      ZERO,F2
          MOVE      SAVPMTYP,F2
          COMPARE   ZERO,F2
          GOTO      PTOT9999 IF EQUAL
.
          MOVE      SAVPMTYP,SVCDNHCP
          MOVE      SP70,KEY20
          CALL      PTYP0000                * Get payment type description
          IF        F2=2
            PRINT     *N,*101,"-------------------------------":
                      *N,*102,"Total Cheque : ",*117,TOTCHQ:
                      *N,*101,"-------------------------------"
            ADD       "4",CLNO
            GOTO      PTOT9999
          ENDIF
.
          IF        F2=3
            PRINT     *N,*106,"-------------------":
                      *N,*99,"Total: ",*110,TOTCRED:
                      *N,*106,"-------------------"
            ADD       "4",CLNO
            GOTO      PTOT9999
          ENDIF
.
          IF        F2=4
            PRINT     *N,*N,*40,"--------------------------------------------":
                      "-----------",*N:
                      *40,"Total ",KEY20,*80,TOTDDBT,*N:
                      *40,"--------------------------------------------":
                      "-----------",*N
            ADD       "6",CLNO
            GOTO      PTOT9999
          ENDIF
.
          IF        F2=6
            MOVE     TOTEFTDB,FORM12P2
            ADD      TOTEFTCR,FORM12P2
            PRINT    *N,*N,*80,"----------------------------------------------":
                    *N:
                       *80,"Total Eftpos",*110,FORM12P2,*N:
                      *80,"----------------------------------------------",*N
            ADD       "7",CLNO
            GOTO      PTOT9999
          ENDIF
.
          IF        F2=7
            PRINT     *N,*N,*40,"--------------------------------------------":
                      "-----------",*N:
                      *40,"Total ",KEY20,*80,TOTBPAY,*N:
                      *40,"--------------------------------------------":
                      "-----------",*N
            ADD       "6",CLNO
            GOTO      PTOT9999
          ENDIF
.
          IF        F2=8
            PRINT     *N,*N,*40,"--------------------------------------------":
                      "-----------",*N:
                      *40,"Total ",KEY20,*80,TOTHCAPS,*N:
                      *40,"--------------------------------------------":
                      "-----------",*N
            ADD       "6",CLNO
            GOTO      PTOT9999
          ENDIF
.
          IF        F2=9
            PRINT     *N,*N,*40,"--------------------------------------------":
                      "-----------",*N:
                      *40,"Total ",KEY20,*80,TOTMDCAR,*N:
                      *40,"--------------------------------------------":
                      "-----------",*N
            ADD       "6",CLNO
            GOTO      PTOT9999
          ENDIF
.
          IF        F2>9
            SUB       NINE,F2
            MOVE      TOTPAYMN[F2],FORM12P2
            PRINT     *N,*106,"-------------------":
                      *N,*99,"Total: ",*110,FORM12P2:
                      *N,*106,"-------------------"
            ADD       "4",CLNO
            GOTO      PTOT9999
          ENDIF
.
PTOT9999  RETURN
+
.****************************************************************************
.         Get Payment type description
.****************************************************************************
PTYP0000  PACK      KEY5,CODEPY,SP70
          CALL      RDSCODE1
PTYP1000  CALL      RDKCODE1
          BRANCH    OVRCD,PTYP9000
.
          MATCH     TCODE,CODEPY
          GOTO      PTYP9000 IF NOT EQUAL
.
          MATCH     "A",PTCOACTV
          GOTO      PTYP1000 IF NOT EQUAL     * Not active
.
          SQUEEZE   PTCDNHCP
          MOVE      ZERO,F2
          MOVE      PTCDNHCP,F2
          MOVE      F2,DIM2
          MATCH     SVCDNHCP,DIM2
          GOTO      PTYP1000 IF NOT EQUAL
.
          PACK      KEY20,TDESC
          PACK      KEY12,TDESC
          MOVE      ZERO,EXIT
          GOTO      PTYP9999
.
PTYP9000  MOVE      ONE,EXIT
PTYP9999  RETURN
+
.****************************************************************************
.         Group payment type for Extended Integra Interface (HSYS1=5)
.   PAYMTYPE = 1 "CASH        "
.            = 2 "CHEQUE      "
.            = 3 "CREDIT CARD "
.            = 4 "MONEY ORDER "
.            = 5 "DIRECT DEPOSIT"
.            = 6 "EFTPOS      "
.            = 7 "BPAY        "
.            = 8 "Virtual Term"
.            = 9 "Medicare    "
.****************************************************************************
INEXT000  MOVE      ZERO,F2
          MOVE      PAYMTYPE,F2
          BRANCH    F2,INEXT100,INEXT700,INEXT200,INEXT400,INEXT800,INEXT900:
                       INEXT910,INEXT920,INEXT930
.
          COMPARE   ZERO,F2
          GOTO      INEXT999 IF EQUAL
.
          SUB       NINE,F2
          MOVE      "13",FPAYTYPE
          ADD       F2,FPAYTYPE
          ADD       CHQAMNT,LODGHREC[FPAYTYPE]      * AMX/DINERS
          ADD       GSTAMNT,LODGSREC[FPAYTYPE]
.
          GOTO      INEXT980
.
INEXT100  MOVE      "1",FPAYTYPE              * Cash
          ADD       CHQAMNT,LODGHREC[1]
          ADD       GSTAMNT,LODGSREC[1]
          GOTO      INEXT980
.
INEXT200  PACK      KEY5,ANSC,ANSR,CARDTYPE,SP70
          CALL      RDCODE1
          IF        OVRCD=0
            MATCH     "1",TCINDC1
            GOTO      INEXT300 IF EQUAL       * Amex
            MATCH     "2",TCINDC1
            GOTO      INEXT500 IF EQUAL       * Visa
            MATCH     "3",TCINDC1
            GOTO      INEXT600 IF EQUAL       * Master Card
          ENDIF
          MOVE      "2",FPAYTYPE              * Credit Card/EFTPOS
          ADD       CHQAMNT,LODGHREC[2]
          ADD       GSTAMNT,LODGSREC[2]
          GOTO      INEXT980
.
INEXT300  MOVE      "3",FPAYTYPE            * Amex
          ADD       CHQAMNT,LODGHREC[3]
          ADD       GSTAMNT,LODGSREC[3]
          GOTO      INEXT980
.
INEXT400  MOVE      "4",FPAYTYPE             * Direct Debit
          ADD       CHQAMNT,LODGHREC[4]
          ADD       GSTAMNT,LODGSREC[4]
          ADD       ONE,ITOTLREC           * number of Lodgement header record
          GOTO      INEXT980
.
INEXT500  MOVE      "5",FPAYTYPE            * Visa
          ADD       CHQAMNT,LODGHREC[5]
          ADD       GSTAMNT,LODGSREC[5]
          GOTO      INEXT980
.
INEXT600  MOVE      "6",FPAYTYPE            * MasterCard
          ADD       CHQAMNT,LODGHREC[6]
          ADD       GSTAMNT,LODGSREC[6]
          GOTO      INEXT980
.
INEXT700  MOVE      "7",FPAYTYPE            * Cheque
          ADD       CHQAMNT,LODGHREC[7]
          ADD       GSTAMNT,LODGSREC[7]
          GOTO      INEXT980
.
INEXT800  MOVE      "8",FPAYTYPE            * Money Order
          ADD       CHQAMNT,LODGHREC[8]
          ADD       GSTAMNT,LODGSREC[8]
          GOTO      INEXT980
.
INEXT900  MATCH     "1",RCBDEFTT            * 1=Cash, 2=Credit
          IF        @EQUAL
            MOVE      "9",FPAYTYPE          * EFTPOS Cash
            ADD       CHQAMNT,LODGHREC[9]
            ADD       GSTAMNT,LODGSREC[9]
          ELSE
            MOVE      "10",FPAYTYPE         * EFTPOS Credite
            ADD       CHQAMNT,LODGHREC[10]
            ADD       GSTAMNT,LODGSREC[10]
          ENDIF
          GOTO      INEXT980
.
INEXT910  MOVE      "11",FPAYTYPE           * BPAY 
          ADD       CHQAMNT,LODGHREC[11]
          ADD       GSTAMNT,LODGSREC[11]
          GOTO      INEXT980
.
INEXT920  MOVE      "12",FPAYTYPE           * Virtual Terminal
          ADD       CHQAMNT,LODGHREC[12]
          ADD       GSTAMNT,LODGSREC[12]
          GOTO      INEXT980
.
INEXT930  MOVE      "13",FPAYTYPE           * Medicare
          ADD       CHQAMNT,LODGHREC[13]
          ADD       GSTAMNT,LODGSREC[13]
          GOTO      INEXT980
.
INEXT980  IF        FPAYTYPE > MAXHREC
            MOVE      FPAYTYPE,MAXHREC
          ENDIF
.
INEXT999  RETURN
+
.****************************************************************************
.         Group payment type for Integra Interface
.   PAYMENT = 1 = CASH/CHEQUE/MONEY ORDER/Medicare
.                 /BPAY/HICAPS
.             2 = CREDIT CARD(Cat CR Ind1<>1)/EFTPOS
.             3 = AMEX (Cat CR Indic1=1)
.             4 = DIRECT DEPOSIT (4 on rcpbdtaf)
.****************************************************************************
INTEP000  MOVE      ZERO,F2
          MOVE      PAYMTYPE,F2
          BRANCH    F2,INTEP100,INTEP100,INTEP200,INTEP400,INTEP100,INTEP220:
                       INTEP100,INTEP100,INTEP100
          COMPARE   ZERO,F2
          GOTO      INTEP999 IF EQUAL
.
          SUB       NINE,F2
          MOVE      "4",FPAYTYPE
          ADD       F2,FPAYTYPE
          ADD       CHQAMNT,LODGHREC[FPAYTYPE]
          ADD       GSTAMNT,LODGSREC[FPAYTYPE]
.
          GOTO      INTEP900
.
INTEP100  MOVE      "1",FPAYTYPE              * Cheques/Cash/Money orders
          ADD       CHQAMNT,LODGHREC[1]
          ADD       GSTAMNT,LODGSREC[1]
          GOTO      INTEP900
.
INTEP200  PACK      KEY5,ANSC,ANSR,CARDTYPE,SP70
          CALL      RDCODE1
          IF        OVRCD=0
            MATCH     "1",TCINDC1
            GOTO      INTEP300 IF EQUAL       * Amex
          ENDIF
INTEP220  MOVE      "2",FPAYTYPE              * Credit Card/EFTPOS
          ADD       CHQAMNT,LODGHREC[2]
          ADD       GSTAMNT,LODGSREC[2]
          GOTO      INTEP900
.
INTEP300  MOVE      "3",FPAYTYPE            * Amex
          ADD       CHQAMNT,LODGHREC[3]
          ADD       GSTAMNT,LODGSREC[3]
          GOTO      INTEP900
.
INTEP400  MOVE      "4",FPAYTYPE             * Direct Debit
          ADD       CHQAMNT,LODGHREC[4]
          ADD       GSTAMNT,LODGSREC[4]
          ADD       ONE,ITOTLREC           * number of Lodgement header record
          GOTO      INTEP900
.
INTEP900  IF        FPAYTYPE > MAXHREC
            MOVE      FPAYTYPE,MAXHREC
          ENDIF
.
INTEP999  RETURN
+
.****************************************************************************
.*                Check for GST                                             * 
.****************************************************************************
CGST0000  MOVE      ZERO,FORM12P2
          PACK      KEY17,RCBDRECN,SP70
          CALL      RSRCDTE1
CGST1000  CALL      RKRCDTE1
          BRANCH    OVRCD,CGST9999
.
          MATCH     RCBDRECN,RCDTRECN       * Same receipt number?
          GOTO      CGST9999 IF NOT EQUAL
.
          CALL      GGST0000               * Get GST Amount
          GOTO      CGST1000
.
CGST9999  RETURN
+
.****************************************************************************
.*                             PCAN0000                                     *
.*   Print Cancelled receipts that have not been reconcilled                *
.****************************************************************************
PCAN0000  CALL      IBACLOCK
          CALL      RTMF0000               * Remove records from tempfile
.
          MOVE      SP70,KEY8              * Blank reconciliation date
          PACK      KEY26,KEY8,DRAWERF,SP70
PCAN1000  CALL      RSRCBNK3
PCAN2000  CALL      RKRCBNK3
          BRANCH    OVRCD,PCAN9999
.
.         Reconciliation date and time are blank
.
          MATCH     SP70,RCBNRDAT
          GOTO      PCAN9999 IF NOT EQUAL  * Not blank
.
          MATCH     RCBNCDRW,DRAWERT
          GOTO      PCAN9999 IF LESS
.
          MATCH     "1",RCBNSTAT            * Cancelled receipts only
          GOTO      PCAN2000 IF NOT EQUAL
.
          IF        IBCNMHOS=1
            PACK      KEY6,RCBNCDRW,SP70
            CALL      RDCIDA1
            BRANCH    OVRCD,PCAN2000
            MATCH     RCCIHOSP,WBSEHOSP
            GOTO      PCAN2000 IF NOT EQUAL * different hospital
          ENDIF
.
          PACK      SAVKEY26,RCBNRDAT,RCBNCDRW,RCBNRECN,SP70
.
.         Get the register for the receipt from rcpdteaf file
.
          MOVE      ZERO,COUNT
          PACK      KEY17,RCBNRECN,SP70
          CALL      RSRCDTE1
PCAN4000  CALL      RKRCDTE1
          BRANCH    OVRCD,PCAN8000
          MATCH     RCDTRECN,RCBNRECN
          GOTO      PCAN8000 IF NOT EQUAL
.
          UNPACK    SP70,VISNUMB,URNUMB,SCFLAG,ALOCDATE
          MOVE      ZERO,ALOCAMNT
          MOVE      RCBNCDRW,DRAWERID
          MOVE      RCDTREGI,REGISTER
          MOVE      RCDTINVN,INVOICEN
          MOVE      RCBNRECN,RECEIPTN
          MOVE      RCDTAMNT,INAMOUNT
          MOVE      ZERO,DSAMOUNT
          MOVE      RCDTNAME,PNAME
          MOVE      RCDTREFR,REFERENC
          MOVE      RCDTVIST,VISNUMB
          MOVE      RCDTURNO,URNUMB
          ADD       ONE,COUNT
          MOVE      COUNT,COUNTREC
.
          PACK      KEY41,RCBNCDRW,RCDTREGI,RCBNRECN,RCDTINVN,COUNTREC,SP70
          CALL      WRDRTMP5
.
          GOTO      PCAN4000
.
.         Set Reconciliation date/time to Current date/time
.
PCAN8000  PACK      RCBNRDAT,CCC,CYY,CMM,CDD  * reconciliation date
          REP       " 0",RCBNRDAT
          CLOCK     TIME,CTIMEIS
          PACK      RCBNRTIM,CTIMEIS,SP70     * reconciliation time
          CALL      UPRCBNK3
.
          MOVE      SAVKEY26,KEY26            * reposition
          GOTO      PCAN1000
.
PCAN9999  RETURN
+
.****************************************************************************
.               Remove records from tempfile                                *
.                      RTMF0000                                             *
.****************************************************************************
RTMF0000  MOVE      SP70,KEY41
          CALL      RSDRTMP5
          CALL      RKDRTMP5
          BRANCH    OVRCD,RTMF9999
.
          PACK      KEY41,DRAWERID,REGISTER,RECEIPTN,INVOICEN,COUNTREC,SP70
          CALL      DEDRTMP5
          GOTO      RTMF0000
.
RTMF9999  RETURN
*
.****************************************************************************
.*                             RUNREL00                                     *
.*   Schedule Cash Release to run if this is a final bank deposit listing   *
.****************************************************************************
RUNREL00  MOVE      "IBARCP76",SCHDPGID
          MOVE      "Cash Release",SCHDDESC
          PACK      SCHDDATE,CCC,CYY,CMM,CDD
          REP       " 0",SCHDDATE
          CLOCK     TIME,SCHDTIME
.
.         Write Keyin parameters
.
          UNPACK    RECDATE,CCENT,CYEAR,CMON,CDAY
          PACK      DIM8,CDAY,CMON,CCENT,CYEAR
          REP       " 0",DIM8
          MATCH     Z70,DRAWERT
          IF        @EQUAL
            MOVE      SP70,DRAWERT
          ENDIF
          MOVE      DRAWERF,KEYSTARR[1]      * From cash drawer
          MOVE      DRAWERT,KEYSTARR[2]      * To cash drawer
          MOVE      DIM8,KEYSTARR[3]         * Release date
          MOVE      USERID,KEYSTARR[4]
          MOVE      ANSY,KEYSTARR[5]         * Yes to continue
          MOVE      SP70,KEYSTARR[6]
          MOVE      SP70,KEYSTARR[7]
.
          MOVE      SEVEN,KEYSTCNT         * Number of Keyins
.
          CALL      SCHPRO00   * Schedule Extract
.
RUNREL99  RETURN
.
.****************************************************************************
.*                                PRTOT000             Called by: PRLIS000  *
.*         Print total for each drawer/cheque account combination           *
.****************************************************************************
PRTOT000  MOVE      ZERO,TOTTOTAL
          MOVE      ZERO,TOTAMT
          MOVE      ZERO,TOTAAMT
          MOVE      SP70,SAVDRAWR
          MOVE      SP70,SAVCHQAC
          CALL      HEADX000
.
          PRINT     *1,"Drawer",*41,"Cheque Account",*90,"BSB",*101,"Amount"
          PRINT     *1,"--------------------------------------":
                    *41,"------------------------------------------------":
                    *90,"----------",*101,"---------------"
          PACK      KEY43,SP70
          IF        SUMMFLAG=1
            CALL      RSDRTMP6
          ELSE
            CALL      RSDRTMP3
          ENDIF
PRTOT100  IF        SUMMFLAG=1
            CALL      RKDRTMP6
          ELSE
            CALL      RKDRTMP3
          ENDIF
          BRANCH    OVRCD,PRTOT999
.
          IF        SUMMFLAG<>1
            MATCH     SP70,SAVDRAWR
            IF        @EQUAL
              MOVE      DRAWERID,SAVDRAWR
            ENDIF
            MATCH     SAVDRAWR,DRAWERID
            IF        !@EQUAL
              CALL      TOTLIN00
              GOTO      PRTOT100
            ENDIF
          ENDIF
.
          MATCH     SP70,SAVCHQAC
          IF        @EQUAL
            MOVE      CHQACCNT,SAVCHQAC
          ENDIF
.
          MATCH     SAVCHQAC,CHQACCNT
          IF        !@EQUAL
            CALL      TOTLIN00
            GOTO      PRTOT100
          ENDIF
.
          ADD       CHQAMNT,TOTAMT
          GOTO      PRTOT100
.
PRTOT999  CALL      TOTLIN00
          PRINT     *80,"------------------------------------":
                    *N,*80,"Total ",*101,TOTTOTAL:
                    *N,*80,"------------------------------------"
          RETURN
+
.****************************************************************************
.*                                TOTLIN00             Called by: PRTOT000  *
.*                        Print a total line                                *
.****************************************************************************
TOTLIN00  PACK      KEY6,SAVDRAWR,SP70
          CALL      RDCIDA1
          IF        OVRCD=1
            UNPACK    SP70,RCPSUR,RCPGIVEN
          ENDIF
          SQUEEZE   RCPGIVEN
          SQUEEZE   RCPSUR
          UNPACK    RECDATE,CCENT,CYEAR,CMON,CDAY
          CALL      PACDATE
          PACK      DRAWER,RCPSUR,SP1,RCPGIVEN,SP70
.
          MATCH     SP70,SAVCHQAC
          IF        @EQUAL
            UNPACK    SP70,CHQADESC,FMCHBSB
            GOTO      TOTLIN80
          ENDIF
.
          PACK      KEY15,SAVCHQAC,SP70
          CALL      RDFMCH1
          IF        OVRCD<>1
            MOVE      FMCHDES,CHQADESC
          ELSE
            MOVE      "Invalid Cheque Account                  ",CHQADESC
            PACK      FMCHBSB,SP70
          ENDIF
.
TOTLIN80  PRINT     *1,DRAWER,*41,CHQADESC,*90,FMCHBSB,*101,TOTAMT
          ADD       TOTAMT,TOTTOTAL
          MOVE      ZERO,TOTAMT
          MOVE      DRAWERID,SAVDRAWR
          MOVE      CHQACCNT,SAVCHQAC
          MOVE      CHQAMNT,TOTAMT
.
TOTLIN99  RETURN
+
.****************************************************************************
.*                                NEWPAG00             Called by: PRLIS000  *
.*                 Print next heading for bank deposit listing              *
.****************************************************************************
NEWPAG00  CALL      LISTOT00
          MOVE      ONE,FRSTFLAG
          MOVE      DRAWERID,SAVDRAWR
          MOVE      PAYMTYPE,SAVPMTYP
          MOVE      CHQACCNT,SAVCHQAC
          CALL      LISHED00               * print next header
.
NEWPAG99  RETURN
.****************************************************************************
.*                                WRSYS000             Called by: PRREC000  *
.*                 Write system reconciliation to tempfile                  *
.****************************************************************************
WRSYS000  MOVE      ZERO,COUNT
          MOVE      SP70,SAVKEY29
          MOVE      ZERO,OTCOLNUM
          PACK      KEY26,SP8,DRAWERF,SP70
.                                                     * add Optn 7 & 8         
          IF        COPTION = 3 | COPTION = 7 | COPTION = 8
            PACK      KEY26,RECDATE,DRAWERF,SP70
          ENDIF 
          CALL      RSRCBNK3
WRSYS100  CALL      RKRCBNK3
          BRANCH    OVRCD,WRSYS999
.
          MATCH     "1",RCBNSTAT            * skip Cancelled receipts
          GOTO      WRSYS100 IF EQUAL
.
          IF        COPTION = 7 | COPTION = 8
            MATCH     RCBNRDAT,RECDATTO     * check Reconcil. within date range
            GOTO      WRSYS999 IF LESS
.
            MATCH     DRAWERF,RCBNCDRW      * check within Drawer range
            GOTO      WRSYS100 IF LESS
            MATCH     RCBNCDRW,DRAWERT
            GOTO      WRSYS100 IF LESS
.
            IF        IBCNMHOS=1
              PACK      KEY6,RCBNCDRW,SP70
              CALL      RDCIDA1
              BRANCH    OVRCD,WRSYS100
              MATCH     RCCIHOSP,WBSEHOSP
              GOTO      WRSYS100 IF NOT EQUAL        * different hospital
            ENDIF
.
            IF        COPTION = 8
              CALL      WROP8000            * write Option 8 tempfile
              GOTO      WRSYS100
            ENDIF
            GOTO      WRSYS400
          ENDIF
.
.         Only includes receipt up to the reconciliation date
.
          IF        COPTION <> 7
            MATCH     RCBNTDAT,RECDATE
            GOTO      WRSYS100 IF LESS
          ENDIF
.
          IF        COPTION = 3
            MATCH     RECDATE,RCBNRDAT
            GOTO      WRSYS999 IF NOT EQUAL
          ELSE
            MATCH     SP70,RCBNRDAT
            GOTO      WRSYS999 IF NOT EQUAL
          ENDIF
.
          IF        IBCNMHOS=1
            PACK      KEY6,RCBNCDRW,SP70
            CALL      RDCIDA1
            BRANCH    OVRCD,WRSYS100
            MATCH     RCCIHOSP,WBSEHOSP
            GOTO      WRSYS100 IF NOT EQUAL        * different hospital
          ENDIF
.
WRSYS200  MATCH     RCBNCDRW,DRAWERT
          GOTO      WRSYS999 IF LESS
.
WRSYS400  PACK      KEY17,RCBNRECN,SP70
          CALL      RSRCDTE1
WRSYS500  CALL      RKRCDTE1
          BRANCH    OVRCD,WRSYS100
.
          MATCH     RCDTRECN,RCBNRECN
          GOTO      WRSYS100 IF NOT EQUAL
.
          IF        COPTION = 7  | COPTION = 8
            MATCH     REGFROM,RCDTREGI      * select Register range
            GOTO      WRSYS500 IF LESS
            MATCH     RCDTREGI,REGTOTO
            GOTO      WRSYS500 IF LESS
          ENDIF
.
          ADD       ONE,COUNT
          MOVE      COUNT,COUNTREC
.
          MATCH     "1",RCCNRCP2
          IF        @EQUAL        
            PACK      KEY41,RCBNCDRW,RCDTREGI,RCDTRECN,RCDTINVN,COUNTREC,SP70
            CALL      RDDRTMP5
          ELSE
            PACK      KEY29,RCBNCDRW,RCDTREGI,RCDTINVN,COUNTREC,SP70
            CALL      RDDRTMP2
          ENDIF
.
          IF        OVRCD=0
            GOTO      WRSYS500
          ENDIF
.
          MOVE      RCBNCDRW,DRAWERID
          MOVE      RCDTREGI,REGISTER                                  *I-59171
          MOVE      RCDTRECN,RECEIPTN
          MOVE      RCDTAMNT,INAMOUNT
          MOVE      RCDTDISC,DSAMOUNT
          MOVE      RCDTVIST,VISNUMB
          MOVE      RCDTURNO,URNUMB
          MOVE      RCDTSFLG,SCFLAG
          MOVE      RCDTNAME,PNAME
          MOVE      RCDTREFR,REFERENC
          MOVE      RCDTINVN,INVOICEN
.                                           * identify any Allocations from Sus-
.                                           * pense (Opn 9 & 10)
          MOVE      SP8,ALOCDATE
          MOVE      ZERO,ALOCAMNT
          IF        COPTION = 9 | COPTION = 7
            MATCH     SP8,RCDTSPUI
            IF        !@EQUAL
              MOVE      RCDTSPUI,ALOCDATE
              MOVE      RCDTAMNT,ALOCAMNT
            ENDIF  
          ENDIF  
.
          MATCH     "1",RCCNRCP2
          IF        @EQUAL
            PACK      KEY41,RCBNCDRW,RCDTREGI,RCDTRECN,RCDTINVN,COUNT,SP70
            CALL      WRDRTMP5
          ELSE
            PACK      KEY29,RCBNCDRW,RCDTREGI,RCDTINVN,COUNT,SP70
            CALL      WRDRTMP2
          ENDIF
.
          BRANCH    COPTION,WRSYS600,WRSYS600,WRSYS600
          GOTO      WRSYS500
.
WRSYS600  COMPARE   ONE,CSVFLAG
          GOTO      WRSYS500 IF NOT EQUAL      * Not generating CSVFLAG
.
          PACK      SAVKEY29,RCBNCDRW,RCDTREGI,INVOICEN,COUNTREC
.
.         Total for each drawer,register
.
          MOVE      "zzzzzzzzzzzz",KEY12       * invoice no
          MOVE      "zzzzzzzz",KEY8            * counter
          PACK      KEY29,RCBNCDRW,RCDTREGI,KEY12,KEY8,SP70
          CALL      RDDRTMP2
          IF        OVRCD=1
            UNPACK    KEY29,DRAWERID,REGISTER,INVOICEN,COUNTREC
            MOVE      RCDTAMNT,INAMOUNT
            MOVE      RCDTDISC,DSAMOUNT
            CALL      WRDRTMP2
          ELSE
            ADD       RCDTAMNT,INAMOUNT
            ADD       RCDTDISC,DSAMOUNT
            CALL      UPDRTMP2
          ENDIF
.
.         Total for each drawer
.
          UNPACK    SAVKEY29,DRAWERID,REGISTER,INVOICEN,COUNTREC
          MOVE      "zzz",KEY3                 * register
          MOVE      "zzzzzzzzzzzz",KEY12       * invoice no
          MOVE      "zzzzzzzz",KEY8            * counter
          PACK      KEY29,DRAWERID,KEY3,KEY12,KEY8,SP70
          CALL      RDDRTMP2
          IF        OVRCD=1
            UNPACK    KEY29,DRAWERID,REGISTER,INVOICEN,COUNTREC
            MOVE      RCDTAMNT,INAMOUNT
            MOVE      RCDTDISC,DSAMOUNT
            CALL      WRDRTMP2
          ELSE
            ADD       RCDTAMNT,INAMOUNT
            ADD       RCDTDISC,DSAMOUNT
            CALL      UPDRTMP2
          ENDIF
.         Total for each register
.
          UNPACK    SAVKEY29,DRAWERID,REGISTER,INVOICEN,COUNTREC
          MOVE      "zzzzzz",KEY6              * drawer id
          MOVE      "zzzzzzzzzzzz",KEY12       * invoice no
          MOVE      "zzzzzzzz",KEY8            * counter
          PACK      KEY29,KEY6,REGISTER,KEY12,KEY8,SP70
          CALL      RDDRTMP2
          IF        OVRCD=1
            UNPACK    KEY29,DRAWERID,REGISTER,INVOICEN,COUNTREC
            MOVE      RCDTAMNT,INAMOUNT
            MOVE      RCDTDISC,DSAMOUNT
            CALL      WRDRTMP2
          ELSE
            ADD       RCDTAMNT,INAMOUNT
            ADD       RCDTDISC,DSAMOUNT
            CALL      UPDRTMP2
          ENDIF
.
          GOTO      WRSYS500
.
WRSYS999  RETURN
+                                                                     *I-175417
.****************************************************************************
.*                                WROP8000             Called by: WRSYS000  *
.*                 Write Summary tempfile for Option 8                      *
.****************************************************************************
.                                           * write temp records for Option 8
WROP8000  MOVE      ZERO,PRORATNO
          MOVE      ZERO,F2
          WHILE     F2 < 50
            ADD       ONE,F2
            MOVE      SP3,OP8REGI[F2]
            MOVE      ZERO,OP8AMNT[F2]
          DO
.
          PACK      KEY17,RCBNRECN,SP70
          CALL      RSRCDTE1
WROP8100  CALL      RKRCDTE1
          BRANCH    OVRCD,WROP8200
.
          MATCH     RCDTRECN,RCBNRECN
          GOTO      WROP8200 IF NOT EQUAL
.
          IF        COPTION=10
            MATCH     RCDTRELD,SAVRDATE
            GOTO      WROP8100 IF NOT EQUAL * different Release date
          ENDIF
.
          IF        COPTION=9
            MATCH     RECDATE,RCDTRELD
            GOTO      WROP8100 IF LESS
            MATCH     RCDTRELD,RECDATTO     * check rel.date within date range
            GOTO      WROP8100 IF LESS
          ENDIF
.
          MATCH     REGFROM,RCDTREGI        * select Register range
          GOTO      WROP8100 IF LESS
          MATCH     RCDTREGI,REGTOTO
          GOTO      WROP8100 IF LESS
.
          MOVE      RCDTTDAT,OP8TDATE
          IF        PRORATNO > 49
            PRINT     *1,"Receipt No. ",RCBNRECN," error - more that 50 ":
                      "Registers"
            GOTO      WROP8200
          ENDIF
.
          MOVE      ZERO,F2
          MOVE      ZERO,DONE
          WHILE     DONE < 1
            ADD       ONE,F2
            MATCH     SP3,OP8REGI[F2]
            IF        @EQUAL
              MOVE      F2,PRORATNO
              MOVE      RCDTREGI,OP8REGI[F2]
              MOVE      RCDTAMNT,OP8AMNT[F2]
              MOVE      ONE,DONE
            ELSE
              MATCH     RCDTREGI,OP8REGI[F2]
              IF        @EQUAL
                ADD       RCDTAMNT,OP8AMNT[F2]
                MOVE      ONE,DONE
              ENDIF
            ENDIF
          DO
.
          GOTO      WROP8100
.
.
WROP8200  PACK      KEY23,OP8TDATE,RCBNRECN,SP70
          CALL      RSRCBDT2
WROP8300  CALL      RKRCBDT2                * read Receipt Bank Details file
          BRANCH    OVRCD,WROP8500
.
          MATCH     RCBDTDAT,OP8TDATE
          GOTO      WROP8500 IF NOT EQUAL
          MATCH     RCBDRECN,RCBNRECN
          GOTO      WROP8500 IF NOT EQUAL
.
          MOVE      " 1",PAYMTYPE
          MATCH     SP70,RCBDPCOD
          GOTO      WROP8400 IF EQUAL
          PACK      KEY5,CODEPY,RCBDPCOD
          CALL      RDCODE1
          BRANCH    OVRCD,WROP8400
.
          SQUEEZE   PTCDNHCP
          MOVE      ZERO,F2
          MOVE      PTCDNHCP,F2
          COMPARE   ZERO,F2
          GOTO      WROP8400 IF EQUAL
.
          MOVE      F2,PAYMTYPE
.
WROP8400  MOVE      RCBDPAMT,OP8INAMT
          MOVE      ZERO,F3
          IF        RCBDPAMT<0
            MOVE      ONE,F3                * negative amount of cash
          ENDIF
.
          MOVE      ONE,F2
          REPEAT
            IF        OP8AMNT[F2] <> 0
              MOVE      OP8INAMT,PAYAMNT 
              IF        F3=1
                COMPARE   OP8INAMT,OP8AMNT[F2]
                IF        !@LESS
                  MOVE      OP8AMNT[F2],PAYAMNT
                ENDIF
              ELSE
                COMPARE   OP8AMNT[F2],OP8INAMT
                IF        !@LESS
                  MOVE      OP8AMNT[F2],PAYAMNT
                ENDIF
              ENDIF
              SUB       PAYAMNT,OP8AMNT[F2]
              SUB       PAYAMNT,OP8INAMT
.
              MOVE      OP8REGI[F2],SREGSTER
              CALL      WRTAMT00            * add Amount to resp. column & write
.
              IF        OP8INAMT = 0
                MOVE      "90",F2
              ENDIF
.
            ENDIF
            ADD       ONE,F2                * point at next Register
          UNTIL     F2 > PRORATNO
.
          GOTO      WROP8300
.                                  -----------
.
WROP8500  GOTO      WROP89999
.
.
WROP8999  RETURN
+
.****************************************************************************
.*                                WRTAMT00                                  *
.*                        Option 8 - Add amounts by Payment Type            *
.****************************************************************************
WRTAMT00  MOVE      ZERO,EXIT
          PACK      KEY17,RCBNCDRW,RCBNRDAT,SREGSTER,SP70
          CALL      RDDRTMP4
          IF        OVRCD = 1
            MOVE      RCBNCDRW,DRAWERID
            MOVE      SREGSTER,REGISTER
            MOVE      RCBNRDAT,RECPDATE
            MOVE      "1",HEADTYPE
            CALL      WRDRTMP4
          ENDIF
.
          PACK      KEY19,RCBNCDRW,RCBNRDAT,SREGSTER,PAYMTYPE,SP70
          CALL      RDDRTM10
          IF        OVRCD = 0
            ADD       PAYAMNT,SUMAMNT
            CALL      UPDRTM10
          ELSE
            MOVE      RCBNCDRW,DRAWERID
            MOVE      SREGSTER,REGISTER
            MOVE      RCBNRDAT,RECPDATE
            MOVE      PAYMTYPE,SUMRTYPE
            MOVE      PAYAMNT,SUMAMNT
            CALL      WRDRTM10
          ENDIF
.
WRTAMT02  PACK      KEY3,TILD20
.
          PACK      KEY17,RCBNCDRW,RCBNRDAT,KEY3,SP70
          CALL      RDDRTMP4
          IF        OVRCD = 1
            MOVE      RCBNCDRW,DRAWERID
            MOVE      KEY3,REGISTER
            MOVE      RCBNRDAT,RECPDATE
            MOVE      "1",HEADTYPE
            CALL      WRDRTMP4
          ENDIF
.
          PACK      KEY19,RCBNCDRW,RCBNRDAT,KEY3,PAYMTYPE,SP70
          CALL      RDDRTM10
          IF        OVRCD = 0
            ADD       PAYAMNT,SUMAMNT
            CALL      UPDRTM10
          ELSE
            MOVE      RCBNCDRW,DRAWERID
            MOVE      KEY3,REGISTER
            MOVE      RCBNRDAT,RECPDATE
            MOVE      PAYMTYPE,SUMRTYPE
            MOVE      PAYAMNT,SUMAMNT
            CALL      WRDRTM10
          ENDIF
.                                           * write a period summary record
WRTAMT03  PACK      KEY8,TILD20
          PACK      KEY17,RCBNCDRW,KEY8,SREGSTER,SP70
          CALL      RDDRTMP4
          IF        OVRCD = 1
            MOVE      RCBNCDRW,DRAWERID
            MOVE      SREGSTER,REGISTER
            MOVE      KEY8,RECPDATE
            MOVE      "2",HEADTYPE
            CALL      WRDRTMP4
          ENDIF
.
          PACK      KEY19,RCBNCDRW,KEY8,SREGSTER,PAYMTYPE,SP70
          CALL      RDDRTM10
          IF        OVRCD = 0
            ADD       PAYAMNT,SUMAMNT
            CALL      UPDRTM10
          ELSE
            MOVE      RCBNCDRW,DRAWERID
            MOVE      SREGSTER,REGISTER
            MOVE      KEY8,RECPDATE
            MOVE      PAYMTYPE,SUMRTYPE
            MOVE      PAYAMNT,SUMAMNT
            CALL      WRDRTM10
          ENDIF
.                                           * write a final Summary
WRTAMT04  UNPACK    TILD20,KEY6,KEY8
          PACK      KEY17,KEY6,KEY8,SREGSTER,SP70
          CALL      RDDRTMP4
          IF        OVRCD = 1
            MOVE      KEY6,DRAWERID
            MOVE      SREGSTER,REGISTER
            MOVE      KEY8,RECPDATE
            MOVE      "3",HEADTYPE
            CALL      WRDRTMP4
          ENDIF
.
          PACK      KEY19,KEY6,KEY8,SREGSTER,PAYMTYPE,SP70
          CALL      RDDRTM10
          IF        OVRCD = 0
            ADD       PAYAMNT,SUMAMNT
            CALL      UPDRTM10
          ELSE
            MOVE      KEY6,DRAWERID
            MOVE      SREGSTER,REGISTER
            MOVE      KEY8,RECPDATE
            MOVE      PAYMTYPE,SUMRTYPE
            MOVE      PAYAMNT,SUMAMNT
            CALL      WRDRTM10
          ENDIF
.                                           * write Grand Total
WRTAMT05  UNPACK    TILD20,KEY6,KEY8,KEY3
          PACK      KEY17,KEY6,KEY8,KEY3,PAYMTYPE,SP70
          CALL      RDDRTMP4
          IF        OVRCD = 1
            MOVE      KEY6,DRAWERID
            MOVE      KEY3,REGISTER
            MOVE      KEY8,RECPDATE
            MOVE      "4",HEADTYPE
            CALL      WRDRTMP4
          ENDIF
.
          PACK      KEY19,KEY6,KEY8,KEY3,PAYMTYPE,SP70
          CALL      RDDRTM10
          IF        OVRCD = 0
            ADD       PAYAMNT,SUMAMNT
            CALL      UPDRTM10
          ELSE
            MOVE      KEY6,DRAWERID
            MOVE      KEY3,REGISTER
            MOVE      KEY8,RECPDATE
            MOVE      PAYMTYPE,SUMRTYPE
            MOVE      PAYAMNT,SUMAMNT
            CALL      WRDRTM10
          ENDIF
.
.         Write to a tempfile for the other payment types (paymtype >9)
.
          MOVE      PAYMTYPE,FORM2
          IF        FORM2<10
            GOTO      WRTAMT90
          ENDIF
.
          PACK      KEY5,PAYMTYPE,RCBDPCOD
          CALL      RDDRTM11
          IF        OVRCD=1
            UNPACK    KEY5,SPAYTYPE,SPAYCODE
            CALL      WRDRTM11
          ENDIF
.
WRTAMT90  MOVE      PAYMTYPE,FORM2
          COMPARE   SEVEN,FORM2
          GOTO      WRTAMT99 IF LESS
.
          SUB       SIX,FORM2
          IF        FORM2>OTCOLNUM
            MOVE      FORM2,OTCOLNUM
          ENDIF
WRTAMT99  RETURN
.
.****************************************************************************
.*                                PRCRE000             Called by: PRREC000  *
.*                        Process tempfile records                          *
.****************************************************************************
PRCRE000  MOVE      ZERO,CLNO
          MOVE      ZERO,TOTCASH 
          MOVE      ZERO,TOTCHQ  
          MOVE      ZERO,TOTCRED 
          MOVE      ZERO,TOTDDBT 
          MOVE      ZERO,TOTMONOR
          MOVE      ZERO,TOTBPAY
          MOVE      ZERO,TOTHCAPS
          MOVE      ZERO,TOTMDCAR
.
          MOVE      ONE,F2
          WHILE     F2<99
            MOVE      ZERO,TOTPAYMN[F2]
            MOVE      ZERO,TTOTPYMN[F2]
            ADD       ONE,F2
          DO
.
          MOVE      ZERO,TOTEFTCR                                     *I-230977
          MOVE      ZERO,TOTEFTDB                                     *I-230977
          MOVE      ZERO,TTOTCASH 
          MOVE      ZERO,TTOTCHQ  
          MOVE      ZERO,TTOTDDBT 
          MOVE      ZERO,TTOTMONR
          MOVE      ZERO,TTOTBPAY
          MOVE      ZERO,TTOTHCPS
          MOVE      ZERO,TTOTMCAR
          MOVE      ZERO,TTOTEFCR                                     *I-230977
          MOVE      ZERO,TTOTEFDB                                     *I-230977
          MOVE      ZERO,TTOTEFTP
          MOVE      ZERO,TOTTOTAL
          MOVE      SP70,SAVDRAWR
          MOVE      ZERO,FRSTFLAG
          MOVE      ZERO,PRTOTFLG
.
          PACK      HDTITLE,SP70
          LOAD      HDTITLE,COPTION,TITLE1,TITLE2,TITLE3,TITLE4,TITLE5,TITLE6
.
...       PRINT     *17,HDTITLE,DISPLDTE,*N
...       PRINT     *15,"*** Drawer Reconciliation ***"
          PACK      KEY18,SP70
          CALL      RSDRTMP1
PRCRE100  CALL      RKDRTMP1
          BRANCH    OVRCD,PRCRE900
.
          IF        FRSTFLAG=0
            MOVE      ONE,FRSTFLAG
            CALL      RECHED00
          ENDIF
.
          MATCH     SP70,SAVDRAWR
          IF        @EQUAL
            MOVE      DRAWERID,SAVDRAWR
          ENDIF
.
          MATCH     SAVDRAWR,DRAWERID
          IF        !@EQUAL
            CALL      RECTOT00               * print total for drawer
            MOVE      ZERO,TOTCASH
            MOVE      ZERO,TOTCHQ
            MOVE      ZERO,TOTCRED
            MOVE      ZERO,TOTDDBT
            MOVE      ZERO,TOTMONOR
            MOVE      ZERO,TOTBPAY
            MOVE      ZERO,TOTHCAPS
            MOVE      ZERO,TOTMDCAR
            MOVE      ZERO,TOTEFTCR
            MOVE      ZERO,TOTEFTDB
            MOVE      ONE,F2
            WHILE     F2<99
              MOVE      ZERO,TOTPAYMN[F2]
              ADD       ONE,F2
            DO
            MOVE      DRAWERID,SAVDRAWR
            CALL      RECHED00               * print header for next drawer
          ENDIF
.
          PACK      KEY15,RECEIPTN,SP70
          CALL      RSRCBDT1
PRCRE200  CALL      RKRCBDT1
          BRANCH    OVRCD,PRCRE100
.
          MATCH     RECEIPTN,RCBDRECN
          GOTO      PRCRE100 IF NOT EQUAL
.
          MOVE      SP70,PAYTYPE
          CALL      GPAY0000                * Get payment type
.
          IF        PAYMINDC=3
            PACK      KEY5,ANSC,ANSR,RCBDCRDT,SP70
            CALL      RDCODE1
            IF        OVRCD=0
              CLEAR     PAYTYPE
              APPEND    "Cr-",PAYTYPE
              APPEND    TDESC,PAYTYPE
              APPEND    SP70,PAYTYPE
              RESET     PAYTYPE
            ENDIF
          ENDIF
.
          IF        PAYMINDC=6
            MATCH     "2",RCBDEFTT
            IF        @EQUAL
              PACK      KEY5,ANSC,ANSR,RCBDCRDT,SP70
              CALL      RDCODE1
              IF        OVRCD=0
                CLEAR     PAYTYPE
                APPEND    "EFT-",PAYTYPE
                APPEND    TDESC,PAYTYPE
                APPEND    SP70,PAYTYPE
                RESET     PAYTYPE
              ENDIF
            ENDIF
          ENDIF
.
          UNPACK    RCBDPAYD,KEY28
          IF        PAYMINDC=1 | PAYMINDC=9
            PRINT     *1,RCBDRECN,*20,KEY28,*50,PAYTYPE,*64,RCBDPAMT;
.
.           Print Statement reference for Payment type of Medicare and
.           Cat Py TCINDC1=4 (Direct Deposit)
.
            IF        PAYMINDC=9
              MATCH     "4",TCINDC1
              IF        @EQUAL
                PRINT     *80,RCBDSTRF;
              ENDIF
            ENDIF
            PRINT     " "
          ELSE
            IF        PAYMINDC=2
              UNPACK    RCBDDRAW,KEY28
            ENDIF
            PRINT     *1,RCBDRECN,*20,KEY28,*50,PAYTYPE,*64,RCBDPAMT;
          ENDIF
          IF        PAYMINDC=2
            PACK      DIM6,RCBDBANK,SP70
            PACK      DIM12,RCBDBRCH,SP70
            PRINT     *80,"Chq No:",RCBDCHQN," Bank:",DIM6," Branch:":
                      DIM12
          ENDIF
          IF        PAYMINDC=3
            PACK      KEY5,ANSC,ANSR,RCBDCRDT,SP70
            CALL      RDCODE1
            IF        OVRCD<>1
              PRINT     *80,TDESC                * C-153826
            ENDIF
          ENDIF
          IF        PAYMINDC=4|PAYMINDC=6|PAYMINDC=7|PAYMINDC=8
            PRINT     *80,RCBDSTRF
          ENDIF
          IF        PAYMINDC=5
            PRINT     *80,RCBDCHQN
          ENDIF
.
          IF        PAYMINDC>9
           PRINT     *80,RCBDSTRF                  * for AMX/DINERS
          ENDIF
.
          ADD       ONE,CLNO
          COMPARE   "55",CLNO
          CALL      RECHED00 IF NOT LESS
.
          MOVE      SP70,DTCRTYPE
          UNPACK    RCBDPAYD,KEY28
.
          BRANCH    PAYMINDC,PRCRE300,PRCRE310,PRCRE320,PRCRE330,PRCRE340:
                             PRCRE350,PRCRE360,PRCRE370,PRCRE380
.
          MOVE      PAYMINDC,F2
          SUB       NINE,F2
          COMPARE   ZERO,F2
          GOTO      PRCRE400 IF LESS
.
          ADD       RCBDPAMT,TOTPAYMN[F2]
          ADD       RCBDPAMT,TTOTPYMN[F2]
          GOTO      PRCRE400
.
PRCRE300  ADD       RCBDPAMT,TOTCASH
          ADD       RCBDPAMT,TTOTCASH
          GOTO      PRCRE400
.
PRCRE310  ADD       RCBDPAMT,TOTCHQ
          ADD       RCBDPAMT,TTOTCHQ
          GOTO      PRCRE400
.
.         write Credit Card details to a tempfile
.
PRCRE320  MOVE      SP70,KEY1
          PACK      KEY5,CODECR,RCBDCRDT
          CALL      RDCODE1
          IF        OVRCD=0
            MOVE      TCINDC1,KEY1           * Indicator 1 for Type of Cred.Card
          ENDIF
.
          PACK      KEY10,DRAWERID,KEY1,RCBDCRDT
          CALL      RDCREDF1
          IF        OVRCD=0
            ADD       RCBDPAMT,CREDAMNT      * Accummulate amount
            CALL      UPCREDF1
          ELSE
            MOVE      KEY1,CREDINDC
            MOVE      DRAWERID,CREDDRAW      * Cash drawer
            MOVE      RCBDCRDT,CREDCODE      * Credit card code
            MOVE      RCBDPAMT,CREDAMNT      * Amount
            CALL      WRCREDF1
          ENDIF
.
          MOVE      RCBDCRDT,DTCRTYPE
          GOTO      PRCRE400
.
PRCRE330  ADD       RCBDPAMT,TOTDDBT
          ADD       RCBDPAMT,TTOTDDBT       * direct deposit
          GOTO      PRCRE400
.
PRCRE340  ADD       RCBDPAMT,TOTMONOR       * money order/patient portal
          ADD       RCBDPAMT,TTOTMONR
          GOTO      PRCRE400
.
.         Write EFTPOS to a tempfile
.
PRCRE350  MOVE      SP70,KEY1
          MATCH     "1",RCBDEFTT            * 1=Cash, 2=Credit        *C-230977
          IF        @EQUAL
            MOVE      "0",KEY1              * for Cash
          ELSE
            PACK      KEY5,CODECR,RCBDCRDT
            CALL      RDCODE1
            IF        OVRCD=0
              MOVE      TCINDC1,KEY1         * Indicator 1 for Type of Cred.Card
            ENDIF
          ENDIF
.
          PACK      KEY10,DRAWERID,KEY1,RCBDCRDT
          CALL      RDEFTPF1
          IF        OVRCD=0
            ADD       RCBDPAMT,EFTPAMNT      * Accummulate amount
            CALL      UPEFTPF1
          ELSE
            MOVE      KEY1,EFTPINDC
            MOVE      DRAWERID,EFTPDRAW      * Cash drawer
            MOVE      RCBDCRDT,EFTPCODE      * Credit card code
            MOVE      RCBDPAMT,EFTPAMNT      * Amount
            CALL      WREFTPF1
          ENDIF
.
          MOVE      RCBDCRDT,DTCRTYPE
          GOTO      PRCRE400
.
PRCRE360  ADD       RCBDPAMT,TOTBPAY        * BPAY
          ADD       RCBDPAMT,TTOTBPAY
          GOTO      PRCRE400
.
PRCRE370  ADD       RCBDPAMT,TOTHCAPS       * Virtual Terminal
          ADD       RCBDPAMT,TTOTHCPS
          GOTO      PRCRE400
.
PRCRE380  ADD       RCBDPAMT,TOTMDCAR       * Medicare
          ADD       RCBDPAMT,TTOTMCAR
          GOTO      PRCRE400
.
PRCRE400  ADD       RCBDPAMT,TOTTOTAL
.
.         If we are not processing CSV format, update the Bank file
.
          IF        COPTION=2 & CSVFLAG=0
            PACK      KEY12,RECEIPTN,SP70
            CALL      RDRCBNK1
            IF        OVRCD=0
              MOVE      RECDATE,RCBNRDAT
              PACK      RCBNRTIM,CTIMEIS,SP70
              CALL      UPRCBNK1
            ENDIF
          ENDIF
.
          CALL      WTTP0000            * Total of each payment for a drawer
          GOTO      PRCRE200
.
PRCRE900  IF        FRSTFLAG=0
            CALL      RECHED00
            PRINT    "*** No records to print ***"
            GOTO      PRCRE999
          ENDIF
          CALL      RECTOT00               * print total for drawer
          COMPARE   "50",CLNO
          IF        !@LESS
            CALL      HEAD132 
          ENDIF
.
          PRINT     *N,*1,"TOTALS"
          CALL      TORD0000          * Print Grand Totals
.
          PRINT     *65,"----------------",*N:
                    *40,"Total",*65,TOTTOTAL,*N:
                    *65,"----------------",*N
          ADD       THREE,CLNO
          GOTO      PRCRE999
.
PRCRE999  RETURN
+
.****************************************************************************
.         total of each payment type for a drawer
.****************************************************************************
WTTP0000  COMPARE   ONE,CSVFLAG
          GOTO      WTTP9999 IF NOT EQUAL     * Not generating a CSV file
.
          MOVE      RCBDPCOD,DTPYTYPE
          MOVE      DRAWERID,DTDRAWER
          PACK      SAVKEY12,DTDRAWER,DTPYTYPE,DTCRTYPE
.
          PACK      KEY12,DTDRAWER,DTPYTYPE,DTCRTYPE,SP70
          CALL      RDCSVTM1
          IF        OVRCD=0
            ADD       RCBDPAMT,DTAMOUNT
            CALL      UPCSVTM1
          ELSE
            UNPACK    KEY12,DTDRAWER,DTPYTYPE,DTCRTYPE
            MOVE      SP70,DTCOLNUM
            MOVE      RCBDPAMT,DTAMOUNT
            CALL      WRCSVTM1
          ENDIF
.
.         Total payment types for a drawer
.
          MOVE      "zzzzzz",KEY6
          PACK      KEY12,DTDRAWER,KEY6
          CALL      RDCSVTM1
          IF        OVRCD=0
            ADD       RCBDPAMT,DTAMOUNT
            CALL      UPCSVTM1
          ELSE
            UNPACK    KEY12,DTDRAWER,DTPYTYPE,DTCRTYPE
            MOVE      SP70,DTCOLNUM
            MOVE      RCBDPAMT,DTAMOUNT
            CALL      WRCSVTM1
          ENDIF
.
.         Grand total record
.
          UNPACK    SAVKEY12,DTDRAWER,DTPYTYPE,DTCRTYPE
          MOVE      "zzzzzz",DTDRAWER
          PACK      KEY12,DTDRAWER,DTPYTYPE,DTCRTYPE,SP70
          CALL      RDCSVTM1
          IF        OVRCD=0
            ADD       RCBDPAMT,DTAMOUNT
            CALL      UPCSVTM1
          ELSE
            UNPACK    KEY12,DTDRAWER,DTPYTYPE,DTCRTYPE
            MOVE      SP70,DTCOLNUM
            MOVE      RCBDPAMT,DTAMOUNT
            CALL      WRCSVTM1
          ENDIF
.
WTTP9999  RETURN
+
.******************************************************************************
.           Process Reconciliation CSV format
.******************************************************************************
PRCSV0000 COMPARE   ONE,CSVFLAG
          GOTO      PRCSV999 IF NOT EQUAL     * Not generating a CSV file
.
          MOVE      SP70,SAVDRAWR
          MOVE      ZERO,ARRNUMB
          MOVE      ZERO,CREDCOL
          MOVE      ZERO,EFTPCOL
          MOVE      ZERO,RECFLAG
.
          WHILE     F2<99
            MOVE      SP70,PAYMCOLN[F2]
            ADD       ONE,F2
          DO
.
          PACK      HDTITLE,SP70
          LOAD      HDTITLE,COPTION,TITLE1,TITLE2,TITLE3
.
          CALL      CSVH0000            * CSV format heading
          WRITE     CSVOFILE,SEQ;*+,XHDROW08
.
PRCSV020  CALL      DRHD0000            * Heading for Drawer Reconciliation
          CALL      SCOL0000            * Set column number for payment
.
          PACK      KEY18,SP70
          CALL      RSDRTMP1
PRCSV100  CALL      RKDRTMP1
          BRANCH    OVRCD,PRCSV900
.
          MATCH     SP70,SAVDRAWR
          IF        @EQUAL
            MOVE      DRAWERID,SAVDRAWR
          ENDIF
.
          MATCH     SAVDRAWR,DRAWERID
          IF        !@EQUAL
            MOVE      DRAWERID,SAVDRAWR
          ENDIF
.
          CALL      CSDRAW00               * Name of Cash drawer
          PACK      KEY15,RECEIPTN,SP70
          CALL      RSRCBDT1
PRCSV200  CALL      RKRCBDT1
          BRANCH    OVRCD,PRCSV100
.
          MATCH     RECEIPTN,RCBDRECN
          GOTO      PRCSV100 IF NOT EQUAL
.
          MOVE      RCBDPAMT,FORM12P2
          CALL      SAMT0000                * Set up payment field
          MOVE      SP70,PAYTYPE
          CALL      GPAY0000                * Get payment type
.
          IF        PAYMINDC=3
            PACK      KEY5,ANSC,ANSR,RCBDCRDT,SP70
            CALL      RDCODE1
            IF        OVRCD=0
              CLEAR     PAYTYPE
              APPEND    "Cr-",PAYTYPE
              APPEND    TDESC,PAYTYPE
              APPEND    SP70,PAYTYPE
              RESET     PAYTYPE
            ENDIF
          ENDIF
.
          IF        PAYMINDC=6
            MATCH     "2",RCBDEFTT
            IF        @EQUAL
              PACK      KEY5,ANSC,ANSR,RCBDCRDT,SP70
              CALL      RDCODE1
              IF        OVRCD=0
                CLEAR     PAYTYPE
                APPEND    "EFT-",PAYTYPE
                APPEND    TDESC,PAYTYPE
                APPEND    SP70,PAYTYPE
                RESET     PAYTYPE
              ENDIF
            ENDIF
          ENDIF
.
          UNPACK    RCBDPAYD,KEY28
          IF        PAYMINDC=1 | PAYMINDC=9
            STRIP     RCBDRECN
            STRIP     KEY28
            STRIP     PAYTYPE
.
            SQUEEZE   RCBDRECN
            STRIP     RCBDRECN
            WRITE     CSVOFILE,SEQ;*+,DRAWNAME,COMMA,RCBDRECN,COMMA,KEY28,COMMA:
                                      PAYTYPE,COMMA,DPYAMNT,COMMA;
            CALL      GREF0000                 * Get reference details
            CALL      PCLN0000                 * print COMMA
            WRITE     CSVOFILE,SEQ;*+,DPYAMNT,COMMA;
            ADD       ONE,CURCOLN
          ELSE
            IF        PAYMINDC=2
              UNPACK    RCBDDRAW,KEY28
            ENDIF
            STRIP     KEY28
            STRIP     PAYTYPE
            SQUEEZE   RCBDRECN
            STRIP     RCBDRECN
            WRITE     CSVOFILE,SEQ;*+,DRAWNAME,COMMA,RCBDRECN,COMMA,KEY28,COMMA:
                                      PAYTYPE,COMMA,DPYAMNT,COMMA;
            CALL      GREF0000                 * Get reference details
            CALL      PCLN0000                 * print COMMA
            WRITE     CSVOFILE,SEQ;*+,DPYAMNT,COMMA;
            ADD       ONE,CURCOLN
          ENDIF
          CALL      PZER0000                 * Print zero dollars
          MOVE      ONE,RECFLAG
.
          IF        COPTION=2
            PACK      KEY12,RECEIPTN,SP70
            CALL      RDRCBNK1
            IF        OVRCD=0
              MOVE      RECDATE,RCBNRDAT
              PACK      RCBNRTIM,CTIMEIS,SP70
              CALL      UPRCBNK1
            ENDIF
          ENDIF
.
          GOTO      PRCSV200
.
PRCSV900  COMPARE   ZERO,RECFLAG
          GOTO      PRCSV9999 IF EQUAL    * No Rrecord
.
          CALL      DRTT0000              * Print Total of each cash drawers
          CALL      GNTT0000              * Print Grand Totals
.
PRCSV9999  RETURN
+
.******************************************************************************
.*                   Cash drawer
.******************************************************************************
CSDRAW00  PACK      KEY6,DRAWERID,SP70
          CALL      RDCIDA1
          IF        OVRCD=1
            UNPACK    SP70,RCPSUR,RCPGIVEN
          ENDIF
          SQUEEZE   RCPGIVEN
          SQUEEZE   RCPSUR
          PACK      DRAWER,RCPSUR,SP1,RCPGIVEN,SP70
          MOVE      DRAWER,DRAWNAME
          STRIP     DRAWNAME
CSDRAW99  RETURN
+
.******************************************************************************
.         Get Payment Reference details
.******************************************************************************
GREF0000  IF        PAYMINDC=2
            PACK      DIM6,RCBDBANK,SP70
            PACK      DIM12,RCBDBRCH,SP70
            SQUEEZE   RCBDCHQN
            CLEAR     KEY50
            APPEND    "Chq No:",KEY50
            APPEND    RCBDCHQN,KEY50
            MATCH     SP70,DIM6
            IF        !@EQUAL
              APPEND    " Bank:",KEY50
              APPEND    DIM6,KEY50
            ENDIF
            MATCH     SP70,DIM12
            IF        !@EQUAL
              APPEND    " Branch:",KEY50
              APPEND    DIM12,KEY50
            ENDIF
            APPEND    SP70,KEY50
            RESET     KEY50
            STRIP     KEY50
.
            WRITE     CSVOFILE,SEQ;*+,KEY50,COMMA;
            GOTO      GREF9999
          ENDIF
          IF        PAYMINDC=3
            PACK      KEY5,ANSC,ANSR,RCBDCRDT,SP70
            CALL      RDCODE1
            IF        OVRCD<>1
              STRIP     TDESC
              WRITE     CSVOFILE,SEQ;*+,TDESC,COMMA;
              GOTO      GREF9999
            ENDIF
          ENDIF
          IF        PAYMINDC=4|PAYMINDC=6|PAYMINDC=7|PAYMINDC=8
            STRIP     RCBDSTRF
            WRITE     CSVOFILE,SEQ;*+,RCBDSTRF,COMMA;
            GOTO      GREF9999
          ENDIF
          IF        PAYMINDC=5
            STRIP     RCBDCHQN
            WRITE     CSVOFILE,SEQ;*+,RCBDCHQN,COMMA;
            GOTO      GREF9999
          ENDIF
.
          IF        PAYMINDC>9
            STRIP     RCBDSTRF
            WRITE     CSVOFILE,SEQ;*+,RCBDSTRF,COMMA;
            GOTO      GREF9999
          ENDIF
          WRITE     CSVOFILE,SEQ;*+,COMMA;
GREF9999  RETURN
+
.******************************************************************************
.*        Print Total of each cash drawers                                    *
.******************************************************************************
DRTT0000  MOVE      ZERO,GNDTOTAL
          MOVE      ZERO,GNSTOTAL
.
          WRITE     CSVOFILE,SEQ;*+,COMMA
          WRITE     CSVOFILE,SEQ;*+,COMMA
.
          MOVE      SP70,SAVDRAWR
          MOVE      ZERO,CURCOLN
          PACK      KEY14,SP70
          CALL      RSCSVTM3
DRTT1000  CALL      RKCSVTM3
          BRANCH    OVRCD,DRTT9000
.
          MATCH     SP70,DTDRAWER
          GOTO      DRTT1000 IF EQUAL      * Skip
          MATCH     "zzzzzz",DTDRAWER
          GOTO      DRTT9000 IF EQUAL      * Skip
          MATCH     "zzz",DTPYTYPE
          GOTO      DRTT1000 IF EQUAL      * Skip
.
          MATCH     SP70,SAVDRAWR
          IF        @EQUAL
            MOVE      DTDRAWER,SAVDRAWR
            MOVE      ZERO,F2
            MOVE      ZERO,CURCOLN
          ELSE
            MATCH     SAVDRAWR,DTDRAWER
            GOTO      DRTT3000 IF EQUAL    * same drawer
.
            CALL      PZER0000                 * Print zero dollars
            MOVE      ZERO,F2
            MOVE      ZERO,CURCOLN
          ENDIF
.
.         Print drawer name and total payment for the drawer
.
          MOVE      DTDRAWER,DRAWERID
          CALL      CSDRAW00               * Name of Cash drawer
          MOVE      ZERO,FORM2
          MOVE      DTCOLNUM,FORM2
.
.         Get total payment for a drawer
.
          PACK      SAVKEY14,DTDRAWER,DTCOLNUM,DTPYTYPE,DTCRTYPE   * save key
          MOVE      "zzzzzz",KEY6
          PACK      KEY12,DTDRAWER,KEY6
          CALL      RDCSVTM1
          BRANCH    OVRCD,DRTT1000
.
          ADD       DTAMOUNT,GNDTOTAL       * Total for all drawer
          MOVE      DTAMOUNT,FORM12P2
          CALL      SAMT0000                * Set up payment field
.
          WRITE     CSVOFILE,SEQ;*+,COMMA,COMMA,COMMA:
                             "Total ",DRAWNAME,COMMA;
.
          WRITE     CSVOFILE,SEQ;*+,DPYAMNT,COMMA,COMMA;
          ADD       ONE,F2
.
          MOVE      SAVKEY14,KEY14
          CALL      RDCSVTM3               * Reposition
.
DRTT3000  MOVE      DTCOLNUM,FORM2
          WHILE     F2<FORM2
            WRITE     CSVOFILE,SEQ;*+,ZDOLLAR,COMMA;
            ADD       ONE,F2
            ADD       ONE,CURCOLN
          DO
.
          MOVE      DTAMOUNT,FORM12P2      * amount for the payment type
          CALL      SAMT0000               * Set up payment field
.
          WRITE     CSVOFILE,SEQ;*+,DPYAMNT,COMMA;
          ADD       ONE,F2
          ADD       ONE,CURCOLN
.
          MOVE      DTDRAWER,SAVDRAWR      * save drawer id
          GOTO      DRTT1000
.
DRTT9000  CALL      PZER0000               * Print zero dollars
DRTT9999  RETURN
+
.******************************************************************************
.*        Print Grand Total                                                   *
.******************************************************************************
GNTT0000  WRITE     CSVOFILE,SEQ;*+,COMMA,COMMA,COMMA:
                             "Grand Total ",COMMA;
.
.         Grand total for all drawer
.
          MOVE      ZERO,F2
          MOVE      ZERO,CURCOLN
          MOVE      GNDTOTAL,FORM12P2
          CALL      SAMT0000                * Set up payment field
.
          WRITE     CSVOFILE,SEQ;*+,DPYAMNT,COMMA,COMMA;
          ADD       ONE,F2
.
          MOVE      "zzzzzz",DTDRAWER
          PACK      KEY14,DTDRAWER,SP70
          CALL      RSCSVTM3
GNTT1000  CALL      RKCSVTM3
          BRANCH    OVRCD,GNTT9000
.
          MATCH     "zzzzzz",DTDRAWER
          GOTO      GNTT9000 IF NOT EQUAL
.
          MOVE      DTCOLNUM,FORM2
          WHILE     F2<FORM2
            WRITE     CSVOFILE,SEQ;*+,ZDOLLAR,COMMA;
            ADD       ONE,F2
            ADD       ONE,CURCOLN
          DO
.
          MOVE      DTAMOUNT,FORM12P2      * amount for the payment type
          CALL      SAMT0000               * Set up payment field
.
          WRITE     CSVOFILE,SEQ;*+,DPYAMNT,COMMA;
          ADD       ONE,F2
          ADD       ONE,CURCOLN
.
          GOTO      GNTT1000
.
GNTT9000  CALL      PZER0000               * Print zero dollars
GNTT9999  RETURN
+
.******************************************************************************
.*                   Print blank column                                       *
.******************************************************************************
PCLN0000  MOVE      ZERO,CURCOLN
          MOVE      PAYMINDC,FORM2
          COMPARE   ZERO,FORM2
          GOTO      PCLN9999 IF EQUAL
.
          MOVE      PAYMINDC,ARRNUMB          * default to payment type
.
          COMPARE   THREE,PAYMINDC
          GOTO      PCLN2000 IF NOT EQUAL     * Not a credit card
.
          MOVE      PAYMINDC,KEY2
          PACK      KEY5,KEY2,RCBDCRDT,SP70
          SUB       ONE,ARRNUMB
          CALL      CARR0000                  * Check the array variable
          GOTO      PCLN8000
.
PCLN2000  COMPARE   SIX,PAYMINDC
          GOTO      PCLN4000 IF NOT EQUAL     * Not an EFTPOS
.
          MOVE      PAYMINDC,KEY2
          PACK      KEY5,KEY2,SP70            * Cash EFTPOS
          MATCH     "2",RCBDEFTT
          IF        @EQUAL
            PACK      KEY5,KEY2,RCBDCRDT,SP70
          ENDIF
          SUB       TWO,ARRNUMB
          CALL      CARR0000                  * Check the array variable
          GOTO      PCLN8000
.
PCLN4000  IF        PAYMINDC>3 & PAYMINDC<6
            SUB       TWO,ARRNUMB
            ADD       CREDCOL,ARRNUMB         * Add Credit card column number
            GOTO      PCLN8000
          ELSE
            IF        PAYMINDC>6
              SUB       THREE,ARRNUMB
              ADD       CREDCOL,ARRNUMB       * Add Credit card column number
              ADD       EFTPCOL,ARRNUMB       * Add EFTPOS column number
              GOTO      PCLN8000
            ENDIF
          ENDIF
          SUB       ONE,ARRNUMB
.
PCLN8000  MOVE      ONE,F2
          WHILE     F2<=ARRNUMB
            WRITE     CSVOFILE,SEQ;*+,ZDOLLAR,COMMA;
            ADD       ONE,F2
            ADD       ONE,CURCOLN
          DO
PCLN9999  RETURN
+
.******************************************************************************
.*                   Get the column number from the array variable            *
.******************************************************************************
CARR0000  MOVE      CREDCOL,FORM2
          ADD       EFTPCOL,FORM2       * No of columns for Cr.card & EFTPOS
          MOVE      ONE,F2
          WHILE     F2<=FORM2
            PACK      DIM5,PAYMCOLN[F2],SP70
            MATCH     KEY5,DIM5
            GOTO      CARR9999 IF EQUAL
            ADD       ONE,F2
            ADD       ONE,ARRNUMB          * add extra lines
          DO
CARR9999  RETURN
+
.******************************************************************************
.*                   Heading for Cash Drawer Reconciliation                   *
.******************************************************************************
DRHD0000  IF        PRTOTFLG=1
            WRITE     CSVOFILE,SEQ;*+,COMMA,COMMA,COMMA,COMMA:
                                      COMMA,COMMA;
          ELSE
            WRITE     CSVOFILE,SEQ;*+,"Cash Drawer",COMMA,"Receipt",COMMA:
                                 "Payer",COMMA,"Payment Type",COMMA:
                                 "Amount",COMMA,"Reference",COMMA;
          ENDIF
.
          CALL      CSHD0000     * heading for Payment types
.
DRHD9999  RETURN
+
.******************************************************************************
.*                   CSV format Heading                                       *
.******************************************************************************
CSVH0000  UNPACK    SP70,XHDROW01
          UNPACK    SP70,XHDROW02
          UNPACK    SP70,XHDROW04
          UNPACK    SP70,XHDROW05
.
          PACK      KEY10,CDD,SLASH,CMM,SLASH,CCC,CYY
          PACK      XHDROW01,CNAME,SP1,KEY10,SP1,CSVCTIME,SP70
          WRITE     CSVOFILE,SEQ;*+,XHDROW01,COMMA
.
          IF        COPTION=1
            MOVE      "Interim Cash Reconciliation CSV Export",XHDROW02
          ELSE
            IF        COPTION=2
              MOVE      "Final Cash Reconciliation CSV Export",XHDROW02
            ELSE
              MOVE      "Reprint Cash Reconciliation CSV Export",XHDROW02
            ENDIF
          ENDIF
          WRITE     CSVOFILE,SEQ;*+,XHDROW02,COMMA
          WRITE     CSVOFILE,SEQ;*+,COMMA,COMMA         * blank row 3
.
          PACK      XHDROW04,HDTITLE,DISPLDTE,COMMA,SP70
          WRITE     CSVOFILE,SEQ;*+,XHDROW04,COMMA
.
          PACK      XHDROW05,SP70
          IF        IBCNMHOS=1
            PACK      KEY3,WBSEHOSP,SP70
            CALL      RDPTHSP1
            IF        OVRCD=0
              MOVE      "Hospital:",KEY9
              MOVE      "-",KEY1
              PACK      XHDROW05,KEY9,WBSEHOSP,KEY1,PTHSNAME,COMMA,SP70
            ENDIF
          ENDIF
          WRITE     CSVOFILE,SEQ;*+,XHDROW05
.
          WRITE     CSVOFILE,SEQ;*+,COMMA,COMMA  * blank - line 6
          WRITE     CSVOFILE,SEQ;*+,COMMA,COMMA  * blank - line 7
.
CSVH9999  RETURN
+
.******************************************************************************
.         Set column number for payments heading
.******************************************************************************
SCOL0000  MOVE      ZERO,DRAWCOL
          MOVE      SP70,SAVKEY2
          PACK      KEY9,CODEPY,SP70
          CALL      RDSCODE5
SCOL1000  CALL      RDKCODE5
          BRANCH    OVRCD,SCOL9999
.
          MATCH     CODEPY,TCODE
          GOTO      SCOL9999 IF NOT EQUAL
.
          MATCH     "A",PTCOACTV
          GOTO      SCOL1000 IF NOT EQUAL     * Not active
.
          SQUEEZE   PTCDNHCP
          MOVE      PTCDNHCP,PAYMINDC
.
          MOVE      ZERO,F2
          MOVE      PTCDNHCP,F2
          MOVE      F2,DIM2
          MATCH     SAVKEY2,DIM2
          GOTO      SCOL1000 IF EQUAL      * Same payment type
.
          PACK      KEY20,TDESC
          PACK      KEY12,TDESC
          MOVE      DIM2,SAVKEY2
.
          MOVE      SP70,KEY3
          BRANCH    F2,SCOL8000,SCOL8000,SCOL3000,SCOL8000,SCOL8000:
                       SCOL6000,SCOL8000,SCOL8000,SCOL8000
          SUB       NINE,F2
          COMPARE   ZERO,F2
          GOTO      SCOL1000 IF LESS
          GOTO      SCOL8000
.
.         Credit card
.
SCOL3000  MOVE      ZERO,FORM2
          IF        CREDCOL<>0
            WHILE     FORM2<CREDCOL
              ADD       ONE,FORM2
              UNPACK    PAYMCOLN[FORM2],KEY2,KEY3   * payment type,card type
              MATCH     " 3",KEY2                   * Credit card payment
              IF        @EQUAL
                CALL      UTMP0000                  * Update column number
              ENDIF
            DO
          ENDIF
          GOTO      SCOL1000
.
.         EFTPOS
.
SCOL6000  MOVE      ZERO,FORM2
          IF        EFTPCOL<>0
            MOVE      CREDCOL,ARRNUMB       * Add Credit card column number
            ADD       EFTPCOL,ARRNUMB       * Add EFTPOS column number
            WHILE     FORM2<ARRNUMB
              ADD       ONE,FORM2
              UNPACK    PAYMCOLN[FORM2],KEY2,KEY3   * payment type,card type
              MATCH     " 6",KEY2                   * EFTPOS payment
              IF        @EQUAL
                CALL      UTMP0000               * Update column number
              ENDIF
            DO
          ENDIF
          GOTO      SCOL1000
.
SCOL8000  CALL      UTMP0000               * Update column number
          GOTO      SCOL1000
.
SCOL9999  RETURN
+
.******************************************************************************
.         Update column number of the tempfile
.******************************************************************************
UTMP0000  ADD       ONE,DRAWCOL
          PACK      KEY12,ACODE,KEY3,SP70
          CALL      RDCSVTM2
          COMPARE   ZERO,OVRCD
          GOTO      UTMP3000 IF EQUAL
          CALL      RSCSVTM2
UTMP2000  CALL      RKCSVTM2
          BRANCH    OVRCD,UTMP9999
.
          MATCH     ACODE,DTPYTYPE          * Same payment type
          GOTO      UTMP9999 IF NOT EQUAL
          MATCH     KEY3,DTCRTYPE
          GOTO      UTMP9999 IF NOT EQUAL
.
UTMP3000  MOVE      DRAWCOL,DTCOLNUM      * Update column number
          CALL      UPCSVTM2
          GOTO      UTMP2000
UTMP9999  RETURN
+
.******************************************************************************
.         Output payments heading
.******************************************************************************
CSHD0000  MOVE      ONE,HEADFLAG
          MOVE      ZERO,TOTCOLN
          MOVE      SP70,SAVKEY2
          PACK      KEY9,CODEPY,SP70
          CALL      RDSCODE5
CSHD0200  CALL      RDKCODE5
          BRANCH    OVRCD,CSHD9900
.
          MATCH     CODEPY,TCODE
          GOTO      CSHD9900 IF NOT EQUAL
.
          MATCH     "A",PTCOACTV
          GOTO      CSHD0200 IF NOT EQUAL     * Not active
.
          SQUEEZE   PTCDNHCP
          MOVE      ZERO,F2
          MOVE      PTCDNHCP,F2
          MOVE      F2,DIM2
          MATCH     SAVKEY2,DIM2
          GOTO      CSHD0200 IF EQUAL      * Same payment type
.
          PACK      KEY20,TDESC
          PACK      KEY12,TDESC
          MOVE      DIM2,SAVKEY2
.
          BRANCH    F2,CSHD9800,CSHD9800,CSHD3000,CSHD9800,CSHD9800:
                       CSHD6000,CSHD9800,CSHD9800,CSHD9800
          SUB       NINE,F2
          COMPARE   ZERO,F2
          GOTO      CSHD9900 IF LESS
          GOTO      CSHD9800
.
CSHD3000  CALL      PCRH0000                * Print credit cards heading
          GOTO      CSHD0200
.
CSHD6000  CALL      PEFH0000                * Print EFTPOS heading
          GOTO      CSHD0200
.
CSHD9800  STRIP     KEY20
          WRITE     CSVOFILE,SEQ;*+,KEY20,COMMA;
          ADD       ONE,TOTCOLN
          GOTO      CSHD0200
.
CSHD9900  WRITE     CSVOFILE,SEQ;*+,COMMA,COMMA
CSHD9999  RETURN
+
.******************************************************************************
.         Print Credit cards heading
.******************************************************************************
PCRH0000  MOVE      KEY20,SAVPDESC
          UNPACK    SP70,SAVKEY1,SAVCCODE
          MOVE      ZERO,ENDFLAG
          PACK      KEY10,SP70
          CALL      RSCREDF2
PCRH1000  CALL      RKCREDF2
          BRANCH    OVRCD,PCRH6000
.
          MATCH     SP70,SAVKEY1
          GOTO      PCRH2000 IF NOT EQUAL
.
          MATCH     SP70,SAVCCODE
          GOTO      PCRH8000 IF EQUAL
.
PCRH2000  MATCH     SAVKEY1,CREDINDC
          GOTO      PCRH7000 IF NOT EQUAL
          MATCH     SAVCCODE,CREDCODE
          GOTO      PCRH7000 IF NOT EQUAL
          GOTO      PCRH8000
.
PCRH6000  MOVE      ONE,ENDFLAG
          MATCH     SP70,SAVCCODE
          GOTO      PCRH9999 IF EQUAL
.
PCRH7000  MOVE      "Invalid Cr.Card",KEY15
          PACK      KEY5,CODECR,SAVCCODE
          CALL      RDCODE1
          IF        OVRCD=0
            PACK      KEY15,TDESC,SP70
          ENDIF
          STRIP     KEY15
          WRITE     CSVOFILE,SEQ;*+,KEY15,COMMA;
          ADD       ONE,ARRNUMB
          ADD       ONE,TOTCOLN
          PACK      PAYMCOLN[ARRNUMB],SAVKEY2,SAVCCODE * payment type,card type
          ADD       ONE,CREDCOL
.
PCRH7200  BRANCH    ENDFLAG,PCRH9999
.
PCRH8000  MOVE      CREDINDC,SAVKEY1
          MOVE      CREDCODE,SAVCCODE
          GOTO      PCRH1000
.
PCRH9999  RETURN
+
.******************************************************************************
.         Print EFTPOS heading
.******************************************************************************
PEFH0000  MOVE      KEY20,SAVPDESC
          MOVE      SP70,SAVCCODE
          MOVE      SP70,SAVKEY1
          MOVE      ZERO,ENDFLAG

.         Check for Chq/Sav EFTPOS
.
          MOVE      "0",KEY1                  * for cash
          PACK      KEY10,KEY1,SP70
          CALL      RSEFTPF2
          CALL      RKEFTPF2
          BRANCH    OVRCD,PEFH0800
          MATCH     KEY1,EFTPINDC             * Cash ?
          GOTO      PEFH0800 IF NOT EQUAL     * check EFTPOS credit card
.
          UNPACK    SAVPDESC,DIM10
          CLEAR     KEY18
          APPEND    DIM10,KEY18
          APPEND    "-Chq/Sav",KEY18
          APPEND    SP70,KEY18
          RESET     KEY18
          STRIP     KEY18
          WRITE     CSVOFILE,SEQ;*+,KEY18,COMMA;
          ADD       ONE,ARRNUMB
          ADD       ONE,TOTCOLN
          MOVE      SP70,KEY5             * for cash
          PACK      PAYMCOLN[ARRNUMB],SAVKEY2,KEY5
          ADD       ONE,EFTPCOL
.
.         Check EFTPOS credit cards
.
PEFH0800  PACK      KEY10,SP70
          CALL      RSEFTPF2
PEFH1000  CALL      RKEFTPF2
          BRANCH    OVRCD,PEFH6000
.
          MATCH     "0",EFTPINDC
          GOTO      PEFH1000 IF EQUAL         * Cash, printed it already
.
          MATCH     SP70,SAVKEY1
          GOTO      PEFH2000 IF NOT EQUAL
.
          MATCH     SP70,SAVCCODE
          GOTO      PEFH8000 IF EQUAL
.
PEFH2000  MATCH     SAVKEY1,EFTPINDC
          GOTO      PEFH7000 IF NOT EQUAL
          MATCH     SAVCCODE,EFTPCODE
          GOTO      PEFH7000 IF NOT EQUAL
          GOTO      PEFH8000
.
PEFH6000  MOVE      ONE,ENDFLAG
          MATCH     SP70,SAVCCODE
          GOTO      PEFH9999 IF EQUAL
.
PEFH7000  MOVE      "Invalid Cr.Card",KEY20
          PACK      KEY5,CODECR,SAVCCODE
          CALL      RDCODE1
          IF        OVRCD=0
            PACK      KEY20,TDESC,SP70
          ENDIF
          UNPACK    SAVPDESC,DIM10
          STRIP     DIM10
          CLEAR     KEY31
          APPEND    DIM10,KEY31
          APPEND    "-",KEY31
          APPEND    KEY20,KEY31
          APPEND    SP70,KEY31
          RESET     KEY31
          STRIP     KEY31
          WRITE     CSVOFILE,SEQ;*+,KEY31,COMMA;
          ADD       ONE,ARRNUMB
          ADD       ONE,TOTCOLN
          PACK      PAYMCOLN[ARRNUMB],SAVKEY2,SAVCCODE
          ADD       ONE,EFTPCOL
.
PEFH7200  BRANCH    ENDFLAG,PEFH9999
.
PEFH8000  MOVE      EFTPINDC,SAVKEY1
          MOVE      EFTPCODE,SAVCCODE
.
          GOTO      PEFH1000
.
PEFH9999  RETURN
+
.****************************************************************************
.         Get payment type
.****************************************************************************
GPAY0000  MOVE      RCBDPTYP,F1
          MOVE      F1,PAYMINDC
.
          MATCH     SP70,RCBDPCOD
          GOTO      GPAY9999 IF EQUAL
.
          PACK      KEY5,CODEPY,RCBDPCOD
          CALL      RDCODE1
          BRANCH    OVRCD,GPAY9999
.
          MOVE      TDESC,PAYTYPE
.
          MOVE      SP70,KEY2
          SQUEEZE   PTCDNHCP
          MOVE      PTCDNHCP,PAYMINDC
.
GPAY9999  RETURN
+
.****************************************************************************
.*                                PRSYS000             Called by: PRREC000  *
.*            Process system reconciliation tempfile records                *
.****************************************************************************
PRSYS000  MOVE      ZERO,CLNO
          MOVE      ZERO,TOTTOTAL
          MOVE      ZERO,TOTAMT
          MOVE      ZERO,TOTAAMT
          MOVE      ZERO,TOTDIS
          MOVE      ZERO,TOTTOAMT
          MOVE      ZERO,TOTTODIS
          MOVE      ZERO,TOTALAMT
          MOVE      SP70,SAVDRAWR
          MOVE      SP70,SAVREG
          MOVE      ZERO,TREGAMT
          MOVE      ZERO,TREGDIS
          MOVE      ZERO,TALOAMT
          MOVE      ZERO,FRSTFLAG
          MOVE      SP70,RECNSAVE
          MOVE      SP70,SAVKEY41
          MOVE      SP70,SAVRECPT
.
          IF        CSVFLAG=1
            WRITE     CSVOFILE,SEQ;*+,COMMA
            WRITE     CSVOFILE,SEQ;*+,XHDROW09
            WRITE     CSVOFILE,SEQ;*+,"Cash Drawer",COMMA,"Register",COMMA:
                           "System",COMMA,"Receipt Number",COMMA:
                           "Inv/Adm/Ref No",COMMA,"Patient/Payer Name",COMMA:
                           "Amount",COMMA,"Discount",COMMA
          ENDIF
.
          MATCH     "1",RCCNRCP2
          IF        @EQUAL
            PACK      KEY41,SP70
            CALL      RSDRTMP5
          ELSE
            PACK      KEY29,SP70
            CALL      RSDRTMP2
          ENDIF
.
PRSYS100  MATCH     "1",RCCNRCP2
          IF        @EQUAL
            CALL      RKDRTMP5
          ELSE
            CALL      RKDRTMP2
          ENDIF
          BRANCH    OVRCD,PRSYS900
.
          MATCH     "1",RCCNRCP2
          IF        @EQUAL
            MOVE      DRAWERID,SAVDRWID
            MOVE      REGISTER,SAVREGIS
            MOVE      RECEIPTN,SAVRECNM
            MOVE      INVOICEN,SAVINVCN
            MOVE      COUNTREC,SAVCOUNT
          ENDIF
.
          IF        FRSTFLAG=0
            CALL      SYSHED00
            MOVE      ONE,FRSTFLAG
          ENDIF
.
          MATCH     SP70,SAVDRAWR
          IF        @EQUAL
            MOVE      DRAWERID,SAVDRAWR
          ENDIF
.
          MATCH     SP70,SAVREG
          IF        @EQUAL
            MOVE      REGISTER,SAVREG
          ENDIF
.
.         Check receipt number if we are printing Cancelled receipts
.
          MATCH     SP70,SAVRECPT
          IF        @EQUAL
            MOVE      RECEIPTN,SAVRECPT
          ENDIF
          MATCH     RECEIPTN,SAVRECPT
          IF        !@EQUAL
            CALL      CAND0000                * Cancelled details
            MOVE      RECEIPTN,SAVRECPT
          ENDIF
.
          MATCH     SAVDRAWR,DRAWERID
          IF        !@EQUAL
            CALL      REGTOT00               * print total for register
            MOVE      REGISTER,SAVREG
            CALL      SYSTOT00               * print total for drawer
            MOVE      DRAWERID,SAVDRAWR
            MOVE      ZERO,TOTAMT
            MOVE      ZERO,TOTAAMT
            MOVE      ZERO,TOTDIS
            CALL      SYSHED00               * print header for next drawer
            GOTO      PRSYS140
          ENDIF
.
          MATCH     SAVREG,REGISTER
          GOTO      PRSYS140 IF EQUAL
.
          CALL      REGTOT00                 * print total for register
          MOVE      REGISTER,SAVREG
.
          IF        SPAGFLAG=1
            CALL      SYSHED00
          ENDIF
.
PRSYS140  PACK      KEY3,REGISTER,SP70
          CALL      RDREGA1
          IF        OVRCD=1
            MOVE      "Invalid Register    ",DESCREG
          ELSE
            PACK      DESCREG,REGDESC,SP70
          ENDIF
.
          MOVE      SP70,SYSDESC
          CALL      GETSYS00
.
          MATCH     SP70,INVOICEN
          IF        @EQUAL
            PACK      INVOICEN,VISNUMB,SP70
          ENDIF
.
          PACK      PATNAM,SP70
.
          MATCH     "0",SCFLAG
          GOTO      PRSYS200 IF NOT EQUAL
.
          PACK      KEY8,URNUMB,SP70
          CALL      RDDBDB1
          IF        OVRCD<>1
            SQUEEZE   DBDBNA2
            PACK      PATNAM,DBDBNA2,SP1,DBDBNA1,SP70
          ENDIF
          GOTO      PRSYS300
.
PRSYS200  PACK      KEY8,URNUMB,SP70
          CALL      RDMAST1
          IF        OVRCD<>1
            SQUEEZE   PGNAME
            PACK      PATNAM,PGNAME,SP1,PSNAME,SP70
          ENDIF
.
PRSYS300  BRANCH    CRECFLAG,PRSYS400       * Printing cancelled receipts
          CALL      PRPAY000
.
          IF        REGIBACD=92|REGIBACD=94|REGIBACD=95|REGIBACD=98|REGIBACD=99|REGIBACD=89
            PRINT     *1,DESCREG,*22,SYSDESC,*44,RECEIPTN,*57,REFERENC:
                      *75,PNAME,*102,INAMOUNT,*118,DSAMOUNT
          ELSE                                               * start  *C-233901
            MOVE      SP2,KEY2
            IF        COPTION = 7
              MATCH     SP8,ALOCDATE
              IF        !@EQUAL
                MOVE      " *",KEY2
              ENDIF
            ENDIF
            IF        COPTION = 9
              MOVE      INAMOUNT,FORM8P2A                   
              MOVE      DSAMOUNT,FORM4P2
              MOVE      ALOCAMNT,FORM8P2B
              MOVE      SP20,DIM11A
              IF        FORM8P2B > 0
                MOVE      FORM8P2B,DIM11A
              ENDIF
              PRINT     *1,DESCREG,*22,SYSDESC,*44,RECEIPTN,*62,INVOICEN:
                        *75,PATNAM,*102,DIM11A,*114,FORM8P2A,*126,FORM4P2
            ELSE
              PRINT     *1,DESCREG,*22,SYSDESC,*44,RECEIPTN,KEY2,*62,INVOICEN:
                        *75,PATNAM,*102,INAMOUNT,*118,DSAMOUNT
            ENDIF                                            * end    *C-233901
          ENDIF
          GOTO      PRSYS800
.
.         Printing Cancelled receipts
.
PRSYS400  IF        REGIBACD=92|REGIBACD=94|REGIBACD=95|REGIBACD=98|REGIBACD=99|REGIBACD=89
            PRINT     *1,DESCREG,*22,SYSDESC,*44,RECEIPTN,*57,REFERENC:
                      *75,PNAME,*102,INAMOUNT
          ELSE
            PRINT     *1,DESCREG,*22,SYSDESC,*44,RECEIPTN,*57,INVOICEN:
                      *75,PATNAM,*102,INAMOUNT
          ENDIF
.
PRSYS800  ADD       ONE,CLNO
          COMPARE   "55",CLNO
          CALL      SYSHED00 IF NOT LESS
.
          ADD       ALOCAMNT,TOTAAMT
          ADD       INAMOUNT,TOTAMT
          ADD       DSAMOUNT,TOTDIS
          ADD       ALOCAMNT,TALOAMT
          ADD       INAMOUNT,TREGAMT
          ADD       DSAMOUNT,TREGDIS
          ADD       ALOCAMNT,TOTALAMT
          ADD       INAMOUNT,TOTTOAMT
          ADD       DSAMOUNT,TOTTODIS
.
          CALL      CSVA0000               * Write to CSV file
.
          GOTO      PRSYS100
.
PRSYS900  IF        FRSTFLAG=0
            GOTO      PRSYS999
          ENDIF
          CALL      CAND0000               * Cancelled details
.
          CALL      REGTOT00               * print total for register
          CALL      SYSTOT00               * print total for drawer
.
          BRANCH    CRECFLAG,PRSYS920      * printing cancelled receipts
.
          IF        COPTION = 9
            MOVE      TOTTOAMT,FORM8P2A                      * start  *C-233901
            MOVE      TOTTODIS,FORM4P2
            MOVE      TOTALAMT,FORM8P2B
            MOVE      SP20,DIM11A
            IF        FORM8P2B > 0
              MOVE      FORM8P2B,DIM11A
              PRINT     *N,*35,"Total Monies allocated from Suspense":
                        *102,DIM11A
            ENDIF
            PRINT     *114,"-------------------":
                      *N,*35,"System Total",*114,FORM8P2A,*126,FORM4P2:
                      *N,*114,"-------------------"
          ELSE
            PRINT     *102,"-------------------------------":
                      *N,*35,"System Total",*102,TOTTOAMT,*118,TOTTODIS:
                      *N,*102,"-------------------------------"
          ENDIF                                              * end    *C-233901
          GOTO      PRSYS980
.
.         Printing cancelled receipts
.
PRSYS920  PRINT     *102,"---------------":
                    *N,*35,"System Total",*102,TOTTOAMT:
                    *N,*102,"---------------"
.
PRSYS980  ADD       THREE,CLNO
.
          CALL      DRGT0000               * print total for drawer & register
.
          IF        CSVFLAG=1
            PRINT     *1,"Generated CSV File is : ",CSVFNAME,".csv"
          ENDIF
.
PRSYS999  RETURN
+
.****************************************************************************
.         Print cancelled receipt details
.****************************************************************************
CAND0000  COMPARE   ONE,CRECFLAG               * printing cancelled receipts
          GOTO      CAND9999 IF NOT EQUAL
.
          MOVE      SAVRECPT,KEY12
          CALL      RDRCBNK1
          BRANCH    OVRCD,CAND9999
.
          MOVE      RCBNUDAT,DIM8              * Date record Updated
          MOVE      RCBNUTIM,KEY8
          PACK      KEY10,RCBNUUID,SP70
          MATCH     SP70,RCBNUDAT
          IF        @EQUAL
            MOVE      RCBNCDAT,DIM8            * Use created date
            MOVE      RCBNCTIM,KEY8
            PACK      KEY10,RCBNCUID,SP70
          ENDIF
          CALL      RDWBSE1
          IF        OVRCD=1
            MOVE      KEY10,WBSENAM
          ENDIF
          STRIP     WBSENAM
          MOVE      ZERO,FORM2
          MOVELPTR  WBSENAM,FORM2
          RESET     WBSENAM,FORM2
          LENSET    WBSENAM
          RESET     WBSENAM
.
          UNPACK    DIM8,CCENT,CYEAR,CMON,CDAY
          CALL      PACDATE
.
          PRINT     *1,"Cancelled By ",*+,WBSENAM," @ ",CPCDATE," ",KEY8
          ADD       ONE,CLNO
.
CAND9999  RETURN
+
.****************************************************************************
.         Write to CSV file
.****************************************************************************
CSVA0000  COMPARE   ONE,CSVFLAG
          GOTO      CSVA9999 IF NOT EQUAL     * Not generating a CSV file
.
          STRIP     DESCREG
          CALL      RDDRAW00               * name of drawer
          STRIP     DRAWER
.
          MOVE      INAMOUNT,FORM12P2
          CALL      SAMT0000                * Set up payment field
.
          STRIP     SYSDESC
          MOVE      RECEIPTN,KEY12
          SQUEEZE   KEY12
.
          STRIP     REFERENC
.
          MOVE      INVOICEN,DIM12
          SQUEEZE   DIM12
.
          IF        REGIBACD=92|REGIBACD=94|REGIBACD=95|REGIBACD=98|REGIBACD=99|REGIBACD=89
            PACK      KEY30,PNAME,SP70
            CALL      DBQU0000                   * Check for quote in field
            UNPACK    KEY30,PNAME
            STRIP     PNAME
            WRITE     CSVOFILE,SEQ;*+,DRAWER,COMMA,DESCREG,COMMA,SYSDESC,COMMA:
                                      KEY12,COMMA,REFERENC,COMMA:
                                      PNAME,COMMA,DPYAMNT,COMMA;
            MOVE      DSAMOUNT,FORM12P2       * discount
            CALL      SAMT0000                * Set up payment field
            WRITE     CSVOFILE,SEQ;*+,DPYAMNT,COMMA
          ELSE
            PACK      KEY30,PATNAM,SP70
            CALL      DBQU0000                   * Check for quote in field
            UNPACK    KEY30,PATNAM
            STRIP     PATNAM
            WRITE     CSVOFILE,SEQ;*+,DRAWER,COMMA,DESCREG,COMMA,SYSDESC,COMMA:
                                      KEY12,COMMA,DIM12,COMMA:
                                      PATNAM,COMMA,DPYAMNT,COMMA;
            MOVE      DSAMOUNT,FORM12P2       * discount
            CALL      SAMT0000                * Set up payment field
            WRITE     CSVOFILE,SEQ;*+,DPYAMNT,COMMA
          ENDIF
CSVA9999  RETURN
+
.****************************************************************************
.*                                DBQU0000                                  *
.*                    Check for any quote in the txt field                  *
.****************************************************************************
DBQU0000  SCAN      DQUOTCHR,KEY30             * check for double quote
          GOTO      DBQU9999 IF NOT EQUAL
.
          MOVEFPTR  KEY30,CCITEM
          UNPACK    KEY30,KEY25
          RESET     KEY30,CCITEM
          APPEND    KEY25,KEY30
          RESET     KEY30
DBQU9999  RETURN
+
.****************************************************************************
.*                                PZER0000                                  *
.*                    Print zero dollars till end of line                   *
.****************************************************************************
PZER0000  WHILE     CURCOLN<TOTCOLN
            WRITE     CSVOFILE,SEQ;*+,ZDOLLAR,COMMA;
            ADD       ONE,CURCOLN
          DO
          WRITE     CSVOFILE,SEQ;*+,COMMA
PZER9999  RETURN
+
.****************************************************************************
.*                                DRGT0000                                  *
.*                    Total for drawer and register                         *
.****************************************************************************
DRGT0000  COMPARE   ONE,CSVFLAG
          GOTO      DRGT9999 IF NOT EQUAL     * Not generating a CSV file
.
          MOVE      ZERO,FRSTFLAG
          MOVE      SP70,SAVDRAWR
          MOVE      ZERO,GNDTOTAL
          MOVE      SP70,SAVKEY29
.
          WRITE     CSVOFILE,SEQ;*+,COMMA
          WRITE     CSVOFILE,SEQ;*+,COMMA
.
          WRITE     CSVOFILE,SEQ;*+,COMMA,COMMA:
                                    COMMA,COMMA:
                                    COMMA,COMMA:
                                    "Amount",COMMA,"Discount",COMMA
.
          PACK      KEY29,SP70
          CALL      RSDRTMP2
DRGT1000  CALL      RKDRTMP2
          BRANCH    OVRCD,DRGT4000
.
          MATCH     ZED40,DRAWERID
          GOTO      DRGT4000 IF EQUAL       * Must be grand total record
.
          MATCH     ZED40,REGISTER
          GOTO      DRGT1000 IF EQUAL       * Must be grand total record
          PACK      KEY20,INVOICEN,COUNTREC,SP70
          MATCH     ZED40,KEY20
          GOTO      DRGT1000 IF NOT EQUAL
.
          PACK      KEY3,REGISTER,SP70
          CALL      RDREGA1
          IF        OVRCD=1
            MOVE      "Invalid Register    ",DESCREG
          ELSE
            PACK      DESCREG,REGDESC,SP70
          ENDIF
.
          MATCH     SP70,SAVDRAWR
          GOTO      DRGT2000 IF EQUAL
.
          MATCH     SAVDRAWR,DRAWERID
          GOTO      DRGT2000 IF EQUAL
.
          PACK      SAVKEY29,DRAWERID,REGISTER,INVOICEN,COUNTREC
.
.         Print total of Drawer
.
DRGT1200  CLEAR     KEY100
          APPEND    "Total ",KEY100
          APPEND    DRAWER,KEY100
          RESET     KEY100
          STRIP     KEY100
.
          PACK      KEY29,SAVDRAWR,ZED40
          CALL      RDDRTMP2
          IF        OVRCD=1
            MOVE      ZERO,INAMOUNT
            MOVE      ZERO,DSAMOUNT
          ENDIF
.
          MOVE      INAMOUNT,FORM12P2
          CALL      SAMT0000                * Set up payment field
          WRITE     CSVOFILE,SEQ;*+,COMMA,COMMA,COMMA,COMMA,COMMA:
                             KEY100,COMMA,DPYAMNT,COMMA;
.
          MOVE      DSAMOUNT,FORM12P2       * discount
          CALL      SAMT0000                * Set up payment field
          WRITE     CSVOFILE,SEQ;*+,DPYAMNT,COMMA
.
          MATCH     SP70,SAVKEY29
          GOTO      DRGT8000 IF EQUAL
.
          MOVE      SAVKEY29,KEY29
          CALL      RDDRTMP2                * reposition
.
.         Print total amount for drawer and register
.
DRGT2000  CALL      RDDRAW00                * get drawer name
          BRANCH    OVRCD,DRGT1000          * invalid register
          STRIP     DRAWER
.
          CLEAR     KEY100
          APPEND    "Total ",KEY100
          APPEND    DRAWER,KEY100
          APPEND    "-",KEY100
          APPEND    DESCREG,KEY100
          RESET     KEY100
          STRIP     KEY100
.
          MOVE      INAMOUNT,FORM12P2
          CALL      SAMT0000                * Set up payment field
          WRITE     CSVOFILE,SEQ;*+,COMMA,COMMA,COMMA,COMMA,COMMA:
                             KEY100,COMMA,DPYAMNT,COMMA;
.
          MOVE      DSAMOUNT,FORM12P2       * discount
          CALL      SAMT0000                * Set up payment field
          WRITE     CSVOFILE,SEQ;*+,DPYAMNT,COMMA
.
          ADD       INAMOUNT,GNDTOTAL         * add to the System total
          ADD       DSAMOUNT,GNSTOTAL         * add to the System total
.
          MOVE      DRAWERID,SAVDRAWR
          MOVE      ONE,FRSTFLAG
.
          GOTO      DRGT1000
.
DRGT4000  MOVE      SP70,SAVKEY29
          BRANCH    FRSTFLAG,DRGT1200      * print total of drawer
          GOTO      DRGT9999
.
DRGT8000  CALL      SREG0000               *  Print System Register Total
.
.         Print System Grand Total
.
          MOVE      "System Total",KEY12
          MOVE      GNDTOTAL,FORM12P2
          CALL      SAMT0000                * Set up payment field
.
          WRITE     CSVOFILE,SEQ;*+,COMMA,COMMA,COMMA,COMMA,COMMA:
                             KEY12,COMMA,DPYAMNT,COMMA;
.
          MOVE      GNSTOTAL,FORM12P2       * discount
          CALL      SAMT0000                * Set up payment field
          WRITE     CSVOFILE,SEQ;*+,DPYAMNT,COMMA
.
DRGT9999  RETURN
+
.****************************************************************************
.         Print Sytem register Total
.****************************************************************************
SREG0000  PACK      KEY29,SP70
          CALL      RSDRTM12
SREG1000  CALL      RKDRTM12
          BRANCH    OVRCD,SREG9999
.
          MATCH     ZED40,REGISTER
          GOTO      SREG9999 IF EQUAL              * end of file for reg.total
          MATCH     ZED40,DRAWERID
          GOTO      SREG1000 IF NOT EQUAL          * skip
          PACK      KEY20,INVOICEN,COUNTREC
          MATCH     ZED40,KEY20
          GOTO      SREG1000 IF NOT EQUAL          * skip
.
          CLEAR     KEY30
          APPEND    "System ",KEY30
          PACK      KEY3,REGISTER,SP70
          CALL      RDREGA1
          IF        OVRCD=1
            MOVE      "Invalid Register    ",DESCREG
          ELSE
            PACK      DESCREG,REGDESC,SP70
          ENDIF
          APPEND    DESCREG,KEY30
          APPEND    SP70,KEY30
          RESET     KEY30
          STRIP     KEY30
.
          MOVE      INAMOUNT,FORM12P2
          CALL      SAMT0000                * Set up payment field
.
          WRITE     CSVOFILE,SEQ;*+,COMMA,COMMA,COMMA,COMMA,COMMA:
                             KEY30,COMMA,DPYAMNT,COMMA;
.
          MOVE      DSAMOUNT,FORM12P2
          CALL      SAMT0000                * Set up payment field
          WRITE     CSVOFILE,SEQ;*+,DPYAMNT,COMMA
.
          GOTO      SREG1000
.
SREG9999  RETURN
+
.******************************************************************************
.*                                  SAMT0000                                  *
.*                  Set up the format for amount                              *
.******************************************************************************
SAMT0000  COMPARE   ZERO,FORM12P2
          GOTO      SAMT2000 IF EQUAL           * zero amount
.
          MOVE      FORM12P2,DIM15
          SQUEEZE   DIM15
          IF        FORM12P2<0
            MULT      "-1",FORM12P2
            MOVE      FORM12P2,DIM15
            SQUEEZE   DIM15
            MOVE      "-",KEY1
            PACK      DPYAMNT,KEY1,DOLLAR,DIM15,SP70  * format -$99999.99
          ELSE
            PACK      DPYAMNT,DOLLAR,DIM15,SP70       * format $99999.99
          ENDIF
          GOTO      SAMT9000
.
SAMT2000  PACK      DPYAMNT,ZDOLLAR,SP70              * format $-
.
SAMT9000  STRIP     DPYAMNT
SAMT9999  RETURN
+
.****************************************************************************
.*                                PRPAY000             Called by: PRSYS000  *
.*                    Print Payee Details from rcpbdtaf                     *
.****************************************************************************
PRPAY000  MATCH     "1",RCCNRCP2
          IF        @EQUAL
.
            MOVE    DESCREG,SAVDSCRG
            MOVE    SYSDESC,SAVSYDSC
            MOVE    REFERENC,SAVREFER
            MOVE    INVOICEN,SAVINVCV
            MOVE    PNAME,SAVPNAME
            MOVE    PATNAM,SAVPTNME
            MOVE    INAMOUNT,SAVINAMT
            MOVE    DSAMOUNT,SAVDSAMT
            MOVE    ALOCAMNT,SAVALAMT
.
            MATCH     RECNSAVE,RECEIPTN
            IF        !@EQUAL
              PRINT     *1,""
              MOVE      RECEIPTN,RECNSAVE
.           PACK      SAVKEY41,DRAWERID,REGISTER,RECEIPTN,INVOICEN,COUNTREC,SP70
              CALL      RKDRTMP5
              IF        OVRCD=0
                MATCH     RECNSAVE,RECEIPTN
                IF        @EQUAL
                  MOVE      ZERO,SAVPYFFG
                  PACK      KEY15,RECEIPTN,SP70
                  CALL      RSRCBDT1
PRPAY500          CALL      RKRCBDT1
                  IF        OVRCD=0
                    MATCH     RECEIPTN,RCBDRECN
                    IF        @EQUAL
                      PRINT     *1,"Payee: ",*22,RCBDPAYD
                      GOTO      PRPAY500
                    ENDIF
                  ENDIF
                ENDIF
              ENDIF
.
              PACK      KEY41,SAVDRWID,SAVREGIS,SAVRECNM,SAVINVCN,SAVCOUNT,SP70
              CALL      RDDRTMP5
.
            ENDIF
.
            MOVE    SAVDSCRG,DESCREG
            MOVE    SAVSYDSC,SYSDESC
            MOVE    SAVREFER,REFERENC
            MOVE    SAVINVCV,INVOICEN
            MOVE    SAVPNAME,PNAME
            MOVE    SAVPTNME,PATNAM
            MOVE    SAVINAMT,INAMOUNT
            MOVE    SAVDSAMT,DSAMOUNT
            MOVE    SAVALAMT,ALOCAMNT
.
          ENDIF
.
PRPAY999  RETURN
+
.****************************************************************************
.*                                SUMREC00             Called by: RCREG000  *
.*            Process Receipts by Register Summary                          *
.****************************************************************************
SUMREC00  MOVE      "99",CLNO
          MOVE      ZERO,FRSTFLAG
          MOVE      SP8,CONTIN
          MOVE      SP70,SAVCSHDR
          MOVE      ZERO,PHEDFLAG
          PACK      KEY17,SP20
          CALL      RSDRTMP4
SUMREC10  CALL      RKDRTMP4
          BRANCH    OVRCD,SUMREC90
.
          IF        FRSTFLAG=0
            MOVE      DRAWERID,SAVDRAWR
            MOVE      REGISTER,SAVREG
            MOVE      HEADTYPE,SAVHTYPE
            MOVE      ONE,PHEDFLAG
            CALL      SUMHED00
            MOVE      ONE,FRSTFLAG
          ENDIF
.
          MATCH     SAVDRAWR,DRAWERID
          IF        !@EQUAL
            MOVE      SP8,CONTIN
            CALL      SUMEND00
            MOVE      ONE,PHEDFLAG
            CALL      SUMHED00
            MOVE      DRAWERID,SAVDRAWR
            MOVE      HEADTYPE,SAVHTYPE
          ENDIF
.
          MATCH     SAVREG,REGISTER
          IF        !@EQUAL
            MOVE      REGISTER,SAVREG
          ENDIF
.
          MATCH     SAVHTYPE,HEADTYPE
          IF        !@EQUAL
            MOVE      SP8,CONTIN
            CALL      SUMEND00
            MOVE      ONE,PHEDFLAG
            CALL      SUMHED00
            MOVE      HEADTYPE,SAVHTYPE
          ENDIF
.
          PACK      SAVKEY17,DRAWERID,RECPDATE,REGISTER
          CALL      GAMNT000            * Get total amount
.
          MOVE      "Invalid Register    ",DESCRE2
          PACK      KEY3,REGISTER,SP3
          CALL      RDREGA1
          IF        OVRCD=0
            PACK      DESCRE2,REGDESC,SP70
          ENDIF
.
          COMPARE   "56",CLNO
          CALL      SUMHED00 IF NOT LESS
.
          MOVE      HEADTYPE,F1
          BRANCH    F1,SUMREC20,SUMREC30,SUMREC30,SUMREC40
.
SUMREC20  MOVE      ZERO,EXIT 
          UNPACK    RECPDATE,CCENT,CYEAR,CMON,CDAY
          CALL      PACDATE
.
          BRANCH    EXPORTFL,SUMREC22
.
          MATCH     REGISTER,TILD20
          IF        @EQUAL
            PRINT     *1,"|      Total for ",CPDATE;
          ELSE
            PRINT     *1,PIP,CPDATE,*10,PIP,DESCRE2;
          ENDIF
          PRINT     *29,PIP,AMTCASH,*40,PIP,AMTCHEQ,*51,PIP,AMTEFTPO:
                    *62,PIP,AMTCRCD,*73,PIP,AMTMONOR,*84,PIP,TOTAL1:
                    *97,PIP,AMTDIRDE,*108,PIP,AMTOTHER,*119,PIP,TOTAL2,PIP
          MATCH     REGISTER,TILD20
          IF        @EQUAL
            PRINT     "--------------------------------------------":
                      "--------------------------------------------":
                      "--------------------------------------------"
            ADD       ONE,CLNO
          ENDIF
          ADD       ONE,CLNO
          GOTO      SUMREC10
.
SUMREC22  MATCH     REGISTER,TILD20
          IF        @EQUAL
            PRINT     "<tr><td>&nbsp;</td>":
                      "<td>Total for</td>":
                      "<td>",CPDATE,"</td>";
          ELSE
            PRINT     "<tr><td>&nbsp;",SAVCSHDR,"</td>":
                      "<td>",CPDATE,"</td>":
                      "<td>",DESCRE2,"</td>";
          ENDIF
.
          PRINT     "<td>",AMTCASH,"</td>":
                    "<td>",AMTCHEQ,"</td>":
                    "<td>",AMTEFTPO,"</td>":
                    "<td>",AMTCRCD,"</td>":
                    "<td>",AMTMONOR,"</td>":
                    "<td>",TOTAL1,"</td>":
                    "<td>",AMTDIRDE,"</td>";
.
          CALL      OTHAM000                * Print other payments column
.
          MATCH     REGISTER,TILD20
          IF        @EQUAL
            PRINT     "<tr><td>&nbsp</td></tr>"
          ENDIF
.
          GOTO      SUMREC10
.
SUMREC30  MOVE      ZERO,EXIT 
          IF        EXPORTFL=1
            PRINT     "<tr><td>&nbsp;",SAVCSHDR,"</td>":
                      "<td>",DESCRE2,"</td>":
                      "<td>",AMTCASH,"</td>":
                      "<td>",AMTCHEQ,"</td>":
                      "<td>",AMTEFTPO,"</td>":
                      "<td>",AMTCRCD,"</td>":
                      "<td>",AMTMONOR,"</td>":
                      "<td>",TOTAL1,"</td>":
                      "<td>",AMTDIRDE,"</td>";
.
            CALL      OTHAM000                * Print other payments column
          ELSE
            PRINT     *1,PIP,DESCRE2,*22,PIP,AMTCASH,*34,PIP,AMTCHEQ:
                      *47,PIP,AMTEFTPO,*59,PIP,AMTCRCD,*71,PIP,AMTMONOR:
                      *83,PIP,TOTAL1,*96,PIP,AMTDIRDE,*107,PIP,AMTOTHER:
                      *118,PIP,TOTAL2,PIP
            ADD       ONE,CLNO
          ENDIF
          GOTO      SUMREC10
.
SUMREC40  MOVE      ZERO,EXIT
          IF        EXPORTFL=1
            PRINT     "<tr><td>&nbsp;</td>":
                      "<td>Grand Total</td>":
                      "<td>",AMTCASH,"</td>":
                      "<td>",AMTCHEQ,"</td>":
                      "<td>",AMTEFTPO,"</td>":
                      "<td>",AMTCRCD,"</td>":
                      "<td>",AMTMONOR,"</td>":
                      "<td>",TOTAL1,"</td>":
                      "<td>",AMTDIRDE,"</td>";
.
            CALL      OTHAM000                * Print other payments column
          ELSE
            PRINT     *1,PIP," Grand Total",*22,PIP,AMTCASH,*34,PIP,AMTCHEQ:
                      *47,PIP,AMTEFTPO,*59,PIP,AMTCRCD,*71,PIP,AMTMONOR:
                      *83,PIP,TOTAL1,*96,PIP,AMTDIRDE,*107,PIP,AMTOTHER:
                      *118,PIP,TOTAL2,PIP
            ADD       ONE,CLNO
          ENDIF
          GOTO      SUMREC10
.
SUMREC90  BRANCH    EXPORTFL,SUMREC99
          CALL      SUMEND00
          PRINT     *N,"End of Report"
.
SUMREC99  RETURN
+
.******************************************************************************
.         Print amount for other payments columns
.******************************************************************************
OTHAM000 COMPARE   ZERO,OTCOLNUM
         GOTO      OTHAM6000 IF EQUAL
.
          MOVE      ONE,F2
          WHILE     F2<=OTCOLNUM
            MOVE      OTHRAMNT[F2],FORM12P2
            PRINT     "<td>",FORM12P2,"</td>"
            ADD       ONE,F2
          DO
.
.         Check if BPAY, HICAPS and Medicare columns had been printed
.
          BRANCH    F2,OTHAM900,OTHAM100,OTHAM200
          GOTO      OTHAM9000
.
OTHAM100  MOVE      ZERO,FORM12P2
          PRINT     "<td>",FORM12P2,"</td>":
                    "<td>",FORM12P2,"</td>"
          ADD       TWO,F2
          GOTO      OTHAM900
.
OTHAM200  MOVE      ZERO,FORM12P2
          PRINT     "<td>",FORM12P2,"</td>"
          ADD       ONE,F2
          GOTO      OTHAM900
.
.         Print column for BPAY,HICAPS and Medicare
.
OTHAM600  MOVE      ZERO,FORM12P2
          PRINT     "<td>",FORM12P2,"</td>":
                    "<td>",FORM12P2,"</td>"
.
          PRINT     "<td>",FORM12P2,"</td>"
.
          ADD       THREE,F2
.
OTHAM900  PRINT     "<td>",TOTAL2,"</td></tr>"
OTHAM999  RETURN
+
.******************************************************************************
.         Print heading for other payments columns
.******************************************************************************
PROTH000  MOVE     " 7",SVCDNHCP
          CALL     PTYP0000                * Get payment type description
          IF       EXIT=0
            PRINT    "<td>&nbsp;",TDESC,"</td>"
          ENDIF
          MOVE     " 8",SVCDNHCP
          CALL     PTYP0000                * Get payment type description
          IF       EXIT=0
            PRINT    "<td>&nbsp;",TDESC,"</td>"
          ENDIF
          MOVE     " 9",SVCDNHCP
          CALL     PTYP0000                * Get payment type description
          IF       EXIT=0
            PRINT    "<td>&nbsp;",TDESC,"</td>"
          ENDIF
.
          PACK     KEY5,SP70
          CALL     RSDRTM11
PROTH100  CALL     RKDRTM11
          BRANCH   OVRCD,PROTH900
.
          PACK     KEY5,CODEPY,SPAYCODE
          CALL     RDCODE1
          BRANCH   OVRCD,PROTH100
.
          PRINT    "<td>&nbsp;",TDESC,"</td>"
          GOTO     PROTH100
.
PROTH900  PRINT    "<td>Total</td></tr>"
PROTH999  RETURN
+
.******************************************************************************
.         Get amount
.******************************************************************************
GAMNT000  MOVE      ZERO,SUMCASH
          MOVE      ZERO,SUMCHEQ
          MOVE      ZERO,SUMEFTPO
          MOVE      ZERO,SUMCRCD
          MOVE      ZERO,SUMMONOR
          MOVE      ZERO,SUMDIRDE
          MOVE      ZERO,SUMBPAY
          MOVE      ZERO,SUMHICAP
          MOVE      ZERO,SUMMCARE
          MOVE      ZERO,TOTAL1
          MOVE      ZERO,TOTAL2
          MOVE      ONE,F2
          WHILE     F2<99
            MOVE      ZERO,OTHRAMNT[F2]
            ADD       ONE,F2
          DO
.
          MOVE      ZERO,TOTOTHS
          MOVE      ZERO,PAYMINDC
.
          PACK      KEY19,SAVKEY17,SP70
          CALL      RSDRTM10
GAMNT100  CALL      RKDRTM10
          BRANCH    OVRCD,GAMNT600
.
          PACK      KEY17,DRAWERID,RECPDATE,REGISTER
          MATCH     KEY17,SAVKEY17
          GOTO      GAMNT600 IF NOT EQUAL
.
          MOVE      ZERO,F2
          MOVE      SUMRTYPE,F2
          BRANCH    F2,GAMNT110,GAMNT120,GAMNT130,GAMNT140,GAMNT150:
                       GAMNT160,GAMNT170,GAMNT180,GAMNT190
.
          ADD       SUMAMNT,TOTAL2
          ADD       SUMAMNT,TOTOTHS
.
          GOTO      GAMNT200
.
GAMNT110  MOVE      SUMAMNT,SUMCASH
          ADD       SUMAMNT,TOTAL2
          GOTO      GAMNT100
.
GAMNT120  MOVE      SUMAMNT,SUMCHEQ
          ADD       SUMAMNT,TOTAL2
          GOTO      GAMNT100
.
GAMNT130  MOVE      SUMAMNT,SUMCRCD
          ADD       SUMAMNT,TOTAL2
          GOTO      GAMNT100
.
GAMNT140  MOVE      SUMAMNT,SUMDIRDE
          ADD       SUMAMNT,TOTAL2
          GOTO      GAMNT100
.
GAMNT150  MOVE      SUMAMNT,SUMMONOR
          ADD       SUMAMNT,TOTAL2
          GOTO      GAMNT100
.
GAMNT160  MOVE      SUMAMNT,SUMEFTPO
          ADD       SUMAMNT,TOTAL2
          GOTO      GAMNT100
.
GAMNT170  MOVE      SUMAMNT,SUMBPAY
          ADD       SUMAMNT,TOTOTHS
          ADD       SUMAMNT,TOTAL2
          GOTO      GAMNT200
.
GAMNT180  MOVE      SUMAMNT,SUMHICAP
          ADD       SUMAMNT,TOTOTHS
          ADD       SUMAMNT,TOTAL2
          GOTO      GAMNT200
.
GAMNT190  MOVE      SUMAMNT,SUMMCARE
          ADD       SUMAMNT,TOTOTHS
          ADD       SUMAMNT,TOTAL2
.
.         Print Payment type > 6 (Bpay, HICS, Medicare and Cr.Cards) as Others
.
GAMNT200  COMPARE   ZERO,F2
          GOTO      GAMNT100 IF LESS
          GOTO      GAMNT100 IF EQUAL
          SUB       SIX,F2
          MOVE      SUMAMNT,OTHRAMNT[F2]
          GOTO      GAMNT100
.
GAMNT600  MOVE      SUMCASH,TOTAL1
          ADD       SUMCHEQ,TOTAL1
          ADD       SUMEFTPO,TOTAL1
          ADD       SUMCRCD,TOTAL1
          ADD       SUMMONOR,TOTAL1
.
          MOVE      SUMCASH,AMTCASH
          MOVE      SUMCHEQ,AMTCHEQ
          MOVE      SUMEFTPO,AMTEFTPO
          MOVE      SUMCRCD,AMTCRCD
          MOVE      SUMMONOR,AMTMONOR
          MOVE      SUMDIRDE,AMTDIRDE
          MOVE      TOTOTHS,AMTOTHER

GAMNT900  MOVE      SAVKEY17,KEY17
          CALL      RDDRTMP4            * reposition
GAMNT999  RETURN
+
.******************************************************************************
.*                        Get System description                              *
.******************************************************************************
GETSYS00  COMPARE   ONE,REGIBACD
          GOTO      GETSYS05 IF NOT EQUAL
.
          MOVE      SYSDES1,SYSDESC
          GOTO      GETSYS99
.
GETSYS05  COMPARE   TWO,REGIBACD
          GOTO      GETSYS10 IF NOT EQUAL
          MOVE      SYSDES2,SYSDESC
          GOTO      GETSYS99
.
GETSYS10  COMPARE   FOUR,REGIBACD
          GOTO      GETSYS15 IF NOT EQUAL
          MOVE      SYSDES4,SYSDESC
          GOTO      GETSYS99
.
GETSYS15  COMPARE   FIVE,REGIBACD
          GOTO      GETSYS20 IF NOT EQUAL
          MOVE      SYSDES5,SYSDESC
          GOTO      GETSYS99
.
GETSYS20  COMPARE   SIX,REGIBACD
          GOTO      GETSYS25 IF NOT EQUAL
          MOVE      SYSDES6,SYSDESC
          GOTO      GETSYS99
.
GETSYS25  COMPARE   NINTY,REGIBACD
          GOTO      GETSYS30 IF NOT EQUAL
          MOVE      SYSDES90,SYSDESC
          GOTO      GETSYS99
.
GETSYS30  COMPARE   NINTY1,REGIBACD
          GOTO      GETSYS35 IF NOT EQUAL
          MOVE      SYSDES91,SYSDESC
          GOTO      GETSYS99
.
GETSYS35  COMPARE   NINTY2,REGIBACD
          GOTO      GETSYS40 IF NOT EQUAL
          MOVE      SYSDES92,SYSDESC
          GOTO      GETSYS99
.
GETSYS40  COMPARE   NINTY4,REGIBACD
          GOTO      GETSYS45 IF NOT EQUAL
          MOVE      SYSDES94,SYSDESC
          GOTO      GETSYS99
.
GETSYS45  COMPARE   NINTY5,REGIBACD
          GOTO      GETSYS50 IF NOT EQUAL
          MOVE      SYSDES95,SYSDESC
          GOTO      GETSYS99
.
GETSYS50  COMPARE   NINTY6,REGIBACD
          GOTO      GETSYS55 IF NOT EQUAL
          MOVE      SYSDES96,SYSDESC
          GOTO      GETSYS99
.
GETSYS55  COMPARE   NINTY7,REGIBACD
          GOTO      GETSYS60 IF NOT EQUAL
          MOVE      SYSDES97,SYSDESC
          GOTO      GETSYS99
.
GETSYS60  COMPARE   NINTY8,REGIBACD
          GOTO      GETSYS65 IF NOT EQUAL
          MOVE      SYSDES98,SYSDESC
          GOTO      GETSYS99
.
GETSYS65  COMPARE   NINTY9,REGIBACD
          GOTO      GETSYS70 IF NOT EQUAL
          MOVE      SYSDES99,SYSDESC
          GOTO      GETSYS99
.
GETSYS70  COMPARE   EIGHTY9,REGIBACD
          GOTO      GETSYS90 IF NOT EQUAL
          MOVE      SYSDES89,SYSDESC
          GOTO      GETSYS99
.
GETSYS90  MOVE      SYSDES0,SYSDESC
GETSYS99  RETURN
.******************************************************************************
.*                        Reconciliation heading                              *
.******************************************************************************
RECHED00  CLOCK     TIME,CTIMEIS
          MOVE      ONE,CNOUNDLN
.
          CLOCK     TIME,CTIMEIS
          CALL      HEAD132 
          PRINT     *17,HDTITLE,DISPLDTE
          IF        IBCNMHOS=1
            PACK      KEY3,WBSEHOSP,SP70
            CALL      RDPTHSP1
            IF        OVRCD=0
              PRINT     *17,"Hospital : ",WBSEHOSP," - ",PTHSNAME
              ADD       ONE,CLNO
            ENDIF
          ENDIF
          PRINT     *N,*15,"*** Drawer Reconciliation ***"
.
          BRANCH    FRSTFLAG,RECHED10
          PRINT     *1,"Cash Drawer From : ",DRAWERF," to ",DRAWERT
          GOTO      RECHED20
.
RECHED10  PACK      KEY6,DRAWERID,SP70
          CALL      RDCIDA1
          IF        OVRCD=1
            UNPACK    SP70,RCPSUR,RCPGIVEN
          ENDIF
          SQUEEZE   RCPGIVEN
          SQUEEZE   RCPSUR
          PACK      DRAWER,RCPSUR,SP1,RCPGIVEN,SP70
          PRINT     *1,"Cash Drawer : ",*17,DRAWER;
.
RECHED20  PRINT     *N,*N,"Receipt",*20,"Payer",*50,"Payment Type":
                    *65,"       Amount":
                    *80,"Reference";
.
          PRINT     *N,"------------",*20,"--------------------":
                    *50,"------------",*65,"--------------":
                    *80,"-----------------------------------------------------"
.
          ADD       "4",CLNO                                           *C-59171
.
RECHED99  RETURN
+
.******************************************************************************
.*                   Cash reconciliation total                                *
.******************************************************************************
RECTOT00  SQUEEZE   RCPSUR
          SQUEEZE   RCPGIVEN
          PACK      DRAWER,RCPSUR,SP1,RCPGIVEN,SP70
          COMPARE   "50",CLNO
          IF        !@LESS
            CALL      HEAD132 
          ENDIF
          PRINT     *N,*1,"Total for Cash Drawer ",DRAWER
          ADD       TWO,CLNO
          CALL      PORD0000          * Print Totals
          PRINT     *N;
          ADD       ONE,CLNO
.
RECTOT99  RETURN
+
.******************************************************************************
.         Check the print order for printing Totals
.******************************************************************************
PORD0000  MOVE      SP70,SAVKEY2
          PRINT     *N;
          ADD       ONE,CLNO
          PACK      KEY9,CODEPY,SP70
          CALL      RDSCODE5
PORD0200  CALL      RDKCODE5
          BRANCH    OVRCD,PORD9999
.
          MATCH     CODEPY,TCODE
          GOTO      PORD9999 IF NOT EQUAL
.
          MATCH     "A",PTCOACTV
          GOTO      PORD0200 IF NOT EQUAL     * Not active
.
          SQUEEZE   PTCDNHCP
          MOVE      ZERO,F2
          MOVE      PTCDNHCP,F2
          MOVE      F2,DIM2
          MATCH     SAVKEY2,DIM2
          GOTO      PORD0200 IF EQUAL      * Same payment type
.
          PACK      KEY20,TDESC
          PACK      KEY12,TDESC
          MOVE      DIM2,SAVKEY2
.
          BRANCH    F2,PORD1000,PORD2000,PORD3000,PORD4000,PORD5000:
                       PORD6000,PORD7000,PORD8000,PORD9000
          SUB       NINE,F2
          COMPARE   ZERO,F2
          GOTO      PORD9800 IF LESS
.
          MOVE      TOTPAYMN[F2],FORM12P2
          PRINT     *10,"Total ",KEY20,*65,FORM12P2
          GOTO      PORD9800
.
PORD1000  PRINT     *10,"Total ",KEY20,*65,TOTCASH
          GOTO      PORD9800
.
PORD2000  PRINT     *10,"Total ",KEY20,*65,TOTCHQ
          GOTO      PORD9800
.
PORD3000  CALL      PCRD0000                * Print credit cards
          GOTO      PORD9800
.
PORD4000  PRINT     *10,"Total ",KEY20,*65,TOTDDBT
          GOTO      PORD9800
.
PORD5000  PRINT     *10,"Total ",KEY20,*65,TOTMONOR
          GOTO      PORD9800
.
PORD6000  CALL      PEFT0000                * Print EFTPOS
          GOTO      PORD9800
.
PORD7000  PRINT     *10,"Total ",KEY20,*65,TOTBPAY
          GOTO      PORD9800
.
PORD8000  PRINT     *10,"Total ",KEY20,*65,TOTHCAPS
          GOTO      PORD9800
.
PORD9000  PRINT     *10,"Total ",KEY20,*65,TOTMDCAR
          GOTO      PORD9800
.
PORD9800  ADD       ONE,CLNO
          GOTO      PORD0200
.
PORD9999  RETURN
+
.******************************************************************************
.         Print Credit cards
.******************************************************************************
PCRD0000  MOVE      KEY20,SAVPDESC
          MOVE      ZERO,TOTAMNT
          MOVE      ZERO,TOTCRED
          MOVE      SP70,SAVCCODE
          MOVE      SP70,SAVKEY1
          MOVE      ZERO,ENDFLAG
          MOVE      ZERO,FORM12P2
          PACK      KEY10,SAVDRAWR,SP70
          CALL      RSCREDF1
PCRD1000  CALL      RKCREDF1
          BRANCH    OVRCD,PCRD6000
.
          MATCH     SAVDRAWR,CREDDRAW
          GOTO      PCRD6000 IF NOT EQUAL   * Different drawer id
.
          MATCH     SP70,SAVKEY1
          GOTO      PCRD2000 IF NOT EQUAL
.
          MATCH     SP70,SAVCCODE
          GOTO      PCRD8000 IF EQUAL
.
PCRD2000  MATCH     SAVKEY1,CREDINDC
          GOTO      PCRD7000 IF NOT EQUAL
          GOTO      PCRD8000
.
PCRD6000  MOVE      ONE,ENDFLAG
          MATCH     SP70,SAVCCODE
          GOTO      PCRD9000 IF EQUAL
.
PCRD7000  MOVE      "Invalid Cr.Card",KEY15
          PACK      KEY5,CODECR,SAVCCODE
          CALL      RDCODE1
          IF        OVRCD=0
            PACK      KEY15,TDESC,SP70
          ENDIF
          PRINT     *10,"Total ",KEY15,*50,TOTAMNT
          ADD       ONE,CLNO
.
          MOVE      "0",GNDTTYPE       * Credit card
          MOVE      SAVCCODE,GNDTCARD
          MOVE      SP70,GNDTINDC
          PACK      KEY5,CODECR,GNDTCARD
          CALL      RDCODE1
          IF        OVRCD=0
            UNPACK    TCINDC1,GNDTINDC
          ENDIF
          PACK      KEY5,GNDTTYPE,GNDTINDC,GNDTCARD
          CALL      RDGNDTF1
          IF        OVRCD=0
            ADD       TOTAMNT,GNDTAMNT
            CALL      UPGNDTF1
          ELSE
            UNPACK    KEY5,GNDTTYPE,GNDTINDC,GNDTCARD
            MOVE      TOTAMNT,GNDTAMNT
            MOVE      SP70,GNDTSPAR
            CALL      WRGNDTF1
          ENDIF
.
          MOVE      ZERO,TOTAMNT
          BRANCH    ENDFLAG,PCRD9000
.
PCRD8000  ADD       CREDAMNT,TOTAMNT
          MOVE      CREDINDC,SAVKEY1
          MOVE      CREDCODE,SAVCCODE
          ADD       CREDAMNT,FORM12P2
.
          GOTO      PCRD1000                 * next record
.
PCRD9000  PRINT     *10,"Total ",SAVPDESC,*65,FORM12P2
.
PCRD9999  RETURN
+
.******************************************************************************
.         Print EFTPOS
.******************************************************************************
PEFT0000  MOVE      KEY20,SAVPDESC
          MOVE      ZERO,TOTAMNT
          MOVE      SP70,SAVCCODE
          MOVE      SP70,SAVKEY1
          MOVE      ZERO,ENDFLAG
.
          MOVE      "0",KEY1                  * for cash
          PACK      KEY10,SAVDRAWR,KEY1,SP70
          CALL      RDEFTPF1
          BRANCH    OVRCD,PEFT0800
.
          UNPACK    SAVPDESC,DIM10
          PRINT     *10,"Total ",DIM10,"-Chq/Sav",*50,EFTPAMNT
          ADD       EFTPAMNT,TOTEFTDB
          ADD       EFTPAMNT,TTOTEFDB
          ADD       ONE,CLNO
.
PEFT0800  PACK      KEY10,SAVDRAWR,SP70
          CALL      RSEFTPF1
PEFT1000  CALL      RKEFTPF1
          BRANCH    OVRCD,PEFT6000
.
          MATCH     SAVDRAWR,EFTPDRAW
          GOTO      PEFT6000 IF NOT EQUAL     * Different drawer id
.
          MATCH     "0",EFTPINDC
          GOTO      PEFT1000 IF EQUAL         * Cash, printed it already
.
          MATCH     SP70,SAVKEY1
          GOTO      PEFT2000 IF NOT EQUAL
.
          MATCH     SP70,SAVCCODE
          GOTO      PEFT8000 IF EQUAL
.
PEFT2000  MATCH     SAVKEY1,EFTPINDC
          GOTO      PEFT7000 IF NOT EQUAL
          MATCH     SAVCCODE,EFTPCODE
          GOTO      PEFT7000 IF NOT EQUAL
          GOTO      PEFT8000
.
PEFT6000  MOVE      ONE,ENDFLAG
          MATCH     SP70,SAVCCODE
          GOTO      PEFT9000 IF EQUAL
.
PEFT7000  MOVE      "Invalid Cr.Card",KEY20
          PACK      KEY5,CODECR,SAVCCODE
          CALL      RDCODE1
          IF        OVRCD=0
            PACK      KEY20,TDESC,SP70
          ENDIF
          UNPACK    SAVPDESC,DIM10
          PRINT     *10,"Total ",DIM10,"-",KEY20,*50,TOTAMNT
          ADD       ONE,CLNO
.
          MOVE      "1",GNDTTYPE       * EFTPOS
          MOVE      SAVCCODE,GNDTCARD
          MOVE      SP70,GNDTINDC
          PACK      KEY5,CODECR,GNDTCARD
          CALL      RDCODE1
          IF        OVRCD=0
            UNPACK    TCINDC1,GNDTINDC
          ENDIF
          PACK      KEY5,GNDTTYPE,GNDTINDC,GNDTCARD
          CALL      RDGNDTF1
          IF        OVRCD=0
            ADD       TOTAMNT,GNDTAMNT
            CALL      UPGNDTF1
          ELSE
            UNPACK    KEY5,GNDTTYPE,GNDTINDC,GNDTCARD
            MOVE      TOTAMNT,GNDTAMNT
            MOVE      SP70,GNDTSPAR
            CALL      WRGNDTF1
          ENDIF
          ADD       TOTAMNT,TOTEFTCR
          MOVE      ZERO,TOTAMNT
          BRANCH    ENDFLAG,PEFT9000
.
PEFT8000  ADD       EFTPAMNT,TOTAMNT
          MOVE      EFTPINDC,SAVKEY1
          MOVE      EFTPCODE,SAVCCODE
.
          GOTO      PEFT1000
.
PEFT9000  MOVE      TOTEFTDB,FORM12P2
          ADD       TOTEFTCR,FORM12P2
          PRINT     *10,"Total ",SAVPDESC,*65,FORM12P2
          ADD       ONE,CLNO
.
PEFT9999  RETURN
+
.******************************************************************************
.         Check the print order for printing Grand Totals
.******************************************************************************
TORD0000  MOVE      SP70,SAVKEY2
          PACK      KEY9,CODEPY,SP70
          CALL      RDSCODE5
TORD0200  CALL      RDKCODE5
          BRANCH    OVRCD,TORD9999
.
          MATCH     CODEPY,TCODE
          GOTO      TORD9999 IF NOT EQUAL
.
          MATCH     "A",PTCOACTV
          GOTO      TORD0200 IF NOT EQUAL     * Not active
.
          SQUEEZE   PTCDNHCP
          MOVE      ZERO,F2
          MOVE      PTCDNHCP,F2
          MOVE      F2,KEY2
          MATCH     SAVKEY2,KEY2
          GOTO      TORD0200 IF EQUAL      * Same payment type
.
          PACK      KEY20,TDESC
          PACK      KEY12,TDESC
          MOVE      KEY2,SAVKEY2
.
          BRANCH    F2,TORD1000,TORD2000,TORD3000,TORD4000,TORD5000:
                       TORD6000,TORD7000,TORD8000,TORD9000
          SUB       NINE,F2
          COMPARE   ZERO,F2
          GOTO      TORD9800 IF LESS
.
          MOVE      TTOTPYMN[F2],FORM12P2
          PRINT     *10,"Total ",KEY20,*65,FORM12P2
          GOTO      TORD9800
.
TORD1000  PRINT     *10,"Total ",KEY20,*65,TTOTCASH
          GOTO      TORD9800
.
TORD2000  PRINT     *10,"Total ",KEY20,*65,TTOTCHQ
          GOTO      TORD9800
.
TORD3000  CALL      PTCR0000              * Print total of each Credit cards
          GOTO      TORD9800
.
TORD4000  PRINT     *10,"Total ",KEY20,*65,TTOTDDBT
          GOTO      TORD9800
.
TORD5000  PRINT     *10,"Total ",KEY20,*65,TTOTMONR
          GOTO      TORD9800
.
TORD6000  CALL      PTEF0000              * Print total of each EFTPOS cr.card
          GOTO      TORD9800
.
TORD7000  PRINT     *10,"Total ",KEY20,*65,TTOTBPAY
          GOTO      TORD9800
.
TORD8000  PRINT     *10,"Total ",KEY20,*65,TTOTHCPS
          GOTO      TORD9800
.
TORD9000  PRINT     *10,"Total ",KEY20,*65,TTOTMCAR
          GOTO      TORD9800
.
TORD9800  ADD       ONE,CLNO
          GOTO      TORD0200
.
TORD9999  RETURN
+
.******************************************************************************
.         Print total of each credit card
.******************************************************************************
PTCR0000  MOVE      KEY20,SAVPDESC         * Save description
          MOVE      ZERO,FORM12P2
          MOVE      "0",KEY1               * for Credit card
          PACK      KEY5,KEY1,SP70
          CALL      RSGNDTF1
PTCR1000  CALL      RKGNDTF1
          BRANCH    OVRCD,PTCR9000
.
          MATCH     KEY1,GNDTTYPE
          GOTO      PTCR9000 IF NOT EQUAL
.
          MOVE      "Credit Card",KEY20
          PACK      KEY5,CODECR,GNDTCARD
          CALL      RDCODE1
          IF        OVRCD=0
            PACK      KEY20,TDESC
          ENDIF
.
          PRINT     *10,"Total ",KEY20,*50,GNDTAMNT
          ADD       GNDTAMNT,FORM12P2
          GOTO      PTCR1000
.
PTCR9000  PRINT     *10,"Total ",SAVPDESC,*65,FORM12P2
PTCR9999  RETURN
+
.******************************************************************************
.         Print total of each EFTPOS credit card
.******************************************************************************
PTEF0000  MOVE      KEY20,SAVPDESC
          MOVE      ZERO,TOTEFTCR
          UNPACK    KEY20,DIM10
          PRINT     *10,"Total ",DIM10,"-Chq/Sav",*50,TTOTEFDB
.
          MOVE      "1",KEY1               * for EFTPOS
          PACK      KEY5,KEY1,SP70
          CALL      RSGNDTF1
PTEF1000  CALL      RKGNDTF1
          BRANCH    OVRCD,PTEF9000
.
          MATCH     KEY1,GNDTTYPE
          GOTO      PTEF9000 IF NOT EQUAL
.
          MOVE      "Credit",KEY20
          PACK      KEY5,CODECR,GNDTCARD
          CALL      RDCODE1
          IF        OVRCD=0
            PACK      KEY20,TDESC
          ENDIF
.
          UNPACK    SAVPDESC,DIM10
          PRINT     *10,"Total ",DIM10,"-",KEY20,*50,GNDTAMNT
          ADD       GNDTAMNT,TOTEFTCR
          ADD       ONE,F2
          GOTO      PTEF1000
.
PTEF9000  MOVE      TTOTEFDB,FORM12P2
          ADD       TOTEFTCR,FORM12P2
          PRINT     *10,"Total ",SAVPDESC,*65,FORM12P2
PTEF9999  RETURN
+
.******************************************************************************
.*                 System Reconciliation heading                              *
.******************************************************************************
SYSHED00  BRANCH    EXPORTFL,SYSHED99
.
          CLOCK     TIME,CTIMEIS
          MOVE      ONE,CNOUNDLN
.
          CALL      HEAD132 
          PACK      HDTITLE,SP70
          LOAD      HDTITLE,COPTION,TITLE1,TITLE2,TITLE3,TITLE4,TITLE5,TITLE6:
                                    TITLE7,TITLE8
.
          MOVE      FIVE,CLNO
          IF        COPTION = 7 | COPTION = 8
            IF        COPTION = 7
              PRINT     *32,TITLE7,DISPLDTE," to ",DISPLDT2,*N
            ELSE
              PRINT     *32,TITLE8,DISPLDTE," to ",DISPLDT2,*N
            ENDIF
          ELSE
            IF        COPTION = 9 | COPTION = 10
              PRINT     *38,"From ",DISPLDTE,"   To ",DISPLDT2
            ELSE
              PRINT     *17,HDTITLE,DISPLDTE,*N
            ENDIF
            IF        CRECFLAG=1
              PRINT     *15,"*** System Reconciliation ":
                            "- Cancelled Receipts ***",*N
            ELSE
              PRINT     *15,"*** System Reconciliation ***",*N
            ENDIF
            ADD       TWO,CLNO
          ENDIF
.
          CALL      RDDRAW00
.
          COMPARE   "8",COPTION
          GOTO      SYSHED99 IF EQUAL
.
          PRINT     *1,"Cash Drawer : ",RCPCASH,*23,DRAWER:
                    *N,*N,"Register",*22,"System",*44,"Receipt No";
.
          BRANCH    CRECFLAG,SYSHED20        * Printing cancelled receipts
.
          PRINT     *57,"Inv/Adm/Ref No",*75,"Patient/Payer Name";
          IF        COPTION = 9
            PRINT   SP8,"  Susp Alloc",*114,"     Amount",*126,"  Disc.":
                    *N,"--------------------",*22,"---------------------":
                    *44,"------------",*57,"-----------------":
                    *75,"--------------------------":
                    *102,"-----------",*114,"-----------",*126,"-------"
          ELSE
            PRINT   *102,"         Amount":
                    *118,"       Discount":
                    *N,"--------------------",*22,"---------------------":
                    *44,"------------",*57,"-----------------":
                    *75,"--------------------------":
                    *102,"---------------",*118,"---------------"
          ENDIF
          GOTO      SYSHED80
.
.         Printing cancelled receipts
.
SYSHED20  PRINT     *57,"Ref No",*75,"Patient/Payer Name":
                    *102,"         Amount":
                    *N,"--------------------",*22,"---------------------":
                    *44,"------------",*57,"-----------------":
                    *75,"--------------------------":
                    *102,"---------------"
.
SYSHED80  ADD       "4",CLNO                                           *C-59171
          GOTO      SYSHED99
.
SYSHED99  RETURN
+
.******************************************************************************
.*                 Read Drawer Full Name                                      *
.******************************************************************************
RDDRAW00  PACK      KEY6,DRAWERID,SP70
          CALL      RDCIDA1
          IF        OVRCD=1
            UNPACK    SP70,RCPSUR,RCPGIVEN
          ENDIF                             
          SQUEEZE   RCPSUR
          SQUEEZE   RCPGIVEN
          PACK      DRAWER,RCPSUR,SP1,RCPGIVEN,SP70
.
RDDEAW99  RETURN
+
.******************************************************************************
.*                 Summary headings                                           *
.******************************************************************************
SUMHED00  IF        EXPORTFL=1
            BRANCH    PHEDFLAG,SUMHED10
            GOTO      SUMHED99
          ENDIF
.
          COMPARE   "44",CLNO
          CALL      SYSHED00 IF NOT LESS
.
SUMHED10  MOVE      ZERO,PHEDFLAG
          MOVE      HEADTYPE,F1
          BRANCH    F1,SUMHED50,SUMHED60,SUMHED60,SUMHED70
.
SUMHED50  MOVE      "1",ANS
          CALL      RDDRAW00
          IF        EXPORTFL=1
            PRINT     "<tr><td>&nbsp;</td></tr>"
            MOVE      RCPCASH,SAVCSHDR
            PRINT     "<table border=1><tr><td>Cash Drawer</td>":
                      "<td>Date</td>":
                      "<td>Register</td>":
                      "<td>Cash</td>":
                      "<td>Cheque</td>":
                      "<td>EFTPOS</td>":
                      "<td>Cred.Card</td>":
                      "<td>Patient Portal</td>":
                      "<td>Sub-total</td>":
                      "<td>Dir.Depost</td>";
.
            CALL      PROTH000               * Print heading for other payments
          ELSE
            PRINT     *1,"Cash Drawer : ",RCPCASH,*23,DRAWER,CONTIN,*N,*N;
            PRINT     "--------------------------------------------":
                      "--------------------------------------------":
                      "--------------------------------------------",*N:
                      "|Date    | Register         | Cash     | Cheque   ":
                      "|EFTPOS    | Cred.Card|Pat.Portal|  Sub-total | Dir.":
                      "Depst|   Others |      Total |",*N:
                      "--------------------------------------------":
                      "--------------------------------------------":
                      "--------------------------------------------"
            ADD       "6",CLNO
          ENDIF
          MOVE      "(cont.)",CONTIN
          GOTO      SUMHED99
.
SUMHED60  MOVE      "1",ANS
          IF        EXPORTFL=1
            PRINT     "<tr><td>&nbsp;</td></tr>"
            MATCH     TILD20,DRAWERID
            IF        @EQUAL
              MOVE      SP70,SAVCSHDR
              PRINT     "<table border=1><tr><td>&nbsp;</td>";
            ELSE
              CALL      RDDRAW00
              MOVE      RCPCASH,SAVCSHDR
              PRINT     "<table border=1><tr><td>Cash Drawer</td>";
            ENDIF
.
            PRINT     "<td>Register</td>":
                      "<td>Cash</td>":
                      "<td>Cheque</td>":
                      "<td>EFTPOS</td>":
                      "<td>Cred.Card</td>":
                      "<td>Patient Portal</td>":
                      "<td>Sub-total</td>":
                      "<td>Dir.Depost</td>";
.
            CALL      PROTH000              * Print heading for other payments
          ELSE
            MATCH     TILD20,DRAWERID
            IF        @EQUAL
              PRINT     *1,*N,"All Cash Drawers ",CONTIN,*N,*N;
            ELSE
              CALL      RDDRAW00
              PRINT     *1,"Cash Drawer : ",RCPCASH,*23,DRAWER,CONTIN,*N,*N;
            ENDIF
            PRINT     "--------------------------------------":
                      "--------------------------------------------":
                      "-------------------------------------------------",*N:
                      "| Register           | Cash      | Cheque    | ":
                      "EFTPOS     | Cred.Card | Pat.Portal|  Sub-total | Dir.":
                      "Depost|  Others |      Total |",*N:
                      "--------------------------------------":
                      "--------------------------------------------":
                      "-------------------------------------------------"
            ADD       "5",CLNO
          ENDIF
          MOVE      "(cont.)",CONTIN
          GOTO      SUMHED99
.
SUMHED70  MOVE      "1",ANS
          IF        EXPORTFL=1
            PRINT     "<tr><td>&nbsp;</td></tr>"
            PRINT     "<table border=1>":
                      "<tr><td>&nbsp;</td>":
                      "<td>&nbsp;</td>":
                      "<td>Cash</td>":
                      "<td>Cheque</td>":
                      "<td>EFTPOS</td>":
                      "<td>Cred.Card</td>":
                      "<td>Patient Portal</td>":
                      "<td>Sub-total</td>":
                      "<td>Dir.Depost</td>";
.
            CALL      PROTH000               * Print heading for other payments
          ELSE
            PRINT     *N,*N,"--------------------------------------":
                      "--------------------------------------------":
                      "-------------------------------------------------",*N:
                      "|                    | Cash      | Cheque    | ":
                      "EFTPOS     | Cred.Card | Pat.Portal|  Sub-total | Dir.":
                      "Depost|  Others |      Total |",*N:
                      "--------------------------------------":
                      "--------------------------------------------":
                      "-------------------------------------------------"
            ADD       "5",CLNO
          ENDIF
          GOTO      SUMHED99
.
SUMHED99  RETURN
+
.******************************************************************************
SUMEND00  BRANCH    EXPORTFL,SUMEND99
          MOVE      ZERO,EXIT
          MOVE      SAVHTYPE,F1
          BRANCH    F1,SUMEND20,SUMEND30,SUMEND30,SUMEND30
.
SUMEND20  PRINT     *N
          GOTO      SUMEND90
.
SUMEND30  PRINT     "--------------------------------------------":
                    "--------------------------------------------":
                    "-------------------------------------------",*N,*N
          GOTO      SUMEND90
.
SUMEND90  ADD       "2",CLNO
.
SUMEND99  RETURN
.******************************************************************************
.*                 System reconciliation total                                *
.******************************************************************************
SYSTOT00  SQUEEZE   RCPGIVEN
          SQUEEZE   RCPSUR
          PACK      DRAWER,RCPSUR,SP1,RCPGIVEN,SP70
          COMPARE   "50",CLNO
          IF        !@LESS
            CALL      SYSHED000
          ENDIF
          PRINT     *N,*1,"Total for Cash Drawer ",DRAWER;
.
          BRANCH    CRECFLAG,SYSTOT20        * Print Cancelled receipts
.
          IF        COPTION = 9
            MOVE      TOTAMT,FORM8P2A                        * start  *C-233901
            MOVE      TOTDIS,FORM4P2
            MOVE      TOTAAMT,FORM8P2B
            MOVE      SP20,DIM11A
            IF        FORM8P2B > 0
              MOVE      FORM8P2B,DIM11A
            ENDIF
            PRINT     *102,"-----------",*114,"-----------",*126,"-------"
            PRINT     *102,DIM11A,*114,FORM8P2A,*126,FORM4P2 
            PRINT     *102,"-----------",*114,"-----------",*126,"-------"
          ELSE
            PRINT     *102,"---------------",*118,"---------------"
            PRINT     *102,TOTAMT,*118,TOTDIS
            PRINT     *102,"---------------",*118,"---------------"
          ENDIF                                              * end    *C-233901
          GOTO      SYSTOT80
.
.         Printing cancelled receipts
.
SYSTOT20  PRINT     *102,"---------------"
          PRINT     *102,TOTAMT
          PRINT     *102,"---------------"
.
SYSTOT80  ADD       "3",CLNO
.
SYSTOT99  RETURN
+
.******************************************************************************
.*                 System reconciliation total                                *
.******************************************************************************
REGTOT00  PACK      KEY3,SAVREG,SP70
          CALL      RDREGA1
          IF        OVRCD=1
            MOVE      "Invalid Register    ",DESCREG
          ELSE
            PACK      DESCREG,REGDESC,SP70
          ENDIF
.
          COMPARE   "50",CLNO
          IF        !@LESS
            CALL      SYSHED00
          ENDIF
          PRINT     *N,*10,"Total for Register ",DESCREG;
.
REGTOT10  BRANCH    CRECFLAG,REGTOT20              * Printing cancelled receipts
.
          IF        COPTION = 9
            MOVE      TREGAMT,FORM8P2A                        * start *C-233901
            MOVE      TREGDIS,FORM4P2   
            MOVE      TALOAMT,FORM8P2B    
            MOVE      SP20,DIM11A
            IF        FORM8P2B > 0
              MOVE      FORM8P2B,DIM11A
            ENDIF
            PRINT     *102,"-----------",*114,"-----------",*126,"-------"
            PRINT     *102,DIM11A,*114,FORM8P2A,*126,FORM4P2
            PRINT     *102,"-----------",*114,"-----------",*126,"-------"
          ELSE
            PRINT     *102,"---------------",*118,"---------------"
            PRINT     *102,TREGAMT,*118,TREGDIS
            PRINT     *102,"---------------",*118,"---------------"
          ENDIF                                               * end   *C-233901
          GOTO      REGTOT80
.
.         Print cancelled receipts
.
REGTOT20  PRINT     *102,"---------------"
          PRINT     *102,TREGAMT
          PRINT     *102,"---------------"
.
REGTOT80  MOVE      ZERO,TREGAMT
          MOVE      ZERO,TREGDIS
          MOVE      ZERO,TALOAMT
.
          ADD       "3",CLNO
.
REGTOT99  RETURN
+
.******************************************************************************
.*                        Bank Deposit List heading                           *
.******************************************************************************
LISHED00  CLOCK     TIME,CTIMEIS
          MOVE      PAYMTYPE,F2
          IF        F2=1 | F2=5
            GOTO      LISHED99
          ENDIF
          CALL      STDHED00
.
          MOVE      PAYMTYPE,SVCDNHCP
          MOVE      SP70,KEY20
          CALL      PTYP0000                * Get payment type description
.
          MOVE      PAYMTYPE,F2
          IF        F2=2
            PRINT     *N,"Cheque Number",*20,"Drawer",*45,"Bank":
                      *80,"Branch",*111,"               Amount":
                      *N,"------------------",*20,"------------------------":
                      *45,"----------------------------------":
                      *80,"------------------------------":
                      *113,"-------------------"
          ENDIF
.
          IF        F2=3
.           PRINT     *N,"Credit Card":
            PRINT     *N,TDESC:
                      *40,"Payer",*110,"         Amount":
                      *N,"-------------------":
                      *40,"---------------------------------------":
                      *110,"---------------"
          ENDIF
.
          IF        F2=4 | F2=7 | F2=8
            PRINT     *N,"Statement Reference":
                      *40,"Payer":
                      *80,"         Amount":
                      *N,"-------------------":
                      *40,"---------------------------------------":
                      *80,"---------------"
          ENDIF
.
          IF        F2=6
            PRINT     *N,"Reference",*30,"EFT Type":
                      *80,"Payer",*110,"         Amount":
                      *N,"-------------------":
                      *30,"---------------------------------------":
                      *80,"---------------------------",*110,"---------------"
          ENDIF
.
          IF        F2=9
.           PRINT     *N,"Medicare":
            PRINT     *N,TDESC:
                      *40,"Payer",*80,"         Amount":
                      *N,"-------------------":
                      *40,"---------------------------------------":
                      *80,"---------------"
          ENDIF
.
          IF        F2>9
            PRINT     *N,TDESC:
                      *40,"Payer",*110,"         Amount":
                      *N,"-------------------":
                      *40,"---------------------------------------":
                      *110,"---------------"
          ENDIF
.
          ADD       "5",CLNO
.
LISHED99  RETURN
+
.******************************************************************************
.*                        Cash Drawer Heading                                 *
.******************************************************************************
STDHED00  COMPARE   ONE,SUMMFLAG
          GOTO      STDHED20 IF NOT EQUAL
.
          BRANCH    NPAGFLAG,STDHED20
.
          COMPARE   "55",CLNO
          GOTO      STDHED20 IF NOT LESS
.
          MATCH    CHQACCNT,SAVCHQAC
          GOTO     STDHED99 IF EQUAL
          GOTO     STDHED70
.
STDHED20  MOVE      ONE,CNOUNDLN
          CALL      HEADX000
          BRANCH    HDBYPASS,STDHED30                                 *I-233235
.
          PACK      HDTITLE,SP70
          LOAD      HDTITLE,COPTION,TITLE1,TITLE2,TITLE3,TITLE4,TITLE5,TITLE6
.
          PRINT     *17,HDTITLE,DISPLDTE,*N                            *C-58680
.
          IF        NOPGOFLO = 1
            MOVE      ONE,HDBYPASS     * first Header printed don't print again
          ENDIF
.
STDHED30  BRANCH    SUMMFLAG,STDHED70
.
          PACK      KEY6,DRAWERID,SP70
          CALL      RDCIDA1
          IF        OVRCD=1
            UNPACK    SP70,RCPSUR,RCPGIVEN
          ENDIF
          SQUEEZE   RCPGIVEN
          SQUEEZE   RCPSUR
          UNPACK    RECDATE,CCENT,CYEAR,CMON,CDAY
          CALL      PACDATE
          PACK      DRAWER,RCPSUR,SP1,RCPGIVEN,SP70
          PACK      KEY15,CHQACCNT,SP70
          CALL      RDFMCH1
          IF        OVRCD<>1
            MOVE      FMCHDES,CHQADESC
          ELSE
            MOVE      "Invalid Cheque Account                  ",CHQADESC
          ENDIF
.                                           * check "no page breaks"  *I-233235
          IF        HDBYPASS = 1
            MATCH     PREVDRID,DRAWERID
            GOTO      STDHED70 IF EQUAL
            MATCH     SP6,PREVDRID
            IF        !@EQUAL
              PRINT     *1,"-------------------------------------------------":
                           "-------------------------------------------------":
                           "----------------------------------",*N
            ENDIF
            MOVE      DRAWERID,PREVDRID
            MOVE      SP20,PREVCHQN
          ENDIF                                                 * end *I-233235
.
          PRINT     *1,"Cash Drawer : ",*17,DRAWER,*N:
                    *N;                                                *I-58680
          ADD       TWO,CLNO
.
STDHED70  MOVE      ZERO,EXIT
.                                           * check "no page breaks"  *I-233235
          IF        HDBYPASS = 1
            MATCH     PREVCHQN,CHQACCNT
            GOTO      STDHED80 IF EQUAL
            MOVE      CHQACCNT,PREVCHQN
          ENDIF
.
          PRINT     *1,"Cheque Account ",*17,CHQACCNT,SP5,CHQADESC
          ADD       ONE,CLNO
STDHED80  MOVE      ZERO,NPAGFLAG
.
STDHED99  RETURN
+
.******************************************************************************
.*                   Bank Deposit listing total                               *
.******************************************************************************
LISTOT00  BRANCH    NEWGRP,LISTOT02
          GOTO      LISTOT98
.
LISTOT02  MATCH     "1",PRINTBD
          GOTO      LISTOT98 IF NOT EQUAL
.
          MOVE      DRAWERID,NEWDRAWR
          MOVE      CHQACCNT,NEWCHQAC
          MOVE      SAVDRAWR,DRAWERID
          MOVE      SAVCHQAC,CHQACCNT
          CALL      STDHED00
          MOVE      NEWDRAWR,DRAWERID
          MOVE      NEWCHQAC,CHQACCNT
.
          PRINT     *N;
          MOVE      ZERO,SAVKEY1
          PACK      KEY9,CODEPY,SP70
          CALL      RDSCODE5
LISTOT08  CALL      RDKCODE5
          BRANCH    OVRCD,LISTOT96
.
          MATCH     CODEPY,TCODE
          GOTO      LISTOT96 IF NOT EQUAL
.
          MATCH     "A",PTCOACTV
          GOTO      LISTOT08 IF NOT EQUAL     * Not active
.
          SQUEEZE   PTCDNHCP
          MOVE      ZERO,F2
          MOVE      PTCDNHCP,F2
          MOVE      F2,DIM2
          MATCH     SAVKEY2,DIM2
          GOTO      LISTOT08 IF EQUAL      * Same payment type
.
          PACK      KEY20,TDESC
          PACK      KEY12,TDESC
.
          BRANCH    F2,LISTOT10,LISTOT20,LISTOT30,LISTOT40,LISTOT50:
                       LISTOT60,LISTOT70,LISTOT80,LISTOT90
          SUB       NINE,F2
          COMPARE   ZERO,F2
          GOTO      LISTOT95 IF LESS
.
          MOVE      TOTPAYMN[F2],FORM12P2
          PRINT     *40,"Total ",KEY12,*65,FORM12P2
          GOTO      LISTOT95
.
LISTOT10  PRINT     *40,"Total ",KEY12,*65,TOTCASH
          GOTO      LISTOT95

LISTOT20  PRINT     *40,"Total ",KEY12,*65,TOTCHQ
          GOTO      LISTOT95
.
LISTOT30  PRINT     *40,"Total ",KEY12,*65,TOTCRED
          GOTO      LISTOT95
.
LISTOT40  PRINT     *40,"Total ",KEY12,*65,TOTDDBT
          GOTO      LISTOT95
.
LISTOT50  PRINT     *40,"Total ",KEY12,*65,TOTMONOR
          GOTO      LISTOT95
.
LISTOT60  PACK      KEY10,KEY20
          MOVE      TOTEFTDB,FORM12P2
          ADD       TOTEFTCR,FORM12P2
          PRINT     *40,"Total ",KEY10,*65,FORM12P2
          GOTO      LISTOT95
.
LISTOT70  PRINT     *40,"Total ",KEY12,*65,TOTBPAY
          GOTO      LISTOT95
.
LISTOT80  PRINT     *40,"Total ",KEY12,*65,TOTHCAPS
          GOTO      LISTOT95
.
LISTOT90  PRINT     *40,"Total ",KEY12,*65,TOTMDCAR
          GOTO      LISTOT95
.
LISTOT95  MOVE      KEY1,SAVKEY1
          ADD       ONE,CLNO
          GOTO      LISTOT08
.
LISTOT96  PRINT     *65,"----------------",*N:
                    *40,"Total Bank Deposit",*65,TOTTOTAL,*N:
                    *65,"----------------",*N
          ADD       "4",CLNO
.
          MOVE      ZERO,TOTCASH
          MOVE      ZERO,TOTCHQ
          MOVE      ZERO,TOTCRED
          MOVE      ZERO,TOTDDBT
          MOVE      ZERO,TOTMONOR
          MOVE      ZERO,TOTEFTDB
          MOVE      ZERO,TOTEFTCR
          MOVE      ZERO,TOTHCAPS
          MOVE      ZERO,TOTBPAY
          MOVE      ZERO,TOTMDCAR
          MOVE      ZERO,TOTTOTAL
          MOVE      ZERO,PRINTBD
          MOVE      ONE,F2
          WHILE     F2<99
            MOVE      ZERO,TOTPAYMN[F2]
            ADD       ONE,F2
          DO
.
LISTOT98  MOVE      ZERO,NEWGRP
          MOVE      ZERO,NEWPTYP
          MOVE      ONE,NPAGFLAG
.
LISTOT99  RETURN
+
.******************************************************************************
.         Excute us1/us2 command
.******************************************************************************
EXCUS000  CLEAR     CMDLINE                 * header file
          IF        COPTION=2
            APPEND    "ibarcp02.us1 ",CMDLINE
          ELSE
            IF        (HSYS1=3 | HSYS1=4 | HSYS1=5) & COPTION=5
              MOVE      HDATARCP,KEY40
              SQUEEZE   KEY40
              APPEND    "ibarcp02.us3 ",CMDLINE      * Integra Cash Interface
              APPEND    KEY40,CMDLINE
              APPEND    SP1,CMDLINE
              APPEND    TXTFNAME,CMDLINE
              GOTO      EXCUS200
            ELSE
              APPEND    "ibarcp02.us2 ",CMDLINE
            ENDIF
          ENDIF
          APPEND    SPLFILE,CMDLINE
          APPEND    ".prt",CMDLINE
EXCUS200  RESET     CMDLINE
          EXECUTE   CMDLINE,TASKID
EXCUS999  RETURN
+
.****************************************************************************
.*                                PRCOM000             Called by: DEPS0000  *
.*                        Print Commssion card details if any               *
.****************************************************************************
PRCOM000  OPEN      PMSCMMA1,"pmscmmaf"
          MOVE      "60",CLNO
          MOVE      ZERO,TOTCHQ
          MOVE      ZERO,TOTCRED
          MOVE      ZERO,TOTTOTAL
          PACK      KEY43,SP70
          CALL      RSDRTMP3
PRCOM100  CALL      RKDRTMP3
          BRANCH    OVRCD,PRCOM8000
.
          MATCH     "3",PAYMTYPE
          GOTO      PRCOM100 IF NOT EQUAL     * Not Credit Card
.
          MATCH     SP70,CARDTYPE
          GOTO      PRCOM100 IF EQUAL         * No Card code
.
          PACK      KEY5,ANSC,ANSR,CARDTYPE,SP70
          CALL      RDCODE1
          BRANCH    OVRCD,PRCOM100
.
          MATCH     "C",TCINDC1
          GOTO      PRCOM100 IF NOT EQUAL     * Not A commission card
.
          MOVE      ACODE,KEY3
          CALL      RDPMCMM1                  * Get Commssion Account details
.
          MOVE      ZERO,FORM12P2
          CALL      GPRC0000                  * Get percentage commission
          IF        EXIT=1 & OVRCD=1
            GOTO     PRCOM100                 * No Commission & No Acc.details
          ENDIF
.
          MOVE      CHQAMNT,FORM12P2
          MULT      FORM3P2,FORM12P2
          DIV       "100",FORM12P2            * Expected Commission
          ADD       FORM12P2,TOTCRED          * Total Expected Commission
.
          COMPARE   "55",CLNO
          CALL      COMHD000 IF NOT LESS
.
          ADD       CHQAMNT,TOTCHQ            * Total Amount paid
          PRINT     *1,"|",TDESC,*25,"|",PMCMCACC,*50,"|",CHQAMNT:
                    *70,"|",FORM12P2;
.
          SUB       FORM12P2,CHQAMNT          * Expected Deposit Amount
          ADD       CHQAMNT,TOTTOTAL          * Total Expected Deposit
          PRINT     *90,"|",CHQAMNT:
                    *132,"|"
          ADD       ONE,CLNO
          GOTO      PRCOM100
.
PRCOM800  COMPARE   ZERO,TOTCHQ
          GOTO      PRCOM999 IF EQUAL         * No commission
.
          CALL      UND132
          PRINT     *25,"| Total: ",*50,"|",TOTCHQ:
                    *70,"|",TOTCRED,*90,"|",TOTTOTAL,*132,"|":
                    *N,*25,"*-----":
                    "-------------------------------------------------":
                    "----------------------------------------------------*"
PRCOM999 RETURN
+
.******************************************************************************
.        Get percentage commission for NZ Private only
.******************************************************************************
GPRC0000  MOVE      ONE,EXIT
          MOVE      ZERO,FORM3P2
          COMPARE   ZERO,TCFORM6
          GOTO      GPRC9999 IF EQUAL         * No commission percentage
.
          MOVE      SP70,KEY6
          MOVE      TCFORM6,KEY6
          UNPACK    KEY6,DIM1,KEY4,KEY1
          MOVE      ".",ANS
          PACK      KEY6,KEY4,ANS,KEY1
          SQUEEZE   KEY6
          MOVE      KEY6,FORM3P2         * Commission percentage
          MOVE      ZERO,EXIT
GPRC9999  RETURN
+
.******************************************************************************
.         Print Commission Header
.******************************************************************************
COMHD000
          CLOCK     TIME,CTIMEIS
          MOVE      ONE,CNOUNDLN
          CLOCK     TIME,CTIMEIS
          CALL      HEAD132 
          PRINT     *15,"*** Commission Card Details ***"
          CALL      UND132
          PRINT     *1,"|Commission Card",*25,"|Account Number":
                    *50,"|     Amt Paid by":
                    *70,"|       Expected",*90,"|          Expected":
                    *132,"|":
                    *N,*1,"|",*25,"|":
                    *50,"|         Patient":
                    *70,"|     Commission",*90,"|    Deposit Amount":
                    *132,"|"
          CALL      UND132
          ADD       "3",CLNO
.
COMHD999  RETURN
+
.****************************************************************************
.         Routine to set up the transaction for each payment type
.****************************************************************************
STRN0000  MOVE      SP70,SAVERECN
          MOVE      ZERO,TOTLTRNL
          MOVE      ZERO,SKIPFLAG
          MOVE      ZERO,COUNT
.
          PACK      KEY14,SP70
          CALL      RSDRTMP8
STRN1000  CALL      RKDRTMP8
          BRANCH    OVRCD,STRN9999
.
          MATCH     SAVERECN,RECEIPTN
          GOTO      STRN2000 IF EQUAL
.
          MOVE      RECEIPTN,SAVERECN
          MOVE      ZERO,SKIPFLAG
          MOVE      ZERO,COUNT
.
.         Check if this is a new payment of a receipt
.
STRN2000  
          MOVE      ZERO,TOTLTRNL
          MOVE      IPAYTYPE,PAYCTYPE
.
          BRANCH    SKIPFLAG,STRN6000
.
          MOVE      ZERO,TOTDTAMT
          PACK      KEY17,RECEIPTN,SP70
          CALL      RSRCDTE1
STRN4000  CALL      RKRCDTE1
          BRANCH    OVRCD,STRN1000
.
          MATCH     RECEIPTN,RCDTRECN       * Same receipt number?
          GOTO      STRN1000 IF NOT EQUAL
.
          ADD       RCDTAMNT,TOTDTAMT
          MOVE      RCDTREGI,KEY3
          CALL      RDREGA1
          BRANCH    OVRCD,STRN4000
.
...........................................
.         Transaction lines
.
STRN6000  
          COMPARE   TOTDTAMT,PAYMAMNT
          GOTO      STRN7000 IF LESS
.
          IF        SKIPFLAG=1
            ADD       ONE,COUNT
            MOVE      COUNT,COUNTTRN
            MOVE      TOTDTAMT,TRNLAMNT
            PACK      KEY22,PAYCTYPE,RCDTRECN,COUNTTRN,SP70
            CALL      WRDRTMP9
            MOVE      ZERO,SKIPFLAG
            MOVE      ZERO,TOTDTAMT
            SUB       TOTDTAMT,CHQAMNT
            GOTO      STRN4000
          ENDIF
.
          ADD       ONE,COUNT
          MOVE      COUNT,COUNTTRN
          MOVE      RCDTAMNT,TRNLAMNT      * use transaction line amount
          PACK      KEY22,PAYCTYPE,RCDTRECN,COUNTTRN,SP70
          CALL      WRDRTMP9
.
          ADD       TRNLAMNT,TOTLTRNL
          GOTO      STRN4000
.
STRN7000  
          MOVE      PAYMAMNT,FORM12P2
          SUB       TOTLTRNL,FORM12P2
          COMPARE   ZERO,FORM12P2
          GOTO      STRN8000 IF EQUAL
.
          MOVE      FORM12P2,TRNLAMNT
          ADD       ONE,COUNT
          MOVE      COUNT,COUNTTRN
          PACK      KEY22,PAYCTYPE,RCDTRECN,COUNTTRN,SP70
          CALL      WRDRTMP9
          ADD       TRNLAMNT,TOTLTRNL
.
STRN8000  SUB       PAYMAMNT,TOTDTAMT
          MOVE      ONE,SKIPFLAG
          GOTO      STRN1000              * get next payment
.
STRN9999  RETURN
+
.****************************************************************************
.         Integra Cash Interface
.****************************************************************************
CSIN0000  COMPARE   ZERO,TOTTOTAL
          GOTO      CSIN9999 IF EQUAL
.
          CALL      CRTF0000              * Create the Text file
.
          CALL      HREC0000              * write a Header record
.
          MOVE      SP70,CURPMTYP
          PACK      KEY14,SP70
          CALL      RSDRTMP7
CSIN1000  CALL      RKDRTMP7
          BRANCH    OVRCD,CSIN9000
.
          MATCH     IPAYTYPE,CURPMTYP
          GOTO      CSIN1800 IF NOT EQUAL
.
.         A new Lodgement header record for each Direct Deposit
.
          MATCH     " 4",IPAYTYPE
          GOTO      CSIN2000 IF NOT EQUAL
.
CSIN1800  CALL      LHDR0000               * write a Lodgement header record
          MOVE      IPAYTYPE,CURPMTYP
          MOVE      ZERO,GSTFLAG
          MOVE      SP70,RCPTDETL
          MOVE      SP70,PAYENAME
.
CSIN2000  PACK      KEY22,IPAYTYPE,RECEIPTN,SP70
          CALL      RSDRTMP9
CSIN4000  CALL      RKDRTMP9
          BRANCH    OVRCD,CSIN1000
.
          MATCH     IPAYTYPE,PAYCTYPE       * Same payment type?
          GOTO      CSIN1000 IF NOT EQUAL
.
          MATCH     RECEIPTN,RCDTRECN       * Same receipt number?
          GOTO      CSIN1000 IF NOT EQUAL
.
          MOVE      TRNLAMNT,RCDTAMNT
          MOVE      RCDTREGI,KEY3
          CALL      RDREGA1
          BRANCH    OVRCD,CSIN4000
          COMPARE   ONE,REGIBACD            * Patient Billing?
          GOTO      CSIN5000 IF NOT EQUAL
.
          IF        HSYS1=5
            PACK      DIM12,RCDTINVN,SP70
            SQUEEZE   DIM12
            PACK      DIM8,RCDTVIST,SP70
            SQUEEZE   DIM8
            PACK      RCPTDETL,DIM12,SP1,RCDTURNO,SP1,DIM8,SP70
            PACK      PAYENAME,DIM12,SP1,RCDTURNO,SP1,DIM8,SP70
          ELSE
            PACK      RCPTDETL,RCDTINVN,SP1,RCDTURNO,SP1,RCDTVIST,SP70
            PACK      PAYENAME,RCDTINVN,SP70
          ENDIF
          GOTO      CSIN8000
.
CSIN5000  COMPARE   "92",REGIBACD
          GOTO      CSIN5200 IF EQUAL      * GST Sundry register
          COMPARE   "94",REGIBACD
          GOTO      CSIN6000 IF EQUAL
          COMPARE   "95",REGIBACD
          GOTO      CSIN6000 IF EQUAL
          COMPARE   "98",REGIBACD
          GOTO      CSIN6000 IF EQUAL
          COMPARE   "99",REGIBACD
          GOTO      CSIN6000 IF EQUAL
          COMPARE   "89",REGIBACD
          GOTO      CSIN6000 IF EQUAL
.
          MATCH     SP70,RCDTREFR
          IF        @EQUAL
            PACK      RCPTDETL,RCDTINVN,SP1,RCDTURNO,SP1,RCDTVIST,SP70
            PACK      PAYENAME,RCDTINVN,SP70
          ELSE
            IF        HSYS1=5
              PACK      DIM12,RCDTINVN,SP70
              SQUEEZE   DIM12
              PACK      DIM17,RCDTREFR,SP70
              STRIP     DIM17
              PACK      DIM8,RCDTURNO,SP70
              SQUEEZE   DIM8
              PACK      RCPTDETL,DIM12,SP1,DIM17,SP1,DIM8,SP70
              PACK      PAYENAME,DIM12,SP1,DIM17,SP1,DIM8,SP70
            ELSE
              PACK      RCPTDETL,RCDTREFR,SP70
              PACK      PAYENAME,RCDTREFR,SP70
            ENDIF
          ENDIF
          GOTO      CSIN8000
.
CSIN5200  MOVE      ONE,GSTFLAG
CSIN6000  PACK      RCPTDETL,RCDTNAME,SP70
          PACK      PAYENAME,RCDTNAME,SP70
.
.         Transaction lines
.
CSIN8000  COMPARE   ZERO,RCDTAMNT
          GOTO      CSIN4000 IF EQUAL
.
          CALL      RLOD0000               * write receipt lodgement line
          CALL      PYEE0000               * write payee details
          CALL      GGST0000               * Get GST Amount
.
          UNPACK    SP70,KEY24,KEY40
          MOVE      SP70,KEY24A
          PACK      KEY24,RCDTINCA,SP70
          MOVE      "0800",KEY4
          MOVE      "  0.00",KEY6
          WRITE     CASHINTR,SEQ;KEY4,KEY24,RCDTGSTC,KEY24A,KEY6:
                                 FORM12P2,RCDTAMNT,KEY40
.
          GOTO      CSIN4000               * Next Transaction
.
CSIN9000  CALL      TRIL0000               * write Trailer record
CSIN9999  RETURN
+
.******************************************************************************
.         Write records to ibaginaf file
.******************************************************************************
WGIN0000  COMPARE   ZERO,TOTTOTAL
          GOTO      WGIN5000 IF EQUAL
.
          CALL      CRTF0000              * Create the Text file
.
          PACK      KEY14,SP70
          CALL      RSDRTMP8
WGIN1000  CALL      RKDRTMP8
          BRANCH    OVRCD,WGIN5000
.
          MOVE      ZERO,TOTDTAMT
          PACK      KEY17,RECEIPTN,SP70
          CALL      RSRCDTE1
WGIN4000  CALL      RKRCDTE1
          BRANCH    OVRCD,WGIN1000
.
          MATCH     RECEIPTN,RCDTRECN       * Same receipt number?
          GOTO      WGIN1000 IF NOT EQUAL
.
          CALL      SETG0000                * set up ibaginaf 
          GOTO      WGIN4000
.
.         Check if there is any receipt allocation from Suspense register
.
WGIN5000  MOVE      "60",CLNO
          MOVE      ZERO,TOTSUSPN
          PACK      KEY25,SP70
          CALL      RSRCDTE2
WGIN6000  CALL      RKRCDTE2
          BRANCH    OVRCD,WGIN9000
.
          MATCH     SP70,RCDTRELD        * finished ???
          GOTO      WGIN9000 IF NOT EQUAL
.
          MOVE      SP70,DRAWERID
          PACK      KEY12,RCDTRECN,SP70
          CALL      RDRCBNK1
          BRANCH    OVRCD,WGIN6000
.
          MATCH     DRAWERF,RCBNCDRW      * check within Drawer range
          GOTO      WGIN6000 IF LESS
          MATCH     RCBNCDRW,DRAWERT
          GOTO      WGIN6000 IF LESS
.
          IF        IBCNMHOS=1
            PACK      KEY6,RCBNCDRW,SP70
            CALL      RDCIDA1
            BRANCH    OVRCD,WGIN6000
            MATCH     RCCIHOSP,WBSEHOSP
            GOTO      WGIN6000 IF NOT EQUAL        * different hospital
          ENDIF
.
          MATCH     "1",RCBNSTAT          * skip cancelled receipts
          GOTO      WGIN6000 IF EQUAL
.
          MATCH     SP70,RCBNBDAT
          GOTO      WGIN6000 IF EQUAL
.
          MATCH     SP70,RCDTSPDT         * Date suspense record allocated
          GOTO      WGIN6000 IF EQUAL
.
          PACK      KEY3,RCDTREGI,SP70
          CALL      RDREGA1
          IF        OVRCD=1
            MOVE      "Invalid Register    ",DESCREG
          ELSE
            PACK      DESCREG,REGDESC,SP70
          ENDIF
.
          MOVE      RCBNCDRW,DRAWERID
          CALL      RDDRAW00
.
          COMPARE   "55",CLNO
          CALL      PHED0000 IF NOT LESS
.
          MOVE      SP70,SYSDESC
          CALL      GETSYS00
.
          MOVE      SP70,PATNAM
          MATCH     SP70,RCDTURNO
          IF        @EQUAL
            PACK      PATNAM,RCDTNAME,SP70
          ELSE
            PACK      KEY8,RCDTURNO,SP70
            CALL      RDMAST1
            IF        OVRCD<>1
              SQUEEZE   PGNAME
              PACK      PATNAM,PGNAME,SP1,PSNAME,SP70
            ENDIF
          ENDIF
.
          IF        REGIBACD=92|REGIBACD=94|REGIBACD=95|REGIBACD=98|REGIBACD=99|REGIBACD=89
            PRINT     *1,DESCREG,*22,SYSDESC,*44,RCDTRECN,*57,RCDTREFR;
          ELSE
            IF        REGIBACD=1 | REGIBACD=2
              PRINT     *1,DESCREG,*22,SYSDESC,*44,RCDTRECN,*62,RCDTINVN;
            ELSE
              PRINT     *1,DESCREG,*22,SYSDESC,*44,RCDTRECN,*62,RCDTVIST;
            ENDIF
          ENDIF
          PRINT     *75,PATNAM,*102,RCDTAMNT,*118,DRAWERID
          ADD       ONE,CLNO
          ADD       RCDTAMNT,TOTSUSPN
.
          CALL      SETG0000              * set up ibaginaf 
          GOTO      WGIN6000
.
WGIN9000  CALL      UND132
          COMPARE   ZERO,TOTSUSPN
          GOTO      WGIN9999 IF EQUAL
          PRINT     *1,"Total Allocated Suspense Register",*102,TOTSUSPN
.
WGIN9999  RETURN
+
.******************************************************************************
.         Print header for the allocated suspense register
.******************************************************************************
PHED0000  CLOCK     TIME,CTIMEIS
          MOVE      ONE,CNOUNDLN
          CLOCK     TIME,CTIMEIS
          CALL      HEAD132 
          PRINT     *N,*N,*15,"*** Allocated Suspense Register Details ***"
          CALL      UND132
.
          PRINT     *1,"Register",*22,"System",*44,"Receipt No":
                    *57,"Inv/Adm/Ref No",*75,"Patient/Payer Name":
                    *102,"         Amount":
                    *118,"Drawer":
                    *N,"--------------------",*22,"---------------------":
                    *44,"------------",*57,"-----------------":
                    *75,"--------------------------":
                    *102,"---------------",*118,"---------------"
.
PHED9999  RETURN
+
.******************************************************************************
.         Set up ibagin file
.******************************************************************************
SETG0000  MOVE      RCDTREGI,KEY3
          CALL      RDREGA1
          BRANCH    OVRCD,SETG9999
.
          UNPACK    RCDTINCA,IBGILEDG       * Ledger
          UNPACK    RCDTBNKA,KEY2,IBGIACCT  * Account
          MOVE      RCDTTDAT,IBGIDATE       * Date
          MOVE      SP1,IBGISIGN            * Sign
          MOVE      RCDTAMNT,IBGIVALU       * Value
.
          COMPARE   "92",REGIBACD
          GOTO      SETG1000 IF EQUAL       * GST Sundry register
.
          UNPACK    RCDTINCA,KEY2,IBGICRAC  * Credit Acc. Cash
          COMPARE   ONE,REGIBACD
          GOTO      SETG3000 IF EQUAL       * Patient billing
.
          COMPARE   "94",REGIBACD
          GOTO      SETG2000 IF EQUAL
          COMPARE   "95",REGIBACD
          GOTO      SETG2000 IF EQUAL
          COMPARE   "98",REGIBACD
          GOTO      SETG2000 IF EQUAL
          COMPARE   "99",REGIBACD
          GOTO      SETG2000 IF EQUAL
          COMPARE   "89",REGIBACD
          GOTO      SETG2000 IF EQUAL
.
          MATCH     SP70,RCDTREFR
          GOTO      SETG3000 IF EQUAL
.
          PACK      IBGIDESC,RCDTREFR,SLASH,RCDTURNO,SP70
          GOTO      SETG4000
.
SETG1000  UNPACK    RCDTGSTA,KEY2,IBGICRAC   * GST Account/Credit Acc. Cash
.
SETG2000  PACK      IBGIDESC,RCDTNAME,SP70
          GOTO      SETG4000
.
SETG3000  PACK      IBGIDESC,RCDTINVN,SLASH,RCDTURNO,SLASH,RCDTVIST,SP70
.
SETG4000  PACK      IBGIREF,RCDTRECN,SP70   * Reference/Receipt number
          MOVE      SP70,IBGIDISS           * Dissection
          MOVE      SP70,IBGIRESP           * Responsibility
          MATCH     SP70,RCDTGSTC
          MOVE      SP70,IBGICRAA           * Credit Acc. Accrual
          MOVE      SP70,IBGIBASC           * Bas code
.
          CALL      WRCSHGL
SETG9999  RETURN
+
.******************************************************************************
.*                        Header record                                       *
.******************************************************************************
HREC0000  MOVE      "0000",KEY4
          MOVE      "Y",KEY1
          UNPACK    SP70,KEY16,KEY10,KEY8
.
          MOVE      ZERO,FORM15P2
          MOVE      ONE,F2
          WHILE     F2<=MAXHREC
            ADD       LODGHREC[F2],FORM15P2    * Totals
            ADD       ONE,F2
          DO
.
.         Get the number of Lodgement Header record
.         Direct Debit (4) will have an individual lodgement header as they will
.         appear on the bank statement individually
.
          MOVE      ZERO,F2
          REPEAT
            ADD       ONE,F2
            IF        LODGHREC[F2]<>0
              ADD       ONE,ITOTLREC
            ENDIF
          UNTIL     F2>=3
.
          MOVE      FOUR,F2
          IF        MAXHREC>4
            REPEAT
              ADD       ONE,F2
              IF        LODGHREC[F2]<>0
                ADD       ONE,ITOTLREC
              ENDIF
            UNTIL     F2=MAXHREC
          ENDIF
.
          WRITE     CASHINTR,SEQ;KEY4,KEY1,KEY16,RECDATE,FORM15P2,ITOTLREC:
                                 KEY10,KEY8
.
HREC9999  RETURN
+
.******************************************************************************
.*                Lodgement Header record                                     *
.******************************************************************************
LHDR0000  MOVE      "0300",KEY4
          UNPACK    SP70,KEY10,KEY16,DIM12,KEY6
          UNPACK    SP70,KEY20,KEY24,KEY3
          MOVE      SP70,KEY60
          MOVE      "WebPAS DEP",DIM10
          MOVE      "WebPAS Cash",KEY11
          PACK      KEY30,KEY11,SP70
          MOVE      SP70,SHORTNAM
.
          PACK      KEY12,RECEIPTN,SP70
          CALL      RDRCBNK1
          IF        OVRCD=0
            UNPACK    RCBNCHQA,DIM12        * Cheque account
            SQUEEZE   DIM12
            PACK      DIM12,DIM12,SP70
            UNPACK    RCBNBDAT,CCENT,CYEAR,CMON,CDAY
            PACK      KEY30,KEY11,CDAY,SLASH,CMON,SLASH,CCENT,CYEAR,SP70
            PACK      SHORTNAM,RCBNRCOD,SP70
          ENDIF
.
          MOVE      ZERO,F2
          MOVE      IPAYTYPE,F2
          MOVE      ZERO,FORM12P2
          MOVE      LODGHREC[F2],FORM12P2
          MOVE      LODGSREC[F2],FORM12D2       * GST
.
          IF        F2=4
            MOVE      RECEIPTN,RCBDRECN
            CALL      CGST0000                  * Get GST direct deposit
            MOVE      FORM12P2,FORM12D2         * GST 
            MOVE      PAYMAMNT,FORM12P2         * Total Direct deposit
          ENDIF
.
          MOVE      FORM12P2,FORM12X2
          SUB       FORM12D2,FORM12X2           * Exclusive GST
.
          IF        HSYS1=5
            CALL      RMTD00000                 * Setup Receipt Method
            UNPACK    SP70,KEY20,KEY30
            WRITE     CASHINTR,SEQ;KEY4,KEY10,DIM10,KEY10,KEY16,DIM12,KEY6,DIM6:
                                 KEY20,RECDATE,KEY24,KEY3,KEY30,KEY60:
                                 FORM12X2,FORM12D2,FORM12P2:
                                 ZEROFLD,ZEROFLD,ZEROFLD,ZEROFLD:
                                 FORM12P2,FORM12P2,ZEROFLD,ZEROFLD
          ELSE
            WRITE     CASHINTR,SEQ;KEY4,KEY10,DIM10,KEY10,KEY16,DIM12,KEY6,KEY6:
                                 KEY20,RECDATE,KEY24,KEY3,KEY30,KEY60:
                                 FORM12X2,FORM12D2,FORM12P2:
                                 ZEROFLD,ZEROFLD,ZEROFLD,ZEROFLD:
                                 FORM12P2,FORM12P2,ZEROFLD,ZEROFLD
          ENDIF
.
LHDR9999  RETURN
+
.******************************************************************************
.         Set up Receipt Method
.******************************************************************************
RMTD0000  MOVE      SP70,DIM6                 * Receipt Method
          MOVE      ZERO,F2
          MOVE      IPAYTYPE,F2
          BRANCH    F2,RMTD1000,RMTD2000,RMTD3000,RMTD4000,RMTD5000:
                       RMTD6000,RMTD7000,RMTD8000,RMTD9000,RMTD9100:
                       RMTD9200,RMTD9300,RMTD9400
          COMPARE   ZERO,F2
          GOTO      RMTD9999 IF EQUAL
.
          SUB       "13",F2
          MOVE      NINE,FORM2
          ADD       F2,FORM2
.
          MOVE      "CRCARD",DIM6
          MOVE      FORM2,SVCDNHCP
          GOTO      RMTD9800
.
RMTD1000  MOVE      "Cash  ",DIM6
          MOVE      " 1",SVCDNHCP
          GOTO      RMTD9800
.
RMTD2000  MOVE      "CrCard",DIM6
          MOVE      " 3",SVCDNHCP
          GOTO      RMTD9800
.
RMTD3000  MOVE      "AMEX  ",DIM6
          GOTO      RMTD9999
.
RMTD4000  MOVE      "DirDep",DIM6
          MOVE      " 4",SVCDNHCP
          GOTO      RMTD9800
.
RMTD5000  MOVE      "Visa  ",DIM6
          GOTO      RMTD9999
.
RMTD6000  MOVE      "Master",DIM6
          GOTO      RMTD9999
.
RMTD7000  MOVE      "Cheque",DIM6
          MOVE      " 2",SVCDNHCP
          GOTO      RMTD9800
.
RMTD8000  MOVE      "MonOrd",DIM6
          MOVE      " 5",SVCDNHCP
          GOTO      RMTD9800
.
RMTD9000  MOVE      "EFT/Cs",DIM6
          GOTO      RMTD9999
.
RMTD9100  MOVE      "EFT/Cr",DIM6
          GOTO      RMTD9999
.
RMTD9200  MOVE      "BPAY  ",DIM6
          MOVE      " 7",SVCDNHCP
          GOTO      RMTD9800
.
RMTD9300  MOVE      "VirTer",DIM6
          MOVE      " 8",SVCDNHCP
          GOTO      RMTD9800
.
RMTD9400  MOVE      "Medicr",DIM6
          MOVE      " 9",SVCDNHCP
          GOTO      RMTD9800
.
RMTD9800  CALL     PTYP0000                * Get payment type description
          IF        EXIT=0
            PACK      DIM6,TDESC
          ENDIF
.
RMTD9999  RETURN
+
.******************************************************************************
.*            Receipt Lodgment line record                                    *
.******************************************************************************
RLOD0000  MOVE      "0600",KEY4
          UNPACK    SP70,DIM10,KEY10,KEY16,KEY6,KEY10
.
          REP       " 0",RCDTTDAT
          MOVE      ZERO,FORM12
          MOVE      RCDTRECN,FORM12
          MOVE      ZERO,F7
          MOVE      FORM12,F7
          MOVE      ZERO,F8
          MOVE      COUNTTRN,F8
          MOVE      ZERO,F3
          MOVE      F8,F3
          PACK      DIM10,F7,F3,SP70
          REP       " 0",DIM10
          MOVE      "N  ",KEY3
          MOVE      "N",DIM1                 * Has no GST value
          IF        GSTFLAG=1
            MOVE      "Y",DIM1
          ENDIF
          IF        HSYS1=5
            WRITE     CASHINTR,SEQ;KEY4,DIM10,RCDTTDAT,RCPTDETL,ANSY,KEY3,DIM1:
                                 RCDTAMNT,KEY16,KEY6,KEY6,KEY10
          ELSE
            WRITE     CASHINTR,SEQ;KEY4,DIM10,RCDTTDAT,RCPTDETL,ANSY,KEY3,DIM1:
                                 RCDTAMNT,KEY16,KEY6,KEY6,KEY10
          ENDIF
.
RLOD9999  RETURN
+
.******************************************************************************
.*                   Payee details                                            *
.******************************************************************************
PYEE0000  MOVE      "0700",KEY4
          UNPACK    SP70,KEY12,KEY30,KEY8,KEY1,KEY12,KEY18
          IF        HSYS1=5
            WRITE     CASHINTR,SEQ;KEY4,PAYENAME:
                                 SHORTNAM,KEY30,KEY30,KEY30,KEY30,KEY30:
                                 KEY8,KEY1,KEY12,KEY12,KEY18
          ELSE
            WRITE     CASHINTR,SEQ;KEY4,PAYENAME:
                                 KEY12,KEY30,KEY30,KEY30,KEY30,KEY30:
                                 KEY8,KEY1,KEY12,KEY12,KEY18
          ENDIF
PYEE9999  RETURN
+
.******************************************************************************
.*                Get GST amount                                              *
.******************************************************************************
GGST0000  MOVE      ZERO,FORM12P2
          MATCH     SP70,RCDTGSTC
          GOTO      GGST8000 IF EQUAL
.
          OPEN     IBAGEDA1,"ibagedaf"
          MOVE     ZERO,IBGEAMNT             * zero GST percentage
          REP      " 0",RCDTTDAT
          PACK     KEY14,RCDTGSTC,RCDTTDAT,SP70
          CALL     RDIBGE1
          COMPARE  ZERO,OVRCD
          GOTO     GGST4000 IF EQUAL         * found GST amount for current date
.
          CALL     RPIBGE1                   * read previous record
          BRANCH   OVRCD,GGST2000
.
          MATCH    RCDTGSTC,IBGECODE         * Same code ?
          GOTO     GGST4000 IF EQUAL
.
GGST2000  MOVE     ZERO,IBGEAMNT
.
.         GST amount is calculated differently for HSYS1=3 and 5 Integra
.         eg. for Receipt (Inc.GST) = $110    GST = 10%
.         for RCCNEGST=0 GST amount = 10% of $110 = $11 and GST Exc.=$110-11=$99
.         for RCCNEGST=1 GST Exc.= $110/1.1=$100 and GST amount=$10
.
GGST4000  COMPARE   FIVE,HSYS1
          GOTO      GGST4200 IF EQUAL      * Extended Integra
          COMPARE   THREE,HSYS1
          GOTO      GGST5000 IF NOT EQUAL  * Not running Integra
.
GGST4200  MATCH     "1",RCCNEGST
          GOTO      GGST5000 IF NOT EQUAL
.
          MOVE      IBGEAMNT,FORM12P2
          ADD       "100",FORM12P2
          DIV       "100",FORM12P2
.
          MOVE      RCDTAMNT,FORM12D2
          DIV       FORM12P2,FORM12D2       * exclusive GST
.
          MOVE      RCDTAMNT,FORM12P2
          SUB       FORM12D2,FORM12P2       * GST amount
          MOVE      FORM12D2,RCDTAMNT       * exclusive GST
          GOTO      GGST9999
.
GGST5000  MOVE      RCDTAMNT,FORM12P2
          MULT      IBGEAMNT,FORM12P2
          DIV       "100.00",FORM12P2
.
GGST8000  SUB       FORM12P2,RCDTAMNT         * exclusive GST amount
.
GGST9999  RETURN
+
.******************************************************************************
.*                Trailer record                                              *
.******************************************************************************
TRIL0000  MOVE      "9999",KEY4
          WRITE     CASHINTR,SEQ;KEY4
TRIL9999  RETURN
+
.****************************************************************************
.         Create a Text file for Integra Cash Interface
.****************************************************************************
CRTF0000  
          MOVE      HDATARCP,KEY40
          SQUEEZE   KEY40
          CLEAR     KEY60
          APPEND    KEY40,KEY60
          APPEND    TXTFNAME,KEY60
          APPEND    ".txt",KEY60
          APPEND    SP70,KEY60
          RESET     KEY60
.
          TRAP      CRTF5000 IF IO
          IF        HSYS1=4
            OPEN      CASHLEDG,KEY60
          ELSE
            OPEN      CASHINTR,KEY60
          ENDIF
          TRAPCLR   IO
.
CRTF1000  IF        HSYS1=4
            CLOSE     CASHLEDG,DELETE
          ELSE
            CLOSE     CASHINTR,DELETE
          ENDIF
          GOTO      CRTF7000
.
.         Create new ASCII file
.
CRTF5000  NORETURN
.
CRTF7000  IF        HSYS1=4
            PREP      CASHLEDG,KEY60
          ELSE
            PREP      CASHINTR,KEY60
          ENDIF
          MOVE      ZERO,EXIT
CRTF9999  RETURN
+
.******************************************************************************
.*                                  CCSV0000              Called by: ML0000   *
.*                  Convert ".txt" file to a ".csv"                           *
.******************************************************************************
CCSV0000  COMPARE   ONE,CSVFLAG
          GOTO      CCSV9999 IF NOT EQUAL     * Not generating a CSV file
.
          MOVE      ZERO,EXIT
          STRIP     RSCNROD                 * output directory
.                                           * change the file name to ".txt"
          RESET     FNAMEL
          SQUEEZE   FNAMEL
          CLEAR     CMDLINE
          APPEND    "cp ",CMDLINE
          APPEND    FNAMEO,CMDLINE
          APPEND    ".txt",CMDLINE
          APPEND    SP1,CMDLINE
          APPEND    RSCNROD,CMDLINE
          APPEND    CSVFNAME,CMDLINE
          APPEND    ".csv",CMDLINE
          RESET     CMDLINE
          EXECUTE   CMDLINE,TASKID
.
CCSV9999  RETURN
+
.******************************************************************************
.*                                   HEADX000                                 *
.*                     Routine to determine if Header is printed              *
.******************************************************************************
HEADX000  MOVE      ZERO,OVRCD
          BRANCH    HDBYPASS,HEADX100
.
          IF        EXPORTFL=0
            CALL      HEAD132
          ENDIF
.
HEADX100  MOVE      ZERO,CLNO
.
HEADX999  RETURN
+
.******************************************************************************
.*                        I/O Routines For The Tempfile                       *
.******************************************************************************
RSDRTMP1  MOVE      ZERO,OVRCD
          RESET     KEY18
          READ      DRAWTMP1,KEY18;;
          RETURN
.
RKDRTMP1  MOVE      ZERO,OVRCD
          RESET     KEY18
          READKS    DRAWTMP1;DRAWERID,RECEIPTN,REGISTER
          GOTO      OVERCOND IF OVER
          RETURN
.
RDDRTMP1  MOVE      ZERO,OVRCD
          RESET     KEY18
          READ      DRAWTMP1,KEY18;DRAWERID,RECEIPTN,REGISTER
          GOTO      OVERCOND IF OVER
          RETURN
.
WRDRTMP1  MOVE      ZERO,OVRCD
          RESET     KEY18
          WRITE     DRAWTMP1,KEY18;KEY18
          RETURN
.
RSDRTMP2  MOVE      ZERO,OVRCD
          RESET     KEY29
          READ      DRAWTMP2,KEY29;;
          RETURN
.
RKDRTMP2  MOVE      ZERO,OVRCD
          RESET     KEY29
          READKS    DRAWTMP2;DRAWERID,REGISTER,INVOICEN,COUNTREC,RECEIPTN:
                             INAMOUNT,DSAMOUNT,VISNUMB,URNUMB,SCFLAG,PNAME:
                             REFERENC
          GOTO      OVERCOND IF OVER
          RETURN
.
RDDRTMP2  MOVE      ZERO,OVRCD
          RESET     KEY29
          READ      DRAWTMP2,KEY29;DRAWERID,REGISTER,INVOICEN,COUNTREC,RECEIPTN:
                             INAMOUNT,DSAMOUNT,VISNUMB,URNUMB,SCFLAG,PNAME:
                             REFERENC
          GOTO      OVERCOND IF OVER
          RETURN
.
WRDRTMP2  MOVE      ZERO,OVRCD
          RESET     KEY29
          WRITE     DRAWTMP2,KEY29;KEY29,RECEIPTN,INAMOUNT,DSAMOUNT:
                                   VISNUMB,URNUMB,SCFLAG,PNAME,REFERENC
          RETURN
.
UPDRTMP2  MOVE      ZERO,OVRCD
          UPDATE    DRAWTMP2;DRAWERID,REGISTER,INVOICEN,COUNTREC,RECEIPTN:
                             INAMOUNT,DSAMOUNT,VISNUMB,URNUMB,SCFLAG,PNAME:
                             REFERENC
          RETURN
.
RSDRTM12  MOVE      ZERO,OVRCD
          RESET     KEY29
          READ      DRAWTM12,KEY29;;
          RETURN
.
RKDRTM12  MOVE      ZERO,OVRCD
          RESET     KEY29
          READKS    DRAWTM12;DRAWERID,REGISTER,INVOICEN,COUNTREC,RECEIPTN:
                             INAMOUNT,DSAMOUNT,VISNUMB,URNUMB,SCFLAG,PNAME:
                             REFERENC
          GOTO      OVERCOND IF OVER
          RETURN
.
RSDRTMP3  MOVE      ZERO,OVRCD
          RESET     KEY43
          READ      DRAWTMP3,KEY43;;
          RETURN
.
RKDRTMP3  MOVE      ZERO,OVRCD
          RESET     KEY43
          READKS    DRAWTMP3;DRAWERID,RECEIPTN,CHQACCNT,PAYMTYPE,COUNTREC:
                             CHQNUMB,CHQDRAW,CHQBANK,CHQBRNCH,CHQAMNT,DDREFER:
                             PAYEE,EFTTYPE,CARDTYPE,PRNTORD,PAYMCODE
          GOTO      OVERCOND IF OVER
          RETURN
.
RDDRTMP3  MOVE      ZERO,OVRCD
          RESET     KEY43
          READ      DRAWTMP3,KEY43;DRAWERID,RECEIPTN,CHQACCNT,PAYMTYPE,COUNTREC:
                             CHQNUMB,CHQDRAW,CHQBANK,CHQBRNCH,CHQAMNT,DDREFER:
                             PAYEE,EFTTYPE,CARDTYPE,PRNTORD,PAYMCODE
          GOTO      OVERCOND IF OVER
          RETURN
.
WRDRTMP3  MOVE      ZERO,OVRCD
          RESET     KEY43
          WRITE     DRAWTMP3,KEY43;DRAWERID,RECEIPTN,CHQACCNT,PAYMTYPE,COUNTREC:
                             CHQNUMB,CHQDRAW,CHQBANK,CHQBRNCH,CHQAMNT,DDREFER:
                             PAYEE,EFTTYPE,CARDTYPE,PRNTORD,PAYMCODE
          RETURN
.
RSDRTMP4  MOVE      ZERO,OVRCD
          RESET     KEY17
          READ      DRAWTMP4,KEY17;;
          RETURN
.
RKDRTMP4  MOVE      ZERO,OVRCD
          RESET     KEY17
          READKS    DRAWTMP4;DRAWERID,REGISTER,RECPDATE,HEADTYPE
          GOTO      OVERCOND IF OVER
          RETURN
.
RDDRTMP4  MOVE      ZERO,OVRCD
          RESET     KEY17
          READ      DRAWTMP4,KEY17;DRAWERID,REGISTER,RECPDATE,HEADTYPE
          GOTO      OVERCOND IF OVER
          RETURN
.
WRDRTMP4  MOVE      ZERO,OVRCD
          RESET     KEY17
          WRITE     DRAWTMP4,KEY17;DRAWERID,REGISTER,RECPDATE,HEADTYPE
          RETURN
.
UPDRTMP4  MOVE      ZERO,OVRCD
          UPDATE    DRAWTMP4;DRAWERID,REGISTER,RECPDATE,HEADTYPE
          RETURN
.
RSDRTM10  MOVE      ZERO,OVRCD
          RESET     KEY19
          READ      DRAWTM10,KEY19;;
          RETURN
.
RKDRTM10  MOVE      ZERO,OVRCD
          RESET     KEY19
          READKS    DRAWTM10;DRAWERID,REGISTER,RECPDATE,SUMRTYPE,SUMAMNT
          GOTO      OVERCOND IF OVER
          RETURN
.
RDDRTM10  MOVE      ZERO,OVRCD
          RESET     KEY19
          READ      DRAWTM10,KEY19;DRAWERID,REGISTER,RECPDATE,SUMRTYPE,SUMAMNT
          GOTO      OVERCOND IF OVER
          RETURN
.
WRDRTM10  MOVE      ZERO,OVRCD
          RESET     KEY19
          WRITE     DRAWTM10,KEY19;DRAWERID,REGISTER,RECPDATE,SUMRTYPE,SUMAMNT
          RETURN
.
UPDRTM10  MOVE      ZERO,OVRCD
          UPDATE    DRAWTM10;DRAWERID,REGISTER,RECPDATE,SUMRTYPE,SUMAMNT
          RETURN
.
RSDRTM11  MOVE      ZERO,OVRCD
          RESET     KEY5
          READ      DRAWTM11,KEY5;;
          RETURN
.
RKDRTM11  MOVE      ZERO,OVRCD
          RESET     KEY5
          READKS    DRAWTM11;SPAYTYPE,SPAYCODE
          GOTO      OVERCOND IF OVER
          RETURN
.
RDDRTM11  MOVE      ZERO,OVRCD
          RESET     KEY5
          READ      DRAWTM11,KEY5;SPAYTYPE,SPAYCODE
          GOTO      OVERCOND IF OVER
          RETURN
.
UPDRTM11  MOVE      ZERO,OVRCD
          UPDATE    DRAWTM11;SPAYTYPE,SPAYCODE
          RETURN
.
WRDRTM11  MOVE      ZERO,OVRCD
          RESET     KEY5
          WRITE     DRAWTM11,KEY5;SPAYTYPE,SPAYCODE
          RETURN
.
RSDRTMP5  MOVE      ZERO,OVRCD
          RESET     KEY41
          READ      DRAWTMP5,KEY41;;
          RETURN    
.         
RKDRTMP5  MOVE      ZERO,OVRCD
          RESET     KEY41
          READKS    DRAWTMP5;DRAWERID,REGISTER,INVOICEN,COUNTREC,RECEIPTN:
                             INAMOUNT,DSAMOUNT,VISNUMB,URNUMB,SCFLAG,PNAME:
                             REFERENC,ALOCAMNT,ALOCDATE
          GOTO      OVERCOND IF OVER
          RETURN    
.         
RDDRTMP5  MOVE      ZERO,OVRCD
          RESET     KEY41
          READ      DRAWTMP5,KEY41;DRAWERID,REGISTER,INVOICEN,COUNTREC,RECEIPTN:
                             INAMOUNT,DSAMOUNT,VISNUMB,URNUMB,SCFLAG,PNAME:
                             REFERENC,ALOCAMNT,ALOCDATE
          GOTO      OVERCOND IF OVER
          RETURN
.
WRDRTMP5  MOVE      ZERO,OVRCD
          RESET     KEY41
          WRITE     DRAWTMP5,KEY41;DRAWERID,REGISTER,INVOICEN,COUNTREC:
                                   RECEIPTN,INAMOUNT,DSAMOUNT:
                                   VISNUMB,URNUMB,SCFLAG,PNAME,REFERENC:
                                   ALOCAMNT,ALOCDATE
          RETURN
.
DEDRTMP5  RESET     KEY41
          DELETE    DRAWTMP5,KEY41
          RETURN
.
RSDRTMP6  MOVE      ZERO,OVRCD
          RESET     KEY43
          READ      DRAWTMP6,KEY43;;
          RETURN
.
RKDRTMP6  MOVE      ZERO,OVRCD
          RESET     KEY43
          READKS    DRAWTMP6;DRAWERID,RECEIPTN,CHQACCNT,PAYMTYPE,COUNTREC:
                             CHQNUMB,CHQDRAW,CHQBANK,CHQBRNCH,CHQAMNT,DDREFER:
                             PAYEE,EFTTYPE,CARDTYPE,PRNTORD,PAYMCODE
          GOTO      OVERCOND IF OVER
          RETURN
.
RDDRTMP6  MOVE      ZERO,OVRCD
          RESET     KEY43
          READ      DRAWTMP6,KEY43;DRAWERID,RECEIPTN,CHQACCNT,PAYMTYPE,COUNTREC:
                             CHQNUMB,CHQDRAW,CHQBANK,CHQBRNCH,CHQAMNT,DDREFER:
                             PAYEE,EFTTYPE,CARDTYPE,PRNTORD,PAYMCODE
          GOTO      OVERCOND IF OVER
          RETURN
.
WRDRTMP6  MOVE      ZERO,OVRCD
          RESET     KEY43
          WRITE     DRAWTMP6,KEY43;DRAWERID,RECEIPTN,CHQACCNT,PAYMTYPE,COUNTREC:
                             CHQNUMB,CHQDRAW,CHQBANK,CHQBRNCH,CHQAMNT,DDREFER:
                             PAYEE,EFTTYPE,CARDTYPE,PRNTORD,PAYMCODE
          RETURN
.
.         Temporary file for Integra Cash Interface
.
RSDRTMP7  MOVE      ZERO,OVRCD
          RESET     KEY14
          READ      DRAWTMP7,KEY14;;
          RETURN
.
RKDRTMP7  MOVE      ZERO,OVRCD
          RESET     KEY14
          READKS    DRAWTMP7;DRAWERID,RECEIPTN,CHQACCNT,IPAYTYPE,DIM8:
                             CHQNUMB,CHQDRAW,CHQBANK,CHQBRNCH,PAYMAMNT,DDREFER:
                             PAYEE,EFTTYPE,CARDTYPE
          GOTO      OVERCOND IF OVER
          RETURN
.
RDDRTMP7  MOVE      ZERO,OVRCD
          RESET     KEY14
          READ      DRAWTMP7,KEY14;DRAWERID,RECEIPTN,CHQACCNT,IPAYTYPE,DIM8:
                             CHQNUMB,CHQDRAW,CHQBANK,CHQBRNCH,PAYMAMNT,DDREFER:
                             PAYEE,EFTTYPE,CARDTYPE
          GOTO      OVERCOND IF OVER
          RETURN
.
WRDRTMP7  MOVE      ZERO,OVRCD
          RESET     KEY14
          WRITE     DRAWTMP7,KEY14;DRAWERID,RECEIPTN,CHQACCNT,IPAYTYPE,DIM8:
                             CHQNUMB,CHQDRAW,CHQBANK,CHQBRNCH,PAYMAMNT,DDREFER:
                             PAYEE,EFTTYPE,CARDTYPE
          RETURN
.
UPDRTMP7  MOVE      ZERO,OVRCD
          UPDATE    DRAWTMP7;DRAWERID,RECEIPTN,CHQACCNT,IPAYTYPE,DIM8:
                             CHQNUMB,CHQDRAW,CHQBANK,CHQBRNCH,PAYMAMNT,DDREFER:
                             PAYEE,EFTTYPE,CARDTYPE
          RETURN
.
RSDRTMP8  MOVE      ZERO,OVRCD
          RESET     KEY14
          READ      DRAWTMP8,KEY14;;
          RETURN
.
RKDRTMP8  MOVE      ZERO,OVRCD
          RESET     KEY14
          READKS    DRAWTMP8;DRAWERID,RECEIPTN,CHQACCNT,IPAYTYPE,DIM8:
                             CHQNUMB,CHQDRAW,CHQBANK,CHQBRNCH,PAYMAMNT,DDREFER:
                             PAYEE,EFTTYPE,CARDTYPE
          GOTO      OVERCOND IF OVER
          RETURN
.
.         Temporary file for Integra Cash Interface Transaction lines
.
RSDRTMP9  MOVE      ZERO,OVRCD
          RESET     KEY22
          READ      DRAWTMP9,KEY22;;
          RETURN
.
RKDRTMP9  MOVE      ZERO,OVRCD
          RESET     KEY22
          READKS    DRAWTMP9;PAYCTYPE,RCDTRECN,COUNTTRN,RCDTTDAT,RCDTINVN:
                             RCDTVIST,RCDTURNO,RCDTNAME,RCDTREFR,RCDTINCA:
                             TRNLAMNT,RCDTGSTC,RCDTREGI
          GOTO      OVERCOND IF OVER
          RETURN
.
RDDRTMP9  MOVE      ZERO,OVRCD
          RESET     KEY22
          READ      DRAWTMP9,KEY22;PAYCTYPE,RCDTRECN,COUNTTRN,RCDTTDAT,RCDTINVN:
                             RCDTVIST,RCDTURNO,RCDTNAME,RCDTREFR,RCDTINCA:
                             TRNLAMNT,RCDTGSTC,RCDTREGI
          GOTO      OVERCOND IF OVER
          RETURN
.
WRDRTMP9  MOVE      ZERO,OVRCD
          RESET     KEY22
          WRITE     DRAWTMP9,KEY22;PAYCTYPE,RCDTRECN,COUNTTRN,RCDTTDAT,RCDTINVN:
                             RCDTVIST,RCDTURNO,RCDTNAME,RCDTREFR,RCDTINCA:
                             TRNLAMNT,RCDTGSTC,RCDTREGI
          RETURN
.
RSCREDF1  MOVE      ZERO,OVRCD
          RESET     KEY10
          READ      CREDFIL1,KEY10;;
          RETURN
.
RKCREDF1  MOVE      ZERO,OVRCD
          RESET     KEY10
          READKS    CREDFIL1;CREDDRAW,CREDINDC,CREDCODE,CREDAMNT,CREDSPAR
          GOTO      OVERCOND IF OVER
          RETURN
.
RDCREDF1  MOVE      ZERO,OVRCD
          RESET     KEY10
          READ      CREDFIL1,KEY10;CREDDRAW,CREDINDC,CREDCODE,CREDAMNT,CREDSPAR
          GOTO      OVERCOND IF OVER
          RETURN
.
WRCREDF1  MOVE      ZERO,OVRCD
          RESET     KEY10
          WRITE     CREDFIL1,KEY10;CREDDRAW,CREDINDC,CREDCODE,CREDAMNT,CREDSPAR
          RETURN
.
UPCREDF1  MOVE      ZERO,OVRCD
          UPDATE    CREDFIL1;CREDDRAW,CREDINDC,CREDCODE,CREDAMNT,CREDSPAR
          RETURN
.
RSCREDF2  MOVE      ZERO,OVRCD
          RESET     KEY10
          READ      CREDFIL2,KEY10;;
          RETURN
.
RKCREDF2  MOVE      ZERO,OVRCD
          RESET     KEY10
          READKS    CREDFIL2;CREDDRAW,CREDINDC,CREDCODE,CREDAMNT,CREDSPAR
          GOTO      OVERCOND IF OVER
          RETURN
.
RSEFTPF1  MOVE      ZERO,OVRCD
          RESET     KEY10
          READ      EFTPFIL1,KEY10;;
          RETURN
.
RKEFTPF1  MOVE      ZERO,OVRCD
          RESET     KEY10
          READKS    EFTPFIL1;EFTPDRAW,EFTPINDC,EFTPCODE,EFTPAMNT,EFTSSPAR
          GOTO      OVERCOND IF OVER
          RETURN
.
RDEFTPF1  MOVE      ZERO,OVRCD
          RESET     KEY10
          READ      EFTPFIL1,KEY10;EFTPDRAW,EFTPINDC,EFTPCODE,EFTPAMNT,EFTSSPAR
          GOTO      OVERCOND IF OVER
          RETURN
.
WREFTPF1  MOVE      ZERO,OVRCD
          RESET     KEY10
          WRITE     EFTPFIL1,KEY10;EFTPDRAW,EFTPINDC,EFTPCODE,EFTPAMNT,EFTSSPAR
          RETURN
.
UPEFTPF1  MOVE      ZERO,OVRCD
          UPDATE    EFTPFIL1;EFTPDRAW,EFTPINDC,EFTPCODE,EFTPAMNT,EFTSSPAR
          RETURN
.
RSEFTPF2  MOVE      ZERO,OVRCD
          RESET     KEY10
          READ      EFTPFIL2,KEY10;;
          RETURN
.
RKEFTPF2  MOVE      ZERO,OVRCD
          RESET     KEY10
          READKS    EFTPFIL2;EFTPDRAW,EFTPINDC,EFTPCODE,EFTPAMNT,EFTSSPAR
          GOTO      OVERCOND IF OVER
          RETURN
.
RDEFTPF2  MOVE      ZERO,OVRCD
          RESET     KEY10
          READ      EFTPFIL2,KEY10;EFTPDRAW,EFTPINDC,EFTPCODE,EFTPAMNT,EFTSSPAR
          GOTO      OVERCOND IF OVER
          RETURN
.
RSGNDTF1  MOVE      ZERO,OVRCD
          RESET     KEY5
          READ      GNDTFIL1,KEY5;;
          RETURN
.
RKGNDTF1  MOVE      ZERO,OVRCD
          RESET     KEY5
          READKS    GNDTFIL1;GNDTTYPE,GNDTINDC,GNDTCARD,GNDTAMNT,GNDTSPAR
          GOTO      OVERCOND IF OVER
          RETURN
.
RDGNDTF1  MOVE      ZERO,OVRCD
          RESET     KEY5
          READ      GNDTFIL1,KEY5;GNDTTYPE,GNDTINDC,GNDTCARD,GNDTAMNT,GNDTSPAR
          GOTO      OVERCOND IF OVER
          RETURN
.
WRGNDTF1  MOVE      ZERO,OVRCD
          RESET     KEY5
          WRITE     GNDTFIL1,KEY5;GNDTTYPE,GNDTINDC,GNDTCARD,GNDTAMNT,GNDTSPAR
          RETURN
.
UPGNDTF1  MOVE      ZERO,OVRCD
          UPDATE    GNDTFIL1;GNDTTYPE,GNDTINDC,GNDTCARD,GNDTAMNT,GNDTSPAR
          RETURN
.
RSCSVTM1  MOVE      ZERO,OVRCD
          RESET     KEY12
          READ      CSVCTMP1,KEY12;;
          RETURN
.
RKCSVTM1  MOVE      ZERO,OVRCD
          RESET     KEY12
          READKS    CSVCTMP1;DTDRAWER,DTPYTYPE,DTCRTYPE,DTCOLNUM,DTAMOUNT
          GOTO      OVERCOND IF OVER
          RETURN
.
RDCSVTM1  MOVE      ZERO,OVRCD
          RESET     KEY12
          READ      CSVCTMP1,KEY12;DTDRAWER,DTPYTYPE,DTCRTYPE,DTCOLNUM,DTAMOUNT
          GOTO      OVERCOND IF OVER
          RETURN
.
WRCSVTM1  MOVE      ZERO,OVRCD
          RESET     KEY12
          WRITE     CSVCTMP1,KEY12;DTDRAWER,DTPYTYPE,DTCRTYPE,DTCOLNUM,DTAMOUNT
          RETURN
.
UPCSVTM1  MOVE      ZERO,OVRCD
          UPDATE    CSVCTMP1;DTDRAWER,DTPYTYPE,DTCRTYPE,DTCOLNUM,DTAMOUNT
          RETURN
.
RSCSVTM2  MOVE      ZERO,OVRCD
          RESET     KEY12
          READ      CSVCTMP2,KEY12;;
          RETURN
.
RKCSVTM2  MOVE      ZERO,OVRCD
          RESET     KEY12
          READKS    CSVCTMP2;DTDRAWER,DTPYTYPE,DTCRTYPE,DTCOLNUM,DTAMOUNT
          GOTO      OVERCOND IF OVER
          RETURN
.
RDCSVTM2  MOVE      ZERO,OVRCD
          RESET     KEY12
          READ      CSVCTMP2,KEY12;DTDRAWER,DTPYTYPE,DTCRTYPE,DTCOLNUM,DTAMOUNT
          GOTO      OVERCOND IF OVER
          RETURN
.
WRCSVTM2  MOVE      ZERO,OVRCD
          RESET     KEY12
          WRITE     CSVCTMP2,KEY12;DTDRAWER,DTPYTYPE,DTCRTYPE,DTCOLNUM,DTAMOUNT
          RETURN
.
UPCSVTM2  MOVE      ZERO,OVRCD
          UPDATE    CSVCTMP2;DTDRAWER,DTPYTYPE,DTCRTYPE,DTCOLNUM,DTAMOUNT
          RETURN
.
RSCSVTM3  MOVE      ZERO,OVRCD
          RESET     KEY14
          READ      CSVCTMP3,KEY14;;
          RETURN
.
RKCSVTM3  MOVE      ZERO,OVRCD
          RESET     KEY14
          READKS    CSVCTMP3;DTDRAWER,DTPYTYPE,DTCRTYPE,DTCOLNUM,DTAMOUNT
          GOTO      OVERCOND IF OVER
          RETURN
.
RDCSVTM3  MOVE      ZERO,OVRCD
          RESET     KEY14
          READ      CSVCTMP3,KEY14;DTDRAWER,DTPYTYPE,DTCRTYPE,DTCOLNUM,DTAMOUNT
          GOTO      OVERCOND IF OVER
          RETURN
.
WRCSVTM3  MOVE      ZERO,OVRCD
          RESET     KEY14
          WRITE     CSVCTMP3,KEY14;DTDRAWER,DTPYTYPE,DTCRTYPE,DTCOLNUM,DTAMOUNT
          RETURN
.
UPCSVTM3  MOVE      ZERO,OVRCD
          UPDATE    CSVCTMP3;DTDRAWER,DTPYTYPE,DTCRTYPE,DTCOLNUM,DTAMOUNT
          RETURN
.
.        HSYS1=4 Write to a comma delimited file
.        ================================================
WRCSHGL  MOVE      SP3,IBGIBASC
         STRIP     IBGILEDG
         STRIP     IBGIACCT
         STRIP     IBGIDATE
         STRIP     IBGISIGN
         MOVE      IBGIVALU,KEY15
         SQUEEZE   KEY15
         STRIP     IBGIDESC
         STRIP     IBGIREF
         STRIP     IBGIDISS
         STRIP     IBGIRESP
         STRIP     IBGICRAC
         STRIP     IBGICRAA
         STRIP     IBGIBASC
.
         WRITE     CASHLEDG,SEQ;*+,IBGILEDG,COMMA,IBGIACCT,COMMA:
                               IBGIDATE,COMMA,IBGISIGN,COMMA:
                               KEY15,COMMA,IBGIDESC,COMMA:
                               IBGIREF,COMMA,IBGIDISS,COMMA:
                               IBGIRESP,COMMA,IBGICRAC,COMMA:
                               IBGICRAA,COMMA,IBGIBASC
         RETURN
+
         INC       TFILENAM                * Generate Temp File Name
         INC       IBASEQIO/INC            * Sequential Numbers File
         INC       WEBERRIO/INC            * Web Server Error Logging
         INC       IBAGINIO/INC
.
         INC       RSHWEBCD
         INC       FMSCHQIO/INC
         INC       PATCODIO/INC
         INC       PATMA1IO/INC
         INC       PMSCMMIO/INC
         INC       DEBDBTIO/INC
         INC       RCPBNKIO/INC
         INC       RCPBDTIO/INC
         INC       RCPDTEIO/INC
         INC       RCPCIDIO/INC
         INC       RCPREGIO/INC
         INC       WEBSECIO/INC
         INC       WEBSCHIO/INC
         INC       IBAGEDIO/INC
         INC       PATHSPIO/INC
.
         INC        STD001IO
