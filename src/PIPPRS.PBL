.******************************************************************************
.* System   : Patient Management                                              *
.* Program  : PIPPRS                                                          *
.* Desc     : PRS2 Extract to delimited files.                                *
.******************************************************************************
.* Date     : 05/10/2000                                                      *
.* Author   : Greg Horvat/Dean Cramer                                         *
.* Function : This program creates pipe delimited files by record type from   *
.*            the PRS2 extract file.                                          *
.* Mods     :                                                                 *
.*            V10.08.01 01/04/2016  Steve Armstrong   TSK 0324703             *
.*                      Recompiled for changes to PATURCFD                    *
.******************************************************************************
.*            V10.04.02 31/12/2013  Don Nguyen        CAR 294451              *
.*                      Recompiled for changes to PATYTDFD and PATYTDIO       *
.*                      31/12/2013  Don Nguyen        CAR 294446              *
.*                      Recompiled for changes to PATMTDFD and PATMTDIO       *
.*            V10.04.01 20/12/2013  Ania P            CAR 294308              *
.*                      Recompiled for PATRDEFD                               *
.*            V10.00.01 12/04/2010  Steve Armstrong   CAR 219111              *
.*                      Recompiled for changes to PATUNAFD                    *
.******************************************************************************
.*            V9.09.01  22/11/2007  Peter Vela        CAR 132264              *
.*                      Recompiled for PATCHCFD                               *
.*                                                                            *
.******************************************************************************
          
          INC       STD001FD
          INC       PMSDAT49/INC
DPISEX    DIM       1
DPIMSTAT  DIM       1
DPIPOST   DIM       4
DPILVMTD  DIM       2
DPILVTOT  DIM       3
DPILVYTD  DIM       3
DPIATYP1  DIM       1
DPIABDP1  DIM       2
DPIABDY1  DIM       3
DPIABDA1  DIM       4
DPIATYP2  DIM       1
DPIABDP2  DIM       2
DPIABDY2  DIM       3
DPIABDA2  DIM       4
DPIATYP3  DIM       1
DPIABDP3  DIM       2
DPIABDY3  DIM       3
DPIABDA3  DIM       4
DPIATYP4  DIM       1
DPIABDP4  DIM       2
DPIABDY4  DIM       3
DPIABDA4  DIM       4
DPIATYP5  DIM       1
DPIABDP5  DIM       2
DPIABDY5  DIM       3
DPIABDA5  DIM       4
DPIATYP6  DIM       1
DPIABDP6  DIM       2
DPIABDY6  DIM       3
DPIABDA6  DIM       4
DPIATYP7  DIM       1
DPIABDP7  DIM       2
DPIABDY7  DIM       3
DPIABDA7  DIM       4
DPISATYP  DIM       1
DPILINSR  DIM       1
.
TEMP1     FILE      ASCII, FIXED=240
TEMP2     FILE      ASCII, FIXED=240
.
FILENAME  DIM       8
PIPE      INIT      "|"
.
PRGID     INIT      "PIPPRS"
PRGNAM    INIT      "Pipe PRS/2 Records"
VERSION   INIT      "V12.01.00"
.
ML0000    CALL      DISPHEAD
          MOVE      ZERO,RECCNT
          DISPLAY   *P1:4,*EF,"PRS/2 Filename : ";
ML0100    KEYIN     *P18:4,*EL,*V2LON,FILENAME;
.
          PACK      FILENAME,FILENAME,SP8
          MATCH     SP8,FILENAME
          GOTO      ML9999 IF EQUAL
.
          STRIP     FILENAME
          MOVE      "/XMT",KEY4
          PACK      KEY12,FILENAME,KEY4
          DISPLAY   *P18:4,*EL,*V2LON,*+,FILENAME,".XMT";
.
          MOVE      ZERO,OVRCD
          TRAP      OVERCOND IF IO
          OPEN      TEMP1,KEY12
          TRAPCLR   IO
          IF        OVRCD=1
            DISPLAY   *P1:24,*EL,*B,"Filename not found.  "
            CALL      HITENTER
            GOTO      ML0100
          ENDIF
.
          PREP      TEMP2,"pipprse2"
.
ML0200    READ      TEMP1,SEQ;E2,UNIQKEY,EPIURNO,EPISITID,EPIMEDI:
                              EPIMCSFX,DPISEX,DPIMSTAT,EPIBDATE,DPIPOST:
                              EPISUBRB,EPIADATR,EPIATIME,EPIATYPE,EPIASRCE:
                              EPITSRCE,DPILVMTD,DPILVTOT,DPILVYTD,EPIACST1:
                              DPIATYP1,EPIQTYP1,DPIABDP1,DPIABDY1,DPIABDA1:
                              EPIACST2,DPIATYP2,EPIQTYP2,DPIABDP2,DPIABDY2:
                              DPIABDA2,EPIACST3,DPIATYP3,EPIQTYP3,DPIABDP3:
                              DPIABDY3,DPIABDA3,EPIACST4,DPIATYP4,EPIQTYP4:
                              DPIABDP4,DPIABDY4,DPIABDA4,EPIACST5,DPIATYP5:
                              EPIQTYP5,DPIABDP5,DPIABDY5,DPIABDA5,EPIACST6:
                              DPIATYP6,EPIQTYP6,DPIABDP6,DPIABDY6,DPIABDA6:
                              EPIACST7,DPIATYP7,EPIQTYP7,DPIABDP7,DPIABDY7:
                              DPIABDA7,EPISDATE,EPISTIME,EPISTYPE,EPISTRFR:
                              EPISREFL,EPICAVAL,EPISACST,DPISATYP,EPISCTYP:
                              EPNEWCOB,EPABRGNL,EPADCRTN,EPIINLOS,EPHLTHFD:
                              DPILINSR,EPIMNTLS,EPIPRGFS,EPISPFDA,EPICTTYP:
                              EPICTROL,EPICTRID,EPIMDCLD,EPIYDCLD,EPITLCLD:
                              EPIUSERF,SP3
          GOTO      ML0300 IF OVER
.
          MATCH     "E2",E2
          GOTO      ML0200 IF NOT EQUAL
.
          ADD       ONE,RECCNT
          IF        RECCNT%10=1
            DISPLAY   *P11:24,*V2LON,RECCNT;
          ENDIF
.
          WRITE     TEMP2,SEQ;E2,PIPE,UNIQKEY,PIPE,EPIURNO:
                              PIPE,EPISITID,PIPE,EPIMEDI,PIPE:
                              EPIMCSFX,PIPE,DPISEX,PIPE,DPIMSTAT:
                              PIPE,EPIBDATE,PIPE,DPIPOST,PIPE:
                              EPISUBRB,PIPE,EPIADATR,PIPE,EPIATIME:
                              PIPE,EPIATYPE,PIPE,EPIASRCE,PIPE:
                              EPITSRCE,PIPE,DPILVMTD,PIPE,DPILVTOT:
                              PIPE,EPILVYTD,PIPE,EPIACST1,PIPE:
                              DPIATYP1,PIPE,EPIQTYP1,PIPE,DPIABDP1:
                              PIPE,DPIABDY1,PIPE,DPIABDA1,PIPE:
                              EPIACST2,PIPE,DPIATYP2,PIPE,EPIQTYP2:
                              PIPE,DPIABDP2,PIPE,DPIABDY2,PIPE:
                              DPIABDA2,PIPE,EPIACST3,PIPE,DPIATYP3:
                              PIPE,EPIQTYP3,PIPE,DPIABDP3,PIPE:
                              DPIABDY3,PIPE,DPIABDA3,PIPE,EPIACST4:
                              PIPE,DPIATYP4,PIPE,EPIQTYP4,PIPE:
                              DPIABDP4,PIPE,DPIABDY4,PIPE,DPIABDA4:
                              PIPE,EPIACST5,PIPE,DPIATYP5,PIPE:
                              EPIQTYP5,PIPE,DPIABDP5,PIPE,DPIABDY5:
                              PIPE,DPIABDA5,PIPE,EPIACST6,PIPE:
                              DPIATYP6,PIPE,EPIQTYP6,PIPE,DPIABDP6:
                              PIPE,DPIABDY6,PIPE,DPIABDA6,PIPE:
                              EPIACST7,PIPE,DPIATYP7,PIPE,EPIQTYP7:
                              PIPE,DPIABDP7,PIPE,DPIABDY7,PIPE:
                              DPIABDA7,PIPE,EPISDATE,PIPE,EPISTIME:
                              PIPE,EPISTYPE,PIPE,EPISTRFR,PIPE:
                              EPISREFL,PIPE,EPICAVAL,PIPE,EPISACST:
                              PIPE,DPISATYP,PIPE,EPISCTYP,PIPE:
                              EPNEWCOB,PIPE,EPABRGNL,PIPE,EPADCRTN:
                              PIPE,EPIINLOS,PIPE,EPHLTHFD,PIPE:
                              DPILINSR,PIPE,EPIMNTLS,PIPE,EPIPRGFS:
                              PIPE,EPISPFDA,PIPE,EPICTTYP,PIPE:
                              EPICTROL,PIPE,EPICTRID,PIPE,EPIMDCLD:
                              PIPE,EPIYDCLD,PIPE,EPITLCLD,PIPE:
                              EPIUSERF,PIPE,SP3,PIPE
          GOTO      ML0200
.
ML0300    DISPLAY   *P1:10,*EF,*B:
                    *P1:11,"File created   : pipprse2.txt":
                    *P1:12,"Records loaded : ",*V2LON,RECCNT,".  ";
          MOVE      ZERO,RECCNT
          CLOSE     TEMP1
          OPEN      TEMP1,KEY12
.
          PREP      TEMP2,"pipprsx2"
.
ML0400    READ      TEMP1,SEQ;X2,UNIQKEY,DIAG1,DIAG2,DIAG3,DIAG4,DIAG5:
                              DIAG6,DIAG7,DIAG8,DIAG9,DIAG10,DIAG11,DIAG12:
                              PROC1,PROC2,PROC3,PROC4,PROC5,PROC6,PROC7:
                              PROC8,PROC9,PROC10,PROC11,PROC12,EPBAWGHT:
                              EPREADMT,EPDUSRF,EPDSICUH,EPDCMVH,EPDRG:
                              EPDSCCU,EPRCCT                          
          GOTO      ML0500 IF OVER
.
          MATCH     "X2",X2
          GOTO      ML0400 IF NOT EQUAL
.
          ADD       ONE,RECCNT
          IF        RECCNT%10=1
            DISPLAY   *P11:24,*V2LON,RECCNT;
          ENDIF
.
          WRITE     TEMP2,SEQ;X2,PIPE,UNIQKEY,PIPE,DIAG1,PIPE,DIAG2:
                              PIPE,DIAG3,PIPE,DIAG4,PIPE:
                              DIAG5,PIPE,DIAG6,PIPE,DIAG7,PIPE,DIAG8:
                              PIPE,DIAG9,PIPE,DIAG10,PIPE,DIAG11,PIPE:
                              DIAG12,PIPE,PROC1,PIPE,PROC2,PIPE,PROC3:
                              PIPE,PROC4,PIPE,PROC5,PIPE,PROC6,PIPE:
                              PROC7,PIPE,PROC8,PIPE,PROC9,PIPE,PROC10:
                              PIPE,PROC11,PIPE,PROC12,PIPE,EPBAWGHT:
                              PIPE,EPREADMT,PIPE,EPDUSRF,PIPE,EPDSICUH:
                              PIPE,EPDCMVH,PIPE,EPDRG,PIPE,EPDSCCU:
                              PIPE,EPRCCT,PIPE
          GOTO      ML0400
.
ML0500    DISPLAY   *P1:13,*EF,*B:
                    *P1:14,"File created   : pipprsx2.txt":
                    *P1:15,"Records loaded : ",*V2LON,RECCNT,".  ";
          MOVE      ZERO,RECCNT
          CLOSE     TEMP1
          OPEN      TEMP1,KEY12
.
          PREP      TEMP2,"pipprsy2"
.
ML0600    READ      TEMP1,SEQ;Y2,UNIQKEY,DIAG13,DIAG14,DIAG15,DIAG16,DIAG17:
                              DIAG18,DIAG19,DIAG20,DIAG21,DIAG22,DIAG23,DIAG24:
                              DIAG25,PROC13,PROC14,PROC15,PROC16,PROC17,PROC18:
                              PROC19,PROC20,PROC21,PROC22,PROC23,PROC24,PROC25
          GOTO      ML0700 IF OVER
.
          MATCH     "Y2",Y2
          GOTO      ML0600 IF NOT EQUAL
.
          ADD       ONE,RECCNT
          IF        RECCNT%10=1
            DISPLAY   *P11:24,*V2LON,RECCNT;
          ENDIF
.
          WRITE     TEMP2,SEQ;Y2,PIPE,UNIQKEY,PIPE,DIAG13,PIPE,DIAG14:
                              PIPE,DIAG15,PIPE,DIAG16,PIPE,DIAG17,PIPE:
                              DIAG18,PIPE,DIAG19,PIPE,DIAG20,PIPE,DIAG21:
                              PIPE,DIAG22,PIPE,DIAG23,PIPE,DIAG24,PIPE:
                              DIAG25,PIPE,PROC13,PIPE,PROC14,PIPE,PROC15:
                              PIPE,PROC16,PIPE,PROC17,PIPE,PROC18,PIPE:
                              PROC19,PIPE,PROC20,PIPE,PROC21,PIPE,PROC22:
                              PIPE,PROC23,PIPE,PROC24,PIPE,PROC25,PIPE
          GOTO      ML0600
.
ML0700    DISPLAY   *P1:16,*EF,*B:
                    *P1:17,"File created   : pipprsy2.txt":
                    *P1:18,"Records loaded : ",*V2LON,RECCNT,".  ";
          MOVE      ZERO,RECCNT
          CLOSE     TEMP1
          OPEN      TEMP1,KEY12
.
          PREP      TEMP2,"pipprsv2"
.
ML0800    READ      TEMP1,SEQ;V2,UNIQKEY,EPIURNO,VETNUMB,VETSURN,VETGIVN:
                              EPIADATR,EPISDATE,VETUSRF
          GOTO      ML0900 IF OVER
.
          MATCH     "V2",V2
          GOTO      ML0800 IF NOT EQUAL
.
          ADD       ONE,RECCNT
          IF        RECCNT%10=1
            DISPLAY   *P11:24,*V2LON,RECCNT;
          ENDIF
.
          WRITE     TEMP2,SEQ;V2,PIPE,UNIQKEY,PIPE,EPIURNO,PIPE:
                              VETNUMB,PIPE,VETSURN,PIPE,VETGIVN,PIPE:
                              EPIADATR,PIPE,EPISDATE,PIPE,VETUSRF,PIPE
          GOTO      ML0800
.
ML0900    DISPLAY   *P1:19,*EF,*B:
                    *P1:20,"File created   : pipprsv2.txt":
                    *P1:21,"Records loaded : ",*V2LON,RECCNT,".  ";
          MOVE      ZERO,RECCNT
          CLOSE     TEMP1
          OPEN      TEMP1,KEY12
.
          PREP      TEMP2,"pipprss2"
.
ML1000    READ      TEMP1,SEQ;S2,UNIQKEY,EPIURNO,BTHIDXAD,BTHIDXDS:
                              PTRDCLSP,ONSETDTE,PTRDARTR,PTRDUSRF:
                              PTRDPCSA,PTRDPCSD,PTRDRGAA,PTRDRGAD:
                              PTRDSRPC                            
          GOTO      ML1100 IF OVER
.
          MATCH     "S2",S2
          GOTO      ML1000 IF NOT EQUAL
.
          ADD       ONE,RECCNT
          IF        RECCNT%10=1
            DISPLAY   *P11:24,*V2LON,RECCNT;
          ENDIF
.
          WRITE     TEMP2,SEQ;S2,PIPE,UNIQKEY,PIPE,EPIURNO,PIPE:
                              BTHIDXAD,PIPE,BTHIDXDS,PIPE,PTRDCLSP,PIPE:
                              ONSETDTE,PIPE,PTRDARTR,PIPE,PTRDUSRF,PIPE:
                              PTRDPCSA,PIPE,PTRDPCSD,PIPE,PTRDRGAA,PIPE:
                              PTRDRGAD,PIPE,PTRDSRPC
          GOTO      ML1000
.
ML1100    DISPLAY   *P1:22,*EF,*B:
                    *P1:23,"File created   : pipprss2.txt":
                    *P1:24,"Records loaded : ",*V2LON,RECCNT,".  ";
.
          CALL      HITEXIT
.
ML9999    CHAIN     PGM
.
          INC       STD001IO
+
.

