.----------------------------------------------------------------------
. Program       : EMRWEB10
.
. Function      : Process Incomplete mandatory field checking  
.
. Modifications :
.------------------------------------------------------------------------------
. V12.00.03 19/11/2025  Nikitha Bhaskar TSK 0969069
.           Recompiled for EMRMR5N2 changes
. V12.00.02 08/09/2025  Thanh T          TSK 0949457
.           Recompiled for EMRMR5N2 changes
. V12.00.01 11/09/2025  Nikitha B       TSK 0965462
.           Recomplied for EMRCHMAN.PBL
. V11.05.05 07/0r42025  PJ Le Febour    TSK 0949428b
.           Recompiled for EMRMR5N2 amended EMRMR5N2
. V11.05.04 26/02/2025  PJ Le Febour    TSK 0957621
.           Recompiled for EMRMR5N2 amended EMRMR5N2
. V11.05.03 22/02/2025  PJ Le Febour    TSK 0949428
.           Recompiled for EMRMR5N2 added PRFC2055 
. V11.05.02 30/01/2025  Thanh T         TSK 0956569
.           Recompiled for EMRMR5N2 changes
. V11.05.01 30/01/2025  Thanh T         TSK 0956569
.           Recompiled for EMRMR5N2 changes
. V11.04.04 17/05/2024  Thanh T         TSK 0941543
.           Added GPMCEX00 section
. V11.04.03 13/05/2024  Thanh T         TSK 0941543
.           Recompiled for EMRMR5N2
. V11.04.02 23/04/2024  Sunny           TSK 0931173
.           Recompiled for EMMRR5N2 - Presenting complaints
. V11.04.01 27/11/2023  Peter Vela      TSK 0935874
.           Recompiled for DXPATMAS - Added validation for PTCNUNET = 3
.           NIHC IHI functionality
. V11.03.03 17/10/2023  Peter Vela       TSK 0935874
.           Added parameter check for pmsihiaf
. V11.03.02 20/09/2023  Thanh T         TSK 0914124
.           Recompiled for EMMRR5N2 changes
. V11.03.01 30/08/2023  Thanh T         TSK 0914124
.           Recompiled for EMMRR5N2 changes
. V11.02.02 29/08/2022  Thanh T         TSK 0914124
.           Recompiled for EMMRR5N2 changes
. V11.02.01 04/08/2022  Thanh T         TSK 0914124
.           Recompiled for EMMRR5N2 changes
. V11.01.01 26/10/2021  Ebon Clements   TSK 0888259 0911480
.           Added polling process to check if discharged patients should
.           have a location - Mainly for sites that don't use the map
.           as the cleaup is only run by the map view - CDVLOC00
. V11.00.02 16/11/2020  Thanh T          TSK 0878747
.           Added PATATRFD PATATRIO and PATATRTD for EMRMR5N2 
. V11.00.01 08/04/2020  Thanh T        TSK 0879163
.           Recompiled for EMRMR5N2
.------------------------------------------------------------------------------
. V10.15.01 07/10/2019  Ken Bell       TSK 0875392
.           Recompile for EMRMR5N2
. V10.14.06 28/08/2019  Ebon Clements  TSK 0880096
.           Added indicatior 6 "A"ssessor test to mandatory field 169 mandatory
.           diagnosis test -  CHKPSC00 CHKDDC00 CHKNNR00
. V10.14.05 11/06/2019  Nicole Torrisi TSK 0870675
.           Recompiled for DXPATMAS
. V10.14.04 18/04/2019  Nicole Torrisi TSK 0870675
.           Recompiled for DXPATMAS - 215 - Email address
. V10.14.03 18/04/2019  Ebon Clements  TSK 0868834
.           Fixed mandatory diagnosis test 169 - CHKMAN00
. V10.14.02 13/03/2019  Ebon Clements  TSK  0868834
.           VEMD 2019 - Telehealth mandatory field departure status change
. V10.14.01 07/02/2019  Ebon Clements  TSK 0866794
.           Perform mandatory ambulance handover test 176 and 177 for vic
.           departures 10 & 11 - left after advice and did not wait - CHKMAN00
. V10.13.02 08/01/2019  Ebon Clements  TSK 0866794
.           Perform mandatory abulance handover test 176 and 177 for all vic
.           departures - CHKPSC00 CHKDDC00 CHKNNR00
. V10.13.01 14/11/2018  Ebon Clements    TSK 0865832
.           Fixed vic mandatory ambulance handover date when left not seeen
.           after MYEMR000 calls
. V10.12.01 10/07/2018  Nicole Torrisi   TSK 0857785
.           Recompiled for DXPATMAS - 214 - Alternate ID
. V10.11.01 13/11/2017  Peter Vela     TSK 0847796
.           Recompiled for EMRMR5N2
. V10.10.04 25/05/2017  Peter Vela      TSK 0833345
.           Recompiled for EMRCHMAN
. V10.10.03 10/05/2017  Peter Vela      TSK 0833345
.           Recompiled for EMRCHMAN
. V10.10.02 09/05/2017  Peter Vela      TSK 0833345
.           Recompiled for EMRCHMAN
. V10.10.01 22/03/2017  Thanh T.       TSK 0832066
.           Changed DVA PREPAT/PMPXDVAC fields to use the new
.           concession card PMCDCNUM/PMCDDVAC fields           
. V10.09.01 22/08/2016  Jill Parkinson TSK 0823729    
.           New web server - copied from EMRWEB03 and removed printing function
.
.------------------------------------------------------------------------------
          INC       IBAWEBDF    
          INC       CHKDIGVR/INC
          INC       EMRICDFD/INC
          INC       EMRHISFD/INC 
          INC       APSMASFD/INC
          INC       AAEDE1FD/INC
          INC       EMRLPCFD/INC
          INC       EMRCONFD/INC                                       *I-50421
          INC       EMRLOCFD/INC
          INC       EMRSITFD/INC
          INC       PATCALAG/INC
          INC       PATDHEAD/INC
          INC       ELTRONVR/INC
          INC       EOCLNKFD/INC
          INC       EOCREFFD/INC
          INC       EMRVISFD/INC
          INC       EMRCLIFD/INC
          INC       EMRGRCFD/INC
          INC       EMRPROFD/INC                                       *I-50421
          INC       EMRUNKFD/INC
          INC       IBADLABS/INC
          INC       IBATMDFD/INC
          INC       MEHDLSFD/INC
          INC       NHIETHFD/INC
          INC       NHIMASFD/INC
          INC       OUTBB1FD/INC
          INC       OUTBOAFD/INC
          INC       OPRNURFD/INC
          INC       PATCONFD/INC
          INC       AAECONFD/INC   *****
          INC       PATALRFD/INC   *****
          INC       PMSALNFD/INC
          INC       PATDO1FD/INC
          INC       PATFN1FD/INC
          INC       PATGO1FD/INC
          INC       PATHSPFD/INC
          INC       PMSCCDFD/INC
          INC       PMSCEXFD/INC
          INC       PMSHCPFD/INC
          INC       PMSHCGFD/INC
          INC       PMSHCPTD/INC
          INC       PMSHCGTD/INC
          INC       PMSIHIFD/INC
          INC       PMSMDTFD/INC
          INC       PMSMTXFD/INC
          INC       PATIN1FD/INC
          INC       PRIITMFD/INC
          INC       PATITMFD/INC                                       *I-50421
          INC       PATICDFD/INC                                       *I-50421
          INC       PATICOFD/INC                                       *I-50421
          INC       PATMA1FD/INC
          INC       PATMI1FD/INC
          INC       PMSPX2FD/INC
          INC       PMSRELFD/INC              
          INC       PMSTLEFD/INC   
          INC       PATNIDFD/INC
          INC       PATRE1FD/INC
          INC       PATVADFD/INC
          INC       PATVISFD/INC
          INC       PMSVX1FD/INC                                       *I-55214
          INC       PMSWX1FD/INC
          INC       PATWC1FD/INC 
          INC       PATWMAFD/INC
          INC       PATWR1FD/INC
          INC       PATWVEFD/INC
          INC       SCRPSTFD/INC
          INC       SCRSBGFD/INC
          INC       SCRSLTFD/INC
          INC       SCRMASFD/INC
          INC       PATHGPFD/INC
.
          INC       PATATRFD/INC
          INC       PATATRTD/INC
.
          INC       EMRDCMFD/INC       
          INC       OBSDETFD/INC                                       *I-54627
          INC       OBSMTXFD/INC
          INC       OBSMDTFD/INC
          INC       EMRISMFD/INC 
          INC       EMRINCFD/INC 
          INC       EMRWFMFD/INC
          INC       EMRVCDFD/INC
          INC       EMRMTXFD/INC
          INC       EMRVPRFD/INC
          INC       VISCMTFD/INC
          INC       VISCODFD/INC
          INC       VISMDTFD/INC
          INC       VISXDCFD/INC
          INC       EMRMANFD/INC 
          INC       VISMTXFD/INC

.
ANSLI     INIT      "i"
ANSLW     INIT      "w"
DAYDESC   DIM       9
DIM1IND6  DIM       1
DIM16     DIM       16
DIM30     DIM       30
DIM35     DIM       35
DIM50     DIM       50
DIM80     DIM       80
DIM100    DIM       100
DFNAME    DIM       60
DSMOKE    DIM       3
GPFRMTNM  DIM       40
LINEA17   DIM       17
LINEB17   DIM       17
LINEC17   DIM       17
LINED17   DIM       17
LINEE17   DIM       17
LINEF17   DIM       17
LINEG17   DIM       17
LINEH17   DIM       17
LINEI17   DIM       17
LINEA37   DIM       37
LINEB37   DIM       37
LINEC37   DIM       37
LINED37   DIM       37
LINEE37   DIM       37
LINEF37   DIM       37
LINEG37   DIM       37
LINEH37   DIM       37
LINEI37   DIM       37
NUM3      FORM      3
TYPE4     INIT      "004"
TYPE5     INIT      "005"
SAVKEY5   DIM       5
SAVENCOM  FORM      1
SAVEDCOM  FORM      1
SAVDOC    DIM       10
SKEY8     DIM       8
DOCTIME   DIM       8
HOUR      DIM       2
MEDINUMB  DIM       13
MIN       DIM       2
MONTHDES  DIM       9
PTFRMTNM  DIM       40
SEC       DIM       2
MEDNOTES  DIM       70
TEMPDATE  DIM       12
.
NEWCOUNT  FORM      10
.
ADLABEL   FORM      2
ATT       DIM       80         * attribute string
AFTDECP   FORM      2          * After Decimal Place
AFTDECPF  FORM      2          * After Decimal Place Format String
.
BEFDECP   FORM      2          * Before Decimal Place
BEFDECPF  FORM      2          * Before Decimal Place Format String
BIRTHDAT  DIM       10            * formatted DOB variable
.
CALDAYS    FORM      3
CDEFPRT2  DIM       6
CHG       FORM      1
CHKMNCNT  FORM      1          * check mandatory fields cycle counter
CLAIMCOD  DIM       3
CLMDET1   DIM       50
CLMDET2   DIM       50
CONTTYPE  DIM       1
CONTTYP2  FORM      1
COUNTER   FORM      1
CPPAPER2  FORM      2
CURRROW   FORM      3
CODEDESC  DIM       100                                                *I-50421
.
DANS1     DIM       20
DCASE     DIM       3
DECIMALP  INIT      "."  
DIM2L     DIM       2
DIM3      DIM       3
DIM6      DIM       6
DIM4      DIM       4
DIM4A     DIM       4
DIM4B     DIM       4
DIM4C     DIM       4
DIM5      DIM       5                                                  *I-54309
DIM8      DIM       8             * U/R variable (spaces removed)
DIM9      DIM       9
DIM10     DIM       10 
DIM10A    DIM       10
DIM10B    DIM       10
DIM11     DIM       11
DIM11G    DIM       11            * given name variable for small labels
DIM11S    DIM       11            * surname variable for small labels
DIM12     DIM       12
DIM14     DIM       14
DIM15     DIM       15
DIM17     DIM       17
DIM18     DIM       18            * given name variable for large labels
DIM20     DIM       20
DIM22     DIM       22 
DIM25     DIM       25
DIM31     DIM       31            * formatted address
DIM40     DIM       40
DIM45     DIM       45
DIM60     DIM       60
DOCTCODE  DIM       6
.
EMRFLAG   FORM      1 
EMRPREV   DIM       20 
EMRSEEN   DIM       8
EMRDOCT   DIM       13
EMRINSUR  DIM       5
EMRDESC   DIM       20
EMRURNO   DIM       8
ENDFLG    FORM      1
.
FIRSTCH   FORM      1                                                  *I-60700
FIELDNO   FORM      5
FORM1A    FORM      1                                                  *I-54627
FORM1B    FORM      1                                                  *I-54627
FORM3     FORM      3
FORM3A    FORM      3                                                  *I-50421
FORM5     FORM      5
FORM21    FORM      21
FORMAT21  FORM      21
FRMPRINT  DIM       6
.                                                                     *I-196463
DIM3A     DIM       3
DIM3B     DIM       3
DIM15A    DIM       15
DIM50A    DIM       50
DIM80A    DIM       80
.
MBIRURNO  DIM       8
MBIRTYOR  DIM       24
.
LINSREQD  FORM      5
PAGENUMB  FORM      3
PAGETOTL  FORM      3
PAGEMAXL  FORM      3                       * Maximum lines per page
PASSNO    FORM      1
PGLINES   DIM       6
PRINTEND  FORM      1
.
WFLINE3A  DIM       20
WFLINE2A  DIM       20
WFLINE8A  DIM       20
WFLINE6A  DIM       20
WFLINE4A  DIM       20
WFLINE7A  DIM       20
WFLINE5A  DIM       20
WFLINE1A  DIM       20
.
HIGH14    DIM       4
HIGH24    DIM       4
HIGH34    DIM       4
.HELPAGE   FORM      1
.HELPRNT   FORM      3
.HELSIZE   FORM      1
.HEMR5COD  DIM       6            * Code for user defined stationary
HEPMR5B   FORM      "1"          * Patient MR5 form sheet 1=Yes, 0=No
.HEMR5L    FORM      "1"          * Layout for MR5.
.                                  0 = Modbury
.                                  1 = User Defined
.
IHINUMBR  DIM       20
JYEAR     FORM      2
.
LASTROW   FORM      3
LABSIZE   FORM      1
LARGELAB  DIM       16
SMALLLAB  DIM       21
LBLPRINT  DIM       6
LABELATT  DIM       80[24]
LABELDAT  DIM       80[24]
LABELTYP  DIM       10
LLCNT     FORM      5
LEFTBRAK  INIT      "(" 
LINE60    DIM       60                                                 *I-60700
.
MANDINUR  FORM      1
MADESC    DIM       3
MODE4     DIM       4
.
NEGOFSET  DIM       8             * U/R variable (spaces removed)
NMPNUMB   DIM       20
NOLABEL   FORM      3
NOTEFILT  DIM       3
.
OPFLG     FORM      1
.
PRDGFLAG  FORM      1
PRINTVAR  DIM       80
PRNTSTRT  FORM      3
PRIDSYET  FORM      1
.
QADD1     DIM       25
QADD2     DIM       25
QADD4     DIM       15
QGNAME    DIM       14
QLOCDOC   DIM       30
QMEDI     DIM       10
QOCCUP    DIM       14
QPOST     DIM       4
QSAGE     FORM      3
QSEX      DIM       1
QSNAME    DIM       15
QSUBRB    DIM       15
QTELEP    DIM       12
QTITL     DIM       4
.
RESPONSD  DIM       3             * Cat EZ code for doctor responsible
RESPONSN  DIM       3             * Cat EZ code for nurse responsible
RESPONSC  DIM       3             * Cat EZ code for psc responsible
.
RTAOVRCD  FORM      1
RUNCOUNT  FORM      2
.
SAVTYP    DIM       3
SCRID     DIM       2
SHRTBDAT  DIM       8
SHRTMDAT  DIM       7
SHRTVDAT  DIM       8
SVSTNCOD  DIM       6
STATNCOD  DIM       6
SIT4      DIM       4
SRC4      DIM       4
.
UNIQF5    FORM      5
VADESC    DIM       3
VARIABLE  DIM       127
VISITDAT  DIM       10            * formatted emergency visit date variable
VISITNUM  DIM       8             * emergency visit number variable
VISNOTES  DIM       100
VISXDCIN  FORM      1
.
WAITTIME  FORM      4
WCDESC    DIM       3
WCNAME    DIM       20
WDATE1    DIM       8
WDATE2    DIM       8
XPRIDIAG  DIM       6      * Primary Diagnosis
XADDIAG1  DIM       6      * Additional Diagnosis 1
.
ANSHP     INIT      "HP"
ANSPP     INIT      "PP"
CODEA     INIT      "A "
CODEA1    INIT      "A1"
CODEA2    INIT      "A2"
CODEA3    INIT      "A3"
CODEA4    INIT      "A4"
CODEA5    INIT      "A5"
CODEA6    INIT      "A6"
CODEA7    INIT      "A7"
CODEA8    INIT      "A8"
CODEAA    INIT      "AA"
CODEAE    INIT      "AE"
CODEAI    INIT      "AI"
CODEAP    INIT      "AP"
CODEAR    INIT      "AR"
CODECL    INIT      "CL"
CODEC     INIT      "C "
CODECC    INIT      "CC"
CODECT    INIT      "ct"
CODEEA    INIT      "EA"
CODEES    INIT      "ES"
CODEEP    INIT      "EP"
CODEED    INIT      "ED"
CODEEW    INIT      "EW"
CODEEZ    INIT      "EZ"
CODEH1    INIT      "H1"
CODEH2    INIT      "H2"
CODEH3    INIT      "H3"
CODEM     INIT      "M "
CODEP     INIT      "P "
CODEP1    INIT      "P1"
CODEP2    INIT      "P2"
CODEP3    INIT      "P3"
CODEP4    INIT      "P4"
CODEP5    INIT      "P5"
CODEP6    INIT      "P5"
CODER     INIT      "R "
CODERA    INIT      "RA"
CODET     INIT      "T "
CODEU1    INIT      "U1"
CODEV6    INIT      "V6"
CODEV7    INIT      "V7"
CODEV8    INIT      "V8"
CODES     INIT      "S "
CATcw     INIT      "cw"
CATEA     INIT      "ea"
CATEB     INIT      "eb"
CATEC     INIT      "ec"
CATED     INIT      "ed"
CATEE     INIT      "ee"
CATEF     INIT      "ef"
CATEG     INIT      "eg"
CATEH     INIT      "eh"
CATEI     INIT      "ei"
CATEJ     INIT      "ej"
CATEK     INIT      "ek"
CATEL     INIT      "el"
CATEM     INIT      "em"
CATEN     INIT      "en"
CATEO     INIT      "eo"
CATEP     INIT      "ep"
CATEQ     INIT      "eq"
CATER     INIT      "er"
CATES     INIT      "es"
CATET     INIT      "et"
CATEU     INIT      "eu"
CATEV     INIT      "ev"
CATEW     INIT      "ew"
CATEY     INIT      "ey"
CATHP     INIT      "HP"
CATLS     INIT      "LS"
CATTC     INIT      "tc"
CATWS     INIT      "ws"                                               *I-59548
CATWT     INIT      "wt"
CATWU     INIT      "wu"
CATWQ     INIT      "wq"                                               *I-59548
CATWR     INIT      "wr"                                               *I-59548
CATW0     INIT      "w0"
DASH      INIT      "-"
OTHER     INIT      "Other"
SP12      INIT      "            "
SP127     INIT      "                                          ":
                    "                                          ":
                    "                                           "
SP40      INIT      "                                       "
X27       INIT      "XXXXXXXXXXXXXXXXXXXXXXXXXXX"
X100      INIT      "XXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXX":
                    "XXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXX"
ZERO4     INIT      "0000"
.
CARET     INIT      "^"
MJAN      INIT      "January"
MFEB      INIT      "February"
MMAR      INIT      "March"
MAPR      INIT      "April"
MMAY      INIT      "May"
MJUN      INIT      "June"
MJUL      INIT      "July"
MAUG      INIT      "August"
MSEP      INIT      "September"
MOCT      INIT      "October"
MNOV      INIT      "November"
MDEC      INIT      "December"
.
.
. PROGRAM CONSTANTS
. ----------------
ARIAL10N  INIT      "(8U(s1p10.00v0s0b16602T"   * Arial 10pt font / normal
ARIAL10B  INIT      "(8U(s1p10.00v0s3b16602T"   * Arial 10pt font / bold
.
HORZTB01  INIT      "&a23C"     * tab to column 23  (1st column of large
.                                                      labels - tab for barcode)
HORZTB02  INIT      "&a28C"     * tab to column 28  (1st column of small
.                                                      labels - left edge)
HORZTB03  INIT      "&a45C"     * tab to column 45  (1st column of large
.                                                      labels - tab for U/R,
.                                                      visit date and age data)
HORZTB04  INIT      "&a56C"     * tab to column 56  (1st column of large
.                                                      labels - tab for claim
.                                                      code data)
HORZTB05  INIT      "&a57C"     * tab to column 57  (2nd column of small
.                                                      labels - left edge)
HORZTB06  INIT      "&a66C"     * tab to column 66  (2nd column of large
.                                                      labels - left edge)
HORZTB07  INIT      "&a89C"     * tab to column 89  (2nd column of large
.                                                      labels - tab for barcode)
HORZTB08  INIT      "&a86C"     * tab to column 86  (3rd column of small
.                                                      labels - left edge)
HORZTB09  INIT      "&a110C"    * tab to column 110 (2nd column of large
.                                                      labels - tab for U/R,
.                                                      visit date and age data)
HORZTB10  INIT      "&a113C"    * tab to column 113 (4th column of small
.                                                      labels - left edge)
HORZTB11  INIT      "&a121C"    * tab to column 121 (2nd column of large
.                                                      labels - tab for claim
.                                                      code data)
HORZTB12  INIT      "&a131C"    * tab to column 131 (3rd column of large
.                                                      labels - left edge)
HORZTB13  INIT      "&a141C"    * tab to column 141 (5th column of small
.                                                      labels - left edge)
HORZTB14  INIT      "&a154C"    * tab to column 154 (3rd column of large
.                                                      labels - tab for barcode)
HORZTB15  INIT      "&a175C"    * tab to column 175 (3rd column of large
.                                                      labels - tab for U/R,
.                                                      visit date and age data)
HORZTB16  INIT      "&a170C"    * tab to column 170 (6th column of small
.                                                      labels - left edge)
HORZTB17  INIT      "&a186C"    * tab to column 186 (3rd column of large
.                                                      labels - tab for claim
.                                                      code data)
.
LINESPAC  INIT      "&l6D"      * line spacing - 6 lines/inch
.
NBARCODE  INIT      "(5U(s0p6.25h18.0v0s-6b0T*"      * Barcode style
.
PRIRESET  INIT      "E"         * printer reset
.
TMARGIN   INIT      "&l2e68F"   * top margin - 1 line
.                                   text length - 68 lines
.
.         Vertical movement is required for the barcode otherwise
.         it will print above the top line of the large labels (verttab1/2)
.
VERTTAB1  INIT      "*p+30Y"    * move 30 PCL units down (for barcode)
VERTTAB2  INIT      "*p-30Y"    * move 30 PCL units up (for barcode)
.
VERTTAB3  INIT      "*p+22Y"    * move 22 PCL units up (vertical space between
.                                                         large labels)
VERTTAB4  INIT      "*p+25Y"    * move 25 PCL units up (vertical space between
.                                                         small labels)
.--------------------------------------------------------------------------------
NSETBOLD  INIT      "(s0bT"
SETBOLD   INIT      "(s7bT"
.
ALRCOMM   DIM       100
MULTILIN  FORM      1  
.--------------------------------------------------------------------------------
PRGID     INIT      "EMRWEB10"
VERSION   INIT      "V12.01.00"
PRGNAM    INIT      "Process Incomplete Mandatory Field Checking"
.--------------------------------------------------------------------------------
.
          CALL      WEBINT00       * Initialise Fifo Etc.
.
          CALL      INIT0000       * Open Files
          MOVE      ZERO,CHKMNCNT    * initialise check mandatory cycle counter
.
MAIN0000  COMMIT
.
          BEGIN
.
MAIN1000  DISPLAY   *W60
          DISPLAY   *W60
.
          CALL      EMERGV00       * Mandatory Field checking
.
.         Run location check for disharged patients every 60 loops or 2 hrs
.
          IF        RUNCOUNT > 60
            CALL      CDVLOC00       * Check discharge visits location
            MOVE      ZERO,RUNCOUNT
          ELSE
            ADD       ONE,RUNCOUNT
          ENDIF
.
          COMMIT
.
          BEGIN
.
          GOTO      MAIN1000
.
.------------------------------------------------------------
. Program Initialisation
.------------------------------------------------------------
INIT0000  MOVE      "70",RUNCOUNT         * Run when first started
          MOVE      ONE,EMRFLAG
          MOVE      ZERO,OVRCD
          TRAP      OVERCOND IF IO
          OPEN      EMRVISA1,"emrvisaf"
          OPEN      EMRVISA2,"emrvisaf"
          OPEN      EMRVISA7,"emrvisaf"
          TRAPCLR   IO
          IF        OVRCD=1
            MOVE      ZERO,EMRFLAG
          ENDIF
          OPEN      EMRCLIA1,"emrcliaf"
.
          OPEN      EMRHISA1,"emrhisaf"
          OPEN      EMRDCMA1,"emrdcmaf"
          OPEN      OBSDETA1,"obsdetaf"                                *I-54627
          OPEN      OBSMDTA1,"obsmdtaf"     * Patient Medical Notes
          OPEN      OBSMTXA1,"obsmtxaf"     * Patient Medical Notes fre

          OPEN      VISCMTA1,"viscmtaf"
          OPEN      VISMTXA1,"vismtxaf"
          OPEN      EMRICDA1,"emricdaf"
          OPEN      EMRWFMA1,"emrwfmaf"
          OPEN      EMRWFMA2,"emrwfmaf"
          OPEN      EMRWFMA3,"emrwfmaf"
          OPEN      EMRWFMA4,"emrwfmaf"
          OPEN      EMRISMA1,"emrismaf"
          OPEN      EMRINCA1,"emrincaf"
          OPEN      EMRINCA2,"emrincaf"
          OPEN      EMRINCA3,"emrincaf"
          OPEN      EMRVCDA1,"emrvcdaf"
          OPEN      EMRVCDA2,"emrvcdaf"                               *I-215117
          OPEN      EMRMTXA3,"emrmtxaf"
.
          OPEN      EMRUNKA1,"emrunkaf"
          OPEN      EMRLPCA1,"emrlpcaf"
          OPEN      EMRLOCA1,"emrlocaf"
          OPEN      EMRPROA1,"emrproaf"                                *I-50421
          OPEN      EMRSITA1,"emrsitaf"
.
          OPEN      OPRNURA1,"oprnuraf"                   
          OPEN      PATALRT1,"patalrtf"                                *I-54627
          OPEN      PATALTT1,"pataltaf"
          OPEN      PATHSPA1,"pathspaf"
          OPEN      PMSMDTA1,"pmsmdtaf"
          OPEN      PMSALNA1,"pmsalnaf"
          OPEN      PMSMDTA1,"pmsmdtaf"
          OPEN      PMSMTXA1,"pmsmtxaf"
          OPEN      PATMA1A1,"patma1af"
          OPEN      PATMI1A1,"patmi1af"
          OPEN      PATMX1A1,"patmx1af"
          OPEN      PMSCCDA1,"pmsccdaf"
          OPEN      PMSPX2A1,"pmspx2af"
          OPEN      PATVISA1,"patvisaf"
          OPEN      AAEDE1A1,"aaede1af"
          OPEN      PATCODE1,"patcodes"
          OPEN      PATDO1A1,"patdo1af"
          OPEN      PATITEM1,"patitemn"                                *I-50421
          OPEN      PATICDO1,"paticdof"                                *I-50421
          OPEN      PATRE1A1,"patre1af"
          OPEN      PATFN1A1,"patfn1af"
          OPEN      PATWR1A1,"patwr1af"
          OPEN      PMSHCPA1,"pmshcpaf"
          OPEN      PMSHCGA1,"pmshcgaf"
          OPEN      PATVADA1,"patvadaf"
          OPEN      PMSVX1A1,"pmsvx1af"                                *I-55214
          OPEN      PMSWX1A1,"pmswx1af"
          OPEN      PMSRELA1,"pmsrelaf"
          OPEN      PMSTLEA1,"pmstleaf"
          OPEN      PMSCEXA1,"pmscexaf"
          OPEN      PRIITEM1,"priitemf"
          OPEN      VISCODA1,"viscodaf"
          OPEN      VISMDTA1,"vismdtaf"
.
          OPEN      IBAPDFA1,"ibapdfaf"
          OPEN      IHAPASS1,"ihapassf"
          OPEN      IBACODE1,"ibacodef"
          OPEN      IBATMHA1,"ibatmhaf"
          OPEN      IBATDET1,"ibatmdaf"
          OPEN      IBASPOL1,"ibaspolf"
          OPEN      MEHDLSA1,"mehdlsaf"
          OPEN      WEBSECA3,"websecaf"
.
          OPEN      SCRSBGA1,"scrsbgaf"
          OPEN      SCRPSTA1,"scrpstaf"
          OPEN      SCRMASA1,"scrmasaf"
          OPEN      PATHGRP1,"pathgrpf"
.
          READ      CONTROLF,ZERO;*43,IBCNMHOS
          READ      CONTROLF,TWO;*182,CSNAME                           *I-54627
.
          READ      CONTROLF,TWENTY1;*138,PTCNNHII
          READ      CONTROLF,THIRTY;*89,HELPAGE,*90,HELPRNT,HELSIZE
.
          READ      CONTROLF,SEVENTY8;*64,AECNLABL
          READ      CONTROLF,EIGHTY;*250,PTCNHDPS
          READ      CONTROLF,EIGHTY9;*138,EMCNICDF                     *I-50421
          READ      CONTROLF,HUND03;*220,PTCNDEES,*221,PTCNDDES
          READ      CONTROLF,HUND18;*138,PTCNNEWC
          READ      CONTROLF,HUND20;*158,PTCNUNET
.
          IF        IBCNMHOS=1
            OPEN      MLTCODA1,"mltcodaf"
            OPEN      MLTCODA2,"mltcodaf"
          ENDIF
.
          IF        EMCNICDF=0
              OPEN      PATICDD1,"paticddf"
              OPEN      PATICDD2,"paticddf"
              OPEN      PATI10D1,"pati10df"
              OPEN      PATI10D2,"pati10df"
          ELSE
              OPEN      EMRICDA1,"emricdaf"
              OPEN      EMRICDA2,"emricdaf"
              OPEN      EMRICDA3,"emricdaf"
          ENDIF
.
          MATCH     "0",PTCNUNET
          IF        !@EQUAL
              OPEN      PMSIHIA1,"pmsihiaf"     * IHI Details
          ENDIF
.
          MOVE      ZERO,VISXDCIN
          MOVE      ZERO,OVRCD
          TRAP      OVERCOND IF IO
          OPEN      VISXDCA1,"visxdcaf"
          TRAPCLR   IO
          IF        OVRCD=1
            MOVE      ONE,VISXDCIN
          ENDIF
.
          RETURN
.---------------------------------------------------------------
. Clear Parameters (NOT USED REQUIRED FOR STANDARD WEB INCLUDES)
.---------------------------------------------------------------
CLRPAR00  RETURN 
.---------------------------------------------------------------
. Set Parameters   (NOT USED REQUIRED FOR STANDARD WEB INCLUDES)
.---------------------------------------------------------------
SETPAR00  RETURN
.---------------------------------------------------------------
. Process Fields   (NOT USED REQUIRED FOR STANDARD WEB INCLUDES)
.---------------------------------------------------------------
PROFLD00  RETURN
.------------------------------------------------------------
.*****************************************************************
.  Following should not be printed on Labels
.*****************************************************************
HDGNS000
..   Any diagnoses on file
HDGNS999  RETURN
.*****************************************************************
HCNT0000
..   Any clinical notes on file
HCNT9999  RETURN
.*****************************************************************
HPRC0000
..   Any procedures on file
HPRC9999  RETURN
.*****************************************************************
UPDURT00
..   Update duration of waiting
UPDURT99  RETURN
.*****************************************************************
.-----------------------------------------------------------
. Read the Emrvisaf file and clear mandatory
.------------------------------------------------------------
EMERGV00  CALL      GETR0000                * Get Responsibilty (category EZ)
.
          PACK      KEY9,ONE,SP70
          CALL      RSEMVIS2
EMERGV10  CALL      RKEMVIS2
          BRANCH    OVRCD,EMERGV50
          BRANCH    EMVISTAT,EMERGV20,EMERGV20
          GOTO      EMERGV50
.
EMERGV20  CALL      CHKMNA00    * Check Patient Mandatory Fields
          GOTO      EMERGV10
.
EMERGV50  PACK      KEY11,SP70
          CALL      RSEMISM1
EMERGV60  CALL      RKEMISM1
          BRANCH    OVRCD,EMERGV99
          MATCH     "1",EMISTYPE
          IF        @EQUAL
            CALL      CALCD000
          ELSE
            CALL      CALCN000
          ENDIF
.
          IF        NEWCOUNT=0
            PACK      KEY11,EMISTYPE,EMISCODE
            CALL      DEEMISM1
            CALL      RSEMISM1
          ELSE
            MOVE      NEWCOUNT,EMISNOIN
            CALL      UPEMISM1
          ENDIF
          GOTO      EMERGV60
.
EMERGV99  RETURN
.
CALCD000  MOVE      ZERO,NEWCOUNT
          PACK      KEY18,EMISCODE,SP70
          CALL      RSEMINC2
CALCD100  CALL      RKEMINC2
          BRANCH    OVRCD,CALCD999
          MATCH     "0",EMIPDCOM
          GOTO      CALCD100 IF NOT EQUAL
          MATCH     EMISCODE,EMIPDOCT
          GOTO      CALCD100 IF NOT EQUAL
          ADD       ONE,NEWCOUNT
          GOTO      CALCD100
.
CALCD999  RETURN
+
CALCN000  MOVE      ZERO,NEWCOUNT
          PACK      KEY18,EMISCODE,SP70
          CALL      RSEMINC3
CALCN100  CALL      RKEMINC3
          BRANCH    OVRCD,CALCN999
          MATCH     "0",EMIPNCOM
          GOTO      CALCN100 IF NOT EQUAL
          MATCH     EMISCODE,EMIPNURS
          GOTO      CALCN100 IF NOT EQUAL
          ADD       ONE,NEWCOUNT
          GOTO      CALCN100
.
CALCN999  RETURN
+
.--------------------------------------------------------------------
. Set the person responsible codes used for the doctor, nurse and
. psc incomplete tests.
. RETURN : RESPONSD - Category EZ code for doctor responsible
.          RESPONSN - Category EZ code for nurse responsible
.          RESPONSC - Category EZ code for psc responsible
.--------------------------------------------------------------------
GETR0000  MOVE      SP70,RESPONSD
          MOVE      SP70,RESPONSN
          MOVE      SP70,RESPONSC
.
          PACK      KEY5,CODEEZ,SP70
          CALL      RDSCODE1
GETR1000  CALL      RDKCODE1
          BRANCH    OVRCD,GETR9999
.
          MATCH     CODEEZ,TCODE
          GOTO      GETR9999 IF NOT EQUAL
.
          MATCH     "I",PTCOACTV
          GOTO      GETR1000 IF EQUAL
.
          MATCH     "1",TCINDC1
          IF        @EQUAL
            MOVE      ACODE,RESPONSC      * psc responsible
            GOTO      GETR1000
          ENDIF
.
          MATCH     "2",TCINDC1
          IF        @EQUAL
            MOVE      ACODE,RESPONSD      * doctor responsible
            GOTO      GETR1000
          ENDIF
.
          MATCH     "3",TCINDC1
          IF        @EQUAL
            MOVE      ACODE,RESPONSN      * nurse responsible
            GOTO      GETR1000
          ENDIF
.
          GOTO      GETR1000
.
GETR9999  RETURN
.
.------------------------------------------------------------
. Check if any incomplete been completed for patient waiting for admissionn
.------------------------------------------------------------
CHKMNA00  PACK      KEY8,DEMVIADM,SP70
          MOVE      KEY8,SKEY8
          CALL      RDEMINC1                * Reading Incomplete visit table
          BRANCH    OVRCD,CHKMNA50                                      *C-49485
          PACK      KEY11,ONE,EMIPDOCT,SP70
          CALL      RDEMISM1
          IF        OVRCD=1
            UNPACK    KEY11,EMISTYPE,EMISCODE
            MOVE      ZERO,EMISNOIN
            MOVE      SP70,EMISSPAR
            CALL      WREMISM1
          ENDIF
          PACK      KEY11,TWO,EMIPNURS,SP70
          CALL      RDEMISM1
          IF        OVRCD=1
            UNPACK    KEY11,EMISTYPE,EMISCODE
            MOVE      ZERO,EMISNOIN
            MOVE      SP70,EMISSPAR
            CALL      WREMISM1
          ENDIF
          BRANCH    EMVISTAT,CHKMNA10,CHKMNA20
          GOTO      CHKMNA99            * No incomplete check required

CHKMNA10  CALL      CHKPSC00                * Check for clerk incomplete
          MOVE      EMVIDOCT,EMIPDOCT
          MOVE      EMVITRNS,EMIPNURS
          MOVE      SKEY8,KEY8
          CALL      RAEMINC1
          BRANCH    OVRCD,CHKMNA99
.
          MOVE      ZERO,OVRCD
          TRAP      OVERCOND IF IO
          CALL      UPEMINC1                * Updating incomplete table
          TRAPCLR   IO
          GOTO      CHKMNA99

CHKMNA20  CALL      CHKDDC00                * Check for doctor incomplete
          MOVE      ZERO,MANDINUR
          CALL      CHKNNR00                * Check for nurse incomplete
          CALL      CHKPSC00                * Check for clerk incomplete
          MOVE      EMVIDOCT,EMIPDOCT
          PACK      KEY11,ONE,EMIPDOCT,SP70
          CALL      RDEMISM1
          IF        OVRCD=1
            UNPACK    KEY11,EMISTYPE,EMISCODE
            MOVE      ZERO,EMISNOIN
            MOVE      SP70,EMISSPAR
            CALL      WREMISM1
          ENDIF
          MOVE      EMVITRNS,EMIPNURS
          PACK      KEY11,TWO,EMIPNURS,SP70
          CALL      RDEMISM1
          IF        OVRCD=1
            UNPACK    KEY11,EMISTYPE,EMISCODE
            MOVE      ZERO,EMISNOIN
            MOVE      SP70,EMISSPAR
            CALL      WREMISM1
          ENDIF
          MOVE      SAVENCOM,EMIPNCOM 
          MOVE      SAVEDCOM,EMIPDCOM
.
          IF        MANDINUR<>ONE
            MATCH     SP70,EMVIDOCT
            GOTO      CHKMNA40 IF EQUAL
          ENDIF
.
CHKMNA30  MOVE      SKEY8,KEY8
          CALL      RAEMINC1
          BRANCH    OVRCD,CHKMNA40
.
CHKMNA35  MOVE      ZERO,OVRCD
          TRAP      OVERCOND IF IO
          CALL      UPEMINC1               * Updating incomplete table
          TRAPCLR   IO
          BRANCH    OVRCD,CHKMNA99
.
          MATCH     "1",EMIPDCOM
          GOTO      CHKMNA99 IF NOT EQUAL
.
          MATCH     "1",EMIPNCOM
          GOTO      CHKMNA99 IF NOT EQUAL
.
          MATCH     "1",EMIPCCOM
          GOTO      CHKMNA99 IF NOT EQUAL
.
CHKMNA40  CALL      DEEMINC1               * Delete record
          PACK      KEY8,EMVIADMN,SP70
          CALL      RDEMVIS1               * Update with new status
          MOVE      THREE,EMVISTAT
          CALL      UPEMVIS1
          PACK      KEY8,EMVIADMN,SP70
          CALL      RDEMVIS1
.
          GOTO     CHKMNA99
.
CHKMNA50  BRANCH   EMVISTAT,CHKMNA99,CHKMNA60,CHKMNA60,CHKMNA99
.
CHKMNA60  CALL     CHKDDC00
          MOVE     ZERO,MANDINUR
          CALL     CHKNNR00
          CALL     CHKPSC00
.
          MOVE     SAVEDCOM,EMIPDCOM
          MOVE     SAVENCOM,EMIPNCOM
          MOVE     DEMVIADM,EMIPADMN
          MOVE     EMVIDOCT,EMIPDOCT
          MOVE     EMVITRNS,EMIPNURS
.
          CALL     WREMINC1
.
CHKMNA99  RETURN
.------------------------------------------------------------
. Three routines below are used when patient status is
. discharged incomplete.
.------------------------------------------------------------
SUBNUR00  MATCH    "1",EMIPNCOM
          IF       @EQUAL
            MOVE      "2",DIM1
            MOVE      EMIPNURS,EMISCODE
            PACK      KEY11,DIM1,EMISCODE,SP70
            CALL      RDEMISM1        * Reading Incomplete summary table
            IF        OVRCD=0
              IF        EMISNOIN=1
                 CALL      DEEMISM1
              ELSE
                 SUB       ONE,EMISNOIN
                 CALL      UPEMISM1           * Updating summary table
              ENDIF
            ENDIF
          ENDIF
.
SUBNUR99  RETURN
.------------------------------------------------------------
. Three routines below are used when patient status is
. discharged incomplete.
.------------------------------------------------------------
SUBDOC00  MATCH    "1",EMIPDCOM
          IF       @EQUAL
            MOVE      "1",DIM1
            MOVE      EMIPDOCT,EMISCODE
            PACK      KEY11,DIM1,EMISCODE,SP70
            CALL      RDEMISM1       * Reading Incomplete summary table
            IF        OVRCD=0
              IF        EMISNOIN=1
                CALL      DEEMISM1
              ELSE
                SUB       ONE,EMISNOIN
                CALL      UPEMISM1          * Updating summary table
              ENDIF
            ENDIF
          ENDIF
.
SUBDOC99  RETURN
.------------------------------------------------------------
. Check incomplete records for PSC (Clerical)
.------------------------------------------------------------
CHKPSC00  MOVE      "1",EMIPCCOM                * Clerk record is complete
          PACK      KEY6,ONE,SP70
          CALL      RSEMWFM2
CHKPSC10  CALL      RKEMWFM2
          BRANCH    OVRCD,CHKPSC99
          MATCH     "1",EMWFMAN
          GOTO      CHKPSC99 IF NOT EQUAL
.
          MATCH     RESPONSC,EMWFRES            * Only Check Clerical
          GOTO      CHKPSC10 IF NOT EQUAL
.
          MOVE      ZERO,FORM2
          MOVE      SP70,DIM1
          MOVE      SP70,DIM1IND6
          MATCH     SP70,EMVIDSTA
          IF        !@EQUAL
            PACK      KEY5,CODEED,EMVIDSTA
            CALL      RDCODE1                      * code on file ?
            IF        OVRCD=0
              UNPACK    THCSCOD,DIM2
              SQUEEZE   DIM2                       * Save HDP Eq.
              MOVE      DIM2,FORM2
              PACK      DIM1,TCINDC3,SP70
              PACK      DIM1IND6,TCINDC6,SP70
            ENDIF
          ENDIF
.
          MOVE      EMWFFLD,FORM5
          PACK      DIM80,SP70,SP70
          CALL      MYEMR000                    * Loading the mandatory fields
.
          MATCH     SP70,DIM80
          GOTO      CHKPSC10 IF NOT EQUAL
.
          IF        PTCNHDPS=THREE & (FORM2=10 | FORM2=11)
            IF       FORM5=176
              GOTO     CHKPSC15
            ENDIF
            IF       FORM5=177
              GOTO     CHKPSC15
            ENDIF
            GOTO     CHKPSC10
          ENDIF
.
          IF        FORM5=102|FORM5=103|FORM5=104|FORM5=105|FORM5=7
            IF        FORM2=11|FORM2=10|FORM2=30
              GOTO      CHKPSC10
            ENDIF
            MATCH     "T1",DIM2
            GOTO      CHKPSC10 IF EQUAL
.
            MATCH     "T1",DIM2
            GOTO      CHKPSC10 IF EQUAL
          ENDIF
.
          IF        FORM5=169
            IF        FORM2=10|FORM2=11|FORM2=30
              GOTO      CHKPSC10
            ENDIF
            MATCH     "T1",DIM2
            GOTO      CHKPSC10 IF EQUAL
            MATCH     "T1",DIM2
            GOTO      CHKPSC10 IF EQUAL
.
            MATCH     "N",DIM1
            IF        @EQUAL
              IF        FORM2=31
                MATCH     "A",DIM1IND6
                IF        @EQUAL
                  PACK      KEY30,EMVIDOCT,EMVIATNS,EMVIMDCD,SP70
                  MATCH     SP70,KEY30
                  GOTO      CHKPSC10 IF EQUAL
                ELSE
                  GOTO      CHKPSC10
                ENDIF
              ELSE
                GOTO      CHKPSC10
              ENDIF
            ENDIF
.
            IF        FORM2=31
              PACK      KEY30,EMVIDOCT,EMVIATNS,EMVIMPRA,SP70
              MATCH     SP70,KEY30
              GOTO      CHKPSC10 IF EQUAL
            ENDIF
          ENDIF
.
CHKPSC15  MOVE      "0",EMIPCCOM
.
CHKPSC99  RETURN
.-------------------------------------------------------------
. Check incomplete records for Doctor after patient discharge
.-------------------------------------------------------------
CHKDDC00  MOVE      "1",SAVEDCOM
          PACK      KEY6,ONE,SP70
          CALL      RSEMWFM2
CHKDDC10  CALL      RKEMWFM2
          BRANCH    OVRCD,CHKDDC99
          MATCH     "1",EMWFMAN
          GOTO      CHKDDC99 IF NOT EQUAL
.
          MATCH     RESPONSD,EMWFRES               * Only check doctor
          GOTO      CHKDDC10 IF NOT EQUAL
.
          MOVE      ZERO,FORM2
          MOVE      SP70,DIM1
          MOVE      SP70,DIM1IND6
          MATCH     SP70,EMVIDSTA
          IF        !@EQUAL
            PACK      KEY5,CODEED,EMVIDSTA
            CALL      RDCODE1                      * code on file ?
            IF        OVRCD=0                      
              UNPACK    THCSCOD,DIM2
              SQUEEZE   DIM2                       * Save HDP Eq.
              MOVE      DIM2,FORM2                 
              PACK      DIM1,TCINDC3,SP70
              PACK      DIM1IND6,TCINDC6,SP70
            ENDIF
          ENDIF
.
          MOVE      EMWFFLD,FORM5
          PACK      DIM80,SP70,SP70
          CALL      MYEMR000                  * Loading the mandatory fields

          MATCH     SP70,DIM80
          GOTO      CHKDDC10 IF NOT EQUAL
.
          IF        PTCNHDPS=THREE & (FORM2=10 | FORM2=11)
            IF       FORM5=176
              GOTO     CHKDDC15
            ENDIF
            IF       FORM5=177
              GOTO     CHKDDC15
            ENDIF
            GOTO     CHKDDC10
          ENDIF
.
          IF        FORM5=102|FORM5=103|FORM5=104|FORM5=105|FORM5=7
            IF        FORM2=11|FORM2=10|FORM2=30
              GOTO      CHKDDC10
            ENDIF
            MATCH     "T1",DIM2
            GOTO      CHKDDC10 IF EQUAL
.
            MATCH     "T1",DIM2
            GOTO      CHKDDC10 IF EQUAL

          ENDIF
.
          IF        FORM5=169
            IF        FORM2=10|FORM2=11|FORM2=30
              GOTO      CHKDDC10
            ENDIF
            MATCH     "T1",DIM2
            GOTO      CHKDDC10 IF EQUAL
            MATCH     "T1",DIM2
            GOTO      CHKDDC10 IF EQUAL
.
            MATCH     "N",DIM1
            IF        @EQUAL
              IF        FORM2=31
                MATCH     "A",DIM1IND6
                IF        @EQUAL
                  PACK      KEY30,EMVIDOCT,EMVIATNS,EMVIMDCD,SP70
                  MATCH     SP70,KEY30
                  GOTO      CHKDDC10 IF EQUAL
                ELSE
                  GOTO      CHKDDC10
                ENDIF
              ELSE
                GOTO      CHKDDC10
              ENDIF
            ENDIF
.
            IF        FORM2=31
              PACK      KEY30,EMVIDOCT,EMVIATNS,EMVIMPRA,SP70
              MATCH     SP70,KEY30
              GOTO      CHKDDC10 IF EQUAL
            ENDIF
          ENDIF
.
CHKDDC15  MOVE      "0",SAVEDCOM
.
CHKDDC99  RETURN
.-------------------------------------------------------------
. Check incomplete records for Nurse after patient discharge
.-------------------------------------------------------------
CHKNNR00  MOVE      "1",SAVENCOM
          PACK      KEY6,ONE,SP70
          CALL      RSEMWFM2
CHKNNR10  CALL      RKEMWFM2
          BRANCH    OVRCD,CHKNNR99
          MATCH     "1",EMWFMAN
          GOTO      CHKNNR99 IF NOT EQUAL
.
          MATCH     RESPONSN,EMWFRES               * Only check nurse
          GOTO      CHKNNR10 IF NOT EQUAL
.
          MOVE      ZERO,FORM2
          MOVE      SP70,DIM1
          MOVE      SP70,DIM1IND6
          MATCH     SP70,EMVIDSTA
          IF        !@EQUAL
            PACK      KEY5,CODEED,EMVIDSTA
            CALL      RDCODE1                      * code on file ?
            IF        OVRCD=0
              UNPACK    THCSCOD,DIM2
              SQUEEZE   DIM2                       * Save HDP Eq.
              MOVE      DIM2,FORM2
              PACK      DIM1,TCINDC3,SP70
              PACK      DIM1IND6,TCINDC6,SP70
            ENDIF
          ENDIF
.
          MOVE      EMWFFLD,FORM5
          PACK      DIM80,SP70,SP70
          CALL      MYEMR000                  * Loading the mandatory fields
.
          MATCH     SP70,DIM80
          GOTO      CHKNNR10 IF NOT EQUAL
.
          IF        PTCNHDPS=THREE & (FORM2=10 | FORM2=11)
            IF       FORM5=176
              GOTO     CHKNNR15
            ENDIF
            IF       FORM5=177
              GOTO     CHKNNR15
            ENDIF
            GOTO     CHKNNR10
          ENDIF
.
          IF        FORM5=102|FORM5=103|FORM5=104|FORM5=105|FORM5=7
            IF        FORM2=11|FORM2=10|FORM2=30
              GOTO      CHKNNR10
            ENDIF
            MATCH     "T1",DIM2
            GOTO      CHKNNR10 IF EQUAL
.
            MATCH     "T1",DIM2
            GOTO      CHKNNR10 IF EQUAL
          ENDIF
.
          IF        FORM5=169
            IF        FORM2=10|FORM2=11|FORM2=30
              GOTO      CHKNNR10
            ENDIF
            MATCH     "T1",DIM2
            GOTO      CHKNNR10 IF EQUAL
            MATCH     "T1",DIM2
            GOTO      CHKNNR10 IF EQUAL
.
            MATCH     "N",DIM1
            IF        @EQUAL
              IF        FORM2=31
                MATCH     "A",DIM1IND6
                IF        @EQUAL
                  PACK      KEY30,EMVIDOCT,EMVIATNS,EMVIMDCD,SP70
                  MATCH     SP70,KEY30
                  GOTO      CHKNNR10 IF EQUAL
                ELSE
                  GOTO      CHKNNR10
                ENDIF
              ELSE
                GOTO      CHKNNR10
              ENDIF
            ENDIF
.
            IF        FORM2=31
              PACK      KEY30,EMVIDOCT,EMVIATNS,EMVIMPRA,SP70
              MATCH     SP70,KEY30
              GOTO      CHKNNR10 IF EQUAL
            ENDIF
          ENDIF
.
CHKNNR15  MOVE      "0",SAVENCOM
.
CHKNNR99  RETURN
.------------------------------------------------------------
. Check for Admission Unit into hospital
.------------------------------------------------------------
ADUNIT00  MATCH     SP70,EMVIUNIT
          IF        !@EQUAL
            MATCH     SP70,EMVIPADM
            IF        @EQUAL
              MOVE      ONE,EXIT
              GOTO      ADUNIT99
            ENDIF
          ENDIF
          MOVE     ZERO,EXIT

ADUNIT99  RETURN
.------------------------------------------------------------
. Validate Procedures/Diagnoses
.------------------------------------------------------------
VICD0000  MOVE      ZERO,EXIT
          COMPARE   TWO,PRDGFLAG              * 0=Both 1=Diagnosis 2=Procedure
          GOTO      VICD1500 IF EQUAL
.
          PACK      KEY14,DEMVIADM,TYPE5,SP70
          CALL      RSEMVCD1
VICD1000  CALL      RKEMVCD1
          BRANCH    OVRCD,VICD9900
.
          MATCH     DEMVIADM,EMVCVIST
          GOTO      VICD9900 IF NOT EQUAL
.
          MATCH     TYPE5,EMVCTYPE          * Emergency diagnosis ?
          GOTO      VICD9900 IF NOT EQUAL
.
          MATCH     "000",EMVCSEQU
          GOTO      VICD1000 IF NOT EQUAL
.
          BRANCH    PRDGFLAG,VICD9999        * only checking for diagnosis
.
VICD1500  PACK      KEY14,DEMVIADM,TYPE4,SP70
          CALL      RSEMVCD1
VICD2000  CALL      RKEMVCD1
          BRANCH    OVRCD,VICD9900
.
          MATCH     DEMVIADM,EMVCVIST
          GOTO      VICD9900 IF NOT EQUAL
.
          MATCH     TYPE4,EMVCTYPE
          GOTO      VICD9900 IF NOT EQUAL
.
          MOVE      ZERO,EXIT                        * Coding Complete
          GOTO      VICD9999
.
VICD9000  GOTO      VICD9900
.
VICD9100  GOTO      VICD9900
.
VICD9900  MOVE      ONE,EXIT
.
VICD9999  RETURN
.------------------------------------------------------------
. Check for Zero U/R
.------------------------------------------------------------
ZERUR000  MATCH     ZEROUR,EMVIURNO
          IF        @EQUAL
            MOVE      ONE,EXIT
          ELSE
            MOVE      ZERO,EXIT
          ENDIF

ZERUR999  RETURN
.
.------------------------------------------------------------
. Get web user id according to the emrlpcaf passcode
.------------------------------------------------------------
WEBU0000  PACK      KEY14,EMLPPSC,SP70
          CALL      RSWBSE3
WEBU1000  CALL      RKWBSE3
          BRANCH    OVRCD,WEBU9000
.
          MATCH     EMLPPSC,WBSEPCD
          GOTO      WEBU9000 IF NOT EQUAL
.
          GOTO      WEBU9999
.
WEBU9000  MOVE      SP70,WBSEUID
          GOTO      WEBU9999
.
WEBU9999  RETURN
.
.
.
.--------------------------------------------------------------------
. Get the patients compensable details if any.
.--------------------------------------------------------------------
. REQUIRES: CLAIMCOD - Claim Code
.           ADMISSNO - Admission number
.
. RETURNS : CLMDET1 = If private the patients health fund name
.                     or W/C, TAC, DVA if compensable
.                     or NILL if not compensable and not private
.           CLMDET2 = If private the patients health fund member number
.                     or W/C, TAC claim numbers, DVA number and (Card Colour)
.                        if compensable
.                     or blank if not compensable and not private
.--------------------------------------------------------------------
CMPH0000  MOVE      SP70,CLMDET1
          MOVE      SP70,CLMDET2
.
          MATCH     SP70,CLAIMCOD
          GOTO      CMPH9999 IF EQUAL
.
          PACK      KEY5,ANSC,ANSL,CLAIMCOD,SP70
          CALL      RDCODE1
          BRANCH    OVRCD,CMPH9999
.
          MATCH     "3",TCINDC5                  * Self insured
          GOTO      CMPH9000 IF EQUAL
.
.------ see what type of claim we have if any exists ------
.
          MOVE      ZERO,FORM2
CMPH1000  ADD       ONE,FORM2
          COMPARE   SIX,FORM2
          GOTO      CMPH5000 IF NOT LESS
.
          LOAD      ANS,FORM2,TCINDC1,TCINDC2,TCINDC3:
                    TCINDC4,TCINDC5
.
          CMATCH    "W",ANS                      * Work Cover
          GOTO      CMPH2000 IF EQUAL
.
          CMATCH    "M",ANS                      * TAC
          GOTO      CMPH3000 IF EQUAL
.
          CMATCH    "V",ANS                      * VET
          GOTO      CMPH4000 IF EQUAL
.
          GOTO      CMPH1000
.
CMPH2000  OPEN      PATWC1A1,"patwc1af"          * Work Cover
          MOVE      "W/C",CLMDET1
          PACK      KEY8,ADMISSNO,SP70
          CALL      RDWCOM1
          BRANCH    OVRCD,CMPH9999
.
          MOVE      WCCLMNO,CLMDET2
          GOTO      CMPH9999
.
CMPH3000  OPEN      PATWMAB1,"patwmabf"          * TAC
          MOVE      "TAC",CLMDET1
          PACK      KEY8,ADMISSNO,SP70
          CALL      RDWMAB1
          BRANCH    OVRCD,CMPH9999
.
          MOVE      MREFNO,CLMDET2
          GOTO      CMPH9999
.
CMPH4000  OPEN      PATWVET1,"patwvetf"          * VET
          MOVE      "DVA",CLMDET1
          PACK      KEY8,ADMISSNO,SP70
          CALL      RDWVET1
          BRANCH    OVRCD,CMPH9999
.
          MOVE      SP70,TDESC
          MOVE      THREE,DIM1
          CALL      GCCARD00
          MATCH     SP70,PMCDDVAC
          IF        !@EQUAL & !@EOS
            PACK      KEY5,ANSD,ANSX,PMCDDVAC,SP10   * DVA Card colour
            CALL      RDCODE1
            IF        OVRCD = 1
              MOVE      PMCDDVAC,TDESC
            ENDIF
          ENDIF
.
          MOVE      TDESC,DIM1
.
          CLEAR     CLMDET2
          STRIP     VCLMNO
          APPEND    VCLMNO,CLMDET2
          APPEND    " (",CLMDET2
          APPEND    DIM1,CLMDET2
          APPEND    ")",CLMDET2
          RESET     CLMDET2
          GOTO      CMPH9999
.
CMPH5000  MATCH     SP70,PFUNDH
          GOTO      CMPH9999 IF EQUAL
.
          PACK      KEY14,PFUNDH,ZERO4,SP70      * Display health fund
          CALL      RDFUND1
          IF        OVRCD=1
            MOVE      PFUNDH,HFNAME
          ENDIF
.
          MOVE      HFNAME,CLMDET1
          MOVE      PFNDMM,CLMDET2
          GOTO      CMPH9999
.
CMPH9000  MOVE      "NIL",CLMDET1                * Self insured
          MOVE      SP70,CLMDET2
.
CMPH9999  RETURN
.
.--------------------------------------------------------------------
. Polling routine to check if a discharge/cancelled ED visit should
. have a location. This is normally called for the ED map load
. so this is really for sites that don't use the ED map.
.--------------------------------------------------------------------
CDVLOC00  PACK      KEY11,Z70
          CALL      RSEMVIS7
CDVLOC10  CALL      RPEMVIS7              * Check visits with a location
          BRANCH    OVRCD,CDVLOC99        * no more visits
.
          MATCH     SP70,EMVILOCN         * Blank location so exit?
          GOTO      CDVLOC99 IF EQUAL    
.
          COMPARE   ONE,EMVISTAT          * Skip current patients
          GOTO      CDVLOC10 IF EQUAL
.
          CALL      MAPCHK00              * Check locations
.
          GOTO      CDVLOC10
.
CDVLOC99  RETURN
+
          INC       IBAWEBCD
.
          INC       CLPMSVX1
          INC       DXPATCOD
          INC       DXPATMAS
          INC       GPMCEX00
          INC       GTIHINUM
          INC       NAMSTRCD
          INC       WEBDITEM
          INC       WEBBGRND
          INC       WEBLBEMR
.
          INC       APSMASIO/INC
          INC       EMRCHMAN
          INC       EMRLPCIO/INC
          INC       EMRLOCIO/INC
          INC       EMRSITIO/INC
          INC       EMRVISIO/INC
          INC       EMRCLIIO/INC
          INC       EMRGRCIO/INC
          INC       EMRPROIO/INC                                       *I-50421
          INC       EMRUNKIO/INC
          INC       IBATMDIO/INC
          INC       MEHDLSIO/INC
          INC       NHIETHIO/INC
          INC       NHIMASIO/INC
          INC       PATGO1IO/INC
          INC       PMSHCPIO/INC
          INC       PMSHCGIO/INC
          INC       AAEDE1IO/INC    *****
          INC       PATALRIO/INC
          INC       PMSALNIO/INC
          INC       PMSRELIO/INC
          INC       PMSTLEIO/INC
          INC       PMSHCPTM
          INC       PMSHCGTM 
          INC       OPRNURIO/INC
          INC       PRIITMIO/INC
          INC       PATITMIO/INC                                       *I-50421
          INC       PATICOIO/INC                                       *I-50421
          INC       PATICDIO/INC                                       *I-50421
          INC       PATNIDIO/INC
          INC       PATVISIO/INC
          INC       PMSVX1IO/INC                                       *I-55214
          INC       PMSWX1IO/INC
          INC       PATDO1IO/INC
          INC       PATHSPIO/INC
          INC       PATIN1IO/INC
          INC       PMSCCDIO/INC
          INC       PMSCEXIO/INC
          INC       PMSIHIIO/INC
          INC       PMSMDTIO/INC
          INC       PMSMTXIO/INC
          INC       PMSPX2IO/INC
          INC       PATFN1IO/INC
          INC       PATMA1IO/INC
          INC       PATMI1IO/INC
          INC       PATRE1IO/INC
          INC       PATWC1IO/INC 
          INC       PATWMAIO/INC
          INC       PATWR1IO/INC
          INC       PATWVEIO/INC
          INC       PATVADIO/INC
          INC       SCRPSTIO/INC
          INC       SCRSBGIO/INC
          INC       SCRSLTIO/INC
          INC       SCRMASIO/INC

.
          INC       EOCLNKIO/INC
          INC       EOCREFIO/INC
          INC       EMRISMIO/INC
          INC       EMRINCIO/INC
          INC       EMRWFMIO/INC
          INC       EMRVCDIO/INC
          INC       EMRMTXIO/INC
          INC       EMRVPRIO/INC
          INC       VISCMTIO/INC
          INC       VISCODIO/INC
          INC       VISMTXIO/INC
          INC       VISMDTIO/INC
          INC       VISXDCIO/INC
          INC       EMRMANIO/INC
          INC       OBSDETIO/INC                                       *I-54627
          INC       OBSMTXIO/INC
          INC       OBSMDTIO/INC
          INC       EMRDCMIO/INC   
          INC       EMRHISIO/INC 
          INC       EMRICDIO/INC 
          INC       PATHGPIO/INC
.
          INC       PATATRIO/INC
          INC       MULBIR00
.
          INC       PATDOCTM
.
          INC       PACADDRS
          INC       PMIGTNID
          INC       PMSCEXCD
          INC       PRINTEMR
          INC       CALCAGE
          INC       CALCYRS
          INC       AGECHK
          INC       PATDOCCD
          INC       CLPATMAS
          INC       CLPMSCEX
          INC       CLPMSPX2
          INC       CLEMRVIS                                          *I-153218
          INC       CLPATVIS                                          *I-153218
          INC       DAYOFWEK
          INC       SGCHKDIG
          INC       GETALTID
          INC       GCCARD00
          INC       EMRMAPCK           * Discharged patient location check
.
