.----------------------------------------------------------------------
. Program       : CLIWEB02
.
. Function      : Clinical Observations Server
.
. Modifications  : 
.----------------------------------------------------------------------
. V11.03.01 24/07/2023 Thanh T        TSK 0930508
.           Recompiled as PMSVX1TM changes 
. V11.02.02 30/08/2022  Bella Turco   TSK 0921957
.           Added NOMORE00 - Display "No more records" at end of list
.           Added PTCNNRTD - Displays number of rows set by parameter value
. V11.02.01 09/02/2022  Thanh T       TSK 0905641
.           Recompiled as OUTMA1FD (PATMASTM) changes
. V11.00.01 09/12/2020  Thanh T        TSK 0872840
.           Added PMSCCDFD/PMSCCDIO as PMSPX2TM changes
. V10.14.01 08/04/2019  Tracey Nguyen     TSK 0871443 
.           Recompiled for PATATRTD/PATARTM
.---------------------------------------------------------
. V10.11.03 27/11/2017  Thanh Tieu     Task 0821710
.           Recompiled as PATMASTM changed
. V10.11.02 30/07/2017  Thanh T.       TSK 0821710
.           Audit admission/outpatient/UR comments. changed PATMASTM/PMSPX2TM.
. V10.10.01 29/03/2017  Tracey Nguyen     TSK 0833454
.           Recompiled for PATATRTD/PATARTM
. V10.08.03 20.06.2016  B.G.Ackland       TSK 0821135
.           Secuity fix for reads on WBSE7 index 
. V10.08.02 06/06/2016  Peter Vela      TSK 0321157
.           Recompiled for PATATRTD
. V10.08.01 28/04/2016  Don Nguyen      TSK 0316489
.           Recompiled for PATATRTM & PATATRFD/IO
.---------------------------------------------------------
. V10.07.01 06/10/2015  Nicole Torrisi  CAR 317557 
.           Display observations for zero UR patient
. V10.06.01 28/04/2015  Ebon Clements   CAR 313649 
.           Display zero U/R observations in mobility - TABB0000
. V10.05.02 13/08/2014  Peter Vela      CAR 304860
.           Fixed writing of height and weight to patatraf
. V10.05.01 28/07/2014  Peter Vela      CAR 301176
.           Added calculated bmi to ADDOBS00 and UPDOBS00
. V10.04.04 07/04/2014  Peter Vela      CAR 286258
.           Recompiled for PATMASTM
. V10.04.03 31.03.2014  B.G.Ackland  CAR 299363
.           Replace META Tag Redirect with Javascript in Common RDIREC00
.           Routine
. V10.04.02 14/03/2014  Peter McMullen CAR 294083
.           read websecaf using index 7 for SECUREID 
. V10.04.01 24/01/2014  Peter Vela     CAR 286158
.           Changed PATATR reads and writes
.---------------------------------------------------------
. V10.03.08 09/12/2013  Peter Vela     CAR 286158
.           Added Patient Attributes functionality
. V10.03.07 19/03/2013  Jill Parkinson CAR 282814
.           Recompiled for PATMASTM - Disability alert DSAL0000 change
. V10.03.06 16.01.2012  B.G.Ackland CAR 279466 
.           NSW Between the Flags Alert Flags for MUH
. V10.03.05 14.09.2012  Ebon Clements    CAR 273077
.           Populated visit extn hosital id for zero ur ed visits - ADDOBS00
. V10.03.04 07.09.2012  B.G.Ackland  CAR 501549 
.           Call Age Calculation In GETVIS for Abnormal Result Calculation to work
. V10.03.03 21.03.2012  B.G.Ackland  CAR 265085
.           Limit Observation Table Output to 100 Most Recent Records
. V10.03.02 16/01/2012  Sandra Barcham  CAR 256563
.           Recompiled for PATMASTM
. V10.03.01 21/12/2011  Brian Ackland  CAR 500542
.           Fix for MUH for new Table Output by U/R with additional Columns
. V10.02.01 13/10/2011  Brian Ackland  CAR 500542
.           Changes for MUH for new Table Output by U/R with additional Columns
. V10.01.01 01/12/2010  Saroeun Soeur  CAR 234703
.           added OBTYTYPE to TABROW00 
. V10.00.03 31/08/2010  Jill Parkinson CAR 500065 
.           Mods to check for preadmits and cancelled adms in GETVIS00
. V10.00.02 09/08/2010  Ebon Clements  CAR 219144 
.           Added admissno to update observation url - TABROW00
. V10.00.01 21/06/2010  Jill Parkinson CAR        
.           Mods to move one to exit after WEBEND00 calls
. V9.11.01  01/04/2009  Ebon Clements  CAR 191912
.           Added TOTNSTAT to TABA0000 to display total neuro if nero obs
. V9.08.01  31/01/2007  Peter Vela     CAR 127930
.           Recompiled for MRTMASFD
. V9.05.01  09/03/2006  Ebon Clements CAR 78533
.           Mods for PATCODTM - Hospital specific category codes
. V9.05.B01 30/01/2006  Ebon Clements CAR 93186
.           Mods for REDIRECT length change. Recompiled for IBAWEBDF
. V9.04.05  25/08/2005  Ebon Clements      CAR 57209
.           Added TRIREDIR - triage redirect flag
. V9.04.04  29/07/2005 Ebon Clements CAR 57835
.           Added update by to TABA0000
. V9.04.03  14/04/2005 Ebon Clements CAR 57851
.           Added pupil and limb details available in TABA0000
. V9.04.02  22/12/2004 Lina Vo    CAR 55990
.           Recompiled for IBACOMM, PMSVX1TD & PMSVX1TM.
. V9.04.01  17/11/2004 Lina Vo    CAR 54752
.           Changed basic observation to have weight from pmsvx1af.
. V9.03.04  07/06/2004 Peter Vela CAR 49016
.           2004 Statutory Changes - recompiled for PMSPX2TM
. V9.03.03  26/03/2004 Peter Vela CAR 13038
.           Recompiled for PATDOCCD - Doctor Name format Parameter
. V9.03.02  02/01/2004 Peter Vela CAR 10485
.           Added read and write functionality for OBDECVPS CVP (1-8)
.           Recompiled for OBSDETFD and OBSDETIO
.           02/01/2004 Peter Vela CAR 10484
.           Added read and write functionality for OBDEPNSC Pain Score (0-10)
.           Recompiled for OBSDETFD and OBSDETIO
.*        V9.03.01  15/07/2003  CAR 37193   Mike Laming                       *
.*                  Port V5.10 changes for PMS05 -                            *
.*                  Add a release of file Lock to routine UPDOBS00            *
. V9.02.03  07/02/2003 Tonii CAR 35992
.           Recompiled for PATMISTM - inactive codes in patfundf
. V9.02.02  09/10/2002 Peter Vela               SRF 17693
.           Recompiled for PATMISTM - Admitting Point
. V9.02.01  03/12/2001 Katie Nelson/Harvinder   SRF 648628(nz)
.           Recompiled for NHI tags added to PATMASTM
. V9.01.02  16.08.2001 J.Tan
.           Recompiled for PATMASTM
. V9.01.01  13.08.2001 J.Tan
.           Recompiled for PATMASTM
. V9.00.B03 13.07.2001 Sandra Barcham
.           Replace GP with HCP
. V9.00.B02 14.06.2001 B.G.Ackland
.           Recompile for Changes to PATMASTM
.---------------------------------------------------------
.                V5.10.00 22.03.2001 B.G.Ackland
.                         THC Update for COMA Score
.                V5.09.02 12.01.2001 Bronko Sosic
.                         Recompiled for PATMASTM  
.                V5.08.05 27.10.2000 B.G.Ackland
.                         Fix Date & Time Last Updated
.                V5.08.04 16.10.2000 B.G.Ackland
.                         Change Output TableSort
.                V5.08.03 28/09/2000 Bronko Sosic  
.                         Recompiled for PATMASTM / PATMISTM
.                V5.08.02 16/08/2000  Caleb Sharman
.                         Changed Health Fund variables to be 8 chars
.                V5.08.01 07/06/2000 Bronko Sosic
.                         Recompiled for PATMASTM  
.----------------------------------------------------------------------
.                V5.07.09 04/04/2000 Bronko Sosic
.                          Added GOTO
.                V5.07.08 02/02/2000 Steven Watkins
.                          Recompiled for PATMASTM / PATMISTM
. 		  V5.07.07 12.01.2000 Bronko Sosic
.                          Fixed CYY, Added REP " 0"
.                 V5.07.06 29.12.1999 Pat Dirito   
.                          Recompiled for PATMASTM                              
.                 V5.07.05 17.12.1999 Katie Nelson 
.                          Recompiled for IBAWEBDF/IBAWEBCD                     
.                 V5.07.04 01.12.1999 Katie Nelson 
.                          Fixed error in CKTIM000 routine                      
.                 V5.07.03 30.11.1999 Katie Nelson 
.                          Fixed a branch statment branching to incorrect place
.                 V5.07.02 03.11.1999 Katie Nelson 
.                          Recompiled for DAYOFWEK    
.                 V5.07.01 27.10.1999 Katie Nelson 
.                          New Version for Basic Obs and/or Full Obs Detail 
.                 V5.07.00 12.10.1998 Katie Nelson 
.                          Created Program
.
.----------------------------------------------------------------------
          INC       IBAWEBDF    
.
          INC       APSMASFD/INC
          INC       EMRSITFD/INC
          INC       EMRUNKFD/INC
          INC       EMRVISFD/INC
          INC       OBSDETFD/INC
          INC       OBSTYPFD/INC
          INC       PATCALAG/INC
          INC       PMSUCHFD/INC
          INC       PMSUCDFD/INC
          INC       PATMASTD/INC
          INC       PATCONFD/INC
          INC       PATMA1FD/INC
          INC       PMSHCPFD/INC
          INC       PMSHCGFD/INC
          INC       PMSHCPTD/INC
          INC       PMSHCGTD/INC
          INC       PATATRFD/INC
          INC       PATATRTD/INC
          INC       PATMI1FD/INC
          INC       PMSPX2FD/INC
          INC       PMSPX2TD/INC
          INC       PMSVX1FD/INC
          INC       PMSVX1TD/INC
          INC       PATHSPFD/INC
          INC       PATPR1FD/INC
          INC       PATVISFD/INC
          INC       PATFN1FD/INC
          INC       PATIN1FD/INC
          INC       MRTMASFD/INC
          INC       PMSCCDFD/INC      * Concession Card Details
.
          INC       PATALRFD/INC      * Patient Alert Code File
          INC       RESLNKFD/INC
          INC       PATWR1FD/INC
          INC       PATDO1FD/INC
          INC       OUTSITFD/INC      * Outpatient Site File                   
          INC       NHIMASFD/INC
          INC       NHIETHFD/INC
.
CSEC      DIM       2
ISEC      FORM      2
OBSTYP01  DIM       3      3        1     Type
OBSTYP02  DIM       25     25       4     Description
OBSTYP03  DIM       3      3        29    BSP Template for Add
OBSTYP04  DIM       3      3        32    BSP Template for Update
OBSTYP05  DIM       1      1        32    Active
ACTIVE    DIM       3
STARTKEY  DIM       50
ACTDESC   DIM       25
FOCDESC   DIM       25
FICDESC   DIM       25
TOTNEURO  FORM      2
TOTNSTAT  DIM       12       * Neuro total GCS score, blank of not nuero obs
.
OUTPPULS  DIM       6
OUTPRESP  DIM       6
OUTPTEMP  DIM       6
OUTPBP    DIM       10
OUTPPOX   DIM       6
OUTPO2F   DIM       6
OUTPPFL   DIM       6
OUTPFOT   DIM       6
OUTPFIN   DIM       6
OBSFLAG   FORM      1 
CURRDATE  DIM       8                       * Current Date
CURRTIME  FORM      6                       * Current Time
DISPPUPL  DIM       3                       * Pupil obs available
DISPLIMB  DIM       3                       * Limb obs available
DIM8      DIM       8
LMODTIME  FORM      6                       * Last modification Time
TEMPTIME  DIM       8                       * Temporary Time variable
TRIREDIR  DIM       1                       * Triage redirect flag
DSETVALU  DIM       2                       * Javachart set value
DOCTCODE  DIM       6
EMRFLAG   FORM      1
IMAGE     DIM       80                      * obs value image ok/out range
COMLNGTH  FORM      2
FORM2P1   FORM      2.1
FORM2P1A  FORM      2.1
FORM4P2   FORM      4.2
FORM6P1A  FORM      6.1
FORM8     FORM      8
F8P2      FORM      8.2
FULOBSFL  FORM      1                       * Full Observation Flag 
NEXTPAGE  FORM      1                       * 1=close window 2=redirect
NOATTRIB  FORM      1
OBSERKEY  DIM       24                      * Observation Key 
PSAGECON  DIM       3
PSAGETYP  DIM       3
UPDTTYPE  DIM       1                       * Update Type
UPDATEKY  DIM       16                      * Update Key 
OBSVTYPE  DIM       3
.
OBDET001  DIM       11     * Observation Date                   
OBDET002  DIM       8      * Observation Time                   
OBDET003  DIM       3      * Observation Type                   
OBDET004  DIM       3      * Pulse                              
OBDET005  DIM       6      * Temperature                        
OBDET006  DIM       3      * Blood Pressure Systolic            
OBDET007  DIM       3      * Blood Pressure Diastolic           
OBDET008  DIM       3      * Respiration                        
OBDET009  DIM       3      * Pulse / Oximeter Sa O2             
OBDET010  DIM       3      * Oxygen Flow Litres per Min         
OBDET011  DIM       4      * Peak Flow                          
OBDET012  DIM       3      * Fluids Output Code
OBDET013  DIM       3      * Fluids Intake Code
OBDET014  DIM       6      * Fluids Output
OBDET015  DIM       6      * Fluids Intake
OBDET016  DIM       1      * Eyes Open
OBDET017  DIM       1      * Best Verbal Response
OBDET018  DIM       1      * Best Motor Response      
OBDET019  DIM       1      * Pupil Size Left          
OBDET020  DIM       1      * Pupil Size Right
OBDET021  DIM       1      * Pupil Reaction Left 
OBDET022  DIM       1      * Pupil Reaction Right
OBDET023  DIM       1      * Limb Movement Left Arm
OBDET024  DIM       1      * Limb Movement Right Arm
OBDET025  DIM       1      * Limb Movement Left Leg 
OBDET026  DIM       1      * Limb Movement Right Leg 
OBDET027  DIM       3      * Action/Comment Code
OBDET028  DIM       1      * User Defined Y/N 1        
OBDET029  DIM       1      * User Defined Y/N 2        
OBDET030  DIM       1      * User Defined Y/N 3        
OBDET031  DIM       1      * User Defined Y/N 4        
OBDET032  DIM       3      * User Defined Code 1       
OBDET033  DIM       3      * User Defined Code 2       
OBDET034  DIM       12     * User Defined Numeric 1    
OBDET035  DIM       12     * User Defined Numeric 2    
OBDET036  DIM       12     * User Defined Numeric 3    
OBDET037  DIM       12     * User Defined Numeric 4    
OBDET038  DIM       40     * Comment 1
OBDET039  DIM       40     * Comment 2                 
OBDET040  DIM       40     * Comment 3                 
OBDET041  DIM       2      * Pain Score (0-10)       * I CAR 10484
OBDET042  DIM       1      * CVP (1-8)               * I CAR 10485
.
BODMASIN  DIM       5
BODMASRN  DIM       60
BODMASUW  INIT      "<font color=purple>"
BODMASHE  INIT      "<font color=black>"
BODMASFT  INIT      "<font color=red>"
BOLD      INIT      "<b>"
ENDBOLD   INIT      "</b>"
ENDFONT   INIT      "</font>"
.
DISPWGT   DIM       9
DISPHGT   DIM       6
DISPHWD   DIM       8
DISPBMI   DIM       8
DISPBSA   DIM       9
FORM6P1   FORM      6.1
FORM6P2   FORM      6.2
FORM3     FORM      3
.
TIMEHHMM  DIM       5
.
PRGID     INIT      "CLIWEB02"
VERSION   INIT      "V12.01.00"
PRGNAM    INIT      "Clinical Observations Server"
.
          CALL      WEBINT00       * Initialise Fifo Etc.
          CALL      INIT0000       * Open Files
.
MAIN1000  CALL      WEBRED00       * Read Fifo WEBPID and USERID
.
          COMPARE   "999",REPORTNO * End Server Process on Report Option 999
          GOTO      MAIN9999 IF EQUAL
.
          BRANCH    REPORTNO,MAIN1100,MAIN1200,MAIN1300
.
          PACK      WEBTITLE,PRGID,SP1,VERSION,SP1,PRGNAM,SP70
          MOVE      "Invalid Option",WEBTITLE
          CALL      WEBERR00   * Create Output File and Write HTML Page Header
          GOTO      MAIN1000
.
MAIN1100  CALL      OBSET000                * Observation Set
          BRANCH    EXIT,MAIN1000
          PERFORM   NEXTPAGE,NXTPG000,NXTPG000,NXTPG000
          GOTO      MAIN1000
.
MAIN1200  CALL      OBSDET00                * Observation Details
          BRANCH    EXIT,MAIN1000
          PERFORM   NEXTPAGE,NXTPG000,NXTPG000,NXTPG000
          GOTO      MAIN1000
.
MAIN1300  CALL      OBSTYP00                * Observation Type Maintenance
          BRANCH    EXIT,MAIN1000
          CALL      WINCLS00
          GOTO      MAIN1000
.
MAIN9999  MOVE      "SERVER SHUTDOWN COMPLETE",WEBTITLE
          CALL      WEBERR00
          STOP
.------------------------------------------------------------
. Open Files and Initialize Variables
.------------------------------------------------------------
INIT0000  CALL      INTMAS00  * Open Routine in PATMASTM   
.
          OPEN      OBSDETA1,"obsdetaf"
          OPEN      OBSTYPA1,"obstypaf"
          OPEN      PATCODE1,"patcodes"
          OPEN      PATCODE2,"patcodes"
          OPEN      PATHSPA1,"pathspaf"
          OPEN      PATVISA1,"patvisaf"
          OPEN      PATVISA2,"patvisaf"
          OPEN      PATMA1A1,"patma1af"
          OPEN      PATMX1A1,"patmx1af"
          OPEN      PATMI1A1,"patmi1af"
          OPEN      PATPR1A1,"patpr1af"
.
          OPEN      EMRVISA1,"emrvisaf"
          OPEN      EMRSITA1,"emrsitaf"
.
          OPEN      PMSVX1A1,"pmsvx1af"
.
          MOVE      ZERO,OVRCD
          TRAP      OVERCOND IF IO
          OPEN      EMRUNKA1,"emrunkaf"
          TRAPCLR   IO
          MOVE      OVRCD,EMRFLAG
.
          READ      CONTROLF,ZERO;*43,IBCNMHOS
          READ      CONTROLF,HUND25;*238,PTCNNRTD
.
          IF        IBCNMHOS=1
            OPEN      MLTCODA1,"mltcodaf"
            OPEN      MLTCODA2,"mltcodaf"
          ENDIF
.
          MOVE      ZERO,F2
          MOVE      PTCNNRTD,F2
          IF        F2 = 0
            MOVE      "10",PTCNNRTD
          ENDIF
.
          MOVE      ZERO,NOATTRIB
          MOVE      ZERO,OVRCD
          TRAP      OVERCOND IF IO
          OPEN      PATATRA1,"patatraf"
          TRAPCLR   IO
          IF        OVRCD=1
            MOVE      ONE,NOATTRIB
          ENDIF
.
          RETURN
.------------------------------------------------------------
. Clear Parameters
.------------------------------------------------------------
CLRPAR00  MOVE      ZERO,REPORTNO
          MOVE      SP70,URNUMBER
          MOVE      SP70,ADMISSNO
          MOVE      SP70,TEMPLATE
          MOVE      SP70,STARTKEY
          MOVE      ZERO,FULOBSFL
          MOVE      SP70,UPDTTYPE
          MOVE      SP70,UPDATEKY
          MOVE      SP70,OBSERKEY
          MOVE      ZERO,NEXTPAGE
          MOVE      ZERO,NORECORD
          MOVE      ZERO,STARTNUM
          PACK      REDIRECT,SP70,SP70,SP70,SP70
          MOVE      SP70,OBSVTYPE
.
          MOVE      SP70,OBDET001  
          MOVE      SP70,OBDET002  
          MOVE      Z70,OBDET003  
          MOVE      Z70,OBDET004  
          MOVE      Z70,OBDET005  
          MOVE      Z70,OBDET006  
          MOVE      Z70,OBDET007  
          MOVE      Z70,OBDET008  
          MOVE      Z70,OBDET009  
          MOVE      Z70,OBDET010  
          MOVE      Z70,OBDET011  
          MOVE      Z70,OBDET012  
          MOVE      Z70,OBDET013  
          MOVE      Z70,OBDET014  
          MOVE      Z70,OBDET015  
          MOVE      Z70,OBDET016  
          MOVE      Z70,OBDET017  
          MOVE      Z70,OBDET018  
          MOVE      Z70,OBDET019  
          MOVE      Z70,OBDET020  
          MOVE      Z70,OBDET021  
          MOVE      Z70,OBDET022  
          MOVE      Z70,OBDET023  
          MOVE      Z70,OBDET024  
          MOVE      Z70,OBDET025  
          MOVE      Z70,OBDET026  
          MOVE      Z70,OBDET027  
          MOVE      Z70,OBDET028  
          MOVE      Z70,OBDET029  
          MOVE      Z70,OBDET030  
          MOVE      Z70,OBDET031  
          MOVE      Z70,OBDET032  
          MOVE      Z70,OBDET033  
          MOVE      Z70,OBDET034  
          MOVE      Z70,OBDET035  
          MOVE      Z70,OBDET036  
          MOVE      Z70,OBDET037  
          MOVE      Z70,OBDET038
          MOVE      Z70,OBDET039 
          MOVE      Z70,OBDET040  
          MOVE      Z70,OBDET041                * I CAR 10484
          MOVE      Z70,OBDET042                * I CAR 10485
.
          MOVE      SP70,TRIREDIR
.
          CALL      CPVXTF00
.
CLRPAR99  RETURN
.------------------------------------------------------------
. Set Parameters
.------------------------------------------------------------
SETPAR00  MATCH     "reportno=",QRYNAME
          IF        @EQUAL
            MOVE      QRYDATA,REPORTNO
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "template=",QRYNAME
          IF        @EQUAL
            MOVE      QRYDATA,TEMPLATE
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "urnumber=",QRYNAME
          IF        @EQUAL
            MOVE      QRYDATA,URNUMBER
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "admissno=",QRYNAME
          IF        @EQUAL
            MOVE      QRYDATA,ADMISSNO
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "obserkey=",QRYNAME
          IF        @EQUAL
            MOVE      QRYDATA,OBSERKEY
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "updateky=",QRYNAME
          IF        @EQUAL
            MOVE      QRYDATA,UPDATEKY
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "updttype=",QRYNAME
          IF        @EQUAL
            MOVE      QRYDATA,UPDTTYPE
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "nextpage=",QRYNAME
          IF        @EQUAL
            MOVE      QRYDATA,NEXTPAGE
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "redirect=",QRYNAME
          IF        @EQUAL
            MOVE      QRYDATA,REDIRECT
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "norecord=",QRYNAME
          IF        @EQUAL
            MOVE      QRYDATA,NORECORD
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "startnum=",QRYNAME
          IF        @EQUAL
            MOVE      QRYDATA,STARTNUM
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "triredir=",QRYNAME
          IF        @EQUAL
            MOVE      QRYDATA,TRIREDIR
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "startkey=",QRYNAME
          IF        @EQUAL
            MOVE      QRYDATA,STARTKEY
            PACK      STARTKEY,STARTKEY,SP70
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "obsvtype=",QRYNAME
          IF        @EQUAL
            MOVE      QRYDATA,OBSVTYPE
            PACK      OBSVTYPE,OBSVTYPE,SP70
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "obdet",QRYNAME
          IF        @EQUAL
            CALL      SPODS000              * Set Observation parameters
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "obstyp",QRYNAME
          IF        @EQUAL
            CALL      SPOTY000              * Set observation type
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "pmsvx",QRYNAME
          IF        @EQUAL
            CALL      SPVXTF00              * visit extension     
            GOTO      SETPAR99
          ENDIF
.
SETPAR99  RETURN
.------------------------------------------------------------
. Set Parameters for Observation Type
.------------------------------------------------------------
SPOTY000  MOVE      ZERO,EXIT
          UNPACK    QRYNAME,KEY6,KEY2
          MOVE      ZERO,F2
          MOVE      KEY2,F2
          PACK      QRYDATA,QRYDATA,SP70
          STORE     QRYDATA,F2,OBSTYP01,OBSTYP02,OBSTYP03,OBSTYP04,OBSTYP05
          RETURN
.------------------------------------------------------------
. Set Parameters for Observation details        
.------------------------------------------------------------
SPODS000  MOVE      ZERO,EXIT
          UNPACK    QRYNAME,KEY5,KEY3
          MOVE      KEY3,F3
          STORE     QRYDATA,F3,OBDET001,OBDET002,OBDET003,OBDET004,OBDET005:
                               OBDET006,OBDET007,OBDET008,OBDET009,OBDET010:
                               OBDET011,OBDET012,OBDET013,OBDET014,OBDET015:
                               OBDET016,OBDET017,OBDET018,OBDET019,OBDET020:
                               OBDET021,OBDET022,OBDET023,OBDET024,OBDET025:
                               OBDET026,OBDET027,OBDET028,OBDET029,OBDET030:
                               OBDET031,OBDET032,OBDET033,OBDET034,OBDET035:
                               OBDET036,OBDET037,OBDET038,OBDET039,OBDET040:
                               OBDET041,OBDET042               * C CAR 10484
.                                                              * C CAR 10485
SPODS999  RETURN 
.------------------------------------------------------------
. Process Fields 
.------------------------------------------------------------
PROFLD00  BRANCH    REPORTNO,PROFLD10,PROFLD20,PROFLD30
          GOTO      PROFLD99
.
PROFLD10  BRANCH    FLDSETNO,PROFLD11,PROFLD12
          GOTO      PROFLD99
.
PROFLD11  CALL      MASF0000
          GOTO      PROFLD99
.
PROFLD12  CALL      OSET0000                * Observation Set Table
          GOTO      PROFLD99
.
PROFLD20  BRANCH    FLDSETNO,PROFLD21,PROFLD22,PROFLD23
          GOTO      PROFLD99
.
PROFLD21  CALL      MASF0000
          GOTO      PROFLD99
.
PROFLD22  CALL      ODET0000
          GOTO      PROFLD99
.
PROFLD23  CALL      VXTF0000
          GOTO      PROFLD99
.
PROFLD30  CALL      TYPE0000
          GOTO      PROFLD99
.
PROFLD99  RETURN
.------------------------------------------------------------
. Process Observation Set
.------------------------------------------------------------
OBSET000  CALL      GETVIS00                * Get visit details
          BRANCH    EXIT,OBSET999
. 
          CLEAR     WEBTITLE
          MOVE      "Clinical Observations",WEBTITLE
          RESET     WEBTITLE
          CALL      WEBHED00   * Create Output File and Write HTML Page Header
          BRANCH    EXIT,OBSET999
          CALL      WEBBOD00   * Process Web Body
          CALL      WEBEND00   * Process End of HTML File
          MOVE      ONE,EXIT
.
OBSET999  RETURN
.------------------------------------------------------------
. Observation Details
.------------------------------------------------------------
OBSDET00  CALL      GETVIS00                * Get visit details
          BRANCH    EXIT,OBSDET99
.
          MATCH     "A",UPDTTYPE
          GOTO      OBSDET10 IF EQUAL
          MATCH     "U",UPDTTYPE
          GOTO      OBSDET20 IF EQUAL
          MATCH     "D",UPDTTYPE
          GOTO      OBSDET30 IF EQUAL
.
          REP       "+ ",OBSERKEY
          MATCH     SP70,OBSERKEY
          GOTO      OBSDET40 IF NOT EQUAL
          CALL      CLOBSDET              * Clear Basic Observation Details
          GOTO      OBSDET80
.
OBSDET10  MATCH     Z70,OBDET003
          GOTO      OBSDET91 IF EQUAL
          CALL      ADDOBS00              * Add Full Observation Details
          GOTO      OBSDET99
.
OBSDET20  MATCH     Z70,OBDET003
          GOTO      OBSDET91 IF EQUAL
          CALL      CKTIM000              * Check last modified date/time 
          BRANCH    EXIT,OBSDET99
          CALL      UPDOBS00              * Update Full Observation Details
          GOTO      OBSDET99
.
OBSDET30  CALL      CKTIM000              * Check last Modified date/time 
          BRANCH    EXIT,OBSDET99
          CALL      DELOBS00              * Delete Observation Details
          GOTO      OBSDET99
.
OBSDET40  CALL      RDOBS000              * Read Full Observation tables
          BRANCH    EXIT,OBSDET99
.
OBSDET80  CLEAR     WEBTITLE
          MOVE      "Observation Details",WEBTITLE
          RESET     WEBTITLE
.
          CALL      WEBHED00   * Create Output File and Write HTML Page Header
          BRANCH    EXIT,OBSDET99
.
          CALL      WEBBOD00   * Process Web Body
          CALL      WEBEND00   * Process End of HTML File
          MOVE      ONE,EXIT
          GOTO      OBSDET99
.
OBSDET91  MOVE      "Observation Type Mandatory",WEBTITLE
          CALL      WEBERR00
          MOVE      ONE,EXIT
          GOTO      OBSDET99
.
OBSDET99  RETURN
.------------------------------------------------------------
. Add Full Observation Details
.------------------------------------------------------------
ADDOBS00  MOVE      ADMISSNO,OBDEVIST 
          CALL      IBACLOCK
          MATCH     SP70,OBDET001
          IF        @EQUAL
            PACK      OBDEDATE,CCC,CYY,CMM,CDD
          ELSE
            UNPACK    OBDET001,CDAY,KEY1,MTHNAM3,KEY1,CCENT,CYEAR
            CALL      SETMTH00            * Set CMON from MTHNAM3
            PACK      OBDEDATE,CCENT,CYEAR,CMON,CDAY
          ENDIF
          REP       " 0",OBDEDATE
          MATCH     SP70,OBDET002
          IF        @EQUAL
            CLOCK     TIME,OBDETIME
          ELSE
            MOVE      OBDET002,OBDETIME
          ENDIF
.
ADDOBS20  PACK      KEY24,OBDEVIST,OBDEDATE,OBDETIME,SP70
          CALL      RAOBDE1
          IF        OVRCD<>1
            CALL       INTM0000    * increment the time
            GOTO       ADDOBS20
          ENDIF
.
          CALL      CLOBSDET
          UNPACK    KEY24,OBDEVIST,OBDEDATE,OBDETIME
          CALL      MOVOBS00
          PACK      OBDEMDAT,CCC,CYY,CMM,CDD
          REP       " 0",OBDEMDAT
          CLOCK     TIME,OBDEMTIM
          MOVE      USERID,OBDEUID
          CALL      WROBDE1
.
          MOVE      OBDEVIST,KEY8
          CALL      RDPMVX11
          IF        OVRCD=0
            CALL      MVVXTF00
.           MULT      "100",PMSVX045
            MOVE      PMSVX045,PMVXPWGT
            MOVE      PMSVX046,PMVXPHGT
            PACK      PMVXDHWR,CCC,CYY,CMM,CDD
            REP       " 0",PMVXDHWR
            CLOCK     TIME,PMVXDHWR
            CALL      UPPMVX11
          ELSE
            CALL      MVVXTF00
            MOVE      OBDEVIST,PMVXVISN
            MOVE      OBDEVIST,KEY8
.           MULT      "100",PMSVX045
            MOVE      PMSVX045,PMVXPWGT
            MOVE      PMSVX046,PMVXPHGT
            PACK      PMVXDHWR,CCC,CYY,CMM,CDD
            REP       " 0",PMVXDHWR
            CLOCK     TIME,PMVXDHWR
            CALL      WRPMVX11
          ENDIF
.
          PACK      KEY8,URNUMBER,SP70
          CALL      RDPMPX21
          IF        OVRCD=0
            MOVE      PMSVX046,PMPXPHEI
.           DIV       "100",PMSVX045
            MOVE      PMSVX045,PMPXPWEI
            CALL      UPPMPX21
          ENDIF
.
          IF        NOATTRIB<>ONE
          PACK      KEY35,URNUMBER,OBDEDATE,OBDETIME,ZERO,ZERO,ONE,ADMISSNO,SP70
            CALL      RDPTATR1
            IF        OVRCD=1
              CALL      CLPATATR
.
              MOVE      URNUMBER,PTARURNO
              MOVE      ADMISSNO,PTARVISN
              MOVE      OBDEDATE,PTARDATE
              MOVE      OBDETIME,PTARTIME
              MOVE      "001",PTARTYPE
.
              MOVE      ZERO,FORM6P1
              MULT      "0.01",PMSVX045
              MOVE      PMSVX045,FORM6P1
              MOVE      SP70,DIM8
              MOVE      FORM6P1,DIM8
              LJUSTIFY  DIM8
              MOVE      DIM8,PTARVAL2
.
              MOVE      ZERO,FORM6P1
              MOVE      PMSVX046,FORM6P1
              MOVE      SP70,DIM8
              MOVE      FORM6P1,DIM8
              LJUSTIFY  DIM8
              MOVE      DIM8,PTARVAL1
.
              CALL      CLCBMI00
              PACK      PTARVAL3,BODMASIN,SP70
.
              MOVE      USERID,PTARCUSR
              MOVE      OBDEDATE,PTARCDTE
              MOVE      OBDETIME,PTARCTME
              MOVE      SP70,PTARUUSR
              MOVE      SP70,PTARUDTE
              MOVE      SP70,PTARUTME
              MOVE      SP70,PTARSPAR
.
              CALL      WRPTATR1 
            ENDIF
.
          ENDIF
.
          GOTO      ADDOBS99
.
ADDOBS99  RETURN
.
MOVOBS00  MATCH     Z70,OBDET003
          IF        !@EQUAL
            MOVE      OBDET003,OBDETYP   *    Observation Type
          ENDIF
          MATCH     Z70,OBDET004
          IF        !@EQUAL
            SQUEEZE   OBDET004
            MOVE      OBDET004,OBDEPULS  *    Pulse            
          ENDIF
          MATCH     Z70,OBDET005
          IF        !@EQUAL
            SQUEEZE   OBDET005
            MOVE      OBDET005,OBDETEMP  *    Temperature     
          ENDIF
          MATCH     Z70,OBDET006
          IF        !@EQUAL
            SQUEEZE   OBDET006
            MOVE      OBDET006,OBDEBPSY  *    Blood Pressure Systolic
          ENDIF
          MATCH     Z70,OBDET007
          IF        !@EQUAL
            SQUEEZE   OBDET007
            MOVE      OBDET007,OBDEBPDI  *    Blood Pressure Diastoli
          ENDIF
          MATCH     Z70,OBDET008
          IF        !@EQUAL
            SQUEEZE   OBDET008
            MOVE      OBDET008,OBDERESP  *    Respiration
          ENDIF
          MATCH     Z70,OBDET009
          IF        !@EQUAL
            SQUEEZE   OBDET009
            MOVE      OBDET009,OBDEPOX   *    Pulse / Oximeter Sa O2
          ENDIF
          MATCH     Z70,OBDET010
          IF        !@EQUAL
            SQUEEZE   OBDET010
            MOVE      OBDET010,OBDEO2F   *    Oxygen Flow Litres per Min
          ENDIF
          MATCH     Z70,OBDET011
          IF        !@EQUAL
            SQUEEZE   OBDET011
            MOVE      OBDET011,OBDEPFL   *    Peak Flow
          ENDIF
          MATCH     Z70,OBDET012
          IF        !@EQUAL
            MOVE      OBDET012,OBDEFOC   *    Fluid Output Type (Cat wq)
          ENDIF
          MATCH     Z70,OBDET013
          IF        !@EQUAL
            MOVE      OBDET013,OBDEFIC   *    Fluid Intake Type (Cat wr)
          ENDIF
          MATCH     Z70,OBDET014
          IF        !@EQUAL
            SQUEEZE   OBDET014
            MOVE      OBDET014,OBDEFOT   *    Fluids Output
          ENDIF
          MATCH     Z70,OBDET015
          IF        !@EQUAL
            SQUEEZE   OBDET015
            MOVE      OBDET015,OBDEFIN   *    Fluid Intake
          ENDIF
          MATCH     Z70,OBDET016
          IF        !@EQUAL
            MOVE      OBDET016,OBDEEYEO  *    Eyes Open
          ENDIF
          MATCH     Z70,OBDET017
          IF        !@EQUAL
            MOVE      OBDET017,OBDEVERB  *    Best Verbal Response 
          ENDIF
          MATCH     Z70,OBDET018
          IF        !@EQUAL
            MOVE      OBDET018,OBDEMOTO  *    Best Motor Response 
          ENDIF
          MATCH     Z70,OBDET019
          IF        !@EQUAL
            MOVE      OBDET019,OBDEPSL   *    Pupil Size Left    
          ENDIF
          MATCH     Z70,OBDET020
          IF        !@EQUAL
            MOVE      OBDET020,OBDEPSR   *    Pupil Size Right  
          ENDIF
          MATCH     Z70,OBDET021
          IF        !@EQUAL
            MOVE      OBDET021,OBDEPRL   *    Pupil Reaction Left
          ENDIF
          MATCH     Z70,OBDET022
          IF        !@EQUAL
            MOVE      OBDET022,OBDEPRR   *    Pupil Reaction Right
          ENDIF
          MATCH     Z70,OBDET023
          IF        !@EQUAL
            MOVE      OBDET023,OBDELMLA  *    Limb Movement Left Arm 
          ENDIF
          MATCH     Z70,OBDET024
          IF        !@EQUAL
            MOVE      OBDET024,OBDELMRM  *    Limb Movement Right Arm
          ENDIF
          MATCH     Z70,OBDET025
          IF        !@EQUAL
            MOVE      OBDET025,OBDELMLL  *    Limb Movement Left Leg
          ENDIF
          MATCH     Z70,OBDET026
          IF        !@EQUAL
            MOVE      OBDET026,OBDELMRL  *    Limb Movement Right Leg
          ENDIF
          MATCH     Z70,OBDET027
          IF        !@EQUAL
            MOVE      OBDET027,OBDEACT   *    Action/Comment Code (ws)
          ENDIF
          MATCH     Z70,OBDET028
          IF        !@EQUAL
            MOVE      OBDET028,OBDEUY1   *    User Def Y/N 1         
          ENDIF
          MATCH     Z70,OBDET029
          IF        !@EQUAL
            MOVE      OBDET029,OBDEUY2   *    User Def Y/N 2        
          ENDIF
          MATCH     Z70,OBDET030
          IF        !@EQUAL
            MOVE      OBDET030,OBDEUY3   *    User Def Y/N 3       
          ENDIF
          MATCH     Z70,OBDET031
          IF        !@EQUAL
            MOVE      OBDET031,OBDEUY4   *    User Def Y/N 4      
          ENDIF
          MATCH     Z70,OBDET032
          IF        !@EQUAL
            MOVE      OBDET032,OBDEUC1   *    User Def Code 1 (wt)
          ENDIF
          MATCH     Z70,OBDET033
          IF        !@EQUAL
            MOVE      OBDET033,OBDEUC2   *    User Def Code 2 (wu)
          ENDIF
          MATCH     Z70,OBDET034
          IF        !@EQUAL
            SQUEEZE   OBDET034
            MOVE      OBDET034,OBDEUN1   *    User Def Num 1 
          ENDIF
          MATCH     Z70,OBDET035
          IF        !@EQUAL
            SQUEEZE   OBDET035
            MOVE      OBDET035,OBDEUN2   *    User Def Bum 2
          ENDIF
          MATCH     Z70,OBDET036
          IF        !@EQUAL
            SQUEEZE   OBDET036
          MOVE      OBDET036,OBDEUN3   *   User Def Num 3                     
          ENDIF
          MATCH     Z70,OBDET037
          IF        !@EQUAL
            SQUEEZE   OBDET037
          MOVE      OBDET037,OBDEUN4   *   User Def Num 4                     
          ENDIF
          MATCH     Z70,OBDET038
          IF        !@EQUAL
            MOVE      OBDET038,OBDECOM1  *   Comment 1                          
          ENDIF
          MATCH     Z70,OBDET039
          IF        !@EQUAL
            MOVE      OBDET039,OBDECOM2  *   Comment 2                          
          ENDIF
          MATCH     Z70,OBDET040
          IF        !@EQUAL
            MOVE      OBDET040,OBDECOM3  *   Comment 3                          
          ENDIF
          MATCH     Z70,OBDET041
          IF        !@EQUAL
            MOVE      OBDET041,OBDEPNSC  *   Pain Score (0-10) * I CAR 10484
          ENDIF
          MATCH     Z70,OBDET042
          IF        !@EQUAL
            MOVE      OBDET042,OBDECVPS  *   CVP (1-8)         * I CAR 10485
          ENDIF
          RETURN
.------------------------------------------------------------
. Check last modified date/time
.------------------------------------------------------------
CKTIM000  REP       "+ ",OBSERKEY
          MOVE      OBSERKEY,KEY24
          CALL      RDOBDE1
          BRANCH    OVRCD,CKTIM900
.
          PACK      CURRDATE,CCC,CYY,CMM,CDD
          REP       " 0",CURRDATE
          MATCH     CURRDATE,OBDEMDAT
          GOTO      CKTIM910 IF NOT EQUAL
.
          MOVE      CTIMEIS,TEMPTIME
          REP       " 0",TEMPTIME
          REP       ": ",TEMPTIME
          SQUEEZE   TEMPTIME
          MOVE      TEMPTIME,CURRTIME
.
          MOVE      OBDEMTIM,TEMPTIME
          REP       " 0",TEMPTIME
          REP       ": ",TEMPTIME
          SQUEEZE   TEMPTIME
          MOVE      TEMPTIME,LMODTIME
.
          SUB       LMODTIME,CURRTIME
          COMPARE   "300",CURRTIME
          GOTO      CKTIM910 IF NOT LESS
.
          MOVE      ZERO,EXIT
          GOTO      CKTIM999
.
CKTIM900  CLEAR     WEBTITLE 
          MOVE      "Invalid Observation Key",WEBTITLE
          CALL      WEBERR00
          MOVE      ONE,EXIT
.
CKTIM910  CLEAR     WEBTITLE 
          MOVE      "Time Limit Expired - Cannot Update Observation",WEBTITLE
          CALL      WEBERR00
          MOVE      ONE,EXIT
.
CKTIM999  RETURN
.------------------------------------------------------------
. Read Full Observation tables
.------------------------------------------------------------
RDOBS000  REP       "+ ",OBSERKEY
          MOVE      OBSERKEY,KEY24
          CALL      RDOBDE1
          BRANCH    OVRCD,RDOBS900
.
          GOTO      RDOBS990
.
RDOBS900  CLEAR     WEBTITLE 
          APPEND    "Invalid Observation Key **",WEBTITLE
          APPEND    OBSERKEY,WEBTITLE
          APPEND    " **",WEBTITLE
          RESET     WEBTITLE
          CALL      WEBERR00
          MOVE      ONE,EXIT
          GOTO      RDOBS999
.
RDOBS990  MOVE      ZERO,EXIT
RDOBS999  RETURN
.------------------------------------------------------------
. Update Full Observation Details
.------------------------------------------------------------
UPDOBS00  REP       "+ ",OBSERKEY 
          UNPACK    OBSERKEY,OBDEVIST,OBDEDATE,OBDETIME
          CALL      IBACLOCK
.
          PACK      KEY24,OBDEVIST,OBDEDATE,OBDETIME
          CALL      RLOBDE1
          IF        OVRCD=0
            CALL      MOVOBS00
            PACK      OBDEMDAT,CCC,CYY,CMM,CDD
            REP       " 0",OBDEMDAT
            CLOCK     TIME,OBDEMTIM
            MOVE      USERID,OBDEUID
            CALL      UPOBDE1
          ENDIF
.
          CALL      UUOBDE1                                            *I-90301
.
          MOVE      OBDEVIST,KEY8
          CALL      RDPMVX11
          IF        OVRCD=0
            CALL      MVVXTF00
.           MULT      "100",PMSVX045
            MOVE      PMSVX045,PMVXPWGT
            MOVE      PMSVX046,PMVXPHGT
            PACK      PMVXDHWR,CCC,CYY,CMM,CDD
            REP       " 0",PMVXDHWR
            CLOCK     TIME,PMVXDHWR
            CALL      UPPMVX11
          ELSE
            CALL      MVVXTF00
            MOVE      OBDEVIST,PMVXVISN
            MOVE      OBDEVIST,KEY8
.           MULT      "100",PMSVX045
            MOVE      PMSVX045,PMVXPWGT
            MOVE      PMSVX046,PMVXPHGT
            PACK      PMVXDHWR,CCC,CYY,CMM,CDD
            REP       " 0",PMVXDHWR
            CLOCK     TIME,PMVXDHWR
            CALL      WRPMVX11
          ENDIF
.
          PACK      KEY8,URNUMBER,SP70
          CALL      RDPMPX21
          IF        OVRCD=0
            MOVE      PMSVX046,PMPXPHEI
.           DIV       "100",PMSVX045
            MOVE      PMSVX045,PMPXPWEI
            CALL      UPPMPX21
          ENDIF
.
          IF        NOATTRIB<>ONE
          PACK      KEY35,URNUMBER,OBDEDATE,OBDETIME,ZERO,ZERO,ONE,ADMISSNO,SP70
            CALL      RDPTATR1
            IF        OVRCD=0
.
              MOVE      ZERO,FORM6P1
              MULT      "0.01",PMSVX045
              MOVE      PMSVX045,FORM6P1
              MOVE      SP70,DIM8
              MOVE      FORM6P1,DIM8
              LJUSTIFY  DIM8
              MOVE      DIM8,PTARVAL2
.
              MOVE      ZERO,FORM6P1
              MOVE      PMSVX046,FORM6P1
              MOVE      SP70,DIM8
              MOVE      FORM6P1,DIM8
              LJUSTIFY  DIM8
              MOVE      DIM8,PTARVAL1
.
              CALL      CLCBMI00
              PACK      PTARVAL3,BODMASIN,SP70
.
              PACK      PTARUDTE,CCC,CYY,CMM,CDD
              REP       " 0",PTARUDTE
              CLOCK     TIME,PTARUTME
              MOVE      USERID,PTARUUSR
.
              CALL      UPPTATR1
.
            ENDIF
          ENDIF
.
UPDOBS99  RETURN
.------------------------------------------------------------
. Delete Observations
.------------------------------------------------------------
DELOBS00  REP       "+ ",OBSERKEY
          PACK      KEY24,OBSERKEY
          CALL      RAOBDE1
          IF        OVRCD=0
            CALL      DEOBDE1
          ENDIF
          RETURN
.------------------------------------------------------------
. Observation Set Field Items
.------------------------------------------------------------
OSET0000  BRANCH    FLDITMNO,OSET0100,OSET0200,OSET0300,OSET0400,OSET0500:
                             OSET0600,OSET0700,OSET0800
          GOTO      OSET9999
.
OSET0100  CALL      TABA0000
          GOTO      OSET9999
.
OSET0200  WRITE     HTMLFILE;ADMISSNO;
          GOTO      OSET9999
.
OSET0300 
          GOTO      OSET9999     
.
OSET0400  
          GOTO      OSET9999
.
OSET0500  CALL      TYPSEL00
          GOTO      OSET9999     
.
OSET0600  MOVE      SP70,OBDETYP
          CALL      SELTYP00
          GOTO      OSET9999     
.
OSET0700  CALL      TABB0000
          GOTO      OSET9999
.
OSET0800  CALL      PROBS000
          GOTO      OSET9999
.
OSET9999  RETURN
.------------------------------------------------------------
. Observation Type Select List
.------------------------------------------------------------
TYPSEL00  MOVE      SP70,KEY3
          CALL      RSOBTY1
TYPSEL10  CALL      RKOBTY1
          BRANCH    OVRCD,TYPSEL99
          MATCH     "1",OBTYACTV
          GOTO      TYPSEL10 IF NOT EQUAL
          MATCH     OBTYTYPE,OBSVTYPE         * Filter by Type of Observation
          IF        @EQUAL
            WRITE     HTMLFILE;"<option value=#"",OBTYTYPE,OBTYTMAD,OBTYTMUP:
                               "#" selected>",OBTYDESC,"</option>"
          ELSE
            WRITE     HTMLFILE;"<option value=#"",OBTYTYPE,OBTYTMAD,OBTYTMUP:
                               "#">",OBTYDESC,"</option>"
          ENDIF
          GOTO      TYPSEL10
.
TYPSEL99  RETURN
.------------------------------------------------------------
. Observation Set Table by U/R
.------------------------------------------------------------
TABB0000  UNPACK    DIM127,DIM1,LINKPRG,DIM127
          UNPACK    DIM127,DIM1,LINKREP,DIM127
          UNPACK    DIM127,DIM1,LINKTEM,DIM127
          IF        NORECORD=0
            MOVE      "51",NORECORD       * Set Default No Records to Display
          ENDIF
          MOVE      ZERO,RECNUMB
          MOVE      ZERO,DISNUMB
.
          MATCH     ZEROUR,URNUMBER
          IF        @EQUAL
            MOVE      ADMISSNO,DPVIBILL
            CALL      GETHW000   * Get Visit Height & Weight
            CALL      TABVS000   * Get Observations for Current Visit
            GOTO      TABB9000
          ENDIF
.       
          MOVE      ADMISSNO,KEY8
          CALL      RDVISA1
          BRANCH    OVRCD,TABB0900
.
          CALL      GETHW000   * Get Visit Height & Weight
          CALL      TABVS000   * Get Observations for Current Visit
          BRANCH    EXIT,TABB9000
.
TABB0900  PACK      KEY24,URNUMBER,Z70
          CALL      RDVISA2
TABB1000  CALL      RDPVISA2
          BRANCH    OVRCD,TABB9000
          MATCH     PVIURNO,URNUMBER
          GOTO      TABB9000 IF NOT EQUAL
          MATCH     DPVIBILL,ADMISSNO
          GOTO      TABB1000 IF EQUAL
.
          CALL      GETHW000
          CALL      TABVS000   * Get Observations for Current Visit
          BRANCH    EXIT,TABB9000
          GOTO      TABB1000
.
TABB9000  MOVE      ZERO,EXIT
TABB9999  RETURN
.
. Visit Observation Details
.
TABVS000  MOVE      ZERO,EXIT
          PACK      KEY24,DPVIBILL,Z70
          CALL      RSOBDE1
TABVS100  CALL      RPOBDE1
          BRANCH    OVRCD,TABVS999
          MATCH     DPVIBILL,OBDEVIST
          GOTO      TABVS999 IF NOT EQUAL
.
          MATCH     SP70,OBSVTYPE         * Filter by Type of Observation
          IF        !@EQUAL
            MATCH     OBDETYP,OBSVTYPE
            GOTO      TABVS100 IF NOT EQUAL
          ENDIF
.
          CALL      CHKABN00    * Check for Abnormal
          CALL      TABRWB00    * Output Table Row
.
          ADD       ONE,DISNUMB
          COMPARE   NORECORD,DISNUMB
          GOTO      TABVS100 IF NOT EQUAL
          MOVE      ONE,EXIT
.
TABVS999  RETURN
.------------------------------------------------------------
. Get Visit Height and Weight
.------------------------------------------------------------
GETHW000  MOVE      SP70,DISPHWD
          MOVE      SP70,DISPWGT
          MOVE      SP70,DISPHGT
          MOVE      SP70,DISPBMI
          MOVE      SP70,DISPBSA
          MOVE      DPVIBILL,KEY8
          CALL      RDPMVX11
          IF        OVRCD=0
            MOVE      PMVXPWGT,PMSVX045
            DIV       "100",PMSVX045
            MOVE      PMSVX045,DISPWGT
            MOVE      PMVXPHGT,DISPHGT
            MOVE      PMVXDHWR,DISPHWD
            IF        PMVXPHGT>0 & PMVXPWGT>0
              ASSIGN    (PMSVX045*PMVXPHGT)/3600,FORM6P2
              MOVE      FORM6P2,DISPBSA
              ASSIGN    PMSVX045/((PMVXPHGT/100)*(PMVXPHGT/100)),FORM6P1
              MOVE      FORM6P1,DISPBMI
            ENDIF
          ENDIF
          RETURN
.
.------------------------------------------------------------
. Output Table Row Details
.------------------------------------------------------------
TABRWB00  MOVE       OBDEPULS,OUTPPULS
          IF         OBDEPULS=0
            MOVE       SP70,OUTPPULS
          ENDIF
.
          MOVE       OBDETEMP,OUTPTEMP
          IF         OBDETEMP=0
            MOVE       SP70,OUTPTEMP
          ENDIF
.
          MOVE       OBDERESP,OUTPRESP
          IF         OBDERESP=0
            MOVE       SP70,OUTPRESP
          ENDIF
.
          MOVE       OBDEPOX,OUTPPOX
          IF         OBDEPOX=0
            MOVE       SP70,OUTPPOX
          ENDIF
.
          MOVE       OBDEO2F,OUTPO2F
          IF         OBDEO2F=0
            MOVE       SP70,OUTPO2F
          ENDIF
.
          MOVE       OBDEPFL,OUTPPFL
          IF         OBDEPFL=0
            MOVE       SP70,OUTPPFL
          ENDIF
.
          MOVE       OBDEFOT,OUTPFOT
          IF         OBDEFOT=0
            MOVE       SP70,OUTPFOT
          ENDIF
.
          MOVE       OBDEFIN,OUTPFIN
          IF         OBDEFIN=0
            MOVE       SP70,OUTPFIN
          ENDIF
.
          PACK       OUTPBP,OBDEBPSY,SLASH,OBDEBPDI,SP70
          IF         OBDEBPDI=0
            MOVE       SP70,OUTPBP
          ENDIF
.
          MOVE       OBDETYP,KEY3
          CALL       RDOBTY1
.
          PACK       OBSERKEY,OBDEVIST,OBDEDATE,OBDETIME,SP70
          REP        " +",OBSERKEY
          CLEAR      HTMLLINK
          APPEND     "javascript:UpdateObs('cliweb02.pbl?reportno=2",HTMLLINK
          APPEND     "&template=",HTMLLINK
          APPEND     OBTYTMUP,HTMLLINK
          APPEND     "&obserkey=",HTMLLINK
          APPEND     OBSERKEY,HTMLLINK
          APPEND     "&admissno=",HTMLLINK
          APPEND     OBDEVIST,HTMLLINK
          APPEND     "')",HTMLLINK
          RESET      HTMLLINK
.
          MOVE       "ws",CATEGORY
          MOVE       OBDEACT,CODE
          CALL       GETCOD00
          MOVE       TDESC,ACTDESC
.
          MOVE       "wq",CATEGORY
          MOVE       OBDEFOC,CODE
          CALL       GETCOD00
          MOVE       TDESC,FOCDESC
.
          MOVE       "No ",DISPPUPL         * Clear pupil details yes/no
          MATCH      SP70,OBDEPSL
          IF         !@EQUAL
            MOVE       "Yes",DISPPUPL
            GOTO       TABRWB30
          ENDIF
.
          MATCH      SP70,OBDEPSR
          IF         !@EQUAL
            MOVE       "Yes",DISPPUPL
            GOTO       TABRWB30
          ENDIF
.
          MATCH      SP70,OBDEPRL
          IF         !@EQUAL
            MOVE       "Yes",DISPPUPL
            GOTO       TABRWB30
          ENDIF
.
          MATCH      SP70,OBDEPRR
          IF         !@EQUAL
            MOVE       "Yes",DISPPUPL
            GOTO       TABRWB30
          ENDIF
.
TABRWB30  MOVE       "No ",DISPLIMB
          MATCH      SP70,OBDELMLA
          IF         !@EQUAL
            MOVE       "Yes",DISPLIMB
            GOTO       TABRWB40
          ENDIF
.
          MATCH      SP70,OBDELMRM
          IF         !@EQUAL
            MOVE       "Yes",DISPLIMB
            GOTO       TABRWB40
          ENDIF
.
          MATCH      SP70,OBDELMLL
          IF         !@EQUAL
            MOVE       "Yes",DISPLIMB
            GOTO       TABRWB40
          ENDIF
.
          MATCH      SP70,OBDELMRL
          IF         !@EQUAL
            MOVE       "Yes",DISPLIMB
            GOTO       TABRWB40
          ENDIF
.
.
TABRWB40  PACK       KEY10,OBDEUID,SP70          * Last updated by
          CALL       RDWBSE1
          IF         OVRCD=1
            MOVE       SP70,WBSENAM
          ENDIF
.
          MOVE       "wr",CATEGORY
          MOVE       OBDEFIC,CODE
          CALL       GETCOD00
          MOVE       TDESC,FICDESC
.
          MOVE       "&nbsp;&nbsp;",TOTNSTAT
          MOVE       ZERO,TOTNEURO
          MOVE       ZERO,F1
          MOVE       OBDEEYEO,F1
          ADD        F1,TOTNEURO
          MOVE       ZERO,F1
          MOVE       OBDEVERB,F1
          ADD        F1,TOTNEURO
          MOVE       ZERO,F1
          MOVE       OBDEMOTO,F1
          ADD        F1,TOTNEURO
.
          IF        TOTNEURO<>0
            MOVE      TOTNEURO,TOTNSTAT  * Neuro total GCS score, blank of not
          ENDIF                          * neuro obs
.
          IF        OBDEUN4>0
            MOVE      OBDEUN4,PMSVX045
            MOVE      PMSVX045,DISPWGT
            MOVE      PMVXPHGT,DISPHGT
            MOVE      PMVXDHWR,DISPHWD
            IF        PMVXPHGT>0 & PMVXPWGT>0
              ASSIGN    (PMSVX045*PMVXPHGT)/3600,FORM6P2
              MOVE      FORM6P2,DISPBSA
              ASSIGN    PMSVX045/((PMVXPHGT/100)*(PMVXPHGT/100)),FORM6P1
              MOVE      FORM6P1,DISPBMI
            ENDIF
          ENDIF
.
          WRITE     HTMLFILE;"t.addRow(#"",HTMLLINK,"#",":
                             "#"",OBDEDATE,OBDETIME,"#",":  *1
                             "#"",OBTYDESC,"#",":           *2
                             "#"",OBSFLAG,"#",":            *3
                             "#"",OUTPPULS,"#",":           *4
                             "#"",OUTPTEMP,"#",":           *5
                             "#"",OUTPRESP,"#",":           *6
                             "#"",OUTPBP,"#",":             *7
                             "#"",OUTPPOX,"#",":            *8
                             "#"",OUTPO2F,"#",":            *9
                             "#"",OUTPPFL,"#",":            *0
                             "#"",FOCDESC,"#",":            *2
                             "#"",OUTPFOT,"#",":
                             "#"",FICDESC,"#",":
                             "#"",OUTPFIN,"#",":
                             "#"",OBDEEYEO,"#",":
                             "#"",OBDEVERB,"#",":
                             "#"",OBDEMOTO,"#",":
                             "#"",TOTNEURO,"#",":
                             "#"",ACTDESC,"#",":
                             "#"",OBDECOM1,"#",":
                             "#"",DISPPUPL,"#",":
                             "#"",DISPLIMB,"#",":
                             "#"",WBSENAM,"#",":
                             "#"",TOTNSTAT,"#",":
                             "#"",OBTYTYPE,"#",":
                             "#"",OBDEUC1,"#",":
                             "#"",OBDEUC2,"#",":
                             "#"",OBDEUN1,"#",":
                             "#"",OBDEUN2,"#",":
                             "#"",OBDEUN3,"#",":
                             "#"",OBDEUN4,"#",":
                             "#"",OBDEUY1,"#",":
                             "#"",OBDEUY2,"#",":
                             "#"",OBDEUY3,"#",":
                             "#"",OBDEUY4,"#",":
                             "#"",OBDEPNSC,"#",":
                             "#"",OBDECVPS,"#",":
                             "#"",DISPBMI,"#",":
                             "#"",DISPBSA,"#",":
                             "#"",DISPWGT,"#",":
                             "#"",DISPHGT,"#",":
                             "#"",DISPHWD,"#")"
.
TABRWB99  RETURN
.------------------------------------------------------------
. Observation Set Table Print Format by Admissno
.------------------------------------------------------------
PROBS000  UNPACK    DIM127,DIM1,DIM2,DIM1,OBSVTYPE,DIM127 
          MOVE      DIM2,NORECORD
          CALL      HDOBS000
.
          PACK      KEY24,ADMISSNO,SP70
          MOVE      ZERO,RECNUMB
          CALL      RSOBDE1
PROBS100  CALL      RKOBDE1
          BRANCH    OVRCD,PROBS900
          MATCH     ADMISSNO,OBDEVIST
          GOTO      PROBS900 IF NOT EQUAL
          MATCH     OBDETYP,OBSVTYPE
          GOTO      PROBS100 IF NOT EQUAL
.
          MOVE      OBDEUID,KEY10
          CALL      RDWBSE1
          IF        OVRCD=1
            MOVE      SP70,WBSENAM
          ENDIF
.
          IF        RECNUMB=NORECORD
            MOVE      ZERO,RECNUMB
            WRITE     HTMLFILE;"</table><p class=pageBreak></p><table width=100% border=0 class=obstable>"
            CALL      HDOBS000
          ENDIF
          UNPACK    OBDEDATE,CCENT,CYEAR,CMON,CDAY
          MOVE      CMON,F2
          LOAD      MTHNAM3,F2,JAN,FEB,MAR,APR,MAY,JUN,JUL,AUG,SEP,OCT,NOV,DEC
          MOVE      OBDETIME,TIMEHHMM
          MATCH     "B  ",OBSVTYPE
          CALL      PRTBAS00 IF EQUAL
          MATCH     "F  ",OBSVTYPE
          CALL      PRTFLU00 IF EQUAL
          MATCH     "N  ",OBSVTYPE
          CALL      PRTNUR00 IF EQUAL
.
          GOTO      PROBS100
.
PROBS900  PACK      KEY80,SECUREID,SP256
          CALL      RDWBSE7
          IF        OVRCD=1
            REP       LOWUPP,KEY80
            CALL      RDWBSE7
          ENDIF
PROBS999  RETURN
.
HDOBS000  MATCH     "B  ",OBSVTYPE
          GOTO      HDOBS010 IF NOT EQUAL
          WRITE     HTMLFILE;"<tr class=obshead><td>Date/Time</td>":
                              "<td align=right>Temp </td>":
                              "<td align=right>Pulse</td>":
                              "<td align=right>Resp </td>":
                              "<td align=center>BP   </td>":
                              "<td align=right>SaO<sup>2</sup>%</td>":
                              "<td align=right>O<sup>2</sup> Flow</td>":
                              "<td>Signed</td>":
                              "</tr>"
          GOTO      HDOBS999
.
HDOBS010  MATCH     "F  ",OBSVTYPE
          GOTO      HDOBS020 IF NOT EQUAL
          WRITE     HTMLFILE;"<tr class=obshead><td>Date/Time</td>":
                              "<td>Input Type </td>":
                              "<td align=right>Input Volume</td>":
                              "<td>Output Type</td>":
                              "<td align=right>Output Volume   </td>":
                              "<td>Signed</td>":
                              "</tr>"
          GOTO      HDOBS999
.
HDOBS020  MATCH     "N  ",OBSVTYPE
          GOTO      HDOBS999 IF NOT EQUAL
          WRITE     HTMLFILE;"<tr class=obshead><td>Date/Time</td>":
                              "<td align=center>Eyes </td>":
                              "<td align=center>Verbal</td>":
                              "<td align=center>Motor </td>":
                              "<td align=center>GCS   </td>":
                              "<td align=center>Pupil Size L/R</td>":
                              "<td align=center>Pupil React L/R</td>":
                              "<td align=center>Arm L/R</td>":
                              "<td align=center>Leg L/R</td>":
                              "<td>Sign</td>":
                              "</tr>"
HDOBS999  RETURN
.
PRTBAS00  MOVE       OBDEPULS,OUTPPULS
          IF         OBDEPULS=0
            MOVE       SP70,OUTPPULS
          ENDIF
          MOVE       OBDETEMP,OUTPTEMP
          IF         OBDETEMP=0
            MOVE       SP70,OUTPTEMP
          ENDIF
          MOVE       OBDERESP,OUTPRESP
          IF         OBDERESP=0
            MOVE       SP70,OUTPRESP
          ENDIF
          MOVE       OBDEPOX,OUTPPOX
          IF         OBDEPOX=0
            MOVE       SP70,OUTPPOX
          ENDIF
          MOVE       OBDEO2F,OUTPO2F
          IF         OBDEO2F=0
            MOVE       SP70,OUTPO2F
          ENDIF
          PACK       OUTPBP,OBDEBPSY,SLASH,OBDEBPDI,SP70
          IF         OBDEBPDI=0
            MOVE       SP70,OUTPBP  
          ENDIF
.
          WRITE     HTMLFILE;"<tr class=obsline><td nowrap>",CDAY,SP1,MTHNAM3,SP1,CCENT,CYEAR," at ",TIMEHHMM,"</td>":
                              "<td align=right>",OUTPTEMP,"</td>":
                              "<td align=right>",OUTPPULS,"</td>":
                              "<td align=right>",OUTPRESP," </td>":
                              "<td align=center>",OUTPBP,"</td>":
                              "<td align=right>",OUTPPOX,"</td>":
                              "<td align=right>",OUTPO2F,"</td>":
                              "<td nowrap>",WBSENAM,"</td></tr>":
                              "<tr class=obsline><td colspan=8>Comment:",OBDECOM1,OBDECOM2,OBDECOM3,"</td></tr>"
          ADD       ONE,RECNUMB
          RETURN
.
PRTFLU00  MOVE       OBDEFOT,OUTPFOT
          IF         OBDEFOT=0
            MOVE       SP70,OUTPFOT
          ENDIF
.
          MOVE       OBDEFIN,OUTPFIN
          IF         OBDEFIN=0
            MOVE       SP70,OUTPFIN
          ENDIF
.
          MOVE      "wq",CATEGORY
          MOVE      OBDEFOC,CODE
          CALL      GETCOD00
          MOVE      TDESC,FOCDESC
          MOVE      "wr",CATEGORY
          MOVE      OBDEFIC,CODE
          CALL      GETCOD00
          MOVE      TDESC,FICDESC
          WRITE     HTMLFILE;"<tr class=obsline><td nowrap>",CDAY,SP1,MTHNAM3,SP1,CCENT,CYEAR," at ",TIMEHHMM,"</td>":
                              "<td>",FICDESC,"</td>":
                              "<td align=right>",OUTPFIN," ml</td>":
                              "<td>",FOCDESC,"</td>":
                              "<td align=right>",OUTPFOT," ml</td>":
                              "<td nowrap>",WBSENAM,"</td></tr>":
                              "<tr class=obsline><td colspan=6>Comment:",OBDECOM1,OBDECOM2,OBDECOM3,"</td></tr>"
          ADD       ONE,RECNUMB
          RETURN
.
PRTNUR00  MOVE      ZERO,TOTNEURO
          MOVE      ZERO,F1
          MOVE      OBDEEYEO,F1
          ADD       F1,TOTNEURO
          MOVE      ZERO,F1
          MOVE      OBDEVERB,F1
          ADD       F1,TOTNEURO
          MOVE      ZERO,F1
          MOVE      OBDEMOTO,F1
          ADD       F1,TOTNEURO
.
          WRITE     HTMLFILE;"<tr class=obsline><td nowrap>",CDAY,SP1,MTHNAM3,SP1,CCENT,CYEAR," at ",TIMEHHMM,"</td>":
                              "<td align=center>",OBDEEYEO," </td>":
                              "<td align=center>",OBDEVERB,"</td>":
                              "<td align=center>",OBDEMOTO," </td>":
                              "<td align=center>",TOTNEURO,"</td>":
                              "<td align=center>",OBDEPSL,"/",OBDEPSR,"</td>":
                              "<td align=center>",OBDEPRL,"/",OBDEPRR,"</td>":
                              "<td align=center>",OBDELMLA,"/",OBDELMRM,"</td>":
                              "<td align=center>",OBDELMLL,"/",OBDELMRL,"</td>":
                              "<td nowrap>",WBSENAM,"</td></tr>":
                              "<tr class=obsline><td colspan=10>Comment:",OBDECOM1,OBDECOM2,OBDECOM3,"</td></tr>"
          ADD       ONE,RECNUMB
          RETURN
.
.------------------------------------------------------------
. Observation Set Table 
.------------------------------------------------------------
TABA0000  UNPACK    DIM127,DIM1,LINKPRG,DIM127 
          UNPACK    DIM127,DIM1,LINKREP,DIM127 
          UNPACK    DIM127,DIM1,LINKTEM,DIM127 
.
          MOVE      ZERO,FORM3
          PACK      KEY24,ADMISSNO,Z70
          CALL      RSOBDE1
TABA0100  CALL      RPOBDE1
          BRANCH    OVRCD,TABA9000
          MATCH     ADMISSNO,OBDEVIST
          GOTO      TABA9000 IF NOT EQUAL
          MATCH     SP70,OBSVTYPE         * Filter by Type of Observation
          IF        !@EQUAL
            MATCH     OBDETYP,OBSVTYPE
            GOTO      TABA0100 IF NOT EQUAL
          ENDIF
.
          COMPARE   "100",FORM3         * limit the rows output to 100
          GOTO      TABA9000 IF NOT LESS
.
          CALL      CHKABN00    * Check for Abnormal
          CALL      TABROW00    * Output Table Row
          ADD       ONE,FORM3
          GOTO      TABA0100
.
TABA9000  MOVE      ZERO,FORM3
TABA9999  RETURN
.------------------------------------------------------------
. Output Table Row Details
.------------------------------------------------------------
TABROW00  MOVE       OBDEPULS,OUTPPULS
          IF         OBDEPULS=0
            MOVE       SP70,OUTPPULS
          ENDIF
.
          MOVE       OBDETEMP,OUTPTEMP
          IF         OBDETEMP=0
            MOVE       SP70,OUTPTEMP
          ENDIF
.
          MOVE       OBDERESP,OUTPRESP
          IF         OBDERESP=0
            MOVE       SP70,OUTPRESP
          ENDIF
.
          MOVE       OBDEPOX,OUTPPOX
          IF         OBDEPOX=0
            MOVE       SP70,OUTPPOX
          ENDIF
.
          MOVE       OBDEO2F,OUTPO2F
          IF         OBDEO2F=0
            MOVE       SP70,OUTPO2F
          ENDIF
.
          MOVE       OBDEPFL,OUTPPFL
          IF         OBDEPFL=0
            MOVE       SP70,OUTPPFL
          ENDIF
.
          MOVE       OBDEFOT,OUTPFOT
          IF         OBDEFOT=0
            MOVE       SP70,OUTPFOT
          ENDIF
.
          MOVE       OBDEFIN,OUTPFIN
          IF         OBDEFIN=0
            MOVE       SP70,OUTPFIN
          ENDIF
.
          PACK       OUTPBP,OBDEBPSY,SLASH,OBDEBPDI,SP70
          IF         OBDEBPDI=0
            MOVE       SP70,OUTPBP  
          ENDIF
.
          MOVE       OBDETYP,KEY3
          CALL       RDOBTY1
.
          PACK       OBSERKEY,OBDEVIST,OBDEDATE,OBDETIME,SP70
          REP        " +",OBSERKEY
          CLEAR      HTMLLINK  
          APPEND     "javascript:UpdateObs('cliweb02.pbl?reportno=2",HTMLLINK
          APPEND     "&template=",HTMLLINK
          APPEND     OBTYTMUP,HTMLLINK
          APPEND     "&obserkey=",HTMLLINK
          APPEND     OBSERKEY,HTMLLINK
          APPEND     "&admissno=",HTMLLINK
          APPEND     OBDEVIST,HTMLLINK
          APPEND     "')",HTMLLINK
          RESET      HTMLLINK  
.
          MOVE       "ws",CATEGORY
          MOVE       OBDEACT,CODE
          CALL       GETCOD00
          MOVE       TDESC,ACTDESC
.
          MOVE       "wq",CATEGORY
          MOVE       OBDEFOC,CODE
          CALL       GETCOD00
          MOVE       TDESC,FOCDESC
.
          MOVE       "No ",DISPPUPL         * Clear pupil details yes/no
          MATCH      SP70,OBDEPSL
          IF         !@EQUAL
            MOVE       "Yes",DISPPUPL
            GOTO       TABROW30
          ENDIF
.
          MATCH      SP70,OBDEPSR
          IF         !@EQUAL
            MOVE       "Yes",DISPPUPL
            GOTO       TABROW30
          ENDIF
.
          MATCH      SP70,OBDEPRL
          IF         !@EQUAL
            MOVE       "Yes",DISPPUPL
            GOTO       TABROW30
          ENDIF
.
          MATCH      SP70,OBDEPRR
          IF         !@EQUAL
            MOVE       "Yes",DISPPUPL
            GOTO       TABROW30
          ENDIF
.
TABROW30  MOVE       "No ",DISPLIMB
          MATCH      SP70,OBDELMLA
          IF         !@EQUAL
            MOVE       "Yes",DISPLIMB
            GOTO       TABROW40
          ENDIF
.
          MATCH      SP70,OBDELMRM
          IF         !@EQUAL
            MOVE       "Yes",DISPLIMB
            GOTO       TABROW40
          ENDIF
.
          MATCH      SP70,OBDELMLL
          IF         !@EQUAL
            MOVE       "Yes",DISPLIMB
            GOTO       TABROW40
          ENDIF
.
          MATCH      SP70,OBDELMRL
          IF         !@EQUAL
            MOVE       "Yes",DISPLIMB
            GOTO       TABROW40
          ENDIF
.
.                
TABROW40  PACK       KEY10,OBDEUID,SP70          * Last updated by
          CALL       RDWBSE1
          IF         OVRCD=1
            MOVE       SP70,WBSENAM
          ENDIF
.
          MOVE       "wr",CATEGORY
          MOVE       OBDEFIC,CODE
          CALL       GETCOD00
          MOVE       TDESC,FICDESC
.
          MOVE       "&nbsp;&nbsp;",TOTNSTAT
          MOVE       ZERO,TOTNEURO
          MOVE       ZERO,F1
          MOVE       OBDEEYEO,F1
          ADD        F1,TOTNEURO
          MOVE       ZERO,F1
          MOVE       OBDEVERB,F1
          ADD        F1,TOTNEURO
          MOVE       ZERO,F1
          MOVE       OBDEMOTO,F1
          ADD        F1,TOTNEURO
.
          IF        TOTNEURO<>0
            MOVE      TOTNEURO,TOTNSTAT  * Neuro total GCS score, blank of not
          ENDIF                          * neuro obs
.
          IF        OBDEUN4>0
            MOVE      OBDEUN4,PMSVX045
            MOVE      PMSVX045,DISPWGT
            MOVE      PMVXPHGT,DISPHGT
            MOVE      PMVXDHWR,DISPHWD
            IF        PMVXPHGT>0 & PMVXPWGT>0
              ASSIGN    (PMSVX045*PMVXPHGT)/3600,FORM6P2
              MOVE      FORM6P2,DISPBSA
              ASSIGN    PMSVX045/((PMVXPHGT/100)*(PMVXPHGT/100)),FORM6P1
              MOVE      FORM6P1,DISPBMI
            ENDIF
          ENDIF
.
          WRITE     HTMLFILE;"t.addRow(#"",HTMLLINK,"#",":
                             "#"",OBDEDATE,OBDETIME,"#",":  *1
                             "#"",OBTYDESC,"#",":           *2
                             "#"",OBSFLAG,"#",":            *3
                             "#"",OUTPPULS,"#",":           *4
                             "#"",OUTPTEMP,"#",":           *5
                             "#"",OUTPRESP,"#",":           *6
                             "#"",OUTPBP,"#",":             *7
                             "#"",OUTPPOX,"#",":            *8
                             "#"",OUTPO2F,"#",":            *9
                             "#"",OUTPPFL,"#",":            *0
                             "#"",FOCDESC,"#",":            *2
                             "#"",OUTPFOT,"#",":
                             "#"",FICDESC,"#",":
                             "#"",OUTPFIN,"#",":
                             "#"",OBDEEYEO,"#",":
                             "#"",OBDEVERB,"#",":
                             "#"",OBDEMOTO,"#",":
                             "#"",TOTNEURO,"#",":
                             "#"",ACTDESC,"#",":
                             "#"",OBDECOM1,"#",":
                             "#"",DISPPUPL,"#",":
                             "#"",DISPLIMB,"#",":
                             "#"",WBSENAM,"#",":
                             "#"",TOTNSTAT,"#",":
                             "#"",OBTYTYPE,"#",":
                             "#"",OBDEUC1,"#",":
                             "#"",OBDEUC2,"#",":
                             "#"",OBDEUN1,"#",":
                             "#"",OBDEUN2,"#",":
                             "#"",OBDEUN3,"#",":
                             "#"",OBDEUN4,"#",":
                             "#"",OBDEUY1,"#",":
                             "#"",OBDEUY2,"#",":
                             "#"",OBDEUY3,"#",":
                             "#"",OBDEUY4,"#",":
                             "#"",OBDEPNSC,"#",":
                             "#"",OBDECVPS,"#",":
                             "#"",DISPBMI,"#",":
                             "#"",DISPBSA,"#",":
                             "#"",DISPWGT,"#",":
                             "#"",DISPHGT,"#",":
                             "#"",DISPHWD,"#")"

.
TABROW99  RETURN
.------------------------------------------------------------
. Check for Abnormal Obs.
.------------------------------------------------------------
CHKABN00  MOVE      ZERO,OBSFLAG
          IF        PSAGEYRS<16
            GOTO      CHKABN80
          ENDIF
.
          IF        OBDEPULS<>0
            IF        (OBDEPULS<60) | (OBDEPULS>120)
              GOTO      CHKABN90
            ENDIF
          ENDIF
.
          IF        OBDETEMP<>0
            IF        (OBDETEMP<35.5) | (OBDETEMP>38)
              GOTO      CHKABN90
            ENDIF
          ENDIF
.
          IF        OBDERESP<>0
            IF        (OBDERESP<14) | (OBDERESP>26)
              GOTO      CHKABN90
            ENDIF
          ENDIF
.
          IF        OBDEBPSY<>0
            IF        (OBDEBPSY<100) | (OBDEBPSY>160)
              GOTO      CHKABN90
            ENDIF
          ENDIF
.
          IF        OBDEBPDI<>0
            IF        OBDEBPDI>110
              GOTO      CHKABN90
            ENDIF
          ENDIF
.
          IF        OBDEPOX<>0
            IF        OBDEPOX<90
              GOTO      CHKABN90
            ENDIF
          ENDIF
.
          MOVE      ZERO,F2
          MOVE      ZERO,F1
          MOVE      OBDEEYEO,F1
          ADD       F1,F2
.
          MOVE      ZERO,F1
          MOVE      OBDEVERB,F1
          ADD       F1,F2
.
          MOVE      ZERO,F1
          MOVE      OBDEMOTO,F1
          ADD       F1,F2
.
          IF        F2<>0
            IF        F2<13
              GOTO      CHKABN90
            ENDIF
          ENDIF
.
CHKABN80  MOVE      ONE,OBSFLAG
          GOTO      CHKABN99
.
CHKABN90  MOVE      ZERO,OBSFLAG
CHKABN99  RETURN
.------------------------------------------------------------
. Observation Type Select List
.------------------------------------------------------------
SELTYP00  MOVE      SP70,KEY3
          CALL      RSOBTY1
SELTYP10  CALL      RKOBTY1
          BRANCH    OVRCD,TYPSEL99
          MATCH     "1",OBTYACTV
          GOTO      SELTYP10 IF NOT EQUAL
          MATCH     OBTYTYPE,OBDETYP
          IF        @EQUAL
            WRITE     HTMLFILE;"<option value=#"",OBTYTYPE,OBTYTMAD,OBTYTMUP:
                               "#" selected>",OBTYDESC,"</option>"
          ELSE
            WRITE     HTMLFILE;"<option value=#"",OBTYTYPE,OBTYTMAD,OBTYTMUP:
                               "#">",OBTYDESC,"</option>"
          ENDIF
          GOTO      SELTYP10
.
SELTYP99  RETURN
.------------------------------------------------------------
. Observation Details Fields
.------------------------------------------------------------
ODET0000  BRANCH    FLDITMNO,ODET0100,ODET0200,ODET0300,ODET0400,ODET0500:
                             ODET0600,ODET0700,ODET0800,ODET0900,ODET1000:
                             ODET1100,ODET1200,ODET1300,ODET1400,ODET1500:
                             ODET1600,ODET1700,ODET1800,ODET1900,ODET2000:
                             ODET2100,ODET2200,ODET2300,ODET2400,ODET2500:
                             ODET2600,ODET2700,ODET2800,ODET2900,ODET3000:
                             ODET3100,ODET3200,ODET3300,ODET3400,ODET3500:
                             ODET3600,ODET3700,ODET3800,ODET3900,ODET4000:
                             ODET4100,ODET4200,ODET4300,ODET4400,ODET4500:
                             ODET4600
.   
          GOTO      ODET9999
.
ODET0100  MATCH     SP70,OBDEDATE 
          IF        @EQUAL
            PACK      OBDEDATE,CCC,CYY,CMM,CDD
            REP       " 0",OBDEDATE
          ENDIF
          UNPACK    OBDEDATE,CCENT,CYEAR,CMON,CDAY
          MOVE      CMON,F2
          LOAD      MTHNAM3,F2,JAN,FEB,MAR,APR,MAY,JUN,JUL,AUG,SEP,OCT,NOV,DEC
          WRITE     HTMLFILE;CDAY,SP1,MTHNAM3,SP1,CCENT,CYEAR;
          GOTO      ODET9999
.                
ODET0200  MATCH     SP70,OBDETIME
          IF        @EQUAL
            CALL      IBACLOCK
            MOVE      CTIMEIS,OBDETIME
          ENDIF
          WRITE     HTMLFILE;OBDETIME;
          GOTO      ODET9999
.
ODET0300  UNPACK    DIM127,D1,KEY1,DIM127
          MOVE      ZERO,F1
          MOVE      KEY1,F1
          BRANCH    F1,ODET0310,ODET0320
          MATCH     SP70,OBDETYP
          GOTO      ODET9999 IF EQUAL
          MOVE      OBDETYP,KEY3
          CALL      RDOBTY1
          BRANCH    OVRCD,ODET9999
          WRITE     HTMLFILE;OBTYDESC;
          GOTO      ODET9999
.
ODET0310  MATCH     SP70,OBDETYP
          GOTO      ODET9999 IF EQUAL
          WRITE     HTMLFILE;OBDETYP;
          GOTO      ODET9999
.
ODET0320  CALL      SELTYP00
          GOTO      ODET9999
.
ODET0400  WRITE     HTMLFILE;OBDEPULS;
          GOTO      ODET9999
.                
ODET0500  WRITE     HTMLFILE;OBDETEMP;
          GOTO      ODET9999
.                
ODET0600  WRITE     HTMLFILE;OBDEBPSY;
          GOTO      ODET9999
.                
ODET0700  WRITE     HTMLFILE;OBDEBPDI;
          GOTO      ODET9999
.                
ODET0800  WRITE     HTMLFILE;OBDERESP;
          GOTO      ODET9999
.                
ODET0900  WRITE     HTMLFILE;OBDEPOX;
          GOTO      ODET9999
.                
ODET1000  WRITE     HTMLFILE;OBDEO2F;
          GOTO      ODET9999
.                
ODET1100  WRITE     HTMLFILE;OBDEPFL;
          GOTO      ODET9999
.                
ODET1200  MOVE      "wq",CATEGORY
          MOVE      OBDEFOC,CODE
          CALL      CODITM00
          GOTO      ODET9999
.                
ODET1300  MOVE      "wr",CATEGORY
          MOVE      OBDEFIC,CODE
          CALL      CODITM00
          GOTO      ODET9999
.                
ODET1400  WRITE     HTMLFILE;OBDEFOT;
          GOTO      ODET9999
.                
ODET1500  WRITE     HTMLFILE;OBDEFIN;
          GOTO      ODET9999
.                
ODET1600  WRITE     HTMLFILE;OBDEEYEO;
          GOTO      ODET9999
.                
ODET1700  WRITE     HTMLFILE;OBDEVERB;
          GOTO      ODET9999
.                
ODET1800  WRITE     HTMLFILE;OBDEMOTO;
          GOTO      ODET9999
.                
ODET1900  WRITE     HTMLFILE;OBDEPSL;
          GOTO      ODET9999
.                
ODET2000  WRITE     HTMLFILE;OBDEPSR;
          GOTO      ODET9999
.                
ODET2100  WRITE     HTMLFILE;OBDEPRL;
          GOTO      ODET9999
.                
ODET2200  WRITE     HTMLFILE;OBDEPRR;
          GOTO      ODET9999
.                
ODET2300  WRITE     HTMLFILE;OBDELMLA;
          GOTO      ODET9999
.                
ODET2400  WRITE     HTMLFILE;OBDELMRM;
          GOTO      ODET9999
.                
ODET2500  WRITE     HTMLFILE;OBDELMLL;
          GOTO      ODET9999
.                
ODET2600  WRITE     HTMLFILE;OBDELMRL;
          GOTO      ODET9999
.                
ODET2700  MOVE      "ws",CATEGORY
          MOVE      OBDEACT,CODE
          CALL      CODITM00
          GOTO      ODET9999
.
ODET2800  WRITE     HTMLFILE;OBDEUY1;
          GOTO      ODET9999
.
ODET2900  WRITE     HTMLFILE;OBDEUY2;
          GOTO      ODET9999
.
ODET3000  WRITE     HTMLFILE;OBDEUY3;
          GOTO      ODET9999
.
ODET3100  WRITE     HTMLFILE;OBDEUY4;
          GOTO      ODET9999
.                
ODET3200  MOVE      "wt",CATEGORY
          MOVE      OBDEUC1,CODE
          CALL      CODITM00
          GOTO      ODET9999
.
ODET3300  MOVE      "wu",CATEGORY
          MOVE      OBDEUC2,CODE
          CALL      CODITM00
          GOTO      ODET9999
.
ODET3400  WRITE     HTMLFILE;OBDEUN1;
          GOTO      ODET9999
.
ODET3500  WRITE     HTMLFILE;OBDEUN2;
          GOTO      ODET9999
.
ODET3600  WRITE     HTMLFILE;OBDEUN3;
          GOTO      ODET9999
.
ODET3700  WRITE     HTMLFILE;OBDEUN4;
          GOTO      ODET9999
.
ODET3800  WRITE     HTMLFILE;OBDECOM1;
          GOTO      ODET9999
.
ODET3900  WRITE     HTMLFILE;OBDECOM2;
          GOTO      ODET9999
.
ODET4000  WRITE     HTMLFILE;OBDECOM3;
          GOTO      ODET9999
.                
ODET4100  REP       " +",OBSERKEY 
          WRITE     HTMLFILE;OBSERKEY;
          GOTO      ODET9999
.
ODET4200  WRITE     HTMLFILE;OBDEPNSC;               * I CAR 10484
          GOTO      ODET9999
.
ODET4300  WRITE     HTMLFILE;OBDECVPS;               * I CAR 10485
          GOTO      ODET9999
.
ODET4400  WRITE     HTMLFILE;TRIREDIR;               * Triage redirect flag
          GOTO      ODET9999
.
ODET4500  MATCH     PURNO,ZEROUR
          IF        !@EQUAL
            MOVE      PMPXPWEI,F6
          ELSE
            MOVE      OBDEVIST,KEY8
            CALL      RDPMVX11
            IF        OVRCD=0
              MOVE      PMVXPWGT,F6
            ELSE
              MOVE      0,F6
            ENDIF
          ENDIF
          IF        F6=0
            WRITE     HTMLFILE;F6;    * Patient Weight
          ELSE
            MOVE      F6,F6P2
            DIV       "100",F6P2
            WRITE     HTMLFILE;F6P2;        * Patient Weight
          ENDIF
          GOTO      ODET9999
.
ODET4600  MATCH     PURNO,ZEROUR
          IF        !@EQUAL
            WRITE     HTMLFILE;PMPXPHEI
          ELSE
            MOVE      OBDEVIST,KEY8
            CALL      RDPMVX11
            IF        OVRCD=0
              WRITE     HTMLFILE;PMVXPHGT
            ELSE
              WRITE     HTMLFILE;ZERO
            ENDIF
          ENDIF
          GOTO      ODET9999
.
ODET9999  RETURN
.------------------------------------------------------------
. Clear Basic Observation Details
.------------------------------------------------------------
CLOBSDET  MOVE      SP70,OBDEDATE
          MOVE      SP70,OBDETIME
          MOVE      SP70,OBDEVIST 
          MOVE      SP70,OBDETYP
          MOVE      ZERO,OBDEPULS
          MOVE      ZERO,OBDETEMP
          MOVE      ZERO,OBDEBPSY
          MOVE      ZERO,OBDEBPDI
          MOVE      ZERO,OBDERESP
          MOVE      ZERO,OBDEPOX   * Pulse / Oximeter Sa O2             
          MOVE      ZERO,OBDEO2F   * Oxygen Flow Litres per Min         
          MOVE      ZERO,OBDEPFL   * Peak Flow                          
          MOVE      SP70,OBDEFOC   * Fluid Output Type (Cat wq)         
          MOVE      SP70,OBDEFIC   * Fluid Intake Type (Cat wr)         
          MOVE      ZERO,OBDEFOT   * Fluids Output                      
          MOVE      ZERO,OBDEFIN   * Fluid Intake                       
          MOVE      SP70,OBDEEYEO  * Eyes Open                          
          MOVE      SP70,OBDEVERB  * Best Verbal Response               
          MOVE      SP70,OBDEMOTO  * Best Motor Response                
          MOVE      SP70,OBDEPSL   * Pupil Size Left                    
          MOVE      SP70,OBDEPSR   * Pupil Size Right                   
          MOVE      SP70,OBDEPRL   * Pupil Reaction Left                
          MOVE      SP70,OBDEPRR   * Pupil Reaction Right               
          MOVE      SP70,OBDELMLA  * Limb Movement Left Arm             
          MOVE      SP70,OBDELMRM  * Limb Movement Right Arm            
          MOVE      SP70,OBDELMLL  * Limb Movement Left Leg             
          MOVE      SP70,OBDELMRL  * Limb Movement Right Leg            
          MOVE      SP70,OBDEACT   * Action/Comment Code (ws)           
          MOVE      SP70,OBDEUY1   * User Def Y/N 1                     
          MOVE      SP70,OBDEUY2   * User Def Y/N 2                     
          MOVE      SP70,OBDEUY3   * User Def Y/N 3                     
          MOVE      SP70,OBDEUY4   * User Def Y/N 4                     
          MOVE      SP70,OBDEUC1   * User Def Code 1 (wt)               
          MOVE      SP70,OBDEUC2   * User Def Code 2 (wu)               
          MOVE      ZERO,OBDEUN1   * User Def Num 1                     
          MOVE      ZERO,OBDEUN2   * User Def Bum 2                     
          MOVE      ZERO,OBDEUN3   * User Def Num 3                     
          MOVE      ZERO,OBDEUN4   * User Def Num 4                     
          MOVE      SP70,OBDEUID   * Web User ID                        
          MOVE      SP70,OBDEMDAT  * Last Modified Date                 
          MOVE      SP70,OBDEMTIM  * Last Modified Time                 
          MOVE      SP70,OBDECOM1  * Comment 1                          
          MOVE      SP70,OBDECOM2  * Comment 2                          
          MOVE      SP70,OBDECOM3  * Comment 3                          
          MOVE      SP70,OBDEPNSC  * Pain Score (0-10)       * I CAR 10484
          MOVE      SP70,OBDECVPS  * CVP (1-8)               * I CAR 10485
          MOVE      SP70,OBDESPA   * Spare                              
.
          RETURN
.------------------------------------------------------------
. Get Name from Visit Based Tables
.------------------------------------------------------------
GETVIS00  CALL      CLPATMAS
          CALL      CLPMSPX2
          CALL      CLPMSVX1
.
          MOVE      ADMISSNO,KEY8
          CALL      RDVISA1
          BRANCH    OVRCD,GETVIS80
          CALL      RDPMVX11
          MATCH     PVIURNO,ZEROUR
          IF        !@EQUAL
            MOVE      PVIURNO,KEY8
            CALL      RDMAST1
            BRANCH    OVRCD,GETVIS90
            MOVE      PURNO,KEY8
            CALL      RDPMPX21
            IF        OVRCD=1
              CALL      CLPMSPX2
            ENDIF
.
            CALL      IBACLOCK
            IF        PCEASE=1
              MATCH     SP70,PDECDTE
              IF        @EQUAL
                PACK      AGEDATE,CCC,CYY,CMM,CDD    * Today's date
              ELSE
                MOVE      PDECDTE,AGEDATE            * Date of Death
              ENDIF
            ELSE
              PACK      AGEDATE,CCC,CYY,CMM,CDD    * Today's date
            ENDIF
            REP       " 0",AGEDATE
            CALL      CALCAGE
.
            COMPARE   THREE,PVITYPE
            IF        @EQUAL
              PACK      KEY8,PVIBILL,SP70
              CALL      RDMISS1
              BRANCH    OVRCD,GETVIS90
              IF        ASTAT=1|ASTAT=5
                GOTO      GETVIS90
              ENDIF
            ENDIF
.
            MOVE      ZERO,EXIT
            GOTO      GETVIS99
          ENDIF
          BRANCH    PVITYPE,GETVIS10,GETVIS20,GETVIS20
          MOVE      ONE,EXIT
          GOTO      GETVIS99
.
GETVIS10  BRANCH    EMRFLAG,GETVIS90
          MOVE      PVIBILL,KEY8
          CALL      RDEMUNK1
          BRANCH    OVRCD,GETVIS90
          MOVE      SP70,PTITL
          MOVE      EMUNSNAM,PSNAME
          MOVE      EMUNGNAM,PGNAME
          MOVE      EMUNBDAT,PBDATE
          MOVE      EMUNSEX,PSEX
          MOVE      EMUNAGE,PSAGE
          MATCH     SP70,PSNAME
          IF        @EQUAL
            MOVE     EMUNDET1,PSNAME
          ENDIF
          MATCH     SP70,PGNAME
          IF        @EQUAL
            MOVE     EMUNDET2,PGNAME
          ENDIF
.
          MOVE      ZERO,EXIT
          GOTO      GETVIS99
.
GETVIS20  MOVE      PVIBILL,KEY8
          CALL      RDPRAM1
          BRANCH    OVRCD,GETVIS90
          MOVE      ZERO,EXIT
          GOTO      GETVIS99
.
GETVIS30  MOVE      PVIBILL,KEY8
          CALL      RDPRAM1
          BRANCH    OVRCD,GETVIS90
          MOVE      ZERO,EXIT
          GOTO      GETVIS99
.
GETVIS80  MOVE      ADMISSNO,KEY8
          CALL      RDPRAM1
          BRANCH    OVRCD,GETVIS85
          MOVE      ZERO,EXIT
          GOTO      GETVIS99
.
GETVIS85  BRANCH    EMRFLAG,GETVIS90
          MOVE      ADMISSNO,KEY8
          CALL      RDEMUNK1
          BRANCH    OVRCD,GETVIS90
          MOVE      SP70,PTITL
          MOVE      EMUNSNAM,PSNAME
          MOVE      EMUNGNAM,PGNAME
          MOVE      EMUNBDAT,PBDATE
          MOVE      EMUNSEX,PSEX
          MOVE      EMUNAGE,PSAGE
          MATCH     SP70,PSNAME
          IF        @EQUAL
            MOVE     EMUNDET1,PSNAME
          ENDIF
          MATCH     SP70,PGNAME
          IF        @EQUAL
            MOVE     EMUNDET2,PGNAME
          ENDIF
.
          COMPARE   ONE,IBCNMHOS                 * If multi hospital
          GOTO      GETVIS87 IF NOT EQUAL        * and a ZERO U/R ED visit
.
          PACK      KEY8,ADMISSNO,SP70
          CALL      RDEMVIS1                     * Read ED visit to get site
          BRANCH    OVRCD,GETVIS87
.
          PACK      KEY3,EMVISITE,SP70
          CALL      RDEMSIT1                     * Read site to get hospital
          BRANCH    OVRCD,GETVIS87               * for visti extn file write
.
          MOVE      EMSTHSNO,PMVXMHOS
.
GETVIS87  MOVE      ZERO,EXIT
          GOTO      GETVIS99
.
GETVIS90  MOVE      "Invalid Visit Number",WEBTITLE
          CALL      WEBERR00 
          MOVE      ONE,EXIT
.
GETVIS99  RETURN
.------------------------------------------------------------
.  Next Page                               Called by MAIN0000
.------------------------------------------------------------
NXTPG000  IF        NEXTPAGE=1
            CALL      WINCLS00              * Refresh parent and close window
          ENDIF
.
          IF        NEXTPAGE=2
              CALL      RDIREC00            * redirect page to REDIRECT
          ENDIF
.
          IF        NEXTPAGE=3
              CALL      PARDIR00            * redirect parent to REDIRECT
          ENDIF
.
NXTPG999  RETURN
.--------------------------------------------------------------------------
. Observation Type Maintenance
.--------------------------------------------------------------------------
TYPE0000  BRANCH    FLDITMNO,TYPE0100,TYPE0200,TYPE0300,TYPE0400,TYPE0500: 
                             TYPE0600,TYPE0700,TYPE0800,TYPE0900
.
TYPE0100  CALL      TYTAB000  * Display table of Types 
          GOTO      TYPE9999
.
TYPE0200  MATCH     SP70,OBTYTYPE 
          GOTO      TYPE9999 IF EQUAL
          WRITE     HTMLFILE;OBTYTYPE;
          GOTO      TYPE9999
.
TYPE0300  MATCH     SP70,OBTYDESC
          GOTO      TYPE9999 IF EQUAL
          WRITE     HTMLFILE;OBTYDESC;
          GOTO      TYPE9999
.
TYPE0400  MATCH     SP70,OBTYTMAD
          GOTO      TYPE9999 IF EQUAL
          WRITE     HTMLFILE;OBTYTMAD;
          GOTO      TYPE9999
.
TYPE0500  MATCH     SP70,OBTYTMUP 
          GOTO      TYPE9999 IF EQUAL
          WRITE     HTMLFILE;OBTYTMUP;
          GOTO      TYPE9999
.
TYPE0600  MATCH     SP70,OBTYACTV
          GOTO      TYPE9999 IF EQUAL
          WRITE     HTMLFILE;OBTYACTV;
          GOTO      TYPE9999
.
TYPE0700  
          GOTO      TYPE9999
.
TYPE0800  CALL      NXTTYP00
          GOTO      TYPE9999
.
TYPE0900  CALL      PRETYP00
          GOTO      TYPE9999
.
TYPE9999  RETURN
.------------------------------------------------------------
. Link to Next set 
.------------------------------------------------------------
NXTTYP00  MOVE      NORECORD,KEY2
          REP       " +",KEY2
          ASSIGN    STARTNUM+NORECORD,F3
          MOVE      F3,KEY3
          REP       " +",KEY3
.
          WRITE     HTMLFILE;"cliweb02.pbl":
                                 "?reportno=1":
                                 "&template=1":
                                 "&startnum=",KEY3:
                                 "&norecord=",KEY2;
.
          RETURN
.-------------------------------------------------------------------------------
. Link to previous set of Clinical Notes 
.-------------------------------------------------------------------------------
PRETYP00  MOVE      NORECORD,KEY2
          REP       " +",KEY2
          ASSIGN    STARTNUM-NORECORD,F3
          IF        F3<0
            MOVE    ZERO,F3
          ENDIF
          MOVE      F3,KEY3
          REP       " +",KEY3
.
          WRITE     HTMLFILE;"emrweb05.pbl":
                                 "?reportno=1":
                                 "&template=1":
                                 "&startnum=",KEY3:
                                 "&norecord=",KEY2;
.
          RETURN
.---------------------------------------------------------------------
. Display Table of Types
.---------------------------------------------------------------------          
TYTAB000  UNPACK    DIM127,D1,LINKPRG,DIM127
          UNPACK    DIM127,D1,LINKREP,DIM127
          UNPACK    DIM127,D1,LINKTEM,DIM127
.
          CALL      TYHED000      * Output Table Heading
.
          IF        NORECORD=0
            MOVE      PTCNNRTD,NORECORD      * Set Default No Records to Display
          ENDIF
          MOVE      ZERO,RECNUMB
          MOVE      ZERO,DISNUMB
.
          PACK      KEY3,STARTKEY,SP3
          CALL      RSOBTY1                 * Positional Read
          IF        OVRCD=0
            CALL      RPOBTY1
          ENDIF
TYTAB100  CALL      RKOBTY1                 * Sequential Read
          BRANCH    OVRCD,TYTAB900
.
          ADD       ONE,RECNUMB
          IF        STARTNUM>=RECNUMB
            GOTO      TYTAB100
          ENDIF
.
          CALL      NROWA000      * Display Note Type Row
          ADD       ONE,DISNUMB
          COMPARE   NORECORD,DISNUMB
          GOTO      TYTAB100 IF NOT EQUAL
          GOTO      TYTAB999
.
TYTAB900  CALL      NOMORE00      * Display No More Records Message
.
TYTAB999  RETURN
.------------------------------------------------------------
. Type Maintenance (TABLE HEADING)
.------------------------------------------------------------
TYHED000  WRITE     HTMLFILE;"<tr>":
                               "<td class=HeadingCell width=20%>Type</td>":
                               "<td class=HeadingCell width=40%>":
                               "Description</td>":
                               "<td class=HeadingCell >":
                               "Active</td>":
                             "</tr>"
.
TYHED999  RETURN
.------------------------------------------------------------
. Type Maintenance (TABLE ROW)
.------------------------------------------------------------
NROWA000  MOVE      "No ",ACTIVE
          MATCH     "1",OBTYACTV
          IF        @EQUAL
            MOVE      "Yes",ACTIVE
          ENDIF
          WRITE     HTMLFILE;"<tr><td nowrap><a href='javascript:EditType":
                             "(#"",LINKPRG,"#.pbl":
                             "?reportno=",LINKREP:
                             "&template=",LINKTEM:
                             "&obstyp01=",OBTYTYPE,"#")'>":
                             "<img src=../images/MaintenanceIcon.gif hspace=4":
                             " border=0 align=absmiddle></a>":
                             OBTYTYPE,"</td>":
                             "<td>",OBTYDESC,"</td>":
                             "<td>",ACTIVE,"</td>":
                             "</tr>"
.
NROWA999 RETURN
.------------------------------------------------------------
. Observation Type Maintenance
.------------------------------------------------------------
OBSTYP00  RESET     UPDTTYPE
          MATCH     SP70,UPDTTYPE
          GOTO      OBSTYP40 IF EQUAL
.
          MATCH     "A",UPDTTYPE           * Add Formaction
          GOTO      OBSTYP10 IF EQUAL
.
          MATCH     "U",UPDTTYPE           * Update Formaction
          GOTO      OBSTYP20 IF EQUAL
.
          MATCH     "D",UPDTTYPE           * Delete Formaction
          GOTO      OBSTYP30 IF EQUAL
.
          GOTO      OBSTYP93
.
.         ************ ADD FORMACTION ***********
.
OBSTYP10  CALL      CHKTYP00    * Checks mandatory fields and for blanks
          BRANCH    EXIT,OBSTYP99
          PACK      KEY3,OBSTYP01,SP70
          CALL      RDOBTY1     * Check if Note already exists
          COMPARE   ZERO,OVRCD
          GOTO      OBSTYP92 IF EQUAL
          CALL      ADDTYP00              * Add New Type of Note SubRoutine
.
          MOVE      ZERO,EXIT
          GOTO      OBSTYP99
.
.         ************ UPDATE FORMACTION **********
.
OBSTYP20  CALL      CHKTYP00    * Checks mandatory fields and for blanks
          BRANCH    EXIT,OBSTYP99
          PACK      KEY3,OBSTYP01,SP70
          CALL      RDOBTY1     * Check if Note already exists
          BRANCH    OVRCD,OBSTYP90
          CALL      UPDTYP00              * Update Type of Note SubRoutine
.
          MOVE      ZERO,EXIT
          GOTO      OBSTYP99
.
.         ************ DELETE FORMACTION **********
.
OBSTYP30  CALL      DELTYP00              * Delete Type of Note SubRoutine
.
          MOVE      ZERO,EXIT
          GOTO      OBSTYP99
.
.         ************ DISPLAY FORMACTION **********
.
OBSTYP40  PACK      KEY3,OBSTYP01,SP70
          CALL      RDOBTY1
          IF        OVRCD=1
            CALL      CLRTYP00     * Clear all the file variables
          ENDIF
.
          CLEAR     WEBTITLE
          MOVE      "Observation Type Maintenance",WEBTITLE
          RESET     WEBTITLE
.
          CALL      WEBHED00   * Create Output File and Write HTML Page Header
          BRANCH    EXIT,OBSTYP99
          CALL      WEBBOD00                * Process Web Body
          CALL      WEBEND00                * Process End of HTML File
          MOVE      ONE,EXIT
          GOTO      OBSTYP99
.
OBSTYP90  MOVE      "Record Does Not Exist",WEBTITLE
          CALL      WEBERR00
          MOVE      ONE,EXIT
          GOTO      OBSTYP99
.
OBSTYP92  MOVE      "Record exists",WEBTITLE
          CALL      WEBERR00
          MOVE      ONE,EXIT
          GOTO      OBSTYP99
.
OBSTYP93  MOVE      "Invalid Form Action.",WEBTITLE
          CALL      WEBERR00
          MOVE      ONE,EXIT
          GOTO      OBSTYP99
.
OBSTYP99  RETURN
.-----------------------------------------------------------
. * Checks mandatory fields
.------------------------------------------------------------
CHKTYP00  RESET     OBSTYP01 
          MATCH     SP70,OBSTYP01
          GOTO      CHKTYP90 IF EQUAL
. 
          RESET     OBSTYP02
          MATCH     SP70,OBSTYP02
          GOTO      CHKTYP91 IF EQUAL
.
          MOVE      "CLIWEB0202",KEY10
          PACK      KEY13,KEY10,OBSTYP03
          CALL      RDWBTP1
          BRANCH    OVRCD,CHKTYP92
.
          PACK      KEY13,KEY10,OBSTYP04
          CALL      RDWBTP1
          BRANCH    OVRCD,CHKTYP93
.
          MOVE      ZERO,EXIT
          GOTO      CHKTYP99
.
CHKTYP90  MOVE      "Type Code Mandatory.",WEBTITLE
          CALL      WEBERR00
          MOVE      ONE,EXIT
          GOTO      CHKTYP99
.
CHKTYP91  MOVE      "Type Description Mandatory.",WEBTITLE
          CALL      WEBERR00
          MOVE      ONE,EXIT
          GOTO      CHKTYP99
.
CHKTYP92  MOVE      "Add Business Server Page Invalid.",WEBTITLE
          CALL      WEBERR00
          MOVE      ONE,EXIT
          GOTO      CHKTYP99
.
CHKTYP93  MOVE      "Update Business Server Page Invalid.",WEBTITLE
          CALL      WEBERR00
          MOVE      ONE,EXIT
          GOTO      CHKTYP99
.
CHKTYP99  RETURN
.
CLRTYP00  MOVE      SP70,OBTYTYPE
          MOVE      SP70,OBTYDESC
          MOVE      SP70,OBTYTMAD
          MOVE      SP70,OBTYTMUP
          MOVE      SP70,OBTYACTV
          MOVE      SP70,OBTYSPAR
          RETURN
.--------------------------------------------------------------------------
. Add New Type
.--------------------------------------------------------------------------
ADDTYP00  MOVE      OBSTYP01,KEY3
          CALL      RDOBTY1
          IF        OVRCD=1
            MOVE      OBSTYP01,OBTYTYPE
            MOVE      OBSTYP02,OBTYDESC
            MOVE      OBSTYP03,OBTYTMAD
            MOVE      OBSTYP04,OBTYTMUP
            MOVE      OBSTYP05,OBTYACTV
            MOVE      SP70,OBTYSPAR
            CALL      WROBTY1
          ENDIF
.--------------------------------------------------------------------------
. Update New Type
.--------------------------------------------------------------------------
UPDTYP00  MOVE      OBSTYP01,KEY3
          CALL      RDOBTY1
          IF        OVRCD=0
            MOVE      OBSTYP02,OBTYDESC
            MOVE      OBSTYP03,OBTYTMAD
            MOVE      OBSTYP04,OBTYTMUP
            MOVE      OBSTYP05,OBTYACTV
            MOVE      SP70,OBTYSPAR
            CALL      UPOBTY1
          ENDIF
          RETURN
.--------------------------------------------------------------------------
. Delete New Type
.--------------------------------------------------------------------------
DELTYP00  MOVE      OBSTYP01,KEY3
          CALL      RDOBTY1
          IF        OVRCD=0
            CALL      DEOBTY1
          ENDIF
          RETURN
.
.------------------------------------------------------------
.         PARDIR00
.------------------------------------------------------------
PARDIR00  CALL      OPENHTML
          BRANCH    EXIT,PARDIR90
.
          WRITE     HTMLFILE;"<script type=#"text/javascript#"> {":
                             " parent.location.href=#"",REDIRECT,"#";":
                             "}":
                             "</script>"
          CALL      CLOSHTML
          GOTO      PARDIR99
.
PARDIR90  DISPLAY   "*** Fifo Not Found ***"
.
PARDIR99  RETURN
.
.------------------------------------------------------------
.         INTM0000 - Increment the time by 1 second
.------------------------------------------------------------
INTM0000  UNPACK    OBDETIME,CHOUR,DIM1,CMIN,DIM1,CSEC
INTM1000  MOVE      CHOUR,IHOUR
          MOVE      CMIN,IMIN
          MOVE      CSEC,ISEC
          IF        ISEC=59
            IF        IMIN=59
              IF        IHOUR=23
                UNPACK    OBDEDATE,CCENT,CYEAR,CMON,CDAY
                MOVE      CCENT,CC
                MOVE      CYEAR,YY
                MOVE      CMON,MM
                MOVE      CDAY,DD
.
                CALL      DMYCON              * Convert to julian format
.
                ADD       ONE,JULDAY          * Add 1 day
                MOVE      JULDAY,JWKDAY
                MOVE      JULYR,JWKYER
                MOVE      JULCC,JWKCC
.
                CALL      JULCON              * Convert back to DDMMYY format
.
                PACK      OBDEDATE,CC,YY,MM,DD    * Effective date + 1 day
.
                MOVE      ZERO,ISEC
                MOVE      ZERO,IMIN
                MOVE      ZERO,IHOUR          * Start of next day
                GOTO      INTM2000
              ENDIF
            ENDIF
          ENDIF
.
          IF        ISEC=59
            IF        IMIN=59
              ADD       ONE,IHOUR           * Increment the hour
              MOVE      ZERO,IMIN
              MOVE      ZERO,ISEC
              GOTO      INTM2000
            ENDIF
          ENDIF
.
          IF        ISEC=59
            ADD       ONE,IMIN              * Increment the minute
            MOVE      ZERO,ISEC
            GOTO      INTM2000
          ENDIF
.
          ADD       ONE,ISEC
.
INTM2000  PACK      OBDETIME,IHOUR,COLON,IMIN,COLON,ISEC
.
          REP       " 0",OBDEDATE
          REP       " 0",OBDETIME
.
INTM9999  RETURN
+
.------------------------------------------------------------
. NOMORE00 - Display "No more records" at end of list
.------------------------------------------------------------
NOMORE00  WRITE     HTMLFILE;"<tr>":
                             "<td class=RedCell colspan=20 align=center>":
                             "No more records</td>"
.
NOMORE99  RETURN
.
.------------------------------------------------------------
          INC       IBAWEBCD
          INC       APSMASIO/INC
          INC       EMRSITIO/INC
          INC       EMRUNKIO/INC
          INC       EMRVISIO/INC
          INC       OBSDETIO/INC
          INC       OBSTYPIO/INC
          INC       PMSUCHIO/INC
          INC       PMSUCDIO/INC
          INC       PATMA1IO/INC
          INC       PMSHCPIO/INC
          INC       PMSHCGIO/INC
          INC       PATATRTM
          INC       PMSHCPTM
          INC       PMSHCGTM
          INC       PMSPX2IO/INC
          INC       PMSVX1IO/INC
          INC       PMSVX1TM    
          INC       PATHSPIO/INC
          INC       PATIN1IO/INC
          INC       PATMI1IO/INC
          INC       PATPR1IO/INC
          INC       PATVISIO/INC
          INC       CLPATMAS
          INC       CLPMSVX1
          INC       CLPATATR
          INC       CALCAGE
          INC       DAYOFWEK
          INC       NAMSTRCD
          INC       PATDOCCD
.
          INC       PATALRIO/INC      * Patient Alerts Code File IO
          INC       PATATRIO/INC
          INC       RESLNKIO/INC
          INC       PATWR1IO/INC
          INC       OUTSITIO/INC      * Outpatient Site File
          INC       PATDO1IO/INC
          INC       PATFN1IO/INC
          INC       PMSCCDIO/INC            * Concession Card Details
.
          INC       MRTMASIO/INC
          INC       NHIMASIO/INC
          INC       NHIETHIO/INC
          INC       CALCBMIN
          INC       CLNHIMAS  
          INC       PATMASTM
          INC       CLPMSPX2
          INC       PMSPX2TM
          INC       PATMSXTM
          INC       PATDOCTM
.
         
