.-------------------------------------------------------
          INC       STDGENDF     * Required Include
.
VERSION   INIT      "V12.01.00"
.-------------------------------------------------------
. V10.02.01 19.05.2011 Sandra Barcham   239574
.           New printer/department table mods
.-------------------------------------------------------
. V9.04.01  19.04.2005 Peter Vela CAR 59696
.           Recompiled for SINTMPDF
. V9.03.01  10.09.2003 Steve Downing (VF.11.01 CAR 9375)
.           Recompiled for SINREBFD & SINREBIO
.-------------------------------------------------------
. V9.02.00  03.05.2002  Glenn Saunders
.           Export to new release i.e. v9.02 from vf.09
.-------------------------------------------------------
. VF.09.B03 22.02.2001 Sandra Barcham
.           Catalog not appearing in download file
.           srf 8966
. VF.09.B02 16.11.2000 Charles Handaya
.           Modification of Warehouse Security
. VF.09.B01 06.11.2000 Sandra Barcham
.           Changed write to ibaspolf
.-------------------------------------------------------
. VF.01.03  30.10.2000 Sandra Barcham
.           Recompiled for IBACODIO & IBAPRNIO
. VF.01.02  03.10.2000 Charles Handaya
.           Space line added in between records on the report
. VF.01.01  13.07.2000 Charles Handaya
.           Omnicell import file - new field Restock ID on Report
.           Quote 9817
.-------------------------------------------------------
. VF.00.03  06.01.2000 Charles Handaya
.           Add Total Cost calculation to show the
.           correct amount for Requisition Type other
.           than B, I, R, and T. (related to SRF 623982)
.           22.12.1999 Charles Handaya
.           Recompiled for Fixing Audit Date (CCYYMMDD)
. VF.00.02  28.05.1999 Sandra Barcham
.           Changed fixed length to 135 of export file
. VF.00.01  28.05.1999 Sandra Barcham
.           Add century to write of ibaspolf
.-------------------------------------------------------
EMPTYREC   FORM   1
ENDREQ     DIM    5
ENDWAR     DIM    5
FORM5      FORM   5
FORM5A     FORM   5
FORM5B     FORM   5
FORM5P2    FORM   5.2
FORM12P6   FORM   12.6
REPTDESC   DIM    7
REPTDSC1   INIT   "Normal "
REPTDSC2   INIT   "Imprest"
REPTTYPE   FORM   1
REQTYPE    DIM    1
RSTBFLAG   FORM   1
RSTIFLAG   FORM   1
RSTNFLAG   FORM   1
TOTAL      FORM   6.2
SKPRESET   FORM   1
STRREQ     DIM    1
STRWAR     DIM    5
EXPORTFN   DIM    8
.
EXPORTFL   FILE   ASCII, FIXED=135
.
EXPCST     DIM    5       1      Cost Centre
EXPLOC     DIM    20      6      Location
EXPWAR     DIM    5       26     Warehouse
EXPRAS     DIM    8       31     Rack & Shelf
EXPCAT     DIM    7       39     Catalog
EXPDES     DIM    60      46     Description
EXPISS     DIM    15      106    Issue Units
EXPRTY     DIM    1       121    Req Type
EXPRNO     DIM    7       122    Req Number
EXPIQT     FORM   6       129    Quantity to Issue
.
.                         135
.
.-------------------------------------------------------
.@@@@@ Start of Generated Code @@@@@
. NB - Code & Comments Included Before the above line 
.      will not be overwritten by the generation of a 
.      program. The STDGENDF file and VERSION must appear
.      before the line. 
.-----------------------------------------
.   Program       :   IBASIN43
.   Function      :   Print Picking Sheets                    
.   Generated  On :   19/05/2011
.-----------------------------------------
.=========================
.File Description Includes
.-------------------------
          INC       IBAPRNFD/INC
          INC       SINBPSFD/INC
          INC       SINCCAFD/INC
          INC       SINCIAFD/INC
          INC       SINCICFD/INC
          INC       SINCIEFD/INC
          INC       SINCODFD/INC
          INC       SINCONFD/INC
          INC       SINIPSFD/INC
          INC       SINNATFD/INC
          INC       SINPRQFD/INC
          INC       SINREAFD/INC
          INC       SINREBFD/INC
          INC       SINTMPDF/INC
          INC       SINWARFD/INC
          INC       SINWSEFD/INC
.=========================
.Local Variable Definition
.-------------------------
RESETFLG  FORM      1 * Scr 00 Fld     6
FROMWAR   DIM      46 * Scr 01 Fld     4
TOWAR     DIM      46 * Scr 01 Fld     5
FROMCOS   DIM      46 * Scr 01 Fld     6
TOCOS     DIM      46 * Scr 01 Fld     7
FROMREQ   DIM      32 * Scr 01 Fld     8
TOREQ     DIM      32 * Scr 01 Fld     9
EXPORTYN  FORM      1 * Scr 01 Fld    16
REPTDTYP  DIM       1 * Scr 02 Fld    13
IMPAGDEL  FORM      1 * Scr 02 Fld    14
.
ACCEPT    FORM      1
SACCEPT   FORM      1
.
PRGID     INIT      "IBASIN43"
PRGNAM    INIT      "Print Picking Sheets                    "
.
.--------------------------------
. MAINLINE - Controlling Logic
.--------------------------------
          TOPIC     PRGID
          MOVE      PORT,PARENTID
          CLOCK     PORT,DIM2
          MOVE      DIM2,PORT
ML0000
          CALL      INIT0000
          CALL      SELPRT00
          CALL      SC00L000
          CHAIN     PGM
.---------------------------------------
. INIT - Open Files & Display Heading
.---------------------------------------
INIT0000  CALL      DISPHEAD
          MOVE      ONE,CCENTRY
          MOVE      ONE,CCANLDTE
          MOVE      ONE,CDEFDTE
          MOVE      ZERO,CHIGHLT
          DISPLAY   *P56:24,"Opening controlf";
          OPEN      CONTROLF,"controlf"
          DISPLAY   *P56:24,"Opening scrsbga1";
          OPEN      SCRSBGA1,"scrsbgaf"
          DISPLAY   *P56:24,"Opening scrpsta1";
          OPEN      SCRPSTA1,"scrpstaf"
          DISPLAY   *P56:24,"Opening scrpsta1";
          OPEN      SCRPSTA2,"scrpstaf"
          DISPLAY   *P56:24,"Opening scrslta1";
          OPEN      SCRSLTA1,"scrsltaf"
          DISPLAY   *P56:24,"Opening sinbpsaf";
          OPEN      SINBPSA1,"sinbpsaf"
          DISPLAY   *P56:24,"Opening sinccaaf";
          OPEN      SINCCAA1,"sinccaaf"
          DISPLAY   *P56:24,"Opening sinciaaf";
          OPEN      SINCIAA1,"sinciaaf"
          DISPLAY   *P56:24,"Opening sincicaf";
          OPEN      SINCICA1,"sincicaf"
          DISPLAY   *P56:24,"Opening sincicaf";
          OPEN      SINCICA4,"sincicaf"
          DISPLAY   *P56:24,"Opening sincieaf";
          OPEN      SINCIEA1,"sincieaf"
          DISPLAY   *P56:24,"Opening sincieaf";
          OPEN      SINCIEA2,"sincieaf"
          DISPLAY   *P56:24,"Opening sincodaf";
          OPEN      SINCODA1,"sincodaf"
          DISPLAY   *P56:24,"Opening  sinipsaf           ";
          OPEN      SINIPSA1,"sinipsaf"          
          DISPLAY   *P56:24,"Opening  sinipsaf           ";
          OPEN      SINIPSA2,"sinipsaf"          
          DISPLAY   *P56:24,"Opening sinprqaf";
          OPEN      SINPRQA1,"sinprqaf"
          DISPLAY   *P56:24,"Opening sinreaaf";
          OPEN      SINREAA1,"sinreaaf"
          DISPLAY   *P56:24,"Opening sinreaaf";
          OPEN      SINREAA4,"sinreaaf"
          DISPLAY   *P56:24,"Opening sinrebaf";
          OPEN      SINREBA1,"sinrebaf"
          DISPLAY   *P56:24,"Opening sinwaraf";
          OPEN      SINWARA1,"sinwaraf"
          DISPLAY   *P56:24,"Opening sinwaraf";
          OPEN      SINWARA2,"sinwaraf"
          DISPLAY   *P56:24,"Opening sinwseaf";
          OPEN      SINWSEA1,"sinwseaf"
          DISPLAY   *P56:24,"Opening sinwseaf";
          OPEN      SINWSEA2,"sinwseaf"
INIT9999  DISPLAY   *P1:24,*EL;
          RETURN
.
.------------------------------------
. Called for Print Screen Routine 
.------------------------------------
PRTSVARS
          MATCH     "00",SCRID
          IF         @EQUAL
            CALL       PS00L000   * Main Screen                        
          ENDIF
          MATCH     "01",SCRID
          IF         @EQUAL
            CALL       PS01L000   * Normal Picking Sheets              
          ENDIF
          MATCH     "02",SCRID
          IF         @EQUAL
            CALL       PS02L000   * Imprest                            
          ENDIF
          MATCH     "03",SCRID
          IF         @EQUAL
            CALL       PS03L000   * Back Order Picking Sheets          
          ENDIF
          MATCH     "04",SCRID
          IF         @EQUAL
            CALL       PS04L000   * All Requisitions                   
          ENDIF
          RETURN
.--------------------------------
. Screen - Main Screen                        
.--------------------------------
SC00L000
SC00L100
          MOVE      "00",SCRID
          MOVE      ZERO,PRCOL
          MOVE      ZERO,PRVERT
          MOVE      "    1",FLDID
          CALL      GETPOSIT
          IF        EXIT=0
            MOVE     SCPSCOL,PRCOL
            MOVE     SCPSROW,PRVERT
          ENDIF
          CALL      SBACK000 * Display Background
.
SC00L200
          CALL      CF00L000 * Clear Fields
          CALL      ONAT0000
SC00L300
          CALL      KY00L000 * Enter Key Fields
          BRANCH    EXIT,SC00L999,SC00L999
SC00L400
          CALL      WP00L000 * Load any WP Details
SC00L500
          CALL      LM00L000 * Load any Batch Details
SC00L600
          CALL      DF00L000 * Display Fields
SC00L700
          CALL      SF00L000 * Select Fields
          BRANCH    EXIT,SC00L100,SC00L100,SC00L200
SC00L800
SC00L900
SC00L999  RETURN
.--------------------------------------------------------
. Clear Fields for Screen : Main Screen                        
.-------------------------------------------------------
CF00L000
          MOVE      ZERO,RESETFLG
CF00L999  RETURN
.--------------------------------------------------------
. Enter Key Fields for Main Screen                        
.--------------------------------------------------------
KY00L000
          MOVE      ZERO,EXIT
          GOTO      KY00L999
.
KY00L900  MOVE      ONE,EXIT
KY00L999  RETURN
.---------------------------------------------------------
. Load WP files for : Main Screen                        
.---------------------------------------------------------
WP00L000
          RETURN
.---------------------------------------------------------
. Load Batch Screen for : Main Screen                        
.---------------------------------------------------------
LM00L000
          RETURN
.---------------------------------------------------------
. Display Fields for : Main Screen                        
.---------------------------------------------------------
DF00L000
          BRANCH   ACCEPT,DF00L999
          PACK     KEY15,PRGID,SCRID,SP70
          CALL     RSSCPS1
DF00L010
          CALL     RKSCPS1
          BRANCH   OVRCD,DF00L900
          MATCH    PRGID,SCPSPID
          GOTO     DF00L900 IF NOT EQUAL
          MATCH    SCRID,SCPSSID
          GOTO     DF00L900 IF NOT EQUAL
          MATCH    SP70,SCPSMTY
          GOTO     DF00L010 IF NOT EQUAL
.
          CALL     PS00L000 * Display Field
          GOTO     DF00L010
DF00L900
DF00L999
          RETURN
.---------------------------------------------------------
. Display/Print Fields for : Main Screen                        
.---------------------------------------------------------
PS00L000   PACK      VAR,SP70,SP70
          PACK     PRINTVAR,SP70,SP70
          MOVE     SCPSITM,FIELDNO
          BRANCH    FIELDNO,PS00L999,PS00L999,PS00L999,PS00L999:
                            PS00L999,PS00L101,PS00L999,PS00L999
          GOTO     PS00L999
.
PS00L101
          MOVE      RESETFLG,VAR     
          CALL      DISPITEM
          GOTO     PS00L999
PS00L999
          RETURN
.---------------------------------------------------------
. Selections for : Main Screen                        
.---------------------------------------------------------
SF00L000  PACK     KEY13,PRGID,SCRID,SP70
          CALL     RSSCSL1
SF00L001  BRANCH   ACCEPT,SF00L020
.
SF00L005  CALL     MTSTQ000
          MOVE     SCSLITM,FIELDNO
          BRANCH    FIELDNO,SF00L006,SF00L101,SF00L102,SF00L103:
                            SF00L104,SF00L006,SF00L105,SF00L106
SF00L006  BEEP
          GOTO     SF00L005
SF00L020  CALL     RKSCSL1
          BRANCH   OVRCD,SF00L090
          MATCH    PRGID,SCSLPID
          GOTO     SF00L090 IF NOT EQUAL
          MATCH    SCRID,SCSLSID
          GOTO     SF00L090 IF NOT EQUAL
          MOVE     SCSLITM,FIELDNO
          BRANCH    FIELDNO,SF00L020,SF00L020,SF00L020,SF00L020:
                            SF00L020,SF00L020,SF00L020,SF00L020
          GOTO     SF00L020
SF00L090  MOVE     ZERO,ACCEPT
          GOTO     SF00L001
.
SF00L101
          MOVE      ZERO,EXIT
          GOTO      SF00L999
.
SF00L102
          CALL      SC01L000
          MOVE      ONE,EXIT
          GOTO      SF00L999
.
SF00L103
          CALL      SC02L000
          MOVE      ONE,EXIT
          GOTO      SF00L999
.
SF00L104
          CALL      SC03L000
          MOVE      ONE,EXIT
          GOTO      SF00L999
.
SF00L105
          CALL      ALIGN000
          MOVE      ONE,EXIT
          GOTO      SF00L999
.
SF00L106
          CALL      SC04L000
          MOVE      ONE,EXIT
          GOTO      SF00L999
SF00L990  MOVE      ONE,EXIT * Exit Char Restart
SF00L999  RETURN
.--------------------------------
. Screen - Normal Picking Sheets              
.--------------------------------
SC01L000
SC01L100
          MOVE      "01",SCRID
          MOVE      ZERO,PRCOL
          MOVE      ZERO,PRVERT
          MOVE      "    1",FLDID
          CALL      GETPOSIT
          IF        EXIT=0
            MOVE     SCPSCOL,PRCOL
            MOVE     SCPSROW,PRVERT
          ENDIF
          CALL      SBACK000 * Display Background
.
SC01L200
          CALL      CF01L000 * Clear Fields
          CALL      RDCN0000
SC01L300
          CALL      KY01L000 * Enter Key Fields
          BRANCH    EXIT,SC01L999,SC01L999
SC01L400
          CALL      WP01L000 * Load any WP Details
SC01L500
          CALL      LM01L000 * Load any Batch Details
SC01L600
          CALL      DF01L000 * Display Fields
SC01L700
          CALL      SF01L000 * Select Fields
          BRANCH    EXIT,SC01L100,SC01L100,SC01L200
          IF        EXIT=4
            MOVE      ONE,EXIT
          ENDIF
SC01L800
SC01L900
SC01L999  RETURN
.--------------------------------------------------------
. Clear Fields for Screen : Normal Picking Sheets              
.-------------------------------------------------------
CF01L000
          MOVE      SP70,FROMWAR 
          MOVE      SP70,TOWAR   
          MOVE      SP70,FROMCOS 
          MOVE      SP70,TOCOS   
          MOVE      SP70,FROMREQ 
          MOVE      SP70,TOREQ   
          MOVE      ZERO,EXPORTYN
CF01L999  RETURN
.--------------------------------------------------------
. Enter Key Fields for Normal Picking Sheets              
.--------------------------------------------------------
KY01L000
          MOVE      ZERO,EXIT
          GOTO      KY01L999
.
KY01L900  MOVE      ONE,EXIT
KY01L999  RETURN
.---------------------------------------------------------
. Load WP files for : Normal Picking Sheets              
.---------------------------------------------------------
WP01L000
          RETURN
.---------------------------------------------------------
. Load Batch Screen for : Normal Picking Sheets              
.---------------------------------------------------------
LM01L000
          RETURN
.---------------------------------------------------------
. Display Fields for : Normal Picking Sheets              
.---------------------------------------------------------
DF01L000
          BRANCH   ACCEPT,DF01L999
          PACK     KEY15,PRGID,SCRID,SP70
          CALL     RSSCPS1
DF01L010
          CALL     RKSCPS1
          BRANCH   OVRCD,DF01L900
          MATCH    PRGID,SCPSPID
          GOTO     DF01L900 IF NOT EQUAL
          MATCH    SCRID,SCPSSID
          GOTO     DF01L900 IF NOT EQUAL
          MATCH    SP70,SCPSMTY
          GOTO     DF01L010 IF NOT EQUAL
.
          CALL     PS01L000 * Display Field
          GOTO     DF01L010
DF01L900
DF01L999
          RETURN
.---------------------------------------------------------
. Display/Print Fields for : Normal Picking Sheets              
.---------------------------------------------------------
PS01L000   PACK      VAR,SP70,SP70
          PACK     PRINTVAR,SP70,SP70
          MOVE     SCPSITM,FIELDNO
          BRANCH    FIELDNO,PS01L999,PS01L999,PS01L999,PS01L101:
                            PS01L102,PS01L103,PS01L104,PS01L105:
                            PS01L106,PS01L999,PS01L999,PS01L999:
                           PS01L999,PS01L999,PS01L999,PS01L107
          GOTO     PS01L999
.
PS01L101
          MOVE      FROMWAR,VAR      
          CALL      DISPITEM
          GOTO     PS01L999
.
PS01L102
          MOVE      TOWAR,VAR        
          CALL      DISPITEM
          GOTO     PS01L999
.
PS01L103
          MOVE      FROMCOS,VAR      
          CALL      DISPITEM
          GOTO     PS01L999
.
PS01L104
          MOVE      TOCOS,VAR        
          CALL      DISPITEM
          GOTO     PS01L999
.
PS01L105
          MOVE      FROMREQ,VAR      
          CALL      DISPITEM
          GOTO     PS01L999
.
PS01L106
          MOVE      TOREQ,VAR        
          CALL      DISPITEM
          GOTO     PS01L999
.
PS01L107
          MOVE      NO,YESNO
          MOVE      ZERO,FORM2
          MOVE      EXPORTYN,FORM2   
          LOAD      YESNO,FORM2,YES
          MOVE      YESNO,VAR
          CALL      DISPITEM
          GOTO     PS01L999
PS01L999
          RETURN
.---------------------------------------------------------
. Selections for : Normal Picking Sheets              
.---------------------------------------------------------
SF01L000  PACK     KEY13,PRGID,SCRID,SP70
          CALL     RSSCSL1
SF01L001  BRANCH   ACCEPT,SF01L020
.
SF01L005  CALL     MTSTQ000
          MOVE     SCSLITM,FIELDNO
          BRANCH    FIELDNO,SF01L006,SF01L101,SF01L102,SF01L103:
                            SF01L006,SF01L104,SF01L006,SF01L105:
                            SF01L006,SF01L006,SF01L006,SF01L006:
                           SF01L006,SF01L006,SF01L006,SF01L106
SF01L006  BEEP
          GOTO     SF01L005
SF01L020  CALL     RKSCSL1
          BRANCH   OVRCD,SF01L090
          MATCH    PRGID,SCSLPID
          GOTO     SF01L090 IF NOT EQUAL
          MATCH    SCRID,SCSLSID
          GOTO     SF01L090 IF NOT EQUAL
          MOVE     SCSLITM,FIELDNO
          BRANCH    FIELDNO,SF01L020,SF01L020,SF01L020,SF01L103:
                            SF01L020,SF01L104,SF01L020,SF01L105:
                            SF01L020,SF01L020,SF01L020,SF01L020:
                           SF01L020,SF01L020,SF01L020,SF01L106
          GOTO     SF01L020
SF01L090  MOVE     ZERO,ACCEPT
          GOTO     SF01L001
.
SF01L101
          MOVE      ZERO,EXIT
          GOTO      SF01L999
.
SF01L102
          CALL      PRNTR000
          MOVE      ZERO,EXIT
          GOTO      SF01L999
.
SF01L103
.
.
          MOVE      "    5",FLDID
          CALL      GETPOSIT
          IF        EXIT=0
            MOVE     SP70,TOWAR   
            PACK      VAR,SP70,SP70
            CALL      DISPITEM
          ENDIF
          CALL     SELECTED
          MOVE      "0",CKEYTYP
          CALL      EWAR0000
          IF        SCPSMAN=1
            IF        EXIT=1
              MOVE      "Mandatory Field - ",DISPMSG
              BEEP
              CALL      MESSAGE1
              GOTO      SF01L103
            ENDIF
            BRANCH    EXIT,SF01L103,SF01L990
          ELSE
            COMPARE   TWO,EXIT
            GOTO      SF01L990 IF EQUAL
          ENDIF
          MOVE      FROMWAR,VAR      
          CALL      DISPITEM
.
.
          MOVE      "    5",FLDID
          CALL      GETPOSIT
          IF        EXIT=0
            MOVE      TOWAR,VAR        
            CALL      DISPITEM
          ENDIF
          GOTO     SF01L001
.
SF01L104
.
.
          MOVE      "    7",FLDID
          CALL      GETPOSIT
          IF        EXIT=0
            MOVE     SP70,TOCOS   
            PACK      VAR,SP70,SP70
            CALL      DISPITEM
          ENDIF
          CALL     SELECTED
          MOVE      "0",CKEYTYP
          CALL      ECOS0000
          IF        SCPSMAN=1
            IF        EXIT=1
              MOVE      "Mandatory Field - ",DISPMSG
              BEEP
              CALL      MESSAGE1
              GOTO      SF01L104
            ENDIF
            BRANCH    EXIT,SF01L104,SF01L990
          ELSE
            COMPARE   TWO,EXIT
            GOTO      SF01L990 IF EQUAL
          ENDIF
          MOVE      FROMCOS,VAR      
          CALL      DISPITEM
.
.
          MOVE      "    7",FLDID
          CALL      GETPOSIT
          IF        EXIT=0
            MOVE      TOCOS,VAR        
            CALL      DISPITEM
          ENDIF
          GOTO     SF01L001
.
SF01L105
.
.
          MOVE      "    9",FLDID
          CALL      GETPOSIT
          IF        EXIT=0
            MOVE     SP70,TOREQ   
            PACK      VAR,SP70,SP70
            CALL      DISPITEM
          ENDIF
          CALL     SELECTED
          MOVE      "0",CKEYTYP
          CALL      EREQ0000
          IF        SCPSMAN=1
            IF        EXIT=1
              MOVE      "Mandatory Field - ",DISPMSG
              BEEP
              CALL      MESSAGE1
              GOTO      SF01L105
            ENDIF
            BRANCH    EXIT,SF01L105,SF01L990
          ELSE
            COMPARE   TWO,EXIT
            GOTO      SF01L990 IF EQUAL
          ENDIF
          MOVE      FROMREQ,VAR      
          CALL      DISPITEM
.
.
          MOVE      "    9",FLDID
          CALL      GETPOSIT
          IF        EXIT=0
            MOVE      TOREQ,VAR        
            CALL      DISPITEM
          ENDIF
          GOTO     SF01L001
.
SF01L106
          CALL      DEFAULTN
          CALL     SELECTED
          CALL      YORN0000
          MOVE       FYESNO,EXPORTYN
          MOVE      NO,YESNO
          MOVE      ZERO,FORM2
          MOVE      EXPORTYN,FORM2   
          LOAD      YESNO,FORM2,YES
          MOVE      YESNO,VAR
          CALL      DISPITEM
          GOTO     SF01L001
SF01L990  MOVE      FOUR,EXIT * Exit Char Exit
SF01L999  RETURN
.--------------------------------
. Screen - Imprest                            
.--------------------------------
SC02L000
SC02L100
          MOVE      "02",SCRID
          MOVE      ZERO,PRCOL
          MOVE      ZERO,PRVERT
          MOVE      "    1",FLDID
          CALL      GETPOSIT
          IF        EXIT=0
            MOVE     SCPSCOL,PRCOL
            MOVE     SCPSROW,PRVERT
          ENDIF
          CALL      SBACK000 * Display Background
.
SC02L200
          CALL      CF02L000 * Clear Fields
          CALL      RDCN0000
SC02L300
          CALL      KY02L000 * Enter Key Fields
          BRANCH    EXIT,SC02L999,SC02L999
SC02L400
          CALL      WP02L000 * Load any WP Details
SC02L500
          CALL      LM02L000 * Load any Batch Details
SC02L600
          CALL      DF02L000 * Display Fields
SC02L700
          CALL      SF02L000 * Select Fields
          BRANCH    EXIT,SC02L100,SC02L100,SC02L200
          IF        EXIT=4
            MOVE      ONE,EXIT
          ENDIF
SC02L800
SC02L900
SC02L999  RETURN
.--------------------------------------------------------
. Clear Fields for Screen : Imprest                            
.-------------------------------------------------------
CF02L000
          MOVE      SP70,FROMWAR 
          MOVE      SP70,TOWAR   
          MOVE      SP70,FROMCOS 
          MOVE      SP70,TOCOS   
          MOVE      SP70,REPTDTYP
          MOVE      ZERO,IMPAGDEL
          MOVE      ZERO,EXPORTYN
CF02L999  RETURN
.--------------------------------------------------------
. Enter Key Fields for Imprest                            
.--------------------------------------------------------
KY02L000
          MOVE      ZERO,EXIT
          GOTO      KY02L999
.
KY02L900  MOVE      ONE,EXIT
KY02L999  RETURN
.---------------------------------------------------------
. Load WP files for : Imprest                            
.---------------------------------------------------------
WP02L000
          RETURN
.---------------------------------------------------------
. Load Batch Screen for : Imprest                            
.---------------------------------------------------------
LM02L000
          RETURN
.---------------------------------------------------------
. Display Fields for : Imprest                            
.---------------------------------------------------------
DF02L000
          BRANCH   ACCEPT,DF02L999
          PACK     KEY15,PRGID,SCRID,SP70
          CALL     RSSCPS1
DF02L010
          CALL     RKSCPS1
          BRANCH   OVRCD,DF02L900
          MATCH    PRGID,SCPSPID
          GOTO     DF02L900 IF NOT EQUAL
          MATCH    SCRID,SCPSSID
          GOTO     DF02L900 IF NOT EQUAL
          MATCH    SP70,SCPSMTY
          GOTO     DF02L010 IF NOT EQUAL
.
          CALL     PS02L000 * Display Field
          GOTO     DF02L010
DF02L900
DF02L999
          RETURN
.---------------------------------------------------------
. Display/Print Fields for : Imprest                            
.---------------------------------------------------------
PS02L000   PACK      VAR,SP70,SP70
          PACK     PRINTVAR,SP70,SP70
          MOVE     SCPSITM,FIELDNO
          BRANCH    FIELDNO,PS02L999,PS02L999,PS02L999,PS02L101:
                            PS02L102,PS02L103,PS02L104,PS02L999:
                           PS02L999,PS02L999,PS02L999,PS02L999:
                           PS02L105,PS02L106,PS02L107
          GOTO     PS02L999
.
PS02L101
          MOVE      FROMWAR,VAR      
          CALL      DISPITEM
          GOTO     PS02L999
.
PS02L102
          MOVE      TOWAR,VAR        
          CALL      DISPITEM
          GOTO     PS02L999
.
PS02L103
          MOVE      FROMCOS,VAR      
          CALL      DISPITEM
          GOTO     PS02L999
.
PS02L104
          MOVE      TOCOS,VAR        
          CALL      DISPITEM
          GOTO     PS02L999
.
PS02L105
          MOVE      REPTDTYP,VAR     
          CALL      DISPITEM
          GOTO     PS02L999
.
PS02L106
          MOVE      NO,YESNO
          MOVE      ZERO,FORM2
          MOVE      IMPAGDEL,FORM2   
          LOAD      YESNO,FORM2,YES
          MOVE      YESNO,VAR
          CALL      DISPITEM
          GOTO     PS02L999
.
PS02L107
          MOVE      NO,YESNO
          MOVE      ZERO,FORM2
          MOVE      EXPORTYN,FORM2   
          LOAD      YESNO,FORM2,YES
          MOVE      YESNO,VAR
          CALL      DISPITEM
          GOTO     PS02L999
PS02L999
          RETURN
.---------------------------------------------------------
. Selections for : Imprest                            
.---------------------------------------------------------
SF02L000  PACK     KEY13,PRGID,SCRID,SP70
          CALL     RSSCSL1
SF02L001  BRANCH   ACCEPT,SF02L020
.
SF02L005  CALL     MTSTQ000
          MOVE     SCSLITM,FIELDNO
          BRANCH    FIELDNO,SF02L006,SF02L101,SF02L102,SF02L103:
                            SF02L006,SF02L104,SF02L006,SF02L006:
                           SF02L006,SF02L006,SF02L006,SF02L006:
                           SF02L105,SF02L106,SF02L107
SF02L006  BEEP
          GOTO     SF02L005
SF02L020  CALL     RKSCSL1
          BRANCH   OVRCD,SF02L090
          MATCH    PRGID,SCSLPID
          GOTO     SF02L090 IF NOT EQUAL
          MATCH    SCRID,SCSLSID
          GOTO     SF02L090 IF NOT EQUAL
          MOVE     SCSLITM,FIELDNO
          BRANCH    FIELDNO,SF02L020,SF02L020,SF02L020,SF02L103:
                            SF02L020,SF02L104,SF02L020,SF02L020:
                           SF02L020,SF02L020,SF02L020,SF02L020:
                           SF02L105,SF02L106,SF02L107
          GOTO     SF02L020
SF02L090  MOVE     ZERO,ACCEPT
          GOTO     SF02L001
.
SF02L101
          MOVE      ZERO,EXIT
          GOTO      SF02L999
.
SF02L102
          CALL      PRNTI000
          MOVE      ZERO,EXIT
          GOTO      SF02L999
.
SF02L103
.
.
          MOVE      "    5",FLDID
          CALL      GETPOSIT
          IF        EXIT=0
            MOVE     SP70,TOWAR   
            PACK      VAR,SP70,SP70
            CALL      DISPITEM
          ENDIF
          CALL     SELECTED
          MOVE      "0",CKEYTYP
          CALL      EWAR0000
          IF        SCPSMAN=1
            IF        EXIT=1
              MOVE      "Mandatory Field - ",DISPMSG
              BEEP
              CALL      MESSAGE1
              GOTO      SF02L103
            ENDIF
            BRANCH    EXIT,SF02L103,SF02L990
          ELSE
            COMPARE   TWO,EXIT
            GOTO      SF02L990 IF EQUAL
          ENDIF
          MOVE      FROMWAR,VAR      
          CALL      DISPITEM
.
.
          MOVE      "    5",FLDID
          CALL      GETPOSIT
          IF        EXIT=0
            MOVE      TOWAR,VAR        
            CALL      DISPITEM
          ENDIF
          GOTO     SF02L001
.
SF02L104
.
.
          MOVE      "    7",FLDID
          CALL      GETPOSIT
          IF        EXIT=0
            MOVE     SP70,TOCOS   
            PACK      VAR,SP70,SP70
            CALL      DISPITEM
          ENDIF
          CALL     SELECTED
          MOVE      "0",CKEYTYP
          CALL      ECOS0000
          IF        SCPSMAN=1
            IF        EXIT=1
              MOVE      "Mandatory Field - ",DISPMSG
              BEEP
              CALL      MESSAGE1
              GOTO      SF02L104
            ENDIF
            BRANCH    EXIT,SF02L104,SF02L990
          ELSE
            COMPARE   TWO,EXIT
            GOTO      SF02L990 IF EQUAL
          ENDIF
          MOVE      FROMCOS,VAR      
          CALL      DISPITEM
.
.
          MOVE      "    7",FLDID
          CALL      GETPOSIT
          IF        EXIT=0
            MOVE      TOCOS,VAR        
            CALL      DISPITEM
          ENDIF
          GOTO     SF02L001
.
SF02L105
          CALL     SELECTED
          MOVE      "0",CKEYTYP
          CALL      EREPT000
          IF        SCPSMAN=1
            IF        EXIT=1
              MOVE      "Mandatory Field - ",DISPMSG
              BEEP
              CALL      MESSAGE1
              GOTO      SF02L105
            ENDIF
            BRANCH    EXIT,SF02L105,SF02L990
          ELSE
            COMPARE   TWO,EXIT
            GOTO      SF02L990 IF EQUAL
          ENDIF
          MOVE      REPTDTYP,VAR     
          CALL      DISPITEM
          GOTO     SF02L001
.
SF02L106
          CALL      DEFAULTN
          CALL     SELECTED
          CALL      YORN0000
          MOVE       FYESNO,IMPAGDEL
          MOVE      NO,YESNO
          MOVE      ZERO,FORM2
          MOVE      IMPAGDEL,FORM2   
          LOAD      YESNO,FORM2,YES
          MOVE      YESNO,VAR
          CALL      DISPITEM
          GOTO     SF02L001
.
SF02L107
          CALL      DEFAULTN
          CALL     SELECTED
          CALL      YORN0000
          MOVE       FYESNO,EXPORTYN
          MOVE      NO,YESNO
          MOVE      ZERO,FORM2
          MOVE      EXPORTYN,FORM2   
          LOAD      YESNO,FORM2,YES
          MOVE      YESNO,VAR
          CALL      DISPITEM
          GOTO     SF02L001
SF02L990  MOVE      FOUR,EXIT * Exit Char Exit
SF02L999  RETURN
.--------------------------------
. Screen - Back Order Picking Sheets          
.--------------------------------
SC03L000
SC03L100
          MOVE      "03",SCRID
          MOVE      ZERO,PRCOL
          MOVE      ZERO,PRVERT
          MOVE      "    1",FLDID
          CALL      GETPOSIT
          IF        EXIT=0
            MOVE     SCPSCOL,PRCOL
            MOVE     SCPSROW,PRVERT
          ENDIF
          CALL      SBACK000 * Display Background
.
SC03L200
          CALL      CF03L000 * Clear Fields
          CALL      RDCN0000
SC03L300
          CALL      KY03L000 * Enter Key Fields
          BRANCH    EXIT,SC03L999,SC03L999
SC03L400
          CALL      WP03L000 * Load any WP Details
SC03L500
          CALL      LM03L000 * Load any Batch Details
SC03L600
          CALL      DF03L000 * Display Fields
SC03L700
          CALL      SF03L000 * Select Fields
          BRANCH    EXIT,SC03L100,SC03L100,SC03L200
          IF        EXIT=4
            MOVE      ONE,EXIT
          ENDIF
SC03L800
SC03L900
SC03L999  RETURN
.--------------------------------------------------------
. Clear Fields for Screen : Back Order Picking Sheets          
.-------------------------------------------------------
CF03L000
          MOVE      SP70,FROMWAR 
          MOVE      SP70,TOWAR   
          MOVE      SP70,FROMCOS 
          MOVE      SP70,TOCOS   
          MOVE      ZERO,EXPORTYN
CF03L999  RETURN
.--------------------------------------------------------
. Enter Key Fields for Back Order Picking Sheets          
.--------------------------------------------------------
KY03L000
          MOVE      ZERO,EXIT
          GOTO      KY03L999
.
KY03L900  MOVE      ONE,EXIT
KY03L999  RETURN
.---------------------------------------------------------
. Load WP files for : Back Order Picking Sheets          
.---------------------------------------------------------
WP03L000
          RETURN
.---------------------------------------------------------
. Load Batch Screen for : Back Order Picking Sheets          
.---------------------------------------------------------
LM03L000
          RETURN
.---------------------------------------------------------
. Display Fields for : Back Order Picking Sheets          
.---------------------------------------------------------
DF03L000
          BRANCH   ACCEPT,DF03L999
          PACK     KEY15,PRGID,SCRID,SP70
          CALL     RSSCPS1
DF03L010
          CALL     RKSCPS1
          BRANCH   OVRCD,DF03L900
          MATCH    PRGID,SCPSPID
          GOTO     DF03L900 IF NOT EQUAL
          MATCH    SCRID,SCPSSID
          GOTO     DF03L900 IF NOT EQUAL
          MATCH    SP70,SCPSMTY
          GOTO     DF03L010 IF NOT EQUAL
.
          CALL     PS03L000 * Display Field
          GOTO     DF03L010
DF03L900
DF03L999
          RETURN
.---------------------------------------------------------
. Display/Print Fields for : Back Order Picking Sheets          
.---------------------------------------------------------
PS03L000   PACK      VAR,SP70,SP70
          PACK     PRINTVAR,SP70,SP70
          MOVE     SCPSITM,FIELDNO
          BRANCH    FIELDNO,PS03L999,PS03L999,PS03L999,PS03L101:
                            PS03L102,PS03L103,PS03L104,PS03L999:
                           PS03L999,PS03L999,PS03L999,PS03L105
          GOTO     PS03L999
.
PS03L101
          MOVE      FROMWAR,VAR      
          CALL      DISPITEM
          GOTO     PS03L999
.
PS03L102
          MOVE      TOWAR,VAR        
          CALL      DISPITEM
          GOTO     PS03L999
.
PS03L103
          MOVE      FROMCOS,VAR      
          CALL      DISPITEM
          GOTO     PS03L999
.
PS03L104
          MOVE      TOCOS,VAR        
          CALL      DISPITEM
          GOTO     PS03L999
.
PS03L105
          MOVE      NO,YESNO
          MOVE      ZERO,FORM2
          MOVE      EXPORTYN,FORM2   
          LOAD      YESNO,FORM2,YES
          MOVE      YESNO,VAR
          CALL      DISPITEM
          GOTO     PS03L999
PS03L999
          RETURN
.---------------------------------------------------------
. Selections for : Back Order Picking Sheets          
.---------------------------------------------------------
SF03L000  PACK     KEY13,PRGID,SCRID,SP70
          CALL     RSSCSL1
SF03L001  BRANCH   ACCEPT,SF03L020
.
SF03L005  CALL     MTSTQ000
          MOVE     SCSLITM,FIELDNO
          BRANCH    FIELDNO,SF03L006,SF03L101,SF03L102,SF03L103:
                            SF03L006,SF03L104,SF03L006,SF03L006:
                           SF03L006,SF03L006,SF03L006,SF03L105
SF03L006  BEEP
          GOTO     SF03L005
SF03L020  CALL     RKSCSL1
          BRANCH   OVRCD,SF03L090
          MATCH    PRGID,SCSLPID
          GOTO     SF03L090 IF NOT EQUAL
          MATCH    SCRID,SCSLSID
          GOTO     SF03L090 IF NOT EQUAL
          MOVE     SCSLITM,FIELDNO
          BRANCH    FIELDNO,SF03L020,SF03L020,SF03L020,SF03L103:
                            SF03L020,SF03L104,SF03L020,SF03L020:
                           SF03L020,SF03L020,SF03L020,SF03L105
          GOTO     SF03L020
SF03L090  MOVE     ZERO,ACCEPT
          GOTO     SF03L001
.
SF03L101
          MOVE      ZERO,EXIT
          GOTO      SF03L999
.
SF03L102
          CALL      PRNTB000
          MOVE      ZERO,EXIT
          GOTO      SF03L999
.
SF03L103
.
.
          MOVE      "    5",FLDID
          CALL      GETPOSIT
          IF        EXIT=0
            MOVE     SP70,TOWAR   
            PACK      VAR,SP70,SP70
            CALL      DISPITEM
          ENDIF
          CALL     SELECTED
          MOVE      "0",CKEYTYP
          CALL      EWAR0000
          IF        SCPSMAN=1
            IF        EXIT=1
              MOVE      "Mandatory Field - ",DISPMSG
              BEEP
              CALL      MESSAGE1
              GOTO      SF03L103
            ENDIF
            BRANCH    EXIT,SF03L103,SF03L990
          ELSE
            COMPARE   TWO,EXIT
            GOTO      SF03L990 IF EQUAL
          ENDIF
          MOVE      FROMWAR,VAR      
          CALL      DISPITEM
.
.
          MOVE      "    5",FLDID
          CALL      GETPOSIT
          IF        EXIT=0
            MOVE      TOWAR,VAR        
            CALL      DISPITEM
          ENDIF
          GOTO     SF03L001
.
SF03L104
.
.
          MOVE      "    7",FLDID
          CALL      GETPOSIT
          IF        EXIT=0
            MOVE     SP70,TOCOS   
            PACK      VAR,SP70,SP70
            CALL      DISPITEM
          ENDIF
          CALL     SELECTED
          MOVE      "0",CKEYTYP
          CALL      ECOS0000
          IF        SCPSMAN=1
            IF        EXIT=1
              MOVE      "Mandatory Field - ",DISPMSG
              BEEP
              CALL      MESSAGE1
              GOTO      SF03L104
            ENDIF
            BRANCH    EXIT,SF03L104,SF03L990
          ELSE
            COMPARE   TWO,EXIT
            GOTO      SF03L990 IF EQUAL
          ENDIF
          MOVE      FROMCOS,VAR      
          CALL      DISPITEM
.
.
          MOVE      "    7",FLDID
          CALL      GETPOSIT
          IF        EXIT=0
            MOVE      TOCOS,VAR        
            CALL      DISPITEM
          ENDIF
          GOTO     SF03L001
.
SF03L105
          CALL      DEFAULTN
          CALL     SELECTED
          CALL      YORN0000
          MOVE       FYESNO,EXPORTYN
          MOVE      NO,YESNO
          MOVE      ZERO,FORM2
          MOVE      EXPORTYN,FORM2   
          LOAD      YESNO,FORM2,YES
          MOVE      YESNO,VAR
          CALL      DISPITEM
          GOTO     SF03L001
SF03L990  MOVE      FOUR,EXIT * Exit Char Exit
SF03L999  RETURN
.--------------------------------
. Screen - All Requisitions                   
.--------------------------------
SC04L000
SC04L100
          MOVE      "04",SCRID
          MOVE      ZERO,PRCOL
          MOVE      ZERO,PRVERT
          MOVE      "    1",FLDID
          CALL      GETPOSIT
          IF        EXIT=0
            MOVE     SCPSCOL,PRCOL
            MOVE     SCPSROW,PRVERT
          ENDIF
          CALL      SBACK000 * Display Background
.
SC04L200
          CALL      CF04L000 * Clear Fields
          CALL      RDCN0000
SC04L300
          CALL      KY04L000 * Enter Key Fields
          BRANCH    EXIT,SC04L999,SC04L999
SC04L400
          CALL      WP04L000 * Load any WP Details
SC04L500
          CALL      LM04L000 * Load any Batch Details
SC04L600
          CALL      DF04L000 * Display Fields
SC04L700
          CALL      SF04L000 * Select Fields
          BRANCH    EXIT,SC04L100,SC04L100,SC04L200
          IF        EXIT=4
            MOVE      ONE,EXIT
          ENDIF
SC04L800
SC04L900
SC04L999  RETURN
.--------------------------------------------------------
. Clear Fields for Screen : All Requisitions                   
.-------------------------------------------------------
CF04L000
          MOVE      SP70,FROMWAR 
          MOVE      SP70,TOWAR   
          MOVE      SP70,FROMCOS 
          MOVE      SP70,TOCOS   
CF04L999  RETURN
.--------------------------------------------------------
. Enter Key Fields for All Requisitions                   
.--------------------------------------------------------
KY04L000
          MOVE      ZERO,EXIT
          GOTO      KY04L999
.
KY04L900  MOVE      ONE,EXIT
KY04L999  RETURN
.---------------------------------------------------------
. Load WP files for : All Requisitions                   
.---------------------------------------------------------
WP04L000
          RETURN
.---------------------------------------------------------
. Load Batch Screen for : All Requisitions                   
.---------------------------------------------------------
LM04L000
          RETURN
.---------------------------------------------------------
. Display Fields for : All Requisitions                   
.---------------------------------------------------------
DF04L000
          BRANCH   ACCEPT,DF04L999
          PACK     KEY15,PRGID,SCRID,SP70
          CALL     RSSCPS1
DF04L010
          CALL     RKSCPS1
          BRANCH   OVRCD,DF04L900
          MATCH    PRGID,SCPSPID
          GOTO     DF04L900 IF NOT EQUAL
          MATCH    SCRID,SCPSSID
          GOTO     DF04L900 IF NOT EQUAL
          MATCH    SP70,SCPSMTY
          GOTO     DF04L010 IF NOT EQUAL
.
          CALL     PS04L000 * Display Field
          GOTO     DF04L010
DF04L900
DF04L999
          RETURN
.---------------------------------------------------------
. Display/Print Fields for : All Requisitions                   
.---------------------------------------------------------
PS04L000   PACK      VAR,SP70,SP70
          PACK     PRINTVAR,SP70,SP70
          MOVE     SCPSITM,FIELDNO
          BRANCH    FIELDNO,PS04L999,PS04L999,PS04L999,PS04L101:
                            PS04L102,PS04L103,PS04L104
          GOTO     PS04L999
.
PS04L101
          MOVE      FROMWAR,VAR      
          CALL      DISPITEM
          GOTO     PS04L999
.
PS04L102
          MOVE      TOWAR,VAR        
          CALL      DISPITEM
          GOTO     PS04L999
.
PS04L103
          MOVE      FROMCOS,VAR      
          CALL      DISPITEM
          GOTO     PS04L999
.
PS04L104
          MOVE      TOCOS,VAR        
          CALL      DISPITEM
          GOTO     PS04L999
PS04L999
          RETURN
.---------------------------------------------------------
. Selections for : All Requisitions                   
.---------------------------------------------------------
SF04L000  PACK     KEY13,PRGID,SCRID,SP70
          CALL     RSSCSL1
SF04L001  BRANCH   ACCEPT,SF04L020
.
SF04L005  CALL     MTSTQ000
          MOVE     SCSLITM,FIELDNO
          BRANCH    FIELDNO,SF04L006,SF04L101,SF04L102,SF04L103:
                            SF04L006,SF04L104,SF04L006
SF04L006  BEEP
          GOTO     SF04L005
SF04L020  CALL     RKSCSL1
          BRANCH   OVRCD,SF04L090
          MATCH    PRGID,SCSLPID
          GOTO     SF04L090 IF NOT EQUAL
          MATCH    SCRID,SCSLSID
          GOTO     SF04L090 IF NOT EQUAL
          MOVE     SCSLITM,FIELDNO
          BRANCH    FIELDNO,SF04L020,SF04L020,SF04L020,SF04L103:
                            SF04L020,SF04L104,SF04L020
          GOTO     SF04L020
SF04L090  MOVE     ZERO,ACCEPT
          GOTO     SF04L001
.
SF04L101
          MOVE      ZERO,EXIT
          GOTO      SF04L999
.
SF04L102
          CALL      PRNTA000
          MOVE      ZERO,EXIT
          GOTO      SF04L999
.
SF04L103
.
.
          MOVE      "    5",FLDID
          CALL      GETPOSIT
          IF        EXIT=0
            MOVE     SP70,TOWAR   
            PACK      VAR,SP70,SP70
            CALL      DISPITEM
          ENDIF
          CALL     SELECTED
          MOVE      "0",CKEYTYP
          CALL      EWAR0000
          IF        SCPSMAN=1
            IF        EXIT=1
              MOVE      "Mandatory Field - ",DISPMSG
              BEEP
              CALL      MESSAGE1
              GOTO      SF04L103
            ENDIF
            BRANCH    EXIT,SF04L103,SF04L990
          ELSE
            COMPARE   TWO,EXIT
            GOTO      SF04L990 IF EQUAL
          ENDIF
          MOVE      FROMWAR,VAR      
          CALL      DISPITEM
.
.
          MOVE      "    5",FLDID
          CALL      GETPOSIT
          IF        EXIT=0
            MOVE      TOWAR,VAR        
            CALL      DISPITEM
          ENDIF
          GOTO     SF04L001
.
SF04L104
.
.
          MOVE      "    7",FLDID
          CALL      GETPOSIT
          IF        EXIT=0
            MOVE     SP70,TOCOS   
            PACK      VAR,SP70,SP70
            CALL      DISPITEM
          ENDIF
          CALL     SELECTED
          MOVE      "0",CKEYTYP
          CALL      ECOS0000
          IF        SCPSMAN=1
            IF        EXIT=1
              MOVE      "Mandatory Field - ",DISPMSG
              BEEP
              CALL      MESSAGE1
              GOTO      SF04L104
            ENDIF
            BRANCH    EXIT,SF04L104,SF04L990
          ELSE
            COMPARE   TWO,EXIT
            GOTO      SF04L990 IF EQUAL
          ENDIF
          MOVE      FROMCOS,VAR      
          CALL      DISPITEM
.
.
          MOVE      "    7",FLDID
          CALL      GETPOSIT
          IF        EXIT=0
            MOVE      TOCOS,VAR        
            CALL      DISPITEM
          ENDIF
          GOTO     SF04L001
SF04L990  MOVE      FOUR,EXIT * Exit Char Exit
SF04L999  RETURN
.@@@@@ Function Restart Point @@@@@
.**********************************************************************
. SELPRT00 - select printer routine
. Requires IBACODFD/INC IBAPRNFD/INC
.          IBAIOCOD/INC IBAIOPRN/INC IBAPRINT
.  Note : already includes IBAPASFD & IBAPASIO
.**********************************************************************
SELPRT00  OPEN      IBACODE1,"ibacodef"     * open files
...       OPEN      IBAPRNT1,"ibaprntf"                               *D-239574
          MOVE      SP70,SPLFILE
          CALL      SELPRINT
          RETURN
.------------------------------------------------------------------------
. Open Nato X-Ref File if required
.------------------------------------------------------------------------
ONAT0000  OPEN      CONTROLF,"controlf"
.
          MOVE      ZERO,OVRCD
          TRAP      OVERCOND IF FORMAT
          READ      CONTROLF,SIXTY3;*143,HNONUSAG
          TRAPCLR   FORMAT
          IF        OVRCD=1
            MOVE      ONE,HNONUSAG
            WRITAB    CONTROLF,SIXTY3;*143,HNONUSAG
          ENDIF
.
          MOVE      ZERO,OVRCD
          TRAP      OVERCOND IF FORMAT
          READ      CONTROLF,SIXTY3;*141,INCNNATO
          TRAPCLR   FORMAT
          IF        OVRCD=1
            MOVE      ZERO,INCNNATO
            WRITAB    CONTROLF,SIXTY3;*141,INCNNATO
          ENDIF
.
          IF        INCNNATO=1
            MOVE      ZERO,OVRCD
            TRAP      OVERCOND IF IO
            OPEN      SINNATA1,"sinnataf"
            TRAPCLR   IO
            IF        OVRCD=1
              DISPLAY   *P1:24,*EL,*B,"Nato file does not exist. Run fixit.  ";
              CALL      HITENTER
              CHAIN     PGM
            ENDIF
.
            OPEN      SINNATA2,"sinnataf"
          ENDIF
.
ONAT9999  RETURN
.----------------------------------------------------------------------
. Internal Requisitions Screen 01
.----------------------------------------------------------------------
IREQ0000  MOVE      ZERO,SKPRESET
          CALL      SC01L000
.
IREQ9999  RETURN
.
ALIGN000  MOVE     "63",SECTOR
          READ     CONTROLF,SECTOR;*149,SNCOPTYP
.
          COMPARE  ZERO,SNCOPTYP
          GOTO     ALIGN999 IF EQUAL
.
ALIGN100  KEYIN     *P1:24,*EL,*P20:24,"Do You Require A Line Up Print (":
                    *V2LON,"Y",*HOFF,"/",*V2LON,"N",*HOFF,") ? ",*V2LON,ANS;
.
          PACK      ANS,ANS,SP10
          REP       UPPLOW,ANS
          CMATCH    "Y" TO ANS
          GOTO      ALIGN200 IF EQUAL
.
          CMATCH    "N" TO ANS
          GOTO      ALIGN999 IF EQUAL
.
          BEEP
          GOTO      ALIGN100
.
ALIGN200  CALL      OPNPRINT
          PRINT     *N,*N,*N,*N,*33,"PICKING SLIP",*71,CDATE:
                    *N,*N,*N,*1,"Department ","XXXXX":
                    *56,"Requisition No. ","A999999":
                    *N,*12,"XXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXX":
                    *55,"Requisition Date ",CDATE:
                    *N,*N,*1,"========================================":
                             "=======================================":
                    *N,*N,*N,*N,*N:
                    *N,*1,"9999999",*10,"XXXXXXXXXXXXXXXXXXXXXXXXXXXXXXX":
                    *42,"99999",*48,"9999.99":
                    *56,"99999",*63,"99999",*69,"XXXXXXXX":
                    *N,*10,"XXXXXXXXXXXXXXXXXXXXXXXXXXXXXXX",*N:
                    *N,*46,"=========":
                    *N,*46,"999999.99":
                    *N,*46,"=========":
                    *N,*N,*N,*N,*N,*N,*N,*N,*N,*N,*N,*N,*N,*N,*N,*N,*N:
                    *N,*N,*N,*N,*N,*N,*N,*N,*N:
                    *N,*1,"9999999",*10,"XXXXXXXXXXXXXXXXXXXXXXXXXXXXXXX":
                    *42,"99999",*48,"9999.99":
                    *56,"99999",*63,"99999",*69,"XXXXXXXX":
                    *N,*N
          CALL      CLSPRINT
          GOTO      ALIGN100
.
ALIGN999  RETURN
. Read controlf to find the picking sheet layout 0 = std, 1 = acc
. Move one to accept for insert mode
.
RDCN0000  READ      CONTROLF,SIXTY3;*149,SNCOPTYP,*161,SNCOASPL
          MOVE      ONE,ACCEPT
          MOVE      "N",DEFYESNO
          MOVE      ZERO,SKPRESET
          MOVE      ZERO,RSTBFLAG
          MOVE      ZERO,RSTIFLAG
          MOVE      ZERO,RSTNFLAG
.
RDCN9999  RETURN
DEFAULTN    MOVE     ANSN,DEFYESNO
            RETURN
.----------------------------------------------------------------------
. Print Requisitions
.----------------------------------------------------------------------
PRNTR000  IF        EXPORTYN=1
            CALL      MKEXP000        * Create Export File
          ENDIF
          PACK      DISPMSG,SP70,SP70
          CALL      MESSAGE2
..          CALL      RANGE000  * Check Warehouse/Cost Centre/Req Type Range.
..          BRANCH    EXIT,PRNTR950
.
          CALL      OPNPRINT
          MOVE      ONE,CNOUNDLN                * no underlines
          MOVE      ZERO,CPAGENO                 * reset page no.
          CLOCK     TIME,CTIMEIS                 * get current time
          MOVE      "999",CLNO                   * init last line number
          MOVE      ZERO,TOTALOUT
          MOVE      ZERO,TOTAL
          MOVE      ONE,EMPTYREC
          DISPLAY   *P1:24,*EL,"Generating Internal    - Warehouse :":
                    *P47:24,"Cost Centre  :";
.
          PACK      KEY83,STRWAR,FCOST,SP70,SP70
          PACK      LASTITEM,SP70
          CALL      RSSIPR1
PRNTR100  CALL      RKSIPR1
          BRANCH    OVRCD,PRNTR900
.
          PACK      KEY9,PASSCODE,SIPRWAR,SP70   * check warehouse security
          CALL      RDSIWS1
          BRANCH    OVRCD,PRNTR100
.
          MATCH     SIPRWAR,ENDWAR          * check print range
          GOTO      PRNTR900 IF LESS
          MATCH     FCOST,SIPRCST
          GOTO      PRNTR100 IF LESS
          MATCH     SIPRCST,TCOST
          GOTO      PRNTR100 IF LESS
          MATCH     SIPRTYP,ENDREQ
          GOTO      PRNTR100 IF LESS
          MATCH     STRREQ,SIPRTYP
          GOTO      PRNTR100 IF LESS
.
          MATCH     SP70,SIPRPFL       * record already printed ?
          IF        !@EQUAL
            PACK      KEY83,SIPRWAR,SIPRCST,SIPRDEL,SIPRRAC:
                            SIPRCAT,SIPRTYP,SIPRREQ,SP70
            CALL      RLSIPR1          * Lock Record
            BRANCH    OVRCD,PRNTR100,PRNTR100
            MOVE      SP70,SIPRPFL     * clear port if not locked !!!!!
            CALL      UPSIPR1
          ENDIF
.
          DISPLAY   *P38:24,*V2LON,SIPRWAR,*P61:24,SIPRCST,*P69:24,SIPRCAT;
.
          PACK      KEY8,SIPRTYP,SIPRREQ
          CALL      RDSIRA1            * Read Requisition Details.
          BRANCH    OVRCD,PRNTR100     * Ignore If NOT found.
.
          PACK      KEY20,SIPRTYP,SIPRREQ,SIPRWAR,SIPRCAT
          CALL      RDSIRB1            * Read Requisition Details.
          BRANCH    OVRCD,PRNTR100     * Ignore If NOT found.
.
          PACK      KEY83,SIPRWAR,SIPRCST,SIPRDEL,SIPRRAC:
                          SIPRCAT,SIPRTYP,SIPRREQ,SP70
          CALL      RLSIPR1            * Lock Record
          BRANCH    OVRCD,PRNTR100,PRNTR100
.
          MOVE      PORT,SIPRPFL       * mark record as printed
          CALL      UPSIPR1            * Update
....      CALL      UUSIPR1            * Dont Unlock !!!!
          PACK      SIRBDAT,CCC,CYY,CMM,CDD
          REP       " 0",SIRBDAT
          CALL      UPSIRB1            * Update Received Date on Req Details
.
.---- print record ----
.
          BRANCH    SNCOPTYP,PRNTR200
.
          PACK      KEY60,SIPRWAR,SIPRCST,SIPRDEL,SP70
          MATCH     KEY60,LASTITEM     * start new page ?
          IF        !@EQUAL
            MOVE      "999",CLNO       * Force Page Break on Change of
            MOVE      KEY60,LASTITEM   * Warehouse,Cost Centre or Delivery
          ENDIF
.
          COMPARE   "50",CLNO
          CALL      HEADR000 IF NOT LESS
          CALL      PLINR000           * Print Details
          GOTO      PRNTR100
.
PRNTR200  PACK      KEY60,SIPRWAR,SIPRCST,SIPRDEL,SP70
          MATCH     KEY60,LASTITEM     * start new page ?
          IF        !@EQUAL
            CALL      HEADR000
            MOVE      KEY60,LASTITEM   * Warehouse,Cost Centre or Delivery
          ENDIF                        * and requisition number
.
          COMPARE   "10",CLNO
          GOTO      PRNTR300 IF NOT LESS
.
          CALL      PLINR000           * Print Details
          GOTO      PRNTR100
.
PRNTR300  PRINT     *N,*N,*N,*N
          MOVE      ZERO,CPAGENO
          CALL      HEADR000
          CALL      PLINR000
          GOTO      PRNTR100
.
PRNTR900  IF        ZERO=CPAGENO
            DISPLAY   *P1:24,*EL,"No Internal records selected - ";
            CALL      HITENTER
            MOVE      ONE,RSTNFLAG
          ELSE
            IF        SKPRESET=0
              MOVE      ZERO,CPAGENO
            ENDIF
            IF        EXPORTYN=1
              CALL      TREXP000       * Transfer Export File
            ENDIF
            CALL      RSETR000         * reset if required
          ENDIF
          MOVE      ZERO,EXIT
          GOTO      PRNTR999
PRNTR950  MOVE      ONE,EXIT
PRNTR999  CALL      MESSAGE3
          RETURN
.**********************************************************************
. RSET - Reset if required
.**********************************************************************
RSETR000  CALL      TAILR000
.
          BRANCH    SKPRESET,RSETR999
.
          IF        SNCOPTYP=0
            PRINT     *N,*N,*45,"***  End of Report  ***"
          ELSE
            PRINT     *N,*N,*N,*N,*N,*1,"***  End of Report  ***"
            GOTO      RSETR100
          ENDIF
          IF        EXPORTYN=1
            CALL      DELPRT00
          ELSE
            IF        SNCOASPL<>1
              CALL      CLSPRINT
            ENDIF
          ENDIF
          IF        SNCOASPL<>1
            CALL      OPNPRINT
          ENDIF
          CALL      HEAD132
          PRINT     *40,"Requisition Picking Sheet Options"
          CALL      UND132
          PRINT     "Warehouse        from : ",FROMWAR," to ",TOWAR
          PRINT     "Cost Centre      from : ",FROMCOS," to ",TOCOS
          PRINT     "Requisition Type from : ",FROMREQ,"     to ",TOREQ
.
.---- check if reset required ----
.
RSETR100  MOVE      "Y",ANS       * Dont ask Question of Auto Spooling ON
          BRANCH    SNCOASPL,RSETR110
          KEYIN     *P1:24,*EL,"Re-set Requisition picking sheets (":
                    *V2LON,"Y",*HOFF,"/",*V2LON,"N",*HOFF,") ? ",*V2LON,ANS;
          PACK      ANS,ANS,SP70
          REP       UPPLOW,ANS
.
RSETR110  MATCH     "Y",ANS
          IF        @EQUAL
            IF        SNCOPTYP=0
              PRINT     *N,*40,"Picking Sheets HAVE been RESET"
              PRINT     *N,*40,"Picking Sheets HAVE been RESET"
              CALL      UND132
            ELSE
              PRINT     *N,*5,"Picking Sheets HAVE been RESET"
            ENDIF
            MOVE      ONE,RESETFLG
            GOTO      RSETR200
          ENDIF
          MATCH     "N",ANS
          IF        @EQUAL
            IF        SNCOPTYP=0
              PRINT     *N,*40,"Picking Sheets have NOT been RESET"
              PRINT     *N,*40,"Picking Sheets have NOT been RESET"
              CALL      UND132
            ELSE
              PRINT     *N,*5,"Picking Sheets have NOT been RESET"
            ENDIF
            MOVE      ZERO,RESETFLG
            GOTO      RSETR200
          ENDIF
          BEEP
          GOTO      RSETR100
.
.---- reset or clear picking sheets ----
.
RSETR200  IF        EXPORTYN=1
            CALL      DELPRT00
          ELSE
            IF        SNCOASPL=1
              CALL      WRSPL000
              CALL      SPLPRINT
            ELSE
              CALL      CLSPRINT
            ENDIF
          ENDIF
          DISPLAY   *P1:24,*EL,"Generating Internal    - Warehouse :":
                    *P47:24,"Cost Centre  :";
          PACK      KEY83,STRWAR,FCOST,SP70,SP70
.
.---- read next record ----
.
RSETR310  CALL      RSSIPR1
.
RSETR320  CALL      RKSIPR1
          BRANCH    OVRCD,RSETR999
.
          PACK      KEY9,PASSCODE,SIPRWAR,SP70   * check warehouse security
          CALL      RDSIWS1
          BRANCH    OVRCD,RSETR320
.
          MATCH     SIPRWAR,ENDWAR
          GOTO      RSETR999 IF LESS
          MATCH     SIPRCST,TCOST
          GOTO      RSETR320 IF LESS
          MATCH     PORT,SIPRPFL       * record printed by this port ?
          GOTO      RSETR320 IF NOT EQUAL
.
          DISPLAY   *P38:24,*V2LON,SIPRWAR,*P61:24,SIPRCST,*P69:24,SIPRCAT;
          PACK      KEY83,SIPRWAR,SIPRCST,SIPRDEL,SIPRRAC:
                          SIPRCAT,SIPRTYP,SIPRREQ,SP70
          CALL      RLSIPR1
          BRANCH    OVRCD,RSETR320,RSETR320
          IF        RESETFLG=1
            CALL      DESIPR1
          ELSE
            PACK      SIPRPFL,SP70
            CALL      UPSIPR1
            CALL      UUSIPR1
            GOTO      RSETR320
          ENDIF
          GOTO      RSETR310
.
RSETR999  RETURN
.**********************************************************************
. PLIN - Print line
.**********************************************************************
PLINR000  PACK      KEY7,SIPRCAT,SP70
          CALL      RDSIIA1
          CALL      GETPNO00   * Get Part Number
.
          MOVE      "99,999,999.99",KEY13
          FEDIT     SIPRRQT,KEY13
          MATCH     "*",KEY13
          IF        @EQUAL
            MOVE      "9999999999.99",KEY13
            FEDIT     SIPRRQT,KEY13
          ENDIF
.
          MOVE      "9,999,999.99",KEY12
          FEDIT     SIPRAQT,KEY12
          MATCH     "*",KEY12
          IF        @EQUAL
            MOVE      "999999999.99",KEY12
            FEDIT     SIPRAQT,KEY12
          ENDIF
.
          CALL      CIQT0000                * Comparing Issue Quantity
          BRANCH    EXIT,PLINR050
.
          MOVE      "999,999,999.99",KEY14
          FEDIT     SIRBAMT,KEY14
          MATCH     "*",KEY14
          IF        @EQUAL
            MOVE      "99999999999.99",KEY14
            FEDIT     SIRBAMT,KEY14
          ENDIF
.
PLINR050  UNPACK    SIRADAT,CCENT,CYEAR,CMON,CDAY
          CALL      PACDATE
.
          BRANCH    SNCOPTYP,PLINR100
.
          PRINT     "|",SIPRRAC,"| ",SIPRCAT,SP1,SIIADES,"|",*95,"|":
                    *108,"| ",CPCDATE,*132,"|"
          PRINT     "|",*10,"|",*20,SIICPNO,KEY13,SP1,SIIAISS," | ",KEY12," | ":
                    *108,"| ",SIPRTYP,SIPRREQ,KEY14,"|"
          GOTO      PLINR200
.
PLINR100  MOVE      ZERO,SIIESOH
          PACK      KEY12,SIPRCAT,SIPRWAR,SP70
          CALL      RDSIIE1
          MOVE      SIIESOH,FORM5
          MOVE      SIIAAVC,FORM12P6
          MULT      SIPRAQT,FORM12P6
          MOVE      FORM12P6,FORM5P2
          UNPACK    SIIADES,KEY30,KEY20,KEY10
          MOVE      SIPRAQT,FORM5A
          MOVE      SIPRBQT,FORM5B
.
          PRINT     *1,SIPRCAT,*10,KEY30,*41,FORM5A,*46,FORM5P2:
                    *55,FORM5B,*62,FORM5,*68,SIPRRAC:
                    *N,*10,SIICPNO,*N
          ADD       ONE,CLNO
          ADD       FORM5P2,TOTAL
          GOTO      PLINR900
.
PLINR200  REP       " 0",SIWAPSH
          MATCH     "1",SIWAPSH
          IF        @EQUAL
            MOVE      ZERO,SIIESOH
            PACK      KEY12,SIPRCAT,SIPRWAR,SP70
            CALL      RDSIIE1
            MOVE      SIIESOH,FORM12
            MOVE      "9999,999,999",KEY12
            FEDIT     FORM12,KEY12
            MATCH     "*",KEY12
            IF        @EQUAL
              MOVE      "999999999999",KEY12
              FEDIT     FORM12,KEY12
            ENDIF
            PRINT     "|",*10,"|",*26,"Stock On Hand in W/H   : ",KEY12:
                      *80,"|",*95,"|",*108,"|",*132,"|"
            ADD       ONE,CLNO
          ENDIF
.
          IF        SIPRBQT=0
            PRINT   "|",*10,"|",*80,"|",*95,"|",*108,"|",*132,"|"
          ELSE
            MOVE      "9,999,999.99",KEY12
            FEDIT     SIPRBQT,KEY12
            MATCH     "*",KEY12
            IF        @EQUAL
              MOVE      "999999999.99",KEY12
              FEDIT     SIPRBQT,KEY12
            ENDIF
            PRINT   "|",*10,"|",*26,"Quantity on Back Order : ",KEY12:
                     *80,"|",*95,"|",*108,"|",*132,"|"
            PRINT   "|",*10,"|",*80,"|",*95,"|",*108,"|",*132,"|"
            ADD       ONE,CLNO
          ENDIF
          ADD       THREE,CLNO
          ADD       SIRBAMT,TOTALOUT
.
PLINR900  IF        EXPORTYN=1
            CALL      EXPTR000
          ENDIF
          MOVE      ZERO,EMPTYREC
.
PLINR999  RETURN
.------------------------------------------------------------
. Write Export File for Barcode Device
.------------------------------------------------------------
EXPTR000  MOVE      SIPRCST,EXPCST
          MOVE      SIPRWAR,EXPWAR
          MOVE      SIPRRAC,EXPRAS
          MOVE      SIIECAT,EXPCAT
          MOVE      SIIADES,EXPDES
          MOVE      SIIAISS,EXPISS
          MOVE      SIPRTYP,EXPRTY
          MOVE      SIPRREQ,EXPRNO
          MOVE      SIPRAQT,EXPIQT
          MOVE      SIPRDEL,EXPLOC
          COMPARE   ZERO,SIPRAQT          * Ignore Zero Issue Quantities
          GOTO      EXPTR999 IF EQUAL
          WRITE     EXPORTFL,SEQ;EXPCST,EXPLOC,EXPWAR,EXPRAS,EXPCAT,EXPDES:
                                 EXPISS,EXPRTY,EXPRNO,EXPIQT
EXPTR999  RETURN
.------------------------------------------------------------
. Create & Open Export File
.------------------------------------------------------------
MKEXP000  MOVE      "export",KEY6
          PACK      EXPORTFN,KEY6,PORT
          REP       " 0",EXPORTFN
          PREP      EXPORTFL,EXPORTFN
MKEXP999  RETURN
.------------------------------------------------------------
. Transfer Export File to PC
.------------------------------------------------------------
TREXP000  CLEAR     KEY80
          APPEND    "ibasin43.us1 ",KEY80
          APPEND    EXPORTFN,KEY80
          APPEND    ".txt",KEY80
          RESET     KEY80
          MOVE      ZERO,HLEF
          CALL      GETSCR00
.
          EXECUTE   KEY80,TASKID        * Execute Transfer Command
.
          CALL      PUTSCR00
.
TREXP999  RETURN
.**********************************************************************
. HEAD - Print page header
.**********************************************************************
HEADR000  COMPARE   ZERO,CPAGENO
          CALL      TAILR000 IF NOT EQUAL
          MOVE      SP70,SIWADES
          PACK      KEY5,SIPRWAR,SP70
          CALL      RDSIWA1
.
          MOVE      SP70,SICADESC
          PACK      KEY5,SIPRCST,SP70
          CALL      RDSICA1
.
          MOVE      "- Requisitions      ",CPHDROPT
.
          BRANCH    SNCOPTYP,HEADR200
.
          CALL      HEAD132
          ADD       "6",CLNO
          PRINT     *1,"Cost Centre       : ",SIPRCST,SP2,SICADESC:
                    *N,"Warehouse         : ",SIPRWAR,SP2,SIWADES:
                    *N,"Delivery Address  : ",SICADAD1
.
          MATCH     SP70,SICADAD2
          IF        !@EQUAL
            PRINT     "                  : ",SICADAD2
            ADD       "1",CLNO
          ENDIF
.
          MATCH     SP70,SICADAD3
          IF        !@EQUAL
            PRINT     "                  : ",SICADAD3
            ADD       "1",CLNO
          ENDIF
.
          PRINT     "Delivery Details  : ",SIPRDEL
          CALL      UND132
          PRINT     "|Rack &  | Catalog Description                      ":
                    "                           |    Issue Qty | Delivere":
                    "d  | Req'n Date            |"
          PRINT     "|Shelf   |         Supplier Part Number         Req'":
                    "n Quantity Issue Unit      |              | (If Diff":
                    "er)| Req'n No.   Total Cost|"
          CALL      UND132
          GOTO      HEADR999
.
HEADR200  UNPACK    SIRADAT,CCENT,CYEAR,CMON,CDAY
          CALL      PACDATE
          PRINT     *N,*N,*N,*N,*33,"PICKING SLIP",*71,CDATE:
                    *N,*N,*N,*1,"Department ",SIPRCST:
                    *53,"Requisition No. ",SIPRTYP,SIPRREQ:
                    *N,*12,SICADESC,*52,"Requisition Date ",CPCDATE:
                    *N,SIPRDEL:
                    *N,*1,"========================================":
                             "=======================================":
                    *N,*N,*N,*N,*N
          ADD       ONE,CPAGENO
          MOVE      ZERO,CLNO
          GOTO      HEADR999
.
HEADR999  RETURN
.------------------------------------------------------------
. TAIL - Print page footer
.------------------------------------------------------------
TAILR000  BRANCH    EMPTYREC,TAILR999
.
          BRANCH    SNCOPTYP,TAILR100
.
          MOVE      "999,999,999.99",KEY14
          FEDIT     TOTALOUT,KEY14
          MATCH     "*",KEY14
            IF        @EQUAL
              MOVE      "99999999999.99",KEY14
              FEDIT     TOTALOUT,KEY14
          ENDIF
          MOVE      ZERO,TOTALOUT
.
          CALL      UND132
          PRINT     *92,"| Page Total : ",*118,KEY14,"|":
                    *N,*92,"*---------------------------------------*"
          MOVE      ZERO,EXIT
          PRINT     *N,*N:
                    *21,"------------------",*51,"---------------------":
                    *N,*21,"P I C K E D    B Y",*51,"R E C E I V E D   B Y"
          GOTO      TAILR999
.
TAILR100  PRINT     *45,"=========":
                    *N,*45,TOTAL:
                    *N,*45,"========="
.
          MOVE      ZERO,TOTAL
          ADD       ONE,CLNO
.
          COMPARE   TEN,CLNO
          GOTO      TAILR130 IF NOT LESS
.
TAILR120  PRINT     *N,*N
          ADD       ONE,CLNO
          COMPARE   TEN,CLNO
          GOTO      TAILR120 IF LESS
.
TAILR130  COMPARE   TEN1,CLNO
          GOTO      TAILR140 IF NOT LESS
.
          PRINT     *N,*N
.
TAILR140  PRINT     *N
          GOTO      TAILR999
.
TAILR999  RETURN
.----------------------------------------------------------------
. RANGE - Check Range for Warehouse/Cost Centre/Requisition Type
.----------------------------------------------------------------
RANGE000  MATCH     SP70,ENDWAR
          IF        !@EQUAL
            MATCH     STRWAR,ENDWAR
            IF        @LESS
              DISPLAY   *P1:24,*B,*EF,"Invalid Warehouse Range - ";
              CALL      HITENTER
              MOVE      ONE,EXIT
              GOTO      RANGE999
            ENDIF
          ELSE
            MOVE      Z70,ENDWAR
          ENDIF
.
          MATCH     SP70,TCOST
          IF        !@EQUAL
            MATCH     FCOST,TCOST
            IF        @LESS
              DISPLAY   *P1:24,*B,*EF,"Invalid Cost Centre Range - ";
              CALL      HITENTER
              MOVE      ONE,EXIT
              GOTO      RANGE999
            ENDIF
          ELSE
            MOVE      Z70,TCOST
          ENDIF
.
          MATCH     SP70,ENDREQ
          IF        !@EQUAL
            MATCH     STRREQ,ENDREQ
            IF        @LESS
              DISPLAY   *P1:24,*B,*EF,"Invalid Requisition Type Range - ";
              CALL      HITENTER
              MOVE      ONE,EXIT
              GOTO      RANGE999
            ENDIF
          ELSE
            MOVE      Z70,ENDREQ
          ENDIF
RANGE999  RETURN
.----------------------------------------------------------------
. Get the Part Number for a Catalog Item
.----------------------------------------------------------------
GETPNO00  MOVE      SP70,SIICPNO
          PACK      KEY27,SIIACAT,SIIAPSC,SP70
          CALL      RSSIIC1
          CALL      RKSIIC1
          BRANCH    OVRCD,GETPNO10
          PACK      KEY12,SIICCAT,SIICSUP
          MATCH     KEY12,KEY27
          GOTO      GETPNO99 IF EQUAL
.
GETPNO10  PACK      KEY27,SIIACAT,SP70
          CALL      RSSIIC1
          CALL      RKSIIC1
          BRANCH    OVRCD,GETPNO90
          MATCH     SIICCAT,SIIACAT
          GOTO      GETPNO99 IF EQUAL
GETPNO90  MOVE      SP70,SIICPNO
GETPNO99  RETURN
.------------------------------------------------------------
. Delete Print Spool File
.------------------------------------------------------------
DELPRT00  SPLCLOSE
          PACK        FILENAME,SPLFILE,IBPREXTN
          PREPARE     SPLTFILE,FILENAME
          CLOSE       SPLTFILE
          OPEN        IBASPOL1,"ibaspolf"
          MOVE        SPLFILE,KEY8
          CALL        DESPOL1              * delete from files spooled
          MOVE        SP8,SPLFILE
DELPRT99  RETURN
.------------------------------------------------------------
. Comparing Issue Quantity for Req.Type other than B, I, R, T
.------------------------------------------------------------
CIQT0000  MOVE      ZERO,EXIT
.
. check for Req. Type of B, I, R, or T
.
          MATCH     ANSB,SIRBTYP
          GOTO      CIQT9999 IF EQUAL
.
          MATCH     ANSI,SIRBTYP
          GOTO      CIQT9999 IF EQUAL
.
          MATCH     ANSR,SIRBTYP
          GOTO      CIQT9999 IF EQUAL
.
          MATCH     ANST,SIRBTYP
          GOTO      CIQT9999 IF EQUAL
.
. compare Issue quantity
.
          COMPARE   SIPRAQT,SIRBIQT
          GOTO      CIQT9999 IF EQUAL
.
          ASSIGN    (SIRBAMT/SIRBIQT)*SIPRAQT,F12P2
.
          MOVE      "999,999,999.99",KEY14
          FEDIT     F12P2,KEY14
          MATCH     "*",KEY14
          IF        @EQUAL
            MOVE      "99999999999.99",KEY14
            FEDIT     F12P2,KEY14
          ENDIF
.
          MOVE      ONE,EXIT
.
CIQT9999  RETURN
.
.----------------------------------------------------------------------
. Range of Warehouse Code with security checked
.----------------------------------------------------------------------
EWAR0000  MOVE      "    4",FLDID
          CALL      GETPOSIT
          MOVE      SP70,VAR
          CALL      DISPITEM
.
          PACK      SIWAWAR,SP70
          PACK      SIWADES,SP70
          CALL      KSIWSA00
          BRANCH    EXIT,EWAR0100,EWAR9500
          MOVE      SIWAWAR,STRWAR
          PACK      FROMWAR,SIWAWAR,SP1,SIWADES
          GOTO      EWAR0150
EWAR0100  MOVE      "Start                                         ",FROMWAR
          PACK      STRWAR,SP70
.
EWAR0150  MOVE      FROMWAR,VAR
          CALL      DISPITEM
.
          MOVE      "    5",FLDID
          CALL      GETPOSIT
          MOVE      SP70,VAR
          CALL      DISPITEM
.
          PACK      SIWAWAR,SP70
          PACK      SIWADES,SP70
          CALL      KSIWSA00
          BRANCH    EXIT,EWAR0200,EWAR9500
          MOVE      SIWAWAR,ENDWAR
          PACK      TOWAR,SIWAWAR,SP1,SIWADES
          MATCH     STRWAR,ENDWAR
          GOTO      EWAR9000 IF EQUAL
          GOTO      EWAR9000 IF NOT LESS
          BEEP
          MOVE      "To Warehouse Must Be > From Warehouse - ",DISPMSG
          CALL      MESSAGE1
.
          MOVE      "    5",FLDID
          CALL      GETPOSIT
          MOVE      SP70,VAR
          CALL      DISPITEM
.
          GOTO      EWAR0000
.
EWAR0200  MOVE      "Finish                                        ",TOWAR
          PACK      ENDWAR,Z70
.
EWAR9000  MOVE      "    4",FLDID
          CALL      GETPOSIT
          MOVE      ZERO,EXIT
          GOTO      EWAR9999
.
EWAR9500  MOVE      TWO,EXIT
          GOTO      EWAR9999
.
EWAR9999  RETURN
.
.----------------------------------------------------------------------
. Enter Cost Centre Range
.----------------------------------------------------------------------
ECOS0000  MOVE      "    6",FLDID
          CALL      GETPOSIT
          MOVE      SP70,VAR
          CALL      DISPITEM
.
          MOVE      ZERO,CKEYTYP
          CALL      KSICAA00
          BRANCH    EXIT,ECOS1000,ECOS9500
          MOVE      SICACODE,FCOST
          PACK      FROMCOS,SICACODE,SP1,SICADESC,SP70
          GOTO      ECOS2000
.
ECOS1000  MOVE      SP70,FCOST
          MOVE      "Start                                         ",FROMCOS
.
ECOS2000  MOVE      FROMCOS,VAR
          CALL      DISPITEM
.
          MOVE      "    7",FLDID
          CALL      GETPOSIT
          MOVE      SP70,VAR
          CALL      DISPITEM
.
          MOVE      ZERO,CKEYTYP
          CALL      KSICAA00
          BRANCH    EXIT,ECOS3000,ECOS9500
          MOVE      SICACODE,TCOST
          PACK      TOCOS,SICACODE,SP1,SICADESC,SP70
          MATCH     FCOST,TCOST
          GOTO      ECOS9000 IF EQUAL
          GOTO      ECOS9000 IF NOT LESS
          BEEP
          MOVE      "To Cost Centre Must Be > From Cost Centre - ",DISPMSG
          CALL      MESSAGE1
.
          MOVE      "    7",FLDID
          CALL      GETPOSIT
          MOVE      SP70,VAR
          CALL      DISPITEM
.
          GOTO      ECOS0000
.
ECOS3000  PACK      TCOST,Z70
          MOVE      "Finish                                        ",TOCOS
.
ECOS9000  MOVE      "    6",FLDID
          CALL      GETPOSIT
          MOVE      ZERO,EXIT
          GOTO      ECOS9999
.
ECOS9500  MOVE      TWO,EXIT
.
ECOS9999  RETURN
.
.----------------------------------------------------------------------
. Enter Range of Requisition Type
.----------------------------------------------------------------------
EREQ0000  MOVE      "    8",FLDID
          CALL      GETPOSIT
          MOVE      SP70,VAR
          CALL      DISPITEM
.
          PACK      REQTYPE,SP70
          PACK      SICDDESC,SP70
          CALL      KREQT000
          BRANCH    EXIT,EREQ0100,EREQ9500
          MOVE      REQTYPE,STRREQ
          PACK      FROMREQ,REQTYPE,SP1,SICDDESC
          GOTO      EREQ0150
EREQ0100  MOVE      "Start                                         ",FROMREQ
          PACK      STRREQ,SP70
.
EREQ0150  MOVE      FROMREQ,VAR
          CALL      DISPITEM
.
          MOVE      "    9",FLDID
          CALL      GETPOSIT
          MOVE      SP70,VAR
          CALL      DISPITEM
.
          PACK      REQTYPE,SP70
          PACK      SICDDESC,SP70
          CALL      KREQT000
          BRANCH    EXIT,EREQ0200,EREQ9500
          MOVE      REQTYPE,ENDREQ
          PACK      TOREQ,REQTYPE,SP1,SICDDESC
          MATCH     STRREQ,ENDREQ
          GOTO      EREQ9000 IF EQUAL
          GOTO      EREQ9000 IF NOT LESS
          BEEP
        MOVE    "To Requisition Type Must Be > From Requisition Type - ",DISPMSG
          CALL      MESSAGE1
.
          MOVE      "    9",FLDID
          CALL      GETPOSIT
          MOVE      SP70,VAR
          CALL      DISPITEM
.
          GOTO      EREQ0000
.
EREQ0200  MOVE      "Finish                                        ",TOREQ
          PACK      ENDREQ,Z70
.
EREQ9000  MOVE      "    8",FLDID
          CALL      GETPOSIT
          MOVE      ZERO,EXIT
          GOTO      EREQ9999
.
EREQ9500  MOVE      TWO,EXIT
          GOTO      EREQ9999
.
EREQ9999  RETURN
.----------------------------------------------------------------------
. Keyin Requisition Type
.----------------------------------------------------------------------
KREQT000  MOVE      UNDLN70,REQTYPE
          KEYIN     *PCCOL:CVERT,*DV,REQTYPE:
                    *PCCOL:CVERT,*V2LON,REQTYPE
          PACK      REQTYPE,REQTYPE,SP70
          MOVE      REQTYPE,SICDCODE
.
          MATCH     SP70,SICDCODE
          GOTO      KREQT900 IF EQUAL
.
          CMATCH    EXITCHAR,SICDCODE
          GOTO      KREQT950 IF EQUAL
.
          CMATCH    QUEST,SICDCODE
          GOTO      KREQT010 IF NOT EQUAL
.
          MOVE      "RT ",SICDCATA
          MOVE      CCITEM,SCCITEM
          CALL      HSICDB00
          MOVE      SCCITEM,CCITEM
.
          ENDSET    SICDCODE
          APPEND    SP70,SICDCODE
          RESET     SICDCODE
.
          MATCH     SP70,SICDCODE
          GOTO      KREQT000 IF EQUAL
.
          DISPLAY   *PCCOL:CVERT,*V2LON,SICDCODE
KREQT010
          MOVE      "RT ",SICDCATA
          PACK      KEY6,SICDCATA,SICDCODE
          CALL      RDSICD1
          BRANCH    OVRCD,KREQT800
          MOVE      SICDCODE,REQTYPE
          MATCH     ANSR,REQTYPE         * Type "R" is Reserved for Returns
          GOTO      KREQT700 IF EQUAL
          MOVE      ZERO,EXIT
          GOTO      KREQT999
.
KREQT700  MOVE      "Requisition Type is for Return of Stock - ",DISPMSG
          CALL      MESSAGE1
          GOTO      KREQT000
.
KREQT800  MOVE      "Requisition Type Does Not Exist - ",DISPMSG
          CALL      MESSAGE1
          GOTO      KREQT000
.
KREQT900  MOVE      ONE,EXIT
          GOTO      KREQT999
.
KREQT950  MOVE      TWO,EXIT
.
KREQT999  RETURN
.
.----------------------------------------------------------------------
. Print Requisitions
.----------------------------------------------------------------------
PRNTI000  IF        EXPORTYN=1
            CALL      MKEXP000        * Create Export File
          ENDIF
          PACK      DISPMSG,SP70,SP70
          CALL      MESSAGE2
..          MOVE      "I",STRREQ
..          MOVE      "I",ENDREQ
..          CALL      RANGE000  * Check Warehouse/Cost Centre/Req Type Range.
..          BRANCH    EXIT,PRNTI950
.
          BRANCH    SKPRESET,PRNTI010
.
          CALL      OPNPRINT
          MOVE      ONE,CNOUNDLN                * no underlines
          MOVE      ZERO,CPAGENO                 * reset page no.
          CLOCK     TIME,CTIMEIS                 * get current time
PRNTI010  MOVE      "999",CLNO                   * init last line number
          MOVE      ZERO,TOTALOUT
          MOVE      ZERO,TOTAL
          MOVE      ONE,EMPTYREC
          DISPLAY   *P1:24,*EL,"Generating Imprest     - Warehouse :":
                    *P47:24,"Cost Centre  :";
.
          PACK      KEY83,STRWAR,FCOST,SP70,SP70
          PACK      KEY87,STRWAR,FCOST,SP70,SP70
          PACK      LASTITEM,SP70
          PERFORM   REPTTYPE,RSSIIP1,RSSIIP2
PRNTI100  PERFORM   REPTTYPE,RKSIIP1,RKSIIP2
          BRANCH    OVRCD,PRNTI900
.
          PACK      KEY9,PASSCODE,SIIPWAR,SP70   * check warehouse security
          CALL      RDSIWS1
          BRANCH    OVRCD,PRNTI100
.
          MATCH     SIIPWAR,ENDWAR          * check print range
          GOTO      PRNTI900 IF LESS
          MATCH     FCOST,SIIPCST
          GOTO      PRNTI100 IF LESS
          MATCH     SIIPCST,TCOST
          GOTO      PRNTI100 IF LESS
.
          MATCH     SP70,SIIPPFL       * record already printed ?
          IF        !@EQUAL
            PACK      KEY83,SIIPWAR,SIIPCST,SIIPDEL,SIIPRAC:
                            SIIPCAT,SIIPTYP,SIIPREQ,SP70
            PACK      KEY87,SIIPWAR,SIIPCST,SIIPDEL,SIIPIMP:
                            SIIPRAC,SIIPCAT,SIIPTYP,SIIPREQ,SP70
            PERFORM   REPTTYPE,RLSIIP1,RLSIIP2  * Lock Record
            BRANCH    OVRCD,PRNTI100,PRNTI100
.
            MOVE      SP70,SIIPPFL     * clear port if not locked !!!!!
            PERFORM   REPTTYPE,UPSIIP1,UPSIIP2
          ENDIF
.
          DISPLAY   *P38:24,*V2LON,SIIPWAR,*P61:24,SIIPCST,*P69:24,SIIPCAT;
.
          PACK      KEY8,SIIPTYP,SIIPREQ
          CALL      RDSIRA1            * Read Requisition Details.
          BRANCH    OVRCD,PRNTI100     * Ignore If NOT found.
.
          PACK      KEY20,SIIPTYP,SIIPREQ,SIIPWAR,SIIPCAT
          CALL      RDSIRB1            * Read Requisition Details.
          BRANCH    OVRCD,PRNTI100     * Ignore If NOT found.
.
          PACK      KEY83,SIIPWAR,SIIPCST,SIIPDEL,SIIPRAC:
                          SIIPCAT,SIIPTYP,SIIPREQ,SP70
          PACK      KEY87,SIIPWAR,SIIPCST,SIIPDEL,SIIPIMP:
                          SIIPRAC,SIIPCAT,SIIPTYP,SIIPREQ,SP70
          PERFORM   REPTTYPE,RLSIIP1,RLSIIP2            * Lock Record
          BRANCH    OVRCD,PRNTI100,PRNTI100
.
          MOVE      PORT,SIIPPFL       * mark record as printed
          PERFORM   REPTTYPE,UPSIIP1,UPSIIP2            * Lock Record
.
          PACK      SIRBDAT,CCC,CYY,CMM,CDD
          REP       " 0",SIRBDAT
          CALL      UPSIRB1            * Update Received Date on Req Details
.
.---- print record ----
.
          IF        IMPAGDEL=1
            PACK      KEY60,SIIPWAR,SIIPCST,SIIPDEL,SP70
          ELSE
            PACK      KEY60,SIIPWAR,SIIPCST,SP70
          ENDIF
.
          BRANCH    SNCOPTYP,PRNTI200
.
          MATCH     KEY60,LASTITEM     * start new page ?
          IF        !@EQUAL
            MOVE      "999",CLNO       * Force Page Break on Change of
            MOVE      KEY60,LASTITEM   * Warehouse or Cost Centre
          ENDIF
.
          COMPARE   "50",CLNO
          CALL      HEADI000 IF NOT LESS
          CALL      PLINI000           * Print Details
          GOTO      PRNTI100
.
PRNTI200  MATCH     KEY60,LASTITEM
          IF        !@EQUAL
            CALL      HEADI000
            MOVE      KEY60,LASTITEM
          ENDIF
.
          COMPARE   "10",CLNO
          GOTO      PRNTI300 IF NOT LESS
.
          CALL      PLINI000           * Print Details
          GOTO      PRNTI100
.
PRNTI300  PRINT     *N,*N,*N,*N
          MOVE      ZERO,CPAGENO
          CALL      HEADI000
          CALL      PLINI000
          GOTO      PRNTI100
.
PRNTI900  IF        ZERO=CPAGENO
            DISPLAY   *P1:24,*EL,"No Imprest records selected - ";
            CALL      HITENTER
            MOVE      ONE,RSTIFLAG
          ELSE
            IF        SKPRESET=0
              MOVE      ZERO,CPAGENO
            ENDIF
            IF        EXPORTYN=1
              CALL      TREXP000       * Transfer Export File
            ENDIF
            CALL      RSETI000         * reset if required
          ENDIF
          MOVE      ZERO,EXIT
          GOTO      PRNTI999
PRNTI950  MOVE      ONE,EXIT
PRNTI999  CALL      MESSAGE3
          RETURN
.**********************************************************************
. RSET - Reset if required
.**********************************************************************
RSETI000  CALL      TAILI000
.
          BRANCH    SKPRESET,RSETI999
.
          IF        SNCOPTYP=0
            PRINT     *N,*N,*45,"***  End of Report  ***"
          ELSE
            PRINT     *N,*N,*N,*N,*N,*1,"***  End of Report  ***"
            GOTO      RSETI100
          ENDIF
          IF        EXPORTYN=1
            CALL      DELPRT00
          ELSE
            IF        SNCOASPL<>1
              CALL      CLSPRINT
            ENDIF
          ENDIF
          IF        SNCOASPL<>1
            CALL      OPNPRINT
          ENDIF
          CALL      HEAD132
          PRINT     *40,"Imprest Picking Sheet Options"
          CALL      UND132
          PRINT     "Warehouse        from : ",FROMWAR," to ",TOWAR
          PRINT     "Cost Centre      from : ",FROMCOS," to ",TOCOS
.
.---- check if reset required ----
.
RSETI100  MOVE      "Y",ANS         * Dont Ask Question if Auto Spool ON
          BRANCH    SNCOASPL,RSETI110
          KEYIN     *P1:24,*EL,"Re-set Imprest picking sheets (":
                    *V2LON,"Y",*HOFF,"/",*V2LON,"N",*HOFF,") ? ",*V2LON,ANS;
          PACK      ANS,ANS,SP70
          REP       UPPLOW,ANS
.
RSETI110  MATCH     "Y",ANS
          IF        @EQUAL
            IF        SNCOPTYP=0
              PRINT     *N,*40,"Picking Sheets HAVE been RESET"
              PRINT     *N,*40,"Picking Sheets HAVE been RESET"
              CALL      UND132
            ELSE
              PRINT     *N,*5,"Picking Sheets HAVE been RESET"
            ENDIF
            MOVE      ONE,RESETFLG
            GOTO      RSETI200
          ENDIF
          MATCH     "N",ANS
          IF        @EQUAL
            IF        SNCOPTYP=0
              PRINT     *N,*40,"Picking Sheets have NOT been RESET"
              PRINT     *N,*40,"Picking Sheets have NOT been RESET"
              CALL      UND132
            ELSE
              PRINT     *N,*5,"Picking Sheets have NOT been RESET"
            ENDIF
            MOVE      ZERO,RESETFLG
            GOTO      RSETI200
          ENDIF
          BEEP
          GOTO      RSETI100
.
.---- reset or clear picking sheets ----
.
RSETI200  IF        EXPORTYN=1
            CALL      DELPRT00
          ELSE
            IF        SNCOASPL=1
              CALL      WRSPL000
              CALL      SPLPRINT
            ELSE
              CALL      CLSPRINT
            ENDIF
          ENDIF
          DISPLAY   *P1:24,*EL,"Processing Imprest     - Warehouse :":
                    *P47:24,"Cost Centre  :";
          PACK      KEY83,STRWAR,FCOST,SP70,SP70
          PACK      KEY87,STRWAR,FCOST,SP70,SP70
.
.---- read next record ----
.
RSETI310  PERFORM   REPTTYPE,RSSIIP1,RSSIIP2            * Lock Record
.
RSETI320  PERFORM   REPTTYPE,RKSIIP1,RKSIIP2            * Lock Record
          BRANCH    OVRCD,RSETI999
.
          PACK      KEY9,PASSCODE,SIIPWAR,SP70   * check warehouse security
          CALL      RDSIWS1
          BRANCH    OVRCD,RSETI320
.
          MATCH     SIIPWAR,ENDWAR
          GOTO      RSETI999 IF LESS
          MATCH     SIIPCST,TCOST
          GOTO      RSETI320 IF LESS
          MATCH     PORT,SIIPPFL       * record printed by this port ?
          GOTO      RSETI320 IF NOT EQUAL
.
          DISPLAY   *P38:24,*V2LON,SIIPWAR,*P61:24,SIIPCST,*P69:24,SIIPCAT;
          PACK      KEY83,SIIPWAR,SIIPCST,SIIPDEL,SIIPRAC:
                          SIIPCAT,SIIPTYP,SIIPREQ,SP70
          PACK      KEY87,SIIPWAR,SIIPCST,SIIPDEL,SIIPIMP:
                          SIIPRAC,SIIPCAT,SIIPTYP,SIIPREQ,SP70
          PERFORM   REPTTYPE,RLSIIP1,RLSIIP2            * Lock Record
          BRANCH    OVRCD,RSETI320,RSETI320
.
          IF        RESETFLG=1
            PERFORM   REPTTYPE,DESIIP1,DESIIP2            * Lock Record
          ELSE
            PACK      SIIPPFL,SP70
            PERFORM   REPTTYPE,UPSIIP1,UPSIIP2            * Lock Record
            PERFORM   REPTTYPE,UUSIIP1,UUSIIP2            * Lock Record
            GOTO      RSETI320
          ENDIF
          GOTO      RSETI310
.
RSETI999  RETURN
.**********************************************************************
. PLIN - Print line
.**********************************************************************
PLINI000  PACK      KEY7,SIIPCAT,SP70
          CALL      RDSIIA1
          CALL      GETPNO00   * Get Part Number
.
          MOVE      "99,999,999.99",KEY13
          FEDIT     SIIPRQT,KEY13
          MATCH     "*",KEY13
          IF        @EQUAL
            MOVE      "9999999999.99",KEY13
            FEDIT     SIIPRQT,KEY13
          ENDIF
.
          MOVE      "9,999,999.99",KEY12
          FEDIT     SIIPAQT,KEY12
          MATCH     "*",KEY12
          IF        @EQUAL
            MOVE      "999999999.99",KEY12
            FEDIT     SIIPAQT,KEY12
          ENDIF
.
          MOVE      "999,999,999.99",KEY14
          FEDIT     SIRBAMT,KEY14
          MATCH     "*",KEY14
          IF        @EQUAL
            MOVE      "99999999999.99",KEY14
            FEDIT     SIRBAMT,KEY14
          ENDIF
.
          UNPACK    SIRADAT,CCENT,CYEAR,CMON,CDAY
          CALL      PACDATE
.
          BRANCH    SNCOPTYP,PLINI100
.
          PRINT     "|",SIIPRAC,"| ",SIIPCAT,SP1,SIIADES,"|":
                    SIIPIMP,*85,"|",*99,"|",*109,"|",CPCDATE,*132,"|"
          PRINT     "|",*10,"|",*20,SIICPNO,KEY13,SP1,SIIAISS," |",*85,"|":
                    KEY12," |",*109,"|",SIIPTYP,SIIPREQ,KEY14,"|"
          MATCH     SP70,SIIPRESI
          IF        !@EQUAL
            PRINT     "|",*10,"|",*20,"Restock ID : ",SIIPRESI:
                      *80,"|",*85,"|",*99,"|",*109,"|",*132,"|"
            ADD       ONE,CLNO
          ENDIF
          GOTO      PLINI200
.
PLINI100  MOVE      ZERO,SIIESOH
          PACK      KEY12,SIIPCAT,SIIPWAR,SP70
          CALL      RDSIIE1
          MOVE      SIIESOH,FORM5
          MOVE      SIIPAQT,FORM12P6
          MULT      SIIAAVC,FORM12P6
          MOVE      FORM12P6,FORM5P2
          UNPACK    SIIADES,KEY30,KEY20,KEY10
          MOVE      SIIPAQT,FORM5A
          MOVE      SIIPBQT,FORM5B
.
          PRINT     *1,SIIPCAT,*10,KEY30,*41,FORM5A,*46,FORM5P2:
                    *55,FORM5B,*62,FORM5,*68,SIIPRAC:
                    *N,*10,SIICPNO,*N
          ADD       ONE,CLNO
          ADD       FORM5P2,TOTAL
          GOTO      PLINI900
.
PLINI200  REP       " 0",SIWAPSH
          MATCH     "1",SIWAPSH
          IF        @EQUAL
            MOVE      ZERO,SIIESOH
            PACK      KEY12,SIIPCAT,SIIPWAR,SP70
            CALL      RDSIIE1
            MOVE      SIIESOH,FORM12
            MOVE      "9999,999,999",KEY12
            FEDIT     FORM12,KEY12
            MATCH     "*",KEY12
            IF        @EQUAL
              MOVE      "999999999999",KEY12
              FEDIT     FORM12,KEY12
            ENDIF
            PRINT     "|",*10,"|",*26,"Stock On Hand in W/H   : ",KEY12:
                      *80,"|",*85,"|",*99,"|",*109,"|",*132,"|"
            ADD       ONE,CLNO
          ENDIF
.
          IF        SIIPBQT=0
            PRINT   "|",*10,"|",*80,"|",*85,"|",*99,"|",*109,"|",*132,"|"
          ELSE
            MOVE      "9,999,999.99",KEY12
            FEDIT     SIIPBQT,KEY12
            MATCH     "*",KEY12
            IF        @EQUAL
              MOVE      "999999999.99",KEY12
              FEDIT     SIIPBQT,KEY12
            ENDIF
            PRINT    "|",*10,"|",*26,"Placed on Back Order   : ",KEY12:
                     *80,"|",*85,"|",*99,"|",*109,"|",*132,"|"
            PRINT   "|",*10,"|",*80,"|",*85,"|",*99,"|",*109,"|",*132,"|"
            ADD       ONE,CLNO
          ENDIF
          ADD       THREE,CLNO
          ADD       SIRBAMT,TOTALOUT
.
PLINI900  IF        EXPORTYN=1
            CALL      EXPTI000
          ENDIF
          MOVE      ZERO,EMPTYREC
.
PLINI999  RETURN
.------------------------------------------------------------
. Write Export File for Barcode Device
.------------------------------------------------------------
EXPTI000  MOVE      SIIPCST,EXPCST
          MOVE      SIIPWAR,EXPWAR
          MOVE      SIIPRAC,EXPRAS
          MOVE      SIIPCAT,EXPCAT
          MOVE      SIIADES,EXPDES
          MOVE      SIIAISS,EXPISS
          MOVE      SIIPTYP,EXPRTY
          MOVE      SIIPREQ,EXPRNO
          MOVE      SIIPAQT,EXPIQT
          MOVE      SIIPDEL,EXPLOC
          COMPARE   ZERO,SIIPAQT          * Ignore Zero Issue Quantities
          GOTO      EXPTI999 IF EQUAL
          WRITE     EXPORTFL,SEQ;EXPCST,EXPLOC,EXPWAR,EXPRAS,EXPCAT,EXPDES:
                                 EXPISS,EXPRTY,EXPRNO,EXPIQT
EXPTI999  RETURN
.**********************************************************************
. HEAD - Print page header
.**********************************************************************
HEADI000  COMPARE   ZERO,CPAGENO
          CALL      TAILI000 IF NOT EQUAL
          MOVE      SP70,SIWADES
          PACK      KEY5,SIIPWAR,SP70
          CALL      RDSIWA1
.
          MOVE      SP70,SICADESC
          PACK      KEY5,SIIPCST,SP70
          CALL      RDSICA1
.
          MOVE      "- Imprest           ",CPHDROPT
.
          BRANCH    SNCOPTYP,HEADI200
.
          CALL      HEAD132
          ADD       "6",CLNO
          PRINT     *1,"Warehouse         : ",SIIPWAR,SP2,SIWADES:
                    *N,"Cost Centre       : ",SIIPCST,SP2,SICADESC:
                    *N,"Report Sequence   : ",REPTDESC," Order":
                    *N,"Delivery Address  : ",SICADAD1
.
          MATCH     SP70,SICADAD2
          IF        !@EQUAL
            PRINT     "                  : ",SICADAD2
            ADD       "1",CLNO
          ENDIF
.
          MATCH     SP70,SICADAD3
          IF        !@EQUAL
            PRINT     "                  : ",SICADAD3
            ADD       "1",CLNO
          ENDIF
          CALL      UND132
          PRINT     "|Rack &  | Catalog Description                  Req'":
                    "n Quantity Issue Unit      |Imp.|   Issue Qty |Delivere":
                    "d|Req'n Date  Total Cost|"
          PRINT     "|Shelf   |         Supplier Part Number             ":
                    "                           |Seq.|             |If Diffe":
                    "r|Req'n No.             |"
          CALL      UND132
          GOTO      HEADI999
.
HEADI200  UNPACK    SIRADAT,CCENT,CYEAR,CMON,CDAY
          CALL      PACDATE
          PRINT     *N,*N,*N,*N,*33,"PICKING SLIP",*71,CDATE:
                    *N,*N,*N,*1,"Department ",SIIPCST:
                    *56,"Requisition No. ",SIIPTYP,SIIPREQ:
                    *N,*12,SICADESC:
                    *N,SIPRDEL:
                    *N,*1,"========================================":
                          "=======================================":
                    *N,*N,*N,*N,*N
          ADD       ONE,CPAGENO
          MOVE      ZERO,CLNO
          GOTO      HEADI999
.
HEADI999  RETURN
.------------------------------------------------------------
. TAIL - Print page footer
.------------------------------------------------------------
TAILI000  BRANCH    EMPTYREC,TAILI999
.
          BRANCH    SNCOPTYP,TAILI100
.
          MOVE      "999,999,999.99",KEY14
          FEDIT     TOTALOUT,KEY14
          MATCH     "*",KEY14
          IF        @EQUAL
            MOVE      "99999999999.99",KEY14
            FEDIT     TOTALOUT,KEY14
          ENDIF
.
          CALL      UND132
          PRINT     *92,"| Page Total : ",*118,KEY14,"|":
                    *N,*92,"*---------------------------------------*"
          MOVE      ZERO,TOTALOUT
          PRINT     *N,*N:
                    *21,"------------------",*51,"---------------------":
                    *N,*21,"P I C K E D    B Y",*51,"R E C E I V E D   B Y"
          GOTO      TAILI999
.
TAILI100  PRINT     *45,"=========":
                    *N,*45,TOTAL:
                    *N,*45,"========="
.
          MOVE      ZERO,TOTAL
          ADD       ONE,CLNO
.
          COMPARE   TEN,CLNO
          GOTO      TAILR130 IF NOT LESS
.
TAILI120  PRINT     *N,*N
          ADD       ONE,CLNO
          COMPARE   TEN,CLNO
          GOTO      TAILI120 IF LESS
.
TAILI130  COMPARE   TEN1,CLNO
          GOTO      TAILI140 IF NOT LESS
.
          PRINT     *N,*N
.
TAILI140  PRINT     *N
          GOTO      TAILI999
.
TAILI999  RETURN
EREPT000  MOVE      "NI",KEY2
          MOVE      "N",REPTDTYP                          * Get default
          KEYIN     *PCCOL:CVERT,*DV,REPTDTYP,"        ": * Read in description
                    *PCCOL:CVERT,*V2LON,*RV,REPTDTYP;
          REP       UPPLOW,REPTDTYP
          SCAN      REPTDTYP,KEY2
          IF        @EQUAL
            MOVE      REPTDTYP,ANS
            REP       "N1I2",ANS
            MOVE      ANS,REPTTYPE
            LOAD      REPTDESC,REPTTYPE,REPTDSC1,REPTDSC2
            DISPLAY   *PCCOL:CVERT,*V2LON,REPTDESC
          ELSE
            BEEP
            GOTO      EREPT000
          ENDIF
.
EREPT999  RETURN
.----------------------------------------------------------------------
. Print Requisitions
.----------------------------------------------------------------------
PRNTB000  IF        EXPORTYN=1
            CALL      MKEXP000        * Create Export File
          ENDIF
          PACK      DISPMSG,SP70,SP70
          CALL      MESSAGE2
..          MOVE      "B",STRREQ
..          MOVE      "B",ENDREQ
..          CALL      RANGE000  * Check Warehouse/Cost Centre/Req Type Range.
..          BRANCH    EXIT,PRNTB950
.
          BRANCH    SKPRESET,PRNTB010
.
          CALL      OPNPRINT
          MOVE      ONE,CNOUNDLN                * no underlines
          MOVE      ZERO,CPAGENO                 * reset page no.
          CLOCK     TIME,CTIMEIS                 * get current time
PRNTB010  MOVE      "999",CLNO                   * init last line number
          MOVE      ZERO,TOTALOUT
          MOVE      ZERO,TOTAL
          MOVE      ONE,EMPTYREC
          DISPLAY   *P1:24,*EL,"Generating Back Order  - Warehouse :":
                    *P47:24,"Cost Centre  :";
.
          PACK      KEY83,STRWAR,FCOST,SP70,SP70
          PACK      LASTITEM,SP70
          CALL      RSSIBP1
PRNTB100  CALL      RKSIBP1
          BRANCH    OVRCD,PRNTB900
.
          PACK      KEY9,PASSCODE,SIBPWAR,SP70   * check warehouse security
          CALL      RDSIWS1
          BRANCH    OVRCD,PRNTB100
.
          MATCH     SIBPWAR,ENDWAR          * check print range
          GOTO      PRNTB900 IF LESS
          MATCH     FCOST,SIBPCST
          GOTO      PRNTB100 IF LESS
          MATCH     SIBPCST,TCOST
          GOTO      PRNTB100 IF LESS
.
          MATCH     SP70,SIBPPFL       * record already printed ?
          IF        !@EQUAL
            PACK      KEY83,SIBPWAR,SIBPCST,SIBPDEL,SIBPRAC:
                            SIBPCAT,SIBPTYP,SIBPREQ,SP70
            CALL      RLSIBP1            * Lock Record
            BRANCH    OVRCD,PRNTB100,PRNTB100
            MOVE      SP70,SIBPPFL     * clear port if not locked !!!!!
            CALL      UPSIBP1
          ENDIF
.
          DISPLAY   *P38:24,*V2LON,SIBPWAR,*P61:24,SIBPCST,*P69:24,SIBPCAT;
.
          PACK      KEY8,SIBPTYP,SIBPREQ
          CALL      RDSIRA1            * Read Requisition Details.
          BRANCH    OVRCD,PRNTB100     * Ignore If NOT found.
.
          PACK      KEY20,SIBPTYP,SIBPREQ,SIBPWAR,SIBPCAT
          CALL      RDSIRB1            * Read Requisition Details.
          BRANCH    OVRCD,PRNTB100     * Ignore If NOT found.
.
          PACK      KEY83,SIBPWAR,SIBPCST,SIBPDEL,SIBPRAC:
                          SIBPCAT,SIBPTYP,SIBPREQ,SP70
          CALL      RLSIBP1            * Lock Record
          BRANCH    OVRCD,PRNTB100,PRNTB100
.
          MOVE      PORT,SIBPPFL       * mark record as printed
          CALL      UPSIBP1            * Update
....      CALL      UUSIBP1            * Dont Unlock !!!!!!
          PACK      SIRBDAT,CCC,CYY,CMM,CDD
          REP       " 0",SIRBDAT
          CALL      UPSIRB1            * Update Received Date on Req Details
.
.---- print record ----
.
          BRANCH    SNCOPTYP,PRNTB200
.
          PACK      KEY60,SIBPWAR,SIBPCST,SIBPDEL,SP70
          MATCH     KEY60,LASTITEM     * start new page ?
          IF        !@EQUAL
            MOVE      "999",CLNO       * Force Page Break on Change of
            MOVE      KEY60,LASTITEM   * Warehouse,Cost Centre or Delivery
          ENDIF
.
          COMPARE   "50",CLNO
          CALL      HEADB000 IF NOT LESS
          CALL      PLINB000           * Print Details
          GOTO      PRNTB100
.
PRNTB200  PACK      KEY60,SIBPWAR,SIBPCST,SIBPDEL,SP70
          MATCH     KEY60,LASTITEM     * start new page ?
          IF        !@EQUAL
            CALL      HEADB000
            MOVE      KEY60,LASTITEM   * Warehouse,Cost Centre or Delivery
          ENDIF
.
          COMPARE   TEN,CLNO
          GOTO      PRNTB300 IF NOT LESS
.
          CALL      PLINB000
          GOTO      PRNTB100
.
PRNTB300  PRINT     *N,*N,*N,*N
          MOVE      ZERO,CPAGENO
          CALL      HEADB000
          CALL      PLINB000
          GOTO      PRNTB100
.
PRNTB900  IF        ZERO=CPAGENO
            DISPLAY   *P1:24,*EL,"No Back Order records selected - ";
            CALL      HITENTER
            MOVE      ONE,RSTBFLAG
          ELSE
            MOVE      ZERO,CPAGENO
            IF        EXPORTYN=1
              CALL      TREXP000       * Transfer Export File
            ENDIF
            CALL      RSETB000         * reset if required
          ENDIF
          MOVE      ZERO,EXIT
          GOTO      PRNTB999
PRNTB950  MOVE      ONE,EXIT
PRNTB999  CALL      MESSAGE3
          RETURN
.**********************************************************************
. RSET - Reset if required
.**********************************************************************
RSETB000  CALL      TAILB000
.
          BRANCH    SKPRESET,RSETB999
.
          IF        SNCOPTYP=0
            PRINT     *N,*N,*45,"***  End of Report  ***"
          ELSE
            PRINT     *N,*N,*N,*N,*N,*N,*45,"***  End of Report  ***"
            GOTO      RSETB100
          ENDIF
          IF        EXPORTYN=1
            CALL      DELPRT00
          ELSE
            IF        SNCOASPL<>1
              CALL      CLSPRINT
            ENDIF
          ENDIF
          IF        SNCOASPL<>1
            CALL      OPNPRINT
          ENDIF
          CALL      HEAD132
          PRINT     *40,"Back Order Picking Sheet Options"
          CALL      UND132
          PRINT     "Warehouse        from : ",FROMWAR," to ",TOWAR
          PRINT     "Cost Centre      from : ",FROMCOS," to ",TOCOS
.
.---- check if reset required ----
.
RSETB100  MOVE      "Y",ANS     * Dont Ask question if Auto Spool ON
          BRANCH    SNCOASPL,RSETB110
          KEYIN     *P1:24,*EL,"Re-set Back Order picking sheets (":
                    *V2LON,"Y",*HOFF,"/",*V2LON,"N",*HOFF,") ? ",*V2LON,ANS;
          PACK      ANS,ANS,SP70
          REP       UPPLOW,ANS
RSETB110  MATCH     "Y",ANS
          IF        @EQUAL
            IF        SNCOPTYP=0
              PRINT     *N,*40,"Picking Sheets HAVE been RESET"
              PRINT     *N,*40,"Picking Sheets HAVE been RESET"
              CALL      UND132
            ELSE
              PRINT     *N,*5,"Picking Sheets HAVE been RESET"
            ENDIF
            MOVE      ONE,RESETFLG
            GOTO      RSETB200
          ENDIF
          MATCH     "N",ANS
          IF        @EQUAL
            IF        SNCOPTYP=0
              PRINT     *N,*40,"Picking Sheets have NOT been RESET"
              PRINT     *N,*40,"Picking Sheets have NOT been RESET"
              CALL      UND132
            ELSE
              PRINT     *N,*5,"Picking Sheets have NOT been RESET"
            ENDIF
            MOVE      ZERO,RESETFLG
            GOTO      RSETB200
          ENDIF
          BEEP
          GOTO      RSETB100
.
.---- reset or clear picking sheets ----
.
RSETB200  IF        EXPORTYN=1
            CALL      DELPRT00
          ELSE
            IF        SNCOASPL=1
              CALL      WRSPL000
              CALL      SPLPRINT
            ELSE
              CALL      CLSPRINT
            ENDIF
          ENDIF
          DISPLAY   *P1:24,*EL,"Processing Back Order  - Warehouse :":
                    *P47:24,"Cost Centre  :";
          PACK      KEY83,STRWAR,FCOST,SP70,SP70
.
.---- read next record ----
.
RSETB310  CALL      RSSIBP1
.
RSETB320  CALL      RKSIBP1
          BRANCH    OVRCD,RSETB999
.
          PACK      KEY9,PASSCODE,SIBPWAR,SP70   * check warehouse security
          CALL      RDSIWS1
          BRANCH    OVRCD,RSETB320
.
          MATCH     SIBPWAR,ENDWAR
          GOTO      RSETB999 IF LESS
          MATCH     SIBPCST,TCOST
          GOTO      RSETB320 IF LESS
          MATCH     PORT,SIBPPFL       * record printed by this port ?
          GOTO      RSETB320 IF NOT EQUAL
.
          DISPLAY   *P38:24,*V2LON,SIBPWAR,*P61:24,SIBPCST,*P69:24,SIBPCAT;
          PACK      KEY83,SIBPWAR,SIBPCST,SIBPDEL,SIBPRAC:
                          SIBPCAT,SIBPTYP,SIBPREQ,SP70
          CALL      RLSIBP1
          BRANCH    OVRCD,RSETB320,RSETB320
          IF        RESETFLG=1
            CALL      DESIBP1
          ELSE
            PACK      SIBPPFL,SP70
            CALL      UPSIBP1
            CALL      UUSIBP1
            GOTO      RSETB320
          ENDIF
          GOTO      RSETB310
.
RSETB999  RETURN
.**********************************************************************
. PLIN - Print line
.**********************************************************************
PLINB000  PACK      KEY7,SIBPCAT,SP70
          CALL      RDSIIA1
          CALL      GETPNO00   * Get Part Number
.
          MOVE      "99,999,999.99",KEY13
          FEDIT     SIBPRQT,KEY13
          MATCH     "*",KEY13
          IF        @EQUAL
            MOVE      "9999999999.99",KEY13
            FEDIT     SIBPRQT,KEY13
          ENDIF
.
          MOVE      "9,999,999.99",KEY12
          FEDIT     SIBPAQT,KEY12
          MATCH     "*",KEY12
          IF        @EQUAL
            MOVE      "999999999.99",KEY12
            FEDIT     SIBPAQT,KEY12
          ENDIF
.
          MOVE      "999,999,999.99",KEY14
          FEDIT     SIRBAMT,KEY14
          MATCH     "*",KEY14
          IF        @EQUAL
            MOVE      "99999999999.99",KEY14
            FEDIT     SIRBAMT,KEY14
          ENDIF
.
          UNPACK    SIRADAT,CCENT,CYEAR,CMON,CDAY
          CALL      PACDATE
.
          BRANCH    SNCOPTYP,PLINB100
.
          PRINT     "|",SIBPRAC,"| ",SIBPCAT,SP1,SIIADES,"|",*95,"|":
                    *108,"| ",CPCDATE,*132,"|"
          PRINT     "|",*10,"|",*20,SIICPNO,KEY13,SP1,SIIAISS," | ",KEY12," | ":
                    *108,"| ",SIBPTYP,SIBPREQ,KEY14,"|"
          PRINT     "|",*10,"| ",SIRADEL,*80,"|",*95,"|",*108,"|",*132,"|"
          MATCH     SP70,SIBPRESI
          IF        !@EQUAL
            PRINT     "|",*10,"|",*20,"Restock ID : ",SIBPRESI:
                      *80,"|",*95,"|",*108,"|",*132,"|"
            ADD       ONE,CLNO
          ENDIF
          GOTO      PLINB200
.
PLINB100  MOVE      ZERO,SIIESOH
          PACK      KEY12,SIBPCAT,SIBPWAR,SP70
          CALL      RDSIIE1
          MOVE      SIIESOH,FORM5
          MOVE      SIIAAVC,FORM12P6
          MULT      SIBPAQT,FORM12P6
          MOVE      FORM12P6,FORM5P2
          UNPACK    SIIADES,KEY30,KEY20,KEY10
          MOVE      SIBPAQT,FORM5A
          MOVE      SIBPBQT,FORM5B
.
          PRINT     *1,SIBPCAT,*10,KEY30,*40,FORM5A,*46,FORM5P2:
                    *55,FORM5B,*62,FORM5,*68,SIBPRAC:
                    *N,*10,SIICPNO,*N
          ADD       ONE,CLNO
          ADD       FORM5P2,TOTAL
          GOTO      PLINB900
.
PLINB200  REP       " 0",SIWAPSH
          MATCH     "1",SIWAPSH
          IF        @EQUAL
            MOVE      ZERO,SIIESOH
            PACK      KEY12,SIBPCAT,SIBPWAR,SP70
            CALL      RDSIIE1
            MOVE      SIIESOH,FORM12
            MOVE      "9999,999,999",KEY12
            FEDIT     FORM12,KEY12
            MATCH     "*",KEY12
            IF        @EQUAL
              MOVE      "999999999999",KEY12
              FEDIT     FORM12,KEY12
            ENDIF
            PRINT     "|",*10,"|",*26,"Stock On Hand in W/H   : ",KEY12:
                      *80,"|",*95,"|",*108,"|",*132,"|"
            ADD       ONE,CLNO
          ENDIF
.
          IF        SIBPBQT=0
            PRINT   "|",*10,"|",*80,"|",*95,"|",*108,"|",*132,"|"
          ELSE
            MOVE      "9,999,999.99",KEY12
            FEDIT     SIBPBQT,KEY12
            MATCH     "*",KEY12
            IF        @EQUAL
              MOVE      "999999999.99",KEY12
              FEDIT     SIBPBQT,KEY12
            ENDIF
            PRINT   "|",*10,"|",*26,"Remaining on Back Order: ",KEY12:
                     *80,"|",*95,"|",*108,"|",*132,"|"
            PRINT   "|",*10,"|",*80,"|",*95,"|",*108,"|",*132,"|"
            ADD       ONE,CLNO
          ENDIF
          ADD       FOUR,CLNO
          ADD       SIRBAMT,TOTALOUT
.
PLINB900  IF        EXPORTYN=1
            CALL      EXPTB000
          ENDIF
          MOVE      ZERO,EMPTYREC
.
PLINB999  RETURN
.------------------------------------------------------------
. Write Export File for Barcode Device
.------------------------------------------------------------
EXPTB000  MOVE      SIBPCST,EXPCST
          MOVE      SIBPWAR,EXPWAR
          MOVE      SIBPRAC,EXPRAS
          MOVE      SIIECAT,EXPCAT
          MOVE      SIIADES,EXPDES
          MOVE      SIIAISS,EXPISS
          MOVE      SIBPTYP,EXPRTY
          MOVE      SIBPREQ,EXPRNO
          MOVE      SIBPAQT,EXPIQT
          MOVE      SIBPDEL,EXPLOC
          COMPARE   ZERO,SIBPAQT          * Ignore Zero Issue Quantities
          GOTO      EXPTB999 IF EQUAL
          WRITE     EXPORTFL,SEQ;EXPCST,EXPLOC,EXPWAR,EXPRAS,EXPCAT,EXPDES:
                                 EXPISS,EXPRTY,EXPRNO,EXPIQT
EXPTB999  RETURN
.**********************************************************************
. HEAD - Print page header
.**********************************************************************
HEADB000  COMPARE   ZERO,CPAGENO
          CALL      TAILB000 IF NOT EQUAL
          MOVE      SP70,SIWADES
          PACK      KEY5,SIBPWAR,SP70
          CALL      RDSIWA1
.
          MOVE      SP70,SICADESC
          PACK      KEY5,SIBPCST,SP70
          CALL      RDSICA1
.
          MOVE      "- Backorder         ",CPHDROPT
.
          BRANCH    SNCOPTYP,HEADB200
.
          CALL      HEAD132
          ADD       "5",CLNO
          PRINT     *1,"Warehouse         : ",SIBPWAR,SP2,SIWADES:
                    *N,"Cost Centre       : ",SIBPCST,SP2,SICADESC:
                    *N,"Delivery Address  : ",SICADAD1
.
          MATCH     SP70,SICADAD2
          IF        !@EQUAL
            PRINT     "                  : ",SICADAD2
            ADD       "1",CLNO
          ENDIF
.
          MATCH     SP70,SICADAD3
          IF        !@EQUAL
            PRINT     "                  : ",SICADAD3
            ADD       "1",CLNO
          ENDIF
.
          PRINT     "Delivery Details  : ",SIBPDEL
          CALL      UND132
          PRINT     "|Rack &  | Catalog Description                  Req'":
                    "n Quantity Issue Unit      |    Issue Qty | Delivere":
                    "d  | Req'n Date  Total Cost|"
          PRINT     "|Shelf   |         Supplier Part Number             ":
                    "                           |              | (If Diff":
                    "er)| Req'n No.             |"
          CALL      UND132
          GOTO      HEADB999
.
HEADB200  UNPACK    SIRADAT,CCENT,CYEAR,CMON,CDAY
          CALL      PACDATE
          PRINT     *N,*N,*N,*N,*33,"PICKING SLIP",*71,CDATE:
                    *N,*N,*N,*1,"Department ",SIBPCST:
                    *53,"Requisition No. ",SIBPTYP,SIBPREQ:
                    *N,*12,SICADESC,*52,"Requisition Date ",CPCDATE:
                    *N,SIBPDEL:
                    *N,*1,"========================================":
                             "=======================================":
                    *N,*N,*N,*N,*N
          ADD       ONE,CPAGENO
          MOVE      ZERO,CLNO
          GOTO      HEADB999
.
HEADB999  RETURN
.------------------------------------------------------------
. TAIL - Print page footer
.------------------------------------------------------------
TAILB000  BRANCH    EMPTYREC,TAILB999
.
          BRANCH    SNCOPTYP,TAILB100
.
          MOVE      "999,999,999.99",KEY14
          FEDIT     TOTALOUT,KEY14
          MATCH     "*",KEY14
          IF        @EQUAL
            MOVE      "99999999999.99",KEY14
            FEDIT     TOTALOUT,KEY14
          ENDIF
.
          CALL      UND132
          PRINT     *92,"| Page Total : ",*118,KEY14,"|":
                    *N,*92,"*---------------------------------------*"
          MOVE      ZERO,TOTALOUT
          PRINT     *N,*N:
                    *21,"------------------",*51,"---------------------":
                    *N,*21,"P I C K E D    B Y",*51,"R E C E I V E D   B Y"
          GOTO      TAILB999
.
TAILB100  PRINT     *45,"=========":
                    *N,*45,TOTAL:
                    *N,*45,"========="
.
          MOVE      ZERO,TOTAL
          ADD       ONE,CLNO
.
          COMPARE   TEN,CLNO
          GOTO      TAILB130 IF NOT LESS
.
TAILB120  PRINT     *N,*N
          ADD       ONE,CLNO
          COMPARE   TEN,CLNO
          GOTO      TAILB120 IF LESS
.
TAILB130  COMPARE   TEN1,CLNO
          GOTO      TAILB140 IF NOT LESS
.
          PRINT     *N,*N
.
TAILB140  PRINT     *N
          GOTO      TAILB999
.
TAILB999  RETURN
.------------------------------------------------------------
. Write Spool Record
.------------------------------------------------------------
WRSPL000  OPEN      IBASPOL1,"ibaspolf"
          MOVE      SPLFILE,KEY8
          CALL      RDSPOL1
          BRANCH    OVRCD OF WRSPL100
          CALL      DESPOL1
.
WRSPL100  DISPLAY   *P1:24,*EL,"Generated Spoolfile is ",*V2LON,SPLFILE;
          MOVE      CDD,CDAY
          MOVE      CMM,CMON
          MOVE      CCC,CCENT
          MOVE      CYY,CYEAR
          CALL      PACDATE
          CLEAR     CSPDESC
          APPEND    "Pick Sheet-",CSPDESC
          APPEND    CPCDATE,CSPDESC
          APPEND    " at ",CSPDESC
          CLOCK     TIME,CTIMEIS
          APPEND    CTIMEIS,CSPDESC
          RESET     CSPDESC
          DISPLAY   *P33:24,"Description : ":
                    *P47:24,*V2LON,CSPDESC;
.
          PACK      CSPDATE,CCC,CYY,CMM,CDD,SP70
          REP       " 0",CSPDATE
.
          CLOCK     TIME,CSPTIME
          MOVE      PASSCODE,CSPOPER
.
          MOVE      SPLFILE,CSPNAME
          MOVE      SPLFILE,KEY8
          MOVE      CPROGLEV,CSPLEVE
          MOVE      CDEPCDE,CSPDEPT
.
          CALL      WRSPOL1
.
          CLOSE     IBASPOL1
.
          RETURN
.
.----------------------------------------------------------------------
. Print All Requisitions
.----------------------------------------------------------------------
PRNTA000  MOVE      SP70,STRREQ
          MOVE      Z70,ENDREQ
.
          MOVE      ZERO,EXPORTYN           * Export is disabled
          MOVE      ONE,SKPRESET            * Reset is skipped for temporary
.
          CALL      PRNTR000                * print internal requisitions
.
          MOVE      ONE,REPTTYPE            * Report Sequence, set to Normal
          CALL      PRNTI000                * print imprest requisitions
.
          CALL      PRNTB000                * print back order requisitions
.
          CALL      RSET0000                * reset ALL if required
.
PRNTA999  RETURN
.----------------------------------------------------------------------
. Reset ALL if required
.----------------------------------------------------------------------
RSET0000  IF        RSTBFLAG=1 & RSTIFLAG=1 & RSTNFLAG=1
            GOTO      RSET9999
          ENDIF
          IF        SNCOPTYP=0
            PRINT     *N,*N,*45,"***  End of Report  ***"
          ELSE
            PRINT     *N,*N,*N,*N,*N,*1,"***  End of Report  ***"
            GOTO      RSET0100
          ENDIF
          IF        EXPORTYN=1
            CALL      DELPRT00
          ELSE
            IF        SNCOASPL<>1
              CALL      CLSPRINT
            ENDIF
          ENDIF
          IF        SNCOASPL<>1
            CALL      OPNPRINT
          ENDIF
          CALL      HEAD132
          PRINT     *40,"ALL Requisition Picking Sheet Options"
          CALL      UND132
          PRINT     "Warehouse        from : ",FROMWAR," to ",TOWAR
          PRINT     "Cost Centre      from : ",FROMCOS," to ",TOCOS
          PRINT     "Requisition Type from : ",FROMREQ,"     to ",TOREQ
.
.---- check if reset required ----
.
RSET0100  MOVE      "Y",ANS       * Dont ask Question of Auto Spooling ON
          BRANCH    SNCOASPL,RSET0110
          KEYIN     *P1:24,*EL,"Re-set ALL Requisition picking sheets (":
                    *V2LON,"Y",*HOFF,"/",*V2LON,"N",*HOFF,") ? ",*V2LON,ANS;
          PACK      ANS,ANS,SP70
          REP       UPPLOW,ANS
.
RSET0110  MATCH     "Y",ANS
          IF        @EQUAL
            IF        SNCOPTYP=0
              PRINT     *N,*40,"Picking Sheets HAVE been RESET"
              PRINT     *N,*40,"Picking Sheets HAVE been RESET"
              CALL      UND132
            ELSE
              PRINT     *N,*5,"Picking Sheets HAVE been RESET"
            ENDIF
            MOVE      ONE,RESETFLG
            GOTO      RSET0200
          ENDIF
          MATCH     "N",ANS
          IF        @EQUAL
            IF        SNCOPTYP=0
              PRINT     *N,*40,"Picking Sheets have NOT been RESET"
              PRINT     *N,*40,"Picking Sheets have NOT been RESET"
              CALL      UND132
            ELSE
              PRINT     *N,*5,"Picking Sheets have NOT been RESET"
            ENDIF
            MOVE      ZERO,RESETFLG
            GOTO      RSET0200
          ENDIF
          BEEP
          GOTO      RSET0100
.
.---- reset or clear picking sheets ----
.
RSET0200  IF        EXPORTYN=1
            CALL      DELPRT00
          ELSE
            IF        SNCOASPL=1
              CALL      WRSPL000
              CALL      SPLPRINT
            ELSE
              CALL      CLSPRINT
            ENDIF
          ENDIF
.----------------------------------------------------------------------
. Reset for Internal Requisitions
.----------------------------------------------------------------------
          BRANCH    RSTNFLAG,RSET2000
.
          DISPLAY   *P1:24,*EL,"Processing Internal    - Warehouse :":
                    *P47:24,"Cost Centre  :";
          PACK      KEY83,STRWAR,FCOST,SP70,SP70
.
.---- read next record ----
.
RSET1100  CALL      RSSIPR1
.
RSET1200  CALL      RKSIPR1
          BRANCH    OVRCD,RSET2000
.
          PACK      KEY9,PASSCODE,SIPRWAR,SP70   * check warehouse security
          CALL      RDSIWS1
          BRANCH    OVRCD,RSET1200
.
          MATCH     SIPRWAR,ENDWAR
          GOTO      RSET2000 IF LESS
          MATCH     SIPRCST,TCOST
          GOTO      RSET1200 IF LESS
          MATCH     PORT,SIPRPFL       * record printed by this port ?
          GOTO      RSET1200 IF NOT EQUAL
.
          DISPLAY   *P38:24,*V2LON,SIPRWAR,*P61:24,SIPRCST,*P69:24,SIPRCAT;
          PACK      KEY83,SIPRWAR,SIPRCST,SIPRDEL,SIPRRAC:
                          SIPRCAT,SIPRTYP,SIPRREQ,SP70
          CALL      RLSIPR1
          BRANCH    OVRCD,RSET1200,RSET1200
          IF        RESETFLG=1
            CALL      DESIPR1
          ELSE
            PACK      SIPRPFL,SP70
            CALL      UPSIPR1
            CALL      UUSIPR1
            GOTO      RSET1200
          ENDIF
          GOTO      RSET1100
.----------------------------------------------------------------------
. Reset for Imprest Requisitions
.----------------------------------------------------------------------
RSET2000  BRANCH    RSTIFLAG,RSET3000
.
          DISPLAY   *P1:24,*EL,"Processing Imprest     - Warehouse :":
                    *P47:24,"Cost Centre  :";
          PACK      KEY83,STRWAR,FCOST,SP70,SP70
          PACK      KEY87,STRWAR,FCOST,SP70,SP70
.
.---- read next record ----
.
RSET2100  PERFORM   REPTTYPE,RSSIIP1,RSSIIP2            * Lock Record
.
RSET2200  PERFORM   REPTTYPE,RKSIIP1,RKSIIP2            * Lock Record
          BRANCH    OVRCD,RSET3000
.
          PACK      KEY9,PASSCODE,SIIPWAR,SP70   * check warehouse security
          CALL      RDSIWS1
          BRANCH    OVRCD,RSET2200
.
          MATCH     SIIPWAR,ENDWAR
          GOTO      RSET3000 IF LESS
          MATCH     SIIPCST,TCOST
          GOTO      RSET2200 IF LESS
          MATCH     PORT,SIIPPFL       * record printed by this port ?
          GOTO      RSET2200 IF NOT EQUAL
.
          DISPLAY   *P38:24,*V2LON,SIIPWAR,*P61:24,SIIPCST,*P69:24,SIIPCAT;
          PACK      KEY83,SIIPWAR,SIIPCST,SIIPDEL,SIIPRAC:
                          SIIPCAT,SIIPTYP,SIIPREQ,SP70
          PACK      KEY87,SIIPWAR,SIIPCST,SIIPDEL,SIIPIMP:
                          SIIPRAC,SIIPCAT,SIIPTYP,SIIPREQ,SP70
          PERFORM   REPTTYPE,RLSIIP1,RLSIIP2            * Lock Record
          BRANCH    OVRCD,RSET2200,RSET2200
.
          IF        RESETFLG=1
            PERFORM   REPTTYPE,DESIIP1,DESIIP2            * Lock Record
          ELSE
            PACK      SIIPPFL,SP70
            PERFORM   REPTTYPE,UPSIIP1,UPSIIP2            * Lock Record
            PERFORM   REPTTYPE,UUSIIP1,UUSIIP2            * Lock Record
            GOTO      RSET2200
          ENDIF
          GOTO      RSET2100
.----------------------------------------------------------------------
. Reset for Back Order Requisitions
.----------------------------------------------------------------------
RSET3000  BRANCH    RSTBFLAG,RSET9999
.
          DISPLAY   *P1:24,*EL,"Processing Back Order  - Warehouse :":
                    *P47:24,"Cost Centre  :";
          PACK      KEY83,STRWAR,FCOST,SP70,SP70
.
.---- read next record ----
.
RSET3100  CALL      RSSIBP1
.
RSET3200  CALL      RKSIBP1
          BRANCH    OVRCD,RSET9999
.
          PACK      KEY9,PASSCODE,SIBPWAR,SP70   * check warehouse security
          CALL      RDSIWS1
          BRANCH    OVRCD,RSET3200
.
          MATCH     SIBPWAR,ENDWAR
          GOTO      RSET9999 IF LESS
          MATCH     SIBPCST,TCOST
          GOTO      RSET3200 IF LESS
          MATCH     PORT,SIBPPFL       * record printed by this port ?
          GOTO      RSET3200 IF NOT EQUAL
.
          DISPLAY   *P38:24,*V2LON,SIBPWAR,*P61:24,SIBPCST,*P69:24,SIBPCAT;
          PACK      KEY83,SIBPWAR,SIBPCST,SIBPDEL,SIBPRAC:
                          SIBPCAT,SIBPTYP,SIBPREQ,SP70
          CALL      RLSIBP1
          BRANCH    OVRCD,RSET3200,RSET3200
          IF        RESETFLG=1
            CALL      DESIBP1
          ELSE
            PACK      SIBPPFL,SP70
            CALL      UPSIBP1
            CALL      UUSIBP1
            GOTO      RSET3200
          ENDIF
          GOTO      RSET3100
.
RSET9999  RETURN
.
.-------------------------------
. Includes for I/O and Keyins
.-------------------------------
          INC       IBAPRINT    
          INC       IBAPRNIO/INC
          INC       SINBPSIO/INC
          INC       SINCCAIO/INC
          INC       SINCCAKY    
          INC       SINCIAIO/INC
          INC       SINCICIO/INC
          INC       SINCIEIO/INC
          INC       SINCODIO/INC
          INC       SINCODKY    
          INC       SINIPSIO/INC
          INC       SINNATIO/INC
          INC       SINPRQIO/INC
          INC       SINREAIO/INC
          INC       SINREBIO/INC
          INC       SINWARIO/INC
          INC       SINWSEIO/INC
          INC       SINWSEKY    
.
          INC       STDGENCD
.
