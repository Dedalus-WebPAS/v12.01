.------------------------------------------------------------------------------
. Program       : COMWEB01
.
. Function      : System Maintenance Server for 
.                 Report 1: Common Category Maintenance                    
.                 Report 2: Common Codes Maintenance                    
.                 Report 3: Remote Script to validate Common Category Codes
.                 Report 4: GST Codes/Rates Maintenance
.                 Report 5: BAS Codes Maintenance
.
. Modifications :
.------------------------------------------------------------------------------
. V11.03.01 19/12/2022  Bella Turco    TSK 0921957
.           Continued adding PTCNNRTD & NOMORE00 to maintenance lists 
. V11.02.01 02/08/2022  Bella Turco    TSK 0921957
.           Added NOMORE00 - Display "No more records" at end of list
.           Added PTCNNRTD - Displays number of rows set by parameter
.           value
. V10.04.01 31.03.2014  B.G.Ackland  CAR 299363
.           Replace META Tag Redirect with Javascript in Common RSAVED00
.           Routine
.------------------------------------------------------------------------------
. V9.05.01  09/03/2006  Ebon Clements CAR 78533
.           Mods for PATCODTM - Hospital specific category codes
. V9.05.B02 30/01/2006  Ebon Clements CAR 93186
.           Mods for REDIRECT length change. Recompiled for IBAWEBDF
. V9.04.01  10/11/2005  Peter Vela               CAR 75644
.           Fixed entry of % in GST CODES/RATES Maintenance
.           GSTRAT70,GSTRAT71
.           RATRW000,GSTRW000
. V9.03.02  04/06/2004  Pat Dirito               CAR 49842
.           Added Option 5 BAS Codes Maintenance
. V9.03.01  19/05/2004  Pat Dirito               CAR 49842
.           Added Option 4 GST Code/Rates Maintenance
.
.------------------------------------------------------------------------------
. FD Includes
.------------------------------------------------------------------------------
.
          INC       IBAWEBDF
          INC       WEBDATDF
          INC       RSHWEBDF
.
          INC       PATCOMM/INC       * IBA Control file
.
          INC       COMCODTD/INC
          INC       PATCONFD/INC      * Patient Control file
          INC       IBAGSTFD/INC      * GST Master
          INC       IBAGEDFD/INC      * GST Rates File
          INC       IBABASFD/INC      * BAS Codes File
.
.-----------------------------------------------------------------------------
. Variable Declarations
.-----------------------------------------------------------------------------
.
. CGI Parameters
. **************
.
NEXTPAGE  FORM      1         * Nextpage parameter
UPDTTYPE  DIM       1         * Update Type (A)dd,(U)pdate,(D)elete,Blank=disp
STARTKEY  DIM       3         * Starting Key for search
VALDCODE  DIM       70        * Validation Code
ALWINACT  FORM      1         * Allow inactive in validation 0=No 1=Yes
.
.
. GST CODE/RATE VARS
.
IBAGD001  DIM       6      * GST Code
IBAGD002  DIM       8      * Effective Date (CCYYMMDD)
IBAGD003  FORM      3.2    * GST Percentage
IBAGD004  DIM       30     * GST Code Description
IBAGD005  DIM       1      * Active/Inactive (1=Inactive)
IBAGD006  DIM       3      * Bas Code
.
. GST BAS CODE VARS
.
IBBAC001  DIM       3      3        1     BAS Code
IBBAC002  DIM       30     30       4     BAS Description
IBBAC003  FORM      1      2        34    Active/Inactive (1 - Inactive)
IBBAC004  DIM       1      1        36    Bas Code Type
.
. 
. Program Variables
. *****************
.
ACTIVE    DIM       3
BASTYPE   DIM       20
CATEDESC  DIM       25       * Current CMCDTCOD for Next & Prev pages
CURRDATE  DIM       8   
CURRCODE  DIM       2        * Current CMCDTCOD for Next & Prev pages
DISPFMDT  DIM       11       
DISPTODT  DIM       11       
BASCODE   DIM       3
LNK2PRT   FORM      1
SAVKEY3   DIM       3         
SAVCODE   DIM       6
.
DIM6      DIM       6
.
. Program Constants
. *****************
FIVE9     FORM      "59"
SEVEN9    FORM      "79"
NBSP      INIT      "&nbsp;"
TYPEDES0  INIT      "GST Type Unknown"
TYPEDES1  INIT      "GST Payable     "
TYPEDES2  INIT      "GST Receivable  "
+
.-----------------------------------------------------------------------------
.
PRGID     INIT      "COMWEB01"
VERSION   INIT      "V12.01.00"
PRGNAM    INIT      "System Maintenance Server"
+
.------------------------------------------------------------------------------
.
          CALL      WEBINT00                * Initialise Fifo Etc.
          CALL      INIT0000                * Open Files
.
MAIN1000  CALL      WEBRED00                * Read Fifo WEBPID and USERID
.
          COMPARE   "999",REPORTNO          * End Server Process if Option=999
          GOTO      MAIN9999 IF EQUAL
.
          BRANCH    REPORTNO,MAIN1100,MAIN1200,MAIN1300,MAIN1400,MAIN1500
          PACK      WEBTITLE,PRGID,SP1,VERSION,SP1,PRGNAM,SP70
          MOVE      "Invalid Option",WEBTITLE
          CALL      WEBERR00                * Output File & Write HTML Pg Header
          GOTO      MAIN1000
.
MAIN1100  CALL      COMCAT00                * Common Category Maintenance  
          BRANCH    EXIT,MAIN1000
          CALL      NXTPG000                * next page
          GOTO      MAIN1000
. 
MAIN1200  CALL      COMCOD00                * Common Codes Maintenance  
          BRANCH    EXIT,MAIN1000
          CALL      NXTPG000                * next page
          GOTO      MAIN1000
. 
MAIN1300  CALL      VALCOD00                * Remote script - Common Cat Codes
          GOTO      MAIN1000
.
MAIN1400  CALL      GSTRAT00                * GST Codes/Rates Maintenance
          BRANCH    EXIT,MAIN1000
          CALL      NXTPG000                * next page
          GOTO      MAIN1000
.
MAIN1500  CALL      IBABAS00                * BAS Code Maintenance
          BRANCH    EXIT,MAIN1000
          CALL      NXTPG000                * next page
          GOTO      MAIN1000
.
MAIN9999  MOVE      "SERVER SHUTDOWN COMPLETE",WEBTITLE
          CALL      WEBERR00
          STOP
+
.------------------------------------------------------------------------------
.  Next Page URL
.------------------------------------------------------------------------------
.
NXTPG000  IF        NEXTPAGE=0
            CALL      WINCLS00              * Refresh parent and close window
          ENDIF

          IF        NEXTPAGE=1
            CALL      RSAVED00              * Redirect URL
          ENDIF
.
          IF        NEXTPAGE=2
            CALL      GOBACK00              * Go Back 1 html page
          ENDIF
.
          IF        NEXTPAGE=3
            CALL      DAH20000              * Go Back 2 html pages
          ENDIF
.
NXTPG999  RETURN
.------------------------------------------------------------------------------
.  Goes back 1 page
.------------------------------------------------------------------------------
GOBACK00  CALL      OPENHTML
          BRANCH    EXIT,GOBACK99
          WRITE     HTMLFILE;"<script type=#"text/javascript#"> {":
                             "    alert(#"",WEBTITLE,"#");":
                             "    self.close();":
                             "    opener.history.go(-1);":
                             "}":
                             "</script>"

          CALL      CLOSHTML
.
GOBACK99  RETURN
+
.------------------------------------------------------------------------------
. Open Files and Initialize Variables
.------------------------------------------------------------------------------
.
INIT0000  OPEN      WEBSECA1,"websecaf"
          OPEN      WEBSECA3,"websecaf"
.
          OPEN      PATCODE1,"patcodes"
          OPEN      PATCODE2,"patcodes"
.
          OPEN      COMCODA1,"comcodaf"
          OPEN      COMCODA2,"comcodaf"
          OPEN      COMCODA3,"comcodaf"
          OPEN      COMCODA4,"comcodaf"
          OPEN      COMCODA5,"comcodaf"
          OPEN      COMCODA6,"comcodaf"
.
          OPEN      IBAGSTA1,"ibagstaf"
          OPEN      IBAGEDA1,"ibagedaf"
          OPEN      IBABASA1,"ibabasaf"
.
.     * Open and Read the Control file variables
.
          OPEN      CONTROLF,"controlf"
          READ      CONTROLF,ZERO;*43,IBCNMHOS
          READ      CONTROLF,HUND25;*238,PTCNNRTD
.
          MOVE      ZERO,F2
          MOVE      PTCNNRTD,F2
          IF        F2 = 0
            MOVE      "10",PTCNNRTD
          ENDIF
.
          IF        IBCNMHOS=1
            OPEN      MLTCODA1,"mltcodaf"
            OPEN      MLTCODA2,"mltcodaf"
          ENDIF
.
INIT9999  RETURN
+
.------------------------------------------------------------------------------
. Clear Parameters
.------------------------------------------------------------------------------
CLRPAR00  MOVE      ZERO,REPORTNO
          MOVE      SP70,TEMPLATE
          MOVE      SP70,UPDTTYPE
          MOVE      ZERO,NEXTPAGE
          PACK      REDIRECT,SP70,SP70,SP70,SP70
          MOVE      ZERO,STARTNUM
          MOVE      ZERO,NORECORD
          MOVE      SP70,STARTKEY
          MOVE      SP70,VALDCODE
          MOVE      ZERO,ALWINACT
          MOVE      SP70,CODEDATE
.
          MOVE      SP70,CMCOD001
          MOVE      SP70,CMCOD002
          MOVE      SP70,CMCOD003
          MOVE      SP70,CMCOD004
          MOVE      SP70,CMCOD005
          MOVE      SP70,CMCOD006
          MOVE      ZERO,CMCOD007
          MOVE      SP70,CMCOD008
          MOVE      SP70,CMCOD009
          MOVE      SP70,CMCOD010
          MOVE      SP70,CMCOD011
          MOVE      SP70,CMCOD012
          MOVE      SP70,CMCOD013
          MOVE      SP70,CMCOD014
          MOVE      SP70,CMCOD015
          MOVE      SP70,CMCOD016
          MOVE      SP70,CMCOD017
          MOVE      SP70,CMCOD018
          MOVE      SP70,CMCOD019
          MOVE      SP70,CMCOD020
          MOVE      SP70,CMCOD021
          MOVE      SP70,CMCOD022
.
          MOVE      SP70,IBAGD001
          MOVE      SP70,IBAGD002
          MOVE      ZERO,IBAGD003
          MOVE      SP70,IBAGD004
          MOVE      SP70,IBAGD005
          MOVE      SP70,IBAGD006
.
          MOVE      SP70,IBBAC001
          MOVE      SP70,IBBAC002
          MOVE      ZERO,IBBAC003
          MOVE      SP70,IBBAC004
.
CLRPAR99  RETURN
+
.------------------------------------------------------------------------------
. Set Parameters
.------------------------------------------------------------------------------
.
SETPAR00  MATCH     "reportno=",QRYNAME
          IF        @EQUAL
            MOVE      QRYDATA,REPORTNO
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "template=",QRYNAME
          IF        @EQUAL
            MOVE      QRYDATA,TEMPLATE
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "updttype=",QRYNAME
          IF        @EQUAL
            MOVE      QRYDATA,UPDTTYPE
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "nextpage=",QRYNAME
          IF        @EQUAL
            MOVE      QRYDATA,NEXTPAGE
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "startkey=",QRYNAME
          IF        @EQUAL
            MOVE      QRYDATA,STARTKEY
            PACK      STARTKEY,STARTKEY,SP70
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "redirect=",QRYNAME
          IF        @EQUAL
            MOVE      QRYDATA,REDIRECT
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "norecord=",QRYNAME
          IF        @EQUAL
            MOVE      QRYDATA,NORECORD
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "startnum=",QRYNAME
          IF        @EQUAL
            MOVE      QRYDATA,STARTNUM
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "cmcod",QRYNAME
          IF        @EQUAL
            CALL      STCCD000
            COMPARE   ZERO,EXIT
            GOTO      SETPAR99 IF EQUAL
          ENDIF
.
          MATCH     "valdcode=",QRYNAME
          IF        @EQUAL
            MOVE      QRYDATA,VALDCODE
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "alwinact=",QRYNAME
          IF        @EQUAL
            MOVE      QRYDATA,ALWINACT
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "codedate=",QRYNAME
          IF        @EQUAL
            UNPACK    QRYDATA,CDAY,KEY1,MTHNAM3,KEY1,CCENT,CYEAR
            CALL      SETMTH00            * Set CMON from MTHNAM3
            PACK      CODEDATE,CCENT,CYEAR,CMON,CDAY
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "ibagd",QRYNAME
          IF        @EQUAL
            CALL      STRAT000
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "ibbac",QRYNAME
          IF        @EQUAL
            CALL      STBAS000
            GOTO      SETPAR99
          ENDIF
.
SETPAR99  RETURN
+
.-------------------------------------------------------------------------------
.   Set Parameters for Common Codes Table
.-------------------------------------------------------------------------------
STCCD000  MOVE      ZERO,EXIT
          UNPACK    QRYNAME,KEY5,KEY3
          MOVE      KEY3,F3
          BRANCH    F3,STCCD001,STCCD002,STCCD003,STCCD004,STCCD005:
                       STCCD006,STCCD007,STCCD008,STCCD009,STCCD010:
                       STCCD011,STCCD012,STCCD013,STCCD014,STCCD015:
                       STCCD016,STCCD017,STCCD018,STCCD019,STCCD020:
                       STCCD021,STCCD022
.
          MOVE      ONE,EXIT
          GOTO      STCCD999
.
STCCD001  SQUEEZE   QRYDATA
          MOVE      QRYDATA,CMCOD001
          PACK      CMCOD001,CMCOD001,SP70
          GOTO      STCCD999
STCCD002  MOVE      QRYDATA,CMCOD002
          GOTO      STCCD999
STCCD003  MOVE      QRYDATA,CMCOD003
          GOTO      STCCD999
STCCD004  MOVE      QRYDATA,CMCOD004
          GOTO      STCCD999
STCCD005  UNPACK    QRYDATA,CDAY,KEY1,MTHNAM3,KEY1,CCENT,CYEAR
          CALL      SETMTH00            * Set CMON from MTHNAM3
          PACK      CMCOD005,CCENT,CYEAR,CMON,CDAY
          GOTO      STCCD999
STCCD006  UNPACK    QRYDATA,CDAY,KEY1,MTHNAM3,KEY1,CCENT,CYEAR
          CALL      SETMTH00            * Set CMON from MTHNAM3
          PACK      CMCOD006,CCENT,CYEAR,CMON,CDAY
          GOTO      STCCD999
STCCD007  MOVE      QRYDATA,CMCOD007
          GOTO      STCCD999
STCCD008  MOVE      QRYDATA,CMCOD008
          GOTO      STCCD999
STCCD009  MOVE      QRYDATA,CMCOD009
          GOTO      STCCD999
STCCD010  MOVE      QRYDATA,CMCOD010
          GOTO      STCCD999
STCCD011  MOVE      QRYDATA,CMCOD011
          GOTO      STCCD999
STCCD012  MOVE      QRYDATA,CMCOD012
          GOTO      STCCD999
STCCD013  MOVE      QRYDATA,CMCOD013
          GOTO      STCCD999
STCCD014  MOVE      QRYDATA,CMCOD014
          GOTO      STCCD999
STCCD015  MOVE      QRYDATA,CMCOD015
          GOTO      STCCD999
STCCD016  MOVE      QRYDATA,CMCOD016
          GOTO      STCCD999
STCCD017  MOVE      QRYDATA,CMCOD017
          GOTO      STCCD999
STCCD018  MOVE      QRYDATA,CMCOD018
          GOTO      STCCD999
STCCD019  MOVE      QRYDATA,CMCOD019
          GOTO      STCCD999
STCCD020  MOVE      QRYDATA,CMCOD020
          GOTO      STCCD999
STCCD021  MOVE      QRYDATA,CMCOD021
          GOTO      STCCD999
STCCD022  MOVE      QRYDATA,CMCOD022
          GOTO      STCCD999
.
STCCD999  RETURN
+
.-------------------------------------------------------------------------------
.   Set Parameters for Option 4 - GST Codes/Rates Maintenance
.-------------------------------------------------------------------------------
STRAT000  UNPACK    QRYNAME,KEY5,KEY3
          MOVE      KEY3,F3
          BRANCH    F3,STRAT001,STRAT002,STRAT003,STRAT004,STRAT005,STRAT006
.
          GOTO      STRAT999
.
STRAT001  MOVE      QRYDATA,IBAGD001
          PACK      IBAGD001,IBAGD001,SP70
          GOTO      STRAT999
.
STRAT002  MOVE      QRYDATA,KEY11   * Change Date as format is (DD MON CCYY)
          PACK      KEY11,KEY11,SP70
          UNPACK    KEY11,KEY8,KEY3
          MATCH     SP70,KEY3
          IF        !@EQUAL
            UNPACK    QRYDATA,CDAY,KEY1,MTHNAM3,KEY1,CCENT,CYEAR
            CALL      SETMTH00
            PACK      IBAGD002,CCENT,CYEAR,CMON,CDAY
            REP       " 0",IBAGD002
          ELSE
            MOVE      QRYDATA,IBAGD002
            PACK      IBAGD002,IBAGD002,SP70
          ENDIF
          GOTO      STRAT999
.
STRAT003  MOVE      QRYDATA,IBAGD003
          GOTO      STRAT999
.
STRAT004  MOVE      QRYDATA,IBAGD004
          GOTO      STRAT999
.
STRAT005  MOVE      QRYDATA,IBAGD005
          GOTO      STRAT999
.
STRAT006  MOVE      QRYDATA,IBAGD006
          GOTO      STRAT999
.
STRAT999  RETURN
.-------------------------------------------------------------------------------
.   Set Parameters for Option 5 - BAS Codes Maintenance
.-------------------------------------------------------------------------------
STBAS000  UNPACK    QRYNAME,KEY5,KEY3
          MOVE      KEY3,F3
          BRANCH    F3,STBAS001,STBAS002,STBAS003,STBAS004
.
          GOTO      STBAS999
.
STBAS001  MOVE      QRYDATA,IBBAC001
          PACK      IBBAC001,IBBAC001,SP70
          GOTO      STBAS999
.
STBAS002  MOVE      QRYDATA,IBBAC002
          GOTO      STBAS999
.
STBAS003  MOVE      QRYDATA,IBBAC003
          GOTO      STBAS999
.
STBAS004  MOVE      QRYDATA,IBBAC004
          GOTO      STBAS999
.
STBAS999  RETURN
.------------------------------------------------------------------------------
. Common Category Codes Maintenance 
.------------------------------------------------------------------------------
.
COMCAT00  RESET     UPDTTYPE
          MATCH     SP1,UPDTTYPE            * Display formaction
          GOTO      COMCAT40 IF EQUAL
.
          MATCH     "A",UPDTTYPE            * 
          GOTO      COMCAT10 IF EQUAL
.
          MATCH     "U",UPDTTYPE            *
          GOTO      COMCAT20 IF EQUAL
.
          MATCH     "D",UPDTTYPE            * 
          GOTO      COMCAT30 IF EQUAL
.
          GOTO      COMCAT90
.
.
COMCAT10  CALL      CHKCAT00      * Checks mandatory fields
          BRANCH    EXIT,COMCAT99
          RESET     CMCOD001
          PACK      KEY5,CMCOD001,SP70
          CALL      RDCMCOD1
          COMPARE   ZERO,OVRCD
          GOTO      COMCAT92 IF EQUAL
.
          CALL      CATSAV00      * Moves input variables to file variables
          PACK      KEY5,CMCOD001,SP70
          CALL      WRCMCOD1       * Writes away the data
          MOVE      ZERO,EXIT
          GOTO      COMCAT99
.
COMCAT20  PACK      KEY5,CMCOD001,SP70   * Update Formaction
          CALL      RDCMCOD1
          BRANCH    OVRCD,COMCAT91
          CALL      CHKCAT00      * Checks mandatory fields
          BRANCH    EXIT,COMCAT99
          CALL      CATSAV00      * Moves input variables to file variables
          CALL      UPCMCOD1       * Writes away the data
          MOVE      ZERO,EXIT
          GOTO      COMCAT99
.
COMCAT30  PACK      KEY5,CMCOD001,SP70   * Delete Formaction
          CALL      RDCMCOD1
          BRANCH    OVRCD,COMCAT91
          CALL      RSCMCODE1
COMCAT31  CALL      RKCMCODE1
          BRANCH    OVRCD,COMCAT32
          MATCH     CMCOD001,CMCDTCOD
          GOTO      COMCAT32 IF NOT EQUAL
          PACK      KEY5,CMCDTCOD,CMCDACOD
          CALL      DECMCOD1       * Does Cascading delete on Codes
          GOTO      COMCAT31
.
COMCAT32  PACK      KEY5,CMCOD001,SP70   * Delete Category
          CALL      DECMCOD1
          MOVE      ZERO,EXIT
          GOTO      COMCAT99
.
.         ************ DISPLAY FORMACTION **********
.
COMCAT40  PACK      KEY5,CMCOD001,SP70
          CALL      RDCMCOD1
          IF        OVRCD=1
            CALL      CLRCOD00    * Clear all the file variables
          ENDIF
.
          CLEAR     WEBTITLE
          MOVE      "Common Codes Maintenance",WEBTITLE
          RESET     WEBTITLE
.
          CALL      WEBHED00                * Output File & Write HTML Pg Header
          BRANCH    EXIT,COMCAT99
.
          CALL      WEBBOD00                * Process Web Body
.
          CALL      WEBEND00                * Process End of HTML File
.
          MOVE      ONE,EXIT
          GOTO      COMCAT99
.
.         ************ DISPLAY ERROR MESSAGE **********
.
COMCAT90  MOVE      "Invalid Form Action.",WEBTITLE
          CALL      WEBERR00
          MOVE      ONE,EXIT
          GOTO      COMCAT99
.
COMCAT91  MOVE      "Category does not exist",WEBTITLE
          CALL      WEBERR00
          MOVE      ONE,EXIT
          GOTO      COMCAT99
.
COMCAT92  MOVE      "Category record exists",WEBTITLE
          CALL      WEBERR00
          MOVE      ONE,EXIT
          GOTO      COMCAT99
.
COMCAT99  RETURN
+
.------------------------------------------------------------
. * Checks mandatory fields
.------------------------------------------------------------
CHKCAT00  RESET     CMCOD001
          MATCH     SP70,CMCOD001
          GOTO      CHKCAT90 IF EQUAL
.
          RESET     CMCOD003
          MATCH     SP70,CMCOD003
          GOTO      CHKCAT91 IF EQUAL
.
          GOTO      CHKCAT98
.
CHKCAT90  MOVE      "Category cannot be blank!",WEBTITLE
          CALL      WEBERR00
          MOVE      ONE,EXIT
          GOTO      CHKCAT99
.
CHKCAT91  MOVE      "Category Description is mandatory!",WEBTITLE
          CALL      WEBERR00
          MOVE      ONE,EXIT
          GOTO      CHKCAT99
.
CHKCAT98  MOVE      ZERO,EXIT
CHKCAT99  RETURN
.------------------------------------------------------------
. Moves cgi variables into file variables
.------------------------------------------------------------
CATSAV00  MOVE      CMCOD001,KEY2
          SQUEEZE   KEY2
          MOVE      KEY2,CMCDTCOD
          MOVE      SP70,CMCDACOD
          MOVE      CMCOD003,CMCDDESC
          MOVE      CMCOD004,CMCDHDPE
          MOVE      CMCOD005,CMCDFMDT
          MOVE      CMCOD006,CMCDTODT
          MOVE      ZERO,CMCDASSC
          MOVE      SP70,CMCDNATE
          MOVE      SP70,CMCDSI01
          MOVE      SP70,CMCDSI02
          MOVE      SP70,CMCDSI03
          MOVE      SP70,CMCDSI04
          MOVE      SP70,CMCDSI05
          MOVE      SP70,CMCDSI06
          MOVE      SP70,CMCDSI07
          MOVE      SP70,CMCDSI08
          MOVE      SP70,CMCDSI09
          MOVE      SP70,CMCDSI10
          MOVE      SP70,CMCDSI11
          MOVE      SP70,CMCDGRPV
          MOVE      SP70,CMCDDEFT
          MOVE      SP70,CMCDSECL
          MOVE      SP70,CMCDSPAR
.
CATSAV99  RETURN
.------------------------------------------------------------
. Code Records: Display,Add,Update,Delete
.------------------------------------------------------------
COMCOD00  RESET     UPDTTYPE
          MATCH     SP1,UPDTTYPE
          GOTO      COMCOD40 IF EQUAL
.
          MATCH     "A",UPDTTYPE    * Add formaction
          GOTO      COMCOD10 IF EQUAL
.
          MATCH     "U",UPDTTYPE    * Update formaction
          GOTO      COMCOD20 IF EQUAL
.
          MATCH     "D",UPDTTYPE    * Delete formaction
          GOTO      COMCOD30 IF EQUAL
.
          GOTO      COMCOD93
.
COMCOD10  CALL      CHKCOD00      * Checks mandatory fields & for Blank
          BRANCH    EXIT,COMCOD99
          PACK      KEY5,CMCOD001,CMCOD002,SP70
          CALL      RDCMCOD1
          COMPARE   ZERO,OVRCD
          GOTO      COMCOD92 IF EQUAL
          CALL      CODSAV00      * Moves input variables to file variables
          PACK      KEY5,CMCOD001,CMCOD002,SP70
          CALL      WRCMCOD1       * Writes away the data
          MOVE      ZERO,EXIT
          GOTO      COMCOD99
.
COMCOD20  PACK      KEY5,CMCOD001,CMCOD002,SP70
          CALL      RDCMCOD1
          BRANCH    OVRCD,COMCOD91
          CALL      CHKCOD00      * Checks mandatory fields
          BRANCH    EXIT,COMCOD99
          CALL      CODSAV00      * Moves input variables to file variables
          CALL      UPCMCOD1       * Writes away the data
          MOVE      ZERO,EXIT
          GOTO      COMCOD99
.
COMCOD30  PACK      KEY5,CMCOD001,CMCOD002,SP70
          CALL      RDCMCOD1
          BRANCH    OVRCD,COMCOD91
          CALL      DECMCOD1       * Writes away the data
          MOVE      ZERO,EXIT
          GOTO      COMCOD99
.
COMCOD40  PACK      KEY5,CMCOD001,SP70
          CALL      RDCMCOD1
          BRANCH    OVRCD,COMCOD94
          MOVE      CMCDTCOD,CURRCODE    * Current CMCDTCOD for Next & Prev pages
          MOVE      CMCDDESC,CATEDESC    * Current Category Description
.
          PACK      KEY5,CMCOD001,CMCOD002,SP70
          CALL      RDCMCOD1
          IF        OVRCD=1
            CALL      CLRCOD00    * Clear all the file variables
          ENDIF
.
          MATCH     SP70,CMCOD002
          IF        @EQUAL
            CALL      CLRCOD00    * Clear all the file variables
          ENDIF
.
          CLEAR     WEBTITLE
          MOVE      "Common Code Record Maintenance",WEBTITLE
          RESET     WEBTITLE
.
          CALL      WEBHED00   * Create Output File and Write HTML Page Header
          BRANCH    EXIT,COMCOD99
          CALL      WEBBOD00   * Process Web Body
          CALL      WEBEND00   * Process End of HTML File
          MOVE      ONE,EXIT
          GOTO      COMCOD99
.
COMCOD91  MOVE      "Code Record does not exist",WEBTITLE
          CALL      WEBERR00
          MOVE      ONE,EXIT
          GOTO      COMCOD99
.
COMCOD92  MOVE      "Code Record exists",WEBTITLE
          CALL      WEBERR00
          MOVE      ONE,EXIT
          GOTO      COMCOD99
.
COMCOD93  MOVE      "Invalid Form Action.",WEBTITLE
          CALL      WEBERR00
          MOVE      ONE,EXIT
          GOTO      COMCOD99
.
COMCOD94  MOVE      "Invalid Category.",WEBTITLE
          CALL      WEBERR00
          MOVE      ONE,EXIT
          GOTO      COMCOD99
.
COMCOD99  RETURN
.-----------------------------------------------------------
. Initialize's file data
.-----------------------------------------------------------
CLRCOD00  MOVE      SP70,CMCDTCOD
          MOVE      SP70,CMCDACOD
          MOVE      SP70,CMCDDESC
          MOVE      SP70,CMCDHDPE
          MOVE      SP70,CMCDFMDT
          MOVE      SP70,CMCDTODT
          MOVE      SP70,CMCDNATE
          MOVE      ZERO,CMCDASSC
          MOVE      SP70,CMCDSI01
          MOVE      SP70,CMCDSI02
          MOVE      SP70,CMCDSI03
          MOVE      SP70,CMCDSI04
          MOVE      SP70,CMCDSI05
          MOVE      SP70,CMCDSI06
          MOVE      SP70,CMCDSI07
          MOVE      SP70,CMCDSI08
          MOVE      SP70,CMCDSI09
          MOVE      SP70,CMCDSI10
          MOVE      SP70,CMCDSI11
          MOVE      SP70,CMCDGRPV
          MOVE      Z70,CMCDDEFT
          MOVE      SP70,CMCDSECL
          MOVE      SP70,CMCDSPAR
.
CLRCOD99  RETURN
.------------------------------------------------------------
. Moves cgi variables into file variables
.------------------------------------------------------------
CODSAV00  MOVE      CMCOD001,KEY2
          SQUEEZE   KEY2
          MOVE      KEY2,CMCDTCOD
          MOVE      CMCOD002,CMCDACOD
          MOVE      CMCOD003,CMCDDESC
          MOVE      CMCOD004,CMCDHDPE
          MOVE      CMCOD005,CMCDFMDT
          MOVE      CMCOD006,CMCDTODT
          MOVE      CMCOD007,CMCDASSC
          MOVE      CMCOD008,CMCDNATE
.
          MOVE      CMCOD009,CMCDSI01
          MOVE      CMCOD010,CMCDSI02
          MOVE      CMCOD011,CMCDSI03
          MOVE      CMCOD012,CMCDSI04
          MOVE      CMCOD013,CMCDSI05
          MOVE      CMCOD014,CMCDSI06
          MOVE      CMCOD015,CMCDSI07
          MOVE      CMCOD016,CMCDSI08
          MOVE      CMCOD017,CMCDSI09
          MOVE      CMCOD018,CMCDSI10
          MOVE      CMCOD019,CMCDSI11
          MOVE      CMCOD020,CMCDGRPV
.
          MATCH     Z70,CMCOD021
          IF        !@EQUAL
            MOVE      CMCOD021,CMCDDEFT
          ELSE
            MOVE      ZERO,CMCDDEFT
          ENDIF
.
          MATCH     SP2,CMCOD022
          IF        @EQUAL
            MOVE      SP2,CMCDSECL
          ELSE
            MOVE      ZERO,F2
            MOVE      CMCOD022,F2
            MOVE      F2,CMCDSECL
          ENDIF
.
          MOVE      SP70,TCSPARE

.
CODSAV99  RETURN
.------------------------------------------------------------
. * Checks mandatory fields
.------------------------------------------------------------
CHKCOD00  RESET     CMCOD002
          MATCH     SP70,CMCOD002
          GOTO      CHKCOD90 IF EQUAL
.
          RESET     CMCOD003
          MATCH     SP70,CMCOD003
          GOTO      CHKCOD91 IF EQUAL
          GOTO      CHKCOD98
.
CHKCOD90  MOVE      "Code cannot be blank!",WEBTITLE
          CALL      WEBERR00
          MOVE      ONE,EXIT
          GOTO      CHKCOD99
.
CHKCOD91  MOVE      "Code Description is mandatory!",WEBTITLE
          CALL      WEBERR00
          MOVE      ONE,EXIT
          GOTO      CHKCOD99
.
CHKCOD98  MOVE      ZERO,EXIT
CHKCOD99  RETURN
.-----------------------------------------------------------------------------
. Remote Script to validate Common Category/Codes
. Required Parameters: VALDCODE - Category and Code
.                      ALWINACT - Allow validation to include inactive codes
.                                 0 = Check for inactive,  
.                                 1 = Allow inactive codes.
.                      CODEDATE - Date compared for inactive validation.
.-----------------------------------------------------------------------------
VALCOD00  CALL      XMLHED00
          BRANCH    EXIT,VALCOD99
          PACK      KEY5,VALDCODE,SP70
          CALL      RDCMCOD1
          BRANCH    OVRCD,VALCOD90
.
          IF        ALWINACT=0
            MATCH     SP70,CMCDFMDT
            GOTO      VALCOD10 IF EQUAL
            MATCH     CMCDFMDT,CODEDATE
            GOTO      VALCOD91 IF LESS
            MATCH     SP70,CMCDTODT
            GOTO      VALCOD10 IF EQUAL
            MATCH     CODEDATE,CMCDTODT
            GOTO      VALCOD91 IF LESS
          ENDIF
.
VALCOD10  PACK      KEY11,CMCDSI01,CMCDSI02,CMCDSI03,CMCDSI04,CMCDSI05:
                          CMCDSI06,CMCDSI07,CMCDSI08,CMCDSI09,CMCDSI10:
                          CMCDSI11
.
          WRITE     HTMLFILE;"<RETURN_VALUE TYPE=SIMPLE>":
                             CMCDDESC,"|",KEY11,"|",CMCDHDPE,"|",CMCDASSC:
                             "</RETURN_VALUE>"
.
          GOTO      VALCOD98
.
VALCOD90  UNPACK    KEY5,KEY2,KEY3
          WRITE     HTMLFILE;"<RETURN_VALUE TYPE=ERROR>":
                             "Invalid Code - ",KEY3:
                             " Category - ",KEY2,"</RETURN_VALUE>"
          GOTO      VALCOD98
.
VALCOD91  UNPACK    KEY5,KEY2,KEY3
          WRITE     HTMLFILE;"<RETURN_VALUE TYPE=ERROR>":
                             "Code Inactive - ",KEY3:
                             " Category - ",KEY2,"</RETURN_VALUE>"
          GOTO      VALCOD98
.
VALCOD98  CALL      XMLEND00
VALCOD99  RETURN
.------------------------------------------------------------
. GST Codes/Rates Maintenance: Display,Add,Update,Delete
.------------------------------------------------------------
GSTRAT00  CALL      IBACLOCK
          PACK      CURRDATE,CCC,CYY,CMM,CDD
          REP       " 0",CURRDATE 
.
          RESET     UPDTTYPE 
          MATCH     SP1,UPDTTYPE
          GOTO      GSTRAT71 IF EQUAL
.
          MATCH     "A",UPDTTYPE    * Add formaction
          GOTO      GSTRAT10 IF EQUAL
.
          MATCH     "U",UPDTTYPE    * Update formaction
          GOTO      GSTRAT20 IF EQUAL
.
          MATCH     "D",UPDTTYPE    * Delete Single Record Formaction
          GOTO      GSTRAT30 IF EQUAL
.
          MATCH     "L",UPDTTYPE    * Delete All formaction
          GOTO      GSTRAT40 IF EQUAL
.
          MATCH     "B",UPDTTYPE    * Add Effective Date/Rate
          GOTO      GSTRAT50 IF EQUAL
.
          MATCH     "E",UPDTTYPE    * Update Effective Date/Rate
          GOTO      GSTRAT60 IF EQUAL
.
          MATCH     "V",UPDTTYPE    * Display GST Code     
          GOTO      GSTRAT70 IF EQUAL
.
          GOTO      GSTRAT94
.
.  *********** ADD GST CODE FORMACTION ***********
.
GSTRAT10  PACK      KEY6,IBAGD001,SP70   
          CALL      RDIBGS1
          COMPARE   ZERO,OVRCD
          GOTO      GSTRAT95 IF EQUAL
.
          CALL      SAVGST00      * Moves input variables to file variables
          CALL      WRIBGS1       * Writes away the data
.
          PACK      KEY14,IBAGD001,IBAGD002,SP70  
          CALL      RDIBGE1
          COMPARE   ZERO,OVRCD
          GOTO      GSTRAT91 IF EQUAL
.
          CALL      SAVRAT00      * Moves input variables to file variables
          CALL      WRIBGE1       * Writes away the data
.
          MOVE      ZERO,EXIT
          GOTO      GSTRAT99
.
.  *********** UPDATE FORMACTION ************
.
GSTRAT20  PACK      KEY6,IBAGD001,SP70   
          CALL      RDIBGS1
          BRANCH    OVRCD,GSTRAT90
.
          CALL      SAVGST00      * Moves input variables to file variables
          CALL      UPIBGS1       
.
          MOVE      ZERO,EXIT
          GOTO      GSTRAT99
.
.  ********** DELETE EFFECTIVE DATE  FORMACTION ***********
.
GSTRAT30  PACK      KEY6,IBAGD001,SP70   
          CALL      RDIBGS1
          BRANCH    OVRCD,GSTRAT90

          PACK      KEY14,IBAGD001,IBAGD002,SP70  
          CALL      RDIBGE1
          BRANCH    OVRCD,GSTRAT92
.
          MATCH     IBGEEDAT,CURRDATE      * Check if in past or current date?
          GOTO      GSTRAT93 IF NOT LESS
.         
          CALL      DEIBGE1      * Deletes the data
.         
          MOVE      ZERO,EXIT
          GOTO      GSTRAT99
.
.  ********** DELETE ALL FORMACTION ***********
.
GSTRAT40  PACK      KEY6,IBAGD001,SP70   
          CALL      RDIBGS1
          BRANCH    OVRCD,GSTRAT90
.
          CALL      DEIBGS1      * Deletes the data

GSTRAT41  PACK      KEY14,IBAGD001,SP70  
          CALL      RSIBGE1
          CALL      RKIBGE1
          BRANCH    OVRCD,GSTRAT42
.         
          MATCH     IBAGD001,IBGECODE     * GST Code
          GOTO      GSTRAT42 IF NOT EQUAL
.         
          PACK      KEY14,IBGECODE,IBGEEDAT,SP70
          CALL      DEIBGE1      * Deletes the data
          GOTO      GSTRAT41
.         
GSTRAT42  MOVE      ZERO,EXIT
          GOTO      GSTRAT99
.
.  *********** ADD EFFECTIVE DATE/RATE FORMACTION ***********
.
GSTRAT50  PACK      KEY6,IBAGD001,SP70   
          CALL      RDIBGS1
          BRANCH    OVRCD,GSTRAT90
.
          PACK      KEY14,IBAGD001,IBAGD002,SP70  
          CALL      RDIBGE1
          COMPARE   ZERO,OVRCD
          GOTO      GSTRAT91 IF EQUAL
.
          CALL      SAVRAT00      * Moves input variables to file variables
          CALL      WRIBGE1       * Writes away the data
.
          MOVE      ZERO,EXIT
          GOTO      GSTRAT99
.
.  *********** UPDATE EFFECTIVE DATE/RATE FORMACTION ************
.
GSTRAT60  PACK      KEY6,IBAGD001,SP70   
          CALL      RDIBGS1
          BRANCH    OVRCD,GSTRAT90
.
          PACK      KEY14,IBAGD001,IBAGD002,SP70  
          CALL      RDIBGE1
          BRANCH    OVRCD,GSTRAT92
.
          CALL      SAVRAT00      * Moves input variables to file variables
          CALL      UPIBGE1       
.
          MOVE      ZERO,EXIT
          GOTO      GSTRAT99
.
.  ********** DISPLAY FORMACTION ***********
.
GSTRAT70  REP       "~%",IBAGD001
          PACK      KEY6,IBAGD001,SP70   
          CALL      RDIBGS1
          BRANCH    OVRCD,GSTRAT90
.
          GOTO      GSTRAT72
.
GSTRAT71  REP       "~%",IBAGD001
          PACK      KEY6,IBAGD001,SP70
          CALL      RDIBGS1 
          IF        OVRCD=1
            CALL      CLRGST00
          ENDIF
.
GSTRAT72  PACK      KEY14,IBAGD001,IBAGD002,SP70  
          CALL      RDIBGE1
          IF        OVRCD=1
            CALL      CLRRAT00
          ENDIF

          CLEAR     WEBTITLE
          MOVE      "GST Codes/Rates Maintenance",WEBTITLE
          RESET     WEBTITLE
.
          CALL      WEBHED00   * Create Output File and Write HTML Page Header
          BRANCH    EXIT,GSTRAT99
          CALL      WEBBOD00   * Process Web Body
          CALL      WEBEND00   * Process End of HTML File
          MOVE      ONE,EXIT
          GOTO      GSTRAT99
.
GSTRAT90  MOVE      "Invalid GST Code",WEBTITLE
          CALL      WEBERR00
          MOVE      ONE,EXIT
          GOTO      GSTRAT99
.
GSTRAT91  MOVE      "GST Rates Code/Effective Date already exists",WEBTITLE
          CALL      WEBERR00
          MOVE      ONE,EXIT
          GOTO      GSTRAT99
.
GSTRAT92  MOVE      "GST Rates Code/Effective Date does not exist",WEBTITLE
          CALL      WEBERR00
          MOVE      ONE,EXIT
          GOTO      GSTRAT99
.
GSTRAT93  MOVE      "Unable to remove past/current records.",WEBTITLE
          CALL      WEBERR00
          MOVE      ONE,EXIT
          GOTO      GSTRAT99
.
GSTRAT94  MOVE      "Invalid Form Action.",WEBTITLE
          CALL      WEBERR00
          MOVE      ONE,EXIT
          GOTO      GSTRAT99
.
GSTRAT95  MOVE      "GST Code already exists",WEBTITLE
          CALL      WEBERR00
          MOVE      ONE,EXIT
          GOTO      GSTRAT99
.
GSTRAT99  RETURN
.-------------------------------------------------------------------------------
. Clear Vars
.-------------------------------------------------------------------------------
CLRGST00  MOVE      SP70,IBGSCODE  * GST Code
          MOVE      SP70,IBGSDESC  * Gst Code Description
          MOVE      ZERO,IBGSACTV  * Active/Inactive (1-Inactive)
          MOVE      SP70,IBGSBASC  * BAS Code
          MOVE      SP70,IBGSSPAR  * Spare Variable
.
CLRGST99  RETURN
.-------------------------------------------------------------------------------
. Clear Vars
.-------------------------------------------------------------------------------
CLRRAT00  MOVE      SP70,IBGECODE  * GST Code
          MOVE      SP70,IBGEEDAT  * Date Effective From
          MOVE      ZERO,IBGEAMNT  * GST Percentage
          MOVE      SP70,IBGESPAR  * Spare Variable
.
CLRRAT99  RETURN
.-------------------------------------------------------------------------------
. Save Vars
.-------------------------------------------------------------------------------
SAVGST00  MOVE      IBAGD001,IBGSCODE  * GST Code
          MOVE      IBAGD004,IBGSDESC  * Gst Code Description
          MOVE      IBAGD005,IBGSACTV  * Active/Inactive (1-Inactive)
          MOVE      IBAGD006,IBGSBASC  * BAS Code
          MOVE      SP70,IBGSSPAR      * Spare Variable
.
SAVGST99  RETURN
.-------------------------------------------------------------------------------
. Save Vars
.-------------------------------------------------------------------------------
SAVRAT00  MOVE      IBAGD001,IBGECODE  * GST Code
          MOVE      IBAGD002,IBGEEDAT  * Date Effective From
          MOVE      IBAGD003,IBGEAMNT  * GST Percentage
          MOVE      SP70,IBGESPAR      * Spare Variable
.
SAVRAT99  RETURN
.------------------------------------------------------------
. BAS Code Maintenance: Display,Add,Update,Delete
.------------------------------------------------------------
IBABAS00  RESET     UPDTTYPE 
          MATCH     SP1,UPDTTYPE
          GOTO      IBABAS70 IF EQUAL
.
          MATCH     "A",UPDTTYPE    * Add Formaction
          GOTO      IBABAS10 IF EQUAL
.
          MATCH     "U",UPDTTYPE    * Update Formaction
          GOTO      IBABAS20 IF EQUAL
.
          MATCH     "D",UPDTTYPE    * Delete Formaction
          GOTO      IBABAS30 IF EQUAL
.
          GOTO      IBABAS94
.
.  *********** ADD CODE FORMACTION ***********
.
IBABAS10  PACK      KEY3,IBBAC001,SP70   
          CALL      RDIBBA1
          COMPARE   ZERO,OVRCD
          GOTO      IBABAS91 IF EQUAL
.
          CALL      SAVBAS00      * Moves input variables to file variables
          CALL      WRIBBA1       * Writes away the data
.
          MOVE      ZERO,EXIT
          GOTO      IBABAS99
.
.  *********** UPDATE FORMACTION ************
.
IBABAS20  PACK      KEY3,IBBAC001,SP70   
          CALL      RDIBBA1
          BRANCH    OVRCD,IBABAS90
.
          CALL      SAVBAS00      * Moves input variables to file variables
          CALL      UPIBBA1       
.
          MOVE      ZERO,EXIT
          GOTO      IBABAS99
.
.  ********** DELETE FORMACTION ***********
.
IBABAS30  PACK      KEY3,IBBAC001,SP70   
          CALL      RDIBBA1
          BRANCH    OVRCD,IBABAS90

          CALL      DEIBBA1      * Deletes the data
.         
          MOVE      ZERO,EXIT
          GOTO      IBABAS99
.
.  ********** DISPLAY FORMACTION ***********
.
IBABAS70  PACK      KEY3,IBBAC001,SP70
          CALL      RDIBBA1 
          IF        OVRCD=1
            CALL      CLRBAS00
          ENDIF
.
          CLEAR     WEBTITLE
          MOVE      "BAS Codes Maintenance",WEBTITLE
          RESET     WEBTITLE
.
          CALL      WEBHED00   * Create Output File and Write HTML Page Header
          BRANCH    EXIT,IBABAS99
          CALL      WEBBOD00   * Process Web Body
          CALL      WEBEND00   * Process End of HTML File
          MOVE      ONE,EXIT
          GOTO      IBABAS99
.
IBABAS90  MOVE      "Invalid BAS Code",WEBTITLE
          CALL      WEBERR00
          MOVE      ONE,EXIT
          GOTO      IBABAS99
.
IBABAS91  MOVE      "BAS Code record already exists",WEBTITLE
          CALL      WEBERR00
          MOVE      ONE,EXIT
          GOTO      IBABAS99
.
IBABAS94  MOVE      "Invalid Form Action.",WEBTITLE
          CALL      WEBERR00
          MOVE      ONE,EXIT
          GOTO      IBABAS99
.
IBABAS99  RETURN
.-------------------------------------------------------------------------------
. Clear Vars
.-------------------------------------------------------------------------------
CLRBAS00  MOVE      SP70,IBBABASC  * BAS Code
          MOVE      SP70,IBBADESC  * BAS Description
          MOVE      ZERO,IBBAACTV  * Active/Inactive (1 - Inactive)
          MOVE      SP70,IBBATYPE  * Bas Code Type
          MOVE      SP70,IBBASPAR  * Spare Variable
.
CLRBAS99  RETURN
.-------------------------------------------------------------------------------
. Save Vars
.-------------------------------------------------------------------------------
SAVBAS00  MOVE      IBBAC001,IBBABASC  * BAS Code
          MOVE      IBBAC002,IBBADESC  * BAS Description
          MOVE      IBBAC003,IBBAACTV  * Active/Inactive (1 - Inactive)
          MOVE      IBBAC004,IBBATYPE  * Bas Code Type
          MOVE      SP70,IBBASPAR      * Spare Variable
.
SAVBAS99  RETURN
.------------------------------------------------------------------------------
. Process Fields called from WEBBOD00
.------------------------------------------------------------------------------
.
PROFLD00  BRANCH    REPORTNO,PROFLD10,PROFLD20,PROFLD99,PROFLD40,PROFLD50
.
          GOTO      PROFLD99
.
PROFLD10  BRANCH    FLDSETNO,PROFLD11
          GOTO      PROFLD99
.
PROFLD11  CALL      CATD0000                       
          GOTO      PROFLD99
.
PROFLD20  BRANCH    FLDSETNO,PROFLD21
          GOTO      PROFLD99
.
PROFLD21  CALL      CODD0000                       
          GOTO      PROFLD99
.
PROFLD40  BRANCH    FLDSETNO,PROFLD41
          GOTO      PROFLD99
.
PROFLD41  CALL      GRAT0000       * GST Codes/Rates Maintenance
          GOTO      PROFLD99
.
PROFLD50  CALL      BASC0000       * BAS Codes Maintenance
          GOTO      PROFLD99
.
PROFLD99  RETURN
+
.-----------------------------------------------------------
. Option 1: Category
.-----------------------------------------------------------
CATD0000  BRANCH    FLDITMNO,CATD0100,CATD0200,CATD0300,CATD0400,CATD0500:
                             CATD0600,CATD0700,CATD0800,CATD0900,CATD1000:
                             CATD1100,CATD1200                            

          GOTO      CATD9999
.
CATD0100  WRITE     HTMLFILE;CMCDTCOD;
          GOTO      CATD9999
.
CATD0200  MATCH     SP70,CMCDDESC
          GOTO      CATD9999 IF EQUAL
          WRITE     HTMLFILE;CMCDDESC;
          GOTO      CATD9999
.
CATD0300  MATCH     SP70,CMCDHDPE
          GOTO      CATD9999 IF EQUAL
          WRITE     HTMLFILE;CMCDHDPE;
          GOTO      CATD9999
.
CATD0400  MATCH     SP70,CMCDFMDT
          GOTO      CATD9999 IF EQUAL
          GOTO      CATD9999 IF EOS
          UNPACK    CMCDFMDT,CCENT,CYEAR,CMON,CDAY
          MOVE      CMON,F2
          MATCH     "00",CDAY
          GOTO      CATD9999 IF EQUAL
          LOAD      MTHNAM3,F2,JAN,FEB,MAR,APR,MAY,JUN,JUL,AUG,SEP,OCT,NOV,DEC
          WRITE     HTMLFILE;CDAY,SP1,MTHNAM3,SP1,CCENT,CYEAR;
          GOTO      CATD9999
.
CATD0500  MATCH     SP70,CMCDTODT
          GOTO      CATD9999 IF EQUAL
          UNPACK    CMCDTODT,CCENT,CYEAR,CMON,CDAY
          MOVE      CMON,F2
          MATCH     "00",CDAY
          GOTO      CATD9999 IF EQUAL
          LOAD      MTHNAM3,F2,JAN,FEB,MAR,APR,MAY,JUN,JUL,AUG,SEP,OCT,NOV,DEC
          WRITE     HTMLFILE;CDAY,SP1,MTHNAM3,SP1,CCENT,CYEAR;
          GOTO      CATD9999
.
CATD0600  MOVE      ZERO,LNK2PRT
          CALL      CATCT000        * Table of Categories by Category
          GOTO      CATD9999
.
CATD0700  MOVE      ZERO,LNK2PRT
          CALL      CATDS000        * Table of Categories by Description
          GOTO      CATD9999
.
CATD0800  CALL      NEXTGR00
          GOTO      CATD9999
.
CATD0900  CALL      PREVGR00
          GOTO      CATD9999
.
CATD1000  MATCH     SP70,STARTKEY
          GOTO      CATD9999 IF EQUAL
          WRITE     HTMLFILE;STARTKEY;
          GOTO      CATD9999
.
CATD1100  MOVE      ONE,LNK2PRT  * Update Parent
          CALL      CATCT000     * Table of Categories by Category
          GOTO      CATD9999
.
CATD1200  CALL      IBACLOCK
          MOVE      XCDATE,CURRDATE
          CALL      SELCOD00     * Category Selection List
          GOTO      CATD9999
.
CATD9999  RETURN
.------------------------------------------------------------
. Category Selection List
.------------------------------------------------------------
SELCOD00  PACK      KEY5,SP70
          CALL      RSCMCOD3
SELCOD10  CALL      RKCMCOD3
          BRANCH    OVRCD,SELCOD99
          MATCH     SP70,CMCDACOD
          GOTO      SELCOD99 IF NOT EQUAL
.
          MATCH     SP70,CMCDFMDT
          GOTO      SELCOD20 IF EQUAL
          MATCH     CMCDFMDT,CURRDATE
          GOTO      SELCOD10 IF LESS
          MATCH     SP70,CMCDTODT
          GOTO      SELCOD20 IF EQUAL
          MATCH     CURRDATE,CMCDTODT
          GOTO      SELCOD10 IF LESS
.
SELCOD20  PACK      KEY4,QUOTE,CMCDTCOD,QUOTE
          WRITE     HTMLFILE;"<option value=",KEY4,">(",CMCDTCOD,") ":
                             CMCDDESC,"</option>"
          GOTO      SELCOD10
.
SELCOD99  RETURN
.-----------------------------------------------------------
. Option 2: Code Record
.-----------------------------------------------------------
CODD0000  BRANCH    FLDITMNO,CODD0100,CODD0200,CODD0300,CODD0400,CODD0500:
                             CODD0600,CODD0700,CODD0800,CODD0900,CODD1000:
                             CODD1100,CODD1200,CODD1300,CODD1400,CODD1500:
                             CODD1600,CODD1700,CODD1800,CODD1900,CODD2000:
                             CODD2100,CODD2200,CODD2300,CODD2400,CODD2500:
                             CODD2600,CODD2700,CODD2800
          GOTO      CODD9999
.
CODD0100  WRITE     HTMLFILE;CMCDTCOD;
          GOTO      CODD9999
.
CODD0200  WRITE     HTMLFILE;CMCDACOD;
          GOTO      CODD9999
.
CODD0300  MATCH     SP70,CMCDDESC
          GOTO      CODD9999 IF EQUAL
          WRITE     HTMLFILE;CMCDDESC;
          GOTO      CODD9999
.
CODD0400  MATCH     SP70,CMCDHDPE
          GOTO      CODD9999 IF EQUAL
          WRITE     HTMLFILE;CMCDHDPE;
          GOTO      CODD9999
.
CODD0500  MATCH     SP70,CMCDFMDT
          GOTO      CODD9999 IF EQUAL
          GOTO      CODD9999 IF EOS
          UNPACK    CMCDFMDT,CCENT,CYEAR,CMON,CDAY
          MOVE      CMON,F2
          MATCH     "00",CDAY
          GOTO      CODD9999 IF EQUAL
          LOAD      MTHNAM3,F2,JAN,FEB,MAR,APR,MAY,JUN,JUL,AUG,SEP,OCT,NOV,DEC
          WRITE     HTMLFILE;CDAY,SP1,MTHNAM3,SP1,CCENT,CYEAR;
          GOTO      CODD9999
.
CODD0600  MATCH     SP70,CMCDTODT
          GOTO      CODD9999 IF EQUAL
          GOTO      CODD9999 IF EOS
          UNPACK    CMCDTODT,CCENT,CYEAR,CMON,CDAY
          MOVE      CMON,F2
          MATCH     "00",CDAY
          GOTO      CODD9999 IF EQUAL
          LOAD      MTHNAM3,F2,JAN,FEB,MAR,APR,MAY,JUN,JUL,AUG,SEP,OCT,NOV,DEC
          WRITE     HTMLFILE;CDAY,SP1,MTHNAM3,SP1,CCENT,CYEAR;
          GOTO      CODD9999
.
CODD0700  COMPARE   ZERO,CMCDASSC
          GOTO      CODD9999 IF EQUAL
          WRITE     HTMLFILE;CMCDASSC;
          GOTO      CODD9999
.
CODD0800  MATCH     SP70,CMCDNATE
          GOTO      CODD9999 IF EQUAL
          WRITE     HTMLFILE;CMCDNATE;
          GOTO      CODD9999
.
CODD0900  MATCH     SP70,CMCDSI01
          GOTO      CODD9999 IF EQUAL
          WRITE     HTMLFILE;CMCDSI01;
          GOTO      CODD9999
.
CODD1000  MATCH     SP70,CMCDSI02
          GOTO      CODD9999 IF EQUAL
          WRITE     HTMLFILE;CMCDSI02;
          GOTO      CODD9999
.
CODD1100  MATCH     SP70,CMCDSI03
          GOTO      CODD9999 IF EQUAL
          WRITE     HTMLFILE;CMCDSI03;
          GOTO      CODD9999
.
CODD1200  MATCH     SP70,CMCDSI04
          GOTO      CODD9999 IF EQUAL
          WRITE     HTMLFILE;CMCDSI04;
          GOTO      CODD9999
.
CODD1300  MATCH     SP70,CMCDSI05
          GOTO      CODD9999 IF EQUAL
          WRITE     HTMLFILE;CMCDSI05;
          GOTO      CODD9999
.
CODD1400  MATCH     SP70,CMCDSI06
          GOTO      CODD9999 IF EQUAL
          WRITE     HTMLFILE;CMCDSI06;
          GOTO      CODD9999
.
CODD1500  MATCH     SP70,CMCDSI07
          GOTO      CODD9999 IF EQUAL
          WRITE     HTMLFILE;CMCDSI07;
          GOTO      CODD9999
.
CODD1600  MATCH     SP70,CMCDSI08
          GOTO      CODD9999 IF EQUAL
          WRITE     HTMLFILE;CMCDSI08;
          GOTO      CODD9999
.
CODD1700  MATCH     SP70,CMCDSI09
          GOTO      CODD9999 IF EQUAL
          WRITE     HTMLFILE;CMCDSI09;
          GOTO      CODD9999
.
CODD1800  MATCH     SP70,CMCDSI10
          GOTO      CODD9999 IF EQUAL
          WRITE     HTMLFILE;CMCDSI10;
          GOTO      CODD9999
.
CODD1900  MATCH     SP70,CMCDSI11
          GOTO      CODD9999 IF EQUAL
          WRITE     HTMLFILE;CMCDSI11;
          GOTO      CODD9999
.
CODD2000  MATCH     SP70,CMCDGRPV
          GOTO      CODD9999 IF EQUAL
          WRITE     HTMLFILE;CMCDGRPV;
          GOTO      CODD9999
.
CODD2100  MATCH     "1",CMCDDEFT
          IF        @EQUAL
            WRITE     HTMLFILE;ONE;
          ELSE
            WRITE     HTMLFILE;ZERO;
          ENDIF
          GOTO      CODD9999
.
CODD2200  MATCH     SP70,CMCDSECL
          GOTO      CODD9999 IF EQUAL
          MATCH     " 0",CMCDSECL
          GOTO      CODD9999 IF EQUAL
          WRITE     HTMLFILE;CMCDSECL;
          GOTO      CODD9999
.
CODD2300  CALL      CODCD000        * Table of Codes by Code
          GOTO      CODD9999
.
CODD2400  CALL      CODDS000        * Table of Codes by Description
          GOTO      CODD9999
.
CODD2500  CALL      NEXTGR00
          GOTO      CODD9999
.
CODD2600  CALL      PREVGR00
          GOTO      CODD9999
.
CODD2700  WRITE     HTMLFILE;CURRCODE;
          GOTO      CODD9999
.
CODD2800  WRITE     HTMLFILE;CATEDESC;
          GOTO      CODD9999
.
CODD9999  RETURN
.------------------------------------------------------------
. Table of Categories by Category
.------------------------------------------------------------
CATCT000  UNPACK    DIM127,D1,LINKPRG,DIM127
          UNPACK    DIM127,D1,LINKREP,DIM127
          UNPACK    DIM127,D1,LINKTEM,DIM127
.
          CALL      CTHED000      * Output Table Heading
.
          IF        NORECORD=0
            MOVE      PTCNNRTD,NORECORD      * Set Default No Records to Display
          ENDIF
          MOVE      ZERO,RECNUMB
          MOVE      ZERO,DISNUMB
.
          PACK      KEY5,SP3,STARTKEY,SP70
          CALL      RSCMCOD3
          IF        OVRCD=0
            CALL      RPCMCOD3
          ENDIF
CATCT100  CALL      RKCMCOD3
          BRANCH    OVRCD,CATCT900
.
          MATCH     SP70,CMCDACOD
          GOTO      CATCT900 IF NOT EQUAL
.
          ADD       ONE,RECNUMB
          IF        STARTNUM>=RECNUMB
            GOTO      CATCT100
          ENDIF
.
          CALL      CTROW000      * Display Category Row
          ADD       ONE,DISNUMB
          COMPARE   NORECORD,DISNUMB
          GOTO      CATCT100 IF NOT EQUAL
          GOTO      CATCT999
.
CATCT900  CALL      NOMORE00      * Display No More Records Message
.
CATCT999  RETURN
.------------------------------------------------------------
. Table of Categories by Description
.------------------------------------------------------------
CATDS000  UNPACK    DIM127,D1,LINKPRG,DIM127
          UNPACK    DIM127,D1,LINKREP,DIM127
          UNPACK    DIM127,D1,LINKTEM,DIM127
.
          CALL      CTHED000      * Output Table Heading
.
          IF        NORECORD=0
            MOVE      PTCNNRTD,NORECORD      * Set Default No Records to Display
          ENDIF
          MOVE      ZERO,RECNUMB
          MOVE      ZERO,DISNUMB
.
          PACK      KEY25,SP3,STARTKEY,SP70
          CALL      RSCMCOD4
          IF        OVRCD=0
            CALL      RPCMCOD4
          ENDIF
CATDS100  CALL      RKCMCOD4
          BRANCH    OVRCD,CATDS900
.
          MATCH     SP70,CMCDACOD
          GOTO      CATDS900 IF NOT EQUAL
.
          ADD       ONE,RECNUMB
          IF        STARTNUM>=RECNUMB
            GOTO      CATDS100
          ENDIF
.
          CALL      CTROW000      * Display Category Row
          ADD       ONE,DISNUMB
          COMPARE   NORECORD,DISNUMB
          GOTO      CATDS100 IF NOT EQUAL
          GOTO      CATDS999
.
CATDS900  CALL      NOMORE00      * Display No More Records Message
.
CATDS999  RETURN
.------------------------------------------------------------
. Category Maintenance (TABLE HEADING)
.------------------------------------------------------------
CTHED000  WRITE     HTMLFILE;"<tr>":
                             "<td class=HeadingCell width=20%>Category":
                             "</td>":
                             "<td class=HeadingCell width=40%>Description":
                             "</td>":
                             "<td class=HeadingCell width=10%>HDP Default":
                             "</td>":
                          "<td class=HeadingCell width=15%>Effective From Date":
                             "</td>":
                          "<td class=HeadingCell width=15%>Effective To Date":
                             "</td>":
                             "</tr>"
.
CTHED999  RETURN
.------------------------------------------------------------
. Category Maintenance (TABLE ROW)
.------------------------------------------------------------
CTROW000  MATCH     SP70,CMCDDESC
          IF        @EQUAL
            MOVE      "&nbsp;",CMCDDESC
          ENDIF
.
          MOVE      CMCDHDPE,KEY6
          MATCH     SP70,CMCDHDPE
          IF        @EQUAL
            MOVE      "&nbsp;",KEY6
          ENDIF
.
          MATCH     SP70,CMCDFMDT
          GOTO      CTROW010 IF EQUAL
          GOTO      CTROW010 IF EOS
          UNPACK    CMCDFMDT,CCENT,CYEAR,CMON,CDAY
          MOVE      CMON,F2
          MATCH     "00",CDAY
          GOTO      CTROW010 IF EQUAL
          LOAD      MTHNAM3,F2,JAN,FEB,MAR,APR,MAY,JUN,JUL,AUG,SEP,OCT,NOV,DEC
          PACK      DISPFMDT,CDAY,SP1,MTHNAM3,SP1,CCENT,CYEAR
          GOTO      CTROW020
.
CTROW010  MOVE      "&nbsp;",DISPFMDT
.
CTROW020  MATCH     SP70,CMCDTODT
          GOTO      CTROW021 IF EQUAL
          GOTO      CTROW021 IF EOS
          UNPACK    CMCDTODT,CCENT,CYEAR,CMON,CDAY
          MOVE      CMON,F2
          MATCH     "00",CDAY
          GOTO      CTROW021 IF EQUAL
          LOAD      MTHNAM3,F2,JAN,FEB,MAR,APR,MAY,JUN,JUL,AUG,SEP,OCT,NOV,DEC
          PACK      DISPTODT,CDAY,SP1,MTHNAM3,SP1,CCENT,CYEAR
          GOTO      CTROW030
.
CTROW021  MOVE      "&nbsp;",DISPTODT
.
CTROW030  BRANCH    LNK2PRT,CTROW100
.
          WRITE     HTMLFILE;"<tr><td nowrap><A HREF='javascript:ShowDetail01":
                             "(#"",LINKPRG,"#.pbl":
                             "?reportno=",LINKREP:
                             "&template=",LINKTEM:
                             "&cmcod001=",CMCDTCOD,"#")'>":
                             "<img src=../images/MaintenanceIcon.gif hspace=4":
                             " border=0 align=absmiddle></a>":
                             CMCDTCOD,"</td>":
                             "<td>",CMCDDESC,"</td>":
                             "<td>",KEY6,"</td>":
                             "<td>",DISPFMDT,"</td>":
                             "<td>",DISPTODT,"</td>":
                             "</tr>"
.
          GOTO      CTROW999
.
CTROW100  WRITE     HTMLFILE;"<tr valign=top>":
                              "<td><a href=#"#" ":
                              "OnClick=#"UpdateParent01('",CMCDTCOD:
                              "','",CMCDDESC,"')#">":
                              "<img src=../images/MaintenanceIcon.gif hspace=4":
                              " border=0 align=absmiddle></a>":
                              CMCDTCOD,"</td>":
                              "<td>",CMCDDESC,"</td>":
                              "<td>",KEY6,"</td>":
                             "<td>",DISPFMDT,"</td>":
                             "<td>",DISPTODT,"</td>":
                              "</tr>"
.
CTROW999  RETURN
.------------------------------------------------------------
. Table of Codes by Code
.------------------------------------------------------------
CODCD000  UNPACK    DIM127,D1,LINKPRG,DIM127
          UNPACK    DIM127,D1,LINKREP,DIM127
          UNPACK    DIM127,D1,LINKTEM,DIM127
.
          CALL      CDHED000      * Output Table Heading
.
          IF        NORECORD=0
            MOVE      PTCNNRTD,NORECORD      * Set Default No Records to Display
          ENDIF
          MOVE      ZERO,RECNUMB
          MOVE      ZERO,DISNUMB
.
          PACK      KEY5,CMCOD001,STARTKEY,SP70
          CALL      RSCMCOD1
          IF        OVRCD=0
            CALL      RPCMCOD1
          ENDIF
CODCD100  CALL      RKCMCOD1
          BRANCH    OVRCD,CODCD900
          MATCH     CMCOD001,CMCDTCOD
          GOTO      CODCD900 IF NOT EQUAL
          MATCH     SP70,CMCDACOD
          GOTO      CODCD100 IF EQUAL
.
          ADD       ONE,RECNUMB
          IF        STARTNUM>=RECNUMB
            GOTO      CODCD100
          ENDIF
.
          CALL      CDROW000      * Display Category Row
          ADD       ONE,DISNUMB
          COMPARE   NORECORD,DISNUMB
          GOTO      CODCD100 IF NOT EQUAL
          GOTO      CODCD999
.
CODCD900  CALL      NOMORE00      * Display No More Records Message
.
CODCD999  RETURN
.------------------------------------------------------------
. Table of Codes by Description
.------------------------------------------------------------
CODDS000  UNPACK    DIM127,D1,LINKPRG,DIM127
          UNPACK    DIM127,D1,LINKREP,DIM127
          UNPACK    DIM127,D1,LINKTEM,DIM127
.
          CALL      CDHED000      * Output Table Heading
.
          IF        NORECORD=0
            MOVE      PTCNNRTD,NORECORD      * Set Default No Records to Display
          ENDIF
          MOVE      ZERO,RECNUMB
          MOVE      ZERO,DISNUMB
.
          PACK      PTCDKEY2,CMCOD001,STARTKEY,SP70
          CALL      RSCMCOD2
          IF        OVRCD=0
            CALL      RPCMCOD2
          ENDIF
CODDS100  CALL      RKCMCOD2
          BRANCH    OVRCD,CODDS900
          MATCH     CMCOD001,CMCDTCOD
          GOTO      CODDS900 IF NOT EQUAL
          MATCH     SP70,CMCDACOD
          GOTO      CODDS100 IF EQUAL
.
          ADD       ONE,RECNUMB
          IF        STARTNUM>=RECNUMB
            GOTO      CODDS100
          ENDIF
.
          CALL      CDROW000      * Display Category Row
          ADD       ONE,DISNUMB
          COMPARE   NORECORD,DISNUMB
          GOTO      CODDS100 IF NOT EQUAL
          GOTO      CODDS999
.
CODDS900  CALL      NOMORE00      * Display No More Records Message
.
CODDS999  RETURN
.------------------------------------------------------------
. Code Record Maintenance (TABLE HEADING)
.------------------------------------------------------------
CDHED000  WRITE     HTMLFILE;"<tr>":
                             "<td class=HeadingCell width=8%>Actual Code":
                             "</td>":
                             "<td class=HeadingCell width=22%>Description":
                             "</td>":
                             "<td class=HeadingCell width=12%>":
                             "Effective From Date":
                             "</td>":
                             "<td class=HeadingCell width=12%>":
                             "Effective To Date":
                             "</td>":
                             "<td class=HeadingCell width=8%>HDP Equivalent":
                             "</td>":
                             "<td class=HeadingCell width=8%>":
                             "National Equivalent":
                             "</td>":
                             "<td class=HeadingCell width=8%>":
                             "Associated No.":
                             "</td>":
                             "<td class=HeadingCell width=10%>Indicators":
                             "</td>":
                             "<td class=HeadingCell width=6%>Default Code":
                             "</td>":
                             "<td class=HeadingCell width=6%>Security Level":
                             "</td>":
                             "</tr>"
.
CDHED999  RETURN
.------------------------------------------------------------
. Code Record Maintenance (TABLE ROW)
.------------------------------------------------------------
CDROW000  MATCH     SP70,CMCDDESC
          IF        @EQUAL
            MOVE      "&nbsp;",CMCDDESC
          ENDIF
.
          MOVE      CMCDHDPE,KEY6
          MATCH     SP70,CMCDHDPE
          IF        @EQUAL
            MOVE      "&nbsp;",KEY6
          ENDIF
.
          MATCH     "1",CMCDDEFT
          IF        @EQUAL
            MOVE      "Yes",D3
          ELSE
            MOVE      "No ",D3
          ENDIF
.
          MATCH     SP10,CMCDSECL
          IF        @EQUAL
            MOVE      "0",CMCDSECL
          ENDIF
.
          MATCH     SP70,CMCDFMDT
          GOTO      CDROW010 IF EQUAL
          GOTO      CDROW010 IF EOS
          UNPACK    CMCDFMDT,CCENT,CYEAR,CMON,CDAY
          MOVE      CMON,F2
          MATCH     "00",CDAY
          GOTO      CDROW010 IF EQUAL
          LOAD      MTHNAM3,F2,JAN,FEB,MAR,APR,MAY,JUN,JUL,AUG,SEP,OCT,NOV,DEC
          PACK      DISPFMDT,CDAY,SP1,MTHNAM3,SP1,CCENT,CYEAR
          GOTO      CDROW020
.
CDROW010  MOVE      "&nbsp;",DISPFMDT
.
CDROW020  MATCH     SP70,CMCDTODT
          GOTO      CDROW021 IF EQUAL
          GOTO      CDROW021 IF EOS
          UNPACK    CMCDTODT,CCENT,CYEAR,CMON,CDAY
          MOVE      CMON,F2
          MATCH     "00",CDAY
          GOTO      CDROW021 IF EQUAL
          LOAD      MTHNAM3,F2,JAN,FEB,MAR,APR,MAY,JUN,JUL,AUG,SEP,OCT,NOV,DEC
          PACK      DISPTODT,CDAY,SP1,MTHNAM3,SP1,CCENT,CYEAR
          GOTO      CDROW030
.
CDROW021  MOVE      "&nbsp;",DISPTODT
.
CDROW030  PACK      CMCDSI01,CMCDSI01,SP70
          PACK      CMCDSI02,CMCDSI02,SP70
          PACK      CMCDSI03,CMCDSI03,SP70
          PACK      CMCDSI04,CMCDSI04,SP70
          PACK      CMCDSI05,CMCDSI05,SP70
          PACK      CMCDSI06,CMCDSI06,SP70
          PACK      CMCDSI07,CMCDSI07,SP70
          PACK      CMCDSI08,CMCDSI08,SP70
          PACK      CMCDSI09,CMCDSI09,SP70
          PACK      CMCDSI10,CMCDSI10,SP70
          PACK      CMCDSI11,CMCDSI11,SP70
          PACK      KEY11,CMCDSI01,CMCDSI02,CMCDSI03,CMCDSI04,CMCDSI05,CMCDSI06:
                          CMCDSI07,CMCDSI08,CMCDSI09,CMCDSI10,CMCDSI11
          MOVE      ZERO,D6
          MOVE      CMCDASSOC,D6
          SQUEEZE   D6
.
          WRITE     HTMLFILE;"<tr><td nowrap><A HREF='javascript:ShowDetail02":
                             "(#"",LINKPRG,"#.pbl":
                             "?reportno=",LINKREP:
                             "&template=",LINKTEM:
                             "&cmcod001=",CMCDTCOD:
                             "&cmcod002=",CMCDACOD,"#")'>":
                             "<img src=../images/MaintenanceIcon.gif hspace=4":
                             " border=0 align=absmiddle></a>":
                             CMCDACOD,"</td>":
                             "<td>",CMCDDESC,"</td>":
                             "<td>",DISPFMDT,"</td>":
                             "<td>",DISPTODT,"</td>":
                             "<td>",KEY6,"</td>":
                             "<td><pre>",CMCDNATE,"</td></pre>":
                             "<td><pre>",D6,"</td></pre>":
                             "<td><pre>",KEY11,"</td></pre>":
                             "<td>",D3,"</td>":
                             "<td>",CMCDSECL,"</td>":
                             "</tr>"
.
CDROW999 RETURN
.-----------------------------------------------------------
. Link to Next Group
.-----------------------------------------------------------
NEXTGR00  MOVE      NORECORD,KEY2
          REP       " +",KEY2
          ASSIGN    STARTNUM+NORECORD,F3
          MOVE      F3,KEY3
          REP       " +",KEY3
          UNPACK    DIM127,D1,FLDPARA,DIM127
          MOVE      REPORTNO,F1
          REP       " +",STARTKEY
          REP       " +",CURRCODE
          REP       "'~",STARTKEY
.
          WRITE     HTMLFILE;"comweb01.pbl":
                                 "?reportno=",F1:
                                 "&template=",FLDPARA:
                                 "&startnum=",KEY3:
                                 "&norecord=",KEY2:
                                 "&startkey=",STARTKEY:
                                 "&cmcod001=",CURRCODE;
.
          REP       "+ ",STARTKEY
          REP       "+ ",CURRCODE
          REP       "~'",STARTKEY
.
NEXTGR99  RETURN
.-------------------------------------------------------------
. Link to Prev Group
.-------------------------------------------------------------
PREVGR00  MOVE      NORECORD,KEY2
          REP       " +",KEY2
          ASSIGN    STARTNUM-NORECORD,F3
          IF        F3<0
            MOVE      ZERO,F3
          ENDIF
          MOVE      F3,KEY3
          REP       " +",KEY3
          UNPACK    DIM127,D1,FLDPARA,DIM127
          MOVE      REPORTNO,F1
          REP       " +",STARTKEY
          REP       " +",CURRCODE
          REP       "'~",STARTKEY
.
          WRITE     HTMLFILE;"comweb01.pbl":
                                 "?reportno=",F1:
                                 "&template=",FLDPARA:
                                 "&startnum=",KEY3:
                                 "&norecord=",KEY2:
                                 "&startkey=",STARTKEY:
                                 "&cmcod001=",CURRCODE;
.
          REP       "+ ",STARTKEY
          REP       "+ ",CURRCODE
          REP       "~'",STARTKEY
.
PREVGR99  RETURN
+
.-----------------------------------------------------------
. Option 4: GST Codes/Rates Maintenance
.-----------------------------------------------------------
GRAT0000  BRANCH    FLDITMNO,GRAT0100,GRAT0200,GRAT0300,GRAT0400,GRAT0500:
                             GRAT0600,GRAT0700,GRAT0800,GRAT0900,GRAT1000:
                             GRAT1100,GRAT1200,GRAT1300,GRAT1400
          GOTO      GRAT9999
.
GRAT0100  WRITE     HTMLFILE;IBGSCODE;  * GST Code 
          GOTO      GRAT9999
.
GRAT0200  WRITE     HTMLFILE;IBGSDESC;  * GST Description
          GOTO      GRAT9999
.
GRAT0300  WRITE     HTMLFILE;IBGSACTV;  * GST Code Active Indicator
          GOTO      GRAT9999
.
GRAT0400  WRITE     HTMLFILE;IBGSBASC;  * BAS Code 
          GOTO      GRAT9999
.
GRAT0500  WRITE     HTMLFILE;IBGECODE;  * GST Code 
          GOTO      GRAT9999
.
GRAT0600  UNPACK    IBGEEDAT,CCENT,CYEAR,CMON,CDAY  * Effective Date
          MOVE      CMON,F2
          LOAD      MTHNAM3,F2,JAN,FEB,MAR,APR,MAY,JUN,JUL,AUG,SEP,OCT,NOV,DEC
          WRITE     HTMLFILE;CDAY,SP1,MTHNAM3,SP1,CCENT,CYEAR;
          GOTO      GRAT9999
.
GRAT0700  WRITE     HTMLFILE;IBGEAMNT;  * GST Percentage
          GOTO      GRAT9999
.
GRAT0800  CALL      RATTB000            * GST Rates Table
          GOTO      GRAT9999
.
GRAT0900  CALL      PREV0000            * Previous List  
          GOTO      GRAT9999
.
GRAT1000  CALL      NEXT0000            * Next List  
          GOTO      GRAT9999
.
GRAT1100  MOVE      SP70,BASCODE
          MATCH     SP70,IBGSBASC
          IF        !@EQUAL 
            MOVE      IBGSBASC,BASCODE       
          ENDIF 
          CALL      BASLST00            * BAS Code selection list
          GOTO      GRAT9999
.
GRAT1200  CALL      GSTTB000            * GST Rates Table for GST CODE
          GOTO      GRAT9999
.
GRAT1300  CALL      PREVG000            * Previous List for GST Code 
          GOTO      GRAT9999
.
GRAT1400  CALL      NEXTG000            * Next List for GST Code 
          GOTO      GRAT9999
.
GRAT9999  RETURN
.-----------------------------------------------------------
. Option 5: BAS Code Maintenance
.-----------------------------------------------------------
BASC0000  BRANCH    FLDITMNO,BASC0100,BASC0200,BASC0300,BASC0400,BASC0500:
                             BASC0600,BASC0700
          GOTO      BASC9999
.
BASC0100  WRITE     HTMLFILE;IBBABASC;  * BAS Code 
          GOTO      BASC9999
.
BASC0200  WRITE     HTMLFILE;IBBADESC;  * BAS Description
          GOTO      BASC9999
.
BASC0300  WRITE     HTMLFILE;IBBAACTV;  * BAS Code Active Indicator
          GOTO      BASC9999
.
BASC0400  WRITE     HTMLFILE;IBBATYPE;  * BAS Code Type
          GOTO      BASC9999
.
BASC0500  CALL      BASTB000            * BAS Code Table
          GOTO      BASC9999
.
BASC0600  CALL      PREV0000            * Previous List  
          GOTO      BASC9999
.
BASC0700  CALL      NEXT0000            * Next List  
          GOTO      BASC9999
.
BASC9999  RETURN
.------------------------------------------------------------
. Table of GST Codes/Rates      
.------------------------------------------------------------
RATTB000  UNPACK    DIM127,D1,LINKPRG,DIM127
          UNPACK    DIM127,D1,LINKREP,DIM127
          UNPACK    DIM127,D1,LINKTEM,DIM127
.
          CALL      RATHD000      * Output Table Heading
.
          IF        NORECORD=0
            MOVE      PTCNNRTD,NORECORD      * Set Default No Records to Display
          ENDIF
          MOVE      ZERO,RECNUMB
          MOVE      ZERO,DISNUMB
.
          MOVE      SP70,SAVCODE
.
          PACK      KEY14,Z70
          CALL      RSIBGE1
RATTB100  CALL      RPIBGE1
          BRANCH    OVRCD,RATTB900
.
          MATCH     SAVCODE,IBGECODE        * Only want Code once
          GOTO      RATTB100 IF EQUAL
.
          MOVE      IBGECODE,SAVCODE
.
          ADD       ONE,RECNUMB
          IF        STARTNUM>=RECNUMB
            GOTO      RATTB100
          ENDIF
.
          CALL      RATRW000      * Display GST Rates Table Details Row
          ADD       ONE,DISNUMB
          COMPARE   NORECORD,DISNUMB
          GOTO      RATTB100 IF NOT EQUAL
          GOTO      RATTB999
.
RATTB900  CALL      NOMORE00      * Display No More Records Message
.
RATTB999  RETURN
.------------------------------------------------------------
. GST Codes/Rates Table Details (TABLE HEADING)
.------------------------------------------------------------
RATHD000  WRITE     HTMLFILE;"<tr>":
                               "<td class=HeadingCell width=15%>":
                               "GST Code</td>":
                               "<td class=HeadingCell width=30%>":
                               "Description</td>":
                               "<td class=HeadingCell width=15%>":
                               "Effective Date</td>":
                               "<td class=HeadingCell width=15%>":
                               "Rate</td>":
                             "</tr>"
.
RATHD999  RETURN
.------------------------------------------------------------
. GST Codes/Rates Table (TABLE ROW)
.------------------------------------------------------------
RATRW000  UNPACK    IBGEEDAT,CCENT,CYEAR,CMON,CDAY  * Effective Date
          MOVE      CMON,F2
          LOAD      MTHNAM3,F2,JAN,FEB,MAR,APR,MAY,JUN,JUL,AUG,SEP,OCT,NOV,DEC
          PACK      KEY11,CDAY,SP1,MTHNAM3,SP1,CCENT,CYEAR
.
          PACK      KEY6,IBGECODE,SP70
          CALL      RDIBGS1
          IF        OVRCD=1       
            MOVE      "Invalid GST Code",IBGSDESC
          ENDIF
.
          MOVE      IBGECODE,DIM6
          REP       "%~",DIM6
.
          WRITE     HTMLFILE;"<tr><td nowrap><A HREF='javascript:ShowDetail":
                             "(#"",LINKPRG,"#.pbl":
                             "?reportno=",LINKREP:
                             "&template=",LINKTEM:
                             "&updttype=V":
                             "&ibagd001=",DIM6:
                             "&ibagd002=",IBGEEDAT,"#")'>":
                             "<img src=../images/MaintenanceIcon.gif hspace=4":
                             " border=0 align=absmiddle></a>":
                             IBGECODE,"</td>":
                             "<td>",IBGSDESC,"</td>":
                             "<td>",KEY11,"</td>":
                             "<td>",IBGEAMNT,"</td>":
                             "</tr>"
.
RATRW999 RETURN
.------------------------------------------------------------
. Table of GST Rates for a GST Code
.------------------------------------------------------------
GSTTB000  UNPACK    DIM127,D1,LINKPRG,DIM127
          UNPACK    DIM127,D1,LINKREP,DIM127
          UNPACK    DIM127,D1,LINKTEM,DIM127
.
          CALL      GSTHD000      * Output Table Heading
.
          IF        NORECORD=0
            MOVE      "10",NORECORD       * Set Default No Records to Display
          ENDIF
          MOVE      ZERO,RECNUMB
          MOVE      ZERO,DISNUMB
.
          PACK      KEY14,IBAGD001,Z70
          CALL      RSIBGE1
GSTTB100  CALL      RPIBGE1
          BRANCH    OVRCD,GSTTB999
.
          MATCH     IBAGD001,IBGECODE        * Same GST Code 
          GOTO      GSTTB999 IF NOT EQUAL
.
          ADD       ONE,RECNUMB
          IF        STARTNUM>=RECNUMB
            GOTO      GSTTB100
          ENDIF
.
          CALL      GSTRW000      * Display GST Rates Table Details Row
          ADD       ONE,DISNUMB
          COMPARE   NORECORD,DISNUMB
          GOTO      GSTTB100 IF NOT EQUAL
.
GSTTB999  RETURN
.------------------------------------------------------------
. GST Rates Table Details (TABLE HEADING)
.------------------------------------------------------------
GSTHD000  WRITE     HTMLFILE;"<tr>":
                               "<td class=HeadingCell width=15%>":
                               "Effective Date</td>":
                               "<td class=HeadingCell width=15%>":
                               "Rate</td>":
                             "</tr>"
.
GSTHD999  RETURN
.------------------------------------------------------------
. GST Rates Table (TABLE ROW)
.------------------------------------------------------------
GSTRW000  UNPACK    IBGEEDAT,CCENT,CYEAR,CMON,CDAY  * Effective Date
          MOVE      CMON,F2
          LOAD      MTHNAM3,F2,JAN,FEB,MAR,APR,MAY,JUN,JUL,AUG,SEP,OCT,NOV,DEC
          PACK      KEY11,CDAY,SP1,MTHNAM3,SP1,CCENT,CYEAR
.
          PACK      KEY6,IBGECODE,SP70
          CALL      RDIBGS1
          IF        OVRCD=1       
            MOVE      "Invalid GST Code",IBGSDESC
          ENDIF
.
          MOVE      IBGECODE,DIM6
          REP       "%~",DIM6
.
          WRITE     HTMLFILE;"<tr><td nowrap><A HREF='javascript:ShowDetail":
                             "(#"",LINKPRG,"#.pbl":
                             "?reportno=",LINKREP:
                             "&template=",LINKTEM:
                             "&ibagd001=",DIM6:
                             "&ibagd002=",IBGEEDAT,"#")'>":
                             "<img src=../images/MaintenanceIcon.gif hspace=4":
                             " border=0 align=absmiddle></a>":
                             KEY11,"</td>":
                             "<td>",IBGEAMNT,"</td>":
                             "</tr>"
.
GSTRW999 RETURN
.-----------------------------------------------------------
. Link to Next List Page
.-----------------------------------------------------------
NEXT0000  MOVE      NORECORD,KEY2
          REP       " +",KEY2
          ASSIGN    STARTNUM+NORECORD,F3
          MOVE      F3,KEY3
          REP       " +",KEY3
          UNPACK    DIM127,D1,FLDPARA,DIM127
          MOVE      REPORTNO,F1
.
          WRITE     HTMLFILE;"comweb01.pbl":
                                 "?reportno=",F1:
                                 "&template=",FLDPARA:
                                 "&startnum=",KEY3:
                                 "&norecord=",KEY2;
.
NEXT9999  RETURN
.-----------------------------------------------------------
. Link to Prev List Page
.-----------------------------------------------------------
PREV0000  MOVE      NORECORD,KEY2
          REP       " +",KEY2
          ASSIGN    STARTNUM-NORECORD,F3
          IF        F3<0
            MOVE      ZERO,F3
          ENDIF
          MOVE      F3,KEY3
          REP       " +",KEY3
          UNPACK    DIM127,D1,FLDPARA,DIM127
          MOVE      REPORTNO,F1
.
          WRITE     HTMLFILE;"comweb01.pbl":
                                 "?reportno=",F1:
                                 "&template=",FLDPARA:
                                 "&startnum=",KEY3:
                                 "&norecord=",KEY2;
.
PREV9999  RETURN
.-----------------------------------------------------------
. Link to Next List Page
.-----------------------------------------------------------
NEXTG000  MOVE      NORECORD,KEY2
          REP       " +",KEY2
          ASSIGN    STARTNUM+NORECORD,F3
          MOVE      F3,KEY3
          REP       " +",KEY3
          UNPACK    DIM127,D1,FLDPARA,DIM127
          MOVE      REPORTNO,F1
.
          REP       " +",IBAGD001
.
          WRITE     HTMLFILE;"comweb01.pbl":
                                 "?reportno=",F1:
                                 "&template=",FLDPARA:
                                 "&startnum=",KEY3:
                                 "&norecord=",KEY2:
                                 "&updttype=V":
                                 "&ibagd001=",IBAGD001;
.
          REP       "+ ",IBAGD001
.
NEXTG999  RETURN
.-----------------------------------------------------------
. Link to Prev List Page
.-----------------------------------------------------------
PREVG000  MOVE      NORECORD,KEY2
          REP       " +",KEY2
          ASSIGN    STARTNUM-NORECORD,F3
          IF        F3<0
            MOVE      ZERO,F3
          ENDIF
          MOVE      F3,KEY3
          REP       " +",KEY3
          UNPACK    DIM127,D1,FLDPARA,DIM127
          MOVE      REPORTNO,F1
.
          REP       " +",IBAGD001
.
          WRITE     HTMLFILE;"comweb01.pbl":
                                 "?reportno=",F1:
                                 "&template=",FLDPARA:
                                 "&startnum=",KEY3:
                                 "&norecord=",KEY2:
                                 "&updttype=V":
                                 "&ibagd001=",IBAGD001;
.
          REP       "+ ",IBAGD001
.
PREVG999  RETURN
.-------------------------------------------------
. BAS Selection List
.-------------------------------------------------
BASLST00  PACK      KEY3,SP70
          CALL      RSIBBA1
BASLST10  CALL      RKIBBA1
          BRANCH    OVRCD,BASLST99
.
          COMPARE   ONE,IBBAACTV          * Active Indicator
          GOTO      BASLST10 IF EQUAL
.
          MATCH     BASCODE,IBBABASC
          IF        @EQUAL
            WRITE     HTMLFILE;"<option value=#"",IBBABASC,"#" selected>":
                               IBBADESC,"</option>"
          ELSE
            WRITE     HTMLFILE;"<option value=#"",IBBABASC,"#">":
                               IBBADESC,"</option>"
          ENDIF
          GOTO      BASLST10
.
BASLST99  RETURN
.------------------------------------------------------------
. Table of BAS Codes      
.------------------------------------------------------------
BASTB000  UNPACK    DIM127,D1,LINKPRG,DIM127
          UNPACK    DIM127,D1,LINKREP,DIM127
          UNPACK    DIM127,D1,LINKTEM,DIM127
.
          CALL      BASHD000      * Output Table Heading
.
          IF        NORECORD=0
            MOVE      PTCNNRTD,NORECORD      * Set Default No Records to Display
          ENDIF
          MOVE      ZERO,RECNUMB
          MOVE      ZERO,DISNUMB
.
          PACK      KEY3,STARTKEY,SP70
          CALL      RSIBBA1
BASTB100  CALL      RKIBBA1
          BRANCH    OVRCD,BASTB900
.
          ADD       ONE,RECNUMB
          IF        STARTNUM>=RECNUMB
            GOTO      BASTB100
          ENDIF
.
          CALL      BASRW000      * Display GST Rates Table Details Row
          ADD       ONE,DISNUMB
          COMPARE   NORECORD,DISNUMB
          GOTO      BASTB100 IF NOT EQUAL
          GOTO      BASTB999
.
BASTB900  CALL      NOMORE00      * Display No More Records Message
.
BASTB999  RETURN
.------------------------------------------------------------
.  BAS Codes Table Details (TABLE HEADING)
.------------------------------------------------------------
BASHD000  WRITE     HTMLFILE;"<tr>":
                               "<td class=HeadingCell width=15%>":
                               "BAS Code</td>":
                               "<td class=HeadingCell width=30%>":
                               "Description</td>":
                               "<td class=HeadingCell width=15%>":
                               "BAS Code Type</td>":
                               "<td class=HeadingCell width=15%>":
                               "Active</td>":
                             "</tr>"
.
BASHD999  RETURN
.------------------------------------------------------------
. BAS Codes Table (TABLE ROW)
.------------------------------------------------------------
BASRW000  MOVE      "Yes",ACTIVE 
          COMPARE   ONE,IBBAACTV
          IF        @EQUAL
            MOVE      "No",ACTIVE
          ENDIF 
.
          MOVE      IBBATYPE,F1
          MOVE      TYPEDES0,BASTYPE
          LOAD      BASTYPE,F1,TYPEDES1,TYPEDES2
.
          WRITE     HTMLFILE;"<tr><td nowrap><A HREF='javascript:ShowDetail":
                             "(#"",LINKPRG,"#.pbl":
                             "?reportno=",LINKREP:
                             "&template=",LINKTEM:
                             "&ibbac001=",IBBABASC,"#")'>":
                             "<img src=../images/MaintenanceIcon.gif hspace=4":
                             " border=0 align=absmiddle></a>":
                             IBBABASC,"</td>":
                             "<td>",IBBADESC,"</td>":
                             "<td>",BASTYPE,"</td>":
                             "<td>",ACTIVE,"</td>":
                             "</tr>"
.
BASRW999 RETURN
.
.------------------------------------------------------------
. NOMORE00 - Display "No more records" at end of list
.------------------------------------------------------------
NOMORE00  WRITE     HTMLFILE;"<tr>":
                             "<td class=RedCell colspan=20 align=center>":
                             "No more records</td>"
.
NOMORE99  RETURN
.

.------------------------------------------------------------------------------
. I/O and Subroutine Includes
.------------------------------------------------------------------------------
.
          INC       IBAGSTIO/INC      * GST Master
          INC       IBABASIO/INC      
          INC       IBAGEDIO/INC
.
          INC       IBAWEBCD
          INC       DAYOFWEK
          INC       RSHWEBCD
          INC       WEBDATCD
