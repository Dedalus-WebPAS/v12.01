.------------------------------------------------------------------------------
. Program       : PATWEB61
.
. Function      : Billing System Maintenance Server for 
.                 Report 1: Invoice Range Table Maintenance 
.                 Report 2: MBS Explosion Charges Table Maintenance 
.                 Report 3: Suggested Classification Maintenance 
.                 Report 4: Invoice Financial - End of Year Reset
.                 Report 5: Patient General Ledger Maintenance    
.                 Report 6: Regime Code Maintenance    
.                 Report 7: System based G/L Interface Maintenance
.                 Report 8: NZP Hospital Based Invoice Range Maintenance    
.
. Modifications :
.------------------------------------------------------------------------------
.      V12.00.01  07/08/2025  Z.Yu    TSK 0964606
.                 Updated NORECORD in SGATB000 by using PTCNNRTD parameter
.                 Added NOMORE00 in SGATB990
.      V11.05.04  05/03/2025  J.Tan   TSK 0955356
.                 Added SKEY40 for PATCALFN
.      V11.05.03  21/02/2025  J.Tan   TSK 0955356
.                 Added FININVN,FINADMN,FINURNO - Financial Summary
.      V11.05.02  20.12.2024 DA Sarkies      TSK 0954547
.                 Commented out <cat> tags to prevent browser incompatibility
.      V11.05.01  26/11/2024  Ebon Clements TSK 0954547
.                 Added <cat-c> start and end tag to category=XX tag
.      V11.04.08  18/07/2024  Bella Turco   TSK 0919569
.                 Fixed Misc Code Desc in MBS Explosion row output MBSRW000     
.      V11.04.07  17/07/2024  Bella Turco   TSK 0919569
.                 New tag option for displaying Misc Code Description (MBSX0860)
.      V11.04.06  09/07/2024  Bella Turco   TSK 0919569
.                 New tag option for displaying MBS Code Description (MBSX0602)
.      V11.04.05  04/06/2024  Bella Turco   TSK 0919569
.                 New routines for searching MBS Explosion by new patechaf  
.                 index 2 - by MBS Code (RSMBSX00 & RKMBSX00)
.      V11.04.04  01/05/2024  Bella Turco   TSK 0919569
.                 Display "All" if Admission Type is blank in tag MBSX1700
.                 Fixed tag unpack issue in MBSX1700
.      V11.04.03  15/01/2024  Bella Turco   TSK 0919569
.                 New CGI variables PTEC0010/11/12
.                 Added new tags MBSX1400/15/16/17/18
.                 Edited MBS Explosion Maintenance table MBSTB000
.      V11.04.02  05/12/2023  Nikitha B     TSK 0940628
.                 Added new tag PMRE1700 to display red colored items button. 
.      V11.04.01  27/11/2023 Thanh T        TSK 0903618
.                 Clear PTECHFND, PTECHGRP and PTCEQNTY fields          
.------------------------------------------------------------------------------
.      V11.03.05  15/07/2023  Nikitha B     TSK 0932631
.                 Added FILTACTV filter to Regime Code Maintenance.
.      V11.03.04  21/04/2023  Bella Turco   TSK 0921957
.                 Fixed more scenarios of NOMORE00 in wrong place in DISACC00
.      V11.03.03  20/04/2023  Bella Turco   TSK 0921957
.                 Fixed NOMORE00 in wrong place in DISACC00                
.      V11.03.02  10/01/2023  Bella Turco   TSK 0921957
.                 Continued adding PTCNNRTD & NOMORE00 to maintenance lists
.      V11.03.01  15/12/2022  Bella Turco    TSK 0921957
.                 Added NOMORE00 - Display "No more records" at end of list
.                 Added PTCNNRTD - Displays number of rows set by parameter 
.                 value
.      V11.02.01  20/01/2022  J.Tan          TSK 0915428
.                 Mod CACCFEE=4 G/L interface to check All Ward for Daily charge
.      V11.01.03  18/08/2021  J.Tan          TSK 0903454
.                 Added Claim code to Lumpsum/Daily charge for CACCFEE=4
.      V11.01.02  18/06/2021  J.Tan          TSK 0893195
.                 Mod SX G/L to validate NZ Misc. instead of patitem (GLIN3992)
.      V11.01.01  02/03/2020  J.Tan          TSK 0902415
.                 Fixed GLIN3410 to display ward if CACCFEE<>5
.      V11.00.01  28/02/2020  J.Tan          TSK 0838262
.                 Added Effective from and to date to MBS Item file
.      V10.15.01  30/01/2020  J.Tan      TSK 0887341
.                 Added Emergency system to System based G/L interface
.      V10.14.01  01/10/2019  Peter Vela TSK 0878570
.                 Added PACK to FINSY004 in PATFIN20
.      V10.12.01  15.01.2018  J.Tan   TSK 0848146
.                 Added CACCFEE=5 - Accumulation FI by Claim code
.      V10.11.01  19.09.2017  J.Tan   TSK 0827346
.                 Fixed displaying Suggested Class.desc.for Enquiry screen
.      V10.06.01  02.06.2015  J.Tan   CAR 318938
.                 Mods to increase carry forward balance finsy003 to F12.2
.      V10.05.01  27.11.2014  J.Tan   CAR 309205
.                 Mods to keyin Ward for G/L Interface accommodation (NO FMS)
.      V10.04.01  31.03.2014  B.G.Ackland  CAR 299363
.                 Replace META Tag Redirect with Javascript in Common RDIREC00
.                 Routine
.------------------------------------------------------------------------------
.      V10.03.02  03/09/2013  Peter Vela     CAR 289879
.                 Allow display of non existent ICD10 header records in SGARW000
.                 and PMSC1000
.      V10.03.01  25/02/2013  Ania P         CAR 281021
.                 Removed unnecessary modification of constants.
.------------------------------------------------------------------------------
.      V10.02.02  27/06/2011  Peter McMullem   240725
.                 Change ward selection list to sort by name, not code 
.      V10.02.01  20/05/2011  J.Tan         234109
.                 Fixed reading ICD10 description for ICD10 sugg.class.
.------------------------------------------------------------------------------
.      V10.01.02  03/12/2010  Mike Laming   CAR 233046
.                 Mods to "patmchgf" - use "Table Type" (PTMCHFTT) replacing
.                 "H/F Table" (MHFTAB)
.      V10.01.01  11/11/2010  Ebon Clements 233071
.                 Added hospital filter NZP Hosp.based Invoice Range
.      V10.00.02  29/07/2010  J.Tan     CAR 227062
.                 Fixed previous and next screen for Hospital based inv.range
.      V10.00.01  30/04/2010  J.Tan     CAR 220887
.                 Mods checking for Active/Inactive of Misc.charge
.      V9.11.02   16/03/2009  J.Tan         CAR 188110
.                 Added ICD10 Suggested Classification 
.      V9.11.01   22/01/2009  J.Tan         CAR 165098
.                 Added Suggested Classification Enquiry
.      V9.10.03   01/10/2008  J.Tan         CAR 172904
.                 Added tag for SX Split GST journal
.      V9.10.02   16/09/2008  J.Tan         CAR 170967
.                 Fixed CACCFEE 2 for Ward/Adm.type
.      V9.10.01   03/06/2008  Ebon Clements CAR 164485
.                 Added regime enquiry tag - EREG0000
.      V9.09.05   29/11/2007  Peter Vela    CAR 147950
.                 Initialised PTSGC008 to SP70 @ CLRPAR00
.      V9.09.04   28/11/2007  Peter Vela     CAR 147950
.                 Added MBS Item Keyword search for Suggested Classification
.                 Maintenance
.      V9.09.03   28/11/2007  Peter McMullen CAR 155341
.                 Changed title of Regime Code Maintence Pages
.      V9.09.02   15/10/2007  Peter Vela    CAR 148954
.                 Changed CAT XX (PMRESNCD) to CAT sn
.      V9.09.01   04/09/2007  Peter Vela    CAR 148954
.                 Added Expected Length of Stay and Special Needs Code to
.                 PMSREGFD maintenance
.      V9.08.06   15/05/2007  J.Tan         CAR 140282
.                 Added PTCNUFMS=2 for Using Other FMS
.      V9.08.05   10/05/2007  J.Tan         CAR 140282
.                 Added Theatre sub-section for SX NZ Private
.      V9.08.04   03/04/2007  Peter Vela    CAR 137671
.                 Added Credit Account column to GL maintenance
.                 DGLHD000 DGLRW000
.      V9.08.03   27/11/2006  Peter Vela    CAR 126013
.                 Added Type 3 to MROW0000 MBS Items for Regime Maintenance
.      V9.08.02   14/11/2006 J.Tan         CAR 124752
.                 New option for Hospital based Invoice range
.      V9.08.01   08/11/2006 J.Tan         CAR 123584
.                 New option for System based G/L Interface
.      V9.07.03   20/09/2006 J.Tan         CAR 119336
.                 Added claim code to Suggested classification file
.      V9.07.02   12/09/2006 Ebon Clements CAR 103367
.                 Mods report 6 - added item type for Regime or Misc.Item
.      V9.07.01   08/06/2006 Ebon Clements CAR 103367
.                 Added report 6 fee estimate regime code maintenance
.      V9.06.02   19/05/2006 J.Tan         CAR 105459
.                 Added Hospital ID to patfmsaf file
.      V9.06.01   27/04/2006 J.Tan         CAR 93324
.                 Fixed updating patfmsaf for ptcnjfee=1 (claimcode/journalcode)
.      V9.05.03   18/04/2006 J.Tan         CAR 93324
.                 Fixed updating patfmsaf for ptcnjfee=1 (claimcode/journalcode)
.      V9.05.02   09/03/2006  Ebon Clements CAR 78533
.                 Mods for PATCODTM - Hospital specific category codes
.      V9.05.01   07/03/2006 J.Tan         CAR 93324
.                 Fixed displaying fields for journal by claim code/journal code
.      V9.05.B01  30.01.2006  Ebon Clements CAR 93186
.                 Mods for REDIRECT length change. Recompiled for IBAWEBDF
.      V9.04.02   01.10.2004  Lina Vo         CAR 53798
.                 Changed program to use PTHSDCLM instead of PTCNDCLM for
.                 Multi Hospital.
.      V9.04.01   19/08/2004 J.Tan         CAR 52835
.                 Mods for multi hospitals - patfinsf file
.      V9.03.11   28/06/2004 Lina Vo       CAR 49814
.                 Added CGLIND for GL Interface Maintenance.  
.      V9.03.10   18/06/2004 Ebon Clements CAR 50833
.                 Fixed call stack overflow from CALL MAIN1000
.      V9.03.09   06/05/2004  Lina Vo       CAR 49559
.                 Changed End of Year reset to use common code RP for
.                 Available Systems.
.      V9.03.08   02/02/2004  Lina Vo       CAR 46098
.                 Replaced CACCFEE=3 with PTCNJFEE=1 for GL Journal Maintenance.
.                 Added PTCNJFEE tag.
.      V9.03.07   13/10/2003  Lina Vo       CAR 36497
.                 Added Patient General Ledger Maintenace (GLINTR00).
.      V9.03.06   01/09/2003  Lina Vo       CAR 40497
.                 Changed index and read of patmchgf to include effective date.
.      V9.03.05   11/08/2003  Tracey Nguyen CAR 41656
.                 Removed Health Fund Selection list and replaced with 
.                 Health Fund search for Suggested Classification Maintenance.
.      V9.03.04   06/08/2003  Tracey Nguyen CAR 41889
.                 Changed REDIRECT to display "Job Submitted" instead of
.                 "Record Saved"
.      V9.03.03   20/05/2003  Tracey Nguyen CAR 36509
.                 Created report 4 for End of Year Reset
.      V9.03.02   13/05/2003  Tracey Nguyen CAR 36500
.                 Created report 3 for Suggested Classification Maintenance
.                 option
.      V9.03.01   10/04/2003  Tracey Nguyen SRF/CAR 36499
.                 Created report 2 for MBS Explosion Charge Maintenance option
.------------------------------------------------------------------------------
.      V9.02.00   17/03/2003  Tracey Nguyen SRF/CAR 36493
.                 Created new web server program for Patient Invoice Range
.                 Table (patirnge) Maintenance
.------------------------------------------------------------------------------
.
.------------------------------------------------------------------------------
. FD Includes
.------------------------------------------------------------------------------
.
          INC       IBAWEBDF
          INC       WEBDATDF
          INC       RSHWEBDF
.
          INC       PATCOMM/INC             * IBA Control file
          INC       IBASMAFD/INC            * Common system master file
          INC       IBABASFD/INC
.
          INC       FMSAMAFD/INC            * Accounts
          INC       FMSDISFD/INC            * Dissection
          INC       FMSLMAFD/INC            * Ledger
          INC       FMSRESFD/INC            * Responsibility
          INC       FMSCSAFD/INC            * Control accounts
.
          INC       OUTSITFD/INC            * Outpatient site code file
.
          INC       PATCONFD/INC            * Patient Control file
          INC       PATDRGFD/INC            * Period Date Range file
          INC       PATECHFD/INC            * MBS Explosion Charges file
          INC       PATRFNFD/INC
          INC       NZPRFNFD/INC
          INC       PATRFGFD/INC
          INC       PATFINFD/INC            * Invoice Financial file
          INC       PATFIGFD/INC            * Invoice Financial file
          INC       NZPFINFD/INC            * Invoice financial summary file
          INC       NZPFIGFD/INC            * Invoice financial summary file
          INC       PATFMSFD/INC            * Interface File
          INC       PMSFMSFD/INC            * System based Interface File
          INC       PATFN1FD/INC            * Health Fund file
          INC       PATHSPFD/INC            * Hospital file
          INC       PATIKIFD/INC            * MBS Keyword file
          INC       PATIRNFD/INC            * Invoice Range file
          INC       NZPIRNFD/INC            * NZP Hospital based Inv.Range file
          INC       NZPIRNTD/INC            * NZP Hospital based Inv.Range file
          INC       PATITMFD/INC            * Items file
          INC       PATMCHFD/INC            * Miscellaneous Charges file
          INC       NZPMCHFD/INC
          INC       PATSGCFD/INC            * Sugg. class. exceptions file
          INC       PATWR1FD/INC
          INC       PMSREGFD/INC            * Regime Details
          INC       PMSSGAFD/INC            * ICD10 Suggested Classification
          INC       PATICDFD/INC            * ICD10 file
          INC       PATDICFD/INC            * ICD10 Keyword
          INC       PATHGPFD/INC            * Patient Health Fund Group File FD
.

.-----------------------------------------------------------------------------
. Variable Declarations
.-----------------------------------------------------------------------------
.
. CGI Parameters
. **************
.
NEXTPAGE  FORM      1         * Nextpage parameter
UPDTTYPE  DIM       1         * Update Type (A)dd,(U)pdate,(D)elete,Blank=disp
STARTKEY  DIM       10        * Starting Key for search
.
. Fee estimate regime cgi vars
.
PMREG001  DIM       10        * Regime Code
PMREG002  DIM       3         * Unique Number
PMREG003  DIM       40        * Description
PMREG004  DIM       1         * Item Type
PMREG005  DIM       10        * Miscellaneous or Regime Code
PMREG006  DIM       1         * Active 0=Active 1=Inactive
PMREG007  FORM      3         * Expected Length of Stay
PMREG008  DIM       3         * Special Needs Code
.
. Patient Invoice Range (PATIRNFD) parameters
.
PTIRN001  DIM       3         * Invoice range code 
PTIRN002  DIM       40        * Invoice range description
PTIRN003  FORM      8         * Next invoice number in range 
PTIRN004  FORM      8         * Maximum invoice number in range 
.
. Patient Exploding Charges (PATECHFD) parameters
.
PTEC0001  DIM       3         * Claim type (Category CL)
PTEC0002  DIM       3         * Admission type (Category A)
PTEC0003  DIM       9         * MBS Code
PTEC0004  FORM      3         * Unique counter
PTEC0005  DIM       9         * Exploding miscellaneous charge
PTEC0006  DIM       3         * Operating personnnel code (Category OP)
PTEC0007  FORM      3.2       * 1st % of miscellaneous charge fee
PTEC0008  FORM      3.2       * 2nd % of miscellaneous charge fee
PTEC0009  FORM      3.2       * 3rd % of miscellaneous charge fee
PTEC0010  DIM       6         * Health Fund (Active)
PTEC0011  DIM       6         * Health Fund Group (Active)
PTEC0012  DIM       3         * Quantity
.
. Patient Suggested Classification Exceptions
.
PTSGC001  DIM       6         * Health Fund Code (from PATFN1FD)
PTSGC002  DIM       9         * MBS Item Code     (from PATITMFD)
PTSGC003  DIM       3         * Suggested classification (Category A)
PTSGC004  DIM       3         * Claim Code
PTSGC005  FORM      1         * All Claim code
PTSGC006  FORM      1         * All Health fund
PTSGC007  FORM      1         * All MBS
PTSGC008  DIM       15        * MBS Item Keyword
.
CPSGC001  DIM       6         * Copy To Health Fund Code
CPSGC002  DIM       9         * Copy To MBS Item Code
CPSGC003  DIM       3         * Copy To Claim code
CPSGC004  DIM       8         * Copy To Health Fund Table
INDEXCNT  FORM      2
.
. Invoice Financial Summary File 
.
FINSY001  FORM      1         * System indicator
FINSY002  DIM       9         * Miscellaneous Code
FINSY003  FORM     12.2       * Carry forward balance amount
FINSY004  DIM       3         * Outpatient site system       
                              * 1 - Outpatient system
                              * 2 - Radiology system
                              * 3 - Mammography system
.
. General Ledger Interface File 
.
ADMISSTP  DIM       3         * Admission Type (Cat A )        
CLAIMCOD  DIM       3         * Claim Code (Cat CL)            
GROUPCOD  DIM       3         * Group Code (Cat FI)            
ITEMCODE  DIM       9         * Item Code             
ACCMWARD  DIM       3         * Ward
JOURNALC  DIM       2         * Journal Code (Cat J )
EPISODTP  DIM       1         * Episode Type 0=MSO 1=Daycase
DAYCASIP  DIM       1         * 0=Inpatient 1=Daycase
SUBSECTN  DIM       1         * Submenu options         
HOSPCODE  DIM       3         * Hospital id
NEWRECRD  DIM       1         * Add new record flag     
SESSTYPE  DIM       3         * Session Type(Cat TU)            
.
GLINT001  DIM       1         * Report Sub Section 
.                               1=Accommodation
.                               2=Theatre
.                               3=Misc Items   
.                               5=Journals     
GLINT002  DIM       13        * Report Sub Section Code
............................... Fees Invoiced
GLINT003  DIM       5         * Dissection
GLINT004  DIM       4         * Responsibility
GLINT005  DIM       2         * Ledger    
GLINT006  DIM       12        * Credit Account/Income Account
GLINT007  DIM       12        * Debit Account/Debtors Control Account
GLINT008  DIM       12        * GST Control Account
GLINT009  DIM       3         * BAS Code  
............................... Fees to be Invoiced
GLINT010  DIM       5         * Dissection
GLINT011  DIM       4         * Responsibility
GLINT012  DIM       2         * Ledger
GLINT013  DIM       12        * Credit Account
GLINT014  DIM       12        * Debit Account
GLINT015  DIM       3         * Hospital ID
. 
SYSGL001  DIM       1         * Report Sub Section
.                               1=Accommodation
.                               3=Misc Items
.                               5=Journals
SYSGL002  DIM       13        * Report Sub Section Code
.Inpatient
............................... Fees Invoiced
SYSGL003  DIM       5         * Dissection
SYSGL004  DIM       4         * Responsibility
SYSGL005  DIM       2         * Ledger
SYSGL006  DIM       12        * Credit Account/Income Account
SYSGL007  DIM       12        * Debit Account/Debtors Control Account
SYSGL008  DIM       12        * GST Control Account
SYSGL009  DIM       3         * BAS Code
............................... Fees to be Invoiced
SYSGL010  DIM       5         * Dissection
SYSGL011  DIM       4         * Responsibility
SYSGL012  DIM       2         * Ledger
SYSGL013  DIM       12        * Credit Account
SYSGL014  DIM       12        * Debit Account
SYSGL015  DIM       3         * Hospital ID
SYSGL016  DIM       1         * System
.
.Outpatient
............................... Fees Invoiced
SYSGL017  DIM       5         * Dissection
SYSGL018  DIM       4         * Responsibility
SYSGL019  DIM       2         * Ledger
SYSGL020  DIM       12        * Credit Account/Income Account
SYSGL021  DIM       12        * Debit Account/Debtors Control Account
SYSGL022  DIM       12        * GST Control Account
SYSGL023  DIM       3         * BAS Code
............................... Fees to be Invoiced
SYSGL024  DIM       5         * Dissection
SYSGL025  DIM       4         * Responsibility
SYSGL026  DIM       2         * Ledger
SYSGL027  DIM       12        * Credit Account
SYSGL028  DIM       12        * Debit Account
.
.Emergency
............................... Fees Invoiced
SYSGL029  DIM       5         * Dissection
SYSGL030  DIM       4         * Responsibility
SYSGL031  DIM       2         * Ledger
SYSGL032  DIM       12        * Credit Account/Income Account
SYSGL033  DIM       12        * Debit Account/Debtors Control Account
SYSGL034  DIM       12        * GST Control Account
SYSGL035  DIM       3         * BAS Code
............................... Fees to be Invoiced
SYSGL036  DIM       5         * Dissection
SYSGL037  DIM       4         * Responsibility
SYSGL038  DIM       2         * Ledger
SYSGL039  DIM       12        * Credit Account
SYSGL040  DIM       12        * Debit Account
.
OTFMFLED  DIM       2         * Outpatient Ledger
OTFMFCRD  DIM       12        * Credit Account
OTFMFDEB  DIM       12        * Debit Account
OTFMGSTA  DIM       12        * GST Control Account
OTFMTLED  DIM       2         * Ledger
OTFMTCRD  DIM       12        * Credit Account
OTFMTDEB  DIM       12        * Debit Account
.
AEFMFLED  DIM       2         * Emergency Ledger
AEFMFCRD  DIM       12        * Credit Account
AEFMFDEB  DIM       12        * Debit Account
AEFMGSTA  DIM       12        * GST Control Account
AEFMTLED  DIM       2         * Ledger
AEFMTCRD  DIM       12        * Credit Account
AEFMTDEB  DIM       12        * Debit Account
.
. Patient Suggested Classification Exceptions
.
PMSGC001  DIM       3         * Claim Code
PMSGC002  DIM       6         * Health Fund Code (from PATFN1FD)
PMSGC003  DIM       8         * Health Fund Table (from PATFN1FD)
PMSGC004  DIM       9         * ICD10 Code
PMSGC005  DIM       3         * Suggested classification (Category A)
PMSGC007  FORM      1         * All Claim code
PMSGC008  FORM      1         * All Health fund
PMSGC009  FORM      1         * All ICD10
.
. Program Variables
. *****************
.
CURRDATE  DIM       8                              
DFLTWARD  DIM       3         * ward to be marked selected in select lists 
DIM3      DIM       3 
DIM15     DIM       15
DIM21     DIM       21
DIM21A    DIM       21
DIM26     DIM       26                             
DIM26A    DIM       26                             
ENQFLAG   FORM      1
FILEOPEN  DIM       30
FILTHOSP  DIM       3
FORM1A    FORM      1        
FUNDCODE  DIM       6         * Health Fund Code
FGSTFLAG  FORM      1
INDEX     FORM      1
NOINDEX2  FORM      1
GROUPDES  DIM       20        * Group Description
KEY21A    DIM       21
KEY26A    DIM       26
LEDDESC1  DIM       35
LEDDESC2  DIM       35
LOCCITEM  FORM      2
SAVKEY3   DIM       3         
SITETYPE  DIM       3         * Outpatient site system       
XLCNT     FORM      2
KEYNWARD  DIM       3         * Ward
FILTACTV  DIM       1         * Active/Inactive status filter
SKEY40    DIM       40
.
. Program Constants
. *****************
CACCFEE0  INIT      "Admission Types"  
CACCFEE1  INIT      "Ward/Claim Codes"  
CACCFEE2  INIT      "Ward/Adm.Types"  
CACCFEE3  INIT      "Ward/Claim/Adm.Types"  
CACCFEE4  INIT      "Ward/Adm.Types/Claim"  
CACCFEE5  INIT      "Claim Type"  
CODEA     INIT      "A "
CODECL    INIT      "CL"
CODEFI    INIT      "FI"
CODETU    INIT      "TU"
CODEJ     INIT      "J "
.
FIVE9     FORM      "59"
FMSAMA    INIT      "fmsamaaf"
FMSDIS    INIT      "fmsdisaf"
FMSLMA    INIT      "fmslmaaf"
FMSRES    INIT      "fmsresaf"
FMSPAT    INIT      "fmspataf"
.
HFHEADER  INIT      "0000    "              * Health Fund Header table
INVALIDS  INIT      "Invalid ("            
INVALIDE  INIT      ")"            
NBSP      INIT      "&nbsp;"
+
.-----------------------------------------------------------------------------
.
PRGID     INIT      "PATWEB61"
VERSION   INIT      "V12.01.00"
PRGNAM    INIT      "Billing Maintenance Server"
+
.------------------------------------------------------------------------------
.
          CALL      WEBINT00                * Initialise Fifo Etc.
          CALL      INIT0000                * Open Files
.
MAIN1000  CALL      WEBRED00                * Read Fifo WEBPID and USERID
.
          COMPARE   "999",REPORTNO          * End Server Process if Option=999
          GOTO      MAIN9999 IF EQUAL
.
          PACK      CURRDATE,CCC,CYY,CMM,CDD
          REP       " 0",CURRDATE
.
          BRANCH    REPORTNO,MAIN1100,MAIN1200,MAIN1300,MAIN1400,MAIN1500:
                             MAIN1600,MAIN1700,MAIN1800,MAIN1900
.
          PACK      WEBTITLE,PRGID,SP1,VERSION,SP1,PRGNAM,SP70
          MOVE      "Invalid Option",WEBTITLE
          CALL      WEBERR00                * Output File & Write HTML Pg Header
          GOTO      MAIN1000
.
MAIN1100  CALL      PTIRNG00                * Invoice Range Maintenance
          BRANCH    EXIT,MAIN1000
          CALL      NXTPG000                * next page
          GOTO      MAIN1000
. 
MAIN1200  CALL      MBSEXP00                * MBS Explosion Charge Maintenance
          BRANCH    EXIT,MAIN1000
          CALL      NXTPG000                * next page
          GOTO      MAIN1000
. 
MAIN1300  CALL      PATSGC00                * Suggested class exceptions file
          BRANCH    EXIT,MAIN1000
          CALL      NXTPG000
          GOTO      MAIN1000
.
MAIN1400  CALL      PATFIN00                * Invoice Financial Summary
          BRANCH    EXIT,MAIN1000
          CALL      NXTPG000
          GOTO      MAIN1000
.          
MAIN1500  CALL      GLINTR00                * General Ledger Interface 
          BRANCH    EXIT,MAIN1000
          CALL      NXTPG000
          GOTO      MAIN1000
.          
MAIN1600  CALL      REGM0000                * Regime Maintenance
          BRANCH    EXIT,MAIN1000
.
          CALL      NXTPG000                * next page
          GOTO      MAIN1000
. 
MAIN1700  CALL      SYGLED00                * System based G/L Interface(No FMS)
          BRANCH    EXIT,MAIN1000
          CALL      NXTPG000
          GOTO      MAIN1000
.          
MAIN1800  CALL      NZIRNG00                * NZP Hosp.based Invoice Range
          BRANCH    EXIT,MAIN1000
          CALL      NXTPG000
          GOTO      MAIN1000
.
MAIN1900  CALL      PMSSGC00                * ICD10 Suggested Classification
          BRANCH    EXIT,MAIN1000
          CALL      NXTPG000
          GOTO      MAIN1000
.          
MAIN9999  MOVE      "SERVER SHUTDOWN COMPLETE",WEBTITLE
          CALL      WEBERR00
          STOP
+
.------------------------------------------------------------------------------
.  Next Page URL
.------------------------------------------------------------------------------
.
NXTPG000  IF        NEXTPAGE=0
            CALL      WINCLS00              * Refresh parent and close window
          ENDIF

          IF        NEXTPAGE=1
            CALL      RDIREC00              * Redirect URL
          ENDIF
.
          IF        NEXTPAGE=2
            CALL      GOBACK00              * Go Back 1 html page
          ENDIF
.
          IF        NEXTPAGE=3
            CALL      DAH20000              * Go Back 2 html pages
          ENDIF
.
NXTPG999  RETURN
.------------------------------------------------------------------------------
.  Goes back 1 page
.------------------------------------------------------------------------------
.
GOBACK00  CALL      OPENHTML
          BRANCH    EXIT,GOBACK99
          WRITE     HTMLFILE;"<script type=#"text/javascript#"> {":
                             "    alert(#"",WEBTITLE,"#");":
                             "    self.close();":
                             "    opener.history.go(-1);":
                             "}":
                             "</script>"

          CALL      CLOSHTML
.
GOBACK99  RETURN
+
.------------------------------------------------------------------------------
. Open Files and Initialize Variables
.------------------------------------------------------------------------------
.
INIT0000  OPEN      IBASMAA1,"ibasmaaf"
          OPEN      IBABASA1,"ibabasaf"
.
          OPEN      COMCODA1,"comcodaf"
          OPEN      COMCODA2,"comcodaf"
          OPEN      OUTSITA1,"outsitaf"
          OPEN      PATCODE1,"patcodes"
          OPEN      PATCODE2,"patcodes"
          OPEN      PATECHA1,"patechaf"
          OPEN      PATHSPA1,"pathspaf"
          OPEN      PATIKIA1,"patikiaf"
          OPEN      PATHGRP1,"pathgrpf"
          OPEN      PATITEM1,"patitemn"
          OPEN      PATIRNG1,"patirnge"      
          OPEN      NZPIRNA1,"nzpirnaf"      
          OPEN      NZPIRNA2,"nzpirnaf"      
          OPEN      PATFINS1,"patfinsf"     * Invoice Financial Summary file
          OPEN      PATFN1A1,"patfn1af"     * Open Health Fund File
          OPEN      PATMCHG1,"patmchgf"
          OPEN      PATMCHG4,"patmchgf"
          OPEN      PATSGCA1,"patsgcaf"     * Suggested class. exceptions file
          OPEN      PATWR1A1,"patwr1af"
          OPEN      PATWR1A7,"patwr1af"
          OPEN      PMSREGA1,"pmsregaf"
          OPEN      PMSREGA2,"pmsregaf"
          OPEN      PMSREGA3,"pmsregaf"
          OPEN      PMSREGA4,"pmsregaf"
          OPEN      PMSSGAA1,"pmssgaaf"
          OPEN      PATDICA1,"patdicaf"
.
          CALL      OPICD1
.
.-------------------------------------------------------------------------------
. Open and Read the Control file variables
.-------------------------------------------------------------------------------
.
          OPEN      CONTROLF,"controlf"
.
          READ      CONTROLF,TWENTY;*193,PTCNDCLM
.
          MATCH     SP3,PTCNDCLM
          IF        @EQUAL
            PACK    PTCNDCLM,ZERO,SP2
          ENDIF
.
          READ      CONTROLF,ZERO;*25,IBCNAESN:  * AAE system number
                                  *28,IBCNOPSN:  * Outpatient system number
                                  *31,IBCNBLSN:  * Patient Billing syst number
                                  *34,IBCNMASN:  * Mamography System Number
                                  *37,IBCNRASN:  * Radiology System Number
                                  *40,IBCNINSN:  * Inpatient System Number
                                  *43,IBCNMHOS:  * Multi hospitals
                                  *85,IBCNUGST:                              
                                  *107,IBCNUBAS                              
.
          READ      CONTROLF,TEN;*192,CACCFEE  
          READ      CONTROLF,TEN8;*162,CGLIND,CGLPATH  
          READ      CONTROLF,TEN9;*212,CFEETYP
          READ      CONTROLF,FIVE9;*127,COTHSFN  * Other Financial option y/n
          READ      CONTROLF,FIFTY9;*60,PTCNUFMS
          READ      CONTROLF,SEVENTY9;*68,PTCNMFEE,PTCNJFEE  
          READ      CONTROLF,HUND03;*219,PTCNSIGL
          READ      CONTROLF,HUND12;*248,PTCNGJRN
          READ      CONTROLF,HUND25;*238,PTCNNRTD
.
          CALL      OPNFMS00
.
          IF        IBCNMHOS=1
            OPEN      MLTCODA1,"mltcodaf"
            OPEN      MLTCODA2,"mltcodaf"
          ENDIF
.
          MOVE      ZERO,F2
          MOVE      PTCNNRTD,F2
          IF        F2 = 0
            MOVE      "10",PTCNNRTD
          ENDIF
.
INIT9999  RETURN
+
.------------------------------------------------------------------------------
. Open Finanical Management Files
.------------------------------------------------------------------------------
.
OPNFMS00  MOVE      TWENTY,XLCNT
OPNFMS10  RESET     CGLPATH,XLCNT
          CMATCH    SP1,CGLPATH
          GOTO      OPNFMS20 IF NOT EQUAL
          SUB       ONE,XLCNT
          COMPARE   ZERO,XLCNT
          GOTO      OPNFMS10 IF NOT EQUAL
          CLEAR     CGLPATH
          GOTO      OPNFMS30
.
OPNFMS20  LENSET    CGLPATH
          RESET     CGLPATH
.
OPNFMS30  
          DISPLAY   *P38:24,"patfmsaf";
          MOVE      ZERO,OVRCD
          TRAP      OVERCOND IF IO
          OPEN      PATFMSA1,"patfmsaf"
          TRAPCLR   IO
          BRANCH    OVRCD,OPNFMS80
.
.         MATCH     "1",PTCNSIGL              * Using System based G/L Int.
.         GOTO      OPNFMS40 IF EQUAL
.
          PACK      FILEOPEN,CGLPATH,FMSAMA
          OPEN      FMSAMAA1,FILEOPEN
          OPEN      FMSAMAA2,FILEOPEN
          OPEN      FMSAMAA3,FILEOPEN
          OPEN      FMSAMAA4,FILEOPEN
.
          PACK      FILEOPEN,CGLPATH,FMSDIS
          OPEN      FMSDISA1,FILEOPEN         * Financial Man. Dissection
.
          PACK      FILEOPEN,CGLPATH,FMSLMA
          OPEN      FMSLMAA1,FILEOPEN         * Financial Man. Ledger
.
          PACK      FILEOPEN,CGLPATH,FMSRES
          OPEN      FMSRESA1,FILEOPEN         * Financial Man. Responsibility
.         GOTO      OPNFMS99
.
OPNFMS40  DISPLAY   *P38:24,"pmsfmsaf";
          MOVE      ZERO,OVRCD
          TRAP      OVERCOND IF IO
          OPEN      PMSFMSA1,"pmsfmsaf"
          TRAPCLR   IO
          BRANCH    OVRCD,OPNFMS82
          GOTO      OPNFMS99
.
OPNFMS80  MOVE      "File Not Found, patfmsaf - ",WEBTITLE
          CALL      WEBERR00                
          GOTO      OPNFMS99                             
.
OPNFMS82  MOVE      "File Not Found, pmsfmsaf - ",WEBTITLE
          CALL      WEBERR00                
          GOTO      OPNFMS99                             
.
OPNFMS99  RETURN
+
.------------------------------------------------------------------------------
. Clear Parameters
.------------------------------------------------------------------------------
.
CLRPAR00  MOVE      ZERO,REPORTNO
          MOVE      SP70,TEMPLATE
          MOVE      SP70,UPDTTYPE
          MOVE      ZERO,NEXTPAGE
          PACK      REDIRECT,SP70,SP70,SP70,SP70
          MOVE      ZERO,STARTNUM
          MOVE      ZERO,NORECORD
          MOVE      SP70,STARTKEY
.
          MOVE      SP70,PTIRN001           * Invoice range code
          MOVE      SP70,PTIRN002           * Invoice range description
          MOVE      ZERO,PTIRN003           * Next invoice number in range
          MOVE      ZERO,PTIRN004           * Maximum invoice number in range
          MOVE      SP70,FILTHOSP           * Hospital filter
.
          MOVE      SP70,PTEC0001           * Claim type (cat CL)          
          MOVE      SP70,PTEC0002           * Admission type (cat A)
          MOVE      SP70,PTEC0003           * MBS Code
          MOVE      ZERO,PTEC0004           * Unique counter
          MOVE      SP70,PTEC0005           * Exploding miscellaneous charge
          MOVE      SP70,PTEC0006           * Operating personnel code (cat OP)
          MOVE      ZERO,PTEC0007           * 1st % of miscellaneous charge fee
          MOVE      ZERO,PTEC0008           * 2nd % of miscellaneous charge fee
          MOVE      ZERO,PTEC0009           * 3rd % of miscellaneous charge fee
          MOVE      SP70,PTEC0010           * Health Fund (Active)
          MOVE      SP70,PTEC0011           * Health Fund Group (Active)
          MOVE      SP70,PTEC0012           * Quantity
.
          MOVE      SP70,PTSGC001           * Health Fund Code (from PATFN1FD)
          MOVE      SP70,PTSGC002           * MBS Item Code     (from PATITMFD)
          MOVE      SP70,PTSGC003           * Suggested classification (Cat A)
          MOVE      SP70,PTSGC004           * Claim Code (Cat CL)
          MOVE      ZERO,PTSGC005           * All Claim
          MOVE      ZERO,PTSGC006           * All Health fund
          MOVE      ZERO,PTSGC007           * All MBS
          MOVE      SP70,PTSGC008
.
          MOVE      SP70,CPSGC001           * Copy To Health Fund Code
          MOVE      SP70,CPSGC002           * Copy To MBS Item Code
          MOVE      SP70,CPSGC003           * Copy To Claim code
          MOVE      SP70,CPSGC004           * Copy To Health Fund table
.
          MOVE      ZERO,FINSY001           * Financial System
          MOVE      SP70,FINSY002           * Miscellaneous code
          MOVE      ZERO,FINSY003           * Carry forward amount balance   
          MOVE      SP70,FINSY004           * Outpatient site type  
.
          MOVE      SP70,CLAIMCOD
          MOVE      SP70,GROUPCOD
          MOVE      SP70,ITEMCODE
          MOVE      SP70,ADMISSTP
          MOVE      SP70,ACCMWARD
          MOVE      SP70,KEYNWARD
          MOVE      SP70,JOURNALC
          MOVE      SP70,EPISODTP
          MOVE      SP70,DAYCASIP
          MOVE      SP70,SUBSECTN
          MOVE      SP70,HOSPCODE
          MOVE      SP70,NEWRECRD
          MOVE      SP70,SESSTYPE
.
          MOVE      SP70,GLINT001           * Report Section
          MOVE      SP70,GLINT002           * Report Sub Section Code
.         ..................................  Fees Invoiced
          MOVE      SP70,GLINT003           * Dissection      
          MOVE      SP70,GLINT004           * Responsibility  
          MOVE      SP70,GLINT005           * Ledger          
          MOVE      SP70,GLINT006           * Credit Account/Income Account
          MOVE      SP70,GLINT007           * Debit Account/Debtors Control Acc
          MOVE      SP70,GLINT008           * GST Control Account
          MOVE      SP70,GLINT009           * BAS Code        
.         ..................................  Fees to be Invoiced
          MOVE      SP70,GLINT010           * Dissection      
          MOVE      SP70,GLINT011           * Responsibility  
          MOVE      SP70,GLINT012           * Ledger          
          MOVE      SP70,GLINT013           * Credit Account  
          MOVE      SP70,GLINT014           * Debit Account   
          MOVE      SP70,GLINT015           * Hospital ID
.
          MOVE      SP70,SYSGL001           * Report Section
          MOVE      SP70,SYSGL002           * Report Sub Section Code
.         ..................................  Fees Invoiced
          MOVE      SP70,SYSGL003           * Dissection      
          MOVE      SP70,SYSGL004           * Responsibility  
          MOVE      SP70,SYSGL005           * Ledger          
          MOVE      SP70,SYSGL006           * Credit Account/Income Account
          MOVE      SP70,SYSGL007           * Debit Account/Debtors Control Acc
          MOVE      SP70,SYSGL008           * GST Control Account
          MOVE      SP70,SYSGL009           * BAS Code        
.         ..................................  Fees to be Invoiced
          MOVE      SP70,SYSGL010           * Dissection      
          MOVE      SP70,SYSGL011           * Responsibility  
          MOVE      SP70,SYSGL012           * Ledger          
          MOVE      SP70,SYSGL013           * Credit Account  
          MOVE      SP70,SYSGL014           * Debit Account   
          MOVE      SP70,SYSGL015           * Hospital ID
          MOVE      SP70,SYSGL016           * System
.
          MOVE      SP70,SYSGL017           * Dissection      
          MOVE      SP70,SYSGL018           * Responsibility  
          MOVE      SP70,SYSGL019           * Ledger          
          MOVE      SP70,SYSGL020           * Credit Account/Income Account
          MOVE      SP70,SYSGL021           * Debit Account/Debtors Control Acc
          MOVE      SP70,SYSGL022           * GST Control Account
          MOVE      SP70,SYSGL023           * BAS Code        
.         ..................................  Fees to be Invoiced
          MOVE      SP70,SYSGL024           * Dissection      
          MOVE      SP70,SYSGL025           * Responsibility  
          MOVE      SP70,SYSGL026           * Ledger          
          MOVE      SP70,SYSGL027           * Credit Account  
          MOVE      SP70,SYSGL028           * Debit Account   
.
          MOVE      SP70,SYSGL029           * Dissection      
          MOVE      SP70,SYSGL030           * Responsibility  
          MOVE      SP70,SYSGL031           * Ledger          
          MOVE      SP70,SYSGL032           * Credit Account/Income Account
          MOVE      SP70,SYSGL033           * Debit Account/Debtors Control Acc
          MOVE      SP70,SYSGL034           * GST Control Account
          MOVE      SP70,SYSGL035           * BAS Code        
.         ..................................  Fees to be Invoiced
          MOVE      SP70,SYSGL036           * Dissection      
          MOVE      SP70,SYSGL037           * Responsibility  
          MOVE      SP70,SYSGL038           * Ledger          
          MOVE      SP70,SYSGL039           * Credit Account  
          MOVE      SP70,SYSGL040           * Debit Account   
.
          MOVE      SP70,PMREG001           * Regime Code
          MOVE      SP70,PMREG002
          MOVE      SP70,PMREG003
          MOVE      SP70,PMREG004
          MOVE      SP70,PMREG005
          MOVE      SP70,PMREG006
          MOVE      ZERO,PMREG007
          MOVE      SP70,PMREG008
          MOVE      SP70,FILTACTV 
.
          MOVE      SP70,PMSGC001           * Claim Code (Cat CL)
          MOVE      SP70,PMSGC002           * Health Fund Code (from PATFN1FD)
          MOVE      SP70,PMSGC003           * Health Fund Code (from PATFN1FD)
          MOVE      SP70,PMSGC004           * ICD10 Code
          MOVE      SP70,PMSGC005           * Suggested classification (Cat A)
          MOVE      ZERO,PMSGC007           * All Claim code
          MOVE      ZERO,PMSGC008           * All Health fund
          MOVE      ZERO,PMSGC009           * All ICD10
.
CLRPAR99  RETURN
+
.------------------------------------------------------------------------------
. Set Parameters
.------------------------------------------------------------------------------
.
SETPAR00  MATCH     "reportno=",QRYNAME
          IF        @EQUAL
            MOVE      QRYDATA,REPORTNO
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "template=",QRYNAME
          IF        @EQUAL
            MOVE      QRYDATA,TEMPLATE
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "updttype=",QRYNAME
          IF        @EQUAL
            MOVE      QRYDATA,UPDTTYPE
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "nextpage=",QRYNAME
          IF        @EQUAL
            MOVE      QRYDATA,NEXTPAGE
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "startkey=",QRYNAME
          IF        @EQUAL
            MOVE      QRYDATA,STARTKEY
            PACK      STARTKEY,STARTKEY,SP70
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "redirect=",QRYNAME
          IF        @EQUAL
            MOVE      QRYDATA,REDIRECT
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "norecord=",QRYNAME
          IF        @EQUAL
            MOVE      QRYDATA,NORECORD
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "startnum=",QRYNAME
          IF        @EQUAL
            MOVE      QRYDATA,STARTNUM
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "ptirn001=",QRYNAME
          IF        @EQUAL
            MOVE      QRYDATA,PTIRN001
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "ptirn002=",QRYNAME
          IF        @EQUAL
            MOVE      QRYDATA,PTIRN002
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "ptirn003=",QRYNAME
          IF        @EQUAL
            MOVE      QRYDATA,PTIRN003
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "ptirn004=",QRYNAME
          IF        @EQUAL
            MOVE      QRYDATA,PTIRN004
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "ptec0",QRYNAME
          IF        @EQUAL
            CALL      SPTEC000
            COMPARE   ZERO,EXIT
            GOTO      SETPAR99 IF EQUAL
          ENDIF
.
          MATCH     "ptsgc001=",QRYNAME
          IF        @EQUAL
            MOVE      QRYDATA,PTSGC001
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "ptsgc002=",QRYNAME
          IF        @EQUAL
            MOVE      QRYDATA,PTSGC002
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "ptsgc003=",QRYNAME
          IF        @EQUAL
            MOVE      QRYDATA,PTSGC003
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "ptsgc004=",QRYNAME
          IF        @EQUAL
            MOVE      QRYDATA,PTSGC004
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "ptsgc005=",QRYNAME
          IF        @EQUAL
            MOVE      QRYDATA,PTSGC005
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "ptsgc006=",QRYNAME
          IF        @EQUAL
            MOVE      QRYDATA,PTSGC006
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "ptsgc007=",QRYNAME
          IF        @EQUAL
            MOVE      QRYDATA,PTSGC007
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "ptsgc008=",QRYNAME
          IF        @EQUAL
            MOVE      QRYDATA,PTSGC008
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "cpsgc001=",QRYNAME
          IF        @EQUAL
            MOVE      QRYDATA,CPSGC001
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "cpsgc002=",QRYNAME
          IF        @EQUAL
            MOVE      QRYDATA,CPSGC002
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "cpsgc003=",QRYNAME
          IF        @EQUAL
            MOVE      QRYDATA,CPSGC003
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "cpsgc004=",QRYNAME
          IF        @EQUAL
            MOVE      QRYDATA,CPSGC004
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "finsy001=",QRYNAME
          IF        @EQUAL
            MOVE      QRYDATA,FINSY001
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "finsy002=",QRYNAME
          IF        @EQUAL
            MOVE      QRYDATA,FINSY002
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "finsy003=",QRYNAME
          IF        @EQUAL
            MOVE      QRYDATA,FINSY003
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "finsy004=",QRYNAME
          IF        @EQUAL
            MOVE      QRYDATA,FINSY004
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "claimcod=",QRYNAME
          IF        @EQUAL
            PACK      CLAIMCOD,QRYDATA,SP70
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "admisstp=",QRYNAME
          IF        @EQUAL
            PACK      ADMISSTP,QRYDATA,SP70
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "accmward=",QRYNAME
          IF        @EQUAL
            PACK      ACCMWARD,QRYDATA,SP70
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "journalc=",QRYNAME
          IF        @EQUAL
            PACK      JOURNALC,QRYDATA,SP70
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "episodtp=",QRYNAME
          IF        @EQUAL
            MOVE      QRYDATA,EPISODTP
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "daycasip=",QRYNAME
          IF        @EQUAL
            MOVE      QRYDATA,DAYCASIP
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "groupcod=",QRYNAME
          IF        @EQUAL
            PACK      GROUPCOD,QRYDATA,SP70
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "sesstype=",QRYNAME
          IF        @EQUAL
            PACK      SESSTYPE,QRYDATA,SP70
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "itemcode=",QRYNAME
          IF        @EQUAL
            PACK      ITEMCODE,QRYDATA,SP70
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "subsectn=",QRYNAME
          IF        @EQUAL
            MOVE      QRYDATA,SUBSECTN
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "hospcode=",QRYNAME
          IF        @EQUAL
            MOVE      QRYDATA,HOSPCODE
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "newrecrd=",QRYNAME
          IF        @EQUAL
            MOVE      QRYDATA,NEWRECRD
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "glint",QRYNAME
          IF        @EQUAL
            CALL      SGLIN000
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "sysgl",QRYNAME
          IF        @EQUAL
            CALL      SGLED000
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "pmreg",QRYNAME
          IF        @EQUAL
            CALL      SPREG000
            GOTO      SETPAR99
          ENDIF 
.
          MATCH     "nzirn",QRYNAME
          IF        @EQUAL
            CALL      SPNZIR00
            GOTO      SETPAR99
          ENDIF 
.
          MATCH     "pmsgc001=",QRYNAME
          IF        @EQUAL
            MOVE      QRYDATA,PMSGC001
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "pmsgc002=",QRYNAME
          IF        @EQUAL
            MOVE      QRYDATA,PMSGC002
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "pmsgc003=",QRYNAME
          IF        @EQUAL
            MOVE      QRYDATA,PMSGC003
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "pmsgc004=",QRYNAME
          IF        @EQUAL
            MOVE      QRYDATA,PMSGC004
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "pmsgc005=",QRYNAME
          IF        @EQUAL
            MOVE      QRYDATA,PMSGC005
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "pmsgc007=",QRYNAME
          IF        @EQUAL
            MOVE      QRYDATA,PMSGC007
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "pmsgc008=",QRYNAME
          IF        @EQUAL
            MOVE      QRYDATA,PMSGC008
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "pmsgc009=",QRYNAME
          IF        @EQUAL
            MOVE      QRYDATA,PMSGC009
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "filthosp=",QRYNAME
          IF        @EQUAL
            PACK      FILTHOSP,QRYDATA,SP70
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "keynward=",QRYNAME
          IF        @EQUAL
            PACK      KEYNWARD,QRYDATA,SP70
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "filtactv=",QRYNAME
          IF        @EQUAL
            PACK      FILTACTV,QRYDATA,SP70
            GOTO      SETPAR99
          ENDIF
.
SETPAR99  RETURN
+
.------------------------------------------------------------
. Set Parameters for Exploding Charge Details
.------------------------------------------------------------
.
SPTEC000  MOVE      ZERO,EXIT
          UNPACK    QRYNAME,KEY5,KEY3
          MOVE      KEY3,F3
          BRANCH    F3,SPTEC010,SPTEC020,SPTEC030,SPTEC040,SPTEC050:
                       SPTEC060,SPTEC070,SPTEC080,SPTEC090,SPTEC100:
                       SPTEC110,SPTEC120
.
          MOVE      ONE,EXIT
          GOTO      SPTEC999
.
SPTEC010  MOVE      QRYDATA,PTEC0001
          GOTO      SPTEC999
.
SPTEC020  MOVE      QRYDATA,PTEC0002
          GOTO      SPTEC999
.
SPTEC030  MOVE      QRYDATA,PTEC0003
          GOTO      SPTEC999
.
SPTEC040  MOVE      QRYDATA,PTEC0004
          GOTO      SPTEC999
.
SPTEC050  MOVE      QRYDATA,PTEC0005
          GOTO      SPTEC999
.
SPTEC060  MOVE      QRYDATA,PTEC0006
          GOTO      SPTEC999
.
SPTEC070  MOVE      QRYDATA,PTEC0007
          GOTO      SPTEC999
.
SPTEC080  MOVE      QRYDATA,PTEC0008
          GOTO      SPTEC999
.
SPTEC090  MOVE      QRYDATA,PTEC0009
          GOTO      SPTEC999
.
SPTEC100  PACK      PTEC0010,QRYDATA,SP70
          GOTO      SPTEC999
.
SPTEC110  PACK      PTEC0011,QRYDATA,SP70
          GOTO      SPTEC999
.
SPTEC120  PACK      PTEC0012,QRYDATA,SP70
          GOTO      SPTEC999
.

SPTEC999  RETURN
+
.------------------------------------------------------------
. Set Parameters for General Ledger Interface
.------------------------------------------------------------
.
SGLIN000  UNPACK    QRYNAME,KEY5,KEY3
          MOVE      KEY3,F3
          BRANCH    F3,SGLIN010,SGLIN020,SGLIN030,SGLIN040,SGLIN050:
                       SGLIN060,SGLIN070,SGLIN080,SGLIN090,SGLIN100:
                       SGLIN110,SGLIN120,SGLIN130,SGLIN140,SGLIN150
.
          GOTO      SGLIN999
.
SGLIN010  MOVE      QRYDATA,GLINT001
          GOTO      SGLIN999
.
SGLIN020  PACK      GLINT002,QRYDATA,SP70
          GOTO      SGLIN999
.
SGLIN030  MOVE      QRYDATA,GLINT003
          GOTO      SGLIN999
.
SGLIN040  MOVE      QRYDATA,GLINT004
          GOTO      SGLIN999
.
SGLIN050  MOVE      QRYDATA,GLINT005
          GOTO      SGLIN999
.
SGLIN060  MOVE      QRYDATA,GLINT006
          GOTO      SGLIN999
.
SGLIN070  MOVE      QRYDATA,GLINT007
          GOTO      SGLIN999
.
SGLIN080  MOVE      QRYDATA,GLINT008
          GOTO      SGLIN999
.
SGLIN090  MOVE      QRYDATA,GLINT009
          GOTO      SGLIN999
.
SGLIN100  MOVE      QRYDATA,GLINT010
          GOTO      SGLIN999
.
SGLIN110  MOVE      QRYDATA,GLINT011
          GOTO      SGLIN999
.
SGLIN120  MOVE      QRYDATA,GLINT012
          GOTO      SGLIN999
.
SGLIN130  MOVE      QRYDATA,GLINT013
          GOTO      SGLIN999
.
SGLIN140  MOVE      QRYDATA,GLINT014
          GOTO      SGLIN999
.
SGLIN150  IF        IBCNMHOS=1
            MOVE      QRYDATA,GLINT015
          ENDIF
          GOTO      SGLIN999
.
SGLIN999  RETURN
.------------------------------------------------------------
. Set Parameters for System Based General Ledger Interface
.------------------------------------------------------------
.
SGLED000  UNPACK    QRYNAME,KEY5,KEY3
          MOVE      KEY3,F3
          BRANCH    F3,SGLED010,SGLED020,SGLED030,SGLED040,SGLED050:
                       SGLED060,SGLED070,SGLED080,SGLED090,SGLED100:
                       SGLED110,SGLED120,SGLED130,SGLED140,SGLED150:
                       SGLED160,SGLED170,SGLED180,SGLED190,SGLED200:
                       SGLED210,SGLED220,SGLED230,SGLED240,SGLED250:
                       SGLED260,SGLED270,SGLED280,SGLED290,SGLED300:
                       SGLED310,SGLED320,SGLED330,SGLED340,SGLED350:
                       SGLED360,SGLED370,SGLED380,SGLED390,SGLED400
.
          GOTO      SGLED999
.
SGLED010  MOVE      QRYDATA,SYSGL001
          GOTO      SGLED999
.
SGLED020  PACK      SYSGL002,QRYDATA,SP70
          GOTO      SGLED999
.
SGLED030  MOVE      QRYDATA,SYSGL003
          GOTO      SGLED999
.
SGLED040  MOVE      QRYDATA,SYSGL004
          GOTO      SGLED999
.
SGLED050  MOVE      QRYDATA,SYSGL005
          GOTO      SGLED999
.
SGLED060  MOVE      QRYDATA,SYSGL006
          GOTO      SGLED999
.
SGLED070  MOVE      QRYDATA,SYSGL007
          GOTO      SGLED999
.
SGLED080  MOVE      QRYDATA,SYSGL008
          GOTO      SGLED999
.
SGLED090  MOVE      QRYDATA,SYSGL009
          GOTO      SGLED999
.
SGLED100  MOVE      QRYDATA,SYSGL010
          GOTO      SGLED999
.
SGLED110  MOVE      QRYDATA,SYSGL011
          GOTO      SGLED999
.
SGLED120  MOVE      QRYDATA,SYSGL012
          GOTO      SGLED999
.
SGLED130  MOVE      QRYDATA,SYSGL013
          GOTO      SGLED999
.
SGLED140  MOVE      QRYDATA,SYSGL014
          GOTO      SGLED999
.
SGLED150  IF        IBCNMHOS=1
            MOVE      QRYDATA,SYSGL015
          ENDIF
          GOTO      SGLED999
.
SGLED160  MOVE      QRYDATA,SYSGL016
          GOTO      SGLED999
.
SGLED170  MOVE      QRYDATA,SYSGL017
          GOTO      SGLED999
.
SGLED180  MOVE      QRYDATA,SYSGL018
          GOTO      SGLED999
.
SGLED190  MOVE      QRYDATA,SYSGL019
          GOTO      SGLED999
.
SGLED200  MOVE      QRYDATA,SYSGL020
          GOTO      SGLED999
.
SGLED210  MOVE      QRYDATA,SYSGL021
          GOTO      SGLED999
.
SGLED220  MOVE      QRYDATA,SYSGL022
          GOTO      SGLED999
.
SGLED230  MOVE      QRYDATA,SYSGL023
          GOTO      SGLED999
.
SGLED240  MOVE      QRYDATA,SYSGL024
          GOTO      SGLED999
.
SGLED250  MOVE      QRYDATA,SYSGL025
          GOTO      SGLED999
.
SGLED260  MOVE      QRYDATA,SYSGL026
          GOTO      SGLED999
.
SGLED270  MOVE      QRYDATA,SYSGL027
          GOTO      SGLED999
.
SGLED280  MOVE      QRYDATA,SYSGL028
          GOTO      SGLED999
.
SGLED290  MOVE      QRYDATA,SYSGL029
          GOTO      SGLED999
.
SGLED300  MOVE      QRYDATA,SYSGL030
          GOTO      SGLED999
.
SGLED310  MOVE      QRYDATA,SYSGL031
          GOTO      SGLED999
.
SGLED320  MOVE      QRYDATA,SYSGL032
          GOTO      SGLED999
.
SGLED330  MOVE      QRYDATA,SYSGL033
          GOTO      SGLED999
.
SGLED340  MOVE      QRYDATA,SYSGL034
          GOTO      SGLED999
.
SGLED350  MOVE      QRYDATA,SYSGL035
          GOTO      SGLED999
.
SGLED360  MOVE      QRYDATA,SYSGL036
          GOTO      SGLED999
.
SGLED370  MOVE      QRYDATA,SYSGL037
          GOTO      SGLED999
.
SGLED380  MOVE      QRYDATA,SYSGL038
          GOTO      SGLED999
.
SGLED390  MOVE      QRYDATA,SYSGL039
          GOTO      SGLED999
.
SGLED400  MOVE      QRYDATA,SYSGL040
          GOTO      SGLED999
.
SGLED999  RETURN
+
.------------------------------------------------------------------------------
. Invoice Range Maintenance
.------------------------------------------------------------------------------
.
PTIRNG00  RESET     UPDTTYPE
          MATCH     SP1,UPDTTYPE            * Display formaction
          GOTO      PTIRNG40 IF EQUAL
.
          MATCH     "A",UPDTTYPE            * Add formaction
          GOTO      PTIRNG10 IF EQUAL
.
          MATCH     "U",UPDTTYPE            * Upate formaction
          GOTO      PTIRNG20 IF EQUAL
.
          MATCH     "D",UPDTTYPE            * Delete formaction
          GOTO      PTIRNG30 IF EQUAL
.
          GOTO      PTIRNG93
.
.
.         ************ ADD FORMACTION ***********
.
PTIRNG10  SQUEEZE   PTIRN001
          PACK      PTIRN001,PTIRN001,SP10
          CALL      CHKPTI00                * No, validate input fields
          BRANCH    EXIT,PTIRNG99           * Exit if error found
.
          PACK      KEY3,PTIRN001,SP10
          CALL      RDIRNG1
          COMPARE   ZERO,OVRCD              * Does record already exist?
          GOTO      PTIRNG92 IF EQUAL       * Yes, display error message 
          CALL      PTISAV00                * No, save input variables
          CALL      WRIRNG1                 * Write new record
.
          MOVE      ZERO,EXIT
          GOTO      PTIRNG99
.
.         ************ UPDATE FORMACTION **********
.
PTIRNG20  PACK      PTIRN001,PTIRN001,SP10
          CALL      CHKPTI00                * Validate input fields
          BRANCH    EXIT,PTIRNG99           * Exit if error found
.
          PACK      KEY3,PTIRN001,SP10
          CALL      RDIRNG1                 * Does record exist?
          BRANCH    OVRCD,PTIRNG91          * No, Display error message
          CALL      PTISAV00                * Yes,save input variables
          CALL      UPIRNG1                 * Update record 
.
          MOVE      ZERO,EXIT
          GOTO      PTIRNG99
.
.         ************ DELETE FORMACTION **********
.
PTIRNG30  PACK      PTIRN001,PTIRN001,SP10
          PACK      KEY3,PTIRN001,SP10
          CALL      RDIRNG1                 * Does record exist?
          BRANCH    OVRCD,PTIRNG91          * No, Display error message
          CALL      DEIRNG1                 * Yes, Delete record
.
          MOVE      ZERO,EXIT
          GOTO      PTIRNG99
.
.         ************ DISPLAY FORMACTION **********
.
PTIRNG40  PACK      PTIRN001,PTIRN001,SP10
          PACK      KEY3,PTIRN001,SP10 
          CALL      RDIRNG1
          IF        OVRCD=1
            CALL      CLRPTI00              * Clear all the file variables
          ENDIF
.
          CLEAR     WEBTITLE
          MOVE      "Patient Invoice Range Maintenance",WEBTITLE
          RESET     WEBTITLE
.
          CALL      WEBHED00                * Output File & Write HTML Pg Header
          BRANCH    EXIT,PTIRNG99
.
          CALL      WEBBOD00                * Process Web Body
.
          CALL      WEBEND00                * Process End of HTML File
.
          MOVE      ONE,EXIT
          GOTO      PTIRNG99
.
.         ************ DISPLAY ERROR MESSAGE **********
.
PTIRNG91  MOVE      "Invoice Range Code record does not exist",WEBTITLE
          CALL      WEBERR00
          MOVE      ONE,EXIT
          GOTO      PTIRNG99
.
PTIRNG92  MOVE      "Invoice Range Code record exists",WEBTITLE
          CALL      WEBERR00
          MOVE      ONE,EXIT
          GOTO      PTIRNG99
.
PTIRNG93  MOVE      "Invalid Form Action.",WEBTITLE
          CALL      WEBERR00
          MOVE      ONE,EXIT
          GOTO      PTIRNG99
.
PTIRNG99  RETURN
+
.------------------------------------------------------------------------------
. Initialize's file data (Invoice Range Maintenance)
.------------------------------------------------------------------------------
.
CLRPTI00  MOVE      SP70,IRANGE             * Invoice range code
          MOVE      SP70,IRDESC             * Invoice range description
          MOVE      ZERO,IRNEXT             * Next invoice number in range
          MOVE      ZERO,IRMAXI             * Maximum invoice number in range
          MOVE      SP70,IRSPAR             * Spare variable
.
CLRPTI99  RETURN
+
.------------------------------------------------------------------------------
. Moves cgi variables into file variables (Invoice Range Maintenance)
.------------------------------------------------------------------------------
.
PTISAV00  MOVE      PTIRN001,IRANGE
          MOVE      PTIRN002,IRDESC
          MOVE      PTIRN003,IRNEXT
          MOVE      PTIRN004,IRMAXI
          MOVE      SP70,IRSPAR
.
PTISAV99  RETURN
+
.------------------------------------------------------------------------------
. Checks mandatory fields and perform validations 
. (Patient Invoice Range Maintenance)
.------------------------------------------------------------------------------
.
. Checks for mandatory range code
.
CHKPTI00  RESET     PTIRN001                * Invoice range code 
          MATCH     SP3,PTIRN001
          GOTO      CHKPTI90 IF EQUAL
.
. Checks for valid Max and Next invoice numbers
.
CHKPTI20  IF        PTIRN004 <= PTIRN003
            GOTO      CHKPTI91 
          ENDIF
.
. Checks for overlaping with an existing invoice range 
.
CHKPTI30  MOVE      SP3,KEY3
          CALL      RDSIRNG1
CHKPTI31  CALL      RDKIRNG1
          BRANCH    OVRCD,CHKPTI98
.
          MATCH     IRANGE,PTIRN001         
          GOTO      CHKPTI31 IF EQUAL
.
          COMPARE   IRNEXT,PTIRN004         
          GOTO      CHKPTI31 IF LESS       
.
          COMPARE   PTIRN003,IRMAXI        
          GOTO      CHKPTI31 IF LESS
.
          GOTO      CHKPTI92
.
CHKPTI90  MOVE      "Invoice Range Code is mandatory",WEBTITLE
          CALL      WEBERR00
          MOVE      ONE,EXIT
          GOTO      CHKPTI99
.
CHKPTI91  MOVE      "Max Invoice Number Must Be greater than ",WEBTITLE
          ENDSET    WEBTITLE
          APPEND    "Next Invoice Number",WEBTITLE
          RESET     WEBTITLE          
          CALL      WEBERR00
          MOVE      ONE,EXIT
          GOTO      CHKPTI99
.
CHKPTI92  MOVE      "This Range Overlaps With Range ",WEBTITLE
          ENDSET    WEBTITLE
          APPEND    IRANGE,WEBTITLE
          RESET     WEBTITLE
          CALL      WEBERR00
          MOVE      ONE,EXIT
          GOTO      CHKPTI99
.
CHKPTI98  MOVE      ZERO,EXIT
.
CHKPTI99  RETURN
+
.------------------------------------------------------------------------------
. MBS Explosion Charge Maintenance
.------------------------------------------------------------------------------
.
MBSEXP00  RESET     UPDTTYPE
          MATCH     SP1,UPDTTYPE            * Display formaction
          GOTO      MBSEXP50 IF EQUAL
.
          MATCH     "A",UPDTTYPE            * Add formaction
          GOTO      MBSEXP10 IF EQUAL
.
          MATCH     "U",UPDTTYPE            * Update formaction
          GOTO      MBSEXP20 IF EQUAL
.
          MATCH     "D",UPDTTYPE            * Delete formaction
          GOTO      MBSEXP30 IF EQUAL
.
          MATCH     "E",UPDTTYPE            * Schedule Global Delete formaction
          GOTO      MBSEXP40 IF EQUAL
.
          GOTO      MBSEXP93
.
.
.         ************ ADD FORMACTION ***********
.
MBSEXP10  PACK      PTEC0001,PTEC0001,SP10
          PACK      PTEC0002,PTEC0002,SP10
          PACK      PTEC0010,PTEC0010,SP10
          PACK      PTEC0011,PTEC0011,SP10
          PACK      PTEC0003,PTEC0003,SP10
          PACK      PTEC0005,PTEC0005,SP10
.
          CALL      CLRMBS00                * clear patechaf fields
.
          PACK      KEY17,PTEC0003,SP70
          CALL      PATITMRD                * is MBS Item valid?
          BRANCH    OVRCD,MBSEXP91
.
          MATCH     ICLSS,PTEC0002          * Suggested class same as admin type
          GOTO      MBSEXP11 IF EQUAL       
.
          MATCH     SP70,PTEC0002           * is Admission Type blank?
          GOTO      MBSEXP11 IF EQUAL
.
          PACK      KEY5,ANSA,SP1,PTEC0002
          CALL      RDCODE1
          BRANCH    OVRCD,MBSEXP94
.
          MATCH     ANSX,TCINDC7            * Admission type excluded?
          GOTO      MBSEXP94 IF NOT EQUAL

MBSEXP11  ADD       ONE,PTEC0004 
          PACK      KEY30,PTEC0001,PTEC0002,PTEC0010,PTEC0011,PTEC0003:
                    PTEC0004,SP70
          CALL      RDPTECH1                
          BRANCH    OVRCD,MBSEXP15
.
          MATCH     PTEC0005,PTECEMCH       * Different exploding misc charge?
          GOTO      MBSEXP92 IF EQUAL
.         
          GOTO      MBSEXP11                 
.
MBSEXP15  CALL      MBSSAV00                
          PACK      KEY30,PTEC0001,PTEC0002,PTEC0010,PTEC0011,PTEC0003:
                    PTEC0004,SP70
          CALL      WRPTECH1                * Write new record
.
          GOTO      MBSEXP98
.
.         ************ UPDATE FORMACTION **********
.
MBSEXP20  PACK      PTEC0001,PTEC0001,SP10
          PACK      PTEC0002,PTEC0002,SP10
          PACK      PTEC0010,PTEC0010,SP10
          PACK      PTEC0011,PTEC0011,SP10
          PACK      PTEC0003,PTEC0003,SP10
          PACK      KEY30,PTEC0001,PTEC0002,PTEC0010,PTEC0011,PTEC0003:
                    PTEC0004,SP70
          CALL      RDPTECH1                * Does record already exist? 
          BRANCH    OVRCD,MBSEXP91          * No, display error message 
.
          CALL      MBSSAV00                * Save input variables
          CALL      UPPTECH1                * Update record
.
          GOTO      MBSEXP98
.
.         ************ DELETE FORMACTION **********
.
MBSEXP30  PACK      PTEC0001,PTEC0001,SP10
          PACK      PTEC0002,PTEC0002,SP10
          PACK      PTEC0010,PTEC0010,SP10
          PACK      PTEC0011,PTEC0011,SP10
          PACK      PTEC0003,PTEC0003,SP10
          PACK      KEY30,PTEC0001,PTEC0002,PTEC0010,PTEC0011,PTEC0003:
                    PTEC0004,SP70 
          CALL      RDPTECH1                * Does record exist?
          BRANCH    OVRCD,MBSEXP91          * No, Display error message
          CALL      DEPTECH1                * Yes, Delete record
          GOTO      MBSEXP98
.
.          CALL      RSPTECH1
.MBSEXP35  CALL      RKPTECH1
.          BRANCH    OVRCD,MBSEXP98
..
.          MATCH     PTEC0001,PTECCTYP
.          GOTO      MBSEXP98 IF NOT EQUAL
..
.          MATCH     PTEC0002,PTECATYP
.          GOTO      MBSEXP98 IF NOT EQUAL
..
.          MATCH     PTEC0010,PTECHFND
.          GOTO      MBSEXP98 IF NOT EQUAL
..
.          MATCH     PTEC0011,PTECHGRP
.          GOTO      MBSEXP98 IF NOT EQUAL
..
.          MATCH     PTEC0003,PTECMBSC
.          GOTO      MBSEXP98 IF NOT EQUAL
..
.          SUBTRACT  ONE,PTECUNIQ
.          CALL      UPPTECH1
.          GOTO      MBSEXP35
.
.         ************ SCHEDULE GLOBAL DELETION FORMACTION ************
.
MBSEXP40  PACK      PTEC0001,PTEC0001,SP10
          PACK      PTEC0002,PTEC0002,SP10
          PACK      PTEC0003,PTEC0003,SP10 
.
          PACK      KEY17,PTEC0003,SP70
          CALL      PATITMRD
          BRANCH    OVRCD,MBSEXP91
.
          MATCH     ICLSS,PTEC0002          * Suggested class same as admin type
          GOTO      MBSEXP45 IF EQUAL
.
          PACK      KEY5,ANSA,SP1,PTEC0002
          CALL      RDCODE1
          BRANCH    OVRCD,MBSEXP94
.
          MATCH     ANSX,TCINDC7            * Admission type excluded?
          GOTO      MBSEXP94 IF NOT EQUAL

MBSEXP45  PACK      KEY18,PTEC0001,PTEC0002,PTEC0003,SP70
          CALL      RSPTECH1
          CALL      RKPTECH1
          BRANCH    OVRCD,MBSEXP91
.
          MATCH     PTEC0001,PTECCTYP
          GOTO      MBSEXP91 IF NOT EQUAL
.
          MATCH     PTEC0002,PTECATYP
          GOTO      MBSEXP91 IF NOT EQUAL
.
          MATCH     PTEC0003,PTECMBSC
          GOTO      MBSEXP91 IF NOT EQUAL
.
          CALL      SGLD0000 
          GOTO      MBSEXP98
.
.         ************ DISPLAY FORMACTION **********
.
MBSEXP50  PACK      PTEC0001,PTEC0001,SP10
          PACK      PTEC0002,PTEC0002,SP10
          PACK      PTEC0010,PTEC0010,SP10
          PACK      PTEC0011,PTEC0011,SP10
          PACK      PTEC0003,PTEC0003,SP10
          PACK      KEY30,PTEC0001,PTEC0002,PTEC0010,PTEC0011,PTEC0003:
                    PTEC0004,SP70
          CALL      RDPTECH1
          IF        OVRCD=1
            CALL      CLRMBS00              * Clear all the file variables
          ENDIF
.
          CLEAR     WEBTITLE
          MOVE      "MBS Explosion Charge Maintenance",WEBTITLE
          RESET     WEBTITLE
.
          CALL      WEBHED00                * Output File & Write HTML Pg Header
          BRANCH    EXIT,MBSEXP99
.
          CALL      WEBBOD00                * Process Web Body
.
          CALL      WEBEND00                * Process End of HTML File
.
          MOVE      ONE,EXIT
          GOTO      MBSEXP99
.
.         ************ DISPLAY ERROR MESSAGE **********
.
MBSEXP91  MOVE      "Record does not exist",WEBTITLE
          CALL      WEBERR00
          MOVE      ONE,EXIT
          GOTO      MBSEXP99
.
MBSEXP92  MOVE      "Record already exists",WEBTITLE
          CALL      WEBERR00
          MOVE      ONE,EXIT
          GOTO      MBSEXP99
.
MBSEXP93  MOVE      "Invalid Form Action.",WEBTITLE
          CALL      WEBERR00
          MOVE      ONE,EXIT
          GOTO      MBSEXP99
.
MBSEXP94  MOVE      "Suggested Classification Different To ",WEBTITLE
          ENDSET    WEBTITLE
          APPEND    "Admission Type.",WEBTITLE
          RESET     WEBTITLE
          CALL      WEBERR00
          MOVE      ONE,EXIT
          GOTO      MBSEXP99
.
MBSEXP98  MOVE      ZERO,EXIT
MBSEXP99  RETURN
+
.--------------------------------------------------------------------------
.*                             SGLD0000                                   *
.*   Schedule global deletion of MBS Exploding charges from IBARSH10      *
.--------------------------------------------------------------------------
.
SGLD0000  MOVE      "IBARSH10",SCHDPGID
          MOVE      "MBS Exploding Charges Global Deletion",SCHDDESC
          MOVE      CURRDATE,SCHDDATE
          CLOCK     TIME,SCHDTIME
.
.         Write Keyin parameters for Extract
.
          MOVE      SIX,KEYSTARR[1]         * Option 
.
          MOVE      PTEC0001,KEYSTARR[2]    * Claim Type
.
          MOVE      PTEC0002,KEYSTARR[3]    * Admission Type
.
          MOVE      PTEC0003,KEYSTARR[4]    * MBS Code
.
          MOVE      ANSY,KEYSTARR[5]        * Yes perform deletion
          MOVE      FIVE,KEYSTCNT           * Number of Keyins
.
          CALL      SCHPRO00                * Schedule Extract
.
SGLD9999  RETURN
+
.------------------------------------------------------------------------------
. Initialize's file data (MBS Explosion Charge Maintenance)
.------------------------------------------------------------------------------
.
CLRMBS00  MOVE      SP70,PTECCTYP           * Claim type (cat CL)          
          MOVE      SP70,PTECATYP           * Admission type (cat A)
          MOVE      SP70,PTECMBSC           * MBS Code
          MOVE      ZERO,PTECUNIQ           * Unique counter
          MOVE      SP70,PTECEMCH           * Exploding miscellaneous charge
          MOVE      SP70,PTECOPPC           * Operating personnel code (cat OP)
          MOVE      ZERO,PTEC1MCF           * 1st % of miscellaneous charge fee
          MOVE      ZERO,PTEC2MCF           * 2nd % of miscellaneous charge fee
          MOVE      ZERO,PTEC3MCF           * 3rd % of miscellaneous charge fee
          MOVE      SP70,PTECHFND           * Health Fund
          MOVE      SP70,PTECHGRP           * Health Fund Group
          MOVE      SP70,PTECQNTY           * Quantity 
          MOVE      SP70,PTECSPAR           * Spare variable
.        
CLRMBS99  RETURN
+
.------------------------------------------------------------------------------
. Moves cgi variables into file variables (MBS Explosion Charge Maintenance)
.------------------------------------------------------------------------------
.
MBSSAV00  MOVE      PTEC0001,PTECCTYP       * Claim type (cat CL)          
          MOVE      PTEC0002,PTECATYP       * Admission type (cat A)
          MOVE      PTEC0003,PTECMBSC       * MBS Code
          MOVE      PTEC0004,PTECUNIQ       * Unique counter
          MOVE      PTEC0005,PTECEMCH       * Exploding miscellaneous charge
          MOVE      PTEC0006,PTECOPPC       * Operating personnel code (cat OP)
          MOVE      PTEC0007,PTEC1MCF       * 1st % of miscellaneous charge fee
          MOVE      PTEC0008,PTEC2MCF       * 2nd % of miscellaneous charge fee
          MOVE      PTEC0009,PTEC3MCF       * 3rd % of miscellaneous charge fee
          MOVE      PTEC0010,PTECHFND       * Health Fund (Active)
          MOVE      PTEC0011,PTECHGRP       * Health Fund Group (Active)
          MOVE      PTEC0012,PTECQNTY       * Quantity
          MOVE      SP70,PTECSPAR           * Spare variable
.
MBSSAV99  RETURN
+
.------------------------------------------------------------------------------
. Suggested Classification Execeptions Maintenance
.------------------------------------------------------------------------------
.
PATSGC00  RESET     UPDTTYPE
          MATCH     SP1,UPDTTYPE            * Display formaction
          GOTO      PATSGC50 IF EQUAL
.
          MATCH     "A",UPDTTYPE            * Add formaction
          GOTO      PATSGC10 IF EQUAL
.
          MATCH     "U",UPDTTYPE            * Update formaction
          GOTO      PATSGC20 IF EQUAL
.
          MATCH     "D",UPDTTYPE            * Delete formaction
          GOTO      PATSGC30 IF EQUAL
.
          MATCH     "F",UPDTTYPE            * Copy Health fund details
          GOTO      PATSGC40 IF EQUAL
.
          GOTO      PATSGC93
. 
.         ************ ADD FORMACTION ***********
.
PATSGC10  PACK      PTSGC001,PTSGC001,SP70
          PACK      PTSGC002,PTSGC002,SP70
          PACK      PTSGC004,PTSGC004,SP70
          PACK      KEY18,PTSGC004,PTSGC001,PTSGC002
          CALL      RDPTSGC1                * Record already exist?
          BRANCH    OVRCD,PATSGC15          * No, insert new record
          GOTO      PATSGC92                * Yes, display error
.
PATSGC15  CALL      SGCSAV00                * Save the variables
          PACK      KEY18,PTSGC004,PTSGC001,PTSGC002
          CALL      WRPTSGC1                * write the new record
          GOTO      PATSGC98 
.
.         ************ UPDATE FORMACTION ***********
.
PATSGC20  PACK      PTSGC001,PTSGC001,SP70
          PACK      PTSGC002,PTSGC002,SP70
          PACK      PTSGC004,PTSGC004,SP70
          PACK      KEY18,PTSGC004,PTSGC001,PTSGC002
          CALL      RDPTSGC1                * Record exists?
          BRANCH    OVRCD,PATSGC91          * No, display error
.
          CALL      SGCSAV00                * Save the variables
          CALL      UPPTSGC1                * Update the record
          GOTO      PATSGC98
.
.         ************ DELETE FORMACTION ***********
.
PATSGC30  PACK      PTSGC001,PTSGC001,SP70
          PACK      PTSGC002,PTSGC002,SP70
          PACK      PTSGC004,PTSGC004,SP70
          PACK      KEY18,PTSGC004,PTSGC001,PTSGC002
          CALL      RDPTSGC1                * Record exists?
          BRANCH    OVRCD,PATSGC91          * No, display error
          CALL      DEPTSGC1                * Yes, delete the record
          GOTO      PATSGC98
.
.         ********* SCHEDULE COPY FORMACTION *********
.
. Copy From Health Fund and MBS item
.
PATSGC40  CALL      SCPY0000                * Schedule copy health fund details
          GOTO      PATSGC98                
.
.         *************** Display Formaction ****************
.
PATSGC50  PACK      PTSGC001,PTSGC001,SP70
          PACK      PTSGC002,PTSGC002,SP70
          PACK      PTSGC004,PTSGC004,SP70
          PACK      KEY18,PTSGC004,PTSGC001,PTSGC002
          CALL      RDPTSGC1
          IF        OVRCD=1
            CALL      CLRSGC00              * Clear all the file variables
          ENDIF
.
          CLEAR     WEBTITLE
          MOVE      "Suggested Classification Maintenance",WEBTITLE
          RESET     WEBTITLE
.
          CALL      WEBHED00                * Output File & Write HTML Pg Header
          BRANCH    EXIT,PATSGC99
.
          CALL      WEBBOD00                * Process Web Body
.
          CALL      WEBEND00                * Process End of HTML File
.
          MOVE      ONE,EXIT
          GOTO      PATSGC99
.
.         ********* DISPLAY ERROR MESSAGES *********
.
PATSGC91  MOVE      "Record does not exist",WEBTITLE
          CALL      WEBERR00
          MOVE      ONE,EXIT
          GOTO      PATSGC99
.
PATSGC92  MOVE      "Record already exists",WEBTITLE
          CALL      WEBERR00
          MOVE      ONE,EXIT
          GOTO      PATSGC99
.
PATSGC93  MOVE      "Invalid formaction",WEBTITLE
          CALL      WEBERR00
          MOVE      ONE,EXIT
          GOTO      PATSGC99
.
PATSGC94  MOVE      "Health Fund is inactive",WEBTITLE
          CALL      WEBERR00
          MOVE      ONE,EXIT
          GOTO      PATSGC99
.
PATSGC98  MOVE      ZERO,EXIT
PATSGC99  RETURN
+ 
.--------------------------------------------------------------------------
.*                             SCPY0000                                   *
.*   Schedule global copying of Health Fund Details from IBARSH10         *
.--------------------------------------------------------------------------
.
SCPY0000  MOVE      "IBARSH10",SCHDPGID
          MOVE      "Copy Health Fund Details",SCHDDESC
          MOVE      CURRDATE,SCHDDATE
          CLOCK     TIME,SCHDTIME
.
          PACK      PTSGC001,PTSGC001,SP70
          PACK      PTSGC002,PTSGC002,SP70
          PACK      PTSGC003,PTSGC003,SP70
          PACK      CPSGC001,CPSGC001,SP70
          PACK      CPSGC002,CPSGC002,SP70
          PACK      CPSGC003,CPSGC003,SP70
.
.         Write Keyin parameters for Extract
.
          MOVE      ONE,INDEXCNT
          MOVE      SEVEN,KEYSTARR[INDEXCNT]       * Option
.         
          ADD       ONE,INDEXCNT
          BRANCH    PTSGC005,SCPY1000       * All Claim code
.
          MOVE      PTSGC003,KEYSTARR[INDEXCNT]    * Copy From Claim code
          GOTO      SCPY2000
.
SCPY1000  MOVE      "All",KEYSTARR[INDEXCNT]
.
SCPY2000  ADD       ONE,INDEXCNT
          BRANCH    PTSGC006,SCPY3000       * All health fund
.
          MOVE      PTSGC001,KEYSTARR[INDEXCNT]    * Copy From Health Fund
          GOTO      SCPY4000
.
SCPY3000  MOVE      "All",KEYSTARR[INDEXCNT]       * All Health Fund
.
SCPY4000  ADD       ONE,INDEXCNT
          BRANCH    PTSGC007,SCPY5000       * All MBS
.
          MOVE      PTSGC002,KEYSTARR[INDEXCNT]    * Copy From MBS Item
          GOTO      SCPY6000
.
SCPY5000  MOVE      "All",KEYSTARR[INDEXCNT]
.
SCPY6000  BRANCH    PTSGC005,SCPY7000              * All Claim code
          ADD       ONE,INDEXCNT
          MOVE      CPSGC003,KEYSTARR[INDEXCNT]    * Copy To Claim code
.
SCPY7000  BRANCH    PTSGC006,SCPY8000              * All Health fund
          ADD       ONE,INDEXCNT
          MOVE      CPSGC001,KEYSTARR[INDEXCNT]    * Copy To Health Fund
.
SCPY8000  BRANCH    PTSGC007,SCPY9000              * All MBS
          ADD       ONE,INDEXCNT
          MOVE      CPSGC002,KEYSTARR[INDEXCNT]    * Copy To MBS Item
.
SCPY9000  ADD       ONE,INDEXCNT
          MOVE      ANSY,KEYSTARR[INDEXCNT]        * Yes perform copy
          MOVE      INDEXCNT,KEYSTCNT              * number of keystrokes
.
          CALL      SCHPRO00                * Schedule Extract
.
SCPY9999  RETURN
+
.------------------------------------------------------------------------------
. Suggested Classification Execeptions Maintenance - Clear variables
.------------------------------------------------------------------------------
.
CLRSGC00  MOVE      SP70,PTSGFUND           * Health Fund Code
          MOVE      SP70,PTSGMBS            * MBS Item Code
          MOVE      SP70,PTSGCLSS           * Suggested  Classification (Ca A)
          MOVE      SP70,PTSGCLMN           * Claim Code
          MOVE      SP70,PTSGSPAR           * Spare variable
.
CLRSGC99  RETURN
+
.------------------------------------------------------------------------------
. Suggested Classification Execeptions Maintenance - Save variables
.------------------------------------------------------------------------------
.
SGCSAV00  MOVE      PTSGC001,PTSGFUND       * Health Fund Code
          MOVE      PTSGC002,PTSGMBS        * MBS Item Code
          MOVE      PTSGC003,PTSGCLSS       * Suggested  Classification (Ca A)
          MOVE      PTSGC004,PTSGCLMN       * Claim code
          MOVE      SP70,PTSGSPAR           * Spare variable
.
SGCSAV99  RETURN
+
.------------------------------------------------------------------------------
. Invoice Financial Summary - At end of year reset
.------------------------------------------------------------------------------
.
PATFIN00  RESET     UPDTTYPE
          MATCH     SP1,UPDTTYPE            * Display formaction
          GOTO      PATFIN40 IF EQUAL
. 
          MATCH     "A",UPDTTYPE            * Add/Update formaction
          GOTO      PATFIN10 IF EQUAL
.
          GOTO      PATFIN92
.
.         ********* ADD/UPDATE FORMACTION *********
.
PATFIN10  MOVE      CURRDATE,CPTDATE
          CALL      GPERD
          BRANCH    EXIT,PATFIN91
.
          MOVE      DRGYR,FINYEAR
.
          CALL      FINSAV00
          BRANCH    EXIT,PATFIN99
.
          MOVE      SP10,FINSITE            * Site
          COMPARE   TWO,FINSYS              * Outpatient site?             
          GOTO      PATFIN30 IF NOT EQUAL   * No
.
          PACK      KEY6,SP10
          CALL      RDSSITA1
PATFIN20  CALL      RDKSITA1
          BRANCH    OVRCD,PATFIN99
.
          PACK      FINSY004,FINSY004,SP70
.
          MATCH     FINSY004,OSTSYST
          GOTO      PATFIN20 IF NOT EQUAL
.
          MOVE      OSTSITE,FINSITE         * The selected site
.
PATFIN30  IF        IBCNMHOS=1
            MOVE      WBSEHOSP,FINHOSP      * hospital id
          ELSE
            MOVE      SP70,FINHOSP
          ENDIF
.
          UNPACK    SP70,FININVN,FINADMN,FINURNO
          MOVE      "EOY",FININVN           * End of year reset
          MOVE      ONE,FOFFSET
          MOVE      FINSY003,FINAMT
          PACK      FINDATE,CCC,CYY,CMM,CDD
          REP       " 0",FINDATE        * Zero fill the current date
.
          MOVE      ZERO,FGSTFLAG
          CALL      WFDE0000                * write to Financial detail file
.
          PACK      KEY28,FINSYS,FINSITE,FINYEAR,FINTYPE,FINCODE,FINHOSP
          MOVE      "FIN",PRXCODE           * System lock
          CALL      GETSLK00                * Get system lock
          CALL      RDFINS1                 * Does record already exist?
          BRANCH    OVRCD,PATFIN35          * No, write a new record
          MOVE      FINSY003,FINMTH1        * Yes,populate value brought forward
          CALL      UPFINS1                 * Update record
          CALL      RELSLK00                * Release System Lock
.
          GOTO      PATFIN98                
.
PATFIN35  CALL      WRFINS1                 * Write a new record
          CALL      RELSLK00                * Release System Lock
.
          GOTO      PATFIN98 
.
.         ********* DISPLAY FORMACTION *********
.
PATFIN40  CALL      CLRFIN00
.  
          CLEAR     WEBTITLE
          MOVE      "Invoice Financial - End of Year Reset",WEBTITLE
          RESET     WEBTITLE
.
          CALL      WEBHED00                * Output File & Write HTML Pg Header
          BRANCH    EXIT,PATFIN99
.
          CALL      WEBBOD00                * Process Web Body
.
          CALL      WEBEND00                * Process End of HTML File
.
          MOVE      ONE,EXIT
          GOTO      PATFIN99
.
.         ********* DISPLAY ERROR MESSAGES *********
.
PATFIN91  MOVE      "Cannot find current year in Period File",WEBTITLE
          CALL      WEBERR00
          MOVE      ONE,EXIT
          GOTO      PATFIN99
.
PATFIN92  MOVE      "Invalid formaction",WEBTITLE
          CALL      WEBERR00
          MOVE      ONE,EXIT
          GOTO      PATFIN99
.
PATFIN98  MOVE      ZERO,EXIT
PATFIN99  RETURN 
+
.------------------------------------------------------------------------------
. Invoice Financial Summary - Save variables
.------------------------------------------------------------------------------
.
FINSAV00  MOVE      FINSY001,FINSYS         * System indicator
.
          MOVE      ANSA,FINTYPE            * A = Fees Generated
.
          PACK      FINSY002,FINSY002,SP70
          IF        IBCNMHOS=1
            MOVE      SP10,KEY3
            CALL      RSPTHSP1
            CALL      RKPTHSP1
            BRANCH    OVRCD,FINSAV91
            PACK      KEY29,PTHSDCLM,SP6,SP3,FINSY002,CURRDATE,SP10
          ELSE
            PACK      KEY29,PTCNDCLM,SP6,SP3,FINSY002,CURRDATE,SP10
          ENDIF
.
FINSAV05  CALL      PATMCHRD                * read Misc.Charges file
          BRANCH    EXIT,FINSAV15
          GOTO      FINSAV20
.
FINSAV15  IF        IBCNMHOS=1
            CALL      RKPTHSP1
            BRANCH    OVRCD,FINSAV91
            PACK      KEY29,PTHSDCLM,SP6,SP3,FINSY002,CURRDATE
            GOTO      FINSAV05
          ENDIF
.
          GOTO      FINSAV91
.
FINSAV20  PACK      FINCODE,ANSM,MMSCGRP,MCHARGE,SP20
.
          MOVE      FINSY003,FINMTH1        * Amount for month 1
          MOVE      ZERO,FINPER             * Period amount
          MOVE      ZERO,FINMTH2            * Amount for month 2
          MOVE      ZERO,FINMTH3            * Amount for month 3
          MOVE      ZERO,FINMTH4            * Amount for month 4
          MOVE      ZERO,FINMTH5            * Amount for month 5
          MOVE      ZERO,FINMTH6            * Amount for month 6
          MOVE      ZERO,FINMTH7            * Amount for month 7
          MOVE      ZERO,FINMTH8            * Amount for month 8
          MOVE      ZERO,FINMTH9            * Amount for month 9
          MOVE      ZERO,FINMTH10           * Amount for month 10
          MOVE      ZERO,FINMTH11           * Amount for month 11
          MOVE      ZERO,FINMTH12           * Amount for month 12
          MOVE      ZERO,FINMTH13           * Amount for month 13
          MOVE      ZERO,FLSTYR             * Last year amount
          MOVE      SP30,FSPARE             * Spare variable
.
          GOTO      FINSAV99
.
FINSAV91  MOVE      "Misc charge code is not on file or not active.",WEBTITLE
          CALL      WEBERR00
          MOVE      ONE,EXIT
          GOTO      FINSAV99
.
FINSAV99  RETURN
+
.------------------------------------------------------------------------------
. Clear all variables for invoice fincancial summary - At end of year reset
.------------------------------------------------------------------------------
.
CLRFIN00  MOVE      ZERO,FINSYS             * System indicator
          MOVE      SP70,FINSITE            * Outpatient site
          MOVE      SP70,FINYEAR            * Financial year
          MOVE      SP70,FINTYPE            * Financial type
          MOVE      SP70,FINCODE            * Financial code
          MOVE      ZERO,FINPER             * Period amount
          MOVE      ZERO,FINMTH1            * Amount for month 1
          MOVE      ZERO,FINMTH2            * Amount for month 2
          MOVE      ZERO,FINMTH3            * Amount for month 3
          MOVE      ZERO,FINMTH4            * Amount for month 4
          MOVE      ZERO,FINMTH5            * Amount for month 5
          MOVE      ZERO,FINMTH6            * Amount for month 6
          MOVE      ZERO,FINMTH7            * Amount for month 7
          MOVE      ZERO,FINMTH8            * Amount for month 8
          MOVE      ZERO,FINMTH9            * Amount for month 9
          MOVE      ZERO,FINMTH10           * Amount for month 10
          MOVE      ZERO,FINMTH11           * Amount for month 11
          MOVE      ZERO,FINMTH12           * Amount for month 12
          MOVE      ZERO,FINMTH13           * Amount for month 13
          MOVE      ZERO,FLSTYR             * Last year amount 
          MOVE      SP70,FINHOSP            * Hospital ID
          MOVE      SP30,FSPARE             * Spare variable
.
CLRFIN99  RETURN
+
.------------------------------------------------------------------------------
. General Ledger Interface Maintenance              
.------------------------------------------------------------------------------
.
GLINTR00  COMPARE   ONE,CGLIND
          GOTO      GLINTR94 IF NOT EQUAL
.
          PACK      GLINT015,GLINT015,SP70
          RESET     UPDTTYPE
          MATCH     SP1,UPDTTYPE            * Display formaction
          GOTO      GLINTR80 IF EQUAL
. 
          MATCH     "A",UPDTTYPE            * Add formaction
          GOTO      GLINTR10 IF EQUAL
.
          MATCH     "U",UPDTTYPE            * Update formaction
          GOTO      GLINTR20 IF EQUAL
.
          MATCH     "D",UPDTTYPE            * Delete formaction
          GOTO      GLINTR30 IF EQUAL
.
          GOTO      GLINTR91
.
.         ********* ADD FORMACTION *********
.
GLINTR10  CALL      GLKEY000                * Determine GL Key
          PACK      KEY17,GLINT015,GLINT001,GLINT002,SP70
          CALL      RDPTFM1
          COMPARE   OVRCD,ZERO     
          GOTO      GLINTR93 IF EQUAL
.
          CALL      CLRGLI00                 * clear variables
          CALL      SAVGLI00
          CALL      WRPTFM1
          GOTO      GLINTR98
.
.         ********* UPDATE FORMACTION *********
.
GLINTR20  PACK      KEY17,GLINT015,GLINT001,GLINT002,SP70
          CALL      RDPTFM1
          BRANCH    OVRCD,GLINTR92
.
          CALL      SAVGLI00
          CALL      UPPTFM1
          GOTO      GLINTR98
.
.         ********* DELETE FORMACTION *********
.
GLINTR30  PACK      KEY17,GLINT015,GLINT001,GLINT002,SP70
          CALL      RDPTFM1
          BRANCH    OVRCD,GLINTR92
.         
          CALL      DEPTFM1
          GOTO      GLINTR98
.
.
.         ********* DISPLAY FORMACTION *********
.
GLINTR80  MATCH     "1",NEWRECRD               * add new record
          GOTO      GLINTR81 IF EQUAL
.
          PACK      KEY17,GLINT015,GLINT001,GLINT002,SP70
          CALL      RDPTFM1
          BRANCH    OVRCD,GLINTR81
          GOTO      GLINTR82
.
GLINTR81  CALL      CLRGLI00                 * clear variables
          MOVE      "1",NEWRECRD
.  
GLINTR82  CLEAR     WEBTITLE
          MOVE      "General Ledger Interface Maintenance",WEBTITLE
          RESET     WEBTITLE
.
          CALL      WEBHED00                * Output File & Write HTML Pg Header
          BRANCH    EXIT,GLINTR99
          CALL      WEBBOD00                * Process Web Body
          CALL      WEBEND00                * Process End of HTML File
.
          MOVE      ONE,EXIT
          GOTO      GLINTR99
.
.         ********* DISPLAY ERROR MESSAGES *********
.
GLINTR91  MOVE      "Invalid formaction",WEBTITLE
          CALL      WEBERR00
          MOVE      ONE,EXIT
          GOTO      GLINTR99
.
GLINTR92  MOVE      "Record does not exist",WEBTITLE
          CALL      WEBERR00
          MOVE      ONE,EXIT
          GOTO      GLINTR99
.
GLINTR93  MOVE      "Record already exists",WEBTITLE
          CALL      WEBERR00
          MOVE      ONE,EXIT
          GOTO      GLINTR99
.
GLINTR94  MOVE      "General Ledger Interface is Turned Off.",WEBTITLE
          CALL      WEBERR00
          MOVE      "../lookups/blank.html",REDIRECT
          MOVE      ONE,NEXTPAGE
          GOTO      GLINTR99
.
GLINTR98  MOVE      ZERO,EXIT
GLINTR99  RETURN 
+
.------------------------------------------------------------------------------
. System Based General Ledger Interfase Maintenance
.------------------------------------------------------------------------------
.
SYGLED00  COMPARE   ONE,CGLIND
          GOTO      SYGLED94 IF NOT EQUAL
.
          RESET     UPDTTYPE
          MATCH     SP1,UPDTTYPE            * Display formaction
          GOTO      SYGLED80 IF EQUAL
.
          MATCH     "A",UPDTTYPE            * Add formaction
          GOTO      SYGLED10 IF EQUAL
.
          MATCH     "U",UPDTTYPE            * Update formaction
          GOTO      SYGLED20 IF EQUAL
.
          MATCH     "D",UPDTTYPE            * Delete formaction
          GOTO      SYGLED30 IF EQUAL
.
          GOTO      SYGLED91
.
.         ********* ADD FORMACTION *********
.
SYGLED10  MOVE      SYSGL001,GLINT001
          CALL      GLKEY000                * Determine GL Key
          MOVE      GLINT002,SYSGL002
.
          MOVE      "3",SYSGL016               * Inpatient
          PACK      KEY18,SYSGL015,SYSGL016,SYSGL001,SYSGL002,SP70
          CALL      RDPMFMS1
          COMPARE   OVRCD,ZERO
          GOTO      SYGLED93 IF EQUAL
.
          CALL      CLRIGL00                 * clear variables
          CALL      SAVIGL00
          CALL      WRPMFMS1
.
          MATCH     "1",SYSGL001
          GOTO      SYGLED98 IF EQUAL        * Outpatient has no accommodation
.
          MOVE      "2",SYSGL016             * Outpatient
          PACK      KEY18,SYSGL015,SYSGL016,SYSGL001,SYSGL002,SP70
          CALL      RDPMFMS1
          COMPARE   OVRCD,ZERO
          GOTO      SYGLED93 IF EQUAL
.
          CALL      CLRIGL00                 * clear variables
          CALL      SAVOGL00
          CALL      WRPMFMS1
.
          MOVE      "1",SYSGL016             * Emergency
          PACK      KEY18,SYSGL015,SYSGL016,SYSGL001,SYSGL002,SP70
          CALL      RDPMFMS1
          COMPARE   OVRCD,ZERO
          GOTO      SYGLED93 IF EQUAL
.
          CALL      CLRIGL00                 * clear variables
          CALL      SAVEGL00
          CALL      WRPMFMS1
.
          GOTO      SYGLED98
.
.         ********* UPDATE FORMACTION *********
.
SYGLED20  MOVE      "3",SYSGL016             * Inpatient
          PACK      KEY18,SYSGL015,SYSGL016,SYSGL001,SYSGL002,SP70
          CALL      RDPMFMS1
          BRANCH    OVRCD,SYGLED92
.
          CALL      SAVIGL00
          CALL      UPPMFMS1
.
          MATCH     "1",SYSGL001
          GOTO      SYGLED98 IF EQUAL        * Outpat/EMR has no accommodation
.
          MOVE      "2",SYSGL016             * Outpatient
          PACK      KEY18,SYSGL015,SYSGL016,SYSGL001,SYSGL002,SP70
          CALL      RDPMFMS1
          BRANCH    OVRCD,SYGLED92
.
          CALL      SAVOGL00
          CALL      UPPMFMS1
.
          MOVE      "1",SYSGL016             * Emergency
          PACK      KEY18,SYSGL015,SYSGL016,SYSGL001,SYSGL002,SP70
          CALL      RDPMFMS1
          BRANCH    OVRCD,SYGLED92
.
          CALL      SAVEGL00
          CALL      UPPMFMS1
.
          GOTO      SYGLED98
.
.         ********* DELETE FORMACTION *********
.
SYGLED30  MOVE      "3",SYSGL016               * Inpatient
          PACK      KEY18,SYSGL015,SYSGL016,SYSGL001,SYSGL002,SP70
          CALL      RDPMFMS1
          BRANCH    OVRCD,SYGLED92
          CALL      DEPMFMS1
.
          MATCH     "1",SYSGL001
          GOTO      SYGLED98 IF EQUAL        * Outpatient has no accommodation
.
          MOVE      "2",SYSGL016             * Outpatient
          PACK      KEY18,SYSGL015,SYSGL016,SYSGL001,SYSGL002,SP70
          CALL      RDPMFMS1
          BRANCH    OVRCD,SYGLED92
          CALL      DEPMFMS1
.
          MOVE      "1",SYSGL016             * Emergency
          PACK      KEY18,SYSGL015,SYSGL016,SYSGL001,SYSGL002,SP70
          CALL      RDPMFMS1
          BRANCH    OVRCD,SYGLED92
          CALL      DEPMFMS1
.
          GOTO      SYGLED98
.
.
.         ********* DISPLAY FORMACTION *********
.
SYGLED80  CALL      CLROGL00
          CALL      CLREGL00
.
          MATCH     "1",NEWRECRD               * add new record
          GOTO      SYGLED82 IF EQUAL
.
          MATCH     "1",SYSGL001
          GOTO      SYGLED81 IF EQUAL          * Outpat/EMR has no accommodation
.
          MOVE      "2",SYSGL016               * Outpatient
          PACK      KEY18,SYSGL015,SYSGL016,SYSGL001,SYSGL002,SP70
          CALL      RDPMFMS1
          IF        OVRCD=0
            MOVE      PMFMFLED,OTFMFLED
            MOVE      PMFMFCRD,OTFMFCRD
            MOVE      PMFMFDEB,OTFMFDEB
            MOVE      PMFMGSTA,OTFMGSTA
            MOVE      PMFMTLED,OTFMTLED
            MOVE      PMFMTCRD,OTFMTCRD
            MOVE      PMFMTDEB,OTFMTDEB
          ENDIF
.
          MOVE      "1",SYSGL016               * Emergency
          PACK      KEY18,SYSGL015,SYSGL016,SYSGL001,SYSGL002,SP70
          CALL      RDPMFMS1
          IF        OVRCD=0
            MOVE      PMFMFLED,AEFMFLED
            MOVE      PMFMFCRD,AEFMFCRD
            MOVE      PMFMFDEB,AEFMFDEB
            MOVE      PMFMGSTA,AEFMGSTA
            MOVE      PMFMTLED,AEFMTLED
            MOVE      PMFMTCRD,AEFMTCRD
            MOVE      PMFMTDEB,AEFMTDEB
          ENDIF
.
SYGLED81  MOVE      "3",SYSGL016               * Inpatient
          PACK      KEY18,SYSGL015,SYSGL016,SYSGL001,SYSGL002,SP70
          CALL      RDPMFMS1
          BRANCH    OVRCD,SYGLED82
.
          GOTO      SYGLED83
.
SYGLED82  CALL      CLRIGL00                 * clear variables
          MOVE      "1",NEWRECRD
.
SYGLED83  CLEAR     WEBTITLE
          MOVE      "General Ledger Interface Maintenance",WEBTITLE
          RESET     WEBTITLE
.
          CALL      WEBHED00                * Output File & Write HTML Pg Header
          BRANCH    EXIT,SYGLED99
          CALL      WEBBOD00                * Process Web Body
          CALL      WEBEND00                * Process End of HTML File
.
          MOVE      ONE,EXIT
          GOTO      SYGLED99
.
.         ********* DISPLAY ERROR MESSAGES *********
.
SYGLED91  MOVE      "Invalid formaction",WEBTITLE
          CALL      WEBERR00
          MOVE      ONE,EXIT
          GOTO      SYGLED99
.
SYGLED92  MOVE      "Record does not exist",WEBTITLE
          CALL      WEBERR00
          MOVE      ONE,EXIT
          GOTO      SYGLED99
.
SYGLED93  MOVE      "Record already exists",WEBTITLE
          CALL      WEBERR00
          MOVE      ONE,EXIT
          GOTO      SYGLED99
.
SYGLED94  MOVE      "General Ledger Interface is Turned Off.",WEBTITLE
          CALL      WEBERR00
          MOVE      "../lookups/blank.html",REDIRECT
          MOVE      ONE,NEXTPAGE
          GOTO      SYGLED99
.
SYGLED98  MOVE      ZERO,EXIT
SYGLED99  RETURN
+
.------------------------------------------------------------------------------
. Determine GL key                                                 
.------------------------------------------------------------------------------
.
GLKEY000  MATCH     "1",GLINT001              * Accommodation
          GOTO      GLKEY100 IF EQUAL
          MATCH     "2",GLINT001              * Theatre
          GOTO      GLKEY200 IF EQUAL
          MATCH     "3",GLINT001              * Misc Item
          GOTO      GLKEY300 IF EQUAL
          MATCH     "5",GLINT001              * Journal
          GOTO      GLKEY500 IF EQUAL
          GOTO      GLKEY999
.
.         Accommodation
.
GLKEY100  CMATCH    "1",SUBSECTN              * Default    
          GOTO      GLKEY103 IF EQUAL
          CMATCH    "2",SUBSECTN              * Non-casemix
          GOTO      GLKEY105 IF EQUAL
          CMATCH    "3",SUBSECTN              * Casemix Lumpsum
          GOTO      GLKEY150 IF EQUAL
          CMATCH    "4",SUBSECTN              * Casemix Daily Charge
          GOTO      GLKEY160 IF EQUAL
          CMATCH    "5",SUBSECTN              * Govt Subsidy           
          GOTO      GLKEY170 IF EQUAL
          GOTO      GLKEY999
.
GLKEY103  PACK      GLINT002,SP70
          GOTO      GLKEY999
.
GLKEY105  BRANCH    CACCFEE,GLKEY110:         * Ward/Claim code
                            GLKEY120:         * Ward/Adm.type
                            GLKEY130:         * Ward/Claim/Adm Type      
                            GLKEY140:         * Ward/Adm Type/Claim
                            GLKEY142          * Claim type
.
          PACK      GLINT002,ANSA,ADMISSTP,SP70
          GOTO      GLKEY999
.
GLKEY110  PACK      GLINT002,ANSA,ACCMWARD,CLAIMCOD,SP70
          GOTO      GLKEY999
.
GLKEY120  PACK      GLINT002,ANSA,ACCMWARD,ADMISSTP,SP70
          GOTO      GLKEY999
.
GLKEY130  PACK      GLINT002,ANSA,ACCMWARD,CLAIMCOD,ADMISSTP,SP70
          GOTO      GLKEY999
.
GLKEY140  PACK      GLINT002,ANSA,ACCMWARD,ADMISSTP,CLAIMCOD,SP70
          GOTO      GLKEY999
.
GLKEY142  PACK      GLINT002,ANSA,CLAIMCOD,SP70
          GOTO      GLKEY999
.
GLKEY150  IF        CACCFEE=5
            PACK      GLINT002,ANSC,EPISODTP,CLAIMCOD,SP70
          ELSE
            IF        CACCFEE=4
              PACK      GLINT002,ANSC,EPISODTP,ADMISSTP,CLAIMCOD,SP70
            ELSE
              PACK      GLINT002,ANSC,EPISODTP,ADMISSTP,SP70
            ENDIF
          ENDIF
          GOTO      GLKEY999
.
GLKEY160  IF        CACCFEE=5
            PACK      GLINT002,ANSD,CLAIMCOD,SP70
          ELSE
            IF        CACCFEE=4
              PACK      GLINT002,ANSD,ACCMWARD,CLAIMCOD,SP70
            ELSE
              PACK      GLINT002,ANSD,ACCMWARD,SP70
            ENDIF
          ENDIF
          GOTO      GLKEY999
.
GLKEY170  PACK      GLINT002,ANSG,SP70
          GOTO      GLKEY999
.
.         Theatre
.
GLKEY200  CMATCH    "1",SUBSECTN              * Default    
          GOTO      GLKEY210 IF EQUAL
          CMATCH    "2",SUBSECTN              * Session Type
          GOTO      GLKEY220 IF EQUAL
          GOTO      GLKEY999
.
GLKEY210  PACK      GLINT002,SP70
          GOTO      GLKEY999
.
GLKEY220  PACK      GLINT002,ANSF,SESSTYPE,SP70 * Session Type
          GOTO      GLKEY999
.
.         Misc Items 
.
GLKEY300  CMATCH    "1",SUBSECTN              * Default    
          GOTO      GLKEY310 IF EQUAL
          CMATCH    "2",SUBSECTN              * Group Codes
          GOTO      GLKEY320 IF EQUAL
          CMATCH    "3",SUBSECTN              * Item/Claim Codes
          GOTO      GLKEY330 IF EQUAL
          CMATCH    "4",SUBSECTN              * Casemix Group Codes
          GOTO      GLKEY340 IF EQUAL
          CMATCH    "5",SUBSECTN              * Casemix Item/Claim Codes
          GOTO      GLKEY350 IF EQUAL
          GOTO      GLKEY999
.
GLKEY310  PACK      GLINT002,SP70
          GOTO      GLKEY999
.
GLKEY320  BRANCH    PTCNMFEE,GLKEY325              
          PACK      GLINT002,ANSM,GROUPCOD,SP70              * Group (item)
          GOTO      GLKEY999
.
GLKEY325  PACK      GLINT002,ANSM,SP3,GROUPCOD,SP70          * Group (claim) 
          GOTO      GLKEY999
.
GLKEY330  BRANCH    PTCNMFEE,GLKEY335              
          PACK      GLINT002,ANSM,SP3,ITEMCODE,SP70          * Item codes
          GOTO      GLKEY999
.
GLKEY335  PACK      GLINT002,ANSM,CLAIMCOD,GROUPCOD,SP70     * Claim codes
          GOTO      GLKEY999
.
GLKEY340  BRANCH    PTCNMFEE,GLKEY345               
          PACK      GLINT002,ANST,EPISODTP,GROUPCOD,SP70     * Casmx Grp(item) 
          GOTO      GLKEY999
.
GLKEY345  PACK      GLINT002,ANST,EPISODTP,SP3,GROUPCOD,SP70 * Casmx Grp(claim)
          GOTO      GLKEY999
.
GLKEY350  BRANCH    PTCNMFEE,GLKEY355  
          PACK      GLINT002,ANST,EPISODTP,SP3,ITEMCODE,SP70 * Casmx Item codes
          GOTO      GLKEY999
.
GLKEY355  PACK      GLINT002,ANST,EPISODTP,CLAIMCOD,GROUPCOD,SP70  * Casmx Clm 
          GOTO      GLKEY999
.
.         Journals
.
GLKEY500  CMATCH    "1",SUBSECTN              * Default        
          GOTO      GLKEY510 IF EQUAL
          CMATCH    "2",SUBSECTN              * Journal Codes  
          GOTO      GLKEY520 IF EQUAL
          GOTO      GLKEY999
.
GLKEY510  PACK      GLINT002,SP70
          GOTO      GLKEY999
.
GLKEY520  COMPARE   ONE,PTCNJFEE
          GOTO      GLKEY525 IF EQUAL
.
          PACK      GLINT002,JOURNALC,SP70
          GOTO      GLKEY999
.
GLKEY525  PACK      GLINT002,CLAIMCOD,JOURNALC,SP70
          GOTO      GLKEY999
.
GLKEY999  RETURN                  
.------------------------------------------------------------------------------
. Unpack GL key                                                 
.------------------------------------------------------------------------------
.
GLVAR000  MATCH     "1",GLINT001              * Accommodation
          GOTO      GLVAR100 IF EQUAL
          MATCH     "3",GLINT001              * Misc Item
          GOTO      GLVAR300 IF EQUAL
          MATCH     "5",GLINT001              * Journal
          GOTO      GLVAR500 IF EQUAL
          GOTO      GLVAR999
.
GLVAR100  CMATCH    "A",GLINT002              * Non-casemix
          GOTO      GLVAR105 IF EQUAL
          CMATCH    "C",GLINT002              * Casemix Lumpsum
          GOTO      GLVAR150 IF EQUAL
          CMATCH    "D",GLINT002              * Casemix Daily Charge
          GOTO      GLVAR160 IF EQUAL
          GOTO      GLVAR999
.
GLVAR105  BRANCH    CACCFEE,GLVAR110:         * Ward/Claim code
                            GLVAR120:         * Ward/Adm.Type
                            GLVAR130:         * Ward/Claim/Adm Type      
                            GLVAR140:         * Ward/Adm Type/Claim
                            GLVAR142          * Claim type
.
          UNPACK    GLINT002,DIM1,ADMISSTP
          GOTO      GLVAR999
.
GLVAR110  UNPACK    GLINT002,DIM1,ACCMWARD,CLAIMCOD
          GOTO      GLVAR999
.
GLVAR120  UNPACK    GLINT002,DIM1,ACCMWARD,ADMISSTP
          GOTO      GLVAR999
.
GLVAR130  UNPACK    GLINT002,DIM1,ACCMWARD,CLAIMCOD,ADMISSTP
          GOTO      GLVAR999
.
GLVAR140  UNPACK    GLINT002,DIM1,ACCMWARD,ADMISSTP,CLAIMCOD
          GOTO      GLVAR999
.
GLVAR142  UNPACK    GLINT002,DIM1,CLAIMCOD
          GOTO      GLVAR999
.
GLVAR150  UNPACK    GLINT002,DIM1,EPISODTP,ADMISSTP
          GOTO      GLVAR999
.
GLVAR160  UNPACK    GLINT002,DIM1,ACCMWARD
          GOTO      GLVAR999
.
GLVAR300
.
GLVAR500
.
GLVAR999  RETURN                  
+
.------------------------------------------------------------------------------
. Clear all variables for General Ledger Interface
.------------------------------------------------------------------------------
.
CLRGLI00  MOVE      SP70,PTFMSUB
          MOVE      SP70,PTFMCOD
          MOVE      SP70,PTFMIDI
          MOVE      SP70,PTFMIRE
          MOVE      SP70,PTFMILD
          MOVE      SP70,PTFMICA
          MOVE      SP70,PTFMIDA
          MOVE      SP70,PTFMIGS
          MOVE      SP70,PTFMBASC
          MOVE      SP70,PTFMTDI
          MOVE      SP70,PTFMTRE
          MOVE      SP70,PTFMTLD
          MOVE      SP70,PTFMTCA
          MOVE      SP70,PTFMTDA
          MOVE      SP70,PTFMHOSP
.
CLRGLI99  RETURN
+
.------------------------------------------------------------------------------
. Save cgi variables for General Ledger Interface                 
.------------------------------------------------------------------------------
.
SAVGLI00  MOVE      GLINT001,PTFMSUB
          MOVE      GLINT002,PTFMCOD
          MOVE      GLINT003,PTFMIDI
          MOVE      GLINT004,PTFMIRE
          MOVE      GLINT005,PTFMILD
          MOVE      GLINT006,PTFMICA
          MOVE      GLINT007,PTFMIDA
          MOVE      GLINT015,PTFMHOSP
.
          MATCH     "5",GLINT001
          GOTO      SAVGLI99 IF EQUAL
.
          MOVE      GLINT008,PTFMIGS
          MOVE      GLINT009,PTFMBASC
          MOVE      GLINT010,PTFMTDI
          MOVE      GLINT011,PTFMTRE
          MOVE      GLINT012,PTFMTLD
          MOVE      GLINT013,PTFMTCA
          MOVE      GLINT014,PTFMTDA
.
SAVGLI99  RETURN 
+
.------------------------------------------------------------------------------
. Clear all variables for System based Inpatient General Ledger Interface
.------------------------------------------------------------------------------
CLRIGL00  MOVE      SP70,PMFMHOSP
          MOVE      SP70,PMFMSYST
          MOVE      SP70,PMFMRSUB
          MOVE      SP70,PMFMCODE
          MOVE      SP70,PMFMFDIS
          MOVE      SP70,PMFMFRES
          MOVE      SP70,PMFMFLED
          MOVE      SP70,PMFMFCRD
          MOVE      SP70,PMFMFDEB
          MOVE      SP70,PMFMGSTA
          MOVE      SP70,PMFMTDIS
          MOVE      SP70,PMFMTRES
          MOVE      SP70,PMFMTLED
          MOVE      SP70,PMFMTCRD
          MOVE      SP70,PMFMTDEB
.
CLRIGL99  RETURN
+
.------------------------------------------------------------------------------
. Clear all variables for System based Outpatient General Ledger Interface
.------------------------------------------------------------------------------
CLROGL00  MOVE      SP70,OTFMFLED
          MOVE      SP70,OTFMFCRD
          MOVE      SP70,OTFMFDEB
          MOVE      SP70,OTFMGSTA
          MOVE      SP70,OTFMTLED
          MOVE      SP70,OTFMTCRD
          MOVE      SP70,OTFMTDEB
CLROGL99  RETURN
+
.------------------------------------------------------------------------------
. Clear all variables for System based Emergency General Ledger Interface
.------------------------------------------------------------------------------
CLREGL00  MOVE      SP70,AEFMFLED
          MOVE      SP70,AEFMFCRD
          MOVE      SP70,AEFMFDEB
          MOVE      SP70,AEFMGSTA
          MOVE      SP70,AEFMTLED
          MOVE      SP70,AEFMTCRD
          MOVE      SP70,AEFMTDEB
CLREGL99  RETURN
+
.------------------------------------------------------------------------------
. Save variables for General Ledger Interface
.------------------------------------------------------------------------------
.
SAVIGL00  MOVE      SYSGL001,PMFMRSUB
          MOVE      SYSGL002,PMFMCODE
          MOVE      SYSGL003,PMFMFDIS
          MOVE      SYSGL004,PMFMFRES
          MOVE      SYSGL005,PMFMFLED
          MOVE      SYSGL006,PMFMFCRD
          MOVE      SYSGL007,PMFMFDEB
.
          MOVE      SYSGL015,PMFMHOSP
          MOVE      SYSGL016,PMFMSYST
.
          MATCH     "5",SYSGL001
          GOTO      SAVIGL99 IF EQUAL
.
          MOVE      SYSGL008,PMFMGSTA
          MOVE      SYSGL009,PMFMBASC
          MOVE      SYSGL010,PMFMTDIS
          MOVE      SYSGL011,PMFMTRES
          MOVE      SYSGL012,PMFMTLED
          MOVE      SYSGL013,PMFMTCRD
          MOVE      SYSGL014,PMFMTDEB
.
SAVIGL99  RETURN
+
.------------------------------------------------------------------------------
. Save variables for Outpatient General Ledger Interface
.------------------------------------------------------------------------------
SAVOGL00  MOVE      SYSGL001,PMFMRSUB
          MOVE      SYSGL002,PMFMCODE
          MOVE      SP70,PMFMFDIS
          MOVE      SP70,PMFMFRES
          MOVE      SYSGL019,PMFMFLED
          MOVE      SYSGL020,PMFMFCRD
          MOVE      SYSGL021,PMFMFDEB
.
          MOVE      SYSGL015,PMFMHOSP
          MOVE      SYSGL016,PMFMSYST
.
          MATCH     "5",SYSGL001
          GOTO      SAVOGL99 IF EQUAL
.
          MOVE      SP70,PMFMBASC
          MOVE      SP70,PMFMTDIS
          MOVE      SP70,PMFMTRES
          MOVE      SYSGL022,PMFMGSTA
          MOVE      SYSGL026,PMFMTLED
          MOVE      SYSGL027,PMFMTCRD
          MOVE      SYSGL028,PMFMTDEB
.
SAVOGL99  RETURN
+
.------------------------------------------------------------------------------
. Save variables for Outpatient General Ledger Interface
.------------------------------------------------------------------------------
SAVEGL00  MOVE      SYSGL001,PMFMRSUB
          MOVE      SYSGL002,PMFMCODE
          MOVE      SP70,PMFMFDIS
          MOVE      SP70,PMFMFRES
          MOVE      SYSGL031,PMFMFLED
          MOVE      SYSGL032,PMFMFCRD
          MOVE      SYSGL033,PMFMFDEB
.
          MOVE      SYSGL015,PMFMHOSP
          MOVE      SYSGL016,PMFMSYST
.
          MATCH     "5",SYSGL001
          GOTO      SAVEGL99 IF EQUAL
.
          MOVE      SP70,PMFMBASC
          MOVE      SP70,PMFMTDIS
          MOVE      SP70,PMFMTRES
          MOVE      SYSGL034,PMFMGSTA
          MOVE      SYSGL038,PMFMTLED
          MOVE      SYSGL039,PMFMTCRD
          MOVE      SYSGL040,PMFMTDEB
.
SAVEGL99  RETURN
+
.------------------------------------------------------------------------------
. NZP Hospital based Invoice Range Maintenance
.------------------------------------------------------------------------------
.
NZIRNG00  RESET     UPDTTYPE
          MATCH     SP1,UPDTTYPE            * Display formaction
          GOTO      NZIRNG40 IF EQUAL
.
          MATCH     "A",UPDTTYPE            * Add formaction
          GOTO      NZIRNG10 IF EQUAL
.
          MATCH     "U",UPDTTYPE            * Upate formaction
          GOTO      NZIRNG20 IF EQUAL
.
          MATCH     "D",UPDTTYPE            * Delete formaction
          GOTO      NZIRNG30 IF EQUAL
.
          GOTO      NZIRNG93
.
.
.         ************ ADD FORMACTION ***********
.
NZIRNG10  SQUEEZE   NZIRN002
          PACK      NZIRN002,NZIRN002,SP10
          CALL      CHKNZI00                * No, validate input fields
          BRANCH    EXIT,NZIRNG99           * Exit if error found
.
          PACK      KEY6,NZIRN001,NZIRN002,SP10
          CALL      RDNZIRN1
          COMPARE   ZERO,OVRCD              * Does record already exist?
          GOTO      NZIRNG92 IF EQUAL       * Yes, display error message
          CALL      NZISAV00                * No, save input variables
          CALL      WRNZIRN1                * Write new record
.
          MOVE      ZERO,EXIT
          GOTO      NZIRNG99
.
.         ************ UPDATE FORMACTION **********
.
NZIRNG20  PACK      NZIRN002,NZIRN002,SP10
          CALL      CHKNZI00                * Validate input fields
          BRANCH    EXIT,NZIRNG99           * Exit if error found
.
          PACK      KEY6,NZIRN001,NZIRN002,SP10
          CALL      RDNZIRN1                * Does record exist?
          BRANCH    OVRCD,NZIRNG91          * No, Display error message
          CALL      NZISAV00                * Yes,save input variables
          CALL      UPNZIRN1                * Update record
.
          MOVE      ZERO,EXIT
          GOTO      NZIRNG99
.
.         ************ DELETE FORMACTION **********
.
NZIRNG30  PACK      NZIRN002,NZIRN002,SP10
          PACK      KEY6,NZIRN001,NZIRN002,SP10
          CALL      RDNZIRN1                * Does record exist?
          BRANCH    OVRCD,NZIRNG91          * No, Display error message
          CALL      DENZIRN1                * Yes, Delete record
.
          MOVE      ZERO,EXIT
          GOTO      NZIRNG99
.
.         ************ DISPLAY FORMACTION **********
.
NZIRNG40  PACK      NZIRN002,NZIRN002,SP10
          PACK      KEY6,NZIRN001,NZIRN002,SP10
          CALL      RDNZIRN1
          IF        OVRCD=1
            CALL      CLRNZI00              * Clear all the file variables
          ENDIF
.
          CLEAR     WEBTITLE
          MOVE      "Patient Invoice Range Maintenance",WEBTITLE
          RESET     WEBTITLE
.
          CALL      WEBHED00                * Output File & Write HTML Pg Header
          BRANCH    EXIT,NZIRNG99
.
          CALL      WEBBOD00                * Process Web Body
.
          CALL      WEBEND00                * Process End of HTML File
.
          MOVE      ONE,EXIT
          GOTO      NZIRNG99
.
.         ************ DISPLAY ERROR MESSAGE **********
.
NZIRNG91  MOVE      "Invoice Range Code record does not exist",WEBTITLE
          CALL      WEBERR00
          MOVE      ONE,EXIT
          GOTO      NZIRNG99
.
NZIRNG92  MOVE      "Invoice Range Code record exists",WEBTITLE
          CALL      WEBERR00
          MOVE      ONE,EXIT
          GOTO      NZIRNG99
.
NZIRNG93  MOVE      "Invalid Form Action.",WEBTITLE
          CALL      WEBERR00
          MOVE      ONE,EXIT
          GOTO      NZIRNG99
.
NZIRNG99  RETURN
+
.------------------------------------------------------------------------------
. Initialize's file data (Invoice Range Maintenance)
.------------------------------------------------------------------------------
.
CLRNZI00  MOVE      SP70,NZIRHOSP           * Hospital code
          MOVE      SP70,NZIRIRNG           * Invoice range code
          MOVE      SP70,NZIRDESC           * Invoice range description
          MOVE      ZERO,NZIRNEXT           * Next invoice number in range
          MOVE      ZERO,NZIRMAXI           * Maximum invoice number in range
          MOVE      SP70,NZIRSPAR           * Spare variable
.
CLRNZI99  RETURN
+
.------------------------------------------------------------------------------
. Moves cgi variables into file variables (Invoice Range Maintenance)
.------------------------------------------------------------------------------
.
NZISAV00  MOVE      NZIRN001,NZIRHOSP
          MOVE      NZIRN002,NZIRIRNG
          MOVE      NZIRN003,NZIRDESC
          MOVE      NZIRN004,NZIRNEXT
          MOVE      NZIRN005,NZIRMAXI
          MOVE      SP70,NZIRSPAR
.
NZISAV99  RETURN
+
.------------------------------------------------------------------------------
. Checks mandatory fields and perform validations
. (Patient Invoice Range Maintenance)
.------------------------------------------------------------------------------
.
. Checks for mandatory range code
.
CHKNZI00  RESET     NZIRN002                * Invoice range code
          MATCH     SP3,NZIRN002
          GOTO      CHKNZI90 IF EQUAL
.
. Checks for valid Max and Next invoice numbers
.
CHKNZI20  IF        NZIRN005 <= NZIRN004
            GOTO      CHKNZI91
          ENDIF
.
. Checks for overlaping with an existing invoice range
.
CHKNZI30  PACK      KEY6,SP70
          CALL      RSNZIRN1
CHKNZI31  CALL      RKNZIRN1
          BRANCH    OVRCD,CHKNZI98
.
          MATCH     NZIRHOSP,NZIRN001
          GOTO      CHKNZI32 IF NOT EQUAL
.
          MATCH     NZIRIRNG,NZIRN002
          GOTO      CHKNZI31 IF EQUAL
.
CHKNZI32  COMPARE   NZIRNEXT,NZIRN005
          GOTO      CHKNZI31 IF LESS
.
          COMPARE   NZIRN004,NZIRMAXI
          GOTO      CHKNZI31 IF LESS
.
          GOTO      CHKNZI92
.
CHKNZI90  MOVE      "Invoice Range Code is mandatory",WEBTITLE
          CALL      WEBERR00
          MOVE      ONE,EXIT
          GOTO      CHKNZI99
.
CHKNZI91  MOVE      "Max Invoice Number Must Be greater than ",WEBTITLE
          ENDSET    WEBTITLE
          APPEND    "Next Invoice Number",WEBTITLE
          RESET     WEBTITLE
          CALL      WEBERR00
          MOVE      ONE,EXIT
          GOTO      CHKNZI99
.
CHKNZI92  MOVE      "This Range Overlaps With Hospital:",WEBTITLE
          ENDSET    WEBTITLE
          APPEND    NZIRHOSP,WEBTITLE
          ENDSET    WEBTITLE
          APPEND    " Range:",WEBTITLE
          APPEND    NZIRIRNG,WEBTITLE
          RESET     WEBTITLE
          CALL      WEBERR00
          MOVE      ONE,EXIT
          GOTO      CHKNZI99
.
CHKNZI98  MOVE      ZERO,EXIT
.
CHKNZI99  RETURN
+
.------------------------------------------------------------------------------
. ICD10 Suggested classification
.------------------------------------------------------------------------------
PMSSGC00  RESET     UPDTTYPE
          MATCH     SP1,UPDTTYPE            * Display formaction
          GOTO      PMSSGC50 IF EQUAL
.
          MATCH     "A",UPDTTYPE            * Add formaction
          GOTO      PMSSGC10 IF EQUAL
.
          MATCH     "U",UPDTTYPE            * Update formaction
          GOTO      PMSSGC20 IF EQUAL
.
          MATCH     "D",UPDTTYPE            * Delete formaction
          GOTO      PMSSGC30 IF EQUAL
.
          MATCH     "F",UPDTTYPE            * Copy Health fund details
          GOTO      PMSSGC40 IF EQUAL
.
          GOTO      PMSSGC93
.
.         ************ ADD FORMACTION ***********
.
PMSSGC10  PACK      PMSGC001,PMSGC001,SP70
          PACK      PMSGC002,PMSGC002,SP70
          PACK      PMSGC003,PMSGC003,SP70
          PACK      PMSGC004,PMSGC004,SP70
          PACK      KEY26,PMSGC001,PMSGC002,PMSGC003,PMSGC004,SP70
          CALL      RDPMSGA1                * Record already exist?
          BRANCH    OVRCD,PMSSGC15          * No, insert new record
          GOTO      PMSSGC92                * Yes, display error
.
PMSSGC15  CALL      SGASAV00                * Save the variables
          PACK      KEY26,PMSGC001,PMSGC002,PMSGC003,PMSGC004,SP70
          CALL      WRPMSGA1                * write the new record
          GOTO      PMSSGC98
.
.         ************ UPDATE FORMACTION ***********
.
PMSSGC20  PACK      PMSGC001,PMSGC001,SP70
          PACK      PMSGC002,PMSGC002,SP70
          PACK      PMSGC003,PMSGC003,SP70
          PACK      PMSGC004,PMSGC004,SP70
          PACK      KEY26,PMSGC001,PMSGC002,PMSGC003,PMSGC004,SP70
          CALL      RDPMSGA1                * Record exists?
          BRANCH    OVRCD,PMSSGC91          * No, display error
.
          CALL      SGASAV00                * Save the variables
          CALL      UPPMSGA1                * Update the record
          GOTO      PMSSGC98
.
.         ************ DELETE FORMACTION ***********
.
PMSSGC30  PACK      PMSGC001,PMSGC001,SP70
          PACK      PMSGC002,PMSGC002,SP70
          PACK      PMSGC003,PMSGC003,SP70
          PACK      PMSGC004,PMSGC004,SP70
          PACK      KEY26,PMSGC001,PMSGC002,PMSGC003,PMSGC004,SP70
          CALL      RDPMSGA1                * Record exists?
          BRANCH    OVRCD,PMSSGC91          * No, display error
          CALL      DEPMSGA1                * Yes, delete the record
          GOTO      PMSSGC98
.
.         ********* SCHEDULE COPY FORMACTION *********
.
. Copy From Health Fund and MBS item
.
PMSSGC40  CALL      SAPY0000                * Schedule copy health fund details
          GOTO      PMSSGC98
.
.         *************** Display Formaction ****************
.
PMSSGC50  PACK      PMSGC001,PMSGC001,SP70
          PACK      PMSGC002,PMSGC002,SP70
          PACK      PMSGC003,PMSGC003,SP70
          PACK      PMSGC004,PMSGC004,SP70
          PACK      KEY26,PMSGC001,PMSGC002,PMSGC003,PMSGC004,SP70
          CALL      RDPMSGA1
          IF        OVRCD=1
            CALL      CLRSGA00              * Clear all the file variables
          ENDIF
.
          CLEAR     WEBTITLE
          MOVE      "ICD10 Suggested Classification Maintenance",WEBTITLE
          RESET     WEBTITLE
.
          CALL      WEBHED00                * Output File & Write HTML Pg Header
          BRANCH    EXIT,PMSSGC99
.
          CALL      WEBBOD00                * Process Web Body
.
          CALL      WEBEND00                * Process End of HTML File
.
          MOVE      ONE,EXIT
          GOTO      PMSSGC99
.
.         ********* DISPLAY ERROR MESSAGES *********
.
PMSSGC91  MOVE      "Record does not exist",WEBTITLE
          CALL      WEBERR00
          MOVE      ONE,EXIT
          GOTO      PMSSGC99
.
PMSSGC92  MOVE      "Record already exists",WEBTITLE
          CALL      WEBERR00
          MOVE      ONE,EXIT
          GOTO      PMSSGC99
.
PMSSGC93  MOVE      "Invalid formaction",WEBTITLE
          CALL      WEBERR00
          MOVE      ONE,EXIT
          GOTO      PMSSGC99
.
PMSSGC94  MOVE      "Health Fund is inactive",WEBTITLE
          CALL      WEBERR00
          MOVE      ONE,EXIT
          GOTO      PMSSGC99
.
PMSSGC98  MOVE      ZERO,EXIT
PMSSGC99  RETURN
+
.------------------------------------------------------------------------------
. ICD10 Suggested Classification Maintenance - Clear variables
.------------------------------------------------------------------------------
CLRSGA00  MOVE      SP70,PMSGCLMN           * Claim Code
          MOVE      SP70,PMSGHFND           * Health Fund
          MOVE      SP70,PMSGHFTB           * Health Fund Table
          MOVE      SP70,PMSGICDC           * ICD10 Code
          MOVE      SP70,PMSGCLSS           * Suggested Classification (catg A)
          MOVE      SP70,PMSGSPAR           * Spare variable
SGASGC99  RETURN
+
.------------------------------------------------------------------------------
. ICD10 Suggested Classification Maintenance - Save variables
.------------------------------------------------------------------------------
SGASAV00  MOVE      PMSGC001,PMSGCLMN       * Claim code
          MOVE      PMSGC002,PMSGHFND       * Health Fund Code
          MOVE      PMSGC003,PMSGHFTB       * Health Fund Code
          MOVE      PMSGC004,PMSGICDC       * MBS Item Code
          MOVE      PMSGC005,PMSGCLSS       * Suggested  Classification (Ca A)
          MOVE      SP70,PMSGSPAR           * Spare variable
SGASAV99  RETURN
+
.--------------------------------------------------------------------------
.*                             SAPY0000                                   *
.*   Schedule global copying of ICD10 Suggested Class.from IBARSH10       *
.--------------------------------------------------------------------------
SAPY0000  MOVE      "IBARSH10",SCHDPGID
          MOVE      "Copy ICD10 Suggested Classification Details",SCHDDESC
          MOVE      CURRDATE,SCHDDATE
          CLOCK     TIME,SCHDTIME
.
          PACK      PMSGC001,PMSGC001,SP70
          PACK      PMSGC002,PMSGC002,SP70
          PACK      PMSGC003,PMSGC003,SP70
          PACK      CPSGC001,CPSGC001,SP70
          PACK      CPSGC002,CPSGC002,SP70
          PACK      CPSGC003,CPSGC003,SP70
.
.         Write Keyin parameters for Extract
.
          MOVE      ONE,INDEXCNT
          MOVE      "30",KEYSTARR[INDEXCNT]       * Option
.
          ADD       ONE,INDEXCNT
          MOVE      PMSGC001,KEYSTARR[INDEXCNT]    * Copy From Claim code
.
          BRANCH    PMSGC008,SAPY3000              * All health fund
.
          ADD       ONE,INDEXCNT
          MOVE      PMSGC002,KEYSTARR[INDEXCNT]    * Copy From Health Fund
.
          ADD       ONE,INDEXCNT
          MOVE      PMSGC003,KEYSTARR[INDEXCNT]    * Copy From Health Fund
.
          GOTO      SAPY4000
.
SAPY3000  ADD       ONE,INDEXCNT
          MOVE      "All",KEYSTARR[INDEXCNT]       * All Health Fund
.
SAPY4000  BRANCH    PMSGC009,SAPY5000              * All ICD10 Code
.
          ADD       ONE,INDEXCNT
          MOVE      PMSGC004,KEYSTARR[INDEXCNT]    * Copy From ICD10 Code
          GOTO      SAPY6000
.
SAPY5000  ADD       ONE,INDEXCNT
          MOVE      "All",KEYSTARR[INDEXCNT]
.
.         Copy To details
.
SAPY6000  ADD       ONE,INDEXCNT
          MOVE      CPSGC003,KEYSTARR[INDEXCNT]    * Copy To Claim code
.
          BRANCH    PMSGC008,SAPY7000              * All health fund
.
          ADD       ONE,INDEXCNT
          MOVE      CPSGC001,KEYSTARR[INDEXCNT]    * Copy To Health Fund
          ADD       ONE,INDEXCNT
          MOVE      CPSGC004,KEYSTARR[INDEXCNT]    * Copy From Health Fund
.
SAPY7000  BRANCH    PMSGC009,SAPY9000              * All ICD10 Code
          ADD       ONE,INDEXCNT
          MOVE      CPSGC002,KEYSTARR[INDEXCNT]    * Copy To ICD10 Code
.
SAPY9000  ADD       ONE,INDEXCNT
          MOVE      ANSY,KEYSTARR[INDEXCNT]        * Yes perform copy
          MOVE      INDEXCNT,KEYSTCNT              * number of keystrokes
.
          CALL      SCHPRO00                * Schedule Extract
.
SAPY9999  RETURN
+
.------------------------------------------------------------------------------
. Process Fields called from WEBBOD00
.------------------------------------------------------------------------------
.
PROFLD00  BRANCH    REPORTNO,PROFLD10,PROFLD20,PROFLD30,PROFLD40,PROFLD50:
                             PROFLD60,PROFLD70,PROFLD80,PROFLD90
.
          GOTO      PROFLD99
.
PROFLD10  BRANCH    FLDSETNO,PROFLD11
          GOTO      PROFLD99
.
PROFLD11  CALL      PTIR0000                * Invoice Range Maintenance       
          GOTO      PROFLD99
.
PROFLD20  BRANCH    FLDSETNO,PROFLD21
          GOTO      PROFLD99
.
PROFLD21  CALL      MBSX0000                * MBS Explosion Charge Maintenance
          GOTO      PROFLD99
.
PROFLD30  BRANCH    FLDSETNO,PROFLD31
          GOTO      PROFLD99
.
PROFLD31  CALL      PTSC0000                * Suggested Classif.Except Maint
          GOTO      PROFLD99
.
PROFLD40  BRANCH    FLDSETNO,PROFLD41
          GOTO      PROFLD99
.
PROFLD41  CALL      PTFN0000                * Inv financial - end of year reset
          GOTO      PROFLD99
.
PROFLD50  BRANCH    FLDSETNO,PROFLD51
          GOTO      PROFLD99
.
PROFLD51  CALL      GLIN0000                * General Ledger Interface         
          GOTO      PROFLD99
.
PROFLD60  BRANCH    FLDSETNO,PROFLD61
          GOTO      PROFLD99
.
PROFLD61  CALL      PMRE0000                * Regime Detail Maintenance
          GOTO      PROFLD99
.
PROFLD70  BRANCH    FLDSETNO,PROFLD71,PROFLD72
          GOTO      PROFLD99
.
PROFLD71  CALL      SGLN0000                * System based G/L Interface
          GOTO      PROFLD99
.
PROFLD72  CALL      SYSG0000                * System based G/L Interface
          GOTO      PROFLD99
.
PROFLD80  BRANCH    FLDSETNO,PROFLD81,PROFLD82
          GOTO      PROFLD99
.
PROFLD81  CALL      NZIR0000                * NZP Invoice range maintenance
          GOTO      PROFLD99
.
PROFLD82  CALL      NZTB0000                * NZP Invoice Range Table
          GOTO      PROFLD99
.
PROFLD90  BRANCH    FLDSETNO,PROFLD91
          GOTO      PROFLD99
.
PROFLD91  CALL      PMSC0000                * ICD10 Suggested Classif.Maint
          GOTO      PROFLD99
.
PROFLD99  RETURN
+
.------------------------------------------------------------------------------
. Patient Invoice Range Maintenance
.------------------------------------------------------------------------------
.
PTIR0000  BRANCH    FLDITMNO,PTIR0100,PTIR0200,PTIR0300,PTIR0400,PTIR0500:
                             PTIR0600,PTIR0700
          GOTO      PTIR9999
.
PTIR0100  CALL      NEXTGR00                * Link to Next Group
          GOTO      PTIR9999
.
PTIR0200  CALL      PREVGR00                * Link to Last Group
          GOTO      PTIR9999
.
PTIR0300  CALL      PTITB000                * Table of Patient Invoice Range
          GOTO      PTIR9999
.
PTIR0400  WRITE     HTMLFILE;IRANGE;        * Invoice range code
          GOTO      PTIR9999
.
PTIR0500  WRITE     HTMLFILE;IRDESC;        * Invoice range description
          GOTO      PTIR9999
.
PTIR0600  WRITE     HTMLFILE;IRNEXT;        * Next invoice number
          GOTO      PTIR9999
.
PTIR0700  WRITE     HTMLFILE;IRMAXI;        * Maximum invoice range number
          GOTO      PTIR9999
.
PTIR9999  RETURN
+
.------------------------------------------------------------
. Link to Next set of Patient Invoice Range
.------------------------------------------------------------
.
NEXTGR00  MOVE      NORECORD,KEY2
          REP       " +",KEY2
          ASSIGN    STARTNUM+NORECORD,F3
          MOVE      F3,KEY3
          REP       " +",KEY3
          UNPACK    DIM127,D1,FLDPARA,DIM127
          MOVE      REPORTNO,F1
.
          REP       " +",STARTKEY
          REP       " +",PMREG001
          REP       " +",FILTACTV
.
          WRITE     HTMLFILE;"patweb61.pbl":
                                 "?reportno=",F1:
                                 "&template=",FLDPARA:
                                 "&startnum=",KEY3:
                                 "&norecord=",KEY2:
                                 "&startkey=",STARTKEY:
                                 "&pmreg001=",PMREG001:
                                 "&filtactv=",FILTACTV;
.
          REP       "+ ",STARTKEY
          REP       "+ ",PMREG001
          REP       "+ ",FILTACTV
.
NEXTGR99  RETURN
+
.------------------------------------------------------------------------------
. Link to previous set of Patient Invoice Range
.------------------------------------------------------------------------------
.
PREVGR00  MOVE      NORECORD,KEY2
          REP       " +",KEY2
          ASSIGN    STARTNUM-NORECORD,F3
          IF        F3<0
            MOVE    ZERO,F3
          ENDIF
          MOVE      F3,KEY3
          REP       " +",KEY3
          UNPACK    DIM127,D1,FLDPARA,DIM127
          MOVE      REPORTNO,F1
.
          REP       " +",STARTKEY
          REP       " +",PMREG001
          REP       " +",FILTACTV
.
          WRITE     HTMLFILE;"patweb61.pbl":
                                 "?reportno=",F1:
                                 "&template=",FLDPARA:
                                 "&startnum=",KEY3:
                                 "&norecord=",KEY2:
                                 "&startkey=",STARTKEY:
                                 "&pmreg001=",PMREG001:
                                 "&filtactv=",FILTACTV;
.
          REP       "+ ",STARTKEY
          REP       "+ ",PMREG001
          REP       "+ ",FILTACTV
.
PREVGR99  RETURN
+
.------------------------------------------------------------------------------
. Invoice Range Table
.------------------------------------------------------------------------------
.
PTITB000  UNPACK    DIM127,D1,LINKPRG,DIM127
          UNPACK    DIM127,D1,LINKREP,DIM127
          UNPACK    DIM127,D1,LINKTEM,DIM127
.
          CALL      PTIHD000                * Output Table Heading
.
          IF        NORECORD=0
            MOVE      PTCNNRTD,NORECORD         * Default Records to Display
          ENDIF
.
          MOVE      ZERO,RECNUMB
          MOVE      ZERO,DISNUMB
.
          PACK      KEY3,STARTKEY,SP10
          CALL      RDSIRNG1                * Position index on startkey
          COMPARE   ZERO,OVRCD              * Is exact match found? 
          IF        @EQUAL
            CALL      RDPIRNG1              * Yes,re-position index on startkey 
          ENDIF
PTITB100  CALL      RDKIRNG1                * Read next record 
          BRANCH    OVRCD,PTITB900
.
          ADD       ONE,RECNUMB
          IF        STARTNUM>=RECNUMB
            GOTO      PTITB100
          ENDIF
.
          MATCH     SP70,IRDESC
          IF        @EQUAL
            MOVE      NBSP,IRDESC
          ENDIF
.
          CALL      PTIRW000                * Invoice range row 
.
          ADD       ONE,DISNUMB
          COMPARE   NORECORD,DISNUMB
          GOTO      PTITB100 IF NOT EQUAL
          GOTO      PTITB999
.
PTITB900  CALL      NOMORE00      * Display No More Records Message
.
PTITB999  RETURN
+
.------------------------------------------------------------------------------
. Invoice Range (TABLE HEADING)
.------------------------------------------------------------------------------
.
PTIHD000  WRITE     HTMLFILE;"<tr>":
                               "<td class=HeadingCell width=15%>":
                               "<b> Code </b></td>":
                               "<td class=HeadingCell width=55%>":
                               "<b> Description </b></td>":
                               "<td class=HeadingCell width=15%>":
                               "<b> Next Invoice Number </b></td>":
                               "<td class=HeadingCell width=15%>":
                               "<b> Max Invoice Number </b></td>":
                             "</tr>"
.
PTIHD999  RETURN
+
.------------------------------------------------------------------------------
. Invoice Range (TABLE ROW)
.------------------------------------------------------------------------------
.
PTIRW000  WRITE     HTMLFILE;"<tr><td nowrap><A HREF='javascript:ShowDetail01":
                             "(#"",LINKPRG,"#.pbl":
                             "?reportno=",LINKREP:
                             "&template=",LINKTEM:
                             "&startkey=",STARTKEY:
                             "&ptirn001=",IRANGE,"#")'>":
                             "<img src=../images/MaintenanceIcon.gif hspace=4":
                             " border=0 align=absmiddle></a>":
                             IRANGE,"</td>":
                             "<td>",IRDESC,"</td>":
                             "<td align=right>",IRNEXT,"</td>":
                             "<td align=right>",IRMAXI,"</td>":
                             "</tr>"
.
PTIRW999 RETURN
+
.------------------------------------------------------------------------------
. NZP Patient Invoice Range Maintenance
.------------------------------------------------------------------------------
NZTB0000  BRANCH    FLDITMNO,NZTB0100,NZTB0200,NZTB0300,NZTB0400
          GOTO      NZTB9999
.
NZTB0100  CALL      NEXTGR00                * Link to Next Group
          GOTO      NZTB9999
.
NZTB0200  CALL      PREVGR00                * Link to Last Group
          GOTO      NZTB9999
.
NZTB0300  CALL      NZITB000                * Table of Patient Invoice Range
          GOTO      NZTB9999
.
NZTB0400  MOVE      FILTHOSP,DIM3
          CALL      NZIH0000                  * hospital selection list
          GOTO      NZTB9999
.
NZTB9999  RETURN
+
.------------------------------------------------------------------------------
. NZP Invoice Range Table
.------------------------------------------------------------------------------
.
NZITB000  UNPACK    DIM127,D1,LINKPRG,DIM127
          UNPACK    DIM127,D1,LINKREP,DIM127
          UNPACK    DIM127,D1,LINKTEM,DIM127
.
          CALL      NZIHD000                * Output Table Heading
.
          IF        NORECORD=0
            MOVE      "13",NORECORD         * Default Records to Display
          ENDIF
.
          MOVE      ZERO,RECNUMB
          MOVE      ZERO,DISNUMB
.
          PACK      KEY6,STARTKEY,SP10
          CALL      RDNZIRN2                * Position index on startkey
          COMPARE   ZERO,OVRCD              * Is exact match found?
          IF        @EQUAL
            CALL      RPNZIRN2              * Yes,re-position index on startkey
          ENDIF
NZITB100  CALL      RKNZIRN2                * Read next record
          BRANCH    OVRCD,NZITB999
.
          MATCH     SP70,FILTHOSP
          IF        !@EQUAL
            MATCH     NZIRHOSP,FILTHOSP
            GOTO      NZITB100 IF NOT EQUAL
          ENDIF
.
          ADD       ONE,RECNUMB
          IF        STARTNUM>=RECNUMB
            GOTO      NZITB100
          ENDIF
.
          MATCH     SP70,NZIRDESC
          IF        @EQUAL
            MOVE      NBSP,NZIRDESC
          ENDIF
.
          CALL      NZIRW000                * Invoice range row
.
          ADD       ONE,DISNUMB
          COMPARE   NORECORD,DISNUMB
          GOTO      NZITB100 IF NOT EQUAL
.
NZITB999  RETURN
+
.------------------------------------------------------------------------------
. NZP Invoice Range (TABLE HEADING)
.------------------------------------------------------------------------------
.
NZIHD000  WRITE     HTMLFILE;"<tr>":
                               "<td class=HeadingCell width=10%>":
                               "<b> Hospital Code </b></td>":
                               "<td class=HeadingCell width=10%>":
                               "<b> Range Code </b></td>":
                               "<td class=HeadingCell width=50%>":
                               "<b> Description </b></td>":
                               "<td class=HeadingCell width=15%>":
                               "<b> Next Invoice Number </b></td>":
                               "<td class=HeadingCell width=15%>":
                               "<b> Max Invoice Number </b></td>":
                             "</tr>"
.
NZIHD999  RETURN
+
.------------------------------------------------------------------------------
. NZP Invoice Range (TABLE ROW)
.------------------------------------------------------------------------------
.
NZIRW000  WRITE     HTMLFILE;"<tr><td nowrap><A HREF='javascript:ShowDetail01":
                             "(#"",LINKPRG,"#.pbl":
                             "?reportno=",LINKREP:
                             "&template=",LINKTEM:
                             "&startkey=",STARTKEY:
                             "&nzirn001=",NZIRHOSP:
                             "&nzirn002=",NZIRIRNG,"#")'>":
                             "<img src=../images/MaintenanceIcon.gif hspace=4":
                             " border=0 align=absmiddle></a>":
                             NZIRHOSP,"</td>":
                             "<td>",NZIRIRNG,"</td>":
                             "<td>",NZIRDESC,"</td>":
                             "<td align=right>",NZIRNEXT,"</td>":
                             "<td align=right>",NZIRMAXI,"</td>":
                             "</tr>"
.
NZIRW999 RETURN
+
.------------------------------------------------------------------------------
. Patient MBS Explosion Maintenance
.------------------------------------------------------------------------------
.
MBSX0000  BRANCH    FLDITMNO,MBSX0100,MBSX0200,MBSX0300,MBSX0400,MBSX0500:
                             MBSX0600,MBSX0700,MBSX0800,MBSX0900,MBSX1000:
                             MBSX1100,MBSX1200,MBSX1300,MBSX1400,MBSX1500:     
                             MBSX1600,MBSX1700,MBSX1800,MBSX1900
          GOTO      MBSX9999
.
MBSX0100  CALL      NEXTEC00                * Link to Next Group
          GOTO      MBSX9999
.
MBSX0200  CALL      PREVEC00                * Link to Last Group
          GOTO      MBSX9999
.
MBSX0300  CALL      MBSTB000                * Table of Patient MBS Explosion
          GOTO      MBSX9999
.
MBSX0400  MOVE      "CL",CATEGORY
          MOVE      PTEC0001,CODE
          CALL      CODITM00
          GOTO      MBSX9999
.
MBSX0500  MOVE      "A ",CATEGORY
          MOVE      PTEC0002,CODE
          CALL      CODITM00 
          GOTO      MBSX9999
.
MBSX0600  UNPACK    DIM127,D1,KEY1,DIM127
          MOVE      ZERO,F1
          MOVE      KEY1,F1
          BRANCH    F1,MBSX0601,MBSX0602
          PACK      KEY17,PTEC0003,SP70
          CALL      PATITMRD
          BRANCH    OVRCD,MBSX9999
          MATCH     "I",PTITACTV
          IF        @EQUAL
            MOVE    "Invalid - item is inactive. ",IDESC
          ENDIF
          WRITE     HTMLFILE;IDESC;
          GOTO      MBSX9999
.
MBSX0601  WRITE     HTMLFILE;PTEC0003;
          GOTO      MBSX9999
.
MBSX0602  PACK      KEY17,PTEC0003,SP70
          CALL      PATITMRD
          IF        OVRCD=1
            PACK      KEY17,PTEC0003,Z70
            CALL      RDSITEM1
            CALL      RDPITEM1
            BRANCH    OVRCD,MBSX9999
            MATCH     PTEC0003,ITEMNO
            IF        !@EQUAL
              MOVE      "Invalid MBS Code",IDESC
            ENDIF
          ENDIF
.
          WRITE     HTMLFILE;IDESC;
          GOTO      MBSX9999
.
MBSX0700  MOVE      "OP",CATEGORY
          MOVE      PTEC0006,CODE
          CALL      CODITM00 
          GOTO      MBSX9999
.
MBSX0800  UNPACK    DIM127,D1,KEY1,DIM127
          MOVE      ZERO,F1
          MOVE      KEY1,F1
          BRANCH    F1,MBSX0850,MBSX0860
.
MBSX0810  PACK      KEY29,PTECCTYP,SP6,SP3,PTECEMCH,CURRDATE,SP70
          CALL      PATMCHRD                * read Misc.Charges file
          COMPARE   ZERO,EXIT
          GOTO      MBSX0840 IF EQUAL       * valid
.
.         read with default claim code
.
MBSX0820  IF        IBCNMHOS = 1
            PACK      KEY3,SP10
            CALL      RSPTHSP1
            CALL      RKPTHSP1
            BRANCH    OVRCD,MBSX0830
            PACK      KEY29,PTHSDCLM,SP6,SP3,PTECEMCH,CURRDATE,SP70
          ELSE
            PACK      KEY29,PTCNDCLM,SP6,SP3,PTECEMCH,CURRDATE,SP70
          ENDIF
.
MBSX0825  CALL      PATMCHRD                * read Misc.Charges file 
          COMPARE   ZERO,EXIT
          GOTO      MBSX0840 IF EQUAL       * valid
.
.                                           * Multi Hospital
          IF        IBCNMHOS = 1
            CALL      RKPTHSP1
            BRANCH    OVRCD,MBSX0830
            PACK      KEY29,PTHSDCLM,SP6,SP3,PTECEMCH,CURRDATE,SP70
            GOTO      MBSX0825
          ENDIF
.
MBSX0830  MOVE      "<< Missing Code >>",MDESC
.
MBSX0840  WRITE     HTMLFILE;MDESC;
          GOTO      MBSX9999
.
MBSX0850  WRITE     HTMLFILE;PTECEMCH;
          GOTO      MBSX9999
.
MBSX0860  PACK      KEY29,PTECCTYP,SP6,SP3,PTECEMCH,CURRDATE,SP70
          CALL      PATMCHRD                * read Misc.Charges file
          COMPARE   ZERO,EXIT
          GOTO      MBSX0840 IF EQUAL       * valid
.
          IF        IBCNMHOS = 1
            PACK      KEY3,SP10
            CALL      RSPTHSP1
            CALL      RKPTHSP1
            BRANCH    OVRCD,MBSX0830
            PACK      KEY29,PTHSDCLM,SP6,SP3,PTECEMCH,CURRDATE,SP70
          ELSE
            PACK      KEY29,PTCNDCLM,SP6,SP3,PTECEMCH,CURRDATE,SP70
          ENDIF
.
          CALL      PATMCHRD                * read Misc.Charges file
          COMPARE   ZERO,EXIT
          GOTO      MBSX0840 IF EQUAL
.
          IF        IBCNMHOS=1
            PACK      KEY29,PTECEMCH,PTHSDCLM,SP70 
          ELSE
            PACK      KEY29,PTECEMCH,PTCNDCLM,SP70
          ENDIF
          CALL      RDSMCHG4
          CALL      RDKMCHG4
          BRANCH    OVRCD,MBSX0830
          MATCH     MCHARGE,PTECEMCH
          IF        @EQUAL
            GOTO      MBSX0840
          ELSE
            GOTO      MBSX0830
          ENDIF
          GOTO      MBSX9999
.
MBSX0900  MOVE      "OP",CATEGORY
          MOVE      PTECOPPC,CODE
          CALL      CODITM00
          GOTO      MBSX9999
.
MBSX1000  WRITE     HTMLFILE;PTEC1MCF;
          GOTO      MBSX9999
.
MBSX1100  WRITE     HTMLFILE;PTEC2MCF; 
          GOTO      MBSX9999
.
MBSX1200  WRITE     HTMLFILE;PTEC3MCF;
          GOTO      MBSX9999
.
MBSX1300  WRITE     HTMLFILE;PTECUNIQ;
          GOTO      MBSX9999
.
MBSX1400  WRITE     HTMLFILE;PTECQNTY;
          GOTO      MBSX9999
.
MBSX1500  CALL      FNDGRP00              * Health Fund Group Selection List
          GOTO      MBSX9999
.
MBSX1600  MATCH     SP70,PTEC0010
          IF        !@EQUAL
            PACK      KEY14,PTEC0010,ZERO,ZERO,ZERO,ZERO,SP70
            CALL      RDFUND1
            BRANCH    OVRCD,MBSX9999
            WRITE     HTMLFILE;HFNAME;
          ELSE
            WRITE     HTMLFILE;SP70;
          ENDIF
          GOTO      MBSX9999              
.
MBSX1700  MATCH     SP70,PTEC0002
          IF        @EQUAL
            UNPACK    DIM127,D1,KEY1,DIM127
            MOVE      SP70,KEY3
            WRITE     HTMLFILE;KEY3;
            GOTO      MBSX9999
          ENDIF
.
          MOVE      "A ",CATEGORY
          MOVE      PTEC0002,CODE
          CALL      CODITM00
          GOTO      MBSX9999
.
MBSX1800  UNPACK    DIM127,D1,KEY1,DIM127
          MOVE      KEY1,F1
          BRANCH    F1,MBSX1801,MBSX1802
          WRITE     HTMLFILE;PTEC0010;       * Health Fund
          GOTO      MBSX9999 
.
MBSX1801  MATCH     SP70,PTEC0010
          GOTO      MBSX9999 IF EQUAL
.
          PACK      KEY14,PTEC0010,SP70
          CALL      RDSFUND1
          CALL      RDKFUND1
          BRANCH    OVRCD,MBSX9999
          WRITE     HTMLFILE;HFNAME;        * Health Fund Name
          GOTO      MBSX9999 
.
MBSX1802  WRITE     HTMLFILE;PTECHFND;
          GOTO      MBSX9999
.
MBSX1900  WRITE     HTMLFILE;PTECMBSC;      * MBS Code
          GOTO      MBSX9999
.
MBSX9999  RETURN
+
.------------------------------------------------------------
. Link to Next set of MBS Explosion Charges
.------------------------------------------------------------
.
NEXTEC00  MOVE      NORECORD,KEY2
          REP       " +",KEY2
          ASSIGN    STARTNUM+NORECORD,F3
          MOVE      F3,KEY3
          REP       " +",KEY3
          UNPACK    DIM127,D1,FLDPARA,DIM127
          MOVE      REPORTNO,F1
.
          WRITE     HTMLFILE;"patweb61.pbl":
                                 "?reportno=",F1:
                                 "&template=",FLDPARA:
                                 "&startnum=",KEY3:
                                 "&norecord=",KEY2:
                                 "&ptec0001=",PTEC0001:
                                 "&ptec0002=",PTEC0002:
                                 "&ptec0003=",PTEC0003:
                                 "&ptec0004=",PTEC0004;
.
NEXTEC99  RETURN
+
.------------------------------------------------------------------------------
. Link to previous set of Patient Invoice Range
.------------------------------------------------------------------------------
.
PREVEC00  MOVE      NORECORD,KEY2
          REP       " +",KEY2
          ASSIGN    STARTNUM-NORECORD,F3
          IF        F3<0
            MOVE    ZERO,F3
          ENDIF
          MOVE      F3,KEY3
          REP       " +",KEY3
          UNPACK    DIM127,D1,FLDPARA,DIM127
          MOVE      REPORTNO,F1
.
          WRITE     HTMLFILE;"patweb61.pbl":
                                 "?reportno=",F1:
                                 "&template=",FLDPARA:
                                 "&startnum=",KEY3:
                                 "&norecord=",KEY2:
                                 "&ptec0001=",PTEC0001:
                                 "&ptec0002=",PTEC0002:
                                 "&ptec0003=",PTEC0003:
                                 "&ptec0004=",PTEC0004;
.
PREVEC99  RETURN
.------------------------------------------------------------------------------
. MBS Explosion Table
.------------------------------------------------------------------------------
.
MBSTB000  UNPACK    DIM127,D1,LINKPRG,DIM127
          UNPACK    DIM127,D1,LINKREP,DIM127
          UNPACK    DIM127,D1,LINKTEM,DIM127
.
          CALL      MBSHD000                * Output Table Heading
.
          IF        NORECORD=0
            MOVE      PTCNNRTD,NORECORD     * Default Records to Display
          ENDIF
.
          MOVE      ZERO,RECNUMB
          MOVE      ZERO,DISNUMB
.
MBSTB020  CALL      RSMBSX00                * Position index
          BRANCH    EXIT,MBSTB900
.
MBSTB100  CALL      RKMBSX00                * read next record
          BRANCH    OVRCD,MBSTB900
.
          ADD       ONE,RECNUMB
          IF        STARTNUM>=RECNUMB
            GOTO     MBSTB100 
          ENDIF
.
          IF        INDEX=1
            IF        NOINDEX2=0
              MATCH     PTEC0001,PTECCTYP             * match claim type
              GOTO      MBSTB900 IF NOT EQUAL
            ENDIF
.
            MATCH     SP70,PTEC0003
            IF        !@EQUAL
              MATCH     PTEC0003,PTECMBSC           * match MBS code
              GOTO      MBSTB100 IF NOT EQUAL
            ENDIF
          ENDIF
.
          IF        INDEX=2
            MATCH     PTEC0003,PTECMBSC             * match MBS code
            GOTO      MBSTB900 IF NOT EQUAL
.
            MATCH     SP70,PTEC0001
            IF        !@EQUAL
              MATCH     PTEC0001,PTECCTYP           * match claim type
              GOTO      MBSTB100 IF NOT EQUAL
            ENDIF
          ENDIF
.
          MATCH     SP70,PTEC0002
          IF        !@EQUAL
            MATCH     PTEC0002,PTECATYP           * match admission type
            GOTO      MBSTB100 IF NOT EQUAL
          ENDIF
.       
          MATCH     SP70,PTEC0010
          IF        !@EQUAL
            MATCH     PTEC0010,PTECHFND           * match health fund   
            GOTO      MBSTB100 IF NOT EQUAL
          ENDIF
.
          MATCH     SP70,PTEC0011
          IF        !@EQUAL
            MATCH     PTEC0011,PTECHGRP           * match health fund group
            GOTO      MBSTB100 IF NOT EQUAL
          ENDIF
.
          CALL      MBSRW000                * MBS Explosion row 
.
          ADD       ONE,DISNUMB
          COMPARE   NORECORD,DISNUMB
          GOTO      MBSTB100 IF NOT EQUAL
          GOTO      MBSTB999
.
MBSTB900  CALL      NOMORE00      * Display No More Records Message
.
MBSTB999  RETURN
+
.------------------------------------------------------------------------------
. Select which patechaf index to use according to search input
.------------------------------------------------------------------------------
.
RSMBSX00  MOVE      ZERO,EXIT
          MOVE      ZERO,INDEX
          MOVE      ZERO,NOINDEX2
.
          MOVE      ZERO,OVRCD
          TRAP      OVERCOND IF IO
          OPEN      PATECHA2,"patechaf"
          TRAPCLR   IO
          IF        OVRCD=1
            MATCH     SP70,PTEC0001        * use index 1 if Claim Type not blank
            IF        @EQUAL
              MATCH     SP70,PTEC0003
              IF        @EQUAL
                GOTO      RSMBSX99  
              ELSE
                MOVE      ONE,NOINDEX2
                MOVE      ONE,INDEX
                PACK      KEY30,SP70
                CALL      RSPTECH1
                GOTO      RSMBSX99
              ENDIF
            ELSE
              MOVE      ONE,NOINDEX2
              MOVE      ONE,INDEX
              PACK      KEY30,PTEC0001,SP70
              CALL      RSPTECH1
              GOTO      RSMBSX99
            ENDIF
          ENDIF
.
          MATCH     SP70,PTEC0001          * use index 1 if Claim Type not blank
          GOTO      RSMBSX10 IF NOT EQUAL
.
          MATCH     SP70,PTEC0003          * use index 2 if MBS Code not blank
          GOTO      RSMBSX20 IF NOT EQUAL
.
          GOTO      RSMBSX90                        * exit
.
RSMBSX10  MOVE      ONE,INDEX
          PACK      KEY30,PTEC0001,PTEC0002,SP70
          CALL      RSPTECH1
          GOTO      RSMBSX99
.
RSMBSX20  MOVE      TWO,INDEX
          PACK      KEY30,PTEC0003,PTEC0001,SP70
          CALL      RSPTECH2
          GOTO      RSMBSX99
.
RSMBSX90  MOVE      ONE,EXIT
.
RSMBSX99  RETURN
+
.------------------------------------------------------------------------------
. Read next patechaf record according to index 1 or 2
.------------------------------------------------------------------------------
RKMBSX00  BRANCH    INDEX,RKMBSX10,RKMBSX20
          GOTO      RKMBSX99
.
RKMBSX10  CALL      RKPTECH1
          GOTO      RKMBSX99
.
RKMBSX20  CALL      RKPTECH2
          GOTO      RKMBSX99
.
RKMBSX99  RETURN
+
.------------------------------------------------------------------------------
. MBS Explosion Maintenance Heading
.------------------------------------------------------------------------------
.
MBSHD000  WRITE     HTMLFILE;"<tr>":
                               "<td class=HeadingCell width=7%>":
                               "<b> Claim Type </b></td>":
                               "<td class=HeadingCell width=7%>":
                               "<b> Admission Type </b></td>":
                               "<td class=HeadingCell width=7%>":
                               "<b> Health Fund </b></td>":
                               "<td class=HeadingCell width=7%>":
                               "<b> Health Fund Group </b></td>":
                               "<td class=HeadingCell width=7%>":
                               "<b> MBS Code </b></td>":
                               "<td class=HeadingCell width=7%>":
                               "<b> Misc Charge <br> Code </b></td>":
                               "<td class=HeadingCell width=3%>":
                               "<b> Qty </b></td>":
                               "<td class=HeadingCell width=10%>":
                               "<b> &nbsp; <br> Description </b></td>":
                               "<td class=HeadingCell width=5%>":
                               "<b> Operating <br> Code </b></td>":
                               "<td class=HeadingCell width=10%>":
                               "<b> &nbsp; <br> Operating Personnel </b></td>":
                               "<td class=HeadingCell width=5%>":
                               "<b> 1st <br> Misc Fee %</b></td>":
                               "<td class=HeadingCell width=5%>":
                               "<b> 2nd <br> Misc Fee %</b></td>":
                               "<td class=HeadingCell width=5%>":
                               "<b> 3rd <br> Misc Fee % </b></td>":
                             "</tr>"
.
MBSHD999  RETURN
+
.------------------------------------------------------------------------------
. MBS Exploding Charges Row  
.------------------------------------------------------------------------------
.
MBSRW000  MOVE      ZERO,EXIT
.
          PACK      KEY29,PTECCTYP,SP6,SP3,PTECEMCH,CURRDATE,SP70
MBSRW100  CALL      PATMCHRD                * read Misc.Charges file
          COMPARE   ZERO,EXIT
          GOTO      MBSRW300 IF EQUAL       * if its valid
.
.         read with default claim code
.
MBSRW110  IF        IBCNMHOS=1
            PACK      KEY3,SP10
            CALL      RSPTHSP1
            CALL      RKPTHSP1
            BRANCH    OVRCD,MBSRW200
            PACK      KEY29,PTHSDCLM,SP6,SP3,PTECEMCH,CURRDATE,SP70
          ELSE
            PACK      KEY29,PTCNDCLM,SP6,SP3,PTECEMCH,CURRDATE,SP70
          ENDIF
.
MBSRW120  CALL      PATMCHRD              * read Misc.Charges file
          COMPARE   ZERO,EXIT
          GOTO      MBSRW300 IF EQUAL     * if its valid
.
.         Multi Hosptial
.
          PACK      KEY50,LINKPRG,LINKREP,LINKTEM,SP70
          MATCH     "patweb6102003",KEY50
          IF        @EQUAL
            IF        IBCNMHOS=1
              PACK      KEY29,PTECEMCH,PTHSDCLM,SP70
            ELSE
              PACK      KEY29,PTECEMCH,PTCNDCLM,SP70
            ENDIF
            CALL      RDSMCHG4
            CALL      RDKMCHG4
            BRANCH    OVRCD,MBSRW200
            MATCH     MCHARGE,PTECEMCH
            IF        @EQUAL
              GOTO      MBSRW300
            ELSE
              GOTO      MBSRW200
            ENDIF
          ELSE
            IF        IBCNMHOS=1
              CALL      RKPTHSP1
              BRANCH    OVRCD,MBSRW200
              PACK      KEY29,PTHSDCLM,SP6,SP3,PTECEMCH,CURRDATE,SP70
              GOTO      MBSRW120
            ENDIF
          ENDIF
.
MBSRW200  MOVE      "<< Missing Code >>",MDESC
.
MBSRW300  MOVE      SP20,TDESC
          PACK      KEY5,ANSO,ANSP,PTECOPPC
          CALL      RDCODE1                 * Get TDESC for operating personnel 
          IF        OVRCD=1
            PACK      TDESC,SP70
          ENDIF
.
          WRITE     HTMLFILE;"<tr><td nowrap><A HREF='javascript:ShowDetail01":
                             "(#"",LINKPRG,"#.pbl":
                             "?reportno=",LINKREP:
                             "&template=",LINKTEM:
                             "&ptec0001=",PTECCTYP:
                             "&ptec0002=",PTECATYP:
                             "&ptec0010=",PTECHFND:
                             "&ptec0011=",PTECHGRP:
                             "&ptec0003=",PTECMBSC:
                             "&ptec0004=",PTECUNIQ,"#")'>":
                             "<img src=../images/MaintenanceIcon.gif hspace=4":
                             " border=0 align=absmiddle></a>":
                             PTECCTYP,"</td>":
                             "<td>",PTECATYP,"</td>":
                             "<td>",PTECHFND,"</td>":
                             "<td>",PTECHGRP,"</td>":
                             "<td>",PTECMBSC,"</td>":
                             "<td>",PTECEMCH,"</td>":
                             "<td>",PTECQNTY,"</td>":
                             "<td>",MDESC,"</td>":
                             "<td>",PTECOPPC,"</td>":
                             "<td>",TDESC,"</td>":
                             "<td align=right>",PTEC1MCF,"</td>":
                             "<td align=right>",PTEC2MCF,"</td>":
                             "<td align=right>",PTEC3MCF,"</td>":
                             "</tr>"
.
MBSRW999 RETURN
+
.------------------------------------------------------------
. Health Fund Group Selection List
.------------------------------------------------------------
FNDGRP00  UNPACK    DIM127,D1,KEY1,DIM127
          MOVE      ZERO,F1
          MOVE      KEY1,F1
          BRANCH    F1,FNDGRP10,FNDGRP20
.
          PACK      KEY8,QUOTE,SP3,ANSA,ANSL,ANSL,QUOTE,SP70
          PACK      KEY6,SP70
          CALL      RSPAHGP1
FNDGRP05  CALL      RKPAHGP1
          BRANCH    OVRCD,FNDGRP99
.
          MOVE      PTHGDESC,KEY50
          PACK      KEY8,QUOTE,PTHGCODE,QUOTE,SP70
          MATCH     PTHGCODE,PTECHGRP
          IF        @EQUAL
            WRITE     HTMLFILE;"<option value=",KEY8," selected>":
                               KEY50,"</option>"
          ELSE
            MATCH     PTHGCODE,PTEC0011
            IF        @EQUAL
              WRITE     HTMLFILE;"<option value=",KEY8," selected>":
                               KEY50,"</option>"
            ELSE
              WRITE     HTMLFILE;"<option value=",KEY8,">",KEY50,"</option>"
            ENDIF
          ENDIF
          GOTO      FNDGRP05
.
FNDGRP10  MATCH     SP70,PTEC0011
          IF        @EQUAL
            WRITE     HTMLFILE;SP70;
            GOTO      FNDGRP99
          ENDIF
.
          PACK      KEY6,PTEC0011,SP70
          CALL      RDPAHGP1
          BRANCH    OVRCD,FNDGRP99 
.
          WRITE     HTMLFILE;PTHGDESC;
          GOTO      FNDGRP99
.
FNDGRP20  WRITE     HTMLFILE;PTECHGRP;
          GOTO      FNDGRP99
.
FNDGRP99  RETURN
+
.
.------------------------------------------------------------------------------
. Patient Suggested Classification Maintenance
.------------------------------------------------------------------------------
.
PTSC0000  BRANCH    FLDITMNO,PTSC0100,PTSC0200,PTSC0300,PTSC0400,PTSC0500:
                             PTSC0600,PTSC0700,PTSC0800,PTSC0900,PTSC1000:
                             PTSC1100,PTSC1200
          GOTO      PTSC9999
.
PTSC0100  CALL      NEXTSC00                * Link to Next Group
          GOTO      PTSC9999
.
PTSC0200  CALL      PREVSC00                * Link to Last Group
          GOTO      PTSC9999
.
PTSC0300  MOVE      ZERO,ENQFLAG
          CALL      SGCTB000                * Table of Suggested Classification
          GOTO      PTSC9999
.
PTSC0400  UNPACK    DIM127,D1,KEY1,DIM127    * Health Fund
          MOVE      ZERO,F1
          MOVE      KEY1,F1
          BRANCH    F1,PTSC0401
          PACK      KEY14,PTSGC001,HFHEADER,SP70
          CALL      RDFUND1
          BRANCH    OVRCD,PTSC9999
          WRITE     HTMLFILE;HFNAME;        * .0 - Health Fund Description
          GOTO      PTSC9999
.
PTSC0401  WRITE     HTMLFILE;PTSGC001;      * .1 - Health Fund code
          GOTO      PTSC9999
.
PTSC0500  UNPACK    DIM127,D1,KEY1,DIM127   * MBS Item 
          MOVE      ZERO,F1
          MOVE      KEY1,F1
          BRANCH    F1,PTSC0501
          PACK      KEY17,PTSGMBS,SP70
          CALL      PATITMRD
          BRANCH    OVRCD,PTSC9999
          MATCH     "I",PTITACTV
          IF        @EQUAL
            MOVE    "Invalid - item is inactive. ",IDESC
          ENDIF
          WRITE     HTMLFILE;IDESC;         * .0 - MBS Code description
          GOTO      PTSC9999
.
PTSC0501  WRITE     HTMLFILE;PTSGMBS;       * .1 - MBS Code
          GOTO      PTSC9999
.
PTSC0600  MOVE      "A ",CATEGORY           * Suggested Classification
          MOVE      PTSGC003,CODE
          CALL      CODITM00
          GOTO      PTSC9999 
.
PTSC0700  MOVE      "A ",CATEGORY           * Suggested Classification
          MOVE      PTSGCLSS,CODE
          CALL      CODITM00
          GOTO      PTSC9999 
.
PTSC0800  UNPACK    DIM127,D1,KEY1,DIM127
          MOVE      ZERO,F1
          MOVE      KEY1,F1
          BRANCH    F1,PTSC0801
          PACK      KEY14,PTSGFUND,HFHEADER,SP70 
          CALL      RDFUND1
          BRANCH    OVRCD,PTSC9999
          WRITE     HTMLFILE;HFNAME;        * .0 - Health Fund description
          GOTO      PTSC9999
.
PTSC0801  WRITE     HTMLFILE;PTSGFUND;      * .1 - Health Fund code
          GOTO      PTSC9999
.  
PTSC0900  MOVE      "CL",CATEGORY           * Claim Code
          MOVE      PTSGC004,CODE
          CALL      CODITM00
          GOTO      PTSC9999 
.
PTSC1000  MOVE      "CL",CATEGORY           * Claim Code
          MOVE      PTSGCLMN,CODE
          CALL      CODITM00
          GOTO      PTSC9999 
.
PTSC1100  WRITE     HTMLFILE;PTSGC008;
          GOTO      PTSC9999
.
PTSC1200  MOVE      ONE,ENQFLAG
          CALL      SGCTB000                * Table of Suggested Classification
          GOTO      PTSC9999
.
PTSC9999  RETURN
+
.------------------------------------------------------------
. Link to Next set of Suggested Classification Charges
.------------------------------------------------------------
.
NEXTSC00  MOVE      NORECORD,KEY2
          REP       " +",KEY2
          ASSIGN    STARTNUM+NORECORD,F3
          MOVE      F3,KEY3
          REP       " +",KEY3
          UNPACK    DIM127,D1,FLDPARA,DIM127
          MOVE      REPORTNO,F1
.
          WRITE     HTMLFILE;"patweb61.pbl":
                                 "?reportno=",F1:
                                 "&template=",FLDPARA:
                                 "&startnum=",KEY3:
                                 "&norecord=",KEY2:
                                 "&ptsgc004=",PTSGC004:
                                 "&ptsgc001=",PTSGC001:
                                 "&ptsgc002=",PTSGC002:
                                 "&ptsgc008=",PTSGC008;
.
NEXTSC99  RETURN
+
.------------------------------------------------------------------------------
. Link to previous set of Patient Invoice Range
.------------------------------------------------------------------------------
.
PREVSC00  MOVE      NORECORD,KEY2
          REP       " +",KEY2
          ASSIGN    STARTNUM-NORECORD,F3
          IF        F3<0
            MOVE    ZERO,F3
          ENDIF
          MOVE      F3,KEY3
          REP       " +",KEY3
          UNPACK    DIM127,D1,FLDPARA,DIM127
          MOVE      REPORTNO,F1
.
          WRITE     HTMLFILE;"patweb61.pbl":
                                 "?reportno=",F1:
                                 "&template=",FLDPARA:
                                 "&startnum=",KEY3:
                                 "&norecord=",KEY2:
                                 "&ptsgc004=",PTSGC004:
                                 "&ptsgc001=",PTSGC001:
                                 "&ptsgc002=",PTSGC002:
                                 "&ptsgc008=",PTSGC008;
.
PREVSC99  RETURN
+
.------------------------------------------------------------------------------
. Suggested Classification Table
.------------------------------------------------------------------------------
SGCTB000  IF        ENQFLAG<>1
            UNPACK    DIM127,D1,LINKPRG,DIM127
            UNPACK    DIM127,D1,LINKREP,DIM127
            UNPACK    DIM127,D1,LINKTEM,DIM127
          ENDIF
.
          CALL      SGCHD000                * Output Table Heading
.
          IF        NORECORD=0
            MOVE      PTCNNRTD,NORECORD         * Default Records to Display
          ENDIF
.
          MOVE      ZERO,RECNUMB
          MOVE      ZERO,DISNUMB
.
          PACK      KEY18,PTSGC004,PTSGC001,PTSGC002,SP70                    
          CALL      RSPTSGC1                * Position index
          COMPARE   ZERO,OVRCD              * Is exact match found? 
          IF        @EQUAL
            CALL      RPPTSGC1              * Yes,re-position index 
          ENDIF
SGCTB100  CALL      RKPTSGC1                * Read next record 
          BRANCH    OVRCD,SGCTB900
.
          ADD       ONE,RECNUMB
          IF        STARTNUM>=RECNUMB
            GOTO     SGCTB100 
          ENDIF
.
          MATCH     PTSGC004,PTSGCLMN       * Different claim code?
          GOTO      SGCTB900 IF NOT EQUAL   * Yes, exit
.
          MATCH     PTSGC001,PTSGFUND       * Different Health Fund?
          GOTO      SGCTB900 IF NOT EQUAL   * Yes, exit
.
          MATCH     SP70,PTSGC008
          GOTO      SGCTB150 IF EQUAL
          GOTO      SGCTB150 IF EOS
.
          MOVE      PTSGC008,DIM15
          REP       UPPLOW,DIM15
.
          PACK      KEY24,PTSGMBS,DIM15,SP70
          CALL      RDPTIK1
          IF        OVRCD=1
            CALL      RSPTIK1
            CALL      RKPTIK1
            BRANCH    OVRCD,SGCTB100
            MATCH     PTSGMBS,PTIKITM
            GOTO      SGCTB100 IF NOT EQUAL
            STRIP     DIM15
            MATCH     DIM15,PTIKKWD
            GOTO      SGCTB100 IF NOT EQUAL
          ENDIF
.
SGCTB150  CALL      SGCRW000                * Suggested Classification row 
.
          ADD       ONE,DISNUMB
          COMPARE   NORECORD,DISNUMB
          GOTO      SGCTB100 IF NOT EQUAL
          GOTO      SGCTB999
.
SGCTB900  CALL      NOMORE00       * Display No More Records Message
.
SGCTB999  RETURN
+
.------------------------------------------------------------------------------
. Suggested Classification Maintenance Heading
.------------------------------------------------------------------------------
SGCHD000  BRANCH    ENQFLAG,SGCHD200
          WRITE     HTMLFILE;"<tr>":
                               "<td class=HeadingCell width=15%>":
                               "<b> MBS Item  </b></td>":
                               "<td class=HeadingCell width=35%>":
                               "<b> MBS Description </b></td>":
                               "<td class=HeadingCell width=15%>":
                               "<b> Classification Code </b></td>":
                               "<td class=HeadingCell width=35%>":
                               "<b> Classification Description </b></td>":
                             "</tr>"
          GOTO      SGCHD999
.
SGCHD200  WRITE     HTMLFILE;"<tr>":
                               "<td class=HeadingCell width=15%>":
                               "<b> Claim Code</b></td>":
                               "<td class=HeadingCell width=20%>":
                               "<b> Health Fund</b></td>":
                               "<td class=HeadingCell width=10%>":
                               "<b> MBS Item  </b></td>":
                               "<td class=HeadingCell width=25%>":
                               "<b> MBS Description </b></td>":
                               "<td class=HeadingCell width=10%>":
                               "<b> Classification Code </b></td>":
                               "<td class=HeadingCell width=20%>":
                               "<b> Classification Description </b></td>":
                             "</tr>"
SGCHD999  RETURN
+
.------------------------------------------------------------------------------
. SGC Exploding Charges Row  
.------------------------------------------------------------------------------
SGCRW000  PACK      KEY17,PTSGMBS,SP70
          CALL      PATITMRD                * Get IDESC for MBS Item
          BRANCH    OVRCD,PTSC9999
          MATCH     "I",PTITACTV
          IF        @EQUAL
            MOVE    "Invalid - item is inactive. ",IDESC
          ENDIF
.
          BRANCH    ENQFLAG,SGCRW200
.
          MOVE      SP20,TDESC
          PACK      KEY5,ANSA,SP1,PTSGCLSS
          CALL      RDCODE1                 * Get TDESC for Suggested Class. 
.
          WRITE     HTMLFILE;"<tr><td nowrap><A HREF='javascript:ShowDetail01":
                             "(#"",LINKPRG,"#.pbl":
                             "?reportno=",LINKREP:
                             "&template=",LINKTEM:
                             "&ptsgc004=",PTSGCLMN:
                             "&ptsgc001=",PTSGFUND:
                             "&ptsgc002=",PTSGMBS,"#")'>":
                             "<img src=../images/MaintenanceIcon.gif hspace=4":
                             " border=0 align=absmiddle></a>":
                             PTSGMBS,"</td>":
                             "<td>",IDESC,"</td>":
                             "<td>",PTSGCLSS,"</td>":
                             "<td>",TDESC,"</td>":
                             "</tr>"
          GOTO      SGCRW999
.
SGCRW200  PACK      KEY14,PTSGFUND,HFHEADER,SP70
          CALL      RDFUND1
          IF        OVRCD=1
            MOVE      SP70,HFNAME
          ENDIF
.
          WRITE     HTMLFILE;"<tr>";
.
          MATCH     SP70,PTSGCLMN
          IF        !@EQUAL
            MOVE      "CL",TCODE
            PACK      KEY5,TCODE,PTSGCLMN,SP70
            CALL      RDCODE1
            IF        OVRCD=1
              MOVE      "Invalid Claim Code",TDESC
            ENDIF
            WRITE     HTMLFILE;"<td>&nbsp",PTSGCLMN,"-",TDESC,"</td>";
          ELSE
            WRITE     HTMLFILE;"<td>&nbsp";
          ENDIF
.
          MOVE      SP20,TDESC
          PACK      KEY5,ANSA,SP1,PTSGCLSS
          CALL      RDCODE1                 * Get TDESC for Suggested Class. 
.
          WRITE     HTMLFILE;"<td>&nbsp",HFNAME,"</td>":
                             "<td>",PTSGMBS,"</td>":
                             "<td>",IDESC,"</td>":
                             "<td>",PTSGCLSS,"</td>":
                             "<td>",TDESC,"</td>":
                             "</tr>"
SGCRW999  RETURN
+
.------------------------------------------------------------------------------
. ICD10 Suggested Classification Maintenance
.------------------------------------------------------------------------------
.
PMSC0000  BRANCH    FLDITMNO,PMSC0100,PMSC0200,PMSC0300,PMSC0400,PMSC0500:
                             PMSC0600,PMSC0700,PMSC0800,PMSC0900,PMSC1000:
                             PMSC1100
          GOTO      PMSC9999
.
PMSC0100  CALL      NEXTSA00                * Link to Next Group
          GOTO      PMSC9999
.
PMSC0200  CALL      PREVSA00                * Link to Last Group
          GOTO      PMSC9999
.
PMSC0300  UNPACK    DIM127,D1,KEY1,DIM127    * Health Fund
          MOVE      ZERO,F1
          MOVE      KEY1,F1
          BRANCH    F1,PMSC0301
          PACK      KEY14,PMSGC002,HFHEADER,SP70
          CALL      RDFUND1
          BRANCH    OVRCD,PMSC9999
          WRITE     HTMLFILE;HFNAME;        * .0 - Health Fund Description
          GOTO      PMSC9999
.
PMSC0301  WRITE     HTMLFILE;PMSGC002;      * .1 - Health Fund code
          GOTO      PMSC9999
.
PMSC0400  UNPACK    DIM127,D1,KEY1,DIM127
          MOVE      ZERO,F1
          MOVE      KEY1,F1
          BRANCH    F1,PMSC0410
          WRITE     HTMLFILE;PMSGC003;
          GOTO      PMSC9999
.
PMSC0410  PACK      KEY14 WITH PMSGC002,PMSGC003,SP10
          CALL      RDFUND1
          IF        OVRCD=0
            WRITE     HTMLFILE;HFNAME;      * Description of Table
          ELSE
            WRITE     HTMLFILE;PMSGC003;    * Table code
          ENDIF
          GOTO      PMSC9999
.
PMSC0500  UNPACK    DIM127,D1,KEY1,DIM127
          MOVE      ZERO,F1
          MOVE      KEY1,F1
          BRANCH    F1,PMSC0501
.
          PACK      KEY9,PMSGICDC,SP10
          CALL      RDPTICD1                * Read an ICD10 disease file record
          BRANCH    OVRCD,PMSC9999
          WRITE     HTMLFILE;DDESC;         * ICD10 Code description
          GOTO      PMSC9999
.
PMSC0501  WRITE     HTMLFILE;PMSGICDC;       * ICD10 Code
          GOTO      PMSC9999
.
PMSC0600  MOVE      "A ",CATEGORY           * Suggested Classification
          MOVE      PMSGC005,CODE
          CALL      CODITM00
          GOTO      PMSC9999
.
PMSC0700  MOVE      "A ",CATEGORY           * Suggested Classification
          MOVE      PMSGCLSS,CODE
          CALL      CODITM00
          GOTO      PMSC9999
.
PMSC0800  MOVE      "CL",CATEGORY           * Claim Code
          MOVE      PMSGC001,CODE
          CALL      CODITM00
          GOTO      PMSC9999
.
PMSC0900  MOVE      "CL",CATEGORY           * Claim Code
          MOVE      PMSGCLMN,CODE
          CALL      CODITM00
          GOTO      PMSC9999
.
PMSC1000  
          UNPACK    DIM127,DIM1,KEY1,DIM127
          MOVE      ZERO,F1
          MOVE      KEY1,F1
.
          PACK      KEY9,PMSGC004,SP70
          CALL      RDPTICD1                * Get IDESC for ICD10 Code
.         BRANCH    OVRCD,PMSC9999
          IF        OVRCD=1
            CALL      RKPTICD1
            BRANCH    OVRCD,PMSC9999
.
            MOVE      PMSGC004,DIM3
.
            MATCH     DIM3,DPCODE
            GOTO      PMSC9999 IF NOT EQUAL
.
            MOVE      SP70,DDESC
          ENDIF
.
          BRANCH    F1,PMSC1020
          WRITE     HTMLFILE;DDESC;         * Output Description
          GOTO      PMSC9999
.         
PMSC1020  WRITE     HTMLFILE;PMSGC004;      * ICD10 Code
          GOTO      PMSC9999
.
PMSC1100  MOVE      ZERO,ENQFLAG
          CALL      SGATB000                * Table of Suggested Classification
          GOTO      PMSC9999
.
PMSC9999  RETURN
+
.------------------------------------------------------------
. Link to Next set of ICD10 Suggested Classification
.------------------------------------------------------------
NEXTSA00  MOVE      NORECORD,KEY2
          REP       " +",KEY2
          ASSIGN    STARTNUM+NORECORD,F3
          MOVE      F3,KEY3
          REP       " +",KEY3
          UNPACK    DIM127,D1,FLDPARA,DIM127
          MOVE      REPORTNO,F1
.
          WRITE     HTMLFILE;"patweb61.pbl":
                                 "?reportno=",F1:
                                 "&template=",FLDPARA:
                                 "&startnum=",KEY3:
                                 "&norecord=",KEY2:
                                 "&pmsgc001=",PMSGC001:
                                 "&pmsgc002=",PMSGC002:
                                 "&pmsgc003=",PMSGC003:
                                 "&pmsgc004=",PMSGC004:
                                 "&pmsgc005=",PMSGC005;
.
NEXTSA99  RETURN
+
.------------------------------------------------------------------------------
. Link to previous set of ICD10 Suggested Classification
.------------------------------------------------------------------------------
PREVSA00  MOVE      NORECORD,KEY2
          REP       " +",KEY2
          ASSIGN    STARTNUM-NORECORD,F3
          IF        F3<0
            MOVE    ZERO,F3
          ENDIF
          MOVE      F3,KEY3
          REP       " +",KEY3
          UNPACK    DIM127,D1,FLDPARA,DIM127
          MOVE      REPORTNO,F1
.
          WRITE     HTMLFILE;"patweb61.pbl":
                                 "?reportno=",F1:
                                 "&template=",FLDPARA:
                                 "&startnum=",KEY3:
                                 "&norecord=",KEY2:
                                 "&pmsgc001=",PMSGC001:
                                 "&pmsgc002=",PMSGC002:
                                 "&pmsgc003=",PMSGC003:
                                 "&pmsgc004=",PMSGC004:
                                 "&pmsgc005=",PMSGC005;
.
PREVSA99  RETURN
+
.------------------------------------------------------------------------------
. ICD10 Suggested Classification Table
.------------------------------------------------------------------------------
SGATB000  IF        ENQFLAG<>1
            UNPACK    DIM127,D1,LINKPRG,DIM127
            UNPACK    DIM127,D1,LINKREP,DIM127
            UNPACK    DIM127,D1,LINKTEM,DIM127
          ENDIF
.
          CALL      SGAHD000                * Output Table Heading
.
          IF        NORECORD=0
            MOVE      PTCNNRTD,NORECORD         * Default Records to Display
          ENDIF
.
          MOVE      ZERO,RECNUMB
          MOVE      ZERO,DISNUMB
.
          PACK      KEY26,PMSGC001,PMSGC002,PMSGC003,SP70
          CALL      RSPMSGA1                * Position index
          COMPARE   ZERO,OVRCD              * Is exact match found?
          IF        @EQUAL
            CALL      RPPMSGA1              * Yes,re-position index
          ENDIF

SGATB100  CALL      RKPMSGA1                * Read next record
          BRANCH    OVRCD,SGATB990
.
          MATCH     PMSGC001,PMSGCLMN       * Different claim code?
          GOTO      SGATB990 IF NOT EQUAL   * Yes, check next record
.
          MATCH     PMSGC002,PMSGHFND       * Different Health Fund?
          GOTO      SGATB990 IF NOT EQUAL   * Yes, check next record
          MATCH     SP70,PMSGC003
          IF        !@EQUAL
            MATCH     PMSGC003,PMSGHFTB       * Different Health Fund Table?
            GOTO      SGATB100 IF NOT EQUAL   * Yes, check next record
          ENDIF
.
          MATCH     SP70,PMSGC004
          IF        !@EQUAL
            MATCH     PMSGC004,PMSGICDC
            GOTO      SGATB100 IF NOT EQUAL   * Yes, check next record
          ENDIF
.
          ADD       ONE,RECNUMB
          IF        STARTNUM>=RECNUMB
            GOTO     SGATB100
          ENDIF
.
SGATB150  CALL      SGARW000                * Suggested Classification row
.
          ADD       ONE,DISNUMB
          COMPARE   NORECORD,DISNUMB
          GOTO      SGATB100 IF NOT EQUAL
          GOTO      SGATB999
.
SGATB990  CALL      NOMORE00      * Dipslay No More Records Message
.
SGATB999  RETURN
+
.------------------------------------------------------------------------------
. ICD10 Suggested Classification Maintenance Heading
.------------------------------------------------------------------------------
SGAHD000  WRITE     HTMLFILE;"<tr>":
                               "<td class=HeadingCell width=15%>":
                               "<b> Health Fund</b></td>":
                               "<td class=HeadingCell width=15%>":
                               "<b> Health Fund Table</b></td>":
.
                               "<td class=HeadingCell width=15%>":
                               "<b> ICD10 Code</b></td>":
                               "<td class=HeadingCell width=20%>":
                               "<b> ICD10 Description </b></td>":
                               "<td class=HeadingCell width=15%>":
                               "<b> Classification Code </b></td>":
                               "<td class=HeadingCell width=20%>":
                               "<b> Classification Description </b></td>":
                             "</tr>"
SGAHD999  RETURN
+
.------------------------------------------------------------------------------
. ICD10 Suggested Classification Row
.------------------------------------------------------------------------------
SGARW000  PACK      KEY9,PMSGICDC,SP70
          CALL      RDPTICD1                * Get IDESC for ICD10 Code
.         BRANCH    OVRCD,SGARW999
          IF        OVRCD=1
            CALL      RKPTICD1
            BRANCH    OVRCD,SGARW999
.
            MOVE      PMSGICDC,DIM3
.
            MATCH     DIM3,DPCODE
            GOTO      SGARW999 IF NOT EQUAL            
.
            MOVE      SP70,DDESC
          ENDIF
.
          MOVE      SP20,TDESC
          PACK      KEY5,ANSA,SP1,PMSGCLSS
          CALL      RDCODE1                 * Get TDESC for Suggested Class.
.
          WRITE     HTMLFILE;"<tr><td nowrap><A HREF='javascript:ShowDetail01":
                             "(#"",LINKPRG,"#.pbl":
                             "?reportno=",LINKREP:
                             "&template=",LINKTEM:
                             "&pmsgc001=",PMSGCLMN:
                             "&pmsgc002=",PMSGHFND:
                             "&pmsgc003=",PMSGHFTB:
                             "&pmsgc004=",PMSGICDC,"#")'>":
                             "<img src=../images/MaintenanceIcon.gif hspace=4":
                             " border=0 align=absmiddle></a>":
                             PMSGHFND,"</td>":
                             "<td>&nbsp;",PMSGHFTB,"</td>":
                             "<td>&nbsp;",PMSGICDC,"</td>":
                             "<td>&nbsp;",DDESC,"</td>":
                             "<td>&nbsp;",PMSGCLSS,"</td>":
                             "<td>&nbsp;",TDESC,"</td>":
                             "</tr>"
SGARW999  RETURN
+
.------------------------------------------------------------------------------
. PROFIELD - Invoice Financial Summary -End of Year Reset
.------------------------------------------------------------------------------
.
PTFN0000  BRANCH    FLDITMNO,PTFN0100,PTFN0200
.
          GOTO      PTFN9999
.
PTFN0100  CALL      SYSID000
          GOTO      PTFN9999
.
PTFN0200  CALL      OTSIT000
          GOTO      PTFN9999
.
PTFN9999  RETURN 
+
.------------------------------------------------------------------------------
. Display active systems - RP common codes. Did not display 0=Consolidated
.------------------------------------------------------------------------------
.
SYSID000  MOVE      CURRDATE,CODEDATE
.
          MOVE      SP70,CMCDDESC
          MOVE      "RP",CATEGORY
          PACK      KEY5,CATEGORY,SP70
          CALL      RDCMCOD1
          BRANCH    OVRCD,SYSID100
.
          MATCH     SP70,CMCDFMDT       * if form date exists
          GOTO      SYSID200 IF EQUAL
          MATCH     CMCDFMDT,CODEDATE   * check from date is before code date
          GOTO      SYSID999 IF LESS
.
          MATCH     SP70,CMCDTODT       * if to date exists
          GOTO      SYSID200 IF EQUAL
          MATCH     CODEDATE,CMCDTODT   * check to date is after code date
          GOTO      SYSID999 IF LESS
.
          GOTO      SYSID200
.
SYSID100  MOVE      CATEGORY,CMCDTCOD
          MOVE      "Invalid Category",CMCDDESC

SYSID200  REP       " _",CMCDTCOD
          REP       " _",CMCDHDPE
          WRITE     HTMLFILE;"<!--<cat-c category=#"",CMCDTCOD,"#" name=#"":
                             CMCDDESC:
                             "#" map=#"",CMCDHDPE,"#"></cat-c>-->"
.
          PACK      KEY25,CATEGORY,SP70
          CALL      RSCMCOD2
SYSID300  CALL      RKCMCOD2
          BRANCH    OVRCD,SYSID999
.
          MATCH     CATEGORY,CMCDTCOD
          GOTO      SYSID999 IF NOT EQUAL
          MATCH     SP10,CMCDACOD        * ignore category row
          GOTO      SYSID300 IF EQUAL
          MATCH     "0",CMCDSI01         * ignore consolidated system row
          GOTO      SYSID300 IF EQUAL
.
          MATCH     SP70,CMCDFMDT       * if form date exists
          GOTO      SYSID500 IF EQUAL
          MATCH     CMCDFMDT,CODEDATE   * check from date is before code date
          GOTO      SYSID300 IF LESS
.
          MATCH     SP70,CMCDTODT       * if to date exists
          GOTO      SYSID500 IF EQUAL
          MATCH     CODEDATE,CMCDTODT   * check to date is after code date
          GOTO      SYSID300 IF LESS
.
SYSID500  PACK      KEY11,CMCDSI01,CMCDSI02,CMCDSI03,CMCDSI04,CMCDSI05:
                          CMCDSI06,CMCDSI07,CMCDSI08,CMCDSI09,CMCDSI10:
                          CMCDSI11
          PACK      KEY14,CMCDHDPE,CMCDNATE,CMCDASSC
          PACK      KEY30,QUOTE,CMCDACOD,KEY11,KEY14,QUOTE
.
          WRITE     HTMLFILE;"<option value=",KEY30,">",CMCDDESC,"</option>"
          GOTO      SYSID300
.
SYSID999  RETURN
+
.------------------------------------------------------------------------------
. Display Oupatient site type
.------------------------------------------------------------------------------
.
OTSIT000  CALL      OTSITE00
          BRANCH    EXIT,OTSIT999
.
          WRITE     HTMLFILE;SITETYPE;
          GOTO      OTSIT999
.
OTSIT999  RETURN
+
.------------------------------------------------------------------------------
. Determine Outpatient site
.------------------------------------------------------------------------------
.
OTSITE00  MOVE      ZERO,EXIT
          MOVE      ZERO,FORM1
          MOVE      ZERO,SITETYPE
          MOVE      ZERO,IBSMAVAL
.
          PACK      KEY3,IBCNOPSN           * Outpatient system active?
          CALL      RDIBSMA1
          MOVE      IBSMAVAL,FORM1
.
          COMPARE   ONE,FORM1
          IF        @EQUAL
            MOVE      ONE,SITETYPE
            GOTO      OTSITE99
          ENDIF
.
          MOVE      ZERO,IBSMAVAL
          PACK      KEY3,IBCNRASN           * Radiology system active?
          CALL      RDIBSMA1
          MOVE      IBSMAVAL,FORM1
.
          COMPARE   ONE,FORM1
          IF        @EQUAL
            MOVE      TWO,SITETYPE
            GOTO      OTSITE99
          ENDIF
.
          MOVE      ZERO,IBSMAVAL
          PACK      KEY3,IBCNMASN           * Mammography system active?
          CALL      RDIBSMA1
          MOVE      IBSMAVAL,FORM1
.
          COMPARE   ONE,FORM1
          IF        @EQUAL
            MOVE      THREE,SITETYPE
            GOTO      OTSITE99
          ENDIF
.
OTSITE90  MOVE      ONE,EXIT
OTSITE99  RETURN
.------------------------------------------------------------------------------
. Read Previous for PATIRNIO.INC
.------------------------------------------------------------------------------
.
RDPIRNG1  MOVE      ZERO,OVRCD
          READKP    PATIRNG1;IRANGE,IRDESC,IRNEXT,IRMAXI,IRSPAR
          GOTO      OVERCOND IF OVER
          RETURN
+
.------------------------------------------------------------------------------
. GLIN0000 - General Ledger Inferface Maintenance           
.------------------------------------------------------------------------------
.
GLIN0000  BRANCH    FLDITMNO,GLIN0100,GLIN0200,GLIN0300,GLIN0400,GLIN0500:
                             GLIN0600,GLIN0700,GLIN0800,GLIN0900,GLIN1000:
                             GLIN1100,GLIN1200,GLIN1300,GLIN1400,GLIN1500:
                             GLIN1600,GLIN1700,GLIN1800,GLIN1900,GlIN2000:
                             GLIN2100,GLIN2200,GLIN2300,GLIN2400,GLIN2500:
                             GLIN2600,GLIN2700,GLIN2800,GLIN2900,GLIN3000:
                             GLIN3100,GLIN3200,GLIN3300,GLIN3400,GLIN3500:
                             GLIN3600,GLIN3700,GLIN3800,GLIN3900,GLIN4000:
                             GLIN4100,GLIN4200,GLIN4300,GLIN4400,GLIN4500:
                             GLIN4600,GLIN4700,GLIN4800,GLIN4900
.
          GOTO      GLIN9999
.
.   Accommodation Interface Sub-Section Selection List
.
GLIN0100  WRITE     HTMLFILE;"<option value=1>Defaults</option>"; 
          MOVE      CACCFEE0,KEY25
          LOAD      KEY25,CACCFEE,CACCFEE1:    * Ward/Claim
                                  CACCFEE2:    * Ward/Adm. type
                                  CACCFEE3:    * Ward/Claim/Adm.type
                                  CACCFEE4:    * Ward/Adm.type/Claim 
                                  CACCFEE5     * Claim type
          WRITE     HTMLFILE;"<option value=2>",KEY25,"</option>" 
          WRITE     HTMLFILE;"<option value=3>Lumpsum (Casemix)</option>" 
          WRITE     HTMLFILE;"<option value=4>Daily Charge (Casemix)</option>" 
          WRITE     HTMLFILE;"<option value=5>Government Subsidy</option>" 
          GOTO      GLIN9999
.
.   Misc Item Interface Sub-Section Selection List
.
GLIN0200  WRITE     HTMLFILE;"<option value=1>Defaults</option>" 
          WRITE     HTMLFILE;"<option value=2>Group Codes</option>" 
.
          IF        PTCNMFEE=0
            WRITE     HTMLFILE;"<option value=3>Item Codes</option>" 
          ELSE
            WRITE     HTMLFILE;"<option value=3>Claim Codes</option>" 
          ENDIF
.
          WRITE     HTMLFILE;"<option value=4>Group Codes (Casemix)</option>"
.
          IF        PTCNMFEE=0
            WRITE     HTMLFILE;"<option value=5>Item Codes (Casemix)</option>" 
          ELSE
            WRITE     HTMLFILE;"<option value=5>Claim Codes (Casemix)</option>"
          ENDIF
.
          GOTO      GLIN9999
.
.   Report Sub Section - Accommodation/Misc Items/Journals                     
.
GLIN0300  WRITE     HTMLFILE;PTFMSUB;
          GOTO      GLIN9999
.
.   Report Sub Section Code                  
.
GLIN0400  WRITE     HTMLFILE;PTFMCOD;
          GOTO      GLIN9999
.
.   Fees Invoiced Dissection Selection List
.
GLIN0500  UNPACK    DIM127,D1,KEY1,DIM127
          MOVE      ZERO,F1
          MOVE      KEY1,F1
          BRANCH    F1,GLIN0510
          WRITE     HTMLFILE;PTFMIDI;
          GOTO      GLIN9999
.
GLIN0510  PACK      KEY5,SP10
          CALL      RSFMDS1
GLIN0520  CALL      RKFMDS1
          BRANCH    OVRCD,GLIN9999
          MATCH     FMDSCODE,PTFMIDI
          IF        @EQUAL
            WRITE     HTMLFILE;"<option value=#"",FMDSCODE,"#" selected> ":
                               FMDSDESC,"</option>"
          ELSE
            WRITE     HTMLFILE;"<option value=#"",FMDSCODE,"#"> ":
                               FMDSDESC,"</option>"
          ENDIF
          GOTO      GLIN0520
.
.   Fees Invoiced Responsibility Selection List
.
GLIN0600  UNPACK    DIM127,D1,KEY1,DIM127
          MOVE      ZERO,F1
          MOVE      KEY1,F1
          BRANCH    F1,GLIN0610
          WRITE     HTMLFILE;PTFMIRE;
          GOTO      GLIN9999
.
GLIN0610  PACK      KEY4,SP70
          CALL      RSFMRS1
GLIN0620  CALL      RKFMRS1
          BRANCH    OVRCD,GLIN9999
.
          MATCH     FMRSCODE,PTFMIRE
          IF        @EQUAL
            WRITE     HTMLFILE;"<option value=",FMRSCODE," selected>":
                               FMRSDESC,"</option>"
          ELSE
            WRITE     HTMLFILE;"<option value=",FMRSCODE,">":
                               FMRSDESC,"</option>"
          ENDIF
          GOTO      GLIN0620
.
.   Fees Invoiced Ledger Selection List
.
GLIN0700  UNPACK    DIM127,D1,KEY1,DIM127
          MOVE      ZERO,F1
          MOVE      KEY1,F1
          BRANCH    F1,GLIN0710
          WRITE     HTMLFILE;PTFMILD;
          GOTO      GLIN9999
.
GLIN0710  PACK      KEY2,SP70
          CALL      RSFMLA1
GLIN0720  CALL      RKFMLA1
          BRANCH    OVRCD,GLIN9999
.
          MATCH     FMLALEDG,PTFMILD
          IF        @EQUAL
            WRITE     HTMLFILE;"<option value=",FMLALEDG," selected>":
                               FMLADESC,"</option>"
          ELSE
            WRITE     HTMLFILE;"<option value=",FMLALEDG,">":
                               FMLADESC,"</option>"
          ENDIF
          GOTO      GLIN0720
.
.   Fees Invoiced Credit Account/Income Account
.
GLIN0800  UNPACK    DIM127,D1,KEY1,DIM127
          MOVE      ZERO,F1
          MOVE      KEY1,F1
.
          MATCH     PTFMICA,SP20
          GOTO      GLIN9999 IF EQUAL
.
          IF        F1=0
            WRITE     HTMLFILE;PTFMICA;  * Credit account
          ELSE
            PACK      KEY14,PTFMILD,PTFMICA,SP70
            CALL      RDFMAM1
            IF        OVRCD=0
              WRITE     HTMLFILE;FMAMDESC;  * Credit account
            ENDIF
          ENDIF
          GOTO      GLIN9999
.
.   Fees Invoiced Debit Account/Debtors Control Account
.
GLIN0900  UNPACK    DIM127,D1,KEY1,DIM127
          MOVE      ZERO,F1
          MOVE      KEY1,F1
.
          CALL      GACC0000
          MATCH     PTFMIDA,SP20
          GOTO      GLIN9999 IF EQUAL
.
          IF        F1=0
            WRITE     HTMLFILE;PTFMIDA;  * Debtor account
          ELSE
            PACK      KEY14,PTFMILD,PTFMIDA,SP70
            CALL      RDFMAM1
            IF        OVRCD=0
              WRITE     HTMLFILE;FMAMDESC;  * Debtor account
            ENDIF
          ENDIF
          GOTO      GLIN9999
.
.   Fees Invoiced GST Control Account
.
GLIN1000  UNPACK    DIM127,D1,KEY1,DIM127
          MOVE      ZERO,F1
          MOVE      KEY1,F1
.
          CALL      GACC0000
          MATCH     PTFMIGS,SP20
          GOTO      GLIN9999 IF EQUAL
.
          IF        F1=0
            WRITE     HTMLFILE;PTFMIGS;
          ELSE
            PACK      KEY14,PTFMILD,PTFMIGS,SP70
            CALL      RDFMAM1
            IF        OVRCD=0
              WRITE     HTMLFILE;FMAMDESC;  * Debtor account
            ENDIF   
          ENDIF
          GOTO      GLIN9999
.
.   Fees Invoiced BAS Code
.
GLIN1100  UNPACK    DIM127,D1,KEY1,DIM127
          MOVE      ZERO,F1
          MOVE      KEY1,F1

          COMPARE   ONE,IBCNUBAS
          GOTO      GLIN9999 IF NOT EQUAL
.
          BRANCH    F1,GLIN1110
          WRITE     HTMLFILE;PTFMBASC;
          GOTO      GLIN9999
.
GLIN1110  PACK      KEY3,SP70
          CALL      RSIBBA1
GLIN1120  CALL      RKIBBA1
          BRANCH    OVRCD,GLIN9999
          COMPARE   IBBAACTV,ONE                 *List only active bas codes
          GOTO      GLIN1120 IF EQUAL
.
          PACK      KEY5,QUOTE,IBBABASC,QUOTE
          MATCH     IBBABASC,PTFMBASC
          IF        @EQUAL
            WRITE     HTMLFILE;"<option value=",KEY5,"selected>",IBBADESC:
                               "</option>";
          ELSE
            WRITE     HTMLFILE;"<option value=",KEY5,">",IBBADESC:
                               "</option>";
          ENDIF
          GOTO      GLIN1120
.
.   Fees to be Invoiced Dissection Selection List
.
GLIN1200  UNPACK    DIM127,D1,KEY1,DIM127
          MOVE      ZERO,F1
          MOVE      KEY1,F1
          BRANCH    F1,GLIN1210
          WRITE     HTMLFILE;PTFMTDI;
          GOTO      GLIN9999
.
GLIN1210  PACK      KEY5,SP10
          CALL      RSFMDS1
GLIN1220  CALL      RKFMDS1
          BRANCH    OVRCD,GLIN9999
          MATCH     FMDSCODE,PTFMTDI
          IF        @EQUAL
            WRITE     HTMLFILE;"<option value=#"",FMDSCODE,"#" selected> ":
                               FMDSDESC,"</option>"
          ELSE
            WRITE     HTMLFILE;"<option value=#"",FMDSCODE,"#"> ":
                               FMDSDESC,"</option>"
          ENDIF
          GOTO      GLIN1220
.
.   Fees to be Invoiced Responsibility Selection List
.
GLIN1300  UNPACK    DIM127,D1,KEY1,DIM127
          MOVE      ZERO,F1
          MOVE      KEY1,F1
          BRANCH    F1,GLIN1310
          WRITE     HTMLFILE;PTFMTRE;
          GOTO      GLIN9999
.
GLIN1310  PACK      KEY4,SP70
          CALL      RSFMRS1
GLIN1320  CALL      RKFMRS1
          BRANCH    OVRCD,GLIN9999
.
          MATCH     FMRSCODE,PTFMTRE
          IF        @EQUAL
            WRITE     HTMLFILE;"<option value=",FMRSCODE," selected>":
                               FMRSDESC,"</option>"
          ELSE
            WRITE     HTMLFILE;"<option value=",FMRSCODE,">":
                               FMRSDESC,"</option>"
          ENDIF
          GOTO      GLIN1320
.
.   Fees to be Invoiced Ledger Selection List
.
GLIN1400  UNPACK    DIM127,D1,KEY1,DIM127
          MOVE      ZERO,F1
          MOVE      KEY1,F1
          BRANCH    F1,GLIN1410
          WRITE     HTMLFILE;PTFMTLD;
          GOTO      GLIN9999
.
GLIN1410  PACK      KEY2,SP70
          CALL      RSFMLA1
GLIN1420  CALL      RKFMLA1
          BRANCH    OVRCD,GLIN9999
.
          MATCH     FMLALEDG,PTFMTLD
          IF        @EQUAL
            WRITE     HTMLFILE;"<option value=",FMLALEDG," selected>":
                               FMLADESC,"</option>"
          ELSE
            WRITE     HTMLFILE;"<option value=",FMLALEDG,">":
                               FMLADESC,"</option>"
          ENDIF
          GOTO      GLIN1420
.
.   Fees to be Invoiced Credit Account
.
GLIN1500  UNPACK    DIM127,D1,KEY1,DIM127
          MOVE      ZERO,F1
          MOVE      KEY1,F1
.
          MATCH     PTFMTCA,SP20
          GOTO      GLIN9999 IF EQUAL
.
          IF        F1=0
            WRITE     HTMLFILE;PTFMTCA;  * Credit account
          ELSE
            PACK      KEY14,PTFMTLD,PTFMTCA
            CALL      RDFMAM1
            IF        OVRCD=0
              WRITE     HTMLFILE;FMAMDESC;  * Credit account
            ENDIF
          ENDIF
          GOTO      GLIN9999
.
.   Fees to be Invoiced Debit Account
.
GLIN1600  UNPACK    DIM127,D1,KEY1,DIM127
          MOVE      ZERO,F1
          MOVE      KEY1,F1
.
          MATCH     PTFMTDA,SP20
          GOTO      GLIN9999 IF EQUAL
.
          IF        F1=0
            WRITE     HTMLFILE;PTFMTDA;
          ELSE
            PACK      KEY14,PTFMTLD,PTFMTDA
            CALL      RDFMAM1
            IF        OVRCD=0
              WRITE     HTMLFILE;FMAMDESC;  * Credit account
            ENDIF
          ENDIF
          GOTO      GLIN9999
.
GLIN1700  MOVE      CODEA,CATEGORY            * Admission Type
          MOVE      ADMISSTP,CODE
          CALL      CODITM00
          GOTO      GLIN9999
.
GLIN1800  MOVE      CODECL,CATEGORY            * Claim Code    
          MOVE      CLAIMCOD,CODE
          CALL      CODITM00
          GOTO      GLIN9999
.
GLIN1900  PACK      DFLTWARD,ACCMWARD
          CALL      WARDSL00
          GOTO      GLIN9999
.
GLIN2000  MOVE      CODEJ,CATEGORY            * Journal Code  
          MOVE      JOURNALC,CODE
          CALL      CODITM00
          GOTO      GLIN9999
.
GLIN2100  WRITE     HTMLFILE;CACCFEE;
          GOTO      GLIN9999
.
GLIN2200  WRITE     HTMLFILE;IBCNUGST;
          GOTO      GLIN9999
.
GLIN2300  WRITE     HTMLFILE;IBCNUBAS;
          GOTO      GLIN9999
.
GLIN2400  WRITE     HTMLFILE;GLINT001;
          GOTO      GLIN9999
.
GLIN2500  WRITE     HTMLFILE;GLINT002;
          GOTO      GLIN9999
.
GLIN2600  MATCH     "1",NEWRECRD                    
          GOTO      GLIN2610 IF EQUAL
.
          WRITE     HTMLFILE;ZERO;            * record found
          GOTO      GLIN9999
.
GLIN2610  WRITE     HTMLFILE;ONE;             * record not found
          GOTO      GLIN9999
.
GLIN2700  CALL      DISACC00
          GOTO      GLIN9999
.
GLIN2800  CALL      NXTACC00
          GOTO      GLIN9999
.
GLIN2900  CALL      PRVACC00
          GOTO      GLIN9999
.
GLIN3000  WRITE     HTMLFILE;SUBSECTN;
          GOTO      GLIN9999
.
GLIN3100  WRITE     HTMLFILE;PTCNMFEE;
          GOTO      GLIN9999
.
GLIN3200  MOVE      CODEFI,CATEGORY            * Group Code  
          MOVE      GROUPCOD,CODE
          CALL      CODITM00
          GOTO      GLIN9999
.
GLIN3300  MATCH     "5",GLINT001              
          GOTO      GLIN9999 IF NOT EQUAL
          MATCH     "2",SUBSECTN              * journal codes          
          GOTO      GLIN9999 IF NOT EQUAL
          MATCH     "1",NEWRECRD              * record does not exist
          GOTO      GLIN3390 IF EQUAL
.
          IF        PTCNJFEE=1
            UNPACK    GLINT002,CLAIMCOD,JOURNALC,KEY11
          ELSE
            UNPACK    GLINT002,JOURNALC,KEY11
          ENDIF
          MATCH     JOURNALC,SP2
          GOTO      GLIN3390 IF EQUAL
.
          PACK      KEY5,CODEJ,JOURNALC,SP10
          CALL      RDCODE1
          BRANCH    OVRCD,GLIN3390
          CMATCH    ANSG,THCSCOD
          GOTO      GLIN3390 IF NOT EQUAL
          WRITE     HTMLFILE;ONE;
          GOTO      GLIN9999
.
GLIN3390  WRITE     HTMLFILE;ZERO;
          GOTO      GLIN9999
.
GLIN3400  MATCH     "1",GLINT001              * Accommodation
          GOTO      GLIN9999 IF NOT EQUAL
          MATCH     "2",SUBSECTN              * non-casemix            
          GOTO      GLIN3410 IF NOT EQUAL
          CMATCH    "A",GLINT002              
          GOTO      GLIN9999 IF NOT EQUAL
          MATCH     "1",NEWRECRD              * record does not exist
          GOTO      GLIN9999 IF EQUAL
.
.         Non-casemix
.
          BRANCH    CACCFEE,GLIN3490:         * ward/claim
                            GLIN3490:         * ward/adm type
                            GLIN3490:         * ward/claim/adm type
                            GLIN3490:         * ward/adm type/claim
                            GLIN9999          * claim type
.
          GOTO      GLIN9999                  * adm type
.          
GLIN3410  IF        CACCFEE=4
            CALL      LSAD0000                  * Lumpsum adm.type
            BRANCH    EXIT,GLIN9999
          ENDIF
.
          MATCH     "4",SUBSECTN              * Casemix daily charge
          GOTO      GLIN9999 IF NOT EQUAL
.
          CMATCH    "D",GLINT002              
          GOTO      GLIN9999 IF NOT EQUAL
          MATCH     "1",NEWRECRD              * record does not exist
          GOTO      GLIN9999 IF EQUAL
.
          IF        CACCFEE=4 | CACCFEE=5
            UNPACK    GLINT002,DIM1,CLAIMCOD,KEY9
            IF        CACCFEE=4
              UNPACK    GLINT002,DIM1,ACCMWARD,CLAIMCOD,KEY9
            ENDIF
            MATCH     CLAIMCOD,SP3
            IF        @EQUAL
              MOVE      "All Claim Types",TDESC
            ELSE
              PACK      KEY5,CODECL,CLAIMCOD,SP10
              CALL      RDCODE1
              IF        OVRCD=1
                PACK      TDESC,INVALIDS,CLAIMCOD,INVALIDE,SP70
              ENDIF
            ENDIF
            WRITE     HTMLFILE;TDESC;
            GOTO      GLIN9999
          ENDIF
.
GLIN3490  UNPACK    GLINT002,DIM1,ACCMWARD,KEY9
          MATCH     ACCMWARD,SP3
          IF        @EQUAL
            MOVE      "All Wards",WBDESC
          ELSE
            PACK      KEY6,ACCMWARD,SP70
            CALL      RDWARD1
            IF        OVRCD=1
              PACK      WBDESC,INVALIDS,ACCMWARD,INVALIDE,SP70
            ENDIF
          ENDIF
          WRITE     HTMLFILE;WBDESC;
          GOTO      GLIN9999
.
GLIN3500  MATCH     "1",GLINT001              * Accommodation
          GOTO      GLIN9999 IF NOT EQUAL
          MATCH     "2",SUBSECTN              * non-casemix ?
          GOTO      GLIN3530 IF NOT EQUAL
          CMATCH    "A",GLINT002              
          GOTO      GLIN9999 IF NOT EQUAL
          MATCH     "1",NEWRECRD              * record does not exist
          GOTO      GLIN9999 IF EQUAL
          BRANCH    CACCFEE,GLIN3502:         * ward/claim
                            GLIN3504:         * ward/adm.type
                            GLIN3510:         * ward/claim/adm.type
                            GLIN3520:         * ward/adm.type/claim
                            GLIN3522          * claim type
.
          UNPACK    GLINT002,DIM1,ADMISSTP,KEY9
          GOTO      GLIN3590                  * adm type
.
GLIN3502  UNPACK    GLINT002,DIM1,ACCMWARD,CLAIMCOD
          GOTO      GLIN3590                  * claim/adm type
.
GLIN3504  UNPACK    GLINT002,DIM1,ACCMWARD,ADMISSTP
          GOTO      GLIN3590                  * claim/adm type
.          
GLIN3510  UNPACK    GLINT002,DIM1,ACCMWARD,CLAIMCOD,ADMISSTP
          GOTO      GLIN3590                  * claim/adm type
.          
GLIN3520  UNPACK    GLINT002,DIM1,ACCMWARD,ADMISSTP,CLAIMCOD
          GOTO      GLIN3590                  * claim/adm type
.
GLIN3522  UNPACK    GLINT002,DIM1,CLAIMCOD,KEY9
          GOTO      GLIN3531                  * claim type
.
GLIN3530  IF        CACCFEE=4
            CALL      DAWR0000                * Daily charge Ward
            BRANCH    EXIT,GLIN9999
          ENDIF
.
          MATCH     "3",SUBSECTN              * Casemix lumpsum
          GOTO      GLIN9999 IF NOT EQUAL
          CMATCH    "C",GLINT002              
          GOTO      GLIN9999 IF NOT EQUAL
          MATCH     "1",NEWRECRD              * record does not exist
          GOTO      GLIN9999 IF EQUAL
.
          IF        CACCFEE=5
              UNPACK    GLINT002,DIM1,EPISODTP,CLAIMCOD,KEY8
          ELSE
            IF        CACCFEE=4
              UNPACK    GLINT002,DIM1,EPISODTP,ADMISSTP,CLAIMCOD,KEY8
            ELSE
              GOTO      GLIN3532
            ENDIF
          ENDIF
.
GLIN3531  MATCH     SP3,CLAIMCOD
          IF        @EQUAL
            MOVE      "All Claim Types",TDESC
          ELSE
            PACK      KEY5,CODECL,CLAIMCOD,SP10
            CALL      RDCODE1
            IF        OVRCD=1
              PACK      TDESC,INVALIDS,CLAIMCOD,INVALIDE,SP70
            ENDIF
          ENDIF
          WRITE     HTMLFILE;TDESC;
          GOTO      GLIN9999
.
GLIN3532  UNPACK    GLINT002,DIM1,EPISODTP,ADMISSTP,KEY8
          GOTO      GLIN3590                  
.
GLIN3590  MATCH     SP3,ADMISSTP
          IF        @EQUAL
            MOVE      "All Admission Types",TDESC
          ELSE
            PACK      KEY5,CODEA,ADMISSTP,SP10
            CALL      RDCODE1
            IF        OVRCD=1
              PACK      TDESC,INVALIDS,ADMISSTP,INVALIDE,SP70
            ENDIF
          ENDIF
          WRITE     HTMLFILE;TDESC;
          GOTO      GLIN9999
.
GLIN3600  MATCH     "1",GLINT001              * Accommodation
          GOTO      GLIN3642 IF NOT EQUAL
          MATCH     "2",SUBSECTN              * non-casemix            
          GOTO      GLIN9999 IF NOT EQUAL
          CMATCH    "A",GLINT002              
          GOTO      GLIN9999 IF NOT EQUAL
          MATCH     "1",NEWRECRD              * record does not exist
          GOTO      GLIN9999 IF EQUAL
          BRANCH    CACCFEE,GLIN3610:         * ward/claim
                            GLIN3620:         * ward/adm.type
                            GLIN3630:         * ward/claim/adm.type
                            GLIN3640:         * ward/adm type/claim
                            GLIN3641          * claim
          GOTO      GLIN9999                  * adm type
.          
GLIN3610  UNPACK    GLINT002,DIM1,ACCMWARD,CLAIMCOD
          GOTO      GLIN3690                  * ward/claim
.          
GLIN3620  UNPACK    GLINT002,DIM1,ACCMWARD,ADMISSTP
          GOTO      GLIN3690                  * ward/claim/daycase
.
GLIN3630  UNPACK    GLINT002,DIM1,ACCMWARD,CLAIMCOD,ADMISSTP
          GOTO      GLIN3690                  * claim/adm type
.
GLIN3640  UNPACK    GLINT002,DIM1,ACCMWARD,ADMISSTP,CLAIMCOD
          GOTO      GLIN3690                  * ward/adm type/claim
.
GLIN3641  UNPACK    GLINT002,DIM1,CLAIMCOD
          GOTO      GLIN3690                  * claim
.
GLIN3642  MATCH     "2",GLINT001              * Theatre
          GOTO      GLIN3650 IF NOT EQUAL
.
          MATCH     "2",SUBSECTN              * Journal Codes
          GOTO      GLIN9999 IF NOT EQUAL
          CMATCH    "F",GLINT002              
          GOTO      GLIN9999 IF NOT EQUAL
          MATCH     "1",NEWRECRD              * record does not exist
          GOTO      GLIN9999 IF EQUAL
.
          UNPACK    GLINT002,DIM1,SESSTYPE
          MATCH     SP3,SESSTYPE
          GOTO      GLIN9999 IF EQUAL
          PACK      KEY5,CODETU,SESSTYPE,SP10
          CALL      RDCODE1
          IF        OVRCD=1
            PACK      TDESC,INVALIDS,SESSTYPE,INVALIDE,SP70
          ENDIF
          WRITE     HTMLFILE;TDESC;
          GOTO      GLIN9999
.
GLIN3650  MATCH     "3",GLINT001              * Misc Item    
          GOTO      GLIN3670 IF NOT EQUAL
          MATCH     "3",SUBSECTN              * Item/claim code
          GOTO      GLIN3660 IF NOT EQUAL
          CMATCH    "M",GLINT002              
          GOTO      GLIN9999 IF NOT EQUAL
          MATCH     "1",NEWRECRD              * record does not exist
          GOTO      GLIN9999 IF EQUAL
          COMPARE   ONE,PTCNMFEE
          GOTO      GLIN9999 IF NOT EQUAL
.
          UNPACK    GLINT002,DIM1,CLAIMCOD,KEY9
          GOTO      GLIN3690                  
.
GLIN3660  MATCH     "5",SUBSECTN              * Casemix Item/claim code
          GOTO      GLIN9999 IF NOT EQUAL
          CMATCH    "T",GLINT002              
          GOTO      GLIN9999 IF NOT EQUAL
          MATCH     "1",NEWRECRD              * record does not exist
          GOTO      GLIN9999 IF EQUAL
          COMPARE   ONE,PTCNMFEE
          GOTO      GLIN9999 IF NOT EQUAL
.
          UNPACK    GLINT002,DIM1,EPISODTP,CLAIMCOD,KEY8
          GOTO      GLIN3690                  
.
GLIN3670  MATCH     "5",GLINT001              * Journal      
          GOTO      GLIN9999 IF NOT EQUAL
          MATCH     "2",SUBSECTN              * Journal Codes  
          GOTO      GLIN9999 IF NOT EQUAL
          MATCH     "1",NEWRECRD              * record does not exist
          GOTO      GLIN9999 IF EQUAL
          COMPARE   ONE,PTCNJFEE
          GOTO      GLIN9999 IF NOT EQUAL
.
          UNPACK    GLINT002,CLAIMCOD,JOURNALC
          GOTO      GLIN3690                  
.
GLIN3690  MATCH     SP3,CLAIMCOD
          IF        @EQUAL
            MOVE      "All Claim Codes",TDESC
          ELSE
            PACK      KEY5,CODECL,CLAIMCOD,SP10
            CALL      RDCODE1
            IF        OVRCD=1
              PACK      TDESC,INVALIDS,CLAIMCOD,INVALIDE,SP70
            ENDIF
          ENDIF
          WRITE     HTMLFILE;TDESC;
          GOTO      GLIN9999
.
GLIN3700  MATCH     "5",GLINT001              * Journal
          GOTO      GLIN9999 IF NOT EQUAL
          MATCH     "2",SUBSECTN              * Journal codes            
          GOTO      GLIN9999 IF NOT EQUAL
          MATCH     "1",NEWRECRD              * record does not exist
          GOTO      GLIN9999 IF EQUAL
.
          IF        PTCNJFEE=1
            UNPACK    GLINT002,CLAIMCOD,JOURNALC,KEY10
          ELSE
            UNPACK    GLINT002,JOURNALC,KEY10
          ENDIF
          MATCH     SP3,JOURNALC
          GOTO      GLIN9999 IF EQUAL
          PACK      KEY5,CODEJ,JOURNALC,SP10
          CALL      RDCODE1
          IF        OVRCD=1
            PACK      TDESC,INVALIDS,JOURNALC,INVALIDE,SP70
          ENDIF
          WRITE     HTMLFILE;TDESC;
          GOTO      GLIN9999
.
GLIN3800  MATCH     "3",GLINT001              * Misc Item    
          GOTO      GLIN9999 IF NOT EQUAL
          MATCH     "2",SUBSECTN              * Group code
          GOTO      GLIN3802 IF NOT EQUAL
          CMATCH    "M",GLINT002              
          GOTO      GLIN9999 IF NOT EQUAL
          GOTO      GLIN3804
.
GLIN3802  IF        PTCNMFEE=1
            MATCH     "3",SUBSECTN            * Claim code ?
            GOTO      GLIN3804 IF EQUAL
          ENDIF
          GOTO      GLIN3810
.
GLIN3804  MATCH     "1",NEWRECRD              * record does not exist
          GOTO      GLIN9999 IF EQUAL
          IF        PTCNMFEE=ONE
            UNPACK    GLINT002,DIM1,KEY3,GROUPCOD,KEY9
          ELSE
            UNPACK    GLINT002,DIM1,GROUPCOD,KEY9
          ENDIF
          GOTO      GLIN3890                  
.
GLIN3810  MATCH     "4",SUBSECTN              * Casemix group code
          GOTO      GLIN3820 IF EQUAL
          IF        PTCNMFEE=1
            MATCH     "5",SUBSECTN
            GOTO      GLIN3820 IF EQUAL       * Claim code Casemix
          ENDIF
          GOTO      GLIN9999
.
GLIN3820  CMATCH    "T",GLINT002              
          GOTO      GLIN9999 IF NOT EQUAL
          MATCH     "1",NEWRECRD              * record does not exist
          GOTO      GLIN9999 IF EQUAL
          IF        PTCNMFEE=ONE
            UNPACK    GLINT002,DIM1,EPISODTP,KEY3,GROUPCOD,KEY5
          ELSE
            UNPACK    GLINT002,DIM1,EPISODTP,GROUPCOD,KEY8
          ENDIF
          GOTO      GLIN3890                  
.
GLIN3890  MATCH     GROUPCOD,SP3
          IF        @EQUAL
            MOVE      "All Item Groups",TDESC
          ELSE
            PACK      KEY5,CODEFI,GROUPCOD,SP10
            CALL      RDCODE1
            IF        OVRCD=1
              PACK      TDESC,INVALIDS,GROUPCOD,INVALIDE,SP70
            ENDIF
          ENDIF
.
          WRITE     HTMLFILE;TDESC;
          GOTO      GLIN9999
.
GLIN3900  MATCH     "3",GLINT001              * Misc Item    
          GOTO      GLIN9999 IF NOT EQUAL
          MATCH     "3",SUBSECTN              * Item/claim code
          GOTO      GLIN3910 IF NOT EQUAL
          CMATCH    "M",GLINT002              
          GOTO      GLIN9999 IF NOT EQUAL
          MATCH     "1",NEWRECRD              * record does not exist
          GOTO      GLIN9999 IF EQUAL
          COMPARE   ONE,PTCNMFEE
          GOTO      GLIN9999 IF EQUAL
.
          UNPACK    GLINT002,DIM1,KEY3,ITEMCODE
          GOTO      GLIN3990                  
.
GLIN3910  MATCH     "5",SUBSECTN              * Casemix Item/claim code
          GOTO      GLIN9999 IF NOT EQUAL
          CMATCH    "T",GLINT002              
          GOTO      GLIN9999 IF NOT EQUAL
          MATCH     "1",NEWRECRD              * record does not exist
          GOTO      GLIN9999 IF EQUAL
          COMPARE   ONE,PTCNMFEE
          GOTO      GLIN9999 IF EQUAL
.
          UNPACK    GLINT002,DIM1,EPISODTP,KEY3,ITEMCODE
          GOTO      GLIN3990                  
.
GLIN3990  MATCH     SP9,ITEMCODE
          IF        @EQUAL
            MOVE      "All Item Codes",IDESC
            GOTO      GLIN3999
          ENDIF
.
          PACK      ITEMCODE,ITEMCODE,SP70
          PACK      KEY17,ITEMCODE,CURRDATE,SP10
          CALL      PATITMRD
          COMPARE   ZERO,OVRCD
          GOTO      GLIN3999 IF EQUAL
.
          IF        IBCNMHOS=1
            MOVE      SP10,KEY3
            CALL      RSPTHSP1
            CALL      RKPTHSP1
            BRANCH    OVRCD,GLIN9999
            PACK      KEY29,PTHSDCLM,SP6,SP3,ITEMCODE,CURRDATE,SP10
          ELSE
            PACK      KEY29,PTCNDCLM,SP6,SP3,ITEMCODE,CURRDATE,SP10
          ENDIF
.
GLIN3992  COMPARE   FIVE,CFEETYP
          GOTO      GLIN3994 IF EQUAL       * Use SX Misc.item
.
          CALL      PATMCHRD                * read Misc.Charges file
          COMPARE   ZERO,EXIT
          GOTO      GLIN3998 IF EQUAL
.
          IF        IBCNMHOS=1
            CALL      RKPTHSP1
            BRANCH    OVRCD,GLIN9999
            PACK      KEY29,PTHSDCLM,SP6,SP3,ITEMCODE,CURRDATE,SP10
            GOTO      GLIN3992
          ENDIF
.
          GOTO      GLIN9999
.
GLIN3994  CALL      GMSC0000                 * SX Misc.item
          BRANCH    EXIT,GLIN9999
          PACK      MDESC,NZMCDESC,SP70
.
GLIN3998  MOVE      MDESC,IDESC

GLIN3999  WRITE     HTMLFILE;IDESC;
          GOTO      GLIN9999
.
GLIN4000  WRITE     HTMLFILE;PTCNUFMS;
          GOTO      GLIN9999
.
GLIN4100  WRITE     HTMLFILE;PTCNJFEE;
          GOTO      GLIN9999
.
GLIN4200  IF        IBCNMHOS<>1
            MOVE      SP70,GLINT015
          ENDIF
          WRITE     HTMLFILE;GLINT015;
          GOTO      GLIN9999
.
GLIN4300  CALL      HSLI0000
          GOTO      GLIN9999
.
GLIN4400  COMPARE   ONE,IBCNMHOS
          GOTO      GLIN9999 IF NOT EQUAL
.
          PACK      KEY10,USERID,SP70
          CALL      RDWBSE1
          BRANCH    OVRCD,GLIN9999
          WRITE     HTMLFILE;WBSEHOSP;
          GOTO      GLIN9999
.
GLIN4500  WRITE     HTMLFILE;HOSPCODE;
          GOTO      GLIN9999
.
GLIN4600  MOVE      CODETU,CATEGORY            * Session Type
          MOVE      SESSTYPE,CODE
          CALL      CODITM00
          GOTO      GLIN9999
.
GLIN4700  MATCH     "2",GLINT001              * Theatre
          GOTO      GLIN9999 IF NOT EQUAL
          MATCH     "2",SUBSECTN              * Session type
          GOTO      GLIN9999 IF NOT EQUAL
          CMATCH    "F",GLINT002
          GOTO      GLIN9999 IF NOT EQUAL
          MATCH     "1",NEWRECRD              * record does not exist
          GOTO      GLIN9999 IF EQUAL
          UNPACK    GLINT002,DIM1,SESSTYPE
.
          MATCH     SESSTYPE,SP3
          GOTO      GLIN9999 IF EQUAL
          PACK      KEY5,CODETU,SESSTYPE,SP10
          CALL      RDCODE1
          IF        OVRCD=1
            PACK      TDESC,INVALIDS,SESSTYPE,INVALIDE,SP70
          ENDIF
          WRITE     HTMLFILE;TDESC;
          GOTO      GLIN9999
.
GLIN4800  WRITE     HTMLFILE;PTCNGJRN;
          GOTO      GLIN9999
.
GLIN4900  PACK      DFLTWARD,KEYNWARD
          CALL      WARDSL00
          GOTO      GLIN9999
.
GLIN9999  RETURN 
+
.------------------------------------------------------------------------------
.         CACCFEE = 4 to Display Lumpsum Admission type
.------------------------------------------------------------------------------
LSAD0000  MOVE      ZERO,EXIT
          MATCH     "3",SUBSECTN
          GOTO      LSAD9999 IF NOT EQUAL
          CMATCH    "C",GLINT002
          GOTO      LSAD9999 IF NOT EQUAL
          MATCH     "1",NEWRECRD              * record does not exist
          GOTO      LSAD9999 IF EQUAL
.
          UNPACK    GLINT002,DIM1,EPISODTP,ADMISSTP,CLAIMCOD,KEY8
          MATCH     SP70,ADMISSTP
          IF        @EQUAL
            MOVE      "All Admission Types",TDESC
          ELSE
            PACK      KEY5,CODEA,ADMISSTP,SP10
            CALL      RDCODE1
            IF        OVRCD=1
              PACK      TDESC,INVALIDS,ADMISSTP,INVALIDE,SP70
            ENDIF
          ENDIF
          WRITE     HTMLFILE;TDESC;
          MOVE      ONE,EXIT
LSAD9999  RETURN
+
.------------------------------------------------------------------------------
.         CACCFEE = 4 to Display Daily charge Ward
.------------------------------------------------------------------------------
DAWR0000  MOVE      ZERO,EXIT
          MATCH     "4",SUBSECTN
          GOTO      DAWR9999 IF NOT EQUAL
          CMATCH    "D",GLINT002              
          GOTO      DAWR9999 IF NOT EQUAL
          MATCH     "1",NEWRECRD              * record does not exist
          GOTO      DAWR9999 IF EQUAL
.
          UNPACK    GLINT002,DIM1,ACCMWARD,CLAIMCOD,KEY8
          MATCH     SP70,ACCMWARD
          IF        @EQUAL
            MOVE      "All Wards",WBDESC
          ELSE
            PACK      KEY6,ACCMWARD,SP70
            CALL      RDWARD1
            IF        OVRCD=1
              PACK      WBDESC,INVALIDS,ACCMWARD,INVALIDE,SP70
            ENDIF
          ENDIF
          WRITE     HTMLFILE;WBDESC;
          MOVE      ONE,EXIT
DAWR9999  RETURN
+
.------------------------------------------------------------------------------
. SGLN0000 - System based General Ledger Inferface Maintenance
.------------------------------------------------------------------------------
.
SGLN0000  BRANCH    FLDITMNO,SGLN0100,SGLN0200,SGLN0300,SGLN0400,SGLN0500:
                             SGLN0600,SGLN0700,SGLN0800,SGLN0900,SGLN1000:
                             SGLN1100,SGLN1200,SGLN1300,SGLN1400,SGLN1500:
                             SGLN1600,SGLN1700,SGLN1800,SGLN1900,SGLN2000:
                             SGLN2100,SGLN2200,SGLN2300,SGLN2400,SGLN2500:
                             SGLN2600,SGLN2700,SGLN2800,SGLN2900,SGLN3000:
                             SGLN3100,SGLN3200,SGLN3300,SGLN3400,SGLN3500:
                             SGLN3600,SGLN3700,SGLN3800,SGLN3900
.
          GOTO      SGLN9999
.
.   Accommodation Interface Sub-Section Selection List
.
SGLN0100  WRITE     HTMLFILE;"<option value=1>Defaults</option>";
          MOVE      CACCFEE0,KEY25
          LOAD      KEY25,CACCFEE,CACCFEE1:    * Ward/Claim
                                  CACCFEE2:    * Ward/Adm.type
                                  CACCFEE3:    * Ward/Claim/Adm.type
                                  CACCFEE4:    * Ward/Adm.type/Claim
                                  CACCFEE5     * Claim type
          WRITE     HTMLFILE;"<option value=2>",KEY25,"</option>"
          WRITE     HTMLFILE;"<option value=3>Lumpsum (Casemix)</option>"
          WRITE     HTMLFILE;"<option value=4>Daily Charge (Casemix)</option>"
          WRITE     HTMLFILE;"<option value=5>Government Subsidy</option>"
          GOTO      SGLN9999
.
.   Misc Item Interface Sub-Section Selection List
.
SGLN0200  WRITE     HTMLFILE;"<option value=1>Defaults</option>"
          WRITE     HTMLFILE;"<option value=2>Group Codes</option>"
.
          IF        PTCNMFEE=0
            WRITE     HTMLFILE;"<option value=3>Item Codes</option>"
          ELSE
            WRITE     HTMLFILE;"<option value=3>Claim Codes</option>"
          ENDIF
.
          WRITE     HTMLFILE;"<option value=4>Group Codes (Casemix)</option>"
.
          IF        PTCNMFEE=0
            WRITE     HTMLFILE;"<option value=5>Item Codes (Casemix)</option>"
          ELSE
            WRITE     HTMLFILE;"<option value=5>Claim Codes (Casemix)</option>"
          ENDIF
.
          GOTO      SGLN9999
.
.   Report Sub Section - Accommodation/Misc Items/Journals
.
SGLN0300  WRITE     HTMLFILE;PMFMRSUB;
          GOTO      SGLN9999
.
.   Report Sub Section Code
.
SGLN0400  WRITE     HTMLFILE;PMFMCODE;
          GOTO      SGLN9999
.
SGLN0500  WRITE     HTMLFILE;SYSGL001;
          GOTO      SGLN9999
.
SGLN0600  WRITE     HTMLFILE;SYSGL002;
          GOTO      SGLN9999
.
SGLN0700  IF        IBCNMHOS<>1
            MOVE      SP70,SYSGL015
          ENDIF
          WRITE     HTMLFILE;SYSGL015;
          GOTO      SGLN9999
.
SGLN0800  WRITE     HTMLFILE;PTCNUFMS;
          GOTO      SGLN9999
.
SGLN0900  COMPARE   ONE,IBCNMHOS
          GOTO      SGLN9999 IF NOT EQUAL
.
          PACK      KEY10,USERID,SP70
          CALL      RDWBSE1
          BRANCH    OVRCD,SGLN9999
          WRITE     HTMLFILE;WBSEHOSP;
          GOTO      SGLN9999
.
SGLN1000  CALL      SGLLST00                  * System Based G/L Int.List
          GOTO      SGLN9999
.
SGLN1100  CALL      NXTSAC00
          GOTO      SGLN9999
.
SGLN1200  CALL      PRVSAC00
          GOTO      SGLN9999
.
SGLN1300  WRITE     HTMLFILE;SUBSECTN;
          GOTO      SGLN9999
.
SGLN1400  CALL      HSLI0000
          GOTO      SGLN9999
.
SGLN1500  WRITE     HTMLFILE;CACCFEE;
          GOTO      SGLN9999
.
SGLN1600  WRITE     HTMLFILE;IBCNUGST;
          GOTO      SGLN9999
.
SGLN1700  WRITE     HTMLFILE;SYSGL016;
          GOTO      SGLN9999
.
SGLN1800  MATCH     "1",NEWRECRD
          GOTO      SGLN1810 IF EQUAL
.
          WRITE     HTMLFILE;ZERO;            * record found
          GOTO      SGLN9999
.
SGLN1810  WRITE     HTMLFILE;ONE;             * record not found
          GOTO      SGLN9999
.
SGLN1900  WRITE     HTMLFILE;PTCNMFEE;
          GOTO      SGLN9999
.
SGLN2000  MATCH     "5",SYSGL001
          GOTO      SGLN9999 IF NOT EQUAL
          MATCH     "2",SUBSECTN              * journal codes
          GOTO      SGLN9999 IF NOT EQUAL
          MATCH     "1",NEWRECRD              * record does not exist
          GOTO      SGLN2090 IF EQUAL
.
          IF        PTCNJFEE=1
            UNPACK    SYSGL002,CLAIMCOD,JOURNALC,KEY11
          ELSE
            UNPACK    SYSGL002,JOURNALC,KEY11
          ENDIF
          MATCH     JOURNALC,SP2
          GOTO      SGLN2090 IF EQUAL
.
          PACK      KEY5,CODEJ,JOURNALC,SP10
          CALL      RDCODE1
          BRANCH    OVRCD,SGLN2090
          CMATCH    ANSG,THCSCOD
          GOTO      SGLN2090 IF NOT EQUAL
          WRITE     HTMLFILE;ONE;
          GOTO      SGLN9999
.
SGLN2090  WRITE     HTMLFILE;ZERO;
          GOTO      SGLN9999
.
SGLN2100  WRITE     HTMLFILE;PTCNJFEE;
          GOTO      SGLN9999
.
.   Fees Invoiced Ledger 
.
SGLN2200  WRITE     HTMLFILE;PMFMFLED;
          GOTO      SGLN9999
.
.   Fees Invoiced Credit Account/Income Account
.
SGLN2300  MATCH     PMFMFCRD,SP20
          GOTO      SGLN9999 IF EQUAL
.
          WRITE     HTMLFILE;PMFMFCRD;  * Credit account
          GOTO      SGLN9999
.
.   Fees Invoiced Debit Account/Debtors Control Account
.
SGLN2400  MATCH     PMFMFDEB,SP20
          GOTO      SGLN9999 IF EQUAL
.
          WRITE     HTMLFILE;PMFMFDEB;  * Debtor account
          GOTO      SGLN9999
.
SGLN2500  MOVE      CODEA,CATEGORY            * Admission Type
          MOVE      ADMISSTP,CODE
          CALL      CODITM00
          GOTO      SGLN9999
.
SGLN2600  MOVE      CODECL,CATEGORY            * Claim Code
          MOVE      CLAIMCOD,CODE
          CALL      CODITM00
          GOTO      SGLN9999
.
SGLN2700  PACK      DFLTWARD,ACCMWARD 
          CALL      WARDSL00
          GOTO      SGLN9999
.
SGLN2800  MOVE      CODEJ,CATEGORY            * Journal Code
          MOVE      JOURNALC,CODE
          CALL      CODITM00
          GOTO      SGLN9999
.
SGLN2900  MATCH     "1",SYSGL001              * Accommodation
          GOTO      SGLN9999 IF NOT EQUAL
          MATCH     "2",SUBSECTN              * non-casemix
          GOTO      SGLN2910 IF NOT EQUAL
          CMATCH    "A",SYSGL002
          GOTO      SGLN9999 IF NOT EQUAL
          MATCH     "1",NEWRECRD              * record does not exist
          GOTO      SGLN9999 IF EQUAL
          BRANCH    CACCFEE,SGLN2990:         * ward/claim
                            SGLN2990:         * ward/adm.type
                            SGLN2990:         * ward/claim/adm.type
                            SGLN2990:         * ward/adm type/claim
                            SGLN9999          * claim type
          GOTO      SGLN9999                  * adm type
.
SGLN2910  MATCH     "4",SUBSECTN              * Casemix daily charge
          GOTO      SGLN9999 IF NOT EQUAL
          CMATCH    "D",SYSGL002
          GOTO      SGLN9999 IF NOT EQUAL
          MATCH     "1",NEWRECRD              * record does not exist
          GOTO      SGLN9999 IF EQUAL
.
          IF        CACCFEE=5
            UNPACK    SYSGL002,DIM1,CLAIMCOD,KEY9
            MATCH     CLAIMCOD,SP3
            IF        @EQUAL
              MOVE      "All Claim Types",TDESC
            ELSE
              PACK      KEY5,CODECL,CLAIMCOD,SP10
              CALL      RDCODE1
              IF        OVRCD=1
                PACK      TDESC,INVALIDS,CLAIMCOD,INVALIDE,SP70
              ENDIF
            ENDIF
            WRITE     HTMLFILE;TDESC;
          ENDIF
          GOTO      SGLN9999
.
SGLN2990  UNPACK    SYSGL002,DIM1,ACCMWARD,KEY9
          MATCH     ACCMWARD,SP3
          IF        @EQUAL
            MOVE      "All Wards",WBDESC
          ELSE
            PACK      KEY6,ACCMWARD,SP70
            CALL      RDWARD1
            IF        OVRCD=1
              PACK      WBDESC,INVALIDS,ACCMWARD,INVALIDE,SP70
            ENDIF
          ENDIF
          WRITE     HTMLFILE;WBDESC;
          GOTO      SGLN9999
.
SGLN3000  MATCH     "1",SYSGL001              * Accommodation
          GOTO      SGLN9999 IF NOT EQUAL
          MATCH     "2",SUBSECTN              * non-casemix
          GOTO      SGLN3030 IF NOT EQUAL
          CMATCH    "A",SYSGL002
          GOTO      SGLN9999 IF NOT EQUAL
          MATCH     "1",NEWRECRD              * record does not exist
          GOTO      SGLN9999 IF EQUAL
          BRANCH    CACCFEE,SGLN3002:         * ward/claim
                            SGLN3004:         * ward/adm.type
                            SGLN3010:         * ward/claim/adm.type
                            SGLN3020:         * ward/adm type/claim
                            SGLN3022          * claim type
          UNPACK    SYSGL002,DIM1,ADMISSTP,KEY9
          GOTO      SGLN3090                  * adm type
.
SGLN3002  UNPACK    SYSGL002,DIM1,ACCMWARD,CLAIMCOD
          GOTO      SGLN3090                  * claim/adm type
.
SGLN3004  UNPACK    SYSGL002,DIM1,ACCMWARD,ADMISSTP
          GOTO      SGLN3090                  * claim/adm type
.
SGLN3010  UNPACK    SYSGL002,DIM1,ACCMWARD,CLAIMCOD,ADMISSTP
          GOTO      SGLN3090                  * claim/adm type
.
SGLN3020  UNPACK    SYSGL002,DIM1,ACCMWARD,ADMISSTP,CLAIMCOD
          GOTO      SGLN3090                  * claim/adm type
.
SGLN3022  UNPACK    SYSGL002,DIM1,CLAIMCOD
          GOTO      SGLN3031                  * claim
.
SGLN3030  MATCH     "3",SUBSECTN              * Casemix lumpsum
          GOTO      SGLN9999 IF NOT EQUAL
          CMATCH    "C",SYSGL002
          GOTO      SGLN9999 IF NOT EQUAL
          MATCH     "1",NEWRECRD              * record does not exist
          GOTO      SGLN9999 IF EQUAL
.
          COMPARE   FIVE,CACCFEE
          GOTO      SGLN3032 IF NOT EQUAL
.
          UNPACK    SYSGL002,DIM1,EPISODTP,CLAIMCOD,KEY8
.
SGLN3031  MATCH     SP3,CLAIMCOD
          IF        @EQUAL
            MOVE      "All Claim Types",TDESC
          ELSE
            PACK      KEY5,CODECL,CLAIMCOD,SP10
            CALL      RDCODE1
            IF        OVRCD=1
              PACK      TDESC,INVALIDS,CLAIMCOD,INVALIDE,SP70
            ENDIF
          ENDIF
          WRITE     HTMLFILE;TDESC;
          GOTO      SGLN9999
.
SGLN3032  UNPACK    SYSGL002,DIM1,EPISODTP,ADMISSTP,KEY8
          GOTO      SGLN3090
.
SGLN3090  MATCH     SP3,ADMISSTP
          IF        @EQUAL
            MOVE      "All Admission Types",TDESC
          ELSE
            PACK      KEY5,CODEA,ADMISSTP,SP10
            CALL      RDCODE1
            IF        OVRCD=1
              PACK      TDESC,INVALIDS,ADMISSTP,INVALIDE,SP70
            ENDIF
          ENDIF
          WRITE     HTMLFILE;TDESC;
          GOTO      SGLN9999
.
SGLN3100  MATCH     "1",SYSGL001              * Accommodation
          GOTO      SGLN3150 IF NOT EQUAL
          MATCH     "2",SUBSECTN              * non-casemix
          GOTO      SGLN9999 IF NOT EQUAL
          CMATCH    "A",SYSGL002
          GOTO      SGLN9999 IF NOT EQUAL
          MATCH     "1",NEWRECRD              * record does not exist
          GOTO      SGLN9999 IF EQUAL
          BRANCH    CACCFEE,SGLN3110:         * ward/claim
                            SGLN3120:         * ward/adm.type
                            SGLN3130:         * ward/claim/adm.type
                            SGLN3140:         * ward/adm type/claim
                            SGLN3141          * claim type
          GOTO      SGLN9999                  * adm type
.
SGLN3110  UNPACK    SYSGL002,DIM1,ACCMWARD,CLAIMCOD
          GOTO      SGLN3190                  * ward/claim
.
SGLN3120  UNPACK    SYSGL002,DIM1,ACCMWARD,ADMISSTP
          GOTO      SGLN3190                  * ward/adm type
.
SGLN3130  UNPACK    SYSGL002,DIM1,ACCMWARD,CLAIMCOD,ADMISSTP
          GOTO      SGLN3190                  * ward/claim/adm type
.
SGLN3140  UNPACK    SYSGL002,DIM1,ACCMWARD,ADMISSTP,CLAIMCOD
          GOTO      SGLN3190                  * ward/adm type/claim
.
SGLN3141  UNPACK    SYSGL002,DIM1,CLAIMCOD
          GOTO      SGLN3190
.
SGLN3150  MATCH     "3",SYSGL001              * Misc Item
          GOTO      SGLN3170 IF NOT EQUAL
          MATCH     "3",SUBSECTN              * Item/claim code
          GOTO      SGLN3160 IF NOT EQUAL
          CMATCH    "M",SYSGL002
          GOTO      SGLN9999 IF NOT EQUAL
          MATCH     "1",NEWRECRD              * record does not exist
          GOTO      SGLN9999 IF EQUAL
          COMPARE   ONE,PTCNMFEE
          GOTO      SGLN9999 IF NOT EQUAL
.
          UNPACK    SYSGL002,DIM1,CLAIMCOD,KEY9
          GOTO      SGLN3190
.
SGLN3160  MATCH     "5",SUBSECTN              * Casemix Item/claim code
          GOTO      SGLN9999 IF NOT EQUAL
          CMATCH    "T",SYSGL002
          GOTO      SGLN9999 IF NOT EQUAL
          MATCH     "1",NEWRECRD              * record does not exist
          GOTO      SGLN9999 IF EQUAL
.
          COMPARE   ONE,PTCNMFEE
          GOTO      SGLN9999 IF NOT EQUAL
.
          UNPACK    SYSGL002,DIM1,EPISODTP,CLAIMCOD,KEY8
          GOTO      SGLN3190
.
SGLN3170  MATCH     "5",SYSGL001              * Journal
          GOTO      SGLN9999 IF NOT EQUAL
          MATCH     "2",SUBSECTN              * Journal Codes
          GOTO      SGLN9999 IF NOT EQUAL
          MATCH     "1",NEWRECRD              * record does not exist
          GOTO      SGLN9999 IF EQUAL
          COMPARE   ONE,PTCNJFEE
          GOTO      SGLN9999 IF NOT EQUAL
.
          UNPACK    SYSGL002,CLAIMCOD,JOURNALC
          GOTO      SGLN3190
.
SGLN3190  MATCH     SP3,CLAIMCOD
          IF        @EQUAL
            MOVE      "All Claim Codes",TDESC
          ELSE
            PACK      KEY5,CODECL,CLAIMCOD,SP10
            CALL      RDCODE1
            IF        OVRCD=1
              PACK      TDESC,INVALIDS,CLAIMCOD,INVALIDE,SP70
            ENDIF
          ENDIF
          WRITE     HTMLFILE;TDESC;
          GOTO      SGLN9999
.
SGLN3200  MATCH     "5",SYSGL001              * Journal
          GOTO      SGLN9999 IF NOT EQUAL
          MATCH     "2",SUBSECTN              * Journal codes
          GOTO      SGLN9999 IF NOT EQUAL
          MATCH     "1",NEWRECRD              * record does not exist
          GOTO      SGLN9999 IF EQUAL
.
          IF        PTCNJFEE=1
            UNPACK    SYSGL002,CLAIMCOD,JOURNALC,KEY10
          ELSE
            UNPACK    SYSGL002,JOURNALC,KEY10
          ENDIF
          MATCH     SP3,JOURNALC
          GOTO      SGLN9999 IF EQUAL
          PACK      KEY5,CODEJ,JOURNALC,SP10
          CALL      RDCODE1
          IF        OVRCD=1
            PACK      TDESC,INVALIDS,JOURNALC,INVALIDE,SP70
          ENDIF
          WRITE     HTMLFILE;TDESC;
          GOTO      SGLN9999
.
SGLN3300  MATCH     "3",SYSGL001              * Misc Item
          GOTO      SGLN9999 IF NOT EQUAL
          MATCH     "2",SUBSECTN              * Group code
          GOTO      SGLN3302 IF NOT EQUAL
          CMATCH    "M",SYSGL002
          GOTO      SGLN9999 IF NOT EQUAL
          GOTO      SGLN3304
.
SGLN3302  IF        PTCNMFEE=1
            MATCH     "3",SUBSECTN            * Claim code ?
            GOTO      SGLN3304 IF EQUAL
          ENDIF
          GOTO      SGLN3310
.
SGLN3304  MATCH     "1",NEWRECRD              * record does not exist
          GOTO      SGLN9999 IF EQUAL
          IF        PTCNMFEE=ONE
            UNPACK    SYSGL002,DIM1,KEY3,GROUPCOD,KEY9
          ELSE
            UNPACK    SYSGL002,DIM1,GROUPCOD,KEY9
          ENDIF
          GOTO      SGLN3390
.
SGLN3310  MATCH     "4",SUBSECTN              * Casemix group code
          GOTO      SGLN3320 IF EQUAL
          IF        PTCNMFEE=1
            MATCH     "5",SUBSECTN
            GOTO      SGLN3320 IF EQUAL       * Claim code Casemix
          ENDIF
          GOTO      SGLN9999
.
SGLN3320  CMATCH    "T",SYSGL002
          GOTO      SGLN9999 IF NOT EQUAL
          MATCH     "1",NEWRECRD              * record does not exist
          GOTO      SGLN9999 IF EQUAL
          IF        PTCNMFEE=ONE
            UNPACK    SYSGL002,DIM1,EPISODTP,KEY3,GROUPCOD,KEY5
          ELSE
            UNPACK    SYSGL002,DIM1,EPISODTP,GROUPCOD,KEY8
          ENDIF
          GOTO      SGLN3390
.
SGLN3390  MATCH     GROUPCOD,SP3
          IF        @EQUAL
            MOVE      "All Item Groups",TDESC
          ELSE
            PACK      KEY5,CODEFI,GROUPCOD,SP10
            CALL      RDCODE1
            IF        OVRCD=1
              PACK      TDESC,INVALIDS,GROUPCOD,INVALIDE,SP70
            ENDIF
          ENDIF
          WRITE     HTMLFILE;TDESC;
          GOTO      SGLN9999
.
SGLN3400  MATCH     "3",SYSGL001              * Misc Item
          GOTO      SGLN9999 IF NOT EQUAL
          MATCH     "3",SUBSECTN              * Item/claim code
          GOTO      SGLN3410 IF NOT EQUAL
          CMATCH    "M",SYSGL002
          GOTO      SGLN9999 IF NOT EQUAL
          MATCH     "1",NEWRECRD              * record does not exist
          GOTO      SGLN9999 IF EQUAL
          COMPARE   ONE,PTCNMFEE
          GOTO      SGLN9999 IF EQUAL
.
          UNPACK    SYSGL002,DIM1,KEY3,ITEMCODE
          GOTO      SGLN3490
.
SGLN3410  MATCH     "5",SUBSECTN              * Casemix Item/claim code
          GOTO      SGLN9999 IF NOT EQUAL
          CMATCH    "T",SYSGL002
          GOTO      SGLN9999 IF NOT EQUAL
          MATCH     "1",NEWRECRD              * record does not exist
          GOTO      SGLN9999 IF EQUAL
          COMPARE   ONE,PTCNMFEE
          GOTO      SGLN9999 IF EQUAL
.
          UNPACK    SYSGL002,DIM1,EPISODTP,KEY3,ITEMCODE
          GOTO      SGLN3490
.
SGLN3490  MATCH     SP9,ITEMCODE
          IF        @EQUAL
            MOVE      "All Item Codes",IDESC
            GOTO      SGLN3499
          ENDIF
.
          PACK      KEY17,ITEMCODE,CURRDATE,SP10
          CALL      PATITMRD
          COMPARE   ZERO,OVRCD
          GOTO      SGLN3499 IF EQUAL
.
          IF        IBCNMHOS=1
            MOVE      SP10,KEY3
            CALL      RSPTHSP1
            CALL      RKPTHSP1
            BRANCH    OVRCD,SGLN9999
            PACK      KEY29,PTHSDCLM,SP6,SP3,ITEMCODE,CURRDATE,SP10
          ELSE
            PACK      KEY29,PTCNDCLM,SP6,SP3,ITEMCODE,CURRDATE,SP10
          ENDIF
.
SGLN3492  CALL      PATMCHRD                * read Misc.Charges file
          COMPARE   ZERO,EXIT
          GOTO      SGLN3498 IF EQUAL
.
          IF        IBCNMHOS=1
            CALL      RKPTHSP1
            BRANCH    OVRCD,SGLN9999
            PACK      KEY29,PTHSDCLM,SP6,SP3,ITEMCODE,CURRDATE,SP10
            GOTO      SGLN3492
          ENDIF
.
          GOTO      SGLN9999
.
SGLN3498  MOVE      MDESC,IDESC

SGLN3499  WRITE     HTMLFILE;IDESC;
          GOTO      SGLN9999
.
SGLN3500  MOVE      CODEFI,CATEGORY            * Group Code
          MOVE      GROUPCOD,CODE
          CALL      CODITM00
          GOTO      SGLN9999
.
.   Fees Invoiced GST Control Account
.
SGLN3600  MATCH     PMFMGSTA,SP20
          GOTO      SGLN9999 IF EQUAL
.
          WRITE     HTMLFILE;PMFMGSTA;  * GST Control account
          GOTO      SGLN9999
.
.   Fees Invoiced Ledger
.
SGLN3700  WRITE     HTMLFILE;PMFMTLED;
          GOTO      SGLN9999
.
.   Fees Invoiced Credit Account/Income Account
.
SGLN3800  MATCH     PMFMTCRD,SP20
          GOTO      SGLN9999 IF EQUAL
.
          WRITE     HTMLFILE;PMFMTCRD;  * Credit account
          GOTO      SGLN9999
.
.   Fees Invoiced Debit Account/Debtors Control Account
.
SGLN3900  MATCH     PMFMTDEB,SP20
          GOTO      SGLN9999 IF EQUAL
.
          WRITE     HTMLFILE;PMFMTDEB;  * Debtor account
          GOTO      SGLN9999
.
SGLN9999  RETURN
+
.------------------------------------------------------------------------------
. SYSG0000 - System based General Ledger Inferface Maintenance
.------------------------------------------------------------------------------
SYSG0000  BRANCH    FLDITMNO,SYSG0100,SYSG0200,SYSG0300,SYSG0400,SYSG0500:
                             SYSG0600,SYSG0700,SYSG0800,SYSG0900,SYSG1000:
                             SYSG1100,SYSG1200,SYSG1300,SYSG1400
          GOTO      SYSG9999
.
SYSG0100  WRITE     HTMLFILE;OTFMFLED;
          GOTO      SYSG9999
.
SYSG0200  WRITE     HTMLFILE;OTFMFCRD;
          GOTO      SYSG9999
.
SYSG0300  WRITE     HTMLFILE;OTFMFDEB;
          GOTO      SYSG9999
.
SYSG0400  WRITE     HTMLFILE;OTFMGSTA;
          GOTO      SYSG9999
.
SYSG0500  WRITE     HTMLFILE;OTFMTLED;
          GOTO      SYSG9999
.
SYSG0600  WRITE     HTMLFILE;OTFMTCRD;
          GOTO      SYSG9999
.
SYSG0700  WRITE     HTMLFILE;OTFMTDEB;
          GOTO      SYSG9999
.
SYSG0800  WRITE     HTMLFILE;AEFMFLED;
          GOTO      SYSG9999
.
SYSG0900  WRITE     HTMLFILE;AEFMFCRD;
          GOTO      SYSG9999
.
SYSG1000  WRITE     HTMLFILE;AEFMFDEB;
          GOTO      SYSG9999
.
SYSG1100  WRITE     HTMLFILE;AEFMGSTA;
...
          GOTO      SYSG9999
.
SYSG1200  WRITE     HTMLFILE;AEFMTLED;
          GOTO      SYSG9999
.
SYSG1300  WRITE     HTMLFILE;AEFMTCRD;
          GOTO      SYSG9999
.
SYSG1400  WRITE     HTMLFILE;AEFMTDEB;
          GOTO      SYSG9999
.
SYSG9999  RETURN
+
.------------------------------------------------------------
. Display System Based GL Maintanence List
.------------------------------------------------------------
SGLLST00  UNPACK    DIM127,D1,LINKPRG,DIM127
          UNPACK    DIM127,D1,LINKREP,DIM127
          UNPACK    DIM127,D1,LINKTEM,DIM127
.
          MOVE      SYSGL001,GLINT001
          CALL      DGLHD000              * Finance Letter List Table Heading
.
          IF        NORECORD=0
            MOVE      "14",NORECORD       * Set Default No Records to Display
          ENDIF
          MOVE      ZERO,RECNUMB
          MOVE      ZERO,DISNUMB
.
          PACK      KEY18,SYSGL015,SYSGL016,SYSGL001,SYSGL002,SP70
          CALL      RSPMFMS1
SGLLST10  CALL      RKPMFMS1
          BRANCH    OVRCD,SGLLST99
.
          IF        IBCNMHOS = 1
            MATCH     SYSGL015,PMFMHOSP
            GOTO      SGLLST99 IF NOT EQUAL
          ENDIF
.
          MATCH     SYSGL016,PMFMSYST
          GOTO      SGLLST99 IF NOT EQUAL
          MATCH     SYSGL001,PMFMRSUB
          GOTO      SGLLST99 IF NOT EQUAL
.
          MATCH     "5",PMFMRSUB              * Journals
          GOTO      SGLLST20 IF NOT EQUAL
          MATCH     SP3,PMFMCODE              * skip Default
          GOTO      SGLLST10 IF EQUAL
          GOTO      SGLLST30
.
SGLLST20  CMATCH    SYSGL002,PMFMCODE
          GOTO      SGLLST99 IF NOT EQUAL
.
SGLLST30  ADD       ONE,RECNUMB
          IF        STARTNUM>=RECNUMB
            GOTO      SGLLST10
          ENDIF
.
          MATCH     PMFMFLED,SP2
          IF        @EQUAL
            MOVE      NBSP,LEDDESC1
            GOTO      SGLLST40
          ELSE
            PACK    LEDDESC1,PMFMFLED,SP70
          ENDIF
.
SGLLST40  MATCH     "5",PMFMRSUB              * Journals
          GOTO      SGLLST80 IF EQUAL
.
          MATCH     PMFMTLED,SP2
          IF        @EQUAL
            MOVE      NBSP,LEDDESC2
            GOTO      SGLLST80
          ELSE
            PACK    LEDDESC2,PMFMTLED,SP70
          ENDIF
.
SGLLST80  CALL      SGLRW000
          ADD       ONE,DISNUMB
          COMPARE   NORECORD,DISNUMB
          GOTO      SGLLST10 IF NOT EQUAL
          GOTO      SGLLST99
.
SGLLST90  MOVE      "Invalid Selection ID",WEBTITLE
          CALL      WEBERR00
          MOVE      ONE,EXIT
.
SGLLST99  RETURN
+
.------------------------------------------------------------
. Hospital Selection
.------------------------------------------------------------
HSLI0000  COMPARE   ONE,IBCNMHOS
          GOTO      HSLI9999 IF NOT EQUAL
          PACK      KEY3,SP70
          CALL      RSPTHSP1
HSLI0100  CALL      RKPTHSP1
          BRANCH    OVRCD,HSLI9999
.
          PACK      KEY5,QUOTE,PTHSHOSP,QUOTE
          WRITE     HTMLFILE;"<option value=",KEY5,">",PTHSNAME,"</option>"
          GOTO      HSLI0100
.
HSLI9999  RETURN
+
.******************************************************************************
.* GACC0000 - Get Debtors & GST control details                              *
.******************************************************************************
GACC0000  COMPARE   TWO,IBCNUGST             * Aust GST
          GOTO      GACC9999 IF NOT EQUAL
          MATCH     "5",PTFMSUB              * Journal ?
          GOTO      GACC9999 IF EQUAL        
          COMPARE   ONE,PTCNUFMS             * FMS System
          GOTO      GACC9999 IF NOT EQUAL        
.
          MOVE      PTFMILD,KEY2
          CALL      RDFMLA1
          BRANCH    OVRCD,GACC9999
.
          MOVE      FMLADEB,FMCSDEB
          MOVE      FMLAAGST,FMCSAGST
          PACK      KEY14,PTFMILD,PTFMICA    * ledger,income
          OPEN      FMSCSAA1,"fmscsaaf"
          CALL      RDFMCS1
          MATCH     SP70,FMCSDEB
          IF        @EQUAL
            MOVE      FMLADEB,PTFMIDA        * Debit account/Debtor account
          ELSE
            MOVE      FMCSDEB,PTFMIDA        * Debit account/Debtor account
          ENDIF
          MATCH     SP70,FMCSAGST
          IF        @EQUAL
            MOVE      FMLAAGST,PTFMIGS       * GST Control
          ELSE
            MOVE      FMCSAGST,PTFMIGS       * GST Control
          ENDIF
.
GACC9999  RETURN
+
.------------------------------------------------------------
. Display GL Maintanence List
.------------------------------------------------------------
DISACC00  UNPACK    DIM127,D1,LINKPRG,DIM127
          UNPACK    DIM127,D1,LINKREP,DIM127
          UNPACK    DIM127,D1,LINKTEM,DIM127
          MATCH     "006",LINKTEM         * template without FMS files
          GOTO      DISACC05 IF EQUAL
.
          IF        PTCNUFMS=0 | PTCNUFMS=2
            MOVE      "003",LINKTEM       * template without validation
          ENDIF
.
DISACC05  CALL      DGLHD000              * G/L List Table Heading
.
          IF        NORECORD=0
            MOVE      PTCNNRTD,NORECORD      * Set Default No Records to Display
          ENDIF
          MOVE      ZERO,RECNUMB
          MOVE      ZERO,DISNUMB
          PACK      KEYNWARD,KEYNWARD,SP70
.
          MATCH     "006",LINKTEM         * template without FMS files
          GOTO      DISACC08 IF NOT EQUAL
.
          MATCH     "1",GLINT001            * Accommodation
          IF        @EQUAL
            CMATCH    "2",SUBSECTN          * Non-casemix
            IF        @EQUAL
              IF        CACCFEE=1 | CACCFEE=2 |CACCFEE=3 |CACCFEE=4
                UNPACK    GLINT002,KEY1
                PACK      GLINT002,KEY1,KEYNWARD,SP70
              ENDIF
            ENDIF
          ENDIF
.
DISACC08  IF        IBCNMHOS = 1
            PACK      KEY17,GLINT015,GLINT001,GLINT002,SP70
          ELSE
            MOVE      SP70,KEY3
            PACK      KEY17,KEY3,GLINT001,GLINT002,SP70
          ENDIF
          CALL      RDPTFM1
          COMPARE   ZERO,OVRCD
          GOTO      DISACC12 IF EQUAL
.
          CALL      RSPTFM1
DISACC10  CALL      RKPTFM1
          BRANCH    OVRCD,DISACC95
.
          IF        IBCNMHOS = 1
            MATCH     GLINT015,PTFMHOSP
            GOTO      DISACC95 IF NOT EQUAL
          ENDIF
.
          MATCH     GLINT001,PTFMSUB
          GOTO      DISACC95 IF NOT EQUAL
.
DISACC12  MATCH     "1",PTFMSUB               * Accommodation
          IF        @EQUAL
            MATCH     SP70,KEYNWARD
            IF        !@EQUAL
              UNPACK    PTFMCOD,ANS,KEY3
              MATCH     KEYNWARD,KEY3
              GOTO      DISACC10 IF NOT EQUAL
            ENDIF
          ENDIF
.
          MATCH     "5",PTFMSUB               * Journals
          GOTO      DISACC20 IF NOT EQUAL
          MATCH     SP70,PTFMCOD              * skip Default 
          GOTO      DISACC10 IF EQUAL
          GOTO      DISACC30
.
DISACC20  CMATCH    GLINT002,PTFMCOD
          GOTO      DISACC95 IF NOT EQUAL
.
DISACC30  ADD       ONE,RECNUMB
          IF        STARTNUM>=RECNUMB
            GOTO      DISACC10
          ENDIF
.
          MATCH     PTFMILD,SP2
          IF        @EQUAL
            MOVE      NBSP,LEDDESC1
            GOTO      DISACC40
          ELSE
            PACK    LEDDESC1,PTFMILD,SP70
          ENDIF
.
          MATCH     "002",LINKTEM         * template with field validation
          IF        @EQUAL
            PACK      KEY2,PTFMILD,SP10
            CALL      RDFMLA1
            IF        OVRCD=0
              PACK    LEDDESC1,FMLADESC,SP70
            ENDIF
          ENDIF
.
DISACC40  MATCH     "5",PTFMSUB               * Journals
          GOTO      DISACC80 IF EQUAL
.
          MATCH     PTFMTLD,SP2
          IF        @EQUAL
            MOVE      NBSP,LEDDESC2
            GOTO      DISACC80
          ELSE
            PACK    LEDDESC2,PTFMTLD,SP70
          ENDIF
.
          MATCH     "002",LINKTEM         * template with field validation
          IF        @EQUAL
            PACK      KEY2,PTFMTLD,SP10
            CALL      RDFMLA1
            IF        OVRCD=0
              PACK    LEDDESC2,FMLADESC,SP70
            ENDIF
          ENDIF
.
DISACC80  CALL      DGLRW000
.
          ADD       ONE,DISNUMB
          COMPARE   NORECORD,DISNUMB
          GOTO      DISACC10 IF NOT EQUAL
          GOTO      DISACC99
.
DISACC90  MOVE      "Invalid Selection ID",WEBTITLE
          CALL      WEBERR00
          MOVE      ONE,EXIT
          GOTO      DISACC99
.
DISACC95  CALL      NOMORE00      * Dipslay No More Records Message
.
DISACC99  RETURN
.------------------------------------------------------------
.  Table GL Maintenance (TABLE HEADING)
.------------------------------------------------------------
DGLHD000  MATCH     "1",GLINT001            * Accommodation
          GOTO      DGLHD100 IF EQUAL
          MATCH     "2",GLINT001            * Theatre
          GOTO      DGLHD200 IF EQUAL
          MATCH     "3",GLINT001            * Misc Item
          GOTO      DGLHD300 IF EQUAL
          MATCH     "5",GLINT001            * Journal
          GOTO      DGLHD500 IF EQUAL
          GOTO      DGLHD999
.
.         Accommodation
.
DGLHD100  CMATCH    "2",SUBSECTN            * Non-casemix
          GOTO      DGLHD105 IF EQUAL
          CMATCH    "3",SUBSECTN            * Casemix lumpsum
          GOTO      DGLHD150 IF EQUAL
          CMATCH    "4",SUBSECTN            * Casemix Daily charge
          GOTO      DGLHD160 IF EQUAL
          GOTO      DGLHD999
.
DGLHD105  BRANCH    CACCFEE,DGLHD110:        * Ward/Claim 
                            DGLHD120:        * Ward/Adm type
                            DGLHD130:        * Ward/Claim/Adm type 
                            DGLHD140:        * Ward/Adm type/Claim 
                            DGLHD142         * Claim type
.
.         Accommodation - Adm Type
.
          WRITE     HTMLFILE;"<tr>":
                       "<td class=HeadingCell>Admission Type</td>":
                       "<td class=HeadingCell>Fees Invoiced Ledger</td>":
                       "<td class=HeadingCell>Credit Account</td>":
                       "<td class=HeadingCell>Fees to be Invoiced Ledger</td>":
                       "</tr>"
          GOTO      DGLHD999
.
.         Accommodation - Ward/Claim Code
.
DGLHD110  WRITE     HTMLFILE;"<tr>":
                       "<td class=HeadingCell>Ward</td>":
                       "<td class=HeadingCell>Claim Code</td>":
                       "<td class=HeadingCell>Fees Invoiced Ledger</td>":
                       "<td class=HeadingCell>Credit Account</td>":
                       "<td class=HeadingCell>Fees to be Invoiced Ledger</td>":
                       "</tr>"
          GOTO      DGLHD999
.
.         Accommodation - Ward/Adm Type
.
DGLHD120  WRITE     HTMLFILE;"<tr>":
                       "<td class=HeadingCell>Ward</td>":
                       "<td class=HeadingCell>Admission Type</td>":
                       "<td class=HeadingCell>Fees Invoiced Ledger</td>":
                       "<td class=HeadingCell>Credit Account</td>":
                       "<td class=HeadingCell>Fees to be Invoiced Ledger</td>":
                       "</tr>"
          GOTO      DGLHD999
.  
.         Accommodation - Ward/Claim/Adm Type
.
DGLHD130  WRITE     HTMLFILE;"<tr>":
                       "<td class=HeadingCell>Ward</td>":
                       "<td class=HeadingCell>Claim Code</td>":
                       "<td class=HeadingCell>Admission Type</td>":
                       "<td class=HeadingCell>Fees Invoiced Ledger</td>":
                       "<td class=HeadingCell>Credit Account</td>":
                       "<td class=HeadingCell>Fees to be Invoiced Ledger</td>":
                       "</tr>"
          GOTO      DGLHD999
.
.         Accommodation - Ward/Adm Type/Claim
.
DGLHD140  WRITE     HTMLFILE;"<tr>":
                       "<td class=HeadingCell>Ward</td>":
                       "<td class=HeadingCell>Admission Type</td>":
                       "<td class=HeadingCell>Claim Code</td>":
                       "<td class=HeadingCell>Fees Invoiced Ledger</td>":
                       "<td class=HeadingCell>Credit Account</td>":
                       "<td class=HeadingCell>Fees to be Invoiced Ledger</td>":
                       "</tr>"
          GOTO      DGLHD999
.
.         Accommodation - Claim Type
.
DGLHD142  WRITE     HTMLFILE;"<tr>":
                       "<td class=HeadingCell>Claim Type</td>":
                       "<td class=HeadingCell>Fees Invoiced Ledger</td>":
                       "<td class=HeadingCell>Credit Account</td>":
                       "<td class=HeadingCell>Fees to be Invoiced Ledger</td>":
                       "</tr>"
          GOTO      DGLHD999
.
.         Accommodation - Casemix Lumpsum
.
DGLHD150  WRITE     HTMLFILE;"<tr>":
                       "<td class=HeadingCell>Episode Type</td>";
          IF        CACCFEE=5
            WRITE     HTMLFILE;"<td class=HeadingCell>Claim Type</td>";
          ELSE
            WRITE     HTMLFILE;"<td class=HeadingCell>Admission Type</td>";
            IF        CACCFEE=4
              WRITE     HTMLFILE;"<td class=HeadingCell>Claim Type</td>";
            ENDIF
          ENDIF
          WRITE     HTMLFILE;"<td class=HeadingCell>Fees Invoiced Ledger</td>":
                       "<td class=HeadingCell>Credit Account</td>":
                       "<td class=HeadingCell>Fees to be Invoiced Ledger</td>":
                       "</tr>"
          GOTO      DGLHD999
.
.         Accommodation - Casemix Day Charge
.
DGLHD160  IF        CACCFEE=5
            WRITE     HTMLFILE;"<tr>":
                         "<td class=HeadingCell>Claim Type</td>";
          ELSE
            WRITE     HTMLFILE;"<tr>":
                         "<td class=HeadingCell>Ward</td>";
            IF        CACCFEE=4
              WRITE     HTMLFILE;"<td class=HeadingCell>Claim Type</td>";
            ENDIF
          ENDIF
.
          WRITE     HTMLFILE;"<td class=HeadingCell>Fees Invoiced Ledger</td>":
                       "<td class=HeadingCell>Credit Account</td>":
                       "<td class=HeadingCell>Fees to be Invoiced Ledger</td>":
                       "</tr>"
          GOTO      DGLHD999
.
.         Theatre
.
DGLHD200  CMATCH    "2",SUBSECTN            * Session Type
          GOTO      DGLHD999 IF NOT EQUAL
.
          WRITE     HTMLFILE;"<tr>":
                       "<td class=HeadingCell>Session Type</td>":
                       "<td class=HeadingCell>Fees Invoiced Ledger</td>":
                       "<td class=HeadingCell>Credit Account</td>":
                       "</tr>"
          GOTO      DGLHD999
.
.         Misc Item
.
DGLHD300  CMATCH    "2",SUBSECTN            * Group Codes
          GOTO      DGLHD310 IF EQUAL
          CMATCH    "3",SUBSECTN            * Item/Claim Codes
          GOTO      DGLHD320 IF EQUAL
          CMATCH    "4",SUBSECTN            * Casemix Group Codes 
          GOTO      DGLHD330 IF EQUAL
          CMATCH    "5",SUBSECTN            * Casemix Item/Claim Codes
          GOTO      DGLHD340 IF EQUAL
          GOTO      DGLHD999
.
DGLHD310  WRITE     HTMLFILE;"<tr>":
                       "<td class=HeadingCell>Group Code</td>":
                       "<td class=HeadingCell>Fees Invoiced Ledger</td>":
                       "<td class=HeadingCell>Credit Account</td>":
                       "<td class=HeadingCell>Fees to be Invoiced Ledger</td>":
                       "</tr>"
          GOTO      DGLHD999
.
DGLHD320  BRANCH    PTCNMFEE,DGLHD325
          WRITE     HTMLFILE;"<tr>":
                       "<td class=HeadingCell>Item Code</td>":
                       "<td class=HeadingCell>Fees Invoiced Ledger</td>":
                       "<td class=HeadingCell>Credit Account</td>":
                       "<td class=HeadingCell>Fees to be Invoiced Ledger</td>":
                       "</tr>"
          GOTO      DGLHD999
.
DGLHD325  WRITE     HTMLFILE;"<tr>":
                       "<td class=HeadingCell>Claim Code</td>":
                       "<td class=HeadingCell>Group Code</td>":
                       "<td class=HeadingCell>Fees Invoiced Ledger</td>":
                       "<td class=HeadingCell>Credit Account</td>":
                       "<td class=HeadingCell>Fees to be Invoiced Ledger</td>":
                       "</tr>"
          GOTO      DGLHD999
.
DGLHD330  WRITE     HTMLFILE;"<tr>":
                       "<td class=HeadingCell>Episode Type</td>":
                       "<td class=HeadingCell>Group Code</td>":
                       "<td class=HeadingCell>Fees Invoiced Ledger</td>":
                       "<td class=HeadingCell>Credit Account</td>":
                       "<td class=HeadingCell>Fees to be Invoiced Ledger</td>":
                       "</tr>"
          GOTO      DGLHD999
.
DGLHD340  BRANCH    PTCNMFEE,DGLHD345
          WRITE     HTMLFILE;"<tr>":
                       "<td class=HeadingCell>Episode Type</td>":
                       "<td class=HeadingCell>Item Code</td>":
                       "<td class=HeadingCell>Fees Invoiced Ledger</td>":
                       "<td class=HeadingCell>Credit Account</td>":
                       "<td class=HeadingCell>Fees to be Invoiced Ledger</td>":
                       "</tr>"
          GOTO      DGLHD999
.
DGLHD345  WRITE     HTMLFILE;"<tr>":
                       "<td class=HeadingCell>Episode Type</td>":
                       "<td class=HeadingCell>Claim Code</td>":
                       "<td class=HeadingCell>Group Code</td>":
                       "<td class=HeadingCell>Fees Invoiced Ledger</td>":
                       "<td class=HeadingCell>Credit Account</td>":
                       "<td class=HeadingCell>Fees to be Invoiced Ledger</td>":
                       "</tr>"
          GOTO      DGLHD999
.
.         Journals
.
DGLHD500  CMATCH    "2",SUBSECTN            * Journal Codes
          GOTO      DGLHD510 IF EQUAL
          GOTO      DGLHD999
.
DGLHD510  COMPARE   ONE,PTCNJFEE
          GOTO      DGLHD520 IF EQUAL
.
          WRITE     HTMLFILE;"<tr>":
                       "<td class=HeadingCell>Journal Code</td>":
                       "<td class=HeadingCell>Fees Invoiced Ledger</td>":
                       "<td class=HeadingCell>Credit Account</td>":
                       "</tr>"
          GOTO      DGLHD999
.
DGLHD520  WRITE     HTMLFILE;"<tr>":
                       "<td class=HeadingCell>Claim Code</td>":
                       "<td class=HeadingCell>Journal Code</td>":
                       "<td class=HeadingCell>Fees Invoiced Ledger</td>":
                       "<td class=HeadingCell>Credit Account</td>":
                       "</tr>"
          GOTO      DGLHD999
.
DGLHD999  RETURN
.------------------------------------------------------------
.  Table GL Maintenance (TABLE ROWS)
.------------------------------------------------------------
.
DGLRW000  MATCH     "1",GLINT001              * Accommodation
          GOTO      DGLRW100 IF EQUAL  
          MATCH     "2",GLINT001              * Theatre
          GOTO      DGLRW200 IF EQUAL  
          MATCH     "3",GLINT001              * Misc Item
          GOTO      DGLRW300 IF EQUAL  
          MATCH     "5",GLINT001              * Journals
          GOTO      DGLRW500 IF EQUAL
          GOTO      DGLRW999 
.                            
DGLRW100  CMATCH    "2",SUBSECTN             * Non-casemix
          GOTO      DGLRW105 IF EQUAL
          CMATCH    "3",SUBSECTN             * Casemix lumpsum
          GOTO      DGLRW150 IF EQUAL
          CMATCH    "4",SUBSECTN             * Casemix daily charge
          GOTO      DGLRW160 IF EQUAL
          GOTO      DGLRW999  
.
DGLRW105  BRANCH    CACCFEE,DGLRW110:         * Ward/Claim
                            DGLRW120:         * Ward/Adm type
                            DGLRW130:         * Ward/Claim/Adm type
                            DGLRW140:         * Ward/Adm type/Claim 
                            DGLRW142          * Claim type
.
.         Accommodation - Adm Type
.
          UNPACK    PTFMCOD,DIM1,ADMISSTP,KEY9
          MATCH     ADMISSTP,SP3
          GOTO      DGLRW999 IF EQUAL         * Mandatory field
          MATCH     KEY9,SP10
          GOTO      DGLRW999 IF NOT EQUAL     * eliminate incorrect data
.
          PACK      KEY5,CODEA,ADMISSTP,SP10
          CALL      RDCODE1
          IF        OVRCD=1
            PACK      TDESC,INVALIDS,ADMISSTP,INVALIDE,SP70
          ENDIF
.
          REP       " +",PTFMCOD
          REP       " +",PTFMHOSP
          WRITE     HTMLFILE;"<td nowrap><A HREF='javascript:ViewInterface":
                             "(#"",LINKPRG,"#.pbl":
                             "?reportno=",LINKREP:
                             "&template=",LINKTEM:
                             "&glint001=",PTFMSUB:
                             "&subsectn=",SUBSECTN:
                             "&glint002=",PTFMCOD:
                             "&glint015=",PTFMHOSP,"#")'>":
                              "<img src=../images/MaintenanceIcon.gif hspace=4":
                              " border=0 align=absmiddle></a>":
                              TDESC,"</td>":
                              "<td>",LEDDESC1,"</td>":
                              "<td>",PTFMICA,"</td>":
                              "<td>",LEDDESC2,"</td></tr>";
          GOTO      DGLRW999
.
.         Accommodation - Ward/Claim code
.
DGLRW110  UNPACK    PTFMCOD,DIM1,ACCMWARD,CLAIMCOD
.
          MATCH     ACCMWARD,SP3
          IF        @EQUAL
            MOVE      "All Wards",WBDESC
          ELSE
            PACK      KEY6,ACCMWARD,SP10
            CALL      RDWARD1
            IF        OVRCD=1
              PACK      WBDESC,INVALIDS,ACCMWARD,INVALIDE,SP70
            ENDIF
          ENDIF
.
          MATCH     CLAIMCOD,SP3
          IF        @EQUAL
            MOVE      "All Claim Codes",TDESC
          ELSE
            PACK      KEY5,CODECL,CLAIMCOD,SP10
            CALL      RDCODE1
            IF        OVRCD=1
              PACK      TDESC,INVALIDS,CLAIMCOD,INVALIDE,SP70
            ENDIF
          ENDIF
.
          REP       " +",PTFMCOD
          REP       " +",PTFMHOSP
          WRITE     HTMLFILE;"<td nowrap><A HREF='javascript:ViewInterface":
                             "(#"",LINKPRG,"#.pbl":
                             "?reportno=",LINKREP:
                             "&template=",LINKTEM:
                             "&glint001=",PTFMSUB:
                             "&subsectn=",SUBSECTN:
                             "&glint002=",PTFMCOD:
                             "&glint015=",PTFMHOSP,"#")'>":
                              "<img src=../images/MaintenanceIcon.gif hspace=4":
                              " border=0 align=absmiddle></a>":
                              WBDESC,"</td>":
                              "<td>",TDESC,"</td>":
                              "<td>",LEDDESC1,"</td>":
                              "<td>",PTFMICA,"</td>":
                              "<td>",LEDDESC2,"</td></tr>";
          GOTO      DGLRW999
.
.         Accommodation - Ward/Adm.Type
.
DGLRW120  UNPACK    PTFMCOD,DIM1,ACCMWARD,ADMISSTP
.
          MATCH     ACCMWARD,SP3
          IF        @EQUAL
            MOVE      "All Wards",WBDESC
          ELSE
            PACK      KEY6,ACCMWARD,SP10
            CALL      RDWARD1
            IF        OVRCD=1
              PACK      WBDESC,INVALIDS,ACCMWARD,INVALIDE,SP70
            ENDIF
          ENDIF
.
          MATCH     ADMISSTP,SP3
          IF        @EQUAL
            MOVE      "All Admission Types",TDESC
          ELSE
            PACK      KEY5,CODEA,ADMISSTP,SP10
            CALL      RDCODE1
            IF        OVRCD=1
              PACK      TDESC,INVALIDS,ADMISSTP,INVALIDE,SP70
            ENDIF
          ENDIF
.
          REP       " +",PTFMCOD
          REP       " +",PTFMHOSP
          WRITE     HTMLFILE;"<td nowrap><A HREF='javascript:ViewInterface":
                             "(#"",LINKPRG,"#.pbl":
                             "?reportno=",LINKREP:
                             "&template=",LINKTEM:
                             "&glint001=",PTFMSUB:
                             "&subsectn=",SUBSECTN:
                             "&glint002=",PTFMCOD:
                             "&glint015=",PTFMHOSP,"#")'>":
                              "<img src=../images/MaintenanceIcon.gif hspace=4":
                              " border=0 align=absmiddle></a>":
                              WBDESC,"</td>":
                              "<td>",TDESC,"</td>":
                              "<td>",LEDDESC1,"</td>":
                              "<td>",PTFMICA,"</td>":
                              "<td>",LEDDESC2,"</td></tr>";
          GOTO      DGLRW999
.
.         Accommodation - Ward/Claim code/Adm Type 
.
DGLRW130  UNPACK    PTFMCOD,DIM1,ACCMWARD,CLAIMCOD,ADMISSTP
.
          MATCH     ACCMWARD,SP3
          IF        @EQUAL
            MOVE      "All Wards",WBDESC
          ELSE
            PACK      KEY6,ACCMWARD,SP10
            CALL      RDWARD1
            IF        OVRCD=1
              PACK      WBDESC,INVALIDS,ACCMWARD,INVALIDE,SP70
            ENDIF
          ENDIF
.
          MATCH     CLAIMCOD,SP3
          IF        @EQUAL
            MOVE      "All Claim Codes",KEY20
          ELSE
            PACK      KEY5,CODECL,CLAIMCOD,SP10
            CALL      RDCODE1
            IF        OVRCD=1
              PACK      KEY20,INVALIDS,CLAIMCOD,INVALIDE,SP70
            ELSE
              PACK      KEY20,TDESC,SP70
            ENDIF
          ENDIF
.
          MATCH     ADMISSTP,SP3
          IF        @EQUAL
            MOVE      "All Admission Types",TDESC
          ELSE
            PACK      KEY5,CODEA,ADMISSTP,SP10
            CALL      RDCODE1
            IF        OVRCD=1
              PACK      TDESC,INVALIDS,ADMISSTP,INVALIDE,SP70
            ENDIF
          ENDIF
.
          REP       " +",PTFMCOD
          REP       " +",PTFMHOSP
          WRITE     HTMLFILE;"<td nowrap><A HREF='javascript:ViewInterface":
                             "(#"",LINKPRG,"#.pbl":
                             "?reportno=",LINKREP:
                             "&template=",LINKTEM:
                             "&glint001=",PTFMSUB:
                             "&subsectn=",SUBSECTN:
                             "&glint002=",PTFMCOD:
                             "&glint015=",PTFMHOSP,"#")'>":
                              "<img src=../images/MaintenanceIcon.gif hspace=4":
                              " border=0 align=absmiddle></a>":
                              WBDESC,"</td>":
                              "<td>",KEY20,"</td>":
                              "<td>",TDESC,"</td>":
                              "<td>",LEDDESC1,"</td>":
                              "<td>",PTFMICA,"</td>":
                              "<td>",LEDDESC2,"</td></tr>";
          GOTO      DGLRW999
.
.         Accommodation - Ward/Adm Type/Claim code 
.
DGLRW140  UNPACK    PTFMCOD,DIM1,ACCMWARD,ADMISSTP,CLAIMCOD,KEY3
.
          MATCH     ACCMWARD,SP3
          IF        @EQUAL
            MOVE      "All Wards",WBDESC
          ELSE
            PACK      KEY6,ACCMWARD,SP10
            CALL      RDWARD1
            IF        OVRCD=1
              PACK      WBDESC,INVALIDS,ACCMWARD,INVALIDE,SP70
            ENDIF
          ENDIF
.
          MATCH     ADMISSTP,SP3
          IF        @EQUAL
            MOVE      "All Admission Types",KEY20
          ELSE
            PACK      KEY5,CODEA,ADMISSTP,SP10
            CALL      RDCODE1
            IF        OVRCD=1
              PACK      KEY20,INVALIDS,ADMISSTP,INVALIDE,SP70
            ELSE
              PACK      KEY20,TDESC,SP70
            ENDIF
          ENDIF
.
          MATCH     CLAIMCOD,SP3
          IF        @EQUAL
            MOVE      "All Claim Codes",TDESC
          ELSE
            PACK      KEY5,CODECL,CLAIMCOD,SP10
            CALL      RDCODE1
            IF        OVRCD=1
              PACK      TDESC,INVALIDS,CLAIMCOD,INVALIDE,SP70
            ENDIF
          ENDIF
.
          REP       " +",PTFMCOD
          REP       " +",PTFMHOSP
          WRITE     HTMLFILE;"<td nowrap><A HREF='javascript:ViewInterface":
                             "(#"",LINKPRG,"#.pbl":
                             "?reportno=",LINKREP:
                             "&template=",LINKTEM:
                             "&glint001=",PTFMSUB:
                             "&subsectn=",SUBSECTN:
                             "&glint002=",PTFMCOD:
                             "&glint015=",PTFMHOSP,"#")'>":
                              "<img src=../images/MaintenanceIcon.gif hspace=4":
                              " border=0 align=absmiddle></a>":
                              WBDESC,"</td>":
                              "<td>",KEY20,"</td>":
                              "<td>",TDESC,"</td>":
                              "<td>",LEDDESC1,"</td>":
                              "<td>",PTFMICA,"</td>":
                              "<td>",LEDDESC2,"</td></tr>";
          GOTO      DGLRW999
.
.         Accommodation - Claim Type
.
DGLRW142  UNPACK    PTFMCOD,DIM1,CLAIMCOD,KEY9
          MATCH     CLAIMCOD,SP3
          GOTO      DGLRW999 IF EQUAL         * Mandatory field
          MATCH     KEY9,SP10
          GOTO      DGLRW999 IF NOT EQUAL     * eliminate incorrect data
.
          PACK      KEY5,CODECL,CLAIMCOD,SP10
          CALL      RDCODE1
          IF        OVRCD=1
            PACK      TDESC,INVALIDS,CLAIMCOD,INVALIDE,SP70
          ENDIF
.
          REP       " +",PTFMCOD
          REP       " +",PTFMHOSP
          WRITE     HTMLFILE;"<td nowrap><A HREF='javascript:ViewInterface":
                             "(#"",LINKPRG,"#.pbl":
                             "?reportno=",LINKREP:
                             "&template=",LINKTEM:
                             "&glint001=",PTFMSUB:
                             "&subsectn=",SUBSECTN:
                             "&glint002=",PTFMCOD:
                             "&glint015=",PTFMHOSP,"#")'>":
                              "<img src=../images/MaintenanceIcon.gif hspace=4":
                              " border=0 align=absmiddle></a>":
                              TDESC,"</td>":
                              "<td>",LEDDESC1,"</td>":
                              "<td>",PTFMICA,"</td>":
                              "<td>",LEDDESC2,"</td></tr>";
          GOTO      DGLRW999
.
.         Accommodation - Casemix lumpsum
.
DGLRW150  PACK      KEY20,SP70
          UNPACK    PTFMCOD,DIM1,EPISODTP,ADMISSTP,KEY8
          IF        CACCFEE=5
            UNPACK    PTFMCOD,DIM1,EPISODTP,CLAIMCOD,KEY8
          ELSE
            IF        CACCFEE=4
              UNPACK    PTFMCOD,DIM1,EPISODTP,ADMISSTP,CLAIMCOD,KEY8
            ENDIF
          ENDIF
          MATCH     EPISODTP,SP1
          GOTO      DGLRW999 IF EQUAL         * Mandatory field
.
          PACK      KEY11,INVALIDS,EPISODTP,INVALIDE,SP10
          MATCH     "0",EPISODTP
          IF        @EQUAL
            MOVE    "MSO",KEY11
          ENDIF
          MATCH     "1",EPISODTP
          IF        @EQUAL
            MOVE    "DAYCASE",KEY11 
          ENDIF
.
          COMPARE   FOUR,CACCFEE               * By AdmType and Claim type
          GOTO      DGLRW151 IF EQUAL
          COMPARE   FIVE,CACCFEE
          GOTO      DGLRW152 IF NOT EQUAL      * Not by Claim type
.
DGLRW151  MATCH     CLAIMCOD,SP3
          IF        @EQUAL
            MOVE      "All Claim Types",TDESC
          ELSE
            PACK      KEY5,CODECL,CLAIMCOD,SP10
            CALL      RDCODE1
            IF        OVRCD=1
              PACK      TDESC,INVALIDS,CLAIMCOD,INVALIDE,SP70
            ENDIF
          ENDIF
          COMPARE   FOUR,CACCFEE
          GOTO      DGLRW154 IF NOT EQUAL      * NOT By AdmType and Claim type
          PACK      KEY20,TDESC,SP70
.
DGLRW152  MATCH     ADMISSTP,SP3
          IF        @EQUAL
            MOVE      "All Admission Types",TDESC
          ELSE
            PACK      KEY5,CODEA,ADMISSTP,SP10
            CALL      RDCODE1
            IF        OVRCD=1
              PACK      TDESC,INVALIDS,ADMISSTP,INVALIDE,SP70
            ENDIF
          ENDIF
.
DGLRW154  REP       " +",PTFMCOD
          REP       " +",PTFMHOSP
          WRITE     HTMLFILE;"<td nowrap><A HREF='javascript:ViewInterface":
                             "(#"",LINKPRG,"#.pbl":
                             "?reportno=",LINKREP:
                             "&template=",LINKTEM:
                             "&glint001=",PTFMSUB:
                             "&subsectn=",SUBSECTN:
                             "&glint002=",PTFMCOD:
                             "&glint015=",PTFMHOSP,"#")'>":
                              "<img src=../images/MaintenanceIcon.gif hspace=4":
                              " border=0 align=absmiddle></a>":
                              KEY11,"</td>":
                              "<td>",TDESC,"</td>";
.
          IF        CACCFEE=4
            WRITE     HTMLFILE;"<td>&nbsp;",KEY20,"</td>";
          ENDIF
.
          WRITE     HTMLFILE;"<td>",LEDDESC1,"</td>":
                              "<td>",PTFMICA,"</td>":
                              "<td>",LEDDESC2,"</td></tr>";
          GOTO      DGLRW999
.
.         Accommodation - Casemix daily charge
.
DGLRW160  PACK      KEY20,SP70
          UNPACK    PTFMCOD,DIM1,ACCMWARD,KEY9
          IF        CACCFEE=5
            UNPACK    PTFMCOD,DIM1,CLAIMCOD,KEY9
          ELSE
            IF        CACCFEE=4
              UNPACK    PTFMCOD,DIM1,ACCMWARD,CLAIMCOD,KEY9
            ENDIF
          ENDIF
.
.         By AdmType and Claim type
.
          IF        CACCFEE=4
            MATCH     SP70,CLAIMCOD
            IF        @EQUAL
              MOVE      "All Claim Types",TDESC
              PACK      KEY20,TDESC,SP70
              GOTO      DGLRW162
            ENDIF
            GOTO      DGLRW161
          ENDIF
.
          COMPARE   FIVE,CACCFEE
          GOTO      DGLRW162 IF NOT EQUAL     * Not by Claim type
.
          MATCH     CLAIMCOD,SP3
          GOTO      DGLRW999 IF EQUAL         * Mandatory field
.
DGLRW161  PACK      KEY5,CODECL,CLAIMCOD,SP10
          CALL      RDCODE1
          IF        OVRCD=1
            PACK      TDESC,INVALIDS,CLAIMCOD,INVALIDE,SP70
          ENDIF
.
          COMPARE   FOUR,CACCFEE               * By AdmType and Claim type ?
          GOTO      DGLRW164 IF NOT EQUAL
          PACK      KEY20,TDESC,SP70
.
DGLRW162  MATCH     SP3,ACCMWARD
          IF        @EQUAL
            COMPARE   "4",CACCFEE
            GOTO      DGLRW999 IF NOT EQUAL     * Mandatory field
            MOVE      "All Ward            ",WBDESC
            GOTO      DGLRW164
          ENDIF
.
          PACK      KEY6,ACCMWARD,SP10
          CALL      RDWARD1
          IF        OVRCD=1
            PACK      WBDESC,INVALIDS,ACCMWARD,INVALIDE,SP70
          ENDIF
.
DGLRW164  REP       " +",PTFMCOD
          REP       " +",PTFMHOSP
          WRITE     HTMLFILE;"<td nowrap><A HREF='javascript:ViewInterface":
                             "(#"",LINKPRG,"#.pbl":
                             "?reportno=",LINKREP:
                             "&template=",LINKTEM:
                             "&glint001=",PTFMSUB:
                             "&subsectn=",SUBSECTN:
                             "&glint002=",PTFMCOD:
                             "&glint015=",PTFMHOSP,"#")'>":
                              "<img src=../images/MaintenanceIcon.gif hspace=4":
                              " border=0 align=absmiddle></a>";
.
          IF        CACCFEE=5
            WRITE     HTMLFILE;TDESC,"</td>";
          ELSE
            WRITE     HTMLFILE;WBDESC,"</td>";
            IF        CACCFEE=4
              WRITE     HTMLFILE;"<td>",KEY20,"</td>";
            ENDIF
          ENDIF
.
          WRITE     HTMLFILE;"<td>",LEDDESC1,"</td>":
                             "<td>",PTFMICA,"</td>":
                             "<td>",LEDDESC2,"</td></tr>";
          GOTO      DGLRW999
.
.         Theatre
.
DGLRW200  CMATCH    "2",SUBSECTN            * Session Type
          GOTO      DGLRW999 IF NOT EQUAL
.
          UNPACK    PTFMCOD,DIM1,SESSTYPE
          MATCH     SESSTYPE,SP2
          GOTO      DGLRW999 IF EQUAL               * Mandatory field
.
          PACK      KEY5,CODETU,SESSTYPE,SP10
          CALL      RDCODE1
          IF        OVRCD=1   
            PACK      TDESC,INVALIDS,SESSTYPE,INVALIDE,SP70
          ENDIF
.
          REP       " +",PTFMCOD
          REP       " +",PTFMHOSP
          WRITE     HTMLFILE;"<td nowrap><A HREF='javascript:ViewInterface":
                             "(#"",LINKPRG,"#.pbl":
                             "?reportno=",LINKREP:
                             "&template=",LINKTEM:
                             "&glint001=",PTFMSUB:
                             "&subsectn=",SUBSECTN:
                             "&glint002=",PTFMCOD:
                             "&glint015=",PTFMHOSP,"#")'>":
                              "<img src=../images/MaintenanceIcon.gif hspace=4":
                              " border=0 align=absmiddle></a>":
                              TDESC,"</td>":
                              "<td>",LEDDESC1,"</td>":
                              "<td>",PTFMICA,"</td>":
                              "</tr>";
          GOTO      DGLRW999
.
.         Misc items
.
DGLRW300  CMATCH    "2",SUBSECTN            * Group Codes
          GOTO      DGLRW310 IF EQUAL
          CMATCH    "3",SUBSECTN            * Item/Claim Codes
          GOTO      DGLRW320 IF EQUAL
          CMATCH    "4",SUBSECTN            * Casemix Group Codes 
          GOTO      DGLRW330 IF EQUAL
          CMATCH    "5",SUBSECTN            * Casemix Item/Claim Codes
          GOTO      DGLRW340 IF EQUAL
          GOTO      DGLRW999
.
.         Misc Item - Group Codes    
.
DGLRW310  IF        PTCNMFEE=1
            UNPACK    PTFMCOD,DIM1,DIM3,GROUPCOD,KEY6
            MATCH     DIM3,SP3
            GOTO      DGLRW999 IF NOT EQUAL         * Eliminate incorrect data
          ELSE
            UNPACK    PTFMCOD,DIM1,GROUPCOD,KEY9
            MATCH     KEY9,SP10
            GOTO      DGLRW999 IF NOT EQUAL         * Eliminate incorrect data
          ENDIF
          MATCH     GROUPCOD,SP3
          GOTO      DGLRW999 IF EQUAL               * Mandatory field
.
          PACK      KEY5,CODEFI,GROUPCOD,SP10
          CALL      RDCODE1
          IF        OVRCD=1
            PACK      TDESC,INVALIDS,GROUPCOD,INVALIDE,SP70
          ENDIF
.
          REP       " +",PTFMCOD
          REP       " +",PTFMHOSP
          WRITE     HTMLFILE;"<td nowrap><A HREF='javascript:ViewInterface":
                             "(#"",LINKPRG,"#.pbl":
                             "?reportno=",LINKREP:
                             "&template=",LINKTEM:
                             "&glint001=",PTFMSUB:
                             "&subsectn=",SUBSECTN:
                             "&glint002=",PTFMCOD:
                             "&glint015=",PTFMHOSP,"#")'>":
                              "<img src=../images/MaintenanceIcon.gif hspace=4":
                              " border=0 align=absmiddle></a>":
                              TDESC,"</td>":
                              "<td>",LEDDESC1,"</td>":
                              "<td>",PTFMICA,"</td>":
                              "<td>",LEDDESC2,"</td></tr>";
          GOTO      DGLRW999
.
.         Misc Item - Item/Claim codes
.
DGLRW320  BRANCH    PTCNMFEE,DGLRW325
          UNPACK    PTFMCOD,DIM1,DIM3,ITEMCODE,KEY6 * Item codes
          MATCH     DIM3,SP3
          GOTO      DGLRW999 IF NOT EQUAL           * Eliminate incorrect data
          MATCH     ITEMCODE,SP3
          GOTO      DGLRW999 IF EQUAL               * Mandatory field
.
.*        PACK      KEY17,ITEMCODE,SP10
.*        CALL      PATITMRD
.*        IF        OVRCD=1
.*          PACK      IDESC,ITEMCODE,SP70
.*        ENDIF
.*        MOVE      IDESC,TDESC
          MOVE      ITEMCODE,TDESC
          GOTO      DGLRW329
.
.         Claim Code/Misc.group
.
DGLRW325  UNPACK    PTFMCOD,DIM1,CLAIMCOD,GROUPCOD  * Claim codes
.
          MATCH     CLAIMCOD,SP3
          IF        @EQUAL
            IF        CACCFEE=4
              MATCH     SP70,GROUPCOD
              GOTO      DGLRW326 IF NOT EQUAL
            ENDIF
            GOTO        DGLRW999
          ENDIF
.
DGLRW326  MOVE      "All Item Groups     ",GROUPDES
          MATCH     SP10,GROUPCOD
          IF        !@EQUAL
            PACK      KEY5,CODEFI,GROUPCOD,SP10
            CALL      RDCODE1
            IF        OVRCD=1
              PACK      GROUPDES,INVALIDS,GROUPCOD,INVALIDE,SP70
            ELSE
              PACK      GROUPDES,TDESC,SP70
            ENDIF
          ENDIF
.
          MOVE      SP70,TDESC
          IF        CACCFEE=4
            MOVE      "All Claim Code      ",TDESC
          ENDIF
          MATCH     SP70,CLAIMCOD
          IF        !@EQUAL
            PACK      KEY5,CODECL,CLAIMCOD,SP10
            CALL      RDCODE1
            IF        OVRCD=1
              PACK      TDESC,INVALIDS,CLAIMCOD,INVALIDE,SP70
            ENDIF
          ENDIF
.
DGLRW329  REP       " +",PTFMCOD
          REP       " +",PTFMHOSP
          WRITE     HTMLFILE;"<td nowrap><A HREF='javascript:ViewInterface":
                             "(#"",LINKPRG,"#.pbl":
                             "?reportno=",LINKREP:
                             "&template=",LINKTEM:
                             "&glint001=",PTFMSUB:
                             "&subsectn=",SUBSECTN:
                             "&glint002=",PTFMCOD:
                             "&glint015=",PTFMHOSP,"#")'>":
                              "<img src=../images/MaintenanceIcon.gif hspace=4":
                              " border=0 align=absmiddle></a>":
                              TDESC,"</td>";
.
          IF        PTCNMFEE=1
            WRITE     HTMLFILE;"<td>",GROUPDES,"</td>";
          ENDIF
.
          WRITE     HTMLFILE;"<td>",LEDDESC1,"</td>":
                              "<td>",PTFMICA,"</td>":
                              "<td>",LEDDESC2,"</td></tr>";
          GOTO      DGLRW999
.
.         Misc Item - Casemix Group Codes
.
DGLRW330  IF        PTCNMFEE=1
            UNPACK    PTFMCOD,DIM1,EPISODTP,DIM3,GROUPCOD,KEY6
            MATCH     DIM3,SP3
            GOTO      DGLRW999 IF NOT EQUAL         * Eliminate incorrect data
          ELSE
            UNPACK    PTFMCOD,DIM1,EPISODTP,GROUPCOD,KEY9
            MATCH     KEY9,SP10
            GOTO      DGLRW999 IF NOT EQUAL         * Eliminate incorrect data
          ENDIF
          MATCH     EPISODTP,SP1
          GOTO      DGLRW999 IF EQUAL               * Mandatory field
          MATCH     GROUPCOD,SP3
          GOTO      DGLRW999 IF EQUAL               * Mandatory field
.
          PACK      KEY11,INVALIDS,EPISODTP,INVALIDE,SP10
          MATCH     "0",EPISODTP
          IF        @EQUAL
            MOVE    "MSO",KEY11
          ENDIF
          MATCH     "1",EPISODTP
          IF        @EQUAL
            MOVE    "DAYCASE",KEY11 
          ENDIF
.
          PACK      KEY5,CODEFI,GROUPCOD,SP10
          CALL      RDCODE1
          IF        OVRCD=1
            PACK      TDESC,INVALIDS,GROUPCOD,INVALIDE,SP70
          ENDIF
.
          REP       " +",PTFMCOD
          REP       " +",PTFMHOSP
          WRITE     HTMLFILE;"<td nowrap><A HREF='javascript:ViewInterface":
                             "(#"",LINKPRG,"#.pbl":
                             "?reportno=",LINKREP:
                             "&template=",LINKTEM:
                             "&glint001=",PTFMSUB:
                             "&subsectn=",SUBSECTN:
                             "&glint002=",PTFMCOD:
                             "&glint015=",PTFMHOSP,"#")'>":
                              "<img src=../images/MaintenanceIcon.gif hspace=4":
                              " border=0 align=absmiddle></a>":
                              KEY11,"</td>":
                              "<td>",TDESC,"</td>":
                              "<td>",LEDDESC1,"</td>":
                              "<td>",PTFMICA,"</td>":
                              "<td>",LEDDESC2,"</td></tr>";
          GOTO      DGLRW999
.
.         Misc Item - Casemix Item/Claim codes
.
DGLRW340  BRANCH    PTCNMFEE,DGLRW345
          UNPACK    PTFMCOD,DIM1,EPISODTP,DIM3,ITEMCODE,KEY6 * Item codes
          MATCH     DIM3,SP3
          GOTO      DGLRW999 IF NOT EQUAL           * Eliminate incorrect data
          MATCH     EPISODTP,SP1
          GOTO      DGLRW999 IF EQUAL               * Mandatory field
          MATCH     ITEMCODE,SP3
          IF        @EQUAL                                                
            MOVE      "All Item Codes",TDESC
          ELSE
            MOVE      ITEMCODE,TDESC
          ENDIF
.
.**       PACK      KEY17,ITEMCODE,SP10
.**       CALL      PATITMRD
.**       IF        OVRCD=1
.**         PACK      IDESC,ITEMCODE,SP70
.**       ENDIF
.**       MOVE      IDESC,TDESC
          GOTO      DGLRW349
.
DGLRW345  UNPACK    PTFMCOD,DIM1,EPISODTP,CLAIMCOD,GROUPCOD  * Claim codes
          MATCH     EPISODTP,SP1
          GOTO      DGLRW999 IF EQUAL               * Mandatory field
          MATCH     CLAIMCOD,SP3
	  IF        @EQUAL
            IF        CACCFEE=4
              MATCH     SP70,GROUPCOD
              GOTO      DGLRW999 IF EQUAL
            ELSE
              GOTO      DGLRW999                   * Mandatory field
            ENDIF
          ENDIF
.
          MOVE      "All Item Groups     ",GROUPDES
          MATCH     SP10,GROUPCOD
          IF        !@EQUAL
            PACK      KEY5,CODEFI,GROUPCOD,SP10
            CALL      RDCODE1
            IF        OVRCD=1
              PACK      GROUPDES,INVALIDS,GROUPCOD,INVALIDE,SP70
            ELSE
              PACK      GROUPDES,TDESC,SP70
            ENDIF
          ENDIF
.
          MOVE      SP70,TDESC
          IF        CACCFEE=4
            MOVE      "All Claim type      ",TDESC
          ENDIF
          MATCH     SP70,CLAIMCOD
          IF        !@EQUAL
            PACK      KEY5,CODECL,CLAIMCOD,SP10
            CALL      RDCODE1
            IF        OVRCD=1
              PACK      TDESC,INVALIDS,CLAIMCOD,INVALIDE,SP70
            ENDIF
          ENDIF
.
DGLRW349  PACK      KEY11,INVALIDS,EPISODTP,INVALIDE,SP10
          MATCH     "0",EPISODTP
          IF        @EQUAL
            MOVE    "MSO",KEY11
          ENDIF
          MATCH     "1",EPISODTP
          IF        @EQUAL
            MOVE    "DAYCASE",KEY11 
          ENDIF
.
          REP       " +",PTFMCOD
          REP       " +",PTFMHOSP
          WRITE     HTMLFILE;"<td nowrap><A HREF='javascript:ViewInterface":
                             "(#"",LINKPRG,"#.pbl":
                             "?reportno=",LINKREP:
                             "&template=",LINKTEM:
                             "&glint001=",PTFMSUB:
                             "&subsectn=",SUBSECTN:
                             "&glint002=",PTFMCOD:
                             "&glint015=",PTFMHOSP,"#")'>":
                              "<img src=../images/MaintenanceIcon.gif hspace=4":
                              " border=0 align=absmiddle></a>":
                              KEY11,"</td>":
                              "<td>",TDESC,"</td>";
.
          IF        PTCNMFEE=1
            WRITE     HTMLFILE;"<td>",GROUPDES,"</td>";
          ENDIF
.
          WRITE     HTMLFILE;"<td>",LEDDESC1,"</td>":
                              "<td>",PTFMICA,"</td>":
                              "<td>",LEDDESC2,"</td></tr>";
          GOTO      DGLRW999
.
.         Journals
.
DGLRW500  CMATCH    "2",SUBSECTN            * Journal Codes
          GOTO      DGLRW510 IF EQUAL
          GOTO      DGLRW999
.
DGLRW510  COMPARE   ONE,PTCNJFEE
          GOTO      DGLRW520 IF EQUAL
.
          UNPACK    PTFMCOD,JOURNALC,KEY11
          MATCH     JOURNALC,SP2
          GOTO      DGLRW999 IF EQUAL               * Mandatory field
          MATCH     KEY11,SP20
          GOTO      DGLRW999 IF NOT EQUAL           * eliminate incorrect data
.
          PACK      KEY5,CODEJ,JOURNALC,SP10
          CALL      RDCODE1
          IF        OVRCD=1
            PACK      TDESC,INVALIDS,JOURNALC,INVALIDE,SP70
          ENDIF
.
          REP       " +",PTFMCOD
          REP       " +",PTFMHOSP
          WRITE     HTMLFILE;"<td nowrap><A HREF='javascript:ViewInterface":
                             "(#"",LINKPRG,"#.pbl":
                             "?reportno=",LINKREP:
                             "&template=",LINKTEM:
                             "&glint001=",PTFMSUB:
                             "&subsectn=",SUBSECTN:
                             "&glint002=",PTFMCOD:
                             "&glint015=",PTFMHOSP,"#")'>":
                              "<img src=../images/MaintenanceIcon.gif hspace=4":
                              " border=0 align=absmiddle></a>":
                              TDESC,"</td>":
                              "<td>",LEDDESC1,"</td>":
                              "<td>",PTFMICA,"</td>":
                              "</tr>";
          GOTO      DGLRW999
.
DGLRW520  UNPACK    PTFMCOD,CLAIMCOD,JOURNALC
.
          MATCH     SP70,CLAIMCOD
          IF        @EQUAL
            IF        CACCFEE=4
              MATCH     SP70,JOURNALC
              GOTO      DGLRW530 IF NOT EQUAL
            ENDIF
            GOTO      DGLRW999              * Mandatory field
          ENDIF
.
DGLRW530  PACK      KEY5,CODEJ,JOURNALC,SP10
          CALL      RDCODE1
          IF        OVRCD=1
            PACK      TDESC,INVALIDS,JOURNALC,INVALIDE,SP70
          ENDIF
          MOVE      TDESC,KEY20
.
          MATCH     CLAIMCOD,SP3
          IF        @EQUAL
            MOVE      "All Claim Codes",TDESC
          ELSE
            PACK      KEY5,CODECL,CLAIMCOD,SP10
            CALL      RDCODE1
            IF        OVRCD=1
              PACK      TDESC,INVALIDS,CLAIMCOD,INVALIDE,SP70
            ENDIF
          ENDIF
.
          REP       " +",PTFMCOD
          REP       " +",PTFMHOSP
          WRITE     HTMLFILE;"<td nowrap><A HREF='javascript:ViewInterface":
                             "(#"",LINKPRG,"#.pbl":
                             "?reportno=",LINKREP:
                             "&template=",LINKTEM:
                             "&glint001=",PTFMSUB:
                             "&subsectn=",SUBSECTN:
                             "&glint002=",PTFMCOD:
                             "&glint015=",PTFMHOSP,"#")'>":
                              "<img src=../images/MaintenanceIcon.gif hspace=4":
                              " border=0 align=absmiddle></a>":
                              TDESC,"</td>":
                              "<td>",KEY20,"</td>":
                              "<td>",LEDDESC1,"</td>":
                              "<td>",PTFMICA,"</td>":
                              "</tr>";
          GOTO      DGLRW999
DGLRW999  RETURN
+
.-----------------------------------------------------------
. Link to Next GL Interface
.-----------------------------------------------------------
NXTACC00  MOVE      NORECORD,KEY2
          REP       " +",KEY2
          ASSIGN    STARTNUM+NORECORD,F3
          MOVE      F3,KEY3
          REP       " +",KEY3
          UNPACK    DIM127,D1,FLDPARA,DIM127
          MOVE      REPORTNO,F2
          REP       " +",GLINT001
          REP       " +",GLINT002
          REP       " +",GLINT015
          REP       " +",KEYNWARD
.
          WRITE     HTMLFILE;"patweb61.pbl":
                                 "?reportno=",F2:
                                 "&template=",FLDPARA:
                                 "&startnum=",KEY3:
                                 "&norecord=",KEY2:
                                 "&glint001=",GLINT001:
                                 "&glint002=",GLINT002:
                                 "&glint015=",GLINT015:
                                 "&subsectn=",SUBSECTN:
                                 "&keynward=",KEYNWARD;
.
          REP       "+ ",GLINT001
          REP       "+ ",GLINT002
          REP       "+ ",GLINT015
          REP       "+ ",KEYNWARD
.
NXTACC99  RETURN
.-------------------------------------------------------------
. Link to Prev GL Interface
.-------------------------------------------------------------
PRVACC00  MOVE      NORECORD,KEY2
          REP       " +",KEY2
          ASSIGN    STARTNUM-NORECORD,F3
          IF        F3<0
            MOVE      ZERO,F3
          ENDIF
          MOVE      F3,KEY3
          REP       " +",KEY3
          UNPACK    DIM127,D1,FLDPARA,DIM127
          MOVE      REPORTNO,F2
          REP       " +",GLINT001
          REP       " +",GLINT002
          REP       " +",GLINT015
          REP       " +",KEYNWARD
.
          WRITE     HTMLFILE;"patweb61.pbl":
                                 "?reportno=",F2:
                                 "&template=",FLDPARA:
                                 "&startnum=",KEY3:
                                 "&norecord=",KEY2:
                                 "&glint001=",GLINT001:
                                 "&glint002=",GLINT002:
                                 "&glint015=",GLINT015:
                                 "&subsectn=",SUBSECTN:
                                 "&keynward=",KEYNWARD;
.
          REP       "+ ",GLINT001
          REP       "+ ",GLINT002
          REP       "+ ",GLINT015
          REP       "+ ",KEYNWARD
.
PRVACC99  RETURN
+
.------------------------------------------------------------
.  Table System based GL Maintenance (TABLE ROWS)
.------------------------------------------------------------
.
SGLRW000  MATCH     "1",SYSGL001              * Accommodation
          GOTO      SGLRW100 IF EQUAL
          MATCH     "3",SYSGL001              * Misc Item
          GOTO      SGLRW300 IF EQUAL
          MATCH     "5",SYSGL001              * Journals
          GOTO      SGLRW500 IF EQUAL
          GOTO      SGLRW999
.
SGLRW100  CMATCH    "2",SUBSECTN             * Non-casemix
          GOTO      SGLRW105 IF EQUAL
          CMATCH    "3",SUBSECTN             * Casemix lumpsum
          GOTO      SGLRW150 IF EQUAL
          CMATCH    "4",SUBSECTN             * Casemix daily charge
          GOTO      SGLRW160 IF EQUAL
          GOTO      SGLRW999
.
SGLRW105  BRANCH    CACCFEE,SGLRW110:         * Ward/Claim
                            SGLRW120:         * Ward/Adm type
                            SGLRW130:         * Ward/Claim/Adm type
                            SGLRW140:         * Ward/Adm type/Claim
                            SGLRW142          * Claim type
.
.         Accommodation - Adm Type
.
          UNPACK    PMFMCODE,DIM1,ADMISSTP,KEY9
          MATCH     ADMISSTP,SP3
          GOTO      SGLRW999 IF EQUAL         * Mandatory field
          MATCH     KEY9,SP10
          GOTO      SGLRW999 IF NOT EQUAL     * eliminate incorrect data
.
          PACK      KEY5,CODEA,ADMISSTP,SP10
          CALL      RDCODE1
          IF        OVRCD=1
            PACK      TDESC,INVALIDS,ADMISSTP,INVALIDE,SP70
          ENDIF
.
          REP       " +",PMFMCODE
          REP       " +",PMFMHOSP
          WRITE     HTMLFILE;"<td nowrap><A HREF='javascript:ViewInterface":
                             "(#"",LINKPRG,"#.pbl":
                             "?reportno=",LINKREP:
                             "&template=",LINKTEM:
                             "&sysgl001=",PMFMRSUB:
                             "&subsectn=",SUBSECTN:
                             "&sysgl002=",PMFMCODE:
                             "&sysgl015=",PMFMHOSP,"#")'>":
                              "<img src=../images/MaintenanceIcon.gif hspace=4":
                              " border=0 align=absmiddle></a>":
                              TDESC,"</td>":
                              "<td>",LEDDESC1,"</td>":
                              "<td>",PMFMFCRD,"</td>":
                              "<td>",LEDDESC2,"</td></tr>";
          GOTO      SGLRW999
.
.         Accommodation - Ward/Claim code
.
SGLRW110  UNPACK    PMFMCODE,DIM1,ACCMWARD,CLAIMCOD
.
          MATCH     ACCMWARD,SP3
          IF        @EQUAL
            MOVE      "All Wards",WBDESC
          ELSE
            PACK      KEY6,ACCMWARD,SP10
            CALL      RDWARD1
            IF        OVRCD=1
              PACK      WBDESC,INVALIDS,ACCMWARD,INVALIDE,SP70
            ENDIF
          ENDIF
.
          MATCH     CLAIMCOD,SP3
          IF        @EQUAL
            MOVE      "All Claim Codes",TDESC
          ELSE
            PACK      KEY5,CODECL,CLAIMCOD,SP10
            CALL      RDCODE1
            IF        OVRCD=1
              PACK      TDESC,INVALIDS,CLAIMCOD,INVALIDE,SP70
            ENDIF
          ENDIF
.
          REP       " +",PMFMCODE
          REP       " +",PMFMHOSP
          WRITE     HTMLFILE;"<td nowrap><A HREF='javascript:ViewInterface":
                             "(#"",LINKPRG,"#.pbl":
                             "?reportno=",LINKREP:
                             "&template=",LINKTEM:
                             "&sysgl001=",PMFMRSUB:
                             "&subsectn=",SUBSECTN:
                             "&sysgl002=",PMFMCODE:
                             "&sysgl015=",PMFMHOSP,"#")'>":
                              "<img src=../images/MaintenanceIcon.gif hspace=4":
                              " border=0 align=absmiddle></a>":
                              WBDESC,"</td>":
                              "<td>",LEDDESC1,"</td>":
                              "<td>",PMFMFCRD,"</td>":
                              "<td>",LEDDESC2,"</td></tr>";
          GOTO      SGLRW999
.
.         Accommodation - Ward/Adm.Type
.
SGLRW120  UNPACK    PMFMCODE,DIM1,ACCMWARD,ADMISSTP
.
          MATCH     ACCMWARD,SP3
          IF        @EQUAL
            MOVE      "All Wards",WBDESC
          ELSE
            PACK      KEY6,ACCMWARD,SP10
            CALL      RDWARD1
            IF        OVRCD=1
              PACK      WBDESC,INVALIDS,ACCMWARD,INVALIDE,SP70
            ENDIF
          ENDIF
.
          MATCH     ADMISSTP,SP3
          IF        @EQUAL
            MOVE      "All Admission Types",TDESC
          ELSE
            PACK      KEY5,CODEA,ADMISSTP,SP10
            CALL      RDCODE1
            IF        OVRCD=1
              PACK      TDESC,INVALIDS,ADMISSTP,INVALIDE,SP70
            ENDIF
          ENDIF
.
          REP       " +",PMFMCODE
          REP       " +",PMFMHOSP
          WRITE     HTMLFILE;"<td nowrap><A HREF='javascript:ViewInterface":
                             "(#"",LINKPRG,"#.pbl":
                             "?reportno=",LINKREP:
                             "&template=",LINKTEM:
                             "&sysgl001=",PMFMRSUB:
                             "&subsectn=",SUBSECTN:
                             "&sysgl002=",PMFMCODE:
                             "&sysgl015=",PMFMHOSP,"#")'>":
                              "<img src=../images/MaintenanceIcon.gif hspace=4":
                              " border=0 align=absmiddle></a>":
                              WBDESC,"</td>":
                              "<td>",LEDDESC1,"</td>":
                              "<td>",PMFMFCRD,"</td>":
                              "<td>",LEDDESC2,"</td></tr>";
          GOTO      SGLRW999
.
.         Accommodation - Ward/Claim code/Adm Type
.
SGLRW130  UNPACK    PMFMCODE,DIM1,ACCMWARD,CLAIMCOD,ADMISSTP
.
          MATCH     ACCMWARD,SP3
          IF        @EQUAL
            MOVE      "All Wards",WBDESC
          ELSE
            PACK      KEY6,ACCMWARD,SP10
            CALL      RDWARD1
            IF        OVRCD=1
              PACK      WBDESC,INVALIDS,ACCMWARD,INVALIDE,SP70
            ENDIF
          ENDIF
.
          MATCH     CLAIMCOD,SP3
          IF        @EQUAL
            MOVE      "All Claim Codes",KEY20
          ELSE
            PACK      KEY5,CODECL,CLAIMCOD,SP10
            CALL      RDCODE1
            IF        OVRCD=1
              PACK      KEY20,INVALIDS,CLAIMCOD,INVALIDE,SP70
            ELSE
              PACK      KEY20,TDESC,SP70
            ENDIF
          ENDIF
.
          MATCH     ADMISSTP,SP3
          IF        @EQUAL
            MOVE      "All Admission Types",TDESC
          ELSE
            PACK      KEY5,CODEA,ADMISSTP,SP10
            CALL      RDCODE1
            IF        OVRCD=1
              PACK      TDESC,INVALIDS,ADMISSTP,INVALIDE,SP70
            ENDIF
          ENDIF
.
          REP       " +",PMFMCODE
          REP       " +",PMFMHOSP
          WRITE     HTMLFILE;"<td nowrap><A HREF='javascript:ViewInterface":
                             "(#"",LINKPRG,"#.pbl":
                             "?reportno=",LINKREP:
                             "&template=",LINKTEM:
                             "&sysgl001=",PMFMRSUB:
                             "&subsectn=",SUBSECTN:
                             "&sysgl002=",PMFMCODE:
                             "&sysgl015=",PMFMHOSP,"#")'>":
                              "<img src=../images/MaintenanceIcon.gif hspace=4":
                              " border=0 align=absmiddle></a>":
                              WBDESC,"</td>":
                              "<td>",KEY20,"</td>":
                              "<td>",TDESC,"</td>":
                              "<td>",LEDDESC1,"</td>":
                              "<td>",PMFMFCRD,"</td>":
                              "<td>",LEDDESC2,"</td></tr>";
          GOTO      SGLRW999
.
.         Accommodation - Ward/Adm Type/Claim code
.
SGLRW140  UNPACK    PMFMCODE,DIM1,ACCMWARD,ADMISSTP,CLAIMCOD,KEY3
          MATCH     ACCMWARD,SP3
          IF        @EQUAL
            MOVE      "All Wards",WBDESC
          ELSE
            PACK      KEY6,ACCMWARD,SP10
            CALL      RDWARD1
            IF        OVRCD=1
              PACK      WBDESC,INVALIDS,ACCMWARD,INVALIDE,SP70
            ENDIF
          ENDIF
.
          MATCH     ADMISSTP,SP3
          IF        @EQUAL
            MOVE      "All Admission Types",KEY20
          ELSE
            PACK      KEY5,CODEA,ADMISSTP,SP10
            CALL      RDCODE1
            IF        OVRCD=1
              PACK      KEY20,INVALIDS,ADMISSTP,INVALIDE,SP70
            ELSE
              PACK      KEY20,TDESC,SP70
            ENDIF
          ENDIF
.
          MATCH     CLAIMCOD,SP3
          IF        @EQUAL
            MOVE      "All Claim Codes",TDESC
          ELSE
            PACK      KEY5,CODECL,CLAIMCOD,SP10
            CALL      RDCODE1
            IF        OVRCD=1
              PACK      TDESC,INVALIDS,CLAIMCOD,INVALIDE,SP70
            ENDIF
          ENDIF
.
          REP       " +",PMFMCODE
          REP       " +",PMFMHOSP
          WRITE     HTMLFILE;"<td nowrap><A HREF='javascript:ViewInterface":
                             "(#"",LINKPRG,"#.pbl":
                             "?reportno=",LINKREP:
                             "&template=",LINKTEM:
                             "&sysgl001=",PMFMRSUB:
                             "&subsectn=",SUBSECTN:
                             "&sysgl002=",PMFMCODE:
                             "&sysgl015=",PMFMHOSP,"#")'>":
                              "<img src=../images/MaintenanceIcon.gif hspace=4":
                              " border=0 align=absmiddle></a>":
                              WBDESC,"</td>":
                              "<td>",KEY20,"</td>":
                              "<td>",TDESC,"</td>":
                              "<td>",LEDDESC1,"</td>":
                              "<td>",PMFMFCRD,"</td>":
                              "<td>",LEDDESC2,"</td></tr>";
          GOTO      SGLRW999
.
.         Accommodation - Claim Type
.
SGLRW142  UNPACK    PMFMCODE,DIM1,CLAIMCOD,KEY9
          MATCH     CLAIMCOD,SP3
          GOTO      SGLRW999 IF EQUAL         * Mandatory field
          MATCH     KEY9,SP10
          GOTO      SGLRW999 IF NOT EQUAL     * eliminate incorrect data
.
          PACK      KEY5,CODECL,CLAIMCOD,SP10
          CALL      RDCODE1
          IF        OVRCD=1
            PACK      TDESC,INVALIDS,CLAIMCOD,INVALIDE,SP70
          ENDIF
.
          REP       " +",PMFMCODE
          REP       " +",PMFMHOSP
          WRITE     HTMLFILE;"<td nowrap><A HREF='javascript:ViewInterface":
                             "(#"",LINKPRG,"#.pbl":
                             "?reportno=",LINKREP:
                             "&template=",LINKTEM:
                             "&sysgl001=",PMFMRSUB:
                             "&subsectn=",SUBSECTN:
                             "&sysgl002=",PMFMCODE:
                             "&sysgl015=",PMFMHOSP,"#")'>":
                              "<img src=../images/MaintenanceIcon.gif hspace=4":
                              " border=0 align=absmiddle></a>":
                              TDESC,"</td>":
                              "<td>",LEDDESC1,"</td>":
                              "<td>",PMFMFCRD,"</td>":
                              "<td>",LEDDESC2,"</td></tr>";
          GOTO      SGLRW999
.
.         Accommodation - Casemix lumpsum
.
SGLRW150  UNPACK    PMFMCODE,DIM1,EPISODTP,ADMISSTP,KEY8
          IF        CACCFEE=5
            UNPACK    PMFMCODE,DIM1,EPISODTP,CLAIMCOD,KEY8
          ENDIF
          MATCH     EPISODTP,SP1
          GOTO      SGLRW999 IF EQUAL         * Mandatory field
.
          PACK      KEY11,INVALIDS,EPISODTP,INVALIDE,SP10
          MATCH     "0",EPISODTP
          IF        @EQUAL
            MOVE    "MSO",KEY11
          ENDIF
          MATCH     "1",EPISODTP
          IF        @EQUAL
            MOVE    "DAYCASE",KEY11
          ENDIF
.
          COMPARE   FIVE,CACCFEE
          GOTO      SGLRW152 IF NOT EQUAL      * Not by Claim type
.
          MATCH     CLAIMCOD,SP3
          IF        @EQUAL
            MOVE      "All Claim Types",TDESC
          ELSE
            PACK      KEY5,CODECL,CLAIMCOD,SP10
            CALL      RDCODE1
            IF        OVRCD=1
              PACK      TDESC,INVALIDS,CLAIMCOD,INVALIDE,SP70
            ENDIF
          ENDIF
          GOTO      SGLRW154
.
SGLRW152  MATCH     ADMISSTP,SP3
          IF        @EQUAL
            MOVE      "All Admission Types",TDESC
          ELSE
            PACK      KEY5,CODEA,ADMISSTP,SP10
            CALL      RDCODE1
            IF        OVRCD=1
              PACK      TDESC,INVALIDS,ADMISSTP,INVALIDE,SP70
            ENDIF
          ENDIF
.
SGLRW154  REP       " +",PMFMCODE
          REP       " +",PMFMHOSP
          WRITE     HTMLFILE;"<td nowrap><A HREF='javascript:ViewInterface":
                             "(#"",LINKPRG,"#.pbl":
                             "?reportno=",LINKREP:
                             "&template=",LINKTEM:
                             "&sysgl001=",PMFMRSUB:
                             "&subsectn=",SUBSECTN:
                             "&sysgl002=",PMFMCODE:
                             "&sysgl015=",PMFMHOSP,"#")'>":
                              "<img src=../images/MaintenanceIcon.gif hspace=4":
                              " border=0 align=absmiddle></a>":
                              KEY11,"</td>":
                              "<td>",TDESC,"</td>":
                              "<td>",LEDDESC1,"</td>":
                              "<td>",PMFMFCRD,"</td>":
                              "<td>",LEDDESC2,"</td></tr>";
          GOTO      SGLRW999
.
.         Accommodation - Casemix daily charge
.
SGLRW160  COMPARE   FIVE,CACCFEE
          GOTO      SGLRW162 IF NOT EQUAL     * Not by Claim type
.
          UNPACK    PMFMCODE,DIM1,CLAIMCOD,KEY9
          MATCH     CLAIMCOD,SP3
          GOTO      SGLRW999 IF EQUAL         * Mandatory field
.
          PACK      KEY5,CODECL,CLAIMCOD,SP10
          CALL      RDCODE1
          IF        OVRCD=1
            PACK      TDESC,INVALIDS,CLAIMCOD,INVALIDE,SP70
          ENDIF
          GOTO      SGLRW164
.
SGLRW162  UNPACK    PMFMCODE,DIM1,ACCMWARD,KEY9
          MATCH     ACCMWARD,SP3
          GOTO      SGLRW999 IF EQUAL         * Mandatory field
.
          PACK      KEY6,ACCMWARD,SP10
          CALL      RDWARD1
          IF        OVRCD=1
            PACK      WBDESC,INVALIDS,ACCMWARD,INVALIDE,SP70
          ENDIF
.
SGLRW164  REP       " +",PMFMCODE
          REP       " +",PMFMHOSP
          WRITE     HTMLFILE;"<td nowrap><A HREF='javascript:ViewInterface":
                             "(#"",LINKPRG,"#.pbl":
                             "?reportno=",LINKREP:
                             "&template=",LINKTEM:
                             "&sysgl001=",PMFMRSUB:
                             "&subsectn=",SUBSECTN:
                             "&sysgl002=",PMFMCODE:
                             "&sysgl015=",PMFMHOSP,"#")'>":
                              "<img src=../images/MaintenanceIcon.gif hspace=4":
                              " border=0 align=absmiddle></a>";
.
          IF        CACCFEE=5
            WRITE     HTMLFILE;TDESC,"</td>";
          ELSE
            WRITE     HTMLFILE;WBDESC,"</td>";
          ENDIF
.
          WRITE     HTMLFILE;"<td>",LEDDESC1,"</td>":
                             "<td>",PMFMFCRD,"</td>":
                             "<td>",LEDDESC2,"</td></tr>";
          GOTO      SGLRW999
.
.         Misc items
.
SGLRW300  CMATCH    "2",SUBSECTN            * Group Codes
          GOTO      SGLRW310 IF EQUAL
          CMATCH    "3",SUBSECTN            * Item/Claim Codes
          GOTO      SGLRW320 IF EQUAL
          CMATCH    "4",SUBSECTN            * Casemix Group Codes
          GOTO      SGLRW330 IF EQUAL
          CMATCH    "5",SUBSECTN            * Casemix Item/Claim Codes
          GOTO      SGLRW340 IF EQUAL
          GOTO      SGLRW999
.
.         Misc Item - Group Codes
.
SGLRW310  IF        PTCNMFEE=1
            UNPACK    PMFMCODE,DIM1,DIM3,GROUPCOD,KEY6
            MATCH     DIM3,SP3
            GOTO      SGLRW999 IF NOT EQUAL         * Eliminate incorrect data
          ELSE
            UNPACK    PMFMCODE,DIM1,GROUPCOD,KEY9
            MATCH     KEY9,SP10
            GOTO      SGLRW999 IF NOT EQUAL         * Eliminate incorrect data
          ENDIF
          MATCH     GROUPCOD,SP3
          GOTO      SGLRW999 IF EQUAL               * Mandatory field
.
          PACK      KEY5,CODEFI,GROUPCOD,SP10
          CALL      RDCODE1
          IF        OVRCD=1
            PACK      TDESC,INVALIDS,GROUPCOD,INVALIDE,SP70
          ENDIF
.
          REP       " +",PMFMCODE
          REP       " +",PMFMHOSP
          WRITE     HTMLFILE;"<td nowrap><A HREF='javascript:ViewInterface":
                             "(#"",LINKPRG,"#.pbl":
                             "?reportno=",LINKREP:
                             "&template=",LINKTEM:
                             "&sysgl001=",PMFMRSUB:
                             "&subsectn=",SUBSECTN:
                             "&sysgl002=",PMFMCODE:
                             "&sysgl015=",PMFMHOSP,"#")'>":
                              "<img src=../images/MaintenanceIcon.gif hspace=4":
                              " border=0 align=absmiddle></a>":
                              TDESC,"</td>":
                              "<td>",LEDDESC1,"</td>":
                              "<td>",PMFMFCRD,"</td>":
                              "<td>",LEDDESC2,"</td></tr>";
          GOTO      SGLRW999
.
.         Misc Item - Item/Claim codes
.
SGLRW320  BRANCH    PTCNMFEE,SGLRW325
          UNPACK    PMFMCODE,DIM1,DIM3,ITEMCODE,KEY6 * Item codes
          MATCH     DIM3,SP3
          GOTO      SGLRW999 IF NOT EQUAL           * Eliminate incorrect data
          MATCH     ITEMCODE,SP3
          GOTO      SGLRW999 IF EQUAL               * Mandatory field
.
.*        PACK      KEY17,ITEMCODE,SP10
.*        CALL      PATITMRD
.*        IF        OVRCD=1
.*          PACK      IDESC,ITEMCODE,SP70
.*        ENDIF
.*        MOVE      IDESC,TDESC
          MOVE      ITEMCODE,TDESC
          GOTO      SGLRW329
.
.         Claim Code/Misc.group
.
SGLRW325  UNPACK    PMFMCODE,DIM1,CLAIMCOD,GROUPCOD      * Claim codes
          MATCH     CLAIMCOD,SP3
          GOTO      SGLRW999 IF EQUAL               * Mandatory field
.
          MOVE      "All Item Groups     ",GROUPDES
          MATCH     SP10,GROUPCOD
          IF        !@EQUAL
            PACK      KEY5,CODEFI,GROUPCOD,SP10
            CALL      RDCODE1
            IF        OVRCD=1
              PACK      GROUPDES,INVALIDS,GROUPCOD,INVALIDE,SP70
            ELSE
              PACK      GROUPDES,TDESC,SP70
            ENDIF
          ENDIF
.
          PACK      KEY5,CODECL,CLAIMCOD,SP10
          CALL      RDCODE1
          IF        OVRCD=1
            PACK      TDESC,INVALIDS,CLAIMCOD,INVALIDE,SP70
          ENDIF
.
SGLRW329  REP       " +",PMFMCODE
          REP       " +",PMFMHOSP
          WRITE     HTMLFILE;"<td nowrap><A HREF='javascript:ViewInterface":
                             "(#"",LINKPRG,"#.pbl":
                             "?reportno=",LINKREP:
                             "&template=",LINKTEM:
                             "&sysgl001=",PMFMRSUB:
                             "&subsectn=",SUBSECTN:
                             "&sysgl002=",PMFMCODE:
                             "&sysgl015=",PMFMHOSP,"#")'>":
                              "<img src=../images/MaintenanceIcon.gif hspace=4":
                              " border=0 align=absmiddle></a>":
                              TDESC,"</td>";
.
          IF        PTCNMFEE=1
            WRITE     HTMLFILE;"<td>",GROUPDES,"</td>";
          ENDIF
.
          WRITE     HTMLFILE;"<td>",LEDDESC1,"</td>":
                              "<td>",PMFMFCRD,"</td>":
                              "<td>",LEDDESC2,"</td></tr>";
          GOTO      SGLRW999
.
.         Misc Item - Casemix Group Codes
.
SGLRW330  IF        PTCNMFEE=1
            UNPACK    PMFMCODE,DIM1,EPISODTP,DIM3,GROUPCOD,KEY6
            MATCH     DIM3,SP3
            GOTO      SGLRW999 IF NOT EQUAL         * Eliminate incorrect data
          ELSE
            UNPACK    PMFMCODE,DIM1,EPISODTP,GROUPCOD,KEY9
            MATCH     KEY9,SP10
            GOTO      SGLRW999 IF NOT EQUAL         * Eliminate incorrect data
          ENDIF
          MATCH     EPISODTP,SP1
          GOTO      SGLRW999 IF EQUAL               * Mandatory field
          MATCH     GROUPCOD,SP3
          GOTO      SGLRW999 IF EQUAL               * Mandatory field
.
          PACK      KEY11,INVALIDS,EPISODTP,INVALIDE,SP10
          MATCH     "0",EPISODTP
          IF        @EQUAL
            MOVE    "MSO",KEY11
          ENDIF
          MATCH     "1",EPISODTP
          IF        @EQUAL
            MOVE    "DAYCASE",KEY11
          ENDIF
.
          PACK      KEY5,CODEFI,GROUPCOD,SP10
          CALL      RDCODE1
          IF        OVRCD=1
            PACK      TDESC,INVALIDS,GROUPCOD,INVALIDE,SP70
          ENDIF
.
          REP       " +",PMFMCODE
          REP       " +",PMFMHOSP
          WRITE     HTMLFILE;"<td nowrap><A HREF='javascript:ViewInterface":
                             "(#"",LINKPRG,"#.pbl":
                             "?reportno=",LINKREP:
                             "&template=",LINKTEM:
                             "&sysgl001=",PMFMRSUB:
                             "&subsectn=",SUBSECTN:
                             "&sysgl002=",PMFMCODE:
                             "&sysgl015=",PMFMHOSP,"#")'>":
                              "<img src=../images/MaintenanceIcon.gif hspace=4":
                              " border=0 align=absmiddle></a>":
                              KEY11,"</td>":
                              "<td>",TDESC,"</td>":
                              "<td>",LEDDESC1,"</td>":
                              "<td>",PMFMFCRD,"</td>":
                              "<td>",LEDDESC2,"</td></tr>";
          GOTO      SGLRW999
.
.         Misc Item - Casemix Item/Claim codes
.
SGLRW340  BRANCH    PTCNMFEE,SGLRW345
          UNPACK    PMFMCODE,DIM1,EPISODTP,DIM3,ITEMCODE,KEY6 * Item codes
          MATCH     DIM3,SP3
          GOTO      SGLRW999 IF NOT EQUAL           * Eliminate incorrect data
          MATCH     EPISODTP,SP1
          GOTO      SGLRW999 IF EQUAL               * Mandatory field
          MATCH     ITEMCODE,SP3
          IF        @EQUAL
            MOVE      "All Item Codes",TDESC
          ELSE
            MOVE      ITEMCODE,TDESC
          ENDIF
.
.**       PACK      KEY17,ITEMCODE,SP10
.**       CALL      PATITMRD
.**       IF        OVRCD=1
.**         PACK      IDESC,ITEMCODE,SP70
.**       ENDIF
.**       MOVE      IDESC,TDESC
          GOTO      SGLRW349
.
SGLRW345  UNPACK    PMFMCODE,DIM1,EPISODTP,CLAIMCOD,GROUPCOD  * Claim codes
          MATCH     EPISODTP,SP1
          GOTO      SGLRW999 IF EQUAL               * Mandatory field
          MATCH     CLAIMCOD,SP3
          GOTO      SGLRW999 IF EQUAL               * Mandatory field
.
          MOVE      "All Item Groups     ",GROUPDES
          MATCH     SP10,GROUPCOD
          IF        !@EQUAL
            PACK      KEY5,CODEFI,GROUPCOD,SP10
            CALL      RDCODE1
            IF        OVRCD=1
              PACK      GROUPDES,INVALIDS,GROUPCOD,INVALIDE,SP70
            ELSE
              PACK      GROUPDES,TDESC,SP70
            ENDIF
          ENDIF
.
          PACK      KEY5,CODECL,CLAIMCOD,SP10
          CALL      RDCODE1
          IF        OVRCD=1
            PACK      TDESC,INVALIDS,CLAIMCOD,INVALIDE,SP70
          ENDIF
.
SGLRW349  PACK      KEY11,INVALIDS,EPISODTP,INVALIDE,SP10
          MATCH     "0",EPISODTP
          IF        @EQUAL
            MOVE    "MSO",KEY11
          ENDIF
          MATCH     "1",EPISODTP
          IF        @EQUAL
            MOVE    "DAYCASE",KEY11
          ENDIF
.
          REP       " +",PMFMCODE
          REP       " +",PMFMHOSP
          WRITE     HTMLFILE;"<td nowrap><A HREF='javascript:ViewInterface":
                             "(#"",LINKPRG,"#.pbl":
                             "?reportno=",LINKREP:
                             "&template=",LINKTEM:
                             "&sysgl001=",PMFMRSUB:
                             "&subsectn=",SUBSECTN:
                             "&sysgl002=",PMFMCODE:
                             "&sysgl015=",PMFMHOSP,"#")'>":
                              "<img src=../images/MaintenanceIcon.gif hspace=4":
                              " border=0 align=absmiddle></a>":
                              KEY11,"</td>":
                              "<td>",TDESC,"</td>";
.
          IF        PTCNMFEE=1
            WRITE     HTMLFILE;"<td>",GROUPDES,"</td>";
          ENDIF
.
          WRITE     HTMLFILE;"<td>",LEDDESC1,"</td>":
                              "<td>",PMFMFCRD,"</td>":
                              "<td>",LEDDESC2,"</td></tr>";
          GOTO      SGLRW999
.
.         Journals
.
SGLRW500  CMATCH    "2",SUBSECTN            * Journal Codes
          GOTO      SGLRW510 IF EQUAL
          GOTO      SGLRW999
.
SGLRW510  COMPARE   ONE,PTCNJFEE
          GOTO      SGLRW520 IF EQUAL
.
          UNPACK    PMFMCODE,JOURNALC,KEY11
          MATCH     JOURNALC,SP2
          GOTO      SGLRW999 IF EQUAL               * Mandatory field
          MATCH     KEY11,SP20
          GOTO      SGLRW999 IF NOT EQUAL           * eliminate incorrect data
.
          PACK      KEY5,CODEJ,JOURNALC,SP10
          CALL      RDCODE1
          IF        OVRCD=1
            PACK      TDESC,INVALIDS,JOURNALC,INVALIDE,SP70
          ENDIF
.
          REP       " +",PMFMCODE
          REP       " +",PMFMHOSP
          WRITE     HTMLFILE;"<td nowrap><A HREF='javascript:ViewInterface":
                             "(#"",LINKPRG,"#.pbl":
                             "?reportno=",LINKREP:
                             "&template=",LINKTEM:
                             "&sysgl001=",PMFMRSUB:
                             "&subsectn=",SUBSECTN:
                             "&sysgl002=",PMFMCODE:
                             "&sysgl015=",PMFMHOSP,"#")'>":
                              "<img src=../images/MaintenanceIcon.gif hspace=4":
                              " border=0 align=absmiddle></a>":
                              TDESC,"</td>":
                              "<td>",LEDDESC1,"</td>":
                              "<td>",PMFMFCRD,"</td>":
                              "</tr>";
          GOTO      SGLRW999
.
SGLRW520  UNPACK    PMFMCODE,CLAIMCOD,JOURNALC
          MATCH     SP70,CLAIMCOD
          GOTO      SGLRW999 IF EQUAL               * Mandatory field
.
          PACK      KEY5,CODEJ,JOURNALC,SP10
          CALL      RDCODE1
          IF        OVRCD=1
            PACK      TDESC,INVALIDS,JOURNALC,INVALIDE,SP70
          ENDIF
          MOVE      TDESC,KEY20
          MATCH     CLAIMCOD,SP3
          IF        @EQUAL
            MOVE      "All Claim Codes",TDESC
          ELSE
            PACK      KEY5,CODECL,CLAIMCOD,SP10
            CALL      RDCODE1
            IF        OVRCD=1
              PACK      TDESC,INVALIDS,CLAIMCOD,INVALIDE,SP70
            ENDIF
          ENDIF
.
          REP       " +",PMFMCODE
          REP       " +",PMFMHOSP
          WRITE     HTMLFILE;"<td nowrap><A HREF='javascript:ViewInterface":
                             "(#"",LINKPRG,"#.pbl":
                             "?reportno=",LINKREP:
                             "&template=",LINKTEM:
                             "&sysgl001=",PMFMRSUB:
                             "&subsectn=",SUBSECTN:
                             "&sysgl002=",PMFMCODE:
                             "&sysgl015=",PMFMHOSP,"#")'>":
                              "<img src=../images/MaintenanceIcon.gif hspace=4":
                              " border=0 align=absmiddle></a>":
                              TDESC,"</td>":
                              "<td>",KEY20,"</td>":
                              "<td>",LEDDESC1,"</td>":
                              "<td>",PMFMFCRD,"</td>":
                              "</tr>";
          GOTO      SGLRW999
SGLRW999  RETURN
+
.-----------------------------------------------------------
. Link to Next System based GL Interface        
.-----------------------------------------------------------
NXTSAC00  MOVE      NORECORD,KEY2
          REP       " +",KEY2
          ASSIGN    STARTNUM+NORECORD,F3
          MOVE      F3,KEY3
          REP       " +",KEY3
          UNPACK    DIM127,D1,FLDPARA,DIM127
          MOVE      REPORTNO,F2
          REP       " +",SYSGL001
          REP       " +",SYSGL002
          REP       " +",SYSGL015
          REP       " +",SYSGL016
.
          WRITE     HTMLFILE;"patweb61.pbl":
                                 "?reportno=",F2:
                                 "&template=",FLDPARA:
                                 "&startnum=",KEY3:
                                 "&norecord=",KEY2:
                                 "&sysgl001=",SYSGL001:
                                 "&sysgl002=",SYSGL002:
                                 "&sysgl015=",SYSGL015:
                                 "&sysgl016=",SYSGL016:
                                 "&subsectn=",SUBSECTN;
.
          REP       "+ ",SYSGL001
          REP       "+ ",SYSGL002
          REP       "+ ",SYSGL015
          REP       "+ ",SYSGL016
.
NXTSAC99  RETURN
.-------------------------------------------------------------
. Link to Prev GL Interface        
.-------------------------------------------------------------
PRVSAC00  MOVE      NORECORD,KEY2
          REP       " +",KEY2
          ASSIGN    STARTNUM-NORECORD,F3
          IF        F3<0
            MOVE      ZERO,F3
          ENDIF
          MOVE      F3,KEY3
          REP       " +",KEY3
          UNPACK    DIM127,D1,FLDPARA,DIM127
          MOVE      REPORTNO,F2
          REP       " +",SYSGL001
          REP       " +",SYSGL002
          REP       " +",SYSGL015
          REP       " +",SYSGL016
.
          WRITE     HTMLFILE;"patweb61.pbl":
                                 "?reportno=",F2:
                                 "&template=",FLDPARA:
                                 "&startnum=",KEY3:
                                 "&norecord=",KEY2:
                                 "&sysgl001=",SYSGL001:
                                 "&sysgl002=",SYSGL002:
                                 "&sysgl015=",SYSGL015:
                                 "&sysgl016=",SYSGL016:
                                 "&subsectn=",SUBSECTN;
.
          REP       "+ ",SYSGL001
          REP       "+ ",SYSGL002
          REP       "+ ",SYSGL015
          REP       "+ ",SYSGL016
.
PRVSAC99  RETURN
.
.------------------------------------------------------------------------------
. Fee Estimate Regime Maintenance
.------------------------------------------------------------------------------
REGM0000  RESET     UPDTTYPE
          MATCH     SP1,UPDTTYPE            * Display formaction
          GOTO      REGM8000 IF EQUAL
.
          MATCH     "A",UPDTTYPE            * Add formaction
          GOTO      REGM1000 IF EQUAL
.
          MATCH     "U",UPDTTYPE            * Upate formaction
          GOTO      REGM2000 IF EQUAL
.
          MATCH     "D",UPDTTYPE            * Delete formaction
          GOTO      REGM3000 IF EQUAL
.
          MATCH     "M",UPDTTYPE            * Add Item to Regime
          GOTO      REGM4000 IF EQUAL
.
          MATCH     "R",UPDTTYPE            * Delete Item to Regime
          GOTO      REGM5000 IF EQUAL
.
          GOTO      REGM9300
.
.         ************ ADD FORMACTION ***********
.
REGM1000  MOVE      "  0",PMREG002
          PACK      KEY13,PMREG001,PMREG002,SP70
          CALL      RDPMREG1
          COMPARE   ZERO,OVRCD              * Does record already exist?
          GOTO      REGM9200 IF EQUAL       * Yes, display error message
.
          CALL      MVPMRE00
.
          CALL      WRPMREG1                * Write new record
.
          MOVE      ZERO,EXIT
          GOTO      REGM9999
.
.         ************ UPDATE FORMACTION **********
.
REGM2000  PACK      KEY13,PMREG001,PMREG002,SP70
          CALL      RDPMREG1                * Does record exist?
          BRANCH    OVRCD,REGM9100          * No, Display error message
.
          CALL      MVPMRE00
.
          CALL      UPPMREG1                * Update record
.
          MOVE      ZERO,EXIT
          GOTO      REGM9999
.
.         ************ DELETE FORMACTION **********
.
REGM3000  PACK      KEY13,PMREG001,PMREG002,SP70
          CALL      RDPMREG1                * Does record exist?
          BRANCH    OVRCD,REGM3000          * No, Display error message
.
REGM3100  PACK      KEY13,PMREG001,SP70
          CALL      RSPMREG1                * Yes, Delete record
          CALL      RKPMREG1
          BRANCH    OVRCD,REGM3200
.
          MATCH     PMREG001,PMREREGM
          GOTO      REGM3200 IF NOT EQUAL
.
          PACK      KEY13,PMREREGM,PMREUNIQ,SP70 
          CALL      DEPMREG1
          GOTO      REGM3100 
.
REGM3200  MOVE      ZERO,EXIT
          GOTO      REGM9999
.
.         ************ ADD ITEM TO REGIME FORMACTION **********
.
REGM4000  MATCH     "2",PMREG004
          GOTO      REGM4100 IF NOT EQUAL   * Regime code?
          CALL      CHKR0000                * Check for the regime code
          BRANCH    EXIT,REGM9400    * Can't have reg.code with another reg.code
.
REGM4100  PACK      KEY13,PMREG001,SP1,SP1,ZERO,SP70
          CALL      RDPMREG1                * Does record exist?
          BRANCH    OVRCD,REGM9100          * No, Display error message
.
          MOVE      ONE,F3
          PACK      KEY13,PMREG001,Z70
          CALL      RSPMREG1                     * Generate sequence number
          CALL      RPPMREG1
          BRANCH    OVRCD,REGM4200
.
          MATCH     PMREG001,PMREREGM
          GOTO      REGM4200 IF NOT EQUAL
.
          MOVE      PMREUNIQ,F3
          ADD       ONE,F3
.
REGM4200  CALL      CLPMRE00                     * Clear file vars
          CALL      MVPMRE00                     * Move cgi to file variables
.
          MOVE      F3,PMREUNIQ                  * Allocate sequence number
          MOVE      "0",PMREACTV                 * Active
.
          PACK      KEY13,PMREREGM,PMREUNIQ,SP70
          CALL      WRPMREG1
.
          MOVE      ZERO,EXIT
          GOTO      REGM9999
.
.         ************ DELETE MISCH CHARGE FROM REGIME FORMACTION **********
.
REGM5000  PACK      KEY13,PMREG001,PMREG002,SP70
          CALL      RDPMREG1                * Does record exist?
          BRANCH    OVRCD,REGM3000          * No, Display error message
.
          PACK      KEY13,PMREREGM,PMREUNIQ,SP70
          CALL      DEPMREG1
.
          MOVE      ZERO,EXIT
          GOTO      REGM9999
.
.         ************ DISPLAY FORMACTION **********
.
REGM8000  MATCH     SP70,PMREG002
          IF        @EQUAL
            MOVE      "  0",PMREG002
          ENDIF
.
          PACK      KEY13,PMREG001,PMREG002,SP70
          CALL      RDPMREG1
          IF        OVRCD=1
            CALL      CLPMRE00              * Clear all the file variables
          ENDIF
.
          CLEAR     WEBTITLE
          MOVE      "Regime Code Maintenance",WEBTITLE
          RESET     WEBTITLE
.
          CALL      WEBHED00                * Output File & Write HTML Pg Header
          BRANCH    EXIT,REGM9999
.
          CALL      WEBBOD00                * Process Web Body
.
          CALL      WEBEND00                * Process End of HTML File
.
          MOVE      ONE,EXIT
          GOTO      REGM9999
.
.         ************ DISPLAY ERROR MESSAGE **********
.
REGM9100  MOVE      "Regime Code record does not exist",WEBTITLE
          CALL      WEBERR00
          MOVE      ONE,EXIT
          GOTO      REGM9999
.
REGM9200  MOVE      "Regime Code record exists",WEBTITLE
          CALL      WEBERR00
          MOVE      ONE,EXIT
          GOTO      REGM9999
.
REGM9300  MOVE      "Invalid Form Action.",WEBTITLE
          CALL      WEBERR00
          MOVE      ONE,EXIT
          GOTO      REGM9999
.
REGM9400  MOVE      "This Regime Code has another Regime Code.",WEBTITLE
          CALL      WEBERR00
          MOVE      ONE,EXIT
          GOTO      REGM9999
.
REGM9999  RETURN
.
.------------------------------------------------------------
.         Check if this regime code has another regime code
.------------------------------------------------------------
CHKR0000  MOVE      ZERO,EXIT
          PACK      KEY13,PMREG005,SP70
          CALL      RSPMREG1                     * Generate sequence number
CHKR1000  CALL      RKPMREG1
          BRANCH    OVRCD,CHKR9999
.
          MATCH     PMREG005,PMREREGM
          GOTO      CHKR9999 IF NOT EQUAL
.
          MATCH     "2",PMREITYP                 * Item type
          GOTO      CHKR1000 IF NOT EQUAL
          MOVE      ONE,EXIT
CHKR9999  RETURN
+
.------------------------------------------------------------
. Set Parameters for fee estimate regime maintenance
.------------------------------------------------------------
SPREG000  UNPACK    QRYNAME,KEY5,KEY3
          MOVE      KEY3,F3
          BRANCH    F3,SPREG010,SPREG020,SPREG030,SPREG040,SPREG050:
                       SPREG060,SPREG070,SPREG080
.
          GOTO      SPREG999
.
SPREG010  SQUEEZE   QRYDATA
          MOVE      QRYDATA,PMREG001
          PACK      PMREG001,PMREG001,SP70
          GOTO      SPREG999
.
SPREG020  PACK      PMREG002,QRYDATA,SP70
          GOTO      SPREG999
.
SPREG030  PACK      PMREG003,QRYDATA,SP70
          GOTO      SPREG999
.
SPREG040  PACK      PMREG004,QRYDATA,SP70
          GOTO      SPREG999
.
SPREG050  PACK      PMREG005,QRYDATA,SP70
          GOTO      SPREG999
.
SPREG060  PACK      PMREG006,QRYDATA,SP70
          GOTO      SPREG999
.
SPREG070  SQUEEZE   QRYDATA
          MOVE      QRYDATA,PMREG007
          GOTO      SPREG999
.
SPREG080  PACK      PMREG008,QRYDATA,SP70
          GOTO      SPREG999
.
SPREG999  RETURN
.
.------------------------------------------------------------------------------
. Moves cgi variables into file variables (Regime Maintenance)
.------------------------------------------------------------------------------
MVPMRE00  MOVE      PMREG001,PMREREGM
          MOVE      PMREG002,PMREUNIQ
          MOVE      PMREG003,PMREDESC
          MOVE      PMREG004,PMREITYP
          MOVE      PMREG005,PMREITMN
          MOVE      PMREG006,PMREACTV
          MOVE      PMREG007,PMREELOS
          MOVE      PMREG008,PMRESNCD
          MOVE      SP70,PMRESPAR
.
MVPMRE99  RETURN
.
.------------------------------------------------------------------------------
. Clear file variables (Regime Maintenance)
.------------------------------------------------------------------------------
CLPMRE00  MOVE      SP70,PMREREGM
          MOVE      SP70,PMREUNIQ       
          MOVE      SP70,PMREDESC       
          MOVE      SP70,PMREITYP       
          MOVE      SP70,PMREITMN       
          MOVE      SP70,PMREACTV
          MOVE      SP70,PMREELOS
          MOVE      SP70,PMRESNCD
          MOVE      SP70,PMRESPAR
.
CLPMRE99  RETURN
.
.------------------------------------------------------------------------------
. Patient Invoice Range Maintenance
.------------------------------------------------------------------------------
PMRE0000  BRANCH    FLDITMNO,PMRE0100,PMRE0200,PMRE0300,PMRE0400,PMRE0500:
                             PMRE0600,PMRE0700,PMRE0800,PMRE0900,PMRE1000:
                             PMRE1100,PMRE1200,PMRE1300,PMRE1400,PMRE1500:
                             PMRE1600,PMRE1700
          GOTO      PMRE9999
.
PMRE0100  CALL      NEXTGR00                * Link to Next Group
          GOTO      PMRE9999
.
PMRE0200  CALL      PREVGR00                * Link to Last Group
          GOTO      PMRE9999
.
PMRE0300  CALL      RTAB0000                * Table of Regimes
          GOTO      PMRE9999
.
PMRE0400  WRITE     HTMLFILE;PMREREGM;
          GOTO      PMRE9999
.
PMRE0500  WRITE     HTMLFILE;PMREUNIQ;
          GOTO      PMRE9999
.
PMRE0600  WRITE     HTMLFILE;PMREDESC;
          GOTO      PMRE9999
.
PMRE0700  WRITE     HTMLFILE;PMREITMN;
          GOTO      PMRE9999
.
PMRE0800  WRITE     HTMLFILE;PMREACTV;
          GOTO      PMRE9999
.
PMRE0900  CALL      MTAB0000                * Table of Regimes Codes
          GOTO      PMRE9999
.
PMRE1000  WRITE     HTMLFILE;PMREG001;
          GOTO      PMRE9999
.
PMRE1100  CALL      STAB0000                * Search Table
          GOTO      PMRE9999
.
PMRE1200  WRITE     HTMLFILE;PMREITYP;
          GOTO      PMRE9999
.
PMRE1300  WRITE     HTMLFILE;PMREELOS;
          GOTO      PMRE9999
.
PMRE1400  MOVE      "sn",CATEGORY
          MOVE      PMRESNCD,CODE
          CALL      CODITM00
          GOTO      PMRE9999
.
PMRE1500  CALL      EREG0000                * Regime Enquiry
          GOTO      PMRE9999
.
PMRE1600  WRITE     HTMLFILE;FILTACTV;      * filter for Regime Code
          GOTO      PMRE9999
.
PMRE1700  PACK      KEY13,PMREG001,SP1,SP1,ZERO,SP70
          CALL      RSPMREG1
          CALL      RKPMREG1
          BRANCH    OVRCD,PMRE1750
.
          MATCH     PMREG001,PMREREGM
          GOTO      PMRE1750 IF NOT EQUAL
.
          WRITE     HTMLFILE;ONE;       * to display red for regime items button
.
PMRE1750  PACK      KEY13,PMREG001,SP1,SP1,ZERO,SP70
          CALL      RDPMREG1
.
          GOTO      PMRE9999
.
PMRE9999  RETURN
.
.------------------------------------------------------------------------------
.  Regime Table
.------------------------------------------------------------------------------
RTAB0000  UNPACK    DIM127,D1,LINKPRG,DIM127
          UNPACK    DIM127,D1,LINKREP,DIM127
          UNPACK    DIM127,D1,LINKTEM,DIM127
.
          CALL      RHED0000                * Output Table Heading
.
          IF        NORECORD=0
            MOVE      PTCNNRTD,NORECORD        * Default Records to Display
          ENDIF
.
          MOVE      ZERO,RECNUMB
          MOVE      ZERO,DISNUMB
.
          PACK      KEY13,SP1,SP1,ZERO,STARTKEY,SP10
          CALL      RDPMREG2                * Position index on startkey
          IF        OVRCD=0
            CALL      RPPMREG2 
          ENDIF
RTAB1000  CALL      RKPMREG2                * Read next record
          BRANCH    OVRCD,RTAB9000
.
          MATCH     "  0",PMREUNIQ
          GOTO      RTAB1000 IF NOT EQUAL
.         
          MATCH     SP70,FILTACTV
          IF        !@EQUAL
            MATCH     "0",FILTACTV          * check if active is selected
            IF        @EQUAL
              MATCH     "1",PMREACTV       
              GOTO      RTAB1000 IF EQUAL   * ignore if inactive record
            ENDIF
.
            MATCH     "1",FILTACTV          * check if inactive is selected
            IF        @EQUAL
              MATCH     "1",PMREACTV
              GOTO      RTAB1000 IF NOT EQUAL * ignore if active record
            ENDIF
          ENDIF
.
          ADD       ONE,RECNUMB
          IF        STARTNUM>=RECNUMB
            GOTO      RTAB1000
          ENDIF
.
          CALL      RROW0000                * Invoice range row
.
          ADD       ONE,DISNUMB
          COMPARE   NORECORD,DISNUMB
          GOTO      RTAB1000 IF NOT EQUAL
          GOTO      RTAB9999
.
RTAB9000  CALL      NOMORE00     * Display No More Records Message
.
RTAB9999  RETURN
.
.------------------------------------------------------------------------------
. Regime Table Heading
.------------------------------------------------------------------------------
RHED0000  WRITE     HTMLFILE;"<tr>":
                               "<td class=HeadingCell width=15%>":
                               "<b> Regime </b></td>":
                               "<td class=HeadingCell width=55%>":
                               "<b> Description </b></td>":
                               "<td class=HeadingCell width=15%>":
                               "<b> Active</b></td>":
                             "</tr>"
.
RHED9999  RETURN
.
.------------------------------------------------------------------------------
. Regime Table Row
.------------------------------------------------------------------------------
.
RROW0000  MATCH     "1",PMREACTV
          IF        @EQUAL
            MOVE      "No",DIM3
          ELSE
            MOVE      "Yes",DIM3
          ENDIF
.
          REP       " +",PMREREGM
          REP       " +",PMREUNIQ
.
          WRITE     HTMLFILE;"<tr><td nowrap><A HREF='javascript:ShowDetail06":
                             "(#"",LINKPRG,"#.pbl":
                             "?reportno=",LINKREP:
                             "&template=",LINKTEM:
                             "&pmreg001=",PMREREGM:
                             "&pmreg002=",PMREUNIQ,"#")'>";
.
          REP       "+ ",PMREREGM
          REP       "+ ",PMREUNIQ
.
          WRITE     HTMLFILE;"<img src=../images/MaintenanceIcon.gif hspace=4":
                             " border=0 align=absmiddle></a>":
                             PMREREGM,"</td>":
                             "<td>",PMREDESC,"&nbsp;</td>":
                             "<td>",DIM3,"&nbsp;</td>":
                             "</tr>"
.
.
RROW9999 RETURN
.
.------------------------------------------------------------------------------
.  Regime Table
.------------------------------------------------------------------------------
MTAB0000  UNPACK    DIM127,D1,LINKPRG,DIM127
          UNPACK    DIM127,D1,LINKREP,DIM127
          UNPACK    DIM127,D1,LINKTEM,DIM127
.
          CALL      MHED0000                * Output Table Heading
.
          IF        NORECORD=0
            MOVE      PTCNNRTD,NORECORD        * Default Records to Display
          ENDIF
.
          MOVE      ZERO,RECNUMB
          MOVE      ZERO,DISNUMB
.
          MOVE      "0",PMREG004
          PACK      KEY24,PMREG001,STARTKEY,SP70
          CALL      RSPMREG4                * Position index on startkey
MTAB1000  CALL      RKPMREG4                * Read next record
          BRANCH    OVRCD,MTAB9000
.
          MATCH     PMREG001,PMREREGM       * Correct Regime
          GOTO      MTAB9000 IF NOT EQUAL
.
          MATCH     "  0",PMREUNIQ
          GOTO      MTAB1000 IF EQUAL
.
          ADD       ONE,RECNUMB
          IF        STARTNUM>=RECNUMB
            GOTO      MTAB1000
          ENDIF
.
          CALL      MROW0000                * Invoice range row
.
          ADD       ONE,DISNUMB
          COMPARE   NORECORD,DISNUMB
          GOTO      MTAB1000 IF NOT EQUAL
          GOTO      MTAB9999
.
MTAB9000  CALL      NOMORE00      * Display No More Records Message
.
MTAB9999  RETURN
.
.------------------------------------------------------------------------------
. Regime Table Heading
.------------------------------------------------------------------------------
MHED0000  WRITE     HTMLFILE;"<tr>":
                               "<td class=HeadingCell width=15%>":
                               "<b> Item</b></td>":
                               "<td class=HeadingCell width=10%>":
                               "<b> Type</b></td>":
                               "<td class=HeadingCell width=75%>":
                               "<b> Description</b></td>":
                             "</tr>"
.
MHED9999  RETURN
.
.------------------------------------------------------------------------------
. Regime Table Row
.------------------------------------------------------------------------------
MROW0000  REP       " +",PMREREGM
          REP       " +",PMREUNIQ
.
          WRITE     HTMLFILE;"<tr><td nowrap><A HREF='javascript:ShowDetail06":
                             "(#"",LINKPRG,"#.pbl":
                             "?reportno=",LINKREP:
                             "&template=",LINKTEM:
                             "&pmreg001=",PMREREGM:
                             "&pmreg004=",PMREITYP:
                             "&pmreg002=",PMREUNIQ,"#")'>";
.
          REP       "+ ",PMREREGM
          REP       "+ ",PMREUNIQ
.
          MOVE      SP70,KEY10
          MATCH     "1",PMREITYP
          IF        @EQUAL
            MOVE      "Misc.Item ",KEY10
          ELSE
            MATCH     "2",PMREITYP
            IF        @EQUAL
              MOVE      "Regime    ",KEY10
            ELSE
              MOVE      "MBS Item  ",KEY10
            ENDIF
          ENDIF
          WRITE     HTMLFILE;"<img src=../images/MaintenanceIcon.gif hspace=4":
                             " border=0 align=absmiddle></a>":
                             PMREITMN,"</td>":
                             "<td>",KEY10,"&nbsp;</td>":
                             "<td>",PMREDESC,"&nbsp;</td>":
                             "</tr>"
.
MROW9999 RETURN
.
.------------------------------------------------------------------------------
.  Regime Enquiry Table
.------------------------------------------------------------------------------
EREG0000  CALL      MHED0000                * Output Table Heading
.
          MOVE      "0",PMREG004
          PACK      KEY24,PMREG001,SP70
          CALL      RSPMREG4                * Position index on startkey
EREG1000  CALL      RKPMREG4                * Read next record
          BRANCH    OVRCD,EREG9999
.
          MATCH     PMREG001,PMREREGM       * Correct Regime
          GOTO      EREG9999 IF NOT EQUAL
.
          MATCH     "  0",PMREUNIQ
          GOTO      EREG1000 IF EQUAL
.
          MOVE      SP70,KEY10
          MATCH     "1",PMREITYP
          IF        @EQUAL
            MOVE      "Misc.Item ",KEY10
          ELSE
            MATCH     "2",PMREITYP
            IF        @EQUAL
              MOVE      "Regime    ",KEY10
            ELSE
              MOVE      "MBS Item  ",KEY10
            ENDIF
          ENDIF
          WRITE     HTMLFILE;"<tr><td>",PMREITMN,"</td>":
                             "<td>",KEY10,"&nbsp;</td>":
                             "<td>",PMREDESC,"&nbsp;</td>":
                             "</tr>"
          GOTO      EREG1000 
.
EREG9999  RETURN
.
.------------------------------------------------------------------------------
.  Regime Table by Description
.------------------------------------------------------------------------------
STAB0000  UNPACK    DIM127,D1,LINKPRG,DIM127
          UNPACK    DIM127,D1,LINKREP,DIM127
          UNPACK    DIM127,D1,LINKTEM,DIM127
.
          CALL      SHED0000                * Output Table Heading
.
          IF        NORECORD=0
            MOVE      "13",NORECORD         * Default Records to Display
          ENDIF
.
          MOVE      ZERO,RECNUMB
          MOVE      ZERO,DISNUMB
.
          PACK      KEY53,SP1,SP1,ZERO,STARTKEY,SP10
          CALL      RDPMREG3                * Position index on startkey
          IF        OVRCD=0
            CALL      RPPMREG3
          ENDIF
STAB1000  CALL      RKPMREG3                * Read next record
          BRANCH    OVRCD,STAB9999
.
          MATCH     "  0",PMREUNIQ
          GOTO      STAB9999 IF NOT EQUAL
.
          MATCH     "1",PMREACTV            * Active
          GOTO      STAB1000 IF EQUAL
.
          ADD       ONE,RECNUMB
          IF        STARTNUM>=RECNUMB
            GOTO      STAB1000
          ENDIF
.
          CALL      SROW0000                * Invoice range row
.
          ADD       ONE,DISNUMB
          COMPARE   NORECORD,DISNUMB
          GOTO      STAB1000 IF NOT EQUAL
.
STAB9999  RETURN
.
.------------------------------------------------------------------------------
. Regime Table Heading Description
.------------------------------------------------------------------------------
SHED0000  WRITE     HTMLFILE;"<tr>":
                               "<td class=HeadingCell width=15%>":
                               "<b> Regime </b></td>":
                               "<td class=HeadingCell width=55%>":
                               "<b> Description </b></td>":
                             "</tr>"
.
SHED9999  RETURN
.
.------------------------------------------------------------------------------
. Regime Table Row Description
.------------------------------------------------------------------------------
SROW0000  WRITE     HTMLFILE;"<tr><td nowrap><A HREF=#"":
                             "javascript:updateParent06('",PMREDESC:
                             "','",PMREREGM,"')#">";
.
          WRITE     HTMLFILE;"<img src=../images/MaintenanceIcon.gif hspace=4":
                             " border=0 align=absmiddle></a>":
                             PMREREGM,"</td>":
                             "<td>",PMREDESC,"&nbsp;</td>":
                             "</tr>"
.
SROW9999 RETURN
.
.                                                                                                           
.------------------------------------------------------------------------------
. Build ward selection list         
.------------------------------------------------------------------------------
WARDSL00  PACK      KEY29,SP70                                                                                                                     
          IF        IBCNMHOS = 1                                                                                                                   
            PACK      KEY29,SP3,WBSEHOSP,SP70                                                                                                      
          ENDIF                                                                                                                                    
          CALL      RDSWARD7                                                                                                                       
WARDSL10  CALL      RDKWARD7                                                                                                                       
          BRANCH    OVRCD,WARDSL99                                                                                                                 
.                                                                                                                                                  
.                         if we have a bed number we have passed all the ward                                                                      
.                         master records, so exit                                                                                                           
          MATCH     SP70,WBED                                                                                                                      
          GOTO      WARDSL99 IF NOT EQUAL                                                                                                          
.                                                                                                                                                  
          COMPARE   WACTIVE,ZERO                 *List only active wards                                                                           
          GOTO      WARDSL10 IF NOT EQUAL                                                                                                          
.                                                                                                                                                  
          IF        IBCNMHOS = 1                                                                                                                   
            MATCH      SP3,WBSEHOSP                                                                                                                
            IF        !@EQUAL                                                                                                                      
              MATCH     WBSEHOSP,PTWDHOSN                                                                                                          
              GOTO      WARDSL99 IF NOT EQUAL                                                                                                      
            ENDIF                                                                                                                                  
          ENDIF                                                                                                                                    
.                                                                                                                                                  
.                       write the select option.                                                                                                   
          WRITE     HTMLFILE;"<option value=#"",WWARD,"#"";                                                                                        
          MATCH     DFLTWARD,WWARD                                                                                                                     
          IF        @EQUAL                                                                                                                         
            WRITE     HTMLFILE;" selected";                                                                                                        
          ENDIF                                                                                                                                    
          WRITE     HTMLFILE;">",WBDESC;
.
          IF        IBCNMHOS = 1
            MATCH      SP3,WBSEHOSP
            IF        @EQUAL
              WRITE     HTMLFILE;" - ",PTWDHOSN;
            ENDIF
          ENDIF
.
          WRITE     HTMLFILE;"</option>"
          GOTO      WARDSL10                                                                                                                       
.                                                                                                                                                  
WARDSL99  RETURN
. 
.------------------------------------------------------------
. Get Misc.item description
.------------------------------------------------------------
GMSC0000  OPEN      NZPMCHA3,"nzpmchaf"
          PACK      KEY9,ITEMCODE
          PACK      KEY37,KEY9,SP70
          CALL      RSNZMCH3
GMSC1000  CALL      RKNZMCH3
          BRANCH    OVRCD,GMSC9000
.
          MATCH     KEY9,NZMCMCHG
          GOTO      GMSC9000 IF NOT EQUAL        * does charge code exist?
.
GMSC8000  MOVE      ZERO,EXIT
          GOTO      GMSC9999
.
GMSC9000  MOVE      ONE,EXIT
GMSC9999  RETURN
+
.------------------------------------------------------------
. NOMORE00 - Display "No more records" at end of list
.------------------------------------------------------------
NOMORE00  WRITE     HTMLFILE;"<tr>":
                             "<td class=RedCell colspan=20 align=center>":
                             "No more records</td>"
.
NOMORE99  RETURN
+
.------------------------------------------------------------------------------
. I/O and Subroutine Includes
.------------------------------------------------------------------------------
.
          INC       IBAWEBCD
          INC       DAYOFWEK
          INC       PATCOMN3
          INC       PATMCHRD                * Miscellaneous Charges read routine
          INC       RSHWEBCD
          INC       WEBDATCD
          INC       NZPIRNTM
          INC       PATITMRD
          INC       PATCALFN
.
          INC       IBASMAIO/INC            * Common system master file
          INC       IBABASIO/INC            * BAS code
.
          INC       FMSAMAIO/INC            * Accounts
          INC       FMSDISIO/INC            * Dissection
          INC       FMSLMAIO/INC            * Ledger
          INC       FMSRESIO/INC            * Responsibility
          INC       FMSCSAIO/INC            * Control accounts
.
          INC       OUTSITIO/INC            * Outpatient Site Code file
.    
          INC       PATECHIO/INC            * MBS Exploding Charges file
          INC       PATDRGIO/INC            * Period Date Range file
          INC       PATFMSIO/INC            * Interface File
          INC       PMSFMSIO/INC            * System based Interface File
          INC       PATHSPIO/INC            * Hospital file
          INC       PATIRNIO/INC            * Invoice Ranges 
          INC       NZPIRNIO/INC            * NZP Hospital based Invoice Ranges 
          INC       PATITMIO/INC            * Items file
          INC       PATIKIIO/INC            * MBS Keyword file
          INC       PATRFNIO/INC
          INC       NZPRFNIO/INC
          INC       PATRFGIO/INC
          INC       PATFINIO/INC            * Invoice financial summary file
          INC       PATFIGIO/INC            * Invoice financial summary file
          INC       NZPFINIO/INC            * Invoice financial summary file
          INC       NZPFIGIO/INC            * Invoice financial summary file
          INC       PATFN1IO/INC            * Health Fund file
          INC       PATMCHIO/INC            * Miscellaneous Charges file
          INC       NZPMCHIO/INC
          INC       PATSGCIO/INC            * Suggested class. exceptions file
          INC       PATWR1IO/INC
          INC       PMSREGIO/INC
          INC       PMSSGAIO/INC            * ICD10 Suggested Classification
          INC       PATICDIO/INC            * ICD10 file
          INC       PATDICIO/INC            * ICD10 Keyword
          INC       PATHGPIO/INC            * Patient Health Fund Group File IO
.
+
.------------------------------------------------------------------------------
. End Of Program
.------------------------------------------------------------------------------
