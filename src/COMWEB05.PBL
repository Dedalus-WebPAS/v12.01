.------------------------------------------------------------------------------ 
. Program       : COMWEB05
.
. Function      : Stationary Template Maintenance           
.                 Report 1: Stationery Template/Code Maintenance
.
. Modifications :
.      V12.00.01  22/05/2025  Nikitha B      TSK 0960634
.                 Recompiled for IBADSTYP
.      V11.02.03  02/08/2022  Bella Turco    TSK 0921957
.                 Added NOMORE00 - Display "No more records" at end of list
.                 Added PTCNNRTD - Displays number of rows set by parameter 
.                 value
.      V11.02.02  06/07/2022  Bella Turco    Task 0921927
.                 Added stationery type filter to stationery type list
.      V11.02.01  02/02/2022  Ebon Clements  Task 0888071
.                 Added free format to input newborn diagnosis defaults
.                 Report 7 - NEWDEF00
.      V11.00.01  28/04/2020  Jill Parkinson Task 0879163
.                 Recompiled for IBADSTYP - removed redundant stationery types
.      V10.14.01  19/02/2019  Tracey Nguyen  TSK 0869882
.                 Added PMREL004 - HDP Equivalent
.------------------------------------------------------------------------------
.      V10.10.04  08.05.2017  B.G.Ackland    TSK 0835482 
.                 FHIR Device Output for User printers
.      V10.10.03  02/05/2017  Richa Phogat      TSK 0837526
.                 Fixed issue with updating User/Date/Time details in 'IBATMHAF'
.                 when copying a Stationery Template in CPYTMH00
.      V10.10.02  28/04/2017  Richa Phogat      TSK 0837526
.                 Update User/Date/Time details in 'IBATMHAF'under various 
.                 scenarios
.      V10.10.01  08/03/2017  Thanh T.          TSK 0319852
.                 Added new variables for comment, create user id, create date,
.                 create time, update user id, update date and update time.  
.      V10.09.01  04/01/2017  Steve Armstrong   TSK 0319852
.                 Added new variables (IBTHCOMM to IBTHUTIM) to CLRTMH00
.------------------------------------------------------------------------------ 
.      V10.04.04  20/05/2014  Jill Parkinson CAR 301367    
.                 Mods to populate IBPDPDSC before WRIBPDD1  
.      V10.04.03  13/05/2014  Don Nguyen       CAR 300111
.                 Modified NXTPG000 - added NEXTPAGE option 4
.      V10.04.02  31.03.2014  B.G.Ackland      CAR 299363
.                 Replace META Tag Redirect with Javascript in Common RDIREC00
.                 Routine
.      V10.04.01  26/02/2014  Patrick Adair    CAR 287247
.                 Store printer description in printer department details
.------------------------------------------------------------------------------ 
.      V10.03.08  11/06/2013  Steve Armstrong  CAR 277665
.                 Added OPEN on PATCODE1 to INIT0000 to fix I*C.
.      V10.03.07  15/05/2013  Peter Vela                     CAR 277665
.                 Added update to Printer Department Maintenance @
.                 PRTR2000
.      V10.03.06  02/05/2013  Don Nguyen      CAR 284693 
.                 Added 'Active Indicator' to Patient Title/Relationship lists
.      V10.03.05  08/01/2013 Peter McMullen   CAR 275033 
.                 Change 'Allied Health' referece to 'Referral Mananagement'
.      V10.03.04  25/10/2012  Patrick Adair                  CAR 2703181
.                 Recompiled for IBADSTYP (AN-SNAP Changes)
.      V10.03.03  08/08/2012  Don Nguyen    CAR 270419
.                 Fixed next/previous filtered paging on Hospital ID (PRIND000)
.      V10.03.02  30/01/2012 J.Tan   CAR 247090
.                 Added Print Indicator to ibatmdaf using spare variable
.      V10.03.01  21/12/2011 B.G.Ackland
.                 Escape Tag "<>" in Variables
.      V10.02.03  29/09/2011  Mike Laming   CAR 251218 
.                 Mods to PDEP0000 to correct Dept/Hosp Printer delete screen &
.                 Add Hospital Filter to PDEP0000 for adding Printers to Dept
.      V10.02.02  16/06/2011 Jill Parkinson CAR 239574 
.                 Fixed display of printer details from in department
.      V10.02.01  28/04/2011 Jill Parkinson CAR 239574 
.                 New printer/department table mods 
.      V10.01.02  16/12/2010 Jill Parkinson CAR 235074
.                 Mods to check CURRROW before adding a new line (not after)
.      V10.01.01  17/11/2010 Jill Parkinson CAR 231795
.                 Changed DPPENNO to PPENNO
.      V10.00.02  20/09/2010 Jill Parkinson CAR 222489
.                 Added IBASTP20 - Medical booking stationery type
.      V10.00.01  16/09/2010 Ebon Clements  CAR 217578
.                 Changed PMBOR004 to DIM 10
.      V9.12.02   19/10/2009 Peter Vela     CAR 199757
.                 Added Next Stationery Template Code Functionality
.      V9.12.01   21/09/2009 Peter Vela     CAR 205008
.                 Compiled for IBADSTYP
.      V9.11.03   20/04/2008 Ebon Clements  CAR 187411
.                 Changed PMNEW004 to DIM 10
.      V9.11.02   07/04/2009  WeeLee Koo    CAR 62420
.                 Added printer and department maintenance (report no: 11 & 12)
.      V9.11.01   17/03/2009 Jill Habasque  CAR 159753
.                 Added report option 10 - Boarder defaults
.      V9.10.07   23/08/2008 Peter Vela     CAR 163634
.                 More overlap validation changes
.      V9.10.06   22/08/2008 Peter Vela     CAR 163634
.                 Overlap validation changes
.      V9.10.05   22/08/2008 Peter Vela     CAR 163634
.                 Fixed overlap validation for Stationery Template variables
.      V9.10.04   29/07/2008 Peter Vela     CAR 151951
.                 Recompiled for IBADSTYP
.      V9.10.03   17/07/2008 Ebon Clements  CAR 172849
.                 Fix WEBTITLE for report 6
.      V9.10.02   26/06/2008 Sandra Barcham CAR 171640
.                 Fix COMWEB05 0x007323 I * C 
.      V9.10.01   13/05/2008  Ebon Clements CAR 166566
.                 Recompiled for IBAWEBDF
.      V9.09.01   28/08/2007  Jill Habasque CAR 135539
.                 Recompiled for IBADSTYP
.      V9.08.02   20/03/2007  Peter Vela    CAR 128233
.                 Recompiled for IBADSTYP
.      V9.08.01   16/03/2007  Jill Habasque CAR 135529
.                 Added Allied Health label type
.      V9.05.02   23/03/2006  Peter Vela    CAR 61299
.                 Increased field no size from DIM3 to DIM5 for stationery
.                 templates
.      V9.05.01   09/03/2006  Ebon Clements CAR 78533
.                 Mods for PATCODTM - Hospital specific category codes
.      V9.05.B01  30/01/2006  Ebon Clements CAR 93186
.                 Mods for REDIRECT length change. Recompiled for IBAWEBDF
.      V9.04.09   07/11/2005  Ebon Clements CAR 81899
.                 Added emergency pathology label type - weblabaf
.      V9.04.08   08/07/2005  Ebon Clements CAR 62220
.                 Added mrt system type to weblabaf
.      V9.04.07   07/07/2005  Jill Habasque CAR 65602
.                 Fixed update of relationships
.      V9.04.06   10/06/2005  Jill Habasque CAR 61761
.                 Added option 8 - Title Selections
.                 10/06/2005  Ebon Clements CAR 61761
.                 Added option 9 - Relationship Selections
.      V9.04.05   02/06/2005  Jill Habasque CAR 61534
.                 Added option 7 - Newborn defaults
.      V9.04.04   11/04/2005  Jill Habasque CAR 60479
.                 Fixed next and previous for label selection list
.      V9.04.03   18/03/2005  Lina Vo            CAR 56405             
.                 Recompiled for IBADSTYP        
.      V9.04.02   17/03/2005  Lina Vo            CAR 56405             
.                 Added IBASTP18 - Theatre Form Stationary Type        
.                 Fixed IBAVAR00 Write, Update and Delete to use index 2
.                 17/03/2005  Jill Habasque      CAR 58443             
.                 Added report number 6
.      V9.04.01   09/09/2004  Lina Vo            CAR 53225
.                 Fixed LCKVR000 to show correct user name and allow locking
.                 by the same user.
.      V9.03.01   23/07/2004  Lina Vo            CAR 50842
.                 Fixed locking to only occur on Add and Update of Templates.
.                 23/07/2004  Pat Dirito         CAR 50842
.                 Changed locking to allow for same user id. 
.      V9.03.00   16/05/2004  Pat Dirito         CAR 50842
.                 Created server
.------------------------------------------------------------------------------
. FD Includes
.------------------------------------------------------------------------------
          INC       IBAWEBDF
          INC       WEBDATDF
          INC       RSHWEBDF
.
          INC       PATCOMM/INC     * IBA Control file
.
          INC       IBAVARFD/INC    * Stationery Template Vars
          INC       IBADPTFD/INC    * Departments
          INC       WEBLABFD/INC    * Label Selection Vars
          INC       IBATMDFD/INC    * Stationery Template Details File
          INC       IBADSTYP/INC
          INC       PATCONFD/INC    * Patient Control file
          INC       PATHSPFD/INC
          INC       MLTSECFD/INC
          INC       PMSBORFD/INC
          INC       PMSNEWFD/INC    * Newborn defaults file
          INC       PMSTLEFD/INC    * Title Selection list file
          INC       PMSRELFD/INC    * Relationship selection list file
. 
.-----------------------------------------------------------------------------
. Variable Declarations
.-----------------------------------------------------------------------------
.
. CGI Parameters
. **************
.
NEXTPAGE  FORM      1         * Nextpage parameter
UPDTTYPE  DIM       1         * Update Type (A)dd,(U)pdate,(D)elete,Blank=disp
STARTKEY  DIM       6         * Starting Key for search
VALDTYPE  FORM      1         * Validation Type
STATNVAR  FORM      5         * Validation Code
STATTYPE  FORM      3         * Stationery Type
STATDESC  DIM       6         * Next Stationery Code
FILTHOSP  DIM       3         * Selected hospital
FILTSTTY  DIM       3         * Selected Stationery Type
HIDPRINT  DIM       6[99]     * Array of printer codes (on the screen)
PRINTARR  DIM       6[99]     * Array of printer codes (selected)
PRINTCNT  FORM      3
HIDPTCNT  FORM      3
.
IBTMH001  DIM       6         * Stationery Code
IBTMH002  DIM       30        * Stationery Description
IBTMH003  FORM      3         * Max Column Width for Printing
IBTMH004  FORM      3         * Paper Length of Stationery
IBTMH005  DIM       3         * Stationery Type
IBTMH006  DIM       1         * Active Indicator 1=Active 0=Not Active
IBTMH007  DIM       80        * Stationery Comments
.
IBCPY001  DIM       6         * Stationery Code
IBCPY002  DIM       30        * Stationery Description
.
IBPRT001  DIM       6         * Printer Code
IBPRT002  DIM       20        * Printer Description
IBPRT003  DIM       1         * Printer Availability 
IBPRT004  DIM       2         * Printer Type (Number)
IBPRT005  DIM       2         * Paper Type (Number)
IBPRT006  DIM       3         * Hospital (pathspaf)
IBPRT007  DIM       50        * Printer Queue Name
IBPRT008  DIM       80        * Printer Location  
IBPRT009  DIM       80        * Script Parameters  
PRITAVLB  DIM       5         * Yes/No? Availability
PRINTYPE  DIM       40        * Printer Type (Description)
PAPERTYP  DIM       30        * Paper Type (Description)
.
DEPRT001  DIM       6         * Printer Department Code
DEPRT002  DIM       80        * Printer Department Description 
DEPRT003  DIM       3         * Hospital Code (pathspaf)
DEPRT004  DIM       6         * Ward
DEPRT005  DIM       3         * EMR Site
DEPRT006  DIM       10        * Outpatient Location
.
IBPDD001  DIM       6         * Printer Department Code (Table)
IBPDD002  DIM       3         * Printer Department Code (Actual)
IBPDD003  DIM       20        * Printer Department Description
.
IBTMD001  DIM       6         * Stationery Code
IBTMD002  FORM      3         * Row for Printing
IBTMD003  FORM      3         * Column for Printing
IBTMD004  FORM      1         * Indicator 1=Text Item 2=Data Item
IBTMD005  FORM      3         * Length to Print
IBTMD006  FORM      2         * Color
IBTMD007  DIM       40        * Text/Field No
IBTMD008  FORM      5         * Variable Number
IBTMD009  DIM       1         * Print Indicator
.
UPDSAVKY  DIM       12        * Save Key for Update Template Details
.
IBVAR001  FORM      3         * Stationery Type
IBVAR002  DIM       30        * Variable Description
IBVAR003  FORM      5         * Field No.
IBVAR004  FORM      3         * Field Length
.
PMBOR001  DIM       8         * Field name
PMBOR002  DIM       3         * Field number
PMBOR003  DIM       1         * Default type
PMBOR004  DIM       10        * Code
.
PMNEW001  DIM       8         * Field name
PMNEW002  DIM       3         * Field number
PMNEW003  DIM       1         * Default type
PMNEW004  DIM       10        * Code
PMNEW005  DIM       40        * Free Format Default
.
PMTLE001  DIM       4         * Title Code
PMTLE002  DIM       30        * Title Description
PMTLE003  FORM      1         * Active Indicator
.
PMREL001  DIM       10        * Relationship Code
PMREL002  DIM       30        * Relationship Description
PMREL003  FORM      1         * Active Indicator
PMREL004  DIM       10        * HDP Equivalent
.
WBLAB001  DIM       1         * System
WBLAB002  DIM       3         * Number of labels
WBLAB003  DIM       1         * Default  
.
. Program Variables
. *****************
ARRCOUNT  FORM      3
COUNT     FORM      3
CURRROW   FORM      3
DEFTDESC  DIM       3
DIM3      DIM       3
DIM4      DIM       4
DIM5      DIM       5
DIM6      DIM       6
FIELDNOD  DIM       5   
FLDNUMBR  DIM       3
FORM3     FORM      3
LASTROW   FORM      3
LNK2PRT   FORM      1
MASTCNT   FORM      3
OBJNAME   DIM       3
PRNTSTRT  FORM      3
SAVKEY5   DIM       5
SAVKEY12  DIM       12
STATNTYP  DIM       3
THISPOS   FORM      3
TYPENAME  DIM       50
TYPENUM   FORM      3
VARIABLE  DIM       127
.
.
. Program Constants
. *****************
MASTF001  INIT      "PSNAME" 
MASTF002  INIT      "PADD1   " 
MASTF003  INIT      "PADD2   " 
MASTF004  INIT      "PADD3   " 
MASTF005  INIT      "PADD4   " 
MASTF006  INIT      "PPOST   " 
MASTF007  INIT      "PTELEP  "
MASTF008  INIT      "PTELEB  "
MASTF009  INIT      "PREG    "
MASTF010  INIT      "PTYPE   " 
MASTF011  INIT      "PMEDI   " 
MASTF012  INIT      "PMPXMEDC"
MASTF013  INIT      "PMPXMSNO"
MASTF014  INIT      "PPENNO "
MASTF015  INIT      "PPNDTE  "
MASTF016  INIT      "PFUNDH  "
MASTF017  INIT      "PFNDTB  "
MASTF018  INIT      "PFNDMM  "
MASTF019  INIT      "PTMXLGA "
MASTF020  INIT      "PTMXADD1"
MASTF021  INIT      "PTMXADD2"
MASTF022  INIT      "PTMXADD3"
MASTF023  INIT      "PTMXADD4"
MASTF024  INIT      "PTMXPOST"
MASTF025  INIT      "PTMXSLAC"
MASTF026  INIT      "PNKNAME "
MASTF027  INIT      "PNKADD1 "
MASTF028  INIT      "PNKADD2 "
MASTF029  INIT      "PNKSUBR "
MASTF030  INIT      "PNKADD4 "
MASTF031  INIT      "PNKPOST "
MASTF032  INIT      "PNKTELP "
MASTF033  INIT      "PNKTELB "
MASTF034  INIT      "PNKRELP "
MASTF035  INIT      "PTMANOKO"
MASTF036  INIT      "PMPXKMOB"
MASTF037  INIT      "PMPXKEML"
MASTF038  INIT      "PTMXECNM"
MASTF039  INIT      "PTMXECA1"
MASTF040  INIT      "PTMXECA2"
MASTF041  INIT      "PTMXECA3"
MASTF042  INIT      "PTMXECA4"
MASTF043  INIT      "PTMXECPC"
MASTF044  INIT      "PTMXECPP"
MASTF045  INIT      "PTMXECBP"
MASTF046  INIT      "PTMXECRE"
MASTF047  INIT      "PMPXCMOB"
MASTF048  INIT      "PMPXCEML"
MASTF049  INIT      "PTMXNRNM"
MASTF050  INIT      "PTMXNRA1"
MASTF051  INIT      "PTMXNRA2"
MASTF052  INIT      "PTMXNRA3"
MASTF053  INIT      "PTMXNRA4"
MASTF054  INIT      "PTMXNRPC"
MASTF055  INIT      "PTMXNRPP"
MASTF056  INIT      "PTMXNRBP"
MASTF057  INIT      "PTMXRMOB"
MASTF058  INIT      "PTMXREML"
MASTF059  INIT      "PMPXMSNA"
MASTF060  INIT      "PMPXMGNA"
MASTF061  INIT      "PMPXMTLE"
MASTF062  INIT      "PMPXMAD1"
MASTF063  INIT      "PMPXMAD2"
MASTF064  INIT      "PMPXMAD3"
MASTF065  INIT      "PMPXMAD4"
MASTF066  INIT      "PMPXMPOS"
MASTF067  INIT      "PMPXMPNO"
MASTF068  INIT      "PMPXMBNO"
MASTF069  INIT      "PMPXMMNO"
MASTF070  INIT      "PMPXMEML"
MASTF071  INIT      "PMPXMCNT"
MASTF072  INIT      "PMPXMREL"
MASTF073  INIT      "PMPXFSNA"
MASTF074  INIT      "PMPXFGNA"
MASTF075  INIT      "PMPXFTLE"
MASTF076  INIT      "PMPXFAD1"
MASTF077  INIT      "PMPXFAD2"
MASTF078  INIT      "PMPXFAD3"
MASTF079  INIT      "PMPXFAD4"
MASTF080  INIT      "PMPXFPOS"
MASTF081  INIT      "PMPXFPNO"
MASTF082  INIT      "PMPXFBNO"
MASTF083  INIT      "PMPXFMNO"
MASTF084  INIT      "PMPXFEML"
MASTF085  INIT      "PMPXFCNT"
MASTF086  INIT      "PMPXFREL"
MASTF087  INIT      "PUSR1   " 
MASTF088  INIT      "PUSR2   " 
MASTF089  INIT      "PUSR3   " 
MASTF090  INIT      "PUSR4   " 
MASTF091  INIT      "PUSR5   " 
MASTF092  INIT      "PUSR6   " 
MASTF093  INIT      "PMPXUSR7"
MASTF094  INIT      "PMPXUSR8"
MASTF095  INIT      "PMPXUSR9"
MASTF096  INIT      "PUYN1   " 
MASTF097  INIT      "PUYN2   " 
MASTF098  INIT      "PUYN3   " 
MASTF099  INIT      "PMPXUYN4"
MASTF100  INIT      "PMPXUYN5"
MASTF101  INIT      "PMPXRHC1"
MASTF102  INIT      "PMPXRH1G"
MASTF103  INIT      "PMPXR1GC"
MASTF104  INIT      "PLOCDOC "
MASTF105  INIT      "PTMANOKE"
.
EMGSYS    INIT      "Emergency"
OUTSYS    INIT      "Outpatients"
INPSYS    INIT      "Inpatients"
MRTSYS    INIT      "Medical Records"
AHSYS     INIT      "Referral Management Labels"
EMRPATH   INIT      "Emergency Pathology Labels"
NBSP      INIT      "&nbsp;"
DASH      INIT      " - "
X50       INIT      "XXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXX"
.
PRTYPE00  INIT      "No barcoding facility"
PRTYPE01  INIT      "HP2934A (Rel 5 & 6)"
PRTYPE02  INIT      "Epson with dongle (Rel 5)"
PRTYPE03  INIT      "Tharo Freedom (Rel 5)"
PRTYPE04  INIT      "Intermec 3400 (Rel 6)"
PRTYPE05  INIT      "Epson DLQ-3000+"
PRTYPE06  INIT      "Sato CX200"
PRTYPE07  INIT      "Zebra"
PRTYPE08  INIT      "Datamax E-class"
PRTYPE09  INIT      "Generic Barcoding"
.
PRITPR00  INIT      "Either"
PRITPR01  INIT      "Plain Paper"
PRITPR02  INIT      "Special Stationary"
RETNVAR   DIM       127
+
.-----------------------------------------------------------------------------
.
PRGID     INIT      "COMWEB05"
VERSION   INIT      "V12.01.00"
PRGNAM    INIT      "Stationery Template Maintenance"
+
.------------------------------------------------------------------------------
.
          CALL      WEBINT00                * Initialise Fifo Etc.
          CALL      INIT0000                * Open Files
.
MAIN1000  CALL      WEBRED00                * Read Fifo WEBPID and USERID
.
          COMPARE   "999",REPORTNO          * End Server Process if Option=999
          GOTO      MAIN9999 IF EQUAL
.
          BRANCH    REPORTNO,MAIN1100,MAIN1200,MAIN1300,MAIN1400,MAIN1500:
                             MAIN1600,MAIN1700,MAIN1800,MAIN1900,MAIN2000:
                             MAIN2100,MAIN2200
.
          PACK      WEBTITLE,PRGID,SP1,VERSION,SP1,PRGNAM,SP70
          MOVE      "InvalidA Option",WEBTITLE
          CALL      WEBERR00                * Output File & Write HTML Pg Header
          GOTO      MAIN1000
.
MAIN1100  CALL      IBATMH00         * Stationery Template/Code Maintenance
          BRANCH    EXIT,MAIN1000
          CALL      NXTPG000         * next page
          GOTO      MAIN1000
.
MAIN1200  CALL      IBATMD00         * Stationery Template Details Maintenance
          BRANCH    EXIT,MAIN1000
          CALL      NXTPG000         * next page
          GOTO      MAIN1000
.
MAIN1300  CALL      IBATYP00         * Stationery Type Maintenance
          BRANCH    EXIT,MAIN1000
          CALL      NXTPG000         * next page
          GOTO      MAIN1000
.
MAIN1400  CALL      IBAVAR00         * Stationery Type Variable Maintenance
          BRANCH    EXIT,MAIN1000
          CALL      NXTPG000         * next page
          GOTO      MAIN1000
.
MAIN1500  CALL      REMOTE00        * Remote Scripting Functions
          GOTO      MAIN1000
.
MAIN1600  CALL      WEBLAB00        * Label selection list table
          BRANCH    EXIT,MAIN1000
          CALL      NXTPG000         * next page
          GOTO      MAIN1000
.
MAIN1700  CALL      NEWDEF00        * Input new born default maintenance
          BRANCH    EXIT,MAIN1000
          CALL      NXTPG000         * next page
          GOTO      MAIN1000
.
MAIN1800  CALL      WEBTLE00        * Title selection list table
          BRANCH    EXIT,MAIN1000
          CALL      NXTPG000         * next page
          GOTO      MAIN1000
.
MAIN1900  CALL      WEBREL00        * Relationship selection list table
          BRANCH    EXIT,MAIN1000
          CALL      NXTPG000         * next page
          GOTO      MAIN1000
.
MAIN2000  CALL      BORDEF00        * Boarder default maintenance
          BRANCH    EXIT,MAIN1000
          CALL      NXTPG000         * next page
          GOTO      MAIN1000
.
MAIN2100  CALL      PRTR0000        * Printer Report
          BRANCH    EXIT,MAIN1000
          CALL      NXTPG000        * next page
          GOTO      MAIN1000
.
MAIN2200  CALL      DEPR0000        * Printer Department Maintenance
          BRANCH    EXIT,MAIN1000
          CALL      NXTPG000        * next page
          GOTO      MAIN1000
.
MAIN9999  MOVE      "SERVER SHUTDOWN COMPLETE",WEBTITLE
          CALL      WEBERR00
          STOP
+
.------------------------------------------------------------------------------
.  Next Page URL
.------------------------------------------------------------------------------
NXTPG000  IF        NEXTPAGE=0
            CALL      WINCLS00              * Refresh parent and close window
          ENDIF

          IF        NEXTPAGE=1
            CALL      RSAVED00              * Redirect URL
          ENDIF
.
          IF        NEXTPAGE=2
            CALL      GOBACK00              * Go Back 1 html page
          ENDIF
.
          IF        NEXTPAGE=3
            CALL      DAH20000              * Go Back 2 html pages
          ENDIF
.
          IF        NEXTPAGE=4
            CALL      RDIREC00              * Redirect to URL (IBAWEBCD)
          ENDIF
.
NXTPG999  RETURN
.------------------------------------------------------------------------------
.  Goes back 1 page
.------------------------------------------------------------------------------
GOBACK00  CALL      OPENHTML
          BRANCH    EXIT,GOBACK99
          WRITE     HTMLFILE;"<script type=#"text/javascript#"> {":
                             "    alert(#"",WEBTITLE,"#");":
                             "    self.close();":
                             "    opener.history.go(-1);":
                             "}":
                             "</script>"

          CALL      CLOSHTML
.
GOBACK99  RETURN
.------------------------------------------------------------------------------
. Open Files and Initialize Variables
.------------------------------------------------------------------------------
INIT0000  OPEN      WEBSECA1,"websecaf"
          OPEN      WEBSECA3,"websecaf"
.
          OPEN      WEBLABA1,"weblabaf"
.
          OPEN      IBAVARD1,"ibavaraf"
          OPEN      IBAVARD2,"ibavaraf"
          OPEN      IBATMHA1,"ibatmhaf"
          OPEN      IBATMHA2,"ibatmhaf"
          OPEN      IBATMHA3,"ibatmhaf"
          OPEN      IBATDET1,"ibatmdaf"
.
          OPEN      PATCODE1,"patcodes"
          OPEN      PATCODE2,"patcodes"
          OPEN      PATCODE3,"patcodes"
.
          OPEN      PMSBORA1,"pmsboraf"
          OPEN      PMSBORA2,"pmsboraf"
.
          OPEN      PMSNEWA1,"pmsnewaf"
          OPEN      PMSNEWA2,"pmsnewaf"
.
          OPEN      PMSTLEA1,"pmstleaf"
          OPEN      PMSRELA1,"pmsrelaf"
.
          OPEN      PATHSPA1,"pathspaf"
.
          OPEN      MLTSECA1,"mltsecaf"
.
          OPEN      IBACODE1,"ibacodef"
.
          OPEN      IBAPDFA1,"ibapdfaf"
.
          OPEN      IBAPRTA1,"ibaprtaf"     
.
          OPEN      IBADPTA1,"ibadptaf"     
.
          OPEN      IBAPDDA1,"ibapddaf"     
          OPEN      IBAPDDA3,"ibapddaf"     
.
          OPEN      CONTROLF,"controlf"
          READ      CONTROLF,ZERO;*43,IBCNMHOS
          READ      CONTROLF,HUND25;*238,PTCNNRTD
.
          MOVE      ZERO,F2
          MOVE      PTCNNRTD,F2
          IF        F2 = 0
            MOVE      "10",PTCNNRTD
          ENDIF
.
          IF        IBCNMHOS=1
            OPEN      MLTCODA1,"mltcodaf"
            OPEN      MLTCODA2,"mltcodaf"
          ENDIF
.
INIT9999  RETURN
.------------------------------------------------------------------------------
. Clear Parameters
.------------------------------------------------------------------------------
CLRPAR00  MOVE      ZERO,REPORTNO
          MOVE      SP70,TEMPLATE
          MOVE      SP70,UPDTTYPE
          MOVE      ZERO,NEXTPAGE
          PACK      REDIRECT,SP70,SP70,SP70,SP70
          MOVE      ZERO,STARTNUM
          MOVE      ZERO,NORECORD
          MOVE      SP70,STARTKEY
          MOVE      ZERO,VALDTYPE
          MOVE      ZERO,STATNVAR
          MOVE      ZERO,STATTYPE
          MOVE      SP70,STATDESC
          MOVE      Z70,FILTHOSP
          MOVE      SP70,FILTSTTY
.
          MOVE      SP70,IBTMH001
          MOVE      SP70,IBTMH002
          MOVE      ZERO,IBTMH003
          MOVE      ZERO,IBTMH004
          MOVE      SP70,IBTMH005
          MOVE      SP70,IBTMH006
          MOVE      SP70,IBTMH007
.
          MOVE      SP70,IBCPY001
          MOVE      SP70,IBCPY002
.
          MOVE      SP70,IBTMD001
          MOVE      ZERO,IBTMD002
          MOVE      ZERO,IBTMD003
          MOVE      ZERO,IBTMD004
          MOVE      ZERO,IBTMD005
          MOVE      ZERO,IBTMD006
          MOVE      SP70,IBTMD007
          MOVE      ZERO,IBTMD008
          MOVE      SP70,IBTMD009
.
          MOVE      ZERO,IBVAR001
          MOVE      SP70,IBVAR002
          MOVE      ZERO,IBVAR003
          MOVE      ZERO,IBVAR004
.
          MOVE      SP70,WBLAB001
          MOVE      SP70,WBLAB002
          MOVE      ZERO,WBLAB003
.
          MOVE      SP70,PMTLE001
          MOVE      SP70,PMTLE002
          MOVE      ZERO,PMTLE003
.
          MOVE      SP70,PMREL001
          MOVE      SP70,PMREL002
          MOVE      ZERO,PMREL003
          MOVE      SP70,PMREL004
.
          MOVE      SP70,UPDSAVKY
          MOVE      SP70,SELPRINT
          MOVE      SP70,FLDNUMBR
          MOVE      SP70,PMNEW001
          MOVE      SP70,PMNEW002
          MOVE      SP70,PMNEW003
          MOVE      SP70,PMNEW004
          MOVE      SP70,PMNEW005
.
          MOVE      SP70,PMBOR001
          MOVE      SP70,PMBOR002
          MOVE      SP70,PMBOR003
          MOVE      SP70,PMBOR004
.
          MOVE      SP70,IBPRT001
          MOVE      SP70,IBPRT002
          MOVE      SP70,IBPRT003
          MOVE      SP70,IBPRT004
          MOVE      SP70,IBPRT005
          MOVE      Z70,IBPRT006
          MOVE      Z70,IBPRT007
          PACK      IBPRT008,Z70,Z70
          PACK      IBPRT009,Z70,Z70
          MOVE      SP70,PRITAVLB
.
          MOVE      Z70,DEPRT001
          MOVE      Z70,DEPRT002
          MOVE      Z70,DEPRT003
          MOVE      Z70,DEPRT004
          MOVE      Z70,DEPRT005
          MOVE      Z70,DEPRT006
.
          MOVE      Z70,IBPDD001
          MOVE      Z70,IBPDD002
          MOVE      Z70,IBPDD003
.
          MOVE      ONE,PRINTCNT
          WHILE     PRINTCNT <= 99
            MOVE      SP70,PRINTARR[PRINTCNT]
            ADD       ONE,PRINTCNT
          DO
.
          MOVE      ONE,HIDPTCNT
          WHILE     HIDPTCNT <= 99
            MOVE      SP70,HIDPRINT[HIDPTCNT]
            ADD       ONE,HIDPTCNT
          DO
.
          MOVE      ZERO,PRINTCNT
          MOVE      ZERO,HIDPTCNT
.
CLRPAR99  RETURN
.------------------------------------------------------------------------------
. Set Parameters
.------------------------------------------------------------------------------
SETPAR00  MATCH     "reportno=",QRYNAME
          IF        @EQUAL
            MOVE      QRYDATA,REPORTNO
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "template=",QRYNAME
          IF        @EQUAL
            MOVE      QRYDATA,TEMPLATE
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "filthosp=",QRYNAME
          IF        @EQUAL
            PACK      FILTHOSP,QRYDATA,SP70
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "filtstty=",QRYNAME
          IF        @EQUAL
            PACK      FILTSTTY,QRYDATA,SP70
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "updttype=",QRYNAME
          IF        @EQUAL
            MOVE      QRYDATA,UPDTTYPE
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "nextpage=",QRYNAME
          IF        @EQUAL
            MOVE      QRYDATA,NEXTPAGE
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "startkey=",QRYNAME
          IF        @EQUAL
            MOVE      QRYDATA,STARTKEY
            PACK      STARTKEY,STARTKEY,SP70
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "redirect=",QRYNAME
          IF        @EQUAL
            MOVE      QRYDATA,REDIRECT
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "norecord=",QRYNAME
          IF        @EQUAL
            MOVE      QRYDATA,NORECORD
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "startnum=",QRYNAME
          IF        @EQUAL
            MOVE      QRYDATA,STARTNUM
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "ibtmh",QRYNAME
          IF        @EQUAL
            CALL      STTMH000
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "ibtmd",QRYNAME
          IF        @EQUAL
            CALL      STTMD000
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "ibvar",QRYNAME
          IF        @EQUAL
            CALL      STVAR000
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "wblab",QRYNAME
          IF        @EQUAL
            CALL      STLAB000
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "pmtle",QRYNAME
          IF        @EQUAL
            CALL      STTLE000
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "pmrel",QRYNAME
          IF        @EQUAL
            CALL      STREL000
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "stattype=",QRYNAME
          IF        @EQUAL
            MOVE      QRYDATA,STATTYPE
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "statdesc=",QRYNAME
          IF        @EQUAL
            MOVE      QRYDATA,STATDESC
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "valdtype=",QRYNAME
          IF        @EQUAL
            MOVE      QRYDATA,VALDTYPE
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "statnvar=",QRYNAME
          IF        @EQUAL
            MOVE      QRYDATA,STATNVAR
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "updsavky=",QRYNAME
          IF        @EQUAL
            MOVE      QRYDATA,UPDSAVKY
            PACK      UPDSAVKY,UPDSAVKY,SP70
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "ibcpy001=",QRYNAME
          IF        @EQUAL
            MOVE      QRYDATA,IBCPY001
            PACK      IBCPY001,IBCPY001,SP70
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "ibcpy002=",QRYNAME
          IF        @EQUAL
            MOVE      QRYDATA,IBCPY002
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "selprint=",QRYNAME
          IF        @EQUAL
            MOVE      QRYDATA,SELPRINT
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "fldnumbr=",QRYNAME
          IF        @EQUAL
            MOVE      QRYDATA,FLDNUMBR
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "pmnew001=",QRYNAME
          IF        @EQUAL
            MOVE      QRYDATA,PMNEW001
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "pmnew002=",QRYNAME
          IF        @EQUAL
            MOVE      QRYDATA,PMNEW002
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "pmnew003=",QRYNAME
          IF        @EQUAL
            MOVE      QRYDATA,PMNEW003
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "pmnew004=",QRYNAME
          IF        @EQUAL
            MOVE      QRYDATA,PMNEW004
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "pmnew005=",QRYNAME
          IF        @EQUAL
            MOVE      QRYDATA,PMNEW005
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "pmbor001=",QRYNAME
          IF        @EQUAL
            MOVE      QRYDATA,PMBOR001
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "pmbor002=",QRYNAME
          IF        @EQUAL
            MOVE      QRYDATA,PMBOR002
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "pmbor003=",QRYNAME
          IF        @EQUAL
            MOVE      QRYDATA,PMBOR003
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "pmbor004=",QRYNAME
          IF        @EQUAL
            MOVE      QRYDATA,PMBOR004
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "ibprt",QRYNAME
          IF        @EQUAL
            CALL      STPRT000
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "deprt",QRYNAME
          IF        @EQUAL
            CALL      SDPRT000
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "hidprint=",QRYNAME
          IF        @EQUAL
            COMPARE   "99",HIDPTCNT
            GOTO      SETPAR99 IF EQUAL
            ADD       ONE,HIDPTCNT
            PACK      HIDPRINT[HIDPTCNT],QRYDATA,SP70
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "printarr=",QRYNAME
          IF        @EQUAL
            COMPARE   "99",PRINTCNT
            GOTO      SETPAR99 IF EQUAL
            ADD       ONE,PRINTCNT
            PACK      PRINTARR[PRINTCNT],QRYDATA,SP70
            GOTO      SETPAR99
          ENDIF
.
SETPAR99  RETURN
.
.-------------------------------------------------------------------------------
.   Set Parameters for Printer Details
.-------------------------------------------------------------------------------
STPRT000  MOVE      ZERO,EXIT
          UNPACK    QRYNAME,KEY5,KEY3
          MOVE      KEY3,F3
          BRANCH    F3,STPRT001,STPRT002,STPRT003,STPRT004,STPRT005:
                       STPRT006,STPRT007,STPRT008,STPRT009
.
          MOVE      ONE,EXIT
          GOTO      STPRT999
.
STPRT001  MOVE      QRYDATA,IBPRT001
          GOTO      STPRT999
.
STPRT002  MOVE      QRYDATA,IBPRT002
          GOTO      STPRT999
.
STPRT003  MOVE      QRYDATA,IBPRT003
          GOTO      STPRT999
.
STPRT004  MOVE      QRYDATA,IBPRT004
          GOTO      STPRT999
.
STPRT005  MOVE      QRYDATA,IBPRT005
          GOTO      STPRT999
.
STPRT006  MOVE      QRYDATA,IBPRT006
          GOTO      STPRT999
.
STPRT007  MOVE      QRYDATA,IBPRT007
          GOTO      STPRT999
.
STPRT008  MOVE      QRYDATA,IBPRT008
          GOTO      STPRT999
.
STPRT009  MOVE      QRYDATA,IBPRT009
          GOTO      STPRT999
.
STPRT999  RETURN
.
.-------------------------------------------------------------------------------
.   Set Parameters for Department Printer Details
.-------------------------------------------------------------------------------
SDPRT000  MOVE      ZERO,EXIT
          UNPACK    QRYNAME,KEY5,KEY3
          MOVE      KEY3,F3
          BRANCH    F3,SDPRT001,SDPRT002,SDPRT003,SDPRT004,SDPRT005:
                       SDPRT006
.
          MOVE      ONE,EXIT
          GOTO      SDPRT999
.
SDPRT001  PACK      DEPRT001,QRYDATA,SP70
          GOTO      SDPRT999
.
SDPRT002  PACK      DEPRT002,QRYDATA,SP70
          GOTO      SDPRT999
.
SDPRT003  MOVE      QRYDATA,DEPRT003
          GOTO      SDPRT999
.
SDPRT004  MOVE      QRYDATA,DEPRT004
          GOTO      SDPRT999
.
SDPRT005  MOVE      QRYDATA,DEPRT005
          GOTO      SDPRT999
.
SDPRT006  MOVE      QRYDATA,DEPRT006
          GOTO      SDPRT999
.
SDPRT999  RETURN
.
.-------------------------------------------------------------------------------
. Option 1: Set Parameters for Stationery Template Table
.-------------------------------------------------------------------------------
STTMH000  MOVE      ZERO,EXIT
          UNPACK    QRYNAME,KEY5,KEY3
          MOVE      KEY3,F3
          BRANCH    F3,STTMH001,STTMH002,STTMH003,STTMH004,STTMH005:
                       STTMH006,STTMH007
.
          GOTO      STTMH999
.
STTMH001  SQUEEZE   QRYDATA
          MOVE      QRYDATA,IBTMH001
          PACK      IBTMH001,IBTMH001,SP70
          GOTO      STTMH999
.
STTMH002  MOVE      QRYDATA,IBTMH002
          GOTO      STTMH999
.
STTMH003  MOVE      QRYDATA,IBTMH003
          GOTO      STTMH999
.
STTMH004  MOVE      QRYDATA,IBTMH004
          GOTO      STTMH999
.
STTMH005  MOVE      QRYDATA,IBTMH005
          GOTO      STTMH999
.
STTMH006  MOVE      QRYDATA,IBTMH006
          GOTO      STTMH999
.
STTMH007  MOVE      QRYDATA,IBTMH007
          GOTO      STTMH999
.
STTMH999  RETURN
.-------------------------------------------------------------------------------
. Option 2: Set Parameters for Stationery Details Table
.-------------------------------------------------------------------------------
STTMD000  MOVE      ZERO,EXIT
          UNPACK    QRYNAME,KEY5,KEY3
          MOVE      KEY3,F3
          BRANCH    F3,STTMD001,STTMD002,STTMD003,STTMD004,STTMD005:
                       STTMD006,STTMD007,STTMD008,STTMD009
.
          GOTO      STTMD999
.
STTMD001  SQUEEZE   QRYDATA
          MOVE      QRYDATA,IBTMD001
          PACK      IBTMD001,IBTMD001,SP70
          GOTO      STTMD999
.
STTMD002  MOVE      QRYDATA,IBTMD002
          GOTO      STTMD999
.
STTMD003  MOVE      QRYDATA,IBTMD003
          GOTO      STTMD999
.
STTMD004  MOVE      QRYDATA,IBTMD004
          GOTO      STTMD999
.
STTMD005  MOVE      QRYDATA,IBTMD005
          GOTO      STTMD999
.
STTMD006  MOVE      QRYDATA,IBTMD006
          GOTO      STTMD999
.
STTMD007  MOVE      QRYDATA,IBTMD007
          GOTO      STTMD999
.
STTMD008  MOVE      QRYDATA,IBTMD008
          GOTO      STTMD999
.
STTMD009  MOVE      QRYDATA,IBTMD009
          GOTO      STTMD999
.
STTMD999  RETURN
.-------------------------------------------------------------------------------
.   Option 4: Set Parameters for Stationery Type Details 
.-------------------------------------------------------------------------------
STVAR000  MOVE      ZERO,EXIT
          UNPACK    QRYNAME,KEY5,KEY3
          MOVE      KEY3,F3
          BRANCH    F3,STVAR001,STVAR002,STVAR003,STVAR004
.
          MOVE      ONE,EXIT
          GOTO      STVAR999
.
STVAR001  MOVE      QRYDATA,IBVAR001
          GOTO      STVAR999
.
STVAR002  MOVE      QRYDATA,IBVAR002
          GOTO      STVAR999
.
STVAR003  MOVE      QRYDATA,IBVAR003
          GOTO      STVAR999
.
STVAR004  MOVE      QRYDATA,IBVAR004
          GOTO      STVAR999
.
STVAR999  RETURN
.-------------------------------------------------------------------------------
.   Option 6: Set Parameters for Label Selection Details
.-------------------------------------------------------------------------------
STLAB000  MOVE      ZERO,EXIT
          UNPACK    QRYNAME,KEY5,KEY3
          MOVE      KEY3,F3
          BRANCH    F3,STLAB001,STLAB002,STLAB003
.
          MOVE      ONE,EXIT
          GOTO      STLAB999
.
STLAB001  MOVE      QRYDATA,WBLAB001
          GOTO      STLAB999
.
STLAB002  MOVE      QRYDATA,WBLAB002
          GOTO      STLAB999
.
STLAB003  MOVE      QRYDATA,WBLAB003
          GOTO      STLAB999
.
STLAB999  RETURN
.-------------------------------------------------------------------------------
.   Option 8: Set Parameters for Title Selection Details
.-------------------------------------------------------------------------------
STTLE000  MOVE      ZERO,EXIT
          UNPACK    QRYNAME,KEY5,KEY3
          MOVE      KEY3,F3
          BRANCH    F3,STTLE001,STTLE002,STTLE003
.
          MOVE      ONE,EXIT
          GOTO      STTLE999
.
STTLE001  MOVE      QRYDATA,PMTLE001
          GOTO      STTLE999
.
STTLE002  MOVE      QRYDATA,PMTLE002
          GOTO      STTLE999
.
STTLE003  MOVE      QRYDATA,PMTLE003
          GOTO      STTLE999
.
STTLE999  RETURN
.------------------------------------------------------------
.   Validate Functions - Remote Scripting       
.   Required  -           
.             - VALDTYPE : 1. Validate Stationery Type Var
.------------------------------------------------------------
REMOTE00  BRANCH    VALDTYPE,REMOTE10,REMOTE20
          GOTO      REMOTE91
.
REMOTE10  CALL      VALVAR00        * Validate Stationery Type Var
          GOTO      REMOTE99
.
REMOTE20  CALL      VALNXT00        * Validate Next Stationery Code
          GOTO      REMOTE99
.
REMOTE91  CALL      XMLHED00
          WRITE     HTMLFILE;"<RETURN_VALUE TYPE=ERROR>":
                             "Invalid Validation Type":
                             "</RETURN_VALUE>"
          CALL      XMLEND00
          GOTO      REMOTE99
.
REMOTE99  RETURN
.---------------------------------------------------------------
.   Return Laterality if found for a valid Cancer Code
.   Required  - STATNVAR - Variable Number
.---------------------------------------------------------------
VALVAR00  CALL      XMLHED00
          BRANCH    EXIT,VALVAR99
.
          PACK      KEY8,STATTYPE,STATNVAR,SP70
          CALL      RDIBVAR2                 * Stationery Type Variable
          BRANCH    OVRCD,VALVAR90
.
          WRITE     HTMLFILE;"<RETURN_VALUE TYPE=SIMPLE>":
                             IBVRDESC,"|",IBVRFLEN,"|":
                             "</RETURN_VALUE>"
.
          GOTO      VALVAR98
.
VALVAR90  WRITE     HTMLFILE;"<RETURN_VALUE TYPE=ERROR>":
                             "Invalid Variable No: - ":
                             STATNVAR,"</RETURN_VALUE>"
          GOTO      VALVAR98
.
VALVAR98  CALL      XMLEND00
VALVAR99  RETURN
.------------------------------------------------------------------------------
. Stationery Template Maintenance
.------------------------------------------------------------------------------
IBATMH00  RESET     UPDTTYPE
          MATCH     SP1,UPDTTYPE            * Display Formaction
          GOTO      IBATMH50 IF EQUAL
.
          MATCH     "A",UPDTTYPE            * Add Formaction
          GOTO      IBATMH10 IF EQUAL
.
          MATCH     "U",UPDTTYPE            * Update Formaction
          GOTO      IBATMH20 IF EQUAL
.
          MATCH     "D",UPDTTYPE            * Delete Formaction
          GOTO      IBATMH30 IF EQUAL
.
          MATCH     "C",UPDTTYPE            * Copy Formaction
          GOTO      IBATMH40 IF EQUAL
.
          GOTO      IBATMH90
.
.         ******* ADD FORMACTION *******
.
IBATMH10  PACK      KEY6,IBTMH001,SP70
          CALL      RDIBTH1
          COMPARE   ZERO,OVRCD
          GOTO      IBATMH92 IF EQUAL
.
          MOVE      USERID,IBTHCUID
          CALL      IBACLOCK
          PACK      IBTHCDAT,CCC,CYY,CMM,CDD
          REP       " 0",IBTHCDAT
          CLOCK     TIME,IBTHCTIM
.          
          CALL      TMHSAV00          * Moves input variables to file variables
          CALL      WRIBTH1           * Writes away the data
.
          MOVE      ZERO,EXIT
          GOTO      IBATMH99
.
.         ******* UPDATE FORMACTION *******
.
IBATMH20  PACK      KEY6,IBTMH001,SP70   * Update Formaction
          CALL      RDIBTH1
          BRANCH    OVRCD,IBATMH91
.
          MOVE      USERID,IBTHUUID
          CALL      IBACLOCK
          PACK      IBTHUDAT,CCC,CYY,CMM,CDD
          REP       " 0",IBTHUDAT
          CLOCK     TIME,IBTHUTIM
.          
          CALL      TMHSAV00          * Moves input variables to file variables
          CALL      UPIBTH1           * Writes away the data
.
          MOVE      ZERO,EXIT
          GOTO      IBATMH99
.
.         ******* DELETE FORMACTION *******
.
IBATMH30  PACK      KEY6,IBTMH001,SP70   
          CALL      RDIBTH1
          BRANCH    OVRCD,IBATMH91
.
          CALL      DEIBTH1           * Delete Stationery Template
.
          CALL      DELTMD00          * Delete all Template Detail Records   
.
          MOVE      ZERO,EXIT
          GOTO      IBATMH99
.
.         ******* COPY FORMACTION *******
.
IBATMH40  PACK      KEY6,IBTMH001,SP70   
          CALL      RDIBTH1
          BRANCH    OVRCD,IBATMH91
.
          PACK      KEY6,IBCPY001,SP70
          CALL      RDIBTH1
          COMPARE   ZERO,OVRCD
          GOTO      IBATMH92 IF EQUAL
.
          CALL      CPYTMH00          * Copy Records
.
          MOVE      ZERO,EXIT
          GOTO      IBATMH99
.
.         ************ DISPLAY FORMACTION **********
.
IBATMH50  MOVE      ZERO,EXIT    * Lock template greater than 001
          MOVE      ZERO,F1       
          MOVE      TEMPLATE,F3
          IF        F3=TWO | F3=THREE
            CALL      LCKST000                * Check if Locked
            BRANCH    EXIT,IBATMH99
          ENDIF
.
          PACK      KEY6,IBTMH001,SP70
          CALL      RDIBTH1
          IF        OVRCD=1
            CALL      CLRTMH00        * Clear file variables
          ENDIF
.
          CLEAR     WEBTITLE
          MOVE      "Stationery Template Maintenance",WEBTITLE
          RESET     WEBTITLE
.
          CALL      WEBHED00          * Output File & Write HTML Pg Header
          BRANCH    EXIT,IBATMH99
.
          CALL      WEBBOD00          * Process Web Body
          CALL      WEBEND00          * Process End of HTML File
.
          MOVE      ONE,EXIT
          GOTO      IBATMH99
.
.         ************ DISPLAY ERROR MESSAGES **********
.
IBATMH90  MOVE      "Invalid Form Action.",WEBTITLE
          CALL      WEBERR00
          MOVE      ONE,EXIT
          GOTO      IBATMH99
.
IBATMH91  MOVE      "Stationery Template does not exist",WEBTITLE
          CALL      WEBERR00
          MOVE      ONE,EXIT
          GOTO      IBATMH99
.
IBATMH92  MOVE      "Stationery Template exists",WEBTITLE
          CALL      WEBERR00
          MOVE      ONE,EXIT
          GOTO      IBATMH99
.
IBATMH99  RETURN
.------------------------------------------------------------
. Moves cgi variables into file variables
.------------------------------------------------------------
TMHSAV00  MOVE      IBTMH001,IBTHSCOD   * Stationery Code
          MOVE      IBTMH002,IBTHDESC   * Stationery Description
          MOVE      IBTMH003,IBTHWIDT   * Max Column Width for Printing
          MOVE      IBTMH004,IBTHLENG   * Paper Length of Stationery
          MOVE      IBTMH005,IBTHSTFM   * Stationery Type
          MOVE      IBTMH006,IBTHACTV   * Active Indicator 1=Active 0=Not Active
          MOVE      IBTMH007,IBTHCOMM   * Stationery Comments
          MOVE      SP70,IBTHSPAR       * Spare variable
.
TMHSAV99  RETURN
.-----------------------------------------------------------
. Clear file variables
.-----------------------------------------------------------
CLRTMH00  MOVE      SP70,IBTHSCOD   * Stationery Code
          MOVE      SP70,IBTHDESC   * Stationery Description
          MOVE      ZERO,IBTHWIDT   * Max Column Width for Printing
          MOVE      ZERO,IBTHLENG   * Paper Length of Stationery
          MOVE      SP70,IBTHSTFM   * Stationery Type
          MOVE      SP70,IBTHACTV   * Active Indicator 1=Active 0=Not Active
          PACK      IBTHCOMM,SP70,SP70
          MOVE      SP70,IBTHCUID
          MOVE      SP70,IBTHCDAT
          MOVE      SP70,IBTHCTIM
          MOVE      SP70,IBTHUUID
          MOVE      SP70,IBTHUDAT
          MOVE      SP70,IBTHUTIM
          MOVE      SP70,IBTHSPAR   * Spare variable
.
CLRTMH99  RETURN
.-----------------------------------------------------------
.  Copy Stationery Template 
.-----------------------------------------------------------
CPYTMH00  PACK      KEY6,IBTMH001,SP70   
          CALL      RDIBTH1
          BRANCH    OVRCD,CPYTMH99
.
          MOVE      IBCPY001,IBTHSCOD    * Set Stationery Code
          MOVE      IBCPY002,IBTHDESC    * Set Description
.
          MOVE      USERID,IBTHCUID
          CALL      IBACLOCK
          PACK      IBTHCDAT,CCC,CYY,CMM,CDD
          REP       " 0",IBTHCDAT
          CLOCK     TIME,IBTHCTIM
.          
          MOVE      SP70,IBTHUUID
          MOVE      SP70,IBTHUDAT
          MOVE      SP70,IBTHUTIM
.
          PACK      KEY6,IBTHSCOD,SP70   * Write new Copied Code
          CALL      WRIBTH1
.
          PACK      KEY12,IBTMH001,SP70
CPYTMH10  CALL      RSIBDET1                
          CALL      RKIBDET1                  
          BRANCH    OVRCD,CPYTMH99
.
          MATCH     IBTMH001,IBDTSCOD
          GOTO      CPYTMH99 IF NOT EQUAL   * Different Stationery Code
.
          PACK      SAVKEY12,IBDTSCOD,IBDTROW,IBDTCOL,SP70
.
          MOVE      IBCPY001,IBDTSCOD       * Set Stationery Code
.
          PACK      KEY12,IBDTSCOD,IBDTROW,IBDTCOL,SP70
          CALL      WRIBDET1
.
          MOVE      SAVKEY12,KEY12
          GOTO      CPYTMH10
.
CPYTMH99  RETURN
.-------------------------------------------------------------------------------
.                         ******* DELTMD00 ********
.             ----- Delete all Stationery Code Variables ----
.-------------------------------------------------------------------------------
DELTMD00  PACK      KEY12,IBTMH001,SP70
          CALL      RSIBDET1                
          CALL      RKIBDET1                  
          BRANCH    OVRCD,DELTMD99
.
          MATCH     IBTMH001,IBDTSCOD
          GOTO      DELTMD99 IF NOT EQUAL   * Different Stationery Code
.
          PACK      KEY12,IBDTSCOD,IBDTROW,IBDTCOL,SP70
          CALL      DEIBDET1                
          GOTO      DELTMD00
.
DELTMD99  RETURN
.--------------------------------------------------------------------------
. Check if Locked - Stationery Template Maintenance
. Note: IBCNTMDM was used for Port Locking for Character Software    
.       IBCNWTMD is used for User ID Locking for WEB.
.--------------------------------------------------------------------------
LCKST000  READ      CONTROLF,ZERO;*112,IBCNWTMD * Stat Template Web User Locking
.
          MATCH     SP10,IBCNWTMD             * check if web locked
          GOTO      LCKST990 IF EQUAL
.
          PACK      KEY10,IBCNWTMD,SP10
          CALL      RDWBSE1
          BRANCH    OVRCD,LCKST100
.
          MATCH     USERID,IBCNWTMD             * Check if same userid OK Then!
          GOTO      LCKST999 IF EQUAL
.
          GOTO      LCKST200
.
LCKST100  MOVE      "Unknown User",WBSENAM
.
LCKST200  SQUEEZE   IBCNWTMD
          CLEAR     FORMATNM
          APPEND    IBCNWTMD,FORMATNM
          APPEND    " - ",FORMATNM
          APPEND    WBSENAM,FORMATNM
          RESET     FORMATNM
          CLEAR     WEBTITLE
          APPEND    "Stationery Template Maintanence locked by ",WEBTITLE
          APPEND    FORMATNM,WEBTITLE
          RESET     WEBTITLE
          CALL      WEBERR00
          MOVE      ONE,EXIT
          GOTO      LCKST999
.
LCKST990  MATCH     SP70,UPDTTYPE
          GOTO      LCKST992 IF NOT EQUAL
.
          PACK      IBCNWTMD,USERID,SP10
          WRITAB    CONTROLF,ZERO;*112,IBCNWTMD
.
LCKST992  MOVE      ZERO,EXIT
LCKST999  RETURN
.--------------------------------------------------------------------------
. Check if Locked - Stationery Type Variable Maintenance
. Note: IBCNVARM was used for Port Locking for Character Software    
.       IBCNWVAR is used for User ID Locking for WEB.
.--------------------------------------------------------------------------
LCKVR000  READ      CONTROLF,ZERO;*122,IBCNWVAR * Stat Template Web User Locking
.
          MATCH     SP10,IBCNWVAR             * check if web locked
          GOTO      LCKVR990 IF EQUAL
.
          PACK      KEY10,IBCNWVAR,SP10
          CALL      RDWBSE1
          BRANCH    OVRCD,LCKVR100
.
          MATCH     USERID,IBCNWVAR             * Check if same userid OK Then!
          GOTO      LCKVR992 IF EQUAL
.
          GOTO      LCKVR200
.
LCKVR100  MOVE      "Unknown User",WBSENAM
.
LCKVR200  SQUEEZE   IBCNWVAR
          CLEAR     FORMATNM
          APPEND    IBCNWVAR,FORMATNM
          APPEND    " - ",FORMATNM
          APPEND    WBSENAM,FORMATNM
          RESET     FORMATNM
          CLEAR     WEBTITLE
          APPEND    "Stationery Type Variable Maintanence locked by ",WEBTITLE
          APPEND    FORMATNM,WEBTITLE
          RESET     WEBTITLE
          CALL      WEBERR00
          MOVE      ONE,EXIT
          GOTO      LCKVR999
.
LCKVR990  MATCH     SP70,UPDTTYPE
          GOTO      LCKVR992 IF NOT EQUAL
.
          PACK      IBCNWVAR,USERID,SP10
          WRITAB    CONTROLF,ZERO;*122,IBCNWVAR
.
LCKVR992  MOVE      ZERO,EXIT
LCKVR999  RETURN
.------------------------------------------------------------------------------
. Stationery Template Details Maintenance
.------------------------------------------------------------------------------
IBATMD00  RESET     UPDTTYPE
          MATCH     SP1,UPDTTYPE            * Display Formaction
          GOTO      IBATMD50 IF EQUAL
.
          MATCH     "A",UPDTTYPE            * Add Formaction
          GOTO      IBATMD10 IF EQUAL
.
          MATCH     "U",UPDTTYPE            * Update Formaction
          GOTO      IBATMD20 IF EQUAL
.
          MATCH     "D",UPDTTYPE            * Delete Formaction
          GOTO      IBATMD30 IF EQUAL
.
          MATCH     "P",UPDTTYPE            * Print Preview Stationery
          GOTO      IBATMD40 IF EQUAL
.
          GOTO      IBATMD90
.
.         ******* ADD FORMACTION *******
.
IBATMD10  PACK      KEY6,IBTMD001,SP70   
          CALL      RDIBTH1
          BRANCH    OVRCD,IBATMD93
.
          COMPARE   IBTMD002,IBTHLENG    * Check if row > the page length
          GOTO      IBATMD94 IF LESS
.
          COMPARE   IBTMD003,IBTHWIDT    * Check Column < maximum width
          GOTO      IBATMD95 IF LESS
.
          PACK      KEY12,IBTMD001,IBTMD002,IBTMD003,SP70
          CALL      RDIBDET1
          COMPARE   ZERO,OVRCD
          GOTO      IBATMD92 IF EQUAL
.
          CALL      VALD0000           * Validate new row and column
          BRANCH    EXIT,IBATMD99      * doesn't overlap with others
.
          CALL      TMDSAV00           * Moves input variables to file variables
.
          PACK      KEY12,IBTMD001,IBTMD002,IBTMD003,SP70
          CALL      WRIBDET1           * Writes away the data
.
          MOVE      USERID,IBTHUUID    
          CALL      IBACLOCK
          PACK      IBTHUDAT,CCC,CYY,CMM,CDD
          REP       " 0",IBTHUDAT
          CLOCK     TIME,IBTHUTIM
.
          CALL      UPIBTH1            * update user id/date/time 
.
          MOVE      ZERO,EXIT
          GOTO      IBATMD99
.
.         ******* UPDATE FORMACTION *******
.
IBATMD20  PACK      KEY6,IBTMD001,SP70   
          CALL      RDIBTH1
          BRANCH    OVRCD,IBATMD93
.
          COMPARE   IBTMD002,IBTHLENG    * Check if row > the page length
          GOTO      IBATMD94 IF LESS
.
          COMPARE   IBTMD003,IBTHWIDT    * Check Column < maximum width
          GOTO      IBATMD95 IF LESS
.
          PACK      KEY12,UPDSAVKY,SP70  * Read Current Record
          CALL      RDIBDET1
          BRANCH    OVRCD,IBATMD91
.
          PACK      KEY12,IBTMD001,IBTMD002,IBTMD003,SP70
.
          MATCH     KEY12,UPDSAVKY       * Check Key for change?
          GOTO      IBATMD21 IF EQUAL
.         
.         * Key has changed make sure not already there!           
.
          PACK      KEY12,IBTMD001,IBTMD002,IBTMD003,SP70
          CALL      RAIBDET1
          COMPARE   ZERO,OVRCD
          GOTO      IBATMD92 IF EQUAL
.
          CALL      VALD0000          * Validate new row and column
          BRANCH    EXIT,IBATMD99     * doesn't overlap with others
.
          CALL      TMDSAV00          * Moves input variables to file variables
.
          PACK      KEY12,IBTMD001,IBTMD002,IBTMD003,SP70
          CALL      WRIBDET1          * Write record with old data and new key
.
.         * Now delete old record as we have a new record with new key
.
          PACK      KEY12,UPDSAVKY,SP70  * Read Current Record
          CALL      RDIBDET1
          BRANCH    OVRCD,IBATMD91
.
          CALL      DEIBDET1             * Delete old rec 
.
          MOVE      USERID,IBTHUUID
          CALL      IBACLOCK
          PACK      IBTHUDAT,CCC,CYY,CMM,CDD
          REP       " 0",IBTHUDAT
          CLOCK     TIME,IBTHUTIM
.
          CALL      UPIBTH1            * update user id/date/time
.
          MOVE      ZERO,EXIT
          GOTO      IBATMD99
.
IBATMD21  CALL      VALD0000          * Validate new row and column
          BRANCH    EXIT,IBATMD99     * doesn't overlap with others
.
          PACK      KEY12,UPDSAVKY,SP70  * Reposition on original Record
          CALL      RDIBDET1
          BRANCH    OVRCD,IBATMD91
.
          CALL      TMDSAV00          * Moves input variables to file variables
          CALL      UPIBDET1          * Updates away the data
.
          MOVE      USERID,IBTHUUID
          CALL      IBACLOCK
          PACK      IBTHUDAT,CCC,CYY,CMM,CDD
          REP       " 0",IBTHUDAT
          CLOCK     TIME,IBTHUTIM
.
          CALL      UPIBTH1            * update user id/date/time
.
          MOVE      ZERO,EXIT
          GOTO      IBATMD99
.
.         ******* DELETE FORMACTION *******
.
IBATMD30  PACK      KEY6,IBTMD001,SP70   
          CALL      RDIBTH1
          BRANCH    OVRCD,IBATMD93
.
          PACK      KEY12,IBTMD001,IBTMD002,IBTMD003,SP70
          CALL      RDIBDET1
          BRANCH    OVRCD,IBATMD91
.
          CALL      DEIBDET1         
.
          MOVE      USERID,IBTHUUID
          CALL      IBACLOCK
          PACK      IBTHUDAT,CCC,CYY,CMM,CDD
          REP       " 0",IBTHUDAT
          CLOCK     TIME,IBTHUTIM
.
          CALL      UPIBTH1            * update user id/date/time
.
          MOVE      ZERO,EXIT
          GOTO      IBATMD99
.
.         ************ Preview Stationery **********
.
IBATMD40  PACK      KEY6,IBTMD001,SP70   
          CALL      RDIBTH1
          BRANCH    OVRCD,IBATMD93
.
          CALL      MRPRN000        * Preview Template Listing
.
          MOVE      ZERO,EXIT
          GOTO      IBATMD99
.
.         ************ DISPLAY FORMACTION **********
.
IBATMD50  PACK      KEY6,IBTMD001,SP70
          CALL      RDIBTH1
          BRANCH    OVRCD,IBATMD93

          PACK      KEY12,IBTMD001,IBTMD002,IBTMD003,SP70
          CALL      RDIBDET1
          IF        OVRCD=1
            CALL      CLRTMD00        * Clear file variables
          ENDIF
.
          CLEAR     WEBTITLE
          MOVE      "Stationery Template Details Maintenance",WEBTITLE
          RESET     WEBTITLE
.
          CALL      WEBHED00          * Output File & Write HTML Pg Header
          BRANCH    EXIT,IBATMD99
.
          CALL      WEBBOD00          * Process Web Body
          CALL      WEBEND00          * Process End of HTML File
.
          MOVE      ONE,EXIT
          GOTO      IBATMD99
.
.         ************ DISPLAY ERROR MESSAGES **********
.
IBATMD90  MOVE      "Invalid Form Action.",WEBTITLE
          CALL      WEBERR00
          MOVE      ONE,EXIT
          GOTO      IBATMD99
.
IBATMD91  MOVE      "Stationery Template Detail record does not exist",WEBTITLE
          CALL      WEBERR00
          MOVE      ONE,EXIT
          GOTO      IBATMD99
.
IBATMD92  MOVE      "Row And Column Already On File.",WEBTITLE
          CALL      WEBERR00
          MOVE      ONE,EXIT
          GOTO      IBATMD99
.
IBATMD93  MOVE      "Stationery Template does not record exists",WEBTITLE
          CALL      WEBERR00
          MOVE      ONE,EXIT
          GOTO      IBATMD99
.
IBATMD94  MOVE      "Row Selected Is Greater The Page Length.",WEBTITLE
          CALL      WEBERR00
          MOVE      ONE,EXIT
          GOTO      IBATMD99
.
IBATMD95  MOVE      "Column Selected Is Greater Than The Page Width.",WEBTITLE
          CALL      WEBERR00
          MOVE      ONE,EXIT
          GOTO      IBATMD99
.
IBATMD99  RETURN
.-----------------------------------------------------------
. Clear file variables
.-----------------------------------------------------------
CLRTMD00  MOVE      SP70,IBDTSCOD   * Stationery Code
          MOVE      ZERO,IBDTROW    * Row for Printing
          MOVE      ZERO,IBDTCOL    * Column for Printing
          MOVE      ZERO,IBDTINDC   * Indicator 1=Text Item 2= Data Item
          MOVE      ZERO,IBDTPLEN   * Length to Print
          MOVE      ZERO,IBDTCOLR   * Color
          MOVE      SP70,IBDTTXFL   * Text/Field No.
          MOVE      SP70,IBDTSPAR   * Spare Variable
.
CLRTMD99  RETURN
.------------------------------------------------------------
. Moves cgi variables into file variables
.------------------------------------------------------------
TMDSAV00  MOVE      IBTMD001,IBDTSCOD   * Stationery Code
          MOVE      IBTMD002,IBDTROW    * Row for Printing
          MOVE      IBTMD003,IBDTCOL    * Column for Printing
          MOVE      IBTMD004,IBDTINDC   * Indicator 1=Text Item 2= Data Item
          MOVE      IBTMD005,IBDTPLEN   * Length to Print
          MOVE      IBTMD006,IBDTCOLR   * Color
          COMPARE   ZERO,IBTMD008
          IF        !@EQUAL
            PACK      IBDTTXFL,IBTMD008,DASH,IBTMD007  * Field - Desc
          ELSE
            MOVE      IBTMD007,IBDTTXFL   * Text/Field No.
          ENDIF 
          MOVE      SP70,IBDTPIND       * Print Indicator
          MATCH     SP70,IBTMD009
          IF        !@EQUAL
            PACK      IBDTPIND,IBTMD009,SP70
          ENDIF
.
TMDSAV99  RETURN
.***************************************************************************
.*                               VALD0000                                  *
.*   Routine to validate the Row and Column for a given entry.             *
.*   i.e. Making sure they don't overlap                                   *
.***************************************************************************
VALD0000  
..          MATCH     ANSC,MODE                   * test for change mode
..          GOTO      VALD1000 IF EQUAL
..
.---- position on the Stationery Details file and get the previous record -----
.
.
          MATCH     "A",UPDTTYPE
          IF        @EQUAL
            PACK      KEY12,IBTMD001,IBTMD002,IBTMD003,SP70
            CALL      RDIBDET1
            IF        OVRCD=0
              GOTO      VALD0100
            ENDIF
.
            CALL      RPIBDET1
            BRANCH    OVRCD,VALD0050
          ELSE
            PACK      KEY12,UPDSAVKY,SP70
            CALL      RDIBDET1
            CALL      RPIBDET1
            BRANCH    OVRCD,VALD0050
          ENDIF
.
          MATCH     IBTMD001,IBDTSCOD            * Not found must be new
          GOTO      VALD0050 IF NOT EQUAL 
.
          COMPARE   IBTMD002,IBDTROW             * Don't validate if the rows
          GOTO      VALD0050 IF NOT EQUAL        * are not equal
.
.------ test that current column is greater than or equal to ------
.------ the previous column added to the length of the previous item ------
.
          MOVE      IBDTCOL,THISPOS
          ADD       IBDTPLEN,THISPOS
.
          COMPARE   THISPOS,IBTMD003
          GOTO      VALD0100 IF LESS
.
VALD0050  MATCH     "A",UPDTTYPE
          IF        @EQUAL
            PACK      KEY12,IBTMD001,IBTMD002,IBTMD003,SP70
            CALL      RDIBDET1
            IF        OVRCD=0
              GOTO      VALD0100
            ENDIF      
.
            CALL      RKIBDET1
            BRANCH    OVRCD,VALD8000
          ELSE
            PACK      KEY12,UPDSAVKY,SP70
            CALL      RDIBDET1
            CALL      RKIBDET1
            BRANCH    OVRCD,VALD8000 
          ENDIF
.
          MATCH     IBTMD001,IBDTSCOD
          GOTO      VALD8000 IF NOT EQUAL
.
          COMPARE   IBTMD002,IBDTROW
          GOTO      VALD8000 IF NOT EQUAL
.
          MOVE      IBTMD003,THISPOS
          ADD       IBTMD005,THISPOS
.
          COMPARE   THISPOS,IBDTCOL
          GOTO      VALD0100 IF LESS
.
          GOTO      VALD8000
.
.------ column is invalid ------
.
VALD0100  MOVE      "Existing Data Overlaps With This Column.",WEBTITLE
          CALL      WEBERR00
          MOVE      ONE,EXIT
          GOTO      VALD9999
.
.------ column is O.K. ------
.
VALD8000  MOVE      FALSE,EXIT
VALD9999  RETURN
.------------------------------------------------------------------------------
. Stationery Type Display    
.------------------------------------------------------------------------------
IBATYP00  RESET     UPDTTYPE
          MATCH     SP1,UPDTTYPE            * Display Formaction
          GOTO      IBATYP40 IF EQUAL
.
          GOTO      IBATYP90
.
.         ************ DISPLAY FORMACTION **********
.
IBATYP40  CLEAR     WEBTITLE
          MOVE      "Stationery Type Maintenance",WEBTITLE
          RESET     WEBTITLE
.
          CALL      WEBHED00          * Output File & Write HTML Pg Header
          BRANCH    EXIT,IBATYP99
.
          CALL      WEBBOD00          * Process Web Body
          CALL      WEBEND00          * Process End of HTML File
.
          MOVE      ONE,EXIT
          GOTO      IBATYP99
.
.         ************ DISPLAY ERROR MESSAGES **********
.
IBATYP90  MOVE      "Invalid Form Action.",WEBTITLE
          CALL      WEBERR00
          MOVE      ONE,EXIT
          GOTO      IBATYP99
.
IBATYP99  RETURN
.------------------------------------------------------------------------------
. Stationery Type Variable Maintenance
.------------------------------------------------------------------------------
IBAVAR00  RESET     UPDTTYPE
          MATCH     SP1,UPDTTYPE            * Display Formaction
          GOTO      IBAVAR40 IF EQUAL
.
          MATCH     "A",UPDTTYPE            * Add Formaction
          GOTO      IBAVAR10 IF EQUAL
.
          MATCH     "U",UPDTTYPE            * Update Formaction
          GOTO      IBAVAR20 IF EQUAL
.
          MATCH     "D",UPDTTYPE            * Delete Formaction
          GOTO      IBAVAR30 IF EQUAL
.
          GOTO      IBAVAR90
.
.         ******* ADD FORMACTION *******
.
IBAVAR10  PACK      KEY8,IBVAR001,IBVAR003,SP70
          CALL      RDIBVAR2
          COMPARE   ZERO,OVRCD
          GOTO      IBAVAR92 IF EQUAL
.
          PACK     KEY33,IBVAR001,IBVAR002,SP70
          CALL     RAIBVAR1
          COMPARE  ZERO,OVRCD
          GOTO     IBAVAR94 IF EQUAL
.
          CALL      SAVVAR00          * Moves input variables to file variables
.
          PACK      KEY8,IBVAR001,IBVAR003,SP70
          CALL      WRIBVAR2      * Writes away the data
.
          MOVE      ZERO,EXIT
          GOTO      IBAVAR99
.
.         ******* UPDATE FORMACTION *******
.
IBAVAR20  PACK      KEY8,IBVAR001,IBVAR003,SP70
          CALL      RDIBVAR2
          BRANCH    OVRCD,IBAVAR91
.
          PACK     KEY33,IBVAR001,IBVAR002,SP70
          CALL     RDIBVAR1
          COMPARE  ZERO,OVRCD
          IF       @EQUAL
            COMPARE  IBVRFNUM,IBVAR003       * check if it's the same record
            GOTO     IBAVAR94 IF NOT EQUAL
          ENDIF
.
          CALL      SAVVAR00      * Moves input variables to file variables
          CALL      UPIBVAR2      * Writes away the data
.
          MOVE      ZERO,EXIT
          GOTO      IBAVAR99
.
.         ******* DELETE FORMACTION *******
.
IBAVAR30  PACK      KEY8,IBVAR001,IBVAR003,SP70
          CALL      RDIBVAR2
          BRANCH    OVRCD,IBAVAR91
.
          PACK      KEY8,IBVAR001,IBVAR003,SP70
          CALL      DEIBVAR2      * Delete Stationery Template
.
          MOVE      ZERO,EXIT
          GOTO      IBAVAR99
.
.         ************ DISPLAY FORMACTION **********
.
IBAVAR40  MOVE      ZERO,EXIT    * Lock template greater than 001
          MOVE      ZERO,F1
          MOVE      TEMPLATE,F3
          IF        F3=TWO | F3=THREE
            CALL      LCKVR000                * Check if Locked
            BRANCH    EXIT,IBAVAR99
          ENDIF 
.
          MOVE      SP70,TYPENAME 
          COMPARE   FORTY,IBVAR001
          GOTO      IBAVAR50 IF NOT LESS
.
          MOVE      IBASTYP0,TYPENAME
          LOAD      TYPENAME,IBVAR001,IBASTYP1,IBASTYP2,IBASTYP3,IBASTYP4:
                                      IBASTYP5,IBASTYP6,IBASTYP7,IBASTYP8:
                                      IBASTYP9,IBASTP10,IBASTP11,IBASTP12:
                                      IBASTP13,IBASTP14,IBASTP15,IBASTP16:
                                      IBASTP17,IBASTP18,IBASTP19,IBASTP20
          GOTO      IBAVAR60
.
IBAVAR50  MOVE      IBVAR001,NSORTYPE
          SUB       FORTY,NSORTYPE
          CALL      NSMORDES
          BRANCH    OVRCD,IBAVAR93
.
          MOVE      NSORDESC,TYPENAME 
.
IBAVAR60  PACK      KEY8,IBVAR001,IBVAR003,SP70
          CALL      RDIBVAR2
          IF        OVRCD=1
            CALL      CLRVAR00        * Clear file variables
          ENDIF
.
          CLEAR     WEBTITLE
          MOVE      "Stationery Type Variable Maintenance",WEBTITLE
          RESET     WEBTITLE
.
          CALL      WEBHED00          * Output File & Write HTML Pg Header
          BRANCH    EXIT,IBAVAR99
.
          CALL      WEBBOD00          * Process Web Body
          CALL      WEBEND00          * Process End of HTML File
.
          MOVE      ONE,EXIT
          GOTO      IBAVAR99
.
.         ************ DISPLAY ERROR MESSAGES **********
.
IBAVAR90  MOVE      "Invalid Form Action.",WEBTITLE
          CALL      WEBERR00
          MOVE      ONE,EXIT
          GOTO      IBAVAR99
.
IBAVAR91  MOVE      "Stationery Type Variable does not exist",WEBTITLE
          CALL      WEBERR00
          MOVE      ONE,EXIT
          GOTO      IBAVAR99
.
IBAVAR92  MOVE      "Stationery Type Variable exists",WEBTITLE
          CALL      WEBERR00
          MOVE      ONE,EXIT
          GOTO      IBAVAR99
.
IBAVAR93  MOVE      "Stationery Type does not exist",WEBTITLE
          CALL      WEBERR00
          MOVE      ONE,EXIT
          GOTO      IBAVAR99
.
IBAVAR94  MOVE      "Stationery Type Description already exists",WEBTITLE
          CALL      WEBERR00
          MOVE      ONE,EXIT
          GOTO      IBAVAR99
.
IBAVAR99  RETURN
.------------------------------------------------------------
. Moves cgi variables into file variables
.------------------------------------------------------------
CLRVAR00  MOVE      ZERO,IBVRSTYP   * Stationery Type
          MOVE      SP70,IBVRDESC   * Variable Description
          MOVE      ZERO,IBVRFNUM   * Field No.
          MOVE      ZERO,IBVRFLEN   * Field Length
          MOVE      SP70,IBVRSPAR   * Spare Variable
.
CLRVAR99  RETURN
.-----------------------------------------------------------
. Clear file variables
.-----------------------------------------------------------
SAVVAR00  MOVE      IBVAR001,IBVRSTYP   * Stationery Type
          MOVE      IBVAR002,IBVRDESC   * Variable Description
          MOVE      IBVAR003,IBVRFNUM   * Field No.
          MOVE      IBVAR004,IBVRFLEN   * Field Length
          MOVE      SP70,IBVRSPAR       * Spare Variable
.
SAVVAR99  RETURN
.------------------------------------------------------------------------------
. Label select list Maintenance
.------------------------------------------------------------------------------
WEBLAB00  RESET     UPDTTYPE
          MATCH     SP1,UPDTTYPE            * Display Formaction
          GOTO      WEBLAB40 IF EQUAL
.
          MATCH     "A",UPDTTYPE            * Add Formaction
          GOTO      WEBLAB10 IF EQUAL
.
          MATCH     "U",UPDTTYPE            * Update Formaction
          GOTO      WEBLAB20 IF EQUAL
.
          MATCH     "D",UPDTTYPE            * Delete Formaction
          GOTO      WEBLAB30 IF EQUAL
.
          GOTO      WEBLAB90
.
.         ******* ADD FORMACTION *******
.
WEBLAB10  PACK      KEY4,WBLAB001,WBLAB002,SP70
          CALL      RDWBLAB1
          COMPARE   ZERO,OVRCD
          GOTO      WEBLAB92 IF EQUAL
.
          CALL      SAVLAB00          * Moves input variables to file variables
.
          PACK      KEY4,WBLBSYST,WBLBNUML,SP70
          CALL      WRWBLAB1      * Writes away the data
.
          MOVE      ZERO,EXIT
          GOTO      WEBLAB99
.
.
.         ******* UPDATE FORMACTION *******
.
WEBLAB20  PACK      KEY4,WBLAB001,WBLAB002,SP70
          CALL      RDWBLAB1
          BRANCH    OVRCD,WEBLAB91
.
          PACK      KEY4,WBLBSYST,WBLBNUML,SP70
          CALL      SAVLAB00      * Moves input variables to file variables
.
          CALL      RAWBLAB1      * go to correct record for key 1
          CALL      UPWBLAB1      * Writes away the data
.
          MOVE      ZERO,EXIT
          GOTO      WEBLAB99
.
.
.         ******* DELETE FORMACTION *******
.
WEBLAB30  PACK      KEY4,WBLAB001,WBLAB002,SP70
          CALL      RDWBLAB1
          BRANCH    OVRCD,WEBLAB91
.
          PACK      KEY4,WBLBSYST,WBLBNUML,SP70
          CALL      DEWBLAB1      * Delete Stationery Template
.
          MOVE      ZERO,EXIT
          GOTO      WEBLAB99
.
.         ************ DISPLAY FORMACTION **********
.
WEBLAB40  MOVE      ZERO,EXIT
          PACK      KEY4,WBLAB001,WBLAB002,SP70
          CALL      RDWBLAB1
          IF        OVRCD=1
            CALL      CLRLAB00        * Clear file variables
          ENDIF
.
          CLEAR     WEBTITLE
          MOVE      "Label Selection Maintenance",WEBTITLE
          RESET     WEBTITLE
.
          CALL      WEBHED00          * Output File & Write HTML Pg Header
          BRANCH    EXIT,WEBLAB99
.
          CALL      WEBBOD00          * Process Web Body
          CALL      WEBEND00          * Process End of HTML File
.
          MOVE      ONE,EXIT
          GOTO      WEBLAB99
.
.         ************ DISPLAY ERROR MESSAGES **********
.
WEBLAB90  MOVE      "Invalid Form Action.",WEBTITLE
          CALL      WEBERR00
          MOVE      ONE,EXIT
          GOTO      WEBLAB99
.
WEBLAB91  MOVE      "Label Selection record does not exist",WEBTITLE
          CALL      WEBERR00
          MOVE      ONE,EXIT
          GOTO      WEBLAB99
.
WEBLAB92  MOVE      "Label Selection record exists",WEBTITLE
          CALL      WEBERR00
          MOVE      ONE,EXIT
          GOTO      WEBLAB99
.
WEBLAB99  RETURN
.------------------------------------------------------------
. Moves cgi variables into file variables
.------------------------------------------------------------
CLRLAB00  MOVE      SP70,WBLBSYST   * System
          MOVE      ZERO,WBLBNUML   * Number of Labels
          MOVE      ZERO,WBLBDEFT   * Default (1=Yes)
          MOVE      SP70,WBLBSPAR   * Spare Variable
.
CLRLAB99  RETURN
.-----------------------------------------------------------
. Clear file variables
.-----------------------------------------------------------
SAVLAB00  MOVE      WBLAB001,WBLBSYST   * System
          MOVE      WBLAB002,F3
          MOVE      F3,WBLBNUML         * Number of Labels
          MOVE      WBLAB003,WBLBDEFT   * Default  
          MOVE      SP70,WBLBSPAR       * Spare Variable
.
SAVLAB99  RETURN
.------------------------------------------------------------------------------
. Title select list Maintenance
.------------------------------------------------------------------------------
WEBTLE00  RESET     UPDTTYPE
          MATCH     SP1,UPDTTYPE            * Display Formaction
          GOTO      WEBTLE40 IF EQUAL
.
          MATCH     "A",UPDTTYPE            * Add Formaction
          GOTO      WEBTLE10 IF EQUAL
.
          MATCH     "U",UPDTTYPE            * Update Formaction
          GOTO      WEBTLE20 IF EQUAL
.
          MATCH     "D",UPDTTYPE            * Delete Formaction
          GOTO      WEBTLE30 IF EQUAL
.
          GOTO      WEBTLE90
.
.         ******* ADD FORMACTION *******
.
WEBTLE10  PACK      KEY4,PMTLE001,SP70
          CALL      RDPMTLE1
          COMPARE   ZERO,OVRCD
          GOTO      WEBTLE92 IF EQUAL
.
          CALL      SAVTLE00          * Moves input variables to file variables
.
          PACK      KEY4,PMTLTITL,SP70
          CALL      WRPMTLE1      * Writes away the data
.
          MOVE      ZERO,EXIT
          GOTO      WEBTLE99
.
.
.         ******* UPDATE FORMACTION *******
.
WEBTLE20  PACK      KEY4,PMTLE001,SP70
          CALL      RDPMTLE1
          BRANCH    OVRCD,WEBTLE91
.
          PACK      KEY4,PMTLTITL,SP70
          CALL      SAVTLE00      * Moves input variables to file variables
.
          CALL      RAPMTLE1      * go to correct record for key 1
          CALL      UPPMTLE1      * Writes away the data
.
          MOVE      ZERO,EXIT
          GOTO      WEBTLE99
.
.
.         ******* DELETE FORMACTION *******
.
WEBTLE30  PACK      KEY4,PMTLE001,SP70
          CALL      RDPMTLE1
          BRANCH    OVRCD,WEBTLE91
.
          PACK      KEY4,PMTLTITL,SP70
          CALL      DEPMTLE1      * Delete Stationery Template
.
          MOVE      ZERO,EXIT
          GOTO      WEBTLE99
.
.         ************ DISPLAY FORMACTION **********
.
WEBTLE40  MOVE      ZERO,EXIT
          PACK      KEY4,PMTLE001,SP70
          CALL      RDPMTLE1
          IF        OVRCD=1
            CALL      CLRTLE00        * Clear file variables
          ENDIF
.
          CLEAR     WEBTITLE
          MOVE      "Title Selection Maintenance",WEBTITLE
          RESET     WEBTITLE
.
          CALL      WEBHED00          * Output File & Write HTML Pg Header
          BRANCH    EXIT,WEBTLE99
.
          CALL      WEBBOD00          * Process Web Body
          CALL      WEBEND00          * Process End of HTML File
.
          MOVE      ONE,EXIT
          GOTO      WEBTLE99
.
.         ************ DISPLAY ERROR MESSAGES **********
.
WEBTLE90  MOVE      "Invalid Form Action.",WEBTITLE
          CALL      WEBERR00
          MOVE      ONE,EXIT
          GOTO      WEBTLE99
.
WEBTLE91  MOVE      "Title record does not exist",WEBTITLE
          CALL      WEBERR00
          MOVE      ONE,EXIT
          GOTO      WEBTLE99
.
WEBTLE92  MOVE      "Title record exists",WEBTITLE
          CALL      WEBERR00
          MOVE      ONE,EXIT
          GOTO      WEBTLE99
.
WEBTLE99  RETURN
.-----------------------------------------------------------
. Clear file variables
.-----------------------------------------------------------
CLRTLE00  MOVE      SP70,PMTLTITL   * Title Code
          MOVE      SP70,PMTLDESC   * Description
          MOVE      SP70,PMTLSPAR   * Spare Variable
.
CLRTLE99  RETURN
.------------------------------------------------------------
. Moves cgi variables into file variables
.------------------------------------------------------------
SAVTLE00  MOVE      PMTLE001,PMTLTITL   * Title Code
          MOVE      PMTLE002,PMTLDESC   * Description
          IF        PMTLE003=1
            MOVE      ZERO,PMTLACTV     * Active
          ELSE
            MOVE      ONE,PMTLACTV      * Inactive
          ENDIF
          MOVE      SP70,PMTLSPAR   * Spare Variable
.
SAVTLE99  RETURN
.------------------------------------------------------------------------------
. Newborn default Maintenance
.------------------------------------------------------------------------------
NEWDEF00  RESET     UPDTTYPE
          MATCH     SP1,UPDTTYPE            * Display Formaction
          GOTO      NEWDEF40 IF EQUAL
.
          MATCH     "U",UPDTTYPE            * Update Formaction
          GOTO      NEWDEF20 IF EQUAL
.
          MATCH     "D",UPDTTYPE            * Delete Formaction
          GOTO      NEWDEF30 IF EQUAL
.
          GOTO      NEWDEF90
.
.
.         ******* UPDATE FORMACTION *******
.
NEWDEF20  MOVE      PMNEW001,PMNWFIEL
          MOVE      PMNEW002,PMNWFLNO
          MOVE      PMNEW003,PMNWDEFT
          MOVE      PMNEW004,PMNWCODE
          MOVE      PMNEW005,PMNWFREE
.
          PACK      KEY3,PMNWFLNO
          CALL      RAPMNEW2
          IF        OVRCD=1
            CALL      WRPMNEW2
          ELSE
            CALL      UPPMNEW2
          ENDIF
          MOVE      ZERO,EXIT
          GOTO      NEWDEF99
.
NEWDEF30  MOVE      PMNEW001,PMNWFIEL
          MOVE      PMNEW002,PMNWFLNO
          MOVE      PMNEW003,PMNWDEFT
          MOVE      PMNEW004,PMNWCODE
          MOVE      PMNEW005,PMNWFREE
.
          PACK      KEY3,PMNWFLNO
          CALL      RAPMNEW2
          IF        OVRCD=0
            CALL      DEPMNEW2
          ENDIF
          MOVE      ZERO,EXIT
          GOTO      NEWDEF99
.
.
.         ************ DISPLAY FORMACTION **********
.
NEWDEF40  MOVE      ZERO,EXIT
.
          MATCH     SP70,FLDNUMBR
          IF        !@EQUAL
            PACK      KEY3,FLDNUMBR,SP70
            CALL      RDPMNEW2
            IF        OVRCD=1
              MOVE      PMNEW001,PMNWFIEL
              MOVE      FLDNUMBR,PMNWFLNO
              MOVE      SP70,PMNWDEFT
              MOVE      SP70,PMNWCODE
            ENDIF
          ENDIF
.
          CLEAR     WEBTITLE
          MOVE      "Newborn default Maintenance",WEBTITLE
          RESET     WEBTITLE
.
          CALL      WEBHED00          * Output File & Write HTML Pg Header
          BRANCH    EXIT,NEWDEF99
.
          CALL      WEBBOD00          * Process Web Body
          CALL      WEBEND00          * Process End of HTML File
.
          MOVE      ONE,EXIT
          GOTO      NEWDEF99
.
.         ************ DISPLAY ERROR MESSAGES **********
.
NEWDEF90  MOVE      "Invalid Form Action.",WEBTITLE
          CALL      WEBERR00
          MOVE      ONE,EXIT
          GOTO      NEWDEF99
.
NEWDEF91  MOVE      "Label Selection record does not exist",WEBTITLE
          CALL      WEBERR00
          MOVE      ONE,EXIT
          GOTO      NEWDEF99
.
NEWDEF92  MOVE      "Label Selection record exists",WEBTITLE
          CALL      WEBERR00
          MOVE      ONE,EXIT
          GOTO      NEWDEF99
.
NEWDEF99  RETURN
.------------------------------------------------------------------------------
. Boarder default Maintenance
.------------------------------------------------------------------------------
BORDEF00  RESET     UPDTTYPE
          MATCH     SP1,UPDTTYPE            * Display Formaction
          GOTO      BORDEF40 IF EQUAL
.
          MATCH     "U",UPDTTYPE            * Update Formaction
          GOTO      BORDEF20 IF EQUAL
.
          MATCH     "D",UPDTTYPE            * Delete Formaction
          GOTO      BORDEF30 IF EQUAL
.
          GOTO      BORDEF90
.
.
.         ******* UPDATE FORMACTION *******
.
BORDEF20  MOVE      PMBOR001,PMBOFIEL
          MOVE      PMBOR002,PMBOFLNO
          MOVE      PMBOR003,PMBODEFT
          MOVE      PMBOR004,PMBOCODE
.
          PACK      KEY3,PMBOFLNO
          CALL      RAPMBOR2
          IF        OVRCD=1
            CALL      WRPMBOR2
          ELSE
            CALL      UPPMBOR2
          ENDIF
          MOVE      ZERO,EXIT
          GOTO      BORDEF99
.
BORDEF30  MOVE      PMBOR001,PMBOFIEL
          MOVE      PMBOR002,PMBOFLNO
          MOVE      PMBOR003,PMBODEFT
          MOVE      PMBOR004,PMBOCODE
.
          PACK      KEY3,PMBOFLNO
          CALL      RAPMBOR2
          IF        OVRCD=0
            CALL      DEPMBOR2
          ENDIF
          MOVE      ZERO,EXIT
          GOTO      BORDEF99
.
.
.         ************ DISPLAY FORMACTION **********
.
BORDEF40  MOVE      ZERO,EXIT
.
          MATCH     SP70,FLDNUMBR
          IF        !@EQUAL
            PACK      KEY3,FLDNUMBR,SP70
            CALL      RDPMBOR2
            IF        OVRCD=1
              MOVE      PMBOR001,PMBOFIEL
              MOVE      FLDNUMBR,PMBOFLNO
              MOVE      SP70,PMBODEFT
              MOVE      SP70,PMBOCODE
            ENDIF
          ENDIF
.
          CLEAR     WEBTITLE
          MOVE      "Boarder default Maintenance",WEBTITLE
          RESET     WEBTITLE
.
          CALL      WEBHED00          * Output File & Write HTML Pg Header
          BRANCH    EXIT,BORDEF99
.
          CALL      WEBBOD00          * Process Web Body
          CALL      WEBEND00          * Process End of HTML File
.
          MOVE      ONE,EXIT
          GOTO      BORDEF99
.
.         ************ DISPLAY ERROR MESSAGES **********
.
BORDEF90  MOVE      "Invalid Form Action.",WEBTITLE
          CALL      WEBERR00
          MOVE      ONE,EXIT
          GOTO      BORDEF99
.
BORDEF99  RETURN
.
.------------------------------------------------------------
. Printer Report 
.------------------------------------------------------------
PRTR0000  MATCH     SP70,UPDTTYPE
          GOTO      PRTR7000 IF EQUAL
.
          MATCH     "A",UPDTTYPE            * Add
          GOTO      PRTR1000 IF EQUAL
.
          MATCH     "U",UPDTTYPE            * Update
          GOTO      PRTR2000 IF EQUAL
.
          MATCH     "D",UPDTTYPE            * Delete
          GOTO      PRTR3000 IF EQUAL
.
          GOTO      PRTR9000
.
.         ************ ADD FORMACTION **************
.
PRTR1000  PACK      KEY6,IBPRT001,SP70  * ADD FORMACTION
          CALL      RDPRTA1
          COMPARE   ZERO,OVRCD
          GOTO      PRTR9100 IF EQUAL
.
          CALL      CODSAV00     * Moves input variables to file variables
          CALL      WRPRTA1      * Writes away the data
.
          MOVE      ZERO,EXIT
          GOTO      PRTR9999
.
.         ************ UPDATE FORMACTION **************
.
PRTR2000  PACK      KEY6,IBPRT001,SP70
          CALL      RDPRTA1
          BRANCH    OVRCD,PRTR9200
.
          MOVE      IBPRT002,PRTDESC
.
          MATCH     SP1,IBPRT003
          IF        @EQUAL
            MOVE      "1",PRTAVAL             * Printer not available
          ELSE
            MOVE      "0",PRTAVAL             * Printer available
          ENDIF
.
          MOVE      IBPRT004,PRTTYPE
          MOVE      IBPRT005,PRTPAPER
          MATCH     Z70,IBPRT006
          IF        !@EQUAL
            PACK       IBPTHOSP,IBPRT006,SP70
          ENDIF
.
          MATCH     Z70,IBPRT007
          IF        !@EQUAL
            PACK       IBPTQUEN,IBPRT007,SP70
          ENDIF
.
          MATCH     Z70,IBPRT008
          IF        !@EQUAL
            PACK       IBPTLOCN,IBPRT008,SP70
          ENDIF
.
          MATCH     Z70,IBPRT009
          IF        !@EQUAL
            PACK       IBPTSCRP,IBPRT009,SP70
          ENDIF
.
          CALL      UPPRTA1
.
          CALL      PRTDEP00
.                                    * Update printer description for all dpmts
PRTR2100  PACK     KEY12,QPRTCODE,SP20
          CALL     RSIBPDD3
PRTR2200  CALL     RKIBPDD3
          BRANCH   OVRCD,PRTR2300
.
          MATCH    IBPDPRTR,QPRTCODE
          GOTO     PRTR2300 IF NOT EQUAL
.
          PACK     IBPDPDSC,PRTDESC,SP20
.
          CALL     UPIBPDD3
.
          GOTO     PRTR2200
.
PRTR2300  MOVE      ZERO,EXIT                                       *
          GOTO      PRTR9999
.
.         ************ DELETE FORMACTION **************
.
PRTR3000  PACK      KEY12,IBPRT001,SP70
          CALL      RSIBPDD3
          CALL      RKIBPDD3
          BRANCH    OVRCD,PRTR3100
          
          MATCH     IBPRT001,IBPDPRTR
          GOTO      PRTR3100 IF NOT EQUAL

          CLEAR     WEBTITLE
          APPEND    "Unable to delete. There's department(s) ",WEBTITLE
          APPEND    "attached to this printer. ",WEBTITLE
          RESET     WEBTITLE 

          CALL      WEBERR00
          MOVE      ONE,EXIT
          GOTO      PRTR9999
          
PRTR3100  PACK      KEY6,IBPRT001,SP70
          CALL      RDPRTA1
          BRANCH    OVRCD,PRTR9200
          CALL      DEPRTA1
          MOVE      ZERO,EXIT
          GOTO      PRTR9999
.
.         ************ UPDATE POPS UP *****************
.
PRTR7000  PACK      KEY6,IBPRT001,SP70
          CALL      RDPRTA1
          IF        OVRCD = 1
            MOVE      SP70,PRTCODE
            MOVE      SP70,PRTDESC
            MOVE      SP70,PRTAVAL
            MOVE      SP70,PRTTYPE
            MOVE      SP70,PRTPAPER
            MOVE      SP70,IBPTHOSP
            MOVE      SP70,IBPTQUEN
            MOVE      SP70,IBPTLOCN
            MOVE      SP70,IBPTSCRP
          ENDIF
.
          CLEAR     WEBTITLE
          MOVE      "Printer Maintenance",WEBTITLE
          RESET     WEBTITLE
.
          CALL      WEBHED00   * Create Output File and Write HTML Page Header
          BRANCH    EXIT,PRTR9999
          CALL      WEBBOD00   * Process Web Body
          CALL      WEBEND00   * Process End of HTML File
.
          MOVE      ONE,EXIT
          GOTO      PRTR9999
.
PRTR9000  MOVE      "Invalid Form Action.",WEBTITLE
          CALL      WEBERR00
          MOVE      ONE,EXIT
          GOTO      PRTR9999
.
PRTR9100  MOVE      "Printer Code exists",WEBTITLE     * for add
          CALL      WEBERR00
          MOVE      ONE,EXIT
          GOTO      PRTR9999
.
PRTR9200  MOVE      "Invalid Printer Code",WEBTITLE   * for update and delete
          CALL      WEBERR00
          MOVE      ONE,EXIT
          GOTO      PRTR9999
.
PRTR9999  RETURN
.
.------------------------------------------------------------
. Moves cgi variables into file variables (Printer Report)
.------------------------------------------------------------
CODSAV00  MOVE      IBPRT001,PRTCODE
          MOVE      IBPRT002,PRTDESC         
.
          MATCH     SP1,IBPRT003
          IF        @EQUAL
            MOVE      "1",PRTAVAL             * Printer not available
          ELSE
            MOVE      "0",PRTAVAL             * Printer available
          ENDIF
.
          MOVE      IBPRT004,PRTTYPE
          MOVE      IBPRT005,PRTPAPER
          MATCH     Z70,IBPRT006
          IF        !@EQUAL
            PACK      IBPTHOSP,IBPRT006,SP70
          ENDIF
.
          MATCH     Z70,IBPRT007
          IF        !@EQUAL
            PACK      IBPTQUEN,IBPRT007,SP70
          ENDIF
.
          MATCH     Z70,IBPRT008
          IF        !@EQUAL
            PACK      IBPTLOCN,IBPRT008,SP70
          ENDIF
.
          MATCH     Z70,IBPRT009
          IF        !@EQUAL
            PACK      IBPTSCRP,IBPRT009,SP70
          ENDIF
.
CODSAV99  RETURN
.
.------------------------------------------------------------
. Printer Department Maintenance
.------------------------------------------------------------
DEPR0000  MATCH     SP70,UPDTTYPE
          GOTO      DEPR7000 IF EQUAL
.
          MATCH     "A",UPDTTYPE            * Add
          GOTO      DEPR1000 IF EQUAL
.
          MATCH     "U",UPDTTYPE            * Update
          GOTO      DEPR2000 IF EQUAL
.
          MATCH     "D",UPDTTYPE            * Delete
          GOTO      DEPR3000 IF EQUAL
.
          MATCH     "K",UPDTTYPE            * Add printer to department
          GOTO      DEPR4000 IF EQUAL
.
          MATCH     "W",UPDTTYPE            * Delete printer from department
          GOTO      DEPR5000 IF EQUAL

          GOTO      DEPR9000
.
.         ************ ADD FORMACTION **************
.
DEPR1000  PACK      KEY6,DEPRT001,SP70  * ADD FORMACTION
          CALL      RDIBDPT1
          COMPARE   ZERO,OVRCD
          GOTO      DEPR9100 IF EQUAL
.
          CALL      CDSV0000      * Moves input variables to file variables
          PACK      KEY6,IBDPDEPT,SP70
          CALL      RAIBDPT1
          IF        OVRCD=1
            CALL      WRIBDPT1      * Writes away the data
          ENDIF
.
          MOVE      ZERO,EXIT
          GOTO      DEPR9999
.
.         ************ UPDATE FORMACTION **************
.
DEPR2000  PACK      KEY6,DEPRT001,SP70
          CALL      RDIBDPT1
          BRANCH    OVRCD,DEPR9200
.
          CALL      CDSV0000      * Moves input variables to file variables
.
          CALL      UPIBDPT1
          MOVE      ZERO,EXIT
          GOTO      DEPR9999
.
.         ************ DELETE FORMACTION **************
.
DEPR3000  PACK      KEY12,DEPRT001,SP70
          CALL      RSIBPDD1
          CALL      RKIBPDD1
          BRANCH    OVRCD,DEPR3100

          MATCH     DEPRT001,IBPDDEPT
          GOTO      DEPR3100 IF NOT EQUAL

          CLEAR     WEBTITLE
          APPEND    "Unable to delete. There's printer(s) attached ",WEBTITLE
          APPEND    "to this department. ",WEBTITLE
          RESET     WEBTITLE

          CALL      WEBERR00
          MOVE      ONE,EXIT
          GOTO      DEPR9999

DEPR3100  PACK      KEY6,DEPRT001,SP70
          CALL      RDIBDPT1
          BRANCH    OVRCD,DEPR9200
          CALL      DEIBDPT1
          MOVE      ZERO,EXIT
          GOTO      DEPR9999
.
.         ************ Add Printer to Department ("K") **************
.
DEPR4000  MOVE      ONE,COUNT           * delete all printers on page
          WHILE     COUNT <= HIDPTCNT
            MATCH     SP70,HIDPRINT[COUNT]
            IF        !@EQUAL
              PACK      KEY12,DEPRT001,HIDPRINT[COUNT],SP70
              CALL      DEIBPDD1   * Delete Record
            ENDIF
            ADD      ONE,COUNT
          DO
.
          MOVE      ONE,COUNT             * Add back selected printers on screen
          WHILE     COUNT <= PRINTCNT
            MATCH     SP70,PRINTARR[COUNT]
            IF        !@EQUAL
.                                                * get printer descripition 
              PACK      KEY6,PRINTARR[COUNT],SP70
              CALL      RDPRTA1
              IF        OVRCD=1
                PACK      PRTDESC,SP20
              ENDIF
.
              MOVE      "  1",IBPDSEQU
              PACK      IBPDDEPT,DEPRT001,SP70
              PACK      IBPDPRTR,PRINTARR[COUNT],SP70
              PACK      IBPDPDSC,PRTDESC,SP70
              PACK      KEY12,IBPDDEPT,IBPDPRTR,SP70
              CALL      RAIBPDD1
              IF        OVRCD=1
                CALL      WRIBPDD1   * Delete Record
              ENDIF
            ENDIF
            ADD      ONE,COUNT
          DO
.
.
.PACK      KEY12,IBPDD001,IBPDD003,SP70   * ADD FORMACTION
.         CALL      RDIBPDD1
.         COMPARE   ZERO,OVRCD
.         GOTO      DEPR9100 IF EQUAL
.
.         PACK      IBPDDEPT,IBPDD001,SP5
.         PACK      IBPDSEQU,IBPDD002,SP5
.         PACK      IBPDPRTR,IBPDD003,SP5
.
.         PACK      KEY12,IBPDDEPT,IBPDPRTR,SP70
.         CALL      RAIBPDD1
.         IF        OVRCD=1
.           CALL      WRIBPDD1      * Writes away the data
.         ENDIF
.
          MOVE      ZERO,EXIT
          GOTO      DEPR9999
.
.         ************ Delete Printer From Department ("W") **************
.
DEPR5000  PACK      KEY12,DEPRT001,IBPRT001,SP70
          CALL      RDIBPDD1
          BRANCH    OVRCD,DEPR9200
.
          CALL      DEIBPDD1
          MOVE      ZERO,EXIT
          GOTO      DEPR9999
.
.         ************ UPDATE POPS UP *****************
.
DEPR7000  PACK      KEY6,DEPRT001,SP70
          CALL      RDIBDPT1
          IF        OVRCD = 1
            MOVE      SP70,IBDPDEPT
            MOVE      SP70,IBDPDESC
            MOVE      SP70,IBDPHOSP
            MOVE      SP70,IBDPWARD
            MOVE      SP70,IBDPEMRS
            MOVE      SP70,IBDPOUTL
          ENDIF
.
          PACK      KEY12,IBPDD001,IBPDD003,SP70
          CALL      RDIBPDD1
          IF        OVRCD=1
            MOVE      SP70,IBPDDEPT
            MOVE      SP70,IBPDSEQU
            MOVE      SP70,IBPDPRTR
          ENDIF
.
          PACK      KEY6,IBPRT001,SP70
          CALL      RDPRTA1
          IF        OVRCD = 1
            MOVE      SP70,PRTCODE
            MOVE      SP70,PRTDESC
            MOVE      SP70,PRTAVAL
            MOVE      SP70,PRTTYPE
            MOVE      SP70,PRTPAPER
            MOVE      SP70,IBPTHOSP
            MOVE      SP70,IBPTQUEN
            MOVE      SP70,IBPTLOCN
            MOVE      SP70,IBPTSCRP
          ENDIF
.

          CLEAR     WEBTITLE
          MOVE      "Printer Department Maintenance",WEBTITLE
          RESET     WEBTITLE
.
          CALL      WEBHED00   * Create Output File and Write HTML Page Header
          BRANCH    EXIT,DEPR9999
          CALL      WEBBOD00   * Process Web Body
          CALL      WEBEND00   * Process End of HTML File
.
          MOVE      ONE,EXIT
          GOTO      DEPR9999
.
DEPR9000  MOVE      "Invalid Form Action.",WEBTITLE
          CALL      WEBERR00
          MOVE      ONE,EXIT
          GOTO      DEPR9999
.
DEPR9100  MOVE      "Printer Department Code exists",WEBTITLE     * for add
          CALL      WEBERR00
          MOVE      ONE,EXIT
          GOTO      DEPR9999
.
DEPR9200  MOVE      "Invalid Department Code",WEBTITLE  * for update and delete
          CALL      WEBERR00
          MOVE      ONE,EXIT
          GOTO      DEPR9999
.
DEPR9999  RETURN
.
.------------------------------------------------------------
. Moves cgi variables into file variables (Printer Department)
.------------------------------------------------------------
CDSV0000  MATCH     Z70,DEPRT001
          IF        !@EQUAL
            PACK      IBDPDEPT,DEPRT001,SP70
          ENDIF
.
          MATCH     Z70,DEPRT002
          IF        !@EQUAL
            PACK      IBDPDESC,DEPRT002,SP70
          ENDIF
.
          MATCH     Z70,DEPRT003
          IF        !@EQUAL
            PACK      IBDPHOSP,DEPRT003,SP70
          ENDIF
.
          MATCH     Z70,DEPRT004
          IF        !@EQUAL
            PACK      IBDPWARD,DEPRT004,SP70
          ENDIF
.
          MATCH     Z70,DEPRT005
          IF        !@EQUAL
            PACK      IBDPEMRS,DEPRT005,SP70
          ENDIF
.
          MATCH     Z70,DEPRT006
          IF        !@EQUAL
            PACK      IBDPOUTL,DEPRT006,SP20
          ENDIF
.
.
CDSV9999  RETURN
+
.------------------------------------------------------------------------------
. Process Fields called from WEBBOD00
.------------------------------------------------------------------------------
PROFLD00  BRANCH    REPORTNO,PROFLD10,PROFLD20,PROFLD30,PROFLD40:
                             PROFLD99,PROFLD60,PROFLD70,PROFLD80:
                             PROFLD90,PROFL100,PROFL110,PROFL120
.
          GOTO      PROFLD99
.
PROFLD10  BRANCH    FLDSETNO,PROFLD11
          GOTO      PROFLD99
.
PROFLD11  CALL      TMHS0000        * Stationery Template
          GOTO      PROFLD99
.
PROFLD20  BRANCH    FLDSETNO,PROFLD21,PROFLD22
          GOTO      PROFLD99
.
PROFLD21  CALL      TMHS0000        * Stationery Template
          GOTO      PROFLD99
.
PROFLD22  CALL      TMDS0000        * Stationery Template Details
          GOTO      PROFLD99
.
PROFLD30  BRANCH    FLDSETNO,PROFLD31
          GOTO      PROFLD99
.
PROFLD31  CALL      TYPS0000        * Stationery Types
          GOTO      PROFLD99
.
PROFLD40  BRANCH    FLDSETNO,PROFLD41
          GOTO      PROFLD99
.
PROFLD41  CALL      VARS0000        * Stationery Type Variables
          GOTO      PROFLD99
.
PROFLD60  BRANCH    FLDSETNO,PROFLD61
          GOTO      PROFLD99
.
PROFLD61  CALL      LABS0000        * Label Selection Variables
          GOTO      PROFLD99
.
PROFLD70  BRANCH    FLDSETNO,PROFLD71,PROFLD72,PROFLD73
          GOTO      PROFLD99
.
PROFLD71  CALL      NEWD0000       * Newborn default fields
          GOTO      PROFLD99
.
PROFLD72  CALL      MNEW0000       * More newborn default fields
          GOTO      PROFLD99
.
PROFLD73  CALL      NEWB0000
          GOTO      PROFLD99
.
PROFLD80  BRANCH    FLDSETNO,PROFLD81
          GOTO      PROFLD99
.
PROFLD81  CALL      TLES0000        * Title Selection Variables
          GOTO      PROFLD99
.
PROFLD90  BRANCH    FLDSETNO,PROFLD91
          GOTO      PROFLD99
.
PROFLD91  CALL      RLES0000        * Relationship Selection Variables
          GOTO      PROFLD99
.
PROFL100  BRANCH    FLDSETNO,PROFL101,PROFL102,PROFL103
          GOTO      PROFLD99
.
PROFL101  CALL      BORD0000       * Boarder default fields
          GOTO      PROFLD99
.
PROFL102  CALL      MBOR0000       * More Boarder default fields
          GOTO      PROFLD99
.
PROFL103  CALL      BORB0000
          GOTO      PROFLD99
.
PROFL110  BRANCH    FLDSETNO,PROFL111     * Printers Report
          GOTO      PROFLD99
.
PROFL111  CALL      PRIM0000       * Printer Maintenance     
          GOTO      PROFLD99
.
PROFL120  BRANCH    FLDSETNO,PROFL121     * Printer Department
          GOTO      PROFLD99
.
PROFL121  CALL      PDEP0000       * Printer Dept Maintenance     
          GOTO      PROFLD99
.
PROFLD99  RETURN
.
.-----------------------------------------------------------
. Option 3: Stationery Types
.-----------------------------------------------------------
TYPS0000  BRANCH    FLDITMNO,TYPS0100,TYPS0200,TYPS0300
.
          WRITE     HTMLFILE;"Invalid IBA Tag";
          GOTO      TYPS9999
.
TYPS0100  CALL      TYPTB000    * Stationery Type Display
          GOTO      TYPS9999
.
TYPS0200  CALL      PREV0000        * Previous Set of Codes
          GOTO      TYPS9999
.
TYPS0300  CALL      NEXT0000        * Next Set of Codes
          GOTO      TYPS9999
.
TYPS9999  RETURN
.-----------------------------------------------------------
. Option 4: Stationery Type Variables
.-----------------------------------------------------------
VARS0000  BRANCH    FLDITMNO,VARS0100,VARS0200,VARS0300,VARS0400,VARS0500:
                             VARS0600,VARS0700,VARS0800,VARS0900,VARS1000:
                             VARS1100 
.
          WRITE     HTMLFILE;"Invalid IBA Tag";
          GOTO      VARS9999
.
VARS0100  WRITE     HTMLFILE;IBVAR001;     * Stationery Type
          GOTO      VARS9999
.
VARS0200  WRITE     HTMLFILE;TYPENAME;     * Stationery Type Description
          GOTO      VARS9999
.
VARS0300  WRITE     HTMLFILE;IBVRSTYP;     * Stationery Type
          GOTO      VARS9999
.
VARS0400  WRITE     HTMLFILE;IBVRDESC;     * Variable Description
          GOTO      VARS9999
.
VARS0500  WRITE     HTMLFILE;IBVRFNUM;     * Variable Number
          GOTO      VARS9999
.
VARS0600  WRITE     HTMLFILE;IBVRFLEN;     * Field Length
          GOTO      VARS9999
.
VARS0700  MOVE      ZERO,LNK2PRT    * Display with Link 
          CALL      VARTB000        * Stationery Type Vars by Code
          GOTO      VARS9999
.
VARS0800  MOVE      ZERO,LNK2PRT    * Display with Link 
          CALL      VARDS000        * Stationery Type Vars by Desc
          GOTO      VARS9999
.
VARS0900  CALL      PREVV000        * Previous Set of Codes
          GOTO      VARS9999
.
VARS1000  CALL      NEXTV000        * Next Set of Codes
          GOTO      VARS9999
.
VARS1100  MOVE      ONE,LNK2PRT     * Display with UpdateParent Link 
          CALL      VARTB000        * Stationery Type Vars by Code
          GOTO      VARS9999
.
VARS9999  RETURN
.-----------------------------------------------------------
. Option 6: Label Selection Variables
.-----------------------------------------------------------
LABS0000  BRANCH    FLDITMNO,LABS0100,LABS0200,LABS0300,LABS0400,LABS0500:
                             LABS0600
                             
.
          WRITE     HTMLFILE;"Invalid IBA Tag";
          GOTO      LABS9999
.
LABS0100  WRITE     HTMLFILE;WBLBSYST;     * System
          GOTO      LABS9999
.
LABS0200  WRITE     HTMLFILE;WBLBNUML;     * Number of labels
          GOTO      LABS9999
.
LABS0300  WRITE     HTMLFILE;WBLBDEFT;     * Default
          GOTO      LABS9999
.
LABS0400  CALL      TYPLB000
          GOTO      LABS9999
.
LABS0500  CALL      PREV0000        * Previous Set of Codes
          GOTO      LABS9999
.
LABS0600  CALL      NEXT0000        * Next Set of Codes
          GOTO      LABS9999
.
LABS9999  RETURN
.-----------------------------------------------------------
. Option 8: Label Selection Variables
.-----------------------------------------------------------
TLES0000  BRANCH    FLDITMNO,TLES0100,TLES0200,TLES0300,TLES0400,TLES0500:
                             tlES0600

.
          WRITE     HTMLFILE;"Invalid IBA Tag";
          GOTO      TLES9999
.
TLES0100  WRITE     HTMLFILE;PMTLTITL;     * Title Code
          GOTO      TLES9999
.
TLES0200  WRITE     HTMLFILE;PMTLDESC;     * Title Description
          GOTO      TLES9999
.
TLES0300  WRITE     HTMLFILE;PMTLACTV;     * Active Indicator
          GOTO      TLES9999
.
TLES0400  CALL      TYPTL000
          GOTO      TLES9999
.
TLES0500  CALL      PREV0000        * Previous Set of Codes
          GOTO      TLES9999
.
TLES0600  CALL      NEXT0000        * Next Set of Codes
          GOTO      TLES9999
.
TLES9999  RETURN
.-----------------------------------------------------------
. Option 7: Newborn default fields
.-----------------------------------------------------------
NEWD0000  BRANCH    FLDITMNO,NEWD0100,NEWD0100,NEWD0100,NEWD0100,NEWD0100:
                             NEWD0100,NEWD0100,NEWD0100,NEWD0100,NEWD0100:
                             NEWD0100,NEWD0100,NEWD0100,NEWD0100,NEWD0100:
                             NEWD0100,NEWD0100,NEWD0100,NEWD0100,NEWD0100:
                             NEWD0100,NEWD0100,NEWD0100,NEWD0100,NEWD0100:
                             NEWD0100,NEWD0100,NEWD0100,NEWD0100,NEWD0100:
                             NEWD0100,NEWD0100,NEWD0100,NEWD0100,NEWD0100:
                             NEWD0100,NEWD0100,NEWD0100,NEWD0100,NEWD0100:
                             NEWD0100,NEWD0100,NEWD0100,NEWD0100,NEWD0100:
                             NEWD0100,NEWD0100,NEWD0100,NEWD0100,NEWD0100:
                             NEWD0100,NEWD0100,NEWD0100,NEWD0100,NEWD0100:
                             NEWD0100,NEWD0100,NEWD0100,NEWD0100,NEWD0100:
                             NEWD0100,NEWD0100,NEWD0100,NEWD0100,NEWD0100:
                             NEWD0100,NEWD0100,NEWD0100,NEWD0100,NEWD0100:
                             NEWD0100,NEWD0100,NEWD0100,NEWD0100,NEWD0100:
                             NEWD0100,NEWD0100,NEWD0100,NEWD0100,NEWD0100:
                             NEWD0100,NEWD0100,NEWD0100,NEWD0100,NEWD0100:
                             NEWD0100,NEWD0100,NEWD0100,NEWD0100,NEWD0100:
                             NEWD0100,NEWD0100,NEWD0100,NEWD0100,NEWD0100:
                             NEWD0100,NEWD0100,NEWD0100,NEWD0100
.
          WRITE     HTMLFILE;"Invalid IBA Tag";
          GOTO      NEWD9999
.
NEWD0100  PACK      KEY3,FLDITMNO,SP70
          CALL      RDPMNEW2
          BRANCH    OVRCD,NEWD9999
          WRITE     HTMLFILE;ONE;
          GOTO      NEWD9999
.
NEWD9999  RETURN
+
.-----------------------------------------------------------
. Option 7: More Newborn default fields
.-----------------------------------------------------------
MNEW0000  BRANCH    FLDITMNO,MNEW0100,MNEW0100,MNEW0100,MNEW0100,MNEW0100:
                             MNEW0100,MNEW0100,MNEW0100,MNEW0100,MNEW0100:
                             MNEW0100,MNEW0100,MNEW0100,MNEW0100,MNEW0100:
                             MNEW0100,MNEW0100,MNEW0100,MNEW0100,MNEW0100:
                             MNEW0100,MNEW0100,MNEW0100,MNEW0100,MNEW0100:
                             MNEW0100,MNEW0100,MNEW0100,MNEW0100,MNEW0100:
                             MNEW0100,MNEW0100,MNEW0100,MNEW0100,MNEW0100:
                             MNEW0100,MNEW0100,MNEW0100,MNEW0100,MNEW0100:
                             MNEW0100,MNEW0100,MNEW0100,MNEW0100,MNEW0100:
                             MNEW0100,MNEW0100,MNEW0100,MNEW0100,MNEW0100:
                             MNEW0100,MNEW0100,MNEW0100,MNEW0100,MNEW0100:
                             MNEW0100,MNEW0100,MNEW0100,MNEW0100,MNEW0100:
                             MNEW0100,MNEW0100,MNEW0100,MNEW0100,MNEW0100:
                             MNEW0100,MNEW0100,MNEW0100,MNEW0100,MNEW0100:
                             MNEW0100,MNEW0100,MNEW0100,MNEW0100,MNEW0100:
                             MNEW0100,MNEW0100,MNEW0100,MNEW0100,MNEW0100:
                             MNEW0100,MNEW0100,MNEW0100,MNEW0100,MNEW0100:
                             MNEW0100,MNEW0100,MNEW0100,MNEW0100,MNEW0100:
                             MNEW0100,MNEW0100,MNEW0100,MNEW0100,MNEW0100:
                             MNEW0100,MNEW0100,MNEW0100,MNEW0100,MNEW0100 
          WRITE     HTMLFILE;"Invalid IBA Tag";
          GOTO      MNEW9999
.
MNEW0100  ASSIGN    FLDITMNO+100,FLDITMNO
          PACK      KEY3,FLDITMNO,SP70
          CALL      RDPMNEW2
          BRANCH    OVRCD,NEWD9999
          WRITE     HTMLFILE;ONE;
          GOTO      MNEW9999
.
MNEW9999  RETURN
+
.-----------------------------------------------------------
. Option 7: Newborn default fields
.-----------------------------------------------------------
NEWB0000  BRANCH    FLDITMNO,NEWB0100,NEWB0200,NEWB0300,NEWB0400,NEWB0500:
                             NEWB0600
          WRITE     HTMLFILE;"Invalid IBA Tag";
          GOTO      MNEW9999
.
NEWB0100  CALL      TABNEW00
          GOTO      NEWB9999
.
NEWB0200  WRITE     HTMLFILE;PMNWFIEL;
          GOTO      NEWB9999
.
NEWB0300  WRITE     HTMLFILE;PMNWFLNO;
          GOTO      NEWB9999
.
NEWB0400  WRITE     HTMLFILE;PMNWDEFT;
          GOTO      NEWB9999
.
NEWB0500  WRITE     HTMLFILE;PMNWCODE;
          GOTO      NEWB9999
.
NEWB0600  WRITE     HTMLFILE;PMNWFREE;
          GOTO      NEWB9999
.
NEWB9999  RETURN
+
.-----------------------------------------------------------
. Newborn defaults table
.-----------------------------------------------------------
TABNEW00  UNPACK    DIM127,KEY1,OBJNAME,DIM127
          PACK      KEY8,SP70
          CALL      RSPMNEW1
TABNEW10  CALL      RKPMNEW1
          BRANCH    OVRCD,TABNEW99
.
          WRITE     HTMLFILE;OBJNAME,".addRow(#"",PMNWFLNO,"#")" 
.
          GOTO      TABNEW10
.
TABNEW99  RETURN
+
.-----------------------------------------------------------
. Option 10: Boarder default fields
.-----------------------------------------------------------
BORD0000  BRANCH    FLDITMNO,BORD0100,BORD0100,BORD0100,BORD0100,BORD0100:
                             BORD0100,BORD0100,BORD0100,BORD0100,BORD0100:
                             BORD0100,BORD0100,BORD0100,BORD0100,BORD0100:
                             BORD0100,BORD0100,BORD0100,BORD0100,BORD0100:
                             BORD0100,BORD0100,BORD0100,BORD0100,BORD0100:
                             BORD0100,BORD0100,BORD0100,BORD0100,BORD0100:
                             BORD0100,BORD0100,BORD0100,BORD0100,BORD0100:
                             BORD0100,BORD0100,BORD0100,BORD0100,BORD0100:
                             BORD0100,BORD0100,BORD0100,BORD0100,BORD0100:
                             BORD0100,BORD0100,BORD0100,BORD0100,BORD0100:
                             BORD0100,BORD0100,BORD0100,BORD0100,BORD0100:
                             BORD0100,BORD0100,BORD0100,BORD0100,BORD0100:
                             BORD0100,BORD0100,BORD0100,BORD0100,BORD0100:
                             BORD0100,BORD0100,BORD0100,BORD0100,BORD0100:
                             BORD0100,BORD0100,BORD0100,BORD0100,BORD0100:
                             BORD0100,BORD0100,BORD0100,BORD0100,BORD0100:
                             BORD0100,BORD0100,BORD0100,BORD0100,BORD0100:
                             BORD0100,BORD0100,BORD0100,BORD0100,BORD0100:
                             BORD0100,BORD0100,BORD0100,BORD0100,BORD0100:
                             BORD0100,BORD0100,BORD0100,BORD0100
.
          WRITE     HTMLFILE;"Invalid IBA Tag";
          GOTO      BORD9999
.
BORD0100  PACK      KEY3,FLDITMNO,SP70
          CALL      RDPMBOR2
          BRANCH    OVRCD,BORD9999
          WRITE     HTMLFILE;ONE;
          GOTO      BORD9999
.
BORD9999  RETURN
+
.-----------------------------------------------------------
. Option 10: More Boarder default fields
.-----------------------------------------------------------
MBOR0000  BRANCH    FLDITMNO,MBOR0100,MBOR0100,MBOR0100,MBOR0100,MBOR0100:
                             MBOR0100,MBOR0100,MBOR0100,MBOR0100,MBOR0100:
                             MBOR0100,MBOR0100,MBOR0100,MBOR0100,MBOR0100:
                             MBOR0100,MBOR0100,MBOR0100,MBOR0100,MBOR0100:
                             MBOR0100,MBOR0100,MBOR0100,MBOR0100,MBOR0100:
                             MBOR0100,MBOR0100,MBOR0100,MBOR0100,MBOR0100:
                             MBOR0100,MBOR0100,MBOR0100,MBOR0100,MBOR0100:
                             MBOR0100,MBOR0100,MBOR0100,MBOR0100,MBOR0100:
                             MBOR0100,MBOR0100,MBOR0100,MBOR0100,MBOR0100:
                             MBOR0100,MBOR0100,MBOR0100,MBOR0100,MBOR0100:
                             MBOR0100,MBOR0100,MBOR0100,MBOR0100,MBOR0100:
                             MBOR0100,MBOR0100,MBOR0100,MBOR0100,MBOR0100:
                             MBOR0100,MBOR0100,MBOR0100,MBOR0100,MBOR0100:
                             MBOR0100,MBOR0100,MBOR0100,MBOR0100,MBOR0100:
                             MBOR0100,MBOR0100,MBOR0100,MBOR0100,MBOR0100:
                             MBOR0100,MBOR0100,MBOR0100,MBOR0100,MBOR0100:
                             MBOR0100,MBOR0100,MBOR0100,MBOR0100,MBOR0100:
                             MBOR0100,MBOR0100,MBOR0100,MBOR0100,MBOR0100:
                             MBOR0100,MBOR0100,MBOR0100,MBOR0100,MBOR0100:
                             MBOR0100,MBOR0100,MBOR0100,MBOR0100,MBOR0100
          WRITE     HTMLFILE;"Invalid IBA Tag";
          GOTO      MBOR9999
.
MBOR0100  ASSIGN    FLDITMNO+100,FLDITMNO
          PACK      KEY3,FLDITMNO,SP70
          CALL      RDPMBOR2
          BRANCH    OVRCD,MBOR9999
          WRITE     HTMLFILE;ONE;
          GOTO      MBOR9999
.
MBOR9999  RETURN
+
.-----------------------------------------------------------
. Option 10: Boarder default fields
.-----------------------------------------------------------
BORB0000  BRANCH    FLDITMNO,BORB0100,BORB0200,BORB0300,BORB0400,BORB0500
          WRITE     HTMLFILE;"Invalid IBA Tag";
          GOTO      BORB9999
.
BORB0100  CALL      TABBOR00
          GOTO      BORB9999
.
BORB0200  WRITE     HTMLFILE;PMBOFIEL;
          GOTO      BORB9999
.
BORB0300  WRITE     HTMLFILE;PMBOFLNO;
          GOTO      BORB9999
.
BORB0400  WRITE     HTMLFILE;PMBODEFT;
          GOTO      BORB9999
.
BORB0500  WRITE     HTMLFILE;PMBOCODE;
          GOTO      BORB9999
.
BORB9999  RETURN
+
.-----------------------------------------------------------
. Boarder defaults table
.-----------------------------------------------------------
TABBOR00  UNPACK    DIM127,KEY1,OBJNAME,DIM127
          PACK      KEY8,SP70
          CALL      RSPMBOR1
TABBOR10  CALL      RKPMBOR1
          BRANCH    OVRCD,TABBOR99
.
          WRITE     HTMLFILE;OBJNAME,".addRow(#"",PMBOFLNO,"#")"
.
          GOTO      TABBOR10
.
TABBOR99  RETURN
+
.-----------------------------------------------------------
. Option 1: Stationery Template/Code Maintenance
.-----------------------------------------------------------
TMHS0000  BRANCH    FLDITMNO,TMHS0100,TMHS0200,TMHS0300,TMHS0400,TMHS0500:
                             TMHS0600,TMHS0700,TMHS0800,TMHS0900,TMHS1000:
                             TMHS1100,TMHS1200,TMHS1300,TMHS1400,TMHS1500
.
          WRITE     HTMLFILE;"Invalid IBA Tag";
          GOTO      TMHS9999
.
TMHS0100  WRITE     HTMLFILE;IBTHSCOD;   * Stationery Code
          GOTO      TMHS9999
.
TMHS0200  WRITE     HTMLFILE;IBTHDESC;   * Stationery Code Desc
          GOTO      TMHS9999
.
TMHS0300  WRITE     HTMLFILE;IBTHWIDT;   * Max Column Width for Printing
          GOTO      TMHS9999
.
TMHS0400  WRITE     HTMLFILE;IBTHLENG;   * Paper Length of Stationery 
          GOTO      TMHS9999
.
TMHS0500  WRITE     HTMLFILE;IBTHSTFM;   * Stationery Type
          GOTO      TMHS9999
.
TMHS0600  WRITE     HTMLFILE;IBTHACTV;   * Active Indicator 1=Yes 0=No
          GOTO      TMHS9999
.
TMHS0700  CALL      TMHCD000        * Table of Stationery Templates by Code
          GOTO      TMHS9999
.
TMHS0800  CALL      TMHDS000        * Table of Stationery Templates by Desc
          GOTO      TMHS9999
.
TMHS0900  CALL      NEXT0000        * Next Set of Codes
          GOTO      TMHS9999
.
TMHS1000  CALL      PREV0000        * Previous Set of Codes
          GOTO      TMHS9999
.
TMHS1100  WRITE     HTMLFILE;STARTKEY;   * Startkey                   
          GOTO      TMHS9999
.
TMHS1200  CALL      TYPLST00        * Stationery Type List
          GOTO      TMHS9999
.
TMHS1300  MOVE      IBTHSTFM,TYPENUM    * Set Stationery Type Var
          CALL      TYPDES00            * Get Stationery Type Description
          GOTO      TMHS9999
.
TMHS1400  WRITE     HTMLFILE;IBTHCOMM;   * Stationery Comments
          GOTO      TMHS9999
.
TMHS1500  WRITE     HTMLFILE;FILTSTTY;   * Stationery Type Filter
          GOTO      TMHS9999
.
TMHS9999  RETURN
.-----------------------------------------------------------
. Option 2: Stationery Template Details Maintenance
.-----------------------------------------------------------
TMDS0000  BRANCH    FLDITMNO,TMDS0100,TMDS0200,TMDS0300,TMDS0400,TMDS0500:
                             TMDS0600,TMDS0700,TMDS0800,TMDS0900,TMDS1000:
                             TMDS1100
.
          WRITE     HTMLFILE;"Invalid IBA Tag";
          GOTO      TMDS9999
.
TMDS0100  WRITE     HTMLFILE;IBDTSCOD;   * Stationery Code
          GOTO      TMDS9999
.
TMDS0200  WRITE     HTMLFILE;IBDTROW;    * Row for printing
          GOTO      TMDS9999
.
TMDS0300  WRITE     HTMLFILE;IBDTCOL;    * Column for printing
          GOTO      TMDS9999
.
TMDS0400  WRITE     HTMLFILE;IBDTINDC;   * Indicator 1=Text Item 2=Data Item 
          GOTO      TMDS9999
.
TMDS0500  WRITE     HTMLFILE;IBDTPLEN;   * Length to Print 
          GOTO      TMDS9999
.
TMDS0600  WRITE     HTMLFILE;IBDTCOLR;   * Color 
          GOTO      TMDS9999
.
TMDS0700  WRITE     HTMLFILE;IBDTTXFL;   * Text/Field No.
          GOTO      TMDS9999
.
TMDS0800  CALL      TMDTB000        * Table of Stationery Details 
          GOTO      TMDS9999
.
TMDS0900  UNPACK    DIM127,D1,KEY1,DIM127
.
          MOVE      SP70,FIELDNOD
          MOVE      SP70,KEY40
          MOVE      ZERO,F1
          MOVE      KEY1,F1
.
          UNPACK    IBDTTXFL,FIELDNOD,KEY3,KEY40
          BRANCH    F1,TMDS0910
.
          WRITE     HTMLFILE;KEY40;      * 0=Desc
          GOTO      TMDS9999
.
TMDS0910  WRITE     HTMLFILE;FIELDNOD;       * 1=Code
          GOTO      TMDS9999
.
TMDS1000  PACK      KEY12,IBDTSCOD,IBDTROW,IBDTCOL,SP70
          WRITE     HTMLFILE;KEY12;
          GOTO      TMDS9999
.
TMDS1100  WRITE     HTMLFILE;IBDTPIND;   * Print Indicator
          GOTO      TMDS9999
.
TMDS9999  RETURN
.
.------------------------------------------------------------
. Printer Maintenance Tags
.------------------------------------------------------------
.
PRIM0000  BRANCH    FLDITMNO,PRIM0100,PRIM0200,PRIM0300,PRIM0400,PRIM0500:
                             PRIM0600,PRIM0700,PRIM0800,PRIM0900,PRIM1000:
                             PRIM1100,PRIM1200,PRIM1300

          GOTO      PRIM9999
.
PRIM0100  WRITE     HTMLFILE;PRTCODE;
          GOTO      PRIM9999
.
PRIM0200  WRITE     HTMLFILE;PRTDESC;
          GOTO      PRIM9999
.
PRIM0300  WRITE     HTMLFILE;PRTAVAL;
          GOTO      PRIM9999
.
PRIM0400  WRITE     HTMLFILE;PRTTYPE;
          GOTO      PRIM9999
.
PRIM0500  WRITE     HTMLFILE;PRTPAPER;
          GOTO      PRIM9999

PRIM0600  CALL      PRTAB000
          GOTO      PRIM9999
.
PRIM0700  CALL      PREVGR00          * previous button
          GOTO      PRIM9999
.
PRIM0800  CALL      NEXTGR00          * next button
          GOTO      PRIM9999
.
PRIM0900  PACK      DIM3,IBPTHOSP
          CALL      HSLU0000
          GOTO      PRIM9999
.
PRIM1000  WRITE     HTMLFILE;IBPTQUEN;
          GOTO      PRIM9999
.
PRIM1100  WRITE     HTMLFILE;IBPTLOCN;
          GOTO      PRIM9999
.
PRIM1200  WRITE     HTMLFILE;IBPTSCRP;
          GOTO      PRIM9999
.
PRIM1300  PACK      DIM3,FILTHOSP
          CALL      HSLU0000
          GOTO      PRIM9999
.
PRIM9999  RETURN
.
.------------------------------------------------------------
. Hospital Selection - only hospitals that user has access to
.------------------------------------------------------------
HSLU0000  COMPARE   ONE,IBCNMHOS
          GOTO      HSLU9999 IF NOT EQUAL
.
          MOVE      ZERO,F1
          PACK      KEY13,WBSEUID,SP70
          CALL      RDMLSEC1
          IF        OVRCD<>1
            MOVE      ONE,F1               * Access to all hospitals
          ENDIF
.
          PACK      KEY3,SP70
          CALL      RSPTHSP1
HSLU0100  CALL      RKPTHSP1
          BRANCH    OVRCD,HSLU9999
.
          BRANCH    F1,HSLU0200
.
          PACK      KEY13,WBSEUID,PTHSHOSP,SP70
          CALL      RDMLSEC1
          BRANCH    OVRCD,HSLU0100
.
HSLU0200  MOVE      PTHSNAME,KEY50
          PACK      KEY5,QUOTE,PTHSHOSP,QUOTE
          MATCH     DIM3,PTHSHOSP
          IF        @EQUAL
            WRITE     HTMLFILE;"<option value=",KEY5," selected>":
                               KEY50,"</option>"
          ELSE
            WRITE     HTMLFILE;"<option value=",KEY5,">",KEY50,"</option>"
          ENDIF
          GOTO      HSLU0100
.
HSLU9999  RETURN
+
.-------------------------------------------------------------
. Link to Prev Group (Printer & Printer Department)
.-------------------------------------------------------------
PREVGR00  MOVE      NORECORD,KEY2
          REP       " +",KEY2
          ASSIGN    STARTNUM-NORECORD,F3
          IF        F3<0
            MOVE      ZERO,F3
          ENDIF
          MOVE      F3,KEY3
          REP       " +",KEY3
          UNPACK    DIM127,D1,FLDPARA,DIM127
          MOVE      REPORTNO,F2
.
          REP       " +",STARTKEY
          WRITE     HTMLFILE;"comweb05.pbl":
                                 "?reportno=",F2:
                                 "&template=",FLDPARA:
                                 "&startnum=",KEY3:
                                 "&startkey=",STARTKEY:
                                 "&deprt001=",DEPRT001:
                                 "&norecord=",KEY2:
                                 "&filthosp=",FILTHOSP;               *I-251218
          REP       "+ ",STARTKEY
.
PREVGR99  RETURN
.
.-----------------------------------------------------------
. Link to Next Group (Printer & Printer Department)
.-----------------------------------------------------------
NEXTGR00  MOVE      NORECORD,KEY2
          REP       " +",KEY2
          ASSIGN    STARTNUM+NORECORD,F3
          MOVE      F3,KEY3
          REP       " +",KEY3
          UNPACK    DIM127,D1,FLDPARA,DIM127
          MOVE      REPORTNO,F2
.
          REP       " +",STARTKEY
          WRITE     HTMLFILE;"comweb05.pbl":
                                 "?reportno=",F2:
                                 "&template=",FLDPARA:
                                 "&startnum=",KEY3:
                                 "&startkey=",STARTKEY:
                                 "&deprt001=",DEPRT001:
                                 "&norecord=",KEY2:
                                 "&filthosp=",FILTHOSP;               *I-251218
          REP       "+ ",STARTKEY
.
NEXTGR99  RETURN

.------------------------------------------------------------
. Table of Printer Code
.------------------------------------------------------------
PRTAB000  UNPACK    DIM127,D1,LINKPRG,DIM127
          UNPACK    DIM127,D1,LINKREP,DIM127
          UNPACK    DIM127,D1,LINKTEM,DIM127
.
          CALL      PRHED000      * Output Table Heading
.
          IF        NORECORD=0
            MOVE      PTCNNRTD,NORECORD      * Set Default No Records to Display
          ENDIF
          MOVE      ZERO,RECNUMB
          MOVE      ZERO,DISNUMB
.
          PACK      KEY6,STARTKEY,SP70
          CALL      RDSPRTA1
          IF        OVRCD=0
            CALL      RDPPRTA1
          ENDIF
PRTAB100  CALL      RDKPRTA1
          BRANCH    OVRCD,PRTAB900
.
          MATCH     Z70,FILTHOSP
          IF        !@EQUAL
            MATCH     SP70,FILTHOSP
            IF        !@EQUAL
              MATCH      FILTHOSP,IBPTHOSP
              GOTO       PRTAB100 IF NOT EQUAL
            ENDIF
          ENDIF
.
          ADD       ONE,RECNUMB
          IF        STARTNUM>=RECNUMB
            GOTO      PRTAB100
          ENDIF
.
          CALL      PRROW000      * Display Printer Code Row
          ADD       ONE,DISNUMB
          COMPARE   NORECORD,DISNUMB
          GOTO      PRTAB100 IF NOT EQUAL
          GOTO      PRTAB999
.
PRTAB900  CALL      NOMORE00      * Display No More Records Message
.
PRTAB999  RETURN
.------------------------------------------------------------
. Printer Code (TABLE HEADING)
.------------------------------------------------------------
PRHED000  WRITE     HTMLFILE;"<tr>":
                               "<td class=HeadingCell width=20%>":
                               "<b>Printer Code</b></td>":
                               "<td class=HeadingCell width=20%>":
                               "<b>Description</b></td>":
                               "<td class=HeadingCell width=20%>":
                               "<b>Availability Code</b></td>":
                               "<td class=HeadingCell width=20%>":
                               "<b>Printer Type</b></td>":
                               "<td class=HeadingCell width=20%>":
                               "<b>Paper Type</b></td>":
                             "</tr>"
.
PRHED999  RETURN
.
.------------------------------------------------------------
. Printer Code (TABLE ROW)
.------------------------------------------------------------
PRROW000  MATCH     SP70,PRTDESC
          IF        @EQUAL
             MOVE     "&nbsp;",PRTDESC
          ENDIF
.
PRROW100  COMPARE   "1",PRTAVAL
          IF        @EQUAL
            MOVE      "No",PRITAVLB           * printer not available
          ELSE
            MOVE      "Yes",PRITAVLB
          ENDIF
.
PRROW200  ADD       ONE,PRTTYPE
          LOAD      PRINTYPE,PRTTYPE,PRTYPE00,PRTYPE01,PRTYPE02,PRTYPE03:
                    PRTYPE04,PRTYPE05,PRTYPE06,PRTYPE07,PRTYPE08:
                    PRTYPE09
          SUB       ONE,PRTTYPE
.
PRROW300  ADD       ONE,PRTPAPER
          LOAD      PAPERTYP,PRTPAPER,PRITPR00,PRITPR01,PRITPR02
          SUB       ONE,PRTPAPER
.
          WRITE     HTMLFILE;"<tr><td nowrap><A HREF='javascript:ShowDetail01":
                             "(#"",LINKPRG,"#.pbl":
                             "?reportno=",LINKREP:
                             "&template=",LINKTEM:
                             "&ibprt001=",PRTCODE,"#")'>":
                             "<img src=../images/MaintenanceIcon.gif hspace=4":
                             " border=0 align=absmiddle></a>":
                             PRTCODE,"</td>":
                             "<td>",PRTDESC,"</td><td>",PRITAVLB,"</td>":
                             "<td>",PRINTYPE,"</td><td>",PAPERTYP,"</td>":
                             "</tr>"
.
PRROW999 RETURN
.
.------------------------------------------------------------
. Printer Dept Maintenance Tags
.------------------------------------------------------------
.
PDEP0000  BRANCH    FLDITMNO,PDEP0100,PDEP0200,PDEP0300,PDEP0400,PDEP0500:
                             PDEP0600,PDEP0700,PDEP0800,PDEP0900,PDEP1000:
                             PDEP1100,PDEP1200,PDEP1300,PDEP1400

          GOTO      PDEP9999
.
PDEP0100  WRITE     HTMLFILE;IBDPDEPT;
          GOTO      PDEP9999
.
PDEP0200  UNPACK    DIM127,D1,KEY1,DIM127
          MOVE      ZERO,F1
          MOVE      KEY1,F1
          BRANCH    F1,PDEP0201
          WRITE     HTMLFILE;IBPRT001;      * Printer Code
          GOTO      PDEP9999
.
PDEP0201  MOVE      "Unknown Printer",PRTDESC
          MOVE      SP10,PRTCODE
          PACK      KEY6,IBPRT001,SP10
          CALL      RDPRTA1
          WRITE     HTMLFILE;PRTDESC;       * Printer Description 
          GOTO      PDEP9999
.
PDEP0300  WRITE     HTMLFILE;IBDPDESC;
          GOTO      PDEP9999
.
PDEP0400  CALL      DEPD0000          * department details
          GOTO      PDEP9999
.
PDEP0500  CALL      PREVGR00          * previous button
          GOTO      PDEP9999
.
PDEP0600  CALL      NEXTGR00          * next button
          GOTO      PDEP9999
.
PDEP0700  CALL      PRDE0000          * printer details of one department
          GOTO      PDEP9999
.
PDEP0800  CALL      EDPR0000          * add printer to one department
          GOTO      PDEP9999 

PDEP0900  WRITE     HTMLFILE;DEPRT001;
          GOTO      PDEP9999
.
PDEP1000  PACK      DIM3,IBDPHOSP
          CALL      HSLU0000
          GOTO      PDEP9999
.
PDEP1100  PACK      DIM3,FILTHOSP
          CALL      HSLU0000
          GOTO      PDEP9999
.
PDEP1200  CALL      PRIND000
          GOTO      PDEP9999
.
PDEP1300  PACK      DIM3,FILTHOSP
          CALL      HSLU0000
          GOTO      PRIM9999
.
PDEP1400  CALL      FHIRP000
          GOTO      PRIM9999
.
PDEP9999  RETURN
.
.------------------------------------------------------------
. FHIR Device Printer Pops Up
.------------------------------------------------------------
FHIRP000  WRITE     HTMLFILE;*+," {":
                    " #"fullUrl#": #"%BASEURL/Device/Printer-S#",":
                    " #"resource#": ":
                    "{ #"resourceType#": #"Device#",":
                    " #"id#" : #"Printer-S#",":
                    " #"extension#": [":
                    " { #"url#":#"%BASEURL/extension/webPASService#"":
                        " ,#"valueString#":#"",PRGID,SP1,PRGNAM,SP1,VERSION,"#"},":
                    " { #"url#":#"%BASEURL/extension/webPASTemplate#"":
                        " ,#"valueString#":#"%TEMPLATEHOME/",WBTPFIL," %TEMPLATEVERSION#"}":
                    " ],":
                    " #"status#" : #"active#",":
                    " #"type#" : { #"text#" : #"Printer#" },":
                    " #"udi#" : { #"name#" : #"Spool Report#" } ":
                    "} }";
          OPEN      IBAPDDA4,"ibapddaf"
          PACK      KEY32,WBSEDEPT,SP70       * Position at start of Depa
          CALL      RSIBPDD4
FHIRP100  CALL      RKIBPDD4
          BRANCH    OVRCD,FHIRP999
          MATCH     WBSEDEPT,IBPDDEPT        * Check if in the same Depa
          GOTO      FHIRP999 IF NOT EQUAL
          PACK      KEY6,IBPDPRTR,SP70      * Read the printer file
          CALL      RDPRTA1
          BRANCH    OVRCD,FHIRP100
          REP       " 0",QPRTCODE
          PACK      KEY8,QUOTE,QPRTCODE,QUOTE
           
          WRITE     HTMLFILE;*+,", {":
                    " #"fullUrl#": #"%BASEURL/Device/Printer-",QPRTCODE,"#",":
                    " #"resource#": ":
                    "{ #"resourceType#": #"Device#",":
                    " #"id#" : #"Printer-",QPRTCODE,"#",":
                    " #"extension#": [":
                    " { #"url#":#"%BASEURL/extension/webPASService#"":
                        " ,#"valueString#":#"",PRGID,SP1,PRGNAM,SP1,VERSION,"#"},":
                    " { #"url#":#"%BASEURL/extension/webPASTemplate#"":
                        " ,#"valueString#":#"%TEMPLATEHOME/",WBTPFIL," %TEMPLATEVERSION#"}":
                    " ],":
                    " #"status#" : #"active#",":
                    " #"type#" : { #"text#" : #"Printer#" },":
                    " #"udi#" : { #"name#" : #"",PRTDESC,"#" } ":
                    "} }";
          GOTO      FHIRP100
.
FHIRP999  RETURN
.------------------------------------------------------------
. Selection Printer Pops Up
.------------------------------------------------------------
EDPR0000  PACK      KEY6,SP70
          CALL      RDSPRTA1
EDPR1000  CALL      RDKPRTA1
          BRANCH    OVRCD,EDPR9999

          MOVE      PRTCODE,DIM6
       
          MATCH     IBPDPRTR,DIM6
          IF        @EQUAL
            WRITE     HTMLFILE;"<option value=#"",PRTCODE,"#" selected>":
                               PRTCODE,DASH,PRTDESC,"</option>"
          ELSE
            WRITE     HTMLFILE;"<option value=#"",PRTCODE,"#">":
                               PRTCODE,DASH,PRTDESC,"</option>"
          ENDIF
.
          GOTO      EDPR1000
.
EDPR9999  RETURN
.
.------------------------------------------------------------
. Table of Printer Code Department
.------------------------------------------------------------
DEPD0000  UNPACK    DIM127,D1,LINKPRG,DIM127
          UNPACK    DIM127,D1,LINKREP,DIM127
          UNPACK    DIM127,D1,LINKTEM,DIM127
.
          CALL      PDHD0000      * Output Table Heading
.
          IF        NORECORD=0
            MOVE      PTCNNRTD,NORECORD      * Set Default No Records to Display
          ENDIF
          MOVE      ZERO,RECNUMB
          MOVE      ZERO,DISNUMB
.
          PACK      KEY6,STARTKEY,SP5
          CALL      RDIBDPT1
          IF        OVRCD <> 1
            GOTO      DEPD1100
          ENDIF
.
          CALL      RSIBDPT1
DEPD1000  CALL      RKIBDPT1
          BRANCH    OVRCD,DEPD9000
.
DEPD1100  MATCH     Z70,FILTHOSP
          IF        !@EQUAL
            MATCH     SP70,FILTHOSP
            IF        !@EQUAL
              MATCH     FILTHOSP,IBDPHOSP
              GOTO      DEPD1000 IF NOT EQUAL
            ENDIF
          ENDIF
.
          ADD       ONE,RECNUMB
          IF        STARTNUM>=RECNUMB
            GOTO      DEPD1000
          ENDIF
.
          CALL      PDRW0000      * Display Printer Code Row
          ADD       ONE,DISNUMB
          COMPARE   NORECORD,DISNUMB
          GOTO      DEPD1000 IF NOT EQUAL
          GOTO      DEPD9999
.
DEPD9000  CALL      NOMORE00      * Display No More Records Message
.
DEPD9999  RETURN
.------------------------------------------------------------
. Printer Department Code (TABLE HEADING)
.------------------------------------------------------------
PDHD0000  WRITE     HTMLFILE;"<tr>":
                               "<td class=HeadingCell width=35%>":
                               "<b>Department Code</b></td>":
                               "<td class=HeadingCell width=35%>":
                               "<b>Department Description</b></td>":
                               "<td class=HeadingCell width=30%>":
                               "<b>Hospital</b></td>":
                             "</tr>"
.
PDHD9999  RETURN
.
.------------------------------------------------------------
. Printer Department Code (TABLE ROW)
.------------------------------------------------------------
PDRW0000  MATCH     SP70,IBDPDESC
          IF        @EQUAL
             MOVE     "&nbsp;",IBDPDESC
          ENDIF
.
          MOVE     "&nbsp;",PTHSNAME
          MATCH     SP70,IBDPHOSP
          IF        !@EQUAL
             PACK     KEY3,IBDPHOSP
             CALL     RDPTHSP1 
             IF       OVRCD=1
               MOVE     "&nbsp;",PTHSNAME
             ENDIF
           ENDIF
.
          WRITE     HTMLFILE;"<tr><td nowrap><A HREF='javascript:ShowDetail01":
                             "(#"",LINKPRG,"#.pbl":
                             "?reportno=",LINKREP:
                             "&template=",LINKTEM:
                             "&deprt001=",IBDPDEPT,"#")'>":
                             "<img src=../images/MaintenanceIcon.gif hspace=4":
                             " border=0 align=absmiddle></a>":
                             IBDPDEPT,"</td>":
                             "<td>",IBDPDESC,"</td>":
                             "<td>",PTHSNAME,"</td>":
                             "</tr>"
.
PDRW9999 RETURN
.
.------------------------------------------------------------
. Table for Printer Details of one Department
.------------------------------------------------------------
PRDE0000  UNPACK    DIM127,D1,LINKPRG,DIM127
          UNPACK    DIM127,D1,LINKREP,DIM127
          UNPACK    DIM127,D1,LINKTEM,DIM127
.
          CALL      PRIH0000      * Output Table Heading
.
          IF        NORECORD=0
            MOVE      PTCNNRTD,NORECORD      * Set Default No Records to Display
          ENDIF
          MOVE      ZERO,RECNUMB
          MOVE      ZERO,DISNUMB
.
          PACK      KEY12,DEPRT001,STARTKEY,SP5
          CALL      RDIBPDD1
          IF        OVRCD <> 1
            GOTO      PRDE1100
          ENDIF
.
PRDE1000  CALL      RKIBPDD1
          BRANCH    OVRCD,PRDE9000
.
PRDE1100  MATCH     IBPDDEPT,DEPRT001
          GOTO      PRDE9000 IF NOT EQUAL

          ADD       ONE,RECNUMB
          IF        STARTNUM>=RECNUMB
            GOTO      PRDE1000
          ENDIF
.
          CALL      PRID0000      * Display Printer Code Row
          ADD       ONE,DISNUMB
          COMPARE   NORECORD,DISNUMB
          GOTO      PRDE1000 IF NOT EQUAL
          GOTO      PRDE9999
.
PRDE9000  CALL      NOMORE00      * Display No More Records Message
.
PRDE9999  RETURN
.
.------------------------------------------------------------
. Printer Details of Department (TABLE HEADING)
.------------------------------------------------------------
PRIH0000  WRITE     HTMLFILE;"<tr>":
                               "<td class=HeadingCell width=40%>":
                               "<b>Printer Code</b></td>":
                               "<td class=HeadingCell width=40%>":
                               "<b>Printer Description</b></td>":
                             "</tr>"
.
PRIH9999  RETURN
.
.------------------------------------------------------------
. Printer Details of Department (TABLE ROW)
.------------------------------------------------------------
PRID0000  PACK      KEY6,IBPDPRTR,SP70
          MOVE      "Invalid Printer Code",PRTDESC
          CALL      RDPRTA1                 * read Printer file for Description
.
          WRITE     HTMLFILE;"<tr><td nowrap><A HREF='javascript:ShowDetail01":
                             "(#"",LINKPRG,"#.pbl":
                             "?reportno=",LINKREP:
                             "&template=",LINKTEM:
                             "&deprt001=",DEPRT001:                   *I-251218
                             "&ibprt001=",IBPDPRTR,"#")'>":
                             "<img src=../images/MaintenanceIcon.gif hspace=4":
                             " border=0 align=absmiddle></a>":
                             IBPDPRTR,"</td>":                        *C-251218
                             "<td>",PRTDESC,"</td>":
                             "</tr>"
.
PRID9999 RETURN
.
.------------------------------------------------------------
. MRPRN000                           
. Routine to print the Preview Stationery Template       
.------------------------------------------------------------
MRPRN000  CALL      OPNPRINT                   * open the spool file
.
          PRINT     *N;
          MOVE      ONE,CURRROW
          PACK      KEY12,IBTMD001,SP6
          CALL      RSIBDET1                   * position on the details file
          CALL      RKIBDET1
          BRANCH    OVRCD,MRPRN990
.
          MATCH     IBTMD001,IBDTSCOD           * match stationary codes
          GOTO      MRPRN990 IF NOT EQUAL
.
          MOVE      IBDTROW,LASTROW
.
          COMPARE   CURRROW,IBDTROW            * compare rows
          GOTO      MRPRN200 IF EQUAL
.
.------ print new-lines until current row equals the one read in ------
.
MRPRN050  COMPARE   CURRROW,IBDTROW            * compare rows
          GOTO      MRPRN200 IF EQUAL
.
          PRINT     *N;
          ADD       ONE,CURRROW
.
          GOTO      MRPRN050
.
.------ read through the details file ------
.
MRPRN100  CALL      RKIBDET1
          BRANCH    OVRCD,MRPRN900
.
          MATCH     IBTMD001,IBDTSCOD           * match stationary codes
          GOTO      MRPRN900 IF NOT EQUAL
.
          MOVE      IBDTROW,LASTROW
.
          COMPARE   CURRROW,IBDTROW            * compare rows
          GOTO      MRPRN200 IF EQUAL
.
.------ print new-lines until current row equals the one read in ------
.
MRPRN110  COMPARE   CURRROW,IBDTROW            * compare rows
          GOTO      MRPRN200 IF EQUAL
.
          PRINT     *N;
          ADD       ONE,CURRROW
.
          GOTO      MRPRN110
.
.------ branch on the field type ------
.
MRPRN200  BRANCH    IBDTINDC,MRPRN300,MRPRN400
.
.------ the field is a text field ------
.
MRPRN300  RESET     IBDTTXFL,IBDTPLEN
          LENSET    IBDTTXFL
          RESET     IBDTTXFL
          PRINT     *IBDTCOL,*+,IBDTTXFL;
          GOTO      MRPRN100
.
.------ the field is a data field Output filled with 'X' ------
.
MRPRN400  MOVE      ONE,COUNT
          WHILE     COUNT<=IBDTPLEN
            APPEND    "X",VARIABLE
            ENDSET    VARIABLE
            ADD       ONE,COUNT
          DO
.
.-------- Formatting Dim Fields -------------
.
          RESET     VARIABLE,IBDTPLEN
          LENSET    VARIABLE
          RESET     VARIABLE
          PRINT     *IBDTCOL,*+,VARIABLE;
          GOTO      MRPRN100
.
MRPRN900  MOVE      FALSE,EXIT
.
.------ print new-lines until the end of page is reached ------
.
MRPRN910  COMPARE   LASTROW,IBTHLENG          * test page length
          GOTO      MRPRN999 IF EQUAL
.
          PRINT     *N;
          ADD       ONE,LASTROW
.
          GOTO      MRPRN910
.
.------ no details on file ------
.
MRPRN990  MOVE      TRUE,EXIT
.
MRPRN999  CALL      CLSPRINT                  * close the spool file
          RETURN
.
.-----------------------------------------------------------------------------
. Stationery Type Desc
.-----------------------------------------------------------------------------
TYPDES00  MOVE      SP70,TYPENAME
.          
          COMPARE   FORTY,TYPENUM
          GOTO      TYPDES10 IF NOT LESS
.
          MOVE      IBASTYP0,TYPENAME
          LOAD      TYPENAME,TYPENUM,IBASTYP1,IBASTYP2,IBASTYP3,IBASTYP4:
                                     IBASTYP5,IBASTYP6,IBASTYP7,IBASTYP8:
                                     IBASTYP9,IBASTP10,IBASTP11,IBASTP12:
                                     IBASTP13,IBASTP14,IBASTP15,IBASTP16:
                                     IBASTP17,IBASTP18,IBASTP19,IBASTP20
          GOTO      TYPDES99
.
TYPDES10  MOVE      TYPENUM,NSORTYPE
          SUB       FORTY,NSORTYPE
          CALL      NSMORDES
          BRANCH    OVRCD,TYPDES90
.
          MOVE      NSORDESC,TYPENAME
          GOTO      TYPDES99
.
TYPDES90  MOVE      "Stationery Type does not exists",TYPENAME
          GOTO      TYPDES99
.
TYPDES99  WRITE     HTMLFILE;TYPENAME;
          RETURN
.------------------------------------------------------------
. Table of Stationery Templates by Code
.------------------------------------------------------------
TMHCD000  UNPACK    DIM127,D1,LINKPRG,DIM127
          UNPACK    DIM127,D1,LINKREP,DIM127
          UNPACK    DIM127,D1,LINKTEM,DIM127
.
          CALL      TMHHD000              * Output Table Heading
.
          IF        NORECORD=0
            MOVE      PTCNNRTD,NORECORD      * Set Default No Records to Display
          ENDIF
          MOVE      ZERO,RECNUMB
          MOVE      ZERO,DISNUMB
.
          PACK      KEY6,STARTKEY,SP70
          CALL      RDIBTH1
          IF        OVRCD=0
            CALL      RPIBTH1
          ENDIF
TMHCD100  CALL      RKIBTH1
          BRANCH    OVRCD,TMHCD900
.
          MATCH     SP70,FILTSTTY
          IF        !@EQUAL
            MATCH     FILTSTTY,IBTHSTYP
            GOTO      TMHCD100 IF NOT EQUAL
          ENDIF
.
          ADD       ONE,RECNUMB
          IF        STARTNUM>=RECNUMB
            GOTO      TMHCD100
          ENDIF
.
          CALL      TMHRW000                * Display Row
          ADD       ONE,DISNUMB
          COMPARE   NORECORD,DISNUMB
          GOTO      TMHCD100 IF NOT EQUAL
          GOTO      TMHCD999
.
TMHCD900  CALL      NOMORE00      * Display No More Records Message
.
TMHCD999  RETURN
+
.------------------------------------------------------------
. Table of Stationery Templates by Description
.------------------------------------------------------------
TMHDS000  UNPACK    DIM127,D1,LINKPRG,DIM127
          UNPACK    DIM127,D1,LINKREP,DIM127
          UNPACK    DIM127,D1,LINKTEM,DIM127
.
          CALL      TMHHD000              * Output Table Heading
.
          IF        NORECORD=0
            MOVE      PTCNNRTD,NORECORD      * Set Default No Records to Display
          ENDIF
          MOVE      ZERO,RECNUMB
          MOVE      ZERO,DISNUMB
.
          PACK      KEY36,STARTKEY,SP70
          CALL      RSIBTH3
TMHDS100  CALL      RKIBTH3
          BRANCH    OVRCD,TMHDS900
.
          MATCH     SP70,FILTSTTY
          IF        !@EQUAL
            MATCH     FILTSTTY,IBTHSTYP
            GOTO      TMHDS100 IF NOT EQUAL
          ENDIF
.
          ADD       ONE,RECNUMB
          IF        STARTNUM>=RECNUMB
            GOTO      TMHDS100
          ENDIF
.
          CALL      TMHRW000                * Display Row
          ADD       ONE,DISNUMB
          COMPARE   NORECORD,DISNUMB
          GOTO      TMHDS100 IF NOT EQUAL
          GOTO      TMHDS999
.
TMHDS900  CALL      NOMORE00    * Display No More Records Message
.
TMHDS999  RETURN
+
.------------------------------------------------------------
. Stationery Template Maintenance (TABLE HEADING)
.------------------------------------------------------------
TMHHD000  WRITE     HTMLFILE;"<tr>":
                             "<td class=HeadingCell width=15%>Stationery Code":
                             "</td>":
                             "<td class=HeadingCell width=30%>Description":
                             "</td>":
                             "<td class=HeadingCell width=30%>Stationery Type":
                             "</td>":
                             "<td class=HeadingCell width=15%>Active":
                             "</td>":
                             "</tr>"
.
TMHHD999  RETURN
.------------------------------------------------------------
. Stationery Template Maintenance (TABLE ROW)
.------------------------------------------------------------
TMHRW000  MATCH     SP70,IBTHDESC
          IF        @EQUAL
            MOVE      "&nbsp;",IBTHDESC
          ENDIF
.
          MATCH     "1",IBTHACTV
          IF        @EQUAL
            MOVE      "Yes",KEY4
          ELSE
            MOVE      "No",KEY4
          ENDIF
.
          WRITE     HTMLFILE;"<tr><td nowrap><A HREF='javascript:ShowDetail01":
                             "(#"",LINKPRG,"#.pbl":
                             "?reportno=",LINKREP:
                             "&template=",LINKTEM:
                             "&ibtmh001=",IBTHSCOD,"#")'>":
                             "<img src=../images/MaintenanceIcon.gif hspace=4":
                             " border=0 align=absmiddle></a>":
                             IBTHSCOD,"</td>":
                             "<td>",IBTHDESC,"</td>":
                             "<td>",IBTHSTFM,"</td>":
                             "<td>",KEY4,"</td>":
                             "</tr>"
.
TMHRW999  RETURN
.-----------------------------------------------------------
. Link to Next Group
.-----------------------------------------------------------
NEXT0000  MOVE      NORECORD,KEY2
          REP       " +",KEY2
          ASSIGN    STARTNUM+NORECORD,F3
          MOVE      F3,KEY3
          REP       " +",KEY3
          UNPACK    DIM127,D1,FLDPARA,DIM127
          MOVE      REPORTNO,F1
.
          REP       " +",STARTKEY
          REP       "'~",STARTKEY
          REP       " +",FILTSTTY
.
          WRITE     HTMLFILE;"comweb05.pbl":
                                 "?reportno=",F1:
                                 "&template=",FLDPARA:
                                 "&startnum=",KEY3:
                                 "&norecord=",KEY2:
                                 "&startkey=",STARTKEY:
                                 "&filtstty=",FILTSTTY;
.
          REP       "+ ",STARTKEY
          REP       "~'",STARTKEY
          REP       "+ ",FILTSTTY
.
NEXT9999  RETURN
.-------------------------------------------------------------
. Link to Prev Group
.-------------------------------------------------------------
PREV0000  MOVE      NORECORD,KEY2
          REP       " +",KEY2
          ASSIGN    STARTNUM-NORECORD,F3
          IF        F3<0
            MOVE      ZERO,F3
          ENDIF
          MOVE      F3,KEY3
          REP       " +",KEY3
          UNPACK    DIM127,D1,FLDPARA,DIM127
          MOVE      REPORTNO,F1
.
          REP       " +",STARTKEY
          REP       "'~",STARTKEY
          REP       " +",FILTSTTY
.
          WRITE     HTMLFILE;"comweb05.pbl":
                                 "?reportno=",F1:
                                 "&template=",FLDPARA:
                                 "&startnum=",KEY3:
                                 "&norecord=",KEY2:
                                 "&startkey=",STARTKEY:
                                 "&filtstty=",FILTSTTY;
.
          REP       "+ ",STARTKEY
          REP       "~'",STARTKEY
          REP       "+ ",FILTSTTY
.
PREV9999  RETURN
.------------------------------------------------------------
. Table of Stationery Template Details
.------------------------------------------------------------
TMDTB000  UNPACK    DIM127,D1,LINKPRG,DIM127
          UNPACK    DIM127,D1,LINKREP,DIM127
          UNPACK    DIM127,D1,LINKTEM,DIM127
.
          CALL      TMDHD000              * Output Table Heading
.
          IF        NORECORD=0
            MOVE      "20",NORECORD       * Set Default No Records to Display
          ENDIF
          MOVE      ZERO,RECNUMB
          MOVE      ZERO,DISNUMB
.
          PACK      KEY12,IBTMD001,SP70
          CALL      RSIBDET1
TMDTB100  CALL      RKIBDET1
          BRANCH    OVRCD,TMDTB999
.
          MATCH     IBTMD001,IBDTSCOD     * Stationery Code still the same?
          GOTO      TMDTB999 IF NOT EQUAL
.
..          ADD       ONE,RECNUMB
..          IF        STARTNUM>=RECNUMB
..            GOTO      TMDTB100
..          ENDIF
.
          CALL      TMDRW000                * Display Row
.
..          ADD       ONE,DISNUMB
..          COMPARE   NORECORD,DISNUMB
..          GOTO      TMDTB100 IF NOT EQUAL
.
          GOTO      TMDTB100
.
TMDTB999  RETURN
+
.------------------------------------------------------------
. Stationery Template Details Maintenance (TABLE HEADING)
.------------------------------------------------------------
TMDHD000  WRITE     HTMLFILE;"<tr>":
                             "<td class=HeadingCell width=2%>&nbsp;":
                             "</td>":
                             "<td class=HeadingCell width=4%>Row":
                             "</td>":
                             "<td class=HeadingCell width=4%>Column":
                             "</td>":
                             "<td class=HeadingCell width=8%>Type":
                             "</td>":
                             "<td class=HeadingCell width=25%>Field No/Text":
                             "</td>":
                             "<td class=HeadingCell width=4%>Length":
                             "</td>":
                             "<td class=HeadingCell width=4%>Print Indicator":
                             "</td>":
                             "</tr>"
.
TMDHD999  RETURN
.------------------------------------------------------------
. Stationery Template Details Maintenance (TABLE ROW)
.------------------------------------------------------------
TMDRW000  MATCH     SP70,IBTHDESC
          IF        @EQUAL
            MOVE      "&nbsp;",IBTHDESC
          ENDIF
.
          COMPARE   ONE,IBDTINDC
          IF        @EQUAL
            MOVE      "Text",KEY4
            CALL      ESCVAR00
          ELSE
            MOVE      "Data",KEY4
          ENDIF
.
          WRITE     HTMLFILE;"<tr><td nowrap><A HREF='javascript:ShowDetail":
                             "(#"",LINKPRG,"#.pbl":
                             "?reportno=",LINKREP:
                             "&template=",LINKTEM:
                             "&ibtmd001=",IBDTSCOD:
                             "&ibtmd002=",IBDTROW:
                             "&ibtmd003=",IBDTCOL,"#")'>":
                             "<img src=../images/MaintenanceIcon.gif hspace=4":
                             " border=0 align=absmiddle></a>":
                             "</td>":
                             "<td>",IBDTROW,"</td>":
                             "<td>",IBDTCOL,"</td>":
                             "<td>",KEY4,"</td>":
                             "<td>",IBDTTXFL,"</td>":
                             "<td>",IBDTPLEN,"</td>":
                             "<td>&nbsp;",IBDTPIND,"</td>":
                             "</tr>"
.
TMDRW999  RETURN
.
ESCVAR00  CLEAR      RETNVAR
ESCVAR10  MOVE       ZERO,F1
          CMATCH     "<",VAR
          IF         @EQUAL
            MOVE       ONE,F1
            APPEND     "&lt;",RETNVAR
          ENDIF
          CMATCH     ">",VAR
          IF         @EQUAL
            MOVE       ONE,F1
            APPEND     "&gt;",RETNVAR
          ENDIF
          IF         F1=0
            MOVE       VAR,KEY1
            APPEND     KEY1,RETNVAR
          ENDIF
          BUMP       VAR
          GOTO       ESCVAR10 IF NOT EOS
          RESET      RETNVAR
          MOVE       RETNVAR,VAR
ESCVAR99  RETURN
.
.------------------------------------------------------------
. Table of Stationery Types
.------------------------------------------------------------
TYPTB000  UNPACK    DIM127,D1,LINKPRG,DIM127
          UNPACK    DIM127,D1,LINKREP,DIM127
          UNPACK    DIM127,D1,LINKTEM,DIM127
.
          CALL      TYPHD000              * Output Table Heading
.
          IF        NORECORD=0
            MOVE      PTCNNRTD,NORECORD      * Set Default No Records to Display
          ENDIF
          MOVE      ZERO,RECNUMB
          MOVE      ZERO,DISNUMB
.
          MOVE      ZERO,TYPENUM
.
TYPTB100  ADD       ONE,TYPENUM
.
          COMPARE   FORTY,TYPENUM
          GOTO      TYPTB200 IF NOT LESS
.
          MOVE      IBASTYP0,TYPENAME
          LOAD      TYPENAME,TYPENUM,IBASTYP1,IBASTYP2,IBASTYP3,IBASTYP4:
                                     IBASTYP5,IBASTYP6,IBASTYP7,IBASTYP8:
                                     IBASTYP9,IBASTP10,IBASTP11,IBASTP12:
                                     IBASTP13,IBASTP14,IBASTP15,IBASTP16:
                                     IBASTP17,IBASTP18,IBASTP19,IBASTP20
          GOTO      TYPTB700
.
TYPTB200  MOVE      TYPENUM,NSORTYPE
          SUB       FORTY,NSORTYPE
          CALL      NSMORDES
          BRANCH    OVRCD,TYPTB900
.
          MOVE      NSORDESC,TYPENAME
.
TYPTB700  ADD       ONE,RECNUMB
          IF        STARTNUM>=RECNUMB
            GOTO      TYPTB100
          ENDIF
.
          CALL      TYPRW000                * Display Row
.
          ADD       ONE,DISNUMB
          COMPARE   NORECORD,DISNUMB
          GOTO      TYPTB100 IF NOT EQUAL
          GOTO      TYPTB999
.
TYPTB900  CALL      NOMORE00    * Display No More Records Message
.
TYPTB999  RETURN
.------------------------------------------------------------
. Stationery Types (TABLE HEADING)
.------------------------------------------------------------
TYPHD000  WRITE     HTMLFILE;"<tr>":
                             "<td class=HeadingCell width=15%>Stationery Type":
                             "</td>":
                             "<td class=HeadingCell width=40%>Description":
                             "</td>":
                             "</tr>"
.
TYPHD999  RETURN
.------------------------------------------------------------
. Stationery Types (TABLE ROW)
.------------------------------------------------------------
TYPRW000  WRITE     HTMLFILE;"<tr><td nowrap><A HREF='javascript:ShowDetail":
                             "(#"",LINKPRG,"#.pbl":
                             "?reportno=",LINKREP:
                             "&template=",LINKTEM:
                             "&ibvar001=",TYPENUM,"#")'>":
                             "<img src=../images/MaintenanceIcon.gif hspace=4":
                             " border=0 align=absmiddle></a>":
                             TYPENUM,"</td>":
                             "<td>",TYPENAME,"</td>":
                             "</tr>"
.
TYPRW999  RETURN
.------------------------------------------------------------
. Table of Label Selection 
.------------------------------------------------------------
TYPLB000  UNPACK    DIM127,D1,LINKPRG,DIM127
          UNPACK    DIM127,D1,LINKREP,DIM127
          UNPACK    DIM127,D1,LINKTEM,DIM127
.
          CALL      LABHD000              * Output Table Heading
.
          IF        NORECORD=0
            MOVE      PTCNNRTD,NORECORD      * Set Default No Records to Display
          ENDIF
          MOVE      ZERO,RECNUMB
          MOVE      ZERO,DISNUMB
.
          PACK      KEY4,SP70
          CALL      RSWBLAB1
TYPLB100  CALL      RKWBLAB1
          BRANCH    OVRCD,TYPLB900
.
          MATCH     "1",WBLBSYST
          IF        @EQUAL
            PACK      TYPENAME,EMGSYS
          ENDIF
.
          MATCH     "2",WBLBSYST
          IF        @EQUAL
            PACK      TYPENAME,OUTSYS
          ENDIF
.
          MATCH     "3",WBLBSYST
          IF        @EQUAL
            PACK      TYPENAME,INPSYS
          ENDIF
.
          MATCH     "4",WBLBSYST
          IF        @EQUAL
            PACK      TYPENAME,MRTSYS
          ENDIF
.
          MATCH     "5",WBLBSYST
          IF        @EQUAL
            PACK      TYPENAME,EMRPATH
          ENDIF
.
          MATCH     "6",WBLBSYST
          IF        @EQUAL
            PACK      TYPENAME,AHSYS
          ENDIF
.
          MATCH     "1",WBLBDEFT
          IF        @EQUAL
            MOVE      "Yes",DEFTDESC
          ELSE
            MOVE      SP70,DEFTDESC
          ENDIF
.
          ADD       ONE,RECNUMB
          IF        STARTNUM>=RECNUMB
            GOTO      TYPLB100
          ENDIF
.
          CALL      LABRW000                * Display Row
.
          ADD       ONE,DISNUMB
          COMPARE   NORECORD,DISNUMB
          GOTO      TYPLB100 IF NOT EQUAL
          GOTO      TYPLB999
.
TYPLB900  CALL      NOMORE00    * Display No More Records Message
.
TYPLB999  RETURN
.------------------------------------------------------------
. Label Selections (TABLE HEADING)
.------------------------------------------------------------
LABHD000  WRITE     HTMLFILE;"<tr>":
                             "<td class=HeadingCell width=30%>System":
                             "</td>":
                             "<td class=HeadingCell width=40%>Number of Labels":
                             "</td>":
                             "<td class=HeadingCell width=20%>Default":
                             "</td>":
                             "</tr>"
.
LABHD999  RETURN
.------------------------------------------------------------
. Label Selections (TABLE ROW)
.------------------------------------------------------------
LABRW000  WRITE     HTMLFILE;"<tr><td nowrap><A HREF='javascript:ShowDetail":
                             "(#"",LINKPRG,"#.pbl":
                             "?reportno=",LINKREP:
                             "&template=",LINKTEM:
                             "&wblab001=",WBLBSYST:
                             "&wblab002=",WBLBNUML,"#")'>":
                             "<img src=../images/MaintenanceIcon.gif hspace=4":
                             " border=0 align=absmiddle></a>":
                             TYPENAME,"</td>":
                             "<td>",WBLBNUML,"</td>":
                             "<td>",DEFTDESC,"&nbsp;</td>":
                             "</tr>"
.
LABRW999  RETURN
.------------------------------------------------------------
. Title Selection List Table
.------------------------------------------------------------
TYPTL000  UNPACK    DIM127,D1,LINKPRG,DIM127
          UNPACK    DIM127,D1,LINKREP,DIM127
          UNPACK    DIM127,D1,LINKTEM,DIM127
.
          CALL      TLEHD000              * Output Table Heading
.
          IF        NORECORD=0
            MOVE      PTCNNRTD,NORECORD      * Set Default No Records to Display
          ENDIF
          MOVE      ZERO,RECNUMB
          MOVE      ZERO,DISNUMB
.
          PACK      KEY4,SP70
          CALL      RSPMTLE1
TYPTL100  CALL      RKPMTLE1
          BRANCH    OVRCD,TYPTL900
.
          ADD       ONE,RECNUMB
          IF        STARTNUM>=RECNUMB
            GOTO      TYPTL100
          ENDIF
.
          CALL      TLERW000                * Display Row
.
          ADD       ONE,DISNUMB
          COMPARE   NORECORD,DISNUMB
          GOTO      TYPTL100 IF NOT EQUAL
          GOTO      TYPTL999
.
TYPTL900  CALL      NOMORE00    * Diplay No More Records Message
.
TYPTL999  RETURN
.------------------------------------------------------------
. Title Selections (TABLE HEADING)
.------------------------------------------------------------
TLEHD000  WRITE     HTMLFILE;"<tr>":
                             "<td class=HeadingCell width=30%>Title":
                             "</td>":
                             "<td class=HeadingCell width=40%>Description":
                             "</td>":
                             "<td class=HeadingCell width=5%>Active":
                             "</td>":
                             "</tr>"
.
TLEHD999  RETURN
.------------------------------------------------------------
. Title Selections (TABLE ROW)
.------------------------------------------------------------
TLERW000  MOVE      "Yes",KEY3
          MATCH     "1",PMTLACTV
          IF        @EQUAL
            MOVE      "No",KEY3
          ENDIF
.
          WRITE     HTMLFILE;"<tr><td nowrap><A HREF='javascript:ShowDetail":
                             "(#"",LINKPRG,"#.pbl":
                             "?reportno=",LINKREP:
                             "&template=",LINKTEM:
                             "&pmtle001=",PMTLTITL,"#")'>":
                             "<img src=../images/MaintenanceIcon.gif hspace=4":
                             " border=0 align=absmiddle></a>":
                             PMTLTITL,"</td>":
                             "<td>",PMTLDESC,"&nbsp;</td>":
                             "<td>",KEY3,"&nbsp;</td>":
                             "</tr>"
.
TLERW999  RETURN
.------------------------------------------------------------
. Table of Stationery Type Variable by Code
.------------------------------------------------------------
VARTB000  UNPACK    DIM127,D1,LINKPRG,DIM127
          UNPACK    DIM127,D1,LINKREP,DIM127
          UNPACK    DIM127,D1,LINKTEM,DIM127
.
          CALL      VARHD000              * Output Table Heading
.
          IF        NORECORD=0
            MOVE      PTCNNRTD,NORECORD      * Set Default No Records to Display
          ENDIF
          MOVE      ZERO,RECNUMB
          MOVE      ZERO,DISNUMB
.
          PACK      KEY8,IBVAR001,IBVAR003,SP70
          CALL      RDIBVAR2
          IF        OVRCD=0
            CALL      RPIBVAR2
          ENDIF
VARTB100  CALL      RKIBVAR2
          BRANCH    OVRCD,VARTB900
.
          COMPARE   IBVAR001,IBVRSTYP    * Stationery Type Still the same
          GOTO      VARTB900 IF NOT EQUAL
.
          ADD       ONE,RECNUMB
          IF        STARTNUM>=RECNUMB
            GOTO      VARTB100
          ENDIF
.
          CALL      VARRW000                * Display Row
          ADD       ONE,DISNUMB
          COMPARE   NORECORD,DISNUMB
          GOTO      VARTB100 IF NOT EQUAL
          GOTO      VARTB999
.
VARTB900  CALL      NOMORE00      * Display No More Records Message
.
VARTB999  RETURN
.------------------------------------------------------------
. Table of Stationery Type Variable by Description
.------------------------------------------------------------
VARDS000  UNPACK    DIM127,D1,LINKPRG,DIM127
          UNPACK    DIM127,D1,LINKREP,DIM127
          UNPACK    DIM127,D1,LINKTEM,DIM127
.
          CALL      VARHD000              * Output Table Heading
.
          IF        NORECORD=0
            MOVE      PTCNNRTD,NORECORD      * Set Default No Records to Display
          ENDIF
          MOVE      ZERO,RECNUMB
          MOVE      ZERO,DISNUMB
.
          PACK      KEY33,IBVAR001,SP70
          CALL      RDIBVAR1
          IF        OVRCD=0
            CALL      RPIBVAR1
          ENDIF
VARDS100  CALL      RKIBVAR1
          BRANCH    OVRCD,VARDS900
.
          COMPARE   IBVAR001,IBVRSTYP    * Stationery Type Still the same
          GOTO      VARTB900 IF NOT EQUAL
.
          ADD       ONE,RECNUMB
          IF        STARTNUM>=RECNUMB
            GOTO      VARDS100
          ENDIF
.
          CALL      VARRW000                * Display Row
          ADD       ONE,DISNUMB
          COMPARE   NORECORD,DISNUMB
          GOTO      VARDS100 IF NOT EQUAL
          GOTO      VARDS999
.
VARDS900  CALL      NOMORE00     * Display No More Records Message
.
VARDS999  RETURN
+
.------------------------------------------------------------
. Stationery Type Variable Maintenance (TABLE HEADING)
.------------------------------------------------------------
VARHD000  WRITE     HTMLFILE;"<tr>":
                             "<td class=HeadingCell width=15%>Field No":
                             "</td>":
                             "<td class=HeadingCell width=30%>Description":
                             "</td>":
                             "<td class=HeadingCell width=30%>Length":
                             "</td>":
                             "</tr>"
.
VARHD999  RETURN
.------------------------------------------------------------
. Stationery Type Variable Maintenance (TABLE ROW)
.------------------------------------------------------------
VARRW000  BRANCH    LNK2PRT,VARRW100
.
          WRITE     HTMLFILE;"<tr><td nowrap><A HREF='javascript:ShowDetail":
                             "(#"",LINKPRG,"#.pbl":
                             "?reportno=",LINKREP:
                             "&template=",LINKTEM:
                             "&ibvar001=",IBVRSTYP:
                             "&ibvar003=",IBVRFNUM,"#")'>":
                             "<img src=../images/MaintenanceIcon.gif hspace=4":
                             " border=0 align=absmiddle></a>":
                             IBVRFNUM,"</td>":
                             "<td>",IBVRDESC,"</td>":
                             "<td>",IBVRFLEN,"</td>":
                             "</tr>"
.
          GOTO      VARRW999
.
VARRW100  WRITE     HTMLFILE;"<tr valign=top>":
                              "<td><a href=#"":
                              "javascript:UpdateParent('",IBVRSTYP:
                              "','",IBVRFNUM,"','",IBVRDESC,"')#">":
                             "<img src=../images/MaintenanceIcon.gif hspace=4":
                             " border=0 align=absmiddle></a>":
                             IBVRFNUM,"</td>":
                             "<td>",IBVRDESC,"</td>":
                             "<td>",IBVRFLEN,"</td>":
                             "</tr>"
.
VARRW999  RETURN
.-----------------------------------------------------------
. Link to Next Group
.-----------------------------------------------------------
NEXTV000  MOVE      NORECORD,KEY2
          REP       " +",KEY2
          ASSIGN    STARTNUM+NORECORD,F4
          MOVE      F4,KEY4
          REP       " +",KEY4
          UNPACK    DIM127,D1,FLDPARA,DIM127
          MOVE      REPORTNO,F1
.
          REP       " +",STARTKEY
          REP       "'~",STARTKEY
.
          MOVE      IBVAR001,STATNTYP
          REP       " +",STATNTYP
          MOVE      IBVAR003,FIELDNOD
          REP       " +",FIELDNOD
.
          WRITE     HTMLFILE;"comweb05.pbl":
                                 "?reportno=",F1:
                                 "&template=",FLDPARA:
                                 "&startnum=",KEY4:
                                 "&norecord=",KEY2:
                                 "&ibvar001=",STATNTYP:
                                 "&ibvar003=",FIELDNOD;
.
          REP       "+ ",STARTKEY
          REP       "~'",STARTKEY
.
NEXTV999  RETURN
.-------------------------------------------------------------
. Link to Prev Group
.-------------------------------------------------------------
PREVV000  MOVE      NORECORD,KEY2
          REP       " +",KEY2
          ASSIGN    STARTNUM-NORECORD,F4
          IF        F4<0
            MOVE      ZERO,F4
          ENDIF
          MOVE      F4,KEY4
          REP       " +",KEY4
          UNPACK    DIM127,D1,FLDPARA,DIM127
          MOVE      REPORTNO,F1
.
          REP       " +",STARTKEY
          REP       "'~",STARTKEY
.
          MOVE      IBVAR001,STATNTYP
          REP       " +",STATNTYP
          MOVE      IBVAR003,FIELDNOD
          REP       " +",FIELDNOD
.
          WRITE     HTMLFILE;"comweb05.pbl":
                                 "?reportno=",F1:
                                 "&template=",FLDPARA:
                                 "&startnum=",KEY4:
                                 "&norecord=",KEY2:
                                 "&ibvar001=",STATNTYP:
                                 "&ibvar003=",FIELDNOD;
.
          REP       "+ ",STARTKEY
          REP       "~'",STARTKEY
.
PREVV999  RETURN
.
.------------------------------------------------------------
. NOMORE00 - Display "No more records" at end of list
.------------------------------------------------------------
NOMORE00  WRITE     HTMLFILE;"<tr>":
                             "<td class=RedCell colspan=20 align=center>":
                             "No more records</td>"
.
NOMORE99  RETURN
.
.-----------------------------------------------------------------------
.  Slection List of Stationery Types
.-----------------------------------------------------------------------
TYPLST00  MOVE      ZERO,TYPENUM
.
TYPLST10  ADD       ONE,TYPENUM
.
          COMPARE   FORTY,TYPENUM
          GOTO      TYPLST20 IF NOT LESS
.
          MOVE      IBASTYP0,TYPENAME
          LOAD      TYPENAME,TYPENUM,IBASTYP1,IBASTYP2,IBASTYP3,IBASTYP4:
                                     IBASTYP5,IBASTYP6,IBASTYP7,IBASTYP8:
                                     IBASTYP9,IBASTP10,IBASTP11,IBASTP12:
                                     IBASTP13,IBASTP14,IBASTP15,IBASTP16:
                                     IBASTP17,IBASTP18,IBASTP19,IBASTP20
          GOTO      TYPLST30
.
TYPLST20  MOVE      TYPENUM,NSORTYPE
          SUB       FORTY,NSORTYPE
          CALL      NSMORDES
          BRANCH    OVRCD,TYPLST99
.
          MOVE      NSORDESC,TYPENAME
.
TYPLST30  WRITE     HTMLFILE;"<option value=#"",TYPENUM,"#">":
                             TYPENAME,"</option>"
.
          GOTO      TYPLST10
.
TYPLST99  RETURN
.
.------------------------------------------------------------------------------
. Relationship select list Maintenance
.------------------------------------------------------------------------------
WEBREL00  RESET     UPDTTYPE
          MATCH     SP1,UPDTTYPE            * Display Formaction
          GOTO      WEBREL40 IF EQUAL
.
          MATCH     "A",UPDTTYPE            * Add Formaction
          GOTO      WEBREL10 IF EQUAL
.
          MATCH     "U",UPDTTYPE            * Update Formaction
          GOTO      WEBREL20 IF EQUAL
.
          MATCH     "D",UPDTTYPE            * Delete Formaction
          GOTO      WEBREL30 IF EQUAL
.
          GOTO      WEBREL90
.
.         ******* ADD FORMACTION *******
.
WEBREL10  PACK      KEY10,PMREL001,SP70
          CALL      RDPMREL1
          COMPARE   ZERO,OVRCD
          GOTO      WEBREL92 IF EQUAL
.
          CALL      SAVREL00          * Moves input variables to file variables
.
          PACK      KEY10,PMRLRELS,SP70
          CALL      WRPMREL1      * Writes away the data
.
          MOVE      ZERO,EXIT
          GOTO      WEBREL99
.
.
.         ******* UPDATE FORMACTION *******
.
WEBREL20  PACK      KEY10,PMREL001,SP70
          CALL      RDPMREL1
          BRANCH    OVRCD,WEBREL91
.
          PACK      KEY10,PMRLRELS,SP70
          CALL      SAVREL00      * Moves input variables to file variables
.
          CALL      RAPMREL1      * go to correct record for key 1
          CALL      UPPMREL1      * Writes away the data
.
          MOVE      ZERO,EXIT
          GOTO      WEBREL99
.
.
.         ******* DELETE FORMACTION *******
.
WEBREL30  PACK      KEY10,PMREL001,SP70
          CALL      RDPMREL1
          BRANCH    OVRCD,WEBREL91
.
          PACK      KEY10,PMRLRELS,SP70
          CALL      DEPMREL1
.
          MOVE      ZERO,EXIT
          GOTO      WEBREL99
.
.         ************ DISPLAY FORMACTION **********
.
WEBREL40  MOVE      ZERO,EXIT
          PACK      KEY10,PMREL001,SP70
          CALL      RDPMREL1
          IF        OVRCD=1
            CALL      CLRREL00        * Clear file variables
          ENDIF
.
          CLEAR     WEBTITLE
          MOVE      "Relationship Selection Maintenance",WEBTITLE
          RESET     WEBTITLE
.
          CALL      WEBHED00          * Output File & Write HTML Pg Header
          BRANCH    EXIT,WEBREL99
.
          CALL      WEBBOD00          * Process Web Body
          CALL      WEBEND00          * Process End of HTML File
.
          MOVE      ONE,EXIT
          GOTO      WEBREL99
.
.         ************ DISPLAY ERROR MESSAGES **********
.
WEBREL90  MOVE      "Invalid Form Action.",WEBTITLE
          CALL      WEBERR00
          MOVE      ONE,EXIT
          GOTO      WEBREL99
.
WEBREL91  MOVE      "Relationship record does not exist",WEBTITLE
          CALL      WEBERR00
          MOVE      ONE,EXIT
          GOTO      WEBREL99
.
WEBREL92  MOVE      "Relationship record exists",WEBTITLE
          CALL      WEBERR00
          MOVE      ONE,EXIT
          GOTO      WEBREL99
.
WEBREL99  RETURN
.
.-----------------------------------------------------------
. Save file variables
.-----------------------------------------------------------
SAVREL00  MOVE      PMREL001,PMRLRELS   * Relationship Code
          MOVE      PMREL002,PMRLDESC   * Description
          IF        PMREL003=1
            MOVE      ZERO,PMRLACTV     * Active
          ELSE
            MOVE      ONE,PMRLACTV      * Inactive
          ENDIF
          MOVE      PMREL004,PMRLHDPE   * HDP Equivalent
          MOVE      SP70,PMRLSPAR       * Spare Variable
.
SAVREL99  RETURN
.
.-----------------------------------------------------------
. Clear file variables
.-----------------------------------------------------------
CLRREL00  MOVE      SP70,PMRLRELS   * Relationship Code
          MOVE      SP70,PMRLDESC   * Description
          MOVE      SP70,PMRLACTV   * Active Indicator
          MOVE      SP70,PMRLHDPE   * HDP Equivalent
          MOVE      SP70,PMRLSPAR   * Spare Variable
.         
CLRREL99  RETURN 
.
.-------------------------------------------------------------------------------
.   Option 9: Set Parameters for Relationship Selection Details
.-------------------------------------------------------------------------------
STREL000  MOVE      ZERO,EXIT
          UNPACK    QRYNAME,KEY5,KEY3
          MOVE      KEY3,F3
          BRANCH    F3,STREL001,STREL002,STREL003,STREL004
.
          MOVE      ONE,EXIT
          GOTO      STREL999
.
STREL001  MOVE      QRYDATA,PMREL001
          GOTO      STREL999
.
STREL002  MOVE      QRYDATA,PMREL002
          GOTO      STREL999
.
STREL003  MOVE      QRYDATA,PMREL003
          GOTO      STREL999
.
STREL004  MOVE      QRYDATA,PMREL004
          GOTO      STREL999
.
STREL999  RETURN
.
.-----------------------------------------------------------
. Option 9: Label Selection Variables
.-----------------------------------------------------------
RLES0000  BRANCH    FLDITMNO,RLES0100,RLES0200,RLES0300,RLES0400,RLES0500:
                             RLES0600,RLES0700

.
          WRITE     HTMLFILE;"Invalid IBA Tag";
          GOTO      RLES9999
.
RLES0100  WRITE     HTMLFILE;PMRLRELS;     * Relationship Code
          GOTO      RLES9999
.
RLES0200  WRITE     HTMLFILE;PMRLDESC;     * Description
          GOTO      RLES9999
.
RLES0300  WRITE     HTMLFILE;PMRLACTV;     * Active Indicator
          GOTO      RLES9999
.
RLES0400  CALL      RELTL000
          GOTO      RLES9999
.
RLES0500  CALL      PREV0000        * Previous Set of Codes
          GOTO      RLES9999
.
RLES0600  CALL      NEXT0000        * Next Set of Codes
          GOTO      RLES9999
.
RLES0700  WRITE     HTMLFILE;PMRLHDPE;     * HDP Equivalent
          GOTO      RLES9999
.
RLES9999  RETURN
.
.------------------------------------------------------------
. Relationship Selection List Table
.------------------------------------------------------------
RELTL000  UNPACK    DIM127,D1,LINKPRG,DIM127
          UNPACK    DIM127,D1,LINKREP,DIM127
          UNPACK    DIM127,D1,LINKTEM,DIM127
.
          CALL      RELHD000              * Output Table Heading
.
          IF        NORECORD=0
            MOVE      PTCNNRTD,NORECORD      * Set Default No Records to Display
          ENDIF
          MOVE      ZERO,RECNUMB
          MOVE      ZERO,DISNUMB
.
          PACK      KEY10,SP70
          CALL      RSPMREL1
RELTL100  CALL      RKPMREL1
          BRANCH    OVRCD,RELTL900
.
          ADD       ONE,RECNUMB
          IF        STARTNUM>=RECNUMB
            GOTO      RELTL100
          ENDIF
.
          CALL      RELRW000                * Display Row
.
          ADD       ONE,DISNUMB
          COMPARE   NORECORD,DISNUMB
          GOTO      RELTL100 IF NOT EQUAL
          GOTO      RELTL999
.
RELTL900  CALL      NOMORE00     * Display No More Records Message
.
RELTL999  RETURN
.------------------------------------------------------------
. Relationship Selections (TABLE HEADING)
.------------------------------------------------------------
RELHD000  WRITE     HTMLFILE;"<tr>":
                             "<td class=HeadingCell width=30%>Relationship":
                             "</td>":
                             "<td class=HeadingCell width=40%>Description":
                             "</td>":
                             "<td class=HeadingCell width=5%>Active":
                             "</td>":
                             "</tr>"
.
RELHD999  RETURN
.------------------------------------------------------------
. Relationship Selections (TABLE ROW)
.------------------------------------------------------------
RELRW000  MOVE      "Yes",KEY3
          MATCH     "1",PMRLACTV
          IF        @EQUAL
            MOVE      "No",KEY3
          ENDIF
.
          WRITE     HTMLFILE;"<tr><td nowrap><A HREF='javascript:ShowDetail":
                             "(#"",LINKPRG,"#.pbl":
                             "?reportno=",LINKREP:
                             "&template=",LINKTEM:
                             "&pmrel001=",PMRLRELS,"#")'>":
                             "<img src=../images/MaintenanceIcon.gif hspace=4":
                             " border=0 align=absmiddle></a>":
                             PMRLRELS,"</td>":
                             "<td>",PMRLDESC,"&nbsp;</td>":
                             "<td>",KEY3,"&nbsp;</td>":
                             "</tr>"
.
RELRW999  RETURN
.
.---------------------------------------------------------------
. Validate Next Stationery Code if it exists and validate if the 
. same type as the original 
.---------------------------------------------------------------
VALNXT00  CALL      XMLHED00
          BRANCH    EXIT,VALVAR99
.
          PACK      KEY6,STATDESC,SP70
          CALL      RDIBTH1                 * Stationery Type Variable
          BRANCH    OVRCD,VALNXT90
.
          COMPARE   STATTYPE,IBTHSTFM
          GOTO      VALNXT95 IF NOT EQUAL
.
          MATCH     STATDESC,IBTMD001
          GOTO      VALNXT96 IF EQUAL
.
          PACK      KEY12,STATDESC,SP70
          CALL      RSIBDET1
VALNXT10  CALL      RKIBDET1
          BRANCH    OVRCD,VALNXT50
.
          MATCH     STATDESC,IBDTSCOD
          GOTO      VALNXT50 IF NOT EQUAL
.
          MOVE      IBDTTXFL,DIM5
.
          PACK      KEY8,STATTYPE,DIM5,SP70
          CALL      RDIBVAR2
          BRANCH    OVRCD,VALNXT10
.
          MOVE      IBVRDESC,DIM4
          MATCH     "!@##$",DIM4
          GOTO      VALNXT97 IF EQUAL 
.
          GOTO      VALNXT10
.
VALNXT50  PACK      KEY12,SP70
          CALL      RSIBDET1
VALNXT55  CALL      RKIBDET1
          BRANCH    OVRCD,VALNXT80
.
          COMPARE   TWO,IBDTINDC
          GOTO      VALNXT55 IF NOT EQUAL
.
          PACK      KEY6,IBDTSCOD,SP70
          CALL      RDIBTH1
          BRANCH    OVRCD,VALNXT80
.
          UNPACK    IBDTTXFL,DIM5,DIM3,DIM6
.
          PACK      KEY8,IBTHSTYP,DIM5,SP70
          CALL      RDIBVAR2
          BRANCH    OVRCD,VALNXT55
.
          MOVE      IBVRDESC,DIM4
          MATCH     "!@##$",DIM4
          GOTO      VALNXT55 IF NOT EQUAL
.
          MATCH     DIM6,IBTMD001
          GOTO      VALNXT94 IF EQUAL
.
          GOTO      VALNXT55
.
VALNXT80  WRITE     HTMLFILE;"<RETURN_VALUE TYPE=SIMPLE>":
                            "Correct": 
                             "</RETURN_VALUE>"
.
          GOTO      VALNXT98
.
VALNXT90  WRITE     HTMLFILE;"<RETURN_VALUE TYPE=ERROR>":
                             "Invalid Stationery Code: - ":
                             STATDESC,"</RETURN_VALUE>"
          GOTO      VALNXT98
.
VALNXT94  WRITE     HTMLFILE;"<RETURN_VALUE TYPE=ERROR>":
                             "Original Stationery is being used as a Next Stationery Code. Cannot add as a Next Stationery Code.":
                             "</RETURN_VALUE>"
          GOTO      VALNXT98
.
VALNXT95  WRITE     HTMLFILE;"<RETURN_VALUE TYPE=ERROR>":
                             "Next Stationery Code Type does not match Original Stationery Code Type":
                             "</RETURN_VALUE>"
          GOTO      VALNXT98
.
VALNXT96  WRITE     HTMLFILE;"<RETURN_VALUE TYPE=ERROR>":
                             "Next Stationery Code cannot be the same as the Original Stationery Code":
                             "</RETURN_VALUE>"
          GOTO      VALNXT98
.
VALNXT97  WRITE     HTMLFILE;"<RETURN_VALUE TYPE=ERROR>":
                             "Next Stationery Code cannot have another Next Stationery Code within it":
                             "</RETURN_VALUE>"
          GOTO      VALNXT98
.
VALNXT98  CALL      XMLEND00
VALNXT99  RETURN
.
.------------------------------------------------------------
. Table of Printers against a department
.------------------------------------------------------------
PRIND000  UNPACK    DIM127,D1,LINKPRG,DIM127
          UNPACK    DIM127,D1,LINKREP,DIM127
          UNPACK    DIM127,D1,LINKTEM,DIM127
.
          CALL      PRINH000      * Output Table Heading
.
          IF        NORECORD=0
            MOVE      "10",NORECORD       * Set Default No Records to Display
          ENDIF
          MOVE      ZERO,RECNUMB
          MOVE      ZERO,DISNUMB
.
          PACK      KEY6,STARTKEY,SP70
          CALL      RDSPRTA1
.
PRIND100  CALL      RDKPRTA1
          BRANCH    OVRCD,PRIND999
.
          MATCH     Z70,FILTHOSP                             * start  *I-251218
          IF        !@EQUAL
            MATCH     SP3,FILTHOSP
            IF        !@EQUAL
              MATCH     FILTHOSP,IBPTHOSP
              GOTO      PRIND100 IF NOT EQUAL
            ENDIF
          ENDIF
.
          ADD       ONE,RECNUMB
          IF        STARTNUM>=RECNUMB
            GOTO      PRIND100
          ENDIF
.
          PACK      PTHSNAME,SP70
          PACK      KEY3,IBPTHOSP,SP70
          CALL      RDPTHSP1                                 * end    *I-251218
.
          CALL      PRINR000                * Display Group Row
          ADD       ONE,DISNUMB
.
          COMPARE   NORECORD,DISNUMB
          GOTO      PRIND100 IF NOT EQUAL
.
PRIND999  RETURN
+
.------------------------------------------------------------
. Printer Table Heading
.------------------------------------------------------------
PRINH000  WRITE     HTMLFILE;"<tr>":
                             "<td class=HeadingCell>Printer":
                             "</td>":
                             "<td class=HeadingCell>Hospital":
                             "</td>":
                             "<td class=HeadingCell>Link":
                             "</td>":
                             "</tr>"
.
PRINTH99  RETURN
+
.------------------------------------------------------------
. Printer row (TABLE ROW)
.------------------------------------------------------------
PRINR000  WRITE     HTMLFILE;"<tr><td nowrap><A HREF='javascript:ShowDetail03":
                             "(#"",LINKPRG,"#.pbl":
                             "?reportno=",LINKREP:
                             "&template=",LINKTEM:
                             "&ibprt001=",PRTCODE,"#")'>":
                             "<img src=../images/MaintenanceIcon.gif hspace=4":
                             " border=0 align=absmiddle></a>":
                             PRTDESC,"</td><td>",PTHSNAME:
                             "</td><input type=hidden name=hidprint ":
                             "value='",QPRTCODE,"'>":
                             "<td><input type=checkbox name=printarr";
.
          PACK      KEY12,DEPRT001,QPRTCODE,SP70
          CALL      RDIBPDD1
          IF        OVRCD=0
            WRITE     HTMLFILE;" checked ";
          ENDIF
          WRITE     HTMLFILE;" value='",QPRTCODE,"'>":
                             "</tr>"
.
PRINR999  RETURN
+
.------------------------------------------------------------------------------
. PRTDEP00
.------------------------------------------------------------------------------
PRTDEP00  PACK      KEY5,SP70
          CALL      RSIBCOD1
PRTDEP10  CALL      RKIBCOD1
          BRANCH    OVRCD,PRTDEP99
.
          MATCH     SP70,PRXCODE
          GOTO      PRTDEP10 IF NOT EQUAL
.
          MOVE      PRXCATA,KEY2
          PACK      SAVKEY5,PRXCATA,PRXCODE,SP70
.
          PACK      KEY5,PRXCATA,SP70
          CALL      RSIBCOD1
PRTDEP20  CALL      RKIBCOD1
          BRANCH    OVRCD,PRTDEP50
.
          MATCH     KEY2,PRXCATA
          GOTO      PRTDEP50 IF NOT EQUAL
.
          MATCH     SP70,PRXCODE
          GOTO      PRTDEP20 IF EQUAL
.
          MATCH     PRXCODE,IBPRT001
          GOTO      PRTDEP20 IF NOT EQUAL
.
          MOVE      IBPRT002,PRXDESC
.
          CALL      UPICOD1
.
PRTDEP50  MOVE      SAVKEY5,KEY5
          CALL      RDIBCOD1
.
          GOTO      PRTDEP10
.
PRTDEP99  RETURN
+
.------------------------------------------------------------------------------
. I/O and Subroutine Includes
.------------------------------------------------------------------------------
.
          INC       IBAWEBCD
          INC       DAYOFWEK
          INC       RSHWEBCD
          INC       WEBDATCD
          INC       NSMORTYP
.
          INC       WEBLABIO/INC  
          INC       IBAVARIO/INC  
          INC       IBADPTIO/INC    * Departments
          INC       IBATMDIO/INC    * Stationery Template Details File
.          INC       IBAPRTIO/INC    * Printer File
          INC       PATHSPIO/INC
          INC       MLTSECIO/INC
          INC       PMSBORIO/INC
          INC       PMSNEWIO/INC
          INC       PMSTLEIO/INC
          INC       PMSRELIO/INC
