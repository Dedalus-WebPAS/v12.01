.******************************************************************************
.* System    :   CASH RECEIPTING                                              *
.* Program   :   IBARCP64                                                     *
.* Desc      :   Re-print a Receipt                                           *
.******************************************************************************
.* Date      :   30/8/88                                                      *
.* Author    :   Karin Peak                                                   *
.* Comments  :                                                                *
.* Mods      :                                                                *
.*        V12.00.01 11/06/2025  Ebon Clements    TSK 0961623                  *
.*                  Alphanueric visit number changes                          *
.*        V11.00.01 09/04/2020  J.Tan             TSK 0868813                 *
.*                  Mod to set PACFRMT to 3 for PKNAME                        *
.*        V10.11.01 22/11/2017 Ania P    TSK 0261630                          *
.*                  Moved TFILNAME to CFNAMEDP in INIT0000                    *
.*        V10.02.01 04/04/2011  Jill Parkinson CAR 239574                     *
.*                  Mods to JH HRN                                            *
.*        V9.08.03  13/12/2006  J.Tan             CAR 127625                  *
.*                  Mods to JH HRN                                            *
.*        V9.08.02  27/11/2006  Steve Armstrong   CAR 126039                  *
.*                  Recompiled for changes to SGCHKDIG                        *
.*        V9.08.01  20/11/2006  Steve Armstrong   CAR 124160                  *
.*                  Added Singapore HRN                                       *
.******************************************************************************
.*        V9.05.01  27/03/2006  Peter Vela CAR 61299                          *
.*                  Increased field no size from DIM3 to DIM5                 *
.******************************************************************************
.*        V9.03.03  29/06/2004  Lina Vo    CAR 50811                          *
.*                  Put RCPCHQFD & IO, RCPCRDFD & IO, RCPDEPFD & IO and       *
.*                  RCPTRNFD & IO within the program because they are now     *
.*                  obsolete.                                                 *
.*        V9.03.02  27/05/2004  Lina Vo    CAR 50176                          *
.*                  Mods to remove Private Practice Debtors (pridbtaf)         *
.*                  This only re-print OLD receipts                            *
.*        V9.03.01  12/05/2003  Henry Son  CAR 39004                          *
.*                  Fix Printing of Register 92.                              *
.******************************************************************************
.*        V9.02.08  25/02/2003  Dean Cramer                                   *
.*                  Recompiled for RCPCHQFD - CHQPTYPE removed                *
.*        V9.02.07  14/02/2003  Dean Cramer  CAR 22238                        *
.*                  Recompiled for RCPTRNFD & RCPCHQFD                        *
.*        V9.02.06  24/12/2002  Dean Cramer srf 19032                         *
.*                  Fix so Private Practice Deposits print more than just     *
.*                  Payee and that transaction line.                          *
.*        V9.02.05  17/12/2002  Dean Cramer srf 19032 & part 22393            *
.*                  Fix so Inpatient Deposits print more than just Payee and  *
.*                  that transaction line.                                    *
.*        V9.02.04  08/04/2002  Dean Cramer                                   *
.*                  Fix where in format 7 post code differs at bottom address *
.*                  print to top address print.                               *
.*        V9.02.03  23/02/2002  Dean Cramer                                   *
.*                  Extract received payee name                               *
.*        V9.02.02  21/02/2002  Dean Cramer                                   *
.*                  Use pmspx2af-pmpxconp when nothing in patre1af            *
.*        V9.02.01  02/02/2002  Dean Cramer                                   *
.*                  Responsible Persons Mods for RCH                          *
.*        V5.08.03  29/08/2000  Caleb Sharman                                 *
.*                  Changed Health Fund variables to be 8 chars               *
.*        V5.08.02  29/06/2000  Charles Handaya                               *
.*                  Add new receipt layout (Templated) for                    *
.*                  Ballarat Health Services (BHS)                            *
.*        V5.08.B02 26/04/2000  Caleb Sharman  SRF 637980                     *
.*                  Fixed date of service shown                               *
.*        V5.08.B01 06/01/2000  Steve Downing  SRF 635925                     *
.*                  Fixed date of service shown on WWH layout                 *
.******************************************************************************
.*        V5.07.06  05/11/1999  Charles Handaya                               *
.*                  Cater for Nursing Home System (TRNSYS = 6)                *
.*        V5.07.05  21/10/1999  Charles Handaya  SRF 635035 633927            *
.*                  Fix West Wimmera Sundry Cash Receipt Layout               *
.*        V5.07.04  02/07/1999  J.Tan   SRF 632327                            *
.*                  Fixed West Wimmera layout - invoice date & Invoice number *
.*        V5.07.03  09/06/1999  Greg Horvat                                   *
.*                  Recompiled for PRIINVIO - Fixed problem with direct read  *
.*        V5.07.02  01.04.1999  Sandra Barcham                                *
.*                  Fix printing of wwh layou                                 *
.*        V5.07.01  31/03/1999  Sandra Barcham                                *
.*                  Allow for 12 digit receipt numbers                        *
.*       V5.05.B01  02/11/1998  Davin                                         *
.*                  Mods for 507 & removed old debtors                        *
.*        V5.05.04  18/06/1998  Sandra Barcham    srf 626215                  *
.*                  Print receipts in suspense for WGH                        *
.*        V5.05.03  24/04/1998  Sandra Barcham    HUT                         *
.*                  Only open patient files if required                       *
.*        V5.05.02  20/04/1998  Steve Armstrong   STH                         *
.*                  Recompiled for mods to PATDPTHV & PATDPATH                *
.*        V5.05.01  02.04.1998 Sandra Barcham                                 *
.*                  Print sundry cash name and address for west Wimmera       *
.******************************************************************************
.*        V5.04.07  10.10.1997 Sandra Barcham    SRF 622219                   *
.*                  Print sundry cash name and address                        *
.*        V5.04.06  18.09.1997 Sandra Barcham    SRF 621953                   *
.*                  Change WGH layout                                         *
.*        V5.04.05  08.09.1997 Sandra Barcham    SRF 621803                   *
.*                  Change WWH layout                                         *
.*        V5.04.04  04.08.1997 Sandra Barcham    SRF 621162                   *
.*                  Fix WWH layout for private practice                       *
.*        V5.04.03  10.07.1997 Sandra Barcham    SRF 620014                   *
.*                  Add in West Wimmera layout                                *
.*        V5.04.02  21.04.1997 Sandra Barcham    SRF 619646                   *
.*                  Add in West Gippsland layout                              *
.*        V5.04.01  02/04/1997 Sandra Barcham    SRF 642737                   *
.*                  Allow reprint receipt for new accounts receivable         *
.*        V5.03.06  12/03/1996  Greg Horvat      SRF 641284                   *
.*                  Changed Hawkes Bay receipt to use the patma1af address's  *
.*                  when reprinting patient billing receipts                  *
.*        V5.03.05  29/12/95 J.Tan    SRF 641111                              *
.*                  Mods to print 20 chars of name for sundary debtors        *
.*        V5.03.04  21/11/1995  Greg Horvat      SRF 640820                   *
.*                  Changed Hawkes Bay receipt to print the PRA subrub when   *
.*                  reprinting a patient billing register (TRNSYS=1)          *
.*        V5.03.03  11/08/1995  Steve Armstrong          SRF 611064           *
.*                  Added read of HSYS4 for Sundry Debtors                    *
.*        V5.03.02  08/08/1995  Steve Armstrong          SRF 611064           *
.*                  Added reprint for system codes 95 & 96 (for HRH)          *
.*        V5.03.01  03/08/1995  Greg Horvat      SRF 136407                   *
.*                  Fixed to read the oaf080 file correctly when reprinting a *
.*                  sundry debtors register (TRNSYS=3)                        *
.*                                                                            *
.* ************************************************************************** *
.*                                                                            *
.*        V5.01.00  20/01/92  DIG                                             *
.*                  Ported from release 5                                     *
.*        V5.01.01  08/04/1993  Steve Armstrong Q 7580  SRF 120401            *
.*                  Added new layout for ACC                                  *
.*        V5.01.02  26/04/1993  Steve Armstrong srf 120401                    *
.*                  Further mods to ACC layout                                *
.*        V5.01.03  19/01/1994  Matt Surridge                                 *
.*                  Added Check on HSYS3 before opening Private practice files*
.*        V5.01.04  21/03/1994    Justin Coates  SRF 128453                   *
.*                  added Hawkes Bay's layout                                 *
.*        V5.01.05  02/06/94  ROD                                             *
.*                  Access invoices across multi-databases                    *
.*        V5.02.01  14/02/1995  Greg Horvat      SRF 134920 134922 134932     *
.*                  Recompiled for IBAPRINT                                   *
.*        V5.02.02  18/04/1995  Steve Armstrong                               *
.*                  Recompiled for changes to RCPTRNFD                        *
.*                  Mods to use PRI instead of PPP                            *
.*        V5.02.03  20/04/1995  Greg Horvat      SRF 134749 & 136050          *
.*                  Fixed the printing of the patients surname & postcode     *
.*                                                                            *
.******************************************************************************
.
          INC       STD001FD
          INC       STDHLPDF
.
          INC       CHKDIGVR/INC
          INC       IBAPRNFD/INC
          INC       IBATMHFD/INC            * Template Header
          INC       IBATMDFD/INC            * Template Tail
          INC       NHIMASFD/INC
          INC       PATCONFD/INC
          INC       PATDPTHV/INC
          INC       PATHOSFD/INC
          INC       PATHSPFD/INC
          INC       PATINVFD/INC
          INC       PATMA1FD/INC
          INC       PATNIDFD/INC
          INC       PMSPX2FD/INC
          INC       PATRE1FD/INC
          INC       PATVISFD/INC
          INC       PRIINVFD/INC
          INC       RCPBNKFD/INC
          INC       RCPCONFD/INC
          INC       RCPREGFD/INC
          INC       DEBDBTFD/INC
          INC       DEBFTHFD/INC
          INC       DEBFDTFD/INC
          INC       TFILEVAR/INC
          INC       WEBERRFD/INC
.
.
.   Obsoleted FD files that are required by this program
.
.
. V5.07.001 07/08/1998 Jim Stathopoulos  507 Changes
.  **********************************************************************
.  *                                                                    *
.  *     Include Name : RCPCHQFD.INC                                    *
.  *                                                                    *
.  *     Function     : File Definition include for Receipting          *
.  *                    Cheque Details                                  *
.  *                                                                    *
.  *     File Type    : SQL                                             *
.  *                                                                    *
.  *     File Name    : rcpchqaf.dat                                    *
.  *                                                                    *
.  *     Keys         : KEY 24                                          *
.  *                                                                    *
.  **********************************************************************
.
RCPCHQA1    IFILE   SQL, FIXED=131, KEY="U1-12,107-118"
.
.NAME       TYPE     LENGTH   PHYSICAL   START     DESCRIPTION
.----       ----     ------   --------   -----     -----------
CHQRECPT     DIM         12      12          1     RECEIPT NUMBER
CHQDATE      DIM          8       8         13     DATE
CHQCASHR     DIM          6       6         21     CASHIER
CHQDRAW      DIM         20      20         27     DRAWER
CHQBANK      DIM         30      30         47     BANK
CHQBRNCH     DIM         30      30         77     BRANCH
CHQNUM       DIM         12      12        107     CHEQUE NUMBER
DCHQAMNT     FORM      12.2       8        119     AMOUNT
CHQSTAT1     FORM         1       2        127     STATUS 1
.                                                  0 = O.K.
.                                                  1 = CANCELLED
CHQSTAT2     FORM         1       2        129     STATUS 2
.                                                  0 = NOT PRINTED
.                                                  1 = PRINTED
.End of Record                             131
.
CHQAMNT      FORM       8.2
.
.....................................................
. V5.07.001 07/08/1998 Jim Stathopoulos  507 Changes
.  **********************************************************************
.  *                                                                    *
.  *     Include Name : RCPCRDFD.INC                                    *
.  *                                                                    *
.  *     Function     : File Definition include for Receipting          *
.  *                    Card Details                                    *
.  *                                                                    *
.  *     File Type    : SQL                                             *
.  *                                                                    *
.  *     File Name    : rcpcrdaf.dat                                    *
.  *                                                                    *
.  *     Keys         : KEY 26                                          *
.  *                                                                    *
.  **********************************************************************
.
RCPCRDA1    IFILE   SQL, FIXED=57, KEY="U1-8,9-9,10-12,13-24,25-26"
.
.NAME       TYPE     LENGTH  PHYSICAL   START     DESCRIPTION
.----       ----     ------  --------   -----     -----------
CRDDATE      DIM          8      8          1     DATE
DCRDFLAG     DIM          1      1          9     TYPE INDICATOR
.                                                   3 - Credit Card
.                                                   4 - Merchant Card
CRDCODE      DIM          3      3         10     CARD CODE
CRDRECNO     DIM         12     12         13     RECEIPT NUMBER
DCRDCOUN     DIM          2      2         25     TRX COUNT
.
CRDNAME      DIM         20     20         27     PAYEE NAME
DCRDAMNT     FORM      12.2      8         47     TRX AMOUNT
CRDSTAT      FORM         1      2         55     STATUS INDICATOR
.                                                   0 - Not Printed
.                                                   1 - Printed
.End of Record                             57
.
.     redefine form fields from key
.     -----------------------------
.NAME       TYPE     LENGTH    START     DESCRIPTION
.----       ----     ------    -----     -----------
CRDFLAG      FORM         1       7      TYPE INDICATOR
CRDCOUNT     FORM         2      19      TRX COUNT
CRDAMNT      FORM       8.2
.
.....................................................
. V9.03.002 12/11/2003 Ebon Clements Added Index 3 CAR 44091
. V9.03.001 15/10/2003 Ebon Clements Added RCDPSYST & RCDPMHOS CAR 44093
. V5.07.001 07/08/1998 Jim Stathopoulos  507 Changes
.  **********************************************************************
.  *                                                                    *
.  *     Include Name  : RCPDEPFD.INC                                   *
.  *                                                                    *
.  *     Function      : File Definition include for Receipting         *
.  *                     Deposits Details                               *
.  *                                                                    *
.  *     File Type     : SQL                                            *
.  *                                                                    *
.  *     File Name     : rcpdepaf.dat                                   *
.  *                                                                    *
.  *     Keys          : KEY 15, KEY18                                  *
.  *                                                                    *
.  **********************************************************************
.
.Data File Definition
.--------------------
RCPDEPA1  IFILE     SQL, FIXED=166, KEY="U1-12,13-15"
RCPDEPA2  IFILE     SQL, FIXED=166, KEY="U26-28,1-12,13-15"
RCPDEPA3  IFILE     SQL, FIXED=166, KEY="U16-23,1-12,13-15"
.
. NAME     TYPE   LENGTH   PHYSICAL  START LOC.   DESCRIPTION
. ----     ----   ------   --------  ----------   -----------
RCDPRECP   DIM      12        12           1      Receipt Number
DRCDPCNT   DIM       3         3          13      Transaction Count
RCDPADMN   DIM       8         8          16      Admission Number
.                                                 (Debtor for P.P.)
RCDPSCAN   FORM      2         2          24      Scan Flag
.                                                   0 = Debtor
.                                                   1 = PMI
RCDPDEPT   DIM       3         3          26      Deposit Type (Cat DP)
RCDPPAYT   FORM      1         2          29      Payment Type
.                                                   0 = Not Applicable
.                                                   1 = Cash
.                                                   2 = Cheque
.                                                   3 = Credit Card
.                                                   4 = Merchant Card
DRCDPAMN   FORM    12.2        8          31      Amount Deposited
RCDPDRAW   DIM      20        20          39      Drawer
RCDPCBNK   DIM      30        30          59      Cheque Bank Name
RCDPCBRN   DIM      30        30          89      Cheque Branch Name
RCDPPRAC   DIM       6         6         119      Practice
RCDPHOSP   DIM       2         2         125      Hospital Multi Database
RCDPSYST   DIM       2         2         127      System Code - Right Justify
.                                                 " 1" = EMERGENCY
.                                                 " 2" = OUTPATIENT
.                                                 " 3" = INPATIENT
.                                                 " 4" = PRIVATE PRACTICE
RCDPMHOS   DIM       3         3         129      Multi Hospital
RCDPSPAR   DIM      34        34         132      Spare Variable
.
.End of Record                           166
.
.  redefine form fields from key
.  -----------------------------
.NAME      TYPE     LENGTH     DESCRIPTION
.----      ----     ------     -----------
RCDPCNT    FORM        3       Transaction Count
RCDPADNO   DIM         8       Admission number for Patient System
RCDPAMNT   FORM        8.2
.
.....................................................
. V9.03.001 03/11/2003 Lina Vo       CAR 44080
.           Added TRNPTYPE description.
. V5.07.001 07/08/1998 Jim Stathopoulos  507 Changes
.  **********************************************************************
.  *                                                                    *
.  *     Include Name : RCPTRNFD.INC                                    *
.  *                                                                    *
.  *     Function     : File Definition include for Receipting          *
.  *                    Transaction details                             *
.  *                                                                    *
.  *     File Type    : SQL                                             *
.  *                                                                    *
.  *     File Name    : rcptrnaf.dat                                    *
.  *                                                                    *
.  *     Keys         : KEY29, KEY15, KEY32, KEY31, KEY28               *
.  *                                                                    *
.  **********************************************************************
.
RCPTRNA1    IFILE  SQL, FIXED=260, KEY="U1-8,9-14,15-26,27-29"
RCPTRNA2    IFILE  SQL, FIXED=260, KEY="U15-26,27-29"
RCPTRNA3    IFILE  SQL, FIXED=260, KEY="U1-8,30-32,9-14,15-26,27-29"
RCPTRNA4    IFILE  SQL, FIXED=260, KEY="U36-43,1-8,15-26,27-29"
RCPTRNA5    IFILE  SQL, FIXED=260, KEY="U36-43,30-32,15-26,27-29"
.
.NAME       TYPE    LENGTH  PHYSICAL   START     DESCRIPTION
.----       ----    ------  --------   -----     -----------
TRNDATE      DIM       8       8           1     TRANSACTION CODE
TRNCASHR     DIM       6       6           9     CASHIER
TRNRECNO     DIM      12      12          15     RECEIPT NUMBER
DTRNCOUN     DIM       3       3          27     TRANSACTION COUNT
TRNREG       DIM       3       3          30     REGISTER
TRNMODE      DIM       1       1          33     MODE
.                                                C = COUNTER
.                                                M = MAIL
TRNSYS       FORM      2       2          34     IBA SYSTEM CODE
TRNINV       DIM       8       8          36     INVOICE NUMBER
TRNREF       DIM      17      17          44     REFERENCE NUMBER
.
.   For DEBTORS Only ---->    38-38   Aging
.                             39-44   Debtor No
.                             45-57   Spaces
.
.   For MEDISAVE Number ->    38-46   Admisson No
.                             47-57   Spaces
.
TRNCARD      DIM       3       3          61     CARD CODE
TRNPAYEE     DIM      20      20          64     PAYEE
TRNADD1      DIM      20      20          84     ADDRESS 1
TRNADD2      DIM      20      20         104     ADDRESS 2
TRNPOST      DIM       4       4         124     POST
TRNPTYPE     FORM      1       2         128     PAYMENT TYPE
.                                                1 = CASH
.                                                2 = CHEQUE
.                                                3 = CREDIT CARD
.                                                4 = DIRECT DEBIT
.                                                5 = MONEY ORDER
.                                                6 = EFTPOS
TRNINACC     DIM      14      14         130     INCOME ACCOUNT
TRNBNKAC     DIM      14      14         144     BANK ACCOUNT
DTRNAMNT     FORM   12.2       8         158     AMOUNT
DTRNDISC     FORM   12.2       8         166     DISCOUNT
TRNSTAT      FORM      1       2         174     STATUS
.                                                0 = O.K.
.                                                1 = CANCELLED
.                                                2 = RELEASED
TRNBANK      FORM      1       2         176     BANK DEPOSIT
.                                                0 = NOT PRINTED
.                                                1 = PRINTED
TRNTYPE      FORM      1       2         178     0 = PATIENT
.                                                1 = HEALTH FUND
.                                                2 = INSURANCE COMP.
.                                                3 = GOV. DEPARTMENT
TRNCHEQ      DIM      12      12         180     CHEQUE NUMBER
.
TRNHOSP      DIM       2       2         192     HOSPITAL
TRNGSTC      DIM       6       6         194     GST CODE
TRNGSTA      DIM      14      14         200     GST ACCOUNT
TRNBDDTE     DIM       8       8         214     BANK DEPOSIT DATE
TRNSPARE     DIM      38      38         222     SPARE
.
.End of Record                           260
.
.     redefine form fields from key
.     -----------------------------
.NAME       TYPE     LENGTH    START     DESCRIPTION
.----       ----     ------    -----     -----------
TRNCOUNT     FORM        3        21     TRANSACTION COUNT
TRNAMNT      FORM      8.2
TRNDISC      FORM      8.2
.
.
.
.         program variables
.
CMDLINE   DIM       50
CURRROW   FORM      3
CRCPDATE  DIM       8
DIM12     DIM       12        * Print field for U/R or Debtor Number
DIM3      DIM       3
DIM5      DIM       5
DIM40     DIM       40
DIM8      DIM       8
FORM3     FORM      3
FORM5     FORM      5
FORM6     FORM      6
FORM8     FORM      8
HEADTAIL  FORM      1
MAXCLNO   FORM      2
MRCNNOHS  FORM      2
NMPNUMB   DIM       20
PATNAME   DIM       80                * formatted patient name
PNAM15    DIM       15
PRNTADD1  DIM       20
PRNTADD2  DIM       20
PRNTSUBR  DIM       20
PRNTADD4  DIM       20
PRNTPOST  DIM       4
PRNTNAME  DIM       80
PRNTRNAM  DIM       80
PRNTPNAM  DIM       30
PRNTPNUM  DIM       8
PRNTSTRT  FORM      3
RECDIM12  DIM       12
RECEIPT   FORM      12
RECTOTAL  FORM      8.2       * Receipt total
REF10     DIM       10
SHREGIS   DIM       26                      * short register decsription
TDESC     DIM       13
TAILLENG  FORM      3
TEMPRECP  DIM       8
TMPLTFLG  FORM      1
VARIABLE  DIM       127
XXDPATH   DIM       120
.
.         program constants
.
PAYTYPE1  INIT      "Cash         "
PAYTYPE2  INIT      "Cheque       "
PAYTYPE3  INIT      "Credit Card  "
PAYTYPE4  INIT      "Merchant Card"
PAYTYPE5  INIT      "Money Order  "
CODEPP    INIT      "P/P"
CODEIR    INIT      "I/R"
CODESP    INIT      "S/P"
CODESR    INIT      "S/R"
CODEUR    INIT      "U/R"
.
PRGNAM    INIT      "Reprint a Receipt"
PRGID     INIT      "IBARCP64"
VERSION   INIT      "V12.01.00"
+
.**************************************************************************
.*                              MAINLINE                                  *
.*                            Controlling Logic                           *
.**************************************************************************
ML0000    CALL      INIT0000               * initialization
          BRANCH    EXIT,ML9999
.
ML1000    CALL      OPTN0000               * input receipt number
          BRANCH    EXIT,ML9999
          CALL      SCR0000                * display screen format
          CALL      DISP0000               * display details
          CALL      CHK0000                * ok to re-print
          BRANCH    EXIT,ML1000
.
          CALL      PRTN0000               * re-print receipt
          GOTO      ML1000
.
ML9999    CHAIN     PGM
+
.**************************************************************************
.*                              INIT0000                                  *
.*                            Initialization                              *
.**************************************************************************
INIT0000  CALL      TFILENAM
          MOVE      TFILNAME,CFNAMEDP            * Must preceed CALL PATDPATH
          CALL      PATDPATH
          CALL      DISPHEAD
          MOVE      ZERO,EXIT
.
          DISPLAY   *P56:24,"Opening rcpchqaf";
          OPEN      RCPCHQA1,"rcpchqaf"
          DISPLAY   *P64:24,"rcpcrdaf";
          OPEN      RCPCRDA1,"rcpcrdaf"
          DISPLAY   *P64:24,"rcpdepaf";
          OPEN      RCPDEPA1,"rcpdepaf"
          DISPLAY   *P64:24,"rcptrnaf";
          OPEN      RCPTRNA2,"rcptrnaf"
          DISPLAY   *P64:24,"rcpregaf";
          OPEN      RCPREGA1,"rcpregaf"
          DISPLAY   *P64:24,"ibacodef";
          OPEN      IBACODE1,"ibacodef"
          DISPLAY   *P64:24,"controlf";
          OPEN      CONTROLF,"controlf"
          READ      CONTROLF,THIRTY6;*87,HSYS2,HSYS3,HSYS4,HSYS5,HSYS6: 
                                     *106,HFORMAT
.
.         Open files for ACC format
.
          IF        HSYS2=1
            DISPLAY   *P64:24,"patma1af";
            OPEN      PATMA1A1,"patma1af"
            DISPLAY   *P64:24,"patma1af";
            OPEN      PATMX1A1,"patmx1af"
            DISPLAY   *P64:24,"patre1af";
            OPEN      PATRE1A1,"patre1af"
            DISPLAY   *P64:24,"pmspx2af";
            OPEN      PMSPX2A1,"pmspx2af"
            DISPLAY   *P64:24,"patvisaf";
            OPEN      PATVISA1,"patvisaf"
            DISPLAY   *P64:24,"patinvrf";
            OPEN      PATINVR1,"patinvrf"
          ENDIF
.
.         Open files for Private Practice
.
          IF        HSYS3=1
..            DISPLAY   *P64:24,"pridebtf";
..            OPEN      PRIDEBT1,"pridebtf"
            OPEN      PRIINVO1,"priinvof"
            DISPLAY   *P64:24,"priinvof";
          ENDIF
.
.         Open files for new account receivable
.
          IF        HSYS6=1
            DISPLAY   *P64:24,"debdbtaf";
            OPEN      DEBDBTA1,"debdbtaf"
            DISPLAY   *P64:24,"debfthaf";
            OPEN      DEBFTHA1,"debfthaf"
            OPEN      DEBFTHA6,"debfthaf"
            OPEN      DEBFTHA7,"debfthaf"
            DISPLAY   *P64:24,"debfdtaf";
            OPEN      DEBFDTA3,"debfdtaf"
          ENDIF
.
.
. open controlf file & template header and details for newer layouts
.
          IF        HFORMAT=8
            READ      CONTROLF,THIRTY6;*205,RCCNRCHD,RCCNRCTL
.
            DISPLAY   *P64:24,"ibatmhaf";
            OPEN      IBATMHA1,"ibatmhaf"
            DISPLAY   *P64:24,"ibatmdaf";
            OPEN      IBATDET1,"ibatmdaf"
.
            CALL      STMPL000
            IF        TMPLTFLG=1
              MOVE      "Parameter setting Wrong. Contact I.B.A. - ",DISPMSG
              CALL      MESSAGE1
              MOVE      ONE,EXIT
              GOTO      INIT9999
            ENDIF
.
            LOAD      MAXCLNO,HFORMAT,ZERO,ZERO,ZERO,ZERO,ZERO:
                                      ZERO,ZERO,THIRTY3,ZERO
.
            PACK      CRCPDATE,CCC,CYY,CMM,CDD,SP70
          ENDIF
.
          CALL      SELPRINT
INIT9999  RETURN
+
.*********************************************************************
.                   OPTN0000
.         Process Users Options
.*********************************************************************
OPTN0000  MOVE      TRUE,EXIT
          KEYIN     *P1:3,*EF,*P1:4,"Receipt Number : ",*V2LON,RECEIPT
          COMPARE   ZERO,RECEIPT
          GOTO      OPTN9999 IF EQUAL
          MOVE      RECEIPT,RECDIM12
          DISPLAY   *P18:4,*V2LON,RECDIM12;
          PACK      KEY15,RECDIM12,SP20
          CALL      RDSTRNA2
          CALL      RDKTRNA2
          BRANCH    OVRCD,OPTN1000         * Receipt doesn't exist
.
          MATCH     RECDIM12,TRNRECNO
          GOTO      OPTN1000 IF NOT EQUAL
.
          BRANCH    TRNSTAT,OPTN2000       * Receipt is cancelled
.
          MOVE      RECDIM12,TEMPRECP
          MOVE      FALSE,EXIT             * Receipt ok
          GOTO      OPTN9999
.
OPTN1000  DISPLAY   *P1:24,*B,*EL,"Invalid Receipt Number.  ";
          CALL      HITENTER
          GOTO      OPTN0000
.
OPTN2000  DISPLAY   *P1:24,*B,*EL,"Receipt Cancelled.  ";
          CALL      HITENTER
          GOTO      OPTN0000
.
OPTN9999  RETURN
+
.*************************************************************************
.*                          SCR0000                                      *
.*                        display screen format                          *
.*************************************************************************
SCR0000   DISPLAY   *P1:6,"Date           :           ":
                    *P1:7,"Cashier        :         ":
                    *P1:9,*V2LON,*ULON,"Register",*P14:9," Invoice":
                    *P27:9,"     Amount",*P43:9,"Payment Type      ";
          RETURN
+
.*************************************************************************
.*                               DISP0000                                *
.*                          display actual detail                        *
.*************************************************************************
.
. ---- display first record ----
.
DISP0000  UNPACK    TRNDATE,CCENT,CYEAR,CMON,CDAY
          CALL      PACDATE
          DISPLAY   *P19:6,*V2LON,CPCDATE:
                    *P19:7,TRNCASHR,*HOFF:
                    *P4:10,TRNREG,*P14:10,TRNINV:
                    *P27:10,TRNAMNT:
                    *P44:10,TRNPTYPE;
          LOAD      TDESC,TRNPTYPE,PAYTYPE1,PAYTYPE2,PAYTYPE3,PAYTYPE4,PAYTYPE5
          DISPLAY   *P46:10,"(",TDESC,")";
.
. ---- display subsequent records if they exist ----
.
          MOVE      TEN1,CVERT
.
DISP1000  CALL      RDKTRNA2
          BRANCH    OVRCD,DISP9999
          MATCH     RECDIM12,TRNRECNO
          GOTO      DISP9999 IF NOT EQUAL
.
          DISPLAY   *P4:CVERT,TRNREG,*P14:CVERT,TRNINV:
                    *P27:CVERT,TRNAMNT,*P44:CVERT,TRNPTYPE;
          LOAD      TDESC,TRNPTYPE,PAYTYPE1,PAYTYPE2,PAYTYPE3,PAYTYPE4:
                    PAYTYPE5
          DISPLAY   *P46:CVERT,"(",TDESC,")";
          ADD       ONE,CVERT
          COMPARE   TWENTY3,CVERT
          GOTO      DISP9999 IF EQUAL
          GOTO      DISP1000
.
DISP9999  RETURN
+
.*************************************************************************
.*                               CHK0000                                 *
.*                            ok to re-print                             *
.*************************************************************************
CHK0000   DISPLAY   *P1:24,*EL,"Ok To Re-print (",*V2LON,ANSY,*HOFF,SLASH:
                    *V2LON,ANSN,*HOFF,") ? ";
          KEYIN     *P24:24,*V2LON,ANS;
          REP       UPPLOW,ANS
          MOVE      FALSE,EXIT
          MATCH     "Y",ANS
          GOTO      CHK9999 IF EQUAL
          MATCH     "N",ANS
          GOTO      CHK0000 IF NOT EQUAL
          MOVE      TRUE,EXIT
CHK9999   RETURN
+
.**************************************************************************
.*                              PRT0000                                   *
.*                        Re-print Receipt                                *
.**************************************************************************
PRT0000   CALL      OPNPRINT                 * Prepare spooler for print
          PACK      CRCPDATE,CCC,CYY,CMM,CDD,SP70
          PACK      DIM12,SP20
          PACK      DIM8,SP10                * srf 635035
          MOVE      ZERO,CLNO                * Nothing printed yet
          CALL      CRCT0000                 * Calculate RECTOTAL
          PACK      KEY15,RECDIM12,SP20
          CALL      RDSTRNA2                 * Go through all transactions
.
PRT1000   CALL      RDKTRNA2
          BRANCH    OVRCD,PRT9100
          MATCH     TRNRECNO,RECDIM12        * Same receipt still ?
          GOTO      PRT9100 IF NOT EQUAL     * No - pad out receipt
.
.         Get invoice details
.
          PACK      KEY8,TRNINV              * Invoice number is the key
                                             * PatBill,PrivPrac,Sundry Debtors
          IF        HFORMAT=5|HFORMAT=6|HFORMAT=7|HFORMAT=8|HFORMAT=9
            PACK      PRNTADD1,TRNADD1,SP30
            PACK      PRNTADD2,TRNADD2,SP30
            PACK      PRNTSUBR,SP30,SP5
            PACK      PRNTPOST,TRNPOST,SP5
          ENDIF
.
          PACK      DIM12,SP20
          PACK      PRNTPNUM,SP20
          BRANCH    TRNSYS,PRT1100,PRT1200,PRT1000,PRT1000,PRT1350:
                           PRT1100
.
          COMPARE   "92",TRNSYS              * GST Sundry Cash Sales   *I-90301
          GOTO      PRT1500 IF EQUAL
          COMPARE   "95",TRNSYS              * Sundry Cash Sales
          GOTO      PRT1500 IF EQUAL
          COMPARE   "96",TRNSYS              * Cash Deposits (Priv. Practice)
          GOTO      PRT1500 IF EQUAL
          COMPARE   "97",TRNSYS              * Cash Deposits (Patient)
          GOTO      PRT1500 IF EQUAL
          COMPARE   "98",TRNSYS              * Internal Receipting
          GOTO      PRT1400 IF EQUAL
          COMPARE   "99",TRNSYS              * Internal Receipting
          GOTO      PRT1400 IF EQUAL
          GOTO      PRT1000                  * Otherwise ignore
.
. ------- patient system ------- (or for Nursing Home System as well)
.
PRT1100   MOVE      TRNHOSP,FORM2            * get correct DPATH to scan
          LOAD      XXDPATH,FORM2,HDPATH1,HDPATH2,HDPATH3,HDPATH4
.
          MOVE      "patvisaf",OPFILE
          MOVE      TWENTY,FILENUM
          CALL      OMDFN000                * open visit file in correct dbase
          IF        EXIT=1
            OPEN      PATVISA1,"patvisaf"
          ENDIF
.
          MOVE      "patinvrf",OPFILE
          MOVE      FIFTY1,FILENUM
          CALL      OMDFN000                * open invoice file in correct dbase
          IF        EXIT=1
            OPEN      PATINVR1,"patinvrf"
          ENDIF
.
          MOVE       "patre1af",OPFILE
          MOVE      FORTY6,FILENUM
          CALL      OMDFN000                * open resp file in correct dbase
          IF        EXIT=1
            OPEN      PATRE1A1,"patre1af"
          ENDIF
.
          CALL      RDINV1                   * Patient Billing invoice
          BRANCH    OVRCD,PRT1600      * check for deposit trans of nursing home
.
          UNPACK    PINVDTE,CCENT,CYEAR,CMON,CDAY  * Invoice Date
          MOVE      PINVADM,KEY8
          CALL      RDVISA1
          IF        OVRCD = ZERO
            UNPACK    PVIDATE,CCENT,CYEAR,CMON,CDAY  * Invoice Date
          ENDIF
          CALL      PACDATE
          PACK      DIM12,CODEUR,SP1,PINVUR  * U/R number
          PACK      PRNTPNUM,PINVUR
.
.         Get patient name
.
          MOVE      "Unknown patient",PATNAME
          MOVE      PINVUR,KEY8
          CALL      RDMAST1                * get patient master record
          BRANCH    OVRCD,PRT4000
.
          IF        HFORMAT = 4
            MOVE      SP4,PACTITLE          * format patient name
            MOVE      PTMASNAM,PACSNAME
            MOVE      PGNAME,PACGNAME
            MOVE      THREE,PACFRMT
            CALL      PACNAME
            MOVE      PACFNAMX,PATNAME
          ENDIF
.
          MOVE      SP20,NMPNUMB
          CALL      PMIGTNID
.
          IF        HFORMAT = 5 | HFORMAT = 7 | HFORMAT=8
            UNPACK    PINVDTE,CCENT,CYEAR,CMON,CDAY
            CALL      PACDATE
            MOVE      PTITL,PACTITLE
            MOVE      PTMASNAM,PACSNAMX
            MOVE      PGNAME,ANS
            MOVE      ANS,PACGNAME
            MOVE      THREE,PACFRMT
            CALL      PACNAME
            MOVE      PACFNAMX,PATNAME
            PACK      PRNTNAME,PATNAME,SP30
            MOVE      PURNO,DIM8
            PACK      PRNTPNUM,PURNO
            PACK      KEY8,PINVADM
            CALL      RDRESP1                * Read the PRA file to get suburb
            IF        OVRCD<>1
              PACK      PRNTADD1,PKADD1,SP30
              PACK      PRNTADD2,PKADD2,SP30
              PACK      PRNTSUBR,PKSUBR,SP30
              PACK      TRNPOST,PKPOST,SP30
            ENDIF
          ENDIF
.
          IF        HFORMAT=6
            UNPACK    PINVDTE,CCENT,CYEAR,CMON,CDAY
            CALL      PACDATE
            MOVE      PTITL,PACTITLE
            MOVE      PTMASNAM,PACSNAMX
            MOVE      PGNAME,ANS
            MOVE      ANS,PACGNAME
            MOVE      THREE,PACFRMT
            CALL      PACNAME
            MOVE      PACFNAMX,PATNAME
            MOVE      PACFNAME,TRNREF
            MOVE      PURNO,DBDBDEB
            PACK      KEY8,PINVADM
            CALL      RDRESP1                * Read the PRA file to get suburb
            IF        OVRCD<>1
              PACK      PATNAME,PKNAME,SP30
              PACK      PRNTADD1,PKADD1,SP30
              PACK      PRNTADD2,PKADD2,SP30
              PACK      PRNTSUBR,PKSUBR,SP30
              PACK      TRNPOST,PKPOST,SP30
            ENDIF
          ENDIF
.
          IF        HFORMAT = 9                          
            UNPACK    PINVDTE,CCENT,CYEAR,CMON,CDAY
            CALL      PACDATE
            MOVE      SP4,PACTITLE
            MOVE      PTMASNAM,PACSNAMX
            MOVE      PGNAME,ANS
            MOVE      ANS,PACGNAME
            MOVE      THREE,PACFRMT
            CALL      PACNAME
            MOVE      PACFNAMX,PATNAME
            PACK      PRNTNAME,PATNAME,SP30
            MOVE      PURNO,DIM8
            PACK      PRNTPNUM,PURNO
            CALL      RPAY0000                
            PACK      KEY8,PINVADM
            CALL      RDRESP1                * Read the PRA file to get suburb
            IF        OVRCD<>1
              PACK      PRNTRNAM,PKNAME,SP30
              PACK      PRNTADD1,PKADD1,SP30
              PACK      PRNTADD2,PKADD2,SP30
              PACK      PRNTSUBR,PKSUBR,SP30
              PACK      PRNTPOST,PKPOST,SP30
             ELSE
              MOVE      PINVUR,KEY8
              CALL      RESC0000
            ENDIF
          ENDIF
          GOTO      PRT4000                  * Print transaction
.
. ------- private practice system -------
.
PRT1200   CALL      RDPRIN1                  * Private Practice invoice
          BRANCH    OVRCD,PRT1000
.
          UNPACK    PRINDATE,CCENT,CYEAR,CMON,CDAY  * Invoice Date
          CALL      PACDATE
          BRANCH    PRINSCAN,PRT1250         * This is a PMI record
          PACK      DIM12,CODEPP,SP1,PRINDEBT * Debtor number
          PACK      PRNTPNUM,PRINDEBT
.
.         Get patient name
.
          MOVE      "Unknown patient",PATNAME
.
.   Private debtors no longer used
.
..          MOVE      PRINDEBT,KEY8
..          CALL      RDPRDB1                * get debtor master record
..          BRANCH    OVRCD,PRT4000
.
..          MOVE      SP4,PACTITLE          * format debtor name
..          MOVE      PRDBSNAM,PACSNAME
..          MOVE      PRDBGNAM,PACGNAME
..          MOVE      ONE,PACFRMT
..          CALL      PACNAME
..          MOVE      PACFNAME,PATNAME
..          PACK      PRNTNAME,PATNAME,SP20
..          CALL      RPAY0000                  
..          PACK      PRNTRNAM,PRDBRNAM,SP20
..          PACK      PRNTADD1,PRDBRAD1,SP20
..          PACK      PRNTADD2,PRDBRAD2,SP20
..          PACK      PRNTSUBR,PRDBRAD3,SP20
..          PACK      PRNTPOST,PRDBRPOS,SP20
          GOTO      PRT4000                  * Print transaction
.
PRT1250   PACK      DIM12,CODEUR,SP1,PRINDEBT * U/R number
          PACK      PRNTPNUM,PRINDEBT
.
          MOVE      "Unknown patient",PATNAME
          MOVE      PRINDEBT,KEY8
          CALL      RDMAST1                * get patient master record
          BRANCH    OVRCD,PRT4000
.
          MOVE      PTITL,PACTITLE
          MOVE      PTMASNAM,PACSNAMX
          MOVE      PGNAME,ANS
          MOVE      ANS,PACGNAME
          MOVE      THREE,PACFRMT
          CALL      PACNAME
          MOVE      PACFNAMX,PATNAME
          PACK      PRNTNAME,PATNAME,SP20
          PACK      PRNTRNAM,PATNAME,SP20
          PACK      PRNTADD1,PADD1,SP30
          PACK      PRNTADD2,PADD2,SP30
          PACK      PRNTSUBR,PSUBRB,SP30
          PACK      PRNTPOST,PPOST,SP30
.
          IF    HFORMAT=9
             MOVE      SP4,PACTITLE
             MOVE      PTMASNAM,PACSNAMX
             MOVE      PGNAME,ANS
             MOVE      ANS,PACGNAME
             MOVE      THREE,PACFRMT
             CALL      PACNAME
             MOVE      PACFNAMX,PATNAME
             MOVE      PACFNAME,TRNREF
             MOVE      PURNO,DBDBDEB
             PACK      KEY8,PINVADM
             CALL      RPAY0000
             CALL      RDRESP1                * Read the PRA file
             IF        OVRCD<>1
               PACK      PRNTRNAM,PKNAME,SP30
               PACK      PRNTADD1,PKADD1,SP30
               PACK      PRNTADD2,PKADD2,SP30
               PACK      PRNTSUBR,PKSUBR,SP30
               PACK      PRNTPOST,PKPOST,SP30
              ELSE
               MOVE      PURNO,KEY8
               CALL      RESC0000
             ENDIF
          ENDIF


          GOTO      PRT4000                  * Print transaction
.
. ------- new sundry debtors receipt -------
.
PRT1350   MOVE      TRNINV,FORM8
          PACK      KEY12,SP4,FORM8
          REP       " 0",KEY12
          PACK      KEY21,ONE,KEY12,SP30
          CALL      RSDBFH6
          CALL      RKDBFH6
          BRANCH    OVRCD,PRT1000
          MATCH     "1",DBFHDTY
          GOTO      PRT1000 IF NOT EQUAL
          MATCH     KEY12,DBFHDOC
          GOTO      PRT1000 IF NOT EQUAL
.
          PACK      KEY8,DBFHDEB,SP30
          CALL      RDDBDB1
          BRANCH    OVRCD,PRT1000
.
          PACK      PATNAME,DBDBNA1,SP70
          PACK      PRNTNAME,DBDBNA1,SP20
          PACK      PRNTADD1,DBDBAD1,SP30
          PACK      PRNTADD2,DBDBAD2,SP30
          PACK      PRNTSUBR,DBDBAD3,SP30
          PACK      PRNTPOST,DBDBPC,SP30
          PACK      PTMXCXMP,SP30
          PACK      PTMXCARD,SP30
          MOVE      SP20,NMPNUMB
          MOVE      DBFHDEB,DIM8
          UNPACK    DBFHDDAT,CCENT,CYEAR,CMON,CDAY
          CALL      PACDATE
          GOTO      PRT4000
.
. ------- internal receipting -------
.
PRT1400   MOVE      SP8,CPDATE               * Internal Receipting
          PACK      DIM12,CODEIR,SP10
          IF HFORMAT=5|HFORMAT=6|HFORMAT=7|HFORMAT=8|HFORMAT=9
            PACK      PRNTNAME,TRNPAYEE,SP30
          ENDIF
          GOTO      PRT4000
.
. ------- System codes 95, 96 & 97 --------
.
PRT1500   IF       TRNSYS=97
            GOTO     PRT1520
          ENDIF
. 
          IF       TRNSYS=96
            GOTO     PRT1520
          ENDIF
. 
          MOVE      SP8,CPDATE
          IF HFORMAT=5|HFORMAT=6|HFORMAT=7|HFORMAT=8|HFORMAT=9
            PACK      PRNTNAME,TRNPAYEE,SP30
          ENDIF
          GOTO      PRT4000
.
PRT1520   PACK      KEY15,TRNRECNO,DTRNCOUN,SP10
          CALL      RDRCDP1
          BRANCH    OVRCD,PRT4000
.
          COMPARE   ONE,RCDPSCAN
          GOTO      PRT4000 IF NOT EQUAL
.
          MOVE      RCDPADMN,KEY8
.
          COMPARE   "96",TRNSYS 
          GOTO      PRT1530 IF EQUAL
.
          CALL      RDVISA1  
          BRANCH    OVRCD,PRT4000 
.
          MOVE      PVIURNO,KEY8
PRT1530   CALL      RDMAST1                * get patient master record
          BRANCH    OVRCD,PRT4000
.
          MOVE      SP4,PACTITLE
          MOVE      PTMASNAM,PACSNAMX
          MOVE      PGNAME,ANS
          MOVE      ANS,PACGNAME
          MOVE      THREE,PACFRMT
          CALL      PACNAME
          MOVE      PACFNAMX,PATNAME
          PACK      PRNTNAME,PATNAME,SP30
          CALL      RPAY0000 
.
          MOVE      PURNO,KEY8
          MOVE      PURNO,DIM8 
          CALL      RESC0000
          PACK      DIM12,CODEUR,SP1,PURNO                
          GOTO      PRT4000
.
. print deposit transaction if any, for Nursing Home System only.
.
PRT1600   IF        TRNSYS=6
            UNPACK    TRNDATE,CCENT,CYEAR,CMON,CDAY
            CALL      PACDATE
..            MOVE      CPCDATE,CDATE
            GOTO      PRT4000
          ENDIF
          GOTO      PRT1000
.
.         Print only 8 transactions (9 for ACC & WGH)
.
PRT4000   BRANCH    HFORMAT,PRT4100,PRT4100,PRT4100,PRT4400:
                            PRT4100,PRT4400,PRT4500,PRT4600:
                            PRT4500
.
PRT4100   BRANCH    CLNO,PRT5000,PRT5000,PRT5000,PRT5000,PRT5000:
                         PRT5000,PRT5000,PRT9000
          GOTO      PRT4900
.
PRT4400   BRANCH    CLNO,PRT5000,PRT5000,PRT5000,PRT5000,PRT5000:
                         PRT5000,PRT5000,PRT5000,PRT9000
          GOTO      PRT4900
.
PRT4500   BRANCH    CLNO,PRT5000,PRT5000,PRT5000,PRT5000,PRT5000:
                         PRT5000,PRT5000,PRT5000,PRT5000,PRT5000:
                         PRT5000,PRT5000,PRT5000,PRT5000,PRT5000:
                         PRT5000,PRT5000,PRT5000,PRT5000,PRT5000:
                         PRT9000
          GOTO      PRT4900
.
PRT4600   BRANCH    CLNO,PRT5000,PRT5000,PRT5000,PRT5000,PRT5000:
                         PRT5000,PRT5000,PRT5000,PRT5000,PRT5000:
                         PRT5000,PRT5000,PRT5000,PRT5000,PRT5000:
                         PRT5000,PRT5000,PRT5000,PRT5000,PRT5000:
                         PRT5000,PRT5000,PRT5000,PRT5000,PRT5000:
                         PRT5000,PRT5000,PRT5000,PRT5000,PRT5000:
                         PRT5000,PRT5000,PRT5000:
                         PRT9000
          GOTO      PRT4900
.
.         Print receipt header
.
PRT4900   CALL      RHED0000
.
.         Print transaction
.
PRT5000   CALL      RTRN0000
          ADD       ONE,CLNO
          GOTO      PRT1000
.
.         have another item to print but no space on current receipt
.         so print spaces until end of page and then do a header
.
PRT9000   CALL      RTAL0000
          MOVE      ZERO,CLNO                * Clear counter
          GOTO      PRT4000                  * Print receipt header
.
.         have finished the receipt
.
PRT9100   CALL      REND0000
          IF        HFORMAT=8
            MOVE      ONE,HEADTAIL    * Flagged to Tail
            CALL      XRCP0000        * Print Receipt Tail
            PRINT     " "
            GOTO      PRT9500
          ENDIF
          IF        HFORMAT=SEVEN | HFORMAT=9
            UNPACK    PATNAME,KEY30
            PRINT     *N,*N,*N,*69,RECTOTAL:
                      *N,*N,*N,*N,*N,*N,*N,*N,*N:
                      *N,*N,*53,DIM8,*68,RECDIM12:
                      *N,*14,KEY30,*N,*14,PRNTADD1,*N,*14,PRNTADD2:
                      *N,*14,PRNTSUBR:
                      *N,*34,PRNTPOST,*N,*69,RECTOTAL
            GOTO      PRT9500
          ENDIF
          IF        HFORMAT <> FIVE
            CALL      RTAL0000
          ELSE
            PRINT     *69,RECTOTAL,*F; 
          ENDIF
PRT9500   CALL      CLSPRINT                 * Print out receipt
.
PRT9999   RETURN
.
.*********************************************************************
.         Subroutine to get Responsible Person if not in patre1af    
.*********************************************************************
RESC0000  MOVE      ZERO,FORM1
          CALL      RDPMPX21
          IF        OVRCD=1
             MOVE     SIX,FORM1
           ELSE
             MOVE     PMPXCONP,FORM1
          ENDIF 
          COMPARE   ZERO,FORM1    
          IF        @EQUAL
             MOVE     SIX,FORM1
          ENDIF
          BRANCH    FORM1,RESC1000,RESC2000,RESC3000,RESC4000,RESC5000,RESC6000
.
RESC1000  MOVE      PMPXMTLE,PACTITLE
          MOVE      PMPXMSNA,PACSNAMX
          MOVE      PMPXMGNA,ANS
          MOVE      ANS,PACGNAME
          MOVE      THREE,PACFRMT
          CALL      PACNAME
          MOVE      PACFNAMX,PRNTRNAM
          PACK      PRNTADD1,PMPXMAD1,SP30
          PACK      PRNTADD2,PMPXMAD2,SP30
          PACK      PRNTSUBR,PMPXMAD3,SP30
          PACK      PRNTPOST,PMPXMPOS,SP30
          GOTO      RESC9999
.
RESC2000  MOVE      PMPXFTLE,PACTITLE
          MOVE      PMPXFSNA,PACSNAMX
          MOVE      PMPXFGNA,ANS
          MOVE      ANS,PACGNAME
          MOVE      THREE,PACFRMT
          CALL      PACNAME
          MOVE      PACFNAMX,PRNTRNAM
          PACK      PRNTADD1,PMPXFAD1,SP30
          PACK      PRNTADD2,PMPXFAD2,SP30
          PACK      PRNTSUBR,PMPXFAD3,SP30
          PACK      PRNTPOST,PMPXFPOS,SP30
          GOTO      RESC9999
.
RESC3000  PACK      PRNTRNAM,PNKNAME,SP30  
          PACK      PRNTADD1,PNKADD1,SP30  
          PACK      PRNTADD2,PNKADD2,SP30  
          PACK      PRNTSUBR,PNKSUBR,SP30  
          PACK      PRNTPOST,PNKPOST,SP30  
          GOTO      RESC9999
.
RESC4000  PACK      PRNTRNAM,PTMXECNM,SP30  
          PACK      PRNTADD1,PTMXECA1,SP30  
          PACK      PRNTADD2,PTMXECA2,SP30  
          PACK      PRNTSUBR,PTMXECA3,SP30  
          PACK      PRNTPOST,PTMXECPC,SP30  
          GOTO      RESC9999
.
RESC5000  PACK      PRNTRNAM,PTMXNRNM,SP30  
          PACK      PRNTADD1,PTMXNRA1,SP30  
          PACK      PRNTADD2,PTMXNRA2,SP30  
          PACK      PRNTSUBR,PTMXNRA3,SP30  
          PACK      PRNTPOST,PTMXNRPC,SP30   
.
RESC6000  PACK      PRNTRNAM,PATNAME,SP30
          PACK      PRNTADD1,PADD1,SP30
          PACK      PRNTADD2,PADD2,SP30
          PACK      PRNTSUBR,PSUBRB,SP30
          PACK      PRNTPOST,PPOST,SP30
.
RESC9999  RETURN
.*********************************************************************
.         Subroutine to get Payee Name                               
.*********************************************************************
RPAY0000  PACK      PRNTPNAM,TRNPAYEE,SP30
          BRANCH    TRNPTYPE,RPAY1000,RPAY2000,RPAY3000,RPAY3000,RPAY5000
.
RPAY1000  PACK      PRNTPNAM,TRNPAYEE
          GOTO      RPAY9999
.
RPAY2000  PACK      KEY24,TRNRECNO,TRNCHEQ
          CALL      RDCHQA1
          BRANCH    OVRCD,RPAY9999
.
          PACK      PRNTPNAM,CHQDRAW,SP30
          GOTO      RPAY9999
.
RPAY3000  PACK      KEY26,TRNDATE,SP30
          CALL      RDSCRDA1
.
RPAY3100  CALL      RDKCRDA1
          BRANCH    OVRCD,RPAY9999
.
          MATCH     TRNDATE,CRDDATE
          GOTO      RPAY9999 IF NOT EQUAL
.
          MATCH     TRNRECNO,CRDRECNO
          GOTO      RPAY3100 IF NOT EQUAL
.
          PACK      PRNTPNAM,CRDNAME,SP30
          GOTO      RPAY9999 
.                                  
RPAY5000                                   
RPAY9999  RETURN
.
.*********************************************************************
.         Subroutine to calculate RECTOTAL
.*********************************************************************
CRCT0000  MOVE      ZERO,RECTOTAL            * Clear variable
          PACK      KEY15,RECDIM12,SP20      * For this receipt ...
          CALL      RDSTRNA2                 * Go through all transactions
CRCT1000  CALL      RDKTRNA2
          BRANCH    OVRCD,CRCT9000           * Finished
          MATCH     RECDIM12,TRNRECNO        * Same receipt ?
          GOTO      CRCT9000 IF NOT EQUAL    * No - finished
          ADD       TRNAMNT,RECTOTAL         * Add transaction amount
          GOTO      CRCT1000                 * Read next record
CRCT9000  RETURN
.
.*********************************************************************
.*                  PRTN0000                    Called by : ML0000   *
.*        Print the receipt depending on Format                      *
.*********************************************************************
PRTN0000  BRANCH    HFORMAT,PRTN1000,PRTN1000,PRTN1300,PRTN1000,PRTN1000:
                            PRTN1000,PRTN1000,PRTN1000,PRTN1000
.
PRTN1000  CALL      PRT0000                 * all others
          GOTO      PRTN9999
.
PRTN1300  CALL      RWAR0000                * for warburton
.
PRTN9999  RETURN
+
.*********************************************************************
.*                  RWAR0000                    Called by : PRTN0000 *
.*        Print Receipt for Warburton                                *
.*********************************************************************
RWAR0000  CALL      OPNPRINT                 * Prepare spooler for print
          MOVE      ZERO,CLNO                * Nothing printed yet
.
          CALL      CRCT0000                 * Calculate RECTOTAL
.
          PACK      KEY15,TEMPRECP,SP20
          CALL      RDSTRNA2                 * Go through all transactions
.
RWAR1000  CALL      RDKTRNA2
          BRANCH    OVRCD,RWAR4600
.
          MATCH     TRNRECNO,RECDIM12        * Same receipt still ?
          GOTO      RWAR4600 IF NOT EQUAL     * No - pad out receipt
.
.         Get invoice details
.
          PACK      KEY8,TRNINV,SP8          * Invoice number is the key
          UNPACK    TRNDATE,CCENT,CYEAR,CMON,CDAY
          CALL      PACDATE
          MOVE      CPDATE,CDATE
.
          BRANCH    TRNSYS,RWAR1100,RWAR1200,RWAR1000
.                          PatBill  PrivPrac Sundry Debtors (ignore old)
.
          COMPARE   "98",TRNSYS              * Internal Receipting
          GOTO      RWAR1400 IF EQUAL
          GOTO      RWAR1000                  * Otherwise ignore
.
RWAR1100  CALL      RDINV1                   * Patient Billing invoice
          BRANCH    OVRCD,RWAR1000           * invalid invoice number
          UNPACK    PINVDTE,CCENT,CYEAR,CMON,CDAY  * Invoice Date
          CALL      PACDATE
          MOVE      PINVUR,DIM8              * UR number
          GOTO      RWAR4000                 * Print transaction
.
RWAR1200  CALL      RDPRIN1                  * Private Practice invoice
          BRANCH    OVRCD,RWAR1000           * invalid invoice number
          UNPACK    PRINDATE,CCENT,CYEAR,CMON,CDAY  * Invoice Date
          CALL      PACDATE
          MOVE      PRINDEBT,DIM8            * UR number
          GOTO      RWAR4000                 * Print transaction
.
RWAR1400  MOVE      SP2,XDAY                 * Internal Receipting
          MOVE      SP2,XMON
          MOVE      SP2,XYEAR
          MOVE      SP2,XCENT
          MOVE      SP10,CPDATE              * clear date
          MOVE      ZERO,DIM8                * no UR number
          GOTO      RWAR4000
.
.         Print only 29 transactions (0-28)
.         when CLNO =  1 ; one line has been printed
.         when CLNO = 29 ; 29 lines have been printed
.
RWAR4000  PACK      DIM12,TRNREF,SP30
          COMPARE   "29",CLNO
          GOTO      RWAR4400 IF NOT LESS    * finished a page
.
          COMPARE   ZERO,CLNO
          GOTO      RWAR4200 IF NOT EQUAL   * normal line
.
.         Print receipt header (line 15 & 18)
.         (assumes we are on line 1, so 14 *N gets to line 15)
.
          PRINT     *N,*N,*N,*N,*N,*N,*N,*N,*N,*N,*N,*N,*N,*N,*68,TRNRECNO:
                    *N,*N,*N,*7,"RECEIPT",*68,CDATE,*N,*N,*N,*N
.
.         Print transaction (lines 23 - 51)
.
RWAR4200  PRINT     *3,TRNREG,*10,TRNINV,*20,TRNREF:
                    *44,DIM8,*57,CPDATE,*68,TRNAMNT
          ADD       ONE,CLNO
          GOTO      RWAR1000
.
.         receipt has gone over a page (line 53)
.
RWAR4400  PRINT     *N,"  continued on next page ",*N,*N,*N,*N,*N,*N,*N,*N,*N:
                    *N,*N,*N,*N,*N;
          MOVE      ZERO,CLNO                * Clear counter
          GOTO      RWAR4000                 * Print receipt header
.
.         at end of current receipt 
.
RWAR4600  COMPARE   "29",CLNO
          GOTO      RWAR5000 IF NOT LESS    * finished receipt
.
.         print blank lines till end of receipt
.
          PRINT     *1,SP10                 * Print another line
          ADD       ONE,CLNO                * Increment counter
          GOTO      RWAR4600
.
.         print the total at end of receipt (line 61) and leave at line 1 of new
.         receipt (line 67 of current one)
.
RWAR5000  PRINT     *N,*N,*N,*N,*N,*N,*N,*N,*N,*68,RECTOTAL,*N,*N,*N,*N,*N,*N;
.
RWAR9995  CALL      CLSPRINT                 * Print out receipt
.
RWAR9999  RETURN
+
.*********************************************************************
.         print the receipt header
.*********************************************************************
RHED0000  BRANCH    HFORMAT,RHED0100,RHED0100,RHED0100,RHED0400,RHED0500:
                            RHED0600,RHED0700,RHED0800,RHED0900
.
RHED0100  PRINT     *N,*72,CDAY,SLASH,CMON,SLASH,CYEAR:
                    *N,*N,*72,TRNRECNO,*N,*N,*26,TRNPAYEE:
                    *69,RECTOTAL,*N,*26,TRNADD1:
                    *N,*26,TRNADD2,*43,TRNPOST,*N,*N
          GOTO      RHED9999
.
RHED0400  PRINT     *N,*82,CDAY,SLASH,CMON,SLASH,CYEAR:
                    *N,*N,*26,TRNPAYEE,*82,TRNRECNO,*N,*26,TRNADD1:
                    *N,*26,TRNADD2,*47,TRNPOST,*79,RECTOTAL,*N,*N
          GOTO      RHED9999
.
. ------- layout 5 - Hawkes Bay -------
.
RHED0500  UNPACK    PRNTNAME,KEY30
          PRINT     *1,KEY30,*32,PURNO:
                    *N,*1,PRNTADD1,*44,"RECEIPT (COPY)",*65,RECDIM12:
                    *N,*1,PRNTADD2,*65,CDATE:
                    *N,*1,PRNTSUBR,*33,PRNTPOST:
                    *N,*N,*N,*10,PTMXCXMP,*35,PTMXCARD,*63,NMPNUMB:
                    *N,*N,*N,*1,"Register",*35,"Invoice No.",*50,"  Date  ":
                    *70,"Amount",*N
          GOTO      RHED9999
.
. ------- layout 6 - West Gippsland -------
.
RHED0600   UNPACK    PRNTNAME,KEY40
           PRINT     *N,*N:
                    *N,*N,*13,KEY40,*65,CDATE:
                    *N,*13,PRNTADD1:
                    *N,*13,PRNTADD2,*65,RECDIM12:
                    *N,*13,PRNTSUBR:
                    *N,*38,PRNTPOST,*65,RECTOTAL,*N,*N,*24,"RECEIPT (COPY)":
                    *N,*N,*N
          GOTO      RHED9999
.
. ------- layout 7 - West Wimmera -------
.
RHED0700  PRINT     *N,*N,*60,"RECEIPT (COPY)":
                    *N,*N,*N,*N,*53,RECDIM12,*70,CDATE:
                    *N,*N,*N,*N,*N,*14,PRNTNAME:
                    *N,*14,PRNTADD1,*57,DIM12:
                    *N,*14,PRNTADD2:
                    *N,*14,PRNTSUBR:
                    *N,*34,PRNTPOST:
                    *N,*N,*N,*N,*N,*N,*N,*N
          GOTO      RHED9999
.
. ------- layout 9 - Ballarat Health Services -------
.
RHED0800  MOVE      ZERO,HEADTAIL      * Flagged to Header
          CALL      XRCP0000           * Print Receipt Header
          CALL      RSBHS000           * print on the right side
.
          GOTO      RHED9999
.
RHED0900 PRINT      *1,"CREATEFORMRCHRECEIPT":
                    *N,*1,"rchreceipt":
                    *N,*60,"RECEIPT (COPY)":
                    *N,PRNTPNAM:
                    *N,*N,*N,*53,RECDIM12,*70,CDATE:
                    *N,*N,*14,PRNTRNAM:
                    *N,*N,*N,*14,PRNTNAME:
                    *N,*14,PRNTADD1,*57,DIM12:
                    *N,*14,PRNTADD2:
                    *N,*14,PRNTSUBR:
                    *N,*34,PRNTPOST:
                    *N,*N,*N,*N,*N,*N,*N,*N
          GOTO      RHED9999
.
RHED9999  RETURN
+
.*********************************************************************
.         print the transaction
.*********************************************************************
RTRN0000  MOVE      "Unknown register",REGDESC
          MOVE      TRNREG,KEY3
          CALL      RDREGA1
          MOVE      REGDESC,SHREGIS
          BRANCH    HFORMAT,RTRN0100,RTRN0100,RTRN0100,RTRN0400,RTRN0500:
                            RTRN0600,RTRN0700,RTRN0800,RTRN0900
.
.                                                       * added reg 92 *I-90301
.
RTRN0100  IF        TRNSYS = 95 | TRNSYS = 96 | TRNSYS = 97 | TRNSYS = 92
            MOVE      TRNREF,REF10
            PRINT     *10,TRNREG,*21,REF10,*33,DIM12:
                      *50,CPDATE,*62,TRNAMNT
          ELSE
            PRINT     *10,TRNREG,*21,TRNINV,*33,DIM12:
                      *50,CPDATE,*62,TRNAMNT
          ENDIF
          GOTO      RTRN9999
.
RTRN0400  MOVE      PATNAME,PNAM15
          PRINT     *1,SHREGIS,*28,TRNINV,*37,DIM12,*50,TRNREF,*71,PNAM15:
                    *87,TRNAMNT
          GOTO      RTRN9999
.
. ----- layout 5 - Hawkes Bay -------
.
RTRN0500  PRINT     *1,SHREGIS,*35,TRNINV,*50,CPDATE,*69,TRNAMNT
          GOTO      RTRN9999
.
. ----- layout 6 - West Gippsland -------
.
RTRN0600  PRINT     *1,TRNREG,*10,TRNREF,*30,DBDBDEB,*41,TRNINV:
                    *52,CPCDATE,*68,TRNAMNT
          GOTO      RTRN9999
.
. ----- layout 7 - West Wimmera & layout 8 RCH -------
.
.                                                       * added reg 92 *I-90301
.
RTRN0700  IF        TRNSYS = 95 | TRNSYS = 96 | TRNSYS = 97 | TRNSYS = 92
            PRINT     CPCDATE,*12,TRNREG,*16,TRNREF,*69,TRNAMNT
          ELSE
            PRINT     CPCDATE,*12,TRNREG,*16,TRNINV,*69,TRNAMNT
          ENDIF
          GOTO      RTRN9999
.
. ----- layout 8 - Ballarat Health Services -------
.
.                                                       * added reg 92 *I-90301
.
RTRN0800  IF        TRNSYS = 95 | TRNSYS = 96 | TRNSYS = 97 | TRNSYS = 92
            PRINT     CPCDATE,*12,TRNREG,*16,TRNREF,*93,TRNAMNT;
          ELSE
            PRINT     CPCDATE,*12,TRNREG,*16,TRNINV,*93,TRNAMNT;
          ENDIF
          ADD       ONE,CLNO
          CALL      RSBHS000        * print on the right side
          SUB       ONE,CLNO
          GOTO      RTRN9999
.
.
. ----- layout 9 - RCH  -------
. 
.                                                       * added reg 92 *I-90301
.
RTRN0900  IF        TRNSYS = 95 | TRNSYS = 96 | TRNSYS = 97 | TRNSYS = 92
            PRINT     CPCDATE,*12,TRNREG,*16,TRNREF,*69,TRNAMNT
          ELSE
            PRINT     CPCDATE,*12,TRNREG,*16,TRNINV,*69,TRNAMNT
          ENDIF
          GOTO      RTRN9999
RTRN9999  RETURN
+
.*********************************************************************
.         print tail when going over a page
.*********************************************************************
RTAL0000  BRANCH    HFORMAT,RTAL0100,RTAL0100,RTAL0100,RTAL0400,RTAL0100:
                            RTAL0600,RTAL0700,RTAL0800,RTAL0900
.
RTAL0100  PRINT     *N,*N,*N
          GOTO      RTAL9999
.
RTAL0400  PRINT     *N,*N,*N,*N
          GOTO      RTAL9999
.
RTAL0600  PRINT     *N,*N,*N,*N,*N,*N,*N,*N,*N,*N,*N
          gOTO      RTAL9999
.
RTAL0700  PRINT     *N,*N,*69,"CARRIED FWD":
                    *N,*N,*N,*N,*N,*N,*N,*N,*N,*N:
                    *N,*N,*N,*N,*N
          GOTO      RTAL9999
.
RTAL0800  PRINT     *N,*N,*69,"CARRIED FWD":
                    *N,*N,*N,*N,*N,*N,*N,*N,*N,*N:
                    *N,*N,*N,*N,*N
          MOVE      THREE,CURRROW              * current row counter
          CALL      XCRF0000                   * Position Carried Forward
          GOTO      RTAL9999
.
RTAL0900  PRINT     *N,*N,*69,"CARRIED FWD":
                    *N,*N,*N,*N,*N,*N,*N,*N,*N,*N:
                    *N,*N,*N,*N,*N
          GOTO      RTAL9999
.
RTAL9999  RETURN
+
.*********************************************************************
.         print the end of the receipt
.*********************************************************************
REND0000  BRANCH    HFORMAT,REND0100,REND0100,REND0100,REND0400,REND0100:
                            REND0400,REND0500,REND0600,REND0500
.
REND0100  BRANCH    CLNO,REND9000,REND9000,REND9000,REND9000,REND9000:
                         REND9000,REND9000,REND9999
          GOTO      REND9000
.
REND0400  BRANCH    CLNO,REND9000,REND9000,REND9000,REND9000,REND9000:
                         REND9000,REND9000,REND9000,REND9999
          GOTO      REND9000
.
REND0500  BRANCH    CLNO,REND9000,REND9000,REND9000,REND9000,REND9000:
                         REND9000,REND9000,REND9000,REND9000,REND9000:
                         REND9000,REND9000,REND9000,REND9000,REND9000:
                         REND9000,REND9000,REND9000,REND9000,REND9000:
                         REND9999
          GOTO      REND9000
.
REND0600  ADD       ONE,CLNO
          MOVE      ONE,OVRCD
          CALL      RSBHS000        * print on the right side
          GOTO      REND9999
.
REND9000  PRINT     *N;                      * Print another line
          ADD       ONE,CLNO                 * Increment counter
          GOTO      REND0000
.
REND9999  RETURN
.------------------------------------------------------------------------------
. Print something on the right hand side of Stationery
. Requires : MAXCLNO
.            OVERCD = 1 - loop thru until MAXCLNO reach
.                     0 - just find the appropriate position to print
.------------------------------------------------------------------------------
RSBHS000  COMPARE   ZERO,CLNO
          GOTO      RSBHS020 IF EQUAL
.
          COMPARE   THREE,CLNO
          GOTO      RSBHS040 IF EQUAL
.
          COMPARE   TEN3,CLNO
          GOTO      RSBHS060 IF EQUAL
.
          COMPARE   TWENTY3,CLNO
          GOTO      RSBHS080 IF EQUAL
.
          COMPARE   MAXCLNO,CLNO
          GOTO      RSBHS010 IF NOT LESS
.
          PRINT     *133,SP1
RSBHS010  BRANCH    OVRCD,RSBHS990
          GOTO      RSBHS999
.
RSBHS020  PRINT     *114," ":
                    *N
          ADD       TWO,CLNO
          BRANCH    OVRCD,RSBHS000
          GOTO      RSBHS999
.
RSBHS040  PRINT     *114,PRNTPNUM
          BRANCH    OVRCD,RSBHS990
          GOTO      RSBHS999
.
RSBHS060  PRINT     *120,RECDIM12
          BRANCH    OVRCD,RSBHS990
          GOTO      RSBHS999
.
RSBHS080  PRINT     *121,RECTOTAL
          BRANCH    OVRCD,RSBHS990
          GOTO      RSBHS999
.
RSBHS990  ADD       ONE,CLNO
.
          COMPARE   MAXCLNO,CLNO
          GOTO      RSBHS999 IF NOT LESS
          GOTO      RSBHS000
.
RSBHS999  RETURN
.------------------------------------------------------------------------------
. Set Template Files
. Returns  : TMPLTFLG : 0 - do template, 1 - don't template
.            TAILLENG
.------------------------------------------------------------------------------
STMPL000  MOVE      ONE,TMPLTFLG
          MOVE      ZERO,TAILLENG
.
          MATCH     "000000",RCCNRCHD
          GOTO      STMPL050 IF EQUAL
.
          MATCH     SP6,RCCNRCHD
          GOTO      STMPL100 IF NOT EQUAL
.
STMPL050  MATCH     "000000",RCCNRCTL
          GOTO      STMPL999 IF EQUAL
.
          MATCH     SP6,RCCNRCTL
          GOTO      STMPL999 IF EQUAL
.
STMPL100  PACK      KEY6,RCCNRCHD,SP70
          CALL      RDIBTH1               * read header detail file
          BRANCH    OVRCD,STMPL900
.
          PACK      KEY6,RCCNRCTL,SP70
          CALL      RDIBTH1               * read header detail file
          BRANCH    OVRCD,STMPL910
.
          MOVE      IBTHLENG,TAILLENG
.
          GOTO      STMPL990
.
.------ stationery code not on file ------
.
STMPL900  MOVE     "User Defined Stationery Header Code not on File. - ",DISPMSG
          CALL      MESSAGE1
          BEEP
          GOTO      STMPL999
.
.
STMPL910  MOVE      "User Defined Stationery Tail Code not on File. - ",DISPMSG
          CALL      MESSAGE1
          BEEP
          GOTO      STMPL999
.
STMPL990  MOVE      ZERO,TMPLTFLG
.
STMPL999  RETURN
.------------------------------------------------------------------------------
. Print Receipt Header or Tail Templating
. Requires : HEADTAIL : 0 - Head , 1 - Tail
.------------------------------------------------------------------------------
XRCP0000  MOVE      ONE,CURRROW              * Initialise current row counter
.
          IF        HEADTAIL=0
            PACK      KEY6,RCCNRCHD,SP70
            CALL      RDIBTH1               * read header detail file
.
            PACK      KEY12,RCCNRCHD,SP70
          ELSE
            PACK      KEY6,RCCNRCTL,SP70
            CALL      RDIBTH1               * read header detail file
.
            PACK      KEY12,RCCNRCTL,SP70
          ENDIF
          CALL      RSIBDET1
          CALL      RKIBDET1
          BRANCH    OVRCD,XRCP8000
.
          IF        HEADTAIL=0
            MATCH     RCCNRCHD,IBDTSCOD        * Same form ?
            GOTO      XRCP8000 IF NOT EQUAL    * No - pad out rest of form
            GOTO      XRCP0100
          ELSE
            MATCH     RCCNRCTL,IBDTSCOD        * Same form ?
            GOTO      XRCP8000 IF NOT EQUAL    * No - pad out rest of form
            GOTO      XRCP0100
          ENDIF
.
XRCP0100  COMPARE   CURRROW,IBDTROW          * Current row up to required row ?
          GOTO      XRCP0400 IF EQUAL        * Yes - print data
          PRINT     *N;                      * Else print 1 extra line
          ADD       ONE,CURRROW              * Increment counter
          GOTO      XRCP0100                 * Check counter again
.
. ------- Read through the details file -------
.
XRCP0200  CALL      RKIBDET1                 * Read next detail record
          BRANCH    OVRCD,XRCP8000           * No more records - pad out form
.
          BRANCH    HEADTAIL,XRCP0250        * Header or Tail ?
.
          MATCH     RCCNRCHD,IBDTSCOD        * Same form ?
          GOTO      XRCP8000 IF NOT EQUAL    * No - pad out rest of form
          GOTO      XRCP0300
.
XRCP0250  MATCH     RCCNRCTL,IBDTSCOD        * Same form ?
          GOTO      XRCP8000 IF NOT EQUAL    * No - pad out rest of form
.
XRCP0300  COMPARE   CURRROW,IBDTROW          * Are we at the required row ?
          GOTO      XRCP0400 IF EQUAL        * Yes - print data
          PRINT     *N;                      * Else pad out to required row
          ADD       ONE,CURRROW              * One more row printed
          GOTO      XRCP0300                 * Check row count
.
. ------- Print actual data lines -------
.
XRCP0400  BRANCH    IBDTINDC,XRCP0500:       * Text field
                             XRCP0600        * Data field
.
. ------- Print text field -------
.
XRCP0500  RESET     IBDTTXFL,IBDTPLEN
          LENSET    IBDTTXFL
          RESET     IBDTTXFL
.
          IF        IBDTPLEN=7
            MOVE      IBDTTXFL,DIM40
            REP       UPPLOW,DIM40
            MATCH     "RECEIPT",DIM40
            IF        @EQUAL
              RESET     IBDTTXFL,IBDTPLEN
              LENSET    IBDTTXFL
              APPEND    " (COPY)",IBDTTXFL
              RESET     IBDTTXFL
            ENDIF
          ENDIF
.
          PRINT     *IBDTCOL,*+,IBDTTXFL;    * Print data
          MOVE      IBDTROW,CURRROW          * Row printed is current row
          GOTO      XRCP0200                 * Read next record
.
. ------- Print data field -------
.
XRCP0600  MOVE      IBDTTXFL,DIM5            * Data number 1st 3 chars of field
          MOVE      DIM5,FORM5               * Move to a FORM field for BRANCH
          PACK      VARIABLE,SP30,SP30,SP30,SP30,SP10  * Initialise variable
.
          BRANCH    HEADTAIL,XRCP0650        * Header or Tail ?
.
          BRANCH    FORM5,XRCP1010,XRCP1020,XRCP1030,XRCP1040,XRCP1050:   * 5
                          XRCP1060,XRCP1070,XRCP1080,XRCP1090,XRCP1100:   *10
                          XRCP1110,XRCP1120,XRCP1130,XRCP1140,XRCP1150:   *15
                          XRCP1160,XRCP1170,XRCP1180,XRCP1190,XRCP1200    *20
          GOTO      XRCP0200                 * ignoring, Read next record
.
XRCP0650  BRANCH    FORM5,XRCP1010,XRCP1020,XRCP1030,XRCP1040,XRCP1050:
                          XRCP1060,XRCP1070,XRCP1080,XRCP0710,XRCP0720:   *10
                          XRCP0730,XRCP1180,XRCP1190,XRCP1200
          GOTO      XRCP0200                 * ignoring, Read next record
.
. Tail Items/Fields below
.
XRCP0710  MOVE      RECTOTAL,VARIABLE        * Unformated Total Receipt
          MOVE      TEN1,PRNTSTRT
          SUB       IBDTPLEN,PRNTSTRT
          GOTO      XRCP5000
.
.... I-55180
XRCP0720  MOVE      RCBNCDRW,VARIABLE        * Cash Drawer
          GOTO      XRCP5000
.
XRCP0730  MOVE      CPAGENO,KEY3             * Page no
          PACK      VARIABLE,KEY3,SP70
          GOTO      XRCP5000
.
. Header Items/Fields below
.
XRCP1010  MOVE      RECDIM12,VARIABLE        * Receipt Number
          GOTO      XRCP5000
.
XRCP1020  UNPACK    CRCPDATE,CCENT,CYEAR,CMON,CDAY    * Receipt date
          CALL      PACDATE
          IF        IBDTPLEN = 10
            MOVE      CPCDATE,VARIABLE
          ELSE
            MOVE      CPDATE,VARIABLE
          ENDIF
          GOTO      XRCP5000
.
XRCP1030  MOVE      PRNTNAME,VARIABLE        * Patient/Debtor Name
          GOTO      XRCP5000
.
XRCP1040  MOVE      PRNTADD1,VARIABLE        * Patient Address Line 1
          GOTO      XRCP5000
.
XRCP1050  MOVE      PRNTADD2,VARIABLE        * Patient Address Line 2
          GOTO      XRCP5000
.
XRCP1060  MOVE      PRNTSUBR,VARIABLE        * Patient Suburb
          GOTO      XRCP5000
.
XRCP1070  MOVE      PRNTPOST,VARIABLE        * Patient Post Code
          GOTO      XRCP5000
.
XRCP1080  MOVE      PRNTPNUM,VARIABLE        * U/R, Private, or Debtor Number
          GOTO      XRCP5000
.           
XRCP1090  MOVE      PTHSHOSP,VARIABLE        * Hospital ID
          GOTO      XRCP5000
.
XRCP1100  MOVE      PTHSNAME,VARIABLE        * Hospital Name
          GOTO      XRCP5000
.
XRCP1110  MOVE      PTHSADD1,VARIABLE        * Hospital Address 1
          GOTO      XRCP5000
.
XRCP1120  MOVE      PTHSADD2,VARIABLE        * Hospital Address 2
          GOTO      XRCP5000
.
XRCP1130  MOVE      PTHSADD3,VARIABLE        * Hospital Address 3
          GOTO      XRCP5000
.
XRCP1140  MOVE      PTHSADD4,VARIABLE        * Hospital Address 4
          GOTO      XRCP5000
.
XRCP1150  MOVE      PTHSPCOD,VARIABLE        * Hospital Postcode
          GOTO      XRCP5000
.
XRCP1160  MOVE      PTHSTELE,VARIABLE        * Hospital Telephone no
          GOTO      XRCP5000
.
XRCP1170  MOVE      PTHSFAXN,VARIABLE        * Hospital Fax no
          GOTO      XRCP5000
.
XRCP1180  MOVE      PRNTADD4,VARIABLE        * Patient Address Line 4
          GOTO      XRCP5000
.
XRCP1190  MOVE      PRNTRNAM,VARIABLE        * Person Responsible for Account
          GOTO      XRCP5000
.
XRCP1200  PROC      GETALTID                 * Singapore HRN
          GOTO      XRCP5000
.
. ------- Format the variable -------
.
XRCP5000  RESET     VARIABLE,IBDTPLEN
          LENSET    VARIABLE
          RESET     VARIABLE
          PRINT     *IBDTCOL,*+,VARIABLE;
          GOTO      XRCP0200                 * Read next record
.
. ------- Formatting for Form fields and right justified variables -------
.
XRCP6000  COMPARE   ZERO,PRNTSTRT          * Don't bump if printing full length
          GOTO      XRCP7000 IF EQUAL
.
          BUMP      VARIABLE,PRNTSTRT      * bump to starting position
.
. ------- Print the variable -------
.
XRCP7000  PRINT     *IBDTCOL,*+,VARIABLE;
          GOTO      XRCP0200                 * Read next record
.
.------ end of invoice reached ------
.
XRCP8000  MOVE      FALSE,EXIT
.
.------ print new-lines until the end of page is reached ------
.
XRCP9000  COMPARE   IBTHLENG,CURRROW         * test page length
          GOTO      XRCP9999 IF NOT LESS
.
          PRINT     *N;
          ADD       ONE,CURRROW
          GOTO      XRCP9000
.
XRCP9999  MOVE      ZERO,CLNO                * Set column number
          RETURN                             * Finished
.------------------------------------------------------------------------------
. Position Receipt - Carried forward
.------------------------------------------------------------------------------
XCRF0000  COMPARE   CURRROW,TAILLENG         * Current row up to required row ?
          GOTO      XCRF9900 IF EQUAL        * Yes - print data
          GOTO      XCRF9999 IF LESS         * out of the loop
          PRINT     *N;                      * Else print 1 extra line
          ADD       ONE,CURRROW              * Increment counter
          GOTO      XCRF0000                 * Check counter again
.
XCRF9900  PRINT     " "
.
XCRF9999  RETURN
.------------------------------------------------------------------------------
. Set Variables value for Lineup print
.------------------------------------------------------------------------------
XSET0000  MOVE      "999999999999",RECDIM12
          MOVE      "99999999",CRCPDATE
          MOVE      "XXXXXXXXXXXXXXXXXXXXXXXXXXXXXX",PRNTNAME
          MOVE      "XXXXXXXXXXXXXXXXXXXX",PRNTADD1
          MOVE      "XXXXXXXXXXXXXXXXXXXX",PRNTADD2
          MOVE      "XXXXXXXXXXXXXXXXXXXX",PRNTSUBR
          MOVE      "XXXX",PRNTPOST
          MOVE      "99999999",PRNTPNUM
          MOVE      "99999999.99",RECTOTAL
XSET9999  RETURN
+
.***************************************************************************
.*  OTRF0000  :  Open all required visit based files                       *
.***************************************************************************
OTRF0000  IF        FILENUM = 20
            CLOSE     PATVISA1
            OPEN      PATVISA1,PATH
          ENDIF
          IF        FILENUM = 51
            CLOSE     PATINVR1
            OPEN      PATINVR1,PATH
          ENDIF
          IF        FILENUM = 46
            CLOSE     PATRE1A1
            OPEN      PATRE1A1,PATH
          ENDIF
.
OTRF9999  RETURN
+
.
.
.   Obsoleted IO files that are required by this program
.
.
.   INC       RCPCHQIO.INC
.
.   FILE  I/O REQUESTS FOR BANK ACCOUNT FILE.
.
.OVRCD  FORM            1             0=NOT OVER
.                                     1= OVER
.KEY24  DIM            24             KEY FOR RCPCHQA1
.
.       NOTE  OVRCD=1   RECORD DOES NOT EXIST
.                   2   RECORD IS LOCKED
.
RDACHQA1 RESET     KEY24
         MOVE      ZERO,OVRCD
         READ      RCPCHQA1,KEY24;ANS
         GOTO      OVERCOND IF OVER
         RETURN
.
RDSCHQA1 RESET     KEY24
         READ      RCPCHQA1,KEY24;;
         RETURN
.
RDCHQA1  MOVE      ZERO,OVRCD
         RESET     KEY24
         READ      RCPCHQA1,KEY24;CHQRECPT,CHQDATE,CHQCASHR,CHQDRAW:
                                  CHQBANK,CHQBRNCH,CHQNUM,DCHQAMNT:
                                  CHQSTAT1,CHQSTAT2
         GOTO      OVERCOND IF OVER
         MOVE      DCHQAMNT,CHQAMNT
         RETURN
.
RDKCHQA1 MOVE      ZERO,OVRCD
         READKS    RCPCHQA1;CHQRECPT,CHQDATE,CHQCASHR,CHQDRAW:
                            CHQBANK,CHQBRNCH,CHQNUM,DCHQAMNT:
                            CHQSTAT1,CHQSTAT2
         GOTO      OVERCOND IF OVER
         MOVE      DCHQAMNT,CHQAMNT
         RETURN
.
RDPCHQA1 MOVE      ZERO,OVRCD
         READKP    RCPCHQA1;CHQRECPT,CHQDATE,CHQCASHR,CHQDRAW:
                            CHQBANK,CHQBRNCH,CHQNUM,DCHQAMNT:
                            CHQSTAT1,CHQSTAT2
         GOTO      OVERCOND IF OVER
         MOVE      DCHQAMNT,CHQAMNT
         RETURN
.
WRCHQA1  RESET     KEY24
         MOVE      CHQAMNT,DCHQAMNT
         MOVE      ZERO,OVRCD
         WRITE     RCPCHQA1,KEY24;CHQRECPT,CHQDATE,CHQCASHR,CHQDRAW:
                                  CHQBANK,CHQBRNCH,CHQNUM,DCHQAMNT:
                                  CHQSTAT1,CHQSTAT2
         RETURN
.
UPCHQA1  MOVE      CHQAMNT,DCHQAMNT
         UPDATE    RCPCHQA1;CHQRECPT,CHQDATE,CHQCASHR,CHQDRAW:
                            CHQBANK,CHQBRNCH,CHQNUM,DCHQAMNT:
                            CHQSTAT1,CHQSTAT2
         RETURN
.
.
DECHQA1  RESET     KEY24
         MOVE      ZERO,OVRCD
         DELETE    RCPCHQA1,KEY24
         RETURN
.
.
.
.   INC       RCPCRDIO.INC
.
.   FILE  I/O REQUESTS FOR CREDIT/MERCHANT CARD FILE.
.
.OVRCD  FORM            1             0=NOT OVER
.                                     1= OVER
.KEY26  DIM            26             KEY FOR RCPCRDA1
.
.       NOTE  OVRCD=1   RECORD DOES NOT EXIST
.                   2   RECORD IS LOCKED
.
RDACRDA1 RESET     KEY26
         MOVE      ZERO,OVRCD
         READ      RCPCRDA1,KEY26;ANS
         GOTO      OVERCOND IF OVER
         RETURN
.
RDSCRDA1 RESET     KEY26
         READ      RCPCRDA1,KEY26;;
         RETURN
.
RDCRDA1  MOVE      ZERO,OVRCD
         RESET     KEY26
         READ      RCPCRDA1,KEY26;CRDDATE,DCRDFLAG,CRDCODE,CRDRECNO,DCRDCOUN:
                                  CRDNAME,DCRDAMNT,CRDSTAT
         GOTO      OVERCOND IF OVER
         MOVE      DCRDFLAG,CRDFLAG
         MOVE      DCRDCOUN,CRDCOUNT
         MOVE      DCRDAMNT,CRDAMNT
         RETURN
.
RDKCRDA1 MOVE      ZERO,OVRCD
         READKS    RCPCRDA1;CRDDATE,DCRDFLAG,CRDCODE,CRDRECNO,DCRDCOUN:
                            CRDNAME,DCRDAMNT,CRDSTAT
         GOTO      OVERCOND IF OVER
         MOVE      DCRDFLAG,CRDFLAG
         MOVE      DCRDCOUN,CRDCOUNT
         MOVE      DCRDAMNT,CRDAMNT
         RETURN
.
WRCRDA1  RESET     KEY26
         MOVE      ZERO,OVRCD
         MOVE      CRDFLAG,DCRDFLAG
         MOVE      CRDCOUNT,DCRDCOUN
         MOVE      CRDAMNT,DCRDAMNT
         WRITE     RCPCRDA1,KEY26;CRDDATE,DCRDFLAG,CRDCODE,CRDRECNO,DCRDCOUN:
                                  CRDNAME,DCRDAMNT,CRDSTAT
         RETURN
.
UPCRDA1  MOVE      CRDFLAG,DCRDFLAG
         MOVE      CRDCOUNT,DCRDCOUN
         MOVE      CRDAMNT,DCRDAMNT
         UPDATE    RCPCRDA1;CRDDATE,DCRDFLAG,CRDCODE,CRDRECNO,DCRDCOUN:
                            CRDNAME,DCRDAMNT,CRDSTAT
         RETURN
.
.
DECRDA1  RESET     KEY26
         MOVE      ZERO,OVRCD
         DELETE    RCPCRDA1,KEY26
         RETURN
.
.
.
. RCPDEPIO.INC
. ------------
. Filename     : rcpdepaf
. Description  : Receipting Deposit File I/O Subroutines
. Variables    : OVRCD    FORM    1
.                KEY15    DIM     11
.
RARCDP1   MOVE      ZERO,OVRCD
          RESET     KEY15
          READ      RCPDEPA1,KEY15;ANS
          GOTO      OVERCOND IF OVER
          RETURN
.
RSRCDP1   MOVE      ZERO,OVRCD
          RESET     KEY15
          READ      RCPDEPA1,KEY15;;
          RETURN
.
RDRCDP1   MOVE      ZERO,OVRCD
          RESET     KEY15
          READ      RCPDEPA1,KEY15;RCDPRECP,DRCDPCNT,RCDPADMN:
                                   RCDPSCAN,RCDPDEPT,RCDPPAYT,DRCDPAMN:
                                   RCDPDRAW,RCDPCBNK,RCDPCBRN,RCDPPRAC:
                                   RCDPHOSP,RCDPSYST,RCDPMHOS,RCDPSPAR
          GOTO      OVERCOND IF OVER
          MOVE      DRCDPCNT,RCDPCNT
          MOVE      RCDPADMN,RCDPADNO
          MOVE      DRCDPAMN,RCDPAMNT
          RETURN
.
RKRCDP1   MOVE      ZERO,OVRCD
          READKS    RCPDEPA1;RCDPRECP,DRCDPCNT,RCDPADMN,RCDPSCAN:
                             RCDPDEPT,RCDPPAYT,DRCDPAMN,RCDPDRAW,RCDPCBNK:
                             RCDPCBRN,RCDPPRAC,RCDPHOSP,RCDPSYST,RCDPMHOS:
                             RCDPSPAR
          GOTO      OVERCOND IF OVER
          MOVE      DRCDPCNT,RCDPCNT
          MOVE      RCDPADMN,RCDPADNO
          MOVE      DRCDPAMN,RCDPAMNT
          RETURN
.
RPRCDP1   MOVE      ZERO,OVRCD
          READKP    RCPDEPA1;RCDPRECP,DRCDPCNT,RCDPADMN,RCDPSCAN:
                             RCDPDEPT,RCDPPAYT,DRCDPAMN,RCDPDRAW,RCDPCBNK:
                             RCDPCBRN,RCDPPRAC,RCDPHOSP,RCDPSYST,RCDPMHOS:
                             RCDPSPAR
          GOTO      OVERCOND IF OVER
          MOVE      DRCDPCNT,RCDPCNT
          MOVE      RCDPADMN,RCDPADNO
          MOVE      DRCDPAMN,RCDPAMNT
          RETURN
.
WRRCDP1   MOVE      ZERO,OVRCD
          RESET     KEY15
          MOVE      RCDPAMNT,DRCDPAMN
          WRITE     RCPDEPA1,KEY15;KEY15,RCDPADMN,RCDPSCAN:
                                   RCDPDEPT,RCDPPAYT,DRCDPAMN,RCDPDRAW,RCDPCBNK:
                                   RCDPCBRN,RCDPPRAC,RCDPHOSP,RCDPSYST,RCDPMHOS:
                                   RCDPSPAR
          RETURN
.
UPRCDP1   MOVE      RCDPCNT,DRCDPCNT
          MOVE      RCDPAMNT,DRCDPAMN
          UPDATE    RCPDEPA1;RCDPRECP,DRCDPCNT,RCDPADMN,RCDPSCAN:
                             RCDPDEPT,RCDPPAYT,DRCDPAMN,RCDPDRAW,RCDPCBNK:
                             RCDPCBRN,RCDPPRAC,RCDPHOSP,RCDPSYST,RCDPMHOS:
                             RCDPSPAR
          RETURN
.
DERCDP1   RESET     KEY15
          DELETE    RCPDEPA1,KEY15
          RETURN
.
.         2nd Index
.
RARCDP2   MOVE      ZERO,OVRCD
          RESET     KEY18
          READ      RCPDEPA2,KEY18;ANS
          GOTO      OVERCOND IF OVER
          RETURN
.
RSRCDP2   MOVE      ZERO,OVRCD
          RESET     KEY18
          READ      RCPDEPA2,KEY18;;
          RETURN
.
RDRCDP2   MOVE      ZERO,OVRCD
          RESET     KEY18
          READ      RCPDEPA2,KEY18;RCDPRECP,DRCDPCNT,RCDPADMN:
                                   RCDPSCAN,RCDPDEPT,RCDPPAYT,DRCDPAMN:
                                   RCDPDRAW,RCDPCBNK,RCDPCBRN,RCDPPRAC:
                                   RCDPHOSP,RCDPSYST,RCDPMHOS,RCDPSPAR
          GOTO      OVERCOND IF OVER
          MOVE      DRCDPCNT,RCDPCNT
          MOVE      RCDPADMN,RCDPADNO
          MOVE      DRCDPAMN,RCDPAMNT
          RETURN
.
RKRCDP2   MOVE      ZERO,OVRCD
          READKS    RCPDEPA2;RCDPRECP,DRCDPCNT,RCDPADMN,RCDPSCAN:
                             RCDPDEPT,RCDPPAYT,DRCDPAMN,RCDPDRAW,RCDPCBNK:
                             RCDPCBRN,RCDPPRAC,RCDPHOSP,RCDPSYST,RCDPMHOS:
                             RCDPSPAR
          GOTO      OVERCOND IF OVER
          MOVE      DRCDPCNT,RCDPCNT
          MOVE      RCDPADMN,RCDPADNO
          MOVE      DRCDPAMN,RCDPAMNT
          RETURN
.
RPRCDP2   MOVE      ZERO,OVRCD
          READKP    RCPDEPA2;RCDPRECP,DRCDPCNT,RCDPADMN,RCDPSCAN:
                             RCDPDEPT,RCDPPAYT,DRCDPAMN,RCDPDRAW,RCDPCBNK:
                             RCDPCBRN,RCDPPRAC,RCDPHOSP,RCDPSYST,RCDPMHOS:
                             RCDPSPAR
          GOTO      OVERCOND IF OVER
          MOVE      DRCDPCNT,RCDPCNT
          MOVE      RCDPADMN,RCDPADNO
          MOVE      DRCDPAMN,RCDPAMNT
          RETURN
.
.         3rd Index
.
RARCDP3   MOVE      ZERO,OVRCD
          RESET     KEY23
          READ      RCPDEPA3,KEY23;ANS
          GOTO      OVERCOND IF OVER
          RETURN
.
RSRCDP3   MOVE      ZERO,OVRCD
          RESET     KEY23
          READ      RCPDEPA3,KEY23;;
          RETURN
.
RDRCDP3   MOVE      ZERO,OVRCD
          RESET     KEY23
          READ      RCPDEPA3,KEY23;RCDPRECP,DRCDPCNT,RCDPADMN:
                                   RCDPSCAN,RCDPDEPT,RCDPPAYT,DRCDPAMN:
                                   RCDPDRAW,RCDPCBNK,RCDPCBRN,RCDPPRAC:
                                   RCDPHOSP,RCDPSYST,RCDPMHOS,RCDPSPAR
          GOTO      OVERCOND IF OVER
          MOVE      DRCDPCNT,RCDPCNT
          MOVE      RCDPADMN,RCDPADNO
          MOVE      DRCDPAMN,RCDPAMNT
          RETURN
.
RKRCDP3   MOVE      ZERO,OVRCD
          READKS    RCPDEPA3;RCDPRECP,DRCDPCNT,RCDPADMN,RCDPSCAN:
                             RCDPDEPT,RCDPPAYT,DRCDPAMN,RCDPDRAW,RCDPCBNK:
                             RCDPCBRN,RCDPPRAC,RCDPHOSP,RCDPSYST,RCDPMHOS:
                             RCDPSPAR
          GOTO      OVERCOND IF OVER
          MOVE      DRCDPCNT,RCDPCNT
          MOVE      RCDPADMN,RCDPADNO
          MOVE      DRCDPAMN,RCDPAMNT
          RETURN
.
RPRCDP3   MOVE      ZERO,OVRCD
          READKP    RCPDEPA3;RCDPRECP,DRCDPCNT,RCDPADMN,RCDPSCAN:
                             RCDPDEPT,RCDPPAYT,DRCDPAMN,RCDPDRAW,RCDPCBNK:
                             RCDPCBRN,RCDPPRAC,RCDPHOSP,RCDPSYST,RCDPMHOS:
                             RCDPSPAR
          GOTO      OVERCOND IF OVER
          MOVE      DRCDPCNT,RCDPCNT
          MOVE      RCDPADMN,RCDPADNO
          MOVE      DRCDPAMN,RCDPAMNT
          RETURN
.
.
.   INC       RCPTRNIO.INC
.
.   FILE  I/O REQUESTS FOR TRANSACTION FILE.
.
.OVRCD  FORM            1             0 = NOT OVER
.                                     1 = OVER
.
.KEY29    DIM          29             KEY FOR RCPTRNA1
.KEY15    DIM          15             KEY FOR RCPTRNA2
.KEY32    DIM          32             KEY FOR RCPTRNA3
.KEY31    DIM          31             KEY FOR RCPTRNA4
.KEY28    DIM          28             KEY FOR RCPTRNA5
.
.         NOTE  OVRCD = 1   RECORD DOES NOT EXIST
.                       2   RECORD IS LOCKED
.
RDATRNA1 RESET     KEY29
         MOVE      ZERO,OVRCD
         READ      RCPTRNA1,KEY29;ANS
         GOTO      OVERCOND IF OVER
         RETURN
.
RDSTRNA1 RESET     KEY29
         READ      RCPTRNA1,KEY29;;
         RETURN
.
RDTRNA1  MOVE      ZERO,OVRCD
         RESET     KEY29
         READ      RCPTRNA1,KEY29;TRNDATE,TRNCASHR,TRNRECNO,DTRNCOUN,TRNREG:
                                  TRNMODE,TRNSYS,TRNINV,TRNREF,TRNCARD:
                                  TRNPAYEE,TRNADD1,TRNADD2,TRNPOST,TRNPTYPE:
                                  TRNINACC,TRNBNKAC,DTRNAMNT,DTRNDISC,TRNSTAT:
                                  TRNBANK,TRNTYPE,TRNCHEQ,TRNHOSP,TRNGSTC:
                                  TRNGSTA,TRNBDDTE,TRNSPARE
         GOTO      OVERCOND IF OVER
         MOVE      DTRNCOUN,TRNCOUNT
         MOVE      DTRNAMNT,TRNAMNT
         MOVE      DTRNDISC,TRNDISC
         RETURN
.
RDKTRNA1 MOVE      ZERO,OVRCD
         READKS    RCPTRNA1;TRNDATE,TRNCASHR,TRNRECNO,DTRNCOUN,TRNREG:
                            TRNMODE,TRNSYS,TRNINV,TRNREF,TRNCARD:
                            TRNPAYEE,TRNADD1,TRNADD2,TRNPOST,TRNPTYPE:
                            TRNINACC,TRNBNKAC,DTRNAMNT,DTRNDISC,TRNSTAT:
                            TRNBANK,TRNTYPE,TRNCHEQ,TRNHOSP,TRNGSTC:
                            TRNGSTA,TRNBDDTE,TRNSPARE
         GOTO      OVERCOND IF OVER
         MOVE      DTRNCOUN,TRNCOUNT
         MOVE      DTRNAMNT,TRNAMNT
         MOVE      DTRNDISC,TRNDISC
         RETURN
.
RDATRNA2 RESET     KEY15
         MOVE      ZERO,OVRCD
         READ      RCPTRNA2,KEY15;ANS
         GOTO      OVERCOND IF OVER
         RETURN
.
RDSTRNA2 RESET     KEY15
         READ      RCPTRNA2,KEY15;;
         RETURN
.
RDTRNA2  MOVE      ZERO,OVRCD
         RESET     KEY15
         READ      RCPTRNA2,KEY15;TRNDATE,TRNCASHR,TRNRECNO,DTRNCOUN,TRNREG:
                                  TRNMODE,TRNSYS,TRNINV,TRNREF,TRNCARD:
                                  TRNPAYEE,TRNADD1,TRNADD2,TRNPOST,TRNPTYPE:
                                  TRNINACC,TRNBNKAC,DTRNAMNT,DTRNDISC,TRNSTAT:
                                  TRNBANK,TRNTYPE,TRNCHEQ,TRNHOSP,TRNGSTC:
                                  TRNGSTA,TRNBDDTE,TRNSPARE
         GOTO      OVERCOND IF OVER
         MOVE      DTRNCOUN,TRNCOUNT
         MOVE      DTRNAMNT,TRNAMNT
         MOVE      DTRNDISC,TRNDISC
         RETURN
.
RDKTRNA2 MOVE      ZERO,OVRCD
         READKS    RCPTRNA2;TRNDATE,TRNCASHR,TRNRECNO,DTRNCOUN,TRNREG:
                            TRNMODE,TRNSYS,TRNINV,TRNREF,TRNCARD:
                            TRNPAYEE,TRNADD1,TRNADD2,TRNPOST,TRNPTYPE:
                            TRNINACC,TRNBNKAC,DTRNAMNT,DTRNDISC,TRNSTAT:
                            TRNBANK,TRNTYPE,TRNCHEQ,TRNHOSP,TRNGSTC:
                            TRNGSTA,TRNBDDTE,TRNSPARE
         GOTO      OVERCOND IF OVER
         MOVE      DTRNCOUN,TRNCOUNT
         MOVE      DTRNAMNT,TRNAMNT
         MOVE      DTRNDISC,TRNDISC
         RETURN
.
RDATRNA3 RESET     KEY32
         MOVE      ZERO,OVRCD
         READ      RCPTRNA3,KEY32;ANS
         GOTO      OVERCOND IF OVER
         RETURN
.
RDSTRNA3 RESET     KEY32
         READ      RCPTRNA3,KEY32;;
         RETURN
.
RDTRNA3  MOVE      ZERO,OVRCD
         RESET     KEY32
         READ      RCPTRNA3,KEY32;TRNDATE,TRNCASHR,TRNRECNO,DTRNCOUN,TRNREG:
                                  TRNMODE,TRNSYS,TRNINV,TRNREF,TRNCARD:
                                  TRNPAYEE,TRNADD1,TRNADD2,TRNPOST,TRNPTYPE:
                                  TRNINACC,TRNBNKAC,DTRNAMNT,DTRNDISC,TRNSTAT:
                                  TRNBANK,TRNTYPE,TRNCHEQ,TRNHOSP,TRNGSTC:
                                  TRNGSTA,TRNBDDTE,TRNSPARE
         GOTO      OVERCOND IF OVER
         MOVE      DTRNCOUN,TRNCOUNT
         MOVE      DTRNAMNT,TRNAMNT
         MOVE      DTRNDISC,TRNDISC
         RETURN
.
RDKTRNA3 MOVE      ZERO,OVRCD
         READKS    RCPTRNA3;TRNDATE,TRNCASHR,TRNRECNO,DTRNCOUN,TRNREG:
                            TRNMODE,TRNSYS,TRNINV,TRNREF,TRNCARD:
                            TRNPAYEE,TRNADD1,TRNADD2,TRNPOST,TRNPTYPE:
                            TRNINACC,TRNBNKAC,DTRNAMNT,DTRNDISC,TRNSTAT:
                            TRNBANK,TRNTYPE,TRNCHEQ,TRNHOSP,TRNGSTC:
                            TRNGSTA,TRNBDDTE,TRNSPARE
         GOTO      OVERCOND IF OVER
         MOVE      DTRNCOUN,TRNCOUNT
         MOVE      DTRNAMNT,TRNAMNT
         MOVE      DTRNDISC,TRNDISC
         RETURN
.
RDATRNA4 RESET     KEY31
         MOVE      ZERO,OVRCD
         READ      RCPTRNA4,KEY31;ANS
         GOTO      OVERCOND IF OVER
         RETURN
.
RDSTRNA4 RESET     KEY31
         READ      RCPTRNA4,KEY31;;
         RETURN
.
RDTRNA4  MOVE      ZERO,OVRCD
         RESET     KEY31
         READ      RCPTRNA4,KEY31;TRNDATE,TRNCASHR,TRNRECNO,DTRNCOUN,TRNREG:
                                  TRNMODE,TRNSYS,TRNINV,TRNREF,TRNCARD:
                                  TRNPAYEE,TRNADD1,TRNADD2,TRNPOST,TRNPTYPE:
                                  TRNINACC,TRNBNKAC,DTRNAMNT,DTRNDISC,TRNSTAT:
                                  TRNBANK,TRNTYPE,TRNCHEQ,TRNHOSP,TRNGSTC:
                                  TRNGSTA,TRNBDDTE,TRNSPARE
         GOTO      OVERCOND IF OVER
         MOVE      DTRNCOUN,TRNCOUNT
         MOVE      DTRNAMNT,TRNAMNT
         MOVE      DTRNDISC,TRNDISC
         RETURN
.
RDKTRNA4 MOVE      ZERO,OVRCD
         READKS    RCPTRNA4;TRNDATE,TRNCASHR,TRNRECNO,DTRNCOUN,TRNREG:
                            TRNMODE,TRNSYS,TRNINV,TRNREF,TRNCARD:
                            TRNPAYEE,TRNADD1,TRNADD2,TRNPOST,TRNPTYPE:
                            TRNINACC,TRNBNKAC,DTRNAMNT,DTRNDISC,TRNSTAT:
                            TRNBANK,TRNTYPE,TRNCHEQ,TRNHOSP,TRNGSTC:
                            TRNGSTA,TRNBDDTE,TRNSPARE
         GOTO      OVERCOND IF OVER
         MOVE      DTRNCOUN,TRNCOUNT
         MOVE      DTRNAMNT,TRNAMNT
         MOVE      DTRNDISC,TRNDISC
         RETURN
.
RDATRNA5 RESET     KEY28
         MOVE      ZERO,OVRCD
         READ      RCPTRNA5,KEY28;ANS
         GOTO      OVERCOND IF OVER
         RETURN
.
RDSTRNA5 RESET     KEY28
         READ      RCPTRNA5,KEY28;;
         RETURN
.
RDTRNA5  MOVE      ZERO,OVRCD
         RESET     KEY28
         READ      RCPTRNA5,KEY28;TRNDATE,TRNCASHR,TRNRECNO,DTRNCOUN,TRNREG:
                                  TRNMODE,TRNSYS,TRNINV,TRNREF,TRNCARD:
                                  TRNPAYEE,TRNADD1,TRNADD2,TRNPOST,TRNPTYPE:
                                  TRNINACC,TRNBNKAC,DTRNAMNT,DTRNDISC,TRNSTAT:
                                  TRNBANK,TRNTYPE,TRNCHEQ,TRNHOSP,TRNGSTC:
                                  TRNGSTA,TRNBDDTE,TRNSPARE
         GOTO      OVERCOND IF OVER
         MOVE      DTRNCOUN,TRNCOUNT
         MOVE      DTRNAMNT,TRNAMNT
         MOVE      DTRNDISC,TRNDISC
         RETURN
.
RDKTRNA5 MOVE      ZERO,OVRCD
         READKS    RCPTRNA5;TRNDATE,TRNCASHR,TRNRECNO,DTRNCOUN,TRNREG:
                            TRNMODE,TRNSYS,TRNINV,TRNREF,TRNCARD:
                            TRNPAYEE,TRNADD1,TRNADD2,TRNPOST,TRNPTYPE:
                            TRNINACC,TRNBNKAC,DTRNAMNT,DTRNDISC,TRNSTAT:
                            TRNBANK,TRNTYPE,TRNCHEQ,TRNHOSP,TRNGSTC:
                            TRNGSTA,TRNBDDTE,TRNSPARE
         GOTO      OVERCOND IF OVER
         MOVE      DTRNCOUN,TRNCOUNT
         MOVE      DTRNAMNT,TRNAMNT
         MOVE      DTRNDISC,TRNDISC
         RETURN
.
WRTRNA1  RESET     KEY29
         MOVE      ZERO,OVRCD
         MOVE      TRNAMNT,DTRNAMNT
         MOVE      TRNDISC,DTRNDISC
         MOVE      TRNCOUNT,DTRNCOUN
         WRITE     RCPTRNA1,KEY29;TRNDATE,TRNCASHR,TRNRECNO,DTRNCOUN,TRNREG:
                                  TRNMODE,TRNSYS,TRNINV,TRNREF,TRNCARD:
                                  TRNPAYEE,TRNADD1,TRNADD2,TRNPOST,TRNPTYPE:
                                  TRNINACC,TRNBNKAC,DTRNAMNT,DTRNDISC,TRNSTAT:
                                  TRNBANK,TRNTYPE,TRNCHEQ,TRNHOSP,TRNGSTC:
                                  TRNGSTA,TRNBDDTE,TRNSPARE
.
         RETURN
.
UPTRNA1  MOVE      TRNCOUNT,DTRNCOUN
         MOVE      TRNAMNT,DTRNAMNT
         MOVE      TRNDISC,DTRNDISC
         UPDATE    RCPTRNA1;TRNDATE,TRNCASHR,TRNRECNO,DTRNCOUN,TRNREG:
                            TRNMODE,TRNSYS,TRNINV,TRNREF,TRNCARD:
                            TRNPAYEE,TRNADD1,TRNADD2,TRNPOST,TRNPTYPE:
                            TRNINACC,TRNBNKAC,DTRNAMNT,DTRNDISC,TRNSTAT:
                            TRNBANK,TRNTYPE,TRNCHEQ,TRNHOSP,TRNGSTC:
                            TRNGSTA,TRNBDDTE,TRNSPARE
         RETURN
.
UPTRNA2  MOVE      TRNCOUNT,DTRNCOUN
         MOVE      TRNAMNT,DTRNAMNT
         MOVE      TRNDISC,DTRNDISC
         UPDATE    RCPTRNA2;TRNDATE,TRNCASHR,TRNRECNO,DTRNCOUN,TRNREG:
                            TRNMODE,TRNSYS,TRNINV,TRNREF,TRNCARD:
                            TRNPAYEE,TRNADD1,TRNADD2,TRNPOST,TRNPTYPE:
                            TRNINACC,TRNBNKAC,DTRNAMNT,DTRNDISC,TRNSTAT:
                            TRNBANK,TRNTYPE,TRNCHEQ,TRNHOSP,TRNGSTC:
                            TRNGSTA,TRNBDDTE,TRNSPARE
         RETURN
.
UPTRNA3  MOVE      TRNCOUNT,DTRNCOUN
         MOVE      TRNAMNT,DTRNAMNT
         MOVE      TRNDISC,DTRNDISC
         UPDATE    RCPTRNA3;TRNDATE,TRNCASHR,TRNRECNO,DTRNCOUN,TRNREG:
                            TRNMODE,TRNSYS,TRNINV,TRNREF,TRNCARD:
                            TRNPAYEE,TRNADD1,TRNADD2,TRNPOST,TRNPTYPE:
                            TRNINACC,TRNBNKAC,DTRNAMNT,DTRNDISC,TRNSTAT:
                            TRNBANK,TRNTYPE,TRNCHEQ,TRNHOSP,TRNGSTC:
                            TRNGSTA,TRNBDDTE,TRNSPARE
         RETURN
.
DETRNA1  RESET     KEY29
         MOVE      ZERO,OVRCD
         DELETE    RCPTRNA1,KEY29
.
         RETURN
.
DETRNA2  RESET     KEY15
         MOVE      ZERO,OVRCD
         DELETE    RCPTRNA2,KEY15
         RETURN
.
RDPTRNA2 MOVE      ZERO,OVRCD
         READKP    RCPTRNA2;TRNDATE,TRNCASHR,TRNRECNO,DTRNCOUN,TRNREG:
                            TRNMODE,TRNSYS,TRNINV,TRNREF,TRNCARD:
                            TRNPAYEE,TRNADD1,TRNADD2,TRNPOST,TRNPTYPE:
                            TRNINACC,TRNBNKAC,DTRNAMNT,DTRNDISC,TRNSTAT:
                            TRNBANK,TRNTYPE,TRNCHEQ,TRNHOSP,TRNGSTC:
                            TRNGSTA,TRNBDDTE,TRNSPARE
         GOTO      OVERCOND IF OVER
         MOVE      DTRNCOUN,TRNCOUNT
         MOVE      DTRNAMNT,TRNAMNT
         MOVE      DTRNDISC,TRNDISC
         RETURN
.
WRTRNA2  RESET     KEY15
         MOVE      ZERO,OVRCD
         MOVE      TRNAMNT,DTRNAMNT
         MOVE      TRNDISC,DTRNDISC
         MOVE      TRNCOUNT,DTRNCOUN
         WRITE     RCPTRNA2,KEY15;TRNDATE,TRNCASHR,TRNRECNO,DTRNCOUN,TRNREG:
                                  TRNMODE,TRNSYS,TRNINV,TRNREF,TRNCARD:
                                  TRNPAYEE,TRNADD1,TRNADD2,TRNPOST,TRNPTYPE:
                                  TRNINACC,TRNBNKAC,DTRNAMNT,DTRNDISC,TRNSTAT:
                                  TRNBANK,TRNTYPE,TRNCHEQ,TRNHOSP,TRNGSTC:
                                  TRNGSTA,TRNBDDTE,TRNSPARE
.
         RETURN
.
................................................................................
.
.         I/O includes
.
          INC       STD001IO
          INC       STDHLPCD
.
          INC       DEBDBTIO/INC
          INC       DEBFTHIO/INC
          INC       DEBFDTIO/INC
          INC       IBAPRNIO/INC
          INC       IBAPRINT
          INC       IBATMHIO/INC            * Template Header
          INC       IBATMDIO/INC            * Template Tail
          INC       NHIMASIO/INC
          INC       PATINVIO/INC
          INC       PATMA1IO/INC
          INC       PATRE1IO/INC
          INC       PATVISIO/INC
          INC       PATNIDIO/INC
          INC       PMSPX2IO/INC
          INC       PRIINVIO/INC
          INC       RCPREGIO/INC
          INC       PATHOSIO/INC
          INC       PATDPATH
          INC       PMIGTNID
          INC       GETALTID
          INC       TFILENAM 
          INC       WEBERRIO/INC

