.******************************************************************************
.*               P R O G R A M  S U M M A R Y                                 *
.*               -------------  -------------                                 *
.*                                                                            *
.*      PROGRAM NAME:     IBABIL23                                            *
.*                                                                            *
.*      FUNCTION:         AGED TRIAL BALANCE                                  *
.*                                                                            *
.*      DATE WRITTEN:     02/06/86                                            *
.*                                                                            *
.*      AUTHOR:           MALCOLM HAYSE (I.B.A)                               *
.*                                                                            *
.*      MODIFICATIONS:                                                        *
.*                                                                            *
.*        V12.01.01 23/01/2026  J.Tan         TSK 0958216                     *
.*                  Added ACLMCD -printing report separate page for each Claim*
.*        V12.00.01 16/05/2025  Ebon Clements TSK 0955096                     *
.*                  Alphanueric visit number changes                          *
.*        V11.04.02 30/07/2024  J.Tan         TSK 0949723                     *
.*                  Mod checking for cancelled outpatient                     *
.*        V11.04.01 13/06/2024  J.Tan         TSK 0947864                     *
.*                  Fixed deleting tempfile                                   *
.*        V10.14.04 10/05/2019  Peter Vela    TSK 0873277                     *
.*                  Changed to pack name into KEY12 in PRINTFU5               *
.*        V10.14.03 09/05/2019  Peter Vela    TSK 0873277                     *
.*                  Changed report layout to accomodate longer value fields   *
.*        V10.14.02 30/04/2019  Peter Vela    TSK 0873277                     *
.*                  Increased length of FTOT60, FTOT90, FTOT120, FTOT1YR      *
.*                  FTOT2YR, DTOT60, DTOT90, DTOT120, DTOT1YR, DTOT2YR to 8.2 *
.*        V10.14.01 29/04/2019  Peter Vela    TSK 0873277                     *
.*                  Made FTOT30, DTOT30 8.2                                   *
.******************************************************************************
.*        V10.11.02 27/11/2017  Thanh T.      TSK 0821710                     *
.*                  Recompiled as PATMISTD changed                            *
.*        V10.11.01 15/09/2017  Thanh T.      TSK 0821710                     *
.*                  Audit Amission/outpatient visit comments                  *
.******************************************************************************
.*        V10.08.05 26/10/2016 J.Tan          TSK 0826575                     *
.*                  Fixed U/R number for Normal ATB layout
.*        V10.08.04 15/07/2015 J.Tan          TSK 0822064                     *
.*                  Mods for No Prepend Comment Date to print last line of    *
.*                  Admission Comments (DCOMFLAG)                             *
.*        V10.08.03 11/05/2016  Don Nguyen    TSK 0314955                     *
.*                  Modified PRCM0000; removed print of </tr> and changed code*
.*                  around where it's being called to work accordingly.       *
.*                  Modified RDBC0000 & PRCM0000 to prefix comments with note *
.*                  input date (VSMDDATE) if non-empty.                       *
.*        V10.08.02 22/04/2015 J.Tan          CAR 0313425                     *
.*                  Mods for ATB Export Only (CATBLAY=6) 120 150 180 Days     *
.*        V10.08.01 23/03/2015 J.Tan          CAR 0313425                     *
.*                  Mods for ATB Export Only 90 and No Comments parameters    *
.******************************************************************************
.*        V10.05.01 21/07/2014 J.Tan          CAR 291099                      *
.*                  Mods printing Billing Comments                            *
.*        V10.04.02 12/06/2014 Steve Armstrong  CAR 301639                    *
.*                  Moved call to TFILENAM to start of program and added call *
.*                  to KILL0000 on exit of program.                           *
.*        V10.04.01 08/04/2013 J.Tan          CAR 261630                      *
.*                  Removed port number from temp file name                   *
.******************************************************************************
.*        V10.03.05 26/04/2013  J.Tan         CAR 284531                      *
.*                  Removed checking Outstanding amount less than zero        *
.*        V10.03.04 03/09/2012  J.Tan         CAR 268233                      *
.*                  Mods for Reassign Debt for Emergency and Outpatients      *
.*        V10.03.03 13/07/2012  Mike Laming   CAR 268180                      *
.*                  Fixed "ENDP GOTO" for non Healthscope hospitals to END30  *
.*        V10.03.02 25/06/2012  J.Tan         CAR 233248                      *
.*                  Fixed patients with changed claim code after invoiced     *
.*        V10.03.01 12/01/2012  J.Tan         CAR 258449                      *
.*                  Mods FTOTCURR to F8.2 from F7.2                           *
.*        V10.02.01 04/05/2011  J.Tan         CAR 229619                      *
.*                  Mods HEA ATB not to print zero amt of HF outstanding      *
.*        V10.01.01 11/03/2011  J.Tan         CAR 233264                      *
.*                  Mods to print Debt Collection Agency                      *
.*        V10.00.02 05/10/2010  J.Tan         CAR 229465                      *
.*                  Fixed Healthscope 90+ days outstanding report             *
.*        V10.00.01 01/04/2010  J.Tan         CAR 218402                      *
.*                  Fixed isbuild errors                                      *
.*        V9.12.10  14/10/2009  J.Tan         CAR 207195                      *
.*                  Fixed including invoices which fully credited             *
.*        V9.12.09  28/09/2009  J.Tan         CAR 194482                      *
.*                  Removed using isbload, mods to write to index file        *
.*        V9.12.08  25/09/2009  J.Tan         CAR 203935                      *
.*                  Mods Cash to use Effective date instead of Transac.date   *
.*        V9.12.07  18/09/2009  Mike Laming   CAR 205647                      *
.*                  Fix Correct line count (CLNO) for Healthscope (CATBLAY=5) *
.*        V9.12.06  18/09/2009  Mike Laming   CAR 205647                      *
.*                  Correct line count (CLNO) for Healthscope (CATBLAY=5)     *
.*        V9.12.05  21/08/2009 J.Tan                                          *
.*                  Add code for ATDTGSTM for AAE at PROC520 (Invoice balance) *
.*        V9.12.04  21/08/2009 Saroeun Soeur  CAR 203057                      *
.*                  fixed billing comment repeating on other admissions       *
.*        V9.12.03  02/07/2009 Saroeun Soeur  CAR 199751                      *
.*                  fixed excel output to patients first initial              *
.*                  instead of patient title, fixed REAS0000                  *
.*                  subroutine to reset PTRAPPOR on OVRCD                     *
.*                  report now matches with web front end                     *
.*        V9.12.02  01/06/2009 J.Tan          CAR 191023                      *
.*                  Mods Patient Debt only option for inpatient option only   *
.*        V9.12.01  18/05/2009 J.Tan          CAR 191023                      *
.*                  Added Patient Debt only option for Healthscope            *
.*        V9.11.03  30/04/2009 J.Tan          CAR 191029                      *
.*                  Mods for Healthscope ATB layout                           *
.*        V9.11.02  21/01/2009 Ebon Clements  CAR 187437                      *
.*                  Changed PRINTFU2 to add 2 to CLNO                         *
.*                  Changed call to HEAD test to 56 in PRTD420,PRINTFUL,DAYR80*
.*        V9.11.01  14/01/2009 Sandra Barcham CAR 187545                      *
.*                  Change heading from 150 Years to 150 Days                 *
.*        V9.10.02  21/07/2008 Jill Habasque  CAR 170152                      *
.*                  Mods to continue if invoice is fully credited (PTINCRST=1)*
.*        V9.10.01  30/04/2007  J.Tan         CAR 167215                      *
.*                  Mods to incl.Credit notes for checking outstanding balance*
.*        V9.08.02  23/02/2007  J.Tan         CAR 130462                      *
.*                  Mods to JH GST                                            *
.*        V9.08.01  09/02/2007  J.Tan         CAR 120001                      *
.*                  Mods for NZ Private billing                               *
.*        V9.07.02  12/09/2006  Jill Habasque CAR 109852                      *
.*                  Mods to output alternate ID if PTCNDAUR=1                 *
.*        V9.07.01  18/08/2007  J.Tan  CAR 103365                             *
.*                  Mods for Johns Hopkins discount                           *
.*        V9.05.01  10/03/2006  Mike Laming   CAR 79281                       *
.*                  Increase PATFACT1 to KEY19 & add FACODE to key string     *
.*        V9.04.06  14/10/05 J.Tan    CAR 77320                               *
.*                  Fixed setting as at date                                  *
.*        V9.04.05  03/08/05 J.Tan    CAR 62750                               *
.*                  Removed redefined amount variables                        *
.*                  02/09/2005  J.Tan             CAR 74612                   *
.*                  Added parameter to print billing comments                 *
.*        V9.04.04  29/07/2004 J.Tan  CAR 67940                               *
.*                  Fixed outstanding invoice amount with GST journals        *
.*        V9.04.03  14/09/2004 J.Tan  CAR 52687                               *
.*                  Mods to default health fund from master file              *
.*        V9.04.02  23/08/2004 J.Tan   CAR 52835                              *
.*                  Mods for multi hospital                                   *
.*        V9.04.01  13/08/2004 J.Tan   CAR 52603                              *
.*                  Mods checking for credit notes date                       *
.******************************************************************************
.*        V9.03.03  13/08/2003 Lina Vo      CAR 41196                         *
.*                  Recompiled for big change in PATSELFN.                    *
.*        V9.03.02  03/07/2003 Dean Cramer  CAR 38200                         *
.*                  Fix claim total and overall totals re overlap             *
.*        V9.03.01  04/06/2003 Dean Cramer  CAR 38200                         *
.*                  Fix where embedded spaces sometimes in date               *
.*                  Fix print overlaps for web                                *
.*                  Reformat amount lines to fit larger amounts               *
.*        V9.02.05  25/04/2003 Dean Cramer  CAR 38200                         *
.*                  Make totals print vertically rather than horizontally due *
.*                  to space considerations                                   *
.*        V9.02.04  04/04/2003 Dean Cramer  CAR 36515                         *
.*                  Tidy entry screens for web                                *
.*        V9.02.03  24/12/2002 J.Tan  SRF 34844                               *
.*                  Mods PRCM0000 to print 1st line of comment(latest)on full *
.*        V9.02.02  29/09/2001  J.Tan                                         *
.*                  Commented out validating aaedet file                      *
.*        V9.02.01  28/09/2001  Davin  SRF 12322                              *
.*                  Copied correct version from tran 508!                     *
.*        V5.08.08  01/06/2001  Caleb Sharman                                 *
.*                  Mods to use CNYRKYIN & CNYRPAT (dim 4's instead of form 2)*
.*                  within the PROC800                                       *
.*        V5.08.07  06/03/2001  Jill Habasque SRF 8634                        *
.*                  Added check for TRECTYPE=6                                *
.*        V5.08.06  06/03/2001  Jill Habasque SRF 8634                        *
.*                  Fixed F*I - health fund table length                      *
.*        V5.08.05  06/12/2000  Caleb Sharman                                 *
.*                  Mods to use keyin routines for claim and health funds     *
.*        V5.08.04  16/08/2000  Caleb Sharman                                 *
.*                  Changed Health Fund variables to be 8 chars               *
.*        V5.08.03  06/06/2000  Jill Habasque                                 *
.*                  Changed from key10 to key14 for the health fund file      *
.*        V5.08.02  01/05/2000  J.Tan                                         *
.*                  Fixed report for not using Aust.GST                       *
.*        V5.08.B04 14/04/2000  Jill Habasque                                 *
.*                  Fixed printing of Start & Finish                          *
.*        V5.08.B03 29/03/2000  Steve Downing                                 *
.*                  Fixed surname sequence for names longer than 6 letters    *
.*        V5.08.B02 18/02/2000  J.Tan                                         *
.*                  Mods to include GST                                       *
.*        V5.08.B01 24/01/2000  Steve Armstrong                               *
.*                  Fixed global recompile errors                             *
.******************************************************************************
.*        V5.07.04  12/11/1999  J.Tan                                         *
.*                  Mods to check outstanding for 30,60,90 breakup(WRTEF00)   *
.*        V5.07.03  23/07/1999  Steve Downing                                 *
.*                  Included century in invoice date calculations             *
.*        V5.07.02  13/07/1999  Greg Horvat                                   *
.*                  Replaced certain variables & with KEY variables           *
.*        V5.07.01  19/02/1999  Jim Stathopoulos                              *
.*                  Report Modifications                                      *
.*     V5.07.B02&3  22/01/1999  Nicole Harrington  507 rebound 115            *
.*                  Mods to print century on dates                            *
.*       V5.07.B01  10/11/1998  Jim Stathopoulos                              *
.*                  507 Changes                                               *
.******************************************************************************
.*        V5.04.01  15/04/97 J.Tan                                            *
.*                  Mods to set endnam                                        *
.*        V5.03.04  20/12/95 J.Tan         SRF 613189                         *
.*                  Fixed to print aae discharge date                         *
.*        V5.03.03  14/11/1995  Greg Horvat      Quote 8486 (Rebound)         *
.*                  Changed to print the admin comments at the end of each    *
.*                  admin when printing a report layout other than the full   *
.*                  report layout                                             *
.*        V5.03.02  03/10/95  MATT                          QUOTE 8486        *
.*                  Added option to print last line from patient comments     *
.*                  file after patient details.                               *
.*        V5.03.B1  06/06/95  Paul Howells                  SRF 136735        *
.*                  Recompiled for PATSELFN                                   *
.*                                                                            *
.* ************************************************************************** *
.*                                                                            *
.*                     V5.01.01 05/07/89  S. O'Gorman                         *
.*                              Converted for N.Z.                            *
.*                     V5.01.02 04.09.89 S.Barcham                            *
.*                              Fix Looping                                   *
.*                     V5.01.03 26/09/89 Graeme Williams                      *
.*                              Changed totals only option as per user group  *
.*                              specs  SRF 102283                             *
.*                     V5.01.04 09/10/89 J.Tan                                *
.*                              Fix Separate page for each                    *
.*                              H.F. Option    SRF 102523                     *
.*                     V5.01.05 20/11/89 J.Tan                                *
.*                              Add financial option in PATSELFN   SRF 102252 *
.*                     V5.01.06 05/04/90 D.Di.Paola                           *
.*                              Fixed keying of range if using surname seq    *
.*                              09/04/90 D.Di.Paola                           *
.*                              Default surname range from Start to Finish    *
.*                              SRF 104533                                    *
.*                              11/04/90 D.Di.Paola                           *
.*                              Default claim type range from Start to Finish *
.*                     V5.01.07 23/05/90 J.Tan  SRF 104901                    *
.*                              Mods PATFN1FD                                 *
.*                     V5.01.08 11/07/90 Paul Duncan                          *
.*                              recomp for OUTBOA & OUTBOB                    *
.*                    V5.01.121 22/10/90 J.Tan   SRF 105269                   *
.*                              Added range of health fund                    *
.*                    V5.01.122 27/11/90 Glen Hobby                           *
.*                              Recompiled for changes to PATMX1FD            *
.*                    V5.01.123 15/05/92 DIG    SRF 113970                    *
.*                              Changed the keyin of as at date to use KEYDATE*
.*                    V5.01.124 22/05/1992  Graeme Williams                   *
.*                              Make sure is invoice is balanced if PINVBLCD  *
.*                              is set (just in case it's wrong)   SRF 114421 *
.*        V5.01.125 12/06/92  Graeme Williams               SRF 114865        *
.*                  Changes for 9 character misc items                        *
.*        V5.01.126 05/09/94  ROD                           SRF 132017        *
.*                  Fix F*I - Assumes PTELEP 12 chars but new file = 20 chars *
.*                  NB: This prgm needs to be modified for New Master file    *
.*                                                                            *
.******************************************************************************
.
+
          INC           STD001FD
          INC           IBASECFD/INC
          INC           IBAPASFD/INC
          INC           IBACONFD/INC
          INC           IBASEQFD/INC                 * Sequential Numbers File
          INC           TFILEVAR/INC                 * Generate Temp File Name
          INC           WEBERRFD/INC                 * Web Server Error Logging
.
          INC           PATMI1FD/INC
          INC           PATMISTD/INC
          INC           VISMDTFD/INC
          INC           VISMTXFD/INC
          INC           PATCODFD/INC
          INC           PATMA1FD/INC

          INC           PATDSCFD/INC
.
          INC           OUTCANFD/INC
          INC           OUTSITFD/INC
          INC           OUTBOAFD/INC
          INC           OUTBB1FD/INC
          INC           AAEDE1FD/INC
          INC           AAEDEBFD/INC
          INC           AAEDI1FD/INC
.
          INC           PATHSPFD/INC
          INC           PATINVFD/INC
          INC           PATDTRFD/INC
          INC           OUTDTRFD/INC
          INC           AAEDTRFD/INC
.
          INC           PATREMFD/INC
          INC           PATFACFD/INC
          INC           PATFN1FD/INC
          INC           PATVISFD/INC
          INC           PMSVX1FD/INC
          INC           PMSCNOFD/INC
          INC           PATRASFD/INC
+
          INC           PATSELDT/INC
.
.                WORK AREA
.
SORTSTR   DIM       60
TEMPFILE  IFILE     SQL, FIXED=309, KEY=SORTSTR
SORT1     INIT      "U297-297,298-300,1-3,4-9,10-17,18-25,71-71,72-79"
SORT2     INIT      "U297-297,298-300,1-9,26-45,46-70,18-25,71-71,72-79"
SORT3     INIT      "U297-297,298-300,1-9,18-25,71-71,72-79"
.
.         Temporary file for detailed Aged Trial Balance
.
.Name     Type      Size   Physical  Start
.----     ----      ----   --------  -----
.ACLMCD   DIM        3        3        1
.HFUND    DIM        6        6        4
.XAURNO   DIM        8        8       10
.XAADMNO  DIM        8        8       18
.PSNAME   DIM        20       20      26
.PGNAME   DIM        25       25      46
.SORTDIM  DIM        1        1       71
.XUNIQUE  DIM        8        8       72
.PTITL    DIM        4        4       80
.PTELEP   DIM        12       12      84
.PINVAMT  FORM      12.2      8       96
.TINVNO   DIM        8        8      104
.XDAY     DIM        2        2      112
.XMON     DIM        2        2      114
.XYEAR    DIM        2        2      116
.XCENT    DIM        2        2      118
XTINVAMT  FORM      12.2      8      120
.AFUNDH   DIM        6        6      128
.AFNDTB   DIM        8        8      134
.AFNDMM   DIM        10       10     142
.PTELEB   DIM        12       12     152
.DDDAY    FORM       2        2      164
.DDMON    FORM       2        2      166
.DDYER    FORM       2        2      168
.DDCEN    FORM       2        2      170
CMNTLINE  DIM        70       70     172
.REMLSTL  DIM        3        3      242
.LSTLDAT  DIM        8        8      245
.SPINVTYP FORM       1        2      253
.SPINVSYS FORM       1        2      255
DAGED     DIM        5        5      257
TEMP35    DIM        35       35     262
PATFLAG   DIM        1        1      297    * x=patient debt, y=debt collector
DEBTAGEN  DIM        3        3      298
.XTOTPAID  FORM      12.2      8      301
.                             EOR    309
.
.          Temporary file for full Aged Trial Balance
.
.Name     Type      Size   Physical  Start
.----     ----      ----   --------  -----
.ACLMCD   DIM        3        3        1
.HFUND    DIM        6        6        4
.XAURNO   DIM        8        8       10
.XAADMNO  DIM        8        8       18
.PSNAME   DIM        20       20      26
.PGNAME   DIM        25       25      46
.SORTDIM  DIM        1        1       71
.XUNIQUE  DIM        8        8       72
.DDDAY    FORM       2        2       80
.DDMON    FORM       2        2       82
.DDYER    FORM       2        2       84
.DDCEN    FORM       2        2       86
XTOTPAID  FORM      12.2      8       88
XTOTCURR  FORM      12.2      8       96
XTOT30    FORM      12.2      8      104
XTOT60    FORM      12.2      8      112
XTOT90    FORM      12.2      8      120
XTOT120   FORM      12.2      8      128
XTOT1YR   FORM      12.2      8      136
XTOT2YR   FORM      12.2      8      144
.ATYPE    DIM        3        3      152
.ADDAY    FORM       2        2      155
.ADMON    FORM       2        2      157
.ADYER    FORM       2        2      159
.ADCEN    FORM       2        2      161
XTOTOUT   FORM      12.2      8      163
.PINVREB  FORM      12.2      8      171
PINVPAT   FORM      12.2      8      179
XTREBCUR  FORM      12.2      8      187
XTPATCUR  FORM      12.2      8      195
XTREB30   FORM      12.2      8      203
XTPAT30   FORM      12.2      8      211
XTREB60   FORM      12.2      8      219
XTPAT60   FORM      12.2      8      227
XTREB90   FORM      12.2      8      235
XTPAT90   FORM      12.2      8      243
XTREB120  FORM      12.2      8      251
XTPAT120  FORM      12.2      8      259
XTSUBREB  FORM      12.2      8      267
XTSUBPAT  FORM      12.2      8      275
.SHFUND   DIM          9      9      283
.SACLM    DIM          3      3      292
.DIM2     DIM          2      2      295
.PATFLAG  DIM          1      1      297
.DEBTAGEN DIM          3      3      298
.TINVNO   DIM          8      8      301
.                             EOR    309
.
ADDAY     FORM      2
ADMON     FORM      2
ADYER     FORM      2
ADCEN     FORM      2
ASATDAY   FORM      3
ASATYER   FORM      2
ASATCC    FORM      2
ASATDATE  DIM       4 
CURRDATE  DIM       4
.
BD        INIT      "B-"
.
CATBLAY   FORM      1
CFEETYP   FORM      1                   * used for PATFNDKY
CHOSTYP   FORM      1
CJRNREP   FORM      1
CLMFUND   DIM       9
CMDLINE   DIM       80
CNYRKYIN  DIM       4
CNYRPAT   DIM       4
CODE      DIM       2
CODECL    INIT      "CL"
COUNT     FORM      3
XCT30     FORM     12.2
XCT60     FORM     12.2
XCT90     FORM     12.2
XCT120    FORM     12.2
XCT1YR    FORM     12.2
XCT2YR    FORM     12.2
XCTCURR   FORM     12.2
XCTPAID   FORM     12.2
XCTTOT    FORM     12.2
.
.CT30      FORM      8.2
.CT60      FORM      8.2
.CT90      FORM      8.2
.CT120     FORM      8.2
.CT1YR     FORM      8.2
.CT2YR     FORM      8.2
.CTCURR    FORM      8.2
.CTPAID    FORM      8.2
.CTTOT     FORM      8.2
.
CURSYS    FORM      1
CURSITE   DIM       6
.
DCOMFLAG  DIM       1
D12PTELP  DIM       12
D12PTELB  DIM       12
DALERG    DIM       3 
DANS      DIM       3
DAYSINYR  FORM      5
DDDAY     FORM      2
DDMON     FORM      2
DDYER     FORM      2
DDCEN     FORM      2
DHOSP     DIM       3
DILLN     DIM       3
DIM2A     DIM       2
DIM3      DIM       3
DIM5      DIM       5
DIM6      DIM       6
DIM8      DIM       8
DIM9      DIM       9
DIM10     DIM       10
DIM11     DIM       11
DIM13     DIM       13
DIM14     DIM       14
DIM31     DIM       31
DIM37     DIM       37
DIM64     DIM       64
DINS      INIT      "(I)"
SDIM9     DIM       9
DSYST     DIM       30
DSYST0    INIT      "CONSOLIDATED REPORT           "
DSYST1    INIT      "ACCIDENT & EMERGENCY REPORT   "
DSYST2    INIT      "OUTPATIENTS REPORT            "
DSYST3    INIT      "INPATIENTS REPORT             "
DSYST4    INIT      "OTHER FINANCIAL REPORT        "
DOUTXTRA  DIM       30
DOUTALL   INIT      "ALL SITES                     "
DOUTSIT   INIT      "SITE : "
DOUTDEP   INIT      "DEPT : "
DEBTTYPE  FORM      1
.
EDCLM     DIM       3
EDHFN     DIM       6
ENDFLAG   FORM      1
ENDNAM    DIM       20
EXPORTFL  FORM      1                  * Create Export File
.
TTTOTCUR  FORM     12.2
TTTOT30   FORM     12.2
TTTOT60   FORM     12.2
TTTOT90   FORM     12.2
TTTOT120  FORM     12.2
TTTOT1YR  FORM     12.2
TTTOT2YR  FORM     12.2
TTTOTOUT  FORM     12.2
.
F12P2     FORM     12.2
FORM9P2   FORM      9.2
FTOTCURR  FORM      8.2
FTOT30    FORM      8.2
FTOT60    FORM      8.2
FTOT90    FORM      8.2
FTOT120   FORM      8.2
FTOT1YR   FORM      8.2
FTOT2YR   FORM      8.2
FTOTOUT   FORM      9.2
.
DTOTCURR  FORM      8.2
DTOT30    FORM      8.2
DTOT60    FORM      8.2
DTOT90    FORM      8.2
DTOT120   FORM      8.2
DTOT1YR   FORM      8.2
DTOT2YR   FORM      8.2
DTOTOUT   FORM      9.2
.
FIVE9     FORM      "59"
FIRST     FORM      1
FNAMET    DIM       8
FORM5DAY  FORM      5
DIM8A     DIM       8
FORM8P2  FORM 8.2
FORM12P2  FORM      12.2
FROMDATE  DIM       8        * FROM DATE IN (CCYYMMDD) FORMAT
FRCLM     DIM       6        * From Claim Code output
FRHFN     DIM       6        * From Health Fund output
FINISH    INIT      "Finish"
.
HD        INIT      "H-"
ACLMCD    DIM       3
HFUND     DIM       6
XHT30     FORM     12.2
XHT60     FORM     12.2
XHT90     FORM     12.2
XHT120    FORM     12.2
XHT1YR    FORM     12.2
XHT2YR    FORM     12.2
XHTCURR   FORM     12.2
XHTPAID   FORM     12.2
XHTTOT    FORM     12.2
.
.HT30      FORM      8.2
.HT60      FORM      8.2
.HT90      FORM      8.2
.HT120     FORM      8.2
.HT1YR     FORM      8.2
.HT2YR     FORM      8.2
.HTCURR    FORM      8.2
.HTPAID    FORM      8.2
.HTTOT     FORM      8.2
.
LSTLDAT   DIM       8
.
OPCND     FORM      1
OPTION1   FORM      1
.
PDIM8     DIM       8
PDIM10    DIM       10
PNAME     DIM       22         * PGNAME.PSNAME
PGNAMEDS  DIM       12         * PGNAME SHORTENED
PGNAMED2  DIM       21         * PGNAME SHORTENED
PNAMEDIS  DIM       18         * PNAME SHORTENED
PNAMEDS2  DIM       20         * PNAME SHORTENED
PSNAMEDS  DIM       17         * PSNAME SHORTENED
PRTADCOM  FORM      1          * PRINT COMMENTS FLAG
PAGFUND   FORM      1
PTCNCATB  FORM      1
PTCNDAUR  DIM       1
PPORTION  FORM      12.2
.
PATCURR   FORM      12.2
PAT30     FORM      12.2
PAT60     FORM      12.2
PAT90     FORM      12.2
PAT120    FORM      12.2
PAT1YR    FORM      12.2
PAT2YR    FORM      12.2
PASSFLAG  FORM      1
PDBONLY   FORM      1
.
SHFUND    DIM       9
D6FUND    DIM       6
SACLM     DIM       3
SAVADMNO  DIM       8
SAVCLAIM  DIM       3
SAVCLM    DIM       3
SAVFUND   DIM       9          * Contains ACLAIM,HFUND
SEPCLM    FORM      1
SEPFUND   FORM      1
SORTDIM   DIM       1
SP12      INIT      "            "
STARTNM   DIM       20
STATUS    FORM      1
STCLM     DIM       3
STHFN     DIM       6
START     INIT      "Start "
SAVAGEN   DIM       3
.
.
TDATE     DIM       8        * ACTUAL TRANSLATED DATE (CCYYMMDD)
TDAY      FORM      3
TINVAMT   FORM      8.2
TINVNO    DIM       8
TMPPAID   FORM      12.2
TOCLM     DIM       6        * To Claim code output
TOHFN     DIM       6        * To Health Fund output
TODATE    DIM       8        * TO DATE IN (CCYYMMDD) FORMAT
.TOT30     FORM      7.2
.TOT60     FORM      7.2
.TOT90     FORM      7.2
.TOT120    FORM      7.2
.TOT1YR    FORM      7.2
.TOT2YR    FORM      7.2
.TOTCURR   FORM      7.2
TOTDAYS   FORM      12.2
TOTONLY   FORM      1
.TOTOUT    FORM      7.2
.TOTPAID   FORM      7.2
.
XTTOT30   FORM     12.2
XTTOT60   FORM     12.2
XTTOT90   FORM     12.2
XTTOT120  FORM     12.2
XTTOT1YR  FORM     12.2
XTTOT2YR  FORM     12.2
XTTOTCUR  FORM     12.2
XTTOTOUT  FORM     12.2
XTTOTPAY  FORM     12.2
.
.TTOT30    FORM      8.2
.TTOT60    FORM      8.2
.TTOT90    FORM      8.2
.TTOT120   FORM      8.2
.TTOT1YR   FORM      8.2
.TTOT2YR   FORM      8.2
.TTOTCURR  FORM      8.2
.TTOTOUT   FORM      8.2
.TTOTPAID  FORM      8.2
TYR       FORM      2
.
.    Melbourne clinic
.
PATPAID   FORM      12.2
HFPAID    FORM      12.2
.TREBCUR   FORM      7.2
.TPATCUR   FORM      7.2
.TREB30    FORM      7.2
.TPAT30    FORM      7.2
.TREB60    FORM      7.2
.TPAT60    FORM      7.2
.TREB90    FORM      7.2
.TPAT90    FORM      7.2
.TREB120   FORM      7.2
.TPAT120   FORM      7.2
.TSUBREB   FORM      7.2
.TSUBPAT   FORM      7.2
.
XCREBCUR  FORM     12.2
XCPATCUR  FORM     12.2
XCREB30   FORM     12.2
XCPAT30   FORM     12.2
XCREB60   FORM     12.2
XCPAT60   FORM     12.2
XCREB90   FORM     12.2
XCPAT90   FORM     12.2
XCREB120  FORM     12.2
XCPAT120  FORM     12.2
XCSUBREB  FORM     12.2
XCSUBPAT  FORM     12.2
.
.CREBCUR   FORM      7.2
.CPATCUR   FORM      7.2
.CREB30    FORM      7.2
.CPAT30    FORM      7.2
.CREB60    FORM      7.2
.CPAT60    FORM      7.2
.CREB90    FORM      7.2
.CPAT90    FORM      7.2
.CREB120   FORM      7.2
.CPAT120   FORM      7.2
.CSUBREB   FORM      7.2
.CSUBPAT   FORM      7.2
.COTHSFN   FORM      1
.
XHREBCUR  FORM     12.2
XHPATCUR  FORM     12.2
XHREB30   FORM     12.2
XHPAT30   FORM     12.2
XHREB60   FORM     12.2
XHPAT60   FORM     12.2
XHREB90   FORM     12.2
XHPAT90   FORM     12.2
XHREB120  FORM     12.2
XHPAT120  FORM     12.2
XHSUBREB  FORM     12.2
XHSUBPAT  FORM     12.2
.
.HREBCUR   FORM      7.2
.HPATCUR   FORM      7.2
.HREB30    FORM      7.2
.HPAT30    FORM      7.2
.HREB60    FORM      7.2
.HPAT60    FORM      7.2
.HREB90    FORM      7.2
.HPAT90    FORM      7.2
.HREB120   FORM      7.2
.HPAT120   FORM      7.2
.HSUBREB   FORM      7.2
.HSUBPAT   FORM      7.2
.
XTTREBCR  FORM     12.2
XTTPATCR  FORM     12.2
XTTREB30  FORM     12.2
XTTPAT30  FORM     12.2
XTTREB60  FORM     12.2
XTTPAT60  FORM     12.2
XTTREB90  FORM     12.2
XTTPAT90  FORM     12.2
XTTRE120  FORM     12.2
XTTPA120  FORM     12.2
XTTSUBRE  FORM     12.2
XTTSUBPA  FORM     12.2
.
.TTREBCUR  FORM      7.2
.TTPATCUR  FORM      7.2
.TTREB30   FORM      7.2
.TTPAT30   FORM      7.2
.TTREB60   FORM      7.2
.TTPAT60   FORM      7.2
.TTREB90   FORM      7.2
.TTPAT90   FORM      7.2
.TTREB120  FORM      7.2
.TTPAT120  FORM      7.2
.TTSUBREB  FORM      7.2
.TTSUBPAT  FORM      7.2
.
UNIQUE    FORM      8
.
XDAY1     DIM       2
XDAY2     DIM       2
XMON1     DIM       2
XMON2     DIM       2
XYEAR1    DIM       2
XYEAR2    DIM       2
XCENT1    DIM       2
XCENT2    DIM       2
XUNIQUE   DIM       8
XAURNO    DIM       8
XAADMNO   DIM       8
.
ZERO00    FORM      "0.00"
NINETY1   FORM      "91"
ONE21     FORM      "121"
ONE51     FORM      "151"
ONE81     FORM      "181"
THREE65   FORM      "365"
THREE66   FORM      "366"
SEVEN31   FORM      "731"
Z30       INIT      "zzzzzzzzzzzzzzzzzzzzzzzzzzzzzz"
.
.-----------------------------------------------------------------------
PRGID     INIT      "IBABIL23"
PRGNAM    INIT      "Aged Trial Balance"
VERSION   INIT      "V12.01.01"
.-----------------------------------------------------------------------
+
.         START OF PROGRAM
.
          CALL          DISPHEAD
.
          DISPLAY       *P56:24,"Opening patmi1af";
          OPEN      PATMI1A1,"patmi1af"
.
          DISPLAY       *P64:24,"patma1af";
          OPEN      PATMA1A1,"patma1af"
.
          DISPLAY       *P64:24,"patmx1af";
          OPEN      PATMX1A1,"patmx1af"
.
          DISPLAY       *P64:24,"patinvrf";
          OPEN          PATINVR4,"patinvrf"
.
          DISPLAY       *P64:24,"patdschf";
          OPEN          PATDSCH1,"patdschf"
.
          DISPLAY       *P64:24,"patdtraf";
          OPEN          PATDTRA1,"patdtraf"
.
          DISPLAY       *P64:24,"aaedtref";
          OPEN          AAEDTRE1,"aaedtref"
.
          DISPLAY       *P64:24,"outsitaf";
          OPEN          OUTSITA1,"outsitaf"
.
          DISPLAY       *P64:24,"aaede1af";
          OPEN      AAEDE1A1,"aaede1af"
.
          DISPLAY       *P64:24,"aaedi1af";
          OPEN      AAEDI1A1,"aaedi1af"
.
          DISPLAY       *P64:24,"vismdtaf";
          OPEN          VISMDTA1,"vismdtaf"
          DISPLAY       *P64:24,"vismtxaf";
          OPEN          VISMTXA1,"vismtxaf"
.
          DISPLAY       *P64:24,"patremdf";
          OPEN          PATREMD1,"patremdf"
.
          DISPLAY       *P64:24,"patcodes";
          OPEN          PATCODE1,"patcodes"
.
          DISPLAY       *P64:24,"pmsvx1af";
          OPEN          PMSVX1A1,"pmsvx1af"
.
          DISPLAY       *P64:24,"patfactf";
          OPEN          PATFACT1,"patfactf"
.
          DISPLAY       *P64:24,"patfn1af";
          OPEN          PATFN1A1,"patfn1af"
.
          DISPLAY       *P64:24,"patvisaf";
          OPEN          PATVISA1,"patvisaf"
.
          DISPLAY       *P64:24,"pmscnoaf";
          OPEN          PMSCNOA3,"pmscnoaf"
.
          DISPLAY       *P64:24,"patrasaf";
          OPEN          PATRASA1,"patrasaf"
.
          DISPLAY       *P64:24,"controlf";
          OPEN          CONTROLF,"controlf"
.
          READ          CONTROLF,ZERO;*43,IBCNMHOS,*85,IBCNUGST
          READ          CONTROLF,TEN3;*185,CATBLAY:
                                          *245,CHOSTYP
          READ          CONTROLF,TEN8;*255,CJRNREP
          READ          CONTROLF,TEN9;*212,CFEETYP
          READ          CONTROLF,HUND09;*243,PTCNCATB
.
          CALL      TFILENAM                     * Generate temporary file name
          MOVE      TFILNAME,FNAMET
+
.
.        START OF PROGRAM
.
        CALL      KATB0000            * Keyin ATB Layout
.
START   MOVE      ZERO,CPAGENO
        MOVE      SIXTY TO CLNO
        MOVE      SP20 TO STARTNM
        MOVE      "zzzzzzzzzzzzzzzzzzzz" TO ENDNAM
        MOVE      SP6,FRCLM
        MOVE      SP6,TOCLM
        MOVE      SP6,FRHFN
        MOVE      SP6,TOHFN
        MOVE      ZERO,PDBONLY
.
        HLINE     *G37,2,49,80
        DISPLAY   *P1:5,*EF:
                  *P1:6,*V2LON,ZERO,*HOFF," = Exit":
                  *P1:7,*V2LON,ONE,*HOFF," = U/R Number Sequence":
                  *P1:8,*V2LON,TWO,*HOFF," = Patient Surname Sequence":
                  *P1:9,*V2LON,THREE,*HOFF," = Admission Number Sequence"
.
KEYSEQ  KEYIN     *P1:11,"Option : ",*EL,*V2LON,OPTION
.
        COMPARE   ZERO TO OPTION
        GOTO      ENDIT IF EQUAL
.
REPEAT  BRANCH    OPTION OF URSEQU,SURNAM,ADMSEQ
        BEEP
        GOTO      KEYSEQ
.
URSEQU  DISPLAY   *P49:2,*V2LON,"- U/R Sequence ",*P1:3,*EF
        MOVE      SORT1,SORTSTR
        GOTO      KEYCLM
.
ADMSEQ  DISPLAY   *P49:2,*V2LON,"- Admission Sequence ",*P1:3,*EF
        MOVE      SORT3,SORTSTR
        GOTO      KEYCLM
.
SURNAM  DISPLAY   *P49:2,*V2LON,"- Surname Sequence ",*P1:3,*EF
        MOVE      SORT2,SORTSTR
.
        MATCH     "IBARSH",PGM
        GOTO      KEYCLM IF EQUAL
.
        MOVE      SP20 TO STARTNM
        KEYIN     *P1:4,"Surname From : ":
                  *P1:5,*EL,"Surname To   : ",*P16:4,*V2LON,STARTNM
        RESET     STARTNM
        GOTO      KEYENDN IF NOT EOS
.
        MATCH    SP20,STARTNM
        GOTO     KEYENDN IF NOT EQUAL
.
        MOVE     SP20,STARTNM
        DISPLAY  *P16:4,*V2LON,"START ";
.
KEYENDN MOVE     SP20,ENDNAM
        KEYIN    *P16:5,*V2LON,ENDNAM;
        RESET    ENDNAM
        GOTO     CORRECT IF NOT EOS
.
        MATCH    SP20,ENDNAM
        GOTO     CORRECT IF NOT EQUAL
.
        MOVE     "zzzzzzzzzzzzzzzzzzzz" TO ENDNAM
        DISPLAY  *P16:5,*V2LON,"FINISH"; 
.
CORRECT
        RESET    STARTNM TO 20
        RESET    STARTNM
        RESET    ENDNAM TO 20
        RESET    ENDNAM
.
        MATCH    ENDNAM TO STARTNM
        GOTO     OK IF EQUAL
        GOTO     OK IF LESS
.
        DISPLAY  *P1:24,*EL,*B,*V2LON,"*** START MUST BE LESS THAN END ***":
                 *W2;
        GOTO     SURNAM
.
OK      KEYIN    *P1:7,*EL,"OK (",*V2LON,"Y",*HOFF,"/",*V2LON,"N":
                 *HOFF,") ? ",*V2LON,ANS
        RESET    ANS
        CMATCH   "Y" TO ANS
        GOTO     START IF NOT EQUAL
.
KEYCLM  MOVE     SP3,STCLM
        DISPLAY  *P1:9,*EL,*P1:8,*EL:
                 *P1:7,*EL,"Starting Claim Type  : "
.
        MOVE     SEVEN,EVERT
        MOVE     TWENTY4,ECOL 
        MOVE     ZERO,CKYIMAND
        MOVE     "CL",CODE
        CALL     PATCODKY
.
        MOVE     ACODE,STCLM
.
        MATCH    SP3,STCLM
        GOTO     KEYCLM1 IF NOT EQUAL
.
        MOVE     START,FRCLM              * Save for printout
        DISPLAY  *P24:7,*V2LON,START;
        GOTO     KEYCLM2
.
KEYCLM1 MOVE     STCLM,FRCLM
        DISPLAY  *P24:7,*V2LON,STCLM
.
KEYCLM2 MOVE     SP3,EDCLM
        DISPLAY  *P41:7,*EL,"Ending Claim Type    : "
.
        MOVE     SEVEN,EVERT
        MOVE     SIXTY4,ECOL 
        MOVE     "CL",CODE
        CALL     PATCODKY
.
        MOVE     ACODE,EDCLM
.
        MATCH    SP3,EDCLM
        GOTO     ECHK1 IF NOT EQUAL
.
        MOVE     "zzz",EDCLM
        MOVE     FINISH,TOCLM         * Save for printout
        DISPLAY  *P64:7,*V2LON,FINISH;
        GOTO     ECHK2
.
ECHK1   MOVE     EDCLM,TOCLM
        DISPLAY  *P64:7,*V2LON,EDCLM
.
ECHK2   MATCH    STCLM,EDCLM
        GOTO     KEYHFN IF NOT LESS
.
        DISPLAY  *P40:8,*EL,*B,*V2LON:
                 "** Ending Claim < Starting Claim **",*W2
        GOTO     KEYCLM
.
.       Keyin range of health fund
.
KEYHFN  MOVE     SP3,STHFN
        DISPLAY  *P1:8,*EF,"Starting Health Fund : ";
.
        MOVE     EIGHT,EVERT
        MOVE     TWENTY4,ECOL
        MOVE     ZERO,CKYIMAND
        CALL     PATFNDKY
.
        MOVE     HCODE,STHFN
        MATCH    SP6,STHFN
        GOTO     KEYHFN1 IF NOT EQUAL
.
        MOVE     START,FRHFN           * Save for printout
        DISPLAY  *P24:8,*V2LON,START;
        GOTO     KEYHFN2
.
KEYHFN1 MOVE     STHFN,FRHFN
        DISPLAY  *P24:8,*V2LON,STHFN;
.
KEYHFN2 MOVE     SP3,EDHFN
        DISPLAY  *P41:8,*EL,"Ending Health Fund   : ";
.
        MOVE     EIGHT,EVERT
        MOVE     SIXTY4,ECOL
        MOVE     ZERO,CKYIMAND
        CALL     PATFNDKY
.
        MOVE     HCODE,EDHFN
        MATCH    SP6,EDHFN
        GOTO     KEYHFN3 IF NOT EQUAL
.
        MOVE     "zzz",EDHFN
        MOVE     FINISH,TOHFN                 * save for printout
        DISPLAY  *P64:8,*V2LON,FINISH;
        GOTO     KEYHFN4
.
KEYHFN3 MOVE     EDHFN,TOHFN                  * save for printout
        DISPLAY  *P64:8,*V2LON,EDHFN
.
KEYHFN4 MATCH    STHFN,EDHFN
        GOTO     KEYCEXP IF NOT LESS
.
        DISPLAY  *P1:10,*EL,*B,*V2LON:
                 "** Ending Health Fund must be greater":
                 " than or equal to Starting Health Fund **",*W2,*P1:10,*EL
        GOTO     KEYHFN
.
KEYCEXP IF       CATBLAY=6
          MOVE     ZERO,PRTADCOM         * no admission comment
          MOVE     ONE,EXPORTFL          * SVMPH ATB layout - Export Only 
          GOTO     KEYCEX1
        ENDIF
.
        COMPARE  FIVE,CATBLAY
        GOTO     KEYALL IF NOT EQUAL    * Not Healthscope
        MOVE     ZERO,PRTADCOM          * no admission comment
.
        CALL     CRTX0000               * Create Export File for Excel
        COMPARE  ONE,EXPORTFL
        GOTO     KEYALL IF NOT EQUAL    * No export file
.
KEYCEX1 MOVE     TWO,SEPCLM             * separate page for each claim
        MOVE     TWO,SEPFUND            * breakup for each health fund
        MOVE     TWO,PAGFUND            * separate page for each health fund
.
        BRANCH   EXPORTFL,KADATE
.
.       Ask if each claim type is to be on a separate page
.
KEYALL  KEYIN    *P1:10,*EL,"Do you want each claim code on a separate page (":
                 *V2LON,"Y",*HOFF,"/",*V2LON,"N",*HOFF,") ? ",*V2LON,ANS
.  
        REP      UPPLOW,ANS
        CMATCH   "Y",ANS
        GOTO     SEPCLMY IF EQUAL
.
        CMATCH   "N",ANS
        GOTO     SEPCLMN IF EQUAL
.
        BEEP
        GOTO     KEYALL
.
SEPCLMY MOVE     ONE,SEPCLM
        GOTO     KEYFND
.
SEPCLMN MOVE     TWO,SEPCLM
.
.       Check if a break-up of Health Funds is wanted
.
KEYFND  KEYIN    *P1:11,*EL,"Do you want a break-up of Health Funds (":
                 *V2LON,"Y",*HOFF,"/",*V2LON,"N",*HOFF,") ? ",*V2LON,ANS
.
        REP      UPPLOW,ANS
        CMATCH   "Y",ANS
        GOTO     SEPFNDY IF EQUAL
.
        CMATCH   "N",ANS
        GOTO     SEPFNDN IF EQUAL
.
        bEEP
        GOTO     KEYFND
.
SEPFNDY MOVE     ONE,SEPFUND
        GOTO     KEYPAGE
.
SEPFNDN MOVE     TWO,SEPFUND
.
.       A separate page for a new health fund
.
KEYPAGE   KEYIN     *P1:12,*EL,"Do you want a new page for each Health Funds (":
                    *V2LON,"Y",*HOFF,"/",*V2LON,"N",*HOFF,") ? ",*V2LON,ANS
.
          REP      UPPLOW,ANS
          CMATCH    "Y",ANS
          GOTO      NPAGEY IF EQUAL
.
          CMATCH    "N",ANS
          GOTO      NPAGEN IF EQUAL
          BEEP
          GOTO      KEYPAGE
.
NPAGEY    MOVE      ONE,PAGFUND
          BRANCH    CATBLAY,KEYCOMM,KEYCOMM,KEYCOMM,KEYCOMM,KADATE,KADATE
          GOTO      KEYCOMM
.
NPAGEN    MOVE      TWO,PAGFUND
          BRANCH    CATBLAY,KEYCOMM,KEYCOMM,KEYCOMM,KEYCOMM,KADATE,KADATE
.
KEYCOMM   KEYIN     *P1:13,*EL,"Do you want to print admission comments (":
                    *V2LON,"Y",*HOFF,"/",*V2LON,"N",*HOFF,") ? ",*V2LON,ANS
.
          MOVE     ZERO,PRTADCOM
          REP      UPPLOW,ANS
          CMATCH   ANSY,ANS
          GOTO     COMMY IF EQUAL
.
          CMATCH   ANSN,ANS
          GOTO     KADATE IF EQUAL
          BEEP
          GOTO     KEYCOMM
.
COMMY     MOVE     ONE,PRTADCOM
.
KADATE    DISPLAY   *P1:4,*EF,*P1:11,"Keyin As At Date : ";
.
          MOVE      ZERO,CHIGHLT
          MOVE      ZERO,CDEFDTE
          MOVE      TEN1,CVERT
          MOVE      TWENTY,CCOL
          UNPACK    SP6,CYEAR,CMON,CDAY
          MOVE      CCC,CCENT
          CALL      KEYDATE
          BRANCH    OVRCD,START
.
          PACK      FROMDATE,CCENT,CYEAR,CMON,CDAY
          REP       " 0",FROMDATE
.
          MOVE      ICENT,CC
          MOVE      IYEAR,YY
          MOVE      IMON,MM
          MOVE      IDAY,DD
.
CHKTOTS KEYIN      *P1:13,*EL,"Totals Only to be Printed (":
                   *V2LON,"Y",*HOFF,*DV,SLASH:
                   *V2LON,"N",*HOFF,") ? ",*V2LON,ANS;
        REP        UPPLOW,ANS
.
        CMATCH     "N",ANS
        GOTO       CHKTOTN IF EQUAL
.
        CMATCH     "Y",ANS
        GOTO       CHKTOTY IF EQUAL
        BEEP
        GOTO       CHKTOTS
.
CHKTOTN MOVE       ZERO,TOTONLY
        GOTO       KEYHOSP
.
CHKTOTY MOVE       ONE,TOTONLY
.
KEYHOSP COMPARE    ONE,IBCNMHOS
        GOTO       KEYOPT IF NOT EQUAL
.
        DISPLAY    *P1:15,*EL,"Hospital Id : ";
        MOVE       TEN5,ECOL
        MOVE       "15",EVERT
        MOVE       SP3,CKYIDEF3
        MOVE       ZERO,CKYIMAND           * Not Mandatory
        OPEN       PATHSPA1,"pathspaf"
.
        CALL       PATHSPKY
        BRANCH     EXIT,ALLHOSP,START
        GOTO       KEYOPT  
.
ALLHOSP MOVE       "All Hospitals",PTHSNAME
        MOVE       SP10,PTHSHOSP
.
KEYOPT  DISPLAY   *P1:17,*EF:
                  *P1:17,*V2LON,ZERO,*HOFF," = Exit":
                  *P1:18,*V2LON,ONE,*HOFF," = Full Report":
                  *P1:19,*V2LON,TWO,*HOFF," = Current Only":
                  *P1:20,*V2LON,THREE,*HOFF," = 30 Days Only":
		  *P1:21,*V2LON,FOUR,*HOFF," = 60 Days Only":
                  *P1:22,*V2LON,FIVE,*HOFF," = Over 90 Days"
.
KEYOPT1 KEYIN     *P1:24,"Option : ",*EL,*V2LON,OPTION1
.
        COMPARE   ZERO TO OPTION1
        GOTO      START IF EQUAL
.
REPEAT1 BRANCH    OPTION1 TO OPTFULL,OPTCUR,OPT30,OPT60,OPT90  
        BEEP
        GOTO      KEYOPT
.
OPTFULL DISPLAY   *P64:2,*V2LON,"- Full Report ",*HOFF
        GOTO      KPATSEL
.
OPTCUR  DISPLAY   *P64:2,*V2LON,"- Current ",*HOFF
        MOVE      "CURRENT  " TO SDIM9
        GOTO      KPATSEL
.
OPT30   DISPLAY   *P64:2,*V2LON,"- 30 Days ",*HOFF
        MOVE      "30 DAYS  " TO SDIM9
        GOTO      KPATSEL
.
OPT60   DISPLAY   *P64:2,*V2LON,"- 60 Days ",*HOFF
        MOVE      "60 DAYS  " TO SDIM9
        GOTO      KPATSEL
.
OPT90   DISPLAY   *P64:2,*V2LON,"- 90+ Days ",*HOFF
        MOVE      "90+ DAYS " TO SDIM9
        GOTO      KPATSEL
.
.       Subroutine to get the starting claim code
.
GETSCLM PACK     KEY5 WITH CODECL,STCLM
        CALL     RDCODE1
        COMPARE  ZERO,OVRCD
        RETURN   IF EQUAL
.
        CALL     RDSCODE1
        CALL     RDKCODE1
        RETURN
+
.*******************************************************************************
.       Get the financial options
.*******************************************************************************
KPATSEL CALL     PATSELFN
        BRANCH   EXIT,START
.
        MOVE     ZERO,PASSFLAG
        MOVE     ZERO,F1
        IF       FSTSYS=1 | FSTSYS=2 | FSTSYS=3
          MOVE     ONE,F1
        ENDIF
.
.       Check for Healthscope and SVHM Layout
.
        IF       CATBLAY=5 | CATBLAY=6
          IF       F1=1
            CALL      PATDEB00          * Healthscope ATB - Patient Debt Only?
          ENDIF
        ENDIF
.
        IF        CATBLAY=6
          MOVE      ONE,EXPORTFL        * SVMPH ATB layout - Export Only 
          CALL      KCOM0000            * Keyin type of comments
        ENDIF
.
.       Set up heading variables
.
        MOVE     DSYST0,DSYST
        LOAD     DSYST,FSTSYS,DSYST1,DSYST2,DSYST3,DSYST4
.
        MOVE     SP30,DOUTXTRA
.
        COMPARE  TWO,FSTSYS
        GOTO     REKEY IF NOT EQUAL
.
        MATCH    SP6,FSTSITE
        GOTO     SINGSITE IF NOT EQUAL
.
        MATCH    SP3,FSTDEPT
        GOTO     SINGDEPT IF NOT EQUAL
.
        MOVE     DOUTALL,DOUTXTRA
        GOTO     REKEY 
.
SINGSITE PACK     DOUTXTRA,DOUTSIT,FSTSITE,SP2,OSTDESC   * Desc already read in
        GOTO     REKEY 
.
SINGDEPT PACK     DOUTXTRA,DOUTDEP,FSTDEPT,SP2,TDESC     * Desc already read in
.
REKEY   CALL      PDCM0000                               * Prepend dates on Comm
        BRANCH    EXIT,START
.
        KEYIN           *P1:24,*EF,"Ok to continue (":
                        *V2LON,"Y",*HOFF,*DV,SLASH:
                        *V2LON,"N",*HOFF,") ? ",*V2LON,ANS;
        REP             UPPLOW,ANS
.
        MATCH           "N" TO ANS
        GOTO            START IF EQUAL
.
        MATCH           "Y" TO ANS
        GOTO            CHKCNT IF EQUAL
.
        BEEP
        GOTO            REKEY
.
CHKCNT  CALL            PROC000
        CALL            PRTD000
.
CONT99  GOTO            START
.
.*******************************************************************************
.       Keyin option to Prepend dates to comments textareas
.*******************************************************************************
PDCM0000  MOVE      ZERO,EXIT
          MOVE      "N",DCOMFLAG
          DISPLAY   *P1:23,*EL,"Prepend Date on Comment :";
          KEYIN     *P25:23,*V2LON,*RV,DCOMFLAG;
          REP       "yYnN",DCOMFLAG
          MATCH     "Y",DCOMFLAG
          GOTO      PDCM9999 IF EQUAL
          MATCH     "N",DCOMFLAG
          GOTO      PDCM9999 IF EQUAL
          MOVE      ONE,EXIT
PDCM9999  RETURN
+
.*******************************************************************************
PROC000 PACK            FROMDATE,CCENT,CYEAR,CMON,CDAY
        REP             " 0",FROMDATE
        MOVE            ICENT,CC
        MOVE            IYEAR,YY
        MOVE            IMON,MM
        MOVE            IDAY,DD
        CALL            DMYCON
.
        MOVE            JULDAY TO ASATDAY
        MOVE            JULYR TO ASATYER
        MOVE            JULCC, ASATCC
        PACK            ASATDATE,ASATCC,ASATYER
        REP             " 0",ASATDATE
.
        CALL            CRTP0000          * Create Tempfile
.
        MOVE            ZEROVISN TO SAVADMNO
        MOVE            SP70,SAVCLAIM
        MOVE            ZERO TO XTOTPAID
        MOVE            ZERO TO XTOTCURR
        MOVE            ZERO TO XTOT30
        MOVE            ZERO TO XTOT60
        MOVE            ZERO TO XTOT90
        MOVE            ZERO TO XTOT120
        MOVE            ZERO TO XTOT1YR
        MOVE            ZERO TO XTOT2YR
        MOVE            ZERO TO UNIQUE
        MOVE            SP10 TO XUNIQUE
        MOVE            SP10 TO XAADMNO
        MOVE            SP10 TO XAURNO
.
        MOVE            ZERO TO HFPAID
        MOVE            ZERO TO PATPAID
        MOVE            ZERO TO XTREBCUR
        MOVE            ZERO TO XTPATCUR
        MOVE            ZERO TO XTREB30
        MOVE            ZERO TO XTPAT30
        MOVE            ZERO TO XTREB60
        MOVE            ZERO TO XTPAT60
        MOVE            ZERO TO XTREB90
        MOVE            ZERO TO XTPAT90
        MOVE            ZERO TO XTREB120
        MOVE            ZERO TO XTPAT120
        MOVE            ZERO TO XTSUBREB
        MOVE            ZERO TO XTSUBPAT
        UNPACK          SP70,DAGED,TEMP35
        MOVE            ZERO,PPORTION
        MOVE            SP70,DEBTTYPE
        MOVE            SP70,DEBTAGEN
        MOVE            SP70,TINVNO
        UNPACK          SP70,SAVCLM,SAVFUND
.
        CLOCK           TIME,CTIMEIS
        IF              EXPORTFL=1
          CALL            EHED0000               * Print the heading
          MOVE            ZERO,CLNO
        ENDIF
.
.       Initialise the key variables for the loop over the invoice file
.
        MOVE            FSTSYS,CURSYS
        MOVE            FSTSITE,CURSITE
.
.       Read in first claim details
.
         CALL            GETSCLM
.
         DISPLAY     *P1:24,*EL,*P5:24,"Claim : ",*P20:24,"Surname : ":
                                *P50:24,"Admission Number :";
.
.        Initialise the key for the fourth index of the invoice file
.
PROC020  MOVE        STARTNM,DIM6
         PACK        KEY32,CURSYS,CURSITE,ACODE,DIM6,SP30
         CALL        RDSINV4
PROC080  CALL        RDKINV4
         BRANCH      OVRCD TO PROC999
.
.        Ignore cancelled invoices
.
         MATCH       ZEROVISN,PINVADM
         GOTO        PROC080 IF EQUAL        * Cancelled Invoice
.
.        Display invoice details
.
         DISPLAY     *P13:24,*V2LON,PINVCLM:
                     *P31:24,PINALPHA,*P70:24,PINVADM
.
.        Check for a change in system
.
         COMPARE     PINVSYS,CURSYS
         GOTO        PROC120 IF EQUAL
.
.        Go to the next system
.
PROC100  ADD         ONE,CURSYS
.
.        New system. Check if we are outside the request range                 
.
         COMPARE     CURSYS,FEDSYS
         GOTO        PROC999 IF LESS
.
.        Initialise for reposition
.
         MOVE        FSTSITE,CURSITE
         CALL        GETSCLM
         GOTO        PROC020
.
.        Same system, check for a change in site
.
PROC120  MATCH       PINVSITE,CURSITE
         GOTO        PROC180 IF EQUAL
.
.        Go to the next site code
.
PROC140 MOVE        CURSITE,KEY6
         CALL        RDSSITA1
PROC160 CALL        RDKSITA1
         BRANCH      OVRCD,PROC100
.
.        New site. Check if we are outside the request range
.
         MATCH       OSTSITE,FEDSITE
         GOTO        PROC100 IF LESS
.
.        Check for a valid department
.
         MATCH       FSTDEPT,OSTSYST
         GOTO        PROC160 IF LESS
.
         MATCH       OSTSYST,FEDDEPT
         GOTO        PROC160 IF LESS
.
.        Initialise for reposition
.
         MOVE        OSTSITE,CURSITE
         CALL        GETSCLM
         GOTO        PROC020
.
.        Same system/site. Check for a new claim code
.
PROC180   MATCH       PINVCLM,ACODE
         GOTO        PROC200 IF EQUAL
.
.        Go to the next claim code
.
PROC190  CALL        RDKCODE1
         BRANCH      OVRCD,PROC140
.
         MATCH       CODECL,TCODE
         GOTO        PROC140 IF NOT EQUAL
.
         MATCH       ACODE,EDCLM
         GOTO        PROC140 IF LESS
.
.        Initialise for reposition
.
         GOTO        PROC020
.
.        Same system/site/claim code. Check for a surname in the valid range
.
PROC200  MOVE        STARTNM,DIM6
         MATCH       DIM6,PINALPHA
         GOTO        PROC020 IF LESS
.
         MOVE        ENDNAM,DIM6
         MATCH       PINALPHA,DIM6
         GOTO        PROC190 IF LESS
.
.        Check for a invalid invoice date
.
         MATCH       PINVDTE,FROMDATE            * Invoice after cut-off date
         GOTO        PROC080 IF LESS
.
         BRANCH      IBCNUGST,PROC220,PROC240,PROC240
.
PROC220 SUB         PTINGSTA,PINVAMT      * exclude GST amount
.
PROC240  IF          IBCNMHOS=1
            MATCH       SP10,PTHSHOSP
            IF          !@EQUAL
              PACK        KEY8,PINVADM,SP8
              CALL        RDPMVX11
              BRANCH      OVRCD,PROC080
              MATCH       PMVXMHOS,PTHSHOSP
              GOTO        PROC080 IF NOT EQUAL
            ENDIF
          ENDIF
.
         MATCH       PINVBLCD,FROMDATE
         GOTO        PROC260 IF LESS
.
.         Invoice should be balanced. Check it just in case (this is because
.         at one stage the centralised cash receipting module did not update
.         the PINVBLCD variable, and so occassionally PINVBLCD said the invoice
.         was balanced, even though it wasn't).
.
          MOVE      PINVAMT,FORM12P2
          ADD       PINVPATA,FORM12P2
          ADD       PINVHFDA,FORM12P2
          ADD       PINVOTHA,FORM12P2
          ADD       PINVJOUR,FORM12P2
          ADD       PTINCRTT,FORM12P2
          IF        IBCNUGST=2 | IBCNUGST=3
            ADD       PTINGSTJ,FORM12P2
          ENDIF
.
          COMPARE   ZERO00,FORM12P2          * invoice balanced ?
          GOTO      PROC080 IF EQUAL         * yes, ignore invoice
.
          BRANCH    EXPORTFL,PROC080         * Export file - no error message
.
.         Invoice is not really balanced. Report the error, and then include
.         the invoice in the report, to make sure the report will balance.
.
          UNPACK    PINVBLCD,CCENT,CYEAR,CMON,CDAY
          CALL      PACDATE
.
          DISPLAY   *P1:17,*V2LON,*EL,*B:
                    "** Invoice ",PINVNO," has an incorrect balanced date ":
                    CPCDATE," **",*W2;
.
          COMPARE   "56",CLNO
          CALL      HEAD0000 IF NOT LESS
          PRINT     *1,"** Invoice ",PINVNO," has on incorrect balanced date ":
                    CPDATE,". Contact I.B.A. Immediately **",*N
          ADD       TWO,CLNO
          GOTO      PROC080
.
.         Determine if this invoice is fully paid or not
.
PROC260  MOVE      ZERO,TMPPAID
         MOVE      ZERO,HFPAID
         MOVE      ZERO,PATPAID
.
        PACK        KEY22 WITH PINVADM,PINVNO,SP6
.
.       Loop over the appropriate DTRAN file
.
        BRANCH      PINVSYS OF PROC500,PROC400,PROC300,PROC400,PROC080
.
.------------------------------------------------------------------------------
.       In-patient invoice
.------------------------------------------------------------------------------
.
PROC300  CALL        RDSDTRN1
.
PROC310 CALL        RDKDTRN1
        BRANCH      OVRCD OF PROC600
.
        MATCH       TREF,PINVNO
        GOTO        PROC600 IF NOT EQUAL
.
.       We are only interested in cash and journals
.
        BRANCH      TRECTYPE,PROC310,PROC310,PROC310,PROC310,PROC330,PROC320
        GOTO        PROC310
.
.       If the Transaction date is used for journals, then treat as cash
.       otherwise use the last modification date as the journal date for
.       determining if the journal was done before or after cutoff date
.
PROC320  BRANCH      CJRNREP,PROC330
.
        MATCH       PTDTEFFD,FROMDATE
        GOTO        PROC310 IF LESS
.
        GOTO        PROC340
.
.       Use the transaction date to determine if this transaction was done
.       before or after the cutoff date.
.
PROC330  PACK        TDATE WITH TFCENT,TFYEAR,TFMONTH,TFDAY
        REP         " 0",TDATE
.
.       MATCH       TDATE,FROMDATE
        MATCH       PTDTEFFD,FROMDATE
        GOTO        PROC310 IF LESS
.
.       Valid payment for this report
.
PROC340  MATCH       "H",TTYPEDEB
        GOTO        PROC350 IF NOT EQUAL
.
        ADD         TPATAMTT,HFPAID          * Health Fund Payment
        GOTO        PROC360
.
PROC350 ADD         TPATAMTT,PATPAID         * Patient Payment
        COMPARE     SIX,TRECTYPE
        GOTO        PROC360 IF NOT EQUAL
.
        IF          IBCNUGST=2 | IBCNUGST=3
          ADD         PTDTGSTM,PATPAID
        ENDIF
.
PROC360  ADD         TPATAMTT,TMPPAID
        COMPARE     SIX,TRECTYPE
        GOTO        PROC310 IF NOT EQUAL
.
        IF          IBCNUGST=2 | IBCNUGST=3
          ADD         PTDTGSTM,TMPPAID          * GST Journal
        ENDIF
        GOTO        PROC310
.
.       Other financial invoice and Outpatient invoice
.
PROC400  MOVE        "out",OSTFILE
        MOVE        PVISITE,KEY6
        CALL        RDSITA1
.
        PACK        CFNAME,OSTFILE,FILDTRO1
        OPEN        OUTDTRO1,CFNAME
.
        CALL        RDSDTRO1
.
PROC410 CALL        RDKDTRO1
        BRANCH      OVRCD OF PROC440
.
        MATCH       OTINVNO,PINVNO
        GOTO        PROC440 IF NOT EQUAL
.
        BRANCH      OTRECTYP,PROC410,PROC430,PROC420
        GOTO        PROC410
.
.       If the Transaction date is used for journals, then treat as cash
.       otherwise use the last modification date as the journal date for
.       determining if the journal was done before or after cutoff date
.
PROC420 BRANCH      CJRNREP,PROC430
.
        MATCH       OTDTEFFD,FROMDATE
        GOTO        PROC410 IF LESS
.
        ADD         OTPATAMT,TMPPAID
.
        IF          IBCNUGST=2 | IBCNUGST=3
          ADD         OTDTGSTM,TMPPAID          * GST Journal
        ENDIF
        GOTO        PROC410
.
.       Use the transaction date to determine if this transaction was done
.       before or after the cutoff date.
.
PROC430  
.       MATCH       OTDDATE,FROMDATE
        MATCH       OTDTEFFD,FROMDATE
        GOTO        PROC410 IF LESS
.
        ADD         OTPATAMT,TMPPAID
        IF          IBCNUGST=2 | IBCNUGST=3
          ADD         OTDTGSTM,TMPPAID
        ENDIF
        GOTO        PROC410
.
PROC440 CLOSE       OUTDTRO1
        GOTO        PROC600
.
.------------------------------------------------------------------------------
.       A + E invoice
.------------------------------------------------------------------------------
.
PROC500  CALL        RDSDTRE1
.
PROC510 CALL        RDKDTRE1
        BRANCH      OVRCD OF PROC600
.
        MATCH       ATINVNO,PINVNO
        GOTO        PROC600 IF NOT EQUAL
.
        BRANCH      ATRECTYP,PROC510,PROC530,PROC520
        GOTO        PROC510
.
.       If the Transaction date is used for journals, then treat as cash
.       otherwise use the last modification date as the journal date for
.       determining if the journal was done before or after cutoff date
.
PROC520  BRANCH      CJRNREP,PROC530
.
        MATCH       ATDTEFFD,FROMDATE
        GOTO        PROC510 IF LESS
.
        ADD         ATPATAMT,TMPPAID
        ADD         ATDTGSTM,TMPPAID                                  *I-198325
        GOTO        PROC510
.
.       Use the transaction date to determine if this transaction was done
.       before or after the cutoff date.
.
PROC530  
.       MATCH       ATDDATE,FROMDATE
        MATCH       ATDTEFFD,FROMDATE
        GOTO        PROC510 IF LESS
.
        ADD         ATPATAMT,TMPPAID
        GOTO        PROC510
.
.       Add the total payments to the invoice total to get the outstanding amt
.
PROC600 CALL        CRDN0000              * Check credit note
        ADD         FORM12P2,PINVAMT
.
        MOVE        PINVAMT,FORM12P2
        ADD         TMPPAID,FORM12P2
.
        COMPARE     ZERO00 TO FORM12P2
        GOTO        PROC080 IF EQUAL
.
        MOVE        PINVAMT,PINVPAT
.
        COMPARE     SIX,CATBLAY
        GOTO        PROC610 IF EQUAL          * SVMPH layout
.
.       Check for a change in admission number
.
        MATCH       PINVADM TO SAVADMNO
        GOTO        PROC610 IF NOT EQUAL
.
        MATCH       PINVCLM,SAVCLAIM
        GOTO        PROC820 IF EQUAL
.
PROC610 BRANCH      OPTION1 TO PROC720,PROC700,PROC700,PROC700,PROC700
        GOTO        PROC720
.
.        Write to tempfile
.
PROC700  COMPARE     SIX,CATBLAY
         GOTO        PROC710 IF EQUAL         * SVMPH layout
         COMPARE     FIVE,CATBLAY
         CALL        WRTEH00 IF NOT EQUAL
.
PROC710  MOVE        ZERO TO TOTDAYS
         MOVE        PINVADM TO SAVADMNO
         MOVE        ZERO,PPORTION
         MOVE        SP70,DEBTTYPE
         MOVE        SP70,DEBTAGEN
         GOTO        PROC730
.
.        Write to tempfile for Full report
.
PROC720 CALL        WRTEF00
.
.       Get the details for this invoice
.
PROC730 MOVE        ZERO TO DDDAY
        MOVE        ZERO TO DDMON
        MOVE        ZERO TO DDYER
        MOVE        ZERO TO DDCEN
.
.       Get the master file details
.
        MOVE        PINVUR TO KEY8
        CALL        RDMAST1
        BRANCH      OVRCD TO NOMAST
.
        BRANCH      PINVSYS OF PROC770,PROC760,PROC740,PROC780,PROC080
.
.------------------------------------------------------------------------------
.       Inpatient details
.------------------------------------------------------------------------------
.
PROC740  MOVE        PINVADM TO KEY8
        CALL        RDMISS1
        BRANCH      OVRCD TO INVADM
.
        COMPARE     ONE TO ASTAT
        GOTO        NOPREAD IF EQUAL
        COMPARE     FIVE TO ASTAT
        GOTO        NOCANAD IF EQUAL
.
PROC750 UNPACK      ADATE TO XCENT,XYEAR,XMON,XDAY
        MOVE        XDAY TO ADDAY
        MOVE        XMON TO ADMON
        MOVE        XYEAR TO ADYER
        MOVE        XCENT,ADCEN
.
        MOVE        AADMNO TO KEY8
        CALL        RDDSCH1
        BRANCH      OVRCD TO PROC800
.
        UNPACK      DDATE TO XCENT,XYEAR,XMON,XDAY
        MOVE        XDAY TO DDDAY
        MOVE        XMON TO DDMON
        MOVE        XYEAR TO DDYER
        MOVE        XCENT,DDCEN
.
.       MATCH       SP10,AFUNDH
.       IF          @EQUAL
.         MOVE        PFUNDH,AFUNDH
.         MOVE        PFNDTB,AFNDTB
.         MOVE        PFNDMM,AFNDMM
.       ENDIF
        GOTO        PROC800
.
.------------------------------------------------------------------------------
.       Outpatient details
.------------------------------------------------------------------------------
.
PROC760 MOVE        PINVADM TO OBAOUTNO
        MOVE        OBAOUTNO,KEY8
        CALL        RDVISA1
        COMPARE     ZERO,OVRCD
        GOTO        PROC762 IF EQUAL
.
.       Check for Cancelled Outpatient
.
        MOVE        "out",OSTFILE
        MOVE        PINVSITE,KEY6
        CALL        RDSITA1
        PACK        CFNAME WITH OSTFILE,FILCANA1
        MOVE        ZERO,OVRCD
        TRAP        OVERCOND IF IO
        OPEN        OUTCANA1,CFNAME
        TRAPCLR     IO
        BRANCH      OVRCD,INVADM
.
        MOVE        OBAOUTNO,KEY8
        CALL        RDOTCAN1
        BRANCH      OVRCD,INVADM
.
        UNPACK      PINVDTE TO XCENT,XYEAR,XMON,XDAY
        MOVE        XDAY TO ADDAY
        MOVE        XMON TO ADMON
        MOVE        XYEAR TO ADYER
        MOVE        XCENT,ADCEN
.
        MOVE        OPCNCLAS,ATYPE
        MOVE        PINVCLM,ACLAIM
        MOVE        PINVUR,AURNO
        MOVE        PINVADM,AADMNO
        MOVE        PFUNDH,AFUNDH
        MOVE        PFNDTB,AFNDTB
        MOVE        PFNDMM,AFNDMM
        GOTO        PROC800
.
PROC762 MOVE        "out",OSTFILE
        MOVE        PVISITE,KEY6
        CALL        RDSITA1
.
        PACK        CFNAME WITH OSTFILE,FILBB1A1
        CALL       OPOTBB11
.
        MOVE        OBAOUTNO,KEY8
        CALL        RDBOKB1
        CLOSE     OUTBB1A1
        BRANCH      OVRCD TO INVADM
.
        UNPACK      OBADATE TO XCENT,XYEAR,XMON,XDAY
        MOVE        XDAY TO ADDAY
        MOVE        XMON TO ADMON
        MOVE        XYEAR TO ADYER
        MOVE        XCENT,ADCEN
.
        MOVE        OBACLASS,ATYPE
        MOVE        OBACOMP,ACLAIM
        MOVE        PINVUR,AURNO
        MOVE        PINVADM,AADMNO
        MOVE        PFUNDH,AFUNDH
        MOVE        PFNDTB,AFNDTB
        MOVE        PFNDMM,AFNDMM
        GOTO        PROC800
.
.------------------------------------------------------------------------------
.       A + E details
.------------------------------------------------------------------------------
PROC770 MOVE        PINVADM TO ADANUMB
        MOVE        ADANUMB,KEY8
        CALL        RDDETA1
.       BRANCH      OVRCD TO INVADM
.
        UNPACK      ADADATE TO XCENT,XYEAR,XMON,XDAY
        MOVE        XDAY TO ADDAY
        MOVE        XMON TO ADMON
        MOVE        XYEAR TO ADYER
        MOVE        XCENT,ADCEN
.
        MOVE        ADACLASS,ATYPE
        MOVE        ADACOMP,ACLAIM
        MOVE        PINVUR,AURNO
        MOVE        PINVADM,AADMNO
        MOVE        PFUNDH,AFUNDH
        MOVE        PFNDTB,AFNDTB
        MOVE        PFNDMM,AFNDMM
.
        MOVE        ADANUMB,KEY8
        CALL        RDDISA1
        BRANCH      OVRCD,PROC800
.
        UNPACK      ADSDATE,XCENT,XYEAR,XMON,XDAY
        MOVE        XDAY,DDDAY
        MOVE        XMON,DDMON
        MOVE        XYEAR,DDYER
        MOVE        XCENT,DDCEN
.
        GOTO        PROC800
.
.------------------------------------------------------------------------------
.       Other Financial details
.------------------------------------------------------------------------------
PROC780  UNPACK      PINVDTE TO XCENT,XYEAR,XMON,XDAY
        MOVE        XDAY TO ADDAY
        MOVE        XMON TO ADMON
        MOVE        XYEAR TO ADYER
        MOVE        XCENT,ADCEN
.
        MOVE        SP3,ATYPE
        MOVE        PINVCLM,ACLAIM
        MOVE        PINVUR,AURNO
        MOVE        PINVADM,AADMNO
        MOVE        PFUNDH,AFUNDH
        MOVE        PFNDTB,AFNDTB
        MOVE        PFNDMM,AFNDMM
.
.------------------------------------------------------------------------------
PROC800 MATCH       SP70,PINVCLM
        IF          !@EQUAL
          MOVE        PINVCLM,ACLAIM
        ENDIF
        MOVE        ACLAIM,SAVCLAIM
.
.       Save invoice details
.
PROC820 MOVE        PINVSYS,SPINVSYS
        MOVE        PINVTYP,SPINVTYP
        UNPACK      PINVDTE INTO XCENT,XYEAR,XMON,XDAY
        MOVE        XCENT,CC
        MOVE        XYEAR TO YY
        MOVE        XMON TO MM
        MOVE        XDAY TO DD
.
        CALL        DMYCON
.
        PACK        CNYRKYIN,ASATCC,ASATYER,SP4
        PACK        CNYRPAT,CC,YY
        REP         " 0",CNYRKYIN
        REP         " 0",CNYRPAT
.
        MOVE        ASATDAY TO FORM5DAY
        MOVE        JULDAY TO TDAY
        MOVE        JULYR TO TYR
.
        ADD         TMPPAID,PINVAMT
        MOVE        PINVAMT TO XTINVAMT
        MULT        SEQ BY TMPPAID
        ADD         TMPPAID TO XTOTPAID
.
.       Calculate the outstanding amount for H.F. and Patient
.
        SUB         PINVREB,PINVPAT          * Patient invoice amount
        ADD         PATPAID,PINVPAT
.
        ADD         HFPAID,PINVREB            * Health Fund
. 
        PACK        CURRDATE,CC,YY
        REP         " 0",CURRDATE
.
        CALL        REAS0000         * Check if there is patient portion amt
        BRANCH      OPTION1 TO PROC830,PROC900,PROC906,PROC920,PROC930       
.
PROC830 COMPARE     ASATCC,CC              *Are dates in same century
        GOTO        PROC832 IF EQUAL          *Continue
        GOTO        PROC834 IF LESS           *Year As at year
.
        GOTO        PROC080                *Date is higher, go to next record
.
PROC832 COMPARE     ASATYER TO YY          *Same year?
        GOTO        PROC836 IF EQUAL          *Yes, go on to dates
        GOTO        PROC834 IF LESS           *Less, work out days difference
.
        GOTO        PROC080
.
PROC834 MOVE        ASATYER TO DAYSINYR
        COMPARE     YY,DAYSINYR
        IF          @LESS
          ADD         HUNDRED,DAYSINYR     *If year lower, add century
        ENDIF
        IF          @EQUAL
          MOVE        HUNDRED, DAYSINYR    *If equal, 100 years difference
          MULT        THREE65,DAYSINYR     *Convert to days
          ADD         TWENTY5,DAYSINYR     *Leap years
          ADD         DAYSINYR,FORM5DAY    
          GOTO        PROC836      *This is not likely to happen but can't hurt!
        ENDIF
.
        SUB         YY FROM DAYSINYR       *Calculate years difference
        MULT        THREE65 BY DAYSINYR    *Convert to days
        ADD         DAYSINYR TO FORM5DAY
.
PROC836 SUB         TDAY FROM FORM5DAY 
.
        COMPARE     ZERO TO FORM5DAY
        GOTO        PROC080 IF LESS
.
        ADD         PINVAMT TO XTOTOUT 
.
.       0-30 days
.
        COMPARE     THIRTY1 TO FORM5DAY
        GOTO        PROC838 IF NOT LESS
.
        ADD         PINVAMT TO XTOTCURR
        ADD         PINVREB,XTREBCUR            * Melbourne clinic
        ADD         PINVPAT,XTPATCUR
        GOTO        PROC880
.
.       31-60 days
.
PROC838 COMPARE     SIXTY1 TO FORM5DAY
        GOTO        PROC840 IF NOT LESS
.
        ADD         PINVAMT TO XTOT30
        ADD         PINVREB,XTREB30            * Melbourne clinic
        ADD         PINVPAT,XTPAT30
        GOTO        PROC880
.
.       61-90 days
.
PROC840 COMPARE     NINETY1 TO FORM5DAY
        GOTO        PROC842 IF NOT LESS
.
        ADD         PINVAMT TO XTOT60
        ADD         PINVREB,XTREB60            * Melbourne clinic
        ADD         PINVPAT,XTPAT60
        GOTO        PROC880
.
.       Check if we want a breakup past 90+ days
.
PROC842 BRANCH      CATBLAY OF PROC844,PROC846,PROC856,PROC846,PROC864,PROC864
.
.       Over 90 days
.
PROC844 ADD         PINVAMT TO XTOT90
        ADD         PINVREB,XTREB90           * Melbourne clinic & SVMPH
        ADD         PINVPAT,XTPAT90
        GOTO        PROC880
.
.       For Mercy only, 121+ days
.
PROC846 COMPARE     ONE21 TO FORM5DAY
        GOTO        PROC848 IF NOT LESS
        GOTO        PROC844
.
PROC848 COMPARE     FOUR,CATBLAY
        GOTO        PROC850 IF EQUAL         * Melbourne clinic
.
        COMPARE     THREE66 TO FORM5DAY
        GOTO        PROC852 IF NOT LESS
.
        ADD         PINVAMT TO XTOT120
        GOTO        PROC080
.
.       Melbourne clinic only
.
PROC850 ADD         PINVAMT,XTOT120
        ADD         PINVREB,XTREB120
        ADD         PINVPAT,XTPAT120
        GOTO        PROC080
.
.       For Mercy only, 1yr+ days
.
PROC852 COMPARE     SEVEN31 TO FORM5DAY
        GOTO        PROC854 IF NOT LESS
.
        ADD         PINVAMT TO XTOT1YR
        GOTO        PROC080
.
.       For Mercy only, 2yr+ days
.
PROC854 ADD         PINVAMT TO XTOT2YR
        GOTO        PROC080
.
.       For St.Andrews (Ipswich) we want a break up of 120,150,180+
.
PROC856 COMPARE     ONE21 TO FORM5DAY
        GOTO        PROC858 IF NOT LESS
        GOTO        PROC844
.
PROC858 COMPARE     ONE51 TO FORM5DAY
        GOTO        PROC860 IF NOT LESS
.
        ADD         PINVAMT TO XTOT120
        GOTO        PROC080
.
.       This is 151-180 days - use the same variable name as for mercy
.
PROC860 COMPARE     ONE81 TO FORM5DAY
        GOTO        PROC862 IF NOT LESS
.
        ADD         PINVAMT TO XTOT1YR
        GOTO        PROC080
.
.       This is 181+ days - use the same variable name as for mercy
.
PROC862 ADD         PINVAMT TO XTOT2YR
        GOTO        PROC080
.
.       For Healthscope layout
.
PROC864 COMPARE     ONE21 TO FORM5DAY
        GOTO        PROC866 IF NOT LESS
        GOTO        PROC844
.
PROC866 COMPARE     ONE51 TO FORM5DAY
        GOTO        PROC868 IF NOT LESS
.
        ADD         PINVAMT TO XTOT120          * 120 days
        GOTO        PROC880
.
PROC868 COMPARE     ONE81 TO FORM5DAY
        GOTO        PROC870 IF NOT LESS
.
        ADD         PINVAMT TO XTOT1YR          * 150 days
        GOTO        PROC880
.
PROC870 ADD         PINVAMT TO XTOT2YR          * 180 days
        GOTO        PROC880
.
PROC880 IF          CATBLAY=6
          MOVE        PINVNO,TINVNO
        ENDIF
        GOTO        PROC080
+
.------------------------------------------------------------------------------
.       Detailed Report check.
.------------------------------------------------------------------------------
.
PROC900 MATCH       CNYRKYIN,CNYRPAT
        GOTO        PROC904 IF EQUAL
        GOTO        PROC902 IF LESS
        GOTO        PROC080
.
PROC902 MOVE        CNYRKYIN TO DAYSINYR
        MOVE        CNYRPAT,FORM4
        SUB         FORM4 FROM DAYSINYR
        MULT        THREE65 BY DAYSINYR
        ADD         DAYSINYR TO FORM5DAY
.
PROC904 SUB         TDAY FROM FORM5DAY 
.
        COMPARE     ZERO TO FORM5DAY
        GOTO        PROC080 IF LESS
.
        COMPARE     THIRTY1 TO FORM5DAY
        CALL        WRTED00 IF LESS    
.
        GOTO        PROC080
.
PROC906 MATCH       CNYRKYIN,CNYRPAT
        GOTO        PROC910 IF EQUAL
        GOTO        PROC908 IF LESS
        GOTO        PROC080
.
PROC908 MOVE        CNYRKYIN TO DAYSINYR
        MOVE        CNYRPAT,FORM4
        SUB         FORM4 FROM DAYSINYR
        MULT        THREE65 BY DAYSINYR
        ADD         DAYSINYR TO FORM5DAY
.
PROC910 SUB         TDAY FROM FORM5DAY 
.
        COMPARE     ZERO TO FORM5DAY
        GOTO        PROC080 IF LESS
.
        COMPARE     THIRTY1 TO FORM5DAY
        GOTO        PROC080 IF LESS
.
        COMPARE     SIXTY1 TO FORM5DAY
        CALL        WRTED00 IF LESS    
.
        GOTO        PROC080
.
PROC920 MATCH       CNYRKYIN,CNYRPAT
        GOTO        PROC924 IF EQUAL
        GOTO        PROC922 IF LESS
        GOTO        PROC080
.
PROC922 MOVE        CNYRKYIN TO DAYSINYR
        MOVE        CNYRPAT,FORM4
        SUB         FORM4 FROM DAYSINYR
        MULT        THREE65 BY DAYSINYR
        ADD         DAYSINYR TO FORM5DAY
.
PROC924 SUB         TDAY FROM FORM5DAY 
.
        COMPARE     ZERO TO FORM5DAY
        GOTO        PROC080 IF LESS
.
        COMPARE     SIXTY1 TO FORM5DAY
        GOTO        PROC080 IF LESS
.
        COMPARE     NINETY1 TO FORM5DAY
        CALL        WRTED00 IF LESS
.
        GOTO        PROC080
.
PROC930 MATCH       CNYRKYIN,CNYRPAT
        GOTO        PROC934 IF EQUAL
        GOTO        PROC932 IF LESS
.
        GOTO        PROC080
.
PROC932 MOVE        CNYRKYIN TO DAYSINYR
        MOVE        CNYRPAT,FORM4
        SUB         FORM4 FROM DAYSINYR
        MULT        THREE65 BY DAYSINYR
        ADD         DAYSINYR TO FORM5DAY
.
PROC934 SUB         TDAY FROM FORM5DAY 
.
        COMPARE     ZERO TO FORM5DAY
        GOTO        PROC080 IF LESS
.
        COMPARE     NINETY1 TO FORM5DAY
        CALL        WRTED00 IF NOT LESS
        GOTO        PROC080
.
PROC999 RETURN
+
.------------------------------------------------------------------------------
.        Set up for writing to tempfile
.------------------------------------------------------------------------------
WRTEH00  MATCH       ZEROVISN TO SAVADMNO
         GOTO        WRTEH99 IF EQUAL
.
         COMPARE     ZERO TO TOTDAYS
         RETURN      IF EQUAL
.
         MOVE        TOTDAYS TO XTINVAMT
         MOVE        SP1 TO SORTDIM
         ADD         ONE TO UNIQUE
.
         COMPARE     ONE,PTCNCATB        * print billing comments?
         GOTO        WRTEH10 IF NOT EQUAL
.
         CALL        RDBC0000            * Billing Comments
         GOTO        WRTEH20
.
WRTEH10  MOVE        AADMNO,KEY8
         CALL        VSCMTX00
         MOVE        VSMTCMNT,CMNTLINE
.
WRTEH20  MOVE        SP3,REMLSTL
         MOVE        SP8,LSTLDAT
         MOVE        AADMNO,KEY8
         CALL        RDREMD1
         BRANCH      OVRCD OF WRTEH30
.
         MATCH       SP8,REMLDTE
         GOTO        WRTEH30 IF EQUAL
.
         UNPACK      REMLDTE WITH XCENT1,XYEAR1,XMON1,XDAY1
         PACK        LSTLDAT WITH XDAY1,SLASH,XMON1,SLASH,XYEAR1
.
WRTEH30  MOVE        ACLAIM,ACLMCD
         BRANCH      SEPCLM OF WRTEH40
         MOVE        "ZZZ",ACLMCD
.
WRTEH40  MOVE        AFUNDH,HFUND
         BRANCH      SEPFUND OF WRTEH50
         MOVE        "ZZZZZZ",HFUND
.
WRTEH50  MOVE        UNIQUE,XUNIQUE
         MOVE        AURNO,XAURNO
         MOVE        AADMNO,XAADMNO
         MOVE        PTELEP,D12PTELP     * since PTELEP/b = 20 chars (new file)
         MOVE        PTELEB,D12PTELB
         MOVE        FORM5DAY,DAGED
.
         UNPACK      SP70,PATFLAG,DEBTAGEN
         CALL        WRTP0000           * Write to tempfile
WRTEH99  RETURN
.
.-----------------------------------------------------------------------
. Retrieve the 1st comment text line of the latest active visit
. comment details
.-----------------------------------------------------------------------
.
VSCMTX00  MOVE      SP70,VSMTCMNT
          PACK      KEY17,KEY8,VSCMTTYP,Z70
          CALL      RSVSMDT1
VSCMTX10  CALL      RPVSMDT1
          BRANCH    OVRCD,VSCMTX99
.
          MATCH     KEY8,VSMDVISN
          GOTO      VSCMTX99 IF NOT EQUAL
.
          MATCH     VSCMTTYP,VSMDTYPE
          GOTO      VSCMTX99 IF NOT EQUAL
.
          MATCH     "1",VSMDDELT          * is comment deleted
          GOTO      VSCMTX10 IF EQUAL
.
. Retrieve the 1st comment text line details
.
          PACK      KEY20,VSMDVISN,VSMDTYPE,VSMDNOTE,SP70
          CALL      RSVSMTX1
          CALL      RKVSMTX1
          BRANCH    OVRCD,VSCMTX10
.
          MATCH     VSMDVISN,VSMTVISN
          GOTO      VSCMTX10 IF NOT EQUAL
.
          MATCH     VSMDTYPE,VSMTTYPE
          GOTO      VSCMTX10 IF NOT EQUAL
.
          MATCH     VSMDNOTE,VSMTNOTE
          GOTO      VSCMTX10 IF NOT EQUAL
.
VSCMTX99  RETURN
.
.*******************************************************************************
.
INVADM  DISPLAY     *P1:17,*V2LON,*EL,*B:
                    "** Invoice ",PINVNO," has invalid admission number ":
                    PINVADM," **",*W2;
.
        MOVE        ZEROVISN,SAVADMNO
        BRANCH      EXPORTFL,PROC080          * export file no error message
        COMPARE      "54" TO CLNO
        CALL         HEAD0000 IF NOT LESS
        PRINT       *1,"** Invoice ",PINVNO," has invalid admission number ":
                    PINVADM,". Contact I.B.A. Immediately **",*N
        ADD         TWO,CLNO
        GOTO        PROC080
.
NOPREAD MATCH       "1",PTINCRST         * is it fully credited?
        GOTO        NOPREAD1 IF NOT EQUAL
.
        DISPLAY     *P1:17,*V2LON,*EL,*B:
                    "** Invoice ",PINVNO," has been fully credited. ":
                    "Totals are included in this report  **",*W2;
.
.       MOVE        ZEROVISN,SAVADMNO
        BRANCH      EXPORTFL,PROC750         * export file no error message
        COMPARE      "54" TO CLNO
        CALL         HEAD0000 IF NOT LESS
        PRINT       *1,"** Invoice ",PINVNO," has been fully credited. ":
                    "Totals are included in this report",*N
        ADD         TWO,CLNO
        GOTO        PROC750

NOPREAD1 DISPLAY     *P1:17,*V2LON,*EL,*B:
                    "** Invoice ",PINVNO," allocated to pre-admission":
                    " number ":
                    PINVADM," **",*W2;
.
        MOVE        ZEROVISN,SAVADMNO
        BRANCH      EXPORTFL,PROC080         * export file no error message
        COMPARE      "54" TO CLNO
        CALL         HEAD0000 IF NOT LESS
        PRINT       *1,"** Invoice ",PINVNO," allocated to pre-admission":
                    " number ":
                    PINVADM,". Contact I.B.A. Immediately **",*N
        ADD         TWO,CLNO
        GOTO        PROC080
.
NOCANAD MATCH       "1",PTINCRST         * is it fully credited?
        GOTO        NOCANAD1 IF NOT EQUAL
.
.       MOVE        ZEROVISN,SAVADMNO
        BRANCH      EXPORTFL,PROC750         * export file no error message
        DISPLAY     *P1:17,*V2LON,*EL,*B:
                    "** Invoice ",PINVNO," has been fully credited ":
                    "Totals are included in this report  **",*W2;
        COMPARE      "54" TO CLNO
        CALL         HEAD0000 IF NOT LESS
        PRINT       *1,"** Invoice ",PINVNO," has been fully credited. ":
                    "Totals are included in this report",*N
        ADD         TWO,CLNO
        GOTO        PROC750
. 
NOCANAD1 DISPLAY     *P1:17,*V2LON,*EL,*B:
                    "** Invoice ",PINVNO," has cancelled admission number ":
                    PINVADM," **",*W2;
.
        MOVE        ZEROVISN,SAVADMNO
        BRANCH      EXPORTFL,PROC080          * export file no error message
        COMPARE      "54" TO CLNO
        CALL         HEAD0000 IF NOT LESS
        PRINT       *1,"** Invoice ",PINVNO," has cancelled admission number ":
                    PINVADM,". Contact I.B.A. Immediately **",*N
        ADD         TWO,CLNO
        GOTO        PROC080
.
NOMAST  DISPLAY     *P1:17,*V2LON,*EL,*B:
                    "** Invoice ",PINVNO," missing master file record ":
                    PINVUR," **",*W2;
.
        MOVE        ZEROVISN,SAVADMNO
        BRANCH      EXPORTFL,PROC080          * export file no error message
        COMPARE      "54" TO CLNO
        CALL         HEAD0000 IF NOT LESS
        PRINT       *1,"** Invoice ",PINVNO," missing master file record ":
                    PINVUR,". Contact I.B.A. Immediately **",*N
        ADD         TWO,CLNO
        GOTO        PROC080
.
.*******************************************************************************
.       Write to tempfile for Full report
.*******************************************************************************
WRTEF00 MOVE        XTOTCURR TO XTOTOUT
        ADD         XTOT30 TO XTOTOUT
        ADD         XTOT60 TO XTOTOUT
        ADD         XTOT90 TO XTOTOUT
        ADD         XTOT120 TO XTOTOUT
        ADD         XTOT1YR TO XTOTOUT
        ADD         XTOT2YR TO XTOTOUT
.
        MATCH       ZEROVISN TO SAVADMNO
        GOTO        WRTEF40 IF EQUAL
.
.         Mods to check if any outstanding amount of each breakup
.
        COMPARE     ZERO,XTOTCURR
        GOTO        WRTEF10 IF NOT EQUAL
        COMPARE     ZERO,XTOT30
        GOTO        WRTEF10 IF NOT EQUAL
        COMPARE     ZERO,XTOT60
        GOTO        WRTEF10 IF NOT EQUAL
        COMPARE     ZERO,XTOT90
        GOTO        WRTEF10 IF NOT EQUAL
.
        COMPARE     ZERO TO XTOTOUT
        GOTO        WRTEF40 IF EQUAL
.
WRTEF10 MOVE        ONE TO SORTDIM
        ADD         ONE TO UNIQUE
.
.       MOVE        AFUNDH,SHFUND         * Melbourne clinic
        PACK        SHFUND,AFUNDH,SP70
.
        MATCH       SP70,SAVCLAIM
        IF          !@EQUAL
          MOVE        SAVCLAIM,ACLAIM
        ENDIF
        MOVE        ACLAIM,SACLM
        MOVE        AFUNDH,HFUND
.
        BRANCH      SEPFUND OF WRTEF20
        MOVE        "ZZZZZZ",HFUND
.
WRTEF20 MOVE        ACLAIM,ACLMCD
        BRANCH      SEPCLM OF WRTEF30
        MOVE        "ZZZ",ACLMCD
.
WRTEF30 MOVE        XTREBCUR,XTSUBREB
        ADD         XTREB30,XTSUBREB
        ADD         XTREB60,XTSUBREB
        ADD         XTREB90,XTSUBREB
        ADD         XTREB120,XTSUBREB
.
        MOVE        XTPATCUR,XTSUBPAT
        ADD         XTPAT30,XTSUBPAT
        ADD         XTPAT60,XTSUBPAT
        ADD         XTPAT90,XTSUBPAT
        ADD         XTPAT120,XTSUBPAT
.
        MOVE        UNIQUE,XUNIQUE
        MOVE        AURNO,XAURNO
        MOVE        AADMNO,XAADMNO
.
        IF          CATBLAY=5 | CATBLAY=6
          IF          PPORTION<>0
            CALL        WAMT0000       * write Patient outstanding amount
            ADD         ONE TO UNIQUE
            MOVE        UNIQUE,XUNIQUE
          ENDIF
          COMPARE    ZERO,PDBONLY
          GOTO       WRTEF40 IF NOT EQUAL     * Not printing 'All'
        ENDIF
.
        UNPACK      SP70,PATFLAG,DEBTAGEN
        IF          CATBLAY=5 | CATBLAY=6
          IF          OPTION1=1
            COMPARE     ZERO,XTOTOUT
            GOTO        WRTEF40 IF EQUAL
          ELSE
            COMPARE     ZERO,XTINVAMT
            GOTO        WRTEF40 IF EQUAL
          ENDIF
        ENDIF
        CALL        WRTP0000           * Write to tempfile
.
WRTEF40 MOVE        ZERO TO XTOTPAID
        MOVE        ZERO TO XTOTCURR
        MOVE        ZERO TO XTOT30
        MOVE        ZERO TO XTOT60
        MOVE        ZERO TO XTOT90
        MOVE        ZERO TO XTOT120
        MOVE        ZERO TO XTOT1YR
        MOVE        ZERO TO XTOT2YR
        MOVE        PINVADM TO SAVADMNO
        MOVE        ZERO,PPORTION
        MOVE        SP70,DEBTTYPE
        MOVE        SP70,DEBTAGEN
.
.       MOVE        ZERO TO HFPAID
.       MOVE        ZERO TO PATPAID
.
        MOVE        ZERO TO XTREBCUR
        MOVE        ZERO TO XTPATCUR
        MOVE        ZERO TO XTREB30
        MOVE        ZERO TO XTPAT30
        MOVE        ZERO TO XTREB60
        MOVE        ZERO TO XTPAT60
        MOVE        ZERO TO XTREB90
        MOVE        ZERO TO XTPAT90
        MOVE        ZERO TO XTREB120
        MOVE        ZERO TO XTPAT120
        MOVE        ZERO TO XTSUBREB
        MOVE        ZERO TO XTSUBPAT
WRTEF99 RETURN
.
.*******************************************************************************
.       Write to tempfile
.*******************************************************************************
WRTED00 MOVE        PINVNO TO TINVNO
.
        MOVE        ONE TO SORTDIM
        ADD         ONE TO UNIQUE
.
        IF          CATBLAY=6
          IF            PTCNCATB=2
            MOVE          SP70,CMNTLINE  * No comments
            GOTO          WRTED20
          ENDIF
        ENDIF
.
        COMPARE     ONE,PTCNCATB
        GOTO        WRTED10 IF NOT EQUAL
.
        CALL        RDBC0000            * Billing Comments
        GOTO        WRTED20
.
WRTED10  MOVE        AADMNO,KEY8
         CALL        VSCMTX00
         MOVE        VSMTCMNT,CMNTLINE
.
WRTED20  MOVE        SP3,REMLSTL
         MOVE        SP8,LSTLDAT
         MOVE        AADMNO,KEY8
         CALL        RDREMD1
         BRANCH      OVRCD OF WRTED30
.
         MATCH       SP6,REMLDTE
         GOTO        WRTED30 IF EQUAL
.
         UNPACK      REMLDTE WITH XCENT1,XYEAR1,XMON1,XDAY1
         PACK        LSTLDAT WITH XDAY1,SLASH,XMON1,SLASH,XYEAR1
.
WRTED30  MOVE        ACLAIM,ACLMCD
         BRANCH      SEPCLM OF WRTED40
         MOVE        "ZZZ",ACLMCD
.
WRTED40  MOVE        AFUNDH,HFUND
         BRANCH      SEPFUND OF WRTED50
         MOVE        "ZZZZZZ",HFUND
.
WRTED50  MOVE        UNIQUE,XUNIQUE
         MOVE        AURNO,XAURNO
         MOVE        AADMNO,XAADMNO
         MOVE        PTELEP,D12PTELP     * since PTELEP/b = 20 chars (new file)
         MOVE        PTELEB,D12PTELB
         MOVE        FORM5DAY,DAGED
.
         MOVE        XTINVAMT,F12P2     * save the original outstanding amount
         IF          CATBLAY=5 | CATBLAY=6
           IF          PPORTION<>0
             CALL        WAMT0000       * write Patient outstanding amount
             ADD         ONE TO UNIQUE
             MOVE        UNIQUE,XUNIQUE
           ENDIF
           COMPARE    ONE,PDBONLY
           GOTO       WRTED60 IF EQUAL         * Patient Debt only
         ENDIF
.
         UNPACK      SP70,PATFLAG,DEBTAGEN
         CALL        WRTP0000           * Write to tempfile
.
WRTED60 ADD         F12P2 TO TOTDAYS
        MOVE        ZERO TO XTOTPAID
        MOVE        ZERO TO XTOTCURR 
        MOVE        ZERO TO XTOT30
        MOVE        ZERO TO XTOT60
        MOVE        ZERO TO XTOT90
WTTED99 RETURN
+
.*******************************************************************************
.       Print data
.*******************************************************************************
PRTD000 MOVE            ZERO,STATUS
        BRANCH          OPTION1 TO PRTD100
.
        COMPARE         SIX,CATBLAY
        GOTO            PRTD200 IF EQUAL       * Export only 
        COMPARE         FIVE,CATBLAY
        CALL            WRTEH00 IF NOT EQUAL
        GOTO            PRTD200
.
PRTD100 CALL            WRTEF00
.
PRTD200 DISPLAY    *P1:24,*EL,*P20:24,"** PROCESSING STATISTICS **",*W;
.
        MOVE          ZERO,TTTOTCUR
        MOVE          ZERO,TTTOT30
        MOVE          ZERO,TTTOT60
        MOVE          ZERO,TTTOT90
        MOVE          ZERO,TTTOT120
        MOVE          ZERO,TTTOT1YR
        MOVE          ZERO,TTTOT2YR
        MOVE          ZERO,TTTOTOUT
.
PRTD300 MOVE          ZERO TO XTTOTPAY
        MOVE          ZERO TO XTOTPAID
        MOVE          ZERO TO XTTOTCUR
        MOVE          ZERO TO XTTOT30
        MOVE          ZERO TO XTTOT60
        MOVE          ZERO TO XTTOT90
        MOVE          ZERO TO XTTOT120
        MOVE          ZERO TO XTTOT1YR
        MOVE          ZERO TO XTTOT2YR
        MOVE          ZERO TO XTTOTOUT
        MOVE          ZERO TO XCTPAID
        MOVE          ZERO TO XCTCURR
        MOVE          ZERO TO XCT30
        MOVE          ZERO TO XCT60
        MOVE          ZERO TO XCT90
        MOVE          ZERO TO XCT120
        MOVE          ZERO TO XCT1YR
        MOVE          ZERO TO XCT2YR
        MOVE          ZERO TO XCTTOT
        MOVE          ZERO TO XHTPAID
        MOVE          ZERO TO XHTCURR
        MOVE          ZERO TO XHT30
        MOVE          ZERO TO XHT60
        MOVE          ZERO TO XHT90
        MOVE          ZERO TO XHT120
        MOVE          ZERO TO XHT1YR
        MOVE          ZERO TO XHT2YR
        MOVE          ZERO TO XHTTOT
        MOVE          SIXTY TO CLNO
        MOVE          ZERO TO ENDFLAG
        MOVE          ZEROVISN TO SAVADMNO
        MOVE          SP70,SAVCLAIM
        MOVE          SP6,ACLMCD
        MOVE          SP6,HFUND
        MOVE          SP30,HFNAME
        MOVE          SP70,SAVAGEN
.
.       Initialize variables used for Melbourne clinic ATB
.
        MOVE          ZERO,XTTREBCR
        MOVE          ZERO,XTTPATCR
        MOVE          ZERO,XTTREB30
        MOVE          ZERO,XTTPAT30
        MOVE          ZERO,XTTREB60
        MOVE          ZERO,XTTPAT60
        MOVE          ZERO,XTTREB90
        MOVE          ZERO,XTTPAT90
        MOVE          ZERO,XTTRE120
        MOVE          ZERO,XTTPA120
        MOVE          ZERO,XTTSUBRE
        MOVE          ZERO,XTTSUBPA
        MOVE          ZERO,XCREBCUR
        MOVE          ZERO,XCPATCUR
        MOVE          ZERO,XCREB30
        MOVE          ZERO,XCPAT30
        MOVE          ZERO,XCREB60
        MOVE          ZERO,XCPAT60
        MOVE          ZERO,XCREB90
        MOVE          ZERO,XCPAT90
        MOVE          ZERO,XCREB120
        MOVE          ZERO,XCPAT120
        MOVE          ZERO,XCSUBREB
        MOVE          ZERO,XCSUBPAT
        MOVE          ZERO,XHREBCUR
        MOVE          ZERO,XHPATCUR
        MOVE          ZERO,XHREB30
        MOVE          ZERO,XHPAT30
        MOVE          ZERO,XHREB60
        MOVE          ZERO,XHPAT60
        MOVE          ZERO,XHREB90
        MOVE          ZERO,XHPAT90
        MOVE          ZERO,XHREB120
        MOVE          ZERO,XHPAT120
        MOVE          ZERO,XHSUBREB
        MOVE          ZERO,XHSUBPAT
.
        MOVE          ZERO,DTOTCURR
        MOVE          ZERO,DTOT30
        MOVE          ZERO,DTOT60
        MOVE          ZERO,DTOT90
        MOVE          ZERO,DTOT120
        MOVE          ZERO,DTOT1YR
        MOVE          ZERO,DTOT2YR
        MOVE          ZERO,DTOTOUT
.
        DISPLAY     *P1:24,*EL,*P20:24,"Admission Number : ":
                               *P48:24,"Name : ";
.
        MOVE          SP70,KEY38
        MOVE          SP70,KEY75
        MOVE          SP70,KEY30
        CALL          RSTP0000
.  
        BRANCH        OPTION1 TO PRTD400,PRTD310,PRTD310,PRTD310,PRTD310
        GOTO          PRTD400
.
PRTD310 CALL          DAYR00            * print day report
        GOTO          PRTD999
.
PRTD400 CALL          RKTP0000
        BRANCH        OVRCD,PRTD420
.
        IF            CATBLAY=5 | CATBLAY=6
          IF            PASSFLAG=1
            MATCH         "x",PATFLAG
            GOTO          PRTD400 IF NOT EQUAL         * Not a Patient O/S amt
          ELSE
            IF            PASSFLAG=2
              MATCH         "y",PATFLAG
              GOTO          PRTD400 IF NOT EQUAL    * Not a debt collection debt
              MATCH         SP70,SAVAGEN
              IF            !@EQUAL
                MATCH         DEBTAGEN,SAVAGEN
                CALL          AGENT00 IF NOT EQUAL
              ENDIF
            ELSE
              MATCH         SP70,PATFLAG
              GOTO          PRTD400 IF NOT EQUAL         * Not a HF O/S amt
            ENDIF
          ENDIF
        ENDIF
.
.       Check for health fund range
.
        MOVE          SHFUND,DIM6
        MATCH         STHFN,DIM6
        GOTO          PRTD400 IF LESS
.
        MATCH         DIM6,EDHFN
        GOTO          PRTD400 IF LESS
.
        MOVE          XUNIQUE,UNIQUE
        MOVE          XAURNO,AURNO
        MOVE          XAADMNO,AADMNO
.
        MOVE          PGNAME TO ANS
        PACK          PNAME WITH ANS,DOT,PSNAME
        RESET         PNAME
        MOVE          PNAME,PNAMEDIS
        MOVE          PNAME,PNAMEDS2
        MOVE          PGNAME,PGNAMEDS
        MOVE          PGNAME,PGNAMED2
        MOVE          PSNAME,PSNAMEDS
.
        DISPLAY       *P39:24,*V2LON,AADMNO,*P55:24,PNAME;
.
        CALL          PRINTFUL
.
        GOTO          PRTD400
.
PRTD420 MOVE         SP3,ACLMCD       * To prevent the health fund title print
.
        COMPARE      "56" TO CLNO
        CALL         HEAD0000 IF NOT LESS
.
        IF           CATBLAY=5 | CATBLAY=6
          IF           PASSFLAG=2
            CALL         AGENT00
            COMPARE      FIVE,CATBLAY
            GOTO         PRTD560 IF EQUAL      * Healthscope
            GOTO         PRTD570               * SVMPH
          ENDIF
        ENDIF
.
        BRANCH        SEPFUND OF PRTD440,PRTD460
.
PRTD440 CALL          HFTOT
.
PRTD460 BRANCH        SEPCLM OF PRTD470,PRTD480
.
PRTD470 CALL          CLMTOT
.
PRTD480 BRANCH        CATBLAY OF PRTD500,PRTD520,PRTD520,PRTD540,PRTD560,PRTD570
.
.        PRINT         *N,*N,*N,*54,"----------",*65,"----------":
.                         *76,"----------",*87,"----------":
.                         *98,"----------",*113,"----------";
.                      *N,*36,"OVERALL TOTAL : ",*53,TTOTPAID,*64,TTOTCURR:
.                         *75,TTOT30,*86,TTOT60,*97,TTOT90:
.                         *112,TTOTOUT:
.                      *N,*54,"----------",*65,"----------":
.                         *76,"----------",*87,"----------":
.                         *98,"----------",*113,"----------"
.
        PRINT          *N,*1,"OVERALL TOTALS";
        PRINT          *N,*1,"----------------------";
        PRINT          *N,*1,"Paid     : ",XTTOTPAY;               
        PRINT          *N,*1,"Current  : ",XTTOTCUR;               
        PRINT          *N,*1,"30 Days  : ",XTTOT30;               
        PRINT          *N,*1,"60 Days  : ",XTTOT60;               
        PRINT          *N,*1,"90+ Days : ",XTTOT90;               
        PRINT          *N,*1,"--------------------------";
        PRINT          *N,*1,"Total    : ",XTTOTOUT;              
        CALL          ENDP00
        GOTO          PRTD999
.
PRTD500   PRINT         *N,*N,*N,*63,"----------",*78,"----------":
                         *93,"----------",*108,"----------":
                         *123,"----------",*N:
                         *37,"OVERALL TOTAL : ",*58,XTTOT90,*73,XTTOT60:
                         *88,XTTOT30,*103,XTTOTCUR,*118,XTTOTOUT,*N:
                         *63,"----------",*78,"----------":
                         *93,"----------",*108,"----------":
                         *123,"----------"
        CALL          ENDP00
        GOTO          PRTD999
.
PRTD520 PRINT         *N,*N,*N:
                        *18,"----------",*33,"----------":
                        *48,"----------",*63,"----------":
                        *78,"----------",*93,"----------":
                        *108,"----------",*123,"----------",*N:
                        *1,"OVERALL TOTAL":
                        *13,XTTOTCUR,*28,XTTOT30,*43,XTTOT60:
                        *58,XTTOT90,*73,XTTOT120,*88,XTTOT1YR:
                        *103,XTTOT2YR,*118,XTTOTOUT,*N:
                        *18,"----------",*33,"----------":
                        *48,"----------",*63,"----------":
                        *78,"----------",*93,"----------":
                        *108,"----------",*123,"----------"
        CALL          ENDP00
        GOTO          PRTD999
.
PRTD540 PRINT       *N,*N,*N:
                      *33,"----------":
                      *48,"----------",*63,"----------":
                      *78,"----------",*93,"----------",*108,"----------":
                      *123,"-----------",*N:
                      *10,"OVERALL TOTAL":
                      *28,XTTRE120,*43,XTTREB90,*58,XTTREB60:
                      *73,XTTREB30,*88,XTTREBCUR,*103,XTTSUBRE:
                      *118,XTTOTOUT,*N:
                      *28,XTTPA120,*43,XTTPAT90,*58,XTTPAT60:
                      *73,XTTPAT30,*88,XTTPATCUR,*103,XTTSUBPA:
                      *N,*33,"----------":
                      *48,"----------",*63,"----------":
                      *78,"----------",*93,"----------",*108,"----------":
                      *123,"----------"
        CALL          ENDP00
        GOTO          PRTD999
.
PRTD560 MOVE        XTTOTCUR,FTOTCURR
        MOVE        XTTOT30,FTOT30
        MOVE        XTTOT60,FTOT60
        MOVE        XTTOT90,FTOT90
        MOVE        XTTOT120,FTOT120
        MOVE        XTTOT1YR,FTOT1YR
        MOVE        XTTOT2YR,FTOT2YR
        MOVE        XTTOTOUT,FTOTOUT
        MOVE        XTTOTOUT,FORM8P2
.
        IF          EXPORTFL=1
          PRINT       "<tr><td>OVERALL TOTAL</td>":
                      "<td>&nbsp;</td>":
                      "<td>&nbsp;</td>":
                      "<td>&nbsp;</td>":
                      "<td>",XTTOTCUR,"</td>":
                      "<td>",XTTOT30,"</td>":
                      "<td>",XTTOT60,"</td>":
                      "<td>",XTTOT90,"</td>":
                      "<td>",XTTOT120,"</td>":
                      "<td>",XTTOT1YR,"</td>":
                      "<td>",XTTOT2YR,"</td>":
                      "<td>",FORM8P2,"</td></tr>"
        ELSE
          PRINT       *N,*N,*N:
                      *39,"-----------",*51,"-----------":
                      *63,"-----------",*75,"-----------":
                      *87,"-----------",*99,"----------":
                      *110,"----------",*121,"------------",*N:
                      *1,"OVERALL TOTAL":
                      *39,FTOTCURR,*51,FTOT30,*63,FTOT60:
                      *75,FTOT90,*87,FTOT120,*98,FTOT1YR:
                      *109,FTOT2YR,*121,FTOTOUT,*N:
                      *39,"-----------",*51,"-----------":
                      *63,"-----------",*75,"-----------":
                      *87,"-----------",*99,"----------":
                      *110,"----------",*121,"------------"
        ENDIF
        CALL          ENDP00
        GOTO          PRTD999
.
.       SVMPH layout
.
PRTD570 MOVE        XTTOTCUR,FTOTCURR
        MOVE        XTTOT30,FTOT30
        MOVE        XTTOT60,FTOT60
        MOVE        XTTOT90,FTOT90
        MOVE        XTTOT120,FTOT120
        MOVE        XTTOT1YR,FTOT1YR
        MOVE        XTTOT2YR,FTOT2YR
        MOVE        XTTOTOUT,FTOTOUT
        MOVE        XTTOTOUT,FORM8P2
.
        PRINT       "<tr><td>OVERALL TOTAL</td>":
                    "<td>&nbsp;</td>":
                    "<td>&nbsp;</td>":
                    "<td>&nbsp;</td>":
                    "<td>&nbsp;</td>":
                    "<td>&nbsp;</td>":
                    "<td>",XTTOTCUR,"</td>":
                    "<td>",XTTOT30,"</td>":
                    "<td>",XTTOT60,"</td>":
                    "<td>",XTTOT90,"</td>":
                    "<td>",XTTOT120,"</td>":
                    "<td>",XTTOT1YR,"</td>":
                    "<td>",XTTOT2YR,"</td>":
                    "<td>&nbsp;</td>":
                    "<td>",XTTOTOUT,"</td>";
.
        IF        PTCNCATB<>2
          PRINT     "<td>&nbsp;</td>";
        ENDIF
.
        PRINT       "</tr>"
.
        CALL        ENDP00
.
PRTD999 RETURN
.
.------------------------------------------------------------------------------
.       Print days report
.------------------------------------------------------------------------------
DAYR00  MOVE          ZEROVISN TO AADMNO
        CALL          RKTP0000
        BRANCH        OVRCD,DAYR80
.
        IF            CATBLAY=5 | CATBLAY=6
          IF          PASSFLAG=1
            MATCH       "x",PATFLAG
            GOTO        DAYR00 IF NOT EQUAL         * Not a Patient O/S amt
          ELSE
            IF            PASSFLAG=2
              MATCH         "y",PATFLAG
              GOTO          DAYR00 IF NOT EQUAL    * Not a debt collection debt
              MATCH         SP70,SAVAGEN
              IF            !@EQUAL
                MATCH         DEBTAGEN,SAVAGEN
                CALL          AGENT00 IF NOT EQUAL
              ENDIF
            ELSE
              MATCH         SP70,PATFLAG
              GOTO          DAYR00 IF NOT EQUAL         * Not a HF O/S amt
            ENDIF
          ENDIF
        ENDIF
.
        MOVE          D12PTELP,PTELEP
        MOVE          D12PTELB,PTELEB
        MOVE          SPINVTYP,PINVTYP
        MOVE          SPINVSYS,PINVSYS
.
.       Check for health fund range
.
        MATCH         STHFN,AFUNDH
        GOTO          DAYR00 IF LESS
.
        MATCH         AFUNDH,EDHFN
        GOTO          DAYR00 IF LESS
.
        MOVE          XUNIQUE,UNIQUE
        MOVE          XAURNO,AURNO
        MOVE          XAADMNO,AADMNO
        MOVE          PGNAME,PGNAMEDS
        MOVE          PGNAME,PGNAMED2
        MOVE          PSNAME,PSNAMEDS
.
        DISPLAY       *P39:24,*V2LON,AADMNO,*P55:24,PSNAME,*HOFF;
.
        COMPARE       SIX,CATBLAY
        GOTO          DAYR10 IF EQUAL               * SVMPH layout
        COMPARE       FIVE,CATBLAY
        GOTO          DAYR10 IF EQUAL               * Healthscope
.
        MATCH         AADMNO TO SAVADMNO
        GOTO          DAYR60 IF EQUAL
.
        MATCH         ZEROVISN,SAVADMNO
        GOTO          DAYR10 IF EQUAL
.
        PACK          FADATE WITH CCC,CYY,CMM,CDD
        REP           " 0",FADATE
.
        PACK          KEY19 WITH SAVADMNO,FADATE,SP10                  *C-79281
        CALL          RDSFACT1                                         *C-79281
.
        CALL          RDKFACT1
        BRANCH        OVRCD OF DAYR10
.
        MATCH         FADMNO,SAVADMNO
        GOTO          DAYR10 IF NOT EQUAL
.
        UNPACK        FADATE WITH XCENT1,XYEAR1,XMON1,XDAY1
        PRINT         *105,"FUTURE ACTION DATE: ",XDAY1,"/",XMON1,"/",XYEAR1
        ADD           ONE,CLNO
.
DAYR10  MOVE          XTINVAMT TO XTOTOUT
        ADD           XTOTOUT TO XTTOTOUT
        ADD           XTOTOUT,TTTOTOUT
.
        MOVE          AADMNO TO SAVADMNO
        COMPARE       TWO,PASSFLAG
        GOTO          DAYR20 IF EQUAL      * Printing Debt collector
.
        MATCH        SP70,SAVCLM
        GOTO         DAYR20 IF EQUAL
.
        MATCH        ACLMCD TO SAVCLM
        CALL         HEAD0000 IF NOT EQUAL
.
        MATCH        SP70,SAVFUND
        GOTO         DAYR20 IF EQUAL
.
        PACK         CLMFUND WITH ACLMCD,HFUND
        MATCH        CLMFUND TO SAVFUND
        CALL         HFTOT IF NOT EQUAL
.
DAYR20 BRANCH       TOTONLY OF DAYR50
.
        MOVE         CMNTLINE,DIM64
.
        MOVE         SP8 TO DIM8
        COMPARE      ZERO,DDDAY
        GOTO         DAYR30 IF EQUAL
.
        PACK         DIM8 WITH DDDAY,SLASH,DDMON,SLASH,DDYER
.
DAYR30  MOVE         SP20 TO DIM14
        MOVE         SP20,DIM13
        MATCH        SP12 TO PTELEP
        GOTO         DAYR40 IF EQUAL
.
        PACK         DIM14 WITH HD,PTELEP
        MOVE         DIM14,DIM13
.
DAYR40  COMPARE      "54" TO CLNO
        CALL         HEAD0000 IF NOT LESS
        REP          " 0",DIM8
        UNPACK       PSNAMEDS,KEY12
        OPEN         CONTROLF,"controlf"
        READ         CONTROLF,HUND10;*249,PTCNDAUR
        PACK         DIM9,AURNO,SP70
        MATCH        "1",PTCNDAUR
        IF           @EQUAL
          MOVE         AURNO,PURNO
          PACK         KEY20,SP70
          PROC         GETALIDS
          MATCH        SP70,KEY20
          IF           !@EQUAL
            UNPACK       KEY20,DIM11,DIM9
          ENDIF
        ENDIF
.
        MOVE         ZERO TO COUNT
        IF           CATBLAY=5 | CATBLAY=6
          CALL         PRNDY00
          GOTO         DAYR50
        ENDIF
.
        PRINT        *N,DIM9,*10,AADMNO,*19,KEY12,SP1,DIM8:
                     *40,XTOTOUT:
                     *56,DIM13,*69,DIM64
.
        ADD          TWO TO CLNO
.
DAYR50  MOVE         ACLMCD TO SAVCLM
        PACK         SAVFUND WITH ACLMCD,HFUND
        ADD          XTOTOUT TO XCTTOT
        ADD          XTOTOUT TO XHTTOT
        GOTO         DAYR00
.
DAYR60
        CALL          PRNDY00
        MOVE          AADMNO TO SAVADMNO
        GOTO          DAYR00
.
DAYR80  MOVE         SP3,ACLMCD
.
        COMPARE      "56" TO CLNO
        CALL         HEAD0000 IF NOT LESS
.
        IF           CATBLAY=5 | CATBLAY=6
          IF           PASSFLAG=2
            CALL         AGENT00
            GOTO         DAYR88            * Printing Deb collection agency
          ENDIF
        ENDIF
.
        BRANCH        SEPFUND OF DAYR82,DAYR84
.
DAYR82 CALL          HFTOT
.
DAYR84 BRANCH        SEPCLM OF DAYR86,DAYR88
.
DAYR86 CALL          CLMTOT
.
DAYR88  IF            CATBLAY=5 | CATBLAY=6
          MOVE          XTTOTOUT,FORM9P2
          IF            EXPORTFL=1
            PRINT         "<tr><td>OVERALL TOTAL</td>":
                          "<td>&nbsp;</td>":
                          "<td>&nbsp;</td>":
                          "<td>&nbsp;</td>":
                          "<td>&nbsp;</td>":
                          "<td>&nbsp;</td>":
                          "<td>",XTTOTOUT,"</td>";
.
            IF            CATBLAY=6
              IF            PTCNCATB<>2
                PRINT         "<td>&nbsp;</td>";
              ENDIF
            ELSE
              PRINT         "<td>&nbsp;</td>";
            ENDIF
            PRINT         "</tr>"
          ELSE
            PRINT         *N,*72,"------------":
                          *N,*55,"OVERALL TOTAL : $",*72,FORM9P2:
                          *N,*72,"------------"
          ENDIF
        ELSE
          PRINT         *N,*39,"----------------":
                        *N,*23,"OVERALL TOTAL : $",*40,XTTOTOUT:
                        *N,*39,"----------------"
        ENDIF
.
        CALL          ENDP00
DAYR99  RETURN
+
.*******************************************************************************
.           OVER CONDITION FOUND..PRINT LAST LINE OF -- AND DISPLAY MESSAGE
.*******************************************************************************
ENDP00   COMPARE   SIX,CATBLAY
         GOTO      END02 IF EQUAL         * SVMPH layout
.
         COMPARE   FIVE,CATBLAY
....     GOTO      END20 IF NOT EQUAL     * Not Healthscope layout    *D-268180
         GOTO      END30 IF NOT EQUAL     * Not Healthscope layout    *I-268180
.
END02    COMPARE   ZERO,PDBONLY
         GOTO      END20 IF NOT EQUAL     * Not printing All
.
.        Printing next section of report
.           First section - HF Invoice
.           Second section - Patient Debtor invoice
.           Third section - Debt Collection debt invoice
.
         BRANCH    PASSFLAG,END10,END20
.
         MOVE      ONE,PASSFLAG           * Processing Patient Outstanding Amt
         MOVE      SIXTY,CLNO
         UNPACK    SP70,SAVCLM,SAVFUND
         GOTO      PRTD300
.
END10    MOVE      TWO,PASSFLAG           * Processing Debt collector debt Amt
         MOVE      SIXTY,CLNO
         UNPACK    SP70,SAVCLM,SAVFUND
         GOTO      PRTD300
.
END20    BRANCH    PDBONLY,END30,END30    * print pat or collector O/S amt only
.
         CALL      TTSTD000               * Print Grand total
.
END30    BRANCH    EXPORTFL,END90
         BRANCH    PASSFLAG,END40,END40
.
         COMPARE   ZERO TO XTTOTOUT
         GOTO      END40 IF NOT EQUAL
.
         CALL      HEAD0000
         PRINT     *N,*N,"  ***  END OF REPORT  ***"
         DISPLAY   *P10:24,*EL,*V2LON:
                   "** No Report Generated **",*W2;
         GOTO      END90
.
END40    PRINT     *N,"  ***  END OF REPORT  ***"
.
         DISPLAY   *P10:24,*EL,*V2LON:
                   "** Report Generation Completed **",*W2;
.
END90    
.        CALL      DTMP0000                  * Delete records from tempfile
         CALL      KILL0000
END99    RETURN
+
.*******************************************************************************
.       Print Grand total for HEA ATB
.*******************************************************************************
TTSTD000  COMPARE   "56" TO CLNO
          CALL      HEAD0000 IF NOT LESS
.
          BRANCH    OPTION1 TO TTSTD200
.
          MOVE      TTTOTOUT,FORM9P2
          IF        EXPORTFL=1
            PRINT     "<tr><td>GRAND TOTAL</td>":
                      "<td>&nbsp;</td>":
                      "<td>&nbsp;</td>":
                      "<td>&nbsp;</td>":
                      "<td>&nbsp;</td>":
                      "<td>&nbsp;</td>":
                      "<td>",TTTOTOUT,"</td>";
            IF        CATBLAY=6
              IF        PTCNCATB<>2
                PRINT     "<td>&nbsp;</td>";
              ENDIF
            ELSE
              PRINT   "<td>&nbsp;</td>";
            ENDIF
            PRINT     "</tr>"
          ELSE
            PRINT     *N,*72,"------------":
                      *N,*55,"GRAND TOTAL : $",*72,FORM9P2:
                      *N,*72,"------------"
          ENDIF
          GOTO      TTSTD800
.
.         Full report
.
TTSTD200  COMPARE     SIX,CATBLAY
          GOTO        TTSTD400 IF EQUAL        * SVMPH layout
.
          MOVE        TTTOTCUR,FTOTCURR
          MOVE        TTTOT30,FTOT30
          MOVE        TTTOT60,FTOT60
          MOVE        TTTOT90,FTOT90
          MOVE        TTTOT120,FTOT120
          MOVE        TTTOT1YR,FTOT1YR
          MOVE        TTTOT2YR,FTOT2YR
          MOVE        TTTOTOUT,FTOTOUT
          IF          EXPORTFL=1
            PRINT       "<tr><td>TOTAL</td>":
                        "<td>&nbsp;</td>":
                        "<td>&nbsp;</td>":
                        "<td>&nbsp;</td>":
                        "<td>",TTTOTCUR,"</td>":
                        "<td>",TTTOT30,"</td>":
                        "<td>",TTTOT60,"</td>":
                        "<td>",TTTOT90,"</td>":
                        "<td>",TTTOT120,"</td>":
                        "<td>",TTTOT1YR,"</td>":
                        "<td>",TTTOT2YR,"</td>":
                        "<td>",TTTOTOUT,"</td></tr>"
          ELSE
            PRINT       *N,*N,*N:
                        *39,"-----------",*51,"-----------":
                        *63,"-----------",*75,"-----------":
                        *87,"-----------",*99,"----------":
                        *110,"----------",*121,"------------",*N:
                        *1,"TOTAL":
                        *39,FTOTCURR,*51,FTOT30,*63,FTOT60:
                        *75,FTOT90,*87,FTOT120,*98,FTOT1YR:
                        *109,FTOT2YR,*121,FTOTOUT,*N:
                        *39,"-----------",*51,"-----------":
                        *63,"-----------",*75,"-----------":
                        *87,"-----------",*99,"----------":
                        *110,"----------",*121,"------------"
          ENDIF
          GOTO      TTSTD800
.
.         SVMPH layout
.
TTSTD400  MOVE      TTTOTCUR,FTOTCURR
          MOVE      TTTOT30,FTOT30
          MOVE      TTTOT60,FTOT60
          MOVE      TTTOT90,FTOT90
          MOVE      TTTOT120,FTOT120
          MOVE      TTTOT1YR,FTOT1YR
          MOVE      TTTOT2YR,FTOT2YR
          MOVE      TTTOTOUT,FTOTOUT
.
          PRINT      "<tr><td>TOTAL</td>":
                     "<td>&nbsp;</td>":
                     "<td>&nbsp;</td>":
                     "<td>&nbsp;</td>":
                     "<td>&nbsp;</td>":
                     "<td>&nbsp;</td>":
                     "<td>",TTTOTCUR,"</td>":
                     "<td>",TTTOT30,"</td>":
                     "<td>",TTTOT60,"</td>":
                     "<td>",TTTOT90,"</td>":
                     "<td>",TTTOT120,"</td>":
                     "<td>",TTTOT1YR,"</td>":
                     "<td>",TTTOT2YR,"</td>":
                     "<td>&nbsp;</td>":
                     "<td>",TTTOTOUT,"</td>";
.
          IF       PTCNCATB<>2
            PRINT       "<td>&nbsp;</td>";
          ENDIF
          PRINT       "</tr>"
.
          GOTO      TTSTD800
.
TTSTD800  MOVE      ZERO,TTTOTCUR
          MOVE      ZERO,TTTOT30
          MOVE      ZERO,TTTOT60
          MOVE      ZERO,TTTOT90
          MOVE      ZERO,TTTOT120
          MOVE      ZERO,TTTOT1YR
          MOVE      ZERO,TTTOT2YR
          MOVE      ZERO,TTTOTOUT
          GOTO      TTSTD999
.
TTSTD999  RETURN
+
.*******************************************************************************
.         Check Reassign debt file
.*******************************************************************************
REAS0000  
          PACK      KEY10,PINVNO,Z70
          CALL      RSPTRAS1
          CALL      RPPTRAS1
          BRANCH    OVRCD,REAS9000
.
          MATCH     PINVNO,PTRAINVN          * Same invoice number?
          GOTO      REAS9000 IF NOT EQUAL
          MATCH     "1",PTRADELE             * Deleted?
          GOTO      REAS9000 IF EQUAL
.
          MOVE      ONE,DEBTTYPE            * Flag for patient debt
.
.         Check for Debt collector debt
.
          MATCH     SP70,PTRARMOV
          GOTO      REAS2000 IF EQUAL        * No reason for debt movement
.
          PACK      DIM5,TCODE,ACODE,SP70   * Save key for code file
          MOVE      "dm",KEY2
          PACK      KEY5,KEY2,PTRARMOV
          CALL      RDCODE1
          IF        OVRCD=0
            MATCH     "D",TCINDC1
            IF        @EQUAL
              MOVE      TWO,DEBTTYPE          * Flag for Debt Collector
              MOVE      PTRADBAG,DEBTAGEN     * Debt Collection Agency
            ENDIF
          ENDIF
          MOVE      DIM5,KEY5
          CALL      RDCODE1                   * Reposition
.
REAS2000  ADD       PTRAPPOR,PPORTION
          GOTO      REAS9999
.
REAS9000  MOVE      ZERO,PTRAPPOR
.
REAS9999  RETURN
+
.*******************************************************************************
.         Write patient outstanding amount
.*******************************************************************************
WAMT0000  BRANCH    OPTION1 TO WAMT1000
          GOTO      WAMT9000
.
.         Full Report
.
WAMT1000  MOVE      ZERO,PATCURR
          MOVE      ZERO,PAT30
          MOVE      ZERO,PAT60
          MOVE      ZERO,PAT90
          MOVE      ZERO,PAT120
          MOVE      ZERO,PAT1YR
          MOVE      ZERO,PAT2YR
.
          COMPARE   ZERO,XTOTCURR
          GOTO      WAMT1200 IF EQUAL
.
          MOVE      PPORTION,PATCURR
          SUB       PPORTION,XTOTCURR
.         IF        XTOTCURR<0
.           MOVE      ZERO,XTOTCURR
.         ENDIF
          GOTO      WAMT8000
.
WAMT1200  COMPARE   ZERO,XTOT30
          GOTO      WAMT2000 IF EQUAL
.
          MOVE      PPORTION,PAT30
          SUB       PPORTION,XTOT30
.         IF        XTOT30<0
.           MOVE      ZERO,XTOT30
.         ENDIF
          GOTO      WAMT8000
.
WAMT2000  COMPARE   ZERO,XTOT60
          GOTO      WAMT3000 IF EQUAL
.
          MOVE      PPORTION,PAT60
          SUB       PPORTION,XTOT60
.         IF        XTOT60<0
.           MOVE      ZERO,XTOT60
.         ENDIF
          GOTO      WAMT8000
.
WAMT3000  COMPARE   ZERO,XTOT90
          GOTO      WAMT4000 IF EQUAL
.
          MOVE      PPORTION,PAT90
          SUB       PPORTION,XTOT90
.         IF        XTOT90<0
.           MOVE      ZERO,XTOT90
.         ENDIF
          GOTO      WAMT8000
.
WAMT4000  COMPARE   ZERO,XTOT120
          GOTO      WAMT5000 IF EQUAL
.
          MOVE      PPORTION,PAT120
          SUB       PPORTION,XTOT120
.         IF        XTOT120<0
.           MOVE      ZERO,XTOT120
.         ENDIF
          GOTO      WAMT8000
.
WAMT5000  COMPARE   ZERO,XTOT1YR
          GOTO      WAMT6000 IF EQUAL
.
          MOVE      PPORTION,PAT1YR
          SUB       PPORTION,XTOT1YR
.         IF        XTOT1YR<0
.           MOVE      ZERO,XTOT1YR
.         ENDIF
          GOTO      WAMT8000
.
WAMT6000  COMPARE   ZERO,XTOT2YR
          GOTO      WAMT8000 IF EQUAL
.
          MOVE      PPORTION,PAT2YR
          SUB       PPORTION,XTOT2YR
.         IF        XTOT2YR<0
.           MOVE      ZERO,XTOT2YR
.         ENDIF
.
WAMT8000  MOVE      PATCURR,PPORTION
          ADD       PAT30,PPORTION
          ADD       PAT60,PPORTION
          ADD       PAT90,PPORTION
          ADD       PAT120,PPORTION
          ADD       PAT1YR,PPORTION
          ADD       PAT2YR,PPORTION
          SUB       PPORTION,XTOTOUT
.
          IF        DEBTTYPE=1
            MOVE      "x",PATFLAG          * flag for Patient outstanding record
          ELSE
            IF        DEBTTYPE=2
              MOVE      "y",PATFLAG       * flag for Debt Collection
            ENDIF
          ENDIF
          CALL      WRTP0000             * Write to tempfile
.
          GOTO      WAMT9999
.
.         Current or 30, 60, 90 days
.
WAMT9000  IF        PTRAPPOR <> 0
            MOVE      PTRAPPOR,XTINVAMT
            IF        DEBTTYPE=1
              MOVE      "x",PATFLAG        * flag for Patient outstanding record
            ELSE
              IF        DEBTTYPE=2
                MOVE      "y",PATFLAG        * flag for Debt Collection record
              ENDIF
            ENDIF
            CALL      WRTP0000             * Write to tempfile
.
            MOVE      F12P2,XTINVAMT
            SUB       PTRAPPOR,XTINVAMT
          ENDIF
.
WAMT9999  RETURN
+
.*******************************************************************************
.     PRINT ACTUAL DATA 
.*******************************************************************************
PRNDY00   BRANCH    TOTONLY OF PRNDY99
          COMPARE   "55",CLNO
          CALL      HEAD0000 IF NOT LESS
.
          MOVE      SP20 TO DIM14
          MOVE      SP20,DIM13
          ADD       ONE TO COUNT
          COMPARE   ONE TO COUNT
          GOTO      PRNDY10 IF EQUAL
.
          MOVE      SP6 TO PTITL
..         MOVE      SP30 TO PGNAME
..         MOVE      SP30,PGNAMEDS
..         MOVE      SP30,PGNAMED2
..         MOVE      SP6 TO AFUNDH
..         MOVE      SP8 TO AFNDTB
..         MOVE      SP10 TO AFNDMM
          MOVE      SP3,REMLSTL
          MOVE      SP8,LSTLDAT
          GOTO      PRNDY20
.
PRNDY10   MATCH     SP12 TO PTELEB
          GOTO      PRNDY20 IF EQUAL
.
          PACK      DIM14 WITH BD,PTELEB
          MOVE      DIM14,DIM13
.
PRNDY20   MOVE      SP3,DIM3
          LOAD      DIM3 USING PINVTYP OF DINS
.
          MOVE      AFNDTB,DIM5
          MOVE      XTINVAMT,TINVAMT
.
          MOVE      PGNAME,ANS
          MOVE      ".",KEY1
          PACK      KEY20,ANS,KEY1,PSNAMEDS,SP70
          COMPARE   SIX,CATBLAY
          GOTO      PRNDY40 IF NOT EQUAL
.
          MOVE      XTINVAMT,FORM9P2
.
.         SVMPH layout
.
          MOVE      SP70,PDIM8
          COMPARE   ZERO,DDDAY
          GOTO      PRNDY30 IF EQUAL
.
          PACK      PDIM8 WITH DDDAY,SLASH,DDMON,SLASH,DDYER
          REP       " 0",PDIM8
.
PRNDY30   PRINT     "<tr><td>&nbsp;",AFUNDH,"</td>":
                    "<td>&nbsp;",PTITL,SP1,PGNAMEDS,"</td>":
                    "<td>&nbsp;",AURNO,"</td>":
                    "<td>&nbsp;",SAVADMNO,"</td>":
                    "<td>",PDIM8,"</td>":
                    "<td>&nbsp;",TINVNO,"</td>":
                    "<td>&nbsp;",FORM9P2,"</td>";
.
          IF        PASSFLAG=2
            MOVE      DEBTAGEN,SAVAGEN
          ENDIF
          MOVE      SAVADMNO,DIM8A
          IF        PTCNCATB<>2
            CALL      PRCM0000              * Printing comments
          ENDIF
          PRINT     "</tr>"
          GOTO      PRNDY80
.
PRNDY40   COMPARE   FIVE,CATBLAY
          GOTO      PRNDY50 IF NOT EQUAL
.
          MOVE      XTINVAMT,FORM9P2
          IF        EXPORTFL=1
            PACK      KEY8,XDAY,SLASH,XMON,SLASH,XYEAR
            REP       " 0",KEY8
            PRINT     "<tr><td>&nbsp;",AFUNDH,"</td>":
                      "<td>&nbsp;",KEY20,"</td>":
                      "<td>&nbsp;",SAVADMNO,"</td>":
                      "<td>&nbsp;",TINVNO,"</td>":
                      "<td>&nbsp;",KEY8,"</td>":
                      "<td>&nbsp;",DAGED,"</td>":
                      "<td>",FORM9P2,"</td>";
          ELSE
            PRINT     *1,AFUNDH,*10,KEY20,*34,SAVADMNO,*44,TINVNO:
                      *54,XDAY,SLASH,XMON,SLASH,XYEAR,*66,DAGED:
                      *72,FORM9P2;
            ADD       ONE,CLNO
          ENDIF
.
          IF        PASSFLAG=2
            MOVE      DEBTAGEN,SAVAGEN
          ENDIF
          MOVE      SAVADMNO,DIM8A
          CALL      PRCM0000              * Printing comments
          IF        EXPORTFL=1
            PRINT     "</tr>"
          ENDIF
          GOTO      PRNDY80
.
PRNDY50   PRINT     *19,PTITL,SP1,PGNAMEDS,*41,DIM13:
                    *61,DIM3,TINVNO,*73,XDAY,SLASH,XMON,SLASH,XYEAR:
                    *81,XTINVAMT,*98,AFUNDH,SP1,DIM5:
                    *110,AFNDMM:
                    *121,REMLSTL,*125,LSTLDAT
          ADD       ONE,CLNO
.
PRNDY80   ADD       XTOTCURR TO DTOTCURR
          ADD       XTOT30 TO DTOT30
          ADD       XTOT60 TO DTOT60
          ADD       XTOT90 TO DTOT90
          ADD       XTOT120 TO DTOT120
          ADD       XTOT1YR TO DTOT1YR
          ADD       XTOT2YR TO DTOT2YR
          ADD       XTOTOUT TO DTOTOUT
.
PRNDY99   RETURN
.
.*******************************************************************************
.         Print full data
.*******************************************************************************
PRINTFUL  COMPARE   TWO,PASSFLAG
          GOTO      PRINTFUA IF EQUAL      * Printing Deb collection agency
.
          MATCH     ACLMCD TO SAVCLM
          CALL      HEAD0000 IF NOT EQUAL
.
          PACK      CLMFUND WITH ACLMCD,HFUND
.
          MATCH     CLMFUND TO SAVFUND
          CALL      HFTOT IF NOT EQUAL
.
PRINTFUA  BRANCH    TOTONLY OF PRINTFU8
.
          COMPARE   "56",CLNO
          CALL      HEAD0000 IF NOT LESS
.
          MOVE      SP8 TO PDIM8
          MOVE      SP8 TO DIM8
          MOVE      SP10 TO PDIM10
          MOVE      SP10 TO DIM10
.
          COMPARE   ZERO TO ADDAY
          GOTO      PRINTFU0 IF EQUAL
.
          PACK      DIM8 WITH ADDAY,SLASH,ADMON,SLASH,ADYER
          REP       " 0",DIM8
          PACK      DIM10 WITH ADDAY,SLASH,ADMON,SLASH,ADCEN,ADYER
          REP       " 0",DIM10
.
          COMPARE   ZERO,DDDAY
          GOTO      PRINTFU0 IF EQUAL
.
          PACK      PDIM8 WITH DDDAY,SLASH,DDMON,SLASH,DDYER
          REP       " 0",PDIM8
          PACK      PDIM10 WITH DDDAY,SLASH,DDMON,SLASH,DDCEN,DDYER
          REP       " 0",PDIM10
.
PRINTFU0  BRANCH    CATBLAY OF PRINTFU1,PRINTFU2,PRINTFU2,PRINTFU4,PRINTFU5:
                               PRINTFU6
.
          UNPACK    PNAME,KEY13
          OPEN      CONTROLF,"controlf"
          READ      CONTROLF,HUND10;*249,PTCNDAUR
          PACK      DIM9,AURNO,SP70
          MATCH     "1",PTCNDAUR
          IF        @EQUAL
            MOVE      AURNO,PURNO
            PACK      KEY20,SP70
            PROC      GETALIDS
            MATCH     SP70,KEY20
            IF        !@EQUAL
              UNPACK    KEY20,DIM11,DIM9
            ENDIF
          ENDIF
.
          PRINT     *1,DIM9,*10,AADMNO,*19,KEY13,*32,PDIM10:
                    *43,XTOTPAID,*58,XTOTCURR,*73,XTOT30:
                    *88,XTOT60,*103,XTOT90,*118,XTOTOUT
          ADD       ONE,CLNO
.
          IF        OPTION1=1
            MOVE      AADMNO,DIM8A
            PERFORM   PRTADCOM,PRCM0000     * Check if printing comments
          ENDIF
.
          GOTO      PRINTFU8
.
PRINTFU1  UNPACK    PSNAME,KEY10
          UNPACK    PGNAMED2,KEY11
          PRINT     *1,AADMNO,*10,KEY10,SP1,KEY11,*33,ATYPE:
                    *37,DIM10,*48,PDIM10:
                    *58,XTOT90,*73,XTOT60:
                    *88,XTOT30,*103,XTOTCURR,*118,XTOTOUT
          ADD       ONE,CLNO
.
          GOTO      PRINTFU8
.
PRINTFU2  OPEN      CONTROLF,"controlf"
          READ      CONTROLF,HUND10;*249,PTCNDAUR
          PACK      DIM9,AURNO,SP70
          MATCH     "1",PTCNDAUR
          IF        @EQUAL
            MOVE      AURNO,PURNO
            PACK      KEY20,SP70
            PROC      GETALIDS
            MATCH     SP70,KEY20
            IF        !@EQUAL
              UNPACK    KEY20,DIM11,DIM9
            ENDIF
          ENDIF
.
          PRINT     *1,DIM9:
                    *13,XTOTCURR:
                    *28,XTOT30,*43,XTOT60,*58,XTOT90,*73,XTOT120:
                    *88,XTOT1YR,*103,XTOT2YR,*118,XTOTOUT
.
          PRINT     *1,AADMNO,*10,PNAMEDIS
          ADD       TWO,CLNO
.
          GOTO      PRINTFU8
.
.         Melbourne Clinic ATB
.
PRINTFU4  UNPACK    PNAMEDS2,KEY13
          OPEN      CONTROLF,"controlf"
          READ      CONTROLF,HUND10;*249,PTCNDAUR
          PACK      DIM9,AURNO,SP70
          MATCH     "1",PTCNDAUR
          IF        @EQUAL
            MOVE      AURNO,PURNO
            PACK      KEY20,SP70
            PROC      GETALIDS
            MATCH     SP70,KEY20
            IF        !@EQUAL
              UNPACK    KEY20,DIM11,DIM9
            ENDIF
          ENDIF
.
          PRINT     *1,DIM9,*10,KEY13,*24,SACLM:
                    *28,XTREB120,*43,XTREB90,*58,XTREB60,*73,XTREB30:
                    *88,XTREBCUR,*103,XTSUBREB,*118,XTOTOUT:
                    *N,*1,AADMNO:
                    *22,SHFUND:
                    *28,XTPAT120,*43,XTPAT90,*58,XTPAT60,*73,XTPAT30:
                    *88,XTPATCUR,*103,XTSUBPAT,*N:
                    *10,DIM10,"->",PDIM10
          ADD       THREE,CLNO
.
          GOTO      PRINTFU8
.
.         Healthscope
.
PRINTFU5  MOVE      PGNAME,ANS
          MOVE      ".",KEY1
          PACK      KEY14,ANS,KEY1,PSNAME,SP70
          PACK      KEY12,ANS,KEY1,PSNAME,SP70
          MOVE      SHFUND,D6FUND
.
          MOVE      XTOTCURR,FTOTCURR
          MOVE      XTOT30,FTOT30
          MOVE      XTOT60,FTOT60
          MOVE      XTOT90,FTOT90
          MOVE      XTOT120,FTOT120
          MOVE      XTOT1YR,FTOT1YR
          MOVE      XTOT2YR,FTOT2YR
          MOVE      XTOTOUT,FTOTOUT
.
          IF        EXPORTFL=1
            PRINT     "<tr><td>&nbsp;",SHFUND,"</td>":
                      "<td>",KEY14,"</td>":
                      "<td>",AURNO,"</td>":
                      "<td>",AADMNO,"</td>":
                      "<td>",FTOTCURR,"</td>":
                      "<td>",FTOT30,"</td>":
                      "<td>",FTOT60,"</td>":
                      "<td>",FTOT90,"</td>":
                      "<td>",FTOT120,"</td>":
                      "<td>",FTOT1YR,"</td>":
                      "<td>",FTOT2YR,"</td>":
                      "<td>",FTOTOUT,"</td></tr>"
          ELSE
            PRINT     *1,D6FUND,*8,KEY12,*21,AURNO,*30,AADMNO:
                      *39,FTOTCURR:
                      *51,FTOT30,*63,FTOT60,*75,FTOT90,*87,FTOT120:
                      *98,FTOT1YR,*109,FTOT2YR,*121,FTOTOUT
            ADD       ONE,CLNO                                        *C-205647
          ENDIF
.
          GOTO      PRINTFU8
.
.         SVMPH layout
.
PRINTFU6  MOVE      XTOTCURR,FTOTCURR
          MOVE      XTOT30,FTOT30
          MOVE      XTOT60,FTOT60
          MOVE      XTOT90,FTOT90
          MOVE      XTOT120,FTOT120
          MOVE      XTOT1YR,FTOT1YR
          MOVE      XTOT2YR,FTOT2YR
          MOVE      XTOTOUT,FTOTOUT
.
          MOVE      SP70,DIM8
          IF        DDDAY<>0
            PACK      DIM8 WITH DDDAY,SLASH,DDMON,SLASH,DDYER,SP70
            REP       " 0",DIM8
          ENDIF
          MOVE      PGNAME,ANS
          MOVE      ".",KEY1
          PACK      KEY14,ANS,KEY1,PSNAME,SP70
.
          PRINT     "<tr><td>&nbsp;",SHFUND,"</td>":
                    "<td>",KEY14,"</td>":
                    "<td>",AURNO,"</td>":
                    "<td>",AADMNO,"</td>":
                    "<td>&nbsp;",DIM8,"</td>":
                    "<td>",TINVNO,"</td>":
                    "<td>",FTOTCURR,"</td>":
                    "<td>",FTOT30,"</td>":
                    "<td>",FTOT60,"</td>":
                    "<td>",FTOT90,"</td>":
                    "<td>",FTOT120,"</td>":
                    "<td>",FTOT1YR,"</td>":
                    "<td>",FTOT2YR,"</td>":
                    "<td>",XTOTPAID,"</td>":
                    "<td>&nbsp;",FTOTOUT,"</td>";
.
          MOVE      AADMNO,DIM8A
          IF        PTCNCATB<>2
            CALL      PRCM0000              * Check if printing comments
          ENDIF
          PRINT     "</tr>"
          GOTO      PRINTFU8
.
PRINTFU8  ADD       XTOTPAID TO XTTOTPAY
          ADD       XTOTCURR TO XTTOTCUR
          ADD       XTOT30 TO XTTOT30
          ADD       XTOT60 TO XTTOT60
          ADD       XTOT90 TO XTTOT90
          ADD       XTOT120 TO XTTOT120
          ADD       XTOT1YR TO XTTOT1YR
          ADD       XTOT2YR TO XTTOT2YR
          ADD       XTOTOUT TO XTTOTOUT
          ADD       XTOTPAID TO XCTPAID
          ADD       XTOTCURR TO XCTCURR
          ADD       XTOT30 TO XCT30
          ADD       XTOT60 TO XCT60
          ADD       XTOT90 TO XCT90
          ADD       XTOT120 TO XCT120
          ADD       XTOT1YR TO XCT1YR
          ADD       XTOT2YR TO XCT2YR
          ADD       XTOTOUT TO XCTTOT
          ADD       XTOTPAID TO XHTPAID
          ADD       XTOTCURR TO XHTCURR
          ADD       XTOT30 TO XHT30
          ADD       XTOT60 TO XHT60
          ADD       XTOT90 TO XHT90
          ADD       XTOT120 TO XHT120
          ADD       XTOT1YR TO XHT1YR
          ADD       XTOT2YR TO XHT2YR
          ADD       XTOTOUT TO XHTTOT
          MOVE      ACLMCD TO SAVCLM
          PACK      SAVFUND WITH ACLMCD,HFUND
          IF        PASSFLAG=2
            MOVE      DEBTAGEN,SAVAGEN
          ENDIF
.
          ADD       XTOTCURR,TTTOTCUR
          ADD       XTOT30,TTTOT30
          ADD       XTOT60,TTTOT60
          ADD       XTOT90,TTTOT90
          ADD       XTOT120,TTTOT120
          ADD       XTOT1YR,TTTOT1YR
          ADD       XTOT2YR,TTTOT2YR
          ADD       XTOTOUT,TTTOTOUT
.
.         Melbourne clinic
.
          ADD       XTREBCUR,XTTREBCR
          ADD       XTPATCUR,XTTPATCR
          ADD       XTREB30,XTTREB30
          ADD       XTPAT30,XTTPAT30
          ADD       XTREB60,XTTREB60
          ADD       XTPAT60,XTTPAT60
          ADD       XTREB90,XTTREB90
          ADD       XTPAT90,XTTPAT90
          ADD       XTREB120,XTTRE120
          ADD       XTPAT120,XTTPA120
          ADD       XTSUBREB,XTTSUBRE
          ADD       XTSUBPAT,XTTSUBPA
.
          ADD       XTREBCUR,XCREBCUR
          ADD       XTPATCUR,XCPATCUR
          ADD       XTREB30,XCREB30
          ADD       XTPAT30,XCPAT30
          ADD       XTREB60,XCREB60
          ADD       XTPAT60,XCPAT60
          ADD       XTREB90,XCREB90
          ADD       XTPAT90,XCPAT90
          ADD       XTREB120,XCREB120
          ADD       XTPAT120,XCPAT120
          ADD       XTSUBREB,XCSUBREB
          ADD       XTSUBPAT,XCSUBPAT
.
          ADD       XTREBCUR,XHREBCUR
          ADD       XTPATCUR,XHPATCUR
          ADD       XTREB30,XHREB30
          ADD       XTPAT30,XHPAT30
          ADD       XTREB60,XHREB60
          ADD       XTPAT60,XHPAT60
          ADD       XTREB90,XHREB90
          ADD       XTPAT90,XHPAT90
          ADD       XTREB120,XHREB120
          ADD       XTPAT120,XHPAT120
          ADD       XTSUBREB,XHSUBREB
          ADD       XTSUBPAT,XHSUBPAT
.
          ADD       XTOTCURR TO DTOTCURR
          ADD       XTOT30 TO DTOT30
          ADD       XTOT60 TO DTOT60
          ADD       XTOT90 TO DTOT90
          ADD       XTOT120 TO DTOT120
          ADD       XTOT1YR TO DTOT1YR
          ADD       XTOT2YR TO DTOT2YR
          ADD       XTOTOUT TO DTOTOUT
PRINTFU9  RETURN
+
.*******************************************************************************
.                 HEADINGS FOR OUTPUT
.*******************************************************************************
HEAD0000  BRANCH    EXPORTFL,HEAD9000
.
          COMPARE   ZERO TO CPAGENO
          GOTO      HEAD1000 IF EQUAL
.
          COMPARE   TWO,PASSFLAG
          GOTO      HEAD1000 IF EQUAL      * Printing Deb collection agency
.
          MATCH     SP70,SAVFUND
          GOTO      HEAD1000 IF EQUAL
.
          PACK      CLMFUND WITH ACLMCD,HFUND
.
          MATCH     CLMFUND TO SAVFUND
          CALL      HFTOT IF NOT EQUAL
.
          MATCH     SP70,SAVCLM
          GOTO      HEAD1000 IF EQUAL
.
          MATCH     ACLMCD TO SAVCLM
          CALL      CLMTOT IF NOT EQUAL
.
HEAD1000  MOVE      ONE,CNOUNDLN
          CALL      IBACLOCK
.
          BRANCH    TOTONLY OF HEAD1400
.
          BRANCH    OPTION OF HEAD1100,HEAD1200,HEAD1300
.
HEAD1100  MOVE      "U/R NUMBER SEQUENCE",CPHDROPT
          GOTO      HEAD3000
.
HEAD1200  MOVE      "SURNAME SEQUENCE",CPHDROPT
          GOTO      HEAD3000
.
HEAD1300  MOVE      "ADM NUMBER SEQUENCE",CPHDROPT
          GOTO      HEAD3000
.
HEAD1400  MOVE      "TOTALS ONLY SELECTED",CPHDROPT
.
HEAD3000  CALL      HEAD132                 
          IF        IBCNMHOS =1
            PRINT     *40,"Hospital : ",PTHSHOSP,"    ",PTHSNAME
            MOVE      FOUR,CLNO
          ELSE
            MOVE      TWO,CLNO
          ENDIF
.
          CLOCK     TIME,CTIMEIS
.
          MOVE      SP30 TO TDESC
.
          COMPARE   ONE,SEPCLM
          GOTO      HEAD3200 IF NOT EQUAL
.
          PACK      KEY5 WITH CODECL,ACLMCD
          CALL      RDCODE1
.
HEAD3200  BRANCH    OPTION1 TO HEAD4200
.
          PACK      DIM10,IDAY,SLASH,IMON,SLASH,ICENT,IYEAR
          REP       " 0",DIM10
.
          BRANCH    SEPCLM OF HEAD3400,HEAD3500
.
HEAD3400  IF        CATBLAY=5
            PRINT     *1,"Claim Type : ",ACLMCD," ",TDESC;
            IF        PASSFLAG=1
              PRINT     *45,"PATIENT DEBTORS OUTSTANDING FOR ",SDIM9;
            ELSE
              IF        PASSFLAG=2
                PRINT     *45,"DEBT COLLECTION DEBTORS OUTSTANDING FOR ",SDIM9;
              ELSE
                PRINT     *45,"HEALTH FUND DEBTORS OUTSTANDING FOR ",SDIM9;
              ENDIF
            ENDIF
            PRINT     "    AS AT : ",DIM10:
                      *N,"Health Fund Range : ",FRHFN," to ",TOHFN;
            ADD       FOUR,CLNO
          ELSE
            PRINT     *1,"Claim Type : ",ACLMCD," ",TDESC:
                      *45,"DEBTORS OUTSTANDING FOR ",SDIM9:
                      "    AS AT : ",DIM10:
                      *N,"Health Fund Range : ",FRHFN," to ",TOHFN;
            ADD       TWO,CLNO
          ENDIF
          GOTO      HEAD3600
.
HEAD3500  IF        CATBLAY=5
            PRINT     *1,"Claim Range : ",FRCLM," to ",TOCLM;
            IF        PASSFLAG=1
              PRINT     *45,"PATIENT DEBTORS OUTSTANDING FOR ",SDIM9;
            ELSE
              IF        PASSFLAG=2
                PRINT     *45,"DEBT COLLECTION DEBTORS OUTSTANDING FOR ",SDIM9;
              ELSE
                PRINT     *45,"HEALTH FUND DEBTORS OUTSTANDING FOR ",SDIM9;
              ENDIF
            ENDIF
            PRINT     "    AS AT : ",DIM10:
                      *N,"Health Fund Range : ",FRHFN," to ",TOHFN;
            ADD       FOUR,CLNO
          ELSE
            PRINT     *1,"Claim Range : ",FRCLM," to ",TOCLM:
                      *45,"DEBTORS OUTSTANDING FOR ",SDIM9:
                      "    AS AT : ",DIM10:
                      *N,"Health Fund Range : ",FRHFN," to ",TOHFN;
            ADD       TWO,CLNO
          ENDIF
.
HEAD3600  BRANCH    OPTION TO HEAD3700,HEAD3800,HEAD3700
.
HEAD3700  PRINT     *N,*45,DSYST:
                    *N,*45,DOUTXTRA
          ADD       THREE,CLNO
          GOTO      HEAD3900
.
HEAD3800  MATCH     SP30,STARTNM
          IF        @EQUAL
            PRINT     *N,"Starting Surname : Start",*45,DSYST
          ELSE
            PRINT     *N,"Starting Surname : ",STARTNM,*45,DSYST
          ENDIF
          MATCH     Z30,ENDNAM
          IF        @EQUAL
            PRINT     "Ending Surname   : Finish",*45,DOUTXTRA
          ELSE
            PRINT     "Ending Surname   : ",ENDNAM,*45,DOUTXTRA
          ENDIF
          ADD       THREE,CLNO
.
HEAD3900  COMPARE  FIVE,CATBLAY
          GOTO     HEAD4000 IF EQUAL        * Healthscope layout
.
          PRINT    *N,*3,"U/R",*12,"Adm.",*32,"Dischrge":
                   *48,SDIM9,*56,"Tel.",*65,"Invoice":
                   *73,"Invoice":
                   *89,"Invoice",*98,"Membership Details":
                   *121,"Last Letter",*N:
                   *1," Number   Number ",*19,"Patient Name",*35," Date":
                   *44,"Outstanding",*56,"Number":
                   *65,"Number",*76,"Date":
                   *85,"Outstanding",*98,"Fund  Table":
                   *110,"Mem.No.",*121,"Code Sent",*N:
                   *1,"-------- --------",*19,"------------":
                   *32,"--------":
                   *44,"--------------",*56,"--------",*65,"-------":
                   *73,"--------":
                   *85,"------------",*98,"----  -----":
                   *110,"-------",*121,"------------"
.
          ADD       FOUR,CLNO
          GOTO      HEAD9000
.
HEAD4000  PRINT    *N,*1,"Health",*9,"Name (Initial,",*33," Adm",*43,"Invoice":
                   *53,"Invoice";
.
          IF        OPTION1=2
            PRINT    *65,"Current";
          ELSE
            IF        OPTION1=3
              PRINT    *65," 30";
            ELSE
              IF        OPTION1=4
                PRINT    *65," 60";
              ELSE
                PRINT    *65," 90+";
              ENDIF
            ENDIF
          ENDIF
.
          PRINT    *N,*1,"Fund",*9,"Surname)",*33,"  No",*43,"  No ":
                   *53," Date":
                   *65,"Days",*76,"Total",*85,"Comments":
                   *N,*1,"------",*9,"--------------",*33,"------":
                   *43,"-------",*53,"-------",*65,"----",*72,"------------":
                   *85,"---------------------------------------------"
.
          ADD       FOUR,CLNO
          GOTO      HEAD9000
.
HEAD4200  PACK      DIM10,IDAY,SLASH,IMON,SLASH,ICENT,IYEAR
          REP       " 0",DIM10
          BRANCH    SEPCLM OF HEAD4300,HEAD4400
.
HEAD4300  IF        CATBLAY=5
            PRINT     *1,"Claim Type : ",ACLMCD," ",TDESC;
            IF        PASSFLAG=1
              PRINT     *45,"PATIENT DEBTORS OUTSTANDING AS AT : ",DIM10,*N;
            ELSE
              IF        PASSFLAG=2
                PRINT     *45,"DEBT COLLECTION DEBTORS OUTSTANDING AS AT : ":
                          DIM10,*N;
              ELSE
                PRINT     *45,"HEALTH FUND OUTSTANDING AS AT : ",DIM10,*N;
              ENDIF
            ENDIF
            PRINT     *1,"Health Fund Range : ",*+,FRHFN," to ",TOHFN
            ADD       FOUR,CLNO
          ELSE
            PRINT     *1,"Claim Type : ",ACLMCD," ",TDESC:
                      *45,"AS AT : ",DIM10,*N:
                      *1,"Health Fund Range : ",*+,FRHFN," to ",TOHFN
            ADD       TWO,CLNO
          ENDIF
          GOTO      HEAD4500
.
HEAD4400  IF        CATBLAY=5
            PRINT     *1,"Claim Range : ",FRCLM," to ",TOCLM;
            IF        PASSFLAG=1
              PRINT     *45,"PATIENT DEBTORS OUTSTANDING AS AT : ",DIM10,*N;
            ELSE
              IF        PASSFLAG=2
                PRINT     *45,"DEBT COLLECTION DEBTORS OUTSTANDING AS AT : ":
                          DIM10,*N;
              ELSE
                PRINT     *45,"HEALTH FUND OUTSTANDING AS AT : ",DIM10,*N;
              ENDIF
            ENDIF
            PRINT     *1,"Health Fund Range : ",*+,FRHFN," to ",TOHFN
            ADD     FOUR,CLNO
          ELSE
            PRINT     *1,"Claim Range : ",FRCLM," to ",TOCLM:
                      *45,"AS AT : ",DIM10,*N:
                      *1,"Health Fund Range : ",*+,FRHFN," to ",TOHFN
            ADD       TWO,CLNO
          ENDIF
.
HEAD4500  BRANCH    OPTION TO HEAD4600,HEAD4700,HEAD4600
.
HEAD4600  PRINT     *45,DSYST:
                    *N,*45,DOUTXTRA
          ADD       TWO,CLNO
          GOTO      HEAD5000
.
HEAD4700  MATCH     SP30,STARTNM
          IF        @EQUAL
            PRINT     *N,"Starting Surname : Start",*45,DSYST
          ELSE
            PRINT     *N,"Starting Surname : ",STARTNM,*45,DSYST
          ENDIF
          MATCH     Z30,ENDNAM
          IF        @EQUAL
            PRINT     "Ending Surname   : Finish",*45,DOUTXTRA
          ELSE
            PRINT     "Ending Surname   : ",ENDNAM,*45,DOUTXTRA
          ENDIF
          ADD       THREE,CLNO
.
HEAD5000  BRANCH    CATBLAY OF HEAD5100,HEAD5300,HEAD5400,HEAD5500,HEAD5600
.
          PRINT     *N,*3,"U/R",*12,"Adm.":
                    *19,"Patient Name",*32,"Discharge":
                    *N:
                    *1," Number   Number ",*19,"Comment":
                    *32,"Date",*50,"    Paid",*65," Current":
                    *81,"30 Days",*96,"60 Days",*110,"90+ Days":
                    *128,"Total",*N:
                    *1,"-------- --------"," ------------":
                    *32,"----------",*50,"    ----":
                    *65," -------",*81,"-------":
                    *96,"-------",*110,"--------":
                    *128,"-----",*N
          ADD       FIVE,CLNO
          GOTO      HEAD9000
.
HEAD5100   BRANCH    CHOSTYP OF HEAD5200
.
          PRINT     *N,*3,"Adm.",*32,"Adm":
                      *36,"Admission",*47,"Discharge",*N:
                      *1,"Number",*10,"Patient Name":
                      *32,"Typ",*36,"Date",*47,"Date":
                      *65,"90+ Days",*81,"60 Days",*96,"30 Days":
                      *111,"Current",*128,"Total",*N:
                      *1,"--------":
                      *10,"---------------------":
                      *32,"----",*36,"----------",*47,"----------":
                      *65,"-------",*81,"-------":
                      *96,"-------",*111,"-------":
                      *128,"-----",*N
.
          ADD       FIVE,CLNO
          GOTO      HEAD9000
. 
HEAD5200  PRINT     *N,*3,"Adm.",*33,"Pat.":
                    *37,"Admission",*48,"Discharge",*N:
                    *1," Number ",*10,"Patient Name":
                    *33,"Cls.",*39,"Date",*50,"Date":
                    *62,"  90+ Days",*77,"  60 Days",*92,"  30 Days":
                    *107,"  Current",*122,"   Total",*N:
                    *1,"--------":
                    *10,"---------------------":
                    *33,"----",*37,"----------",*48,"----------":
                    *62,"----------",*77,"----------":
                    *92,"----------",*107,"----------":
                    *122,"----------",*N
.
          ADD       FIVE,CLNO
          GOTO      HEAD9000
.
HEAD5300  PRINT     *N,*1," U/R No ":
                    *18,"   Current",*33,"   30 Days",*48,"   60 Days":
                    *63,"   90 Days",*78,"  120 Days",*93,"    1 Year":
                    *108,"  2+ Years",*123,"     Total",*N:
                    *1," Adm No ",*10,"Patient Name",*N:
                    *1,"-------- --------":
                    *18,"----------",*33,"----------":
                    *48,"----------",*63,"----------":
                    *78,"----------",*93,"----------":
                    *108,"----------",*123,"----------"
.
          ADD       FIVE,CLNO
          GOTO      HEAD9000
.
HEAD5400  PRINT     *N,*1," U/R No ":
                    *18,"   Current",*33,"   30 Days",*48,"   60 Days":
                    *63,"   90 Days",*78,"  120 Days",*93,"  150 Days":
                    *108,"  180 Days",*123,"     Total",*N:
                    *1," Adm No ",*10,"Patient Name",*N:
                    *1,"-------- --------":
                    *18,"----------",*33,"----------":
                    *48,"----------",*63,"----------":
                    *78,"----------",*93,"----------":
                    *108,"----------",*123,"----------"
          ADD       FOUR,CLNO
          GOTO      HEAD9000
.
.         Melbourne Clinic ATB
.
HEAD5500   PRINT     *N,*1," U/R No ",*10,"Debtor",*24,"Clm.":
                    *33," 120+ Days":
                    *48,"   90 Days",*63,"   60 Days":
                    *78,"   30 Days",*93,"   Current",*108," Sub-Total":
                    *122,"Total Owing":
                    *N,*1," Adm No ",*24,"Fund":
                    *N,*1,"--------",*10,"------------":
                    *24,"----",*33,"----------":
                    *48,"----------",*63,"----------":
                    *78,"----------",*93,"----------",*108,"----------":
                    *123,"----------",*N
          ADD       FIVE,CLNO
          GOTO      HEAD9000
.
HEAD5600   PRINT     *N,*8,"Name":
                      *N,*1,"Health",*8,"(Initial,",*21,"U/R",*30," Adm.":
                      *N,*1,"Fund",*8,"Surname",*21," No.",*30,"  No.":
                      *39," Current",*51," 30 Days",*63," 60 Days":
                      *75,"   90 Days",*87,"  120 Days",*99," 150 Days":
                      *110," 180 Days",*121,"       Total",*N:
                      *1,"------",*8,"------------":
                      *21,"--------",*30,"--------":
                      *39,"-----------",*51,"-----------":
                      *63,"-----------",*75,"-----------":
                      *87,"-----------",*99,"----------":
                      *110,"----------",*121,"------------"
.
          ADD       "8",CLNO            * (incl. 3 fudge factor)
          GOTO      HEAD9000
.
HEAD9000  CALL      HFTITLE
HEAD9999  RETURN
.
.------------------------------------------------------------------------------
.         Routine to print heading for Export File
.------------------------------------------------------------------------------
EHED0000  BRANCH    OPTION1,EHED2000
.
          IF       CATBLAY=6
            PRINT     "<table border=1><tr><td width=10%>Health Fund</td>":
                      "<td>Patient Name</td>":
                      "<td>U/R No.</td>":
                      "<td>Admission No.</td>":
                      "<td>Discharge Date</td>":
                      "<td>Invoice No.</td>";
            GOTO      EHED1000
          ELSE
            PRINT     "<table border=1><tr><td width=10%>Health Fund</td>":
                      "<td>Patient Name</td>":
                      "<td>Admission No.</td>":
                      "<td>Invoice No.</td>":
                      "<td>Invoice Date</td>";
          ENDIF
.
           IF        OPTION1=2
             PRINT    "<td>Current</td>";
           ELSE
             IF        OPTION1=3
               PRINT    "<td>30 Days</td>";
             ELSE
               IF        OPTION1=4
                 PRINT    "<td>60 Days</td>";
               ELSE
                 PRINT    "<td>90+ Days</td>";
               ENDIF
             ENDIF
           ENDIF
.
EHED1000  IF       CATBLAY=6
             PRINT    "<td>Total</td>";
             IF       PTCNCATB<>2
               PRINT    "<td>Last Comments</td>";
             ENDIF
             PRINT    "</tr>"
           ELSE
             PRINT    "<td>Total</td>":
                      "<td>Comments</td></tr>"
           ENDIF
           GOTO     EHED9999
.
EHED2000   IF       CATBLAY=6
             PRINT     "<table border=1><tr><td width=10%>Health Fund</td>":
                       "<td>Patient Name</td>":
                       "<td>U/R No</td>":
                       "<td>Admission No</td>":
                       "<td>Disc.Date</td>":
                       "<td>Invoice No</td>":
                       "<td>Current</td>":
                       "<td>30 Days</td>":
                       "<td>60 Days</td>":
                       "<td>90 Days</td>":
                       "<td>120 Days</td>":
                       "<td>150 Days</td>":
                       "<td>180 Days</td>":
                       "<td>Paid</td>":
                       "<td>Total</td>";
             IF       PTCNCATB<>2
               PRINT     "<td>Last Comments</td>";
             ENDIF
             PRINT    "</tr>"
           ELSE
             PRINT     "<table border=1><tr><td width=10%>Health Fund</td>":
                       "<td>Patient Name</td>":
                       "<td>U/R No</td>":
                       "<td>Admission No.</td>":
                       "<td>Current</td>":
                       "<td>30 Days</td>":
                       "<td>60 Days</td>":
                       "<td>90 Days</td>":
                       "<td>120 Days</td>":
                       "<td>150 Days</td>":
                       "<td>180 Days</td>":
                       "<td>Total</td></tr>"
           ENDIF
           GOTO      EHED9999
.
EHED9999   RETURN
+
.------------------------------------------------------------------------------
.         Subroutine to print the claim totals for each claim type
.------------------------------------------------------------------------------
.
CLMTOT    COMPARE   TWO,SEPCLM
          RETURN    IF EQUAL
.
          BRANCH    OPTION1 TO CLMTOTA
.
          IF        CATBLAY=5
            MOVE      XCTTOT,FORM9P2
            PRINT     *N,*72,"------------":
                      *N,*55,"CLAIM TOTAL : $ ",*72,FORM9P2:
                      *N,*72,"------------"
            MOVE      ZERO TO XCTTOT
          ELSE
            PRINT     *N,*39,"----------------":
                      *N,*23,"CLAIM TOTAL : $ ",*40,XCTTOT:
                      *N,*39,"----------------"
            MOVE      ZERO TO XCTTOT
          ENDIF
          RETURN
.
CLMTOTA   BRANCH    CATBLAY OF CLMTOT1,CLMTOT2,CLMTOT2,CLMTOT4,CLMTOT5
.
CLMTOT0   PRINT       *N,*47,"----------":
                         *63,"----------",*78,"----------":
                         *93,"----------",*108,"----------":
                         *123,"----------":
                      *N,*24,"CLAIM TOTAL : ",*43,XCTPAID,*58,XCTCURR:
                         *73,XCT30,*88,XCT60,*103,XCT90:
                         *118,XCTTOT:
                      *N,*47,"----------":
                         *63,"----------",*78,"----------":
                         *93,"----------",*108,"----------":
                         *123,"----------"
          GOTO        CLMTOTZ
.
CLMTOT1   PRINT       *N,*63,"----------",*78,"----------":
                         *93,"----------",*108,"----------":
                         *123,"----------",*N:
                         *37,"CLAIM TOTAL : ",*58,XCT90,*73,XCT60:
                         *88,XCT30,*103,XCTCURR,*118,XCTTOT,*N:
                         *63,"----------",*78,"----------":
                         *93,"----------",*108,"----------":
                         *123,"----------"
          GOTO        CLMTOTZ
.
CLMTOT2   PRINT       *N,*18,"----------",*33,"----------":
                         *48,"----------",*63,"----------":
                         *78,"----------",*93,"----------":
                         *108,"----------",*123,"----------",*N:
                         *1,"CLAIM TOTAL":
                         *13,XCTCURR,*28,XCT30,*43,XCT60:
                         *58,XCT90,*73,XCT120,*88,XCT1YR:
                         *103,XCT2YR,*118,XCTTOT,*N:
                         *18,"----------",*33,"----------":
                         *48,"----------",*63,"----------":
                         *78,"----------",*93,"----------":
                         *108,"----------",*123,"----------",*N
          GOTO        CLMTOTZ
.
.         Melbourne Clinic ATB
.
CLMTOT4   PRINT    *N,*33,"----------":
                   *48,"----------",*63,"----------":
                   *78,"----------",*93,"----------",*108,"----------":
                   *123,"----------",*N:
                   *10,"CLAIM TOTAL":
                   *28,XCREB120,*43,XCREB90,*58,XCREB60,*73,XCREB30:
                   *88,XCREBCUR,*103,XCSUBREB,*118,XCTTOT:
                   *N,*28,XCPAT120,*43,XCPAT90,*58,XCPAT60,*73,XCPAT30:
                   *88,XCPATCUR,*103,XCSUBPAT:
                   *N,*33,"----------":
                   *48,"----------",*63,"----------":
                   *78,"----------",*93,"----------",*108,"----------":
                   *123,"----------"
          GOTO      CLMTOTZ
.
CLMTOT5   MOVE      XCTCURR,FTOTCURR
          MOVE      XCT30,FTOT30
          MOVE      XCT60,FTOT60
          MOVE      XCT90,FTOT90
          MOVE      XCT120,FTOT120
          MOVE      XCT1YR,FTOT1YR
          MOVE      XCT2YR,FTOT2YR
          MOVE      XCTTOT,FTOTOUT
.
          PRINT     *N,*1,"------",*8,"------------":
                    *21,"--------",*30,"--------":
                    *39,"-----------",*51,"-----------":
                    *63,"-----------",*75,"-----------":
                    *87,"-----------",*99,"----------":
                    *110,"----------",*121,"------------":
                    *N,*1,"CLAIM TOTAL : ":
                    *39,FTOTCURR:
                    *51,FTOT30,*63,FTOT60,*75,FTOT90,*87,FTOT120:
                    *98,FTOT1YR,*109,FTOT2YR,*121,FTOTOUT:
                    *N,*1,"------",*8,"------------":
                    *21,"--------",*30,"--------":
                    *39,"-----------",*51,"-----------":
                    *63,"-----------",*75,"-----------":
                    *87,"-----------",*98,"----------":
                    *110,"----------",*121,"------------"
          GOTO      CLMTOTZ
.
CLMTOTZ   MOVE        ZERO TO XCTPAID
          MOVE        ZERO TO XCTCURR
          MOVE        ZERO TO XCT30
          MOVE        ZERO TO XCT60
          MOVE        ZERO TO XCT90
          MOVE        ZERO TO XCT120
          MOVE        ZERO TO XCT1YR
          MOVE        ZERO TO XCT2YR
          MOVE        ZERO TO XCTTOT
.
.         Melbourne Clinic
.
          MOVE        ZERO,XCREB120
          MOVE        ZERO,XCPAT120
          MOVE        ZERO,XCREB90
          MOVE        ZERO,XCPAT90
          MOVE        ZERO,XCREB60
          MOVE        ZERO,XCPAT60
          MOVE        ZERO,XCREB30
          MOVE        ZERO,XCPAT30
          MOVE        ZERO,XCREBCUR
          MOVE        ZERO,XCPATCUR
          MOVE        ZERO,XCSUBREB
          MOVE        ZERO,XCSUBPAT
          RETURN
.
.*******************************************************************************
.         Print Debt Agency Total
.*******************************************************************************
AGENT00   MOVE      SP70,TDESC
          MATCH     SP70,SAVAGEN
          GOTO      AGENT80 IF EQUAL
.
          COMPARE   "56",CLNO
          CALL      HEAD0000 IF NOT LESS
.
          MOVE      "dc",KEY2
          PACK      KEY5,KEY2,SAVAGEN
          CALL      RDCODE1
.
          BRANCH    OPTION1 TO AGENT10           * full report
.
          MOVE      DTOTOUT,FORM9P2
          IF        EXPORTFL=1
            PRINT     "<tr>":
                      "<td>TOTAL (",TDESC,")</td>":
                      "<td>&nbsp;</td>":
                      "<td>&nbsp;</td>":
                      "<td>&nbsp;</td>":
                      "<td>&nbsp;</td>":
                      "<td>&nbsp;</td>":
                      "<td>",DTOTOUT,"</td></tr>"
          ELSE
            PRINT     *N,*72,"------------":
                      *N,*34,"TOTAL (",TDESC,") : $ ",*72,FORM9P2:
                      *N,*72,"------------",*N
          ENDIF
          GOTO        AGENT80
.
AGENT10   COMPARE     SIX,CATBLAY
          GOTO        AGENT30 IF EQUAL          * SVMPH layout
.
          MOVE        DTOTCURR,FTOTCURR
          MOVE        DTOT30,FTOT30
          MOVE        DTOT60,FTOT60
          MOVE        DTOT90,FTOT90
          MOVE        DTOT120,FTOT120
          MOVE        DTOT1YR,FTOT1YR
          MOVE        DTOT2YR,FTOT2YR
          MOVE        DTOTOUT,FTOTOUT
.
          BRANCH      EXPORTFL,AGENT20
.
          PRINT       *N,*1,"------",*8,"------------":
                      *21,"--------",*30,"--------":
                      *39,"-----------",*51,"-----------":
                      *63,"-----------",*75,"-----------":
                      *87,"-----------",*99,"----------":
                      *110,"----------",*121,"------------",*N:
                      *N,*1,"TOTAL (",TDESC,") :":
                      *39,FTOTCURR,*51,FTOT30,*63,FTOT60:
                      *75,FTOT90,*87,FTOT120,*98,FTOT1YR:
                      *109,FTOT2YR,*121,FTOTOUT,*N:
                      *N,*1,"------",*8,"------------":
                      *21,"--------",*30,"--------":
                      *39,"-----------",*51,"-----------":
                      *63,"-----------",*75,"-----------":
                      *87,"-----------",*99,"----------":
                      *110,"----------",*121,"------------",*N
          ADD         ONE,CLNO         * Extra line
          GOTO        AGENT80
.
AGENT20   PRINT       "<tr><td>TOTAL (",TDESC,")</td>":
                      "<td>&nbsp;</td>":
                      "<td>&nbsp;</td>":
                      "<td>&nbsp;</td>":
                      "<td>",FTOTCURR,"</td>":
                      "<td>",FTOT30,"</td>":
                      "<td>",FTOT60,"</td>":
                      "<td>",FTOT90,"</td>":
                      "<td>",FTOT120,"</td>":
                      "<td>",FTOT1YR,"</td>":
                      "<td>",FTOT2YR,"</td>":
                      "<td>",FTOTOUT,"</td></tr>"
          GOTO        AGENT80
.
.         SVMPH layout
.
AGENT30   MOVE        DTOTCURR,FTOTCURR
          MOVE        DTOT30,FTOT30
          MOVE        DTOT60,FTOT60
          MOVE        DTOT90,FTOT90
          MOVE        DTOT120,FTOT120
          MOVE        DTOT1YR,FTOT1YR
          MOVE        DTOT2YR,FTOT2YR
          MOVE        DTOTOUT,FTOTOUT
.
          PRINT       "<tr><td>TOTAL (",TDESC,")</td>":
                      "<td>&nbsp;</td>":
                      "<td>&nbsp;</td>":
                      "<td>&nbsp;</td>":
                      "<td>&nbsp;</td>":
                      "<td>&nbsp;</td>":
                      "<td>",FTOTCURR,"</td>":
                      "<td>",FTOT30,"</td>":
                      "<td>",FTOT60,"</td>":
                      "<td>",FTOT90,"</td>":
                      "<td>",FTOT120,"</td>":
                      "<td>",FTOT1YR,"</td>":
                      "<td>",FTOT2YR,"</td>":
                      "<td>&nbsp;</td>":
                      "<td>",FTOTOUT,"</td>";
.
          IF       PTCNCATB<>2
            PRINT       "<td>&nbsp;</td>";
          ENDIF
          PRINT       "</tr>"
.
          GOTO        AGENT80
.
AGENT80   ADD         FIVE,CLNO
          MOVE        DEBTAGEN,SAVAGEN
          MOVE        ZERO,DTOTCURR
          MOVE        ZERO,DTOT30
          MOVE        ZERO,DTOT60
          MOVE        ZERO,DTOT90
          MOVE        ZERO,DTOT120
          MOVE        ZERO,DTOT1YR
          MOVE        ZERO,DTOT2YR
          MOVE        ZERO,DTOTOUT
.
AGENT99   RETURN
+
.*******************************************************************************
.         Print Health Fund Total
.*******************************************************************************
.
HFTOT     COMPARE     TWO,SEPFUND
          RETURN      IF EQUAL
.
          BRANCH    OPTION1 TO HFTOTA
.
          MOVE      HFNAME,DIM31
.
          UNPACK    DIM31,KEY25
          IF        CATBLAY=5 | CATBLAY=6
            MOVE      XHTTOT,FORM9P2
            PRINT     *N,*72,"------------":
                      *N,*34,"TOTAL (",KEY25,") : $ ",*72,FORM9P2:
                      *N,*72,"------------",*N
          ELSE
            PRINT     *N,*40,"---------------":
                      *N,*2,"TOTAL (",KEY25,") : $ ",*40,XHTTOT:
                      *N,*40,"---------------",*N
          ENDIF
.
          GOTO      ENDHFTOT
.
HFTOTA    BRANCH    CATBLAY OF HFTOT1,HFTOT2,HFTOT2,HFTOT4,HFTOT5,HFTOTZ
.
HFTOT0    MOVE      HFNAME,DIM37
          UNPACK    DIM37,KEY30
          PRINT     *N,*48,"----------":
                    *63,"----------",*78,"----------":
                    *93,"----------",*108,"----------":
                    *123,"----------":
                    *N,*1,"TOTAL (",KEY30,") : ",*43,XHTPAID,*58,XHTCURR:
                    *73,XHT30,*88,XHT60,*103,XHT90:
                    *118,XHTTOT:
                    *N,*48,"----------":
                    *63,"----------",*78,"----------":
                    *93,"----------",*108,"----------":
                    *123,"----------",*N
          GOTO        HFTOTZ
.
HFTOT1    UNPACK      HFNAME,KEY30
          PRINT       *N,*63,"----------",*78,"----------":
                      *93,"----------",*108,"----------":
                      *123,"----------",*N:
                      *15,"TOTAL (",KEY30,") : ",*58,XHT90,*73,XHT60:
                      *88,XHT30,*103,XHTCURR,*118,XHTTOT,*N:
                      *63,"----------",*78,"----------":
                      *93,"----------",*108,"----------":
                      *123,"----------",*N
.
          GOTO        HFTOTZ
.
HFTOT2    PRINT       *N,*18,"----------",*33,"----------":
                      *48,"----------",*63,"----------":
                      *78,"----------",*93,"----------":
                      *108,"----------",*123,"----------",*N:
                      *1,"FUND TOTAL":
                      *13,XHTCURR,*28,XHT30,*43,XHT60:
                      *58,XHT90,*73,XHT120,*88,XHT1YR:
                      *103,XHT2YR,*118,XHTTOT,*N:
                      *18,"----------",*33,"----------":
                      *48,"----------",*63,"----------":
                      *78,"----------",*93,"----------":
                      *108,"----------",*123,"----------",*N
.
          GOTO        HFTOTZ
.
.         Melbourne clinic
.
HFTOT4    PRINT    *N,*33,"----------":
                      *48,"----------",*63,"----------":
                      *78,"----------",*93,"----------",*108,"----------":
                      *123,"----------":
                      *N,*10,"FUND TOTAL":
                      *28,XHREB120,*43,XHREB90,*58,XHREB60:
                      *73,XHREB30,*88,XHREBCUR,*103,XHSUBREB,*118,XHTTOT:
                      *N,*28,XHPAT120,*43,XHPAT90,*58,XHPAT60:
                      *73,XHPAT30,*88,XHPATCUR,*103,XHSUBPAT,*N:
                      *33,"----------":
                      *48,"----------",*63,"----------":
                      *78,"----------",*93,"----------",*108,"----------":
                      *123,"----------",*N
          ADD         ONE,CLNO         * Extra line
.
          MOVE        ZERO TO XHREB120
          MOVE        ZERO TO XHREB90
          MOVE        ZERO TO XHREB60
          MOVE        ZERO TO XHREB30
          MOVE        ZERO TO XHREBCUR
          MOVE        ZERO TO XHSUBREB
          MOVE        ZERO TO XHPAT120
          MOVE        ZERO TO XHPAT90
          MOVE        ZERO TO XHPAT60
          MOVE        ZERO TO XHPAT30
          MOVE        ZERO TO XHPATCUR
          MOVE        ZERO TO XHSUBPAT
.
          GOTO        HFTOTZ
.
.         Healthscope layout
.
HFTOT5    MOVE        XHTCURR,FTOTCURR
          MOVE        XHT30,FTOT30
          MOVE        XHT60,FTOT60
          MOVE        XHT90,FTOT90
          MOVE        XHT120,FTOT120
          MOVE        XHT1YR,FTOT1YR
          MOVE        XHT2YR,FTOT2YR
          MOVE        XHTTOT,FTOTOUT
.
          PRINT       *N,*1,"------",*8,"------------":
                      *21,"--------",*30,"--------":
                      *39,"-----------",*51,"-----------":
                      *63,"-----------",*75,"-----------":
                      *87,"-----------",*99,"----------":
                      *110,"----------",*121,"------------",*N:
                      *N,*1,"FUND TOTAL":
                      *39,FTOTCURR,*51,FTOT30,*63,FTOT60:
                      *75,FTOT90,*87,FTOT120,*98,FTOT1YR:
                      *109,FTOT2YR,*121,FTOTOUT,*N:
                      *N,*1,"------",*8,"------------":
                      *21,"--------",*30,"--------":
                      *39,"-----------",*51,"-----------":
                      *63,"-----------",*75,"-----------":
                      *87,"-----------",*98,"----------":
                      *110,"----------",*121,"------------",*N
          ADD         ONE,CLNO         * Extra line
          GOTO        HFTOTZ
.
HFTOTZ    MOVE        ZERO TO XHTPAID
          MOVE        ZERO TO XHTCURR
          MOVE        ZERO TO XHT30
          MOVE        ZERO TO XHT60
          MOVE        ZERO TO XHT90
          MOVE        ZERO TO XHT120
          MOVE        ZERO TO XHT1YR
          MOVE        ZERO TO XHT2YR
.
ENDHFTOT  MOVE        ZERO TO XHTTOT
          PACK        SAVFUND WITH ACLMCD,HFUND
          ADD         FIVE,CLNO
.
          MATCH       ACLMCD,SAVCLM
          RETURN      IF NOT EQUAL
.
          COMPARE     "52",CLNO
          GOTO        FORCEFF IF NOT LESS
.
.         Check for option of new page for each fund
.
          COMPARE     ONE,PAGFUND
          GOTO        FORCEFF IF EQUAL
.
          CALL        HFTITLE
          RETURN
.
FORCEFF   CALL        HEAD0000
          RETURN
.
.         Subroutine to print the Health Fund subtitle
.
HFTITLE   BRANCH    SEPFUND OF PRTSHF1,ENDHFTTL
.
PRTSHF1   MATCH     SP6,HFUND
          GOTO      NOFUND1 IF EQUAL
.
          PACK      KEY14 WITH HFUND,ZERO,ZERO,ZERO,ZERO,SP10
          CALL      RDFUND1
          COMPARE   ZERO,OVRCD
          GOTO      PRTSHF2 IF EQUAL
.
          CLEAR     HFNAME
          APPEND    "UNKNOWN HEALTH FUND - ",HFNAME
          APPEND    HFUND,HFNAME
          APPEND    SP30,HFNAME
          RESET     HFNAME
          GOTO      PRTSHF2
.
NOFUND1   MOVE      "NO HEALTH FUND                ",HFNAME
.
PRTSHF2   COMPARE   "52",CLNO
          CALL      HEAD0000 IF NOT LESS
.
          PRINT     *1,HFNAME," (",HFUND,")":
                    *N,"-------------------------------------------------"
          ADD       TWO,CLNO
.
ENDHFTTL  PACK      SAVFUND WITH ACLMCD,HFUND
          RETURN
+
.*************************************************************************
.       Create Tempfile
.*************************************************************************
CRTP0000  CALL      KILL0000
.
          CLEAR     CMDLINE
          APPEND    "isbuild ",CMDLINE
          APPEND    FNAMET,CMDLINE
          APPEND    " 309 ",CMDLINE
          APPEND    SORTSTR,CMDLINE
          APPEND    SP70,CMDLINE
          RESET     CMDLINE
          EXECUTE   CMDLINE,TASKID
.
          OPEN      TEMPFILE,FNAMET
.         CALL      DTMP0000                  * Delete tempfile if exists 
.
CRTP9999  RETURN
+
.******************************************************************************
.         Delete records from tempfile
.******************************************************************************
KILL0000  CLOSE     TEMPFILE
          PACK      CMDLINE,SP70,SP70
          CLEAR     CMDLINE
          APPEND    "iserase ",CMDLINE
          APPEND    FNAMET,CMDLINE
          RESET     CMDLINE
          EXECUTE   CMDLINE,TASKID
.
KILL9999  RETURN
+
.******************************************************************************
.         Delete records from tempfile
.******************************************************************************
DTMP0000  PACK      KEY38,SP70
          PACK      KEY75,SP70,SP70
          PACK      KEY30,SP70
          CALL      RSTP0000
          CALL      RKTP0000
          BRANCH    OVRCD,DTMP9999
.
          BRANCH    OPTION,DTMP1000,DTMP2000,DTMP3000
DTMP1000  PACK      KEY38,PATFLAG,DEBTAGEN,ACLMCD,HFUND,XAURNO,XAADMNO:
                          SORTDIM,XUNIQUE,SP70
          MATCH     SP70,KEY38
          GOTO      DTMP9999 IF EQUAL
          GOTO      DTMP5000
.
DTMP2000  PACK      KEY75,PATFLAG,DEBTAGEN,ACLMCD,HFUND,PSNAME,PGNAME,XAADMNO:
                          SORTDIM,XUNIQUE,SP70
          MATCH     SP70,KEY75
          GOTO      DTMP9999 IF EQUAL
          GOTO      DTMP5000
.
DTMP3000  PACK      KEY30,PATFLAG,DEBTAGEN,ACLMCD,HFUND,XAADMNO:
                          SORTDIM,XUNIQUE,SP70
          MATCH     SP70,KEY30
          GOTO      DTMP9999 IF EQUAL
.
DTMP5000  CALL      DETP0000
          GOTO      DTMP0000
DTMP9999  RETURN
+
.******************************************************************************
.*        PRCM0000 - Print first line of patient comments                     *
.*        Parameters - DIM8A - admission number                               *
.******************************************************************************
.
PRCM0000  MOVE      ONE,EXIT
          COMPARE   ONE,PTCNCATB
          GOTO      PRCM1000 IF NOT EQUAL   * Print admission comments
.
          PACK      CMNTLINE,SP70,SP70
          MOVE      "003",KEY3            * Billing Comments
          PACK      KEY17,DIM8A,KEY3,Z70
          CALL      RSVSMDT1
PRCM0200  CALL      RPVSMDT1
          BRANCH    OVRCD,PRCM8000          * end of file
.
          MATCH     DIM8A,VSMDVISN           * same Admission Number?
          GOTO      PRCM8000 IF NOT EQUAL
.
          MATCH     KEY3,VSMDTYPE           * same comment type?
          GOTO      PRCM8000 IF NOT EQUAL
.
          MATCH     "1",VSMDDELT            * comment deleted?
          GOTO      PRCM0200 IF EQUAL
.
          PACK      KEY20,VSMDVISN,VSMDTYPE,VSMDNOTE,SP70
          CALL      RSVSMTX1
          CALL      RKVSMTX1
          BRANCH    OVRCD,PRCM8000
.
          MATCH     VSMDVISN,VSMTVISN       * same Admission Number?
          GOTO      PRCM8000 IF NOT EQUAL
.
          MATCH     VSMDTYPE,VSMTTYPE
          GOTO      PRCM8000 IF NOT EQUAL
.
          MATCH     VSMDNOTE,VSMTNOTE
          GOTO      PRCM8000 IF NOT EQUAL
.
          MATCH     VSMDDATE,SP70
          IF        @EQUAL
            PACK      KEY70,VSMTCMNT,SP70
          ELSE
            UNPACK    VSMDDATE,CCENT,CYEAR,CMON,CDAY
            PACK      KEY70,CDAY,SLASH,CMON,SLASH,CCENT,CYEAR,COLON,SP1,VSMTCMNT,SP70
          ENDIF
.
          IF        CATBLAY=5 | CATBLAY=6
            UNPACK    KEY70,KEY47
            IF        EXPORTFL=1
              PRINT     "<td>&nbsp;",KEY70,"</td>";
            ELSE
              UNPACK    KEY70,KEY45
              PRINT     *86,KEY45           * Print the comments under other
            ENDIF
          ELSE
            PRINT     *19,KEY70             * Print the comments under other
          ENDIF
          GOTO      PRCM2000
.
PRCM1000  MOVE      SP70,VSMTCMNT 
          MOVE      DIM8A,KEY8
          PACK      KEY17,KEY8,VSCMTTYP,Z70      * Key for start of comment
          CALL      RSVSMDT1
PRCM1020  CALL      RPVSMDT1
          BRANCH    OVRCD,PRCM8000
.
          MATCH     KEY8,VSMDVISN
          GOTO      PRCM8000 IF NOT EQUAL
.
          MATCH     VSCMTTYP,VSMDTYPE
          GOTO      PRCM8000 IF NOT EQUAL
.
          MATCH     "1",VSMDDELT          * is comment deleted
          GOTO      PRCM1020 IF EQUAL
.
. Retrieve the comment text line details
.
          MATCH     "N",DCOMFLAG
          IF        @EQUAL
            PACK      KEY20,VSMDVISN,VSMDTYPE,VSMDNOTE,Z70
            CALL      RSVSMTX1
            CALL      RPVSMTX1              * Get Last comment line
          ELSE
            PACK      KEY20,VSMDVISN,VSMDTYPE,VSMDNOTE,SP70
            CALL      RSVSMTX1
            CALL      RKVSMTX1              * Get first comment line
          ENDIF
          BRANCH    OVRCD,PRCM1020          * No comments
.
          MATCH     VSMDVISN,VSMTVISN
          GOTO      PRCM1020 IF NOT EQUAL
.
          MATCH     VSMDTYPE,VSMTTYPE
          GOTO      PRCM1020 IF NOT EQUAL
.
          MATCH     VSMDNOTE,VSMTNOTE
          GOTO      PRCM1020 IF NOT EQUAL
.
          IF        CATBLAY=5 | CATBLAY=6
            UNPACK    VSMTCMNT,KEY47
            IF        EXPORTFL=1
              PRINT     "<td>&nbsp;",VSMTCMNT,"</td>";
            ELSE
              PRINT     *86,VSMTCMNT        * Print the comments under other
            ENDIF
          ELSE
            PRINT     *19,VSMTCMNT          * Print the comments under other
          ENDIF
.
PRCM2000  MOVE      ZERO,EXIT
          BRANCH    EXPORTFL,PRCM9999
          ADD       ONE,CLNO                * details
          GOTO      PRCM9999
.
PRCM8000  IF        EXPORTFL=1
            PRINT     "<td>&nbsp;</td>"
          ELSE
            PRINT     " "
          ENDIF
PRCM9999  RETURN
.
+
.******************************************************************************
.*        CRDN0000 - Credit for credit note                                   *
.******************************************************************************
CRDN0000  MOVE      ZERO,FORM12P2
          PACK      KEY16,PINVNO,SP70
          CALL      RSPMCNO3
CRDN1000  CALL      RKPMCNO3
          BRANCH    OVRCD,CRDN9000
          MATCH     PMCNINVN,PINVNO         * Same invoice number?
          GOTO      CRDN9000 IF NOT EQUAL   * No
.
          MATCH     PMCNDATE,FROMDATE
          GOTO      CRDN1000 IF LESS
          ADD       PMCNAMNT,FORM12P2
          GOTO      CRDN10000
.
CRDN9000  COMPARE   ZERO,FORM12P2
          GOTO      CRDN9999 IF EQUAL       * No credit note
          SUB       PTINROUN,FORM12P2
CRDN9999  RETURN
+
.****************************************************************************
.*                                CRTX0000             Called by: ML0000    *
.* Create export file for excel                                             *
.****************************************************************************
CRTX0000  MOVE      ZERO,EXPORTFL                  * No to create export file
          DISPLAY   *P1:9,"Create Export file for Excel : "
          KEYIN     *P32:9,*V2LON,*RV,DIM1:
                    *P32:9,*DV,DIM1
          REP       UPPLOW,DIM1
          DISPLAY   *P32:9,*V2LON,DIM1
          MOVE      ONE,EXPORTFL
          MATCH     "Y",DIM1
          GOTO      CRTX9999 IF EQUAL
.
          MOVE      ZERO,EXPORTFL
          MATCH     "N",DIM1
          GOTO      CRTX9999 IF EQUAL
          BEEP
          GOTO      CRTX0000
.
CRTX9999  RETURN
+
.******************************************************************************
.*        RDBC0000 - Read Billing Comments                                    *
.******************************************************************************
RDBC0000  PACK      CMNTLINE,SP70,SP70
          MOVE      "003",KEY3            * Billing Comments
          PACK      KEY17,AADMNO,KEY3,Z70
          CALL      RSVSMDT1
RDBC1000  CALL      RPVSMDT1
          BRANCH    OVRCD,RDBC9999          * end of file
.
          MATCH     VSMDVISN,DAADMNO       * same Admission Number?
          GOTO      RDBC9999 IF NOT EQUAL
.
          MATCH     KEY3,VSMDTYPE           * same comment type?
          GOTO      RDBC9999 IF NOT EQUAL
.
          MATCH     "1",VSMDDELT            * comment deleted?
          GOTO      RDBC1000 IF EQUAL
.
          PACK      KEY20,VSMDVISN,VSMDTYPE,VSMDNOTE,SP70
          CALL      RSVSMTX1
          CALL      RKVSMTX1
          BRANCH    OVRCD,RDBC9999
.
          MATCH     VSMDVISN,VSMTVISN       * same Admission Number?
          GOTO      RDBC9999 IF NOT EQUAL
.
          MATCH     VSMDTYPE,VSMTTYPE
          GOTO      RDBC9999 IF NOT EQUAL
.
          MATCH     VSMDNOTE,VSMTNOTE
          GOTO      RDBC9999 IF NOT EQUAL
.
          MATCH     VSMDDATE,SP70
          IF        @EQUAL
            PACK      CMNTLINE,VSMTCMNT,SP70
          ELSE
            UNPACK    VSMDDATE,CCENT,CYEAR,CMON,CDAY
            PACK      CMNTLINE,CDAY,SLASH,CMON,SLASH,CCENT,CYEAR,COLON,SP1,VSMTCMNT,SP70
          ENDIF
          GOTO      RDBC9999
.
RDBC9999  RETURN
+
.*******************************************************************************
.         Keyin Patient Debt Only
.*******************************************************************************
PATDEB00  DISPLAY   *P1:24,*EL,"0=All Debt, 1=Patient Debt Only, ":
                               "2=Debt Collection Debt only."
          MOVE      SP1,ANS
          KEYIN     *P1:20,*EL,"Patient Debt Only:":
                    *V2LON,ANS;
          RESET     ANS
          REP       UPPLOW,ANS
.
          MATCH     SP1,ANS
          GOTO      PATDEB40 IF EOS
          GOTO      PATDEB40 IF EQUAL
.
          MOVE      ZERO,FORM1
          MOVE      ANS,FORM1
          BRANCH    FORM1,PATDEB40,PATDEB60
.
          MOVE      ZERO,PDBONLY
          MOVE      ZERO,PASSFLAG
          DISPLAY   *P22:20,*V2LON,"All Debt";
          GOTO      PATDEB99
.
PATDEB40  MOVE      ONE,PDBONLY
          MOVE      ONE,PASSFLAG       * Print Patient debtor only
          DISPLAY   *P22:20,*V2LON,"Patient Debt Only";
          GOTO      PATDEB99
.
PATDEB60  MOVE      TWO,PDBONLY
          MOVE      TWO,PASSFLAG     * Print Debt Collection Debt only
          DISPLAY   *P22:20,*V2LON,"Debt Collection Debt Only";
.
PATDEB99  RETURN
+
.*******************************************************************************
.       Keyin ATB layout 
.*******************************************************************************
KATB0000  DISPLAY   *P1:4,*EF,"ATB Layout:";
.
          DISPLAY   *P1:23,*EL:
                    "0=Normal":
                    " 1=WCH, 2=Mercy, 3=St.Andrew":
                    *P1:24,"4=Melb.Clinic":
                    " 5=Healthscope, 6=Export Only";
.
          READ      CONTROLF,TEN3;*185,CATBLAY
.
          MOVE      SP70,ANS
          MOVE      CATBLAY,ANS          * default to Export only
          KEYIN     *P12:4,*V2LON,*RV,ANS;
          RESET     ANS
          GOTO      KATB1000 IF EOS
.
          MOVE      ZERO,FORM1
          MOVE      ANS,FORM1
.
KATB1000  COMPARE   ZERO,FORM1
          GOTO      KATB2000 IF EQUAL
          BRANCH    FORM1,KATB2000,KATB2000,KATB2000,KATB2000,KATB2000,KATB2000
          GOTO      KATB9000
.
KATB2000  IF        FORM1=0
            MOVE      "Normal",KEY15
          ENDIF
          IF        FORM1=1
            MOVE      "W.C.H.",KEY15
          ENDIF
          IF        FORM1=2
            MOVE      "Mercy",KEY15
          ENDIF
          IF        FORM1=3
            MOVE      "St.Andrews",KEY15
          ENDIF
          IF        FORM1=4
            MOVE      "Melb.Clinic",KEY15
          ENDIF
          IF        FORM1=5
            MOVE      "Healthscope",KEY15
          ENDIF
          IF        FORM1=6
            MOVE      "Export Only",KEY15
          ENDIF
          MOVE      FORM1,CATBLAY
          DISPLAY   *P15:4,*EL,*V2LON,KEY15;
          GOTO      KATB9999
.
KATB9000  DISPLAY   *P1:24,*EL,"Invalid ATB layout. ";
          CALL      HITENTER
          GOTO      KATB0000
.
KATB9999  RETURN
+
.*******************************************************************************
.       Keyin Type of comments
.*******************************************************************************
KCOM0000  DISPLAY   *P1:24,*EL:
                   " 0=Admission Comments, 1=Billing Comments, 2=Blank";
.
          READ      CONTROLF,HUND09;*243,PTCNCATB
          MOVE      SP70,KEY20
          IF        PTCNCATB=0
            MOVE      "Admiission Comments",KEY20
          ELSE
            IF        PTCNCATB=1
              MOVE      "Billing Comments",KEY20
            ENDIF
          ENDIF
          MOVE      "2",ANS               * default to Blank - No comment
          MOVE      PTCNCATB,ANS
          DISPLAY   *P1:22,*EL,"Comment   :",*P15:22,KEY20;
          KEYIN     *P12:22,*V2LON,*RV,ANS;
.
          MOVE      ZERO,FORM1
          MOVE      ANS,FORM1
          COMPARE   ZERO,FORM1
          GOTO      KCOM0100 IF EQUAL
          BRANCH    FORM1,KCOM1000,KCOM2000
          GOTO      KCOM9000
.
KCOM0100  MOVE      "Admission Comments",KEY20
          MOVE      "0",PTCNCATB
          GOTO      KCOM8000
.
KCOM1000  MOVE      "Billing Comments",KEY20
          MOVE      "1",PTCNCATB
          GOTO      KCOM8000
.
KCOM2000  MOVE      SP70,KEY20
          MOVE      "2",PTCNCATB
          GOTO      KCOM8000
.
KCOM8000  DISPLAY   *P15:22,*EL,*V2LON,KEY20;
          GOTO      KCOM9999
.
KCOM9000  DISPLAY   *P1:24,*EL,"Invalid Comments type. ";
          CALL      HITENTER
          GOTO      KCOM0000
.
KCOM9999 RETURN
+
.*****************************************************************************
.         I/O for tempfile
.*****************************************************************************
WRTP0000  IF        OPTION1=1
            CALL      WRFU0000            * Full report
          ELSE
            IF        CATBLAY=5 | CATBLAY=6
              MOVE      PINVUR,XAURNO
            ENDIF
            CALL      WRDE0000            * Details report
          ENDIF
WRTP9999  RETURN
+
RSTP0000  BRANCH    OPTION,RSTP1000,RSTP2000,RSTP3000
.
RSTP1000  RESET     KEY38
          READ      TEMPFILE,KEY38;;
          GOTO      RSTP9999
.
RSTP2000  RESET     KEY75
          READ      TEMPFILE,KEY75;;
          GOTO      RSTP9999
.
RSTP3000  RESET     KEY30
          READ      TEMPFILE,KEY30;;
RSTP9999  RETURN
+
RKTP0000  IF        OPTION1=1
            CALL      RKFU0000        * Full Report
          ELSE
            CALL      RKDE0000        * Details Report
          ENDIF
RKTP9999  RETURN
+
DETP0000  BRANCH    OPTION,DETP1000,DETP2000,DETP3000
DETP1000  RESET     KEY38
          DELETE    TEMPFILE,KEY38
          GOTO      DETP9999
.
DETP2000  RESET     KEY75
          DELETE    TEMPFILE,KEY75
          GOTO      DETP9999
.
DETP3000  RESET     KEY30
          DELETE    TEMPFILE,KEY30
DETP9999  RETURN
+
.*****************************************************************************
.         I/O Tempfile for Details report
.*****************************************************************************
WRDE0000  BRANCH    OPTION,WRDE1000,WRDE2000,WRDE3000
.
.         Details Report
.
WRDE1000  PACK      KEY38,PATFLAG,DEBTAGEN,ACLMCD,HFUND,XAURNO,XAADMNO,SORTDIM:
                          XUNIQUE,SP70
          RESET     KEY38
          WRITE     TEMPFILE,KEY38;ACLMCD,HFUND,XAURNO,XAADMNO,PSNAME,PGNAME:
                                 SORTDIM,XUNIQUE,PTITL,D12PTELP:
                                 PINVAMT,TINVNO,XDAY,XMON,XYEAR,XCENT,XTINVAMT:
                                 AFUNDH,AFNDTB,AFNDMM:
                                 D12PTELB,DDDAY,DDMON,DDYER,DDCEN,CMNTLINE:
                                 REMLSTL,LSTLDAT,SPINVTYP,SPINVSYS,DAGED,TEMP35:
                                 PATFLAG,DEBTAGEN,XTOTPAID
          GOTO      WRDE9999
.
WRDE2000  PACK      KEY75,PATFLAG,DEBTAGEN,ACLMCD,HFUND,PSNAME,PGNAME,XAADMNO:
                          SORTDIM,XUNIQUE,SP70
          RESET     KEY75
          WRITE     TEMPFILE,KEY75;ACLMCD,HFUND,XAURNO,XAADMNO,PSNAME,PGNAME:
                                 SORTDIM,XUNIQUE,PTITL,D12PTELP:
                                 PINVAMT,TINVNO,XDAY,XMON,XYEAR,XCENT,XTINVAMT:
                                 AFUNDH,AFNDTB,AFNDMM:
                                 D12PTELB,DDDAY,DDMON,DDYER,DDCEN,CMNTLINE:
                                 REMLSTL,LSTLDAT,SPINVTYP,SPINVSYS,DAGED,TEMP35:
                                 PATFLAG,DEBTAGEN,XTOTPAID
          GOTO      WRDE9999
.
WRDE3000  PACK      KEY30,PATFLAG,DEBTAGEN,ACLMCD,HFUND,XAADMNO,SORTDIM:
                          XUNIQUE,SP70
          RESET     KEY30
          WRITE     TEMPFILE,KEY30;ACLMCD,HFUND,XAURNO,XAADMNO,PSNAME,PGNAME:
                                 SORTDIM,XUNIQUE,PTITL,D12PTELP:
                                 PINVAMT,TINVNO,XDAY,XMON,XYEAR,XCENT,XTINVAMT:
                                 AFUNDH,AFNDTB,AFNDMM:
                                 D12PTELB,DDDAY,DDMON,DDYER,DDCEN,CMNTLINE:
                                 REMLSTL,LSTLDAT,SPINVTYP,SPINVSYS,DAGED,TEMP35:
                                 PATFLAG,DEBTAGEN,XTOTPAID
WRDE9999  RETURN
+
RKDE0000  MOVE      ZERO,OVRCD
          READKS    TEMPFILE;ACLMCD,HFUND,XAURNO,XAADMNO,PSNAME,PGNAME:
                              SORTDIM,XUNIQUE,PTITL,D12PTELP:
                              PINVAMT,TINVNO,XDAY,XMON,XYEAR,XCENT,XTINVAMT:
                              AFUNDH,AFNDTB,AFNDMM:
                              D12PTELB,DDDAY,DDMON,DDYER,DDCEN,CMNTLINE:
                              REMLSTL,LSTLDAT,SPINVTYP,SPINVSYS,DAGED,TEMP35:
                              PATFLAG,DEBTAGEN,XTOTPAID
          GOTO      OVERCOND IF OVER
RKDE9999  RETURN
+
.*****************************************************************************
.         IO Tempfile for Full Report
.*****************************************************************************
WRFU0000  BRANCH    OPTION,WRFU1000,WRFU2000,WRFU3000
WRFU1000  PACK      KEY38,PATFLAG,DEBTAGEN,ACLMCD,HFUND,XAURNO,XAADMNO,SORTDIM:
                          XUNIQUE,SP70
          RESET     KEY38
          MATCH     "x",PATFLAG          * flag for Patient outstanding record
          GOTO      WRFU1200 IF EQUAL
          MATCH     "y",PATFLAG          * flag for Debt Collection debt
          GOTO      WRFU1200 IF EQUAL
          WRITE     TEMPFILE,KEY38;ACLMCD,HFUND,XAURNO,XAADMNO,PSNAME,PGNAME:
                                SORTDIM,XUNIQUE:
                                DDDAY,DDMON,DDYER,DDCEN,XTOTPAID:
                                XTOTCURR,XTOT30,XTOT60,XTOT90:
                                XTOT120,XTOT1YR,XTOT2YR:
                                ATYPE,ADDAY,ADMON,ADYER,ADCEN:
                                XTOTOUT,PINVREB,PINVPAT,XTREBCUR,XTPATCUR:
                                XTREB30,XTPAT30,XTREB60,XTPAT60,XTREB90,XTPAT90:
                                XTREB120,XTPAT120,XTSUBREB,XTSUBPAT:
                                SHFUND,SACLM,SP2,PATFLAG,DEBTAGEN,TINVNO
          GOTO      WRFU9999
.
WRFU1200  WRITE     TEMPFILE,KEY38;ACLMCD,HFUND,XAURNO,XAADMNO,PSNAME,PGNAME:
                                SORTDIM,XUNIQUE:
                                DDDAY,DDMON,DDYER,DDCEN,XTOTPAID:
                                PATCURR,PAT30,PAT60,PAT90:
                                PAT120,PAT1YR,PAT2YR:
                                ATYPE,ADDAY,ADMON,ADYER,ADCEN:
                                PPORTION,PINVREB,PINVPAT,XTREBCUR,XTPATCUR:
                                XTREB30,XTPAT30,XTREB60,XTPAT60,XTREB90,XTPAT90:
                                XTREB120,XTPAT120,XTSUBREB,XTSUBPAT:
                                SHFUND,SACLM,SP2,PATFLAG,DEBTAGEN,TINVNO
          GOTO      WRFU9999
.
WRFU2000  PACK      KEY75,PATFLAG,DEBTAGEN,ACLMCD,HFUND,PSNAME,PGNAME,XAADMNO:
                          SORTDIM,XUNIQUE,SP70
          RESET     KEY75
          MATCH     "x",PATFLAG          * flag for Patient outstanding record
          GOTO      WRFU2200 IF EQUAL
          MATCH     "y",PATFLAG          * flag for Debt Collection debt
          GOTO      WRFU2200 IF EQUAL
          WRITE     TEMPFILE,KEY75;ACLMCD,HFUND,XAURNO,XAADMNO,PSNAME,PGNAME:
                                SORTDIM,XUNIQUE:
                                DDDAY,DDMON,DDYER,DDCEN,XTOTPAID:
                                XTOTCURR,XTOT30,XTOT60,XTOT90:
                                XTOT120,XTOT1YR,XTOT2YR:
                                ATYPE,ADDAY,ADMON,ADYER,ADCEN:
                                XTOTOUT,PINVREB,PINVPAT,XTREBCUR,XTPATCUR:
                                XTREB30,XTPAT30,XTREB60,XTPAT60,XTREB90,XTPAT90:
                                XTREB120,XTPAT120,XTSUBREB,XTSUBPAT:
                                SHFUND,SACLM,SP2,PATFLAG,DEBTAGEN,TINVNO
          GOTO      WRFU9999
.
WRFU2200  WRITE     TEMPFILE,KEY75;ACLMCD,HFUND,XAURNO,XAADMNO,PSNAME,PGNAME:
                                SORTDIM,XUNIQUE:
                                DDDAY,DDMON,DDYER,DDCEN,XTOTPAID:
                                PATCURR,PAT30,PAT60,PAT90:
                                PAT120,PAT1YR,PAT2YR:
                                ATYPE,ADDAY,ADMON,ADYER,ADCEN:
                                PPORTION,PINVREB,PINVPAT,XTREBCUR,XTPATCUR:
                                XTREB30,XTPAT30,XTREB60,XTPAT60,XTREB90,XTPAT90:
                                XTREB120,XTPAT120,XTSUBREB,XTSUBPAT:
                                SHFUND,SACLM,SP2,PATFLAG,DEBTAGEN,TINVNO
          GOTO      WRFU9999
.
WRFU3000  PACK      KEY30,PATFLAG,DEBTAGEN,ACLMCD,HFUND,XAADMNO,SORTDIM:
                          XUNIQUE,SP70
          RESET     KEY30
          MATCH     "x",PATFLAG          * flag for Patient outstanding record
          GOTO      WRFU3200 IF EQUAL
          MATCH     "y",PATFLAG          * flag for Debt Collection debt
          GOTO      WRFU3200 IF EQUAL
          WRITE     TEMPFILE,KEY30;ACLMCD,HFUND,XAURNO,XAADMNO,PSNAME,PGNAME:
                                SORTDIM,XUNIQUE:
                                DDDAY,DDMON,DDYER,DDCEN,XTOTPAID:
                                XTOTCURR,XTOT30,XTOT60,XTOT90:
                                XTOT120,XTOT1YR,XTOT2YR:
                                ATYPE,ADDAY,ADMON,ADYER,ADCEN:
                                XTOTOUT,PINVREB,PINVPAT,XTREBCUR,XTPATCUR:
                                XTREB30,XTPAT30,XTREB60,XTPAT60,XTREB90,XTPAT90:
                                XTREB120,XTPAT120,XTSUBREB,XTSUBPAT:
                                SHFUND,SACLM,SP2,PATFLAG,DEBTAGEN,TINVNO
          GOTO      WRFU9999
.
WRFU3200  WRITE     TEMPFILE,KEY30;ACLMCD,HFUND,XAURNO,XAADMNO,PSNAME,PGNAME:
                                SORTDIM,XUNIQUE:
                                DDDAY,DDMON,DDYER,DDCEN,XTOTPAID:
                                PATCURR,PAT30,PAT60,PAT90:
                                PAT120,PAT1YR,PAT2YR:
                                ATYPE,ADDAY,ADMON,ADYER,ADCEN:
                                PPORTION,PINVREB,PINVPAT,XTREBCUR,XTPATCUR:
                                XTREB30,XTPAT30,XTREB60,XTPAT60,XTREB90,XTPAT90:
                                XTREB120,XTPAT120,XTSUBREB,XTSUBPAT:
                                SHFUND,SACLM,SP2,PATFLAG,DEBTAGEN,TINVNO
          GOTO      WRFU9999
.
WRFU9999  RETURN
+
RKFU0000  MOVE      ZERO,OVRCD
          READKS    TEMPFILE;ACLMCD,HFUND,XAURNO,XAADMNO,PSNAME,PGNAME:
                                SORTDIM,XUNIQUE:
                                DDDAY,DDMON,DDYER,DDCEN,XTOTPAID:
                                XTOTCURR,XTOT30,XTOT60,XTOT90:
                                XTOT120,XTOT1YR,XTOT2YR:
                                ATYPE,ADDAY,ADMON,ADYER,ADCEN:
                                XTOTOUT,PINVREB,PINVPAT,XTREBCUR,XTPATCUR:
                                XTREB30,XTPAT30,XTREB60,XTPAT60,XTREB90,XTPAT90:
                                XTREB120,XTPAT120,XTSUBREB,XTSUBPAT:
                                SHFUND,SACLM,DIM2,PATFLAG,DEBTAGEN,TINVNO
          GOTO      OVERCOND IF OVER
RKFU9999  RETURN
+
.*****************************************************************************
.*  GETALTID
.*  Procedure to get an alternate ID
.*  Exit=0  No alternate ID
.*       1  Alternate ID's exist
.*****************************************************************************
          DEFPROC   GETALIDS
.
          INC       PMSAIDFD/INC
.
          MOVE      ZERO,EXIT
          PACK      KEY20,SP70
          OPEN      PMSAIDA1,"pmsaidaf"
.
          PACK      KEY31,PURNO,SP70
          CALL      RSPMAID1           * Read alternate id Table
GETALI10  CALL      RKPMAID1
          BRANCH    OVRCD,GETALI99
.
          MATCH     PURNO,PMAIURNO     * Check same UR
          GOTO      GETALI99 IF NOT EQUAL
.
          MATCH     "1",PMAIDISU
          GOTO      GETALI10 IF NOT EQUAL
.
          PACK      KEY20,PMAIALID,SP70
          MOVE      ONE,EXIT
          GOTO      GETALI99
.
          INC       PMSAIDIO/INC
          INC       IBAOVRIO/INC
.
GETALI99  CLOSE     PMSAIDA1
.
          ENDPROC
.
          INC       STD001IO
          INC       PATCODKY
          INC       PATFNDKY
          INC       PATHSPKY
          INCLUDE   PATSELFN
          INC       TFILENAM                     * Generate Temp File Name
.
          INC       IBASEQIO/INC                 * Sequential Numbers File
          INC       WEBERRIO/INC                 * Web Server Error Logging
.
          INC       AAEDE1IO/INC
          INC       AAEDTRIO/INC
          INC       AAEDI1IO/INC
          INC       IBAPASIO/INC
          INC       IBASECIO/INC
          INC       OUTBB1IO/INC
          INC       OUTDTRIO/INC
          INC       OUTCANIO/INC
          INC       OUTSITIO/INC
          INC       VISMDTIO/INC
          INC       VISMTXIO/INC
          INC       PATCODIO/INC
          INC       PATDSCIO/INC
          INC       PATDTRIO/INC
          INC       PATFACIO/INC
          INC       PATFN1IO/INC
          INC       PATHSPIO/INC
          INC       PATINVIO/INC     
          INC       PATMA1IO/INC
          INC       PATMI1IO/INC
          INC       PATREMIO/INC
          INC       PATVISIO/INC
          INC       PMSVX1IO/INC
          INC       PMSCNOIO/INC
          INC       PATRASIO/INC
.
.
ENDIT     CHAIN     PGM
          STOP
.
