.----------------------------------------------------------------------
. Program       : ALLWEB06
.
. Function      : Allied Health Group Contacts
.
. Modifications : 
.----------------------------------------------------------------------
. V12.00.01  10/11/2025  Bella Turco   TSK 0968532
.            Fixed incorrect spelling of 'HoNOS'
. V11.03.03 10/05/2023  Nikitha B     TSK 0928533
.           Recompiled for MEHHONTM changes
. V11.03.02 27.03.2023  Sunny         TSK 0929100
.           Added Infant indicator in MHTAB000 and MHUTB000
. V11.03.01 08/03/2023  Thanh T       TSK 0865479
.           Added TABL0060 to return visit type 
. V11.02.09 03.06.2022  DA Sarkies    TSK 0916831
.           Reconfigured code so that the responsible Dr and Responsible
.           team are ported across.
. V11.02.08 13/05/2022  Thanh T       TSK 0873130
.           Changed MHOMR000 to fix issue with the list not showing the
.           correctly
. V11.02.06 11/05/2022  Thanh T       TSK 0873130
.           Changed MHOMR000 to fix issue with the list not showing the
.           correctly
. V11.02.05 28/04/2022  Thanh T       TSK 0873130
.           Changed MHOMR000 to check for All ward option
. V11.02.04 17/03/2022  Thanh T       TSK 0873130
.           Added CASETFLG to show the case team details
. V11.02.03 16/02/2022  Thanh T       TSK 0873130
.           Added MHOMR000, OUTROW00, RLISN000, WSEL0000, NEXTA000,
.           PREVA000. Changed RLIS000 and ODUEH000 for MH Inpatient
.           Outcome Measure Review List
. V11.02.02 09/02/2022  Thanh T       TSK 0905641
.           Recompiled as OUTMA1FD (PATMASTM) changes
. V11.02.01 07/02/2022  Thanh T       TSK 0896905
.           Recompiled for ALLDEPFD changes
.----------------------------------------------------------------------
. V11.01.04 06/12/2021  Ebon Clements  TSK 0891705
.           Fixed ad hoc collection reasons test - Cat hp associated
.           number = 0 - RLIS0050
. V11.01.03 06/12/2021  Ebon Clements  TSK 0891705
.           Only check the same assessment type when checking for a
.           discharged collection reason - RLIS0050
. V11.01.02 30/09/2021  Ebon Clements  TSK 0891705
.           Fixed the discharged collection reason indicator test for HONOS
.           records on the same date. RLIS0050
. V11.01.01 23/03/2021  Tracey Nguyen  TSK 0901817
.           Output Category GA codes long description (patcodes.PTCDLDES)
.           instead of (patcodes.TDESC) - OPTB0000, OHTB0000
.           Increased DESCSTAT from DIM 20 to 50
.----------------------------------------------------------------------
. V11.00.05 09/12/2020  Thanh T        TSK 0872840
.           Added PMSCCDFD/PMSCCDIO as PMSPX2TM changes
. V11.00.04 11/11/2020  Ebon Clements  TSK 0898674
.           Changed overdue list keep alive to 25 records from 250 - ODUEH000
.           Removed duplicate incomplete test - ODUEH550
. V11.00.03 04/11/2020  Sunny  TSK 0897474
.           Recompiled for MEHHONTM 
. V11.00.02 11/06/2020  Ebon Clements  TSK 0887960
.           Added referral status edit to group session master add patient
.           SESS2500
. V11.00.01 05/05/2020  Ebon Clements  TSK 0887960
.           Added referral status/date edit to group session add patient
.           CONT2500
. V10.15.07 18/02/2020  Davin          TSK 0874266
.           Set 'user id completed' to blank if honos is not completed
. V10.15.06 11/02/2020  Davin          TSK 0874266
.           Write Web User ID Completed (MHHNWEBF) when outcome is completed
. V10.15.05 07/01/2020  Ebon Clements  TSK 0885102
.           Added new discharge collection reason indicator test to
.           the HONOS review list - RLIS0050
. V10.15.04 30/12/2019  Thanh T.       TSK 0878029
.           Changed REVDIS50 to determine the add/update icon by matching
.           the MHHNCOMP with 0 isntead of MHHNDATF with SPACES
. V10.15.03 13/11/2019  Thanh T.       TSK 0878029
.           Changed RLIS0000 to show rows which are completed
. V10.15.02 11/11/2019  Tracey Nguyen  TSK 0858390
.           Added EXCLADOM,EXHON000 to exclude ADOM fields before updating
.           mehhonaf in EXHON000
. V10.15.01 29/10/2019  Peter Vela     TSK 0882956
.           Added validation for Primary Referral in CONT2800
. V10.14.10 30/08/2019  Ebon Clements  TSK 0871639
.           Changed overdue list keep alive to 250 records from 4000 - ODUEH000
. V10.14.09 14/08/2019  Thanh T.       TSK 0878422
.           Recompiled for MEHHLSTM changes
. V10.14.08 09/08/2019  Ebon Clements  TSK 0872247
.           Ignore ad hoc reviews on outcome measures review list - RLIS0000
. V10.14.07 31/07/2019  Peter Vela     TSK 0876598
.           Default SP70 into DOCFNAME if no doctor found at REVDIS50
. V10.14.06 25/07/2019  Tracey Nguyen  TSK 0858390
.           Added MREAS000, HTMLLNK4,HTMLLNK5 in MHTAB000, MHUTB000
. V10.14.05 24/07/2019  Peter Vela     TSK 0858824
.           Added Additional HCPs functionality
. V10.14.04 14/06/2019  Tracey Nguyen  TSK 0856503
.           Recompiled for MEHDIATD/TM - Diagnosis type 1 to 6
. V10.14.03 06/12/2019  Ken Bell       TSK 0872398
.           Tags to Verify Collection Date with Inpatient Adm/Dis Dates
. V10.14.02 21/02/2019  Ania P         TSK 0865184
.           Split output for HTTG0210 into Add & Update
. V10.14.01 19/02/2019  Ania P         TSK 0865184
.           Added output for HTTG0210
. V10.13.03 15/08/2018  Tracey Nguyen  TSK 0852969
.           Recompiled for MEHHLSTM
. V10.13.02 31/07/2018  Thanh T         TSK 0845563
.           Recompiled for ALLAUDFD
. V10.13.01 30/07/2018  Ebon Clements   TSK 0815359
.           Don't display IP department in selection lists
. V10.12.01 13/03/2018  Ania P         TSK 0853938
.           Recompiled for MEHHONTM
. V10.11.03 27/11/2017  Thanh Tieu     Task 0821710
.           Recompiled as PATMASTM changed
. V10.11.02 15/08/2017  Thanh T.       TSK 0821710
.           Removed PATCMNFD/PATCMNIO since it is not used.
. V10.11.01 30/07/2017  Thanh T.       TSK 0821710
.           Audit admission/outpatient/UR comments. changed PATMASTM/PMSPX2TM.
.----------------------------------------------------------------------
. V10.10.02 15/05/2017  Richa Phogat   TSK 0299195
.           Added a filter and column for Case Team (MHHNCAST in REVDIS00)
. V10.10.01 14/03/2017  Ania P         TSK 0832481
.           Recompiled for MEHHONTM
. V10.09.01 27/01/2017  Ebon Clements  TSK 0828785
.           Recompiled for ALLREFTM - OP Site selection list security test
. V10.08.06 02/09/2016  Ania P         CAR 819643
.           Output MHHNAD8A and MHHNFREE in RETPRE00
. V10.08.05 31/08/2016  Ania P         CAR 824296
.           Replaced MHHNRHCP with MHHNPHCP in RLIS0000
. V10.08.04 30/08/2016  Ania P         CAR 814033
.           Recompile for MEHHONTM
. V10.08.03 10/08/2016  Ania P         CAR 814035
.           Recompile for MEHHONTM
. V10.08.02 26/07/2016  Ania P         CAR 819009
.           Recompile for MEHHONTM
. V10.08.01 08/07/2016  Jill Parkinson TSK 0822002
.           Recompiled for PATMASTM
. V10.07.01 10/12/2015  Ania P         CAR 318818
.           Added matching of HONOSTYP to MHHNHOTY in RETPRE00
. V10.06.10 28/09/2015  Peter Vela     CAR 316640
.           Added HONOS Table UR Based
. V10.06.09 16/09/2015  Ebon Clements  CAR 319899
.           Added LOOPCNTR to keep server alive - ODUEH000
. V10.06.08 09/09/2015  Ebon Clements  CAR 319899
.           Added OMEASURE and HONFILTR to NXTGRP00 and PRVGRP00
.           Set HONFILTR to zero in CLRPAR00
. V10.06.07 11/08/2915  Ania P         CAR 319861
.           Recompile for ALLREFTM
. V10.06.06 07/08/2015  Ania P            CAR 319811
.           Recompiled for changes to MEHHONTM
. V10.06.05 30/07/2015  Ania P            CAR 319818
.           Recompiled for changes to MEHHONTM
. V10.06.04 22/07/2015  Ania P            CAR 319768
.           Fixed graph plotting and updated new mappings for ADOM
. V10.06.03 21/07/2015  Ania P            CAR 303210
.           Recompiled for changes to MEHHONTM
. V10.06.02 14/05/2015  Ebon Clements     CAR 303890
.           Added ALLPROFD and open
. V10.06.01 16/03/2015  Don Nguyen        CAR 306757
.           Recompiled for MEHHLSTM
.           12/03/2015  Steve Armstrong   CAR 314108
.           Removed reference to PATCGPFD (No Longer in use)
.----------------------------------------------------------------------
. V10.05.03 26/08/2014  Ania P            CAR 303210
.           Added fiters for outcome measures (NZ/ADOM/HONOS).
.           New variable OMEASURE in RLIS0000 and ODUEH000 
. V10.05.02 03/10/2014  Ebon Clements  CAR 268970
.           Change to use OUTCLIFD index 1 instead of index 2
. V10.05.01 26/08/2014  Ania P            CAR 303210                     
.           Populated MHHNURNO before write to mehhonaf               
. V10.04.06 15/05/2014  Don Nguyen        CAR 299126
.           Modified CONT3000 & CONT5500 - check future date/time (CHFTGC00)
. V10.04.05 07/04/2014  Peter Vela        CAR 286258
.           Recompiled for PATMASTM
. V10.04.04 01/04/2014  Nicole Torrisi    CAR 269742
.           Changed display of secure score to accommodate 1-12 ratings
. V10.04.03 31.03.2014  B.G.Ackland  CAR 299363
.           Replace META Tag Redirect with Javascript in Common RDIREC00
.           Routine
. V10.04.02 31/03/2014  Ebon Clements     CAR 298817
.           Added no further review test to overdue review list - ODUEH000
. V10.04.01 26/03/2014  Don Nguyen        CAR 228900
.           Added cgi vars ALGRO012-16 for new fields in allgroaf.
.           Added ALGR0240-ALGR0280 for OPTION tag outputs (24-28).
.----------------------------------------------------------------------
. V10.03.17 02/10/2013  Patrick Adair     CAR 265798
.           Recompiled for MEHDIATM
. V10.03.16 02/10/2013  Peter Vela        CAR 291757
.           Recompiled for ALLREFTM
. V10.03.15 30/06/2013  Davin             CAR 283202
.           Recompiled for changes to hl7 messaging
. V10.03.14 05/07/2013  Nicole Torrisi   CAR 281080
.           Changes to validate department before adding refs to grp sessions
. V10.03.13 30/06/2013  Davin             CAR 279183
.           Recompiled for changes to hl7 messaging (allquefd)
. V10.03.12 17/06/2013  Nicole Torrisi   CAR 281080
.           Changes to prevent primary referrals being added to group sessions
. V10.03.11 12/06/2013  Patrick Adair    CAR 286403
.           Recompiled for MEHHONTM
. V10.03.10 19/03/2013  Jill Parkinson CAR 282814
.           Recompiled for PATMASTM - Disability alert DSAL0000 change
. V10.03.09 25/02/2013 Ania P            CAR 281021
.           Removed unnecessary modification of constants.
. V10.03.08 10/10/2012  Peter McMullen   CAR 272741
.           Add folder suffix to tablesort output
. V10.03.07 28/05/2012  Ebon Clements    CAR 236242
.           Activate waiting referrals when adding patient to group session
. V10.03.06 18/05/2012  Mike Laming      CAR 260105
.           Added test for HONOS Type "Secure" (MHHNHOTY) to set template "019"
.           Add Secure values to remote script in RETPRE00, recompile 4 MEHHONTM
. V10.03.05 21/03/2012  Peter Vela       CAR 261571
.           Recompiled for MEHHONTM
. V10.03.04 20/02/2012  Nicole Torrisi   CAR 256501
.           Recompiled for MEHHONTM
. V10.03.03 13/02/2012  Nicole Torrisi   CAR 256501
.           Added DATASET3 and DATASET4 for HONOS graphs and added output
.           of patient referral details to report 4, fieldset 5
. V10.03.02 24/01/2012  Mike Laming      CAR 186519
.           Added Patient Att.Status & HCP Att.Status to List at ETAB2000
. V10.03.01 16/01/2012  Sandra Barcham  CAR 256563
.           Recompiled for PATMASTM
. V10.00.09 25/10/2010  Mike Laming       CAR 231674
.           Mod to HoNoS Overdue Review list - use HCP sequence if HCP selected
. V10.00.08 29/09/2010  Peter Vela        CAR 230994
.           Recompiled for MEHHLSTM
. V10.00.07 24/08/2010  Mike Laming       CAR 195158
.           Added HoNoS Overdue Review list ODUEH000                        
. V10.00.06 24/08/2010  Mike Laming       CAR 195158
.           Recompiled for PATMASTM - Legal Status Icon changes
. V10.00.05 18/06/2010 Mike Laming       CAR 221911
.           Re-compiled for PATMASTM - NZ LS Alerts
. V10.00.04 03/05/2010  Mike Laming    CAR 219765
.           Add test for "Active" HoNoS in RLIS0000
. V10.00.03 31/03/2010  Mike Laming  CAR 217575
.           Recompiled for changes to MEHDIAFD
. V10.00.02 23/03/2010  Ebon Clements  CAR 193357
.           Recompiled for MEHHONTM - Exclude ratings 7, 8 & 9 from total score
.----------------------------------------------------------------------
. V9.12.10  18/03/2010  Jill Parkinson CAR 187630
.           Moved check tcform6 on cat hp in RLIS0000 to output all incomplete
. V9.12.09  09/03/2010  Jill Parkinson CAR 187630
.           Mods to check tcform6 on cat hp in RLIS0000
. V9.12.08  08/02/2010  Peter Vela     CAR 211798
.           Added direct read to ALLREFFD @ MHHON850
. V9.12.07  04/02/2010  Jill Parkinson CAR 208962
.           Mods to check for valid visit in MHHON000
. V9.12.06  22/01/2010  Peter Vela     CAR 211798
.           Added validation for HONOS Collection Date and HONOS Completion Date
.           in MHHON000 Add and Update.
. V9.12.05  12/01/2010  Jill Parkinson CAR 185864
.           Mods to output ALREHCP in RLIS0000
. V9.12.04  11/01/2010  Ebon Clements CAR 191610
.           Added cultural support and NGO fields to RETPRE00
. V9.12.03  08/12/2009  Peter Vela    CAR 211798
.           Added validation for HONOS date and Referral Close date in MHHON000
.           Add and Update
. V9.12.02  11/08/2009  Mike Laming   CAR 202881
.           Re-compiled for MEHHONTD.INC - change MHHON085 from DIM 2 to DIM3
. V9.12.01  09/06/2009  Jill Habasque CAR 193470
.           Moved read of patcodes for previous change
. V9.11.10  07/04/2009  Mike Laming   CAR 193470
.           Added "Collection Occasion" MHHNREAS to HONOS Table routine MHTAB000
. V9.11.09  31/03/2009  Saroeun Soeur CAR 193411 
.           Added open MLTCODA1 for multi hospital
. V9.11.08  05/03/2009  Jill Habasque CAR 181565
.           Recompiled for MEHHONTM
. V9.11.07  03/02/2009  Ebon Clements CAR 182077
.           Added inactive test to legal status display - MHHON810
. V9.11.06  16/02/2009 Jill Habasque CAR 181543
.           Mods to calculate total score
. V9.11.05  25/02/2009 Ebon Clements CAR 187703
.           Added hospital security tests to department selection lists
.           DEPS0000
. V9.11.04  24/02/2009  Ebon Clements CAR 186823
.           Only display inactive HONOS in supervisor list - MHTAB000
. V9.11.03  24/02/2009  Ebon Clements CAR 182077
.           Fixed clear of legal status file - MHHON810
. V9.11.02  27/01/2009  Mike Laming   CAR 185601
.           Added Cat/Codes Ind.1 to addHONOS() and updateHONOS() at REVDIS50
. V9.11.01  05/11/2008  Peter McMullen CAR 174725
.           convert internal javascript to W3C standards
. V9.10.01  03/07/2008  Ebon Clements CAR 170971
.           Fixed allocation of next group contact number - CONT1000
. V9.09.03  12/02/2008  J.Tan         CAR 135498
.           Mods for MHINC Extract
. V9.09.02  28/08/2007  Davin         CAR 135538
.           Added report option 5 - Assessment details
.           24/08/2007  Ebon Clements CAR 133923
.           Changed department selection lists to be in alphabetical order
. V9.09.01  09/08/2007  Jill Habasque            CAR 135539
.           Added report option 4 - HONOS details
. V9.09.00  06/07/2007  Ebon Clements            CAR 135536
.           Created Web Server.
.----------------------------------------------------------------------
          INC       IBAWEBDF    
          INC       WEBDATDF
.
          INC       ALLADSFD/INC
          INC       ALLADSTD/INC
          INC       ALLATSFD/INC
          INC       ALLAUDFD/INC
          INC       ALLCASFD/INC
          INC       ALLCONFD/INC
          INC       ALLDEPFD/INC
          INC       ALLDIAFD/INC
          INC       ALLDSPFD/INC
          INC       ALLENCFD/INC
          INC       ALLGEHFD/INC
          INC       ALLGPAFD/INC
          INC       ALLGREFD/INC
          INC       ALLGRHFD/INC
          INC       ALLGROFD/INC
          INC       ALLGRPFD/INC
          INC       ALLRITFD/INC
          INC       ALLPROFD/INC
          INC       ALLPRRFD/INC
          INC       ALLREFFD/INC
          INC       ALLREFTD/INC
          INC       ALLRLNFD/INC
          INC       ALLSERFD/INC
          INC       ALLSTSFD/INC
          INC       ALLQUEFD/INC
          INC       HL7CISFD/INC
          INC       HL7INBFD/INC
          INC       MEHHONFD/INC
          INC       MEHHONTD/INC
          INC       MEHDIATD/INC
          INC       MEHHLSTD/INC
          INC       MEHDIAFD/INC
          INC       MEHHLSFD/INC
          INC       MEHDLSFD/INC
          INC       MEHVI1FD/INC
          INC       PATNIDFD/INC
          INC       PMSHCLFD/INC
          INC       PMSHCPTD/INC
          INC       PATDO1FD/INC 
          INC       ALLCTMFD/INC
          INC       APSMASFD/INC
          INC       PATMA1FD/INC
          INC       PATCONFD/INC
          INC       PATALRFD/INC
          INC       PATVISFD/INC
          INC       PATHSPFD/INC
          INC       PMSHCPFD/INC
          INC       PMSQPTFD/INC
          INC       PMSVX1FD/INC
          INC       OUTSITFD/INC
          INC       OUTCTYFD/INC
          INC       OUTCLIFD/INC
          INC       PMSUCHFD/INC
          INC       PMSUCDFD/INC
          INC       PATMASTD/INC
          INC       PATEORFD/INC
          INC       PATVADFD/INC
          INC       PATRE1FD/INC
          INC       PMSPX2FD/INC
          INC       PMSPX2TD/INC
          INC       PATMI1FD/INC
          INC       PATFN1FD/INC
          INC       PATPR1FD/INC
          INC       PATWR1FD/INC
          INC       MLTSECFD/INC
          INC       MLTSITFD/INC
          INC       MRTMASFD/INC
          INC       NHIMASFD/INC
          INC       NHIETHFD/INC
          INC       PATCALAG/INC
          INC       PATIN1FD/INC
          INC       PMSHCGTD/INC
          INC       PMSHCGFD/INC
          INC       PRIITMFD/INC
          INC       PATDSCFD/INC
          INC       PATASFFD/INC
          INC       PATDGWFD/INC
          INC       PATITMFD/INC
          INC       PMSCCDFD/INC            * Concession Card Details
.
. allgroaf cgi vars
.
.Name     Type      Length Description
.----     ----      ------ -----------
ALGRO001  DIM       8      Session Number
ALGRO002  DIM       60     Session Name
ALGRO003  DIM       3      Session Type (Cat gy)
ALGRO004  DIM       3      Location (Cat PO)
ALGRO005  DIM       1      Day Indicator
ALGRO006  DIM       8      Start Date (CCYYMMDD)
ALGRO007  DIM       8      Start Time (HH:MM:SS)
ALGRO008  DIM       3      Duration (Minutes)
ALGRO009  DIM       3      Department Code (alldepaf)
ALGRO010  DIM       3      Frequency (Cat fr) 
ALGRO011  DIM       1      Active 0=Active 1=Inactive
ALGRO012  DIM       3      Contract (Cat gb)
ALGRO013  DIM       3      User Defined Field 1 (Cat g1)
ALGRO014  DIM       3      User Defined Field 2 (Cat g2)
ALGRO015  DIM       3      User Defined Field 3 (Cat g3)
ALGRO016  DIM       3      User Defined Field 4 (Cat g4)
.
. allgrpaf cgi vars
.
.Name     Type      Length Description
.----     ----      ------ -----------
ALGRP001  DIM       8      Session Number
ALGRP002  DIM       8      U/R
ALGRP003  DIM       8      Referral Number (allrefaf)
ALGRP004  DIM       1      Active 0=Active 1=Inactive
.
. allgrhaf cgi vars
.
.Name     Type      Length Description
.----     ----      ------ -----------
ALGRH001  DIM       8      Session Number
ALGRH002  DIM       10     HCP (pmschpaf)
ALGRH003  DIM       3      HCP Speciality (Cat DT)
ALGRH004  DIM       1      Active 0=Active 1=Inactive
.
. allgreaf cgi vars
.
.Name     Type      Length Description
.----     ----      ------ -----------
ALGRE001  DIM       8      Contact Number
ALGRE002  DIM       8      Session Number (allgroaf)
ALGRE003  DIM       3      Location (Cat PO)
ALGRE004  DIM       8      Group Contact Date (CCYYMMDD)
ALGRE005  DIM       8      Group Contact Time (HH:MM:SS)
ALGRE006  DIM       3      Duration (minutes)
.
. allgehaf cgi vars
.
.Name     Type      Length Description
.----     ----      ------ -----------
ALGEH001  DIM       8      Contact Number
ALGEH002  DIM       10     HCP (pmshcpaf)
ALGEH003  DIM       3      HCP Specialty (Cat DT)
ALGEH004  DIM       3      HCP Status (Cat GA)
.
. allgpaaf cgi vars
.
.Name     Type      Length Description
.----     ----      ------ -----------
ALGPA001  DIM       8      Contact Number
ALGPA002  DIM       8      U/R
ALGPA003  DIM       8      Referral Number (allrefaf)
ALGPA004  DIM       1      Current Patient 0=No 1=Yes
ALGPA005  DIM       3      Patient Status (Cat GA)
ALGPA006  DIM       1      Meals Provided 0=No 1=Yes
ALGPA007  DIM       1      MOH Extract 0=No 1=Yes
.
FLTRDEPT  DIM       3      Department Filter
FLTRLOCN  DIM       3      Location Filter
FLTRACTV  DIM       1      Active/Inactive Filter
FILTRDAY  DIM       1      Day Filter
FILTOPTN  DIM       1      option filter
FILTWARD  DIM       3      Ward filter
DFLTWARD  DIM       3      
SHOWFLAG  DIM       1      
.
.
. Vars
.
ADDMASTR  DIM       1
ASSMTYPE  DIM       10
ASSTDESC  DIM       30
BOOKDATE  DIM       8
CISMFLAG  FORM      1
COMPDESC  DIM       3
COMPSTAT  DIM       15
COUNT     FORM      3
CURRDATE  DATE      8
CURRTIME  DIM       8
DATECLSD  DIM       8
DEFTFLAG  FORM      1
DEPTCODE  DIM       3 
DESCACTV  DIM       8  
DESCDEPT  DIM       20
DESCMOHX  DIM       3
DESCSEST  DIM       20
DESCSPEC  DIM       20
DESCSTAT  DIM       50
DESCLOCN  DIM       20
DIM3      DIM       3
DIM50     DIM       50
CFILEPRE  DIM       3
DATASET0  DIM       16
DATASET1  DIM       16
DATASET2  DIM       16
DATASET3  DIM       16
DATASET4  DIM       16
DIM6      DIM       6
DOCTCODE  DIM       10
DOCINDIC  DIM       1
CASETEAM  DIM       10
DRECCNT   DIM       4
EXCLADOM  DIM       1             * Exclude ADOM fields flag
EXPRDATE  DATE      8
FBOKDATE  DIM       12
FILTTEAM  DIM       10       
F2A       FORM      2
F3A       FORM      3
F3P2      FORM      3.2
F3B       FORM      3
HONSDATE  DATE      8
RECCNT    FORM      4
REMNDAYS  DIM       3
REFNUMBR  DIM       8
FUNCTYPE  FORM      2
FOLDERSF  DIM       3
FORM8     FORM      8
HONAVAIL  FORM      1
HONOSTYP  DIM       3
HONOSTY1  DIM       1
HONFILTR  FORM      1
HONOSIN1  DIM       1
HNTYDESC  DIM       25
HNRCDESC  DIM       25
FILTSTAT  DIM       1
STATSCHG  FORM      1
HTMLLNK2  DIM       127
HTMLLNK3  DIM       127
HTMLLNK4  DIM       127                                    *T0858390
HTMLLNK5  DIM       127                                    *T0858390
HTMLLNK6  DIM       127 
HTMLLNK7  DIM       127 
IBAMFLAG  FORM      1
LINKICON  DIM       15
LINKFUNC  DIM       20
DISCDATE  DIM       8
CASETFLG  DIM       1             * show case team flag 
.
LISTVIEW  FORM      1
LOOPCNTR  FORM      8
MESSAGID  DIM       20
NEXTPAGE  DIM       1 
NEWKEY24  DIM       24
NMPNUMB   DIM       20        * actual number keyed in
OUTCOMEC  DIM       20
OVERDUE   FORM      1
STATCODE  DIM       1
STATDESC  DIM       10
OMEADESC  DIM       20
DISPICON  DIM       20
HCPATSTA  DIM       8
OMEASURE  DIM       3         * Outcome Measure Filter
PATATSTA  DIM       8 
PHCPDESC  DIM       50
PREVHON   FORM      1
PSAGETYP  DIM       3
PSAGECON  DIM       3
RHCPNAME  DIM       35
REFSTAT   DIM       10
SAVKEY24  DIM       24
SAVVISN   DIM       8
SAVVUNIQ  DIM       8
SITECODE  DIM       6
SECSCORE  DIM       3 
SENTSTAT  DIM       15
SEQR      FORM      3                       * report sequence in ODUEH000
SP16      INIT      "                "
SSETDESC  DIM       25
SUPRFLAG  DIM       1
TEMPDAT1  DIM       12
TEMPDAT2  DIM       12
TEMPDAT3  DIM       12
TOTDSPLY  DIM       40
TOTSCORE  DIM       3
TYPEOFAS  DIM       1
PRTPDATE  DIM       8   
UPDTTYPE  DIM       1
VALDCODE  DIM       50
.
CATGA     INIT      "GA" 
CATLHP    INIT      "hp"
CATLHS    INIT      "hs"
CATLSS    INIT      "ss"
CATGY     INIT      "gy"
CATtm     INIT      "tm"
NBSP      INIT      "&nbsp;"
.
.----------------------------------------------------------------------
PRGID     INIT      "ALLWEB06"
VERSION   INIT      "V12.01.00"
PRGNAM    INIT      "Allied Health Group Contacts"
.----------------------------------------------------------------------
          CALL      WEBINT00       * Initialise Fifo Etc.
          CALL      INIT0000       * Open Files
.
MAIN1000  CALL      WEBRED00       * Read Fifo WEBPID and USERID
.
MAIN1010  COMPARE   "999",REPORTNO * End Server Process on Report Option 999
          GOTO      MAIN9999 IF EQUAL
.
          CALL      OUTFIL00       * Check Correct Site Files Are Open
          BRANCH    EXIT,MAIN1000
.
MAIN1020  BRANCH    REPORTNO,MAIN1100,MAIN1200,MAIN1300,MAIN1400,MAIN1500
.
          PACK      WEBTITLE,PRGID,SP1,VERSION,SP1,PRGNAM,SP70
          MOVE      "Invalid Option",WEBTITLE
          CALL      WEBERR00   * Create Output File and Write HTML Page Header
          GOTO      MAIN1000
.
MAIN1100  CALL      SESS0000                     * Session setup
          BRANCH    EXIT,MAIN1000
          CALL      NXTPAG00
          GOTO      MAIN1000
.
MAIN1200  CALL      CONT0000                      * Group Contacts
          BRANCH    EXIT,MAIN1000
          CALL      NXTPAG00
          GOTO      MAIN1000
.
MAIN1300  CALL      REMOTE00                     * REMOTE SCRIPTING ROUTINES
          GOTO      MAIN1000
.
MAIN1400  CALL      MHHON000                      * MH HONOS details
          BRANCH    EXIT,MAIN1000
          CALL      NXTPAG00
          GOTO      MAIN1000
.
MAIN1500  CALL      ASSREF00                     * Assessments for referrals
          BRANCH    EXIT,MAIN1000,MAIN1000
          CALL      NXTPAG00
          GOTO      MAIN1000
.
MAIN9999  MOVE      "SERVER SHUTDOWN COMPLETE",WEBTITLE
          CALL      WEBERR00
          STOP
.------------------------------------------------------------
. Output Next Page Based on CGI Parameter nextpage
.------------------------------------------------------------
NXTPAG00  MOVE      ZERO,F1
          MOVE      NEXTPAGE,F1
          BRANCH    F1,NXTPAG10,NXTPAG20,NXTPAG30,NXTPAG40
.
          CALL      WINCLS00
          GOTO      NXTPAG99
.
NXTPAG10  CALL      RDIREC00
          GOTO      NXTPAG99
.
NXTPAG20  CALL      GOBACK00      * Go Back 1 Html page
          GOTO      NXTPAG99
.
NXTPAG30  CALL      DAH20000      * Go Back 2 html pages
          GOTO      NXTPAG99
.
NXTPAG40  CALL      PREDIR00      * Redirect Parent
          GOTO      NXTPAG99
.
NXTPAG99  RETURN
.------------------------------------------------------------------------------
.  Redirect Parent URL
.------------------------------------------------------------------------------
PREDIR00  CALL      OPENHTML
          BRANCH    EXIT,PREDIR90
.
          WRITE     HTMLFILE;"<script type=#"text/javascript#"> {":
                             " parent.location.href=#"",REDIRECT,"#";":
                             "}":
                             "</script>"
          CALL      CLOSHTML
          GOTO      PREDIR99
.
PREDIR90  DISPLAY   "*** Fifo Not Found ***"
.
PREDIR99  RETURN
.-------------------------------------------------------------------------------
.  Goes back 1 page
.-------------------------------------------------------------------------------
GOBACK00  CALL      OPENHTML
          BRANCH    EXIT,GOBACK99
          WRITE     HTMLFILE;"<script type=#"text/javascript#"> {":
                             "    alert(#"",WEBTITLE,"#");":
                             "    self.close();":
                             "    opener.history.go(-1);":
                             "}":
                             "</script>"
          CALL      CLOSHTML
GOBACK99  RETURN
.------------------------------------------------------------
. Open Files and Initialize Variables
.------------------------------------------------------------
INIT0000  OPEN      ALLADSA1,"alladsaf"
          OPEN      ALLATSA1,"allatsaf"
          OPEN      ALLAUDA1,"allaudaf"
          OPEN      ALLCASA1,"allcasaf"
          OPEN      ALLCTMA1,"allctmaf"
          OPEN      ALLDEPA1,"alldepaf"
          OPEN      ALLDIAA1,"alldiaaf"
          OPEN      ALLDIAA2,"alldiaaf"
          OPEN      ALLDSPA1,"alldspaf"
          OPEN      ALLENCA1,"allencaf"
          OPEN      ALLGEHA1,"allgehaf"
          OPEN      ALLGPAA1,"allgpaaf"
          OPEN      ALLGPAA2,"allgpaaf"
          OPEN      ALLGREA1,"allgreaf"
          OPEN      ALLGREA2,"allgreaf"
          OPEN      ALLGREA3,"allgreaf"
          OPEN      ALLGRHA1,"allgrhaf"
          OPEN      ALLGRHA2,"allgrhaf"
          OPEN      ALLGROA1,"allgroaf"
          OPEN      ALLGRPA1,"allgrpaf"
          OPEN      ALLGRPA2,"allgrpaf"
          OPEN      ALLREFA1,"allrefaf"
          OPEN      ALLREFA3,"allrefaf"
          OPEN      ALLREFA4,"allrefaf"
          OPEN      ALLREFA5,"allrefaf"
          OPEN      ALLRLNA1,"allrlnaf"
          OPEN      ALLRLNA2,"allrlnaf"
          OPEN      ALLPROA1,"allproaf"
          OPEN      ALLPROA2,"allproaf"
          OPEN      ALLPRRA1,"allprraf"
          OPEN      ALLPRRA2,"allprraf"
          OPEN      ALLRITA1,"allritaf"
          OPEN      ALLSERA1,"allseraf"
          OPEN      ALLSERA2,"allseraf"
          OPEN      ALLSTSA1,"allstsaf"
          OPEN      COMCODA1,"comcodaf"
          OPEN      COMCODA2,"comcodaf"
          OPEN      MEHHONA1,"mehhonaf"
          OPEN      MEHHONA2,"mehhonaf"
          OPEN      MEHHONA3,"mehhonaf"
          OPEN      MEHHONA4,"mehhonaf"
          OPEN      MEHDLSA1,"mehdlsaf"
          OPEN      MEHHLSA1,"mehhlsaf"
          OPEN      MEHHLSA2,"mehhlsaf"
          OPEN      MEHDIAA1,"mehdiaaf"
          OPEN      MEHVI1A1,"mehvi1af"
          OPEN      MLTSITA1,"mltsitaf"
          OPEN      PMSHCLA1,"pmshclaf"
          OPEN      PMSHCPA1,"pmshcpaf"
          OPEN      PATDO1A1,"patdo1af"
          OPEN      PATCODE1,"patcodes"
          OPEN      PATCODE2,"patcodes"
          OPEN      PATHSPA1,"pathspaf"
          OPEN      PATMI1A1,"patmi1af"
          OPEN      PATMI1A2,"patmi1af"
          OPEN      PATMI1A8,"patmi1af"
          OPEN      PATWR1A7,"patwr1af"
          OPEN      WEBSECA1,"websecaf"
.
          CALL      INTMAS00     * Open routine for PATMASTM
.
          OPEN      PATVISA1,"patvisaf"
          OPEN      PATVISA2,"patvisaf"
          OPEN      PMSVX1A1,"pmsvx1af"
          OPEN      PATRE1A1,"patre1af"
          OPEN      PATDGWA1,"patdgwaf"
          OPEN      PATITEM1,"patitemn"
          OPEN      PATASFA1,"patasfaf"
          OPEN      PATDSCH1,"patdschf"
          OPEN      PATDSCH2,"patdschf"
          OPEN      PRIITEM1,"priitemf"
          OPEN      PATMI1A1,"patmi1af"
.
          READ      CONTROLF,ZERO;*43,IBCNMHOS
          READ      CONTROLF,HUND06;*27,ALCNRAUD,*202,ALCNAAUD
          READ      CONTROLF,EIGHTY;*250,PTCNHDPS
.
          IF        IBCNMHOS=1
            OPEN      MLTCODA1,"mltcodaf"
            OPEN      MLTCODA2,"mltcodaf"
            OPEN      MLTSECA1,"mltsecaf"
          ENDIF
.
          MATCH     "1",ALCNAAUD
          IF        @EQUAL
            OPEN      ALLAUDAD,"allaudad"
          ENDIF
.
          MATCH     "1",ALCNRAUD
          IF        @EQUAL
            OPEN      ALLAUDRE,"allaudre"
          ENDIF
.
          MOVE      "out",CFILEPRE
          OPEN      OUTSITA1,"outsitaf"
          OPEN      OUTSITA2,"outsitaf"
.
          CALL      OPNOUT00
.
INIT9999  RETURN
.
.------------------------------------------------------------
. Clear Parameters
.------------------------------------------------------------
CLRPAR00  MOVE      ZERO,REPORTNO
          MOVE      SP70,TEMPLATE
          MOVE      SP70,NEXTPAGE
          MOVE      SP70,REDIRECT
          MOVE      ZERO,NORECORD
          MOVE      ZERO,STARTNUM
          MOVE      SP70,UPDTTYPE
          MOVE      SP70,URNUMBER
          MOVE      SP70,ADMISSNO
          MOVE      SP70,DEPTCODE
          MOVE      ZERO,HONAVAIL
          MOVE      SP70,FLTRLOCN
          MOVE      SP70,FLTRACTV
          MOVE      SP70,FILTRDAY
          MOVE      SP70,FLTRDEPT
          MOVE      ZERO,LISTVIEW
          MOVE      ZERO,DEFTFLAG
          MOVE      ZERO,FUNCTYPE
          MOVE      SP70,VALDCODE
          MOVE      SP70,ADDMASTR
          MOVE      SP70,HONOSTYP
          MOVE      ZERO,HONFILTR
          MOVE      SP70,OMEASURE
          MOVE      SP70,FILTOPTN
          MOVE      SP70,FILTWARD
          MOVE      SP70,FILTSTAT
          MOVE      ZERO,STATSCHG
          MOVE      SP70,SHOWFLAG
.
          MOVE      Z70,ALGRO001
          MOVE      Z70,ALGRO002
          MOVE      Z70,ALGRO003
          MOVE      Z70,ALGRO004
          MOVE      Z70,ALGRO005
          MOVE      Z70,ALGRO006
          MOVE      Z70,ALGRO007
          MOVE      Z70,ALGRO008
          MOVE      Z70,ALGRO009
          MOVE      Z70,ALGRO010
          MOVE      Z70,ALGRO011
          MOVE      Z70,ALGRO012
          MOVE      Z70,ALGRO013
          MOVE      Z70,ALGRO014
          MOVE      Z70,ALGRO015
          MOVE      Z70,ALGRO016
.
          MOVE      Z70,ALGRP001
          MOVE      Z70,ALGRP002
          MOVE      Z70,ALGRP003
          MOVE      Z70,ALGRP004
.
          MOVE      Z70,ALGRH001
          MOVE      Z70,ALGRH002
          MOVE      Z70,ALGRH003
          MOVE      Z70,ALGRH004
.
          MOVE      Z70,ALGRE001
          MOVE      Z70,ALGRE002
          MOVE      Z70,ALGRE003
          MOVE      Z70,ALGRE004
          MOVE      Z70,ALGRE005
          MOVE      Z70,ALGRE006
.
          MOVE      Z70,ALGEH001
          MOVE      Z70,ALGEH002
          MOVE      Z70,ALGEH003
          MOVE      Z70,ALGEH004
.
          MOVE      Z70,ALGPA001
          MOVE      Z70,ALGPA002
          MOVE      Z70,ALGPA003
          MOVE      Z70,ALGPA004
          MOVE      Z70,ALGPA005
          MOVE      Z70,ALGPA006
          MOVE      Z70,ALGPA007
.
          CALL      CPMHHN00
          CALL      CPALAD00
.
          MOVE      Z70,DATASET0
          MOVE      Z70,DATASET1
          MOVE      Z70,DATASET2
          MOVE      Z70,DATASET3
          MOVE      Z70,DATASET4
          MOVE      SP70,FILTTEAM
          MOVE      SP70,CASETEAM
          MOVE      SP70,DOCTCODE
          MOVE      SP70,DEPTCODE
          MOVE      SP70,VIEWTYPE
          MOVE      SP70,FRSTDATE
          MOVE      SP70,LASTDATE
          MOVE      SP70,VYEARMTH
.
          MOVE      SP70,EXCLADOM
.
CLRPAR99  RETURN
.------------------------------------------------------------
. Set Parameters
.------------------------------------------------------------
SETPAR00  MATCH     "reportno=",QRYNAME
          IF        @EQUAL
            MOVE      QRYDATA,REPORTNO
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "template=",QRYNAME
          IF        @EQUAL
            MOVE      QRYDATA,TEMPLATE
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "updttype=",QRYNAME
          IF        @EQUAL
            MOVE      QRYDATA,UPDTTYPE
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "urnumber=",QRYNAME
          IF        @EQUAL
            MOVE      QRYDATA,URNUMBER
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "addmastr=",QRYNAME
          IF        @EQUAL
            MOVE      QRYDATA,ADDMASTR
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "honostyp=",QRYNAME
          IF        @EQUAL
            MOVE      QRYDATA,HONOSTYP
            BUMP      QRYDATA,3
            MOVE      QRYDATA,HONOSIN1
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "honfiltr=",QRYNAME
          IF        @EQUAL
            MOVE      QRYDATA,HONFILTR
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "filtstat=",QRYNAME
          IF        @EQUAL
            MOVE      QRYDATA,FILTSTAT
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "statschg=",QRYNAME
          IF        @EQUAL
            MOVE      QRYDATA,STATSCHG
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "omeasure=",QRYNAME
          IF        @EQUAL
            PACK      OMEASURE,QRYDATA,SP70
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "filtoptn=",QRYNAME
          IF        @EQUAL
            PACK      FILTOPTN,QRYDATA,SP70
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "filtward=",QRYNAME
          IF        @EQUAL
            PACK      FILTWARD,QRYDATA,SP70
            GOTO      SETPAR99
          ENDIF
.
SETPAR20  MATCH     "showflag=",QRYNAME
          IF        @EQUAL
            PACK      SHOWFLAG,QRYDATA,SP70
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "caseteam=",QRYNAME
          IF        @EQUAL
            PACK      CASETEAM,QRYDATA,SP70
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "doctcode=",QRYNAME
          IF        @EQUAL
            PACK      DOCTCODE,QRYDATA,SP70
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "deptcode=",QRYNAME
          IF        @EQUAL
            PACK      DEPTCODE,QRYDATA,SP70
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "viewtype=",QRYNAME
          IF        @EQUAL
            MOVE      QRYDATA,VIEWTYPE
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "valdcode=",QRYNAME
          IF        @EQUAL
            MOVE      QRYDATA,VALDCODE
            PACK      VALDCODE,VALDCODE,SP70
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "admissno=",QRYNAME
          IF        @EQUAL
            MOVE      QRYDATA,ADMISSNO
            GOTO      SETPAR99
          ENDIF
.  
          MATCH     "nextpage=",QRYNAME
          IF        @EQUAL
            MOVE      QRYDATA,NEXTPAGE
            GOTO      SETPAR99
          ENDIF 
.
          MATCH     "redirect=",QRYNAME
          IF        @EQUAL
            MOVE      QRYDATA,REDIRECT
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "norecord=",QRYNAME
          IF        @EQUAL
            MOVE      QRYDATA,NORECORD
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "startnum=",QRYNAME
          IF        @EQUAL
            MOVE      QRYDATA,STARTNUM
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "frstdate=",QRYNAME
          IF        @EQUAL
            MOVE      QRYDATA,FRSTDATE
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "lastdate=",QRYNAME
          IF        @EQUAL
            MOVE      QRYDATA,LASTDATE
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "vyearmth=",QRYNAME
          IF        @EQUAL
            MOVE      QRYDATA,VYEARMTH
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "functype=",QRYNAME
          IF        @EQUAL
            MOVE      QRYDATA,FUNCTYPE
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "deftflag=",QRYNAME
          IF        @EQUAL
            MOVE      QRYDATA,DEFTFLAG
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "listview=",QRYNAME
          IF        @EQUAL
            MOVE      QRYDATA,LISTVIEW
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "deptcode=",QRYNAME
          IF        @EQUAL
            PACK      DEPTCODE,QRYDATA,SP70
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "fltrlocn=",QRYNAME
          IF        @EQUAL
            PACK      FLTRLOCN,QRYDATA,SP70
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "fltractv=",QRYNAME
          IF        @EQUAL
            PACK      FLTRACTV,QRYDATA,SP70
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "filtteam=",QRYNAME
          IF        @EQUAL
            PACK      FILTTEAM,QRYDATA,SP70
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "filtrday=",QRYNAME
          IF        @EQUAL
            PACK      FILTRDAY,QRYDATA,SP70
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "fltrdept=",QRYNAME
          IF        @EQUAL
            PACK      FLTRDEPT,QRYDATA,SP70
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "algro",QRYNAME
          IF        @EQUAL
            CALL      SGRO0000
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "algrp",QRYNAME
          IF        @EQUAL
            CALL      SGRP0000
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "algrh",QRYNAME
          IF        @EQUAL
            CALL      SGRH0000
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "algre",QRYNAME
          IF        @EQUAL
            CALL      SGRE0000
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "algeh",QRYNAME
          IF        @EQUAL
            CALL      SGEH0000
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "algpa",QRYNAME
          IF        @EQUAL
            CALL      SGPA0000
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "mhhon",QRYNAME
          IF        @EQUAL
            CALL      STMHN000
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "alads",QRYNAME
          IF        @EQUAL
            CALL      SPADS000
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "dataset0",QRYNAME
          IF        @EQUAL
            PACK      DATASET0,QRYDATA,SP70
            GOTO      SETPAR99
          ENDIF
.   
          MATCH     "dataset1",QRYNAME
          IF        @EQUAL
            PACK      DATASET1,QRYDATA,SP70
            GOTO      SETPAR99
          ENDIF
.   
          MATCH     "dataset2",QRYNAME
          IF        @EQUAL
            PACK      DATASET2,QRYDATA,SP70
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "dataset3",QRYNAME
          IF        @EQUAL
            PACK      DATASET3,QRYDATA,SP70
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "dataset4",QRYNAME
          IF        @EQUAL
            PACK      DATASET4,QRYDATA,SP70
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "excladom",QRYNAME
          IF        @EQUAL
            PACK      EXCLADOM,QRYDATA,SP70
            GOTO      SETPAR99
          ENDIF
.   
SETPAR99  RETURN
.
.------------------------------------------------------------
. Process Fields 
.------------------------------------------------------------
PROFLD00  BRANCH    REPORTNO,PROFLD10,PROFLD20,PROFLD30,PROFLD40,PROFLD50
.
          GOTO      PROFLD99 
.
PROFLD10  BRANCH    FLDSETNO,PROFLD11,PROFLD12,PROFLD13
          GOTO      PROFLD99
.
PROFLD11  CALL      ALGR0000
          GOTO      PROFLD99
.
PROFLD12  CALL      ALGP0000
          GOTO      PROFLD99
.
PROFLD13  CALL      ALGH0000
          GOTO      PROFLD99
.
PROFLD20  BRANCH    FLDSETNO,PROFLD21,PROFLD22,PROFLD23,PROFLD24
          GOTO      PROFLD99
.
PROFLD21  CALL      ALGR0000
          GOTO      PROFLD99
.
PROFLD22  CALL      ALGE0000
          GOTO      PROFLD99
.
PROFLD23  CALL      ALGA0000
          GOTO      PROFLD99
.
PROFLD24  CALL      ALGC0000
          GOTO      PROFLD99
.
PROFLD30  BRANCH    FLDSETNO,PROFLD31
          GOTO      PROFLD99
.
PROFLD31  CALL      MASF0000               
          GOTO      PROFLD99
.
PROFLD40  BRANCH    FLDSETNO,PROFLD41,PROFLD42,PROFLD43,PROFLD44,PROFLD45:
                    PROFLD46,PROFLD47
          GOTO      PROFLD99
.
PROFLD41  CALL      MASF0000
          GOTO      PROFLD99
.
PROFLD42  CALL      MHON0000                * HONOS tags
          GOTO      PROFLD99
.
PROFLD43  CALL      HTTG0000                * HONOS List
          GOTO      PROFLD99
.
PROFLD44  CALL      MHDI0000
          GOTO      PROFLD99
.
PROFLD45  CALL      DLSF0000
          GOTO      PROFLD99
.
PROFLD46  CALL      ALRE0000                * Patient Referral Details
          GOTO      PROFLD99
.
PROFLD47  CALL      TABL0000                * General Tags
          GOTO      PROFLD99
.
PROFLD50  BRANCH    FLDSETNO,PROFLD51,PROFLD52,PROFLD53,PROFLD54,PROFLD55
          GOTO      PROFLD99
.
PROFLD51  CALL      MASF0000
          GOTO      PROFLD99
.
PROFLD52  CALL      ALRE0000                * Patient Referral Details
          GOTO      PROFLD99
.
PROFLD53  CALL      ALAD0000
          GOTO      PROFLD99
.
PROFLD54  CALL      TABL0000                * General Tags
          GOTO      PROFLD99
.
PROFLD55  CALL      PMIX0000
          GOTO      PROFLD99
.
PROFLD99  RETURN
.
.------------------------------------------------------------------------------
. HONOS Table tags
.------------------------------------------------------------------------------
HTTG0000  BRANCH    FLDITMNO,HTTG0010,HTTG0020,HTTG0030,HTTG0040,HTTG0050:
                             HTTG0060,HTTG0070,HTTG0080,HTTG0090,HTTG0100:
                             HTTG0110,HTTG0120,HTTG0130,HTTG0140,HTTG0150:
                             HTTG0160,HTTG0170,HTTG0180,HTTG0190,HTTG0200:
                             HTTG0210,HTTG0220,HTTG0230,HTTG0240,HTTG0250:
                             HTTG0260,HTTG0270,HTTG0280,HTTG0290,HTTG0300:  
                             HTTG0310
.
          WRITE     HTMLFILE;"Invalid IBA Tag";
          GOTO      HTTG9999
.
HTTG0010  CALL      MHTAB000                * List of Honos for a patient
          GOTO      HTTG9999
.
HTTG0020  CALL      RLIS0000                * Review List
          GOTO      HTTG9999
.
HTTG0030  WRITE     HTMLFILE;VIEWTYPE;
          GOTO      HTTG9999
.
HTTG0040  CALL      ARFD0000                * A/H Dept. Pull down list
          GOTO      HTTG9999
.
HTTG0050  CALL      HCPCOD00                * HCP Code/Name for List filter
          GOTO      HTTG9999
.
HTTG0060  CALL      NEXT0000                * Next Page Day/Week/Month Link
          GOTO      HTTG9999
.
HTTG0070  CALL      PREV0000                * Previous Day/Week/Month Link
          GOTO      HTTG9999
.
HTTG0080  MOVE      DEPTCODE,CODE
          MOVE      "CG",CATEGORY
          CALL      CODITM00
          GOTO      HTTG9999
.
HTTG0090  CALL      SELV0000
          GOTO      HTTG9999
.
HTTG0100  WRITE     HTMLFILE;HONOSTYP;
          GOTO      HTTG9999
.
HTTG0110  CALL      NXTGRP00
          GOTO      HTTG9999
.
HTTG0120  CALL      PRVGRP00
          GOTO      HTTG9999
.
HTTG0130  WRITE     HTMLFILE;HONAVAIL;
          GOTO      HTTG9999
.
HTTG0140  WRITE     HTMLFILE;DATECLSD;
          GOTO      HTTG9999
.                                                                     *I-189452
HTTG0150  CALL      ODUEH000                * Honos Overdue Reviews 
          GOTO      HTTG9999
.
HTTG0160  WRITE     HTMLFILE;HONFILTR;
          GOTO      HTTG9999
.
HTTG0170  WRITE     HTMLFILE;OMEASURE;
          GOTO      HTTG9999
.
HTTG0180  IF        DEFTFLAG=0
            MATCH     SP70,DEPTCODE
            IF        @EQUAL
              MOVE      WBSEDALL,DEPTCODE
            ENDIF
          ENDIF
.
          CALL      ARFD0000                * A/H Dept. Pull down list
          GOTO      HTTG9999
.
HTTG0190  CALL      MHUTB000                * List of Honos for a patient
          GOTO      HTTG9999                * UR Based
.
HTTG0200  CALL      CASETM00               * Case Team Code/Name for List filter
          GOTO      HTTG9999
.
HTTG0210  UNPACK    DIM127,D1,KEY1,DIM127
          MOVE      KEY1,F1
          IF        F1=0
            PACK      KEY5,CATLHS,HONOSTYP
          ELSE
            PACK      KEY5,CATLHS,MHHNHOTY
          ENDIF
          CALL      RDCODE1
          BRANCH    OVRCD,HTTG9999
          WRITE     HTMLFILE;TCINDC1;
          GOTO      HTTG9999
.
HTTG0220  MATCH     "1",SHOWFLAG
          IF        @EQUAL
            MOVE      SP70,DFLTWARD
          ELSE
            PACK      DFLTWARD,FILTWARD,SP70
          ENDIF
          CALL      WSEL0000      * Ward Select Options
          GOTO      HTTG9999
.
HTTG0230  PACK      KEY10,USERID,SP70
          CALL      RDWBSE1
          IF        OVRCD = 1
            MOVE      SP70,WBSEWRD
          ENDIF
          WRITE     HTMLFILE;WBSEWRD;
          GOTO      HTTG9999
.
HTTG0240  CALL      NEXTA000                * Next Page Day/Week/Month Link
          GOTO      HTTG9999
.
HTTG0250  CALL      PREVA000                * Previous Day/Week/Month Link
          GOTO      HTTG9999
.
HTTG0260  CALL      MHOMR000                * MH Inpat Outcome Measure Review 
          GOTO      HTTG9999
.
HTTG0270  WRITE     HTMLFILE;SHOWFLAG;
          GOTO      HTTG9999
.
HTTG0280  MATCH     "1",SHOWFLAG
          IF        @EQUAL
            MOVE      "C",FILTOPTN
          ENDIF
          WRITE     HTMLFILE;FILTOPTN; 
          GOTO      HTTG9999
.
HTTG0290  WRITE     HTMLFILE;FILTWARD;
          GOTO      HTTG9999
.
HTTG0300  MATCH     "1",SHOWFLAG
          IF        @EQUAL
            MOVE      "I",FILTSTAT
          ENDIF 
          WRITE     HTMLFILE;FILTSTAT;
          GOTO      HTTG9999
.
HTTG0310  WRITE     HTMLFILE;STATSCHG;
          GOTO      HTTG9999
.
HTTG9999  RETURN
.
.******************************************************************************
.*                      Case Review Required list                             *
.******************************************************************************
RLIS0000  UNPACK    DIM127,D1,CASETFLG,DIM127
          IF        STATSCHG = 1
            MOVE      ZERO,STARTNUM
          ENDIF
          MATCH     "N",FILTSTAT
          IF        @EQUAL
            CALL     RLISN000               * New List
            GOTO     RLIS9999
          ENDIF
.
RLIS0005  MOVE      ZERO,OVERDUE
          IF        NORECORD=0
            MOVE    "10",NORECORD           * Numb of records=0 Default to 10
          ENDIF
          MOVE      ZERO,RECNUMB            * Init Number of records Read
          MOVE      ZERO,DISNUMB            * Init number of records output
.
          PACK      KEY24,FRSTDATE,SP70
          CALL      RSMHHON2                * positional read
RLIS0010  CALL      RKMHHON2                * read a record forward
          BRANCH    OVRCD,RLIS9999
.
          MATCH     MHHNRDAT,LASTDATE       * Checks lastdate with case review
          GOTO      RLIS9999 IF LESS        * date
.
          MATCH     "1",MHHNACTV            * is this Active (1=Active) ?
          GOTO      RLIS0010 IF NOT EQUAL                             *I-219765
.
          MATCH     SP70,OMEASURE
          IF        !@EQUAL
            MATCH     OMEASURE,MHHNHOTY
            GOTO      RLIS0010 IF NOT EQUAL
          ENDIF
.
          PACK      KEY5,CATLHS,MHHNHOTY,SP70
          CALL      RDCODE1
          BRANCH    OVRCD,RLIS0010
. 
          MOVE      TCINDC1,TYPEOFAS        * Save type of assessment
.
          IF        HONFILTR = 2
            PACK      KEY5,CATLHS,MHHNHOTY,SP70
            CALL      RDCODE1
            BRANCH    OVRCD,RLIS0010
. 
            MATCH     "M",TCINDC1
            GOTO      RLIS0010 IF NOT EQUAL
          ENDIF
.
          IF        HONFILTR = 3
            PACK      KEY5,CATLHS,MHHNHOTY,SP70
            CALL      RDCODE1
            BRANCH    OVRCD,RLIS0010
.
            MATCH     "M",TCINDC1
            GOTO      RLIS0010 IF EQUAL
          ENDIF
.
          MATCH     SP70,FILTTEAM           * Check correct team
          IF        !@EQUAL
            MATCH     FILTTEAM,MHHNCAST
            GOTO      RLIS0010 IF NOT EQUAL
          ENDIF
.
          PACK      KEY8,MHHNVISN,SP70
          CALL      RDALREF1
          BRANCH    OVRCD,RLIS0010
.
          CALL      INDHCP00
.
          MATCH     SP70,DEPTCODE
          IF        !@EQUAL
            MATCH     DEPTCODE,ALREDEPT
            GOTO      RLIS0010 IF NOT EQUAL
          ENDIF
.
          MATCH     SP70,DOCTCODE           * Check correct HCP
          IF        !@EQUAL
.
            MATCH     "1",DOCINDIC
            IF        @EQUAL
              MATCH     DOCTCODE,ALREHCP
              GOTO      RLIS0015 IF EQUAL
              MATCH     DOCTCODE,ALREUHC2
              GOTO      RLIS0015 IF EQUAL
              MATCH     DOCTCODE,ALREUHC3
              GOTO      RLIS0015 IF EQUAL
              MATCH     DOCTCODE,ALREUHC5
              GOTO      RLIS0015 IF EQUAL
              MATCH     DOCTCODE,ALREUHC6
              GOTO      RLIS0015 IF EQUAL
              GOTO      RLIS0010
            ELSE
              MATCH     DOCTCODE,ALREHCP
              GOTO      RLIS0010 IF NOT EQUAL
            ENDIF
          ENDIF
.
RLIS0015  MATCH     SP70,CASETEAM           * Check correct Case Team
          IF        !@EQUAL
            MATCH     CASETEAM,MHHNCAST
            GOTO      RLIS0010 IF NOT EQUAL
          ENDIF
.
          PACK      SAVKEY24,MHHNRDAT,MHHNVISN,MHHNUNIQ,SP70
.          MATCH     SP70,MHHNDATF           * output all incomplete records
.          GOTO      RLIS0100 IF EQUAL
.
          PACK      KEY5,CATLHP,MHHNREAS,SP70
          CALL      RDCODE1
          IF        OVRCD<>1
            COMPARE   ZERO,TCFORM6
            GOTO      RLIS0010 IF EQUAL
.
            MATCH     "10",THCSCOD
            GOTO      RLIS0010 IF EQUAL
.
            MATCH     "09",THCSCOD
            GOTO      RLIS0010 IF EQUAL
          ENDIF
.
          MOVE      MHHNUNIQ,SAVVUNIQ      * Save record unique number
.
          PACK      KEY24,MHHNVISN,MHHNHDAT,SP70
          CALL      RSMHHON3
RLIS0050  CALL      RKMHHON3
          BRANCH    OVRCD,RLIS0100
.
          UNPACK    KEY24,SAVVISN
          MATCH     MHHNVISN,SAVVISN
          GOTO      RLIS0100 IF NOT EQUAL
.
          MATCH     MHHNUNIQ,SAVVUNIQ       * ignore record being tested
          GOTO      RLIS0050 IF EQUAL
.
          MATCH     "1",MHHNACTV            * is this Active (1=Active) ?
          GOTO      RLIS0050 IF NOT EQUAL               
.
          PACK      KEY5,CATLHS,MHHNHOTY,SP70
          CALL      RDCODE1
          BRANCH    OVRCD,RLIS0050
.
          MATCH     TCINDC1,TYPEOFAS        * Only check the same type
          GOTO      RLIS0050 IF NOT EQUAL   * of assessment
.
          PACK      KEY5,CATLHP,MHHNREAS,SP70
          CALL      RDCODE1
          IF        OVRCD<>1
            MATCH     "D",TCINDC20          * Discharge type. No review
            GOTO      RLIS0010 IF EQUAL     * required so skip record
.
            COMPARE   ZERO,TCFORM6          * Non ad-hoc review done
            GOTO      RLIS0010 IF NOT EQUAL * so skip record
          ENDIF
.
          GOTO      RLIS0050                * Check next record
.
RLIS0100  PACK      KEY24,SAVKEY24,SP70
          CALL      RDMHHON2
          BRANCH    OVRCD,RLIS0010
.
          ADD       ONE,RECNUMB
          IF        STARTNUM>=RECNUMB
            GOTO      RLIS0010
          ENDIF
.
          PACK      KEY11,SP20
          MATCH     SP8,MHHNDATF          * completed date
          IF        @EQUAL
            MOVE      "Incomplete",KEY11
          ELSE
            MOVE      "Review",KEY11
          ENDIF
.
          CALL      REVDIS00                * Display Row
.
          ADD       ONE,DISNUMB
          COMPARE   NORECORD,DISNUMB
          GOTO      RLIS0010 IF NOT EQUAL
.
RLIS9999  RETURN
.
.******************************************************************************
.*                      Overdue Honos Reviews List                            *
.******************************************************************************
ODUEH000  IF        STATSCHG = 1
            MOVE      ZERO,STARTNUM
          ENDIF
          MATCH     "N",FILTSTAT
          IF        @EQUAL
            CALL      RLISN000               * New List
            GOTO      ODUEH999
          ENDIF
.
ODUEH005  MOVE      ZERO,EXIT
          MOVE      ONE,OVERDUE
          MOVE      ZERO,LOOPCNTR
.
          IF        NORECORD=0
            MOVE    "10",NORECORD           * Numb of records=0 Default to 10
          ENDIF     
          MOVE      ZERO,RECNUMB            * Init Number of records Read
          MOVE      ZERO,DISNUMB            * Init number of records output
.         
          PACK      CURRDATE,CCC,CYY,CMM,CDD
          REP       " 0",CURRDATE
.
          MOVE      "1",SEQR
          MATCH     SP70,DEPTCODE
          IF        !@EQUAL
            MOVE      "2",SEQR
          ELSE
            MATCH     SP70,DOCTCODE
            IF        !@EQUAL
              MOVE      "3",SEQR
            ENDIF
          ENDIF
          BRANCH    SEQR,ODUEH100,ODUEH200,ODUEH300
          GOTO      ODUEH100                
.
ODUEH050  BRANCH    SEQR,ODUEH150,ODUEH250,ODUEH350
          GOTO      ODUEH150                
.
.
ODUEH100  PACK      KEY17,ONE,SP20         * Referral sequence
          CALL      RSALREF3
ODUEH150  CALL      RKALREF3                * read active referrals
          BRANCH    OVRCD,ODUEH999
.
          MATCH     "1",ALRESTAT
          GOTO      ODUEH999 IF NOT EQUAL
.
          CALL      INDHCP00
.
          GOTO      ODUEH500
.
.ODUEH200  PACK      KEY22,DEPTCODE,ONE,DOCTCODE,SP70  * Department/Doctor seq.
.          CALL      RSALREF4
.ODUEH250  CALL      RKALREF4                * read active referrals
.          BRANCH    OVRCD,ODUEH999
.
ODUEH200  MOVE      DEPTCODE,ALREDEPT
          CALL      INDHCP00
.
          PACK      KEY22,DEPTCODE,ONE,SP70  * Department/Doctor seq.
          CALL      RSALREF4
ODUEH250  CALL      RKALREF4                * read active referrals
          BRANCH    OVRCD,ODUEH999
. 
          MATCH     DEPTCODE,ALREDEPT
          GOTO      ODUEH999 IF NOT EQUAL
.
          MATCH     "1",ALRESTAT
          GOTO      ODUEH999 IF NOT EQUAL
.
          MATCH     SP70,DOCTCODE
          IF        !@EQUAL
.           
            MATCH     "1",DOCINDIC
            IF        @EQUAL
              MATCH     DOCTCODE,ALREHCP
              GOTO      ODUEH500 IF EQUAL
              MATCH     DOCTCODE,ALREUHC2
              GOTO      ODUEH500 IF EQUAL
              MATCH     DOCTCODE,ALREUHC3
              GOTO      ODUEH500 IF EQUAL
              MATCH     DOCTCODE,ALREUHC5
              GOTO      ODUEH500 IF EQUAL
              MATCH     DOCTCODE,ALREUHC6
              GOTO      ODUEH500 IF EQUAL

              GOTO      ODUEH250
            ELSE
              MATCH     DOCTCODE,ALREHCP  
              GOTO      ODUEH250 IF NOT EQUAL
            ENDIF
          ENDIF
.
          GOTO      ODUEH500
.
ODUEH300  PACK      KEY27,DOCTCODE,ONE,SP70  * Doctor sequence
          CALL      RSALREF5
ODUEH350  CALL      RKALREF5                * read active referrals
          BRANCH    OVRCD,ODUEH999
.
          CALL      INDHCP00
.
          MATCH     "1",DOCINDIC
          IF        @EQUAL
            MATCH     DOCTCODE,ALREHCP
            GOTO      ODUEH355 IF EQUAL
            MATCH     DOCTCODE,ALREUHC2
            GOTO      ODUEH355 IF EQUAL
            MATCH     DOCTCODE,ALREUHC3
            GOTO      ODUEH355 IF EQUAL
            MATCH     DOCTCODE,ALREUHC5
            GOTO      ODUEH355 IF EQUAL
            MATCH     DOCTCODE,ALREUHC6
            GOTO      ODUEH355 IF EQUAL
            GOTO      ODUEH999
          ELSE
            MATCH     DOCTCODE,ALREHCP
            GOTO      ODUEH999 IF NOT EQUAL
          ENDIF
.
ODUEH355  MATCH     "1",ALRESTAT
          GOTO      ODUEH999 IF NOT EQUAL
.
          GOTO      ODUEH500
.
ODUEH500  ADD       ONE,LOOPCNTR
.
.  Write record number in a comment to keep apache listening if no matching
.  records are found per 25 records
.
          IF        (LOOPCNTR > 25)
            WRITE     HTMLFILE;"<!--",LOOPCNTR,"-->"
            MOVE      ZERO,LOOPCNTR
          ENDIF
.
          PACK      KEY24,ALREVISN,Z70      * (key = Ref.No., Honos Date , etc
          CALL      RSMHHON3                * positional read
ODUEH550  CALL      RPMHHON3                * read most recent Honos
          BRANCH    OVRCD,ODUEH050
.
          MATCH     ALREVISN,MHHNVISN
          GOTO      ODUEH050 IF NOT EQUAL
.
          MATCH     "1",MHHNACTV            * is this Active (1=Active) ?
          GOTO      ODUEH050 IF NOT EQUAL
.
          MATCH     SP70,CASETEAM           * Check correct Case Team
          IF        !@EQUAL
            MATCH     CASETEAM,MHHNCAST
            GOTO      ODUEH050 IF NOT EQUAL
          ENDIF
.
          MATCH     SP70,OMEASURE
          IF        !@EQUAL
            MATCH     OMEASURE,MHHNHOTY
            GOTO      ODUEH050 IF NOT EQUAL
          ENDIF
.
          IF        HONFILTR = 2
            PACK      KEY5,CATLHS,MHHNHOTY,SP70
            CALL      RDCODE1
            BRANCH    OVRCD,ODUEH050
.
            MATCH     "M",TCINDC1
            GOTO      ODUEH050 IF NOT EQUAL
          ENDIF
.
          IF        HONFILTR = 3
            PACK      KEY5,CATLHS,MHHNHOTY,SP70
            CALL      RDCODE1
            BRANCH    OVRCD,ODUEH050
.
            MATCH     "M",TCINDC1
            GOTO      ODUEH050 IF EQUAL
          ENDIF
.
          PACK      KEY11,SP20
          MATCH     SP8,MHHNDATF          * completed date
          IF        @EQUAL
            MOVE      "Incomplete",KEY11
            GOTO      ODUEH700
          ELSE
            MOVE      "Review",KEY11
          ENDIF
.
          PACK      KEY5,CATLHP,MHHNREAS,SP70
          CALL      RDCODE1
          IF        OVRCD<>1
            COMPARE   ZERO,TCFORM6          * No further review required
            GOTO      ODUEH050 IF EQUAL
          ENDIF
.
ODUEH600  MATCH     MHHNRDAT,CURRDATE
          GOTO      ODUEH050 IF LESS        * MHHNRDAT in the future - next Ref
.
ODUEH700  ADD       ONE,RECNUMB
          IF        STARTNUM >= RECNUMB
            GOTO      ODUEH050
          ENDIF     
.         
          MOVE      ZERO,LOOPCNTR
          MOVE      "1",CASETFLG
          CALL      REVDIS00                * Display Row
.
          ADD       ONE,DISNUMB
          COMPARE   NORECORD,DISNUMB
          GOTO      ODUEH050 IF NOT EQUAL
          GOTO      ODUEH999
.          
.          
ODUEH999  RETURN
.
.------------------------------------------------------------------------------
. MH Inpatient Ourtcome Measure Review List
.------------------------------------------------------------------------------
MHOMR000  MATCH     "C",FILTOPTN
          GOTO      MHOMR400 IF EQUAL
.
. Discharge list
.
MHOMR100  PACK      KEY16,FRSTDATE,SP70
          CALL      RDSDSCH2
MHOMR120  CALL      RDKDSCH2
          BRANCH    OVRCD,MHOMR999
.
          MATCH     DDATE,LASTDATE          * Checks lastdate with discharge
          GOTO      MHOMR999 IF LESS        * date
.
          PACK      KEY8,DDADMNO,SP70
          CALL      RDMHVIS1
          BRANCH    OVRCD,MHOMR120
.
          PACK      KEY8,DDADMNO,SP70
          CALL      RDMISS1
          BRANCH    OVRCD,MHOMR120
.
          MATCH     SP70,FILTWARD
          IF        !@EQUAL & !@EOS
            MATCH     FILTWARD,AWARD
            GOTO      MHOMR120 IF NOT EQUAL
          ENDIF
.
          PACK      KEY16,DDADMNO,Z70
          CALL      RSMHHON1                * positional read
MHOMR140  CALL      RPMHHON1                * read a record forward
          BRANCH    OVRCD,MHOMR160
.
          MATCH     DDADMNO,MHHNVISN
          GOTO      MHOMR160 IF NOT EQUAL
.
          MATCH     "1",MHHNACTV            * is this Active (1=Active) ?
          GOTO      MHOMR120 IF NOT EQUAL
.
          MATCH     MHHNRDAT,LASTDATE       * Checks lastdate with case review
          GOTO      MHOMR120 IF LESS        * date
.
          MATCH     "I",FILTSTAT
          GOTO      MHOMR160 IF NOT EQUAL
.
          MATCH     "0",MHHNCOMP
          IF        @EQUAL
            MOVE      "I",STATCODE
          ELSE
            MOVE      "R",STATCODE
          ENDIF
.
          GOTO      MHOMR200
.
MHOMR160  MATCH     "N",FILTSTAT
          GOTO      MHOMR120 IF NOT EQUAL
.
          MOVE      "N",STATCODE
.
MHOMR200  MOVE      DDATE,DISCDATE
          CALL      OUTROW00                * Display Row
.
          GOTO      MHOMR120
.
. Current admission list
.
MHOMR400  PACK      KEY9,TWO,Z70
          CALL      RDSMISS2
MHOMR420  CALL      RDPMISS2
          BRANCH    OVRCD,MHOMR999
.
          COMPARE   TWO,ASTAT
          GOTO      MHOMR999 IF NOT EQUAL
.
          MATCH     SP70,FILTWARD
          IF        !@EQUAL & !@EOS
            MATCH     FILTWARD,AWARD
            GOTO      MHOMR420 IF NOT EQUAL
          ENDIF
.
          PACK      KEY8,DAADMNO,SP70
          CALL      RDMHVIS1
          BRANCH    OVRCD,MHOMR420
.
          PACK      KEY8,DAADMNO,SP70
          CALL      RDDSCH1
.
          PACK      KEY16,DAADMNO,Z70
          CALL      RSMHHON1                * positional read
MHOMR440  CALL      RPMHHON1                * read a record forward
          BRANCH    OVRCD,MHOMR460
.
          MATCH     DAADMNO,MHHNVISN
          GOTO      MHOMR460 IF NOT EQUAL              
.
          MATCH     "1",MHHNACTV            * is this Active (1=Active) ?
          GOTO      MHOMR420 IF NOT EQUAL   
.
          MATCH     MHHNRDAT,LASTDATE       * Checks lastdate with case review
          GOTO      MHOMR420 IF LESS        * date
.
          MATCH     "I",FILTSTAT
          GOTO      MHOMR460 IF NOT EQUAL
.
          MATCH     "0",MHHNCOMP
          IF        @EQUAL
            MOVE      "I",STATCODE
          ELSE
            MOVE      "R",STATCODE
          ENDIF
.
          GOTO      MHOMR500
.
MHOMR460  MATCH     "N",FILTSTAT
          GOTO      MHOMR420 IF NOT EQUAL
.
          MOVE      "N",STATCODE
.
MHOMR500  MOVE      SP70,DISCDATE
          CALL      OUTROW00                * Display Row
.
          GOTO      MHOMR420
.
MHOMR999  RETURN
.
.------------------------------------------------------------------------------
. Write MH Inpatient Outcome Measure Review List row
.------------------------------------------------------------------------------
OUTROW00  PACK      KEY8,AURNO,SP70
          CALL      RDMAST1                 * Read the master file for details
          IF        OVRCD=1
            CALL      CLPATMAS
            CLEAR     PSNAME
            APPEND    "Invalid U/R -",PSNAME
            APPEND    KEY8,PSNAME
            RESET     PSNAME
          ENDIF
.
          PACK      CURRDATE,CCC,CYY,CMM,CDD
          REP       " 0",CURRDATE
.
          PACK      KEY8,AURNO,SP70      * GET URNO
          CALL      RDPMPX21                * Get Master file 2nd extension
          CALL      PATFLD00                * Set Patient Folder suffix
.
          PACK      AGEDATE,CCC,CYY,CMM,CDD    * Today's date
          REP       " 0",AGEDATE
          CALL      CALCAGE
          CALL      PATLN000
.
          PACK      KEY10,ADOCTA,SP70
          CALL      RDPMHCP1
          IF        OVRCD=0
            MOVE      PMHCTITL,FMTTITLE
            MOVE      PMHCGNAM,FMTGNAME
            MOVE      PMHCSNAM,FMTSNAME
            CALL      DOCNM000
            PACK      RHCPNAME,DOCFNAME
          ELSE
            MOVE      SP70,DOCFNAME
          ENDIF
.
          PACK      KEY6,AWARD,SP70
          CALL      RDWARD1
          IF        OVRCD = 1
            MOVE      SP70,WBDESC
          ENDIF 
.
OUTROW50  MOVE      SP70,OMEADESC,TCINDC1
.
          MATCH     "N",STATCODE
          IF        @EQUAL
            MOVE      "MaintenanceIcon",LINKICON
            MOVE      "UpdateHONOSNew",LINKFUNC
            MOVE      "New",STATDESC

            CLEAR     HTMLLNK6
            APPEND    "javascript:",HTMLLNK6
            APPEND    LINKFUNC,HTMLLNK6
            APPEND    "('",HTMLLNK6
            APPEND    AURNO,HTMLLNK6
            APPEND    "','",HTMLLNK6
            APPEND    DAADMNO,HTMLLNK6
            APPEND    "','",HTMLLNK6
            APPEND    "",HTMLLNK6
            APPEND    "','",HTMLLNK6
            APPEND    "",HTMLLNK6
            APPEND    "');",HTMLLNK6
            RESET     HTMLLNK6
          ELSE
            PACK      KEY5,CATLHS,MHHNHOTY,SP70
            CALL      RDCODE1
            IF        OVRCD = 0
              MOVE     TDESC,OMEADESC
            ENDIF  
            MATCH     "I",STATCODE
            IF        @EQUAL
              MOVE      "PatientFolder",LINKICON
              MOVE      "UpdateHONOS",LINKFUNC
              MOVE      "Incomplete",STATDESC
            ELSE
              MOVE      "EditIcon",LINKICON
              MOVE      "AddHONOS",LINKFUNC
              MOVE      "Review",STATDESC
            ENDIF

            CLEAR     HTMLLNK6
            APPEND    "javascript:",HTMLLNK6
            APPEND    LINKFUNC,HTMLLNK6
            APPEND    "('",HTMLLNK6
            APPEND    AURNO,HTMLLNK6
            APPEND    "','",HTMLLNK6
            APPEND    DAADMNO,HTMLLNK6
            APPEND    "','",HTMLLNK6
            APPEND    MHHNUNIQ,HTMLLNK6
            APPEND    "','",HTMLLNK6
            APPEND    MHHNHOTY,HTMLLNK6
            APPEND    TCINDC1,HTMLLNK6
            APPEND    "');",HTMLLNK6
            RESET     HTMLLNK6
          ENDIF
          STRIP     LINKICON
          STRIP     LINKFUNC    
.
          CLEAR     HTMLLNK7
          APPEND    "<img src=../images/",HTMLLNK7
          APPEND    LINKICON,HTMLLNK7
          APPEND    ".gif",HTMLLNK7
          APPEND    " class=icon",HTMLLNK7
          APPEND    ">",HTMLLNK7
          RESET     HTMLLNK7
.
          WRITE     HTMLFILE;"t.addRow(#"",HTMLLNK6,"#",";            * 0
OUTROW52  WRITE     HTMLFILE;"#"",HTMLLNK7,FORMATNM,"#",":            * 1
                             "#"",DAADMNO,"#",":                      * 2
                             "#"",ADATE,ATIME,"#",";                  * 3
.
          MATCH     SP70,DISCDATE
          IF        @EQUAL
            WRITE     HTMLFILE;"#"","","#",";                         * 4
          ELSE
            WRITE     HTMLFILE;"#"",DISCDATE,"#",";                   * 4
          ENDIF                
.
          WRITE     HTMLFILE;"#"",DOCFNAME,"#",";                     * 5
          WRITE     HTMLFILE;"#"",WBDESC,"#",";                       * 6
          WRITE     HTMLFILE;"#"",OMEADESC,"#",";                        * 7
          WRITE     HTMLFILE;"#"",STATDESC,"#");"                     * 8
.
OUTROW99  RETURN
.
.******************************************************************************
. Review List for New
.******************************************************************************
RLISN000  MOVE      ZERO,OVERDUE
          MOVE      ZERO,LOOPCNTR
          IF        NORECORD=0
            MOVE    "10",NORECORD           * Numb of records=0 Default to 10
          ENDIF
          MOVE      ZERO,RECNUMB            * Init Number of records Read
          MOVE      ZERO,DISNUMB            * Init number of records output
.
          MATCH     SP70,DEPTCODE           * Correct department
          GOTO      RLISN999 IF EQUAL

          PACK      KEY22,DEPTCODE,ONE,SP70
          CALL      RSALREF4                
RLISN020  CALL      RKALREF4                
          BRANCH    OVRCD,RLISN999
.
          MATCH     DEPTCODE,ALREDEPT       * Correct department
          GOTO      RLISN999 IF NOT EQUAL
.
          MATCH     "1",ALRESTAT            * Active only
          GOTO      RLISN999 IF NOT EQUAL
.
          ADD       ONE,LOOPCNTR
.
.  Write record number in a comment to keep apache listening if no matching
.  records are found per 100 records
.
          IF        (LOOPCNTR >=100)
            WRITE     HTMLFILE;"<!--",LOOPCNTR,"-->"
            MOVE      ZERO,LOOPCNTR
          ENDIF
.
          MATCH     "1",ALREUYN4            * Primary referrals only
          GOTO      RLISN020 IF NOT EQUAL
.
          CALL      INDHCP00
.
RLISN025  MATCH     SP70,DOCTCODE           * Check correct HCP
          IF        !@EQUAL
            MATCH     "1",DOCINDIC
            IF        @EQUAL
              MATCH     DOCTCODE,ALREHCP
              GOTO      RLISN030 IF EQUAL
              MATCH     DOCTCODE,ALREUHC2
              GOTO      RLISN030 IF EQUAL
              MATCH     DOCTCODE,ALREUHC3
              GOTO      RLISN030 IF EQUAL
              MATCH     DOCTCODE,ALREUHC5
              GOTO      RLISN030 IF EQUAL
              MATCH     DOCTCODE,ALREUHC6
              GOTO      RLISN030 IF EQUAL
              GOTO      RLISN020
            ELSE
              MATCH     DOCTCODE,ALREHCP
              GOTO      RLISN020 IF NOT EQUAL
            ENDIF
          ENDIF
.
RLISN030  PACK      KEY16,ALREVISN,Z70
          CALL      RSMHHON1                * positional read
RLISN040  CALL      RPMHHON1                * read a record forward
          BRANCH    OVRCD,RLISN060
.
          MATCH     ALREVISN,MHHNVISN
          GOTO      RLISN060 IF NOT EQUAL
.
. Hono details found. skip this
.
          GOTO      RLISN020           
.
RLISN060  ADD       ONE,RECNUMB
          IF        STARTNUM>=RECNUMB
            GOTO      RLISN020
          ENDIF
.
          MOVE      "New",KEY11
.
          MOVE      ZERO,LOOPCNTR
          MOVE      "1",CASETFLG
          CALL      REVDIS00                * Display Row
.
          ADD       ONE,DISNUMB
          COMPARE   NORECORD,DISNUMB
          GOTO      RLISN020 IF NOT EQUAL
.
RLISN999  RETURN
.
.------------------------------------------------------------
. Ward selection
.------------------------------------------------------------
WSEL0000  PACK      KEY29,SP70
          IF        IBCNMHOS = 1
            PACK      KEY29,SP3,WBSEHOSP,SP70
          ENDIF
          CALL      RDSWARD7
WSEL0100  CALL      RDKWARD7
          BRANCH    OVRCD,WSEL9999
.
.                         if we have a bed number we have passed all the ward
.                         master records, so exit
          MATCH     SP70,WBED
          GOTO      WSEL9999 IF NOT EQUAL
.
          COMPARE   WACTIVE,ZERO                 *List only active wards
          GOTO      WSEL0100 IF NOT EQUAL
.
          IF        IBCNMHOS = 1
            MATCH      SP3,WBSEHOSP
            IF        !@EQUAL
              MATCH     WBSEHOSP,PTWDHOSN
              GOTO      WSEL9999 IF NOT EQUAL
            ENDIF
          ENDIF
.
.                       write the select option.
          WRITE     HTMLFILE;"<option value=#"",WWARD,"#"";
          MATCH     DFLTWARD,WWARD
          IF        @EQUAL
            WRITE     HTMLFILE;" selected";
          ENDIF
          WRITE     HTMLFILE;">",WBDESC;
.
          IF        IBCNMHOS = 1
            MATCH      SP3,WBSEHOSP
            IF        @EQUAL
              WRITE     HTMLFILE;" - ",PTWDHOSN;
            ENDIF
          ENDIF
.
          WRITE     HTMLFILE;"</option>"
          GOTO      WSEL0100
.
WSEL9999  RETURN
.
.------------------------------------------------------------
. Output Code or Name of HCP for List Filter Display
.    Tag Parameter .0 = Code
.                  .1 = Formatted Name
.------------------------------------------------------------
HCPCOD00  UNPACK    DIM127,KEY1,ANS,DIM127
          MOVE      ZERO,F1
          MOVE      ANS,F1
          BRANCH    F1,HCPCOD10
          WRITE     HTMLFILE;DOCTCODE;
          GOTO      HCPCOD99
.
HCPCOD10  PACK      KEY10,DOCTCODE,SP70
          CALL      RDPMHCP1
          BRANCH    OVRCD,HCPCOD99
          MOVE      PMHCTITL,FMTTITLE
          MOVE      PMHCGNAM,FMTGNAME
          MOVE      PMHCSNAM,FMTSNAME
          CALL      DOCNM000
          WRITE     HTMLFILE;DOCFNAME;
.
HCPCOD99  RETURN
.
.------------------------------------------------------------
. Output Code or Name of Case Team for List Filter Display
.    Tag Parameter .0 = Code
.                  .1 = Formatted Name
.------------------------------------------------------------
CASETM00  UNPACK    DIM127,KEY1,ANS,DIM127
          MOVE      ZERO,F1
          MOVE      ANS,F1
          BRANCH    F1,CASETM10
          WRITE     HTMLFILE;CASETEAM;
          GOTO      HCPCOD99
.
CASETM10  PACK      KEY10,CASETEAM,SP70
          CALL      RDALCAS1
          BRANCH    OVRCD,CASETM99
          WRITE     HTMLFILE;ALCADESC;
.
CASETM99  RETURN
.-------------------------------------------------------------------
.     writing here for allied health department drop down
.-------------------------------------------------------------------
ARFD0000  PACK      KEY10,USERID,SP70       * Read security id to get hospital
          CALL      RDWBSE1
          BRANCH    OVRCD,ARFD9999
.
          PACK      PTCDKEY2,ANSC,ANSG,SP70
          CALL      RDSCODE2                      * positional read
ARFD0100  CALL      RDKCODE2                      * read a record
          BRANCH    OVRCD,ARFD9999 
.
          MATCH     "CG",TCODE
          GOTO      ARFD9999 IF NOT EQUAL
.
          MATCH     ANSI,TCINDC3                  * Skip IP Departments
          GOTO      ARFD0100 IF EQUAL
.
          PACK      KEY3,ACODE,SP70         
          CALL      RDALDEP1                      * Read department table
          BRANCH    OVRCD,ARFD0100
.
          MATCH     "1",ALDEACTV
          GOTO      ARFD0100 IF EQUAL       * Skip Inactive
.
          MATCH     DEPTCODE,ALDEDEPT
          IF        @EQUAL
            WRITE     HTMLFILE;"<option selected value=",ALDEDEPT,">":
                               TDESC,"</option>"
          ELSE
            IF        IBCNMHOS=1
              MATCH     SP70,ALDEHOSP
              IF        !@EQUAL
                MATCH     WBSEHOSP,ALDEHOSP
                GOTO      ARFD0100 IF NOT EQUAL
              ENDIF
            ENDIF
            WRITE     HTMLFILE;"<option value=",ALDEDEPT,">":
                               TDESC,"</option>"
          ENDIF
          GOTO      ARFD0100
.
ARFD9999  RETURN
.
.******************************************************************************
.           Write case review referral
.******************************************************************************
REVDIS00  PACK      KEY8,ALREURNO,SP70
          CALL      RDMAST1                 * Read the master file for details
          IF        OVRCD=1
            CALL      CLPATMAS
            CLEAR     PSNAME
            APPEND    "Invalid U/R -",PSNAME
            APPEND    KEY8,PSNAME
            RESET     PSNAME
          ENDIF
.
          PACK      CURRDATE,CCC,CYY,CMM,CDD
          REP       " 0",CURRDATE
.
          PACK      KEY8,ALREURNO,SP70      * GET URNO
          CALL      RDPMPX21                * Get Master file 2nd extension
          CALL      PATFLD00                * Set Patient Folder suffix
.
          PACK      AGEDATE,CCC,CYY,CMM,CDD    * Today's date
          REP       " 0",AGEDATE
          CALL      CALCAGE
          CALL      PATLN000
.
          MOVE      PBDATE,PRTPDATE
          CALL      ALLDAT00                * Fromat the Date
          MOVE      FBOKDATE,TEMPDAT1       * formatted DOB
.
          PACK      KEY10,ALREHCP,SP70
          CALL      RDPMHCP1
          IF        OVRCD=0
            MOVE      PMHCTITL,FMTTITLE
            MOVE      PMHCGNAM,FMTGNAME
            MOVE      PMHCSNAM,FMTSNAME
            CALL      DOCNM000
            PACK      RHCPNAME,DOCFNAME
          ELSE
            MOVE      SP70,RHCPNAME
          ENDIF
.
          MATCH     "N",FILTSTAT
          IF        @EQUAL
            MOVE      SP70,TEMPDAT2
            MOVE      SP70,TEMPDAT3
            MOVE      SP70,DOCFNAME
            MOVE      SP70,MHHNCAST
          ELSE
            MOVE      MHHNRDAT,PRTPDATE
            CALL      ALLDAT00                * Fromat the Date
            MOVE      FBOKDATE,TEMPDAT2       * formatted Referral Date
.
            MOVE      MHHNHDAT,PRTPDATE
            CALL      ALLDAT00                * Fromat the Date
            MOVE      FBOKDATE,TEMPDAT3       * formatted HONOS Date
.
            PACK      KEY10,MHHNPHCP,SP70
            CALL      RDPMHCP1
            IF        OVRCD=0
              MOVE      PMHCTITL,FMTTITLE
              MOVE      PMHCGNAM,FMTGNAME
              MOVE      PMHCSNAM,FMTSNAME
              CALL      DOCNM000
            ELSE
              MOVE      SP70,DOCFNAME
            ENDIF
          ENDIF
.
REVDIS50  MOVE      SP70,TDESC,TCINDC1
          MATCH     "I",FILTSTAT
          IF        @EQUAL
            PACK      KEY5,CATLHS,MHHNHOTY,SP70
            CALL      RDCODE1
            IF        OVRCD=1
              MOVE      SP70,TDESC
            ENDIF  
          ENDIF
.
          MATCH     "N",FILTSTAT
          IF        @EQUAL
            WRITE     HTMLFILE;"<tr><td nowrap>":
                               "<img src=../images/MaintenanceIcon.gif":
                               " class=ListIcon ":
                               " onclick='UpdateHONOSNew(#"":
                               ALREURNO,"#",#"":
                               ALREVISN,"#",#"":
                               "","#",#"":
                               "","#");'>";
          ELSE   
            MATCH     "0",MHHNCOMP
            IF        @EQUAL
              WRITE     HTMLFILE;"<tr><td nowrap>":
                                 "<img src=../images/PatientFolder.gif":
                                 " class=ListIcon ":
                                 " onclick='UpdateHONOS(#"":
                                 ALREURNO,"#",#"":
                                 MHHNVISN,"#",#"":
                                 MHHNUNIQ,"#",#"":
                                 MHHNHOTY,TCINDC1,"#");'>";
            ELSE
              WRITE     HTMLFILE;"<tr><td nowrap>":
                                 "<img src=../images/EditIcon.gif":
                                 " class=ListIcon ":
                                 " onclick='AddHONOS(#"":
                                 ALREURNO,"#",#"": 
                                 MHHNVISN,"#",#"":
                                 MHHNUNIQ,"#",#"":
                                 MHHNHOTY,TCINDC1,"#");'>";
            ENDIF
          ENDIF
.
REVDIS80  WRITE     HTMLFILE;FORMATNM,"</td>":
                             "<td>&nbsp;",TEMPDAT2,"</td>":
                             "<td>&nbsp;",RHCPNAME,"</td>":
                             "<td>&nbsp;",DOCFNAME,"</td>";
.       
          MATCH     "1",CASETFLG
          IF        @EQUAL    
            WRITE     HTMLFILE;"<td>&nbsp;",MHHNCAST,"</td>";
          ENDIF
.
          WRITE     HTMLFILE;"<td>&nbsp;",TEMPDAT3,"</td>":
                             "<td>&nbsp;",TDESC,"</td>":
                             "<td>&nbsp;",KEY11,"</td>":
                             "</tr>"
          GOTO      REVDIS99
.
REVDIS99  RETURN
.
.******************************************************************************
.*                      Check Correct Files are Open for System               *
.******************************************************************************
OUTFIL00  MOVE      WBSESIT,KEY6
          CALL      RDSITA1
          BRANCH    OVRCD,OUTFIL90
          MATCH     OSTFILE,CFILEPRE        * Save Current File Prefix
          IF        !@EQUAL
            MOVE      OSTFILE,CFILEPRE      * Save Current File Prefix
            CALL      OPNOUT00              * Open Outpatient Files
          ENDIF
          MOVE      ZERO,EXIT
          GOTO      OUTFIL99
.
OUTFIL90  MOVE      "Outpatient Site Invalid",WEBTITLE
          CALL      WEBERR00
          MOVE      ONE,EXIT
.
OUTFIL99  RETURN
.
.------------------------------------------------------------
. Open Outpatient Files
.------------------------------------------------------------
OPNOUT00  CLOSE     OUTCTYA1
          PACK      CFNAME,CFILEPRE,FILCTYA1  * Get the name of the CTYA1 file
          OPEN      OUTCTYA1,CFNAME
.
          CLOSE     OUTCTYA2
          PACK      CFNAME,CFILEPRE,FILCTYA2  * Get the name of the CTYA2 file
          OPEN      OUTCTYA2,CFNAME
.
          CLOSE     OUTCTYA3
          PACK      CFNAME,CFILEPRE,FILCTYA3  * Get the name of the CTYA3 file
          OPEN      OUTCTYA3,CFNAME
.
          CLOSE     OUTCLIA1
          PACK      CFNAME,CFILEPRE,FILCLIA1  * Get the name of the CLIA1 file
          OPEN      OUTCLIA1,CFNAME
.
OPNOUT99  RETURN
.
.------------------------------------------------------------
. session Setup
.------------------------------------------------------------
SESS0000  RESET     UPDTTYPE
          MATCH     SP1,UPDTTYPE
          GOTO      SESS8000 IF EQUAL
.
          MATCH     "A",UPDTTYPE    * Add session formaction
          GOTO      SESS1000 IF EQUAL
.
          MATCH     "U",UPDTTYPE    * Update session formaction
          GOTO      SESS1500 IF EQUAL
.
          MATCH     "D",UPDTTYPE    * Delete session formaction
          GOTO      SESS2000 IF EQUAL
.
          MATCH     "P",UPDTTYPE    * Add patient formaction
          GOTO      SESS2500 IF EQUAL
.
          MATCH     "R",UPDTTYPE    * Update patient formaction
          GOTO      SESS3000 IF EQUAL
.
          MATCH     "S",UPDTTYPE    * Delete patient formaction
          GOTO      SESS3500 IF EQUAL
.
          MATCH     "T",UPDTTYPE    * Add HCP formaction
          GOTO      SESS4000 IF EQUAL
.
          MATCH     "W",UPDTTYPE    * Update HCP formaction
          GOTO      SESS4500 IF EQUAL
.
          MATCH     "V",UPDTTYPE    * Delete HCP formaction
          GOTO      SESS5000 IF EQUAL
.
          GOTO      SESS9000
.
.         ************ ADD FORMACTION ***********
.
SESS1000  MOVE      "106",PRXCODE
          CALL      GETSLK00
          READ      CONTROLF,HUND06;*185,ALCNSESN 
          ADD       ONE,ALCNSESN              
          WRITAB    CONTROLF,HUND06;*185,ALCNSESN
          SUB       ONE,ALCNSESN     
          CALL      RELSLK00
.
          MOVE      ALCNSESN,ALGRO001
.
          PACK      KEY8,ALGRO001,SP70
          CALL      RDALGRO1
          COMPARE   ZERO,OVRCD
          GOTO      SESS1000 IF EQUAL
.
          CALL      CGRO0000                     * Clear file vars
          CALL      MGRO0000                     * Move cgi to file variables
.
          PACK      KEY8,CCC,CYY,CMM,CDD
          REP       " 0",KEY8
          MOVE      KEY8,ALGRCDAT                * System date
          CLOCK     TIME,ALGRCTIM                * System time
          MOVE      USERID,ALGRCUID              * web user id
.
          PACK      KEY8,ALGRSESN,SP70
          CALL      WRALGRO1                     * Writes the data
.
          MOVE      ZERO,EXIT
          GOTO      SESS9999
.
.         ************ UPDATE FORMACTION **********
.
SESS1500  PACK      KEY8,ALGRO001,SP70
          CALL      RDALGRO1
          BRANCH    OVRCD,SESS9200
.
          CALL      MGRO0000                     * Move cgi to file variables
.
          PACK      KEY8,CCC,CYY,CMM,CDD
          REP       " 0",KEY8
          MOVE      KEY8,ALGRUDAT                * System date
          CLOCK     TIME,ALGRUTIM                * System time 
          MOVE      USERID,ALGRUUID              * web user id
.         
          CALL      UPALGRO1                     * Update the data
.
          MOVE      ZERO,EXIT
          GOTO      SESS9999
.
.         ************ DELETE FORMACTION **********
.
SESS2000  PACK      KEY8,ALGRO001,SP70
          CALL      RDALGRO1
          BRANCH    OVRCD,SESS9200
.
          CALL      CHKD0000 
          BRANCH    EXIT,SESS9999
.
          PACK      KEY8,ALGRO001,SP70
          CALL      DEALGRO1
.
          MOVE      ZERO,EXIT
          GOTO      SESS9999
.
.         ************ ADD PATIENT FORMACTION ***********
.
SESS2500  PACK      KEY16,ALGRP001,ALGRP003,SP70
          CALL      RDALGRP1
          COMPARE   ZERO,OVRCD
          GOTO      SESS9100 IF EQUAL
.
          MATCH     "0",ALGRP004
          IF        @EQUAL
            CALL      ACTP0000                   * Check if already active
            BRANCH    EXIT,SESS9300
          ENDIF
.
.         CAR 281080 - don't allow primary referrals to be added to group session
.
          MOVE      ALGRP003,KEY8
          CALL      RDALREF1                * read the referral table
          BRANCH    OVRCD,SESS9110
.
          MATCH     ALREDEPT,ALGRDEPT
          GOTO      SESS9140 IF NOT EQUAL
.
          PACK      KEY3,ALREDEPT,SP70
          CALL      RDALDEP1
          BRANCH    OVRCD,SESS9120
.
          MATCH     "1",ALREUYN4
          IF        @EQUAL
            MATCH     "1",ALDEPENC          * Don't allow enc on primary ref
            GOTO      SESS9130 IF EQUAL
          ENDIF
.
          MATCH     "2",ALRESTAT                 * Closed
          GOTO      SESS9500 IF EQUAL
.
          MATCH     "3",ALRESTAT                 * Inactive
          GOTO      SESS9510 IF EQUAL
.
          MATCH     "4",ALRESTAT                 * Cancelled
          GOTO      SESS9520 IF EQUAL
.
          MATCH     "5",ALRESTAT                 * Rejected
          GOTO      SESS9530 IF EQUAL
.
          CALL      CGRP0000                     * Clear file vars
          CALL      MGRP0000                     * Move cgi to file variables
.
          PACK      KEY8,CCC,CYY,CMM,CDD
          REP       " 0",KEY8
          MOVE      KEY8,ALGPCDAT                * System date
          CLOCK     TIME,ALGPCTIM                * System time
          MOVE      USERID,ALGPCUID              * web user id
.
          PACK      KEY16,ALGPSESN,ALGPREFN,SP70
          CALL      WRALGRP1                     * Writes the data
.
          MOVE      ALGPREFN,REFNUMBR
          CALL      AREF0000                     * Activate waiting referral
.
          MOVE      ZERO,EXIT
          GOTO      SESS9999
.
.         ************ UPDATE PATIENT FORMACTION ***********
.
SESS3000  PACK      KEY16,ALGRP001,ALGRP003,SP70
          CALL      RDALGRP1
          BRANCH    OVRCD,SESS9200
.         
          MATCH     "0",ALGRP004
          IF        @EQUAL
            CALL      ACTP0000                   * Check if already active
            BRANCH    EXIT,SESS9300
          ENDIF
.
          PACK      KEY16,ALGRP001,ALGRP003,SP70
          CALL      RDALGRP1
          BRANCH    OVRCD,SESS9200
.
          CALL      MGRP0000                     * Move cgi to file variables
.
          PACK      KEY8,CCC,CYY,CMM,CDD
          REP       " 0",KEY8
          MOVE      KEY8,ALGPUDAT                * System date
          CLOCK     TIME,ALGPUTIM                * System time
          MOVE      USERID,ALGPUUID              * web user id
.         
          CALL      UPALGRP1                     * Update the data
.
          MOVE      ZERO,EXIT
          GOTO      SESS9999
.
.         ************ DELETE PATIENT FORMACTION ***********
.
SESS3500  PACK      KEY16,ALGRP001,ALGRP003,SP70
          CALL      RDALGRP1
          BRANCH    OVRCD,SESS9200
.
          CALL      DEALGRP1
.
          MOVE      ZERO,EXIT
          GOTO      SESS9999
.
.         ************ ADD HCP FORMACTION ***********
.
SESS4000  PACK      KEY21,ALGRH001,ALGRH002,ALGRH003,SP70
          CALL      RDALGRH1
          COMPARE   ZERO,OVRCD
          GOTO      SESS9100 IF EQUAL
.
          MATCH     "0",ALGRH004
          IF        @EQUAL
            CALL      ACTH0000                   * Check if already active
            BRANCH    EXIT,SESS9400
          ENDIF
.
          CALL      CGRH0000                     * Clear file vars
          CALL      MGRH0000                     * Move cgi to file variables
.
          PACK      KEY8,CCC,CYY,CMM,CDD
          REP       " 0",KEY8
          MOVE      KEY8,ALGHCDAT                * System date
          CLOCK     TIME,ALGHCTIM                * System time
          MOVE      USERID,ALGHCUID              * web user id
.
          PACK      KEY21,ALGHSESN,ALGHHCPC,ALGHSPEC,SP70
          CALL      WRALGRH1                     * Writes the data
.
          MOVE      ZERO,EXIT
          GOTO      SESS9999
.
.         ************ UPDATE HCP FORMACTION **********
.
SESS4500  PACK      KEY21,ALGRH001,ALGRH002,ALGRH003,SP70
          CALL      RDALGRH1
          BRANCH    OVRCD,SESS9200
.
          MATCH     "0",ALGRH004
          IF        @EQUAL
            CALL      ACTH0000                   * Check if already active
            BRANCH    EXIT,SESS9400
          ENDIF
.
          PACK      KEY21,ALGRH001,ALGRH002,ALGRH003,SP70
          CALL      RDALGRH1
          BRANCH    OVRCD,SESS9200
.
          CALL      MGRH0000                     * Move cgi to file variables
.
          PACK      KEY8,CCC,CYY,CMM,CDD
          REP       " 0",KEY8
          MOVE      KEY8,ALGHUDAT                * System date
          CLOCK     TIME,ALGHUTIM                * System time
          MOVE      USERID,ALGHUUID              * web user id
.
          CALL      UPALGRH1                     * Update the data
.
          MOVE      ZERO,EXIT
          GOTO      SESS9999
.
.         
.         ************ DELETE HCP FORMACTION ***********
.         
SESS5000  PACK      KEY21,ALGRH001,ALGRH002,ALGRH003,SP70
          CALL      RDALGRH1
          BRANCH    OVRCD,SESS9200
.         
          CALL      DEALGRH1
.         
          MOVE      ZERO,EXIT
          GOTO      SESS9999
. 
.
.         ************ DISPLAY FORMACTION **********
.
SESS8000  PACK      KEY8,ALGRO001,SP70
          CALL      RDALGRO1
          IF        OVRCD=1
            CALL     CGRO0000
          ENDIF
.
          PACK      KEY16,ALGRP001,ALGRP003,SP70
          CALL      RDALGRP1
          IF        OVRCD=1
            CALL     CGRP0000
          ENDIF
.
          PACK      KEY21,ALGRH001,ALGRH002,ALGRH003,SP70
          CALL      RDALGRH1
          IF        OVRCD=1
            CALL     CGRH0000
          ENDIF
.
          CLEAR     WEBTITLE
          MOVE      "Group Contact Maintenance",WEBTITLE
          RESET     WEBTITLE
.
          CALL      WEBHED00   * Create Output File and Write HTML Page Header
          BRANCH    EXIT,SESS9999
.
          CALL      WEBBOD00   * Process Web Body
          CALL      WEBEND00   * Process End of HTML File
          MOVE      ONE,EXIT
          GOTO      SESS9999
.
SESS9000  MOVE      "Invalid Form Action.",WEBTITLE
          CALL      WEBERR00
          MOVE      ONE,EXIT
          GOTO      SESS9999
.
SESS9100  MOVE      "Setup exists.",WEBTITLE
          CALL      WEBERR00
          MOVE      ONE,EXIT
          GOTO      SESS9999
.
SESS9110  MOVE      "Invalid Referral Number.",WEBTITLE
          CALL      WEBERR00
          MOVE      ONE,EXIT
          GOTO      SESS9999
.
SESS9120  MOVE      "Department does not exist.",WEBTITLE
          CALL      WEBERR00
          MOVE      ONE,EXIT
          GOTO      SESS9999
.
SESS9130  SQUEEZE   ALCNMDES
          CLEAR     WEBTITLE
          APPEND    ALCNMDES,WEBTITLE
          APPEND    " Referrals cannot be added to group sessions.",WEBTITLE
          RESET     ALCNMDES
          RESET     WEBTITLE
          CALL      WEBERR00
          MOVE      ONE,EXIT
          GOTO      SESS9999
.
SESS9140  MOVE      "Referral department does not match group session department",WEBTITLE
          CALL      WEBERR00
          MOVE      ONE,EXIT
          GOTO      SESS9999
.
SESS9200  MOVE      "Invalid Setup.",WEBTITLE
          CALL      WEBERR00
          MOVE      ONE,EXIT
          GOTO      SESS9999
.
SESS9300  MOVE      "Patient already active for this session.",WEBTITLE
          CALL      WEBERR00
          MOVE      ONE,EXIT
          GOTO      SESS9999
.
SESS9400  MOVE      "HCP already active for this session.",WEBTITLE
          CALL      WEBERR00
          MOVE      ONE,EXIT
          GOTO      SESS9999
.
SESS9500  CLEAR     WEBTITLE
          APPEND    "Invalid referral status - ",WEBTITLE
          APPEND    "This referral is Closed.",WEBTITLE
          RESET     WEBTITLE
          CALL      WEBERR00
          MOVE      ONE,EXIT
          GOTO      SESS9999
.
SESS9510  CLEAR     WEBTITLE
          APPEND    "Invalid referral status - ",WEBTITLE
          APPEND    "This referral is Inactive.",WEBTITLE
          RESET     WEBTITLE
          CALL      WEBERR00
          MOVE      ONE,EXIT
          GOTO      SESS9999
.
SESS9520  CLEAR     WEBTITLE
          APPEND    "Invalid referral status - ",WEBTITLE
          APPEND    "This referral is Cancelled.",WEBTITLE
          RESET     WEBTITLE
          CALL      WEBERR00
          MOVE      ONE,EXIT
          GOTO      SESS9999
.
SESS9530  CLEAR     WEBTITLE
          APPEND    "Invalid referral status - ",WEBTITLE
          APPEND    "This referral is Rejected.",WEBTITLE
          RESET     WEBTITLE
          CALL      WEBERR00
          MOVE      ONE,EXIT
          GOTO      SESS9999
.
SESS9999  RETURN
.
.         
.------------------------------------------------------------
. Group Contacts
.------------------------------------------------------------
CONT0000  RESET     UPDTTYPE
          MATCH     SP1,UPDTTYPE
          GOTO      CONT8000 IF EQUAL
.
          MATCH     "A",UPDTTYPE    * Add/open group contact formaction
          GOTO      CONT1000 IF EQUAL
.
          MATCH     "U",UPDTTYPE    * Update session formaction
          GOTO      CONT1500 IF EQUAL
.
          MATCH     "D",UPDTTYPE    * Delete session formaction
          GOTO      CONT2000 IF EQUAL
.
          MATCH     "P",UPDTTYPE    * Add patient formaction
          GOTO      CONT2500 IF EQUAL
.
          MATCH     "R",UPDTTYPE    * Update patient formaction
          GOTO      CONT3000 IF EQUAL
.
          MATCH     "S",UPDTTYPE    * Delete patient formaction
          GOTO      CONT3500 IF EQUAL
.
          MATCH     "T",UPDTTYPE    * Add HCP formaction
          GOTO      CONT4000 IF EQUAL 
.         
          MATCH     "W",UPDTTYPE    * Update HCP formaction
          GOTO      CONT4500 IF EQUAL
.
          MATCH     "V",UPDTTYPE    * Delete HCP formaction
          GOTO      CONT5000 IF EQUAL
.
          MATCH     "M",UPDTTYPE    * Global function 
          GOTO      CONT5500 IF EQUAL
.
          GOTO      CONT9000
.
.         ************ ADD FORMACTION ***********
.
CONT1000  CALL      CHKA0000  
          BRANCH    EXIT,CONT9999
.
          MOVE      "106",PRXCODE
          CALL      GETSLK00
          READ      CONTROLF,HUND06;*193,ALCNCONT
          ADD       ONE,ALCNCONT
          WRITAB    CONTROLF,HUND06;*193,ALCNCONT
          SUB       ONE,ALCNCONT
          CALL      RELSLK00
.
          MOVE      ALCNCONT,ALGRE001
.
          PACK      KEY8,ALGRE001,SP70
          CALL      RDALGRE1
          COMPARE   ZERO,OVRCD
          GOTO      CONT1000 IF EQUAL
.
          CALL      CGRE0000                     * Clear file vars
          CALL      MGRE0000                     * Move cgi to file variables
.
          PACK      KEY8,CCC,CYY,CMM,CDD
          REP       " 0",KEY8
          MOVE      KEY8,ALGECDAT                * System date
          CLOCK     TIME,ALGECTIM                * System time
          MOVE      USERID,ALGECUID              * web user id
.
          PACK      KEY8,ALGECONT,SP70
          CALL      WRALGRE1                     * Writes the data 
.
          CALL      COPP0000                     * Copy patients
          CALL      COPH0000                     * Copy hcp's  s
.
          MOVE      ZERO,EXIT
          GOTO      CONT9999
.
.         ************ UPDATE FORMACTION **********
.
CONT1500  PACK      KEY8,ALGRE001,SP70
          CALL      RDALGRE1
          BRANCH    OVRCD,CONT9100
.         
          CALL      MGRE0000                     * Move cgi to file variables
.         
          PACK      KEY8,CCC,CYY,CMM,CDD
          REP       " 0",KEY8
          MOVE      KEY8,ALGEUDAT                * System date
          CLOCK     TIME,ALGEUTIM                * System time
          MOVE      USERID,ALGEUUID              * web user id
.         
          CALL      UPALGRE1                     * Update the data
.
          MOVE      ZERO,EXIT
          GOTO      CONT9999
.
.         ************ DELETE FORMACTION **********
.
CONT2000  PACK      KEY8,ALGRE001,SP70
          CALL      RDALGRE1
          BRANCH    OVRCD,CONT9100
.         
          CALL      DCHK0000
          BRANCH    EXIT,CONT9999
.         
          PACK      KEY8,ALGRE001,SP70
          CALL      DEALGRE1
.
          MOVE      ZERO,EXIT
          GOTO      CONT9999
.
.         ************ ADD PATIENT FORMACTION ***********
.         
CONT2500  PACK      KEY16,ALGPA001,ALGPA003,SP70
          CALL      RDALGPA1
          COMPARE   ZERO,OVRCD
          GOTO      CONT9120 IF EQUAL
.         
          CALL      CHKP0000                     * Check if this U/R is active
          BRANCH    EXIT,CONT9300
.
.         CAR 281080 - don't allow primary referrals to be added to group session
.
          PACK      KEY8,ALGPA001,SP70
          CALL      RDALGRE1                * read open session to get session
          BRANCH    OVRCD,CONT9510          * date
.
          PACK      KEY8,ALGESESN,SP70
          CALL      RDALGRO1                * read session master setup to get
          BRANCH    OVRCD,CONT9520          * the department
.
          MOVE      ALGPA003,KEY8
          CALL      RDALREF1                * read the referral table
          BRANCH    OVRCD,CONT9130
.
          MATCH     ALREDEPT,ALGRDEPT
          GOTO      CONT9160 IF NOT EQUAL
.
          PACK      KEY3,ALREDEPT,SP70
          CALL      RDALDEP1
          BRANCH    OVRCD,CONT9140
.
          MATCH     "1",ALREUYN4
          IF        @EQUAL
            MATCH     "1",ALDEPENC          * Don't allow enc on primary ref
            GOTO      CONT9150 IF EQUAL
          ENDIF
.
          MATCH     "2",ALRESTAT                 * Closed
          IF        @EQUAL
            MATCH     ALGEGDTE,ALREDCLO          * Prior to contact date
            GOTO      CONT9530 IF LESS
          ENDIF
.
          MATCH     "3",ALRESTAT                 * Inactive
          GOTO      CONT9540 IF EQUAL
.
          MATCH     "4",ALRESTAT                 * Cancelled
          GOTO      CONT9550 IF EQUAL
.
          MATCH     "5",ALRESTAT                 * Rejected
          GOTO      CONT9560 IF EQUAL
.
          CALL      CGPA0000                     * Clear file vars
          CALL      MGPA0000                     * Move cgi to file variables
.         
          PACK      KEY8,CCC,CYY,CMM,CDD
          REP       " 0",KEY8
          MOVE      KEY8,ALGACDAT                * System date
          CLOCK     TIME,ALGACTIM                * System time
          MOVE      USERID,ALGACUID              * web user id
.
          MOVE      ZERO,ALGACURP
          PACK      KEY17,ALGAURNO,TWO,SP70
          CALL      RSPTMI18
          CALL      RKPTMI18
          BRANCH    OVRCD,CONT2700               * not on file
.
          MATCH     ALGAURNO,AURNO               * same U/R Number?
          GOTO      CONT2700 IF NOT EQUAL        * No
.
          COMPARE   TWO,ASTAT
          GOTO      CONT2700 IF NOT EQUAL
.
          MOVE      ONE,ALGACURP
          GOTO      CONT2800
.
CONT2700  CALL      MHINC000                     * Set MHINC extract indicator
.
CONT2800  PACK      KEY16,ALGACONT,ALGAREFN,SP70
          CALL      WRALGPA1                     * Writes the data
.
          MOVE      ALGAREFN,REFNUMBR
          CALL      AREF0000                     * Activate waiting referral
.
. Check for Linked Referral
.
          PACK      KEY16,ALGPA003,SP70
          CALL      RSALRLN2
CONT2810  CALL      RKALRLN2
          BRANCH    OVRCD,CONT2820
.
          MATCH     ALGPA003,ALRLLNKV
          GOTO      CONT2820 IF NOT EQUAL
.
          PACK      KEY8,ALRLVISN,SP70
          CALL      RDALREF1
          BRANCH    OVRCD,CONT2810
.
          MOVE      ALREVISN,REFNUMBR
          CALL      AREF0000
.
          GOTO      CONT2810
.
.
.
CONT2820  MOVE      ALGPA003,KEY8
          CALL      RDALREF1                * read the referral table
          BRANCH    OVRCD,CONT9130
.
          CALL      PSES0000                     * Add patient to session master
          BRANCH    EXIT,CONT9999
.
CONT2850  MOVE      ZERO,EXIT
          GOTO      CONT9999
.
.         ************ UPDATE PATIENT FORMACTION ***********
.
CONT3000  PACK      KEY16,ALGPA001,ALGPA003,SP70
          CALL      RDALGPA1
          BRANCH    OVRCD,CONT9100
.
          MATCH     ALGPA005,Z70                 * updating Attendance Status?
          GOTO      CONT3050 IF EQUAL
.
          CALL      CHFTGC00                * check if session future date/time?
          BRANCH    EXIT,CONT9500
.
CONT3050  MATCH     SP70,ALGAMOHX
          GOTO      CONT3100 IF EQUAL            * not MHINC
.
          MATCH     "1",ALGARCST
          GOTO      CONT9110 IF EQUAL            * Deleted record
.
CONT3100  CALL      MGPA0000                     * Move cgi to file variables
.
          PACK      KEY8,CCC,CYY,CMM,CDD
          REP       " 0",KEY8
          MOVE      KEY8,ALGAUDAT                * System date
          CLOCK     TIME,ALGAUTIM                * System time
          MOVE      USERID,ALGAUUID              * web user id
.
          CALL      MHINC000                     * Set MHINC extract indicator
          CALL      UPALGPA1                     * Update the data
.
          MOVE      ZERO,EXIT
          GOTO      CONT9999
.
.         ************ DELETE PATIENT FORMACTION ***********
.
CONT3500  PACK      KEY16,ALGPA001,ALGPA003,SP70
          CALL      RDALGPA1
          BRANCH    OVRCD,CONT9100
.
          MATCH     SP70,ALGAMOHX
          GOTO      CONT3700 IF EQUAL            * not MHINC
.
          MATCH     "1",ALGARCST
          GOTO      CONT9110 IF EQUAL            * Deleted record
.
          MATCH     "0",ALGAMOHX
          GOTO      CONT3700 IF EQUAL            * unsent
.
          MOVE      "1",ALGARCST
          CALL      MHINC000                     * Set MHINC extract indicator
          CALL      UPALGPA1
          GOTO      CONT3800
.
CONT3700  CALL      DEALGPA1
.
CONT3800  MATCH     "1",ADDMASTR
          IF        @EQUAL
            PACK      KEY16,ALGRP001,ALGRP003,SP70 
            CALL      DEALGRP1
          ENDIF
.
          MOVE      ZERO,EXIT
          GOTO      CONT9999
.
.         ************ ADD HCP FORMACTION ***********
.
CONT4000  PACK      KEY21,ALGEH001,ALGEH002,ALGEH003,SP70
          CALL      RDALGEH1
          COMPARE   ZERO,OVRCD
          GOTO      CONT9200 IF EQUAL
.
          CALL      CHKH0000                     * Check if already active
          BRANCH    EXIT,CONT9400
.
          CALL      CGEH0000                     * Clear file vars
          CALL      MGEH0000                     * Move cgi to file variables
.
          PACK      KEY8,CCC,CYY,CMM,CDD
          REP       " 0",KEY8
          MOVE      KEY8,ALGCCDAT                * System date
          CLOCK     TIME,ALGCCTIM                * System time
          MOVE      USERID,ALGCCUID              * web user id
.
          PACK      KEY21,ALGCCONT,ALGCHCPC,ALGCSPEC,SP70
          CALL      WRALGEH1                     * Writes the data
.
          CALL      HSES0000                     * Add HCP to session master
          BRANCH    EXIT,CONT9999
.    
          MOVE      ZERO,EXIT
          GOTO      CONT9999
.
.         ************ UPDATE HCP FORMACTION **********
.
CONT4500  PACK      KEY21,ALGEH001,ALGEH002,ALGEH003,SP70
          CALL      RDALGEH1
          BRANCH    OVRCD,CONT9100
.
          CALL      MGEH0000                     * Move cgi to file variables
.
          PACK      KEY8,CCC,CYY,CMM,CDD
          REP       " 0",KEY8
          MOVE      KEY8,ALGCUDAT                * System date
          CLOCK     TIME,ALGCUTIM                * System time
          MOVE      USERID,ALGCUUID              * web user id
.
          CALL      UPALGEH1                     * Update the data
.
          MOVE      ZERO,EXIT
          GOTO      CONT9999
.
.
.         ************ DELETE HCP FORMACTION ***********
.
CONT5000  PACK      KEY21,ALGEH001,ALGEH002,ALGEH003,SP70
          CALL      RDALGEH1
          BRANCH    OVRCD,CONT9200
.
          CALL      DEALGEH1
.
          MATCH     "1",ADDMASTR
          IF        @EQUAL
            PACK      KEY21,ALGRH001,ALGRH002,ALGRH003,SP70
            CALL      DEALGRH1
          ENDIF
.
          MOVE      ZERO,EXIT
          GOTO      CONT9999
.
.         ************ MEALS TO ALL FORMACTION ***********
.
CONT5500  MATCH     ALGPA005,Z70            * updating Attendance Status?
          GOTO      CONT5600 IF EQUAL
.
          CALL      CHFTGC00                * check if session future date/time?
          BRANCH    EXIT,CONT9500
.
CONT5600  CALL      ALLP0000
.
          MOVE      ZERO,EXIT
          GOTO      CONT9999
.
.         ************ DISPLAY FORMACTION **********
.
CONT8000  PACK      KEY8,ALGRO001,SP70
          CALL      RDALGRO1
          IF        OVRCD=1
            CALL     CGRO0000
          ENDIF
.
          PACK      KEY8,ALGRE001,SP70
          CALL      RDALGRE1
          IF        OVRCD=1
            CALL      CGRE0000
          ENDIF
.
          PACK      KEY21,ALGEH001,ALGEH002,ALGEH003,SP70
          CALL      RDALGEH1
          IF        OVRCD=1
            CALL      CGEH0000
          ENDIF
.
          PACK      KEY16,ALGPA001,ALGPA003,SP70
          CALL      RDALGPA1
          IF        OVRCD=1
            CALL      CGPA0000
          ENDIF
.
          CLEAR     WEBTITLE
          MOVE      "Group Contacts",WEBTITLE
          RESET     WEBTITLE
.
          CALL      WEBHED00   * Create Output File and Write HTML Page Header
          BRANCH    EXIT,CONT9999
.
          CALL      WEBBOD00   * Process Web Body
          CALL      WEBEND00   * Process End of HTML File
          MOVE      ONE,EXIT
          GOTO      CONT9999
.
CONT9000  MOVE      "Invalid Form Action.",WEBTITLE
          CALL      WEBERR00
          MOVE      ONE,EXIT
          GOTO      CONT9999
.
CONT9100  MOVE      "Invalid Setup.",WEBTITLE
          CALL      WEBERR00
          MOVE      ONE,EXIT 
          GOTO      CONT9999
.
CONT9110  MOVE      "Setup has been Deleted.",WEBTITLE
          CALL      WEBERR00
          MOVE      ONE,EXIT 
          GOTO      CONT9999
.
CONT9120  MATCH     "1",ALGARCST
          GOTO      CONT9200 IF NOT EQUAL      * Not deleted
.
          MOVE      "Setup had been deleted.",WEBTITLE
          CALL      WEBERR00
          MOVE      ONE,EXIT 
          GOTO      CONT9999
.
CONT9130  MOVE      "Invalid Referral Number.",WEBTITLE
          CALL      WEBERR00
          MOVE      ONE,EXIT
          GOTO      CONT9999
.
CONT9140  MOVE      "Department does not exist.",WEBTITLE
          CALL      WEBERR00
          MOVE      ONE,EXIT
          GOTO      CONT9999
.
CONT9150  SQUEEZE   ALCNMDES
          CLEAR     WEBTITLE
          APPEND    ALCNMDES,WEBTITLE
          APPEND    " Referrals cannot be added to group sessions.",WEBTITLE
          RESET     ALCNMDES
          RESET     WEBTITLE
          CALL      WEBERR00
          MOVE      ONE,EXIT
          GOTO      CONT9999
.
CONT9160  MOVE      "Referral department does not match group session department",WEBTITLE
          CALL      WEBERR00
          MOVE      ONE,EXIT
          GOTO      CONT9999
.
CONT9200  MOVE      "Setup exists.",WEBTITLE
          CALL      WEBERR00
          MOVE      ONE,EXIT 
          GOTO      CONT9999
.
CONT9300  MOVE      "Patient already active for this session.",WEBTITLE
          CALL      WEBERR00
          MOVE      ONE,EXIT 
          GOTO      CONT9999
.
CONT9400  MOVE      "HCP already active for this session.",WEBTITLE
          CALL      WEBERR00
          MOVE      ONE,EXIT 
          GOTO      CONT9999
.
CONT9500  MOVE      "Cannot update Attendance Status - Group Contact Date/Time in the future.",WEBTITLE
          CALL      WEBERR00
          MOVE      ONE,EXIT
          GOTO      CONT9999
.
CONT9510  MOVE      "Invalid open group session setup record.",WEBTITLE
          CALL      WEBERR00
          MOVE      ONE,EXIT
          GOTO      CONT9999
.
CONT9520  MOVE      "Invalid group session setup record.",WEBTITLE
          CALL      WEBERR00
          MOVE      ONE,EXIT
          GOTO      CONT9999
.
CONT9530  CLEAR     WEBTITLE
          APPEND    "Invalid referral status - This referral is ",WEBTITLE
          APPEND    "closed prior to the contact date.",WEBTITLE
          RESET     WEBTITLE
          CALL      WEBERR00
          MOVE      ONE,EXIT
          GOTO      CONT9999
.
CONT9540  CLEAR     WEBTITLE
          APPEND    "Invalid referral status - ",WEBTITLE
          APPEND    "This referral is Inactive.",WEBTITLE
          RESET     WEBTITLE
          CALL      WEBERR00
          MOVE      ONE,EXIT
          GOTO      CONT9999
.
CONT9550  CLEAR     WEBTITLE
          APPEND    "Invalid referral status - ",WEBTITLE
          APPEND    "This referral is Cancelled.",WEBTITLE
          RESET     WEBTITLE
          CALL      WEBERR00
          MOVE      ONE,EXIT
          GOTO      CONT9999
.
CONT9560  CLEAR     WEBTITLE
          APPEND    "Invalid referral status - ",WEBTITLE
          APPEND    "This referral is Rejected.",WEBTITLE
          RESET     WEBTITLE
          CALL      WEBERR00
          MOVE      ONE,EXIT
          GOTO      CONT9999
.
CONT9999  RETURN
+
.-------------------------------------------------------------------------------
.  Check if Group Contact session is in the future (1=YES, 0=NO)
.-------------------------------------------------------------------------------
CHFTGC00  MOVE      ZERO,EXIT
.
          PACK      KEY8,ALGPA001,SP70
          CALL      RDALGRE1                     * get session details
          BRANCH    OVRCD,CHFTGC99
.
          CALL      IBACLOCK                     * get System date
          PACK      CURRDATE,CCC,CYY,CMM,CDD
          REP       " 0",CURRDATE
.
          MATCH     CURRDATE,ALGEGDTE            * session is current date?
          IF        @EQUAL
            CLOCK     TIME,CURRTIME              * get System time
            MATCH     CURRTIME,ALGEGTIM
            GOTO      CHFTGC90 IF EQUAL
            GOTO      CHFTGC91 IF NOT LESS       * session is at a future time
          ELSE
            GOTO      CHFTGC91 IF NOT LESS       * session is at a future date
          ENDIF
.
CHFTGC90  MOVE      ZERO,EXIT
          GOTO      CHFTGC99
.
CHFTGC91  MOVE      ONE,EXIT           * Future Group Contact date/time
CHFTGC99  RETURN
+
.-------------------------------------------------------------------------------
.  Check if it is OK to open this group contact session
.-------------------------------------------------------------------------------
CHKA0000  PACK      KEY8,ALGRO001,SP70
          CALL      RDALGRO1
          BRANCH    OVRCD,CHKA9000
.
          MATCH     ALGRSDAT,ALGRE004
          GOTO      CHKA9200 IF LESS
.
          PACK      KEY24,ALGRE004,ALGRE002,SP70
          CALL      RSALGRE3
CHKA1000  CALL      RKALGRE3
          BRANCH    OVRCD,CHKA8000
.
          MATCH     ALGRE004,ALGEGDTE
          GOTO      CHKA8000 IF NOT EQUAL
.
          MATCH     ALGRE002,ALGESESN
          GOTO      CHKA9100 IF EQUAL
.
CHKA8000  MOVE      ZERO,EXIT
          GOTO      CHKD9999
.
CHKA9000  MOVE      "Invalid group session setup.",WEBTITLE
          CALL      WEBERR00
          MOVE      ONE,EXIT
          GOTO      CHKD9999
.
CHKA9100  MOVE      "Open group contacts exist for this date",WEBTITLE
          CALL      WEBERR00
          MOVE      ONE,EXIT
          GOTO      CHKD9999
.
CHKA9200  MOVE      "Contact date must be after session start date",WEBTITLE
          CALL      WEBERR00
          MOVE      ONE,EXIT
          GOTO      CHKD9999
.
CHKA9999  RETURN
.
.-------------------------------------------------------------------------------
.  Copy session setup patients to contact patients file
.-------------------------------------------------------------------------------
COPP0000  PACK      KEY16,ALGESESN,SP70
          CALL      RSALGRP1
COPP1000  CALL      RKALGRP1
          BRANCH    OVRCD,COPP9999
.
          MATCH     ALGESESN,ALGPSESN
          GOTO      COPP9999 IF NOT EQUAL
.
          MATCH     "0",ALGPACTV
          GOTO      COPP1000 IF NOT EQUAL
.
          CALL      CGPA0000
.
          MOVE      ALGECONT,ALGACONT
          MOVE      ALGPURNO,ALGAURNO
          MOVE      ALGPREFN,ALGAREFN
          MOVE      ZERO,ALGAMEAL
.
          PACK      KEY8,CCC,CYY,CMM,CDD
          REP       " 0",KEY8
          MOVE      KEY8,ALGACDAT                * System date
          CLOCK     TIME,ALGACTIM                * System time
          MOVE      USERID,ALGACUID              * web user id
.
          MOVE      ZERO,ALGACURP
          PACK      KEY17,ALGAURNO,TWO,SP70
          CALL      RSPTMI18
          CALL      RKPTMI18
          BRANCH    OVRCD,COPP6000               * not on file
.
          MATCH     ALGAURNO,AURNO               * same U/R Number?
          GOTO      COPP6000 IF NOT EQUAL        * No
.
          COMPARE   TWO,ASTAT
          GOTO      COPP6000 IF NOT EQUAL
.
          MOVE      ONE,ALGACURP
          GOTO      COPP8000
.
.         Check for Mental Health Department
.
COPP6000  CALL      MHINC000                     * Set MHINC extract indicator
.
COPP8000  PACK      KEY16,ALGACONT,ALGAREFN,SP70
          CALL      RAALGPA1
          IF        OVRCD=1
            CALL     WRALGPA1
          ENDIF
.
          GOTO      COPP1000
.         
COPP9999  RETURN
.
.-------------------------------------------------------------------------------
.  Copy session setup hcp's to contact hcp's file
.-------------------------------------------------------------------------------
COPH0000  PACK      KEY21,ALGESESN,SP70
          CALL      RSALGRH1
COPH1000  CALL      RKALGRH1
          BRANCH    OVRCD,COPH9999
.
          MATCH     ALGESESN,ALGHSESN
          GOTO      COPH9999 IF NOT EQUAL
.
          MATCH     "0",ALGHACTV
          GOTO      COPH1000 IF NOT EQUAL
.
          CALL      CGEH0000
.
          MOVE      ALGECONT,ALGCCONT
          MOVE      ALGHHCPC,ALGCHCPC
          MOVE      ALGHSPEC,ALGCSPEC
.
          PACK      KEY8,CCC,CYY,CMM,CDD
          REP       " 0",KEY8
          MOVE      KEY8,ALGCCDAT                * System date
          CLOCK     TIME,ALGCCTIM                * System time
          MOVE      USERID,ALGCCUID              * web user id
.
          PACK      KEY21,ALGCCONT,ALGCHCPC,ALGCSPEC,SP70
          CALL      RAALGEH1
          IF        OVRCD=1
            CALL     WRALGEH1
          ENDIF
.
          GOTO      COPH1000
.
COPH9999  RETURN
.-------------------------------------------------------------------------------
.  Check if it is OK to delete this session.
.-------------------------------------------------------------------------------
CHKD0000  PACK      KEY8,ALGRSESN,SP70
          CALL      RSALGRP1
CHKD1000  CALL      RKALGRP1
          BRANCH    OVRCD,CHKD2000
.
          MATCH     ALGRSESN,ALGPSESN
          GOTO      CHKD9000 IF EQUAL
.
CHKD2000  PACK      KEY8,ALGRSESN,SP70
          CALL      RSALGRH1
CHKD2100  CALL      RKALGRH1
          BRANCH    OVRCD,CHKD3000
.
          MATCH     ALGRSESN,ALGHSESN
          GOTO      CHKD9100 IF EQUAL
.
CHKD3000  PACK      KEY16,ALGRSESN,SP70
          CALL      RSALGRE2
CHKD3100  CALL      RKALGRE2
          BRANCH    OVRCD,CHKD8000
.
          MATCH     ALGRSESN,ALGESESN
          GOTO      CHKD9200 IF EQUAL
.
CHKD8000  MOVE      ZERO,EXIT
          GOTO      CHKD9999
.
CHKD9000  MOVE      "Invalid deletion patients exist for this session.",WEBTITLE
          CALL      WEBERR00 
          MOVE      ONE,EXIT
          GOTO      CHKD9999
.         
CHKD9100  MOVE      "Invalid deletion HCP's exist for this session.",WEBTITLE
          CALL      WEBERR00 
          MOVE      ONE,EXIT
          GOTO      CHKD9999
.         
CHKD9200  CLEAR     WEBTITLE
          APPEND    "Invalid deletion attendances exist for ",WEBTITLE
          APPEND    "this session.",WEBTITLE
          RESET     WEBTITLE
          CALL      WEBERR00 
          MOVE      ONE,EXIT
          GOTO      CHKD9999
.         
CHKD9999  RETURN
.
.-------------------------------------------------------------------------------
.  Check if it is OK to delete this group contact.
.-------------------------------------------------------------------------------
DCHK0000  PACK      KEY16,ALGECONT,SP70
          CALL      RSALGPA1
DCHK1000  CALL      RKALGPA1
          BRANCH    OVRCD,DCHK2000
.
          MATCH     ALGECONT,ALGACONT
          GOTO      DCHK2000 IF NOT EQUAL
.
          MATCH     "1",ALGARCST
          GOTO      DCHK1000 IF EQUAL         * Deleted record
.
          GOTO      DCHK9000
.
DCHK2000  PACK      KEY21,ALGECONT,SP70
          CALL      RSALGEH1
DCHK2100  CALL      RKALGEH1
          BRANCH    OVRCD,DCHK8000
.
          MATCH     ALGECONT,ALGCCONT
          GOTO      DCHK9100 IF EQUAL
.
DCHK8000  MOVE      ZERO,EXIT
          GOTO      DCHK9999
.
DCHK9000  CLEAR     WEBTITLE
          APPEND    "Invalid deletion patients exist for this ",WEBTITLE
          APPEND    "open session.",WEBTITLE
          RESET     WEBTITLE
          CALL      WEBERR00
          MOVE      ONE,EXIT
          GOTO      DCHK9999
.
DCHK9100  CLEAR     WEBTITLE
          APPEND    "Invalid deletion HCP's exist for this ",WEBTITLE
          APPEND    "open session.",WEBTITLE
          RESET     WEBTITLE
          CALL      WEBERR00
          MOVE      ONE,EXIT
          GOTO      DCHK9999
.
DCHK9999  RETURN
.
.-------------------------------------------------------------------------------
.  Check if this U/R already has an active record for this session
.-------------------------------------------------------------------------------
ACTP0000  MOVE      ZERO,EXIT
          PACK      KEY25,ALGRP001,ALGRP002,SP70
          CALL      RSALGRP2
ACTP1000  CALL      RKALGRP2
          BRANCH    OVRCD,ACTP9999
.
          MATCH     ALGRP001,ALGPSESN
          GOTO      ACTP9999 IF NOT EQUAL
.
          MATCH     ALGRP002,ALGPURNO
          GOTO      ACTP9999 IF NOT EQUAL
.
          MATCH     ALGRP003,ALGPREFN
          GOTO      ACTP1000 IF EQUAL 
.
          MATCH     "0",ALGPACTV
          GOTO      ACTP9999 IF NOT EQUAL
.
          MOVE      ONE,EXIT
.
ACTP9999  RETURN
.
.-------------------------------------------------------------------------------
.  Check if this U/R already exist for this group contact
.-------------------------------------------------------------------------------
CHKP0000  MOVE      ZERO,EXIT
          PACK      KEY24,ALGPA001,ALGPA002,SP70
          CALL      RSALGRP2
CHKP1000  CALL      RKALGRP2
          BRANCH    OVRCD,CHKP9999
.
          MATCH     ALGPA001,ALGACONT
          GOTO      CHKP9999 IF NOT EQUAL
.
          MATCH     ALGPA002,ALGPURNO
          GOTO      CHKP9999 IF NOT EQUAL
.
          MOVE      ONE,EXIT
.
CHKP9999  RETURN
.
.-------------------------------------------------------------------------------
.  Check if this HCP already has an active record for this session
.-------------------------------------------------------------------------------
ACTH0000  MOVE      ZERO,EXIT
          PACK      KEY22,ALGRH001,ALGRH002,SP70
          CALL      RSALGRH2
ACTH1000  CALL      RKALGRH2
          BRANCH    OVRCD,ACTH9999
.
          MATCH     ALGRH001,ALGHSESN
          GOTO      ACTH9999 IF NOT EQUAL
.
          MATCH     ALGRH002,ALGHHCPC
          GOTO      ACTH9999 IF NOT EQUAL
.
          MATCH     ALGRH003,ALGHSPEC
          GOTO      ACTP1000 IF EQUAL
.
          MATCH     "0",ALGHACTV
          GOTO      ACTH9999 IF NOT EQUAL
.
          MOVE      ONE,EXIT
.
ACTH9999  RETURN
.
.
.-------------------------------------------------------------------------------
.  Check if this HCP already exists for this group contact
.-------------------------------------------------------------------------------
CHKH0000  MOVE      ZERO,EXIT
          PACK      KEY21,ALGEH001,ALGEH002,SP70
          CALL      RSALGEH1
CHKH1000  CALL      RKALGEH1
          BRANCH    OVRCD,CHKH9999
.
          MATCH     ALGEH001,ALGCCONT
          GOTO      CHKH9999 IF NOT EQUAL
.
          MATCH     ALGEH002,ALGCHCPC
          GOTO      CHKH9999 IF NOT EQUAL
.
          MOVE      ONE,EXIT
.
CHKH9999  RETURN
.
.-------------------------------------------------------------------------------
.  Set Parameters for group contact session setup - allgroaf
.-------------------------------------------------------------------------------
SGRO0000  MOVE      ZERO,EXIT
          UNPACK    QRYNAME,KEY5,KEY3
          MOVE      KEY3,F3
          BRANCH    F3,SGRO0001,SGRO0002,SGRO0003,SGRO0004,SGRO0005:
                       SGRO0006,SGRO0007,SGRO0008,SGRO0009,SGRO0010:
                       SGRO0011,SGRO0012,SGRO0013,SGRO0014,SGRO0015:
                       SGRO0016
.
          MOVE      ONE,EXIT
          GOTO      SGRO9999
.
SGRO0001  PACK      ALGRO001,QRYDATA,SP70
          GOTO      SGRO9999
.
SGRO0002  MOVE      QRYDATA,ALGRO002
          GOTO      SGRO9999
.
SGRO0003  MOVE      QRYDATA,ALGRO003
          GOTO      SGRO9999
.
SGRO0004  MOVE      QRYDATA,ALGRO004
          GOTO      SGRO9999
.
SGRO0005  MOVE      QRYDATA,ALGRO005
          GOTO      SGRO9999
.
SGRO0006  UNPACK    QRYDATA,CDAY,KEY1,MTHNAM3,KEY1,CCENT,CYEAR
          CALL      SETMTH00                *Set CMON from MTHNAM3
          PACK      ALGRO006,CCENT,CYEAR,CMON,CDAY
          GOTO      SGRO9999
.
SGRO0007  MOVE      QRYDATA,ALGRO007 
          GOTO      SGRO9999
.
SGRO0008  MOVE      QRYDATA,ALGRO008
          GOTO      SGRO9999
.
SGRO0009  MOVE      QRYDATA,ALGRO009
          GOTO      SGRO9999
.
SGRO0010  MOVE      QRYDATA,ALGRO010
          GOTO      SGRO9999
.
SGRO0011  MOVE      QRYDATA,ALGRO011
          GOTO      SGRO9999
.
SGRO0012  MOVE      QRYDATA,ALGRO012
          GOTO      SGRO9999
.
SGRO0013  MOVE      QRYDATA,ALGRO013
          GOTO      SGRO9999
.
SGRO0014  MOVE      QRYDATA,ALGRO014
          GOTO      SGRO9999
.
SGRO0015  MOVE      QRYDATA,ALGRO015
          GOTO      SGRO9999
.
SGRO0016  MOVE      QRYDATA,ALGRO016
          GOTO      SGRO9999
.
SGRO9999  RETURN
.
.-------------------------------------------------------------------------------
.  Set Parameters for group contact patients - allgpaaf
.-------------------------------------------------------------------------------
SGPA0000  MOVE      ZERO,EXIT
          UNPACK    QRYNAME,KEY5,KEY3
          MOVE      KEY3,F3
          BRANCH    F3,SGPA0001,SGPA0002,SGPA0003,SGPA0004,SGPA0005:
                       SGPA0006,SGPA0007
.                      
          MOVE      ONE,EXIT
          GOTO      SGPA9999
.         
SGPA0001  PACK      ALGPA001,QRYDATA,SP70
          GOTO      SGPA9999
.         
SGPA0002  PACK      ALGPA002,QRYDATA,SP70
          GOTO      SGPA9999
.
SGPA0003  PACK      ALGPA003,QRYDATA,SP70
          GOTO      SGPA9999
.
SGPA0004  MOVE      QRYDATA,ALGPA004
          GOTO      SGPA9999
.
SGPA0005  MOVE      QRYDATA,ALGPA005
          GOTO      SGPA9999
.
SGPA0006  MOVE      QRYDATA,ALGPA006
          GOTO      SGPA9999
.
SGPA0007  MOVE      QRYDATA,ALGPA007
          GOTO      SGPA9999
.
SGPA9999  RETURN
.
.-------------------------------------------------------------------------------
.  Set Parameters for group contact session patients - allgrpaf
.-------------------------------------------------------------------------------
SGRP0000  MOVE      ZERO,EXIT
          UNPACK    QRYNAME,KEY5,KEY3
          MOVE      KEY3,F3
          BRANCH    F3,SGRP0001,SGRP0002,SGRP0003,SGRP0004
.
          MOVE      ONE,EXIT
          GOTO      SGRP9999
.
SGRP0001  PACK      ALGRP001,QRYDATA,SP70
          GOTO      SGRP9999
.
SGRP0002  MOVE      QRYDATA,ALGRP002
          GOTO      SGRP9999
.
SGRP0003  PACK      ALGRP003,QRYDATA,SP70
          GOTO      SGRP9999
.
SGRP0004  MOVE      QRYDATA,ALGRP004
          GOTO      SGRP9999
.
SGRP9999  RETURN
.
.-------------------------------------------------------------------------------
.  Set Parameters for group contact session hcp's - allgrhaf
.-------------------------------------------------------------------------------
SGRH0000  MOVE      ZERO,EXIT
          UNPACK    QRYNAME,KEY5,KEY3
          MOVE      KEY3,F3
          BRANCH    F3,SGRH0001,SGRH0002,SGRH0003,SGRH0004
.         
          MOVE      ONE,EXIT
          GOTO      SGRH9999
.         
SGRH0001  PACK      ALGRH001,QRYDATA,SP70
          GOTO      SGRH9999
.         
SGRH0002  PACK      ALGRH002,QRYDATA,SP70
          GOTO      SGRH9999
.         
SGRH0003  PACK      ALGRH003,QRYDATA,SP70
          GOTO      SGRH9999
.
SGRH0004  MOVE      QRYDATA,ALGRH004
          GOTO      SGRH9999
.
SGRH9999  RETURN
.
.-------------------------------------------------------------------------------
.  Set Parameters for group contacts - allgreaf
.-------------------------------------------------------------------------------
SGRE0000  MOVE      ZERO,EXIT
          UNPACK    QRYNAME,KEY5,KEY3
          MOVE      KEY3,F3
          BRANCH    F3,SGRE0001,SGRE0002,SGRE0003,SGRE0004,SGRE0005:
                       SGRE0006
.
          MOVE      ONE,EXIT
          GOTO      SGRE9999
.
SGRE0001  PACK      ALGRE001,QRYDATA,SP70
          GOTO      SGRE9999
.
SGRE0002  PACK      ALGRE002,QRYDATA,SP70
          GOTO      SGRE9999
.
SGRE0003  PACK      ALGRE003,QRYDATA,SP70
          GOTO      SGRE9999
.
SGRE0004  UNPACK    QRYDATA,CDAY,KEY1,MTHNAM3,KEY1,CCENT,CYEAR
          CALL      SETMTH00                *Set CMON from MTHNAM3
          PACK      ALGRE004,CCENT,CYEAR,CMON,CDAY
          GOTO      SGRE9999
.
SGRE0005  MOVE      QRYDATA,ALGRE005
          GOTO      SGRE9999
.
SGRE0006  MOVE      QRYDATA,ALGRE006
          GOTO      SGRE9999
.
SGRE9999  RETURN
.
.-------------------------------------------------------------------------------
.  Set Parameters for group contacts hcps- allgreaf
.-------------------------------------------------------------------------------
SGEH0000  MOVE      ZERO,EXIT
          UNPACK    QRYNAME,KEY5,KEY3
          MOVE      KEY3,F3
          BRANCH    F3,SGEH0001,SGEH0002,SGEH0003,SGEH0004
.
          MOVE      ONE,EXIT
          GOTO      SGEH9999
.
SGEH0001  PACK      ALGEH001,QRYDATA,SP70
          GOTO      SGEH9999
.
SGEH0002  PACK      ALGEH002,QRYDATA,SP70
          GOTO      SGEH9999
.
SGEH0003  PACK      ALGEH003,QRYDATA,SP70
          GOTO      SGEH9999
.
SGEH0004  MOVE      QRYDATA,ALGEH004
          GOTO      SGEH9999
.
SGEH9999  RETURN
.
.------------------------------------------------------------
.  Update cgi to group contact session setup - allgroaf     
.------------------------------------------------------------
MGRO0000  MATCH     ALGRO001,Z70
          IF        !@EQUAL
            MOVE      ALGRO001,ALGRSESN
          ENDIF     
.
          MATCH     ALGRO002,Z70
          IF        !@EQUAL
            MOVE      ALGRO002,ALGRNAME
          ENDIF     
.
          MATCH     ALGRO003,Z70
          IF        !@EQUAL
            MOVE      ALGRO003,ALGRSEST
          ENDIF     
.
          MATCH     ALGRO004,Z70
          IF        !@EQUAL
            MOVE      ALGRO004,ALGRLOCN
          ENDIF     
.
          MATCH     ALGRO005,Z70
          IF        !@EQUAL
            MOVE      ALGRO005,ALGRDAYI
          ENDIF     
.
          MATCH     ALGRO006,Z70
          IF        !@EQUAL
            MOVE      ALGRO006,ALGRSDAT
          ENDIF     
.
          MATCH     ALGRO007,Z70
          IF        !@EQUAL
            MOVE      ALGRO007,ALGRSTIM
          ENDIF     
.
          MATCH     ALGRO008,Z70
          IF        !@EQUAL
            MOVE      ALGRO008,ALGRDURN
          ENDIF     
.
          MATCH     ALGRO009,Z70
          IF        !@EQUAL
            MOVE      ALGRO009,ALGRDEPT
          ENDIF     
.
          MATCH     ALGRO010,Z70
          IF        !@EQUAL
            MOVE      ALGRO010,ALGRFREQ
          ENDIF     
.
          MATCH     ALGRO011,Z70
          IF        !@EQUAL
            MOVE      ALGRO011,ALGRACTV
          ENDIF     
.
          MATCH     ALGRO012,Z70
          IF        !@EQUAL
            MOVE      ALGRO012,ALGRCONT
          ENDIF     
.
          MATCH     ALGRO013,Z70
          IF        !@EQUAL
            MOVE      ALGRO013,ALGRUDF1
          ENDIF     
.
          MATCH     ALGRO014,Z70
          IF        !@EQUAL
            MOVE      ALGRO014,ALGRUDF2
          ENDIF     
.
          MATCH     ALGRO015,Z70
          IF        !@EQUAL
            MOVE      ALGRO015,ALGRUDF3
          ENDIF     
.
          MATCH     ALGRO016,Z70
          IF        !@EQUAL
            MOVE      ALGRO016,ALGRUDF4
          ENDIF     
.
MGRO9999  RETURN
.
.------------------------------------------------------------
.  Update cgi to group contact session patients - allgrpaf
.------------------------------------------------------------
MGRP0000  MATCH     ALGRP001,Z70
          IF        !@EQUAL
            MOVE      ALGRP001,ALGPSESN
          ENDIF
.
          MATCH     ALGRP002,Z70
          IF        !@EQUAL
            MOVE      ALGRP002,ALGPURNO
          ENDIF
.
          MATCH     ALGRP003,Z70
          IF        !@EQUAL
            MOVE      ALGRP003,ALGPREFN
          ENDIF
.
          MATCH     ALGRP004,Z70
          IF        !@EQUAL
            MOVE      ALGRP004,ALGPACTV
          ENDIF
.
MGRP9999  RETURN
.
.------------------------------------------------------------
.  Update cgi to group contact patients - allgpaaf
.------------------------------------------------------------
MGPA0000  MATCH     ALGPA001,Z70
          IF        !@EQUAL
            MOVE      ALGPA001,ALGACONT
          ENDIF
.
          MATCH     ALGPA002,Z70
          IF        !@EQUAL
            MOVE      ALGPA002,ALGAURNO
          ENDIF
.
          MATCH     ALGPA003,Z70
          IF        !@EQUAL
            MOVE      ALGPA003,ALGAREFN
          ENDIF
.
          MATCH     ALGPA004,Z70
          IF        !@EQUAL
            MOVE      ALGPA004,ALGACURP
          ENDIF
.
          MATCH     ALGPA005,Z70
          IF        !@EQUAL
            MATCH     ALGPA005,ALGAPSTA
            IF        !@EQUAL
              MOVE      ALGPA005,ALGAPSTA
            ENDIF
          ENDIF
.
          MATCH     ALGPA006,Z70
          IF        !@EQUAL
            MOVE      ALGPA006,ALGAMEAL
          ENDIF
.
.         MATCH     ALGPA007,Z70
.         IF        !@EQUAL
.           MOVE      ALGPA007,ALGAMOHX
.         ENDIF
.         
MGPA9999  RETURN
.
.------------------------------------------------------------
.  Update cgi to group contact session hcp's - allgrhaf
.------------------------------------------------------------
MGRH0000  MATCH     ALGRH001,Z70
          IF        !@EQUAL
            MOVE      ALGRH001,ALGHSESN
          ENDIF
.
          MATCH     ALGRH002,Z70
          IF        !@EQUAL
            MOVE      ALGRH002,ALGHHCPC
          ENDIF
.
          MATCH     ALGRH003,Z70
          IF        !@EQUAL
            MOVE      ALGRH003,ALGHSPEC
          ENDIF
.
          MATCH     ALGRH004,Z70
          IF        !@EQUAL
            MOVE      ALGRH004,ALGHACTV
          ENDIF
.
MGRH9999  RETURN
.
.------------------------------------------------------------
.  Update cgi to group contacts - allgreaf
.------------------------------------------------------------
MGRE0000  MATCH     ALGRE001,Z70
          IF        !@EQUAL
            MOVE      ALGRE001,ALGECONT
          ENDIF
.
          MATCH     ALGRE002,Z70
          IF        !@EQUAL
            MOVE      ALGRE002,ALGESESN
          ENDIF
.
          MATCH     ALGRE003,Z70
          IF        !@EQUAL
            MOVE      ALGRE003,ALGELOCN
          ENDIF
.
          MATCH     ALGRE004,Z70
          IF        !@EQUAL
            MOVE      ALGRE004,ALGEGDTE
          ENDIF
.
          MATCH     ALGRE005,Z70
          IF        !@EQUAL
            MOVE      ALGRE005,ALGEGTIM
          ENDIF
.
          MATCH     ALGRE006,Z70
          IF        !@EQUAL
            MOVE      ALGRE006,ALGEDURN
          ENDIF
.
MGRE9999  RETURN
.
.------------------------------------------------------------
.  Update cgi to group contact hcp's - allgehaf
.------------------------------------------------------------
MGEH0000  MATCH     ALGEH001,Z70
          IF        !@EQUAL
            MOVE      ALGEH001,ALGCCONT
          ENDIF
.
          MATCH     ALGEH002,Z70
          IF        !@EQUAL
            MOVE      ALGEH002,ALGCHCPC
          ENDIF
.
          MATCH     ALGEH003,Z70
          IF        !@EQUAL
            MOVE      ALGEH003,ALGCSPEC
          ENDIF
.
          MATCH     ALGEH004,Z70
          IF        !@EQUAL
            MOVE      ALGEH004,ALGCHSTA
          ENDIF
.
MGEH9999  RETURN
.
.------------------------------------------------------------
. Output group contact session setup - allgroaf
.------------------------------------------------------------
ALGR0000  BRANCH    FLDITMNO,ALGR0010,ALGR0020,ALGR0030,ALGR0040,ALGR0050:
                             ALGR0060,ALGR0070,ALGR0080,ALGR0090,ALGR0100:
                             ALGR0110,ALGR0120,ALGR0130,ALGR0140,ALGR0150:
                             ALGR0160,ALGR0170,ALGR0180,ALGR0190,ALGR0200:
                             ALGR0210,ALGR0220,ALGR0230,ALGR0240,ALGR0250:
                             ALGR0260,ALGR0270,ALGR0280
.
          WRITE     HTMLFILE;"Invalid IBA Tag";
          GOTO      ALGR9999
.
ALGR0010  WRITE     HTMLFILE;ALGRSESN;
          GOTO      ALGR9999
.
ALGR0020  WRITE     HTMLFILE;ALGRNAME;
          GOTO      ALGR9999
.
ALGR0030  MOVE      "gy",CATEGORY
          MOVE      ALGRSEST,CODE
          CALL      CODITM00
          GOTO      ALGR9999
.
ALGR0040  MOVE      "PO",CATEGORY
          MOVE      ALGRLOCN,CODE
          CALL      CODITM00
          GOTO      ALGR9999
.
ALGR0050  UNPACK    DIM127,D1,KEY1,DIM127
          MOVE      ZERO,F1
          MOVE      KEY1,F1
          BRANCH    F1,ALGR0051
. 
          MOVE      ALGRDAYI,F1
          LOAD      DAYNAM3,F1,MON,TUE,WED,THU,FRI,SAT,SUN
          WRITE     HTMLFILE;DAYNAM3;
          GOTO      ALGR9999
.
ALGR0051  WRITE     HTMLFILE;ALGRDAYI;
          GOTO      ALGR9999
.
ALGR0060  MATCH     ALGRSDAT,SP70
          GOTO      ALGR9999 IF EQUAL
.
          UNPACK    ALGRSDAT,CCENT,CYEAR,CMON,CDAY
          MOVE      CMON,F2
          LOAD      MTHNAM3,F2,JAN,FEB,MAR,APR,MAY,JUN,JUL,AUG,SEP,OCT,NOV,DEC
          WRITE     HTMLFILE;CDAY,SP1,MTHNAM3,SP1,CCENT,CYEAR;
          GOTO      ALGR9999
.
ALGR0070  WRITE     HTMLFILE;ALGRSTIM;
          GOTO      ALGR9999
.
ALGR0080  WRITE     HTMLFILE;ALGRDURN;
          GOTO      ALGR9999
.
ALGR0090  UNPACK    DIM127,D1,KEY1,DIM127
          MOVE      ZERO,F1
          MOVE      KEY1,F1
          BRANCH    F1,ALGR0091,ALGR0092
.
          PACK      KEY5,ANSC,ANSG,ALGRDEPT,SP70
          CALL      RDCODE1
          IF        OVRCD=1
            MOVE      ALGRDEPT,TDESC
          ENDIF
          WRITE     HTMLFILE;TDESC
          GOTO      ALGR9999
.
ALGR0091  WRITE     HTMLFILE;ALGRDEPT;
          GOTO      ALGR9999
.
ALGR0092  MOVE      ALGRDEPT,D3
          CALL      DEPS0000
          GOTO      ALGR9999
.
ALGR0100  MOVE      "fr",CATEGORY
          MOVE      ALGRFREQ,CODE
          CALL      CODITM00
          GOTO      ALGR9999
.
ALGR0110  UNPACK    DIM127,D1,KEY1,DIM127
          MOVE      ZERO,F1
          MOVE      KEY1,F1
          BRANCH    F1,ALGR0111
.
          MOVE      "Inactive",DESCACTV
          MATCH     "0",ALGRACTV
          IF        @EQUAL
            MOVE      "Active",DESCACTV
          ENDIF
          WRITE     HTMLFILE;DESCACTV;
          GOTO      ALGR9999
.
ALGR0111  WRITE     HTMLFILE;ALGRACTV;
          GOTO      ALGR9999
.
ALGR0120  MATCH     ALGRCDAT,SP70
          GOTO      ALGR9999 IF EQUAL
.
          UNPACK    ALGRCDAT,CCENT,CYEAR,CMON,CDAY
          MOVE      CMON,F2
          LOAD      MTHNAM3,F2,JAN,FEB,MAR,APR,MAY,JUN,JUL,AUG,SEP,OCT,NOV,DEC
          WRITE     HTMLFILE;CDAY,SP1,MTHNAM3,SP1,CCENT,CYEAR;
          GOTO      ALGR9999
.
ALGR0130  WRITE     HTMLFILE;ALGRCTIM;
          GOTO      ALGR9999
.
ALGR0140  MATCH     SP70,ALGRCUID
          GOTO      ALGR9999 IF EQUAL
.
          MOVE      SP70,WBSENAM
          PACK      KEY10,ALGRCUID,SP70
          CALL      RDWBSE1
          IF        OVRCD=1
            MOVE      ALGRCUID,WBSENAM
          ENDIF
          WRITE     HTMLFILE;WBSENAM;
          GOTO      ALGR9999
.
ALGR0150  MATCH     ALGRUDAT,SP70
          GOTO      ALGR9999 IF EQUAL
.
          UNPACK    ALGRUDAT,CCENT,CYEAR,CMON,CDAY
          MOVE      CMON,F2
          LOAD      MTHNAM3,F2,JAN,FEB,MAR,APR,MAY,JUN,JUL,AUG,SEP,OCT,NOV,DEC
          WRITE     HTMLFILE;CDAY,SP1,MTHNAM3,SP1,CCENT,CYEAR;
          GOTO      ALGR9999
.
ALGR0160  WRITE     HTMLFILE;ALGRUTIM;
          GOTO      ALGR9999
.
ALGR0170  MATCH     SP70,ALGRUUID
          GOTO      ALGR9999 IF EQUAL
.
          MOVE      SP70,WBSENAM
          PACK      KEY10,ALGRUUID,SP70
          CALL      RDWBSE1
          IF        OVRCD=1
            MOVE      ALGRUUID,WBSENAM
          ENDIF
          WRITE     HTMLFILE;WBSENAM;
          GOTO      ALGR9999
.
ALGR0180  MOVE      "PO",CATEGORY
          MOVE      FLTRLOCN,CODE
          CALL      CODITM00
          GOTO      ALGR9999
.
ALGR0190  WRITE     HTMLFILE;FLTRACTV;
          GOTO      ALGR9999
.
ALGR0200  WRITE     HTMLFILE;FILTRDAY;
          GOTO      ALGR9999
.
ALGR0210  IF        DEFTFLAG=0
            MOVE      WBSEDALL,FLTRDEPT
          ENDIF
.
          CALL      OTAB0000                * session setup table
          GOTO      ALGR9999
.
ALGR0220  IF        DEFTFLAG=0
            MOVE      WBSEDALL,FLTRDEPT
          ENDIF
.
          MOVE      FLTRDEPT,D3
          CALL      DEPS0000
          GOTO      ALGR9999
.
ALGR0230  IF        DEFTFLAG=0
            MOVE      WBSEDALL,FLTRDEPT
          ENDIF
.
          MOVE      ZERO,FLTRACTV           * active only
.
          CALL      OTAB0000                * session setup table
          GOTO      ALGR9999
.
ALGR0240  MOVE      "gb",CATEGORY
          MOVE      ALGRCONT,CODE
          CALL      CODITM00
          GOTO      ALGR9999
.
ALGR0250  MOVE      "g1",CATEGORY
          MOVE      ALGRUDF1,CODE
          CALL      CODITM00
          GOTO      ALGR9999
.
ALGR0260  MOVE      "g2",CATEGORY
          MOVE      ALGRUDF2,CODE
          CALL      CODITM00
          GOTO      ALGR9999
.
ALGR0270  MOVE      "g3",CATEGORY
          MOVE      ALGRUDF3,CODE
          CALL      CODITM00
          GOTO      ALGR9999
.
ALGR0280  MOVE      "g4",CATEGORY
          MOVE      ALGRUDF4,CODE
          CALL      CODITM00
          GOTO      ALGR9999
.
ALGR9999  RETURN
.
.------------------------------------------------------------
. Output group contact session patients - allgrpaf
.------------------------------------------------------------
ALGP0000  BRANCH    FLDITMNO,ALGP0010,ALGP0020,ALGP0030,ALGP0040,ALGP0050:
                             ALGP0060,ALGP0070,ALGP0080,ALGP0090,ALGP0100:
                             ALGP0110,ALGP0120,ALGP0130,ALGP0140
.
          WRITE     HTMLFILE;"Invalid IBA Tag";
          GOTO      ALGP9999
.
ALGP0010  WRITE     HTMLFILE;ALGPSESN;
          GOTO      ALGP9999
.
ALGP0020  WRITE     HTMLFILE;ALGPURNO;
          GOTO      ALGP9999
.
ALGP0030  WRITE     HTMLFILE;ALGPREFN;
          GOTO      ALGP9999
.
ALGP0040  WRITE     HTMLFILE;ALGPACTV;
          GOTO      ALGP9999
.
ALGP0050  MATCH     ALGPCDAT,SP70
          GOTO      ALGP9999 IF EQUAL
.
          UNPACK    ALGPCDAT,CCENT,CYEAR,CMON,CDAY
          MOVE      CMON,F2
          LOAD      MTHNAM3,F2,JAN,FEB,MAR,APR,MAY,JUN,JUL,AUG,SEP,OCT,NOV,DEC
          WRITE     HTMLFILE;CDAY,SP1,MTHNAM3,SP1,CCENT,CYEAR;
          GOTO      ALGP9999
.
ALGP0060  WRITE     HTMLFILE;ALGPCTIM;
          GOTO      ALGP9999
.
ALGP0070  MATCH     SP70,ALGPCUID
          GOTO      ALGP9999 IF EQUAL
.
          MOVE      SP70,WBSENAM
          PACK      KEY10,ALGPCUID,SP70
          CALL      RDWBSE1
          IF        OVRCD=1
            MOVE      ALGPCUID,WBSENAM
          ENDIF
          WRITE     HTMLFILE;WBSENAM;
          GOTO      ALGP9999
.
ALGP0080  MATCH     ALGPUDAT,SP70
          GOTO      ALGP9999 IF EQUAL
.
          UNPACK    ALGPUDAT,CCENT,CYEAR,CMON,CDAY
          MOVE      CMON,F2
          LOAD      MTHNAM3,F2,JAN,FEB,MAR,APR,MAY,JUN,JUL,AUG,SEP,OCT,NOV,DEC
          WRITE     HTMLFILE;CDAY,SP1,MTHNAM3,SP1,CCENT,CYEAR;
          GOTO      ALGP9999
.
ALGP0090  WRITE     HTMLFILE;ALGPUTIM;
          GOTO      ALGP9999
.
ALGP0100  MATCH     SP70,ALGPUUID
          GOTO      ALGP9999 IF EQUAL
.
          MOVE      SP70,WBSENAM
          PACK      KEY10,ALGPUUID,SP70
          CALL      RDWBSE1
          IF        OVRCD=1
            MOVE      ALGPUUID,WBSENAM
          ENDIF
          WRITE     HTMLFILE;WBSENAM;
          GOTO      ALGP9999
.
ALGP0110  BRANCH    LISTVIEW,ALGP0115
          CALL      PTAB0000
          GOTO      ALGP9999
.
ALGP0115  CALL      HTAB0000  
          GOTO      ALGP9999
.
ALGP0120  PACK      KEY8,ALGPURNO,SP70
          CALL      RDMAST1
          BRANCH    OVRCD,ALGP9999
.
          CALL      PATNAM00 
          WRITE     HTMLFILE;PATFNAME;
          GOTO      ALGP9999
.
ALGP0130  PACK      KEY8,ALGPREFN,SP70
          CALL      RDALREF1
          BRANCH    OVRCD,ALGP9999
.
          PACK      KEY5,ANSC,ANSG,ALREDEPT,SP70
          CALL      RDCODE1
          IF        OVRCD=1
            MOVE      ALREDEPT,TDESC
          ENDIF
          WRITE     HTMLFILE;TDESC;   
          GOTO      ALGP9999
.
ALGP0140  WRITE     HTMLFILE;LISTVIEW;   
          GOTO      ALGP9999
.
ALGP9999  RETURN
.
.------------------------------------------------------------
. Output group contact session hcp's - allgrhaf
.------------------------------------------------------------
ALGH0000  BRANCH    FLDITMNO,ALGH0010,ALGH0020,ALGH0030,ALGH0040,ALGH0050:
                             ALGH0060,ALGH0070,ALGH0080,ALGH0090,ALGH0100
.
          WRITE     HTMLFILE;"Invalid IBA Tag";
          GOTO      ALGH9999
.
ALGH0010  WRITE     HTMLFILE;ALGHSESN;
          GOTO      ALGH9999
.
ALGH0020  UNPACK    DIM127,D1,KEY1,DIM127
          MOVE      ZERO,F1
          MOVE      KEY1,F1
          BRANCH    F1,ALGH0021
.
          PACK      KEY10,ALGHHCPC,SP70
          CALL      RDPMHCP1
          BRANCH    OVRCD,ALGH9999
.
          MOVE      PMHCTITL,FMTTITLE
          MOVE      PMHCGNAM,FMTGNAME
          MOVE      PMHCSNAM,FMTSNAME
          CALL      DOCNM000
          WRITE     HTMLFILE;DOCFNAME;
          GOTO      ALGH9999
.
ALGH0021  WRITE     HTMLFILE;ALGHHCPC;
          GOTO      ALGH9999
.
ALGH0030  MOVE      "DT",CATEGORY
          MOVE      ALGHSPEC,CODE
          CALL      CODITM00
          GOTO      ALGH9999
.
ALGH0040  WRITE     HTMLFILE;ALGHACTV;
          GOTO      ALGH9999
.
ALGH0050  MATCH     ALGHCDAT,SP70
          GOTO      ALGH9999 IF EQUAL
.
          UNPACK    ALGHCDAT,CCENT,CYEAR,CMON,CDAY
          MOVE      CMON,F2
          LOAD      MTHNAM3,F2,JAN,FEB,MAR,APR,MAY,JUN,JUL,AUG,SEP,OCT,NOV,DEC
          WRITE     HTMLFILE;CDAY,SP1,MTHNAM3,SP1,CCENT,CYEAR;
          GOTO      ALGH9999
.
ALGH0060  WRITE     HTMLFILE;ALGHCTIM;
          GOTO      ALGH9999
.
ALGH0070  MATCH     SP70,ALGHCUID
          GOTO      ALGH9999 IF EQUAL
.
          MOVE      SP70,WBSENAM
          PACK      KEY10,ALGHCUID,SP70
          CALL      RDWBSE1
          IF        OVRCD=1
            MOVE      ALGHCUID,WBSENAM
          ENDIF
          WRITE     HTMLFILE;WBSENAM;
          GOTO      ALGH9999
.
ALGH0080  MATCH     ALGHUDAT,SP70
          GOTO      ALGH9999 IF EQUAL
.
          UNPACK    ALGHUDAT,CCENT,CYEAR,CMON,CDAY
          MOVE      CMON,F2
          LOAD      MTHNAM3,F2,JAN,FEB,MAR,APR,MAY,JUN,JUL,AUG,SEP,OCT,NOV,DEC
          WRITE     HTMLFILE;CDAY,SP1,MTHNAM3,SP1,CCENT,CYEAR;
          GOTO      ALGH9999
.
ALGH0090  WRITE     HTMLFILE;ALGHUTIM;
          GOTO      ALGH9999
.
ALGH0100  MATCH     SP70,ALGHUUID
          GOTO      ALGH9999 IF EQUAL
.
          MOVE      SP70,WBSENAM
          PACK      KEY10,ALGHUUID,SP70
          CALL      RDWBSE1
          IF        OVRCD=1
            MOVE      ALGHUUID,WBSENAM
          ENDIF
          WRITE     HTMLFILE;WBSENAM;
          GOTO      ALGH9999
.
ALGH9999  RETURN
.
.------------------------------------------------------------
. Output group contact patients - allgpaaf
.------------------------------------------------------------
ALGA0000  BRANCH    FLDITMNO,ALGA0010,ALGA0020,ALGA0030,ALGA0040,ALGA0050:
                             ALGA0060,ALGA0070,ALGA0080,ALGA0090,ALGA0100:
                             ALGA0110,ALGA0120,ALGA0130,ALGA0140,ALGA0150:
                             ALGA0160
.                            
          WRITE     HTMLFILE;"Invalid IBA Tag";
          GOTO      ALGA9999
.         
ALGA0010  WRITE     HTMLFILE;ALGACONT;
          GOTO      ALGA9999
.
ALGA0020  WRITE     HTMLFILE;ALGAURNO;
          GOTO      ALGA9999
.
ALGA0030  WRITE     HTMLFILE;ALGAREFN;
          GOTO      ALGA9999
.
ALGA0040  WRITE     HTMLFILE;ALGACURP;
          GOTO      ALGA9999
.
ALGA0050  MOVE      "GA",CATEGORY
          MOVE      ALGAPSTA,CODE
          CALL      CODITM00
          GOTO      ALGA9999
.
ALGA0060  WRITE     HTMLFILE;ALGAMEAL;
          GOTO      ALGA9999
.
ALGA0070  WRITE     HTMLFILE;ALGAMOHX;
          GOTO      ALGA9999
.
ALGA0080  MATCH     ALGACDAT,SP70
          GOTO      ALGA9999 IF EQUAL
.
          UNPACK    ALGACDAT,CCENT,CYEAR,CMON,CDAY
          MOVE      CMON,F2
          LOAD      MTHNAM3,F2,JAN,FEB,MAR,APR,MAY,JUN,JUL,AUG,SEP,OCT,NOV,DEC
          WRITE     HTMLFILE;CDAY,SP1,MTHNAM3,SP1,CCENT,CYEAR;
          GOTO      ALGA9999
.
ALGA0090  WRITE     HTMLFILE;ALGACTIM;
          GOTO      ALGA9999
.
ALGA0100  MATCH     SP70,ALGACUID
          GOTO      ALGA9999 IF EQUAL
.
          MOVE      SP70,WBSENAM
          PACK      KEY10,ALGACUID,SP70
          CALL      RDWBSE1
          IF        OVRCD=1
            MOVE      ALGACUID,WBSENAM
          ENDIF
          WRITE     HTMLFILE;WBSENAM;
          GOTO      ALGA9999
.
ALGA0110  MATCH     ALGAUDAT,SP70
          GOTO      ALGA9999 IF EQUAL
.
          UNPACK    ALGAUDAT,CCENT,CYEAR,CMON,CDAY
          MOVE      CMON,F2
          LOAD      MTHNAM3,F2,JAN,FEB,MAR,APR,MAY,JUN,JUL,AUG,SEP,OCT,NOV,DEC
          WRITE     HTMLFILE;CDAY,SP1,MTHNAM3,SP1,CCENT,CYEAR;
          GOTO      ALGA9999
.
ALGA0120  WRITE     HTMLFILE;ALGAUTIM;
          GOTO      ALGA9999
.
ALGA0130  MATCH     SP70,ALGAUUID
          GOTO      ALGA9999 IF EQUAL
.
          MOVE      SP70,WBSENAM
          PACK      KEY10,ALGAUUID,SP70
          CALL      RDWBSE1
          IF        OVRCD=1
            MOVE      ALGAUUID,WBSENAM
          ENDIF
          WRITE     HTMLFILE;WBSENAM;
          GOTO      ALGA9999
.
ALGA0140  PACK      KEY8,ALGAURNO,SP70
          CALL      RDMAST1
          BRANCH    OVRCD,ALGA9999
.
          CALL      PATNAM00
          WRITE     HTMLFILE;PATFNAME;
          GOTO      ALGA9999
.
ALGA0150  PACK      KEY8,ALGAREFN,SP70
          CALL      RDALREF1
          BRANCH    OVRCD,ALGA9999
.
          PACK      KEY5,ANSC,ANSG,ALREDEPT,SP70
          CALL      RDCODE1
          IF        OVRCD=1
            MOVE      ALREDEPT,TDESC
          ENDIF
          WRITE     HTMLFILE;TDESC;
          GOTO      ALGA9999
.
ALGA0160  WRITE     HTMLFILE;LISTVIEW;
          GOTO      ALGA9999
.
ALGA9999  RETURN
.
.------------------------------------------------------------
. Output group contact hcp's - allgehaf
.------------------------------------------------------------
ALGC0000  BRANCH    FLDITMNO,ALGC0010,ALGC0020,ALGC0030,ALGC0040,ALGC0050:
                             ALGC0060,ALGC0070,ALGC0080,ALGC0090,ALGC0100
.
          WRITE     HTMLFILE;"Invalid IBA Tag";
          GOTO      ALGC9999
.
ALGC0010  WRITE     HTMLFILE;ALGCCONT;
          GOTO      ALGC9999
.
ALGC0020  UNPACK    DIM127,D1,KEY1,DIM127
          MOVE      ZERO,F1
          MOVE      KEY1,F1
          BRANCH    F1,ALGC0021
.
          PACK      KEY10,ALGCHCPC,SP70
          CALL      RDPMHCP1
          BRANCH    OVRCD,ALGC9999
.
          MOVE      PMHCTITL,FMTTITLE
          MOVE      PMHCGNAM,FMTGNAME
          MOVE      PMHCSNAM,FMTSNAME
          CALL      DOCNM000
          WRITE     HTMLFILE;DOCFNAME;
          GOTO      ALGC9999
.
ALGC0021  WRITE     HTMLFILE;ALGCHCPC;
          GOTO      ALGC9999
.
ALGC0030  MOVE      "DT",CATEGORY
          MOVE      ALGCSPEC,CODE
          CALL      CODITM00
          GOTO      ALGC9999
.
ALGC0040  MOVE      "GA",CATEGORY
          MOVE      ALGCHSTA,CODE
          CALL      CODITM00
          GOTO      ALGC9999
.
ALGC0050  MATCH     ALGCCDAT,SP70
          GOTO      ALGC9999 IF EQUAL
.
          UNPACK    ALGCCDAT,CCENT,CYEAR,CMON,CDAY
          MOVE      CMON,F2
          LOAD      MTHNAM3,F2,JAN,FEB,MAR,APR,MAY,JUN,JUL,AUG,SEP,OCT,NOV,DEC
          WRITE     HTMLFILE;CDAY,SP1,MTHNAM3,SP1,CCENT,CYEAR;
          GOTO      ALGC9999
.
ALGC0060  WRITE     HTMLFILE;ALGCCTIM;
          GOTO      ALGC9999
.
ALGC0070  MATCH     SP70,ALGCCUID
          GOTO      ALGC9999 IF EQUAL
.
          MOVE      SP70,WBSENAM
          PACK      KEY10,ALGCCUID,SP70
          CALL      RDWBSE1
          IF        OVRCD=1
            MOVE      ALGCCUID,WBSENAM
          ENDIF
          WRITE     HTMLFILE;WBSENAM;
          GOTO      ALGC9999
.
ALGC0080  MATCH     ALGCUDAT,SP70
          GOTO      ALGC9999 IF EQUAL
.
          UNPACK    ALGCUDAT,CCENT,CYEAR,CMON,CDAY
          MOVE      CMON,F2
          LOAD      MTHNAM3,F2,JAN,FEB,MAR,APR,MAY,JUN,JUL,AUG,SEP,OCT,NOV,DEC
          WRITE     HTMLFILE;CDAY,SP1,MTHNAM3,SP1,CCENT,CYEAR;
          GOTO      ALGC9999
.
ALGC0090  WRITE     HTMLFILE;ALGCUTIM;
          GOTO      ALGC9999
.
ALGC0100  MATCH     SP70,ALGCUUID
          GOTO      ALGC9999 IF EQUAL
.
          MOVE      SP70,WBSENAM
          PACK      KEY10,ALGCUUID,SP70
          CALL      RDWBSE1
          IF        OVRCD=1
            MOVE      ALGCUUID,WBSENAM
          ENDIF
          WRITE     HTMLFILE;WBSENAM;
          GOTO      ALGC9999
.
ALGC9999  RETURN
.
.------------------------------------------------------------
. Output group contacts - allgreaf
.------------------------------------------------------------
ALGE0000  BRANCH    FLDITMNO,ALGE0010,ALGE0020,ALGE0030,ALGE0040,ALGE0050:
                             ALGE0060,ALGE0070,ALGE0080,ALGE0090,ALGE0100:
                             ALGE0110,ALGE0120,ALGE0130,ALGE0140,ALGE0150:
                             ALGE0160
.
          WRITE     HTMLFILE;"Invalid IBA Tag";
          GOTO      ALGE9999
.
ALGE0010  WRITE     HTMLFILE;ALGECONT;
          GOTO      ALGE9999
.
ALGE0020  WRITE     HTMLFILE;ALGESESN;
          GOTO      ALGE9999
.
ALGE0030  MOVE      "PO",CATEGORY
          MOVE      ALGELOCN,CODE
          CALL      CODITM00
          GOTO      ALGE9999
.
ALGE0040  MATCH     ALGEGDTE,SP70
          GOTO      ALGE9999 IF EQUAL
.
          UNPACK    ALGEGDTE,CCENT,CYEAR,CMON,CDAY
          MOVE      CMON,F2
          LOAD      MTHNAM3,F2,JAN,FEB,MAR,APR,MAY,JUN,JUL,AUG,SEP,OCT,NOV,DEC
          WRITE     HTMLFILE;CDAY,SP1,MTHNAM3,SP1,CCENT,CYEAR;
          GOTO      ALGE9999
.
ALGE0050  WRITE     HTMLFILE;ALGEGTIM;
          GOTO      ALGE9999
.
ALGE0060  WRITE     HTMLFILE;ALGEDURN;
          GOTO      ALGE9999
.
ALGE0070  MATCH     ALGECDAT,SP70
          GOTO      ALGE9999 IF EQUAL
.
          UNPACK    ALGECDAT,CCENT,CYEAR,CMON,CDAY
          MOVE      CMON,F2
          LOAD      MTHNAM3,F2,JAN,FEB,MAR,APR,MAY,JUN,JUL,AUG,SEP,OCT,NOV,DEC
          WRITE     HTMLFILE;CDAY,SP1,MTHNAM3,SP1,CCENT,CYEAR;
          GOTO      ALGE9999
.
ALGE0080  WRITE     HTMLFILE;ALGECTIM;
          GOTO      ALGE9999
.
ALGE0090  MATCH     SP70,ALGECUID
          GOTO      ALGE9999 IF EQUAL
.
          MOVE      SP70,WBSENAM
          PACK      KEY10,ALGECUID,SP70
          CALL      RDWBSE1
          IF        OVRCD=1
            MOVE      ALGECUID,WBSENAM
          ENDIF
          WRITE     HTMLFILE;WBSENAM;
          GOTO      ALGE9999
.
ALGE0100  MATCH     ALGEUDAT,SP70
          GOTO      ALGE9999 IF EQUAL
.
          UNPACK    ALGEUDAT,CCENT,CYEAR,CMON,CDAY
          MOVE      CMON,F2
          LOAD      MTHNAM3,F2,JAN,FEB,MAR,APR,MAY,JUN,JUL,AUG,SEP,OCT,NOV,DEC
          WRITE     HTMLFILE;CDAY,SP1,MTHNAM3,SP1,CCENT,CYEAR;
          GOTO      ALGE9999
.
ALGE0110  WRITE     HTMLFILE;ALGEUTIM;
          GOTO      ALGE9999
.
ALGE0120  MATCH     SP70,ALGEUUID
          GOTO      ALGE9999 IF EQUAL
.
          MOVE      SP70,WBSENAM
          PACK      KEY10,ALGEUUID,SP70
          CALL      RDWBSE1
          IF        OVRCD=1
            MOVE      ALGEUUID,WBSENAM
          ENDIF
          WRITE     HTMLFILE;WBSENAM;
          GOTO      ALGE9999
.
ALGE0130  CALL      ETAB0000                * Open group contacts table
          GOTO      ALGE9999
.
ALGE0140  UNPACK    ALGEGDTE,CCENT,CYEAR,CMON,CDAY
          CALL      DAYOFWEK
          LOAD      DAYNAM3,WEEKDAY,MON,TUE,WED,THU,FRI,SAT,SUN 
          WRITE     HTMLFILE;DAYNAM3;
          GOTO      ALGE9999
.
ALGE0150  WRITE     HTMLFILE;LISTVIEW;
          GOTO      ALGE9999
.
ALGE0160  BRANCH    LISTVIEW,ALGE0165
.
          CALL      OPTB0000
          GOTO      ALGE9999
.
ALGE0165  CALL      OHTB0000
          GOTO      ALGE9999
.
ALGE9999  RETURN
.
.------------------------------------------------------------
. Clear group contact session setup - allgroaf
.------------------------------------------------------------
CGRO0000  MOVE      SP70,ALGRSESN
          MOVE      SP70,ALGRNAME
          MOVE      SP70,ALGRSEST
          MOVE      SP70,ALGRLOCN
          MOVE      SP70,ALGRDAYI
          MOVE      SP70,ALGRSDAT
          MOVE      SP70,ALGRSTIM
          MOVE      SP70,ALGRDURN
          MOVE      SP70,ALGRDEPT
          MOVE      SP70,ALGRACTV
          MOVE      SP70,ALGRFREQ
          MOVE      SP70,ALGRCDAT
          MOVE      SP70,ALGRCTIM
          MOVE      SP70,ALGRCUID
          MOVE      SP70,ALGRUDAT
          MOVE      SP70,ALGRUTIM
          MOVE      SP70,ALGRUUID
          MOVE      SP70,ALGRSPAR
.
CGRO9999  RETURN
.
.------------------------------------------------------------
. Clear group contact session patients - allgrpaf
.------------------------------------------------------------
CGRP0000  MOVE      SP70,ALGPSESN
          MOVE      SP70,ALGPURNO
          MOVE      SP70,ALGPREFN
          MOVE      SP70,ALGPACTV
          MOVE      SP70,ALGPCDAT
          MOVE      SP70,ALGPCTIM
          MOVE      SP70,ALGPCUID
          MOVE      SP70,ALGPUDAT
          MOVE      SP70,ALGPUTIM
          MOVE      SP70,ALGPUUID
          MOVE      SP70,ALGPSPAR
.
CGRP9999  RETURN
.
.------------------------------------------------------------
. Clear group contact session hcp's - allgrhaf
.------------------------------------------------------------
CGRH0000  MOVE      SP70,ALGHSESN
          MOVE      SP70,ALGHHCPC
          MOVE      SP70,ALGHSPEC
          MOVE      SP70,ALGHACTV
          MOVE      SP70,ALGHCDAT
          MOVE      SP70,ALGHCTIM
          MOVE      SP70,ALGHCUID
          MOVE      SP70,ALGHUDAT
          MOVE      SP70,ALGHUTIM
          MOVE      SP70,ALGHUUID
          MOVE      SP70,ALGHSPAR
.
CGRH9999  RETURN
.
.------------------------------------------------------------
. Clear group contacts - allgreaf
.------------------------------------------------------------
CGRE0000  MOVE      SP70,ALGECONT
          MOVE      SP70,ALGESESN
          MOVE      SP70,ALGELOCN
          MOVE      SP70,ALGEGDTE
          MOVE      SP70,ALGEGTIM
          MOVE      SP70,ALGEDURN
          MOVE      SP70,ALGECDAT
          MOVE      SP70,ALGECTIM
          MOVE      SP70,ALGECUID
          MOVE      SP70,ALGEUDAT
          MOVE      SP70,ALGEUTIM
          MOVE      SP70,ALGEUUID
          MOVE      SP70,ALGESPAR
.
CGRE9999  RETURN
.
.------------------------------------------------------------
. Clear group contacts hcp's- allgehaf
.------------------------------------------------------------
CGEH0000  MOVE      SP70,ALGCCONT
          MOVE      SP70,ALGCHCPC
          MOVE      SP70,ALGCSPEC
          MOVE      SP70,ALGCHSTA
          MOVE      SP70,ALGCCDAT
          MOVE      SP70,ALGCCTIM
          MOVE      SP70,ALGCCUID
          MOVE      SP70,ALGCUDAT
          MOVE      SP70,ALGCUTIM
          MOVE      SP70,ALGCUUID
          MOVE      SP70,ALGCSPAR
.
CGEH9999  RETURN
.
.------------------------------------------------------------
. Clear group contact patients- allgpaaf
.------------------------------------------------------------
CGPA0000  MOVE      SP70,ALGACONT
          MOVE      SP70,ALGAURNO
          MOVE      SP70,ALGAREFN
          MOVE      SP70,ALGACURP
          MOVE      SP70,ALGAPSTA
          MOVE      SP70,ALGAMEAL
          MOVE      SP70,ALGAMOHX
          MOVE      SP70,ALGACDAT
          MOVE      SP70,ALGACTIM
          MOVE      SP70,ALGACUID
          MOVE      SP70,ALGAUDAT
          MOVE      SP70,ALGAUTIM
          MOVE      SP70,ALGAUUID
          MOVE      SP70,ALGARCST
          MOVE      SP70,ALGASPAR
.         
CGPA9999  RETURN  
.
.------------------------------------------------------------
. List group contact session setups - allgroaf
.------------------------------------------------------------
OTAB0000  PACK      KEY8,SP70
          CALL      RSALGRO1
OTAB1000  CALL      RKALGRO1
          BRANCH    OVRCD,OTAB9999
.
          MATCH     SP70,FLTRLOCN
          IF        !@EQUAL
            MATCH     FLTRLOCN,ALGRLOCN
            GOTO      OTAB1000 IF NOT EQUAL
          ENDIF
.
          MATCH     SP70,FLTRDEPT
          IF        !@EQUAL
            MATCH     FLTRDEPT,ALGRDEPT
            GOTO      OTAB1000 IF NOT EQUAL
          ENDIF
.
          MATCH     SP70,FLTRACTV
          IF        !@EQUAL
            MATCH     FLTRACTV,ALGRACTV
            GOTO      OTAB1000 IF NOT EQUAL
          ENDIF
.
          MATCH     SP70,FILTRDAY
          IF        !@EQUAL
            MATCH     FILTRDAY,ALGRDAYI
            GOTO      OTAB1000 IF NOT EQUAL
          ENDIF
.
          MOVE      ALGRDAYI,F1
          LOAD      DAYNAM3,F1,MON,TUE,WED,THU,FRI,SAT,SUN
.
          MOVE      SP70,DESCLOCN
          MATCH     SP70,ALGRLOCN
          IF        !@EQUAL
            PACK      KEY5,ANSP,ANSO,ALGRLOCN,SP70
            CALL      RDCODE1
            IF        OVRCD=1
              MOVE      ALGRLOCN,TDESC
            ENDIF 
            MOVE    TDESC,DESCLOCN
          ENDIF
.
          MOVE      SP70,DESCDEPT
          MATCH     SP70,ALGRDEPT
          IF        !@EQUAL
            PACK      KEY5,ANSC,ANSG,ALGRDEPT,SP70
            CALL      RDCODE1
            IF        OVRCD=1
              MOVE      ALGRDEPT,TDESC
            ENDIF   
            MOVE    TDESC,DESCDEPT
          ENDIF
.
          MOVE      SP70,DESCSEST
          MATCH     SP70,ALGRSEST     
          IF        !@EQUAL           
            PACK      KEY5,CATGY,ALGRSEST,SP70
            CALL      RDCODE1
            IF        OVRCD=1         
              MOVE      ALGRSEST,TDESC
            ENDIF                     
            MOVE    TDESC,DESCSEST    
          ENDIF  
.
          MOVE      "Inactive",DESCACTV
          MATCH     "0",ALGRACTV
          IF        @EQUAL
            MOVE      "Active",DESCACTV
          ENDIF
. 
          CLEAR     HTMLLINK
          APPEND    "javascript:UpdateSession('",HTMLLINK
          APPEND    ALGRSESN,HTMLLINK
          APPEND    "')",HTMLLINK
          RESET     HTMLLINK
.
          WRITE     HTMLFILE;"t.addRow(#"",HTMLLINK,"#",":              *0
                                      "#"",ALGRNAME,"#",":              *1
                                      "#"",ALGRSEST,"#",":              *2
                                      "#"",DESCSEST,"#",":              *3
                                      "#"",ALGRLOCN,"#",":              *4
                                      "#"",DESCLOCN,"#",":              *5
                                      "#"",ALGRDAYI,"#",":              *6
                                      "#"",DAYNAM3,"#",":               *7
                                      "#"",ALGRSDAT,"#",":              *8
                                      "#"",ALGRSTIM,"#",":              *9 
                                      "#"",ALGRSDAT,ALGRSTIM,"#",":     *10
                                      "#"",ALGRDURN,"#",":              *11
                                      "#"",DESCACTV,"#",":              *12
                                      "#"",DESCDEPT,"#",":              *13
                                      "#"",ALGRDEPT,"#");"              *14
.
          GOTO      OTAB1000
.
OTAB9999  RETURN
.
.------------------------------------------------------------
. List open group contacts - allgreaf
.------------------------------------------------------------
ETAB0000  PACK      KEY16,ALGRO001,SP70
          CALL      RSALGRE2
ETAB1000  CALL      RKALGRE2
          BRANCH    OVRCD,ETAB9999
.
          MATCH     ALGRO001,ALGESESN
          GOTO      ETAB9999 IF NOT EQUAL
.
          UNPACK    ALGEGDTE,CCENT,CYEAR,CMON,CDAY
          CALL      DAYOFWEK
          LOAD      DAYNAM3,WEEKDAY,MON,TUE,WED,THU,FRI,SAT,SUN
.
          MOVE      SP70,DESCLOCN
          MATCH     SP70,ALGRLOCN
          IF        !@EQUAL
            PACK      KEY5,ANSP,ANSO,ALGRLOCN,SP70
            CALL      RDCODE1
            IF        OVRCD=1
              MOVE      ALGRLOCN,TDESC
            ENDIF
            MOVE    TDESC,DESCLOCN
          ENDIF
.
.                                                             * start *I-186519
ETAB2000  MOVE      ZERO,F3A                * check for Patient attendance
          MOVE      ZERO,F3B
          MOVE      SP8,PATATSTA
          PACK      KEY16,ALGECONT,SP20
          CALL      RSALGPA1
ETAB2200  CALL      RKALGPA1
          BRANCH    OVRCD,ETAB2400
          MATCH     ALGECONT,ALGACONT
          GOTO      ETAB2400 IF NOT EQUAL
          ADD       ONE,F3A
          MATCH     SP3,ALGAPSTA
          GOTO      ETAB2200 IF EQUAL
          PACK      KEY5,CATGA,ALGAPSTA
          CALL      RDCODE1
          BRANCH    OVRCD,ETAB2200
          ADD       ONE,F3B                 * count Patients with valid Status
          GOTO      ETAB2200
.
ETAB2400  IF        F3B > 0
            IF        F3A = F3B
              MOVE      "Complete",PATATSTA
            ELSE
              MOVE      "Partial ",PATATSTA
            ENDIF
          ENDIF
.
ETAB3000  MOVE      ZERO,F3A                * check for HCP attendance
          MOVE      ZERO,F3B
          MOVE      SP8,HCPATSTA
          PACK      KEY21,ALGECONT,SP20
          CALL      RSALGEH1
ETAB3200  CALL      RKALGEH1
          BRANCH    OVRCD,ETAB3400
          MATCH     ALGECONT,ALGCCONT
          GOTO      ETAB3400 IF NOT EQUAL
          ADD       ONE,F3A
          MATCH     SP3,ALGCHSTA
          GOTO      ETAB3200 IF EQUAL
          CALL      RDCODE1
          BRANCH    OVRCD,ETAB3200
          ADD       ONE,F3B                 * count HCPs with valid Status
          GOTO      ETAB3200
.
ETAB3400  IF        F3B > 0
            IF        F3A = F3B
              MOVE      "Complete",HCPATSTA
            ELSE
              MOVE      "Partial ",HCPATSTA
            ENDIF
          ENDIF
.                                                             * end   *I-186519
.
ETAB4000  CLEAR     HTMLLINK
          APPEND    "javascript:UpdateSession02('",HTMLLINK
          APPEND    ALGECONT,HTMLLINK
          APPEND    "','",HTMLLINK
          APPEND    ALGESESN,HTMLLINK
          APPEND    "')",HTMLLINK
          RESET     HTMLLINK
.
          WRITE     HTMLFILE;"t.addRow(#"",HTMLLINK,"#",":              *0
                                      "#"",ALGECONT,"#",":              *1
                                      "#"",ALGESESN,"#",":              *2
                                      "#"",ALGELOCN,"#",":              *3
                                      "#"",DESCLOCN,"#",":              *4
                                      "#"",ALGEGDTE,ALGEGTIM,"#",":     *5
                                      "#"",ALGEDURN,"#",":              *6
                                      "#"",DAYNAM3,"#",":               *7
                                      "#"",PATATSTA,"#",":              *8
                                      "#"",HCPATSTA,"#");"              *9
.
          GOTO      ETAB1000
.
ETAB9999  RETURN
.
.------------------------------------------------------------
. List group contact session patients - allgrpaf
.------------------------------------------------------------
PTAB0000  PACK      KEY16,ALGRO001,SP70
          CALL      RSALGRP1
PTAB1000  CALL      RKALGRP1
          BRANCH    OVRCD,PTAB9999
.
          MATCH     ALGRO001,ALGPSESN
          GOTO      PTAB9999 IF NOT EQUAL
.  
          PACK      KEY8,ALGPURNO,SP70
          CALL      RDMAST1
          BRANCH    OVRCD,PTAB1000
.
          PACK      KEY8,ALGPURNO,SP70
          CALL      RDPMPX21
          BRANCH    OVRCD,PTAB1000
.
          PACK      AGEDATE,CCC,CYY,CMM,CDD    * Today's date
          REP       " 0",AGEDATE
          CALL      CALCAGE
          CALL      PATLN000
          CALL      PATFLD00
          MOVE      KEY3,FOLDERSF
.
          PACK      KEY8,ALGPREFN,SP70
          CALL      RDALREF1
          BRANCH    OVRCD,PTAB1000
.
          MOVE      SP70,DESCDEPT
          MATCH     SP70,ALREDEPT
          IF        !@EQUAL
            PACK      KEY5,ANSC,ANSG,ALREDEPT,SP70
            CALL      RDCODE1
            IF        OVRCD=1
              MOVE      ALREDEPT,TDESC
            ENDIF   
            MOVE    TDESC,DESCDEPT
          ENDIF
.
          MOVE      "Inactive",DESCACTV
          MOVE      "LineThrough",KEY15
          MATCH     "0",ALGPACTV
          IF        @EQUAL
            MOVE      "Active",DESCACTV
            MOVE      SP70,KEY15
          ENDIF
.
          PACK      KEY3,ALREDEPT,SP70
          CALL      RDALDEP1 
          BRANCH    OVRCD,PTAB1000
.
          PACK      HTMLLINK,SP70,SP70
          MATCH     "1",ALDESECU
          IF        @EQUAL
            MATCH     WBSEDALL,ALREDEPT
            GOTO      PTAB5000 IF NOT EQUAL
          ENDIF
.
          MATCH     "2",ALDESECU
          IF        @EQUAL
            MATCH     WBSEDALL,ALREDEPT
            GOTO      PTAB1000 IF NOT EQUAL
          ENDIF
.
          CLEAR     HTMLLINK
          APPEND    "javascript:UpdatePatient('",HTMLLINK
          APPEND    ALGPSESN,HTMLLINK
          APPEND    "','",HTMLLINK
          APPEND    ALGPREFN,HTMLLINK
          APPEND    "','",HTMLLINK
          APPEND    ALGRACTV,HTMLLINK
          APPEND    "')",HTMLLINK
          RESET     HTMLLINK
.
PTAB5000  WRITE     HTMLFILE;"t.addRow(#"",HTMLLINK,"#",":              *0
                                      "#"",FORMATNM,"#",":              *1
                                      "#"",ALGPSESN,"#",":              *2
                                      "#"",ALGPURNO,"#",":              *3
                                      "#"",ALGPREFN,"#",":              *4
                                      "#"",DESCDEPT,"#",":              *5 
                                      "#"",DESCACTV,"#",":              *6 
                                      "#"",KEY15,"#",":                 *7
                                      "#"",FOLDERSF,"#");"              *8
.
          GOTO      PTAB1000
.
PTAB9999  RETURN
.
.------------------------------------------------------------
. List group contact session hcp's - allgrhaf
.------------------------------------------------------------
HTAB0000  PACK      KEY21,ALGRO001,SP70
          CALL      RSALGRH1
HTAB1000  CALL      RKALGRH1
          BRANCH    OVRCD,HTAB9999
.
          MATCH     ALGRO001,ALGHSESN
          GOTO      HTAB9999 IF NOT EQUAL
.
          MOVE      SP70,DOCFNAME
          PACK      KEY10,ALGHHCPC,SP70
          CALL      RDPMHCP1
          IF        OVRCD=0
            MOVE      PMHCTITL,FMTTITLE
            MOVE      PMHCGNAM,FMTGNAME
            MOVE      PMHCSNAM,FMTSNAME
            CALL      DOCNM000
          ENDIF
.
          MOVE      SP70,DESCSPEC
          MATCH     SP70,ALGHSPEC
          IF        !@EQUAL
            PACK      KEY5,ANSD,ANST,ALGHSPEC,SP70
            CALL      RDCODE1
            IF        OVRCD=1
              MOVE      ALGHSPEC,TDESC
            ENDIF
            MOVE    TDESC,DESCSPEC
          ENDIF
.
          MOVE      "Inactive",DESCACTV
          MOVE      "LineThrough",KEY15
          MATCH     "0",ALGHACTV
          IF        @EQUAL
            MOVE      "Active",DESCACTV
            MOVE      SP70,KEY15
          ENDIF
.
          CLEAR     HTMLLINK
          APPEND    "javascript:UpdateHCP('",HTMLLINK
          APPEND    ALGHSESN,HTMLLINK
          APPEND    "','",HTMLLINK
          APPEND    ALGHHCPC,HTMLLINK
          APPEND    "','",HTMLLINK
          APPEND    ALGHSPEC,HTMLLINK
          APPEND    "','",HTMLLINK
          APPEND    ALGRACTV,HTMLLINK
          APPEND    "')",HTMLLINK
          RESET     HTMLLINK
.
          WRITE     HTMLFILE;"t.addRow(#"",HTMLLINK,"#",":              *0
                                      "#"",DOCFNAME,"#",":              *1
                                      "#"",DESCSPEC,"#",":              *2
                                      "#"",DESCACTV,"#",":              *3
                                      "#"",KEY15,"#");"                 *4
.
          GOTO      HTAB1000
.
HTAB9999  RETURN
.
.-------------------------------------------------------------------
. Allied health department drop down
.-------------------------------------------------------------------
DEPS0000  PACK      KEY10,USERID,SP70       * Read security id to get hospital
          CALL      RDWBSE1
          BRANCH    OVRCD,DEPS9999
.         
          PACK      PTCDKEY2,ANSC,ANSG,SP70
          CALL      RDSCODE2                      * positional read
DEPS0100  CALL      RDKCODE2                      * read a record
          BRANCH    OVRCD,DEPS9999 
.         
          MATCH     "CG",TCODE
          GOTO      DEPS9999 IF NOT EQUAL
.
          MATCH     ANSI,TCINDC3                  * Skip IP Departments
          GOTO      DEPS0100 IF EQUAL
.
          PACK      KEY3,ACODE,SP70         
          CALL      RDALDEP1                      * Read department table
          BRANCH    OVRCD,DEPS0100
.
          MATCH     "1",ALDEACTV
          GOTO      DEPS0100 IF EQUAL       * Skip Inactive
.         
          MATCH     D3,ALDEDEPT
          IF        @EQUAL
            WRITE     HTMLFILE;"<option selected value=",ALDEDEPT,">":
                               TDESC,"</option>"
          ELSE
            IF        IBCNMHOS=1
              MATCH     SP70,ALDEHOSP
              IF        !@EQUAL
                PACK      KEY13,USERID,SP70              * All hospital access
                CALL      RDMLSEC1
                IF        OVRCD=1
                  PACK      KEY13,USERID,ALDEHOSP,SP70   * This hospital access
                  CALL      RDMLSEC1
                  IF        OVRCD=1
                    MATCH     WBSEHOSP,ALDEHOSP
                    GOTO      DEPS0100 IF NOT EQUAL
                  ENDIF
                ENDIF
              ENDIF
            ENDIF
            WRITE     HTMLFILE;"<option value=",ALDEDEPT,">":
                               TDESC,"</option>"
          ENDIF                             * HPS CODE Added (KSK)
          GOTO      DEPS0100
.
DEPS9999  RETURN
.
.
.------------------------------------------------------------
. List group contact patients - allgpaaf
.------------------------------------------------------------
OPTB0000  MOVE      ZERO,RECCNT
.
          PACK      KEY16,ALGECONT,SP70
          CALL      RSALGPA1
OPTB1000  CALL      RKALGPA1
          BRANCH    OVRCD,OPTB9999
.
          MATCH     ALGECONT,ALGACONT
          GOTO      OPTB9999 IF NOT EQUAL
.
          PACK      KEY8,ALGAURNO,SP70
          CALL      RDMAST1
          BRANCH    OVRCD,OPTB1000
.
          PACK      KEY8,ALGAURNO,SP70
          CALL      RDPMPX21
          BRANCH    OVRCD,OPTB1000
.
          PACK      AGEDATE,CCC,CYY,CMM,CDD    * Today's date
          REP       " 0",AGEDATE
          CALL      CALCAGE
          CALL      PATLN000
          CALL      PATFLD00
          MOVE      KEY3,FOLDERSF
.
          PACK      KEY8,ALGAREFN,SP70
          CALL      RDALREF1
          BRANCH    OVRCD,OPTB1000
.
          MOVE      SP70,DESCDEPT
          MATCH     SP70,ALREDEPT
          IF        !@EQUAL
            PACK      KEY5,ANSC,ANSG,ALREDEPT,SP70
            CALL      RDCODE1
            IF        OVRCD=1
              MOVE      ALREDEPT,TDESC
            ENDIF
            MOVE    TDESC,DESCDEPT
          ENDIF
.
          MOVE      SP70,DESCSTAT
          MATCH     SP70,ALGAPSTA
          IF        !@EQUAL
            PACK      KEY5,ANSG,ANSA,ALGAPSTA,SP70
            CALL      RDCODE1
            IF        OVRCD=1
              MOVE      ALGAPSTA,PTCDLDES
            ENDIF
            MOVE    PTCDLDES,DESCSTAT
          ENDIF
.
          MOVE     "No",DESCMOHX
          MATCH    "1",ALGAMOHX
          IF       @EQUAL
            MOVE     "Yes",DESCMOHX
          ENDIF
.
          PACK      KEY3,ALREDEPT,SP70
          CALL      RDALDEP1
          BRANCH    OVRCD,OPTB1000
.
          PACK      HTMLLINK,SP70,SP70
          MATCH     "1",ALDESECU
          IF        @EQUAL
            MATCH     WBSEDALL,ALREDEPT
            GOTO      OPTB5000 IF NOT EQUAL
          ENDIF
.
          MATCH     "2",ALDESECU
          IF        @EQUAL
            MATCH     WBSEDALL,ALREDEPT
            GOTO      OPTB1000 IF NOT EQUAL
          ENDIF
.
          MOVE      SP70,KEY15
          MATCH     "1",ALGARCST
          IF        @EQUAL
            MOVE      "LineThrough",KEY15
          ENDIF
.
          CLEAR     HTMLLINK
          APPEND    "javascript:UpdatePatient02('",HTMLLINK
          APPEND    ALGESESN,HTMLLINK
          APPEND    "','",HTMLLINK
          APPEND    ALGACONT,HTMLLINK
          APPEND    "','",HTMLLINK
          APPEND    ALGAREFN,HTMLLINK
          APPEND    "')",HTMLLINK
          RESET     HTMLLINK
.
OPTB5000  WRITE     HTMLFILE;"t.addRow(#"",HTMLLINK,"#",":              *0
                                      "#"",FORMATNM,"#",":              *1
                                      "#"",ALGACONT,"#",":              *2
                                      "#"",ALGAURNO,"#",":              *3
                                      "#"",ALGAREFN,"#",":              *4
                                      "#"",DESCDEPT,"#",":              *5
                                      "#"",DESCSTAT,"#",":              *6
                                      "#"",DESCMOHX,"#",";              *7
.
          ADD       ONE,RECCNT
          MOVE      RECCNT,DRECCNT
          REP       " 0",DRECCNT
.
.         Meal Provided                                                 *8
          WRITE     HTMLFILE;"#"<input type='checkbox' name='pmir",DRECCNT,"'":
                             " value='",ALGACONT,ALGAREFN,"' ";
          MATCH     "1",ALGARCST
          IF        @EQUAL
            WRITE     HTMLFILE;"disabled ";
          ELSE
            WRITE     HTMLFILE;"onclick='UpdateMeal(this);' ";
          ENDIF
          MATCH     "1",ALGAMEAL
          IF        @EQUAL
            WRITE     HTMLFILE;"checked ";
          ENDIF
          WRITE     HTMLFILE;"/>#",";


.
.         Current Patient                                               *9
          WRITE     HTMLFILE;"#"<input type='checkbox' name='pmcr",DRECCNT,"'":
                             " value='",ALGACONT,ALGAREFN,"' ";
          MATCH     "1",ALGARCST
          IF        @EQUAL
            WRITE     HTMLFILE;"disabled ";
          ELSE
            WRITE     HTMLFILE;"onclick='UpdateCurp(this);' ";
          ENDIF
          MATCH     "1",ALGACURP
          IF        @EQUAL
            WRITE     HTMLFILE;"checked ";
          ENDIF
          WRITE     HTMLFILE;"/>#",";
.
          WRITE     HTMLFILE;"#"",KEY15,"#",":                         *10
                             "#"",FOLDERSF,"#");"                      *11
.
          GOTO      OPTB1000
.
OPTB9999  RETURN
.
.------------------------------------------------------------
. List group contact hcp's - allgehaf
.------------------------------------------------------------
OHTB0000  PACK      KEY21,ALGECONT,SP70
          CALL      RSALGEH1
OHTB1000  CALL      RKALGEH1
          BRANCH    OVRCD,OHTB9999
.
          MATCH     ALGECONT,ALGCCONT
          GOTO      OHTB9999 IF NOT EQUAL
.
          MOVE      SP70,DOCFNAME
          PACK      KEY10,ALGCHCPC,SP70
          CALL      RDPMHCP1
          IF        OVRCD=0
            MOVE      PMHCTITL,FMTTITLE
            MOVE      PMHCGNAM,FMTGNAME
            MOVE      PMHCSNAM,FMTSNAME
            CALL      DOCNM000
          ENDIF
.
          MOVE      SP70,DESCSPEC
          MATCH     SP70,ALGCSPEC
          IF        !@EQUAL
            PACK      KEY5,ANSD,ANST,ALGCSPEC,SP70
            CALL      RDCODE1
            IF        OVRCD=1
              MOVE      ALGCSPEC,TDESC
            ENDIF
            MOVE    TDESC,DESCSPEC
          ENDIF
.
          MOVE      SP70,DESCSTAT
          MATCH     SP70,ALGCHSTA
          IF        !@EQUAL
            PACK      KEY5,ANSG,ANSA,ALGCHSTA,SP70
            CALL      RDCODE1
            IF        OVRCD=1
              MOVE      ALGCHSTA,PTCDLDES
            ENDIF
            MOVE    PTCDLDES,DESCSTAT
          ENDIF
.
          CLEAR     HTMLLINK
          APPEND    "javascript:UpdateHCP02('",HTMLLINK
          APPEND    ALGESESN,HTMLLINK
          APPEND    "','",HTMLLINK
          APPEND    ALGCCONT,HTMLLINK
          APPEND    "','",HTMLLINK
          APPEND    ALGCHCPC,HTMLLINK
          APPEND    "','",HTMLLINK
          APPEND    ALGCSPEC,HTMLLINK
          APPEND    "')",HTMLLINK
          RESET     HTMLLINK
.
          WRITE     HTMLFILE;"t.addRow(#"",HTMLLINK,"#",":              *0
                                      "#"",DOCFNAME,"#",":              *1
                                      "#"",DESCSPEC,"#",":              *2
                                      "#"",DESCSTAT,"#");"              *3
.
          GOTO      OHTB1000
.
OHTB9999  RETURN
.
.------------------------------------------------------------
. Remote Scripting Functions
.   Required  - FUNCCODE
.             - FUNCTYPE
.               1. Validate Equipment Code
.------------------------------------------------------------
REMOTE00  BRANCH    FUNCTYPE,REMOTE10,REMOTE20
          GOTO      REMOTE90
.
REMOTE10  CALL      VALHCP00     * Return a HCP's valid specilty codes
          GOTO      REMOTE99
.
REMOTE20  CALL      UPDPAT00     * Update meals privided flag
          GOTO      REMOTE99
.
REMOTE90  CALL      XMLHED00
          WRITE     HTMLFILE;"<RETURN_VALUE TYPE=ERROR>":
                             "Invalid Validation Type":
                             "</RETURN_VALUE>"
          CALL      XMLEND00
          GOTO      REMOTE99
.
REMOTE99  RETURN
.
.
.------------------------------------------------------------
. Return the valid specialty codes for a HCP
. INPUTS:  VALDCODE - HCP Code
.------------------------------------------------------------
VALHCP00  CALL      XMLHED00
          BRANCH    EXIT,VALHCP99
.
          PACK      KEY10,VALDCODE,SP70
          CALL      RDPMHCP1
          BRANCH    OVRCD,VALHCP90
.
          MOVE      ZERO,F1
          WRITE     HTMLFILE;"<RETURN_VALUE TYPE=SIMPLE>";
.
VALHCP10  ADD       ONE,F1
          COMPARE   SIX,F1
          GOTO      VALHCP97 IF EQUAL
.
          LOAD      D3,F1,PMHCSPC1,PMHCSPC2,PMHCSPC3,PMHCSPC4,PMHCSPC5
          MATCH     SP70,D3
          GOTO      VALHCP10 IF EQUAL
.
          PACK      KEY5,ANSD,ANST,D3,SP70
          CALL      RDCODE1
          BRANCH    OVRCD,VALHCP10
.
          PACK      KEY15,TCINDC1,TCINDC2,TCINDC3,TCINDC4,TCINDC5:
                          TCINDC6,TCINDC7,TCINDC8,TCINDC9,TCINDC10:
                          TCINDC11,THCSCOD
.
          PACK      KEY20,ACODE,KEY15,SP70
.
          WRITE     HTMLFILE;KEY20,",",TDESC,"|";
.
          GOTO      VALHCP10
.
VALHCP90  WRITE     HTMLFILE;"<RETURN_VALUE TYPE=ERROR>":
                             "Invalid HCP Code - ":
                              KEY10,"</RETURN_VALUE>"
          GOTO      VALHCP98
.
VALHCP97  WRITE     HTMLFILE;"</RETURN_VALUE>"
.
VALHCP98  CALL      XMLEND00
VALHCP99  RETURN
.
.------------------------------------------------------------
. Update the meals provided flag
. INPUTS:  VALDCODE - HCP Code
.------------------------------------------------------------
UPDPAT00  CALL      XMLHED00
          BRANCH    EXIT,UPDPAT99
.
UPDPAT10  PACK      KEY16,VALDCODE,SP70
          CALL      RDALGPA1
          BRANCH    OVRCD,UPDPAT90
.
          MATCH     "1",ALGARCST
          GOTO      UPDPAT10 IF EQUAL          * Deleted
.
          MATCH     "0",UPDTTYPE
          IF        @EQUAL
            MOVE      ONE,ALGAMEAL  
          ENDIF
.
          MATCH     "1",UPDTTYPE
          IF        @EQUAL
            MOVE      ZERO,ALGAMEAL  
          ENDIF
.
          MATCH     "2",UPDTTYPE
          IF        @EQUAL
            MOVE      ONE,ALGACURP  
          ENDIF
.
          MATCH     "3",UPDTTYPE
          IF        @EQUAL
            MOVE      ZERO,ALGACURP  
          ENDIF
.
          CALL      MHINC000                     * Set MHINC extract indicator
          CALL      UPALGPA1
.
          WRITE     HTMLFILE;"<RETURN_VALUE TYPE=SIMPLE>":
                             "Update Complete":
                             "</RETURN_VALUE>"
.
UPDPAT90  WRITE     HTMLFILE;"<RETURN_VALUE TYPE=ERROR>":
                             "Invalid Patient Setup - ":
                              KEY16,"</RETURN_VALUE>"
          GOTO      UPDPAT98
.
UPDPAT98  CALL      XMLEND00
UPDPAT99  RETURN
.
.------------------------------------------------------------
. Global update patients in this group session
.------------------------------------------------------------
ALLP0000  COMPARE   FOUR,FUNCTYPE           * Global update HCP
          GOTO      ALLP5000 IF EQUAL
.
          PACK      KEY16,ALGPA001,SP70
          CALL      RSALGPA1
ALLP1000  CALL      RKALGPA1
          BRANCH    OVRCD,ALLP9999
.
          MATCH     ALGPA001,ALGACONT
          GOTO      ALLP9999 IF NOT EQUAL
.
          MATCH     "1",ALGARCST
          GOTO      ALLP1000 IF EQUAL          * Deleted
.
          IF        FUNCTYPE=1
            MOVE      ONE,ALGAMEAL
          ENDIF
.
          IF        FUNCTYPE=2
            MOVE      ZERO,ALGAMEAL
          ENDIF
.
          IF        FUNCTYPE=3
            MATCH     ALGPA005,Z70
            IF        !@EQUAL
              MATCH     ALGPA005,ALGAPSTA
              IF        !@EQUAL
                MOVE      ALGPA005,ALGAPSTA
              ENDIF
            ENDIF
          ENDIF
.
          CALL      MHINC000                     * Set MHINC extract indicator
          CALL      UPALGPA1
.
          GOTO      ALLP1000
.
ALLP5000  PACK      KEY21,ALGEH001,SP70
          CALL      RSALGEH1
ALLP5100  CALL      RKALGEH1
          BRANCH    OVRCD,ALLP9999
.
          MATCH     ALGEH001,ALGCCONT
          GOTO      ALLP9999 IF NOT EQUAL
.
          MATCH     Z70,ALGEH004
          IF        !@EQUAL
            MOVE      ALGEH004,ALGCHSTA
          ENDIF
.
          CALL      UPALGEH1
.
          GOTO      ALLP5100
.
ALLP9999  RETURN
.
.------------------------------------------------------------
. Add patient to group session master 
.------------------------------------------------------------
PSES0000  MATCH     "1",ADDMASTR
          GOTO      PSES9999 IF NOT EQUAL
.
          PACK      KEY16,ALGRP001,ALGRP003,SP70
          CALL      RDALGRP1
          COMPARE   ZERO,OVRCD
          GOTO      PSES9000 IF EQUAL
.
          MATCH     "0",ALGRP004
          IF        @EQUAL
            CALL      ACTP0000                   * Check if already active
            BRANCH    EXIT,PSES9100
          ENDIF
.
          CALL      CGRP0000                     * Clear file vars
          CALL      MGRP0000                     * Move cgi to file variables
.
          PACK      KEY8,CCC,CYY,CMM,CDD
          REP       " 0",KEY8
          MOVE      KEY8,ALGPCDAT                * System date
          CLOCK     TIME,ALGPCTIM                * System time
          MOVE      USERID,ALGPCUID              * web user id
.
          PACK      KEY16,ALGPSESN,ALGPREFN,SP70
          CALL      WRALGRP1                     * Writes the data
.
          MOVE      ZERO,EXIT
          GOTO      PSES9999
.
PSES9000  MOVE      "Setup exists in session master.",WEBTITLE
          CALL      ERRWAR00
          MOVE      ONE,EXIT
          GOTO      PSES9999
.
PSES9100  MOVE      "Patient already active in session master.",WEBTITLE
          CALL      ERRWAR00
          MOVE      ONE,EXIT
          GOTO      PSES9999
.
PSES9999  RETURN
.
.------------------------------------------------------------
. Add HCP to group session master
.------------------------------------------------------------
HSES0000  MATCH     "1",ADDMASTR
          GOTO      HSES9999 IF NOT EQUAL
.
          PACK      KEY21,ALGRH001,ALGRH002,ALGRH003,SP70
          CALL      RDALGRH1
          COMPARE   ZERO,OVRCD
          GOTO      HSES9000 IF EQUAL
.
          MATCH     "0",ALGRH004
          IF        @EQUAL
            CALL      ACTH0000                   * Check if already active
            BRANCH    EXIT,HSES9100
          ENDIF
.
          CALL      CGRH0000                     * Clear file vars
          CALL      MGRH0000                     * Move cgi to file variables
.
          PACK      KEY8,CCC,CYY,CMM,CDD
          REP       " 0",KEY8
          MOVE      KEY8,ALGHCDAT                * System date
          CLOCK     TIME,ALGHCTIM                * System time
          MOVE      USERID,ALGHCUID              * web user id
.
          PACK      KEY21,ALGHSESN,ALGHHCPC,ALGHSPEC,SP70
          CALL      WRALGRH1                     * Writes the data
.
          MOVE      ZERO,EXIT
          GOTO      HSES9999
.
HSES9000  MOVE      "Setup exists in session master.",WEBTITLE
          CALL      ERRWAR00
          MOVE      ONE,EXIT
          GOTO      HSES9999
.
HSES9100  MOVE      "HCP already active for this session master.",WEBTITLE
          CALL      ERRWAR00
          MOVE      ONE,EXIT
          GOTO      HSES9999
.
HSES9999  RETURN
.
.------------------------------------------------------------
. Refresh Parent and Close Window and alert webtitle
.------------------------------------------------------------
ERRWAR00  CALL      OPENHTML
          BRANCH    EXIT,ERRWAR99
.
          WRITE     HTMLFILE;"<script type=#"text/javascript#" ":
                             "src=#"../js/Standard.js#"></script>":
                             "<script type=#"text/javascript#" ":
                             "src=#"../js/Custom.js#"></script>":
                             "<script type=#"text/javascript#"> {":
                             "  alert(#"",WEBTITLE,"#");":
                             " if (self.name.match(/PopUpFrame/)) {":
                             "  reloadParentFrame();}":
                             " else { ":
                             "  opener.history.go(0);":
                             "  self.close(); }":
                             "}":
                             "</script>"
          CALL      CLOSHTML     * End of Document
ERRWAR99  RETURN
.------------------------------------------------------------
. MHHON000 - AH HONOS details
. Returns:   EXIT  0 = Ok to continue
.                  1 = Error
.------------------------------------------------------------
MHHON000  MATCH     SP70,UPDTTYPE      * Display
          GOTO      MHHON800 IF EQUAL
.
          MATCH     "A",UPDTTYPE       * Add New
          GOTO      MHHON100 IF EQUAL
.
          MATCH     "U",UPDTTYPE       * Update
          GOTO      MHHON200 IF EQUAL
.
          MATCH     "D",UPDTTYPE       * Delete
          GOTO      MHHON300 IF EQUAL
.
          MATCH     "R",UPDTTYPE       * Remote script
          IF        @EQUAL
            CALL      RETPRE00
            MOVE      ONE,EXIT
            GOTO      MHHON999
          ENDIF
.
.         Add Formaction
.
MHHON100  MATCH     SP70,MHHON017
          IF        !@EQUAL & !@EOS
            MATCH     MHHON006,MHHON017
            GOTO      MHHON995 IF LESS
          ENDIF
.
          PACK      KEY8,MHHON001,SP70
          CALL      RDALREF1
          IF        OVRCD=0
            MATCH     SP70,ALREDCLO
            IF        !@EQUAL & !@EOS
              REP       " 0",ALREDCLO
              MATCH     MHHON006,ALREDCLO
              GOTO      MHHON970 IF LESS
            ENDIF
          ENDIF
.
          MOVE      ZERO,FORM8
          MATCH     SP70,MHHON001
          GOTO      MHHON920 IF EQUAL
.
          PACK      KEY16,MHHON001,Z70
          CALL      RSMHHON1
MHHON110  CALL      RPMHHON1
          BRANCH    OVRCD,MHHON130
.
          MATCH     MHHON001,MHHNVISN         * same Visit Number?
          GOTO      MHHON130 IF NOT EQUAL
          MOVE      MHHNUNIQ,FORM8
.
MHHON120  ADD       ONE,FORM8                 * get Next Count value
          GOTO      MHHON140
.
MHHON130  MOVE      ONE,FORM8    
.
MHHON140  CALL      CLRHON00
          CALL      MVHON000
          MOVE      FORM8,MHHNUNIQ
          PACK      KEY16,MHHNVISN,MHHNUNIQ,SP70
.
          PACK      KEY8,MHHNVISN,SP70
          CALL      RDVISA1
          IF        OVRCD=1
            PACK      MHHNURNO,SP70
          ELSE
            PACK      MHHNURNO,PVIURNO,SP70
          ENDIF
.
          CALL      RAMHHON1
          IF        OVRCD=1
            CALL      IBACLOCK
            CLOCK     TIME,CTIMEIS
            PACK      MHHNCDTE,CCC,CYY,CMM,CDD
            REP       " 0",MHHNCDTE
            PACK      MHHNCTIM,CTIMEIS
            PACK      MHHNWEBC,USERID
.
            MATCH     "1",MHHNCOMP
            IF        @EQUAL
              PACK      MHHNWEBF,USERID        * write user id (0874266)
            ENDIF
            MATCH     "0",MHHNCOMP
            IF        @EQUAL
              PACK      MHHNWEBF,SP70          * clear user id completed
            ENDIF
.
            PACK      KEY5,CATLHP,MHHNREAS,SP70
            CALL      RDCODE1
            IF        OVRCD<>1
              MOVE      MHHNHDAT,HONSDATE
              ADD       TCFORM6,HONSDATE
              MOVE      HONSDATE,MHHNRDAT
              REP       " 0",MHHNRDAT
            ENDIF
            CALL      WRMHHON1
          ENDIF
          MOVE      ZERO,EXIT
          GOTO      MHHON999
.
.         Update Formaction
.
MHHON200  MATCH     SP70,MHHON017
          IF        !@EQUAL & !@EOS
            MATCH     MHHON006,MHHON017
            GOTO      MHHON995 IF LESS
          ENDIF
. 
          PACK      KEY8,MHHON001,SP70
          CALL      RDALREF1
          IF        OVRCD=0
            MATCH     SP70,ALREDCLO
            IF        !@EQUAL & !@EOS
              REP       " 0",ALREDCLO
              MATCH     MHHON006,ALREDCLO
              GOTO      MHHON970 IF LESS
            ENDIF
          ENDIF
.
          PACK      KEY16,MHHON001,MHHON002,SP70
          CALL      RDMHHON1
          BRANCH    OVRCD,MHHON980
.
          MOVE      MHHNCOMP,D1                * check completed flag (0874266)
.
          CALL      MVHON000
.
.--------*T0858390-Start - Check if ADOM fields need to be excluded
          MATCH     ANSY,EXCLADOM       *Exclude ADOM fields?
          IF        @EQUAL
            CALL      EXHON000          *Yes, blank out ADOM fields
          ENDIF
.--------*T0858390-End
.
          CALL      IBACLOCK
          CLOCK     TIME,CTIMEIS
          PACK      MHHNDATU,CCC,CYY,CMM,CDD
          REP       " 0",MHHNDATU
          PACK      MHHNTIMU,CTIMEIS
          PACK      MHHNWEBU,USERID
.
          MATCH     D1,MHHNCOMP
          IF        !@EQUAL
            PACK      MHHNWEBF,USERID          * write user id (0874266)
          ENDIF
          MATCH     "0",MHHNCOMP
          IF        @EQUAL
            PACK      MHHNWEBF,SP70            * clear user id completed
          ENDIF
.
          PACK      KEY5,CATLHP,MHHNREAS,SP70
          CALL      RDCODE1
          IF        OVRCD<>1
            MOVE      MHHNHDAT,HONSDATE
            ADD       TCFORM6,HONSDATE
            MOVE      HONSDATE,MHHNRDAT
            REP       " 0",MHHNRDAT
          ENDIF
          CALL      UPMHHON1
          MOVE      ZERO,EXIT
          GOTO      MHHON999
.
.         Delete Formaction
.
MHHON300  PACK      KEY16,MHHON001,MHHON002,SP70
          CALL      RDMHHON1
          BRANCH    OVRCD,MHHON980
.
          CALL      DEMHHON1
          MOVE      ZERO,EXIT
          GOTO      MHHON999
.
MHHON800  CALL      CURPER00
          CALL      CALCDT00
.
          PACK      KEY8,URNUMBER,SP70
          CALL      RDMAST1
          IF        OVRCD=1
            CALL      CLPATMAS
          ENDIF
          MOVE      PURNO,KEY8
          CALL      RDPMPX21
          IF        OVRCD=1
            CALL      CLPMSPX2
          ENDIF
.
          MOVE      ZERO,HONAVAIL
          PACK      KEY8,ADMISSNO,SP70
          CALL      RDVISA1
          BRANCH    OVRCD,MHHON807
.
          MATCH     "10",PTVITYPE
          GOTO      MHHON805 IF EQUAL
.
          COMPARE   "3",PVITYPE
          GOTO      MHHON805 IF EQUAL
.
          IF        PTCNHDPS=1
            GOTO      MHHON807
          ENDIF
.
MHHON805  MOVE      ONE,HONAVAIL
.
MHHON807  PACK      KEY32,URNUMBER,Z70
          CALL      RSMHDLS1
MHHON810  CALL      RPMHDLS1
          BRANCH    OVRCD,MHHON815
.
          MATCH     URNUMBER,MHDLURNO
          IF        @EQUAL
            MATCH     "1",MHDLACTV          * Inactive
            GOTO      MHHON810 IF EQUAL
.
            GOTO      MHHON820 
          ENDIF
.
MHHON815  CALL      CLRDLS00
.
MHHON820  PACK      KEY16,ADMISSNO,Z70
          CALL      RSMHDIA1
          CALL      RPMHDIA1
          BRANCH    OVRCD,MHHON830
          MATCH     ADMISSNO,DMHDIADM
          GOTO      MHHON840 IF EQUAL
.
MHHON830  CALL      CLMEHDIA
.
MHHON840  CALL      CLRHON00
          MOVE      ZERO,PREVHON
          PACK      KEY24,ADMISSNO,Z70
          CALL      RSMHHON3
MHHON841  CALL      RPMHHON3
          BRANCH    OVRCD,MHHON850
.
          MATCH     ADMISSNO,MHHNVISN
          GOTO      MHHON850 IF NOT EQUAL
.
          MATCH     HONOSTYP,MHHNHOTY
          GOTO      MHHON841 IF NOT EQUAL
.
          MOVE      ONE,PREVHON
.
MHHON850  CALL      CLRHON00
          MATCH     Z70,MHHON001
          IF        !@EQUAL
            PACK      KEY16,MHHON001,MHHON002,SP70
            CALL      RDMHHON1 
          ENDIF
.
.         Checks if the referral is closed
          MOVE      SP70,DATECLSD
          PACK      KEY8,ADMISSNO,SP70
          CALL      RDALREF1
          IF        OVRCD<>1
            MOVE      ALREDCLO,DATECLSD
          ELSE
            CALL    CLALLREF                * If not, clears the referrals 
            CALL    RDMISS1                 * Loads the responsible Dr
            IF      OVRCD<>1
              MOVE    ADOCTA,ALREHCP 
            ENDIF
            CALL    RDPMVX11                * Loads the Responsible Team
            IF      OVRCD<>1
              MOVE    PMVXCASE,ALREUHC4 
            ENDIF
          ENDIF
.
          CALL      PATNAM00
          CLEAR     WEBTITLE
          APPEND  "Mental Health Inpatient Outcome Measure Review List",WEBTITLE
          RESET     WEBTITLE
.
          CALL      WEBHED00
          BRANCH    EXIT,MHHON999
          CALL      WEBBOD00
          CALL      WEBEND00
          MOVE      ONE,EXIT
          GOTO      MHHON999
.
MHHON920  MOVE      "Invalid visit selected",WEBTITLE
          CALL      WEBERR00
          MOVE      ONE,EXIT
          GOTO      MHHON999
. 
MHHON970  MOVE      "HoNOS Date cannot be after Referral Close Date.",WEBTITLE
          CALL      WEBERR00
          MOVE      ONE,EXIT
          GOTO      MHHON999
.
MHHON980  MOVE      "Record does not exist",WEBTITLE
          CALL      WEBERR00
          MOVE      ONE,EXIT
          GOTO      MHHON999
.
MHHON990  MOVE      "Record already exists for this patient",WEBTITLE
          CALL      WEBERR00
          MOVE      ONE,EXIT
          GOTO      MHHON999
.
MHHON995  MOVE      "Completion Date must be equal or after Collection Date.",WEBTITLE
          CALL      WEBERR00
          MOVE      ONE,EXIT
          GOTO      MHHON999
.
MHHON999  RETURN
+
.------------------------------------------------------------
.EXHON000 - Exclude ADOM fields
.------------------------------------------------------------
EXHON000  MOVE     SP70,MHHNFOCU    *Focus of care
          MOVE     SP70,MHHNCOLS    *Collection Status
          MOVE     SP70,MHHNMODA    *Mode of Administration
          MOVE     SP70,MHHNRFMV    *Referral Mandated/Voluntary
          MOVE     SP70,MHHNCEPS    *Co-existing Problems
          MOVE     SP70,MHHNDAYS    *Number of Days Covered
.
.-------- Section 1 Scoring Fields
          MOVE     SP70,MHHNAM01    *Q1
          MOVE     SP70,MHHNAM02    *Q2
          MOVE     SP70,MHHNAM03    *Q3
          MOVE     SP70,MHHNAM04    *Q4
          MOVE     SP70,MHHNAM05    *Q5
          MOVE     SP70,MHHNAM06    *Q6
          MOVE     SP70,MHHNAM7A    *Q7b - mhhon096
          MOVE     SP70,MHHNAM7B    *Q7a - mhhon097
          MOVE     SP70,MHHNAM7C    *Q7d - mhhon098
          MOVE     SP70,MHHNAM7D    *Q7c - mhhon099
          MOVE     SP70,MHHNAM7E    *Q7f - mhhon100
          MOVE     SP70,MHHNAM7F    *Q7e - mhhon101
          MOVE     SP70,MHHNAM08    *Q8
          MOVE     SP70,MHHNAM9A    *Q9a
          MOVE     SP70,MHHNAM9B    *Q9b
          MOVE     SP70,MHHNAM9C    *Q9c
          MOVE     SP70,MHHNAM10    *Q10
          MOVE     SP70,MHHNAM11    *Q11
.
.-------- Section 2 Scoring Fields
          MOVE     SP70,MHHNAM12    *Q12
          MOVE     SP70,MHHNAM13    *Q13
          MOVE     SP70,MHHNAM14    *Q14
          MOVE     SP70,MHHNAM15    *Q15
          MOVE     SP70,MHHNAM16    *Q16
          MOVE     SP70,MHHNAM17    *Q17
          MOVE     SP70,MHHNAM18    *Q18
.
.-------- Section 3 Scoring Fields
          MOVE     SP70,MHHNAM19    *Q19
          MOVE     SP70,MHHNAM20    *Q20
.
EXHON999  RETURN
+
.------------------------------------------------------------
. Return previous honos values
.------------------------------------------------------------
RETPRE00  CALL      XMLHED00
          BRANCH    EXIT,RETPRE99
.
          CALL      CLRHON00
          PACK      KEY24,ADMISSNO,Z70
          CALL      RSMHHON3
RETPRE10  CALL      RPMHHON3
          BRANCH    OVRCD,RETPRE90
.
          MATCH     ADMISSNO,MHHNVISN
          GOTO      RETPRE90 IF NOT EQUAL
.
          MATCH     HONOSTYP,MHHNHOTY
          GOTO      RETPRE10 IF NOT EQUAL
.
          WRITE     HTMLFILE;"<RETURN_VALUE TYPE=SIMPLE>":
                            MHHNMODA,"|",MHHNADQ1,"|",MHHNADQ2,"|",MHHNADQ3,"|":
                            MHHNADQ4,"|",MHHNADQ5,"|",MHHNADQ6,"|",MHHNADQ7,"|":
                            MHHNADQ8,"|",MHHNADQ9,"|",MHHNAQ10,"|",MHHNAQ11,"|":
                            MHHNAQ12,"|",MHHNCYQ1,"|",MHHNCYQ2,"|",MHHNCYQ3,"|":
                            MHHNCYQ4,"|",MHHNCYQ5,"|",MHHNCYQ6,"|",MHHNCYQ7,"|":
                            MHHNCYQ8,"|",MHHNCYQ9,"|",MHHNCQ10,"|",MHHNCQ11,"|":
                            MHHNCQ12,"|",MHHNCQ13,"|",MHHNCQ14,"|",MHHNCQ15,"|":
                            MHHNLDQ1,"|",MHHNLDQ2,"|",MHHNLDQ3,"|",MHHNLDQ4,"|":
                            MHHNLDQ5,"|",MHHNLDQ6,"|",MHHNLDQ7,"|",MHHNLDQ8,"|":
                            MHHNLDQ9,"|",MHHNLQ10,"|",MHHNLQ11,"|",MHHNLQ12,"|":
                            MHHNLQ13,"|",MHHNLQ14,"|",MHHNLQ15,"|",MHHNLQ16,"|":
                            MHHNLQ17,"|",MHHNLQ18,"|",MHHNCULS,"|",MHHNNGOS,"|":
                            MHHNNGOA,"|",MHHNNGOW,"|",MHHNVOCA,"|",MHHNNSNG,"|":
                            MHHNSCQ1,"|",MHHNSCQ2,"|",MHHNSCQ3,"|",MHHNSCQ4,"|":
                            MHHNSCQ5,"|",MHHNSCQ6,"|",MHHNSCQ7,"|",MHHNAQ8A,"|":
                            MHHNFREE:
                            "</RETURN_VALUE>"
          GOTO      RETPRE98
.
RETPRE90  WRITE     HTMLFILE;"<RETURN_VALUE TYPE=ERROR>":
                             "No Previous HoNOS Visit exists":
                             "</RETURN_VALUE>"
          GOTO      RETPRE98
.
RETPRE98  CALL      XMLEND00
RETPRE99  RETURN
.******************************************************************************
.*            Output HONOS table                                              *
.******************************************************************************
MHTAB000  MOVE      ZERO,SUPRFLAG
          UNPACK    DIM127,D1,SUPRFLAG,DIM127
.
          MOVE      ZERO,COUNT
          PACK      KEY16,ADMISSNO,SP70
          CALL      RSMHHON1
MHTAB100  CALL      RKMHHON1
          BRANCH    OVRCD,MHTAB999
.
          MATCH     ADMISSNO,MHHNVISN
          GOTO      MHTAB999 IF NOT EQUAL
.
          MATCH     "1",SUPRFLAG
          IF        !@EQUAL
            MATCH     "1",MHHNACTV               * Only display active HONOS
            GOTO      MHTAB100 IF NOT EQUAL
          ENDIF
.
          MATCH     "1",MHHNACTV
          IF        @EQUAL
            MOVE       SP70,KEY15
          ELSE
            MOVE      "LineThrough",KEY15
          ENDIF
.
          MOVE      SP70,DOCFNAME
          MOVE      SP70,DIM50
          PACK      KEY10,MHHNPHCP,SP70
          CALL      RDPMHCP1
          IF        OVRCD=0
            MOVE      PMHCTITL,FMTTITLE
            MOVE      PMHCGNAM,FMTGNAME
            MOVE      PMHCSNAM,FMTSNAME
            CALL      DOCNM000
            MOVE      DOCFNAME,DIM50
          ENDIF
.
          MOVE      SP70,DOCFNAME
          PACK      KEY10,MHHNRHCP,SP70
          CALL      RDPMHCP1
          IF        OVRCD=0
            MOVE      PMHCTITL,FMTTITLE
            MOVE      PMHCGNAM,FMTGNAME
            MOVE      PMHCSNAM,FMTSNAME
            CALL      DOCNM000
          ENDIF
.
          MOVE      SP70,SSETDESC
          PACK      KEY5,CATLSS,MHHNSSET,SP70
          CALL      RDCODE1
          IF        OVRCD=0
            MOVE      TDESC,SSETDESC
          ENDIF
.
          MOVE      SP70,HNRCDESC                                     *I-193470
          PACK      KEY5,CATLHP,MHHNREAS,SP70
          CALL      RDCODE1
          IF        OVRCD=0
            MOVE      TDESC,HNRCDESC
          ENDIF
.
          MOVE      SP70,HNTYDESC
          PACK      KEY5,CATLHS,MHHNHOTY,SP70
          CALL      RDCODE1
          IF        OVRCD=0
            MOVE      TDESC,HNTYDESC
          ENDIF
.
          PACK      TOTSCORE,SP70
          MOVE      "003",D3            * default to adult honos
          CALL      CALADL00
          PACK      TOTDSPLY,TOTSCORE,SP70
.
          MATCH     ANSC,TCINDC1
          IF        @EQUAL
            MOVE      "005",D3          * child honos
            CALL      CALCHI00 
            PACK      TOTDSPLY,TOTSCORE,SP70
          ENDIF
          MATCH     ANSL,TCINDC1
          IF        @EQUAL
            MOVE      "007",D3          * LD honos
            CALL      CALLDI00 
            PACK      TOTDSPLY,TOTSCORE,SP70
          ENDIF
          MATCH     ANSS,TCINDC1                                      *I-260105
          IF        @EQUAL
            MOVE      "019",D3          * Secure honos
            CALL      CALSEC00                        * (in MEHHONTM) *I-260105
            PACK      TOTDSPLY,TOTSCORE,NBSP,NBSP,NBSP,NBSP,SECSCORE,SP70
          ENDIF
          MATCH     ANSM,TCINDC1
          IF        @EQUAL
            MOVE      "023",D3          * ADOM
            CALL      CALCHI00
            PACK      TOTDSPLY,TOTSCORE,SP70
          ENDIF
          MATCH     ANSI,TCINDC1
          IF        @EQUAL
            MOVE      "029",D3          * Infant
            CALL      CALCHI00
            PACK      TOTDSPLY,TOTSCORE,SP70
          ENDIF
.
          MOVE     "No",COMPSTAT
          MATCH    "1",MHHNCOMP
          IF       @EQUAL
            MOVE     "Yes",COMPSTAT
          ENDIF
.
          MOVE     "No",SENTSTAT
          MATCH    "1",MHHNSENT
          IF       @EQUAL
            MOVE     "Yes",SENTSTAT
          ENDIF
          CLEAR     HTMLLINK
          APPEND    "javascript:HONOSLink('",HTMLLINK
          APPEND    URNUMBER,HTMLLINK
          APPEND    "','",HTMLLINK
          APPEND    ADMISSNO,HTMLLINK
          APPEND    "','",HTMLLINK
          APPEND    MHHNUNIQ,HTMLLINK
          APPEND    "','",HTMLLINK
          APPEND    D3,HTMLLINK
          APPEND    "')",HTMLLINK
          RESET     HTMLLINK
.
          CLEAR     HTMLLNK2
          APPEND    "javascript:SingleGraphLink('",HTMLLNK2
          APPEND    URNUMBER,HTMLLNK2
          APPEND    "','",HTMLLNK2
          APPEND    ADMISSNO,HTMLLNK2
          APPEND    "','",HTMLLNK2
          APPEND    MHHNUNIQ,HTMLLNK2
          APPEND    "','",HTMLLNK2
          APPEND    D3,HTMLLNK2
          APPEND    "')",HTMLLNK2
          RESET     HTMLLNK2
.
          ADD       ONE,COUNT
          MOVE      COUNT,DIM3
          REP       " 0",DIM3
.
.---------T0858390-start
.---------Set HTMLLNK4 and HTMLLNK5 for mehhonaf.mhhnreas
          CALL      MREAS000
.---------T0858390-End
.
          WRITE     HTMLFILE;"t.addRow(#"",HTMLLINK,"#",":           * 0
                             "#"",MHHNHDAT,"#",":                    * 1
                             "#"",SSETDESC,"#",":                    * 2
                             "#"",HNTYDESC,"#",":                    * 3
                             "#"",DOCFNAME,"#",":                    * 4
                             "#"",SENTSTAT,"#",":                    * 5
                             "#"",COMPSTAT,"#",":                    * 6
                             "#"",HTMLLNK2,"#",":                    * 7
                             "#"<input type=checkbox name=prc",DIM3:
                             " value='",MHHNVISN,MHHNUNIQ,"' onclick=setType(":
                             "this,'",D3,"');":
                             ">#",":                                 * 8
                             "#"",D3,"#",":                          * 9
                             "#"",KEY15,"#",":                       * 10
                             "#"",TOTDSPLY,"#",":                    * 11
                             "#"",HNRCDESC,"#",":                    * 12
                             "#"",DIM50,"#",":                       * 13
                             "#"",HTMLLNK4,"#",":                    * 14
                             "#"",HTMLLNK5,"#"":                     * 15
                             ");"
          GOTO      MHTAB100
.
MHTAB999  RETURN
+
.-----------------------------------------------------------------------------.
.  Assessments for Referrals
.-----------------------------------------------------------------------------.
ASSREF00  PACK      KEY13,ALREDEPT,ALADS003,SP70
          CALL      RDALATS1
          IF        OVRCD=0
            MOVE     ALATNAME,TEMPLATE
            MOVE     ALATREMD,REMNDAYS
          ENDIF
.
          RESET     UPDTTYPE
          MATCH     SP70,UPDTTYPE
          GOTO      ASSREF80 IF EQUAL
.
          MATCH     "U",UPDTTYPE            * Update
          GOTO      ASSREF10 IF EQUAL
.
          MATCH     "A",UPDTTYPE            * Add
          GOTO      ASSREF20 IF EQUAL
.
          MATCH     "D",UPDTTYPE            * Delete
          GOTO      ASSREF30 IF EQUAL
.
          GOTO      ASSREF90
.
ASSREF10  PACK      KEY16,ALADS001,ALADS002,SP70
          CALL      RDALADS1
          BRANCH    OVRCD,ASSREF20
.
          MOVE      TWO,AUDTTYPE            * before history record
          CALL      WAALAD00
.
          CALL      MVALAD00
.
          PACK      ALADUDAT,CCC,CYY,CMM,CDD
          REP       " 0",ALADUDAT
          CLOCK     TIME,ALADUTIM
          MOVE      USERID,ALADUUID
.
          CALL      UPALADS1
.
          MOVE      THREE,AUDTTYPE          * after history record
          CALL      WAALAD00
.
          MOVE      ZERO,EXIT
          GOTO      ASSREF99
.
ASSREF20  MOVE      ZERO,F8
          PACK      KEY16,ALADS001,Z70
          CALL      RSALADS1
          CALL      RPALADS1
          BRANCH    OVRCD,ASSREF21
.
          MATCH     ALADS001,ALADREFN
          GOTO      ASSREF21 IF NOT EQUAL
.
          MOVE      ALADANUM,F8
.
ASSREF21  CALL      CLALAD00
.
          ADD       ONE,F8
.
          CALL      MVALAD00                * move in the cgi-para
          MOVE      F8,ALADANUM
.
          PACK      ALADCDAT,CCC,CYY,CMM,CDD
          REP       " 0",ALADCDAT
          CLOCK     TIME,ALADCTIM
          MOVE      USERID,ALADCUID
.
          PACK      ALADUDAT,SP70
          PACK      ALADUTIM,SP70
          PACK      ALADUUID,SP70
.
          PACK      KEY16,ALADREFN,ALADANUM,SP70
          CALL      RAALADS1
          COMPARE   ONE,OVRCD
          GOTO      ASSREF21 IF NOT EQUAL
.
          CALL      WRALADS1                * write assessment for referral
.
          MOVE      ONE,AUDTTYPE            * write history record
          CALL      WAALAD00
.
          MOVE      ZERO,EXIT
          GOTO      ASSREF99
.
ASSREF30  PACK      KEY16,ALADS001,ALADS002,SP70
          CALL      RDALADS1
          BRANCH    OVRCD,ASSREF93
.
          CALL      DEALADS1                * Delete assessment for referral
.
          MOVE      FOUR,AUDTTYPE            * delete history record
          CALL      WAALAD00
.
          MOVE      ZERO,EXIT
          GOTO      ASSREF99
.
ASSREF80  CALL      CURPER00              * Display Routine
          CALL      CALCDT00              * Calculate Next and Last Period Dates
.
          PACK      KEY8,URNUMBER,SP70      * Patient Referral Details
          CALL      RDMAST1
          BRANCH    OVRCD,ASSREF91
.
          MOVE      PURNO,KEY8
          CALL      RDPMPX21
          BRANCH    OVRCD,ASSREF91
.
          PACK      KEY8,ADMISSNO,SP70      * Patient Referral Details
          CALL      RDALREF1
          BRANCH    OVRCD,ASSREF92
.
          PACK      KEY8,ADMISSNO,SP70      * Patient Referral Details
          CALL      RDVISA1
          IF        OVRCD=1
            CALL      CLPATVIS
          ENDIF
.
          PACK      KEY16,ADMISSNO,ALADS002,SP70
          CALL      RDALADS1
          IF        OVRCD=1
            CALL      CLALAD00
          ENDIF
.
          MOVE      ALADS003,ASSMTYPE
.
          PACK      KEY3,ALREDEPT,SP70
          CALL      RDALDEP1                      * Read department table
          BRANCH    OVRCD,ASSREF94
.
ASSREF85  CLEAR     WEBTITLE
          MOVE      "Allied Health Assessments for Referrals",WEBTITLE
          RESET     WEBTITLE
.
          CALL      WEBHED00   * Create Output File and Write HTML Page Header
          BRANCH    EXIT,ASSREF99
          CALL      WEBBOD00   * Process Web Body (calls PROFLD00)
          CALL      WEBEND00   * Process End of HTML File
.
          MOVE      ONE,EXIT
          GOTO      ASSREF99
.
ASSREF90  MOVE      "Invalid Update Type.",WEBTITLE
          CALL      WEBERR00
          MOVE      ONE,EXIT
          GOTO      ASSREF99
.
ASSREF91  MOVE      "Invalid Patient U/R.",WEBTITLE
          CALL      WEBERR00
          MOVE      ONE,EXIT
          GOTO      ASSREF99
.
ASSREF92  MOVE      "Invalid Referral.",WEBTITLE
          CALL      WEBERR00
          MOVE      ONE,EXIT
          GOTO      ASSREF99
.
ASSREF93  MOVE      "Invalid Assessment for Referral.",WEBTITLE
          CALL      WEBERR00
          MOVE      ONE,EXIT
          GOTO      ASSREF99
.
ASSREF94  MOVE      "Invalid Department.",WEBTITLE
          CALL      WEBERR00
          MOVE      ONE,EXIT
          GOTO      ASSREF99
.
ASSREF99  RETURN
+
.-----------------------------------------------------------------------------.
. List Assessments 
.-----------------------------------------------------------------------------.
ASTB0000  PACK      KEY16,ADMISSNO,Z70 
          CALL      RSALADS1
ASTB1000  CALL      RPALADS1
          BRANCH    OVRCD,ASTB9999           
.
          MATCH     ADMISSNO,ALADREFN
          GOTO      ASTB9999 IF NOT EQUAL
.
          PACK      KEY8,ALADREFN,SP70
          CALL      RDALREF1
          BRANCH    OVRCD,ASTB1000
.
          CLEAR     HTMLLINK
          APPEND    "javascript:",HTMLLINK
          APPEND    "AssRefLink('",HTMLLINK
          APPEND    ALADREFN,HTMLLINK
          APPEND    "','",HTMLLINK
          APPEND    ALADANUM,HTMLLINK
          APPEND    "','",HTMLLINK
          APPEND    ALADTYPE,HTMLLINK
          APPEND    "')",HTMLLINK
          RESET     HTMLLINK
.
          MATCH     "1",ALADACTV
          IF        @EQUAL
            MOVE      "Yes",DIM3
          ELSE
            MOVE      "No ",DIM3
          ENDIF
.
          MATCH     "1",ALADCOMP
          IF        @EQUAL
            MOVE      "Yes",COMPDESC
          ELSE
            MOVE      "No ",COMPDESC
          ENDIF
.
          MOVE      SP70,OUTCOMEC
          MATCH     SP70,ALADOUTC
          IF        !@EQUAL
            PACK      KEY5,ANSO,ANSZ,ALADOUTC
            CALL      RDCODE1
            IF        OVRCD<>1
              MOVE      TDESC,OUTCOMEC
            ENDIF
          ENDIF
.
          CALL      GHCP0000                * Get hcp name
          CALL      GASST000                * Get assessment type desc
.
          WRITE     HTMLFILE;"t.addRow(#"",HTMLLINK,"#",":          * 0
                             "#"",ALADANUM,"#",":                   * 1
                             "#"",ALADCOLD,"#",":                   * 2
                             "#"",ASSTDESC,"#",":                   * 3
                             "#"",PHCPDESC,"#",":                   * 4
                             "#"",DIM3,"#",":                       * 5
                             "#"",COMPDESC,"#",":                   * 6
                             "#"",OUTCOMEC,"#"":                    * 7
                             ");"
          GOTO      ASTB1000
.
ASTB9999  RETURN
+
.******************************************************************************
.* Get hcp name                                                               *
.******************************************************************************
GHCP0000  MOVE      SP70,PHCPDESC
          PACK      KEY10,ALADHCP1,SP70
          CALL      RDPMHCP1
          IF        OVRCD=1
            MOVE      ALADHCP1,PHCPDESC
            GOTO      GHCP9999
          ENDIF
          MOVE      PMHCTITL,FMTTITLE
          MOVE      PMHCGNAM,FMTGNAME
          MOVE      PMHCSNAM,FMTSNAME
          CALL      DOCNM000
          MOVE      DOCFNAME,PHCPDESC
GHCP9999  RETURN
+
.******************************************************************************
.* Get assessment type description                                            *
.******************************************************************************
GASST000  PACK      KEY13,ALADDEPT,ALADTYPE,SP70
          CALL      RDALATS1
          IF        OVRCD<>1
            MOVE      ALATDESC,ASSTDESC
          ELSE
            MOVE      SP70,ASSTDESC
          ENDIF
GASST999  RETURN
+
.------------------------------------------------------------------------------
. General tags
.------------------------------------------------------------------------------
TABL0000  BRANCH    FLDITMNO,TABL0010,TABL0020,TABL0030,TABL0040,TABL0050:
                             TABL0060
.
          WRITE     HTMLFILE;"Invalid IBA Tag";
          GOTO      TABL9999
.
TABL0010  CALL      ASTB0000                * Assessment List
          GOTO      TABL9999
.
TABL0020  CALL      ATSL0000                * Assessment Type Selection List
          GOTO      TABL9999
.
TABL0030  WRITE     HTMLFILE;REMNDAYS;      * Assessment Type Reminder Days
          GOTO      TABL9999
.
TABL0040  PACK      KEY8,ADMISSNO,SP70
          CALL      RDVISA1
          BRANCH    OVRCD,TABL9999
.
          MATCH     " 3",PTVITYPE
          GOTO      TABL9999 IF NOT EQUAL   * Visit Type is Not Inpatient
.
          CALL      RDMISS1                 * Admission Details
          BRANCH    OVRCD,TABL9999
.
          WRITE     HTMLFILE;ADATE;         * Admission Date
          GOTO      TABL9999
.
TABL0050  PACK      KEY8,ADMISSNO,SP70
          CALL      RDVISA1
          BRANCH    OVRCD,TABL9999
.
          MATCH     " 3",PTVITYPE
          GOTO      TABL9999 IF NOT EQUAL   * Visit Type is Not Inpatient
.
          CALL      RDDSCH1                 * Discharge Details
          BRANCH    OVRCD,TABL9999
.
          WRITE     HTMLFILE;DDATE;         * Discharge Date 
          GOTO      TABL9999
.
TABL0060  PACK      KEY8,ADMISSNO,SP70
          CALL      RDVISA1
          BRANCH    OVRCD,TABL9999
.
          WRITE     HTMLFILE;PTVITYPE; 
          GOTO      TABL9999
.
TABL9999  RETURN
+
.-------------------------------------------------------------------
. Assessment Type: 0=Desc, 1=Code, 2= Selection List for Dept
.-------------------------------------------------------------------
ATSL0000  CALL      IBACLOCK
          PACK      CURRDATE,CCC,CYY,CMM,CDD
          REP       " 0",CURRDATE
.
          UNPACK    DIM127,D1,KEY1,DIM127
          MOVE      ZERO,F1
          MOVE      KEY1,F1
          BRANCH    F1,ATSL0100,ATSL0200
.
          MOVE      SP70,ALATDESC
          PACK      KEY13,ALDEDEPT,ASSMTYPE,SP70
          CALL      RDALATS1
          WRITE     HTMLFILE;ALATDESC;
          GOTO      ATSL9999
.
ATSL0100  MOVE      SP70,ALATTYPE
          PACK      KEY13,ALDEDEPT,ASSMTYPE,SP70
          CALL      RDALATS1
          WRITE     HTMLFILE;ALATTYPE;
          GOTO      ATSL9999
.
ATSL0200  PACK      KEY13,ALDEDEPT,SP70
          CALL      RSALATS1                * positional read
ATSL0250  CALL      RKALATS1                * read a record
          BRANCH    OVRCD,ATSL9999
.         
          MATCH     ALDEDEPT,ALATDEPT
          GOTO      ATSL0250 IF NOT EQUAL   * same dept?
.
          MATCH     "1",ALATACTV
          GOTO      ATSL0250 IF NOT EQUAL   * Skip Inactive
.
          MATCH     ALATCDTE,CURRDATE       * current date < commencement date?
          GOTO      ATSL0250 IF LESS
.
          MATCH     SP70,ALATFDTE
          IF        !@EQUAL
            MATCH     CURRDATE,ALATFDTE     * finish date < current date?
            GOTO      ATSL0250 IF LESS
          ENDIF
.
          WRITE     HTMLFILE;"<option value=",ALATTYPE,">":
                             ALATDESC,"</option>";
          GOTO      ATSL0250
.
ATSL9999  RETURN
+
.-----------------------------------------------------------------------------.
.          Format Date
.-----------------------------------------------------------------------------.
ALLDAT00  MOVE      SP70,FBOKDATE
.
          MATCH     PRTPDATE,SP70
          IF        @EQUAL
            MOVE     "&nbsp",FBOKDATE
            GOTO     ALLDAT99
          ENDIF
          UNPACK    PRTPDATE,CCENT,CYEAR,CMON,CDAY
          MOVE      CMON,F2
          LOAD      MTHNAM3,F2,JAN,FEB,MAR,APR,MAY,JUN,JUL,AUG,SEP,OCT,NOV,DEC
          PACK      FBOKDATE,CDAY,SP1,MTHNAM3,SP1,CCENT,CYEAR
.
ALLDAT99  RETURN
.
.-----------------------------------------------------------------------------.
. Next Day, Week, Month                                                       .
.-----------------------------------------------------------------------------.
NEXT0000  MOVE      TEMPLATE,F3
          MOVE      F3,KEY3
          REP       " 0",KEY3
          MOVE      REPORTNO,F2
          MOVE      F2,KEY2
          REP       " 0",KEY2
          REP       " +",DEPTCODE
          REP       " +",DOCTCODE
          REP       " +",CASETEAM
          REP       " +",VIEWTYPE
          REP       " +",OMEASURE
.
          WRITE     HTMLFILE;"allweb06.pbl":
                             "?reportno=",KEY2:
                             "&template=",KEY3:
                             "&frstdate=",NXTFDATE:
                             "&lastdate=",NXTLDATE:
                             "&viewtype=",VIEWTYPE:
                             "&deptcode=",DEPTCODE:
                             "&doctcode=",DOCTCODE:
                             "&caseteam=",CASETEAM:
                             "&omeasure=",OMEASURE:
                             "&honfiltr=",HONFILTR:
                             "&filtstat=",FILTSTAT:
                             "&deftflag=1";
.
          REP       "+ ",DEPTCODE
          REP       "+ ",DOCTCODE    
          REP       "+ ",CASETEAM    
          REP       "+ ",VIEWTYPE
          REP       "+ ",OMEASURE
.
NEXT9999  RETURN
.
.-----------------------------------------------------------------------------.
. Previous Day, Week, Month                                                   .
.-----------------------------------------------------------------------------.
PREV0000  MOVE      TEMPLATE,F3
          MOVE      F3,KEY3
          REP       " 0",KEY3
          MOVE      REPORTNO,F2
          MOVE      F2,KEY2
          REP       " 0",KEY2
          REP       " +",DEPTCODE
          REP       " +",DOCTCODE
          REP       " +",CASETEAM
          REP       " +",VIEWTYPE
          REP       " +",OMEASURE
.
          WRITE     HTMLFILE;"allweb06.pbl":
                             "?reportno=",KEY2:
                             "&template=",KEY3:
                             "&frstdate=",PREFDATE:
                             "&lastdate=",PRELDATE:
                             "&viewtype=",VIEWTYPE:
                             "&deptcode=",DEPTCODE:
                             "&doctcode=",DOCTCODE:
                             "&caseteam=",CASETEAM:
                             "&omeasure=",OMEASURE:
                             "&honfiltr=",HONFILTR:
                             "&filtstat=",FILTSTAT:
                             "&deftflag=1";
.
          REP       "+ ",DEPTCODE
          REP       "+ ",DOCTCODE 
          REP       "+ ",CASETEAM 
          REP       "+ ",VIEWTYPE
          REP       "+ ",OMEASURE
.
PREV9999  RETURN
.
.******************************************************************************
.              Link to Next Group of Patients                                 .
.******************************************************************************
NXTGRP00  MOVE      NORECORD,KEY2
          REP       " +",KEY2
          ASSIGN    STARTNUM+NORECORD,F3
          MOVE      F3,KEY3
          REP       " +",KEY3
          UNPACK    DIM127,D1,FLDPARA,DIM127
          MOVE      REPORTNO,F1
.
          REP       " +",DEPTCODE
          REP       " +",DOCTCODE
          REP       " +",CASETEAM
          REP       " +",LASTDATE
          REP       " +",VIEWTYPE
          REP       " +",OMEASURE
.
          WRITE     HTMLFILE;"allweb06.pbl":
                                 "?reportno=",F1:
                                 "&template=",FLDPARA:
                                 "&startnum=",KEY3:
                                 "&norecord=",KEY2:
                                 "&deptcode=",DEPTCODE:
                                 "&doctcode=",DOCTCODE:
                                 "&caseteam=",CASETEAM:
                                 "&lastdate=",LASTDATE:
                                 "&viewtype=",VIEWTYPE:
                                 "&omeasure=",OMEASURE:
                                 "&honfiltr=",HONFILTR:
                                 "&filtstat=",FILTSTAT:
                                 "&deftflag=1";
.
          REP       "+ ",DEPTCODE
          REP       "+ ",DOCTCODE
          REP       "+ ",CASETEAM
          REP       "+ ",LASTDATE
          REP       "+ ",VIEWTYPE
          REP       "+ ",OMEASURE
.
NXTGRP99  RETURN
.
.******************************************************************************
.               Link to Previous Group                                        .
.******************************************************************************
PRVGRP00  MOVE      NORECORD,KEY2
          REP       " +",KEY2
          ASSIGN    STARTNUM-NORECORD,F3
          IF        F3<0
            MOVE      ZERO,F3
          ENDIF
          MOVE      F3,KEY3
          REP       " +",KEY3
          UNPACK    DIM127,D1,FLDPARA,DIM127
          MOVE      REPORTNO,F1
          REP       " +",DEPTCODE
          REP       " +",DOCTCODE
          REP       " +",CASETEAM
          REP       " +",LASTDATE
          REP       " +",VIEWTYPE
          REP       " +",OMEASURE
.
          WRITE     HTMLFILE;"allweb06.pbl":
                                 "?reportno=",F1:
                                 "&template=",FLDPARA:
                                 "&startnum=",KEY3:
                                 "&norecord=",KEY2:
                                 "&deptcode=",DEPTCODE:
                                 "&doctcode=",DOCTCODE:
                                 "&caseteam=",CASETEAM:
                                 "&viewtype=",VIEWTYPE:
                                 "&lastdate=",LASTDATE:
                                 "&omeasure=",OMEASURE:
                                 "&honfiltr=",HONFILTR:
                                 "&filtstat=",FILTSTAT:
                                 "&deftflag=1";
.
          REP       "+ ",DEPTCODE
          REP       "+ ",DOCTCODE
          REP       "+ ",CASETEAM
          REP       "+ ",LASTDATE
          REP       "+ ",VIEWTYPE
          REP       "+ ",OMEASURE
.
PRVGRP99  RETURN
+
.-----------------------------------------------------------------------------.
. Next Day, Week, Month                                                       .
.-----------------------------------------------------------------------------.
NEXTA000  MOVE      TEMPLATE,F3
          MOVE      F3,KEY3
          REP       " 0",KEY3
          MOVE      REPORTNO,F2
          MOVE      F2,KEY2
          REP       " 0",KEY2
          REP       " +",FILTOPTN
          REP       " +",FILTWARD
.
          WRITE     HTMLFILE;"allweb06.pbl":
                             "?reportno=",KEY2:
                             "&template=",KEY3:
                             "&frstdate=",NXTFDATE:
                             "&lastdate=",NXTLDATE:
                             "&viewtype=",VIEWTYPE:
                             "&filtoptn=",FILTOPTN:
                             "&filtward=",FILTWARD:
                             "&filtstat=",FILTSTAT:
                             "&showflag=0";
.
          REP       "+ ",FILTOPTN
          REP       "+ ",FILTWARD
          REP       "+ ",SHOWFLAG
.
NEXTA999  RETURN
.
.-----------------------------------------------------------------------------.
. Previous Day, Week, Month                                                   .
.-----------------------------------------------------------------------------.
PREVA000  MOVE      TEMPLATE,F3
          MOVE      F3,KEY3
          REP       " 0",KEY3
          MOVE      REPORTNO,F2
          MOVE      F2,KEY2
          REP       " 0",KEY2
          REP       " +",FILTOPTN
          REP       " +",FILTWARD
.
          WRITE     HTMLFILE;"allweb06.pbl":
                             "?reportno=",KEY2:
                             "&template=",KEY3:
                             "&frstdate=",PREFDATE:
                             "&lastdate=",PRELDATE:
                             "&viewtype=",VIEWTYPE:
                             "&filtoptn=",FILTOPTN:
                             "&filtward=",FILTWARD:
                             "&filtstat=",FILTSTAT:
                             "&showflag=0";
.
          REP       "+ ",FILTOPTN
          REP       "+ ",FILTWARD
          REP       "+ ",SHOWFLAG
.
PREVA999  RETURN
+
.******************************************************************************
.         MHINC - Check for MH Department and Primary Ref.
.******************************************************************************
MHINC000  PACK      KEY8,ALGAREFN,SP70
          CALL      RDALREF1
          BRANCH    OVRCD,MHINC999
.
          PACK      KEY5,ANSC,ANSG,ALREDEPT,SP70
          CALL      RDCODE1
          BRANCH    OVRCD,MHINC999
.
          MATCH     "M",TCINDC4
          GOTO      MHINC999 IF NOT EQUAL    * Not a Mental Health department
.
          MATCH     "1",ALREUYN4
          GOTO      MHINC999 IF NOT EQUAL    * Not Primary Referral
.
          MATCH     "1",ALGARCST             * deleting record?
          GOTO      MHINC600 IF EQUAL
.
          MATCH     "3",ALGAMOHX             * send update?
          GOTO      MHINC999 IF EQUAL
          MATCH     "1",ALGAMOHX             * already sent?
          GOTO      MHINC400 IF EQUAL
.
          MOVE      "0",ALGAMOHX             * Unsent
          GOTO      MHINC999
.
MHINC400  MOVE      "3",ALGAMOHX             * Send Update
          GOTO      MHINC999
.
MHINC600  MOVE      "2",ALGAMOHX             * set to 'Send Delete'
          GOTO      MHINC999
.
MHINC999  RETURN
+
.******************************************************************************
. Activate a waiting AH referral
.******************************************************************************
AREF0000  MATCH     SP70,REFNUMBR                 * Blank referral number
          GOTO      AREF9999 IF EQUAL
.
          PACK      KEY8,REFNUMBR,SP70
          CALL      RDALREF1
          BRANCH    OVRCD,AREF9999
.
          MATCH     "0",ALRESTAT                  * Exit if not waiting
          GOTO      AREF9999 IF NOT EQUAL
.
          PACK      KEY8,ALREURNO,SP70
          CALL      RDMAST1                       * Read PMI details for
          BRANCH    OVRCD,AREF9999                * HL7 messsage
.
          PACK      KEY8,ALREURNO,SP70
          CALL      RDPMPX21
          BRANCH    OVRCD,AREF9999
.
          MOVE      TWO,AUDTTYPE                  * before history record
          CALL      WAALRE00
.
          PACK      ALREUDAT,CCC,CYY,CMM,CDD
          REP       " 0",ALREUDAT
          CLOCK     TIME,ALREUTIM
          MOVE      USERID,ALREUUID
          PACK      ALREDACT,CCC,CYY,CMM,CDD
          REP       " 0",ALREDACT
          MOVE      ONE,ALRESTAT         * Activate referral
          MOVE      ALREDACT,ALSTSDAT    * write to Referral History Table
.
          MOVE      ALREDACT,BOOKDATE
          CALL      CALX0000             * calculate expiry date
.
          CALL      ARMHI000             * Set MHINC indicator
          CALL      UPALREF1
.
          CALL      PMIGTNID             * get national id for dgate write
          MOVE      NMPNUMB,PTNINMPI
          MOVE      ONE,HL7TRGID
          MOVE      SP8,HL7INCLD
          CALL      DGCLII13             * broadcast Update Ref. (REF^I13)
.
          MOVE      THREE,AUDTTYPE       * after history record
          CALL      WAALRE00
          CALL      WRTRSH00             * write a record to allstsaf
.
AREF9999  RETURN
+
.------------------------------------------------------------
. Calculate referral expiry date if required
.------------------------------------------------------------
CALX0000  MATCH     SP70,ALRERTYP           * No referral type
          GOTO      CALX9999 IF EQUAL
.
          MATCH     SP70,BOOKDATE           * No booking date
          GOTO      CALX9999 IF EQUAL
.
          PACK      KEY5,ANSR,ANSI,ALRERTYP,SP70
          CALL      RDCODE1
          BRANCH    OVRCD,CALX9999
.
          COMPARE   ZERO,TCFORM6            * No days for expiry warning
          GOTO      CALX9999 IF EQUAL
.
          MOVE      BOOKDATE,EXPRDATE
          ADD       TCFORM6,EXPRDATE
          MOVE      EXPRDATE,ALREREXP
.
CALX9999  RETURN
+
.******************************************************************************
.      write a record to the Referral Status History Table
.******************************************************************************
WRTRSH00  MOVE      ALREVISN,ALSTVISN       * Populate all the fields and write
          MOVE      ALRESTAT,ALSTSTAT
          PACK      ALSTCDAT,CCC,CYY,CMM,CDD
          REP       " 0",ALSTCDAT
          CLOCK     TIME,ALSTCTIM
          MOVE      WBSEUID,ALSTCUID
          PACK      KEY17,ALSTVISN,ALSTSTAT,ALSTSDAT,SP70
          CALL      RAALSTS1
          IF        OVRCD=0
            CALL      UPALSTS1                * update to the file
          ELSE
            CALL      WRALSTS1                * write to the file
          ENDIF
.
WRTRSH99  RETURN
+
.******************************************************************************
.         MHINC - MH Department and Primary Ref.
.******************************************************************************
ARMHI000  PACK      KEY5,ANSC,ANSG,ALREDEPT,SP70
          CALL      RDCODE1
          BRANCH    OVRCD,ARMHI999
.
          MATCH     "M",TCINDC4
          GOTO      ARMHI999 IF NOT EQUAL      * Not a Mental Health department
.
          MATCH     "1",ALREUYN4
          GOTO      ARMHI999 IF NOT EQUAL      * Not Primary Referral
.
          MOVE      "0",ALREMOHR               * Unsent
.
ARMHI999  RETURN
+
.******************************************************************************
.*            Output HONOS table UR Based                                     *
.******************************************************************************
MHUTB000  MOVE      ZERO,SUPRFLAG
          UNPACK    DIM127,D1,SUPRFLAG,DIM127
.
          MOVE      ZERO,COUNT
          PACK      KEY24,URNUMBER,SP70
          CALL      RSMHHON4
MHUTB100  CALL      RKMHHON4
          BRANCH    OVRCD,MHUTB999
.
          MATCH     URNUMBER,MHHNURNO
          GOTO      MHUTB999 IF NOT EQUAL
.
          MATCH     "1",SUPRFLAG
          IF        !@EQUAL
            MATCH     "1",MHHNACTV               * Only display active HONOS
            GOTO      MHUTB100 IF NOT EQUAL
          ENDIF
.
          MATCH     "1",MHHNACTV
          IF        @EQUAL
            MOVE       SP70,KEY15
          ELSE
            MOVE      "LineThrough",KEY15
          ENDIF
.
          MOVE      SP70,DOCFNAME
          MOVE      SP70,DIM50
          PACK      KEY10,MHHNPHCP,SP70
          CALL      RDPMHCP1
          IF        OVRCD=0
            MOVE      PMHCTITL,FMTTITLE
            MOVE      PMHCGNAM,FMTGNAME
            MOVE      PMHCSNAM,FMTSNAME
            CALL      DOCNM000
            MOVE      DOCFNAME,DIM50
          ENDIF
.
          MOVE      SP70,DOCFNAME
          PACK      KEY10,MHHNRHCP,SP70
          CALL      RDPMHCP1
          IF        OVRCD=0
            MOVE      PMHCTITL,FMTTITLE
            MOVE      PMHCGNAM,FMTGNAME
            MOVE      PMHCSNAM,FMTSNAME
            CALL      DOCNM000
          ENDIF
.
          MOVE      SP70,SSETDESC
          PACK      KEY5,CATLSS,MHHNSSET,SP70
          CALL      RDCODE1
          IF        OVRCD=0
            MOVE      TDESC,SSETDESC
          ENDIF
.
          MOVE      SP70,HNRCDESC                                     *I-193470
          PACK      KEY5,CATLHP,MHHNREAS,SP70
          CALL      RDCODE1
          IF        OVRCD=0
            MOVE      TDESC,HNRCDESC
          ENDIF
.
          MOVE      SP70,HNTYDESC
          MOVE      SP70,HONOSTY1
          PACK      KEY5,CATLHS,MHHNHOTY,SP70
          CALL      RDCODE1
          IF        OVRCD=0
            MOVE      TDESC,HNTYDESC
            MOVE      TCINDC1,HONOSTY1
          ENDIF
.
          PACK      TOTSCORE,SP70
          MOVE      "003",D3            * default to adult honos
          CALL      CALADL00          
          PACK      TOTDSPLY,TOTSCORE,SP70
.
          MATCH     ANSC,TCINDC1
          IF        @EQUAL
            MOVE      "005",D3          * child honos
            CALL      CALCHI00
            PACK      TOTDSPLY,TOTSCORE,SP70
          ENDIF
          MATCH     ANSL,TCINDC1
          IF        @EQUAL
            MOVE      "007",D3          * LD honos
            CALL      CALLDI00
            PACK      TOTDSPLY,TOTSCORE,SP70
          ENDIF
          MATCH     ANSS,TCINDC1                                      *I-260105
          IF        @EQUAL
            MOVE      "019",D3          * Secure honos
            CALL      CALSEC00                        * (in MEHHONTM) *I-260105
            PACK      TOTDSPLY,TOTSCORE,NBSP,NBSP,NBSP,NBSP,SECSCORE,SP70
          ENDIF
          MATCH     ANSM,TCINDC1
          IF        @EQUAL
            MOVE      "023",D3          * ADOM
            CALL      CALCHI00
            PACK      TOTDSPLY,TOTSCORE,SP70
          ENDIF
          MATCH     ANSI,TCINDC1
          IF        @EQUAL
            MOVE      "029",D3          * Infant
            CALL      CALCHI00
            PACK      TOTDSPLY,TOTSCORE,SP70
          ENDIF
.
          MOVE     "No",COMPSTAT
          MATCH    "1",MHHNCOMP
          IF       @EQUAL
            MOVE     "Yes",COMPSTAT
          ENDIF
.
          MOVE     "No",SENTSTAT
          MATCH    "1",MHHNSENT
          IF       @EQUAL
            MOVE     "Yes",SENTSTAT
          ENDIF
          CLEAR     HTMLLINK
          APPEND    "javascript:HONOSLink('",HTMLLINK
          APPEND    URNUMBER,HTMLLINK
          APPEND    "','",HTMLLINK
          APPEND    MHHNVISN,HTMLLINK
          APPEND    "','",HTMLLINK
          APPEND    MHHNUNIQ,HTMLLINK
          APPEND    "','",HTMLLINK
          APPEND    D3,HTMLLINK
          APPEND    "')",HTMLLINK
          RESET     HTMLLINK
.
          CLEAR     HTMLLNK2
          APPEND    "javascript:SingleGraphLink('",HTMLLNK2
          APPEND    URNUMBER,HTMLLNK2
          APPEND    "','",HTMLLNK2
          APPEND    MHHNVISN,HTMLLNK2
          APPEND    "','",HTMLLNK2
          APPEND    MHHNUNIQ,HTMLLNK2
          APPEND    "','",HTMLLNK2
          APPEND    D3,HTMLLNK2
          APPEND    "')",HTMLLNK2
          RESET     HTMLLNK2
.
          CLEAR     HTMLLNK3
          APPEND    "javascript:AddHONOS('",HTMLLNK3
          APPEND    MHHNHOTY,HTMLLNK3
          APPEND    "','",HTMLLNK3
          APPEND    HONOSTY1,HTMLLNK3
          APPEND    "','",HTMLLNK3
          APPEND    MHHNVISN,HTMLLNK3
          APPEND    "')",HTMLLNK3
          RESET     HTMLLNK3
.
          ADD       ONE,COUNT
          MOVE      COUNT,DIM3
          REP       " 0",DIM3
.
.---------T0858390-start
.---------Set HTMLLNK4 and HTMLLNK5 for mehhonaf.mhhnreas
          CALL      MREAS000
.---------T0858390-End
.
          WRITE     HTMLFILE;"t.addRow(#"",HTMLLINK,"#",":           * 0
                             "#"",MHHNHDAT,"#",":                    * 1
                             "#"",SSETDESC,"#",":                    * 2
                             "#"",HNTYDESC,"#",":                    * 3
                             "#"",DOCFNAME,"#",":                    * 4
                             "#"",SENTSTAT,"#",":                    * 5
                             "#"",COMPSTAT,"#",":                    * 6
                             "#"",HTMLLNK2,"#",":                    * 7
                             "#"<input type=checkbox name=prc",DIM3:
                             " value='",MHHNVISN,MHHNUNIQ,"' onclick=setType(":
                             "this,'",D3,"');":
                             ">#",":                                 * 8
                             "#"",D3,"#",":                          * 9
                             "#"",KEY15,"#",":                       * 10
                             "#"",TOTDSPLY,"#",":                    * 11
                             "#"",HNRCDESC,"#",":                    * 12
                             "#"",DIM50,"#",":                       * 13
                             "#"",MHHNVISN,"#",":                    * 14
                             "#"",HTMLLNK3,"#",":                    * 15
                             "#"",SP1,"#",":                         * 16
                             "#"",HTMLLNK4,"#",":                    * 17
                             "#"",HTMLLNK5,"#"":                     * 18
                             ");"
          GOTO      MHUTB100
.
MHUTB999  RETURN
+
.------------------------------------------------------------------------------
. Set HTMLLNK4 and HTMLLNK5 for mehhonaf.mhhnreas
.------------------------------------------------------------------------------
MREAS000  CLEAR     HTMLLNK4
          CLEAR     HTMLLNK5
.
          PACK      KEY5,CATLHP,MHHNREAS,SP70
          CALL      RDCODE1
          BRANCH    OVRCD,MREAS999
.
          MATCH     ANSX,TCINDC7          * Exclude ADOM?
          GOTO      MREAS999 IF EQUAL     * Yes
.
MREAS100  APPEND    "<img src='../images/Column1GraphIcon.gif'",HTMLLNK4
          APPEND    " class=ListIcon onclick=SingleGraphLink('",HTMLLNK4
          REP       " +",URNUMBER
          REP       " +",MHHNVISN
          REP       " +",MHHNUNIQ
          REP       " +",D3
          APPEND    URNUMBER,HTMLLNK4
          APPEND    "','",HTMLLNK4
          APPEND    MHHNVISN,HTMLLNK4
          APPEND    "','",HTMLLNK4
          APPEND    MHHNUNIQ,HTMLLNK4
          APPEND    "','",HTMLLNK4
          APPEND    D3,HTMLLNK4
          APPEND    "');>",HTMLLNK4
          RESET     HTMLLNK4
          REP       "+ ",URNUMBER
          REP       "+ ",MHHNVISN
          REP       "+ ",MHHNUNIQ
          REP       "+ ",D3
.
          APPEND    "<input type=checkbox name=prc",HTMLLNK5
          APPEND    DIM3,HTMLLNK5
          APPEND    " value='",HTMLLNK5
          APPEND    MHHNVISN,HTMLLNK5
          APPEND    MHHNUNIQ,HTMLLNK5
          APPEND    "' onclick=setType(this,'",HTMLLNK5
          APPEND    D3,HTMLLNK5
          APPEND    "');>",HTMLLNK5
          RESET     HTMLLNK5
.           
          GOTO      MREAS999
.
MREAS999  RETURN
.------------------------------------------------------------
. Additional HCPs Indicator for ALREDEPT
.------------------------------------------------------------
INDHCP00  MOVE      SP70,DOCINDIC
.
          MATCH     SP70,ALREDEPT
          GOTO      INDHCP99 IF EQUAL
          GOTO      INDHCP99 IF EOS
.
          MOVE      ALREDEPT,CODE
          MOVE      "CG",CATEGORY
          CALL      GETCOD00
.
          MATCH     "A",TCINDC22
          GOTO      INDHCP99 IF NOT EQUAL
.
          MOVE      "1",DOCINDIC
.
INDHCP99  RETURN
.
.------------------------------------------------------------
          INC       IBAWEBCD
          INC       WEBDATCD
          INC       DAYOFWEK
          INC       PATDOCCD
          INC       NAMSTRCD
          INC       PATDOCTM
.
          INC       ALLADSIO/INC
          INC       ALLATSIO/INC
          INC       ALLAUDIO/INC
          INC       ALLCASIO/INC
          INC       ALLDEPIO/INC
          INC       ALLDIAIO/INC
          INC       ALLDSPIO/INC
          INC       ALLENCIO/INC
          INC       ALLGEHIO/INC
          INC       ALLGPAIO/INC
          INC       ALLGREIO/INC
          INC       ALLGRHIO/INC
          INC       ALLGROIO/INC
          INC       ALLGRPIO/INC
          INC       ALLREFIO/INC
          INC       ALLRLNIO/INC
          INC       ALLPROIO/INC
          INC       ALLPRRIO/INC
          INC       ALLRITIO/INC
          INC       ALLSERIO/INC
          INC       ALLSTSIO/INC
          INC       PMSHCLIO/INC
          INC       PMSHCPIO/INC
          INC       PATDO1IO/INC  
.
          INC       ALLADSTM
          INC       ALLREFTM
          INC       BRHLCOMN
          INC       PATMASTM
          INC       PMIGTNID
          INC       CLNHIMAS
          INC       CLMEHDIA
          INC       CLPMSPX2
          INC       CALCAGE
          INC       DGCLII13
          INC       PMSPX2TM
          INC       PMSHCGTM
          INC       MEHHONTM
          INC       MEHHLSTM
          INC       MEHDIATM
          INC       PATMSXTM
          INC       PATNAMCD
          INC       CLPATMAS
          INC       CLPATVIS
          INC       PMSHCPTM
          INC       CLALLREF
.
          INC       ALLCTMIO/INC
          INC       ALLQUEIO/INC
          INC       APSMASIO/INC
          INC       HL7CISIO/INC
          INC       HL7INBIO/INC
          INC       PATMA1IO/INC
          INC       PATALRIO/INC
          INC       PMSQPTIO/INC
          INC       PATVISIO/INC
          INC       PMSVX1IO/INC
          INC       OUTSITIO/INC
          INC       OUTCTYIO/INC
          INC       OUTCLIIO/INC
          INC       PMSUCHIO/INC
          INC       PMSUCDIO/INC
          INC       PMSPX2IO/INC
          INC       PATMI1IO/INC
          INC       PATNIDIO/INC
          INC       PATFN1IO/INC
          INC       PATPR1IO/INC
          INC       PATWR1IO/INC
          INC       PRIITMIO/INC
          INC       MEHHONIO/INC
          INC       MEHDIAIO/INC
          INC       MEHHLSIO/INC
          INC       MEHDLSIO/INC
          INC       MEHVI1IO/INC
          INC       MLTSECIO/INC
          INC       MLTSITIO/INC
          INC       MRTMASIO/INC
          INC       NHIMASIO/INC
          INC       NHIETHIO/INC
          INC       PATHSPIO/INC
          INC       PATIN1IO/INC
          INC       PMSHCGIO/INC
          INC       PATRE1IO/INC
          INC       PATDSCIO/INC
          INC       PATASFIO/INC
          INC       PATDGWIO/INC
          INC       PATEORIO/INC
          INC       PATVADIO/INC
          INC       PATITMIO/INC
          INC       PMSCCDIO/INC            * Concession Card Details
