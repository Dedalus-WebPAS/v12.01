.-------------------------------------------------------------------------------
. Program       : PRIWEB05 
.
. Function      : General Private Practice Maintenance Server
.
. Modifications : 
.-------------------------------------------------------------------------------
. V11.04.01 25/06/2024  Thanh T       TSK 0947684
.           Added PMSHCGTD
. V11.03.03 02/05/2023  Thanh T.        TSK 0929137                       
.           Changed CEASE000 to update all the previous MBS/AMA items     
.           with the blank end date to the new effective date minus 1 day 
. V11.03.02 05/01/2023  Bella Turco  TSK 0921957
.           Continued adding PTCNNRTD & NOMORE00 to maintenance pages
. V11.03.01 25/11/2022  Bella Turco  TSK 0921957
.           Added NORECORD=PTCNNRTD to SPTCTA00 routine
. V11.02.02 02/08/2022  Bella Turco  TSK 0921957
.           Continued adding PTCNNRTD & NOMORE00 to maintenance pages 
. V11.02.01 19/07/2022  Bella Turco  TSK 0921957
.           Added NOMORE00 - Display "No more records" at end of list
.           Added PTCNNRTD - Displays number of rows set by parameter value
. V10.11.01 21/08/2017  Peter Vela   TSK 0837619
.           Added Sub Item validation to SPTCTA00 for IMC
. V10.09.01 16/02/2017  Peter Vela   TSK 0833601
.           Added option 4 to LNK2PRT in SPTCTA00
. V10.08.01 29/09/2016  Peter Vela   TSK 0294177
.           Added IMC Derived Items when validating for PRITPATH
. V10.06.01 14.04.2015  J.Tan        CAR 296772
.           Recompiled for PRIIKIPR - keyword search for PP MBS Items
. V10.04.01 31.03.2014  B.G.Ackland  CAR 299363
.           Replace META Tag Redirect with Javascript in Common RDIREC00
.           Routine
.-------------------------------------------------------------------------------
. V10.03.03 16/07/2013  Jill Parkinson CAR 287923
.           Added include of PATCONFD
. V10.03.02 12/12/2012  B.G.Ackland    CAR 275970 
.           Added JSON Keyword Search for Allied Health Contact Page
.           allweb0301802
. V10.03.01 14/11/2011  J.Tan          CAR 254386
.           Recompiled for PRIIKIPR.PBL - mods to generate item less than 3 chrs
. V10.01.03 10/02/2011  Mike Laming    CAR 230710
.           Recompiled for PRIIKIPR.PBL - mods to Keywords table update
.           Mods to SPTCTA00 for Keyword search and display.
. V10.01.02 16/11/2010  Ebon Clements  CAR 192235
.           Display invalid items in common item templates - AMATB000 - MBSTB000
. V10.01.01 05/11/2010  Mike Laming    CAR 230710
.           Added Cease Date (PRITDAT2) test in VALITM00, OUTITM00 & SPTCTA00
.           Added CEASE000
. V9.11.01  03/04/2009  Mike Laming    CAR 123419
.           Added auto create of "pritestf" records - see ADDPTE00 & DELPTE00
. V9.09.03  13/12/2007  Peter Vela     CAR 151458
.           Fixed update of multiple items maintenance description
. V9.09.02  24/10/2007  Jill Habasque  CAR 151761
.           Added call to CLRITM00 in PRIITM10
. V9.09.01  25/05/2007  Peter Vela    CAR SJOG ED Billing
.           Added the input of the following priitemf variables:
.           - Schedule Fee 75%
.           - Schedule Fee 85%
.           - Suggested AMA Fee
.           - Print Service Date/Time on Invoice for this Item
. V9.05.01  09/03/2006  Ebon Clements CAR 78533
.           Mods for PATCODTM - Hospital specific category codes
. V9.05.B01 30/01/2006  Ebon Clements CAR 93186
.           Mods for REDIRECT length change. Recompiled for IBAWEBDF
. V9.04.06 19.08.2005      J.Tan    CAR 62750
.          Removed redefined amount variables
. V9.04.05 11.05.2005 Ebon Clements CAR 61563
.          Adde tag for updttype for global items update
. V9.04.04 03.05.2005 J.Tan     CAR 60929
.          Fixed selection list for Medical practice
. V9.04.03 22.05.2005 J.Tan     CAR 60889
.          Added tag for item schedule fee
. V9.04.02 23.02.2005 Davin     CAR 56697
.          Added routine to output cmbs templates (remote50)
. V9.04.01 18.02.2005 J.Tan     CAR 56703
.          Added function to copy commission schedule fee 
. V9.03.06 25.06.2004 Lina Vo   CAR 49814
.          Added extra MBS/AMA validation to REMOTE00, VALDTYPE=4
. V9.03.05 04.03.2004 J.Tan
.          Mods to rename and initialise the prithdaf file
. V9.03.04 02.02.2004 Pat Dirito                 CAR 44122 & CAR 44123
.          Added Option 6 Pathology Test Maintenance  
.          Added Option 7 Multiple Item Tests Maintenance  
.          Added Option 8 Remote Scripting Functions       
. V9.03.03 28.01.2004 Pat Dirito                 CAR 44127
.          Added Option 4 & 5 Common Items Maintenance  
. V9.03.02 27.01.2004 Pat Dirito                 CAR 44124
.          Added function DELOTH00 - Deletion of Other Item Records when delete
.          parent record in PRIITM30
. V9.03.01 05.01.2004 Pat Dirito                 CAR 44124
.          Added Option 2 & 3 
. V9.03.00 01.12.2003 Pat Dirito                 CAR 44124
.          Created Program - Added Option 1 
.-------------------------------------------------------------------------------
          INC       IBAWEBDF    
          INC       WEBDATDF
          INC       RSHWEBDF
.
          INC       PATCONFD/INC
          INC       APSMASFD/INC
          INC       PMSHCPTD/INC
          INC       PMSHCGTD/INC
          INC       PRIMGPFD/INC
          INC       PRIITMFD/INC
          INC       PRIIKIFD/INC
          INC       PRITESFD/INC
          INC       PRITKIFD/INC
          INC       PRIMULFD/INC
          INC       PRIGRPFD/INC
          INC       PRIDOCFD/INC
          INC       PRIPRAFD/INC
          INC       PRITHDFD/INC
          INC       PRITDTFD/INC
          INC       PATDO1FD/INC                 * insurance company file
          INC       PATIN1FD/INC                 * insurance company file
          INC       PMSHCPFD/INC
          INC       IBAGSTFD/INC
.
.---------------------------------------------------------------------------
.  CGI Variables
.
NEXTPAGE  DIM       1      * Nextpage parameter CGI parameter
UPDTTYPE  DIM       1      * Update Type
DEFTTYPE  DIM       1      * Default Update Type
STARTKEY  DIM       15     * Starting Key
.
PRIMG001  DIM       8      * Effective Date
PRIMG002  FORM      3.2    * Gap Value       
.
PRITM001  DIM       2      * Item Type
PRITM002  DIM       9      * MBS Item Number
PRITM003  DIM       3      * MBS Subitem Number
PRITM004  DIM       8      * Date item commenced (CCYYMMDD format)
PRITM005  DIM       30     * Item Description
PRITM006  DIM       1      * Keyin Indicator
PRITM007  DIM       12     * Item Schedule Fee ($)
PRITM008  DIM       3      * Set Code (Category PG)
PRITM009  DIM       8      * Date item will cease
PRITM010  DIM       3      * Item Category
PRITM011  DIM       3      * Item Group
PRITM012  DIM       3      * Item Subgroup
PRITM013  DIM       1      * Fee Type
PRITM014  DIM       3      * Provider Type
PRITM015  DIM       1      * Pathology item indicator
PRITM016  DIM       3      * Maximum no. of Requests
PRITM017  DIM       3      * Period of Days
PRITM018  DIM       9      * Item to stepdown to after max req.
PRITM019  DIM       3      * Sub-item to stepdown to
PRITM020  DIM       1      * Fixed charged item ?
PRITM021  DIM       1      * GST Charge
PRITM022  DIM       6      * GST Payable Code
PRITM023  DIM       12     * Schedule Fee 75%
PRITM024  DIM       12     * Schedule Fee 85%
PRITM025  DIM       12     * Schedule Fee Suggested AMA Fee
PRITM026  DIM       1      * Print Service Date/Time
.
PRIGL001  DIM       1      * Item Type
PRIGL002  DIM       8      * Effective Date 
PRIGL003  DIM       9      * MBS From Item Number
PRIGL004  DIM       9      * MBS Too Item Number
PRIGL005  FORM      3.2    * % Increase
PRIGL006  DIM       40     * Filename 
PRIGL007  DIM       6      * Medical Practice from
PRIGL008  DIM       6      * Associated Doctor from
PRIGL009  DIM       6      * Medical Practice to
PRIGL010  DIM       6      * Associated Doctor to
.
PRITS001  DIM       9      * Test Code
PRITS002  DIM       8      * Date Effective From
PRITS003  DIM       30     * Test Description
PRITS004  DIM       9      * MBS Item Number
PRITS005  DIM       3      * MBS Subitem Number
PRITS006  DIM       9      * AMA Item Number
PRITS007  DIM       5      * Multiple Services Code
PRITS008  FORM      3      * Number of Procedures
PRITS009  DIM       4      * Standard Abbreviation
.
CMBSTEMP  DIM       4      * Template ID
CURRDATE  DIM       8
DOCTCODE  DIM       6
DELETEKY  DIM       34
DELTSTKY  DIM       16
ITMCOUNT  FORM      2
ITEMTYPE  DIM       2
ITEMNUMB  DIM       9
SUBITEMN  DIM       3
VSUBITEM  DIM       3
.
OTHIT001  DIM       2      * Item Type 0 = MBS Item 1 = AMA Item
OTHIT002  DIM       9      * MBS/AMA Item Number (Primary Item)
OTHIT003  DIM       3      * MBS Subitem Number
OTHIT004  DIM       8      * Date effective from
OTHIT005  DIM       9      * MBS/AMA Item Number (Secondary Item)
OTHIT006  DIM       3      * MBS Subitem Number
.
PRITH001  DIM       4      * Template ID
PRITH002  DIM       35     * Description
PRITH003  DIM       1      * Active Indicator 1=Active 0=Not
.
PRITD001  DIM       4      * Template ID
PRITD002  DIM       1      * Item Type 0=MBS 1=AMA 
PRITD003  DIM       3      * Sequence No.
PRITD004  DIM       9      * Item Code
PRITD005  DIM       3      * Sub-Item No
PRITD006  FORM      2      * Quantity
.
PRIML001  DIM       5      * Multiple Services Code
PRIML002  DIM       8      * Date Effective From
PRIML003  FORM      3      * Number of Procedures
PRIML004  DIM       30     * Description
PRIML005  DIM       9      * MBS Item Number
PRIML006  DIM       3      * MBS Subitem Number
PRIML007  DIM       9      * AMA Item Number
.
NUMTESTS  FORM      3[100]  * Array of Number of Tests/Procs
MBSITEMS  DIM       9[100]  * Array of MBS Items 
MBSSUBIT  DIM       3[100]  * Array of MBS Sub-Items 
AMAITEMS  DIM       9[100]  * Array of AMA Items 
.
VALDCODE  DIM       70      * Validation Code
VALDTYPE  FORM      1       * Validation Type
VALDONLY  FORM      1       * Validation Only
VALDEFDT  DIM       8       * validate effective date
.
. Variable Declarations  
.
FOUNDFLG  FORM      1
LASTTEST  FORM      3       * Last Test No of Diagnosis array
COUNT     FORM      3
FORM3     FORM      3       * Count for Sequence
FORM3A    FORM      3       * Testing for weather to read backwards or forwards
SAVKEY    DIM       8       * Key Save
SAVCODE   DIM       5       
SAVDESC   DIM       30      
NEWSEQNC  DIM       3       * New sequence passed in from BSP
MOVESWAP  DIM       1       * passed in from BSP to indicate swap or move
NNN       INIT      "999"
S         INIT      "S"
PACKLINK  DIM       70 
DIM3      DIM       3
DIM15     DIM       15
DIM16     DIM       16
DIM34     DIM       34
ITEMTYP   DIM       2
ITEMDESC  DIM       30
AMADESC   DIM       30
ITEMNO    DIM       9
KEY11B    DIM       11
PREVEFDT  DIM       8                                                 *I-230710
SAVSUB    DIM       3
SAVDAT    DIM       8
SAVKEY22  DIM       22      * Key Save
SAVKEY24  DIM       24
SAVKEY26  DIM       26
SAVKEY9   DIM       9
SAVKEY2   DIM       2
SAVPFLAG  FORM      2
SAVPSTEP  DIM       9
SAVPSTSB  DIM       3
TESTCODE  DIM       9
LNK2PRT   FORM      1
WORKDATE  DATE      8
REPNO     DIM       2
NINE8     INIT      "99999999"
NINE3     INIT      "999"
DASH      INIT      "-"
.
INPFILE   FILE      ASCII, FIXED=256             * input data file (Option 5)
.
.---------------------------------------------------------------------------
PRGID     INIT      "PRIWEB05"
VERSION   INIT      "V12.01.00"
PRGNAM    INIT      "General Private Practice Maintenance Maintenance"
.---------------------------------------------------------------------------
          CALL      WEBINT00       * Initialise Fifo Etc.
          CALL      INIT0000       * Open Files
.
MAIN1000  CALL      WEBRED00       * Read Fifo WEBPID and USERID
.
          COMPARE   "999",REPORTNO * End Server Process on Report Option 999
          GOTO      MAIN9999 IF EQUAL
.
          PACK      CURRDATE,CCC,CYY,CMM,CDD
          REP       " 0",CURRDATE
.
          BRANCH    REPORTNO,MAIN1100,MAIN1200,MAIN1300,MAIN1400,MAIN1500:
                             MAIN1600,MAIN1700,MAIN1800
.
          PACK      WEBTITLE,PRGID,SP1,VERSION,SP1,PRGNAM,SP70
          MOVE      "Invalid Option",WEBTITLE
          CALL      WEBERR00   * Create Output File and Write HTML Page Header
          GOTO      MAIN1000
.
MAIN1100  CALL      PRIMGP00        * Medicare Gap Maintenance
          BRANCH    EXIT,MAIN1000
          MOVE      "Update Complete",WEBTITLE
          CALL      NXTPAG00
          GOTO      MAIN1000
.
MAIN1200  CALL      PRIITM00        * AMA/MBS Main & Key Word Search
          BRANCH    EXIT,MAIN1000
          MOVE      "Update Complete",WEBTITLE
          CALL      NXTPAG00
          GOTO      MAIN1000
.
MAIN1300  CALL      PRIGRP00        * AMA/MBS Other Items
          BRANCH    EXIT,MAIN1000
          MOVE      "Update Complete",WEBTITLE
          CALL      NXTPAG00
          GOTO      MAIN1000
.
MAIN1400  CALL      PRITHD00        * Common Items Templates
          BRANCH    EXIT,MAIN1000
          MOVE      "Update Complete",WEBTITLE
          CALL      NXTPAG00
          GOTO      MAIN1000
.
MAIN1500  CALL      PRITDT00        * Common Items Templates Details
          BRANCH    EXIT,MAIN1000
          MOVE      "Update Complete",WEBTITLE
          CALL      NXTPAG00
          GOTO      MAIN1000
.
MAIN1600  CALL      PRITES00        * Pathology Test Main & Key Word Search
          BRANCH    EXIT,MAIN1000
          MOVE      "Update Complete",WEBTITLE
          CALL      NXTPAG00
          GOTO      MAIN1000
.
MAIN1700  CALL      PRIMUL00        * Multiple Services Maintenance 
          BRANCH    EXIT,MAIN1000
          MOVE      "Update Complete",WEBTITLE
          CALL      NXTPAG00
          GOTO      MAIN1000
.
MAIN1800  CALL      REMOTE00        * Remote Scripting Functions
          GOTO      MAIN1000
. 
MAIN9999  MOVE      "SERVER SHUTDOWN COMPLETE",WEBTITLE
          CALL      WEBERR00
          STOP
.------------------------------------------------------------
. Output Next Page Based on CGI Parameter nextpage
.------------------------------------------------------------
NXTPAG00  MOVE      ZERO,F1
          MOVE      NEXTPAGE,F1
          BRANCH    F1,NXTPAG10,NXTPAG20,NXTPAG30,NXTPAG40,NXTPAG50
.
          CALL      WINCLS00
          GOTO      NXTPAG99
.
NXTPAG10  CALL      RDIREC00
          GOTO      NXTPAG99
.
NXTPAG20  CALL      GOBACK00      * Go Back 1 Html page
          GOTO      NXTPAG99
.
NXTPAG30  CALL      DAH20000      * Go Back 2 html pages 
          GOTO      NXTPAG99
.
NXTPAG40  CALL      GOBACK00
          GOTO      NXTPAG99
.
NXTPAG50  CALL      PREDIR00      * Redirect Parent
          GOTO      NXTPAG99
.
NXTPAG99  RETURN
.-------------------------------------------------------------------------------
.  Goes back 1 page
.-------------------------------------------------------------------------------
GOBACK00  CALL      OPENHTML
          BRANCH    EXIT,GOBACK99
          WRITE     HTMLFILE;"<script language=#"JavaScript#"> {":
                             "    alert(#"",WEBTITLE,"#");":
                             "    self.close();":
                             "    opener.history.go(-1);": 
                             "}":
                             "</script>"
          CALL      CLOSHTML
GOBACK99  RETURN
.------------------------------------------------------------------------------
.  Redirect Parent URL
.------------------------------------------------------------------------------
PREDIR00  CALL      OPENHTML
          BRANCH    EXIT,PREDIR90
.
          WRITE     HTMLFILE;"<script type=#"text/javascript#"> {":
                             " parent.location.href=#"",REDIRECT,"#";":
                             "}":
                             "</script>"
          CALL      CLOSHTML
          GOTO      PREDIR99
.
PREDIR90  DISPLAY   "*** Fifo Not Found ***"
.
PREDIR99  RETURN
.-------------------------------------------------------------------------------
. Open Files and Initialize Variables
.-------------------------------------------------------------------------------
INIT0000  OPEN      PRIMGPA1,"primgpaf" 
          OPEN      PRIITEM1,"priitemf"
          OPEN      PRIIKIA1,"priikiaf"
          OPEN      PRIIKIA2,"priikiaf"
          OPEN      PRITEST1,"pritestf"
          OPEN      PRITKIA1,"pritkiaf"
          OPEN      PRITKIA2,"pritkiaf"
          OPEN      PRIGRPA1,"prigrpaf"
          OPEN      PRITHDA1,"prithdaf"
          OPEN      PRITDTA1,"pritdtaf"
          OPEN      PRIMULT1,"primultf"
          OPEN      PRIMULT2,"primultf"
          OPEN      PRIDOCT1,"pridoctf"
          OPEN      PRIPRAC1,"pripracf"
          OPEN      IBAGSTA1,"ibagstaf"
          OPEN      PATCODE1,"patcodes"
          OPEN      PATCODE2,"patcodes"
          OPEN      PATDO1A2,"patdo1af"
.
          READ      CONTROLF,ZERO;*43,IBCNMHOS
          READ      CONTROLF,HUND25;*238,PTCNNRTD
.
          IF        IBCNMHOS=1
            OPEN      MLTCODA1,"mltcodaf"
            OPEN      MLTCODA2,"mltcodaf"
          ENDIF
.
          MOVE      ZERO,F2
          MOVE      PTCNNRTD,F2
          IF        F2 = 0
            MOVE      "10",PTCNNRTD
          ENDIF
.
INIT9999  RETURN
.-------------------------------------------------------------------------------
. Clear Parameters
.-------------------------------------------------------------------------------
CLRPAR00  MOVE      ZERO,STARTNUM
          MOVE      ZERO,NORECORD
          MOVE      ZERO,REPORTNO
          MOVE      SP70,TEMPLATE
          MOVE      SP70,UPDTTYPE
          MOVE      SP70,DEFTTYPE
          MOVE      SP70,ADMISSNO
          MOVE      SP70,URNUMBER 
          MOVE      SP70,NEXTPAGE
          PACK      REDIRECT,SP70,SP70,SP70,SP70
          MOVE      SP70,STARTKEY
          MOVE      SP70,KEYWORDS
          MOVE      SP70,VALDCODE
          MOVE      ZERO,VALDTYPE
          MOVE      ZERO,VALDONLY
          MOVE      SP70,VALDEFDT
.
          MOVE      SP70,PRIMG001 
          MOVE      ZERO,PRIMG002 
.
          MOVE      Z70,PRITM001  
          MOVE      Z70,PRITM002  
          MOVE      Z70,PRITM003  
          MOVE      Z70,PRITM004  
          MOVE      Z70,PRITM005  
          MOVE      Z70,PRITM006  
          MOVE      Z70,PRITM007  
          MOVE      Z70,PRITM008  
          MOVE      Z70,PRITM009  
          MOVE      Z70,PRITM010  
          MOVE      Z70,PRITM011  
          MOVE      Z70,PRITM012  
          MOVE      Z70,PRITM013  
          MOVE      Z70,PRITM014  
          MOVE      Z70,PRITM015  
          MOVE      Z70,PRITM016  
          MOVE      Z70,PRITM017  
          MOVE      Z70,PRITM018  
          MOVE      Z70,PRITM019  
          MOVE      Z70,PRITM020  
          MOVE      Z70,PRITM021  
          MOVE      Z70,PRITM022  
          MOVE      Z70,PRITM023
          MOVE      Z70,PRITM024
          MOVE      Z70,PRITM025
          MOVE      Z70,PRITM026
.
          MOVE      SP70,PRIGL001
          MOVE      SP70,PRIGL002
          MOVE      SP70,PRIGL003
          MOVE      SP70,PRIGL004
          MOVE      ZERO,PRIGL005
          MOVE      SP70,PRIGL006
          MOVE      SP70,PRIGL007
          MOVE      SP70,PRIGL008
          MOVE      SP70,PRIGL009
          MOVE      SP70,PRIGL010
.
          MOVE      SP70,OTHIT001  
          MOVE      SP70,OTHIT002  
          MOVE      SP70,OTHIT003  
          MOVE      SP70,OTHIT004  
          MOVE      SP70,OTHIT005  
          MOVE      SP70,OTHIT006  
.
          MOVE      SP70,PRITH001
          MOVE      SP70,PRITH002
          MOVE      SP70,PRITH003
.
          MOVE      SP70,PRITD001
          MOVE      SP70,PRITD002
          MOVE      SP70,PRITD003
          MOVE      SP70,PRITD004
          MOVE      SP70,PRITD005
          MOVE      ZERO,PRITD006
.
          MOVE      SP70,PRITS001
          MOVE      SP70,PRITS002
          MOVE      SP70,PRITS003
          MOVE      SP70,PRITS004
          MOVE      SP70,PRITS005
          MOVE      SP70,PRITS006
          MOVE      SP70,PRITS007
          MOVE      ZERO,PRITS008
          MOVE      SP70,PRITS009
.
          MOVE      SP70,PRIML001
          MOVE      SP70,PRIML002
          MOVE      SP70,PRIML003
          MOVE      SP70,PRIML004
          MOVE      SP70,PRIML005
          MOVE      SP70,PRIML006
          MOVE      SP70,PRIML007
.
          MOVE      SP70,CMBSTEMP
          MOVE      SP70,ITEMTYPE
          MOVE      SP70,ITEMNUMB
          MOVE      SP70,SUBITEMN
          MOVE      SP70,VSUBITEM
          MOVE      SP70,DELETEKY
          MOVE      SP70,DELTSTKY
          MOVE      SP70,NEWSEQNC
          MOVE      SP70,MOVESWAP
          MOVE      ZERO,FORM3
          MOVE      ZERO,FORM3A
          MOVE      SP70,SAVKEY
.
          MOVE      ONE,COUNT
          WHILE     COUNT <= 100
            MOVE      ZERO,NUMTESTS[COUNT]
            MOVE      SP70,MBSITEMS[COUNT]
            MOVE      SP70,MBSSUBIT[COUNT]
            MOVE      SP70,AMAITEMS[COUNT]
            ADD       ONE,COUNT
          DO
.
CLRPAR99  RETURN
.-------------------------------------------------------------------------------
. Set Parameters
.-------------------------------------------------------------------------------
SETPAR00  MATCH     "reportno=",QRYNAME
          IF        @EQUAL
            MOVE      QRYDATA,REPORTNO
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "urnumber=",QRYNAME
          IF        @EQUAL
            MOVE      QRYDATA,URNUMBER
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "admissno=",QRYNAME
          IF        @EQUAL
            MOVE      QRYDATA,ADMISSNO
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "template=",QRYNAME
          IF        @EQUAL
            MOVE      QRYDATA,TEMPLATE
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "updttype=",QRYNAME
          IF        @EQUAL
            MOVE      QRYDATA,UPDTTYPE
            GOTO      SETPAR99
          ENDIF
.   
          MATCH     "defttype=",QRYNAME
          IF        @EQUAL
            MOVE      QRYDATA,DEFTTYPE
            GOTO      SETPAR99
          ENDIF
.   
          MATCH     "nextpage=",QRYNAME
          IF        @EQUAL
            MOVE      QRYDATA,NEXTPAGE
            GOTO      SETPAR99
          ENDIF  
.
          MATCH     "redirect=",QRYNAME
          IF        @EQUAL
            MOVE      QRYDATA,REDIRECT
            GOTO      SETPAR99
          ENDIF
. 
          MATCH     "keywords=",QRYNAME
          IF        @EQUAL
            MOVE      QRYDATA,KEYWORDS
            GOTO      SETPAR99
          ENDIF
. 
          MATCH     "norecord=",QRYNAME
          IF        @EQUAL
            MOVE      QRYDATA,NORECORD
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "startnum=",QRYNAME
          IF        @EQUAL
            MOVE      QRYDATA,STARTNUM
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "startkey=",QRYNAME
          IF        @EQUAL
            MOVE      QRYDATA,STARTKEY
            PACK      STARTKEY,STARTKEY,SP70
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "cmbstemp=",QRYNAME
          IF        @EQUAL
            MOVE      QRYDATA,CMBSTEMP
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "itemtype=",QRYNAME
          IF        @EQUAL
            MOVE      QRYDATA,ITEMTYPE
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "itemnumb=",QRYNAME
          IF        @EQUAL
            MOVE      QRYDATA,ITEMNUMB
            PACK      ITEMNUMB,ITEMNUMB,SP70 
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "subitemn=",QRYNAME
          IF        @EQUAL
            MOVE      QRYDATA,SUBITEMN
            PACK      SUBITEMN,SUBITEMN,SP70 
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "vsubitem=",QRYNAME
          IF        @EQUAL
            MOVE      QRYDATA,VSUBITEM
            PACK      VSUBITEM,VSUBITEM,SP70
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "deleteky=",QRYNAME
          IF        @EQUAL
            MOVE      QRYDATA,DELETEKY
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "deltstky=",QRYNAME
          IF        @EQUAL
            MOVE      QRYDATA,DELTSTKY
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "newseqnc=",QRYNAME
          IF        @EQUAL
            MOVE      QRYDATA,NEWSEQNC
            PACK      NEWSEQNC,NEWSEQNC,SP70
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "moveswap=",QRYNAME
          IF        @EQUAL
            MOVE      QRYDATA,MOVESWAP
            PACK      MOVESWAP,MOVESWAP,SP70
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "valdcode=",QRYNAME
          IF        @EQUAL
            MOVE      QRYDATA,VALDCODE
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "valdtype=",QRYNAME
          IF        @EQUAL
            MOVE      QRYDATA,VALDTYPE
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "valdefdt=",QRYNAME
          IF        @EQUAL
            MOVE      QRYDATA,VALDEFDT
            TYPE      VALDEFDT
            IF        @EQUAL
              PACK      VALDEFDT,VALDEFDT,SP70
            ELSE
              UNPACK    QRYDATA,CDAY,KEY1,MTHNAM3,KEY1,CCENT,CYEAR
              CALL      SETMTH00                * To Format Month
              PACK      VALDEFDT,CCENT,CYEAR,CMON,CDAY
            ENDIF
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "primg",QRYNAME
          IF        @EQUAL
            CALL      STMGP000
            GOTO      SETPAR99 
          ENDIF
.
          MATCH     "pritm",QRYNAME
          IF        @EQUAL
            CALL      STITM000
            GOTO      SETPAR99 
          ENDIF
.
          MATCH     "prigl",QRYNAME
          IF        @EQUAL
            CALL      STIGL000
            GOTO      SETPAR99 
          ENDIF
.
          MATCH     "othit",QRYNAME
          IF        @EQUAL
            CALL      STOTH000
            GOTO      SETPAR99 
          ENDIF
.
          MATCH     "prith",QRYNAME
          IF        @EQUAL
            CALL      STTHD000
            GOTO      SETPAR99 
          ENDIF
.
          MATCH     "pritd",QRYNAME
          IF        @EQUAL
            CALL      STTDT000
            GOTO      SETPAR99 
          ENDIF
.
          MATCH     "prits",QRYNAME
          IF        @EQUAL
            CALL      STITS000
            GOTO      SETPAR99 
          ENDIF
.
          MATCH     "priml",QRYNAME
          IF        @EQUAL
            CALL      STMUL000
            GOTO      SETPAR99 
          ENDIF
.
          MATCH     "pripr",QRYNAME    * Contains No of Tests 
          IF        @EQUAL
            CALL      STTST000
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "prmbs",QRYNAME    * Contains No of Tests 
          IF        @EQUAL
            CALL      STMBS000
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "prsub",QRYNAME    * Contains No of Tests 
          IF        @EQUAL
            CALL      STSUB000
            GOTO      SETPAR99
          ENDIF
.
          MATCH     "prama",QRYNAME    * Contains No of Tests 
          IF        @EQUAL
            CALL      STAMA000
            GOTO      SETPAR99
          ENDIF
.
SETPAR99  RETURN
.----------------------------------------------------------------
. Set parameter for AMA Items   
.----------------------------------------------------------------
STAMA000  MOVE      ZERO,EXIT
          UNPACK    QRYNAME,KEY5,KEY3
          MOVE      KEY3,F3
          ASSIGN    F3-100,F3   * Field comes in as 101 filled     
          PACK      AMAITEMS[F3],QRYDATA,SP70
STAMA999  RETURN
.----------------------------------------------------------------
. Set parameter for MBS Sub-Items   
.----------------------------------------------------------------
STSUB000  MOVE      ZERO,EXIT
          UNPACK    QRYNAME,KEY5,KEY3
          MOVE      KEY3,F3
          ASSIGN    F3-100,F3   * Field comes in as 101 filled     
          PACK      MBSSUBIT[F3],QRYDATA,SP70
STSUB999  RETURN
.----------------------------------------------------------------
. Set parameter for MBS Items   
.----------------------------------------------------------------
STMBS000  MOVE      ZERO,EXIT
          UNPACK    QRYNAME,KEY5,KEY3
          MOVE      KEY3,F3
          ASSIGN    F3-100,F3   * Field comes in as 101 filled     
          PACK      MBSITEMS[F3],QRYDATA,SP70
STMBS999  RETURN
.----------------------------------------------------------------
. Set parameter for No. of Tests
.----------------------------------------------------------------
STTST000  MOVE      ZERO,EXIT
          UNPACK    QRYNAME,KEY5,KEY3
          MOVE      KEY3,F3
          ASSIGN    F3-100,F3   * Field comes in as 101 filled     
          MOVE      QRYDATA,NUMTESTS[F3]
          MOVE      F3,LASTTEST
STTST999  RETURN
.-------------------------------------------------------------------------------
.   Set Parameters for Option 2 - Private Practice AMA/MBS Item Maintenance
.-------------------------------------------------------------------------------
STITM000  UNPACK    QRYNAME,KEY5,KEY3
          MOVE      KEY3,F3
          BRANCH    F3,STITM001,STITM002,STITM003,STITM004,STITM005:
                       STITM006,STITM007,STITM008,STITM009,STITM010:
                       STITM011,STITM012,STITM013,STITM014,STITM015:
                       STITM016,STITM017,STITM018,STITM019,STITM020:
                       STITM021,STITM022,STITM023,STITM024,STITM025:
                       STITM026
.
          GOTO      STITM999
.
STITM001  MOVE      QRYDATA,PRITM001
          GOTO      STITM999
.
STITM002  SQUEEZE   QRYDATA 
          MOVE      QRYDATA,PRITM002
          PACK      PRITM002,PRITM002,SP70
          GOTO      STITM999
.
STITM003  SQUEEZE   QRYDATA 
          MOVE      QRYDATA,PRITM003
          PACK      PRITM003,PRITM003,SP70
          GOTO      STITM999
.
STITM004  MOVE      QRYDATA,KEY11   * Change Date as format is (DD MON CCYY)
          PACK      KEY11,KEY11,SP70
          UNPACK    KEY11,KEY8,KEY3
          MATCH     SP70,KEY3
          IF        !@EQUAL
            UNPACK    QRYDATA,CDAY,KEY1,MTHNAM3,KEY1,CCENT,CYEAR
            CALL      SETMTH00
            PACK      PRITM004,CCENT,CYEAR,CMON,CDAY
            REP       " 0",PRITM004
          ELSE
            MOVE      QRYDATA,PRITM004
          ENDIF
          GOTO      STITM999
.
STITM005  MOVE      QRYDATA,PRITM005
          GOTO      STITM999
.
STITM006  MOVE      QRYDATA,PRITM006
          GOTO      STITM999
.
STITM007  MOVE      QRYDATA,PRITM007
          GOTO      STITM999
.
STITM008  MOVE      QRYDATA,PRITM008
          GOTO      STITM999
.
STITM009  MOVE      SP8,PRITM009
          MATCH     SP10,QRYDATA
          IF        !@EQUAL & !@EOS
            UNPACK    QRYDATA,CDAY,KEY1,MTHNAM3,KEY1,CCENT,CYEAR
            CALL      SETMTH00
            PACK      PRITM009,CCENT,CYEAR,CMON,CDAY
            REP       " 0",PRITM009
          ENDIF
          GOTO      STITM999
.
STITM010  MOVE      QRYDATA,PRITM010
          GOTO      STITM999
.
STITM011  MOVE      QRYDATA,PRITM011
          GOTO      STITM999
.
STITM012  MOVE      QRYDATA,PRITM012
          GOTO      STITM999
.
STITM013  MOVE      QRYDATA,PRITM013
          GOTO      STITM999
.
STITM014  MOVE      QRYDATA,PRITM014
          GOTO      STITM999
.
STITM015  MOVE      QRYDATA,PRITM015
          GOTO      STITM999
.
STITM016  MOVE      QRYDATA,PRITM016
          GOTO      STITM999
.
STITM017  MOVE      QRYDATA,PRITM017
          GOTO      STITM999
.
STITM018  MOVE      QRYDATA,PRITM018
          GOTO      STITM999
.
STITM019  MOVE      QRYDATA,PRITM019
          GOTO      STITM999
.
STITM020  MOVE      QRYDATA,PRITM020
          GOTO      STITM999
.
STITM021  MOVE      QRYDATA,PRITM021
          GOTO      STITM999
.
STITM022  MOVE      QRYDATA,PRITM022
          GOTO      STITM999
.
STITM023  MOVE      QRYDATA,PRITM023
          GOTO      STITM999
.
STITM024  MOVE      QRYDATA,PRITM024
          GOTO      STITM999
.
STITM025  MOVE      QRYDATA,PRITM025
          GOTO      STITM999
.
STITM026  MOVE      QRYDATA,PRITM026
          GOTO      STITM999
.
STITM999  RETURN
.-------------------------------------------------------------------------------
.   Set Parameters for Option 2 - Private Practice AMA/MBS Global Functions
.-------------------------------------------------------------------------------
STIGL000  UNPACK    QRYNAME,KEY5,KEY3
          MOVE      KEY3,F3
          BRANCH    F3,STIGL001,STIGL002,STIGL003,STIGL004,STIGL005:
                       STIGL006,STIGL007,STIGL008,STIGL009,STIGL010
.
          GOTO      STIGL999
.
STIGL001  MOVE      QRYDATA,PRIGL001
          GOTO      STIGL999
.
STIGL002  UNPACK    QRYDATA,CDAY,KEY1,MTHNAM3,KEY1,CCENT,CYEAR
          CALL      SETMTH00
          PACK      PRIGL002,CDAY,CMON,CCENT,CYEAR  * Backwards for KEYIN
          REP       " 0",PRIGL002
          GOTO      STIGL999
.
STIGL003  SQUEEZE   QRYDATA 
          MOVE      QRYDATA,PRIGL003
          PACK      PRIGL003,PRIGL003,SP70
          MATCH     "Start",PRIGL003
          IF        @EQUAL
            MOVE      SP70,PRIGL003
          ENDIF          
          GOTO      STIGL999
.
STIGL004  SQUEEZE   QRYDATA 
          MOVE      QRYDATA,PRIGL004
          PACK      PRIGL004,PRIGL004,SP70
          MATCH     "Finish",PRIGL004
          IF        @EQUAL
            MOVE      SP70,PRIGL004
          ENDIF          
          GOTO      STIGL999
.
STIGL005  MOVE      QRYDATA,PRIGL005
          GOTO      STIGL999
.
STIGL006  MOVE      QRYDATA,PRIGL006
          GOTO      STIGL999
.
STIGL007  MOVE      QRYDATA,PRIGL007
          GOTO      STIGL999
.
STIGL008  MOVE      QRYDATA,PRIGL008
          GOTO      STIGL999
.
STIGL009  MOVE      QRYDATA,PRIGL009
          GOTO      STIGL999
.
STIGL010  MOVE      QRYDATA,PRIGL010
          GOTO      STIGL999
.
STIGL999  RETURN
.-------------------------------------------------------------------------------
.   Set Parameters for Option 3 - Private Practice AMA/MBS Other Items 
.-------------------------------------------------------------------------------
STOTH000  UNPACK    QRYNAME,KEY5,KEY3
          MOVE      KEY3,F3
          BRANCH    F3,STOTH001,STOTH002,STOTH003,STOTH004,STOTH005:
                       STOTH006
.
          GOTO      STOTH999
.
STOTH001  MOVE      QRYDATA,OTHIT001
          GOTO      STOTH999

STOTH002  SQUEEZE   QRYDATA 
          MOVE      QRYDATA,OTHIT002
          PACK      OTHIT002,OTHIT002,SP70
          GOTO      STOTH999

STOTH003  SQUEEZE   QRYDATA 
          MOVE      QRYDATA,OTHIT003
          PACK      OTHIT003,OTHIT003,SP70
          GOTO      STOTH999
.
STOTH004  MOVE      QRYDATA,OTHIT004
          GOTO      STOTH999
.
STOTH005  SQUEEZE   QRYDATA 
          MOVE      QRYDATA,OTHIT005
          PACK      OTHIT005,OTHIT005,SP70
          GOTO      STOTH999
.
STOTH006  SQUEEZE   QRYDATA 
          MOVE      QRYDATA,OTHIT006
          PACK      OTHIT006,OTHIT006,SP70
          GOTO      STOTH999
.
STOTH999  RETURN
.-------------------------------------------------------------------------------
.   Set Parameters for Option 1 - Medicare Gap
.-------------------------------------------------------------------------------
STMGP000  UNPACK    QRYNAME,KEY5,KEY3
          MOVE      KEY3,F3
          BRANCH    F3,STMGP001,STMGP002
.
          GOTO      STMGP999
.
STMGP001  MOVE      QRYDATA,KEY11   * Change Date as format is (DD MON CCYY)
          PACK      KEY11,KEY11,SP70
          UNPACK    KEY11,KEY8,KEY3
          MATCH     SP70,KEY3
          IF        !@EQUAL
            UNPACK    QRYDATA,CDAY,KEY1,MTHNAM3,KEY1,CCENT,CYEAR
            CALL      SETMTH00
            PACK      PRIMG001,CCENT,CYEAR,CMON,CDAY
            REP       " 0",PRIMG001
          ELSE
            MOVE      QRYDATA,PRIMG001
          ENDIF
          GOTO      STMGP999
.
STMGP002  MOVE      QRYDATA,PRIMG002
          GOTO      STMGP999
.
STMGP999  RETURN
.-------------------------------------------------------------------------------
.   Set Parameters for Option 4 - Common Items Templates Header 
.-------------------------------------------------------------------------------
STTHD000  UNPACK    QRYNAME,KEY5,KEY3
          MOVE      KEY3,F3
          BRANCH    F3,STTHD001,STTHD002,STTHD003
.
          GOTO      STTHD999

STTHD001  SQUEEZE   QRYDATA 
          MOVE      QRYDATA,PRITH001
          PACK      PRITH001,PRITH001,SP70
          GOTO      STTHD999
.
STTHD002  MOVE      QRYDATA,PRITH002
          GOTO      STTHD999
.
STTHD003  MOVE      QRYDATA,PRITH003
          GOTO      STTHD999

STTHD999  RETURN
.-------------------------------------------------------------------------------
.   Set Parameters for Option 5 - Common Items Templates Details 
.-------------------------------------------------------------------------------
STTDT000  UNPACK    QRYNAME,KEY5,KEY3
          MOVE      KEY3,F3
          BRANCH    F3,STTDT001,STTDT002,STTDT003,STTDT004,STTDT005,STTDT006
.
          GOTO      STTDT999

STTDT001  SQUEEZE   QRYDATA 
          MOVE      QRYDATA,PRITD001
          PACK      PRITD001,PRITD001,SP70
          GOTO      STTDT999
.
STTDT002  PACK      QRYDATA,QRYDATA,SP30
          UNPACK    QRYDATA,KEY1,KEY2 * Check for formatted or unformatted
          MATCH     SP70,KEY2
          IF        @EQUAL
            MOVE      QRYDATA,PRITD002 * Do not change format 
          ELSE
            MATCH     "MBS",QRYDATA
            IF        @EQUAL
              MOVE      ZERO,PRITD002   * MBS
            ELSE
              MOVE      ONE,PRITD002    * AMA
            ENDIF
          ENDIF
          GOTO      STTDT999

STTDT003  SQUEEZE   QRYDATA 
          MOVE      QRYDATA,PRITD003
          PACK      PRITD003,PRITD003,SP70
          GOTO      STTDT999
.
STTDT004  MOVE      QRYDATA,PRITD004
          GOTO      STTDT999
.
STTDT005  MOVE      QRYDATA,PRITD005
          GOTO      STTDT999
.
STTDT006  MOVE      QRYDATA,PRITD006
          GOTO      STTDT999

STTDT999  RETURN
.-------------------------------------------------------------------------------
.   Set Parameters for Option 3 - Pathology Test Maintenance
.-------------------------------------------------------------------------------
STITS000  UNPACK    QRYNAME,KEY5,KEY3
          MOVE      KEY3,F3
          BRANCH    F3,STITS001,STITS002,STITS003,STITS004,STITS005:
                       STITS006,STITS007,STITS008,STITS009
          GOTO      STITS999
.
STITS001  SQUEEZE   QRYDATA 
          MOVE      QRYDATA,PRITS001
          PACK      PRITS001,PRITS001,SP70
          GOTO      STITS999
.
STITS002  MOVE      QRYDATA,KEY11   * Change Date as format is (DD MON CCYY)
          PACK      KEY11,KEY11,SP70
          UNPACK    KEY11,KEY8,KEY3
          MATCH     SP70,KEY3
          IF        !@EQUAL
            UNPACK    QRYDATA,CDAY,KEY1,MTHNAM3,KEY1,CCENT,CYEAR
            CALL      SETMTH00
            PACK      PRITS002,CCENT,CYEAR,CMON,CDAY
            REP       " 0",PRITS002
          ELSE
            MOVE      QRYDATA,PRITS002
          ENDIF
          GOTO      STITS999
.
STITS003  MOVE      QRYDATA,PRITS003
          GOTO      STITS999
.
STITS004  SQUEEZE   QRYDATA 
          MOVE      QRYDATA,PRITS004
          PACK      PRITS004,PRITS004,SP70
          GOTO      STITS999
.
STITS005  SQUEEZE   QRYDATA 
          MOVE      QRYDATA,PRITS005
          PACK      PRITS005,PRITS005,SP70
          GOTO      STITS999
.
STITS006  SQUEEZE   QRYDATA 
          MOVE      QRYDATA,PRITS006
          PACK      PRITS006,PRITS006,SP70
          GOTO      STITS999
.
STITS007  SQUEEZE   QRYDATA 
          MOVE      QRYDATA,PRITS007
          PACK      PRITS007,PRITS007,SP70
          GOTO      STITS999
.
STITS008  MOVE      QRYDATA,PRITS008
          GOTO      STITS999
.
STITS009  MOVE      QRYDATA,PRITS009
          GOTO      STITS999
.
STITS999  RETURN
.-------------------------------------------------------------------------------
.   Set Parameters for Option 7 - Multiple Services Maintenance
.-------------------------------------------------------------------------------
STMUL000  UNPACK    QRYNAME,KEY5,KEY3
          MOVE      KEY3,F3
          BRANCH    F3,STMUL001,STMUL002,STMUL003,STMUL004,STMUL005:
                       STMUL006,STMUL007
          GOTO      STMUL999
.
STMUL001  SQUEEZE   QRYDATA 
          MOVE      QRYDATA,PRIML001
          PACK      PRIML001,PRIML001,SP70
          GOTO      STMUL999
.
STMUL002  MOVE      QRYDATA,KEY11   * Change Date as format is (DD MON CCYY)
          PACK      KEY11,KEY11,SP70
          UNPACK    KEY11,KEY8,KEY3
          MATCH     SP70,KEY3
          IF        !@EQUAL
            UNPACK    QRYDATA,CDAY,KEY1,MTHNAM3,KEY1,CCENT,CYEAR
            CALL      SETMTH00
            PACK      PRIML002,CCENT,CYEAR,CMON,CDAY
            REP       " 0",PRIML002
          ELSE
            MOVE      QRYDATA,PRIML002
          ENDIF
          GOTO      STMUL999
.
STMUL003  MOVE      QRYDATA,PRIML003
          GOTO      STMUL999
.
STMUL004  MOVE      QRYDATA,PRIML004
          GOTO      STMUL999
.
STMUL005  SQUEEZE   QRYDATA 
          MOVE      QRYDATA,PRIML005
          PACK      PRIML005,PRIML005,SP70
          GOTO      STMUL999
.
STMUL006  SQUEEZE   QRYDATA 
          MOVE      QRYDATA,PRIML006
          PACK      PRIML006,PRIML006,SP70
          GOTO      STMUL999
.
STMUL007  SQUEEZE   QRYDATA 
          MOVE      QRYDATA,PRIML007
          PACK      PRIML007,PRIML007,SP70
          GOTO      STMUL999
.
STMUL999  RETURN
.------------------------------------------------------------
. Check ICD Record
.   Required  - VALDCODE
.             - VALDTYPE 
.               1. Validate AMA/MBS for Multiple Tests
.               2. Validate AMA/MBS for Pathology Tests
.               3. Validate Multiple Services Code 
.------------------------------------------------------------
REMOTE00  BRANCH    VALDTYPE,REMOTE10,REMOTE20,REMOTE30,REMOTE40,REMOTE50
          GOTO      REMOTE90
.
REMOTE10  CALL      VALITM00     * Validate AMA/MBS for Multiple Tests
          GOTO      REMOTE99
.
REMOTE20  CALL      PATHIT00     * Validate AMA/MBS for Pathology Maintenance 
          GOTO      REMOTE99
.
REMOTE30  CALL      VALMUL00     * Validate Multiple Services Code 
          GOTO      REMOTE99
.
REMOTE40  MOVE      ONE,VALDONLY
          CALL      VALITM00     * Validate AMA/MBS 
          GOTO      REMOTE99
.
REMOTE50  CALL      OUTITM00     * Output Common Item Template
          GOTO      REMOTE99
.
REMOTE90  CALL      XMLHED00
          WRITE     HTMLFILE;"<RETURN_VALUE TYPE=ERROR>":
                             "Invalid Validation Type":
                             "</RETURN_VALUE>"
          CALL      XMLEND00
          GOTO      REMOTE99
.
REMOTE99  RETURN
.------------------------------------------------------------
. Validate AMA/MBS for Multiple Tests
. INPUTS: ITEMTYPE - Item Type
.         ITEMNUMB - Item Number 
.         SUBITEMN - Sub Item 
.         PRIML002 - Effective Date
.------------------------------------------------------------
VALITM00  CALL      XMLHED00
          BRANCH    EXIT,VALITM99
.
          MOVE      ONE,FOUNDFLG
          MOVE      ITEMTYPE,F2
          MOVE      "MBS",KEY3
          IF        F2=1
            MOVE      "AMA",KEY3
          ENDIF
          PACK      KEY22,F2,ITEMNUMB,SUBITEMN,NINE8 
          CALL      RSPRIT1                      * position in file
VALITM10  CALL      RPPRIT1                      * read previous record
          BRANCH    OVRCD,VALITM90               * end of file
.
          COMPARE   F2,PRITFLAG                  * same item type ?
          GOTO      VALITM90 IF NOT EQUAL        * no
.
          MATCH     ITEMNUMB,PRITITMN            * same item number ?
          GOTO      VALITM90 IF NOT EQUAL        * no
.
          MATCH     SUBITEMN,PRITSUBN            * same subitem number ?
          GOTO      VALITM90 IF NOT EQUAL        * no
          MOVE      ZERO,FOUNDFLG
.
          MATCH     PRITDAT1,PRIML002            * item date > mult. serv date ?
          GOTO      VALITM10 IF LESS             * yes
.
          MATCH     SP8,PRITDAT2            * is there a Cease Date?  *I-230710
          IF        !@EQUAL
            MATCH     PRIML002,PRITDAT2     * Item Cease date < mult.serv date?
            GOTO      VALITM10 IF LESS      * yes
          ENDIF                                                 * end *I-230710
.
          BRANCH    VALDONLY,VALITM20
.
          COMPARE   ZERO,PRITPATH                * pathology item ?
          GOTO      VALITM91 IF NOT EQUAL        * No 
.
.  Dummy ouput for valid Code
.
VALITM20  WRITE     HTMLFILE;"<RETURN_VALUE TYPE=SIMPLE>":
                              PRITDESC:
                             "</RETURN_VALUE>"
.
          GOTO      VALITM98
.
VALITM90  BRANCH    FOUNDFLG,VALITM92
          WRITE     HTMLFILE;"<RETURN_VALUE TYPE=ERROR>":
                             "Item ",ITEMNUMB," Effective Date is not less":
                             " Code Effective Date. ":
                             "</RETURN_VALUE>"
          GOTO      VALITM98
.
VALITM91  WRITE     HTMLFILE;"<RETURN_VALUE TYPE=ERROR>":
                             "Not a pathology item. Item: ":
                             ITEMNUMB:
                             "</RETURN_VALUE>"
          GOTO      VALITM98
.
VALITM92  WRITE     HTMLFILE;"<RETURN_VALUE TYPE=ERROR>":
                             "Item ",KEY3,"-",ITEMNUMB;
.
          MATCH     SP10,SUBITEMN
          IF        !@EQUAL
            WRITE     HTMLFILE;"(",SUBITEMN,")";
          ENDIF
.
          WRITE     HTMLFILE;" not Found.":
                             "</RETURN_VALUE>"
          GOTO      VALITM98
.
VALITM98  CALL      XMLEND00
VALITM99  RETURN
.------------------------------------------------------------
. Validate AMA/MBS for Pathology Maintenance
. INPUTS: ITEMTYPE - Item Type
.         ITEMNUMB - Item Number 
.         SUBITEMN - Sub Item 
.         PRITS002 - Effective Date
.------------------------------------------------------------
PATHIT00  CALL      XMLHED00
          BRANCH    EXIT,PATHIT99

          MOVE      ITEMTYPE,F2
          PACK      KEY22,F2,ITEMNUMB,SUBITEMN,SP70
          CALL      RSPRIT1
          CALL      RKPRIT1
          BRANCH    OVRCD,PATHIT90                         
.
          COMPARE   F2,PRITFLAG
          GOTO      PATHIT90 IF NOT EQUAL
.
          MATCH     ITEMNUMB,PRITITMN
          GOTO      PATHIT90 IF NOT EQUAL
.
          MATCH     SUBITEMN,PRITSUBN
          GOTO      PATHIT90 IF NOT EQUAL
.
          MOVE      ITEMTYPE,F2
          PACK      KEY22,F2,ITEMNUMB,SUBITEMN,PRITS002,SP70
          CALL      RDPRIT1
          BRANCH    OVRCD,PATHIT91                         
.
          COMPARE   ZERO,PRITPATH                * pathology item ?
          GOTO      PATHIT92 IF NOT EQUAL        * No 
.
.  Dummy ouput for valid Code
.
          WRITE     HTMLFILE;"<RETURN_VALUE TYPE=SIMPLE>":
                              PRITDESC:
                             "</RETURN_VALUE>"
.
          GOTO      PATHIT98
.
PATHIT90  WRITE     HTMLFILE;"<RETURN_VALUE TYPE=ERROR>":
                             "Item Code not found. ":
                             "</RETURN_VALUE>"
          GOTO      PATHIT98
.
PATHIT91  WRITE     HTMLFILE;"<RETURN_VALUE TYPE=ERROR>":
                             "Item Effective Date is not equal to Code ":
                             " Effective Date. ":
                             "</RETURN_VALUE>"
          GOTO      PATHIT98
.
PATHIT92  WRITE     HTMLFILE;"<RETURN_VALUE TYPE=ERROR>":
                             "Not a pathology item. ":
                             "</RETURN_VALUE>"
          GOTO      PATHIT98
.
PATHIT98  CALL      XMLEND00
PATHIT99  RETURN
.------------------------------------------------------------
. Validate Multiple Services Code           
. INPUTS: PRITS007 - Multiple Service Code
.         PRITS002 - Effective Date
.------------------------------------------------------------
VALMUL00  CALL      XMLHED00
          BRANCH    EXIT,VALMUL99
.
          PACK      KEY16,PRITS007,SP70
          CALL      RSPRMU1                      * position in file
          CALL      RKPRMU1                      * read previous record
          BRANCH    OVRCD,VALMUL90               * end of file
.
          MATCH     PRITS007,PRMUCODE            * same code ?
          GOTO      VALMUL90 IF NOT EQUAL        * no
.
          PACK      KEY16,PRITS007,PRITS002,NINE3
          CALL      RSPRMU1                      * position in file
          CALL      RPPRMU1                      * read previous record
          BRANCH    OVRCD,VALMUL91               * end of file
.
.         The effective date for the test code, must be equal to or
.         greater than the first multiple services code on file
.
          MATCH     PRITS007,PRMUCODE            * same code ?
          GOTO      VALMUL91 IF NOT EQUAL        * no
.
          MATCH     PRMUDATE,PRITS002            * test effective date = or >
          GOTO      VALMUL91 IF LESS             * no
.
.  Dummy ouput for valid Code
.
          WRITE     HTMLFILE;"<RETURN_VALUE TYPE=SIMPLE>":
                              PRMUDESC:
                             "</RETURN_VALUE>"
.
          GOTO      VALMUL98
.
VALMUL90  WRITE     HTMLFILE;"<RETURN_VALUE TYPE=ERROR>":
                             "Multiple service code not on file. ":
                             "</RETURN_VALUE>"
          GOTO      VALMUL98
.
VALMUL91  WRITE     HTMLFILE;"<RETURN_VALUE TYPE=ERROR>":
                             "Multiple Service Code Effective Date is not ":
                             "less than Pathology Effective Date. ":
                             "</RETURN_VALUE>"
          GOTO      VALMUL98
.
VALMUL98  CALL      XMLEND00
VALMUL99  RETURN
.------------------------------------------------------------
. Output common item template details
. INPUTS: CMBSTEMP - Common Template ID
.         VALDEFDT - Date (eg clinic date) to compare to 'effective date'
.------------------------------------------------------------
OUTITM00  CALL      XMLHED00
          BRANCH    EXIT,OUTITM99
.
          MOVE      ZERO,ITMCOUNT                * init item counter
          PACK      KEY8,CMBSTEMP,SP70
          CALL      RSPRTDT1
          CALL      RKPRTDT1                     * read template id file
          BRANCH    OVRCD,OUTITM95
.
          MATCH     CMBSTEMP,PRTDTMID            * check if template id exists
          GOTO      OUTITM95 IF NOT EQUAL
.
          WRITE     HTMLFILE;"<RETURN_VALUE TYPE=SIMPLE>";
.
          CALL      RPPRTDT1
OUTITM10  CALL      RKPRTDT1                     * loop thru template id file
          BRANCH    OVRCD,OUTITM90
.
          MATCH     CMBSTEMP,PRTDTMID
          GOTO      OUTITM80 IF NOT EQUAL        * same template id?
.
          PACK      KEY2,SP1,PRTDTYPE
          PACK      KEY22,KEY2,PRTDCODE,PRTDSUBI,Z70
          CALL      RSPRIT1
OUTITM20  CALL      RPPRIT1                      * validate each item/get desc
          BRANCH    OVRCD,OUTITM80
.
          MATCH     KEY2,DPRITFLG
          GOTO      OUTITM80 IF NOT EQUAL
.
          MATCH     PRTDCODE,PRITITMN
          GOTO      OUTITM80 IF NOT EQUAL
.
          MATCH     SP70,PRTDSUBI
          IF        !@EQUAL
            MATCH     PRTDSUBI,PRITSUBN
            GOTO      OUTITM80 IF NOT EQUAL
          ENDIF
.
          MATCH     SP70,VALDEFDT
          IF        !@EQUAL
            MATCH     PRITDAT1,VALDEFDT
            GOTO      OUTITM20 IF LESS
            MATCH     SP8,PRITDAT2          * is there a Cease date?  *I-230710
            IF        !@EQUAL
              MATCH     VALDEFDT,PRITDAT2   * has item ceased?
              GOTO      OUTITM20 IF LESS    * item ceased, read next record
            ENDIF                                               * end *I-230710
          ENDIF
.
          MATCH     " 0",DPRITFLG
          IF        @EQUAL
            MOVE      "MBS",DIM3
          ELSE
            MOVE      "AMA",DIM3
          ENDIF
          MOVE      PRITSFEE,DIM15
          GOTO      OUTITM85
.
OUTITM80  MOVE      SP70,DIM3                    * clear output vars
          MOVE      SP70,PRITITMN
          MOVE      SP70,PRITSUBN
          MOVE      SP70,PRITDESC
          MOVE      SP70,DIM15
.
OUTITM85  WRITE     HTMLFILE;DIM3,"|",PRITITMN,"|",PRITSUBN,"|",PRITDESC,"|":
                             DIM15,"|";
          ADD       ONE,ITMCOUNT
          IF        ITMCOUNT < 5
            GOTO      OUTITM10                   * only want max of 5 items
          ENDIF
.
OUTITM90  WRITE     HTMLFILE;"</RETURN_VALUE>"
          GOTO      OUTITM98
.
OUTITM95  WRITE     HTMLFILE;"<RETURN_VALUE TYPE=ERROR>":
                             "Error loading CMBS Template.":
                             "</RETURN_VALUE>"
          GOTO      OUTITM98
.
OUTITM98  CALL      XMLEND00
OUTITM99  RETURN
.------------------------------------------------------------
. Medicare Gap Maintenance: Display,Add,Update,Delete
.------------------------------------------------------------
PRIMGP00  RESET     UPDTTYPE
          MATCH     SP1,UPDTTYPE
          GOTO      PRIMGP40 IF EQUAL
.
          MATCH     "A",UPDTTYPE    * Add formaction
          GOTO      PRIMGP10 IF EQUAL
.
          MATCH     "U",UPDTTYPE    * Update formaction
          GOTO      PRIMGP20 IF EQUAL
.
          MATCH     "D",UPDTTYPE    * Delete formaction
          GOTO      PRIMGP30 IF EQUAL
.
          GOTO      PRIMGP93
.
.         ************ ADD FORMACTION ***********
.
PRIMGP10  PACK      KEY8,PRIMG001,SP70
          CALL      RDPRMG1
          COMPARE   ZERO,OVRCD
          GOTO      PRIMGP92 IF EQUAL
.
          CALL      MGPSAV00      * Moves input variables to file variables
.
          CALL      WRPRMG1       * Writes away the data
.
          MOVE      ZERO,EXIT
          GOTO      PRIMGP99
.
.         ************ UPDATE FORMACTION **********
.
PRIMGP20  PACK      KEY8,PRIMG001,SP70   
          CALL      RDPRMG1
          BRANCH    OVRCD,PRIMGP91

          CALL      MGPSAV00      * Moves input variables to file variables
          CALL      UPPRMG1       * Writes away the data
.
          MOVE      ZERO,EXIT
          GOTO      PRIMGP99
.
.         ************ DELETE FORMACTION **********
.
PRIMGP30  PACK      KEY8,PRIMG001,SP70   
          CALL      RDPRMG1
          BRANCH    OVRCD,PRIMGP91
.
          CALL      DEPRMG1
.
          MOVE      ZERO,EXIT
          GOTO      PRIMGP99
.
.         ************ DISPLAY FORMACTION **********
.
PRIMGP40  PACK      KEY8,PRIMG001,SP70
          CALL      RDPRMG1
          IF        OVRCD=1
            CALL      CLRMGP00    * Clear all the file variables
          ENDIF
.
          CLEAR     WEBTITLE
          MOVE      "Medicare Gap Maintenance",WEBTITLE
          RESET     WEBTITLE
.
          CALL      WEBHED00   * Create Output File and Write HTML Page Header
          BRANCH    EXIT,PRIMGP99
          CALL      WEBBOD00   * Process Web Body
          CALL      WEBEND00   * Process End of HTML File
          MOVE      ONE,EXIT
          GOTO      PRIMGP99
.
PRIMGP91  MOVE      "Medicare Gap Code record does not exist",WEBTITLE
          CALL      WEBERR00
          MOVE      ONE,EXIT
          GOTO      PRIMGP99
.
PRIMGP92  MOVE      "Medicare Gap Code record exists",WEBTITLE
          CALL      WEBERR00
          MOVE      ONE,EXIT
          GOTO      PRIMGP99
.
PRIMGP93  MOVE      "Invalid Form Action.",WEBTITLE
          CALL      WEBERR00
          MOVE      ONE,EXIT
          GOTO      PRIMGP99
.
PRIMGP99  RETURN
.-----------------------------------------------------------
. Initialize's file data
.-----------------------------------------------------------
CLRMGP00  MOVE      SP70,PRMGDATE  * Effective Date
          MOVE      ZERO,PRMGVALU  * Gap Value 
          MOVE      SP70,PRMGSPAR  * Spare Variable
.
CLRMGP99  RETURN
.-----------------------------------------------------------
. Save routine - move cgi parameters into file variables
.-----------------------------------------------------------
MGPSAV00  MOVE      PRIMG001,PRMGDATE  * Effective Date
          MOVE      PRIMG002,PRMGVALU  * Gap Value
          MOVE      SP70,PRMGSPAR      * Spare Variable
.
MGPSAV99  RETURN
.------------------------------------------------------------
. AMA/MBS Item Coding Maintenance: Display,Add,Update,Delete
.------------------------------------------------------------
PRIITM00  RESET     UPDTTYPE 
          MATCH     SP1,UPDTTYPE
          GOTO      PRIITM60 IF EQUAL
.
          MATCH     "A",UPDTTYPE    * Add formaction
          GOTO      PRIITM10 IF EQUAL
.
          MATCH     "U",UPDTTYPE    * Update formaction
          GOTO      PRIITM20 IF EQUAL
.
          MATCH     "D",UPDTTYPE    * Delete formaction
          GOTO      PRIITM30 IF EQUAL
.
          MATCH     "P",UPDTTYPE    * % Item Fee Increase
          GOTO      PRIITM40 IF EQUAL
.
          MATCH     "F",UPDTTYPE    * Update Fees From a Data File
          GOTO      PRIITM50 IF EQUAL
.
          MATCH     "C",UPDTTYPE    * Copy Schedule Fees 
          GOTO      PRIITM55 IF EQUAL
.
          GOTO      PRIITM93
.
.  *********** ADD FORMACTION ***********
.
PRIITM10  PACK      KEY22,PRITM001,PRITM002,PRITM003,PRITM004,SP70  
          MOVE      KEY22,SAVKEY22          * save for CEASE000       *I-230710
          CALL      RDPRIT1
          COMPARE   ZERO,OVRCD
          GOTO      PRIITM92 IF EQUAL
.
          CALL      CLRITM00
          CALL      SAVITM00      * Moves input variables to file variables
          CALL      WRPRIT1      * Writes away the data
.
          MOVE      PRITFLAG,ITEMTYP  * Input var for PRIIKIUP
          MOVE      PRITITMN,ITEMNO   * Input var for PRIIKIUP
          MOVE      PRITDESC,ITEMDESC * Input var for PRIIKIUP
          PROC      PRIIKIUP
.
          MATCH     "0",PRITM015            * is this a Pathology test ?
          CALL      ADDPTE00 IF EQUAL       * add the Item to "pritestf"
.
.                                                                     *I-230710
          CALL      CEASE000                * add Cease Date to earlier Items
.
          MOVE      ZERO,EXIT
          GOTO      PRIITM99
.
.  *********** UPDATE FORMACTION ************
.
PRIITM20  PACK      KEY22,PRITM001,PRITM002,PRITM003,PRITM004,SP70
          MOVE      KEY22,SAVKEY22          * save for CEASE000       *I-230710
          CALL      RDPRIT1
          BRANCH    OVRCD,PRIITM91
.
          CALL      SAVITM00                * Moves input vars to file variables
          CALL      UPPRIT1                 * Writes away the data
.
          MOVE      PRITFLAG,ITEMTYP  * Input var for PRIIKIUP
          MOVE      PRITITMN,ITEMNO   * Input var for PRIIKIUP
          MOVE      PRITDESC,ITEMDESC * Input var for PRIIKIUP
          PROC      PRIIKIUP
.
PRIITM25  MATCH     "0",PRITM015            * is this a Pathology test ?
          IF        @EQUAL
            CALL      ADDPTE00              * add the Item to "pritestf"
          ELSE
            CALL      DELPTE00              * delete Item from "pritestf"
          ENDIF
.
.                                                                     *I-230710
          CALL      CEASE000                * add Cease Date to earlier Items
.
          MOVE      ZERO,EXIT
          GOTO      PRIITM99
.
.  ********** DELETE FORMACTION ***********
.
PRIITM30  PACK      KEY22,PRITM001,PRITM002,PRITM003,PRITM004,SP70
          CALL      RDPRIT1
          BRANCH    OVRCD,PRIITM91
.
          CALL      DEPRIT1      * Deletes the data
.         
          CALL      DELPTE00     * Delete Pathology Test record
.
          MOVE      PRITFLAG,ITEMTYP * Input var for PRIIKIUP
          MOVE      PRITITMN,ITEMNO  * Input var for PRIIKIUP
          MOVE      PRITDESC,ITEMDESC * Input var for PRIIKIUP
          PROC      PRIIKIUP
.
          CALL      DELOTH00     * Delete Other Item records
.
          MOVE      ZERO,EXIT
          GOTO      PRIITM99
.
.  ********** GLOBAL FUNCTIONS ***********
.
PRIITM40  CALL      FEEINC00      * % Item Fee Increase
          GOTO      PRIITM99
.
PRIITM50  CALL      FEEUPD00      * Update Fees from a Data File
          GOTO      PRIITM99
.
PRIITM55  CALL      FEECOP00      * Copy Schedule Fees 
          GOTO      PRIITM99
.
.  ********** DISPLAY FORMACTION ***********
.
PRIITM60  PACK      KEY22,PRITM001,PRITM002,PRITM003,PRITM004,SP70
          CALL      RDPRIT1
          IF        OVRCD=1
            CALL      CLRITM00    * Clear all the file variables
          ENDIF
.
          CLEAR     WEBTITLE
          MOVE      "AMA/MBS Item Maintenance",WEBTITLE
          RESET     WEBTITLE
.
          CALL      WEBHED00   * Create Output File and Write HTML Page Header
          BRANCH    EXIT,PRIITM99
          CALL      WEBBOD00   * Process Web Body
          CALL      WEBEND00   * Process End of HTML File
          MOVE      ONE,EXIT
          GOTO      PRIITM99
.
PRIITM91  MOVE      "AMA/MBS Item Code does not exist",WEBTITLE
          CALL      WEBERR00
          MOVE      ONE,EXIT
          GOTO      PRIITM99
.
PRIITM92  MOVE      "AMA/MBS Item Code exists",WEBTITLE
          CALL      WEBERR00
          MOVE      ONE,EXIT
          GOTO      PRIITM99
.
PRIITM93  MOVE      "Invalid Form Action.",WEBTITLE
          CALL      WEBERR00
          MOVE      ONE,EXIT
          GOTO      PRIITM99
.
PRIITM99  RETURN
.
.-------------------------------------------------------------------------------
. Routine to insert Cease Date into all old Items                     *I-230710
.-------------------------------------------------------------------------------
CEASE000  MOVE      SAVKEY22,KEY22
          CALL      RDPRIT1
          BRANCH    OVRCD,CEASE999
.
          PACK      CURRDATE,CCC,CYY,CMM,CDD
          REP       " 0",CURRDATE
          UNPACK    SAVKEY22,PRITM001,PRITM002,PRITM003,PRITM004   *restore keys
          MOVE      PRITDAT1,PREVEFDT       * save Effective Date of latest
.
.                                           * read thru earlier Item records
CEASE100  CALL      RPPRIT1
          BRANCH    OVRCD,CEASE999
.
          MATCH     DPRITFLG,PRITM001
          GOTO      CEASE999 IF NOT EQUAL
.
          MATCH     PRITITMN,PRITM002
          GOTO      CEASE999 IF NOT EQUAL
.
          MATCH     PRITSUBN,PRITM003
          GOTO      CEASE999 IF NOT EQUAL
.
          MATCH     SP8,PRITDAT2            * don't change if already dated
          GOTO      CEASE200 IF NOT EQUAL
.
.          MATCH     CURRDATE,PREVEFDT       * don't change if in the future
.          GOTO      CEASE200 IF NOT LESS
.
          MOVE      PREVEFDT,WORKDATE       * save Effective Date of latest
          SUB       ONE,WORKDATE
          MOVE      WORKDATE,PRITDAT2       * read thru earlier Item records
          CALL      UPPRIT1
.
CEASE200  MOVE      PRITDAT1,PREVEFDT       * update previous Effective date
          GOTO      CEASE100
.
CEASE999  RETURN
.
.-------------------------------------------------------------------------------
. Add Item to Pathology Test table
.-------------------------------------------------------------------------------
ADDPTE00  PACK      KEY17,PRITITMN,PRITDAT1,SP70
          CALL      RDPRTE1
          COMPARE   ZERO,OVRCD              * already exists ?
          GOTO      ADDPTE99 IF EQUAL
.
          MOVE      PRITITMN,PRTECODE   * Test Code
          MOVE      PRITDAT1,PRTEDATE   * Date Effective From
          MOVE      PRITDESC,PRTEDESC   * Test Description
          UNPACK    SP70,PRTEITMN,PRTESUBN,PRTEAMAN
          IF        PRITFLAG = 0
            MOVE      PRITITMN,PRTEITMN * MBS Item Number
            MOVE      PRITSUBN,PRTESUBN * MBS Subitem Number
          ELSE
            MOVE      PRITITMN,PRTEAMAN * AMA Item Number
          ENDIF
          MOVE      SP5,PRTEMSER        * Multiple Services Code
          MOVE      "  1",PRTETESN      * Number of Procedures
          MOVE      SP4,PRTEABRV        * Standard Abbreviation
          CALL      WRPRTE1             * Writes away the data
.
          MOVE      PRTECODE,TESTCODE   * Input var for PRITKIUP
          MOVE      PRTEDESC,ITEMDESC   * Input var for PRITKIUP
          PROC      PRITKIUP            * Update Pathology Test Keyword Index
.
ADDPTE99  RETURN
.-------------------------------------------------------------------------------
. Delete Item from Pathology Test table
.-------------------------------------------------------------------------------
DELPTE00  PACK      KEY17,PRITITMN,PRITDAT1,SP70
          CALL      RDPRTE1
          BRANCH    OVRCD,DELPTE99
.
          MATCH     SP3,PRITSUBN
          GOTO      DELPTE99 IF NOT EQUAL
.
          CALL      DEPRTE1             * Writes away the data
.
          MOVE      PRTECODE,TESTCODE   * Input var for PRITKIUP
          MOVE      PRTEDESC,ITEMDESC   * Input var for PRITKIUP
          PROC      PRITKIUP            * Update Pathology Test Keyword Index
.
DELPTE99  RETURN
.
.-------------------------------------------------------------------------------
. Clear File Vars                     
.-------------------------------------------------------------------------------
CLRITM00  MOVE      ZERO,PRITFLAG  * Item Type
          MOVE      SP70,PRITITMN  * MBS Item Number
          MOVE      SP70,PRITSUBN  * MBS Subitem Number
          MOVE      SP70,PRITDAT1  * Date item commenced (CCYYMMDD format)
          MOVE      SP70,PRITDESC  * Item Description
          MOVE      ZERO,PRITKEYI  * Keyin Indicator
          MOVE      ZERO,PRITSFEE  * Item Schedule Fee ($)
          MOVE      SP70,PRITSETC  * Set Code (Category PG)
          MOVE      SP70,PRITDAT2  * Date item will cease
          MOVE      SP70,PRITICAT  * Item Category
          MOVE      SP70,PRITIGRP  * Item Group
          MOVE      SP70,PRITSGRP  * Item Subgroup
          MOVE      SP70,PRITFTYP  * Fee Type
          MOVE      SP70,PRITPTYP  * Provider Type
          MOVE      ZERO,PRITPATH  * Pathology item indicator
          MOVE      ZERO,PRITMAXR  * Maximum no. of Requests
          MOVE      ZERO,PRITDAYS  * Period of Days
          MOVE      SP70,PRITSTEP  * Item to stepdown to after max req.
          MOVE      SP70,PRITSTSB  * Sub-item to stepdown to
          MOVE      ZERO,PRITFIXD  * Fixed charged item ?
          MOVE      ZERO,PRITGSTA  * GST Charge
          MOVE      SP70,PRITGSTC  * GST Payable Code
          MOVE      ZERO,PRITSF75  * Schedule Fee 75%
          MOVE      ZERO,PRITSF85  * Schedule Fee 85%
          MOVE      ZERO,PRITSAFE  * Suggested AMA Fee
          MOVE      SP70,PRITPDTI  * Print Service Date/Time on Invoice for
.                                  * this item
          MOVE      SP70,PRITSPAR  * Spare Variables
.
CLRITM99  RETURN
.-------------------------------------------------------------------------------
. Save CGI Vars                       
.-------------------------------------------------------------------------------
SAVITM00  MOVE      PRITM001,PRITFLAG   * Item Type 0=MBS 1=AMA
          MOVE      PRITM002,PRITITMN   * Item No.
          MOVE      PRITM003,PRITSUBN   * MBS Subitem No.
          MOVE      PRITM004,PRITDAT1   * Date Commenced 
.
          MATCH     Z70,PRITM005 
          IF        !@EQUAL
            MOVE      PRITM005,PRITDESC   * Item Description
          ENDIF 
.
          MATCH     Z70,PRITM006 
          IF        !@EQUAL
            MOVE      PRITM006,PRITKEYI   * Key Indicator
          ENDIF 
.
          MATCH     Z70,PRITM007 
          IF        !@EQUAL
            MATCH     SP70,PRITM007
             IF        @EQUAL|@EOS
               MOVE      ZERO,PRITSFEE  * Item Schedule Fee ($)
             ELSE
               MOVE      PRITM007,PRITSFEE  * Item Schedule Fee ($)
             ENDIF
          ENDIF 
.
          MATCH     Z70,PRITM008 
          IF        !@EQUAL
            MOVE      PRITM008,PRITSETC  * Set Code (Category PG)
          ENDIF 
.
          MATCH     Z70,PRITM009 
          IF        !@EQUAL
            MOVE      PRITM009,PRITDAT2  * Date item will cease
          ENDIF 
.
          MATCH     Z70,PRITM010 
          IF        !@EQUAL
            MOVE      PRITM010,PRITICAT  * Item Category
          ENDIF 
.
          MATCH     Z70,PRITM011 
          IF        !@EQUAL
            MOVE      PRITM011,PRITIGRP  * Item Group
          ENDIF 
.
          MATCH     Z70,PRITM012 
          IF        !@EQUAL
            MOVE      PRITM012,PRITSGRP  * Item Subgroup
          ENDIF 
.
          MATCH     Z70,PRITM013 
          IF        !@EQUAL
            MOVE      PRITM013,PRITFTYP  * Fee Type
          ENDIF 
.
          MATCH     Z70,PRITM014 
          IF        !@EQUAL
            MOVE      PRITM014,PRITPTYP  * Provider Type
          ENDIF 
.
          MATCH     Z70,PRITM015 
          IF        !@EQUAL
            MATCH     SP70,PRITM015
             IF        @EQUAL
               MOVE      ZERO,PRITPATH  * Pathology item indicator
             ELSE 
               MOVE      PRITM015,PRITPATH  * Pathology item indicator
             ENDIF
          ENDIF 
.
          MATCH     Z70,PRITM016 
          IF        !@EQUAL
            MATCH     SP70,PRITM016
             IF        @EQUAL
               MOVE      ZERO,PRITMAXR  * Maximum no. of Requests
             ELSE
               MOVE      PRITM016,PRITMAXR  * Maximum no. of Requests
             ENDIF
          ENDIF 
.
          MATCH     Z70,PRITM017 
          IF        !@EQUAL
            MATCH     SP70,PRITM017
             IF        @EQUAL
               MOVE      ZERO,PRITDAYS  * Period of Days
             ELSE
               MOVE      PRITM017,PRITDAYS  * Period of Days
             ENDIF
          ENDIF 
.
          MATCH     Z70,PRITM018 
          IF        !@EQUAL
            MOVE      PRITM018,PRITSTEP  * Item to stepdown to after max req.
          ENDIF 
.
          MATCH     Z70,PRITM019 
          IF        !@EQUAL
            MOVE      PRITM019,PRITSTSB  * Sub-item to stepdown to
          ENDIF 
.
          MATCH     Z70,PRITM020 
          IF        !@EQUAL
            MOVE      PRITM020,PRITFIXD  * Fixed charged item ?
          ENDIF 
.
          MATCH     Z70,PRITM021 
          IF        !@EQUAL
            MOVE      PRITM021,PRITGSTA  * GST Charge
          ENDIF 
.
          MATCH     Z70,PRITM022 
          IF        !@EQUAL
            MOVE      PRITM022,PRITGSTC  * GST Payable Code
          ENDIF 
.
          MATCH     Z70,PRITM023
          IF        !@EQUAL
            MATCH     SP70,PRITM023
            IF        @EQUAL|@EOS
              MOVE      ZERO,PRITSF75
            ELSE
              MOVE      PRITM023,PRITSF75
            ENDIF
          ENDIF
.
          MATCH     Z70,PRITM024
          IF        !@EQUAL
            MATCH     SP70,PRITM024
            IF        @EQUAL|@EOS
              MOVE      ZERO,PRITSF85
            ELSE
              MOVE      PRITM024,PRITSF85
            ENDIF
          ENDIF
.
          MATCH     Z70,PRITM025
          IF        !@EQUAL
            MATCH     SP70,PRITM025
            IF        @EQUAL|@EOS
              MOVE      ZERO,PRITSAFE
            ELSE
              MOVE      PRITM025,PRITSAFE
            ENDIF
          ENDIF
.
          MATCH     Z70,PRITM026
          IF        !@EQUAL
            MOVE      PRITM026,PRITPDTI
          ENDIF
.
          MOVE      SP70,PRITSPAR        * Spare Variables
.
SAVITM99  RETURN
.--------------------------------------------------------------------------
.   Delete Other Items Records
.--------------------------------------------------------------------------
DELOTH00  PACK      KEY34,PRITM001,PRITM002,PRITM003,PRITM004,SP70
          CALL      RSPRGP1
          CALL      RKPRGP1
          BRANCH    OVRCD,DELOTH99
.
          MATCH     PRITM001,DPRGPFLG      * Item Flag
          GOTO      DELOTH99 IF NOT EQUAL
.
          MATCH     PRITM002,PRGPITM1      * AMA/MBS Item
          GOTO      DELOTH99 IF NOT EQUAL
.
          MATCH     PRITM003,PRGPSUB1      * Subitem No.  
          GOTO      DELOTH99 IF NOT EQUAL
.
          MATCH     PRITM004,PRGPDATE      * Effective Date
          GOTO      DELOTH99 IF NOT EQUAL
.
          PACK      KEY34,PRGPFLAG,PRGPITM1,PRGPSUB1,PRGPDATE,PRGPITM2:
                          PRGPSUB2,SP70
          CALL      DEPRGP1      * Deletes the data
          GOTO      DELOTH00
.
DELOTH99  RETURN
.--------------------------------------------------------------------------
.*                             FEEINC00                                   *
.*   Schedule % Item Fee Increase - Option 4 IBAPRI16                     *
.--------------------------------------------------------------------------
FEEINC00  MOVE      "IBAPRI16",SCHDPGID
          MOVE      "Schedule % Item Fee Increase",SCHDDESC
          PACK      SCHDDATE,CCC,CYY,CMM,CDD
          REP       " 0",SCHDDATE
          CLOCK     TIME,SCHDTIME
.
.         Write Keyin parameters
.
          MOVE      FOUR,KEYSTARR[1]        * Option
          MOVE      PRIGL001,KEYSTARR[2]    * Item Type
          MOVE      PRIGL002,KEYSTARR[3]    * Effective Date
          MOVE      PRIGL003,KEYSTARR[4]    * From Item   
          MOVE      PRIGL004,KEYSTARR[5]    * Too Item  
          MOVE      PRIGL005,KEYSTARR[6]    * % Increase
.
          MOVE      "Y",KEYSTARR[7]         * Yes Increase
          MOVE      "0",KEYSTARR[8]         * Exit Screen
          MOVE      EIGHT,KEYSTCNT
.
          CALL      SCHPRO00   * Schedule Extract
.
FEEINC99  RETURN
.--------------------------------------------------------------------------
.*                             FEEUPD00                                   *
.*   Schedule Update Fees from a Data File - Option 5 IBAPRI16            *
.--------------------------------------------------------------------------
FEEUPD00  CALL      FNAM0000         * Validate Filename
          BRANCH    EXIT,FEEUPD99 
.
          MOVE      "IBAPRI16",SCHDPGID
          MOVE      "Schedule Update Fees from a Data File",SCHDDESC
          PACK      SCHDDATE,CCC,CYY,CMM,CDD
          REP       " 0",SCHDDATE
          CLOCK     TIME,SCHDTIME
.
.         Write Keyin parameters
.
          MOVE      FIVE,KEYSTARR[1]        * Option
          MOVE      PRIGL001,KEYSTARR[2]    * Item Type
          MOVE      PRIGL006,KEYSTARR[3]    * File Name
.
          MOVE      "Y",KEYSTARR[4]         * Yes Do Update
          MOVE      "0",KEYSTARR[5]         * Exit Screen
          MOVE      FIVE,KEYSTCNT
.
          CALL      SCHPRO00   * Schedule Extract
.
FEEUPD99  RETURN
.
.--------------------------------------------------------------------------
.*                             FEECOP00                                   *
.*   Schedule Update Fees from a Data File - Option 5 IBAPRI16            *
.--------------------------------------------------------------------------
FEECOP00  MOVE      "IBAPRI82",SCHDPGID
          MOVE      "Schedule Copy Fees",SCHDDESC
          PACK      SCHDDATE,CCC,CYY,CMM,CDD
          REP       " 0",SCHDDATE
          CLOCK     TIME,SCHDTIME
.
.         Write Keyin parameters
.
          MOVE      ONE,KEYSTARR[1]         * Option
          MOVE      PRIGL007,KEYSTARR[2]    * From Medical Record
          MOVE      PRIGL008,KEYSTARR[3]    * From Associated doctor
          MOVE      PRIGL009,KEYSTARR[4]    * To Medical Record
          MOVE      PRIGL010,KEYSTARR[5]    * To Associated doctor
.
          MOVE      "Y",KEYSTARR[6]         * Yes Do Copy
          MOVE      "0",KEYSTARR[7]         * Exit Screen
          MOVE      SEVEN,KEYSTCNT
.
          CALL      SCHPRO00   * Schedule Extract
.
FEECOP99  RETURN
.****************************************************************************
.*                                 FNAM0000                                 *
.*                      Validate the file name for update                      *
.****************************************************************************
FNAM0000  PACK      PRIGL006,PRIGL006,SP70
          MATCH     SP70,PRIGL006
          GOTO      FNAM9000 IF EQUAL        * nothing input
.
          CLOSE     INPFILE                  * make sure file is closed
          MOVE      ZERO,OVRCD
          TRAP      OVERCOND IF IO
          OPEN      INPFILE,PRIGL006         * try to open file
          TRAPCLR   IO
          IF        OVRCD = 1
            MOVE      "Cannot open this data file.",WEBTITLE
            CALL      WEBERR00
            GOTO      FNAM9000
          ENDIF
.
          MOVE      ZERO,EXIT
          GOTO      FNAM9999
.
.         nothing input
.
FNAM9000  MOVE      ONE,EXIT
.
FNAM9999  RETURN
.------------------------------------------------------------
. AMA/MBS Other Item Maintenance: Display,Add,Update,Delete
.------------------------------------------------------------
PRIGRP00  RESET     UPDTTYPE 
          MATCH     SP1,UPDTTYPE
          GOTO      PRIGRP60 IF EQUAL
.
          MATCH     "A",UPDTTYPE    * Add formaction
          GOTO      PRIGRP10 IF EQUAL
.
          MATCH     "D",UPDTTYPE    * Delete formaction
          GOTO      PRIGRP30 IF EQUAL
.
          GOTO      PRIGRP94
.
.  *********** ADD FORMACTION ***********
.
PRIGRP10  PACK      KEY22,OTHIT001,OTHIT002,OTHIT003,OTHIT004,SP70
          CALL      RDPRIT1
          BRANCH    OVRCD,PRIGRP91    * Read Parent Record
.
          CALL      CHEK0000          * Validate Other Item
          BRANCH    EXIT,PRIGRP99
.
          CALL      SAVGRP00     * Moves input variables to file variables
          CALL      WRPRGP1      * Writes away the data
.
          MOVE      ZERO,EXIT
          GOTO      PRIGRP99
.
.  ********** DELETE FORMACTION ***********
.
PRIGRP30  PACK      KEY22,OTHIT001,OTHIT002,OTHIT003,OTHIT004,SP70
          CALL      RDPRIT1
          BRANCH    OVRCD,PRIGRP91    * Read Parent Record
.
          PACK      KEY34,DELETEKY,SP70  
          CALL      RDPRGP1
          BRANCH    OVRCD,PRIGRP93
.
          CALL      DEPRGP1      * Deletes the data
.
          MOVE      ZERO,EXIT
          GOTO      PRIGRP99
.
.  ********** DISPLAY FORMACTION ***********
.
PRIGRP60  PACK      KEY22,OTHIT001,OTHIT002,OTHIT003,OTHIT004,SP70
          CALL      RDPRIT1
          BRANCH    OVRCD,PRIGRP91    * Read Parent Record

          PACK      KEY34,OTHIT001,OTHIT002,OTHIT003,OTHIT004,OTHIT005:
                          OTHIT006,SP70  
          CALL      RDPRGP1
          IF        OVRCD=1
            CALL      CLRGRP00    * Clear all the file variables
          ENDIF
.
          CLEAR     WEBTITLE
          MOVE      "AMA/MBS Other Item Maintenance",WEBTITLE
          RESET     WEBTITLE
.
          CALL      WEBHED00   * Create Output File and Write HTML Page Header
          BRANCH    EXIT,PRIGRP99
          CALL      WEBBOD00   * Process Web Body
          CALL      WEBEND00   * Process End of HTML File
          MOVE      ONE,EXIT
          GOTO      PRIGRP99
.
PRIGRP91  MOVE      "AMA/MBS Primary Item Code does not exist",WEBTITLE
          CALL      WEBERR00
          MOVE      ONE,EXIT
          GOTO      PRIGRP99
.
PRIGRP93  MOVE      "Item Code does not exists",WEBTITLE
          CALL      WEBERR00
          MOVE      ONE,EXIT
          GOTO      PRIGRP99
.
PRIGRP94  MOVE      "Invalid Form Action.",WEBTITLE
          CALL      WEBERR00
          MOVE      ONE,EXIT
          GOTO      PRIGRP99
.
PRIGRP99  RETURN
.-------------------------------------------------------------------------------
. Clear Other Item Vars               
.-------------------------------------------------------------------------------
CLRGRP00  MOVE      ZERO,PRGPFLAG   * Item Type
          MOVE      SP70,PRGPITM1   * MBS/AMA Item Number (Primary Item)
          MOVE      SP70,PRGPSUB1   * MBS Subitem Number
          MOVE      SP70,PRGPDATE   * Date effective from
          MOVE      SP70,PRGPITM2   * MBS/AMA Item Number (Secondary Item)
          MOVE      SP70,PRGPSUB2   * MBS Subitem Number
          MOVE      SP70,PRGPSPAR   * Spare
.
CLRGRP99  RETURN
.-------------------------------------------------------------------------------
. Save Other Item Vars               
.-------------------------------------------------------------------------------
SAVGRP00  MOVE      OTHIT001,PRGPFLAG   * Item Type
          MOVE      OTHIT002,PRGPITM1   * MBS/AMA Item Number (Primary Item)
          MOVE      OTHIT003,PRGPSUB1   * MBS Subitem Number
          MOVE      OTHIT004,PRGPDATE   * Date effective from
          MOVE      OTHIT005,PRGPITM2   * MBS/AMA Item Number (Secondary Item)
          MOVE      OTHIT006,PRGPSUB2   * MBS Subitem Number
          MOVE      SP70,PRGPSPAR       * Spare
.
SAVGRP99  RETURN
.****************************************************************************
.*                                 CHEK0000            Called by: PRIGRP00  *
.*                see what was input for secondary item                     *
.*  RETURNS:      EXIT    0 = valid item                                    *
.*                        1 = invalid entry                                 *
.****************************************************************************
CHEK0000  MATCH     OTHIT005,OTHIT002            * same as primary item ?
          GOTO      CHEK0500 IF NOT EQUAL        * no
.
          MATCH     OTHIT006,OTHIT003            * same primary subitem ?
          GOTO      CHEK0500 IF NOT EQUAL        * no
.
          GOTO      CHEK3000
.
CHEK0500  PACK      KEY22,OTHIT001,OTHIT005,OTHIT006,OTHIT004,SP70
          CALL      RDPRIT1
          COMPARE   ZERO,OVRCD                   * on file ?
          GOTO      CHEK1000 IF EQUAL            * yes
.
          MOVE      "Item Code for Effecitive date does not exists",WEBTITLE
          CALL      WEBERR00
          MOVE      ONE,EXIT
          GOTO      CHEK9999
.
CHEK1000  COMPARE   ZERO,PRITPATH                * pathology item ?
          GOTO      CHEK2000 IF EQUAL            * yes
.
          MOVE      "Not a pathology item.",WEBTITLE
          CALL      WEBERR00
          MOVE      ONE,EXIT
          GOTO      CHEK9999
.
CHEK2000  PACK      KEY34,OTHIT001,OTHIT002,OTHIT003,OTHIT004,OTHIT005:
                          OTHIT006,SP70  
          CALL      RDPRGP1                      * item on file already ?
          BRANCH    OVRCD,CHEK9000               * no
.
          MOVE      "Item already input.",WEBTITLE
          CALL      WEBERR00
          MOVE      ONE,EXIT
          GOTO      CHEK9999
.
CHEK3000  MOVE      "Primary item not allowed.",WEBTITLE
          CALL      WEBERR00
          MOVE      ONE,EXIT
          GOTO      CHEK9999
.
CHEK9000  
..          MOVE      PRITDESC,ITDESC
          MOVE      ZERO,EXIT
          GOTO      CHEK9999
.
CHEK9999  RETURN
.-------------------------------------------------------------------------------
. Private Practice Template Headings Maintenance: Display,Add,Update,Delete
.-------------------------------------------------------------------------------
PRITHD00  RESET     UPDTTYPE
          MATCH     SP1,UPDTTYPE
          GOTO      PRITHD40 IF EQUAL
.
          MATCH     "A",UPDTTYPE    * Add formaction
          GOTO      PRITHD10 IF EQUAL
.
          MATCH     "D",UPDTTYPE    * Delete formaction
          GOTO      PRITHD30 IF EQUAL
.
          GOTO      PRITHD93
.
.         ************ ADD FORMACTION ***********
.
PRITHD10  PACK      KEY4,PRITH001,SP70
          CALL      RDPRTHD1
          COMPARE   ZERO,OVRCD
          GOTO      PRITHD92 IF EQUAL
.
          CALL      THDSAV00      * Moves input variables to file variables
.
          PACK      KEY4,PRITH001,SP70
          PACK      PRTHSPRE,SP70
          CALL      WRPRTHD1      * Writes away the data
.
          MOVE      ZERO,EXIT
          GOTO      PRITHD99
.
.         ************ DELETE FORMACTION **********
.
PRITHD30  PACK      KEY4,PRITH001,SP70
          CALL      RDPRTHD1
          BRANCH    OVRCD,PRITHD91

          CALL      DEPRTHD1
.
PRITHD31  PACK      KEY8,PRITH001,SP70
          CALL      RDPRTDT1
          CALL      RKPRTDT1
          BRANCH    OVRCD,PRITHD32
.
          MATCH     PRTDTMID,PRITH001
          GOTO      PRITHD32 IF NOT EQUAL
.          
          PACK      KEY8,PRTDTMID,PRTDTYPE,PRTDSEQN,SP70
          CALL      DEPRTDT1
.
          GOTO      PRITHD31
.
PRITHD32  MOVE      ZERO,EXIT
          GOTO      PRITHD99
.
.         ************ DISPLAY FORMACTION **********
.
PRITHD40  PACK      KEY4,PRITH001,SP70
          CALL      RDPRTHD1
          IF        OVRCD=1
            CALL      CLRTHD00    * Clear all the file variables
          ENDIF
.
          CLEAR     WEBTITLE
          MOVE      "Common Items Template Maintenance",WEBTITLE
          RESET     WEBTITLE
.
          CALL      WEBHED00   * Create Output File and Write HTML Page Header
          BRANCH    EXIT,PRITHD99
          CALL      WEBBOD00   * Process Web Body
          CALL      WEBEND00   * Process End of HTML File
          MOVE      ONE,EXIT
          GOTO      PRITHD99
.
PRITHD91  MOVE      "Common Item Template does not exists",WEBTITLE
          CALL      WEBERR00
          MOVE      ONE,EXIT
          GOTO      PRITHD99
.
PRITHD92  MOVE      "Common Item Template exists",WEBTITLE
          CALL      WEBERR00
          MOVE      ONE,EXIT
          GOTO      PRITHD99
.
PRITHD93  MOVE      "Invalid Form Action.",WEBTITLE
          CALL      WEBERR00
          MOVE      ONE,EXIT
          GOTO      PRITHD99
.
PRITHD99  RETURN
.-----------------------------------------------------------
. Initialize's file data
.-----------------------------------------------------------
CLRTHD00  MOVE      SP70,PRTHTMID
          MOVE      SP70,PRTHDESC 
          MOVE      SP70,PRTHINDC 
.
CLRHTD99  RETURN
.-----------------------------------------------------------
. Save routine - move cgi parameters into file variables
.-----------------------------------------------------------
THDSAV00  MOVE      PRITH001,PRTHTMID  * Template ID  
          MOVE      PRITH002,PRTHDESC  * Description
          MOVE      PRITH003,PRTHINDC  * Active Indicator
.
THDSAV99  RETURN
.-------------------------------------------------------------------------------
. Common Items Templates Maintenance: Display,Add,Update,Delete
.-------------------------------------------------------------------------------
PRITDT00  RESET     UPDTTYPE
          MATCH     SP1,UPDTTYPE
          GOTO      PRITDT50 IF EQUAL
.
          MATCH     "A",UPDTTYPE    * Add formaction
          GOTO      PRITDT10 IF EQUAL
.
          MATCH     "S",UPDTTYPE    * Swap Sequence 
          GOTO      PRITDT20 IF EQUAL
.
          MATCH     "U",UPDTTYPE    * Update formaction
          GOTO      PRITDT40 IF EQUAL
.
          MATCH     "D",UPDTTYPE    * Delete formaction
          GOTO      PRITDT30 IF EQUAL
.
          GOTO      PRITDT93
.
.         ************ ADD FORMACTION ***********
.
PRITDT10  CALL      SEQN0000             * sets up next seq in list
.
          MOVE      FORM3,PRITD003
          REP       " 0",PRITD003
          PACK      PRITD003,PRITD003,SP70
.
          PACK      KEY8,PRITD001,PRITD002,PRITD003,SP70
          CALL      RDPRTDT1
          COMPARE   ZERO,OVRCD
          GOTO      PRITDT92 IF EQUAL
.
          CALL      TDTSAV00      * Moves input variables to file variables
          PACK      KEY8,PRITD001,PRITD002,PRITD003,SP70
          CALL      WRPRTDT1      * Writes away the data
.
          MOVE      ZERO,EXIT
          GOTO      PRITDT99
.
.         ************ SWAP FORMACTION **********
.
PRITDT20  MATCH     NEWSEQNC,PRITD003
          GOTO      PRITDT99 IF EQUAL
.
          PACK      KEY8,PRITD001,PRITD002,PRITD003,SP70   
          CALL      RDPRTDT1
          BRANCH    OVRCD,PRITDT91
.
          MATCH     MOVESWAP,S
          IF        @EQUAL
            GOTO      SWAP0000
          ENDIF
.
          MOVE      NEWSEQNC,FORM3
          MOVE      PRITD003,FORM3A
          
          IF        FORM3 > FORM3A
            GOTO      STRL0000
          ELSE
            GOTO      ENDL0000
          ENDIF
.
          MOVE      ZERO,EXIT
          GOTO      PRITDT99
.
.         ************ DELETE FORMACTION **********
.
PRITDT30  PACK      KEY8,PRITD001,PRITD002,PRITD003,SP70   
          CALL      RDPRTDT1
          BRANCH    OVRCD,PRITDT91
.
          CALL      DEPRTDT1
.
PRITDT31  CALL      RKPRTDT1
          BRANCH    OVRCD,PRITDT32
.
          MATCH     PRTDTMID,PRITD001
          GOTO      PRITDT32 IF NOT EQUAL
.
          MATCH     PRTDTYPE,PRITD002
          GOTO      PRITDT32 IF NOT EQUAL
.
          PACK      SAVKEY,PRTDTMID,PRTDTYPE,PRTDSEQN,SP70
          PACK      KEY8,SAVKEY
          CALL      DEPRTDT1
.
          MOVE      PRTDSEQN,FORM3
          SUB       ONE,FORM3
          MOVE      FORM3,PRTDSEQN
          REP       " 0",PRTDSEQN
          PACK      KEY8,PRTDTMID,PRTDTYPE,PRTDSEQN,SP70
          CALL      WRPRTDT1             

          GOTO      PRITDT31
.
PRITDT32  MOVE      ZERO,EXIT
          GOTO      PRITDT99
.
.
.         ************ UPDATE FORMACTION **********
.
PRITDT40  PACK      KEY8,PRITD001,PRITD002,PRITD003,SP70
          CALL      RDPRTDT1
          BRANCH    OVRCD,PRITDT91
.
          CALL      TDTSAV00      * Moves input variables to file variables
.
          PACK      KEY8,PRITD001,PRITD002,PRITD003,SP70
          CALL      UPPRTDT1      * Writes away the data
.
          MOVE      ZERO,EXIT
          GOTO      PRITDT99
.
.
.         ************ DISPLAY FORMACTION **********
.
PRITDT50  PACK      KEY4,PRITD001,SP70
          CALL      RDPRTHD1
          BRANCH    OVRCD,PRITDT90
 
          PACK      KEY8,PRITD001,PRITD002,PRITD003,SP70
          CALL      RDPRTDT1
          IF        OVRCD=1
            CALL      CLRTDT00    * Clear all the file variables
          ENDIF
.
          CLEAR     WEBTITLE
          MOVE      "Common Items Templates Details Maintenance",WEBTITLE
          RESET     WEBTITLE
.
          CALL      WEBHED00   * Create Output File and Write HTML Page Header
          BRANCH    EXIT,PRITDT99
          CALL      WEBBOD00   * Process Web Body
          CALL      WEBEND00   * Process End of HTML File
          MOVE      ONE,EXIT
          GOTO      PRITDT99
.
PRITDT90  MOVE      "Common Item does not exists",WEBTITLE
          CALL      WEBERR00
          MOVE      ONE,EXIT
          GOTO      PRITDT99
.
PRITDT91  MOVE      "Common Item Does not exist",WEBTITLE
          CALL      WEBERR00
          MOVE      ONE,EXIT
          GOTO      PRITDT99
.
PRITDT92  MOVE      "Common Item exists",WEBTITLE
          CALL      WEBERR00
          MOVE      ONE,EXIT
          GOTO      PRITDT99
.
PRITDT93  MOVE      "Invalid Form Action.",WEBTITLE
          CALL      WEBERR00
          MOVE      ONE,EXIT
          GOTO      PRITDT99
.
PRITDT99  RETURN
.-----------------------------------------------------------
. Initialize's file data
.-----------------------------------------------------------
CLRTDT00  MOVE      SP70,PRTDTMID
          MOVE      SP70,PRTDTYPE 
          MOVE      SP70,PRTDSEQN 
          MOVE      SP70,PRTDCODE   
          MOVE      SP70,PRTDSUBI   
          MOVE      SP70,PRTDQUAN  
          MOVE      ZERO,PRTDSPAR    
.
CLRTDT99  RETURN
.-----------------------------------------------------------
. Save routine - move cgi parameters into file variables
.-----------------------------------------------------------
TDTSAV00  MOVE      PRITD001,PRTDTMID   * Template ID 
          MOVE      PRITD002,PRTDTYPE   * Item Type    
          MOVE      PRITD003,PRTDSEQN   * Sequence No   
          MOVE      PRITD004,PRTDCODE   * Item Code    
          MOVE      PRITD005,PRTDSUBI   * Sub-Item No    
          MOVE      PRITD006,PRTDQUAN   * Quantity
          MOVE      ZERO,PRTDSPAR    
.
TDTSAV99  RETURN
.-------------------------------------------------------------------------
.             Loops through List to find last Sequence number
.-------------------------------------------------------------------------
SEQN0000  MOVE      ZERO,FORM3
.
          PACK      KEY8,PRITD001,PRITD002,SP70
          CALL      RDPRTDT1
SEQN0100  CALL      RKPRTDT1
          BRANCH    OVRCD,SEQN9000
.
          MATCH     PRITD001,PRTDTMID       * Template ID
          GOTO      SEQN9000 IF NOT EQUAL
.
          MATCH     PRITD002,PRTDTYPE       * Type
          GOTO      SEQN9000 IF NOT EQUAL
.
          ADD       ONE,FORM3
.
          GOTO      SEQN0100
.
SEQN9000  ADD       ONE,FORM3
SEQN9999  RETURN
.---------------------------------------------------------------------
.         Repositions sequence in template from start to end
.---------------------------------------------------------------------
STRL0000  PACK      SAVKEY,PRITD001,PRITD002,PRITD003,SP70   
          MOVE      SAVKEY,KEY8
          CALL      RDPRTDT1
          MOVE      NNN,PRTDSEQN
          PACK      KEY8,PRTDTMID,PRTDTYPE,PRTDSEQN,SP70
          CALL      RAPRTDT1
          CALL      WRPRTDT1
          MOVE      SAVKEY,KEY8 
          CALL      DEPRTDT1

          PACK      KEY8,SAVKEY,SP70
          CALL      RSPRTDT1
STRL1000  CALL      RKPRTDT1
          BRANCH    OVRCD,STRL9999

          MATCH     PRTDTMID,PRITD001
          GOTO      STRL9999 IF NOT EQUAL

          MATCH     PRTDTYPE,PRITD002
          GOTO      STRL9999 IF NOT EQUAL

          MATCH     PRTDSEQN,NEWSEQNC
          GOTO      STRL2000 IF NOT EQUAL
          
          MOVE      PRTDSEQN,FORM3
          SUB       ONE,FORM3
          MOVE      FORM3,PRTDSEQN
          REP       " 0",PRTDSEQN
          PACK      KEY8,PRTDTMID,PRTDTYPE,PRTDSEQN,SP70
          CALL      WRPRTDT1             
          PACK      KEY8,PRTDTMID,PRTDTYPE,NEWSEQNC,SP70
          CALL      DEPRTDT1
.
          PACK      KEY8,PRTDTMID,PRTDTYPE,NNN,SP70
          CALL      RDPRTDT1
          MOVE      NEWSEQNC,PRTDSEQN
          PACK      KEY8,PRTDTMID,PRTDTYPE,NEWSEQNC,SP70
          CALL      WRPRTDT1
          PACK      KEY8,PRTDTMID,PRTDTYPE,NNN,SP70
          CALL      DEPRTDT1
          GOTO      STRL9999

STRL2000  MOVE      PRTDSEQN,FORM3
          MOVE      PRTDSEQN,KEY3
          SUB       ONE,FORM3
          MOVE      FORM3,PRTDSEQN
          REP       " 0",PRTDSEQN
          PACK      KEY8,PRTDTMID,PRTDTYPE,PRTDSEQN,SP70
          CALL      WRPRTDT1             

          PACK      KEY8,PRTDTMID,PRTDTYPE,KEY3,SP70
          CALL      DEPRTDT1
          GOTO      STRL1000

STRL9999  RETURN             
.---------------------------------------------------------------------
.         Repositions sequence in template from end to start
.---------------------------------------------------------------------
ENDL0000  PACK      SAVKEY,PRITD001,PRITD002,PRITD003,SP70   
          MOVE      SAVKEY,KEY8
          CALL      RDPRTDT1
          MOVE      NNN,PRTDSEQN
          PACK      KEY8,PRTDTMID,PRTDTYPE,PRTDSEQN,SP70
          CALL      WRPRTDT1
          MOVE      SAVKEY,KEY8 
          CALL      DEPRTDT1

          PACK      KEY8,SAVKEY,SP70
          CALL      RSPRTDT1
ENDL1000  CALL      RPPRTDT1
          BRANCH    OVRCD,ENDL9999

          MATCH     PRTDTMID,PRITD001
          GOTO      ENDL9999 IF NOT EQUAL

          MATCH     PRTDTYPE,PRITD002
          GOTO      ENDL9999 IF NOT EQUAL

          MATCH     PRTDSEQN,NEWSEQNC
          GOTO      ENDL2000 IF NOT EQUAL
          
          MOVE      PRTDSEQN,FORM3
          ADD       ONE,FORM3
          MOVE      FORM3,PRTDSEQN
          REP       " 0",PRTDSEQN
          PACK      KEY8,PRTDTMID,PRTDTYPE,PRTDSEQN,SP70
          CALL      WRPRTDT1             
          PACK      KEY8,PRTDTMID,PRTDTYPE,NEWSEQNC,SP70
          CALL      DEPRTDT1
.
          PACK      KEY8,PRTDTMID,PRTDTYPE,NNN,SP70
          CALL      RDPRTDT1
          MOVE      NEWSEQNC,PRTDSEQN
          PACK      KEY8,PRTDTMID,PRTDTYPE,NEWSEQNC,SP70
          CALL      WRPRTDT1
          PACK      KEY8,PRTDTMID,PRTDTYPE,NNN,SP70
          CALL      DEPRTDT1
          GOTO      ENDL9999

ENDL2000  MOVE      PRTDSEQN,FORM3
          MOVE      PRTDSEQN,KEY3
          ADD       ONE,FORM3
          MOVE      FORM3,PRTDSEQN
          REP       " 0",PRTDSEQN
          PACK      KEY8,PRTDTMID,PRTDTYPE,PRTDSEQN,SP70
          CALL      WRPRTDT1             

          PACK      KEY8,PRTDTMID,PRTDTYPE,KEY3,SP70
          CALL      DEPRTDT1
          GOTO      ENDL1000

ENDL9999  RETURN             
.---------------------------------------------------------------------
.         Swap sequence in list
.---------------------------------------------------------------------
SWAP0000  PACK      KEY8,PRITD001,PRITD002,PRITD003,SP70   
          CALL      RDPRTDT1
          CALL      DEPRTDT1
          MOVE      NNN,PRTDSEQN
          PACK      KEY8,PRTDTMID,PRTDTYPE,PRTDSEQN,SP70
          CALL      WRPRTDT1
.
          PACK      KEY8,PRITD001,PRITD002,NEWSEQNC,SP70
          CALL      RDPRTDT1
          CALL      DEPRTDT1
          MOVE      PRITD003,PRTDSEQN
          PACK      KEY8,PRTDTMID,PRTDTYPE,PRTDSEQN,SP70
          CALL      WRPRTDT1
.
          PACK      KEY8,PRITD001,PRITD002,NNN,SP70
          CALL      RDPRTDT1
          CALL      DEPRTDT1
          MOVE      NEWSEQNC,PRTDSEQN
          PACK      KEY8,PRTDTMID,PRTDTYPE,PRTDSEQN,SP70
          CALL      WRPRTDT1
.
SWAP9999  RETURN
.------------------------------------------------------------
. Pathology Test Maintenance: Display,Add,Update,Delete
.------------------------------------------------------------
PRITES00  RESET     UPDTTYPE 
          MATCH     SP1,UPDTTYPE
          GOTO      PRITES40 IF EQUAL
.
          MATCH     "A",UPDTTYPE    * Add formaction
          GOTO      PRITES10 IF EQUAL
.
          MATCH     "U",UPDTTYPE    * Update formaction
          GOTO      PRITES20 IF EQUAL
.
          MATCH     "D",UPDTTYPE    * Delete formaction
          GOTO      PRITES30 IF EQUAL
.
          GOTO      PRITES93
.
.  *********** ADD FORMACTION ***********
.
PRITES10  PACK      KEY17,PRITS001,PRITS002,SP70  
          CALL      RDPRTE1
          COMPARE   ZERO,OVRCD
          GOTO      PRITES92 IF EQUAL
.
          CALL      SAVTES00      * Moves input variables to file variables
          CALL      WRPRTE1       * Writes away the data
.
          MOVE      PRTECODE,TESTCODE   * Input var for PRITKIUP
          MOVE      PRTEDESC,ITEMDESC   * Input var for PRITKIUP
          PROC      PRITKIUP            * Update Pathology Test Keyword Index
.
          MOVE      ZERO,EXIT
          GOTO      PRITES99
.
.  *********** UPDATE FORMACTION ************
.
PRITES20  PACK      KEY17,PRITS001,PRITS002,SP70
          CALL      RDPRTE1
          BRANCH    OVRCD,PRITES91
.
          CALL      SAVTES00      * Moves input variables to file variables
          CALL      UPPRTE1       * Writes away the data
.
          MOVE      PRTECODE,TESTCODE   * Input var for PRITKIUP
          MOVE      PRTEDESC,ITEMDESC   * Input var for PRITKIUP
          PROC      PRITKIUP            * Update Pathology Test Keyword Index
.
          MOVE      ZERO,EXIT
          GOTO      PRITES99
.
.  ********** DELETE FORMACTION ***********
.
PRITES30  PACK      KEY17,PRITS001,PRITS002,SP70
          CALL      RDPRTE1
          BRANCH    OVRCD,PRITES91
.
          CALL      DEPRTE1      * Deletes the data
.
          MOVE      PRTECODE,TESTCODE   * Input var for PRITKIUP
          MOVE      PRTEDESC,ITEMDESC   * Input var for PRITKIUP
          PROC      PRITKIUP            * Update Pathology Test Keyword Index
.
          MOVE      ZERO,EXIT
          GOTO      PRITES99
.
.  ********** DISPLAY FORMACTION ***********
.
PRITES40  PACK      KEY17,PRITS001,PRITS002,SP70
          CALL      RDPRTE1
          IF        OVRCD=1
            CALL      CLRTES00    * Clear all the file variables
          ENDIF
.
          CLEAR     WEBTITLE
          MOVE      "Pathology Test Maintenance",WEBTITLE
          RESET     WEBTITLE
.
          CALL      WEBHED00   * Create Output File and Write HTML Page Header
          BRANCH    EXIT,PRITES99
          CALL      WEBBOD00   * Process Web Body
          CALL      WEBEND00   * Process End of HTML File
          MOVE      ONE,EXIT
          GOTO      PRITES99
.
PRITES91  MOVE      "Pathology Test Code does not exist",WEBTITLE
          CALL      WEBERR00
          MOVE      ONE,EXIT
          GOTO      PRITES99
.
PRITES92  MOVE      "Pathology Test Code exists",WEBTITLE
          CALL      WEBERR00
          MOVE      ONE,EXIT
          GOTO      PRITES99
.
PRITES93  MOVE      "Invalid Form Action.",WEBTITLE
          CALL      WEBERR00
          MOVE      ONE,EXIT
          GOTO      PRITES99
.
PRITES99  RETURN
.-------------------------------------------------------------------------------
. Clear Vars
.-------------------------------------------------------------------------------
CLRTES00  MOVE      SP70,PRTECODE   * Test Code
          MOVE      SP70,PRTEDATE   * Date Effective From
          MOVE      SP70,PRTEDESC   * Test Description
          MOVE      SP70,PRTEITMN   * MBS Item Number
          MOVE      SP70,PRTESUBN   * MBS Subitem Number
          MOVE      SP70,PRTEAMAN   * AMA Item Number
          MOVE      SP70,PRTEMSER   * Multiple Services Code
          MOVE      ZERO,PRTETESN   * Number of Procedures
          MOVE      SP70,PRTEABRV   * Standard Abbreviation
.
CLRTES99  RETURN
.-------------------------------------------------------------------------------
. Clear Vars
.-------------------------------------------------------------------------------
SAVTES00  MOVE      PRITS001,PRTECODE   * Test Code
          MOVE      PRITS002,PRTEDATE   * Date Effective From
          MOVE      PRITS003,PRTEDESC   * Test Description
          MOVE      PRITS004,PRTEITMN   * MBS Item Number
          MOVE      PRITS005,PRTESUBN   * MBS Subitem Number
          MOVE      PRITS006,PRTEAMAN   * AMA Item Number
          MOVE      PRITS007,PRTEMSER   * Multiple Services Code
          MOVE      PRITS008,PRTETESN   * Number of Procedures
          MOVE      PRITS009,PRTEABRV   * Standard Abbreviation
.
SAVTES99  RETURN
.------------------------------------------------------------
. Multiple Item Maintenance: Display,Add,Update,Delete
.------------------------------------------------------------
PRIMUL00  RESET     UPDTTYPE 
          MATCH     SP1,UPDTTYPE
          GOTO      PRIMUL60 IF EQUAL
.
          MATCH     "A",UPDTTYPE    * Add formaction
          GOTO      PRIMUL10 IF EQUAL
.
          MATCH     "S",UPDTTYPE    * Add Single formaction
          GOTO      PRIMUL20 IF EQUAL
.
          MATCH     "U",UPDTTYPE    * Update formaction
          GOTO      PRIMUL30 IF EQUAL
.
          MATCH     "D",UPDTTYPE    * Delete All formaction
          GOTO      PRIMUL40 IF EQUAL
.
          MATCH     "L",UPDTTYPE    * Delete formaction
          GOTO      PRIMUL50 IF EQUAL
.
          GOTO      PRIMUL93
.
.  *********** ADD FORMACTION ***********
.
PRIMUL10  PACK      KEY16,PRIML001,PRIML002,SP70  
          CALL      RSPRMU1
          CALL      RKPRMU1
          BRANCH    OVRCD,PRIMUL11
.
          MATCH     PRIML001,PRMUCODE     * Mult Service code
          GOTO      PRIMUL11 IF NOT EQUAL
.
          MATCH     PRIML002,PRMUDATE     * Effective Date
          GOTO      PRIMUL11 IF NOT EQUAL

          GOTO      PRIMUL92      * Record already exists
.
PRIMUL11  CALL      MULARR00      * Saves Array Records
.
          MOVE      ZERO,EXIT
          GOTO      PRIMUL99
.
.  *********** ADD SINGLE RECORD FORMACTION ************
.
PRIMUL20  PACK      KEY16,PRIML001,PRIML002,PRIML003,SP70  
          CALL      RDPRMU1
          COMPARE   ZERO,OVRCD
          GOTO      PRIMUL94 IF EQUAL
.
          CALL      SAVMUL00      * Moves input variables to file variables
          CALL      WRPRMU1       * Writes away the data
.
          MOVE      ZERO,EXIT
          GOTO      PRIMUL99
.
.  *********** UPDATE FORMACTION ************
.
.PRIMUL30  PACK      KEY16,PRIML001,PRIML002,PRIML003,SP70  
.          CALL      RDPRMU1
.          BRANCH    OVRCD,PRIMUL91
.
.          CALL      SAVMUL00      * Moves input variables to file variables
.          CALL      UPPRMU1       * Writes away the data
.
.          MOVE      ZERO,EXIT
.          GOTO      PRIMUL99
.
PRIMUL30  PACK      KEY16,PRIML001,PRIML002,SP70
          CALL      RSPRMU1
PRIMUL35  CALL      RKPRMU1
          BRANCH    OVRCD,PRIMUL39
.
          MATCH     PRIML001,PRMUCODE
          GOTO      PRIMUL39 IF NOT EQUAL
.
          MATCH     PRIML002,PRMUDATE
          GOTO      PRIMUL39 IF NOT EQUAL
.
          MOVE      PRIML004,PRMUDESC
          CALL      UPPRMU1 
.
          GOTO      PRIMUL35
.
PRIMUL39  MOVE      ZERO,EXIT
          GOTO      PRIMUL99   
.
.  ********** DELETE ALL FORMACTION ***********
.
PRIMUL40  PACK      KEY16,PRIML001,PRIML002,SP70
          CALL      RSPRMU1
          CALL      RKPRMU1
          BRANCH    OVRCD,PRIMUL41
.         
          MATCH     PRIML001,PRMUCODE     * Mult Service code
          GOTO      PRIMUL41 IF NOT EQUAL
.         
          MATCH     PRIML002,PRMUDATE     * Effective Date
          GOTO      PRIMUL41 IF NOT EQUAL
.         
          PACK      KEY16,PRMUCODE,PRMUDATE,PRMUNUMB,SP70
          CALL      DEPRMU1      * Deletes the data
          GOTO      PRIMUL40
.         
PRIMUL41  MOVE      ZERO,EXIT
          GOTO      PRIMUL99
.
.  ********** DELETE FORMACTION ***********
.
PRIMUL50  PACK      KEY16,DELTSTKY,SP70  
          CALL      RDPRMU1
          BRANCH    OVRCD,PRIMUL91
.
          CALL      DEPRMU1      * Deletes the data
.
          MOVE      ZERO,EXIT
          GOTO      PRIMUL99
.
.  ********** DISPLAY FORMACTION ***********
.
PRIMUL60  COMPARE   ZERO,PRIML003
          GOTO      PRIMUL61 IF EQUAL 

          PACK      KEY16,PRIML001,PRIML002,PRIML003,SP70  
          CALL      RDPRMU1
          IF        OVRCD=1
            CALL      CLRMUL00    * Clear all the file variables
          ENDIF
.
PRIMUL61  PACK      KEY16,PRIML001,PRIML002,Z70
          CALL      RSPRMU1
          CALL      RPPRMU1
          IF        OVRCD=1
            CALL      CLRMUL00    * Clear all the file variables
          ENDIF
.
          MATCH     PRIML001,PRMUCODE
          IF        !@EQUAL
            CALL      CLRMUL00    * Clear all the file variables
          ENDIF
.
          MATCH     PRIML002,PRMUDATE
          IF        !@EQUAL
            CALL      CLRMUL00    * Clear all the file variables
          ENDIF

          CLEAR     WEBTITLE
          MOVE      "Multiple Item Maintenance",WEBTITLE
          RESET     WEBTITLE
.
          CALL      WEBHED00   * Create Output File and Write HTML Page Header
          BRANCH    EXIT,PRIMUL99
          CALL      WEBBOD00   * Process Web Body
          CALL      WEBEND00   * Process End of HTML File
          MOVE      ONE,EXIT
          GOTO      PRIMUL99
.
PRIMUL91  MOVE      "Multiple Item Code/Effective Date does not exist",WEBTITLE
          CALL      WEBERR00
          MOVE      ONE,EXIT
          GOTO      PRIMUL99
.
PRIMUL92  MOVE      "Multiple Item Code/Effective Date already exists",WEBTITLE
          CALL      WEBERR00
          MOVE      ONE,EXIT
          GOTO      PRIMUL99
.
PRIMUL93  MOVE      "Invalid Form Action.",WEBTITLE
          CALL      WEBERR00
          MOVE      ONE,EXIT
          GOTO      PRIMUL99
.
PRIMUL94  CLEAR     WEBTITLE 
          MOVE      "Multiple Item Code/Effective Date & Test No",WEBTITLE
          ENDSET    WEBTITLE
          APPEND    " already exists",WEBTITLE
          CALL      WEBERR00
          MOVE      ONE,EXIT
          GOTO      PRIMUL99
.
PRIMUL99  RETURN
.-------------------------------------------------------------------------------
. Clear Vars
.-------------------------------------------------------------------------------
CLRMUL00  MOVE      SP70,PRMUCODE  * Multiple Services Code
          MOVE      SP70,PRMUDATE  * Date Effective From
          MOVE      ZERO,PRMUNUMB  * Number of Procedures
          MOVE      SP70,PRMUDESC  * Description
          MOVE      SP70,PRMUITMN  * MBS Item Number
          MOVE      SP70,PRMUSUBN  * MBS Subitem Number
          MOVE      SP70,PRMUAMAN  * AMA Item Number
          MOVE      SP70,PRMUSPAR  * Spare Variable
.
CLRMUL99  RETURN
.-------------------------------------------------------------------------------
. Save Vars
.-------------------------------------------------------------------------------
SAVMUL00  MOVE      PRIML001,PRMUCODE  * Multiple Services Code
          MOVE      PRIML002,PRMUDATE  * Date Effective From
          MOVE      PRIML003,PRMUNUMB  * Number of Procedures
          MOVE      PRIML004,PRMUDESC  * Description
          MOVE      PRIML005,PRMUITMN  * MBS Item Number
          MOVE      PRIML006,PRMUSUBN  * MBS Subitem Number
          MOVE      PRIML007,PRMUAMAN  * AMA Item Number
          MOVE      SP70,PRMUSPAR      * Spare Variable
.
SAVMUL99  RETURN
.-------------------------------------------------------------------------------
. Save each record from the Array     
.-------------------------------------------------------------------------------
MULARR00  MOVE      ONE,COUNT
          WHILE     COUNT <= LASTTEST
            MATCH     SP70,MBSITEMS[COUNT]
            IF        !@EQUAL
              CALL      SAVMLT00   * Save Test Record
            ELSE 
              MATCH     SP70,AMAITEMS[COUNT]
              IF        !@EQUAL
                CALL      SAVMLT00   * Save Test Record
              ENDIF
            ENDIF
            ADD       ONE,COUNT
          DO
.
MULARR99  RETURN
.-------------------------------------------------------------------------------
. Save Multiple Service Record (Loaded from Array)
.-------------------------------------------------------------------------------
SAVMLT00  PACK      KEY16,PRIML001,PRIML002,NUMTESTS[COUNT],SP70  
          CALL      RDPRMU1
          COMPARE   ZERO,OVRCD
          GOTO      SAVMLT99 IF EQUAL
.
          MOVE      PRIML001,PRMUCODE         * Multiple Services Code
          MOVE      PRIML002,PRMUDATE         * Date Effective From
          MOVE      NUMTESTS[COUNT],PRMUNUMB  * Number of Procedures
          MOVE      PRIML004,PRMUDESC         * Description
          MOVE      MBSITEMS[COUNT],PRMUITMN  * MBS Item Number
          MOVE      MBSSUBIT[COUNT],PRMUSUBN  * MBS Subitem Number
          MOVE      AMAITEMS[COUNT],PRMUAMAN  * AMA Item Number
          MOVE      SP70,PRMUSPAR             * Spare Variable
.
          PACK      KEY16,PRMUCODE,PRMUDATE,NUMTESTS[COUNT],SP70  
          CALL      RDPRMU1
          IF        OVRCD=1
            CALL      WRPRMU1       * Writes away the data
          ENDIF
.
SAVMLT99  RETURN
.-------------------------------------------------------------------------------
. Process Fields called from WEBBOD00 
.-------------------------------------------------------------------------------
PROFLD00  BRANCH    REPORTNO,PROFLD10,PROFLD20,PROFLD30,PROFLD40,PROFLD50:
                             PROFLD60,PROFLD70
          GOTO      PROFLD99
.
PROFLD10  CALL      PRMG0000       * Medicare Gap
          GOTO      PROFLD99
.
PROFLD20  BRANCH    FLDSETNO,PRFLD21,PRFLD22
          GOTO      PROFLD99
.
PRFLD21   CALL      PRTM0000       * AMA/MBS Item Maintenance
          GOTO      PROFLD99
.
PRFLD22   CALL      PRSC0000       * Copy Schedule fees
          GOTO      PROFLD99
.
PROFLD30  BRANCH    FLDSETNO,PROFLD31,PROFLD32                
          GOTO      PROFLD99
.
PROFLD31  CALL      PRTM0000       * AMA/MBS Item Search/Maintenance
          GOTO      PROFLD99
.
PROFLD32  CALL      PRGP0000       * AMA/MBS Other Item Maintenance
          GOTO      PROFLD99
.
PROFLD40  CALL      PTHD0000       * Common Items Heading Maintenance
          GOTO      PROFLD99
.
PROFLD50  BRANCH    FLDSETNO,PROFLD51,PROFLD52
          GOTO      PROFLD99
.
PROFLD51  CALL      PTHD0000       * Common Items Heading Maintenance
          GOTO      PROFLD99
.
PROFLD52  CALL      PTDT0000       * Common Items Details Maintenance
          GOTO      PROFLD99
.
PROFLD60  CALL      PRTS0000       * Pathology Maintenance/Search
          GOTO      PROFLD99
.
PROFLD70  CALL      PRML0000       * Multiple Services Maintenance
          GOTO      PROFLD99
.
PROFLD99  RETURN
.-------------------------------------------------------------------------------
. Option 1 - Medicare Gap
.-------------------------------------------------------------------------------
PRMG0000  BRANCH    FLDITMNO,PRMG0100,PRMG0200,PRMG0300,PRMG0400,PRMG0500
          GOTO      PRMG9999
.
PRMG0100  UNPACK    PRMGDATE,CCENT,CYEAR,CMON,CDAY  * Effective Date
          MOVE      CMON,F2
          LOAD      MTHNAM3,F2,JAN,FEB,MAR,APR,MAY,JUN,JUL,AUG,SEP,OCT,NOV,DEC
          WRITE     HTMLFILE;CDAY,SP1,MTHNAM3,SP1,CCENT,CYEAR; 
          GOTO      PRMG9999
.
PRMG0200  WRITE     HTMLFILE;PRMGVALU;  * Gap Value 
          GOTO      PRMG9999
.
PRMG0300  CALL      MGPTB000     * Table of Medicare Gap 
          GOTO      PRMG9999
.
PRMG0400  CALL      NEXTPR00     * Link to Next Set of Medicare Gaps
          GOTO      PRMG9999
.
PRMG0500  CALL      PREVPR00     * Link to Prev Set of Medicare Gaps 
          GOTO      PRMG9999
.
PRMG9999  RETURN
.--------------------------------------------------------------
. Option 4 - Common Items Templates Heading Mantenance
.--------------------------------------------------------------
PTHD0000  BRANCH    FLDITMNO,PTHD0100,PTHD0200,PTHD0300,PTHD0400,PTHD0500:
                             PTHD0600
          GOTO      PTHD9999
.
PTHD0100  WRITE     HTMLFILE;PRTHTMID;  * Template ID
          GOTO      PTHD9999
.
PTHD0200  WRITE     HTMLFILE;PRTHDESC;  * Description
          GOTO      PTHD9999
.
PTHD0300  WRITE     HTMLFILE;PRTHINDC;  * Active Indicator
          GOTO      PTHD9999
.
PTHD0400  CALL      THDTB000     * Table of Med Rec Template Headings
          GOTO      PTHD9999
.
PTHD0500  CALL      NEXTPR00     * Link to Next Set of Codes
          GOTO      PTHD9999
.
PTHD0600  CALL      PREVPR00     * Link to Prev Set of Codes
          GOTO      PTHD9999
.
PTHD9999  RETURN
.-------------------------------------------------------------------------------
. Option 2 - AMA/MBS Item Maintenance
.-------------------------------------------------------------------------------
PRTM0000  BRANCH    FLDITMNO,PRTM0100,PRTM0200,PRTM0300,PRTM0400,PRTM0500:
                             PRTM0600,PRTM0700,PRTM0800,PRTM0900,PRTM1000:
                             PRTM1100,PRTM1200,PRTM1300,PRTM1400,PRTM1500:
                             PRTM1600,PRTM1700,PRTM1800,PRTM1900,PRTM2000:
                             PRTM2100,PRTM2200,PRTM2300,PRTM2400,PRTM2500:
                             PRTM2600,PRTM2700,PRTM2800,PRTM2900,PRTM3000:
                             PRTM3100,PRTM3200,PRTM3300,PRTM3400,PRTM3500:
                             PRTM3600,PRTM3700,PRTM3800,PRTM3900,PRTM4000:
                             PRTM4100,PRTM4200,PRTM4300
          GOTO      PRTM9999
.
PRTM0100  WRITE     HTMLFILE;PRITFLAG;  
          GOTO      PRTM9999
.
PRTM0200  WRITE     HTMLFILE;PRITITMN;  
          GOTO      PRTM9999
.
PRTM0300  WRITE     HTMLFILE;PRITSUBN;  
          GOTO      PRTM9999
.
PRTM0400  UNPACK    DIM127,D1,KEY1,DIM127
          MOVE      ZERO,F1
          MOVE      KEY1,F1
          BRANCH    F1,PRTM0410
.
          WRITE     HTMLFILE;PRITDAT1;   * Unformattted Date
          GOTO      PRTM9999
.
PRTM0410  UNPACK    PRITDAT1,CCENT,CYEAR,CMON,CDAY  * Effective Date
          MOVE      CMON,F2
          LOAD      MTHNAM3,F2,JAN,FEB,MAR,APR,MAY,JUN,JUL,AUG,SEP,OCT,NOV,DEC
          WRITE     HTMLFILE;CDAY,SP1,MTHNAM3,SP1,CCENT,CYEAR; 
          GOTO      PRTM9999
.
PRTM0500  WRITE     HTMLFILE;PRITDESC;  * Item Desc 
          GOTO      PRTM9999
.
PRTM0600  COMPARE   ZERO,PRITKEYI
          GOTO      PRTM9999 IF EQUAL 
          WRITE     HTMLFILE;PRITKEYI;  * Key Indicator
          GOTO      PRTM9999
.
PRTM0700  COMPARE   ZERO,PRITSFEE
          GOTO      PRTM9999 IF EQUAL 
          WRITE     HTMLFILE;PRITSFEE;  * Item Schedule Fee
          GOTO      PRTM9999
.
PRTM0800  MOVE      "PG",CATEGORY       * Set Code 
          MOVE      PRITSETC,CODE
          CALL      CODITM00
          GOTO      PRTM9999
.
PRTM0900  MATCH     SP70,PRITDAT2       * Item cease date
          GOTO      PRTM9999 IF EQUAL 
          UNPACK    PRITDAT2,CCENT,CYEAR,CMON,CDAY  * Effective Date
          MOVE      CMON,F2
          LOAD      MTHNAM3,F2,JAN,FEB,MAR,APR,MAY,JUN,JUL,AUG,SEP,OCT,NOV,DEC
          WRITE     HTMLFILE;CDAY,SP1,MTHNAM3,SP1,CCENT,CYEAR; 
          GOTO      PRTM9999
.
PRTM1000  MATCH     SP70,PRITICAT
          GOTO      PRTM9999 IF EQUAL 
          WRITE     HTMLFILE;PRITICAT;  * Item Category
          GOTO      PRTM9999
.
PRTM1100  MATCH     SP70,PRITIGRP
          GOTO      PRTM9999 IF EQUAL 
          WRITE     HTMLFILE;PRITIGRP;  * Item Group
          GOTO      PRTM9999
.
PRTM1200  MATCH     SP70,PRITSGRP
          GOTO      PRTM9999 IF EQUAL 
          WRITE     HTMLFILE;PRITSGRP;  * Item Subgroup
          GOTO      PRTM9999
.
PRTM1300  MATCH     SP70,PRITFTYP
          GOTO      PRTM9999 IF EQUAL 
          WRITE     HTMLFILE;PRITFTYP;  * Fee Type
          GOTO      PRTM9999
.
PRTM1400  MATCH     SP70,PRITPTYP
          GOTO      PRTM9999 IF EQUAL 
          WRITE     HTMLFILE;PRITPTYP;  * Provider Type
          GOTO      PRTM9999
.
PRTM1500  WRITE     HTMLFILE;PRITPATH;  * Pathology Item Indicator
          GOTO      PRTM9999
.
PRTM1600  COMPARE   ZERO,PRITMAXR
          GOTO      PRTM9999 IF EQUAL 
          WRITE     HTMLFILE;PRITMAXR;  * Maximum No. of requests
          GOTO      PRTM9999
.
PRTM1700  COMPARE   ZERO,PRITDAYS
          GOTO      PRTM9999 IF EQUAL 
          WRITE     HTMLFILE;PRITDAYS;  * Period of days
          GOTO      PRTM9999
.
PRTM1800  MATCH     SP70,PRITSTEP
          GOTO      PRTM9999 IF EQUAL 
          WRITE     HTMLFILE;PRITSTEP;  * Item stepdown 
          GOTO      PRTM9999
.
PRTM1900  MATCH     SP70,PRITSTSB
          GOTO      PRTM9999 IF EQUAL 
          WRITE     HTMLFILE;PRITSTSB;  * Sub-item stepdown
          GOTO      PRTM9999
.
PRTM2000  WRITE     HTMLFILE;PRITFIXD;  * Fixed charge item
          GOTO      PRTM9999
.
PRTM2100  COMPARE   ZERO,PRITGSTA
          GOTO      PRTM9999 IF EQUAL 
          WRITE     HTMLFILE;PRITGSTA;  * GST Charge
          GOTO      PRTM9999
.
PRTM2200  CALL      CODGST00      * GST payable code fr. GST rate tabl 
          GOTO      PRTM9999
.
PRTM2300  MOVE      ONE,LNK2PRT  * Display row with link
          CALL      SPTCTA00     * AMA/MBS Item Code: Search Table 
          GOTO      PRTM9999
.
PRTM2400  CALL      NEXTGR00     * Link to Next Set 
          GOTO      PRTM9999
.
PRTM2500  CALL      PREVGR00     * Link to Prev Set 
          GOTO      PRTM9999
.
PRTM2600  WRITE     HTMLFILE;ITEMTYPE;
          GOTO      PRTM9999
.
PRTM2700  WRITE     HTMLFILE;PRITM001;     * Item Type CGI
          GOTO      PRTM9999
.
PRTM2800  WRITE     HTMLFILE;PRITM002;     * Item CGI
          GOTO      PRTM9999
.
PRTM2900  CALL      ITMTB000     * Table of AMA/MBS Items
          GOTO      PRTM9999
.
PRTM3000  CALL      NEXTIT00     * Link to Next Set of AMA/MBS Items
          GOTO      PRTM9999
.
PRTM3100  CALL      PREVIT00     * Link to Prev Set of AMA/MBS Items 
          GOTO      PRTM9999
.
PRTM3200  MOVE      TWO,LNK2PRT  * Display row with Update Parent Link
          CALL      SPTCTA00     * AMA/MBS Item Code: Search Table 
          GOTO      PRTM9999
.
PRTM3300  MATCH     " 0",PRITM001
          IF        @EQUAL 
            WRITE     HTMLFILE;"MBS";
          ELSE
            WRITE     HTMLFILE;"AMA";
          ENDIF
          GOTO      PRTM9999
.
PRTM3400  WRITE     HTMLFILE;PRITM003;    * Sub Item CGI
          GOTO      PRTM9999
.
PRTM3500  CALL      STPDES00        * Step Down Item Description
          GOTO      PRTM9999
.
PRTM3600  WRITE     HTMLFILE;PRITM005;    * Item Description
          GOTO      PRTM9999
.
PRTM3700  COMPARE   ZERO,PRITFLAG
          IF        @EQUAL 
            WRITE     HTMLFILE;"MBS";
          ELSE
            WRITE     HTMLFILE;"AMA";
          ENDIF
          GOTO      PRTM9999
.
PRTM3800  COMPARE   ZERO,PRITSF75
          GOTO      PRTM9999 IF EQUAL
          WRITE     HTMLFILE;PRITSF75;
          GOTO      PRTM9999
.
PRTM3900  COMPARE   ZERO,PRITSF85
          GOTO      PRTM9999 IF EQUAL
          WRITE     HTMLFILE;PRITSF85;
          GOTO      PRTM9999
.
PRTM4000  COMPARE   ZERO,PRITSAFE
          GOTO      PRTM9999 IF EQUAL
          WRITE     HTMLFILE;PRITSAFE;
          GOTO      PRTM9999
.
PRTM4100  WRITE     HTMLFILE;PRITPDTI;
          GOTO      PRTM9999
.
PRTM4200  MOVE      THREE,LNK2PRT  * Remote Service JSON Response
          CALL      SPTCTA00       * AMA/MBS Item Code: Search Table 
          GOTO      PRTM9999
.
PRTM4300  MOVE      FOUR,LNK2PRT 
          CALL      SPTCTA00    
          GOTO      PRTM9999
.
PRTM9999  RETURN
.-------------------------------------------------------------------------------
. Option 2 -  Copy schedule fee
.-------------------------------------------------------------------------------
PRSC0000  BRANCH    FLDITMNO,PRSC0100,PRSC0200,PRSC0300
          GOTO      PRSC9999
.
PRSC0100  UNPACK    DIM127,D1,KEY1,DIM127
          MOVE      ZERO,F1
          MOVE      KEY1,F1
          BRANCH    F1,PRSC0110,PRSC0120,PRSC0120
          WRITE     HTMLFILE;PRDOPRAC;
          GOTO      PRSC9999
.
PRSC0110  PACK      KEY6,PRDOPRAC,SP70
          CALL      RDPRPR1
          IF        OVRCD=0
            WRITE     HTMLFILE;PRPRDESC;
          ELSE
            WRITE     HTMLFILE;PRDOPRAC;
          ENDIF
          GOTO      PRSC9999
.
PRSC0120  PACK      KEY6,SP10
          CALL      RSPRPR1
PRSC0125  CALL      RKPRPR1
          BRANCH    OVRCD,PRSC9999
.
          COMPARE   ZERO,PRPRSTAT           * Is Medical Practice Active?
          GOTO      PRSC0125 IF NOT EQUAL   * No, get next record
.
          PACK      KEY8,QUOTE,PRPRCODE,QUOTE
.
          MATCH     PRDOPRAC,PRPRCODE
          IF        @EQUAL
             IF        F1=3
               WRITE     HTMLFILE;"<option value=",KEY8," selected>":
                         PRPRDESC,"</option>"
             ELSE
               WRITE     HTMLFILE;"<option value=",KEY8," selected>":
                         "(",PRPRCODE,") ",PRPRDESC,"</option>"
             ENDIF
          ELSE
             IF        F1=3
               WRITE     HTMLFILE;"<option value=",KEY8,">":
                         PRPRDESC,"</option>"
             ELSE
               WRITE     HTMLFILE;"<option value=",KEY8,">":
                         "(",PRPRCODE,") ",PRPRDESC,"</option>"
             ENDIF
          ENDIF
          GOTO      PRSC0125
.
PRSC0200  MOVE      PRDODOCT,DOCTCODE   * Associated Doctor
          PACK      GENPCODE,DOCTCODE,SP70
          CALL      HCPDET00            * Get Doctor Details
          GOTO      PRSC9999
.
PRSC0300  WRITE     HTMLFILE;DEFTTYPE;
          GOTO      PRSC9999
PRSC9999  RETURN
.-------------------------------------------------------------------------------
. Option 3 - AMA/MBS Other Item Maintenance
.-------------------------------------------------------------------------------
PRGP0000  BRANCH    FLDITMNO,PRGP0100,PRGP0200,PRGP0300,PRGP0400,PRTM0500:
                             PRGP0600,PRGP0700,PRGP0800,PRGP0900
          GOTO      PRGP9999
.
PRGP0100  WRITE     HTMLFILE;PRGPFLAG;  
          GOTO      PRGP9999
.
PRGP0200  WRITE     HTMLFILE;PRGPITM1;  
          GOTO      PRGP9999
.
PRGP0300  WRITE     HTMLFILE;PRGPSUB1;  
          GOTO      PRGP9999
.
PRGP0400  UNPACK    DIM127,D1,KEY1,DIM127
          MOVE      ZERO,F1
          MOVE      KEY1,F1
          BRANCH    F1,PRGP0410
.
          WRITE     HTMLFILE;PRGPDATE;   * Unformattted Date
          GOTO      PRGP9999
.
PRGP0410  UNPACK    PRGPDATE,CCENT,CYEAR,CMON,CDAY  * Effective Date
          MOVE      CMON,F2
          LOAD      MTHNAM3,F2,JAN,FEB,MAR,APR,MAY,JUN,JUL,AUG,SEP,OCT,NOV,DEC
          WRITE     HTMLFILE;CDAY,SP1,MTHNAM3,SP1,CCENT,CYEAR; 
          GOTO      PRGP9999
.
PRGP0500  WRITE     HTMLFILE;PRGPITM2;  
          GOTO      PRGP9999
.
PRGP0600  WRITE     HTMLFILE;PRGPSUB2;  
          GOTO      PRGP9999
.
PRGP0700  CALL      GRPTB000     * Table of AMA/MBS Other Items
          GOTO      PRGP9999
.
PRGP0800  CALL      NXTGRP00     * Link to Next Set of AMA/MBS Other Items
          GOTO      PRGP9999
.
PRGP0900  CALL      PRVGRP00     * Link to Prev Set of AMA/MBS Other Items 
          GOTO      PRGP9999
.
PRGP9999  RETURN.
.-------------------------------------------------------------------------------
. Option 6 - Pathology Tests Maintenance/Search
.-------------------------------------------------------------------------------
PRTS0000  BRANCH    FLDITMNO,PRTS0100,PRTS0200,PRTS0300,PRTS0400,PRTS0500:
                             PRTS0600,PRTS0700,PRTS0800,PRTS0900,PRTS1000:
                             PRTS1100,PRTS1200,PRTS1300,PRTS1400,PRTS1500:
                             PRTS1600,PRTS1700,PRTS1800,PRTS1900
          GOTO      PRTS9999
.
PRTS0100  WRITE     HTMLFILE;PRTECODE;   * Test Code    
          GOTO      PRTS9999
.
PRTS0200  UNPACK    DIM127,D1,KEY1,DIM127
          MOVE      ZERO,F1
          MOVE      KEY1,F1
          BRANCH    F1,PRTS0210
.
          WRITE     HTMLFILE;PRTEDATE;   * Unformattted Date
          GOTO      PRTM9999
.
PRTS0210  UNPACK    PRTEDATE,CCENT,CYEAR,CMON,CDAY  * Effective Date
          MOVE      CMON,F2
          LOAD      MTHNAM3,F2,JAN,FEB,MAR,APR,MAY,JUN,JUL,AUG,SEP,OCT,NOV,DEC
          WRITE     HTMLFILE;CDAY,SP1,MTHNAM3,SP1,CCENT,CYEAR;
          GOTO      PRTS9999
.
PRTS0300  WRITE     HTMLFILE;PRTEDESC;   * Test Description
          GOTO      PRTS9999
.
PRTS0400  WRITE     HTMLFILE;PRTEITMN;   * MBS Item No
          GOTO      PRTS9999
.
PRTS0500  WRITE     HTMLFILE;PRTESUBN;   * MBS Subitem No.
          GOTO      PRTS9999
.
PRTS0600  MOVE      ZERO,FORM2 * Set to MBS
          PACK      KEY22,FORM2,PRTEITMN,PRTESUBN,Z70 * Get current record
          CALL      RSPRIT1
          CALL      RPPRIT1
          BRANCH    OVRCD,PRTS9999
.
          COMPARE   FORM2,PRITFLAG           * Item Type
          GOTO      PRTS9999 IF NOT EQUAL
.
          MATCH     PRTEITMN,PRITITMN        * AMA/MBS Item
          GOTO      PRTS9999 IF NOT EQUAL
.
          MATCH     PRTESUBN,PRITSUBN        * Sub Item
          GOTO      PRTS9999 IF NOT EQUAL
.
          WRITE     HTMLFILE;PRITDESC;       * MBS Code Description
          GOTO      PRTS9999
.
PRTS0700  UNPACK    DIM127,D1,KEY1,DIM127    * AMA Item No
          MOVE      ZERO,F1
          MOVE      KEY1,F1
          BRANCH    F1,PRTS0710

          WRITE     HTMLFILE;PRTEAMAN;
          GOTO      PRTS9999

PRTS0710  MOVE      ONE,FORM2 * Set to AMA
          PACK      KEY22,FORM2,PRTEAMAN,Z70 * Get current record
          CALL      RSPRIT1
          CALL      RPPRIT1
          BRANCH    OVRCD,PRTS9999
.
          COMPARE   FORM2,PRITFLAG           * Item Type
          GOTO      PRTS9999 IF NOT EQUAL
.
          MATCH     PRTEAMAN,PRITITMN        * AMA/MBS Item
          GOTO      PRTS9999 IF NOT EQUAL
.
          WRITE     HTMLFILE;PRITDESC;       * AMA Code Description
          GOTO      PRTS9999
.
PRTS0800  WRITE     HTMLFILE;PRTEMSER;       * Multiple Service Code   
          GOTO      PRTS9999
.
PRTS0900  WRITE     HTMLFILE;PRTETESN;       * No. of Mult Service Proc 
          GOTO      PRTS9999

PRTS1000  PACK      KEY16,PRTEMSER,Z70       * Mult Service Desc 
          CALL      RSPRMU1
PRTS1010  CALL      RPPRMU1
          BRANCH    OVRCD,PRTS9999
.
          MATCH     PRTEMSER,PRMUCODE        * Multiple Service Code
          GOTO      PRTS9999 IF NOT EQUAL
.
          COMPARE   PRTETESN,PRMUNUMB        * No of Procedures 
          GOTO      PRTS1010 IF NOT EQUAL
.
          WRITE     HTMLFILE;PRMUDESC;       * Code Description
          GOTO      PRTS9999
.
PRTS1100  MATCH     SP70,PRTEABRV            * Standard Abbreviation
          GOTO      PRTS9999 IF EQUAL
          WRITE     HTMLFILE;PRTEABRV;
          GOTO      PRTS9999
.
PRTS1200  MOVE      ONE,LNK2PRT  * Display row with link
          CALL      SPTESA00     * Pathology Code: Search Table
          GOTO      PRTS9999
.
PRTS1300  MOVE      TWO,LNK2PRT  * Display row with UpdateParent link
          CALL      SPTESA00     * Pathology Code: Search Table
          GOTO      PRTS9999
.
PRTS1400  CALL      NEXTTS00     * Link to Next Set of Keywords
          GOTO      PRTS9999
.
PRTS1500  CALL      PREVTS00     * Link to Prev Set of Keywords
          GOTO      PRTS9999
.
PRTS1600  CALL      TESTB000     * Table of Pathology Code Effective Dates 
          GOTO      PRTS9999
.
PRTS1700  CALL      NEXTIT00     * Link to Next Set of AMA/MBS Items
          GOTO      PRTS9999
.
PRTS1800  CALL      PREVIT00     * Link to Prev Set of AMA/MBS Items
          GOTO      PRTS9999
.
PRTS1900  WRITE     HTMLFILE;PRITS001;   * Test Code CGI
          GOTO      PRTS9999
.
PRTS9999  RETURN
.-------------------------------------------------------------------------------
. Option 7 - Multiple Services Maintenance
.-------------------------------------------------------------------------------
PRML0000  BRANCH    FLDITMNO,PRML0100,PRML0200,PRML0300,PRML0400,PRML0500:
                             PRML0600,PRML0700,PRML0800,PRML0900,PRML1000:
                             PRML1100,PRML1200,PRML1300,PRML1400,PRML1500:
                             PRML1600,PRML1700,PRML1800,PRML1900,PRML2000
          GOTO      PRML9999
.
PRML0100  WRITE     HTMLFILE;PRMUCODE;   * Multiple Services Code    
          GOTO      PRML9999
.
PRML0200  UNPACK    PRMUDATE,CCENT,CYEAR,CMON,CDAY  * Effective Date
          MOVE      CMON,F2
          LOAD      MTHNAM3,F2,JAN,FEB,MAR,APR,MAY,JUN,JUL,AUG,SEP,OCT,NOV,DEC
          WRITE     HTMLFILE;CDAY,SP1,MTHNAM3,SP1,CCENT,CYEAR;
          GOTO      PRML9999
.
PRML0300  WRITE     HTMLFILE;PRMUNUMB;   * Num of Procedures
          GOTO      PRML9999
.
PRML0400  WRITE     HTMLFILE;PRMUDESC;   * Description
          GOTO      PRML9999
.
PRML0500  MATCH     SP70,PRMUITMN
          GOTO      PRML9999 IF EQUAL
          WRITE     HTMLFILE;PRMUITMN;   * MBS Item   
          GOTO      PRML9999
.
PRML0600  MATCH     SP70,PRMUSUBN
          GOTO      PRML9999 IF EQUAL
          WRITE     HTMLFILE;PRMUSUBN;   * MBS Sub-Item   
          GOTO      PRML9999
.
PRML0700  MATCH     SP70,PRMUAMAN
          GOTO      PRML9999 IF EQUAL
          WRITE     HTMLFILE;PRMUAMAN;   * AMA Item   
          GOTO      PRML9999
.
PRML0800  MOVE      ZERO,LNK2PRT
          CALL      MULTB000     * Table of Multiple Services by Code
          GOTO      PRML9999
.
PRML0900  CALL      NEXTML00     * Link to Next Set of Codes
          GOTO      PRML9999
.
PRML1000  CALL      PREVML00     * Link to Prev Set of Codes
          GOTO      PRML9999
.
PRML1100  MOVE      ZERO,LNK2PRT
          CALL      MULDS000     * Table of Multiple Services by Desc
          GOTO      PRML9999
.
PRML1200  CALL      MLETB000     * Table of Multiple Services Effective Dates
          GOTO      PRML9999
.
PRML1300  CALL      NEXTME00     * Link to Next Set of Codes
          GOTO      PRML9999
.
PRML1400  CALL      PREVME00     * Link to Prev Set of Codes
          GOTO      PRML9999
.
PRML1500  WRITE     HTMLFILE;PRIML001;    
          GOTO      PRML9999
.
PRML1600  CALL      TSTTB000     * Table of Multiple Item Tests
          GOTO      PRML9999
.
PRML1700  CALL      NXTTST00     * Link to Next Set of Multiple Services Tests 
          GOTO      PRML9999
.
PRML1800  CALL      PRVTST00     * Link to Prev Set of Multiple Services Tests 
          GOTO      PRML9999
.
PRML1900  CALL      TSTCNT00     * Tests Counter 
          WRITE     HTMLFILE;COUNT;
          GOTO      PRML9999
.
PRML2000  MOVE      ONE,LNK2PRT
          CALL      MULTB000     * Table of Multiple Services by Code
          GOTO      PRML9999
.
PRML9999  RETURN
.------------------------------------------------------------
. Tests Counter                                     
.------------------------------------------------------------
TSTCNT00  MOVE      ZERO,COUNT
          PACK      KEY16,PRIML001,PRIML002,SP70
          CALL      RSPRMU1
TSTCNT10  CALL      RKPRMU1
          BRANCH    OVRCD,TSTCNT99
.
          MATCH     PRIML001,PRMUCODE        * Multiple Service Code
          GOTO      TSTCNT99 IF NOT EQUAL
.
          MATCH     PRIML002,PRMUDATE        * Effective Date
          GOTO      TSTCNT99 IF NOT EQUAL
.
          ADD       ONE,COUNT
          GOTO      TSTCNT10
.
TSTCNT99  RETURN
.------------------------------------------------------------
. Output Step Down Item Description Based on CGI Vars
.------------------------------------------------------------
STPDES00  MOVE      PRITFLAG,SAVPFLAG    * Save current Step Down Vars
          MOVE      PRITSTEP,SAVPSTEP    * as we are reading the same file
          MOVE      PRITSTSB,SAVPSTSB    * for the description!
.
          PACK      KEY22,SAVPFLAG,SAVPSTEP,SAVPSTSB,Z70 * Get current record
          CALL      RSPRIT1
          CALL      RPPRIT1
          BRANCH    OVRCD,STPDES90
.
          COMPARE   SAVPFLAG,PRITFLAG        * Item Type
          GOTO      STPDES90 IF NOT EQUAL
.
          MATCH     SAVPSTEP,PRITITMN        * AMA/MBS Item
          GOTO      STPDES90 IF NOT EQUAL
.
          MATCH     SAVPSTSB,PRITSUBN        * Sub Item    
          GOTO      STPDES90 IF NOT EQUAL
.
          WRITE     HTMLFILE;PRITDESC;
.
. Reposition back to original record
.
STPDES90  PACK      KEY22,PRITM001,PRITM002,PRITM003,PRITM004,SP70
          CALL      RDPRIT1
.
STPDES99  RETURN
.------------------------------------------------------------
. GST Code Selection List
.------------------------------------------------------------
CODGST00  PACK      KEY6,SP70
          CALL      RSIBGS1
CODGST10  CALL      RKIBGS1
          BRANCH    OVRCD,CODGST99
.
          COMPARE   "1",IBGSACTV
          GOTO      CODGST10 IF EQUAL
.
          MATCH     PRITGSTC,IBGSCODE
          IF        @EQUAL
            WRITE     HTMLFILE;"<option value=",IBGSCODE," selected>":
                               IBGSDESC,"</option>"
          ELSE
            WRITE     HTMLFILE;"<option value=",IBGSCODE,">":
                               IBGSDESC,"</option>"
          ENDIF
.
          GOTO      CODGST10
.
CODGST99  RETURN
.-----------------------------------------------------------
. Link to Next Group
.-----------------------------------------------------------
NEXTGR00  MOVE      NORECORD,KEY2
          REP       " +",KEY2
          ASSIGN    STARTNUM+NORECORD,F3
          MOVE      F3,KEY3
          REP       " +",KEY3
          UNPACK    DIM127,D1,FLDPARA,DIM127
          MOVE      REPORTNO,F1
.
          REP       " +",ITEMTYPE
.
          WRITE     HTMLFILE;"priweb05.pbl":
                                 "?reportno=",F1:
                                 "&template=",FLDPARA:
                                 "&startnum=",KEY3:
                                 "&norecord=",KEY2:
                                 "&itemtype=",ITEMTYPE:
                                 "&keywords=",KEYWORDS;
.
          REP       "+ ",ITEMTYPE
.
NEXTGR99  RETURN
.-------------------------------------------------------------
. Link to Prev Group
.-------------------------------------------------------------
PREVGR00  MOVE      NORECORD,KEY2
          REP       " +",KEY2
          ASSIGN    STARTNUM-NORECORD,F3
          IF        F3<0
            MOVE      ZERO,F3
          ENDIF
          MOVE      F3,KEY3
          REP       " +",KEY3
          UNPACK    DIM127,D1,FLDPARA,DIM127
          MOVE      REPORTNO,F1
.
          REP       " +",ITEMTYPE
.
          WRITE     HTMLFILE;"priweb05.pbl":
                                 "?reportno=",F1:
                                 "&template=",FLDPARA:
                                 "&startnum=",KEY3:
                                 "&norecord=",KEY2:
                                 "&itemtype=",ITEMTYPE:
                                 "&keywords=",KEYWORDS;
.
          REP       "+ ",ITEMTYPE
.
PREVGR99  RETURN
.-----------------------------------------------------------
. Link to Next Group
.-----------------------------------------------------------
NEXTTS00  MOVE      NORECORD,KEY2
          REP       " +",KEY2
          ASSIGN    STARTNUM+NORECORD,F3
          MOVE      F3,KEY3
          REP       " +",KEY3
          UNPACK    DIM127,D1,FLDPARA,DIM127
          MOVE      REPORTNO,F1
.
          WRITE     HTMLFILE;"priweb05.pbl":
                                 "?reportno=",F1:
                                 "&template=",FLDPARA:
                                 "&startnum=",KEY3:
                                 "&norecord=",KEY2:
                                 "&keywords=",KEYWORDS:
                                 "&prits001=",PRITS001;
.
NEXTTS99  RETURN
.-------------------------------------------------------------
. Link to Prev Group
.-------------------------------------------------------------
PREVTS00  MOVE      NORECORD,KEY2
          REP       " +",KEY2
          ASSIGN    STARTNUM-NORECORD,F3
          IF        F3<0
            MOVE      ZERO,F3
          ENDIF
          MOVE      F3,KEY3
          REP       " +",KEY3
          UNPACK    DIM127,D1,FLDPARA,DIM127
          MOVE      REPORTNO,F1
.
          WRITE     HTMLFILE;"priweb05.pbl":
                                 "?reportno=",F1:
                                 "&template=",FLDPARA:
                                 "&startnum=",KEY3:
                                 "&norecord=",KEY2:
                                 "&keywords=",KEYWORDS:
                                 "&prits001=",PRITS001;
.
PREVTS99  RETURN
.-----------------------------------------------------------
. AMA/MBS Item Code: Search Table
.-----------------------------------------------------------
SPTCTA00  IF        LNK2PRT=3
            WRITE     HTMLFILE;"[";
          ELSE
            WRITE     HTMLFILE;"<tr align=center>":
                               "<td class=HeadingCell colspan=5>":
                               "<b>You Searched for ":
                               KEYWORDS,"</td></tr><tr>":
                               "<td class=HeadingCell width=20%><b>Code</b>":
                               "</td>":
                               "<td class=HeadingCell><b>Description</b></td>":
                               "<td class=HeadingCell><b>Effective Date</b>":
                               "<td class=HeadingCell><b>Activity</b>":
                               "<td class=HeadingCell><b>Pathology</b>":
                               "</td></tr>"
          ENDIF
.
          CALL      GETWRD00
.
          UNPACK    DIM127,D1,LINKPRG,DIM127
          UNPACK    DIM127,D1,LINKREP,DIM127
          UNPACK    DIM127,D1,LINKTEM,DIM127
.
          IF        NORECORD=0
            MOVE      PTCNNRTD,NORECORD      * Set Default No Records to Display
          ENDIF
          MOVE      ZERO,RECNUMB
          MOVE      ZERO,DISNUMB
.
          STRIP     KEYWRD01
          PACK      KEY26,ITEMTYPE,KEYWRD01,SP70
          CALL      RSPRIK2
SPTCTA10  CALL      RKPRIK2
          BRANCH    OVRCD,SPTCTA90
.
          MATCH     PRIKTFLG,ITEMTYPE        * Item Type
          GOTO      SPTCTA90 IF NOT EQUAL
.
          CALL      SPTCTB00
          BRANCH    OVRCD,SPTCTA10,SPTCTA90
.
          MOVE      Z70,SAVSUB
.
          PACK      KEY22,PRIKTFLG,PRIKKITM,SAVSUB,Z70  
          CALL      RSPRIT1
SPTCTA20  CALL      RPPRIT1
          BRANCH    OVRCD,SPTCTA10
.
SPTCTA21  MATCH     PRIKTFLG,DPRITFLG        * Item Type
          GOTO      SPTCTA10 IF NOT EQUAL
.
          MATCH     PRIKKITM,PRITITMN        * AMA/MBS Item 
          GOTO      SPTCTA10 IF NOT EQUAL
.
          MATCH     Z70,SAVSUB
          IF        !@EQUAL 
            MATCH     SAVSUB,PRITSUBN        * AMA/MBS Subitem 
            GOTO      SPTCTA20 IF EQUAL
          ENDIF
.
          MATCH     SP70,VSUBITEM
          IF        !@EQUAL
            MATCH     VSUBITEM,PRITSUBN
            GOTO      SPTCTA20 IF NOT EQUAL
          ENDIF
.
          MATCH     CURRDATE,PRITDAT1       * check if Effective date in future
          GOTO      SPTCTA25 IF LESS
          GOTO      SPTCTA25 IF EQUAL
          GOTO      SPTCTA20
.
SPTCTA25  MOVE      "&nbsp;",KEY10
          MATCH     SP8,PRITDAT2            * is there a Cease Date?  *I-230710
          IF        !@EQUAL
            MATCH     CURRDATE,PRITDAT2     * Item Cease date < mult.serv date?
            IF        @LESS
              MOVE      "Inactive",KEY10
            ENDIF
          ENDIF                                                 * end *I-230710
.
          MOVE      PRITSUBN,SAVSUB
.
          ADD       ONE,RECNUMB
          IF        STARTNUM>=RECNUMB
            GOTO      SPTCTA20
          ENDIF
.
          BRANCH    LNK2PRT,SPTCTA50,SPTCTA60,SPTCTA70,SPTCTA75
          GOTO      SPTCTA99  
.
.
SPTCTA50  MATCH     SP70,PRITSUBN
          IF        !@EQUAL 
            CLEAR     KEY35 
            STRIP     PRITITMN 
            APPEND    PRITITMN,KEY35
            APPEND    SLASH,KEY35   
            APPEND    PRITSUBN,KEY35
          ELSE 
            MOVE      PRITITMN,KEY35
          ENDIF
.
          UNPACK    PRITDAT1,CCENT,CYEAR,CMON,CDAY  * Effective Date
          MOVE      CMON,F2
          LOAD      MTHNAM3,F2,JAN,FEB,MAR,APR,MAY,JUN,JUL,AUG,SEP,OCT,NOV,DEC
          PACK      KEY11,CDAY,SP1,MTHNAM3,SP1,CCENT,CYEAR
.
          MOVE      "Pathology",KEY16
          COMPARE   ONE,PRITPATH
          IF        @EQUAL
            MOVE      "Non-Pathology",KEY16
          ELSE
            COMPARE   TWO,PRITPATH
            IF        @EQUAL
              MOVE      "IMC Derived Item",KEY16
            ENDIF
          ENDIF
.          
          WRITE     HTMLFILE;"<tr><td nowrap><A HREF='javascript:showItem":
                             "(#"",LINKPRG,"#.pbl":
                             "?reportno=",LINKREP:
                             "&template=",LINKTEM:
                             "&pritm001=",PRITFLAG:
                             "&pritm002=",PRITITMN:
                             "&pritm003=",PRITSUBN:
                             "&pritm005=",PRITDESC,"#")'>":
                             "<img src=../images/MaintenanceIcon.gif hspace=4":
                             " border=0 align=absmiddle></a>":
                             KEY35,"</td>":
                             "<td>",PRITDESC,"</td>":
                             "<td>",KEY11,"</td>":
                             "<td>",KEY10,"</td>":
                             "<td>",KEY16,"</td>":
                             "</tr>"
.
          GOTO      SPTCTA80                * finish
.
SPTCTA60  MOVE      PRITDESC,KEY30 
          REP       "#' ",KEY30 
.
          MATCH     SP70,PRITSUBN
          IF        !@EQUAL 
            CLEAR     KEY35 
            STRIP     PRITITMN 
            APPEND    PRITITMN,KEY35
            APPEND    SLASH,KEY35   
            APPEND    PRITSUBN,KEY35
          ELSE 
            MOVE      PRITITMN,KEY35
          ENDIF
.
          UNPACK    PRITDAT1,CCENT,CYEAR,CMON,CDAY  * Effective Date
          MOVE      CMON,F2
          LOAD      MTHNAM3,F2,JAN,FEB,MAR,APR,MAY,JUN,JUL,AUG,SEP,OCT,NOV,DEC
          PACK      KEY11,CDAY,SP1,MTHNAM3,SP1,CCENT,CYEAR
.
          MOVE      "Pathology",KEY16
          COMPARE   ONE,PRITPATH
          IF        @EQUAL
            MOVE      "Non-Pathology",KEY16
          ELSE
            COMPARE   TWO,PRITPATH
            IF        @EQUAL
              MOVE      "IMC Derived Item",KEY16
            ENDIF
          ENDIF
.
          WRITE     HTMLFILE;"<tr valign=top>":
                             "<td><A HREF=#"javascript:":
                             "updateParent('",PRITFLAG,"','",PRITITMN,"','":
                             PRITSUBN,"','",PRITDAT1,"','",KEY30,"')#">":
                             "<img src=../images/MaintenanceIcon.gif hspace=4":
                             " border=0 align=absmiddle></a>":
                             KEY35,"</td>":
                             "<td>",PRITDESC,"</td>":
                             "<td>",KEY11,"</td>":
                             "<td>",KEY10,"</td>":
                             "<td>",KEY16,"</td>":
                             "</tr>"
          GOTO      SPTCTA80                * finish
.
SPTCTA70  UNPACK    PRITDAT1,CCENT,CYEAR,CMON,CDAY  * Effective Date
          MOVE      CMON,F2
          LOAD      MTHNAM3,F2,JAN,FEB,MAR,APR,MAY,JUN,JUL,AUG,SEP,OCT,NOV,DEC
          PACK      KEY11,CDAY,SP1,MTHNAM3,SP1,CCENT,CYEAR
          WRITE     HTMLFILE;"{#"code#":#"",PRITITMN,"#",":
                             "#"value#":#"",PRITDESC,"#",":
                             "#"subtext#":#"Item:",PRITITMN," Eff:",KEY11,"&nbsp;#"},";
          GOTO      SPTCTA80
.
SPTCTA75  MOVE      PRITDESC,KEY30
          REP       "#' ",KEY30
.
          MATCH     SP70,PRITSUBN
          IF        !@EQUAL
            CLEAR     KEY35
            STRIP     PRITITMN
            APPEND    PRITITMN,KEY35
            APPEND    SLASH,KEY35
            APPEND    PRITSUBN,KEY35
          ELSE
            MOVE      PRITITMN,KEY35
          ENDIF
.
          UNPACK    PRITDAT1,CCENT,CYEAR,CMON,CDAY  * Effective Date
          MOVE      CMON,F2
          LOAD      MTHNAM3,F2,JAN,FEB,MAR,APR,MAY,JUN,JUL,AUG,SEP,OCT,NOV,DEC
          PACK      KEY11,CDAY,SP1,MTHNAM3,SP1,CCENT,CYEAR
.
          MOVE      "Pathology",KEY16
          COMPARE   ONE,PRITPATH
          IF        @EQUAL
            MOVE      "Non-Pathology",KEY16
          ELSE
            COMPARE   TWO,PRITPATH
            IF        @EQUAL
              MOVE      "IMC Derived Item",KEY16
            ENDIF
          ENDIF
.
          WRITE     HTMLFILE;"<tr valign=top>":
                             "<td><A HREF=#"javascript:":
                             "updateParent('",PRITFLAG,"','",PRITITMN,"','":
          PRITSUBN,"','",PRITDAT1,"','",KEY30,"','",KEY10,"')#">":
                             "<img src=../images/MaintenanceIcon.gif hspace=4":
                             " border=0 align=absmiddle></a>":
                             KEY35,"</td>":
                             "<td>",PRITDESC,"</td>":
                             "<td>",KEY11,"</td>":
                             "<td>",KEY10,"</td>":
                             "<td>",KEY16,"</td>":
                             "</tr>"
          GOTO      SPTCTA80                * finish
. 
SPTCTA80  ADD       ONE,DISNUMB
          COMPARE   NORECORD,DISNUMB
          GOTO      SPTCTA20 IF NOT EQUAL
          GOTO      SPTCTA99
.
SPTCTA90  IF        RECNUMB = 0
          ENDIF
          IF        LNK2PRT=3
            WRITE     HTMLFILE;"]"
          ENDIF
.
          CALL      NOMORE00             * Display No More Records Message
.
SPTCTA99  RETURN
.------------------------------------------------------------
. Check AMA/MBS Item Record
.------------------------------------------------------------
SPTCTB00  MATCH     ITEMTYPE,PRIKTFLG
          GOTO      SPTCTB92 IF NOT EQUAL
.
          MATCH     KEYWRD01,PRIKKKWD
          GOTO      SPTCTB92 IF NOT EQUAL
.
          IF        KEYWRDNO>1
            PACK      SAVKEY26,PRIKTFLG,PRIKKKWD,PRIKKITM
            CALL      SPTCTC00
            BRANCH    EXIT,SPTCTB91
            MOVE      SAVKEY26,KEY26
            CALL      RDPRIK2
          ENDIF
.
... Insert Other Check for Valid Record Here i.e. Suspended or In Active
...   eg    COMPARE    ONE,INACTIVE
...         GOTO       SPTCTB91 IF EQUAL
.
          GOTO      SPTCTB90
.
SPTCTB90  MOVE      ZERO,OVRCD
          GOTO      SPTCTB99
.
SPTCTB91  MOVE      ONE,OVRCD
          GOTO      SPTCTB99
.
SPTCTB92  MOVE      TWO,OVRCD
SPTCTB99  RETURN
.------------------------------------------------------------
. Check for Matching AMA/MBS Item Words
.------------------------------------------------------------
SPTCTC00  MOVE      ONE,F2
          MOVE      ZERO,EXIT
          PACK      SAVKEY2,PRIKTFLG,SP70
          PACK      SAVKEY9,PRIKKITM,SP70
.
SPTCTC10  COMPARE   KEYWRDNO,F2           * Loop through each Key Word in Search
          GOTO      SPTCTC99 IF EQUAL     * Exit OK
          ADD       ONE,F2
          LOAD      KEYWRDXX,F2,KEYWRD01,KEYWRD02,KEYWRD03,KEYWRD04,KEYWRD05:
                             KEYWRD06,KEYWRD07,KEYWRD08,KEYWRD09,KEYWRD10
.
          PACK      KEY26,PRIKTFLG,PRIKKITM,KEYWRDXX
          CALL      RDPRIK1               * Check for Exact Match
          COMPARE   ZERO,OVRCD            * Ok so Continue Loop
          GOTO      SPTCTC10 IF EQUAL
.
          CALL      RKPRIK1               * Not Exact so Read Next Record
          BRANCH    OVRCD,SPTCTC90        * No Match So Exit No Match
.
          MATCH     SAVKEY2,PRIKTFLG      * Match Key Fields
          GOTO      SPTCTC90 IF NOT EQUAL * No Match So Exit

          PACK      KEY9,PRIKKITM,SP70
          MATCH     SAVKEY9,KEY9          * Match Key Fields
          GOTO      SPTCTC90 IF NOT EQUAL * No Match So Exit
.
          STRIP     KEYWRDXX
          MATCH     PRIKKKWD,KEYWRDXX     * Check Key Word
          GOTO      SPTCTC90 IF NOT EQUAL * No Match So Exit
.
          GOTO      SPTCTC10              * Check Next Search Word
.
SPTCTC90  MOVE      ONE,EXIT
SPTCTC99  RETURN
.-----------------------------------------------------------
. Pathology Tests: Search Table
.-----------------------------------------------------------
SPTESA00  WRITE     HTMLFILE;"<tr align=center>":
                             "<td class=HeadingCell colspan=3>":
                             "<b>You Searched for ":
                               KEYWORDS,"</td></tr><tr>":
                               "<td class=HeadingCell width=20%><b>Code</b>":
                               "</td>":
                               "<td class=HeadingCell><b>Description</b></td>":
                               "<td class=HeadingCell><b>Effective Date</b>":
                             "</td></tr>"
.
          CALL      GETWRD00
.
          UNPACK    DIM127,D1,LINKPRG,DIM127
          UNPACK    DIM127,D1,LINKREP,DIM127
          UNPACK    DIM127,D1,LINKTEM,DIM127
.
          IF        NORECORD=0
            MOVE      "13",NORECORD      * Set Default No Records to Display
          ENDIF
          MOVE      ZERO,RECNUMB
          MOVE      ZERO,DISNUMB
.
          STRIP     KEYWRD01
          PACK      KEY24,KEYWRD01,SP70
          CALL      RSPRTKI2
SPTESA10  CALL      RKPRTKI2
          BRANCH    OVRCD,SPTESA90
.
          CALL      SPTESB00
          BRANCH    OVRCD,SPTESA10,SPTESA90
.
          PACK      KEY17,PRTKPTST,Z70       * Read most Current Test Code 
          CALL      RSPRTE1
          CALL      RPPRTE1
          BRANCH    OVRCD,SPTESA10
.
          MATCH     PRTKPTST,PRTECODE        * Test Code    
          GOTO      SPTESA10 IF NOT EQUAL
.
          ADD       ONE,RECNUMB
          IF        STARTNUM>=RECNUMB
            GOTO      SPTESA10
          ENDIF
.
          BRANCH    LNK2PRT,SPTESA20,SPTESA30
          GOTO      SPTESA99  
.
SPTESA20  UNPACK    PRTEDATE,CCENT,CYEAR,CMON,CDAY  * Effective Date
          MOVE      CMON,F2
          LOAD      MTHNAM3,F2,JAN,FEB,MAR,APR,MAY,JUN,JUL,AUG,SEP,OCT,NOV,DEC
          PACK      KEY11,CDAY,SP1,MTHNAM3,SP1,CCENT,CYEAR
.          
          WRITE     HTMLFILE;"<tr><td nowrap><A HREF='javascript:showItem":
                             "(#"",LINKPRG,"#.pbl":
                             "?reportno=",LINKREP:
                             "&template=",LINKTEM:
                             "&prits001=",PRTECODE:
                             "&prits003=",PRTEDATE,"#")'>":
                             "<img src=../images/MaintenanceIcon.gif hspace=4":
                             " border=0 align=absmiddle></a>":
                             PRTECODE,"</td>":
                             "<td>",PRTEDESC,"</td>":
                             "<td>",KEY11,"</td>":
                             "</tr>"
.
          GOTO      SPTESA80  
.
SPTESA30  MOVE      PRTEDESC,KEY30 
          REP       "#' ",KEY30 
.
          UNPACK    PRTEDATE,CCENT,CYEAR,CMON,CDAY  * Effective Date
          MOVE      CMON,F2
          LOAD      MTHNAM3,F2,JAN,FEB,MAR,APR,MAY,JUN,JUL,AUG,SEP,OCT,NOV,DEC
          PACK      KEY11,CDAY,SP1,MTHNAM3,SP1,CCENT,CYEAR
.
          WRITE     HTMLFILE;"<tr valign=top>":
                             "<td><A HREF=#"javascript:":
                             "updateParent('",PRTECODE,"','",PRTEDATE,"','":
                             KEY30,"')#">":
                             "<img src=../images/MaintenanceIcon.gif hspace=4":
                             " border=0 align=absmiddle></a>":
                             PRTECODE,"</td>":
                             "<td>",PRTEDESC,"</td>":
                             "<td>",KEY11,"</td>":
                             "</tr>"
. 
SPTESA80  ADD       ONE,DISNUMB
          COMPARE   NORECORD,DISNUMB
          GOTO      SPTESA10 IF NOT EQUAL
          GOTO      SPTESA99
.
SPTESA90  CALL      NOMORE00      * Display No More Records Message
.
SPTESA99  RETURN
.------------------------------------------------------------
. Check Pathology Test Record
.------------------------------------------------------------
SPTESB00  MATCH     KEYWRD01,PRTKPKWD
          GOTO      SPTESB92 IF NOT EQUAL
.
          IF        KEYWRDNO>1
            PACK      SAVKEY24,PRTKPKWD,PRTKPTST
            CALL      SPTESC00
            BRANCH    EXIT,SPTESB91
            MOVE      SAVKEY24,KEY24
            CALL      RDPRTKI2
          ENDIF
.
... Insert Other Check for Valid Record Here i.e. Suspended or In Active
...   eg    COMPARE    ONE,INACTIVE
...         GOTO       SPTESB91 IF EQUAL
.
          GOTO      SPTESB90
.
SPTESB90  MOVE      ZERO,OVRCD
          GOTO      SPTESB99
.
SPTESB91  MOVE      ONE,OVRCD
          GOTO      SPTESB99
.
SPTESB92  MOVE      TWO,OVRCD
SPTESB99  RETURN
.------------------------------------------------------------
. Check for Matching Pathology Test Words
.------------------------------------------------------------
SPTESC00  MOVE      ONE,F2
          MOVE      ZERO,EXIT
          PACK      SAVKEY9,PRTKPTST,SP70
.
SPTESC10  COMPARE   KEYWRDNO,F2           * Loop through each Key Word in Search
          GOTO      SPTESC99 IF EQUAL     * Exit OK
          ADD       ONE,F2
          LOAD      KEYWRDXX,F2,KEYWRD01,KEYWRD02,KEYWRD03,KEYWRD04,KEYWRD05:
                             KEYWRD06,KEYWRD07,KEYWRD08,KEYWRD09,KEYWRD10
.
          PACK      KEY24,PRTKPTST,KEYWRDXX
          CALL      RDPRTKI1               * Check for Exact Match
          COMPARE   ZERO,OVRCD            * Ok so Continue Loop
          GOTO      SPTESC10 IF EQUAL
.
          CALL      RKPRTKI1               * Not Exact so Read Next Record
          BRANCH    OVRCD,SPTESC90        * No Match So Exit No Match
.
          PACK      KEY9,PRTKPTST,SP70
          MATCH     SAVKEY9,KEY9          * Match Key Fields
          GOTO      SPTESC90 IF NOT EQUAL * No Match So Exit
.
          STRIP     KEYWRDXX
          MATCH     PRTKPKWD,KEYWRDXX     * Check Key Word
          GOTO      SPTESC90 IF NOT EQUAL * No Match So Exit
.
          GOTO      SPTESC10              * Check Next Search Word
.
SPTESC90  MOVE      ONE,EXIT
SPTESC99  RETURN
.------------------------------------------------------------
. Table of Medicare Gaps      
.------------------------------------------------------------
MGPTB000  UNPACK    DIM127,D1,LINKPRG,DIM127
          UNPACK    DIM127,D1,LINKREP,DIM127
          UNPACK    DIM127,D1,LINKTEM,DIM127
.
          CALL      MGPHD000      * Output Table Heading
.
          IF        NORECORD=0
            MOVE      PTCNNRTD,NORECORD      * Set Default No Records to Display
          ENDIF
          MOVE      ZERO,RECNUMB
          MOVE      ZERO,DISNUMB
.
          PACK      KEY8,Z70
          CALL      RSPRMG1
MGPTB100  CALL      RPPRMG1
          BRANCH    OVRCD,MGPTB900
.
          ADD       ONE,RECNUMB
          IF        STARTNUM>=RECNUMB
            GOTO      MGPTB100
          ENDIF
.
          CALL      MGPRW000      * Display Medicare Gaps Table Details Row
          ADD       ONE,DISNUMB
          COMPARE   NORECORD,DISNUMB
          GOTO      MGPTB100 IF NOT EQUAL
          GOTO      MGPTB999
.
MGPTB900  CALL      NOMORE00      * Display No More Records Message 
.
MGPTB999  RETURN
.------------------------------------------------------------
. Medicare Gaps Table Details (TABLE HEADING)
.------------------------------------------------------------
MGPHD000  WRITE     HTMLFILE;"<tr>":
                               "<td class=HeadingCell width=60%>":
                               "Effective Date</td>":
                               "<td class=HeadingCell align=right width=30%>":
                               "Amount</td>":
                             "</tr>"
.
MGPHD999  RETURN
.------------------------------------------------------------
. Medicare Gaps Table (TABLE ROW)
.------------------------------------------------------------
MGPRW000  UNPACK    PRMGDATE,CCENT,CYEAR,CMON,CDAY  * Effective Date
          MOVE      CMON,F2
          LOAD      MTHNAM3,F2,JAN,FEB,MAR,APR,MAY,JUN,JUL,AUG,SEP,OCT,NOV,DEC
          PACK      KEY11,CDAY,SP1,MTHNAM3,SP1,CCENT,CYEAR
.
          WRITE     HTMLFILE;"<tr><td nowrap><A HREF='javascript:ShowDetail":
                             "(#"",LINKPRG,"#.pbl":
                             "?reportno=",LINKREP:
                             "&template=",LINKTEM:
                             "&primg001=",PRMGDATE,"#")'>":
                             "<img src=../images/MaintenanceIcon.gif hspace=4":
                             " border=0 align=absmiddle></a>":
                             KEY11,"</td>":
                             "<td align=right>$",PRMGVALU,"</td>":
                             "</tr>"
.
MGPRW999 RETURN
.-----------------------------------------------------------
. Link to Next List Page
.-----------------------------------------------------------
NEXTPR00  MOVE      NORECORD,KEY2
          REP       " +",KEY2
          ASSIGN    STARTNUM+NORECORD,F3
          MOVE      F3,KEY3
          REP       " +",KEY3
          UNPACK    DIM127,D1,FLDPARA,DIM127
          MOVE      REPORTNO,F1
.
          WRITE     HTMLFILE;"priweb05.pbl":
                                 "?reportno=",F1:
                                 "&template=",FLDPARA:
                                 "&startnum=",KEY3:
                                 "&norecord=",KEY2;
.
NEXTPR99  RETURN
.-----------------------------------------------------------
. Link to Prev List Page
.-----------------------------------------------------------
PREVPR00  MOVE      NORECORD,KEY2
          REP       " +",KEY2
          ASSIGN    STARTNUM-NORECORD,F3
          IF        F3<0
            MOVE      ZERO,F3
          ENDIF
          MOVE      F3,KEY3
          REP       " +",KEY3
          UNPACK    DIM127,D1,FLDPARA,DIM127
          MOVE      REPORTNO,F1
.
          WRITE     HTMLFILE;"priweb05.pbl":
                                 "?reportno=",F1:
                                 "&template=",FLDPARA:
                                 "&startnum=",KEY3:
                                 "&norecord=",KEY2;
.
PREVPR99  RETURN
.-----------------------------------------------------------
. Link to Next List Page
.-----------------------------------------------------------
NEXTML00  MOVE      NORECORD,KEY2
          REP       " +",KEY2
          ASSIGN    STARTNUM+NORECORD,F3
          MOVE      F3,KEY3
          REP       " +",KEY3
          UNPACK    DIM127,D1,FLDPARA,DIM127
          MOVE      REPORTNO,F1
.
          REP       " +",STARTKEY
.
          WRITE     HTMLFILE;"priweb05.pbl":
                                 "?reportno=",F1:
                                 "&template=",FLDPARA:
                                 "&startnum=",KEY3:
                                 "&norecord=",KEY2:
                                 "&startkey=",STARTKEY;
.
          REP       "+ ",STARTKEY
.
NEXTML99  RETURN
.-----------------------------------------------------------
. Link to Prev List Page
.-----------------------------------------------------------
PREVML00  MOVE      NORECORD,KEY2
          REP       " +",KEY2
          ASSIGN    STARTNUM-NORECORD,F3
          IF        F3<0
            MOVE      ZERO,F3
          ENDIF
          MOVE      F3,KEY3
          REP       " +",KEY3
          UNPACK    DIM127,D1,FLDPARA,DIM127
          MOVE      REPORTNO,F1
.
          REP       " +",STARTKEY
.
          WRITE     HTMLFILE;"priweb05.pbl":
                                 "?reportno=",F1:
                                 "&template=",FLDPARA:
                                 "&startnum=",KEY3:
                                 "&norecord=",KEY2:
                                 "&startkey=",STARTKEY;
.
          REP       "+ ",STARTKEY
.
PREVML99  RETURN
.-----------------------------------------------------------
. Link to Next List Page
.-----------------------------------------------------------
NEXTME00  MOVE      NORECORD,KEY2
          REP       " +",KEY2
          ASSIGN    STARTNUM+NORECORD,F3
          MOVE      F3,KEY3
          REP       " +",KEY3
          UNPACK    DIM127,D1,FLDPARA,DIM127
          MOVE      REPORTNO,F1
.
          REP       " +",PRIML001
.
          WRITE     HTMLFILE;"priweb05.pbl":
                                 "?reportno=",F1:
                                 "&template=",FLDPARA:
                                 "&startnum=",KEY3:
                                 "&norecord=",KEY2:
                                 "&priml001=",PRIML001;
.
          REP       "+ ",PRIML001
.
NEXTME99  RETURN
.-----------------------------------------------------------
. Link to Prev List Page
.-----------------------------------------------------------
PREVME00  MOVE      NORECORD,KEY2
          REP       " +",KEY2
          ASSIGN    STARTNUM-NORECORD,F3
          IF        F3<0
            MOVE      ZERO,F3
          ENDIF
          MOVE      F3,KEY3
          REP       " +",KEY3
          UNPACK    DIM127,D1,FLDPARA,DIM127
          MOVE      REPORTNO,F1
.
          REP       " +",PRIML001
.
          WRITE     HTMLFILE;"priweb05.pbl":
                                 "?reportno=",F1:
                                 "&template=",FLDPARA:
                                 "&startnum=",KEY3:
                                 "&norecord=",KEY2:
                                 "&priml001=",PRIML001;
.
          REP       "+ ",PRIML001
.
PREVME99  RETURN
.------------------------------------------------------------
. Table of Effective Dates for AMA/MBS Item
.------------------------------------------------------------
ITMTB000  UNPACK    DIM127,D1,LINKPRG,DIM127
          UNPACK    DIM127,D1,LINKREP,DIM127
          UNPACK    DIM127,D1,LINKTEM,DIM127
.
          CALL      ITMHD000      * Output Table Heading
.
          IF        NORECORD=0
            MOVE      PTCNNRTD,NORECORD      * Set Default No Records to Display
          ENDIF
          MOVE      ZERO,RECNUMB
          MOVE      ZERO,DISNUMB
.
          PACK      KEY22,PRITM001,PRITM002,PRITM003,SP70
          CALL      RSPRIT1
ITMTB100  CALL      RKPRIT1
          BRANCH    OVRCD,ITMTB900
.
          MATCH     PRITM001,DPRITFLG        * Item Type
          GOTO      ITMTB900 IF NOT EQUAL
.
          MATCH     PRITM002,PRITITMN        * AMA/MBS Item No
          GOTO      ITMTB900 IF NOT EQUAL
.
          MATCH     PRITM003,PRITSUBN        * MBS Subitem No
          GOTO      ITMTB900 IF NOT EQUAL
.
          ADD       ONE,RECNUMB
          IF        STARTNUM>=RECNUMB
            GOTO      ITMTB100
          ENDIF
.
          CALL      ITMRW000      * Display Row
          ADD       ONE,DISNUMB
          COMPARE   NORECORD,DISNUMB
          GOTO      ITMTB100 IF NOT EQUAL
          GOTO      ITMTB999
.
ITMTB900  CALL      NOMORE00      * Display No More Records Message
.
ITMTB999  RETURN
.------------------------------------------------------------
. Effective Dates for AMA/MBS Item Details (TABLE HEADING)
.------------------------------------------------------------
ITMHD000  WRITE     HTMLFILE;"<tr>":
                               "<td class=HeadingCell width=10%>":
                               "Effective Date</td>":
                               "<td class=HeadingCell width=25%>":
                               "Description</td>":
                               "<td class=HeadingCell width=10%>":
                               "Set Code</td>":
                               "<td class=HeadingCell width=10%>":
                               "Schedule Fee</td>":
                               "<td class=HeadingCell width=15%>":
                               "GST Code</td>":
                               "<td class=HeadingCell width=15%>":
                               "Pathology Test</td>":
                               "<td class=HeadingCell width=10%>":
                               "Cease Date</td>":
                             "</tr>"
.
ITMHD999  RETURN
.------------------------------------------------------------
. Effective Dates for AMA/MBS Item (TABLE ROW)
.------------------------------------------------------------
ITMRW000  UNPACK    PRITDAT1,CCENT,CYEAR,CMON,CDAY  * Effective Date
          MOVE      CMON,F2
          LOAD      MTHNAM3,F2,JAN,FEB,MAR,APR,MAY,JUN,JUL,AUG,SEP,OCT,NOV,DEC
          PACK      KEY11,CDAY,SP1,MTHNAM3,SP1,CCENT,CYEAR
.
          MATCH     SP70,PRITGSTC
          IF        @EQUAL
            MOVE      "&nbsp;",IBGSDESC
          ELSE
            PACK      KEY6,PRITGSTC,SP70    * GST Code Description
            CALL      RDIBGS1
            IF        OVRCD=1
              MOVE      "&nbsp;",IBGSDESC
            ENDIF
          ENDIF
.
          MOVE      "Pathology",KEY16
          COMPARE   ONE,PRITPATH
          IF        @EQUAL
            MOVE      "Non-Pathology",KEY16
          ELSE
            COMPARE   TWO,PRITPATH
            IF        @EQUAL
              MOVE      "IMC Derived Item",KEY16
            ENDIF
          ENDIF
.
          MOVE      "PG",CATEGORY       * Set Code 
          MOVE      PRITSETC,CODE
          CALL      GETCOD00
          MATCH     SP10,TDESC
          IF        @EQUAL
            MOVE      "&nbsp;",TDESC
          ENDIF
.
          MOVE      "&nbsp;",KEY11B
          MATCH     SP8,PRITDAT2
          IF        !@EQUAL
            UNPACK    PRITDAT2,CCENT,CYEAR,CMON,CDAY  * Cease Date
            MOVE      CMON,F2
            LOAD      MTHNAM3,F2,JAN,FEB,MAR,APR,MAY,JUN,JUL,AUG,SEP,OCT,NOV,DEC
            PACK      KEY11B,CDAY,SP1,MTHNAM3,SP1,CCENT,CYEAR
          ENDIF
.
          WRITE     HTMLFILE;"<tr><td nowrap><A HREF='javascript:ShowDetail":
                             "(#"",LINKPRG,"#.pbl":
                             "?reportno=",LINKREP:
                             "&template=",LINKTEM:
                             "&pritm001=",DPRITFLG:
                             "&pritm002=",PRITITMN:
                             "&pritm003=",PRITSUBN:
                             "&pritm004=",PRITDAT1,"#")'>":
                             "<img src=../images/MaintenanceIcon.gif hspace=4":
                             " border=0 align=absmiddle></a>":
                             KEY11,"</td>":
                             "<td>",PRITDESC,"</td>":
                             "<td>",TDESC,"</td>":
                             "<td>",PRITSFEE,"</td>":
                             "<td>",IBGSDESC,"</td>":
                             "<td>",KEY16,"</td>":
                             "<td>",KEY11B,"</td>":
                             "</tr>"
.
ITMRW999 RETURN
.------------------------------------------------------------
. Table of Effective Dates for Pathology Tests
.------------------------------------------------------------
TESTB000  UNPACK    DIM127,D1,LINKPRG,DIM127
          UNPACK    DIM127,D1,LINKREP,DIM127
          UNPACK    DIM127,D1,LINKTEM,DIM127
.
          CALL      TESHD000      * Output Table Heading
.
          IF        NORECORD=0
            MOVE      "13",NORECORD      * Set Default No Records to Display
          ENDIF
          MOVE      ZERO,RECNUMB
          MOVE      ZERO,DISNUMB
.
          PACK      KEY17,PRITS001,SP70
          CALL      RSPRTE1
TESTB100  CALL      RKPRTE1
          BRANCH    OVRCD,TESTB900
.
          MATCH     PRITS001,PRTECODE        * Test Code
          GOTO      TESTB900 IF NOT EQUAL
.
          ADD       ONE,RECNUMB
          IF        STARTNUM>=RECNUMB
            GOTO      TESTB100
          ENDIF
.
          CALL      TESRW000      * Display Row
          ADD       ONE,DISNUMB
          COMPARE   NORECORD,DISNUMB
          GOTO      TESTB100 IF NOT EQUAL
          GOTO      TESTB999
.
TESTB900  CALL      NOMORE00      * Display No More Records Message
.
.
TESTB999  RETURN
.------------------------------------------------------------
. Effective Dates for Pathology Tests (TABLE HEADING)
.------------------------------------------------------------
TESHD000  WRITE     HTMLFILE;"<tr>":
                               "<td class=HeadingCell width=10%>":
                               "Effective Date</td>":
                               "<td class=HeadingCell width=20%>":
                               "Description</td>":
                               "<td class=HeadingCell width=15%>":
                               "MBS Item</td>":
                               "<td class=HeadingCell width=15%>":
                               "AMA Item</td>":
                               "<td class=HeadingCell width=15%>":
                               "Multiple Service</td>":
                               "<td class=HeadingCell width=15%>":
                               "No. of Procs</td>":
                               "<td class=HeadingCell width=15%>":
                               "Standard Abbrev</td>":
                             "</tr>"
.
TESHD999  RETURN
.------------------------------------------------------------
. Effective Dates for Pathology Tests (TABLE ROW)
.------------------------------------------------------------
TESRW000  UNPACK    PRTEDATE,CCENT,CYEAR,CMON,CDAY  * Effective Date
          MOVE      CMON,F2
          LOAD      MTHNAM3,F2,JAN,FEB,MAR,APR,MAY,JUN,JUL,AUG,SEP,OCT,NOV,DEC
          PACK      KEY11,CDAY,SP1,MTHNAM3,SP1,CCENT,CYEAR
.
..          CALL      TSMBSS00   * MBS Code Desc
.
          MATCH     SP70,PRTESUBN
          IF        !@EQUAL
            CLEAR     KEY20
            STRIP     PRTEITMN
            APPEND    PRTEITMN,KEY20
            APPEND    SLASH,KEY20
            APPEND    PRTESUBN,KEY20
          ELSE
            MOVE      PRTEITMN,KEY20
          ENDIF
          MATCH      SP70,KEY20
          IF         @EQUAL
            MOVE       "&nbsp;",KEY20
          ENDIF
.
          MATCH      SP70,PRTEAMAN
          IF         @EQUAL
            MOVE       "&nbsp;",PRTEAMAN
          ENDIF
.
          MOVE       PRTEMSER,D6
          MATCH      SP70,PRTEMSER
          IF         @EQUAL
            MOVE       "&nbsp;",D6
          ENDIF
.
          MOVE       PRTETESN,D7
          COMPARE    ZERO,PRTETESN
          IF         @EQUAL
            MOVE       "&nbsp;",D7
          ENDIF
.
          MOVE       PRTEABRV,D8
          MATCH      SP70,PRTEABRV
          IF         @EQUAL
            MOVE       "&nbsp;",D8
          ENDIF
.
          WRITE     HTMLFILE;"<tr><td nowrap><A HREF='javascript:ShowDetail":
                             "(#"",LINKPRG,"#.pbl":
                             "?reportno=",LINKREP:
                             "&template=",LINKTEM:
                             "&prits001=",PRTECODE:
                             "&prits002=",PRTEDATE,"#")'>":
                             "<img src=../images/MaintenanceIcon.gif hspace=4":
                             " border=0 align=absmiddle></a>":
                             KEY11,"</td>":
                             "<td>",PRTEDESC,"</td>":
                             "<td>",KEY20,"</td>":
                             "<td>",PRTEAMAN,"</td>":
                             "<td>",D6,"</td>":
                             "<td>",D7,"</td>":
                             "<td>",D8,"</td>":
                             "</tr>"
.
TESRW999 RETURN
.-----------------------------------------------------------
. Link to Next List Page
.-----------------------------------------------------------
TSMBSS00  MOVE      ZERO,FORM2 * Set to MBS
          PACK      KEY22,FORM2,PRTEITMN,PRTESUBN,Z70 * Get current record
          CALL      RSPRIT1
          CALL      RPPRIT1
          BRANCH    OVRCD,TSMBSS90
.
          COMPARE   FORM2,PRITFLAG           * Item Type
          GOTO      TSMBSS90 IF NOT EQUAL
.
          MATCH     PRTEITMN,PRITITMN        * AMA/MBS Item
          GOTO      TSMBSS90 IF NOT EQUAL
.
          MATCH     PRTESUBN,PRITSUBN        * Sub Item
          GOTO      TSMBSS90 IF NOT EQUAL
.
          MOVE      PRITDESC,ITEMDESC         * MBS Code Description
          GOTO      TSMBSS99
.
TSMBSS90  MOVE      "&nbsp;",ITEMDESC
TSMBSS99  RETURN
.-----------------------------------------------------------
. Link to Next List Page
.-----------------------------------------------------------
NEXTIT00  MOVE      NORECORD,KEY2
          REP       " +",KEY2
          ASSIGN    STARTNUM+NORECORD,F3
          MOVE      F3,KEY3
          REP       " +",KEY3
          UNPACK    DIM127,D1,FLDPARA,DIM127
          MOVE      REPORTNO,F1
.
          REP       " +",PRITM001
          REP       " +",PRITM002
          REP       " +",PRITM003
.
          WRITE     HTMLFILE;"priweb05.pbl":
                                 "?reportno=",F1:
                                 "&template=",FLDPARA:
                                 "&startnum=",KEY3:
                                 "&norecord=",KEY2:
                                 "&pritm001=",PRITM001:
                                 "&pritm002=",PRITM002:
                                 "&pritm003=",PRITM003;
.
          REP       "+ ",PRITM001
          REP       "+ ",PRITM002
          REP       "+ ",PRITM003
.
NEXTIT99  RETURN
.-----------------------------------------------------------
. Link to Prev List Page
.-----------------------------------------------------------
PREVIT00  MOVE      NORECORD,KEY2
          REP       " +",KEY2
          ASSIGN    STARTNUM-NORECORD,F3
          IF        F3<0
            MOVE      ZERO,F3
          ENDIF
          MOVE      F3,KEY3
          REP       " +",KEY3
          UNPACK    DIM127,D1,FLDPARA,DIM127
          MOVE      REPORTNO,F1
.
          REP       " +",PRITM001
          REP       " +",PRITM002
          REP       " +",PRITM003
.
          WRITE     HTMLFILE;"priweb05.pbl":
                                 "?reportno=",F1:
                                 "&template=",FLDPARA:
                                 "&startnum=",KEY3:
                                 "&norecord=",KEY2:
                                 "&pritm001=",PRITM001:
                                 "&pritm002=",PRITM002:
                                 "&pritm003=",PRITM003;
.
          REP       "+ ",PRITM001
          REP       "+ ",PRITM002
          REP       "+ ",PRITM003
.
PREVIT99  RETURN
.-----------------------------------------------------------
. Link to Next List Page
.-----------------------------------------------------------
NEXTTE00  MOVE      NORECORD,KEY2
          REP       " +",KEY2
          ASSIGN    STARTNUM+NORECORD,F3
          MOVE      F3,KEY3
          REP       " +",KEY3
          UNPACK    DIM127,D1,FLDPARA,DIM127
          MOVE      REPORTNO,F1
.
          REP       " +",PRITS001
.
          WRITE     HTMLFILE;"priweb05.pbl":
                                 "?reportno=",F1:
                                 "&template=",FLDPARA:
                                 "&startnum=",KEY3:
                                 "&norecord=",KEY2:
                                 "&prits001=",PRITS001;
.
          REP       "+ ",PRITS001
.
NEXTTE99  RETURN
.-----------------------------------------------------------
. Link to Prev List Page
.-----------------------------------------------------------
PREVTE00  MOVE      NORECORD,KEY2
          REP       " +",KEY2
          ASSIGN    STARTNUM-NORECORD,F3
          IF        F3<0
            MOVE      ZERO,F3
          ENDIF
          MOVE      F3,KEY3
          REP       " +",KEY3
          UNPACK    DIM127,D1,FLDPARA,DIM127
          MOVE      REPORTNO,F1
.
          REP       " +",PRITS001
.
          WRITE     HTMLFILE;"priweb05.pbl":
                                 "?reportno=",F1:
                                 "&template=",FLDPARA:
                                 "&startnum=",KEY3:
                                 "&norecord=",KEY2:
                                 "&prits001=",PRITS001;
.
          REP       "+ ",PRITS001
.
PREVTE99  RETURN
.-----------------------------------------------------------
. Link to Next List Page - AMA/MBS Other Items
.-----------------------------------------------------------
NXTGRP00  MOVE      NORECORD,KEY2
          REP       " +",KEY2
          ASSIGN    STARTNUM+NORECORD,F3
          MOVE      F3,KEY3
          REP       " +",KEY3
          UNPACK    DIM127,D1,FLDPARA,DIM127
          MOVE      REPORTNO,F1
.
          REP       " +",OTHIT001
          REP       " +",OTHIT002
          REP       " +",OTHIT003
          REP       " +",OTHIT004
.
          WRITE     HTMLFILE;"priweb05.pbl":
                                 "?reportno=",F1:
                                 "&template=",FLDPARA:
                                 "&startnum=",KEY3:
                                 "&norecord=",KEY2:
                                 "&othit001=",OTHIT001:
                                 "&othit002=",OTHIT002:
                                 "&othit003=",OTHIT003:
                                 "&othit004=",OTHIT004;
.
          REP       "+ ",OTHIT001
          REP       "+ ",OTHIT002
          REP       "+ ",OTHIT003
          REP       "+ ",OTHIT004
.
NXTGRP99  RETURN
.-----------------------------------------------------------
. Link to Prev List Page
.-----------------------------------------------------------
PRVGRP00  MOVE      NORECORD,KEY2
          REP       " +",KEY2
          ASSIGN    STARTNUM-NORECORD,F3
          IF        F3<0
            MOVE      ZERO,F3
          ENDIF
          MOVE      F3,KEY3
          REP       " +",KEY3
          UNPACK    DIM127,D1,FLDPARA,DIM127
          MOVE      REPORTNO,F1
.
          REP       " +",OTHIT001
          REP       " +",OTHIT002
          REP       " +",OTHIT003
          REP       " +",OTHIT004
.
          WRITE     HTMLFILE;"priweb05.pbl":
                                 "?reportno=",F1:
                                 "&template=",FLDPARA:
                                 "&startnum=",KEY3:
                                 "&norecord=",KEY2:
                                 "&othit001=",OTHIT001:
                                 "&othit002=",OTHIT002:
                                 "&othit003=",OTHIT003:
                                 "&othit004=",OTHIT004;
.
          REP       "+ ",OTHIT001
          REP       "+ ",OTHIT002
          REP       "+ ",OTHIT003
          REP       "+ ",OTHIT004
.
PRVGRP99  RETURN
.-----------------------------------------------------------
. Link to Next List Page - Tests of Multiple Items
.-----------------------------------------------------------
NXTTST00  MOVE      NORECORD,KEY2
          REP       " +",KEY2
          ASSIGN    STARTNUM+NORECORD,F3
          MOVE      F3,KEY3
          REP       " +",KEY3
          UNPACK    DIM127,D1,FLDPARA,DIM127
          MOVE      REPORTNO,F1
.
          REP       " +",PRIML001
          REP       " +",PRIML002
.
          WRITE     HTMLFILE;"priweb05.pbl":
                                 "?reportno=",F1:
                                 "&template=",FLDPARA:
                                 "&startnum=",KEY3:
                                 "&norecord=",KEY2:
                                 "&priml001=",PRIML001:
                                 "&priml002=",PRIML002;
.
          REP       "+ ",PRIML001
          REP       "+ ",PRIML002
.
NXTTST99  RETURN
.-----------------------------------------------------------
. Link to Prev List Page - Tests of Multiple Items
.-----------------------------------------------------------
PRVTST00  MOVE      NORECORD,KEY2
          REP       " +",KEY2
          ASSIGN    STARTNUM-NORECORD,F3
          IF        F3<0
            MOVE      ZERO,F3
          ENDIF
          MOVE      F3,KEY3
          REP       " +",KEY3
          UNPACK    DIM127,D1,FLDPARA,DIM127
          MOVE      REPORTNO,F1
.
          REP       " +",PRIML001
          REP       " +",PRIML002
.
          WRITE     HTMLFILE;"priweb05.pbl":
                                 "?reportno=",F1:
                                 "&template=",FLDPARA:
                                 "&startnum=",KEY3:
                                 "&norecord=",KEY2:
                                 "&priml001=",PRIML001:
                                 "&priml002=",PRIML002;
.
          REP       "+ ",PRIML001
          REP       "+ ",PRIML002
.
PRVTST99  RETURN
.------------------------------------------------------------
. NOMORE00 - Display "No more records" at end of list
.------------------------------------------------------------
NOMORE00  WRITE     HTMLFILE;"<tr>":
                             "<td class=RedCell colspan=20 align=center>":
                             "No more records</td>"
.
NOMORE99  RETURN
.
.------------------------------------------------------------
. Table of AMA/MBS Other Item
.------------------------------------------------------------
GRPTB000  UNPACK    DIM127,D1,LINKPRG,DIM127
          UNPACK    DIM127,D1,LINKREP,DIM127
          UNPACK    DIM127,D1,LINKTEM,DIM127
.
          CALL      GRPHD000      * Output Table Heading
.
          IF        NORECORD=0
            MOVE      "13",NORECORD       * Set Default No Records to Display
          ENDIF
          MOVE      ZERO,RECNUMB
          MOVE      ZERO,DISNUMB
.
          PACK      KEY34,OTHIT001,OTHIT002,OTHIT003,OTHIT004,SP70
          CALL      RSPRGP1
GRPTB100  CALL      RKPRGP1
          BRANCH    OVRCD,GRPTB999
.
          MATCH     OTHIT001,DPRGPFLG        * Item Type
          GOTO      GRPTB999 IF NOT EQUAL
.
          MATCH     OTHIT002,PRGPITM1        * AMA/MBS Item No
          GOTO      GRPTB999 IF NOT EQUAL
.
          MATCH     OTHIT003,PRGPSUB1        * AMA/MBS Subitem No
          GOTO      GRPTB999 IF NOT EQUAL
.
          MATCH     OTHIT004,PRGPDATE        * AMA/MBS Effective Date
          GOTO      GRPTB999 IF NOT EQUAL
.
          ADD       ONE,RECNUMB
          IF        STARTNUM>=RECNUMB
            GOTO      GRPTB100
          ENDIF
.
          CALL      GRPRW000      * Display Row
          ADD       ONE,DISNUMB
          COMPARE   NORECORD,DISNUMB
          GOTO      GRPTB100 IF NOT EQUAL
.
GRPTB999  RETURN
.------------------------------------------------------------
. AMA/MBS Other Item Details (TABLE HEADING)
.------------------------------------------------------------
GRPHD000  WRITE     HTMLFILE;"<tr>":
                               "<td class=HeadingCell width=15%>":
                               "Item</td>":
                               "<td class=HeadingCell width=25%>":
                               "Description</td>":
                             "</tr>"
.
GRPHD999  RETURN
.------------------------------------------------------------
. AMA/MBS Other Item (TABLE ROW)
.------------------------------------------------------------
GRPRW000  MATCH     SP70,PRGPSUB2
          IF        !@EQUAL
            CLEAR     KEY13
            STRIP     PRGPITM2
            APPEND    PRGPITM2,KEY13
            APPEND    SLASH,KEY13
            APPEND    PRGPSUB2,KEY13
          ELSE
            MOVE      PRGPITM2,KEY13
          ENDIF
.
          PACK      KEY22,PRGPFLAG,PRGPITM2,PRGPSUB2,PRGPDATE,SP70
          CALL      RDPRIT1     * Read Parent Record
          IF        OVRCD=1    
            MOVE      "&nbsp;",PRITDESC
          ENDIF
.
          CLEAR     DIM34
          APPEND    PRGPFLAG,DIM34
          PACK      PRGPITM1,PRGPITM1,SP70
          APPEND    PRGPITM1,DIM34
          PACK      PRGPSUB1,PRGPSUB1,SP70
          APPEND    PRGPSUB1,DIM34
          APPEND    PRGPDATE,DIM34
          PACK      PRGPITM2,PRGPITM2,SP70
          APPEND    PRGPITM2,DIM34
          PACK      PRGPSUB2,PRGPSUB2,SP70
          APPEND    PRGPSUB2,DIM34
.
          WRITE     HTMLFILE;"<tr><td nowrap><A HREF=#"javascript:DeleteRecord":
                             "('",DIM34,"');#">":
                             "<img src=../images/DeleteIcon.gif hspace=4":
                             " border=0 align=absmiddle></a>":
                             KEY13,"</td>":
                             "<td>",PRITDESC,"</td>":
                             "</tr>"
.
GRPRW999 RETURN
.------------------------------------------------------------
. Table of Common Item Template Heading Maintenance
.------------------------------------------------------------
THDTB000  UNPACK    DIM127,D1,LINKPRG,DIM127
          UNPACK    DIM127,D1,LINKREP,DIM127
          UNPACK    DIM127,D1,LINKTEM,DIM127
.
          PACK      KEY4,SP70
          CALL      RDPRTHD1
THDTB100  CALL      RKPRTHD1
          BRANCH    OVRCD,THDTB999
.
          PACK      PACKLINK,PRTHTMID
.
          CLEAR     HTMLLINK
          APPEND    "javascript:UpdateTemplt('",HTMLLINK
          APPEND    PACKLINK,HTMLLINK
          APPEND    "')",HTMLLINK
          RESET     HTMLLINK
          WRITE     HTMLFILE;"t.addRow(#"",HTMLLINK,"#",":
                             "#"",PRTHTMID,"#",":
                             "#"",PRTHDESC,"#");"
.
          GOTO      THDTB100 
.
THDTB999  RETURN
.-----------------------------------------------------------
. Common Items Details Mantenance
.-----------------------------------------------------------
PTDT0000  BRANCH    FLDITMNO,PTDT0100,PTDT0200,PTDT0300,PTDT0400,PTDT0500:
                             PTDT0600,PTDT0700,PTDT0800,PTDT0900,PTDT1000
          GOTO      PTDT9999
.
PTDT0100  WRITE     HTMLFILE;PRTDTMID;     * Template ID    
          GOTO      PTDT9999
.
PTDT0200  WRITE     HTMLFILE;PRTDTYPE;     * Item Type
          GOTO      PTDT9999
.
PTDT0300  WRITE     HTMLFILE;PRTDSEQN;     * Sequence  
          GOTO      PTDT9999
.
PTDT0400  WRITE     HTMLFILE;PRTDCODE;     * AMA/MBS Code 
          GOTO      PTDT9999
.
PTDT0500  WRITE     HTMLFILE;PRTDSUBI;     * Sub-Item No   
          GOTO      PTDT9999
.
PTDT0600  WRITE     HTMLFILE;PRTDQUAN;     * Quantity
          GOTO      PTDT9999
.
PTDT0700  MOVE      PRTDTYPE,FORM2
          PACK      KEY22,FORM2,PRTDCODE,PRTDSUBI,Z70 * Get current record
          CALL      RSPRIT1
          CALL      RPPRIT1
          BRANCH    OVRCD,PTDT0704
.
          COMPARE   FORM2,PRITFLAG           * Item Type
          GOTO      PTDT0704 IF NOT EQUAL
.
          MATCH     PRTDCODE,PRITITMN        * AMA/MBS Item
          GOTO      PTDT0704 IF NOT EQUAL
.
          MATCH     PRTDSUBI,PRITSUBN        * Sub Item
          GOTO      PTDT0704 IF NOT EQUAL
.
          GOTO      PTDT0705
.
PTDT0704  MOVE      "Invalid item code",PRITDESC
          MOVE      ZERO,PRITSFEE
.
PTDT0705  UNPACK    DIM127,D1,KEY1,DIM127
          MOVE      ZERO,F1
          MOVE      KEY1,F1
          BRANCH    F1,PTDT0710
.
          WRITE     HTMLFILE;PRITDESC;       * AMA/MBS Description
          GOTO      PTDT9999
.
PTDT0710  WRITE     HTMLFILE;PRITSFEE;       * Schedule fees
          GOTO      PTDT9999
.
PTDT0800  CALL      AMATB000     * Table of AMA Items 
          GOTO      PTDT9999
.
PTDT0900  CALL      MBSTB000     * Table of MBS Items 
          GOTO      PTDT9999
.
PTDT1000  MATCH     "0",PRTDTYPE
          IF        @EQUAL
            WRITE     HTMLFILE;"MBS";     * MBS Code 
          ELSE 
            WRITE     HTMLFILE;"AMA";     * AMA Code 
          ENDIF
          GOTO      PTDT9999
.
PTDT9999  RETURN
.------------------------------------------------------------
. Table of Common Item Template Details for AMA Codes
.------------------------------------------------------------
AMATB000  UNPACK    DIM127,D1,LINKPRG,DIM127
          UNPACK    DIM127,D1,LINKREP,DIM127
          UNPACK    DIM127,D1,LINKTEM,DIM127
.
          CALL      AMAHD000      * Output Table Heading
.
          PACK      KEY8,PRITD001,ONE,SP70
          CALL      RSPRTDT1
AMATB100  CALL      RKPRTDT1
          BRANCH    OVRCD,AMATB999
.
          MATCH     PRITD001,PRTDTMID       * Item ID
          GOTO      AMATB999 IF NOT EQUAL
.
          MATCH     "1",PRTDTYPE            * AMA Code
          GOTO      AMATB100 IF NOT EQUAL
.
          CALL      AMARW000  * Display Details Row
          GOTO      AMATB100
.
AMATB999  RETURN
.------------------------------------------------------------
. Common Item Template Details Table Details (TABLE HEADING)
.------------------------------------------------------------
AMAHD000  WRITE     HTMLFILE;"<tr>":
                               "<td class=HeadingCell width=30%>":
                               "AMA Codes</td>":
                               "<td class=HeadingCell width=59%>":
                               "Description</td>":
                               "<td class=HeadingCell width=11%>":
                               "Sequence</td>":
                               "</tr>"
.
AMAHD999  RETURN
.------------------------------------------------------------
. Common Item Template Details Table Details (TABLE ROW)
.------------------------------------------------------------
AMARW000  MATCH     SP70,PRTDSUBI
          IF        !@EQUAL
            CLEAR     KEY35
            STRIP     PRTDCODE
            APPEND    PRTDCODE,KEY35
            APPEND    SLASH,KEY35
            APPEND    PRTDSUBI,KEY35
            RESET     PRTDCODE
            PACK      PRTDCODE,PRTDCODE,SP70
          ELSE
            MOVE      PRTDCODE,KEY35
          ENDIF
.
          MOVE      PRTDTYPE,FORM2
          PACK      KEY22,FORM2,PRTDCODE,PRTDSUBI,Z70 * Get current record
          CALL      RSPRIT1
          CALL      RPPRIT1
          BRANCH    OVRCD,AMARW100
.
          COMPARE   FORM2,PRITFLAG           * Item Type
          GOTO      AMARW100 IF NOT EQUAL
.
          MATCH     PRTDCODE,PRITITMN        * AMA/MBS Item
          GOTO      AMARW100 IF NOT EQUAL
.
          MATCH     PRTDSUBI,PRITSUBN        * Sub Item
          GOTO      AMARW100 IF NOT EQUAL
.
          GOTO      AMARW200
.
AMARW100  MOVE      "Invalid item code",PRITDESC
.
AMARW200  WRITE     HTMLFILE;"<tr><td nowrap>":
                             "<img src=../images/EditIcon.gif hspace=4":
                             " border=0 align=absmiddle onclick='":
                             "ShowDetail(#"",LINKPRG,"#.pbl":
                             "?reportno=",LINKREP:
                             "&template=",LINKTEM:
                             "&pritd001=",PRTDTMID:
                             "&pritd002=",PRTDTYPE:
                             "&pritd003=",PRTDSEQN,"#")';>":
                             KEY35,"</td>":                     
                             "<td>",PRITDESC,"</td>"
          CALL      SEQU0000
          WRITE     HTMLFILE;"<img src=../images/MoveIcon.gif":
                             " alt='Move Record' border=0 ":
                             "onclick=#"javascript:MoveRec('",PRTDTMID:
                             "','",PRTDTYPE,"','",PRTDSEQN,"','M')#";>":
                             "<img src=../images/SwapIcon.gif":
                             " alt='Swap Record' border=0 ":
                             "onclick=#"javascript:MoveRec('",PRTDTMID:
                             "','",PRTDTYPE,"','",PRTDSEQN,"','S')#";>":
                             "</td></tr>"
.
AMARW999  RETURN 
.------------------------------------------------------------
. Table of Common Item Template Details for MBS Codes
.------------------------------------------------------------
MBSTB000  UNPACK    DIM127,D1,LINKPRG,DIM127
          UNPACK    DIM127,D1,LINKREP,DIM127
          UNPACK    DIM127,D1,LINKTEM,DIM127
.
          CALL      MBSHD000      * Output Table Heading
.
          PACK      KEY8,PRITD001,ZERO,SP70
          CALL      RSPRTDT1
MBSTB100  CALL      RKPRTDT1
          BRANCH    OVRCD,MBSTB999
.
          MATCH     PRITD001,PRTDTMID        * Item ID
          GOTO      MBSTB999 IF NOT EQUAL
.
          MATCH     "0",PRTDTYPE             * MBS Code
          GOTO      MBSTB100 IF NOT EQUAL
.
          CALL      MBSRW000  * Display Details Row
          GOTO      MBSTB100
.
MBSTB999  RETURN
.------------------------------------------------------------
. Common Item Template Details (TABLE HEADING)
.------------------------------------------------------------
MBSHD000  WRITE     HTMLFILE;"<tr>":
                               "<td class=HeadingCell width=30%>":
                               "MBS Code</td>":
                               "<td class=HeadingCell width=59%>":
                               "Description</td>":
                               "<td class=HeadingCell width=11%>":
                               "Sequence</td>":
                               "</tr>"
.
MBSHD999  RETURN
.------------------------------------------------------------
. Common Item Template Details (TABLE ROW)
.------------------------------------------------------------
MBSRW000  MATCH     SP70,PRTDSUBI
          IF        !@EQUAL
            CLEAR     KEY35
            STRIP     PRTDCODE
            APPEND    PRTDCODE,KEY35
            APPEND    SLASH,KEY35
            APPEND    PRTDSUBI,KEY35
            RESET     PRTDCODE
            PACK      PRTDCODE,PRTDCODE,SP70
          ELSE
            MOVE      PRTDCODE,KEY35
          ENDIF 
.
          MOVE      PRTDTYPE,FORM2
          PACK      KEY22,FORM2,PRTDCODE,PRTDSUBI,Z70 * Get current record
          CALL      RSPRIT1
          CALL      RPPRIT1
          BRANCH    OVRCD,MBSRW100
.
          COMPARE   FORM2,PRITFLAG           * Item Type
          GOTO      MBSRW100 IF NOT EQUAL
.
          MATCH     PRTDCODE,PRITITMN        * AMA/MBS Item
          GOTO      MBSRW100 IF NOT EQUAL
.
          MATCH     PRTDSUBI,PRITSUBN        * Sub Item
          GOTO      MBSRW100 IF NOT EQUAL
.
          GOTO      MBSRW200
.
MBSRW100  MOVE      "Invalid item code",PRITDESC
.
MBSRW200  WRITE     HTMLFILE;"<tr><td nowrap>":
                             "<img src=../images/EditIcon.gif hspace=4":
                             " border=0 align=absmiddle ":
                             "onclick='ShowDetail(#"",LINKPRG,"#.pbl":
                             "?reportno=",LINKREP:
                             "&template=",LINKTEM:
                             "&pritd001=",PRTDTMID:
                             "&pritd002=",PRTDTYPE:
                             "&pritd003=",PRTDSEQN,"#")';>":
                             KEY35,"</td>":
                             "<td>",PRITDESC,"</td>"
          CALL      SEQU0000
          WRITE     HTMLFILE;"<img src=../images/MoveIcon.gif":
                             " alt='Move Record' border=0 ":
                             "onclick=#"MoveRec('",PRTDTMID:      
                             "','",PRTDTYPE,"','",PRTDSEQN,"','M')#";>":
                             "<img src=../images/SwapIcon.gif":
                             " alt='Swap Record' border=0 ":
                             "onclick=#"MoveRec('",PRTDTMID:      
                             "','",PRTDTYPE,"','",PRTDSEQN,"','S')#";>":
                             "</td></tr>"
.
MBSRW999  RETURN 
.-------------------------------------------------------------------------
. Displays drop down list of sequence
.-------------------------------------------------------------------------
SEQU0000  MOVE      PRTDSEQN,KEY3
          MOVE      PRTDTYPE,KEY1
          MOVE      PRTDTMID,KEY4
          WRITE     HTMLFILE;"<td><select name=dummy ":
                             "onChange=setSeq(this);>"
          PACK      KEY8,PRTDTMID,PRTDTYPE,SP70
          CALL      RDPRTDT1
SEQU0100  CALL      RKPRTDT1
          BRANCH    OVRCD,SEQU9000
.
          MATCH     PRTDTMID,KEY4
          GOTO      SEQU9000 IF NOT EQUAL
.
          MATCH     PRTDTYPE,KEY1
          GOTO      SEQU9000 IF NOT EQUAL
.
          MOVE      PRTDSEQN,FORM3 
          MATCH     PRTDSEQN,KEY3
          IF        @EQUAL
            WRITE     HTMLFILE;"<option value=#"",PRTDSEQN,"#" selected>":
                               FORM3,"</option>"
          ELSE
            WRITE     HTMLFILE;"<option value=#"",PRTDSEQN,"#">":
                               FORM3,"</option>"
          ENDIF
          GOTO      SEQU0100
.
SEQU9000  WRITE     HTMLFILE;"</select>"
          PACK      KEY8,KEY4,KEY1,KEY3,SP70
          CALL      RSPRTDT1
          MOVE      KEY3,PRTDSEQN
          MOVE      KEY1,PRTDTYPE
          MOVE      KEY4,PRTDTMID

SEQU9999  RETURN
.------------------------------------------------------------
. Table of Multiple Services
.------------------------------------------------------------
MULTB000  UNPACK    DIM127,D1,LINKPRG,DIM127
          UNPACK    DIM127,D1,LINKREP,DIM127
          UNPACK    DIM127,D1,LINKTEM,DIM127
.
          CALL      MULHD000      * Output Table Heading
.
          IF        NORECORD=0
            MOVE      PTCNNRTD,NORECORD      * Set Default No Records to Display
          ENDIF
          MOVE      ZERO,RECNUMB
          MOVE      ZERO,DISNUMB
.
          MOVE      SP70,SAVCODE
.
          PACK      KEY16,Z70
          CALL      RSPRMU1
MULTB100  CALL      RPPRMU1
          BRANCH    OVRCD,MULTB900
.
          MATCH     SAVCODE,PRMUCODE        * Only want Code once  
          GOTO      MULTB100 IF EQUAL
.
          MOVE      PRMUCODE,SAVCODE
.
          ADD       ONE,RECNUMB
          IF        STARTNUM>=RECNUMB
            GOTO      MULTB100
          ENDIF
.
          CALL      MULRW000      * Display Row
          ADD       ONE,DISNUMB
          COMPARE   NORECORD,DISNUMB
          GOTO      MULTB100 IF NOT EQUAL
          GOTO      MULTB999
.
MULTB900  CALL      NOMORE00      * Display No More Records Message
.
MULTB999  RETURN
.------------------------------------------------------------
. Table of Multiple Services by Description
.------------------------------------------------------------
MULDS000  UNPACK    DIM127,D1,LINKPRG,DIM127
          UNPACK    DIM127,D1,LINKREP,DIM127
          UNPACK    DIM127,D1,LINKTEM,DIM127
.
          CALL      MULHD000      * Output Table Heading
.
          IF        NORECORD=0
            MOVE      "13",NORECORD       * Set Default No Records to Display
          ENDIF
          MOVE      ZERO,RECNUMB
          MOVE      ZERO,DISNUMB
.
          MOVE      SP70,SAVCODE
..          MOVE      SP70,SAVDESC
.
          PACK      KEY46,Z70
          CALL      RSPRMU2
MULDS100  CALL      RPPRMU2
          BRANCH    OVRCD,MULDS999
.
..          MATCH     SAVDESC,PRMUDESC        * Only want Desc once  
..          GOTO      MULDS100 IF EQUAL
.
          MATCH     SAVCODE,PRMUCODE        * Only want Code once  
          GOTO      MULDS100 IF EQUAL
.
..          MOVE      PRMUDESC,SAVDESC
          MOVE      PRMUCODE,SAVCODE
.
          ADD       ONE,RECNUMB
          IF        STARTNUM>=RECNUMB
            GOTO      MULDS100
          ENDIF
.
          CALL      MULRW000      * Display Row
          ADD       ONE,DISNUMB
          COMPARE   NORECORD,DISNUMB
          GOTO      MULDS100 IF NOT EQUAL
.
MULDS999  RETURN
.------------------------------------------------------------
. Multiple Services by Code (TABLE HEADING)
.------------------------------------------------------------
MULHD000  WRITE     HTMLFILE;"<tr>":
                               "<td class=HeadingCell width=15%>":
                               "Service Code</td>":
                               "<td class=HeadingCell width=25%>":
                               "Description</td>":
                               "<td class=HeadingCell width=25%>":
                               "Effective Date</td>":
                             "</tr>"
.
MULHD999  RETURN
.------------------------------------------------------------
. Multiple Services (TABLE ROW)
.------------------------------------------------------------
MULRW000  UNPACK    PRMUDATE,CCENT,CYEAR,CMON,CDAY  * Effective Date
          MOVE      CMON,F2
          LOAD      MTHNAM3,F2,JAN,FEB,MAR,APR,MAY,JUN,JUL,AUG,SEP,OCT,NOV,DEC
          PACK      KEY11,CDAY,SP1,MTHNAM3,SP1,CCENT,CYEAR 
.
          BRANCH    LNK2PRT,MULRW100
.
          WRITE     HTMLFILE;"<tr><td nowrap><A HREF='javascript:showItem":
                             "(#"",LINKPRG,"#.pbl":
                             "?reportno=",LINKREP:
                             "&template=",LINKTEM:
                             "&priml001=",PRMUCODE,"#")'>":
                             "<img src=../images/MaintenanceIcon.gif hspace=4":
                             " border=0 align=absmiddle></a>":
                             PRMUCODE,"</td>":
                             "<td>",PRMUDESC,"</td>":
                             "<td>",KEY11,"</td>":
                             "</tr>"
.
          GOTO       MULRW999
.
MULRW100  WRITE     HTMLFILE;"<tr><td nowrap>":
                             "<A HREF='javascript:updateParent":
                             "(#"",PRMUCODE,"#",#"",PRMUDESC,"#")'>":
                             PRMUCODE,"</a></td>":
                             "<td>",PRMUDESC,"</td>":
                             "<td>",KEY11,"</td>":
                             "</tr>"; 
.
MULRW999  RETURN
.------------------------------------------------------------
. Table of Effective Dates for Multiple Services Code
.------------------------------------------------------------
MLETB000  UNPACK    DIM127,D1,LINKPRG,DIM127
          UNPACK    DIM127,D1,LINKREP,DIM127
          UNPACK    DIM127,D1,LINKTEM,DIM127
.
          CALL      MLEHD000      * Output Table Heading
.
          IF        NORECORD=0
            MOVE      PTCNNRTD,NORECORD      * Set Default No Records to Display
          ENDIF
          MOVE      ZERO,RECNUMB
          MOVE      ZERO,DISNUMB
          MOVE      SP70,SAVDAT
.
          PACK      KEY16,PRIML001,SP70
          CALL      RSPRMU1
MLETB100  CALL      RKPRMU1
          BRANCH    OVRCD,MLETB900
.
          MATCH     PRIML001,PRMUCODE        * Code
          GOTO      MLETB900 IF NOT EQUAL
.
          MATCH     SAVDAT,PRMUDATE          * Only Want Unique Date Record
          GOTO      MLETB100 IF EQUAL
.
          MOVE      PRMUDATE,SAVDAT 
.
          ADD       ONE,RECNUMB
          IF        STARTNUM>=RECNUMB
            GOTO      MLETB100
          ENDIF
.
          CALL      MLERW000      * Display Row
          ADD       ONE,DISNUMB
          COMPARE   NORECORD,DISNUMB
          GOTO      MLETB100 IF NOT EQUAL
          GOTO      MLETB999
.
MLETB900  CALL      NOMORE00      * Display No More Records Message
.
MLETB999  RETURN
.------------------------------------------------------------
. Effective Dates for Multiple Services Code (TABLE HEADING)
.------------------------------------------------------------
MLEHD000  WRITE     HTMLFILE;"<tr>":
                               "<td class=HeadingCell width=10%>":
                               "Effective Date</td>":
                               "<td class=HeadingCell width=25%>":
                               "Description</td>":
                             "</tr>"
.
MLEHD999  RETURN
.------------------------------------------------------------
. Effective Dates for Multiple Services Code (TABLE ROW)
.------------------------------------------------------------
MLERW000  UNPACK    PRMUDATE,CCENT,CYEAR,CMON,CDAY  * Effective Date
          MOVE      CMON,F2
          LOAD      MTHNAM3,F2,JAN,FEB,MAR,APR,MAY,JUN,JUL,AUG,SEP,OCT,NOV,DEC
          PACK      KEY11,CDAY,SP1,MTHNAM3,SP1,CCENT,CYEAR
.
          WRITE     HTMLFILE;"<tr><td nowrap><A HREF='javascript:ShowDetail":
                             "(#"",LINKPRG,"#.pbl":
                             "?reportno=",LINKREP:
                             "&template=",LINKTEM:
                             "&priml001=",PRMUCODE:
                             "&priml002=",PRMUDATE,"#")'>":
                             "<img src=../images/MaintenanceIcon.gif hspace=4":
                             " border=0 align=absmiddle></a>":
                             KEY11,"</td>":
                             "<td>",PRMUDESC,"</td>":
                             "</tr>"
.
MLERW999 RETURN
.------------------------------------------------------------
. Table of Tests for Multiple Item
.------------------------------------------------------------
TSTTB000  CALL      TSTHD000      * Output Table Heading
.
          IF        NORECORD=0
            MOVE      "13",NORECORD       * Set Default No Records to Display
          ENDIF
          MOVE      ZERO,RECNUMB
          MOVE      ZERO,DISNUMB
.
          PACK      KEY16,PRIML001,PRIML002,SP70
          CALL      RSPRMU1
TSTTB100  CALL      RKPRMU1
          BRANCH    OVRCD,TSTTB999
.
          MATCH     PRIML001,PRMUCODE        * Multiple Service Code
          GOTO      TSTTB999 IF NOT EQUAL
.
          MATCH     PRIML002,PRMUDATE        * Effective Date
          GOTO      TSTTB999 IF NOT EQUAL
.
          ADD       ONE,RECNUMB
          IF        STARTNUM>=RECNUMB
            GOTO      TSTTB100
          ENDIF
.
          CALL      TSTRW000      * Display Row
          ADD       ONE,DISNUMB
          COMPARE   NORECORD,DISNUMB
          GOTO      TSTTB100 IF NOT EQUAL
.
TSTTB999  RETURN
.------------------------------------------------------------
. Tests (TABLE HEADING)
.------------------------------------------------------------
TSTHD000  WRITE     HTMLFILE;"<tr>":
                               "<td class=HeadingCell width=8%>":
                               "No. of Tests</td>":
                               "<td class=HeadingCell width=41%>":
                               "MBS Item</td>":
                               "<td class=HeadingCell width=44%>":
                               "AMA Item</td>":
                             "</tr>"
.
TSTHD999  RETURN
.------------------------------------------------------------
. Tests (TABLE ROW)
.------------------------------------------------------------
TSTRW000  MATCH     SP70,PRMUSUBN
          IF        !@EQUAL
            STRIP     PRMUITMN
            CLEAR     KEY13
            APPEND    PRMUITMN,KEY13
            APPEND    SLASH,KEY13
            APPEND    PRMUSUBN,KEY13
            RESET     KEY13
          ELSE
            MOVE      PRMUITMN,KEY13
          ENDIF
.
          MOVE      ZERO,F2 
          PACK      KEY22,F2,PRMUITMN,PRMUSUBN,Z70
          CALL      RSPRIT1     
          CALL      RPPRIT1     
          BRANCH    OVRCD,TSTRW100
.
          COMPARE   F2,PRITFLAG          * Item Type
          GOTO      TSTRW100 IF NOT EQUAL 
.
          MATCH     PRMUITMN,PRITITMN    * MBS Item
          GOTO      TSTRW100 IF NOT EQUAL 
.
          MATCH     PRMUSUBN,PRITSUBN    * MBS Sub-Item
          GOTO      TSTRW100 IF NOT EQUAL 
.
          MOVE      PRITDESC,ITEMDESC    * Set Desc 

          CLEAR     KEY50
..          APPEND    KEY13,KEY50
..          APPEND    SP1,KEY50 
..          APPEND    DASH,KEY50 
..          APPEND    SP1,KEY50 
..          APPEND    ITEMDESC,KEY50
          PACK      KEY50,KEY13,SP1,DASH,SP1,ITEMDESC
          GOTO      TSTRW200 
.
TSTRW100  MOVE      "&nbsp;",KEY50 

TSTRW200  MOVE      ONE,F2 
          PACK      KEY22,F2,PRMUAMAN,Z70
          CALL      RSPRIT1     
          CALL      RPPRIT1     
          BRANCH    OVRCD,TSTRW300
.
          COMPARE   F2,PRITFLAG          * Item Type
          GOTO      TSTRW300 IF NOT EQUAL 
.
          MATCH     PRMUAMAN,PRITITMN    * AMA Item
          GOTO      TSTRW300 IF NOT EQUAL 

          MOVE      PRITDESC,AMADESC     * Set Desc 
          CLEAR     KEY40
          PACK      KEY40,PRMUAMAN,SP1,DASH,SP1,AMADESC
          GOTO      TSTRW400 
.
TSTRW300  MOVE      "&nbsp;",KEY40   
.
TSTRW400  CLEAR     DIM16
          PACK      PRMUCODE,PRMUCODE,SP70
          APPEND    PRMUCODE,DIM16
          APPEND    PRMUDATE,DIM16
          APPEND    PRMUNUMB,DIM16
.
          WRITE     HTMLFILE;"<tr><td nowrap><A HREF=#"javascript:DeleteRecord":
                             "('",DIM16,"');#">":
                             "<img src=../images/DeleteIcon.gif hspace=4":
                             " border=0 align=absmiddle></a>":
                             PRMUNUMB,"</td>":
                             "<td>",KEY50,"</td>":
                             "<td>",KEY40,"</td>":
                             "</tr>"
.
TSTRW999 RETURN
.------------------------------------------------------------------------------
          INC       IBAWEBCD
          INC       RSHWEBCD
          INC       PMSHCPTM
          INC       PATDOCTM
          INC       PATDOCCD
.
          INC       APSMASIO/INC
          INC       PRIMGPIO/INC
          INC       PRIITMIO/INC
          INC       PRIIKIIO/INC
          INC       PRITESIO/INC
          INC       PRITKIIO/INC
          INC       PRIGRPIO/INC
          INC       PRIDOCIO/INC
          INC       PRIPRAIO/INC
          INC       PRITHDIO/INC
          INC       PRITDTIO/INC
          INC       PRIMULIO/INC
          INC       PMSHCPIO/INC
          INC       PATIN1IO/INC                 * insurance company file
          INC       PATDO1IO/INC                 * insurance company file
          INC       IBAGSTIO/INC
.
          INC       DAYOFWEK
          INC       NAMSTRCD
          INC       WEBDATCD
          INC       PRIIKIPR     * AMA/MBS Item Keyword Proc
          INC       PRITKIPR     * Pathology Test Keyword Proc
