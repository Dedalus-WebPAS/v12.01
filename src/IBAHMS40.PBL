.*******************************************************************************
.* System         :  PMI                                                       *
.* Program        :  IBAHMS40                                                  *
.* Description    :  Load eAccreditation Doctor Details into webPAS            *
.*******************************************************************************
.* Date           :  15/02/2013                                                *
.* Author         :  Patrick Adair                                             *
.* Function       :  Load eAccreditation Doctor Details from CSV file          *
.* Modifications  :                                                            *
.*******************************************************************************
.* V12.01.01   26/11/2025 J.Tan                  TSK 0969590                   *
.*                        Mod checking for a space between Doctor code-CSPA0000*
.* V12.00.04   14.10.2025 DA Sarkies             TSK 0948995                   *
.*                        Cleared hospital flag PTDOHOSS if update flag        *
.*                        PTCNUPEA is set at PROC5200                          *
.* V12.00.03   10.10.2025 DA Sarkies             TSK 0948995                   *
.*                        Cleared hospital flag PMHCHOSS if update flag        *
.*                        PTCNUPEA is set at PROC5200                          *
.* V12.00.02   22.09.2025 DA Sarkies             TSK 0948995                   *
.*                        Added 'Valid for all Hospitals' if blank             *
.* V12.00.01   18/09/2025 DA Sarkies             TSK 0948995                   *
.*                        Added check to skip error if hospital code blank     *
.*                        in PURPST00                                          *
.* V11.05.04   14.10.2025 DA Sarkies             TSK 0948995                   *
.*                        Cleared hospital flag PTDOHOSS if update flag        *
.*                        PTCNUPEA is set at PROC5200                          *
.* V11.05.03   10.10.2025 DA Sarkies             TSK 0948995                   *
.*                        Cleared hospital flag PMHCHOSS if update flag        *
.*                        PTCNUPEA is set at PROC5200                          *
.* V11.05.02   22.09.2025 DA Sarkies             TSK 0948995                   *
.*                        Added 'Valid for all Hospitals' if blank             *
.* V11.05.01   18/09/2025 DA Sarkies             TSK 0948995                   *
.*                        Added check to skip error if hospital code blank     *
.* V11.01.01   15/02/2021 Peter Vela             TSK 0897522                   *
.*                        MOVE "1" to PTDOHOSS in ADDR0000 and UPDR0000        *
.*                        when there is an update or write to mlthcpaf         *
.* V11.00.01   09/02/2021 Peter Vela             TSK 0897522                   *
.*                        MOVE "1" to PMHCHOSS in ADDR0000 and UPDR0000        *
.*                        when there is an update or write to mlthcpaf         *
.* V10.11.04   19/10/2017 Thanh T.               TSK 0845551                   *
.*                        Added valiation for First and Last Accreditation     *
.* V10.11.03   18/10/2017 Thanh T.               TSK 0845551                   *
.*                        Added First Accreditation date (EACRDFAC) and Last   *
.*                        Accreditation Date (EACRDLAC) fields for uploading   *
.* V10.11.02   16/08/2017 J.Tan                  TSK 0843289                   *
.*                        Fixed I*D on pmsdunaf file                           *
.* V10.11.01   09/08/2017 Tracey Nguyen          TSK 0299206                   *
.*                        Recompiled for PATDKIPR/PMSHKIPR                     *
.* V10.10.02   27/06/2017 Ania P                 TSK 0837439                   *
.*                        Added validation for EACRPRFC and EACRLEVL           *
.* V10.10.01   14/06/2017 Ania P                 TSK 0837439                   *
.*                        Added new variables EACRPRFC and EACRLEVL            *
.* V10.09.03   13/02/2017 Don Nguyen             TSK 0833377                   *
.*                        Modified PROC0000 - Test for blank record (line)     *
.* V10.09.02   08/02/2017 Don Nguyen             TSK 0832961                   *
.*                        Modified VALI2699 - Validate non-numeric characters  *
.* V10.09.01   07/02/2017 Don Nguyen             TSK 0832961                   *
.*                        Modified VALI2699 - Format Status Code for validation*
.* V10.08.03   04/11/2016 Don Nguyen             TSK 0817948                   *
.*                        Added validation for Gender & Insurance Code         *
.* V10.08.02   28/10/2016 Don Nguyen             TSK 0817948                   *
.*                        Reworked report layout for PTCNEACF=1.               *
.*                        Cleared DIM3 at VALI2000.                            *
.*                        Modified ADDR0000 & UPDR0000 to call PCOM0000.       *
.*                        Added GCMTYP00, PCOM0000 & PRUPST00.                 *
.*                        Added extended format (SJGHC) fields - PTCNEACF      *
.*                        Added pipe delimiter counts to file layout (EACRDTXT)*
.* V10.08.01   29/09/2016 Ebon Clements                            TSK 0826175 *
.*                        Added option 2 - Automatic Load eAccreditation.      *
.* V10.06.03   14/07/2015 Peter Vela                                CAR 318915 *
.*                        Removed auto Upper Case Doctor Hospitals             *
.* V10.06.02   24/06/2015 Don Nguyen                                CAR 307674 *
.*                        Added new fields for AH Preferred Method of Contact  *
.*                        (EACRAMC1-3) and Registration Number (EACRREGN).     *
.*                        Modified VALI0000 to validate all Speciality codes   *
.*                        (EACRSPC1-5).                                        *
.* V10.06.01   30/04/2015 Don Nguyen                                CAR 307991 *
.*                        Added PTCNUPEA - Update Doctor Load eAccreditation.  *
.*                        Modified LCUC0000 to remove some fields from upcase. *
.*                        Added new fields for Speciality 2-5 (PMHCSPC2-5).    *
.*******************************************************************************
.* V10.05.01   18/07/2014 Steve Armstrong                           CAR 298854 *
.*                        Fixed to load local doctor code (pmshcpaf.pnhcldoc)  *
.*                        field when writing HCP record.                       *
.*******************************************************************************
.* V10.04.01   28/04/2014 Patrick Adair                             CAR 299906 *
.*                        Set doctor start & end date in mlthcpaf and pmshcpaf *
.*******************************************************************************
.* V10.03.01   24/07/2013 Patrick Adair                             CAR 288519 *
.*                        Removed auto Upper Case for Doctor Names and address *
.* V10.03.00   15/02/2013 Patrick Adair                             CAR 274379 *
.*                        Initial Program Release                              *
.*******************************************************************************
.
          INC       STD001FD                     * Standard Include
.
          INC       IBACONFD/INC                 * Control File
          INC       MLTHCPFD/INC                 * Multi Hospital HCP Codes
          INC       PATCODFD/INC                 * Patient Codes File
          INC       PATCONFD/INC                 * Patient Control File
          INC       PATDO1FD/INC                 * Doctor Details File
          INC       PATDKIFD/INC                 * Doctors Key Word File
          INC       PATDRGFD/INC                 * Patient Period Date Range
          INC       PATDSTFD/INC                 * Patient Doctor Stats File
          INC       PATHSPFD/INC                 * Hospital Details File
          INC       PATIN1FD/INC                 * Insurance Details File
          INC       PMSDUNFD/INC                 * Doctor/Unit Combination File
          INC       PMSHCPFD/INC                 * HCP Details File
          INC       PMSHKIFD/INC                 * HCP Key Word File
          INC       PMSTCOFD/INC                 * General HCP Comments
          INC       WEBSECFD/INC                 * Web Security File
.
.*******************************************************************************
.*                     Doctors eAccreditation Upload file                      *
.*******************************************************************************
.
EACRDTXT  FILE       HL7, FIXED=4096
.
.Name      Type    Size              Start Loc   Description
.----      ----    ----              ---------   -----------
EACRHCPC   DIM      10                      1    Doctor Code
.PIPE      DIM       1                     11    Pipe Delimiter
EACRTITL   DIM      10                     12    Doctor Title
.PIPE      DIM       1                     22    Pipe Delimiter
EACRSNAM   DIM      35                     23    Doctor Surname
.PIPE      DIM       1                     58    Pipe Delimiter
EACRGNAM   DIM      35                     59    Doctor Given Name
.PIPE      DIM       1                     94    Pipe Delimiter
EACRADD1   DIM      60                     95    Doctor Surgery Address 1
.PIPE      DIM       1                    155    Pipe Delimiter
EACRADD2   DIM      60                    156    Doctor Surgery Address 2
.PIPE      DIM       1                    216    Pipe Delimiter
EACRADD3   DIM      60                    217    Doctor Surgery Suburb
.PIPE      DIM       1                    277    Pipe Delimiter
EACRADD4   DIM      60                    278    Doctor Surgery State
.PIPE      DIM       1                    338    Pipe Delimiter
EACRPOST   DIM       8                    339    Doctor Post Code
.PIPE      DIM       1                    347    Pipe Delimiter
EACRSEML   DIM      80                    348    Doctor Surgery Email
.PIPE      DIM       1                    428    Pipe Delimiter
EACRRCPT   DIM      25                    429    Doctor Receptionist
.PIPE      DIM       1                    454    Pipe Delimiter
EACRSTEL   DIM      20                    455    Doctor Telephone
.PIPE      DIM       1                    475    Pipe Delimiter
EACRFAXN   DIM      20                    476    Doctor Fax
.PIPE      DIM       1                    496    Pipe Delimiter
EACRHAD1   DIM      60                    497    Doctor Home Address
.PIPE      DIM       1                    557    Pipe Delimiter
EACRHAD3   DIM      60                    558    Doctor Home Suburb
.PIPE      DIM       1                    618    Pipe Delimiter
EACRHAD4   DIM      60                    619    Doctor Home State
.PIPE      DIM       1                    679    Pipe Delimiter
EACRHPCD   DIM       8                    680    Doctor Home Postcode
.PIPE      DIM       1                    688    Pipe Delimiter
EACRDTOB   DIM       8                    689    Doctor Date of Birth
.PIPE      DIM       1                    697    Pipe Delimiter
EACRPAGR   DIM      20                    698    Doctor Pager Phone Number
.PIPE      DIM       1                    718    Pipe Delimiter
EACRPAGN   DIM      20                    719    Doctor Pager Number
.PIPE      DIM       1                    739    Pipe Delimiter
EACRMOBN   DIM      20                    740    Doctor Mobile Number
.PIPE      DIM       1                    760    Pipe Delimiter
EACRSPC1   DIM       3                    761    Doctor Primary Speciality
.                                                       (Category DT)
.PIPE      DIM       1                    764    Pipe Delimiter
EACRNHSN   DIM      10                    765    Doctor Prescriber Number
.PIPE      DIM       1                    775    Pipe Delimiter
EACRSTAT   DIM       1                    776    Doctor Status
.                                                       0 - Active in hospital
.                                                       1 - Not Active
.                                                       2 - Active Outside
.
.PIPE      DIM       1                    777    Pipe Delimiter
.
.* Repeating Hospital Section Group 1
EACRHSP0   DIM       3                    778    Doctor Hospital
.PIPE      DIM       1                    781    Pipe Delimiter
EACRSTD0   DIM       8                    782    Doctor Start Date
.PIPE      DIM       1                    790    Pipe Delimiter
EACREDD0   DIM       8                    791    Doctor End Date
.PIPE      DIM       1                    799    Pipe Delimiter
EACRPRV0   DIM      10                    800    Doctor Provider number
.PIPE      DIM       1                    810    Pipe Delimiter
EACRHST0   DIM       2                    811    HCP Status
.PIPE      DIM       1                    813    Pipe Delimiter
EACRTYP0   DIM       3                    814    Doctor Accreditation Type
.                                                       (Category AT)
.PIPE      DIM       1                    817    Pipe Delimiter
EACREXP0   DIM       8                    818    Doctor Accreditation Expiry
.PIPE      DIM       1                    826    Pipe Delimiter
EACRACV0   DIM       1                    827    Doctor Active
.                                                       0 - Active
.                                                       1 - Inactive
.
.PIPE      DIM       1                    828    Pipe Delimiter
.
.* Repeating Hospital Section Group 2
EACRHSP1   DIM       3                    829    Doctor Hospital
.PIPE      DIM       1                    832    Pipe Delimiter
EACRSTD1   DIM       8                    833    Doctor Start Date
.PIPE      DIM       1                    841    Pipe Delimiter
EACREDD1   DIM       8                    842    Doctor End Date
.PIPE      DIM       1                    850    Pipe Delimiter
EACRPRV1   DIM      10                    851    Doctor Provider number
.PIPE      DIM       1                    861    Pipe Delimiter
EACRHST1   DIM       2                    862    HCP Status
.PIPE      DIM       1                    864    Pipe Delimiter
EACRTYP1   DIM       3                    865    Doctor Accreditation Type
.                                                       (Category AT)
.PIPE      DIM       1                    868    Pipe Delimiter
EACREXP1   DIM       8                    869    Doctor Accreditation Expiry
.PIPE      DIM       1                    877    Pipe Delimiter
EACRACV1   DIM       1                    878    Doctor Active
.                                                       0 - Active
.                                                       1 - Inactive
.
.PIPE      DIM       1                    879    Pipe Delimiter
.
.* Repeating Hospital Section Group 3
EACRHSP2   DIM       3                    880    Doctor Hospital
.PIPE      DIM       1                    883    Pipe Delimiter
EACRSTD2   DIM       8                    884    Doctor Start Date
.PIPE      DIM       1                    892    Pipe Delimiter
EACREDD2   DIM       8                    893    Doctor End Date
.PIPE      DIM       1                    901    Pipe Delimiter
EACRPRV2   DIM      10                    902    Doctor Provider number
.PIPE      DIM       1                    912    Pipe Delimiter
EACRHST2   DIM       2                    913    HCP Status
.PIPE      DIM       1                    915    Pipe Delimiter
EACRTYP2   DIM       3                    916    Doctor Accreditation Type
.                                                       (Category AT)
.PIPE      DIM       1                    919    Pipe Delimiter
EACREXP2   DIM       8                    920    Doctor Accreditation Expiry
.PIPE      DIM       1                    928    Pipe Delimiter
EACRACV2   DIM       1                    929    Doctor Active
.                                                       0 - Active
.                                                       1 - Inactive
.
.PIPE      DIM       1                    930    Pipe Delimiter
.
.* Repeating Hospital Section Group 4
EACRHSP3   DIM       3                    931    Doctor Hospital
.PIPE      DIM       1                    934    Pipe Delimiter
EACRSTD3   DIM       8                    935    Doctor Start Date
.PIPE      DIM       1                    943    Pipe Delimiter
EACREDD3   DIM       8                    944    Doctor End Date
.PIPE      DIM       1                    952    Pipe Delimiter
EACRPRV3   DIM      10                    953    Doctor Provider number
.PIPE      DIM       1                    963    Pipe Delimiter
EACRHST3   DIM       2                    964    HCP Status
.PIPE      DIM       1                    966    Pipe Delimiter
EACRTYP3   DIM       3                    967    Doctor Accreditation Type
.                                                       (Category AT)
.PIPE      DIM       1                    970    Pipe Delimiter
EACREXP3   DIM       8                    971    Doctor Accreditation Expiry
.PIPE      DIM       1                    979    Pipe Delimiter
EACRACV3   DIM       1                    980    Doctor Active
.                                                       0 - Active
.                                                       1 - Inactive
.
.PIPE      DIM       1                    981    Pipe Delimiter
.
.* Repeating Hospital Section Group 5
EACRHSP4   DIM       3                    982    Doctor Hospital
.PIPE      DIM       1                    985    Pipe Delimiter
EACRSTD4   DIM       8                    986    Doctor Start Date
.PIPE      DIM       1                    994    Pipe Delimiter
EACREDD4   DIM       8                    995    Doctor End Date
.PIPE      DIM       1                   1003    Pipe Delimiter
EACRPRV4   DIM      10                   1004    Doctor Provider number
.PIPE      DIM       1                   1014    Pipe Delimiter
EACRHST4   DIM       2                   1015    HCP Status
.PIPE      DIM       1                   1017    Pipe Delimiter
EACRTYP4   DIM       3                   1018    Doctor Accreditation Type
.                                                       (Category AT)
.PIPE      DIM       1                   1021    Pipe Delimiter
EACREXP4   DIM       8                   1022    Doctor Accreditation Expiry
.PIPE      DIM       1                   1030    Pipe Delimiter
EACRACV4   DIM       1                   1031    Doctor Active
.                                                       0 - Active
.                                                       1 - Inactive
.
.PIPE      DIM       1                   1032    Pipe Delimiter
.
.* Repeating Hospital Section Group 6
EACRHSP5   DIM       3                   1033    Doctor Hospital
.PIPE      DIM       1                   1036    Pipe Delimiter
EACRSTD5   DIM       8                   1037    Doctor Start Date
.PIPE      DIM       1                   1045    Pipe Delimiter
EACREDD5   DIM       8                   1046    Doctor End Date
.PIPE      DIM       1                   1054    Pipe Delimiter
EACRPRV5   DIM      10                   1055    Doctor Provider number
.PIPE      DIM       1                   1065    Pipe Delimiter
EACRHST5   DIM       2                   1066    HCP Status
.PIPE      DIM       1                   1068    Pipe Delimiter
EACRTYP5   DIM       3                   1067    Doctor Accreditation Type
.                                                       (Category AT)
.PIPE      DIM       1                   1070    Pipe Delimiter
EACREXP5   DIM       8                   1071    Doctor Accreditation Expiry
.PIPE      DIM       1                   1079    Pipe Delimiter
EACRACV5   DIM       1                   1080    Doctor Active
.                                                       0 - Active
.                                                       1 - Inactive
.
.PIPE      DIM       1                   1081    Pipe Delimiter
.
.* Repeating Hospital Section Group 7
EACRHSP6   DIM       3                   1082    Doctor Hospital
.PIPE      DIM       1                   1085    Pipe Delimiter
EACRSTD6   DIM       8                   1086    Doctor Start Date
.PIPE      DIM       1                   1094    Pipe Delimiter
EACREDD6   DIM       8                   1095    Doctor End Date
.PIPE      DIM       1                   1113    Pipe Delimiter
EACRPRV6   DIM      10                   1114    Doctor Provider number
.PIPE      DIM       1                   1124    Pipe Delimiter
EACRHST6   DIM       2                   1125    HCP Status
.PIPE      DIM       1                   1127    Pipe Delimiter
EACRTYP6   DIM       3                   1128    Doctor Accreditation Type
.                                                       (Category AT)
.PIPE      DIM       1                   1131    Pipe Delimiter
EACREXP6   DIM       8                   1132    Doctor Accreditation Expiry
.PIPE      DIM       1                   1140    Pipe Delimiter
EACRACV6   DIM       1                   1141    Doctor Active
.                                                       0 - Active
.                                                       1 - Inactive
.
.PIPE      DIM       1                   1142    Pipe Delimiter
.
.* Repeating Hospital Section Group 8
EACRHSP7   DIM       3                   1143    Doctor Hospital
.PIPE      DIM       1                   1146    Pipe Delimiter
EACRSTD7   DIM       8                   1147    Doctor Start Date
.PIPE      DIM       1                   1155    Pipe Delimiter
EACREDD7   DIM       8                   1156    Doctor End Date
.PIPE      DIM       1                   1164    Pipe Delimiter
EACRPRV7   DIM      10                   1165    Doctor Provider number
.PIPE      DIM       1                   1175    Pipe Delimiter
EACRHST7   DIM       2                   1176    HCP Status
.PIPE      DIM       1                   1178    Pipe Delimiter
EACRTYP7   DIM       3                   1179    Doctor Accreditation Type
.                                                       (Category AT)
.PIPE      DIM       1                   1182    Pipe Delimiter
EACREXP7   DIM       8                   1183    Doctor Accreditation Expiry
.PIPE      DIM       1                   1191    Pipe Delimiter
EACRACV7   DIM       1                   1192    Doctor Active
.                                                       0 - Active
.                                                       1 - Inactive
.
.PIPE      DIM       1                   1193    Pipe Delimiter
.
.* Repeating Hospital Section Group 9
EACRHSP8   DIM       3                   1194    Doctor Hospital
.PIPE      DIM       1                   1197    Pipe Delimiter
EACRSTD8   DIM       8                   1198    Doctor Start Date
.PIPE      DIM       1                   1206    Pipe Delimiter
EACREDD8   DIM       8                   1207    Doctor End Date
.PIPE      DIM       1                   1215    Pipe Delimiter
EACRPRV8   DIM      10                   1216    Doctor Provider number
.PIPE      DIM       1                   1226    Pipe Delimiter
EACRHST8   DIM       2                   1227    HCP Status
.PIPE      DIM       1                   1229    Pipe Delimiter
EACRTYP8   DIM       3                   1230    Doctor Accreditation Type
.                                                       (Category AT)
.PIPE      DIM       1                   1233    Pipe Delimiter
EACREXP8   DIM       8                   1234    Doctor Accreditation Expiry
.PIPE      DIM       1                   1242    Pipe Delimiter
EACRACV8   DIM       1                   1243    Doctor Active
.                                                       0 - Active
.                                                       1 - Inactive
.
.PIPE      DIM       1                   1244    Pipe Delimiter
.
.* Repeating Hospital Section Group 10
EACRHSP9   DIM       3                   1245    Doctor Hospital
.PIPE      DIM       1                   1248    Pipe Delimiter
EACRSTD9   DIM       8                   1249    Doctor Start Date
.PIPE      DIM       1                   1257    Pipe Delimiter
EACREDD9   DIM       8                   1258    Doctor End Date
.PIPE      DIM       1                   1266    Pipe Delimiter
EACRPRV9   DIM      10                   1267    Doctor Provider number
.PIPE      DIM       1                   1277    Pipe Delimiter
EACRHST9   DIM       2                   1278    HCP Status
.PIPE      DIM       1                   1280    Pipe Delimiter
EACRTYP9   DIM       3                   1281    Doctor Accreditation Type
.                                                       (Category AT)
.PIPE      DIM       1                   1284    Pipe Delimiter
EACREXP9   DIM       8                   1285    Doctor Accreditation Expiry
.PIPE      DIM       1                   1293    Pipe Delimiter
EACRACV9   DIM       1                   1294    Doctor Active
.                                                       0 - Active
.                                                       1 - Inactive
.
.PIPE      DIM       1                   1295    Pipe Delimiter
.
.* Repeating Units Section  X10
EACRUNT0   DIM       3                   1296    Doctor Unit (Category AC)
.PIPE      DIM       1                   1299    Pipe Delimiter
EACRUNT1   DIM       3                   1300    Doctor Unit (Category AC)
.PIPE      DIM       1                   1303    Pipe Delimiter
EACRUNT2   DIM       3                   1304    Doctor Unit (Category AC)
.PIPE      DIM       1                   1307    Pipe Delimiter
EACRUNT3   DIM       3                   1308    Doctor Unit (Category AC)
.PIPE      DIM       1                   1311    Pipe Delimiter
EACRUNT4   DIM       3                   1312    Doctor Unit (Category AC)
.PIPE      DIM       1                   1315    Pipe Delimiter
EACRUNT5   DIM       3                   1316    Doctor Unit (Category AC)
.PIPE      DIM       1                   1319    Pipe Delimiter
EACRUNT6   DIM       3                   1320    Doctor Unit (Category AC)
.PIPE      DIM       1                   1323    Pipe Delimiter
EACRUNT7   DIM       3                   1324    Doctor Unit (Category AC)
.PIPE      DIM       1                   1327    Pipe Delimiter
EACRUNT8   DIM       3                   1328    Doctor Unit (Category AC)
.PIPE      DIM       1                   1331    Pipe Delimiter
EACRUNT9   DIM       3                   1332    Doctor Unit (Category AC)
.PIPE      DIM       1                   1335    Pipe Delimiter
.
.
. Sub Specialities
EACRSPC2   DIM       3                   1336    2nd Speciality
.PIPE      DIM       1                   1339    Pipe Delimiter
EACRSPC3   DIM       3                   1340    3rd Speciality
.PIPE      DIM       1                   1343    Pipe Delimiter
EACRSPC4   DIM       3                   1344    4th Speciality
.PIPE      DIM       1                   1347    Pipe Delimiter
EACRSPC5   DIM       3                   1348    5th Speciality
.PIPE      DIM       1                   1351    Pipe Delimiter
.
.
. AH Pref Method of Contact
EACRAMC1   DIM       3                   1352    AH Pref Method of Contact 1
.PIPE      DIM       1                   1355    Pipe Delimiter
EACRAMC2   DIM       3                   1356    AH Pref Method of Contact 2
.PIPE      DIM       1                   1359    Pipe Delimiter
EACRAMC3   DIM       3                   1360    AH Pref Method of Contact 3
.PIPE      DIM       1                   1363    Pipe Delimiter
EACRREGN   DIM       20                  1364    Registration Number
.PIPE      DIM       1                   1384    Pipe Delimiter
.
.
. Extended (SJGHC) Format Fields
EACRPRFN   DIM       30                  1385    Preferred Name
.PIPE      DIM       1                   1415    Pipe Delimiter
EACRGEND   DIM       1                   1416    Gender
.PIPE      DIM       1                   1417    Pipe Delimiter
EACRHTEL   DIM       20                  1418    HCP Home Telephone
.PIPE      DIM       1                   1438    Pipe Delimiter
EACRPFAX   DIM       12                  1439    HCP Personal Fax
.PIPE      DIM       1                   1451    Pipe Delimiter
EACRPEML   DIM       80                  1452    HCP Personal Email
.PIPE      DIM       1                   1532    Pipe Delimiter
EACRABNN   DIM       11                  1533    HCP ABN
.PIPE      DIM       1                   1544    Pipe Delimiter
EACRARFR   DIM       8                   1545    AHPRA Number Registration From
.PIPE      DIM       1                   1553    Pipe Delimiter
EACRARTO   DIM       8                   1554    AHPRA Number Registration To
.PIPE      DIM       1                   1562    Pipe Delimiter
EACRINSC   DIM       6                   1563    Insurance Code
.PIPE      DIM       1                   1569    Pipe Delimiter
EACRINSP   DIM       20                  1570    Insurance Policy Number
.PIPE      DIM       1                   1590    Pipe Delimiter
EACRINFR   DIM       8                   1591    Insurance Date From
.PIPE      DIM       1                   1599    Pipe Delimiter
EACRINTO   DIM       8                   1600    Insurance Date To
.PIPE      DIM       1                   1608    Pipe Delimiter
EACRNOKC   DIM       200                 1609    Next of Kin Comments
.PIPE      DIM       1                   1809    Pipe Delimiter
EACRRADC   DIM       200                 1810    Radiation License Comments
.PIPE      DIM       1                   2010    Pipe Delimiter
EACRWRKC   DIM       200                 2011    Working with Children Comments
.PIPE      DIM       1                   2211    Pipe Delimiter
EACRPOLC   DIM       200                 2212    Police Clearance Comments
.PIPE      DIM       1                   2412    Pipe Delimiter
EACRSCPC   DIM       200                 2413    Scope of Practice Comments
.PIPE      DIM       1                   2613    Pipe Delimiter
EACROTHC   DIM       200                 2614    Other Information Comments
.PIPE      DIM       1                   2814    Pipe Delimiter
EACRVEHC   DIM       200                 2815    Vehicle Registration Comments
.PIPE      DIM       1                   3015    Pipe Delimiter
EACRPRFC   DIM       3                   3016    HCP Preferred Contact Method
.PIPE      DIM       1                   3019    Pipe Delimiter
EACRLEVL   DIM       3                   3020    Supervision Level
.PIPE      DIM       1                   3023    Pipe Delimiter
EACRDFAC   DIM       8                   3024    First Accreditation Date
.PIPE      DIM       1                   3032    Pipe Delimiter
EACRDLAC   DIM       8                   3033    Last Accreditation Date
.
.
.End of record                           3041
.
.*******************************************************************************
.*                             Program Variables                               *
.*******************************************************************************
CMDLINE   DIM       200                          * Command Line
CMNTTIND  DIM       1                            * Comment Type Indc3 value
CMNTTCOD  DIM       3                            * Comment Type Code (Cat TZ)
COMCOUNT  FORM      8                            * Comments error record count
COMMTLEN  FORM      4                            * Comments length
CPTDATE   DIM       8                            * Date parameter for GPERD
DIM3      DIM       3                            * Category Code validation
ERRMESSG  DIM       100                          * Formatted Error Message
FINYEAR   DIM       4                            * Current Financial Year
FNAMEINP  DIM       150                          * Input File path/name
LINENUMB  FORM      3                            * Comments Line No.
LEAPDAYS  FORM      2                            * Days in February
LOOPCNTR  FORM      2                            * File Occurrences
COMNTHCP  DIM       10                           * Comments HCP Code
COMNTLNE  DIM       200                          * Comments Line
COMNTTYP  DIM       3                            * Comments Type (Cat TZ)
PATHNAME  DIM       100                          * Path Name of Input File
TEMPDATE  DIM       8                            * Date Validation
DATEFROM  FORM      8                            * From Date
DATETO    FORM      8                            * To Date
TEMPVAR   DIM       20
TODAY     DIM       8                            * Today's Date
TOTDOCTS  FORM      4                            * Number of Doctors Processed
TOTDRADD  FORM      4                            * Number of Doctors added
TOTDRERR  FORM      4                            * Number of Doctors in error
TOTDRUPD  FORM      4                            * Number of Doctors updated
UPDTTIME  DIM       8                            * Current Time
UPDTTYPE  DIM       1                            * Add/Update flag
UPLDSTAT  FORM      1                            * Upload status
USERID    DIM       10                           * Input User ID
.
.*******************************************************************************
.*                             Program Constants                               *
.*******************************************************************************
CATUCAC   INIT      "AC"
CATUCAT   INIT      "AT"
CATUCCZ   INIT      "CZ"
CATUCDL   INIT      "DL"
CATUCDT   INIT      "DT"
CATUCTZ   INIT      "TZ"
ENDOFRPT  INIT      "  ***  END OF REPORT  ***"
EXCEP001  INIT      "Category "
EXCEP002  INIT      " Code "
EXCEP003  INIT      " is invalid or inactive"
EXCEP004  INIT      "Hospital code "
EXCEP005  INIT      " invalid"
EXCEP006  INIT      "Doctor Status"
EXCEP007  INIT      "HCP Status"
EXCEP008  INIT      "Doctor code already exists in HCP file but not Doctor File"
EXCEP009  INIT      "Start date is invalid "
EXCEP010  INIT      "End Date is invalid "
EXCEP011  INIT      "Accreditation Expiry Date is invalid "
EXCEP012  INIT      "Date of Birth is invalid "
EXCEP013  INIT      "Doctor code already exists in Doctor file but not HCP File"
EXCEP014  INIT      "Gender code "
EXCEP015  INIT      "Insurance code "
EXCEP016  INIT      "Invalid Preferred Contact Method"
EXCEP017  INIT      "Invalid Supervision Level"
EXCEP018  INIT      "First Accreditation Date > Last Accreditation Date"
EXCEP019  INIT      "First Accreditation Date is invalid "
EXCEP020  INIT      "Last Accreditation Date is invalid "
.
.*******************************************************************************
.*                        Program Version Information                          *
.*******************************************************************************
PRGID     INIT      "IBAHMS40"
.                   ****************** NB Spaces at end of PRGNAM are deliberate
PRGNAM    INIT      "Load eAccreditation Doctor Details   "
VERSION   INIT      "V12.01.01"
+
.******************************************************************************
.*                                  MAIN0000                                  *
.*                               Main Procedure                               *
.******************************************************************************
MAIN0000  CALL      INIT0000                     * Initailize variables & files
          BRANCH    EXIT,MAIN9900
.
          CALL      OPTN0000                     * select options
          BRANCH    EXIT,MAIN9999                * EXIT = 1 if 0 chosen in menu

          CALL      GFIL0000                     * Keyin Input Path & File name
          BRANCH    EXIT,MAIN9900
.
          CALL      GUSR0000                     * Get Web User Id
          BRANCH    EXIT,MAIN9900
.
          CALL      GPTH0000                     * Keyin pathname
          BRANCH    EXIT,MAIN9900
.
MAIN1000  CALL      PROC0000                     * Upload Dr eAccreditation Dtls
.
          CALL      PRTOT000                     * Print Upload Record totals
          PRINT     *N,*N,ENDOFRPT               * Print End of Report
.
          IF        COPTION=2
            CLEAR     CMDLINE                    * Run us3 sending spool file
            APPEND    "ibahms40.us3 ",CMDLINE    * name
            APPEND    SPLFILE,CMDLINE
            APPEND    SP70,CMDLINE
            RESET     CMDLINE
            EXECUTE   CMDLINE,TASKID
          ENDIF
.
          GOTO      MAIN9999
.
MAIN9900  CALL      HEAD132
          PRINT     *N,"Failed to open upload file. "
.
          IF        COPTION=2
            CLEAR     CMDLINE
            APPEND    "ibahms40.us2 ",CMDLINE    * Run us2 sending load
            APPEND    FNAMEINP,CMDLINE           * file name
            APPEND    SP70,CMDLINE
            RESET     CMDLINE
            EXECUTE   CMDLINE,TASKID
          ENDIF
.
MAIN9999  CHAIN     PGM
+
.****************************************************************************
.*                                OPTN0000             Called by: ML0000    *
.*                        get user options or exit                          *
.*                                                                          *
.*    Returns:  EXIT    = FALSE (0)  Run clean up                           *
.*                        TRUE  (1)  Exit option selected                   *
.****************************************************************************
.
OPTN0000  DISPLAY   *P1:3,*EF,*P1:4,*V2LON,ZERO,*HOFF,". Exit":
                    *P1:5,*V2LON,ONE,*HOFF,". Load eAccreditation":
                    *P1:6,*V2LON,TWO,*HOFF,". Auto Load eAccreditation "
.
OPTN0500  KEYIN     *P1:7,*EL,"Select Option : ",*DV,UNDLN1:
                    *P17:7,*V2LON,COPTION
.
          COMPARE   ZERO,COPTION                 * exit selected ?
          GOTO      OPTN9500 IF EQUAL            * yes
.
          BRANCH    COPTION,OPTN9000,OPTN9000    * run clean-up
.
          BEEP
          GOTO      OPTN0500
.
OPTN9000  MOVE      ZERO,EXIT
          GOTO      OPTN9999
.
OPTN9500  MOVE      ONE,EXIT
.
OPTN9999  RETURN
+
.******************************************************************************
.*                                 INIT0000                                   *
.*                     Initialize Variables & Open Files                      *
.******************************************************************************
INIT0000  CALL      DISPHEAD                     * Display screen heading
.
          CALL      IBACLOCK
          PACK      TODAY,CCC,CYY,CMM,CDD
          REP       " 0",TODAY
          CLOCK     TIME,UPDTTIME
.
          DISPLAY   *P64:24,"controlf";
          OPEN      CONTROLF,"controlf"          * Inpatient CONTROL File
.
          DISPLAY   *P64:24,"mlthcpaf";
          OPEN      MLTHCPA1,"mlthcpaf"          * Multi Hospital HCP Codes
.
          DISPLAY   *P64:24,"patcodes";
          OPEN      PATCODE1,"patcodes"          * Patient Codes File
.
          DISPLAY   *P64:24,"patcodes";
          OPEN      PATCODE2,"patcodes"          * Patient Codes File
.
          DISPLAY   *P64:24,"patdo1af";
          OPEN      PATDO1A1,"patdo1af"          * Doctor Details File
.
          DISPLAY   *P64:24,"patdkiaf";
          OPEN      PATDKIA1,"patdkiaf"          * Doctors Key Word File
.
          DISPLAY   *P64:24,"patdrgaf";
          OPEN      PATDRGA1,"patdrgaf"          * Period Date Range File
.
          DISPLAY   *P64:24,"patdstat";
          OPEN      PATDSTA1,"patdstat"          * Patient Doctor Statistics File
.
          DISPLAY   *P64:24,"pathspaf";
          OPEN      PATHSPA1,"pathspaf"          * Hospital Details File
.
          DISPLAY   *P64:24,"pmsdunaf";
          OPEN      PMSDUNA1,"pmsdunaf"          * Doctor/Unit Combination File
.
          DISPLAY   *P64:24,"pmshcpaf";
          OPEN      PMSHCPA1,"pmshcpaf"          * HCP Details File
.
          DISPLAY   *P64:24,"pmshkiaf";
          OPEN      PMSHKIA1,"pmshkiaf"          * HCP Key Word File
.
          DISPLAY   *P64:24,"websecaf";
          OPEN      WEBSECA1,"websecaf"          * Web Security File
.
          DISPLAY   *P64:24,"pmstcoaf";
          OPEN      PMSTCOA1,"pmstcoaf"          * General HCP Comments
.
          DISPLAY   *P64:24,"patin1af";
          OPEN      PATIN1A1,"patin1af"          * Insurance Details
.
          READ      CONTROLF,HUND16;*250,PTCNUPEA
          READ      CONTROLF,ZERO;*2,CDD,CMM,CYY,CCC
          READ      CONTROLF,HUND24;*134,PTCNEACF     * eAccreditation Format
.
.         Get the current financial year
.
          MOVE      TODAY,CPTDATE
          CALL      GPERD
          IF        EXIT = 1
            DISPLAY   *P1:24,*EL,*B,"Current Date Not Found In Period File.  ";
            CALL      HITENTER
            GOTO      INIT9999
          ENDIF
.
          MOVE      DRGYR,FINYEAR
.
          MOVE      ZERO,TOTDOCTS                * Number of Doctors Processed
          MOVE      ZERO,TOTDRADD                * Number of Doctors added
          MOVE      ZERO,TOTDRERR                * Number of Doctors in error
          MOVE      ZERO,TOTDRUPD                * Number of Doctors updated
          MOVE      SEVENTY,CLNO                 * Init Line Count
          MOVE      ZERO,CPAGENO                 * Init Page Count
.
INIT9999  RETURN
+
.******************************************************************************
.*                                 GFIL0000              Called by : MAIN0000 *
.* Keyin Upload File name and path                                            *
.******************************************************************************
GFIL0000  MOVE      ZERO,EXIT
          PACK      FNAMEINP WITH SP70,SP70,SP70
.
          DISPLAY   *P26:11,*EF,"Upload Doctors eAccreditation File";
.
          KEYIN     *P1:13,*EL,"Upload Path & File Name : ",*V2LON,FNAMEINP
.
          PACK      FNAMEINP,FNAMEINP,SP70,SP70,SP70
.
          MATCH     SP70,FNAMEINP
          GOTO      GFIL9000 IF EQUAL
.
          SCAN      ".txt",FNAMEINP
          IF        !@EQUAL
            SQUEEZE   FNAMEINP
            ENDSET    FNAMEINP
            APPEND    ".txt",FNAMEINP              * add ".txt" if necessary
            APPEND    SP70,FNAMEINP
            RESET     FNAMEINP
          ENDIF
          RESET     FNAMEINP
.
          DISPLAY   *P27:13,*V2LON,*EL,FNAMEINP;
          MOVE      ZERO,OVRCD
          TRAP      OVERCOND IF IO
.                                                * Check if Input file exists
          OPEN      EACRDTXT,FNAMEINP            * Doctors eAccreditation File
.
          TRAPCLR   IO
          BRANCH    OVRCD,GFIL8000
.                                                * Reformat Input File
          CALL      GFMT0000
.                                                * Open Input file
          OPEN      EACRDTXT,FNAMEINP            * Doctors eAccreditation File
.
          TRAPCLR   IO
          BRANCH    OVRCD,GFIL8000
.
          MOVE      ZERO,EXIT
          GOTO      GFIL9999
.
GFIL8000  DISPLAY   *P1:24,*EL,*B,"File not found.  ";
          CALL      HITENTER
          IF        COPTION=2
            GOTO      GFIL9000
          ENDIF

          GOTO      GFIL0000
.
GFIL9000  MOVE      ONE,EXIT
.
GFIL9999  RETURN
+
.*******************************************************************************
.*                                  GFMT0000               Called by: GFIL0000 *
.* Reformat tab delimited input file to HL7 pipe format                        *
.*******************************************************************************
GFMT0000  CLEAR     CMDLINE
          APPEND    "ibahms40.us1 ",CMDLINE
          APPEND    FNAMEINP,CMDLINE
          APPEND    SP70,CMDLINE
          RESET     CMDLINE
          EXECUTE   CMDLINE,TASKID
.
GFMT9999  RETURN
+
.*******************************************************************************
.*                                  GUSR0000               Called by: MAIN0000 *
.* Get Web User Id                                                             *
.*******************************************************************************
GUSR0000  MOVE      SP70,USERID
          KEYIN     *P1:15,*EF,"Web User Id  : ",*V2LON,USERID
.
          PACK      USERID,USERID,SP70
          MATCH     SP70,USERID
          GOTO      GUSR9100 IF EQUAL
.
          PACK      KEY10,USERID,SP70
          CALL      RDWBSE1
          BRANCH    OVRCD,GUSR9100
.
          MOVE      ZERO,EXIT
          GOTO      GUSR9999
.
GUSR9100  MOVE      ONE,EXIT
.
GUSR9999  RETURN
+
.******************************************************************************
.*                                  GPTH0000             Called by : MAIN0000 *
.* Keyin Upload File name and path                                            *
.******************************************************************************
GPTH0000  PACK      PATHNAME,SP70,SP70,SP70
          KEYIN     *P1:17,*EL,"Upload Path & File Name : ":
                    *P27:17,*V2LON,PATHNAME;
          ENDSET    PATHNAME
          APPEND    SP70,PATHNAME
          APPEND    SP70,PATHNAME
          APPEND    SP70,PATHNAME
          RESET     PATHNAME
.
          PACK      PATHNAME,PATHNAME,SP70,SP70,SP70
          MATCH     SP70,PATHNAME
          GOTO      GPTH9500 IF EQUAL
.
          MOVE      ZERO,EXIT
          GOTO      GPTH9999
.
GPTH9500  MOVE      ONE,EXIT
.
GPTH9999  RETURN
+
.******************************************************************************
.*                                  PROC0000             Called by : MAIN0000 *
.*  Upload Doctor eAccreditation Details                                      *
.******************************************************************************
PROC0000  MATCH     "1",PTCNEACF       * Extended (SJGHC) format?
          GOTO      PROC1000 IF EQUAL
.
          READ      EACRDTXT,SEQ;EACRHCPC,EACRTITL,EACRSNAM,EACRGNAM,EACRADD1:
                                 EACRADD2,EACRADD3,EACRADD4,EACRPOST,EACRSEML:
                                 EACRRCPT,EACRSTEL,EACRFAXN,EACRHAD1,EACRHAD3:
                                 EACRHAD4,EACRHPCD,EACRDTOB,EACRPAGR,EACRPAGN:
                                 EACRMOBN,EACRSPC1,EACRNHSN,EACRSTAT,EACRHSP0:
                                 EACRSTD0,EACREDD0,EACRPRV0,EACRHST0,EACRTYP0:
                                 EACREXP0,EACRACV0,EACRHSP1,EACRSTD1,EACREDD1:
                                 EACRPRV1,EACRHST1,EACRTYP1,EACREXP1,EACRACV1:
                                 EACRHSP2,EACRSTD2,EACREDD2,EACRPRV2,EACRHST2:
                                 EACRTYP2,EACREXP2,EACRACV2,EACRHSP3,EACRSTD3:
                                 EACREDD3,EACRPRV3,EACRHST3,EACRTYP3,EACREXP3:
                                 EACRACV3,EACRHSP4,EACRSTD4,EACREDD4,EACRPRV4:
                                 EACRHST4,EACRTYP4,EACREXP4,EACRACV4,EACRHSP5:
                                 EACRSTD5,EACREDD5,EACRPRV5,EACRHST5,EACRTYP5:
                                 EACREXP5,EACRACV5,EACRHSP6,EACRSTD6,EACREDD6:
                                 EACRPRV6,EACRHST6,EACRTYP6,EACREXP6,EACRACV6:
                                 EACRHSP7,EACRSTD7,EACREDD7,EACRPRV7,EACRHST7:
                                 EACRTYP7,EACREXP7,EACRACV7,EACRHSP8,EACRSTD8:
                                 EACREDD8,EACRPRV8,EACRHST8,EACRTYP8,EACREXP8:
                                 EACRACV8,EACRHSP9,EACRSTD9,EACREDD9,EACRPRV9:
                                 EACRHST9,EACRTYP9,EACREXP9,EACRACV9,EACRUNT0:
                                 EACRUNT1,EACRUNT2,EACRUNT3,EACRUNT4,EACRUNT5:
                                 EACRUNT6,EACRUNT7,EACRUNT8,EACRUNT9,EACRSPC2:
                                 EACRSPC3,EACRSPC4,EACRSPC5,EACRAMC1,EACRAMC2:
                                 EACRAMC3,EACRREGN
          GOTO      PROC2000
.
PROC1000  READ      EACRDTXT,SEQ;EACRHCPC,EACRTITL,EACRSNAM,EACRGNAM,EACRADD1:
                                 EACRADD2,EACRADD3,EACRADD4,EACRPOST,EACRSEML:
                                 EACRRCPT,EACRSTEL,EACRFAXN,EACRHAD1,EACRHAD3:
                                 EACRHAD4,EACRHPCD,EACRDTOB,EACRPAGR,EACRPAGN:
                                 EACRMOBN,EACRSPC1,EACRNHSN,EACRSTAT,EACRHSP0:
                                 EACRSTD0,EACREDD0,EACRPRV0,EACRHST0,EACRTYP0:
                                 EACREXP0,EACRACV0,EACRHSP1,EACRSTD1,EACREDD1:
                                 EACRPRV1,EACRHST1,EACRTYP1,EACREXP1,EACRACV1:
                                 EACRHSP2,EACRSTD2,EACREDD2,EACRPRV2,EACRHST2:
                                 EACRTYP2,EACREXP2,EACRACV2,EACRHSP3,EACRSTD3:
                                 EACREDD3,EACRPRV3,EACRHST3,EACRTYP3,EACREXP3:
                                 EACRACV3,EACRHSP4,EACRSTD4,EACREDD4,EACRPRV4:
                                 EACRHST4,EACRTYP4,EACREXP4,EACRACV4,EACRHSP5:
                                 EACRSTD5,EACREDD5,EACRPRV5,EACRHST5,EACRTYP5:
                                 EACREXP5,EACRACV5,EACRHSP6,EACRSTD6,EACREDD6:
                                 EACRPRV6,EACRHST6,EACRTYP6,EACREXP6,EACRACV6:
                                 EACRHSP7,EACRSTD7,EACREDD7,EACRPRV7,EACRHST7:
                                 EACRTYP7,EACREXP7,EACRACV7,EACRHSP8,EACRSTD8:
                                 EACREDD8,EACRPRV8,EACRHST8,EACRTYP8,EACREXP8:
                                 EACRACV8,EACRHSP9,EACRSTD9,EACREDD9,EACRPRV9:
                                 EACRHST9,EACRTYP9,EACREXP9,EACRACV9,EACRUNT0:
                                 EACRUNT1,EACRUNT2,EACRUNT3,EACRUNT4,EACRUNT5:
                                 EACRUNT6,EACRUNT7,EACRUNT8,EACRUNT9,EACRSPC2:
                                 EACRSPC3,EACRSPC4,EACRSPC5,EACRAMC1,EACRAMC2:
                                 EACRAMC3,EACRREGN,EACRPRFN,EACRGEND,EACRHTEL:
                                 EACRPFAX,EACRPEML,EACRABNN,EACRARFR,EACRARTO:
                                 EACRINSC,EACRINSP,EACRINFR,EACRINTO,EACRNOKC:
                                 EACRRADC,EACRWRKC,EACRPOLC,EACRSCPC,EACROTHC:
                                 EACRVEHC,EACRPRFC,EACRLEVL,EACRDFAC,EACRDLAC
.
.
PROC2000  GOTO      PROC9999 IF OVER
.
.         Make sure we haven't read in a blank line
.
          MOVE      ZERO,F2
          MOVELPTR  EACRHCPC,F2
          COMPARE   ZERO,F2
          GOTO      PROC0000 IF EQUAL       * Read next record
.
          MOVE      ZERO,UPLDSTAT           * Reset upload status value
          CALL      LCUC0000                * Ensure all fields are UCase
.
          CALL      VALI0000                * Validate Input Record
          BRANCH    EXIT,PROC9998
.
          CALL      VALIE000                * Validate Input for extended
          BRANCH    EXIT,PROC9998
.
          MOVE      "A",UPDTTYPE
.
          PACK      KEY6,EACRHCPC,SP70      * Check if Doctor exists
          CALL      RDDOCT1
          BRANCH    OVRCD,PROC5000
.
          MOVE      "U",UPDTTYPE
          GOTO      PROC5100
.                                                * New Doctor to be added
PROC5000  PACK      KEY10,EACRHCPC,SP70
          CALL      RDPMHCP1
          BRANCH    OVRCD,PROC5200
.                                                * HCP Code already exists
          PACK      ERRMESSG,EXCEP008,SP70
          CALL      PRIB0000                     * Print Upload Error Report
          GOTO      PROC9998
.
PROC5100  PACK      KEY10,EACRHCPC,SP70
          CALL      RDPMHCP1
.                                                * HCP Code does not exist
          IF        OVRCD=1
            PACK      ERRMESSG,EXCEP013,SP70
            CALL      PRIB0000                   * Print Upload Error Report
            GOTO      PROC9998
          ENDIF
.
PROC5200  MATCH     "1",PTCNUPEA                 * Update fields (not rewrite)
          IF        @EQUAL
            MATCH     "A",UPDTTYPE
            IF        @EQUAL
              PACK      PMHCHOSS,SP70              * Clears Hospital Flag
              PACK      PTDOHOSS,SP70              * Clears Hospital Flag
            ENDIF
            GOTO      PROC5300
          ENDIF
.
          CALL      CLPATDOC                     * Clear all Doctor fields
          CALL      CLPMSHCP                     * Clear all HCP fields
.
PROC5300  CALL      MVDR0000                     * Populate Doctor fields
          CALL      MVHC0000                     * Populate HCP Fields
.
          MATCH     "U",UPDTTYPE
          GOTO      PROC6000 IF EQUAL
.
          CALL      ADDR0000                     * Add New Doctor/HCP Details
          MOVE      ONE,UPLDSTAT
          GOTO      PROC9998
.
PROC6000  CALL      UPDR0000                     * Update Doctor/HCP Details
          MOVE      ONE,UPLDSTAT
.
PROC9998  ADD       ONE,TOTDOCTS
          MATCH     "1",PTCNEACF                 * Extended (SJGHC) format?
          IF        @EQUAL
            CALL      PRUPST00                   * Print HCP upload status info
          ENDIF
.
          GOTO      PROC0000                     * Read Next Dr eAccreditation
.
PROC9999  RETURN
+
.******************************************************************************
.*                                  LCUC0000             Called by : PROC0000 *
.*  Ensure all file fields are in Upper case                                  *
.******************************************************************************
LCUC0000  REP       UPPLOW,EACRPOST
          REP       UPPLOW,EACRSTEL
          REP       UPPLOW,EACRFAXN
          REP       UPPLOW,EACRHPCD
          REP       UPPLOW,EACRDTOB
          REP       UPPLOW,EACRPAGR
          REP       UPPLOW,EACRPAGN
          REP       UPPLOW,EACRMOBN
          REP       UPPLOW,EACRSPC1
          REP       UPPLOW,EACRNHSN
.         REP       UPPLOW,EACRHSP0
          REP       UPPLOW,EACRSTD0
          REP       UPPLOW,EACREDD0
          REP       UPPLOW,EACRPRV0
          REP       UPPLOW,EACRHST0
          REP       UPPLOW,EACRTYP0
          REP       UPPLOW,EACREXP0
          REP       UPPLOW,EACRACV0
.         REP       UPPLOW,EACRHSP1
          REP       UPPLOW,EACRSTD1
          REP       UPPLOW,EACREDD1
          REP       UPPLOW,EACRPRV1
          REP       UPPLOW,EACRHST1
          REP       UPPLOW,EACRTYP1
          REP       UPPLOW,EACREXP1
          REP       UPPLOW,EACRACV1
.         REP       UPPLOW,EACRHSP2
          REP       UPPLOW,EACRSTD2
          REP       UPPLOW,EACREDD2
          REP       UPPLOW,EACRPRV2
          REP       UPPLOW,EACRHST2
          REP       UPPLOW,EACRTYP2
          REP       UPPLOW,EACREXP2
          REP       UPPLOW,EACRACV2
.         REP       UPPLOW,EACRHSP3
          REP       UPPLOW,EACRSTD3
          REP       UPPLOW,EACREDD3
          REP       UPPLOW,EACRPRV3
          REP       UPPLOW,EACRHST3
          REP       UPPLOW,EACRTYP3
          REP       UPPLOW,EACREXP3
          REP       UPPLOW,EACRACV3
.         REP       UPPLOW,EACRHSP4
          REP       UPPLOW,EACRSTD4
          REP       UPPLOW,EACREDD4
          REP       UPPLOW,EACRPRV4
          REP       UPPLOW,EACRHST4
          REP       UPPLOW,EACRTYP4
          REP       UPPLOW,EACREXP4
          REP       UPPLOW,EACRACV4
.         REP       UPPLOW,EACRHSP5
          REP       UPPLOW,EACRSTD5
          REP       UPPLOW,EACREDD5
          REP       UPPLOW,EACRPRV5
          REP       UPPLOW,EACRHST5
          REP       UPPLOW,EACRTYP5
          REP       UPPLOW,EACREXP5
          REP       UPPLOW,EACRACV5
.         REP       UPPLOW,EACRHSP6
          REP       UPPLOW,EACRSTD6
          REP       UPPLOW,EACREDD6
          REP       UPPLOW,EACRPRV6
          REP       UPPLOW,EACRHST6
          REP       UPPLOW,EACRTYP6
          REP       UPPLOW,EACREXP6
          REP       UPPLOW,EACRACV6
.         REP       UPPLOW,EACRHSP7
          REP       UPPLOW,EACRSTD7
          REP       UPPLOW,EACREDD7
          REP       UPPLOW,EACRPRV7
          REP       UPPLOW,EACRHST7
          REP       UPPLOW,EACRTYP7
          REP       UPPLOW,EACREXP7
          REP       UPPLOW,EACRACV7
.         REP       UPPLOW,EACRHSP8
          REP       UPPLOW,EACRSTD8
          REP       UPPLOW,EACREDD8
          REP       UPPLOW,EACRPRV8
          REP       UPPLOW,EACRHST8
          REP       UPPLOW,EACRTYP8
          REP       UPPLOW,EACREXP8
          REP       UPPLOW,EACRACV8
.         REP       UPPLOW,EACRHSP9
          REP       UPPLOW,EACRSTD9
          REP       UPPLOW,EACREDD9
          REP       UPPLOW,EACRPRV9
          REP       UPPLOW,EACRHST9
          REP       UPPLOW,EACRTYP9
          REP       UPPLOW,EACREXP9
          REP       UPPLOW,EACRACV9
          REP       UPPLOW,EACRUNT0
          REP       UPPLOW,EACRUNT1
          REP       UPPLOW,EACRUNT2
          REP       UPPLOW,EACRUNT3
          REP       UPPLOW,EACRUNT4
          REP       UPPLOW,EACRUNT5
          REP       UPPLOW,EACRUNT6
          REP       UPPLOW,EACRUNT7
          REP       UPPLOW,EACRUNT8
          REP       UPPLOW,EACRUNT9
.
LCUC9999  RETURN
+
.******************************************************************************
.*                                  VALI0000             Called by : PROC0000 *
.*  Validate input fields                                                     *
.******************************************************************************
VALI0000  MOVE      ZERO,EXIT
.                                                * Validate Doctor Code
          MATCH     SP70,EACRHCPC
          GOTO      VALI9890 IF EQUAL
.
          CALL      CSPA0000                    * Check a space b/w Doctorcode
          BRANCH    EXIT,VALI9890
.                                                * Validate Doctor DOB
          MOVE      EACRDTOB,TEMPDATE
          CALL      VDTE0000
          BRANCH    EXIT,VALI9891
.                                                * Validate Doctor Status
VALI1000  REP       " 0",EACRSTAT
.
          TYPE      EACRSTAT
          GOTO      VALI9896 IF NOT EQUAL        * Status is not numeric
.
          MOVE      ZERO,FORM1                   * Valid Status = 0,1,2
          MOVE      EACRSTAT,FORM1
          COMPARE   FORM1,TWO
          GOTO      VALI9896 IF LESS
.                                                * Validate Specialities
          PACK      DIM2,CATUCDT
          PACK      DIM3,SP70
.
          MOVE      ZERO,LOOPCNTR
VALI1100  ADD       ONE,LOOPCNTR
          IF        LOOPCNTR > 5
            GOTO      VALI2000
          ENDIF
.
          BRANCH    LOOPCNTR,VALI1101,VALI1102,VALI1103,VALI1104,VALI1105
          GOTO      VALI2000
.
VALI1101  PACK      DIM3,EACRSPC1,SP70
          GOTO      VALI1199
.
VALI1102  PACK      DIM3,EACRSPC2,SP70
          GOTO      VALI1199
.
VALI1103  PACK      DIM3,EACRSPC3,SP70
          GOTO      VALI1199
.
VALI1104  PACK      DIM3,EACRSPC4,SP70
          GOTO      VALI1199
.
VALI1105  PACK      DIM3,EACRSPC5,SP70
          GOTO      VALI1199
.
VALI1199  MATCH     DIM3,SP70
          GOTO      VALI2000 IF EQUAL
.
          PACK      KEY5,DIM2,DIM3
          CALL      RDCODE1
          BRANCH    OVRCD,VALI9895
.                                                * Validate Category is active
          MATCH     SP70,PTCOACTV
          IF        !@EQUAL
            MATCH     "A",PTCOACTV
            IF        !@EQUAL
              GOTO      VALI9895
            ENDIF
          ENDIF
.
          GOTO      VALI1100
.                                                * Validate Hospital Group
VALI2000  PACK      DIM3,SP70
.
          MATCH     EACRHSP0,SP70                * at least one record please
          GOTO      VALI9897 IF EQUAL
.
          MOVE      ZERO,LOOPCNTR
.
VALI2100  ADD       ONE,LOOPCNTR
          IF        LOOPCNTR > 10
            GOTO      VALI3000                   * End of Group
          ENDIF
.                                                * Validate Hospital Code
          BRANCH    LOOPCNTR,VALI2101,VALI2102,VALI2103,VALI2104,VALI2105:
                             VALI2106,VALI2107,VALI2108,VALI2109,VALI2110
. 
VALI2101  PACK      DIM3,EACRHSP0,SP70
          GOTO      VALI2199
. 
VALI2102  PACK      DIM3,EACRHSP1,SP70
          GOTO      VALI2199
. 
VALI2103  PACK      DIM3,EACRHSP2,SP70
          GOTO      VALI2199
. 
VALI2104  PACK      DIM3,EACRHSP3,SP70
          GOTO      VALI2199
. 
VALI2105  PACK      DIM3,EACRHSP4,SP70
          GOTO      VALI2199
. 
VALI2106  PACK      DIM3,EACRHSP5,SP70
          GOTO      VALI2199
. 
VALI2107  PACK      DIM3,EACRHSP6,SP70
          GOTO      VALI2199
. 
VALI2108  PACK      DIM3,EACRHSP7,SP70
          GOTO      VALI2199
. 
VALI2109  PACK      DIM3,EACRHSP8,SP70
          GOTO      VALI2199
. 
VALI2110  PACK      DIM3,EACRHSP9,SP70
          GOTO      VALI2199
.
VALI2199  MATCH     DIM3,SP70
          GOTO      VALI3000 IF EQUAL            * End of Group
.
          PACK      KEY3,DIM3,SP70
          CALL      RDPTHSP1
          BRANCH    OVRCD,VALI9897
.                                                * Validate Doctor Start Date
VALI2200  BRANCH    LOOPCNTR,VALI2201,VALI2202,VALI2203,VALI2204,VALI2205:
                             VALI2206,VALI2207,VALI2208,VALI2209,VALI2210
. 
VALI2201  PACK      TEMPDATE,EACRSTD0,SP70
          GOTO      VALI2299
. 
VALI2202  PACK      TEMPDATE,EACRSTD1,SP70
          GOTO      VALI2299
. 
VALI2203  PACK      TEMPDATE,EACRSTD2,SP70
          GOTO      VALI2299
. 
VALI2204  PACK      TEMPDATE,EACRSTD3,SP70
          GOTO      VALI2299
. 
VALI2205  PACK      TEMPDATE,EACRSTD4,SP70
          GOTO      VALI2299
. 
VALI2206  PACK      TEMPDATE,EACRSTD5,SP70
          GOTO      VALI2299
. 
VALI2207  PACK      TEMPDATE,EACRSTD6,SP70
          GOTO      VALI2299
. 
VALI2208  PACK      TEMPDATE,EACRSTD7,SP70
          GOTO      VALI2299
. 
VALI2209  PACK      TEMPDATE,EACRSTD8,SP70
          GOTO      VALI2299
. 
VALI2210  PACK      TEMPDATE,EACRSTD9,SP70
          GOTO      VALI2299
.
VALI2299  MATCH     TEMPDATE,SP70
          GOTO      VALI9892 IF EQUAL
.
          CALL      VDTE0000
          BRANCH    EXIT,VALI9892
.                                                * Validate Doctor End Date
VALI2300  BRANCH    LOOPCNTR,VALI2301,VALI2302,VALI2303,VALI2304,VALI2305:
                             VALI2306,VALI2307,VALI2308,VALI2309,VALI2310
. 
VALI2301  PACK      TEMPDATE,EACREDD0,SP70
          GOTO      VALI2399
. 
VALI2302  PACK      TEMPDATE,EACREDD1,SP70
          GOTO      VALI2399
. 
VALI2303  PACK      TEMPDATE,EACREDD2,SP70
          GOTO      VALI2399
. 
VALI2304  PACK      TEMPDATE,EACREDD3,SP70
          GOTO      VALI2399
. 
VALI2305  PACK      TEMPDATE,EACREDD4,SP70
          GOTO      VALI2399
. 
VALI2306  PACK      TEMPDATE,EACREDD5,SP70
          GOTO      VALI2399
. 
VALI2307  PACK      TEMPDATE,EACREDD6,SP70
          GOTO      VALI2399
. 
VALI2308  PACK      TEMPDATE,EACREDD7,SP70
          GOTO      VALI2399
. 
VALI2309  PACK      TEMPDATE,EACREDD8,SP70
          GOTO      VALI2399
. 
VALI2310  PACK      TEMPDATE,EACREDD9,SP70
          GOTO      VALI2399
.
VALI2399  MATCH     TEMPDATE,SP70
          GOTO      VALI2400 IF EQUAL
.
          CALL      VDTE0000
          BRANCH    EXIT,VALI9893
.                                                * Validate Doctor Acc Expire Dt
VALI2400  BRANCH    LOOPCNTR,VALI2401,VALI2402,VALI2403,VALI2404,VALI2405:
                             VALI2406,VALI2407,VALI2408,VALI2409,VALI2410
. 
VALI2401  PACK      TEMPDATE,EACREXP0,SP70
          GOTO      VALI2499
. 
VALI2402  PACK      TEMPDATE,EACREXP1,SP70
          GOTO      VALI2499
. 
VALI2403  PACK      TEMPDATE,EACREXP2,SP70
          GOTO      VALI2499
. 
VALI2404  PACK      TEMPDATE,EACREXP3,SP70
          GOTO      VALI2499
. 
VALI2405  PACK      TEMPDATE,EACREXP4,SP70
          GOTO      VALI2499
. 
VALI2406  PACK      TEMPDATE,EACREXP5,SP70
          GOTO      VALI2499
. 
VALI2407  PACK      TEMPDATE,EACREXP6,SP70
          GOTO      VALI2499
. 
VALI2408  PACK      TEMPDATE,EACREXP7,SP70
          GOTO      VALI2499
. 
VALI2409  PACK      TEMPDATE,EACREXP8,SP70
          GOTO      VALI2499
. 
VALI2410  PACK      TEMPDATE,EACREXP9,SP70
          GOTO      VALI2499
.
VALI2499  MATCH     TEMPDATE,SP70
          GOTO      VALI9894 IF EQUAL
.
          CALL      VDTE0000
          BRANCH    EXIT,VALI9894
.                                                * Validate Accreditation Type
VALI2500  BRANCH    LOOPCNTR,VALI2501,VALI2502,VALI2503,VALI2504,VALI2505:
                             VALI2506,VALI2507,VALI2508,VALI2509,VALI2510
. 
VALI2501  PACK      DIM3,EACRTYP0,SP70
          GOTO      VALI2599
. 
VALI2502  PACK      DIM3,EACRTYP1,SP70
          GOTO      VALI2599
. 
VALI2503  PACK      DIM3,EACRTYP2,SP70
          GOTO      VALI2599
. 
VALI2504  PACK      DIM3,EACRTYP3,SP70
          GOTO      VALI2599
. 
VALI2505  PACK      DIM3,EACRTYP4,SP70
          GOTO      VALI2599
. 
VALI2506  PACK      DIM3,EACRTYP5,SP70
          GOTO      VALI2599
. 
VALI2507  PACK      DIM3,EACRTYP6,SP70
          GOTO      VALI2599
. 
VALI2508  PACK      DIM3,EACRTYP7,SP70
          GOTO      VALI2599
. 
VALI2509  PACK      DIM3,EACRTYP8,SP70
          GOTO      VALI2599
. 
VALI2510  PACK      DIM3,EACRTYP9,SP70
          GOTO      VALI2599
.
VALI2599  MATCH     DIM3,SP70
          GOTO      VALI2600 IF EQUAL
.
          PACK      DIM2,CATUCAT
          PACK      KEY5,DIM2,DIM3
          CALL      RDCODE1
          BRANCH    OVRCD,VALI9895
.                                                * Validate Category is active
          MATCH     SP70,PTCOACTV
          IF        !@EQUAL
            MATCH     "A",PTCOACTV
            IF        !@EQUAL
              GOTO      VALI9895
            ENDIF
          ENDIF
.                                                * Validate HCP Status
VALI2600  BRANCH    LOOPCNTR,VALI2601,VALI2602,VALI2603,VALI2604,VALI2605:
                             VALI2606,VALI2607,VALI2608,VALI2609,VALI2610
. 
VALI2601  PACK      DIM2,EACRHST0,SP70
          GOTO      VALI2699
. 
VALI2602  PACK      DIM2,EACRHST1,SP70
          GOTO      VALI2699
. 
VALI2603  PACK      DIM2,EACRHST2,SP70
          GOTO      VALI2699
. 
VALI2604  PACK      DIM2,EACRHST3,SP70
          GOTO      VALI2699
. 
VALI2605  PACK      DIM2,EACRHST4,SP70
          GOTO      VALI2699
. 
VALI2606  PACK      DIM2,EACRHST5,SP70
          GOTO      VALI2699
. 
VALI2607  PACK      DIM2,EACRHST6,SP70
          GOTO      VALI2699
. 
VALI2608  PACK      DIM2,EACRHST7,SP70
          GOTO      VALI2699
. 
VALI2609  PACK      DIM2,EACRHST8,SP70
          GOTO      VALI2699
. 
VALI2610  PACK      DIM2,EACRHST9,SP70
          GOTO      VALI2699
.
VALI2699  MATCH     SP70,DIM2
          GOTO      VALI9898 IF EQUAL
.
          RJUSTIFY  DIM2
          REP       " 0",DIM2
.
          TYPE      DIM2                    * Numeric?
          GOTO      VALI9898 IF NOT EQUAL
.
          MOVE      ZERO,FORM2
          MOVE      DIM2,FORM2
.
.         Valid Status = 0 thru 10
.
          COMPARE   ZERO,FORM2
          GOTO      VALI9898 IF LESS
.
          COMPARE   FORM2,TEN
          GOTO      VALI9898 IF LESS
.
          GOTO      VALI2100
.                                           * Validate Doctor Unit Group
VALI3000  PACK      DIM2,CATUCAC
          PACK      DIM3,SP70
          MATCH     EACRUNT0,SP70
          GOTO      VALI9895 IF EQUAL       * at least one record please
.
          MOVE      ZERO,LOOPCNTR
VALI3100  ADD       ONE,LOOPCNTR
          IF        LOOPCNTR > 10
            GOTO      VALI4000              * End of group
          ENDIF
.
          BRANCH    LOOPCNTR,VALI3101,VALI3102,VALI3103,VALI3104,VALI3105:
                             VALI3106,VALI3107,VALI3108,VALI3109,VALI3110
. 
VALI3101  PACK      DIM3,EACRUNT0,SP70
          GOTO      VALI3199
. 
VALI3102  PACK      DIM3,EACRUNT1,SP70
          GOTO      VALI3199
. 
VALI3103  PACK      DIM3,EACRUNT2,SP70
          GOTO      VALI3199
. 
VALI3104  PACK      DIM3,EACRUNT3,SP70
          GOTO      VALI3199
. 
VALI3105  PACK      DIM3,EACRUNT4,SP70
          GOTO      VALI3199
. 
VALI3106  PACK      DIM3,EACRUNT5,SP70
          GOTO      VALI3199
. 
VALI3107  PACK      DIM3,EACRUNT6,SP70
          GOTO      VALI3199
. 
VALI3108  PACK      DIM3,EACRUNT7,SP70
          GOTO      VALI3199
. 
VALI3109  PACK      DIM3,EACRUNT8,SP70
          GOTO      VALI3199
. 
VALI3110  PACK      DIM3,EACRUNT9,SP70
          GOTO      VALI3199
.
VALI3199  MATCH     DIM3,SP70
          GOTO      VALI4000 IF EQUAL            * End of group
.
          PACK      DIM2,CATUCAC
          PACK      KEY5,DIM2,DIM3
          CALL      RDCODE1
          BRANCH    OVRCD,VALI9895
.                                                * Validate Category is active
          MATCH     SP70,PTCOACTV
          IF        !@EQUAL
            MATCH     "A",PTCOACTV
            IF        !@EQUAL
              GOTO      VALI9895
            ENDIF
          ENDIF
.
          GOTO      VALI3100
.
.         Validate AH Preferred Method of Contact (Cat CZ) codes 1-3
.
VALI4000  PACK      DIM2,CATUCCZ
          PACK      DIM3,SP70
.
          MOVE      ZERO,LOOPCNTR
VALI4100  ADD       ONE,LOOPCNTR
          IF        LOOPCNTR > 3
            GOTO      VALI5000                   * End of CZ codes
          ENDIF
.
          BRANCH    LOOPCNTR,VALI4101,VALI4102,VALI4103
          GOTO      VALI5000
.
VALI4101  PACK      DIM3,EACRAMC1,SP70
          GOTO      VALI4199
.
VALI4102  PACK      DIM3,EACRAMC2,SP70
          GOTO      VALI4199
.
VALI4103  PACK      DIM3,EACRAMC3,SP70
          GOTO      VALI4199
.
VALI4199  MATCH     DIM3,SP70
          GOTO      VALI5000 IF EQUAL
.
          PACK      KEY5,DIM2,DIM3
          CALL      RDCODE1
          BRANCH    OVRCD,VALI9895               * Invalid code
.
          MATCH     SP70,PTCOACTV
          IF        !@EQUAL
            MATCH     "A",PTCOACTV
            IF        !@EQUAL
              GOTO      VALI9895                 * Not active
            ENDIF
          ENDIF
.
          GOTO      VALI4100
.
.
.         Validate Gender Code (M,F,I,U)
.
VALI5000  MATCH     "1",PTCNEACF            * Extended (SJGHC) format?
          GOTO      VALI9998 IF NOT EQUAL
.
          MOVE      EACRGEND,DIM1
          MOVE      "MFIU",TEMPVAR
          REP       " _",TEMPVAR
          SCAN      EACRGEND,TEMPVAR
          GOTO      VALI9899 IF NOT EQUAL
.
.
.         Validate Insurance Code
.
          MOVE      EACRINSC,D6
          PACK      KEY6,EACRINSC,SP70
          CALL      RDINSR1
          BRANCH    OVRCD,VALI9901
.
          MATCH     "1",PTINACTV       * Inactive?
          GOTO      VALI9901 IF EQUAL
.
VALI6000  PACK      KEY5,CATUCCZ,EACRPRFC,SP70
          CALL      RDCODE1
          BRANCH    OVRCD,VALI9902
.
          PACK      KEY5,CATUCDL,EACRLEVL,SP70
          CALL      RDCODE1
          BRANCH    OVRCD,VALI9903
.
          GOTO      VALI9998
.
VALI9890  MOVE      "Doctor Code may not be spaces",ERRMESSG
          GOTO      VALI9996
.
VALI9891  PACK      ERRMESSG,EXCEP012,TEMPDATE,SP70
          GOTO      VALI9996
.
VALI9892  PACK      ERRMESSG,EXCEP009,TEMPDATE,SP70
          GOTO      VALI9996
.
VALI9893  PACK      ERRMESSG,EXCEP010,TEMPDATE,SP70
          GOTO      VALI9996
.
VALI9894  PACK      ERRMESSG,EXCEP011,TEMPDATE,SP70
          GOTO      VALI9996
.
VALI9895  PACK      ERRMESSG,EXCEP001,DIM2,EXCEP002,DIM3,EXCEP003,SP70
          GOTO      VALI9996
.
VALI9896  PACK      ERRMESSG,EXCEP006,EXCEP005,SP70
          GOTO      VALI9996
.
VALI9897  PACK      ERRMESSG,EXCEP004,DIM3,EXCEP005,SP70
          GOTO      VALI9996
.
VALI9898  PACK      ERRMESSG,EXCEP007,EXCEP005,SP70
          GOTO      VALI9996
.
VALI9899  PACK      ERRMESSG,EXCEP014,DIM1,EXCEP005,SP70
          GOTO      VALI9996
.
VALI9901  PACK      ERRMESSG,EXCEP015,D6,EXCEP003,SP70
          GOTO      VALI9996
.
VALI9902  PACK      ERRMESSG,EXCEP016,SP70
          GOTO      VALI9996
.
VALI9903  PACK      ERRMESSG,EXCEP017,SP70
          GOTO      VALI9996
.
VALI9996  CALL      PRIB0000
          MOVE      ONE,EXIT
          GOTO      VALI9999
.
VALI9998  MOVE      ZERO,EXIT
.
VALI9999  RETURN
+
.******************************************************************************
.*                                  CSPA0000                                  *
.*  Check for spaces in doctor - spaces are not permitted in between code     *
.******************************************************************************
CSPA0000  MOVE      ZERO,EXIT
          PACK      KEY10,EACRHCPC,SP70
.
          SCAN      SP1,KEY10
          GOTO      CSPA9999 IF NOT EQUAL
.
CSPA1000  BUMP      KEY10,1
          GOTO      CSPA9999 IF EOS
.
          CMATCH    SP1,KEY10
          GOTO      CSPA1000 IF EQUAL
.
CSPA9000  MOVE      ONE,EXIT
CSPA9999  RETURN
+
.******************************************************************************
.*                                  VALIE000             Called by : PROC0000 *
.*  Validate input fields                                                     *
.******************************************************************************
VALIE000  MOVE      ZERO,EXIT
          MATCH     "1",PTCNEACF       * Extended (SJGHC) format?
          GOTO      VALIE999 IF NOT EQUAL
.
          PACK      EACRDFAC,EACRDFAC,SP70
          PACK      EACRDLAC,EACRDLAC,SP70
.
          MATCH     SP70,EACRDFAC
          GOTO      VALIE200 IF EQUAL
.
          MOVE      EACRDFAC,TEMPDATE
          CALL      VDTE0000
          IF        EXIT = 1
            PACK      ERRMESSG,EXCEP019,TEMPDATE,SP70
            GOTO      VALIE996
          ENDIF
.
VALIE200  MATCH     SP70,EACRDLAC
          GOTO      VALIE999 IF EQUAL
.
          MOVE      EACRDLAC,TEMPDATE
          CALL      VDTE0000
          IF        EXIT = 1
            PACK      ERRMESSG,EXCEP020,TEMPDATE,SP70
            GOTO      VALIE996
          ENDIF
.
VALIE300  MATCH     SP70,EACRDFAC
          GOTO      VALIE999 IF EQUAL
.
          MOVE      EACRDFAC,DATEFROM
          MOVE      EACRDLAC,DATETO
          IF        DATEFROM > DATETO
            PACK      ERRMESSG,EXCEP018,SP70
            GOTO      VALIE996
          ENDIF
.
          GOTO      VALIE9999
.
VALIE991  PACK      ERRMESSG,EXCEP012,TEMPDATE,SP70
          GOTO      VALIE996
.
VALIE996  CALL      PRIB0000
          MOVE      ONE,EXIT
          GOTO      VALIE999
.
VALIE999  RETURN
.
.******************************************************************************
.*                                  MVDR0000             Called by : PROC0000 *
.*  Populate Doctor File variables with values from Input file                *
.******************************************************************************
MVDR0000  PACK      DCODE,EACRHCPC,SP70          * Doctor Code
          PACK      DTITL,EACRTITL,SP70          * Title
          PACK      DSNAME,EACRSNAM,SP70         * Surname
          PACK      DGNAME,EACRGNAM,SP70         * Given Names
          PACK      DSADD1,EACRADD1,SP70         * Surgery Address 1
          PACK      DSADD2,EACRADD2,SP70         * Surgery Address 2
          PACK      DSADD3,EACRADD3,SP70         * Surgery Suburb
          PACK      DSADD4,EACRADD4,SP70         * Surgery State
          PACK      DSPOST,EACRPOST,SP70         * Surgery Post Code
          PACK      PTDOSEML,EACRSEML,SP70       * Surgery Email
          PACK      DRNAME,EACRRCPT,SP70         * Receptionist
          PACK      DTELES,EACRSTEL,SP70         * Telephone
          PACK      PTDOFAXN,EACRFAXN,SP70       * Fax
          PACK      DHADD1,EACRHAD1,SP70         * Home Address
          PACK      DHADD3,EACRHAD3,SP70         * Home Suburb
          PACK      DHADD4,EACRHAD4,SP70         * Home State
          PACK      DHPOST,EACRHPCD,SP70         * Home Post Code
          PACK      DBIRTH,EACRDTOB,SP70         * Date of Birth
          PACK      DTELEP,EACRPAGR,SP70         * Pager Phone Number
          PACK      DPAGER,EACRPAGN,SP70         * Pager Number
          PACK      PTDOMOBL,EACRMOBN,SP70       * Mobile Number
          PACK      DRTYPE,EACRSPC1,SP70         * Primary Speciality
          PACK      PTDONHSN,EACRNHSN,SP70       * Prescriber Number
          MOVE      EACRSTAT,DRSTAT              * Status
          PACK      PTDOSDAT,EACRSTD0,SP70       * Start Date
          PACK      PTDOEDAT,EACREDD0,SP70       * End Date
          PACK      DPROV,EACRPRV0,SP70          * Provider Number
          PACK      DACCRED,EACRTYP0,SP70        * Accreditation Type
          PACK      PTDODEAC,EACREXP0,SP70       * Accreditation Expiry
          PACK      DRTYPE2,EACRSPC2,SP70        * 2nd Speciality
          PACK      DRTYPE3,EACRSPC3,SP70        * 3rd Speciality
          PACK      DRTYPE4,EACRSPC4,SP70        * 4th Speciality
          PACK      DRTYPE5,EACRSPC5,SP70        * 5th Speciality
          PACK      PTDOAHC1,EACRAMC1,SP70       * AH Pref Cont Method 1(Cat CZ)
          PACK      PTDOAHC2,EACRAMC2,SP70       * AH Pref Cont Method 2(Cat CZ)
          PACK      PTDOAHC3,EACRAMC3,SP70       * AH Pref Cont Method 3(Cat CZ)
          PACK      PTDOREGN,EACRREGN,SP70       * Registration Number
.
.         Extended Format (SJGHC) fields...
.
          MATCH     "1",PTCNEACF  * Extended (SJGHC) format?
          IF        @EQUAL
            PACK      PTDOPREF,EACRPRFN,SP70     * Preferred Name
            PACK      DTELEH,EACRHTEL,SP70       * HCP Home Telephone
            PACK      PTDOHFAX,EACRPFAX,SP70     * HCP Personal Fax
            PACK      PTDOHEML,EACRPEML,SP70     * HCP Personal Email
            PACK      PTDOABNN,EACRABNN,SP70     * HCP ABN
            PACK      PTDOREGF,EACRARFR,SP70    * AHPRA Number Registration From
            PACK      PTDOREGT,EACRARTO,SP70    * AHPRA Number Registration To
            PACK      PTDOINSC,EACRINSC,SP70     * Insurance Code
            PACK      PTDOINSN,EACRINSP,SP70     * Insurance Policy Number
            PACK      PTDOINSF,EACRINFR,SP70     * Insurance Date From
            PACK      PTDOINST,EACRINTO,SP70     * Insurance Date To
            PACK      DALEVEL,EACRLEVL,SP70      * Supervision Level
          ENDIF
.
MVDR9999  RETURN
+
.******************************************************************************
.*                                  MVHC0000             Called by : PROC0000 *
.*  Populate HCP File variables with values from Input file                   *
.******************************************************************************
MVHC0000  PACK      PMHCHCPC,EACRHCPC,SP70       * HCP Code
          PACK      PMHCTITL,EACRTITL,SP70       * Title
          PACK      PMHCSNAM,EACRSNAM,SP70       * Surname
          PACK      PMHCGNAM,EACRGNAM,SP70       * Given Name
          PACK      PMHCADR1,EACRADD1,SP70       * Surgery Address 1
          PACK      PMHCADR2,EACRADD2,SP70       * Surgery Address 2
          PACK      PMHCADR3,EACRADD3,SP70       * Surgery Suburb
          PACK      PMHCADR4,EACRADD4,SP70       * Surgery State
          PACK      PMHCPOST,EACRPOST,SP70       * Post Code
          PACK      PMHCSEML,EACRSEML,SP70       * Surgery Email
          PACK      PMHCRCPT,EACRRCPT,SP70       * Receptionist
          PACK      PMHCSTEL,EACRSTEL,SP70       * Telephone
          PACK      PMHCFAXN,EACRFAXN,SP70       * Fax
          PACK      PMHCHAD1,EACRHAD1,SP70       * Home Address
          PACK      PMHCHAD3,EACRHAD3,SP70       * Home Suburb
          PACK      PMHCHAD4,EACRHAD4,SP70       * Home State
          PACK      PMHCHPCD,EACRHPCD,SP70       * Home Postcode
          PACK      PMHCDTOB,EACRDTOB,SP70       * Date of Birth
          PACK      PMHCPAGR,EACRPAGR,SP70       * Pager Phone Number
          PACK      PMHCPAGN,EACRPAGN,SP70       * Pager Number
          PACK      PMHCMOBN,EACRMOBN,SP70       * Mobile Number
          PACK      PMHCSPC1,EACRSPC1,SP70       * Primary Speciality
          PACK      PMHCNHSN,EACRNHSN,SP70       * Prescriber Number
          PACK      PMHCLDOC,EACRHCPC,SP70       * Local Doctor Code
          COMPARE   ZERO,DRSTAT
          IF        @EQUAL
            MOVE      ZERO,PMHCSTTS              * Doctor Status
          ENDIF
.
          COMPARE   ONE,DRSTAT
          IF        @EQUAL
            MOVE      ONE,PMHCSTTS               * Doctor Status
          ENDIF
.
          COMPARE   TWO,DRSTAT
          IF        @EQUAL
            MOVE      ZERO,PMHCSTTS              * Doctor Status
          ENDIF
          PACK      PMHCPRV1,EACRPRV0,SP70       * Provider number
          RJUSTIFY  EACRHST0
          REP       " 0",EACRHST0
          MOVE      ZERO,FORM2
          MOVE      EACRHST0,FORM2
          MOVE      FORM2,PMHCHCST               * HCP Status
          PACK      PMHCATYP,EACRTYP0,SP70       * Accreditation Type
          PACK      PMHCDEAC,EACREXP0,SP70       * Accreditation Expiry
          PACK      PMHCSDAT,EACRSTD0,SP70       * Start Date
          PACK      PMHCEDAT,EACREDD0,SP70       * End Date
          PACK      PMHCSPC2,EACRSPC2,SP70       * 2nd Speciality
          PACK      PMHCSPC3,EACRSPC3,SP70       * 3rd Speciality
          PACK      PMHCSPC4,EACRSPC4,SP70       * 4th Speciality
          PACK      PMHCSPC5,EACRSPC5,SP70       * 5th Speciality
          PACK      PMHCAHC1,EACRAMC1,SP70       * AH Pref Cont Method 1(Cat CZ)
          PACK      PMHCAHC2,EACRAMC2,SP70       * AH Pref Cont Method 2(Cat CZ)
          PACK      PMHCAHC3,EACRAMC3,SP70       * AH Pref Cont Method 3(Cat CZ)
          PACK      PMHCMPGN,EACRREGN,SP70       * Registration Number
.
.         Extended Format (SJGHC) fields...
.
          MATCH     "1",PTCNEACF  * Extended (SJGHC) format?
          IF        @EQUAL
            PACK      PMHCPRFN,EACRPRFN,SP70     * Preferred Name     
            PACK      PMHCGNDR,EACRGEND,SP70     * Gender
            PACK      PMHCHTEL,EACRHTEL,SP70     * HCP Home Telephone
            PACK      PMHCHFXN,EACRPFAX,SP70     * HCP Personal Fax
            PACK      PMHCHEML,EACRPEML,SP70     * HCP Personal Email
            PACK      PMHCABNN,EACRABNN,SP70     * HCP ABN
            PACK      PMHCRGDF,EACRARFR,SP70     * AHPRA Number Registration From
            PACK      PMHCRGDT,EACRARTO,SP70     * AHPRA Number Registration To
            PACK      PMHCINSC,EACRINSC,SP70     * Insurance Code
            PACK      PMHCIPLN,EACRINSP,SP70     * Insurance Policy Number
            PACK      PMHCIDTF,EACRINFR,SP70     * Insurance Date From
            PACK      PMHCIDTT,EACRINTO,SP70     * Insurance Date To
            PACK      PMHCPRFC,EACRPRFC,SP70     * HPC Preferred Contact Method
            PACK      PMHCOSLV,EACRLEVL,SP70     * Supervision Level
            PACK      PMHCDFAC,EACRDFAC,SP70     * First Accreditation Date
            PACK      PMHCDLAC,EACRDLAC,SP70     * Last Accreditation Date
          ENDIF
.
MVHC9999  RETURN
+
.******************************************************************************
.*                                  ADDR0000             Called by : PROC0000 *
.*  Load new Doctor eAccreditation details into webPAS                        *
.******************************************************************************
ADDR0000  MOVE      ZERO,EXIT
.                                                * Create Doctor Details File
          MOVE      TODAY,DLUPDDTE
          MOVE      UPDTTIME,DLUPDTME
.
          PACK      KEY6,DCODE
          CALL      WRDOCT1
          CALL      DSCR0000                     * Create blank patdstat records
          PROC      PATDKIUP                     * Updates keyword index
.                                                * Create HCP Details File
          MOVE      TODAY,PMHCCDTE
          MOVE      UPDTTIME,PMHCCTIM
          MOVE      USERID,PMHCWEBC
.
          PACK      KEY10,PMHCHCPC,SP70
          CALL      WRPMHCP1
          PROC      PMSHKIUP                     * Updates keyword index
.                                                * Create Doctor/Unit File
          MOVE      ZERO,LOOPCNTR
ADDR1000  ADD       ONE,LOOPCNTR
          IF        LOOPCNTR > 10
            GOTO      ADDR2000                   * End of Group
          ENDIF
.
          BRANCH    LOOPCNTR,ADDR1001,ADDR1002,ADDR1003,ADDR1004,ADDR1005:
                             ADDR1006,ADDR1007,ADDR1008,ADDR1009,ADDR1010
. 
ADDR1001  PACK      DIM3,EACRUNT0,SP70
          GOTO      ADDR1099
. 
ADDR1002  PACK      DIM3,EACRUNT1,SP70
          GOTO      ADDR1099
. 
ADDR1003  PACK      DIM3,EACRUNT2,SP70
          GOTO      ADDR1099
. 
ADDR1004  PACK      DIM3,EACRUNT3,SP70
          GOTO      ADDR1099
. 
ADDR1005  PACK      DIM3,EACRUNT4,SP70
          GOTO      ADDR1099
. 
ADDR1006  PACK      DIM3,EACRUNT5,SP70
          GOTO      ADDR1099
. 
ADDR1007  PACK      DIM3,EACRUNT6,SP70
          GOTO      ADDR1099
. 
ADDR1008  PACK      DIM3,EACRUNT7,SP70
          GOTO      ADDR1099
. 
ADDR1009  PACK      DIM3,EACRUNT8,SP70
          GOTO      ADDR1099
. 
ADDR1010  PACK      DIM3,EACRUNT9,SP70
          GOTO      ADDR1099
.
ADDR1099  MATCH     DIM3,SP70
          GOTO      ADDR2000 IF EQUAL            * End of Group
.
          PACK      PMDUDOCT,EACRHCPC,SP70
          PACK      PMDUUNIT,DIM3,SP70
          PACK      PMDUHEAD,SP70
          PACK      PMDUSPAR,SP70
.
          PACK      KEY9,PMDUDOCT,PMDUUNIT,SP70
          CALL      RAPMDUN1
          COMPARE   ZERO,OVRCD
          GOTO      ADDR1000 IF EQUAL            * already exist
.
          CALL      WRPMDUN1
.
          GOTO      ADDR1000
.                                                * Create Multi Hosp HCP Codes
ADDR2000  MOVE      ZERO,LOOPCNTR
ADDR2100  ADD       ONE,LOOPCNTR
          IF        LOOPCNTR > 10
            GOTO      ADDR3000                   * End of Group
          ENDIF
.
          BRANCH    LOOPCNTR,ADDR2101,ADDR2102,ADDR2103,ADDR2104,ADDR2105:
                             ADDR2106,ADDR2107,ADDR2108,ADDR2109,ADDR2110
. 
ADDR2101  PACK      DIM3,EACRHSP0,SP70
          GOTO      ADDR2199
. 
ADDR2102  PACK      DIM3,EACRHSP1,SP70
          GOTO      ADDR2199
. 
ADDR2103  PACK      DIM3,EACRHSP2,SP70
          GOTO      ADDR2199
. 
ADDR2104  PACK      DIM3,EACRHSP3,SP70
          GOTO      ADDR2199
. 
ADDR2105  PACK      DIM3,EACRHSP4,SP70
          GOTO      ADDR2199
. 
ADDR2106  PACK      DIM3,EACRHSP5,SP70
          GOTO      ADDR2199
. 
ADDR2107  PACK      DIM3,EACRHSP6,SP70
          GOTO      ADDR2199
. 
ADDR2108  PACK      DIM3,EACRHSP7,SP70
          GOTO      ADDR2199
. 
ADDR2109  PACK      DIM3,EACRHSP8,SP70
          GOTO      ADDR2199
. 
ADDR2110  PACK      DIM3,EACRHSP9,SP70
          GOTO      ADDR2199
.
ADDR2199  MATCH     DIM3,SP70
          GOTO      ADDR3000 IF EQUAL            * End of Group
.
          PACK      KEY13,DIM3,EACRHCPC,SP70
          CALL      RDMLHCP1
          IF        OVRCD = 1
            PACK      MLHCHOSP,DIM3,SP70
            PACK      MLHCHCPC,EACRHCPC,SP70
            PACK      MLHCSDAT,EACRSTD0,SP70
            PACK      MLHCEDAT,EACREDD0,SP70
            PACK      MLHCHSRI,SP70
            PACK      MLHCSPAR,SP70
            CALL      WRMLHCP1
.
            PACK      KEY10,EACRHCPC,SP70
            CALL      RDPMHCP1
            IF        OVRCD=0
              MOVE      "1",PMHCHOSS
.
              CALL      UPPMHCP1
            ENDIF
.
            PACK      KEY6,EACRHCPC,SP70
            CALL      RDDOCT1
            IF        OVRCD=0
              MOVE      "1",PTDOHOSS
.
              CALL      UPDOCT1
            ENDIF
.
          ENDIF
.
          GOTO      ADDR2100
.
.
.         Process HCP Comments...
.
ADDR3000  MATCH     "1",PTCNEACF       * Extended (SJGHC) format?
          GOTO      ADDR9000 IF NOT EQUAL
.
          MOVE      ZERO,LOOPCNTR
ADDR3100  ADD       ONE,LOOPCNTR
          IF        LOOPCNTR > 7
            GOTO      ADDR9000
          ENDIF
.
          BRANCH    LOOPCNTR,ADDR3101,ADDR3102,ADDR3103,ADDR3104,ADDR3105:
                             ADDR3106,ADDR3107
.
ADDR3101  MOVE      EACRNOKC,COMNTLNE  * Next of Kin comments
          MOVE      ANSN,D1            * Indc 3 = "N"
          GOTO      ADDR3199
.
ADDR3102  MOVE      EACRRADC,COMNTLNE  * Radiation License comments
          MOVE      ANSR,D1            * Indc 3 = "R"
          GOTO      ADDR3199
.
ADDR3103  MOVE      EACRWRKC,COMNTLNE  * Working with Children comments
          MOVE      ANSW,D1            * Indc 3 = "W"
          GOTO      ADDR3199
.
ADDR3104  MOVE      EACRPOLC,COMNTLNE  * Police Clearance comments
          MOVE      ANSP,D1            * Indc 3 = "P"
          GOTO      ADDR3199
.
ADDR3105  MOVE      EACRSCPC,COMNTLNE  * Scope of Practice comments
          MOVE      ANSS,D1            * Indc 3 = "S"
          GOTO      ADDR3199
.
ADDR3106  MOVE      EACROTHC,COMNTLNE  * Other Information comments
          MOVE      ANSO,D1            * Indc 3 = "O"
          GOTO      ADDR3199
.
ADDR3107  MOVE      EACRVEHC,COMNTLNE  * Vehicle Registration comments
          MOVE      ANSV,D1            * Indc 3 = "V"
          GOTO      ADDR3199
.
ADDR3199  MOVE      D1,CMNTTIND
          CALL      GCMTYP00           * Get Comment Type (category TZ)
          IF        EXIT=0
            MOVE      CMNTTCOD,COMNTTYP
            MOVE      EACRHCPC,COMNTHCP
            CALL      PCOM0000         * Process HCP Comments
          ENDIF
.
          GOTO      ADDR3100
.
ADDR9000  ADD       ONE,TOTDRADD
.
ADDR9999  RETURN
+
.******************************************************************************
.*                                  UPDR0000             Called by : PROC0000 *
.*  Update eAccreditation Doctor Details into webPAS                          *
.******************************************************************************
UPDR0000  MOVE      ZERO,EXIT
.                                                * Create Doctor Details File
          MOVE      TODAY,DLUPDDTE
          MOVE      UPDTTIME,DLUPDTME
.
          PACK      KEY6,DCODE
          CALL      UPDOCT1
          PROC      PATDKIUP                     * Updates keyword index
.                                                * Create HCP Details File
          MOVE      TODAY,PMHCLUPD
          MOVE      UPDTTIME,PMHCLUPT
          MOVE      USERID,PMHCWEBU
.
          CALL      UPPMHCP1
          PROC      PMSHKIUP                     * Updates keyword index
.                                                * Update Doctor/Unit File
UPDR1000  PACK      KEY9,DCODE,SP70
          CALL      RSPMDUN1
UPDR1500  CALL      RKPMDUN1                     * Remove all existing records
          BRANCH    OVRCD,UPDR2000
.
          MATCH     PMDUDOCT,EACRHCPC
          GOTO      UPDR2000 IF NOT EQUAL
.
          PACK      KEY9,PMDUDOCT,PMDUUNIT
          CALL      DEPMDUN1
          GOTO      UPDR1000
.                                                * Create Doctor/Unit File
UPDR2000  MOVE      ZERO,LOOPCNTR
UPDR2100  ADD       ONE,LOOPCNTR
          IF        LOOPCNTR > 10
            GOTO      UPDR3000
          ENDIF
.
          BRANCH    LOOPCNTR,UPDR2101,UPDR2102,UPDR2103,UPDR2104,UPDR2105:
                             UPDR2106,UPDR2107,UPDR2108,UPDR2109,UPDR2110
. 
UPDR2101  PACK      DIM3,EACRUNT0,SP70
          GOTO      UPDR2199
. 
UPDR2102  PACK      DIM3,EACRUNT1,SP70
          GOTO      UPDR2199
. 
UPDR2103  PACK      DIM3,EACRUNT2,SP70
          GOTO      UPDR2199
. 
UPDR2104  PACK      DIM3,EACRUNT3,SP70
          GOTO      UPDR2199
. 
UPDR2105  PACK      DIM3,EACRUNT4,SP70
          GOTO      UPDR2199
. 
UPDR2106  PACK      DIM3,EACRUNT5,SP70
          GOTO      UPDR2199
. 
UPDR2107  PACK      DIM3,EACRUNT6,SP70
          GOTO      UPDR2199
. 
UPDR2108  PACK      DIM3,EACRUNT7,SP70
          GOTO      UPDR2199
. 
UPDR2109  PACK      DIM3,EACRUNT8,SP70
          GOTO      UPDR2199
. 
UPDR2110  PACK      DIM3,EACRUNT9,SP70
          GOTO      UPDR2199
.
UPDR2199  MATCH     DIM3,SP70
          GOTO      UPDR3000 IF EQUAL
.
          MOVE      EACRHCPC,PMDUDOCT
          MOVE      DIM3,PMDUUNIT
          MOVE      SP70,PMDUHEAD
          MOVE      SP70,PMDUSPAR
.
          PACK      KEY9,PMDUDOCT,PMDUUNIT,SP70
          CALL      RAPMDUN1
          COMPARE   ZERO,OVRCD
          GOTO      UPDR2100 IF EQUAL            * already exist
.
          CALL      WRPMDUN1
.
          GOTO      UPDR2100
.                                                * Update Multi Hosp HCP Codes
UPDR3000  MOVE      ZERO,LOOPCNTR
UPDR3100  ADD       ONE,LOOPCNTR
          IF        LOOPCNTR > 10
            GOTO      UPDR5000
          ENDIF
.
          BRANCH    LOOPCNTR,UPDR3101,UPDR3102,UPDR3103,UPDR3104,UPDR3105:
                             UPDR3106,UPDR3107,UPDR3108,UPDR3109,UPDR3110
. 
UPDR3101  PACK      DIM3,EACRHSP0,SP70
          GOTO      UPDR3199
. 
UPDR3102  PACK      DIM3,EACRHSP1,SP70
          GOTO      UPDR3199
. 
UPDR3103  PACK      DIM3,EACRHSP2,SP70
          GOTO      UPDR3199
. 
UPDR3104  PACK      DIM3,EACRHSP3,SP70
          GOTO      UPDR3199
. 
UPDR3105  PACK      DIM3,EACRHSP4,SP70
          GOTO      UPDR3199
. 
UPDR3106  PACK      DIM3,EACRHSP5,SP70
          GOTO      UPDR3199
. 
UPDR3107  PACK      DIM3,EACRHSP6,SP70
          GOTO      UPDR3199
. 
UPDR3108  PACK      DIM3,EACRHSP7,SP70
          GOTO      UPDR3199
. 
UPDR3109  PACK      DIM3,EACRHSP8,SP70
          GOTO      UPDR3199
. 
UPDR3110  PACK      DIM3,EACRHSP9,SP70
          GOTO      UPDR3199
.
UPDR3199  MATCH     DIM3,SP70
          GOTO      UPDR5000 IF EQUAL
.
          PACK      KEY13,DIM3,EACRHCPC,SP70
          CALL      RDMLHCP1
          BRANCH    OVRCD,UPDR4000
.
          PACK      MLHCSDAT,EACRSTD0,SP70
          PACK      MLHCEDAT,EACREDD0,SP70
          MOVE      SP70,MLHCHSRI
          MOVE      SP70,MLHCSPAR
          CALL      UPMLHCP1
.
          PACK      KEY10,EACRHCPC,SP70
          CALL      RDPMHCP1
          IF        OVRCD=0
            MOVE      "1",PMHCHOSS
.
            CALL      UPPMHCP1
          ENDIF
.
          PACK      KEY6,EACRHCPC,SP70      * Check if Doctor exists
          CALL      RDDOCT1
          IF        OVRCD=0
            MOVE      "1",PTDOHOSS
.
            CALL      UPDOCT1
          ENDIF
.
          GOTO      UPDR3100
.
UPDR4000  MOVE      DIM3,MLHCHOSP
          MOVE      EACRHCPC,MLHCHCPC
          PACK      MLHCSDAT,EACRSTD0,SP70
          PACK      MLHCEDAT,EACREDD0,SP70
          MOVE      SP70,MLHCHSRI
          MOVE      SP70,MLHCSPAR
          CALL      WRMLHCP1
.
          PACK      KEY10,EACRHCPC,SP70
          CALL      RDPMHCP1
          IF        OVRCD=0
            MOVE      "1",PMHCHOSS
.
            CALL      UPPMHCP1
          ENDIF
.
          PACK      KEY6,EACRHCPC,SP70      * Check if Doctor exists
          CALL      RDDOCT1
          IF        OVRCD=0
            MOVE      "1",PTDOHOSS
.
            CALL      UPDOCT1
          ENDIF
.
          GOTO      UPDR3100
.
.
.         Process HCP Comments...
.
UPDR5000  MATCH     "1",PTCNEACF       * Extended (SJGHC) format?
          GOTO      UPDR9000 IF NOT EQUAL
.
          MOVE      ZERO,LOOPCNTR
UPDR5100  ADD       ONE,LOOPCNTR
          IF        LOOPCNTR > 7
            GOTO      UPDR9000
          ENDIF
.
          BRANCH    LOOPCNTR,UPDR5101,UPDR5102,UPDR5103,UPDR5104,UPDR5105:
                             UPDR5106,UPDR5107
.
UPDR5101  MOVE      EACRNOKC,COMNTLNE  * Next of Kin comments
          MOVE      ANSN,D1            * Indc 3 = "N"
          GOTO      UPDR5199
.
UPDR5102  MOVE      EACRRADC,COMNTLNE  * Radiation License comments
          MOVE      ANSR,D1            * Indc 3 = "R"
          GOTO      UPDR5199
.
UPDR5103  MOVE      EACRWRKC,COMNTLNE  * Working with Children comments
          MOVE      ANSW,D1            * Indc 3 = "W"
          GOTO      UPDR5199
.
UPDR5104  MOVE      EACRPOLC,COMNTLNE  * Police Clearance comments
          MOVE      ANSP,D1            * Indc 3 = "P"
          GOTO      UPDR5199
.
UPDR5105  MOVE      EACRSCPC,COMNTLNE  * Scope of Practice comments
          MOVE      ANSS,D1            * Indc 3 = "S"
          GOTO      UPDR5199
.
UPDR5106  MOVE      EACROTHC,COMNTLNE  * Other Information comments
          MOVE      ANSO,D1            * Indc 3 = "O"
          GOTO      UPDR5199
.
UPDR5107  MOVE      EACRVEHC,COMNTLNE  * Vehicle Registration comments
          MOVE      ANSV,D1            * Indc 3 = "V"
          GOTO      UPDR5199
.
UPDR5199  MOVE      D1,CMNTTIND
          CALL      GCMTYP00           * Get Comment Type (category TZ)
          IF        EXIT=0
            MOVE      CMNTTCOD,COMNTTYP
            MOVE      EACRHCPC,COMNTHCP
            CALL      PCOM0000         * Process HCP Comments
          ENDIF
.
          GOTO      UPDR5100
.
UPDR9000  ADD       ONE,TOTDRUPD
.
UPDR9999  RETURN
+
.*****************************************************************************
.*                  GCMTYP00                   Called by: ADDR0000, UPDR0000 *
.*        Returns the first HCP Comment Type code (Cat TZ) with a matching   *
.*        Indicator 3 value.                                                 *
.*                                                                           *
.*        Requires:                                                          *
.*          CMNTTIND - Indicator 3 value                                     *
.*                                                                           *
.*        Returns:                                                           *
.*          EXIT     - 0=Found  1=No match found                             *
.*          CMNTTCOD - Category TZ Code                                      *
.*****************************************************************************
GCMTYP00  MOVE      SP10,CMNTTCOD
.
          PACK      KEY5,CATUCTZ,SP70
          CALL      RDSCODE1
GCMTYP10  CALL      RDKCODE1
          BRANCH    OVRCD,GCMTYP91
.
          MATCH     CATUCTZ,TCODE
          GOTO      GCMTYP91 IF NOT EQUAL
.
          MATCH     TCINDC3,CMNTTIND
          GOTO      GCMTYP90 IF EQUAL
.
          GOTO      GCMTYP10
.
GCMTYP90  MOVE      ACODE,CMNTTCOD
          MOVE      ZERO,EXIT
          GOTO      GCMTYP99
.
GCMTYP91  MOVE      ONE,EXIT
          GOTO      GCMTYP99
.
GCMTYP99  RETURN
+
.******************************************************************************
.*                                  PRHD0000             Called by : PRIB0000 *
.*                                                                   PRTOT000 *
.*  Print Doctors eAccreditation Upload report header details                 *
.******************************************************************************
PRHD0000  COMPARE   "60",CLNO
          GOTO      PRHD9999 IF LESS
.
          CALL      HEAD132                      * Print New Page Header
.
          PRINT     *N,"Input Data File : ",PATHNAME,*N
.
          IF        TOTDRERR = 0
            MOVE      "6",CLNO
.
            MATCH     "1",PTCNEACF                 * Extended (SJGHC) format?
            GOTO      PRHD1000 IF EQUAL
.
            GOTO      PRHD9999
          ENDIF
.
PRHD1000  CALL      UND132
.
          PRINT     *1,"| Doctor Code":
                    *23,"| Message":
                    *132,"|"
.
          CALL      UND132
.
          MOVE      "9",CLNO
.
PRHD9999  RETURN
+
.******************************************************************************
.*                                  PRTOT000             Called by : MAIN0000 *
.*  Print report totals                                                       *
.******************************************************************************
PRTOT000  COMPARE   "60",CLNO
          CALL      PRHD0000 IF NOT LESS
.
          IF        TOTDRERR = 0
            GOTO      PRTOT100
          ENDIF
.
          MATCH     "1",PTCNEACF                 * Extended (SJGHC) format?
          IF        !@EQUAL
            CALL      UND132
            ADD       ONE,CLNO
          ENDIF
.
PRTOT050  PRINT     *N,*1,"  Number of Errors: ",TOTDRERR,*N
          ADD       THREE,CLNO
.
          CALL      UND132
          ADD       ONE,CLNO
.
PRTOT100  PRINT     *N,*1," Number of Doctor Codes Added        : ",TOTDRADD
          PRINT     *1," Number of Doctor Codes Updated      : ",TOTDRUPD
          PRINT     *1," Number of Doctor Codes with Errors  : ",TOTDRERR
          PRINT     *1," Number of Doctor Records Processed  : ",TOTDOCTS
.
          ADD       FIVE,CLNO
.
PRTOT999  RETURN
+
.******************************************************************************
.*                                  PRIB0000             Called by : PROC0000 *
.*                                                                   VALI0000 *
.*  Print Doctors eAccreditation Upload Error Report                          *
.******************************************************************************
PRIB0000  ADD       ONE,TOTDRERR
.
          COMPARE   "60",CLNO
          CALL      PRHD0000 IF NOT LESS
.
          PRINT     *1,"| ",EACRHCPC:
                    *23,"| ",ERRMESSG:
                    *132,"|"
.
          PRINT     *1,"|":
                    *23,"|":
                    *132,"|"
.
          ADD       TWO,CLNO
.
PRIB9999  RETURN
+
.******************************************************************************
.*                                  PRUPST00             Called by : PROC0000 *
.*        Print HCP upload status information                                 *
.******************************************************************************
PRUPST00  COMPARE   "60",CLNO
          CALL      PRHD0000 IF NOT LESS
.
          UNPACK    TODAY,CCENT,CYEAR,CMON,CDAY
          CALL      PACDATE
          REP       " 0",CPCDATE
          PACK      EACRHSP0,EACRHSP0,SP70
.
          PACK      KEY3,EACRHSP0,SP70
          CALL      RDPTHSP1
          IF        OVRCD=1
            CLEAR     PTHSNAME
            APPEND    EACRHSP0,PTHSNAME
            MATCH     SP70,EACRHSP0
            IF        !@EQUAL
              APPEND    " - invalid code",PTHSNAME
            ELSE
              MOVE      "Valid to All Hospitals",PTHSNAME
            ENDIF
            RESET     PTHSNAME
          ENDIF
.
          PRINT     *1,"| Processing Date     | ",CPCDATE,*132,"|"
          PRINT     *1,"| SJGHC Division Name | ",PTHSNAME,*132,"|"
          PRINT     *1,"| HCP Surname         | ",EACRSNAM,*132,"|"
          PRINT     *1,"| HCP First Name      | ",EACRGNAM,*132,"|"
          PRINT     *1,"| HCP AHPRA Number    | ",EACRREGN,*132,"|"
.
          IF        UPLDSTAT=1
            PRINT     *1,"| HCP Update Status   | Upload success",*132,"|"
          ELSE
            PRINT     *1,"| HCP Update Status   | Upload unsuccessful",*132,"|"
          ENDIF
.
          CALL      UND132
.
          ADD       SEVEN,CLNO
.
PRUPST99  RETURN
+
.*******************************************************************************
.*                                  VDTE0000              Called by : VALI0000 *
.* Validate a date field                                                       *
.* Requires:  TEMPDATE - Date in format ccyymmdd                               *
.* Returns:   EXIT = 1 if an error in date validation occurs.                  *
.*******************************************************************************
VDTE0000  SQUEEZE   TEMPDATE
          MOVELPTR  TEMPDATE,FORM1
          IF        FORM1 <> 8
            GOTO      VDTE9800
          ENDIF
.
          UNPACK    TEMPDATE,CCENT,CYEAR,CMON,CDAY
          MOVE      CCENT,FORM2
          IF        FORM2 < 18 | FORM2 > CCC
            GOTO      VDTE9800
          ENDIF
.
          MOVE      CMON,FORM2
          IF        FORM2 < 1 | FORM2 > 12
            GOTO      VDTE9800
          ENDIF
.
          BRANCH    FORM2,VDTE1000:              * Jan
                          VDTE3000:              * Feb
                          VDTE1000:              * Mar
                          VDTE2000:              * Apr
                          VDTE1000:              * May
                          VDTE2000:              * Jun
                          VDTE1000:              * Jul
                          VDTE1000:              * Aug
                          VDTE2000:              * Sep
                          VDTE1000:              * Oct
                          VDTE2000:              * Nov
                          VDTE1000               * Dec
.                                                * Validate days for 31 day Mnths
VDTE1000  MOVE      CDAY,FORM2
          IF        FORM2 < 1 | FORM2 > 31
            GOTO      VDTE9800
          ENDIF
          GOTO      VDTE9900
.                                                * Validate days for 30 day Mnths
VDTE2000  MOVE      CDAY,FORM2
          IF        FORM2 < 1 | FORM2 > 30
            GOTO      VDTE9800
          ENDIF
          GOTO      VDTE9900
.                                                * Validate days for February
. * N.B. A leap year is one where:
. *      If the year is divisible 100 and 400, then it is a leap century year
. *      Otherwise every year divisible by 4 is a leap year.
VDTE3000  MOVE      CDAY,FORM2
          PACK      D4,CCENT,CYEAR
          MOVE      D4,FORM4
          MOVE      TWENTY8,LEAPDAYS             * Normal February Days
.
          IF        (FORM4%4) = 0
            IF        (FORM4%100) = 0
              IF        (FORM4%400) = 0
                MOVE      TWENTY9,LEAPDAYS       * Leap Century February Days
              ENDIF
            ELSE
              MOVE      TWENTY9,LEAPDAYS         * Leap Year February Days
            ENDIF
          ENDIF
.                                                * Check for February days
VDTE3100  IF        FORM2 < 1 | FORM2 > LEAPDAYS
            GOTO      VDTE9800
          ENDIF
          GOTO      VDTE9900
.
VDTE9800  MOVE      ONE,EXIT
          GOTO      VDTE9999
.
VDTE9900  MOVE      ZERO,EXIT
.
VDTE9999  RETURN
+
.******************************************************************************
.*                                  DSCR0000             Called by : ADDR0000 *
.*  Create blank records in patdstat file for each period this year           *
.******************************************************************************
DSCR0000  PACK      KEY6,FINYEAR,SP10
          CALL      RDSDRGA1
DSCR1000  CALL      RDKDRGA1
.
          BRANCH    OVRCD,DSCR9999
.
          MATCH     DRGYR,FINYEAR
          GOTO      DSCR9999 IF LESS
.
          MOVE      ZERO,PTDSBADM
          MOVE      ZERO,PTDSBBED
          MOVE      ZERO,PTDSBOPR
          MOVE      ZERO,PTDSBMBS
          MOVE      ZERO,PTDSADMS
          MOVE      ZERO,PTDSBEDD
          MOVE      ZERO,PTDSOPRS
          MOVE      ZERO,PTDSMBSC
          MOVE      FINYEAR,PTDSYEAR
          MOVE      DRGNUM,PTDSPERD
          MOVE      DCODE,PTDSCODE
.
          PACK      KEY13,PTDSYEAR,PTDSPERD,ANSR,PTDSCODE
          CALL      RADSTA1
          IF        OVRCD=1
            CALL      WRDSTA1
          ENDIF
          PACK      KEY13,PTDSYEAR,PTDSPERD,ANSA,PTDSCODE
          CALL      RADSTA1
          IF        OVRCD=1
            CALL      WRDSTA1
          ENDIF
.
          GOTO      DSCR1000
.
DSCR9999  RETURN
+
.*****************************************************************************
.*                  PCOM0000                   Called by: ADDR0000, UPDR0000 *
.*        Process General HCP comments. Write/update records in pmstcoaf.dat *
.*        Comments longer than 70 chars will be chopped into multiple lines. *
.*                                                                           *
.* Requires: COMNTHCP - Comments HCP Code                                    *
.*           COMNTTYP - Comments Type (Cat TZ)                               *
.*           COMNTLNE - Comments Line (max 200 chars)                        *
.*****************************************************************************
.
PCOM0000  STRIP     COMNTLNE                     * remove trailing spaces
          MOVELPTR  COMNTLNE,COMMTLEN            * get comment field length
.
          COMPARE   ZERO,COMMTLEN                * any comments ?
          GOTO      PCOM9999 IF EQUAL            * no - finished
.
          MOVE      ZERO,LINENUMB                * yes - initialise line number
          PACK      COMNTHCP,COMNTHCP,SP70
.
.         Write a comment line
.
PCOM0500  ADD       ONE,LINENUMB                 * increment line number
.
          PACK      KEY16,COMNTHCP,COMNTTYP,LINENUMB,SP70
          CALL      RAPMTCO1
          IF        OVRCD=1
            MOVE      COMNTHCP,PMTCCODE          * HCP Code
            MOVE      COMNTTYP,PMTCTCOM          * Type of Comments (Cat TZ)
            MOVE      LINENUMB,PMTCLNUM          * Line number
            MOVE      COMNTLNE,PMTCCOMM
            PACK      PMTCCOMM,PMTCCOMM,SP70     * load comment line
            MOVE      TODAY,PMTCUDAT
            MOVE      UPDTTIME,PMTCUTIM
            MOVE      USERID,PMTCUUID            * WEB User Id Updated
            MOVE      SP70,PMTCSPAR
            CALL      WRPMTCO1
          ELSE
            CALL    RDPMTCO1
            IF      OVRCD=0
              MOVE      COMNTHCP,PMTCCODE        * HCP Code
              MOVE      COMNTTYP,PMTCTCOM        * Type of Comments (Cat TZ)
              MOVE      LINENUMB,PMTCLNUM        * Line number
              MOVE      COMNTLNE,PMTCCOMM
              PACK      PMTCCOMM,PMTCCOMM,SP70   * load comment line
              MOVE      TODAY,PMTCUDAT
              MOVE      UPDTTIME,PMTCUTIM
              MOVE      USERID,PMTCUUID          * WEB User Id Updated
              CALL      UPPMTCO1
            ENDIF
          ENDIF
.
          COMPARE   COMMTLEN,SEVENTY             * any comments remaining ?
          GOTO      PCOM9999 IF NOT LESS         * no - finished
.
.         There is at least one more line of comments to load
.
          BUMP      COMNTLNE,70                  * move forward 70 characters
          SUB       SEVENTY,COMMTLEN             * reduce string length by 70
          GOTO      PCOM0500                     * process next line
.
PCOM9999  RETURN
+
*******************************************************************************
          INC       STD001IO                     * Standard Includes
.
          INC       CLPATDOC                     * Clear Doctor File
          INC       CLPMSHCP                     * Clear HCP File
          INC       PATCOMN3                     * Patient Common Routines
          INC       PATDKIPR                     * Doctor Key Word generation
          INC       PMSHKIPR                     * HCP Key Word generation
.
          INC       MLTHCPIO/INC                 * Multi Hospital HCP Codes
          INC       PATCODIO/INC                 * Patient Codes File
          INC       PATDO1IO/INC                 * Doctor Details File
          INC       PATDKIIO/INC                 * Doctors Key Word File
          INC       PATDRGIO/INC                 * Patient Period Date Range File
          INC       PATDSTIO/INC                 * Patient Doctor Statistics File
          INC       PATHSPIO/INC                 * Hospital Details File
          INC       PATIN1IO/INC                 * Insurance Details File
          INC       PMSDUNIO/INC                 * Doctor/Unit Combination File
          INC       PMSHCPIO/INC                 * HCP Details File
          INC       PMSHKIIO/INC                 * HCP Key Word File
          INC       PMSTCOIO/INC                 * General HCP Comments
          INC       WEBSECIO/INC                 * Web Security File
