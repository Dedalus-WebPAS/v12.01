
. ***************************************************************
. *                                                             *
. *                 P R O G R A M  S U M M A R Y                *
. *                 - - - - - - -  - - - - - - -                *
. *                                                             *
. *     Program Name   :  SABLOCK                               *
. *                                                             *
. *     Function       :  Create systable link from DPATH       *
. *                                                             *
. *     Modifications  :  V5.00 26.05.89 B.G.Ackland (I.B.A.)   *
. *                             Remove Need For Linking systable*
. *                       V5.01.01 29.11.90 Helen Crick(IBA)    *
. *                             Recompiled for Release 5.01     *
. *                                                             *
. *                * A T T E N T I O N *                        *
. *                ---------------------                        *
. *        This   program   is  the   property  of              *
. *        Information Builders Australia  Pty Ltd              *
. *        and must not be utilised,  ENQified  or              *
. *        copied in any manner whatsoever without              *
. *        the  express   written   permission  of              *
. *        Information Builders Australia Pty Ltd.              *
. *                                                             *
. ***************************************************************
.
          INC       STD001FD
.
SYSTABLE  IFILE     SQL, FIXED=177, KEY="U1-17"
TABLELIN  FILE      ASCII, FIXED=256
.
. fields in systables file
.
TABNAME   DIM       18
OWNER     DIM       8 
NOWNER    DIM       8
DIRPATH   DIM       64
.
. woring variables
.
LLCNT     FORM      2
DIM3      DIM       3
PATH      DIM       25
SQLDIR    DIM       40
OPENSYS   DIM       50
LDAT      INIT      "linktab "
LDATEND   INIT      " >tablelin.txt"
COMMAND   DIM       80
.
SP17      INIT      "                 "
SP18      INIT      "                  "
SP40      INIT      "                                        "
.
PRGID     INIT      "PATLOCK "
PRGNAM    INIT      "Lock or Unlock Informix Systables pat Files Only"
VERSION   INIT      "V12.01.00"
.
          CALL      DISPHEAD
MAIN1000  KEYIN     *P1:5,*EF,"Enter Systable Path : ",*V2LON,SQLDIR
          ENDSET    SQLDIR
          APPEND    SP40,SQLDIR
          RESET     SQLDIR
          MATCH     SP40,SQLDIR
          GOTO      MAIN9999 IF EQUAL
          CALL      SETP0000
          MOVE      ZERO,OVRCD
          TRAP      OVERCOND IF IO
          OPEN      SYSTABLE,OPENSYS
          TRAPCLR   IO
          COMPARE   ZERO,OVRCD
          GOTO      MAIN1500 IF EQUAL
          KEYIN     *P1:24,"Could NOT Open ",*DV,OPENSYS," Tap Enter.",ANS
          GOTO      MAIN1000
MAIN1500  KEYIN     *P23:5,*EL,*V2LON,*DV,SQLDIR,*HOFF,*P65:5,"Ok (":
                    *V2LON,"y",*HOFF,"/",*V2LON,"n",*HOFF,") ? ",*V2LON,ANS
          MATCH     "n",ANS
          GOTO      MAIN1000 IF EQUAL
          MATCH     "y",ANS
          GOTO      MAIN1500 IF NOT EQUAL
.
MAIN2000  KEYIN     *P1:24,"Enter New Owner( ",*V2LON,"*",*HOFF," to Exit":
                    " ): ",*P31:24,*V2LON,NOWNER
          ENDSET    NOWNER
          APPEND    SP8,NOWNER
          RESET     NOWNER
          MATCH     "*",NOWNER
          GOTO      MAIN1000 IF EQUAL
          KEYIN     *P31:24,*V2LON,*DV,NOWNER,*HOFF,*P40:24,*EL,"Ok to Run (":
                    *V2LON,"y",*HOFF,"/",*V2LON,"n",*HOFF,") ? ",*V2LON,ANS
          MATCH     "n",ANS
          GOTO      MAIN1000 IF EQUAL
          MATCH     "y",ANS
          GOTO      MAIN2000 IF NOT EQUAL
.
          MOVE      SP17,KEY17
          DISPLAY   *P1:12,*EF,"Processing Table : "
          READ      SYSTABLE,KEY17;;
MAIN3000  READKS    SYSTABLE;TABNAME,OWNER,DIRPATH
          GOTO      MAIN9000 IF OVER
          MOVE      TABNAME,DIM3
          MATCH     "pat",DIM3
          GOTO      MAIN3000 IF NOT EQUAL
          DISPLAY   *P30:12,TABNAME,OWNER,SP3,NOWNER
          MOVE      NOWNER,OWNER
          UPDATE    SYSTABLE;TABNAME,OWNER,DIRPATH
          GOTO      MAIN3000
.
MAIN9000  KEYIN     *P1:24,*EL,"*** Changes Completed. Tap Enter. ***",ANS
MAIN9999  CHAIN     PGM
.--------------------------------
. set directory path
.--------------------------------
SETP0000  MOVE      "40",LLCNT           * set up acct dir path
SETP1000  RESET     SQLDIR,LLCNT
          CMATCH    SP1,SQLDIR
          GOTO      SETP9000 IF NOT EQUAL
.
          SUB       ONE FROM LLCNT
          COMPARE   ZERO,LLCNT
          GOTO      SETP1000 IF NOT EQUAL
.
          CLEAR     SQLDIR
          GOTO      SETP9999
.
SETP9000  LENSET    SQLDIR
          RESET     SQLDIR
SETP9999  CLEAR     OPENSYS
          APPEND    SQLDIR,OPENSYS
          APPEND    "systables",OPENSYS
          RESET     OPENSYS
          RETURN
.--------------------------------
. set table name
.--------------------------------
.SETT0000  MOVE      "18",LLCNT           * set up acct dir path
.SETT1000  RESET     TABNAME,LLCNT
.          CMATCH    SP1,TABNAME
.          GOTO      SETT9999 IF NOT EQUAL
.
.          SUB       ONE FROM LLCNT
.          COMPARE   ZERO,LLCNT
.          GOTO      SETT1000 IF NOT EQUAL
..
.          CLEAR     TABNAME
.          RETURN
.
.SETT9999  LENSET    TABNAME
.          RESET     TABNAME
.          RETURN
.
          INC       STD001IO
.
