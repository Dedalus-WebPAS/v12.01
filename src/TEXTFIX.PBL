. ************************************************************
. *                P R O G R A M  S U M M A R Y              *
. *                - - - - - - -  - - - - - - -              *
. *                                                          *
. *     PROGRAM NAME:          TEXTFIX                       *
. *                                                          *
. *     FUNCTION:              CHANGE TEXT FILES ON SCREEN   *
. *                                                          *
. *     AUTHOR:                SOMEONE FROM THE PAST         *
. *                                                          *
. *     MODIFICATIONS:                                       *
. *       V9.06.01 31/05/2006  Steve Armstrong               *
. *                Fixed SECTOR display for option 1         *
. *       C1.00.01 05/10/1995 Matt                           *
. *                Changed FILE definition to SFILE          *
. *       V5.00 B.G.Ackland (I.B.A.)                         *
. *                Release 5 changes  (CISAM)                *
. *       W2.00 M.HAYSE (I.B.A)                              *
. *                NEW HIGHLIGHTING AND UNDERLINE            *
. *                                                          *
. ************************************************************
. *                                                          *
. *                  * A T T E N T I O N *                   *
. *                  - - - - - - - - - - -                   *
. *            THIS PROGRAM IS THE PROPERTY OF               *
. *            INFORMATION BUILDERS (AUSTRALIA) PTY LTD      *
. *            AND MUST NOT BE UTILISED MODIFIED OR          *
. *            COPIED IN ANY MANNER WHATSOEVER WITHOUT       *
. *            THE EXPRESS WRITTEN PERMISSION OF             *
. *            INFORMATION BUILDERS (AUSTRALIA) PTY LTD.     *
. *                                                          *
. ************************************************************
.
          INC       STD001FD
.
 IFGE     $$VER,7
A         SFILE    ASCII, FIXED=256
 XIF
 IFEQ     $$VER,6
A         FILE     ASCII, FIXED=256
 XIF
ACTION    FORM      1
.
BFL       FORM      1
.
CH1       DIM       10
CH2       DIM       10
CH3       DIM       10
CH4       DIM       10
CH5       DIM       10
CH6       DIM       10
CH7       DIM       10
CH8       DIM       10
CH9       DIM       10
CH10      DIM       10
CH11      DIM       10
CH12      DIM       10
CH13      DIM       10
CH14      DIM       10
CH15      DIM       10
CH16      DIM       10
CH17      DIM       10
CH18      DIM       10
CH19      DIM       10
CH20      DIM       10
CH21      DIM       10
CH22      DIM       10
CH23      DIM       10
CH24      DIM       10
CH25      DIM       10
.
DLREC     FORM      3     DISPLAYED RECORD LENGTH INCLUDING EOR
DUMMY     FORM      1
.
EFL       FORM      1
EOR       INIT      015
EOS       INIT      003
.
FFL       FORM      1
FREC      FORM      2
FSEC      FORM      5
FTAB      FORM      3     BASED ON SCREEN REQUEST
.
H         FORM      2
.
LINES     FORM      2
LLREC     FORM      2
LLTAB     FORM      3     BASED ON ANY EOR POINTER OR ELSE FTAB,LTAB
LREC      FORM      3
LSEC      FORM      5
LTAB      FORM      3     DITTO
.
M         FORM      2
MSAVE     FORM      2
.
N         FORM      2
NAME      DIM       9
NREC      FORM      3
NSAVE     FORM      2
.
OFL       FORM      1
.
PAGE      FORM      3
PROGNAME  DIM       8
.
R         DIM       1
REC       FORM      2
RFL       FORM      1
.
SEC       FORM      5
SFL       FORM      1
STR2      DIM       2
.
T1        DIM       1
T2        DIM       2
T3        DIM       3
T4        DIM       4
T5        DIM       5
T6        DIM       6
T7        DIM       7
T8        DIM       8
T9        DIM       9
TAB       FORM      4
TABCNT    FORM      4
TEMP      DIM       10
TEMP3     FORM      3
.
V         FORM      2
.
WFL       FORM      1
.
X         INIT      "!"
.
.
PRGNAM    INIT      "Textfix"
PRGID     INIT      "TEXTFIX"
VERSION   INIT      "V12.01.00"
.
START     DISPLAY   *ES,*P1:1,"*** INFORMATION BUILDERS AUSTRALIA":
                    *V2LON," TEXTFIX ",*HOFF:
                    "DATA FILE REPAIR UTILITY V5.00 ***"
.
          DISPLAY   *P1:3,*V2LON," 0 ",*HOFF,"= CHAIN ANSWER":
                    *P1:4,*V2LON," 1 ",*HOFF,"= SCREEN DISPLAY/MODIFY":
                    *P1:5,*V2LON," 2 ",*HOFF,"= PRINTER OUTPUT":
                    *P1:6,*V2LON," 3 ",*HOFF,"= CHAIN ISAMFIX":
                    *P1:7,*V2LON," 4 ",*HOFF,"= CHAIN DISPLAY":
                    *P1:8,*V2LON," 5 ",*HOFF,"= CHAIN LIST":
                    *P1:9,*V2LON," 6 ",*HOFF,"= CHAIN TO ANOTHER PROGRAM":
                    *P1:10,*V2LON," 7 ",*HOFF,"= EXIT"
.
          KEYIN     *P1:12,"OPTION : ",*V2LON,ACTION
.
          BRANCH    ACTION OF X0,X0:
                    CHISM,CHDSP,CHLST,ELSEWHER,CHOUT
.
CHIBA     CHAIN     CCMENU
.
CHDSP     CHAIN     "DISPLAY"
.
CHISM     CHAIN     "ISAMFIX"
.
CHLST     CHAIN     "LIST"
.
CHOUT     CHAIN     CCMENU
          STOP
.
ELSEWHER  TRAP      NOPROG IF CFAIL
          KEYIN     *P1:12,*EL,"Enter Program Name : ",PROGNAME
.
          CHAIN     PROGNAME
          GOTO      ELSEWHER
.
NOPROG    BEEP
          DISPLAY   *P22:12,"NO SUCH PROGRAM !!!",*W
          RETURN
.
X0        KEYIN     *P1:2,*EF,"FILE NAME: ",NAME
          RESET     NAME
          GOTO      START IF EOS
          RESET     NAME,21
X20       RESET     NAME
          MOVE      "0",TAB
          TRAP      X30 IF IO
          OPEN      A,NAME
          TRAPCLR   IO
          BRANCH    TAB OF X0
          GOTO      X100
X30       BEEP
          DISPLAY   *P30:2,"NO SUCH FILE",*W
          MOVE      "1",TAB
          RETURN
.
X100      MOVE      "1",SFL
          MOVE      "0",BFL
          MOVE      "0",RFL
          MOVE      "0",FFL
          MOVE      "0",WFL
          MOVE      "0",EFL
          MOVE      "250",LREC
          MOVE      "1",FTAB
          MOVE      "250",LTAB
          KEYIN     *P30:2,*EF,"STANDARD ? ",R
          CMATCH    "E",R
          GOTO      E100 IF EQUAL
          CMATCH    "N",R
          GOTO      X150 IF NOT EQUAL
.
          MOVE      "0",SFL
          KEYIN     *P1:4,"BLOCKED ? ",R
          CMATCH    "N",R
          GOTO      X120 IF EQUAL
          MOVE      "1",BFL
          MOVE      "0",NSAVE
X110      KEYIN     *P21:4,*EF,"RECORD LENGTH: ",LREC:
                    *P41:4,"RECORDS/SECTOR: ",NREC
          COMPARE   "1",LREC
          GOTO      X115 IF LESS
          COMPARE   "1",NREC
          GOTO      X115 IF LESS
          MOVE      LREC,TAB
          MULT      NREC,TAB
          COMPARE   "251",TAB
          GOTO      X115 IF NOT LESS
          GOTO      X130
X115      BEEP
          BRANCH    NSAVE OF X115B,X115C
          DISPLAY   *P1:12,"DO YOU THINK I AM STUPID ?",*W
          MOVE      "1",NSAVE
          GOTO      X116
X115B     DISPLAY   *P1:12,"MAY BE YOU ARE STUPID !",*W
          MOVE      "2",NSAVE
          GOTO      X116
X115C     DISPLAY   *P1:12,"COME ON !   ACT YOUR AGE !",*W
          MOVE      "0",NSAVE
X116      BRANCH    BFL OF X110
          GOTO      X125
.
X120      KEYIN     *P1:6,"FIXED LIMITED DISPLAY ? ",R
          CMATCH    "N",R
          GOTO      X130 IF EQUAL
          MOVE      "1",FFL
          MOVE      "0",NSAVE
X125      KEYIN     *P33:6,*EF,"FIRST TAB: ",FTAB:
                    *P51:6,"LAST TAB: ",LTAB
          COMPARE   "1",FTAB
          GOTO      X115 IF LESS
          COMPARE   FTAB,LTAB
          GOTO      X115 IF LESS
          COMPARE   "251",LTAB
          GOTO      X115 IF NOT LESS
          MOVE      LTAB,LREC
          SUB       FTAB,LREC
          ADD       "1",LREC
.
X130      MOVE      "0",RFL
          KEYIN     *P1:8,"RELATIVE TAB LABELS ? ",R
          CMATCH    "N",R
          GOTO      X150 IF EQUAL
          MOVE      "1",RFL
.
X150      BRANCH    ACTION OF X151,P1
X151      DISPLAY   *P30:2,*EF
X152      DISPLAY   *P7:3,"|",*P17:3,"|",*P27:3,"|",*P37:3,"|",*P47:3,"|":
                    *P7:5,"|",*P17:5,"|",*P27:5,"|",*P37:5,"|",*P47:5,"|":
                    *P7:7,"|",*P17:7,"|",*P27:7,"|",*P37:7,"|",*P47:7,"|":
                    *P7:9,"|",*P17:9,"|",*P27:9,"|",*P37:9,"|",*P47:9,"|":
                    *P7:11,"|",*P17:11,"|",*P27:11,"|",*P37:11,"|",*P47:11,"|"
          CLEAR     R
          BRANCH    EFL OF L3,E21,XX1
          GOTO      X170
.
X160      DISPLAY   *P1:4,*EL,*P1:6,*EL,*P1:8,*EL,*P1:10,*EL,*P1:12,*EL
.
X170      CMATCH    "I",R
          GOTO      X180 IF EQUAL
          CMATCH    "D",R
          GOTO      X180 IF EQUAL
          CMATCH    "R",R
          GOTO      X180 IF EQUAL
          GOTO      X200
X180      DISPLAY   *P30:2,*EL,"SECTOR: ",SEC
          COMPARE   "0",SEC
          GOTO      X0 IF LESS
          BRANCH    BFL OF X190
          BRANCH    SFL OF X230
          BRANCH    FFL OF X230
          DISPLAY   *P50:2,"TAB: ",FTAB
          GOTO      X230
X190      DISPLAY   *P47:2,"RECORD: ",REC
          GOTO      X215
.
X200      KEYIN     *P30:2,*EL,"SECTOR:":
                    *P47:2,"(-1 TO EXIT)":
                    *P38:2,SEC:
                    *P43:2,*EL
          COMPARE   "0",SEC
          GOTO      X0 IF LESS
          BRANCH    BFL OF X210
          GOTO      X220
X210      KEYIN     *P47:2,*EL,"RECORD: ",REC
          COMPARE   "1",REC
          GOTO      X212 IF LESS
          COMPARE   REC,NREC
          GOTO      X212 IF LESS
          GOTO      X215
X212      BEEP
          DISPLAY   *P61:2,"RECORD OUT OF RANGE",*W
          GOTO      X210
X215      MOVE      REC,FTAB
          SUB       "1",FTAB
          MULT      LREC,FTAB
          ADD       "1",FTAB
          MOVE      REC,LTAB
          MULT      LREC,LTAB
          GOTO      X230
.
X220      BRANCH    SFL OF X230
          BRANCH    FFL OF X230
          KEYIN     *P50:2,*EL,"TAB: ",FTAB
          COMPARE   "1",FTAB
          GOTO      X225 IF LESS
          COMPARE   "250",FTAB
          GOTO      X225 IF NOT LESS
          MOVE      "250",LREC
          SUB       FTAB,LREC
          ADD       "1",LREC
          GOTO      X230
X225      BEEP
          GOTO      X220
.
X230      MOVE      "1",NSAVE
          TRAP      X240 IF IO
          TRAP      X240 IF RANGE
          READ      A,SEC;*FTAB,CH1,CH2,CH3,CH4,CH5,CH6,CH7,CH8,CH9,CH10:
                    CH11,CH12,CH13,CH14,CH15,CH16,CH17,CH18,CH19,CH20:
                    CH21,CH22,CH23,CH24,CH25
          TRAPCLR   IO
          TRAPCLR   RANGE
          BRANCH    NSAVE OF X250
          BRANCH    EFL OF E19,E19,E19
          GOTO      X200
X240      BEEP
          BRANCH    EFL OF X241,X241,X241
          DISPLAY   *P61:2,"SECTOR OUT OF RANGE",*W
          MOVE      "0",NSAVE
          RETURN
X241      DISPLAY   *P60:6,"SECTOR OUT OF RANGE",*W
          MOVE      "0",NSAVE
          RETURN
.
X250      MOVE      LREC,TAB
          SUB       "1",TAB
          DIV       "10",TAB
          ADD       "1",TAB
          MOVE      TAB,N
          MOVE      LREC,TAB
          MOVE      N,TABCNT
          SUB       "1",TABCNT
          MULT      "10",TABCNT
          SUB       TABCNT,TAB
          MOVE      TAB,M
          CLEAR     TEMP
          LOAD      TEMP FROM N OF CH1,CH2,CH3,CH4,CH5,CH6,CH7,CH8,CH9,CH10:
                    CH11,CH12,CH13,CH14,CH15,CH16,CH17,CH18,CH19,CH20:
                    CH21,CH22,CH23,CH24,CH25
          RESET     TEMP,M
          GOTO      XX0 IF NOT EOS
          BRANCH    N OF K26,K26,K26,K26:
                    K20E,K20E,K20E,K20E,K20E:
                    K20D,K20D,K20D,K20D,K20D:
                    K20C,K20C,K20C,K20C,K20C:
                    K20B,K20B,K20B,K20B,K20B:
                    K20
.
K20       CMATCH    " ",CH25
          GOTO      K21 IF NOT EOS
K20B      CMATCH    " ",CH20
          GOTO      K22 IF NOT EOS
K20C      CMATCH    " ",CH15
          GOTO      K23 IF NOT EOS
K20D      CMATCH    " ",CH10
          GOTO      K24 IF NOT EOS
K20E      CMATCH    " ",CH5
          GOTO      K25 IF NOT EOS
          GOTO      K26
.
K21       MOVE      "25",N
          GOTO      L21
K22       MOVE      "20",N
          GOTO      L20
K23       MOVE      "15",N
          GOTO      L20
K24       MOVE      "10",N
          GOTO      L20
K25       MOVE      "5",N
          GOTO      L20
K26       MOVE      "1",N
L20       CLEAR     TEMP
          LOAD      TEMP FROM N OF CH1,CH2,CH3,CH4,CH5,CH6,CH7,CH8,CH9,CH10,CH11:
                    CH12,CH13,CH14,CH15,CH16,CH17,CH18,CH19,CH20:
                    CH21,CH22,CH23,CH24,CH25
          RESET     TEMP,10
          GOTO      L21 IF EOS
          ADD       "1",N
          GOTO      L20
.
L21       MOVE      "1",M
          CLEAR     TEMP
          LOAD      TEMP FROM N OF CH1,CH2,CH3,CH4,CH5,CH6,CH7,CH8,CH9,CH10,CH11:
                    CH12,CH13,CH14,CH15,CH16,CH17,CH18,CH19,CH20:
                    CH21,CH22,CH23,CH24,CH25
L22       RESET     TEMP,M
          GOTO      L23 IF EOS
          ADD       "1",M
          GOTO      L22
.
L23       CMOVE     "^",TEMP
          RESET     TEMP
          SUB       "1",M
          STORE     TEMP INTO N OF CH1,CH2,CH3,CH4,CH5,CH6,CH7,CH8,CH9,CH10,CH11:
                    CH12,CH13,CH14,CH15,CH16,CH17,CH18,CH19,CH20:
                    CH21,CH22,CH23,CH24,CH25
          MOVE      "1",TAB
          GOTO      L3
.
XX0       LENSET    TEMP
          RESET     TEMP
          MOVE      "0",TAB
          STORE     TEMP INTO N OF CH1,CH2,CH3,CH4,CH5,CH6,CH7,CH8,CH9,CH10:
                    CH11,CH12,CH13,CH14,CH15,CH16,CH17,CH18,CH19:
                    CH20,CH21,CH22,CH23,CH24,CH25
          BRANCH    N OF XX1,XX2,XX3,XX4,XX5,XX6,XX7,XX8,XX9,XX10:
                    XX11,XX12,XX13,XX14,XX15,XX16,XX17,XX18,XX19,XX20:
                    XX21,XX22,XX23,XX24,L3
XX1       CLEAR     CH2
XX2       CLEAR     CH3
XX3       CLEAR     CH4
XX4       CLEAR     CH5
XX5       CLEAR     CH6
XX6       CLEAR     CH7
XX7       CLEAR     CH8
XX8       CLEAR     CH9
XX9       CLEAR     CH10
XX10      CLEAR     CH11
XX11      CLEAR     CH12
XX12      CLEAR     CH13
XX13      CLEAR     CH14
XX14      CLEAR     CH15
XX15      CLEAR     CH16
XX16      CLEAR     CH17
XX17      CLEAR     CH18
XX18      CLEAR     CH19
XX19      CLEAR     CH20
XX20      CLEAR     CH21
XX21      CLEAR     CH22
XX22      CLEAR     CH23
XX23      CLEAR     CH24
XX24      CLEAR     CH25
.
.
L3        COMPARE   "0",M
          GOTO      L3X IF NOT EQUAL
          SUB       "1",N
          MOVE      "10",M
L3X       MOVE      N,DLREC
          SUB       "1",DLREC
          MULT      "10",DLREC
          ADD       M,DLREC
          ADD       TAB,DLREC
          BRANCH    ACTION OF L3J,P100
.
.
L3J       BRANCH    RFL OF L3A
          MOVE      FTAB,TEMP3
          GOTO      L3B
L3A       MOVE      "1",TEMP3
L3B       DISPLAY   *P1:4,*+,TEMP3,".  ",CH1,CH2,CH3,CH4,CH5
          ADD       "50",TEMP3
          COMPARE   "51",DLREC
          GOTO      X300 IF LESS
          DISPLAY   *P1:6,*+,TEMP3,".  ",CH6,CH7,CH8,CH9,CH10
          ADD       "50",TEMP3
          COMPARE   "101",DLREC
          GOTO      X300 IF LESS
          DISPLAY   *P1:8,*+,TEMP3,".  ",CH11,CH12,CH13,CH14,CH15
          ADD       "50",TEMP3
          COMPARE   "151",DLREC
          GOTO      X300 IF LESS
          DISPLAY   *P1:10,*+,TEMP3,".  ",CH16,CH17,CH18,CH19,CH20
          ADD       "50",TEMP3
          COMPARE   "201",DLREC
          GOTO      X300 IF LESS
          DISPLAY   *P1:12,*+,TEMP3,".  ",CH21,CH22,CH23,CH24,CH25
          BRANCH    EFL OF X300,X300,E31
.
X300      MOVE      N,NSAVE
          MOVE      M,MSAVE
          BRANCH    EFL OF X300A,X300A,E31
X300A     KEYIN     *P60:12,*EL,"ANY CHANGES? ",R
          BRANCH    EFL OF X302,X302,X302
          CMATCH    "P",R
          GOTO      X340 IF EQUAL
X301      CMATCH    "N",R
          GOTO      X160 IF EQUAL
          CMATCH    "E",R
          GOTO      X330 IF EQUAL
          CMATCH    "I",R
          GOTO      X310 IF EQUAL
          CMATCH    "D",R
          GOTO      X320 IF EQUAL
          CMATCH    "R",R
          GOTO      X160 IF EQUAL
          GOTO      L040
X302      CMATCH    "N",R
          GOTO      E40 IF EQUAL
          GOTO      L040
.
X310      BRANCH    BFL OF X310A
          GOTO      X312
X310A     ADD       "1",REC
          COMPARE   REC,NREC
          GOTO      X311 IF LESS
          GOTO      X160
X311      MOVE      "1",REC
X312      ADD       "1",SEC
          GOTO      X160
.
X320      BRANCH    BFL OF X320A
          GOTO      X322
X320A     SUB       "1",REC
          COMPARE   "1",REC
          GOTO      X321 IF LESS
          GOTO      X160
X321      MOVE      NREC,REC
X322      SUB       "1",SEC
          GOTO      X160
.
X330      BEEP
          KEYIN     *P60:12,*EL,"WEOF (Y/N) ? ",R
          CMATCH    "N",R
          GOTO      X300 IF EQUAL
          CMATCH    "Y",R
          GOTO      X330 IF NOT EQUAL
          WEOF      A,SEC
          DISPLAY   *P60:12,*EL,"* DONE *",*W
          GOTO      X160
.
X340      MOVE      "0",LINES
          MOVE      "0",PAGE
          CALL      PRINTSEC
          CALL      ENDPR
          GOTO      X160
.
.
.
L040      MOVE      "0",OFL
          MOVE      N,LLTAB
          SUB       "1",LLTAB
          MULT      "10",LLTAB
          ADD       M,LLTAB
L40       KEYIN     *P67:2,"TAB:    ",*P72:2,TAB
          COMPARE   "999",TAB
          GOTO      L042 IF NOT EQUAL
          DISPLAY   *P78:2,"O"
          MOVE      "1",OFL
          GOTO      L40
L042      COMPARE   "0",TAB
          GOTO      L040E IF NOT EQUAL
          BRANCH    EFL OF E40,E40,E40
          GOTO      L60
L040E     BRANCH    RFL OF L040C
          SUB       FTAB,TAB
          ADD       "1",TAB
L040C     COMPARE   "1",TAB
          GOTO      L41 IF LESS
          COMPARE   TAB,LLTAB
          GOTO      L42 IF NOT LESS
          BRANCH    OFL OF L040D
          GOTO      L41
L040D     MOVE      LLTAB,TEMP3
          ADD       "1",TEMP3
          COMPARE   TAB,TEMP3
          GOTO      L41 IF NOT EQUAL
          COMPARE   "250",TEMP3
          GOTO      L42 IF LESS
L41       BEEP
          GOTO      L40
.
L42       MOVE      TAB,TABCNT
          MOVE      "1",N
          MOVE      "4",V
L43       COMPARE   "51",TAB
          GOTO      L44 IF LESS
          SUB       "50",TAB
          ADD       "2",V
          ADD       "5",N
          GOTO      L43
.
L44       MOVE      "6",H
          ADD       TAB,H
L45       COMPARE   "11",TAB
          GOTO      L47 IF LESS
          SUB       "10",TAB
          ADD       "1",N
          GOTO      L45
.
L47       KEYIN     *PH:V,*+,R
          RESET     R
          GOTO      L47A IF NOT EOS
          GOTO      L40
.
L47A      LOAD      TEMP FROM N OF CH1,CH2,CH3,CH4,CH5,CH6,CH7,CH8,CH9,CH10,CH11:
                    CH12,CH13,CH14,CH15,CH16,CH17,CH18,CH19,CH20:
                    CH21,CH22,CH23,CH24,CH25
          RESET     TEMP,TAB
          GOTO      L48A
.
L48       KEYIN     *PH:V,*+,R
          RESET     R
          GOTO      L50 IF EOS
          BUMP      TEMP
          GOTO      L48A IF NOT EOS
          EXTEND    TEMP
          GOTO      L48A IF NOT EOS
          CALL      L49C
L48A      CMATCH    "^",R
          GOTO      L49 IF NOT EQUAL
          MOVE      EOR,R
          GOTO      L49A
L49       CMATCH    "|",R
          GOTO      L49A IF NOT EQUAL
          MOVE      EOS,R
L49A      CMOVE     R,TEMP
          ADD       "1",TABCNT
          BRANCH    OFL OF L49B
          COMPARE   TABCNT,LLTAB
          GOTO      L49B IF NOT LESS
          GOTO      L50
L49B      COMPARE   "250",TABCNT
          GOTO      L50 IF NOT LESS
          ADD       "1",H
          COMPARE   "57",H
          GOTO      L48 IF NOT EQUAL
          MOVE      "7",H
          ADD       "2",V
          GOTO      L48
.
L49C      RESET     TEMP
          STORE     TEMP INTO N OF CH1,CH2,CH3,CH4,CH5,CH6,CH7,CH8,CH9,CH10,CH11:
                    CH12,CH13,CH14,CH15,CH16,CH17,CH18,CH19,CH20:
                    CH21,CH22,CH23,CH24,CH25
          ADD       "1",N
          LOAD      TEMP FROM N OF CH1,CH2,CH3,CH4,CH5,CH6,CH7,CH8,CH9,CH10,CH11:
                    CH12,CH13,CH14,CH15,CH16,CH17,CH18,CH19,CH20:
                    CH21,CH22,CH23,CH24,CH25
          RESET     TEMP
          RETURN
.
L50       RESET     TEMP
          STORE     TEMP INTO N OF CH1,CH2,CH3,CH4,CH5,CH6,CH7,CH8,CH9,CH10,CH11:
                    CH12,CH13,CH14,CH15,CH16,CH17,CH18,CH19,CH20:
                    CH21,CH22,CH23,CH24,CH25
L50A      COMPARE   TABCNT,LLTAB
          GOTO      L40 IF NOT LESS
          BRANCH    OFL OF L51
          GOTO      L41
L51       MOVE      TABCNT,LLTAB
          SUB       "1",LLTAB
          MOVE      TABCNT,TAB
          SUB       "1",TAB
          DIV       "10",TAB
          MOVE      TAB,NSAVE
          ADD       "1",NSAVE
          MULT      "10",TAB
          SUB       TAB,TABCNT
          MOVE      TABCNT,MSAVE
          SUB       "1",MSAVE
          GOTO      L40
.
L60       KEYIN     *P60:12,*EL,"POST (Y/N)? ",STR2
          MOVE      "0",WFL
          CMATCH    "N",STR2
          GOTO      L61 IF EQUAL
          CMATCH    "Y",STR2
          GOTO      L91 IF EQUAL
          CMATCH    "W",STR2
          GOTO      L60A IF NOT EQUAL
          MOVE      "1",WFL
          GOTO      L91
L60A      BEEP
          GOTO      L60
.
L61       MOVE      " ",R
          RESET     STR2,2
          GOTO      L62 IF EOS
          CMOVE     STR2,R
          GOTO      X301
L62       KEYIN     *P60:12,*EL,"MORE CHANGES?",R
          DISPLAY   *P72:2,*EL
          MOVE      NSAVE,N
          MOVE      MSAVE,M
          GOTO      X301
.
L91       MOVE      " ",R
          RESET     STR2,2
          GOTO      L91A IF EOS
          CMOVE     STR2,R
L91A      DISPLAY   *P60:12,*EL,"*** POSTING ***"
.
K99       COMPARE   "0",EFL
          GOTO      K99A IF EQUAL
          WRITE     A,SEC;" "
K99A      READ      A,SEC;*FTAB;
          BRANCH    NSAVE OF L95,K100,K100,K100,K100,K101,K101,K101,K101,K101:
                    K102,K102,K102,K102,K102,K103,K103,K103,K103,K103:
                    K104,K104,K104,K104,K105
          GOTO      L110
K100      MOVE      "1",N
          GOTO      K106
K101      WRITE     A,SEQ;*-,CH1,CH2,CH3,CH4,CH5;
          MOVE      "6",N
          GOTO      K106
K102      WRITE     A,SEQ;*-,CH1,CH2,CH3,CH4,CH5,CH6,CH7,CH8,CH9,CH10;
          MOVE      "11",N
          GOTO      K106
K103      WRITE     A,SEQ;*-,CH1,CH2,CH3,CH4,CH5,CH6,CH7,CH8,CH9,CH10:
                    CH11,CH12,CH13,CH14,CH15;
          MOVE      "16",N
          GOTO      K106
K104      WRITE     A,SEQ;*-,CH1,CH2,CH3,CH4,CH5,CH6,CH7,CH8,CH9,CH10:
                    CH11,CH12,CH13,CH14,CH15,CH16,CH17,CH18,CH19,CH20;
          MOVE      "21",N
          GOTO      K106
K105      WRITE     A,SEQ;*-,CH1,CH2,CH3,CH4,CH5,CH6,CH7,CH8,CH9,CH10:
                    CH11,CH12,CH13,CH14,CH15,CH16,CH17,CH18,CH19,CH20:
                    CH21,CH22,CH23,CH24;
          MOVE      "25",N
.
K106      LOAD      TEMP FROM N OF CH1,CH2,CH3,CH4,CH5,CH6,CH7,CH8,CH9,CH10,CH11:
                    CH12,CH13,CH14,CH15,CH16,CH17,CH18,CH19,CH20:
                    CH21,CH22,CH23,CH24,CH25
          COMPARE   N,NSAVE
          GOTO      L95 IF EQUAL
          WRITE     A,SEQ;*-,TEMP;
          ADD       "1",N
          GOTO      K106
.
L95       BRANCH    WFL OF L99
          BRANCH    MSAVE OF LL101,LL102,LL103,LL104,LL105,LL106,LL107:
                    LL108,LL109,LL109A
LL101     MOVE      TEMP,T1
          WRITE     A,SEQ;*-,T1;
          GOTO      L110
LL102     MOVE      TEMP,T2
          WRITE     A,SEQ;*-,T2;
          GOTO      L110
LL103     MOVE      TEMP,T3
          WRITE     A,SEQ;*-,T3;
          GOTO      L110
LL104     MOVE      TEMP,T4
          WRITE     A,SEQ;*-,T4;
          GOTO      L110
LL105     MOVE      TEMP,T5
          WRITE     A,SEQ;*-,T5;
          GOTO      L110
LL106     MOVE      TEMP,T6
          WRITE     A,SEQ;*-,T6;
          GOTO      L110
LL107     MOVE      TEMP,T7
          WRITE     A,SEQ;*-,T7;
          GOTO      L110
LL108     MOVE      TEMP,T8
          WRITE     A,SEQ;*-,T8;
          GOTO      L110
LL109     MOVE      TEMP,T9
          WRITE     A,SEQ;*-,T9;
          GOTO      L110
LL109A    WRITE     A,SEQ;*-,TEMP;
          GOTO      L110
.
L99       BRANCH    MSAVE OF L101,L102,L103,L104,L105,L106,L107,L108,L109:
                    L109A
L101      MOVE      TEMP,T1
          WRITE     A,SEQ;*-,T1
          GOTO      L110
L102      MOVE      TEMP,T2
          WRITE     A,SEQ;*-,T2
          GOTO      L110
L103      MOVE      TEMP,T3
          WRITE     A,SEQ;*-,T3
          GOTO      L110
L104      MOVE      TEMP,T4
          WRITE     A,SEQ;*-,T4
          GOTO      L110
L105      MOVE      TEMP,T5
          WRITE     A,SEQ;*-,T5
          GOTO      L110
L106      MOVE      TEMP,T6
          WRITE     A,SEQ;*-,T6
          GOTO      L110
L107      MOVE      TEMP,T7
          WRITE     A,SEQ;*-,T7
          GOTO      L110
L108      MOVE      TEMP,T8
          WRITE     A,SEQ;*-,T8
          GOTO      L110
L109      MOVE      TEMP,T9
          WRITE     A,SEQ;*-,T9
          GOTO      L110
L109A     WRITE     A,SEQ;*-,TEMP
.
L110      BRANCH    EFL OF E55,E55,E55
          CMATCH    "I",R
          GOTO      X310 IF EQUAL
          CMATCH    "D",R
          GOTO      X320 IF EQUAL
          CMATCH    "P",R
          GOTO      X340 IF EQUAL
          GOTO      X160
.
.
P1        MOVE      "0",LINES
          MOVE      "0",PAGE
          KEYIN     *P30:2,*EF:
                    *P1:4,"FIRST SECTOR: ":
                    *P21:4,"(-1 TO EXIT)":
                    *P15:4,FSEC,*EF
          COMPARE   "0",FSEC
          GOTO      X0 IF LESS
          MOVE      FSEC,SEC
          CALL      READSEC
          BRANCH    NSAVE OF P1
          BRANCH    BFL OF P10
          GOTO      P20
P10       KEYIN     *P20:4,*EF,"RECORD: ",FREC
          COMPARE   "1",FREC
          GOTO      P15 IF LESS
          COMPARE   FREC,NREC
          GOTO      P15 IF LESS
          GOTO      P30
P15       BEEP
          DISPLAY   *P5:12,"RECORD OUT OF RANGE",*W
          GOTO      P10
P20       BRANCH    SFL OF P30
          KEYIN     *P20:4,*EF,"FROM TAB: ",FTAB
          COMPARE   "1",FTAB
          GOTO      P25 IF LESS
          COMPARE   "250",FTAB
          GOTO      P25 IF NOT LESS
          MOVE      "250",LREC
          SUB       FTAB,LREC
          ADD       "1",LREC
          GOTO      P30
P25       BEEP
          GOTO      P20
.
READSEC   MOVE      "0",NSAVE
          TRAP      READERR IF IO
          TRAP      READERR IF RANGE
          READ      A,SEC;TEMP;
          TRAPCLR   IO
          TRAPCLR   RANGE
          RETURN
READERR   BEEP
          MOVE      "1",NSAVE
          DISPLAY   *P5:12,"SECTOR OUT OF RANGE",*W
          RETURN
.
P30       KEYIN     *P1:6,*EF,"LAST  SECTOR: ",LSEC
          MOVE      LSEC,SEC
          CALL      READSEC
          BRANCH    NSAVE OF P30
          COMPARE   FSEC,LSEC
          GOTO      P45 IF LESS
          BRANCH    BFL OF P40
          GOTO      P50
P40       KEYIN     *P20:6,*EF,"RECORD: ",LLREC
          COMPARE   "1",LLREC
          GOTO      P41 IF LESS
          COMPARE   LLREC,NREC
          GOTO      P41 IF LESS
          COMPARE   FSEC,LSEC
          GOTO      P50 IF NOT EQUAL
          COMPARE   FREC,LLREC
          GOTO      P45 IF LESS
          GOTO      P50
P41       BEEP
          DISPLAY   *P5:12,"RECORD OUT OF RANGE",*W
          GOTO      P40
P45       BEEP
          DISPLAY   *P5:12,"LAST PRIOR TO FIRST",*W
          GOTO      P1
.
P50       MOVE      FSEC,SEC
          MOVE      FREC,REC
          GOTO      X180
.
P100      CALL      PRINTSEC
          BRANCH    BFL OF P110
          GOTO      P130
P110      ADD       "1",REC
          COMPARE   REC,NREC
          GOTO      P120 IF LESS
          GOTO      P140
P120      MOVE      "1",REC
P130      ADD       "1",SEC
P140      COMPARE   SEC,LSEC
          GOTO      P160 IF LESS
          BRANCH    BFL OF P145
          GOTO      P150
P145      COMPARE   LSEC,SEC
          GOTO      P146 IF EQUAL
          GOTO      P150
P146      COMPARE   REC,LLREC
          GOTO      P160 IF LESS
P150      GOTO      X180
P160      CALL      ENDPR
          GOTO      P1
.
PRINTSEC  COMPARE   "0",LINES
          GOTO      PR40 IF NOT EQUAL
          ADD       "1",PAGE
          PRINT     *F:
                    *N,*25,"*** INFORMATION BUILDERS (AUST) PTY LTD - DATA FILE":
                    " REPAIR UTILITY V1.00  ***":
                    *110,"PAGE ",PAGE:
                    *N,*N
          RESET     NAME,9
          CMATCH    " ",NAME
          GOTO      PR10 IF EQUAL
          CMOVE     NAME,R
          RESET     NAME,8
          LENSET    NAME
          RESET     NAME
          PRINT     *15,"FILE : ",NAME,":DR",R
          GOTO      PR20
PR10      PRINT     *15,"FILE : ",NAME
PR20      PRINT     *N,*56,"+10",*67,"+20",*78,"+30",*89,"+40",*100,"+50":
                    *N,*35,"*-----------------------------------":
                    "------------------------------*"
          MOVE      "8",LINES
.
PR40      BRANCH    RFL OF PR50
          MOVE      FTAB,TEMP3
          GOTO      PR60
PR50      MOVE      "1",TEMP3
PR60      PRINT     *35,X,*46,X,*57,X,*68,X,*79,X,*90,X,*101,X
          ADD       "1",LINES
          BRANCH    BFL OF PR70
          GOTO      PR80
PR70      PRINT     *5,"SECTOR: ",SEC,"    RECORD: ",REC;
          GOTO      PR90
PR80      PRINT     *15,"SECTOR: ",SEC;
PR90      PRINT     *35,X,*40,TEMP3,".",*46,X,CH1,X,CH2,X,CH3,X,CH4,X,CH5,X
          ADD       "1",LINES
          ADD       "50",TEMP3
          COMPARE   "51",DLREC
          GOTO      PR998 IF LESS
          PRINT     *35,X,*40,TEMP3,".",*46,X,CH6,X,CH7,X,CH8,X,CH9,X,CH10,X
          ADD       "1",LINES
          ADD       "50",TEMP3
          COMPARE   "101",DLREC
          GOTO      PR998 IF LESS
          PRINT     *35,X,*40,TEMP3,".",*46,X,CH11,X,CH12,X,CH13,X,CH14,X,CH15,X
          ADD       "1",LINES
          ADD       "50",TEMP3
          COMPARE   "151",DLREC
          GOTO      PR998 IF LESS
          PRINT     *35,X,*40,TEMP3,".",*46,X,CH16,X,CH17,X,CH18,X,CH19,X,CH20,X
          ADD       "1",LINES
          ADD       "50",TEMP3
          COMPARE   "201",DLREC
          GOTO      PR998 IF LESS
          PRINT     *35,X,*40,TEMP3,".",*46,X,CH21,X,CH22,X,CH23,X,CH24,X,CH25,X
          ADD       "1",LINES
PR998     COMPARE   "50",LINES
          GOTO      PR999 IF LESS
          CALL      ENDPR
PR999     RETURN
.
ENDPR     COMPARE   "0",LINES
          RETURN    IF EQUAL
          PRINT     *35,X,*46,X,*57,X,*68,X,*79,X,*90,X,*101,X:
                    *N,*35,"*-----------------------------------":
                    "------------------------------*":
                    *N,*56,"+10",*67,"+20",*78,"+30",*89,"+40",*100,"+50"
          MOVE      "0",LINES
          RETURN
.
.
. ROUTINE TO EXTEND A FILE
.
E100      MOVE      "1",WFL
          KEYIN     *P30:2,*EF,"OVERWRITE AND EXTEND OPTION":
                    *P1:5,"0. EXIT":
                    *P1:6,"1. DEFAULT FORMAT":
                    *P1:7,"2. EXISTING FORMAT":
                    *P1:8,"3. NEW FORMAT":
                    *P1:9,EFL:
                    *P1:5,*EF
          BRANCH    EFL OF E10,E20,E30
          COMPARE   "0",EFL
          GOTO      X0 IF EQUAL
          BEEP
          GOTO      E100
.
E10       MOVE      "0000000000",CH1
          MOVE      "0000000000",CH2
          MOVE      "0000000000",CH3
          MOVE      "0000000000",CH4
          MOVE      "0000000000",CH5
          MOVE      "0000000000",CH6
          MOVE      "0000000000",CH7
          MOVE      "0000000000",CH8
          MOVE      "0000000000",CH9
          MOVE      "0000000000",CH10
          MOVE      "0000000000",CH11
          MOVE      "0000000000",CH12
          MOVE      "0000000000",CH13
          MOVE      "0000000000",CH14
          MOVE      "0000000000",CH15
          MOVE      "0000000000",CH16
          MOVE      "0000000000",CH17
          MOVE      "0000000000",CH18
          MOVE      "0000000000",CH19
          MOVE      "0000000000",CH20
          MOVE      "0000000000",CH21
          MOVE      "0000000000",CH22
          MOVE      "0000000000",CH23
          MOVE      "0000000000",CH24
          MOVE      "000000000^",CH25
          MOVE      "25",N
          MOVE      "9",M
          GOTO      X152
.
E19       DISPLAY   *P60:4,*EL:
                    *P60:6,*EL
          GOTO      E21
.
E20       GOTO      X152
E21       KEYIN     *P60:4,"FORMAT SEC:":
                    *P65:6,"(-1 TO EXIT)":
                    *P71:4,SEC:
                    *P65:6,*EL
          COMPARE   "0",SEC
          GOTO      E100 IF LESS
          GOTO      X230
.
E30       CLEAR     CH1
          GOTO      X152
E31       MOVE      "1",N
          MOVE      "1",NSAVE
          MOVE      "0",M
          MOVE      "0",MSAVE
          MOVE      "1",OFL
          MOVE      "1",TAB
          MOVE      "0",LLTAB
          DISPLAY   *P67:2,"TAB:",TAB:
                    *P78:2,"O"
          GOTO      L42
.
E40       DISPLAY   *P67:2,*EL:
                    *P60:12,*EL
E45       KEYIN     *P60:6,*EL:
                    *P60:8,*EL:
                    *P60:6,"FROM  SEC:":
                    *P65:8,"(ENTER -1 TO EXIT)":
                    *P71:6,FSEC
          COMPARE   "0",FSEC
          GOTO      E100 IF LESS
          KEYIN     *P60:8,*EL,"UP TO SEC: ",LSEC
          COMPARE   FSEC,LSEC
          GOTO      E45 IF LESS
          KEYIN     *P60:10,"OK TO PROCEED ? ",R
          CMATCH    "N",R
          GOTO      E45 IF EQUAL
          DISPLAY   *P60:10,*EL,"WRITING SEC"
          MOVE      FSEC,SEC
.
E50       DISPLAY   *P71:10,SEC
          GOTO      K99
E55       ADD       "1",SEC
          COMPARE   SEC,LSEC
          GOTO      E50 IF NOT LESS
E60       BEEP
          KEYIN     *P60:12,*EL,"WEOF (Y/N) ? ",R
          CMATCH    "N",R
          GOTO      E70 IF EQUAL
          CMATCH    "Y",R
          GOTO      E60 IF NOT EQUAL
          DISPLAY   *P71:10,SEC
          MOVE      "          ",TEMP
          WRITE     A,SEC;TEMP,TEMP,TEMP,TEMP,TEMP,TEMP:
                    TEMP,TEMP,TEMP,TEMP,TEMP,TEMP:
                    TEMP,TEMP,TEMP,TEMP,TEMP,TEMP:
                    TEMP,TEMP,TEMP,TEMP,TEMP,TEMP:
                    "         "
          WEOF      A,SEC
          DISPLAY   *P60:12,*EL,"   * DONE *",*W
E70       CLOSE     A
          OPEN      A,NAME
          GOTO      E100
.
          INC       STD001IO
.
