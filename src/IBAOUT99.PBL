.******************************************************************************
.* System         : Outpatients                                               *
.* Program        : IBAOUT99.PBL                                              *
.* Name           : Update Clinic Header Details                              *
.******************************************************************************
.* Date           : 25.02.2013                                                *
.* Author         : Ebon Clements                                             *
.* Function       : This will update the latest clinic header details for     *
.*                  for the selected clinics                                  *
.*                                                                            *
.* Modifications  :                                                           *
.******************************************************************************
.* V11.02.01 09/02/2022  Thanh T          TSK 0905641                         *
.*           Recompiled as OUTHEDFD changes                                   *
.* V10.04.01 28/03/2014  Patrick Adair    CAR 277862                          * 
.*           Changed PROC1000 to use OUTHEDA2 instead of OUTHEDA1             *
.* V10.03.00 25/02/2013  Ebon Clements    CAR 277862                          * 
.*           Created program                                                  *
.******************************************************************************
.
          INC       STD001FD
.
          INC       IBACONFD/INC
          INC       OUTCLIFD/INC
          INC       OUTCTYFD/INC
          INC       OUTHEDFD/INC
          INC       OUTSITFD/INC
          INC       PATHSPFD/INC
.
. ----- Program Variables -----
.
CLINIDFR  DIM       6
CLINIDTO  DIM       6
CLINTYFR  DIM       6
CLINTYTO  DIM       6
DIM9      DIM       9
DIM20     DIM       20
HOSPCODE  DIM       3
SITECODE  DIM       6
WEEKDYFR  FORM      1
WEEKDYTO  FORM      1
SESTIMFR  DIM       5
SESTIMTO  DIM       5
.
RETAIN01  DIM       1
RETAIN02  DIM       1
RETAIN03  DIM       1
RETAIN04  DIM       1
RETAIN05  DIM       1
RETAIN06  DIM       1
RETAIN07  DIM       1
RETAIN08  DIM       1
RETAIN09  DIM       1
RETAIN10  DIM       1
RETAIN11  DIM       1
RETAIN12  DIM       1
RETAIN13  DIM       1
RETAIN14  DIM       1
RETAIN15  DIM       1
RETAIN16  DIM       1
RETAIN17  DIM       1
.
NEWVL01A  DIM       40
NEWVL01B  DIM       40
NEWVL002  DIM       40
NEWVL003  DIM       20
NEWVL004  DIM       4
NEWVL005  DIM       1
NEWVL006  DIM       3
NEWVL007  DIM       1
NEWVL008  DIM       3
NEWVL009  DIM       1
NEWVL10A  DIM       40
NEWVL10B  DIM       40
NEWVL10C  DIM       40
NEWVL011  DIM       1
NEWVL012  DIM       1
NEWVL013  DIM       10
NEWVL014  DIM       1
NEWVL015  DIM       1
NEWVL016  DIM       1
NEWVL017  DIM       1
.
. ----- Program Constants -----
.
MON       INIT      "Monday"
TUE       INIT      "Tuesday"
WED       INIT      "Wednesday"
THU       INIT      "Thursday"
FRI       INIT      "Friday"
SAT       INIT      "Saturday"
SUN       INIT      "Sunday"
.
PRGID     INIT      "IBAOUT99"
PRGNAM    INIT      "Update Clinic Header Details"
VERSION   INIT      "V12.01.00"
.
.******************************************************************************
.*                                   MAIN0000                                 *
.*                                 Main Module                                *
.******************************************************************************
MAIN0000  CALL      INIT0000                * Initialise variables & open files
.
MAIN1000  CALL      OPTN0000                * Choose main option
          BRANCH    OPTION,MAIN2000,MAIN2000
          BRANCH    EXIT,MAIN9999
.
. Selection criteria keyin
.
MAIN2000  CALL      CSEL0000                * Clear selection criteria
          CALL      KSIT0000                * Keyin site code
          BRANCH    EXIT,MAIN1000
.
MAIN2010  CALL      KHOS0000                * Keyin hospital code
          BRANCH    EXIT,MAIN2000
.
MAIN2020  CALL      KCTY0000                * Keyin clinic type  
          BRANCH    EXIT,MAIN2010
.
MAIN2030  CALL      KCID0000                * Keyin clinic id  
          BRANCH    EXIT,MAIN2020
.
MAIN2035  CALL      KDAY0000                * Keyin day
          BRANCH    EXIT,MAIN2030
.
MAIN2040  CALL      KTIM0000                * Keyin start time
          BRANCH    EXIT,MAIN2035
.
          CALL      CONTQST                 * Ok to continue (Y/N/C) ?
          BRANCH    CEXIT,MAIN5000,MAIN1000,MAIN9999
          GOTO      MAIN1000
.
. Update values keyin
.
MAIN5000  CALL      CVAL0000                * Clear update values
          CALL      KCOM0000                * Keyin comments
          CALL      KCLC0000                * Keyin clinic location
          CALL      KPHN0000                * Keyin clinic phone
          CALL      KMRT0000                * Keyin mrt location 
          CALL      KPUL0000                * Keyin pulling list 
          CALL      KDEP0000                * Keyin department 
          CALL      KHIG0000                * Keyin high risk  
          CALL      KLDY0000                * Keyin send letter days
          CALL      KCHK0000                * Keyin using check in page 
.
          CALL      KINS0000                * Keyin instructions
          CALL      KGRP0000                * Keyin group bookings
          CALL      KEPS0000                * Keyin collect episode
          CALL      KDFD0000                * Keyin default doctot  
          CALL      KDOC0000                * Keyin enter doctor    
          CALL      KMLT0000                * Keyin multi disc      
          CALL      KPMI0000                * Keyin confirm pmi     
          CALL      KREF0000                * Keyin referral mandatory
.
          CALL      CONTQST                 * Ok to continue (Y/N/C) ?
          BRANCH    CEXIT,MAIN7000,MAIN1000,MAIN9999
          GOTO      MAIN1000
.
MAIN7000  CALL      PROC0000                * Process report
          GOTO      MAIN1000
.
MAIN9999  CHAIN     PGM
.
.******************************************************************************
.*                                   INIT0000                                 *
.*                        Initialise Variable & Open Files                    *
.******************************************************************************
INIT0000  CALL      DISPHEAD                * Display screen heading
.
          DISPLAY   *P56:24,"Opening controlf";
          OPEN      CONTROLF,"controlf"
.
          READ      CONTROLF,ZERO;*43,IBCNMHOS
.
          DISPLAY   *P64:24,"outsitaf";
          OPEN      OUTSITA1,"outsitaf"
.
          DISPLAY   *P64:24,"pathspaf";
          OPEN      PATHSPA1,"pathspaf"
.
INIT9999  RETURN
.
.******************************************************************************
.*                                  OPTN0000                                  *
.*                                Choose Option                               *
.******************************************************************************
OPTN0000  MOVE      ZERO,OPTION
          DISPLAY   *P1:3,*EF:
                    *P1:4,*V2LON,"0",*HOFF," = Exit":
                    *P1:5,*V2LON,"1",*HOFF," = Update Clinic Header Details":
                    *P1:7,"Select Option : ";
OPTN1000  KEYIN     *P17:7,*V2LON,*DV,UNDLN2,*P17:7,OPTION;
.
          COMPARE   ZERO,OPTION
          GOTO      OPTN9500 IF EQUAL
.
          BRANCH    OPTION,OPTN9000
.
          BEEP
          GOTO      OPTN1000
.
OPTN9000  MOVE      ZERO,EXIT
          GOTO      OPTN9999
.
OPTN9100  MOVE      ZERO,EXIT
          GOTO      OPTN9999
.
OPTN9500  MOVE      ONE,EXIT
OPTN9999  RETURN
.
.*********************************************************************
. Keyin OP site code                                       
.*********************************************************************
CSEL0000  MOVE      SP70,CLINIDFR 
          MOVE      SP70,CLINIDTO
          MOVE      SP70,CLINTYFR
          MOVE      SP70,CLINTYTO
          MOVE      SP70,HOSPCODE
          MOVE      SP70,SITECODE
          MOVE      ZERO,WEEKDYFR
          MOVE      ZERO,WEEKDYTO
          MOVE      SP70,SESTIMFR
          MOVE      SP70,SESTIMTO
.
CSEL9999  RETURN
.
.*********************************************************************
. Keyin OP site code                                       
.*********************************************************************
KSIT0000  DISPLAY   *P1:3,*V2LON,"Enter Selection Criteria"
.
          KEYIN     *P1:4,*EF:
                    *P1:4,"Site Code : ",*V2LON,SITECODE
.
          PACK      SITECODE,SITECODE,SP70
.
          MATCH     SP70,SITECODE
          GOTO      KSIT9100 IF EQUAL
.
.         Validate the clinic code
.
          PACK      KEY6,SITECODE,SP70
          CALL      RDSITA1
          BRANCH    OVRCD,KSIT7100
.
          CALL      OSDF0000                * open site dep. files
.
          DISPLAY   *P20:4,*V2LON,OSTDESC
          GOTO      KSIT9000 
.
KSIT7100  DISPLAY   *P1:24,*B,"Invalid Site Code.",*EL;
          CALL      HITENTER
          GOTO      KSIT0000
.
KSIT9000  MOVE      ZERO,EXIT
          GOTO      KSIT9999
.
KSIT9100  MOVE      ONE,EXIT
KSIT9999  RETURN
.
.*********************************************************************
. Keyin hospital code
.*********************************************************************
KHOS0000  KEYIN     *P1:5,*EF:
                    *P1:5,"Hospital Code : ",*V2LON,HOSPCODE
.
          IF        IBCNMHOS<>1
            PACK      HOSPCODE,SP70
            DISPLAY   *P21:5,*V2LON,HOSPCODE
            GOTO      KHOS9000
          ELSE
            PACK      HOSPCODE,HOSPCODE,SP70
          ENDIF
.
          MATCH     SP70,HOSPCODE
          GOTO      KHOS9100 IF EQUAL
.
.         Validate the clinic code
.
          PACK      KEY3,HOSPCODE,SP70
          CALL      RDPTHSP1
          BRANCH    OVRCD,KHOS7100
.
          DISPLAY   *P21:5,*V2LON,PTHSNAME
          GOTO      KHOS9000
.
KHOS7100  DISPLAY   *P1:24,*B,"Invalid Hosital Code.",*EL;
          CALL      HITENTER
          GOTO      KHOS0000
.
KHOS9000  MOVE      ZERO,EXIT
          GOTO      KHOS9999
.
KHOS9100  MOVE      ONE,EXIT
KHOS9999  RETURN
.
.*********************************************************************
. Keyin clinic type ranges
.*********************************************************************
KCTY0000  KEYIN     *P1:6,*EF:
                    *P1:6,"From Clinic Type : ",*V2LON,CLINTYFR
.
          PACK      CLINTYFR,CLINTYFR,SP70
.
          MATCH     SP70,CLINTYFR
          IF        @EQUAL
            GOTO      KCTY9100
          ENDIF
.
.         Validate the clinic code
.
          PACK      KEY12,SITECODE,CLINTYFR,SP70
          CALL      RDCTYA1
          BRANCH    OVRCD,KCTY7100
.
          MOVE      OCTDESC,DIM20
          DISPLAY   *P27:6,*V2LON,DIM20
.
KCTY5000  KEYIN     *P49:6,*EF:
                    *P49:6,"To : ",*V2LON,CLINTYTO
.
          PACK      CLINTYTO,CLINTYTO,SP70
.
          MATCH     SP70,CLINTYTO
          IF        @EQUAL
            GOTO      KCTY0000
          ENDIF
.
.         Validate the clinic code
.
          PACK      KEY12,SITECODE,CLINTYTO,SP70
          CALL      RDCTYA1
          BRANCH    OVRCD,KCTY8100
.
          MOVE      OCTDESC,DIM20
          DISPLAY   *P60:6,*V2LON,DIM20
.
          MATCH     CLINTYFR,CLINTYTO
          GOTO      KCTY9999 IF NOT LESS    * end >= start so OK
.
          DISPLAY   *P1:24,*B,"End value must be after Start value.  ",*EL;
          CALL      HITENTER
          GOTO      KCTY0000
.
KCTY7100  DISPLAY   *P1:24,*B,"Invalid Clinic Type From.",*EL;
          CALL      HITENTER
          GOTO      KCTY0000
.
KCTY8100  DISPLAY   *P1:24,*B,"Invalid Clinic Type To.",*EL;
          CALL      HITENTER
          GOTO      KCTY5000
.
KCTY9000  MOVE      ZERO,EXIT
          GOTO      KCTY9999
.
KCTY9100  MOVE      ONE,EXIT
.
KCTY9999  RETURN
.
.*********************************************************************
. Keyin clinic type ranges
.*********************************************************************
KCID0000  KEYIN     *P1:7,*EF:
                    *P1:7,"From Clinic ID : ",*V2LON,CLINIDFR
.
          PACK      CLINIDFR,CLINIDFR,SP70
.
          MATCH     SP70,CLINIDFR
          IF        @EQUAL
            DISPLAY   *P27:7,*V2LON,"Start"
            GOTO      KCID5000
          ENDIF
.
.         Validate the clinic code
.
          PACK      KEY20,SITECODE,CLINIDFR,Z70
          CALL      RDCLIA1
          IF        OVRCD=1
            CALL      RDPCLIA1          * Read Clinic Record
            BRANCH    OVRCD,KCID7100
.
            MATCH     SITECODE,OCASITE
            GOTO      KCID7100 IF NOT EQUAL
.
            MATCH     CLINIDFR,OCACLIN
            GOTO      KCID7100 IF NOT EQUAL
          ENDIF
.
          MOVE      OCADESC,DIM20
          DISPLAY   *P27:7,*V2LON,DIM20
.
KCID5000  KEYIN     *P49:7,*EF:
                    *P49:7,"To : ",*V2LON,CLINIDTO
.
          PACK      CLINIDTO,CLINIDTO,SP70
.
          MATCH     SP70,CLINIDTO
          IF        @EQUAL
            MOVE      Z70,CLINIDTO
            DISPLAY   *P60:7,*V2LON,"Finish"
            GOTO      KCID9000
          ENDIF
.
.         Validate the clinic code
.
          PACK      KEY20,SITECODE,CLINIDTO,Z70
          CALL      RDCLIA1
          IF        OVRCD=1
            CALL      RDPCLIA1          * Read Clinic Record
            BRANCH    OVRCD,KCID8100
.
            MATCH     SITECODE,OCASITE
            GOTO      KCID8100 IF NOT EQUAL
.
            MATCH     CLINIDTO,OCACLIN
            GOTO      KCID8100 IF NOT EQUAL
          ENDIF
.
          MOVE      OCADESC,DIM20
          DISPLAY   *P60:7,*V2LON,DIM20
.
          MATCH     CLINIDFR,CLINIDTO
          GOTO      KCID9999 IF NOT LESS    * end >= start so OK
.
          DISPLAY   *P1:24,*B,"End value must be after Start value.  ",*EL;
          CALL      HITENTER
          GOTO      KCID0000
.
KCID7100  DISPLAY   *P1:24,*B,"Invalid Clinic Id From.",*EL;
          CALL      HITENTER
          GOTO      KCID0000
.
KCID8100  DISPLAY   *P1:24,*B,"Invalid Clinic Id To.",*EL;
          CALL      HITENTER
          GOTO      KCID5000
.
KCID9000  MOVE      ZERO,EXIT
          GOTO      KCID9999
.
KCID9100  MOVE      ONE,EXIT
.
KCID9999  RETURN
.
.*********************************************************************
. Keyin clinic type ranges
.*********************************************************************
KDAY0000  KEYIN     *P1:8,*EF:
                    *P1:8,"From Week Day  : ",*V2LON,WEEKDYFR
.
          COMPARE   ZERO,WEEKDYFR
          GOTO      KDAY9100 IF EQUAL
.
          IF        WEEKDYFR>7
            GOTO      KDAY7100
          ENDIF
          MOVE      SP70,DIM9
          LOAD      DIM9,WEEKDYFR,MON,TUE,WED,THU,FRI,SAT,SUN
.
          DISPLAY   *P27:8,*V2LON,DIM9
.
KDAY5000  KEYIN     *P49:8,*EF:
                    *P49:8,"To : ",*V2LON,WEEKDYTO
.
          COMPARE   ZERO,WEEKDYTO
          GOTO      KDAY0000 IF EQUAL
.
          MOVE      SP70,DIM9
          LOAD      DIM9,WEEKDYTO,MON,TUE,WED,THU,FRI,SAT,SUN
.
          IF        WEEKDYTO>7
            GOTO      KDAY8100
          ENDIF
          DISPLAY   *P60:8,*V2LON,DIM9
.
          COMPARE   WEEKDYFR,WEEKDYTO
          GOTO      KDAY9999 IF NOT LESS    * end >= start so OK
.
          DISPLAY   *P1:24,*B,"End value must be after Start value.  ",*EL;
          CALL      HITENTER
          GOTO      KDAY0000
.
KDAY7100  DISPLAY   *P1:24,*B,"Invalid Week Day From.",*EL;
          CALL      HITENTER
          GOTO      KDAY0000
.
KDAY8100  DISPLAY   *P1:24,*B,"Invalid Week Day To.",*EL;
          CALL      HITENTER
          GOTO      KDAY5000
.
KDAY9000  MOVE      ZERO,EXIT
          GOTO      KDAY9999
.
KDAY9100  MOVE      ONE,EXIT
.
KDAY9999  RETURN
.
+
.*********************************************************************
. Keyin start time ranges           
.*********************************************************************
KTIM0000  UNPACK    SP4,CHOUR,CMIN
          MOVE      "19",CCOL
          MOVE      "9",CVERT
.
          KEYIN     *P1:9,*EF:
                    *P1:9,"Start Time From : "
.
          CALL      KEYTIME
          MATCH     SP2,CHOUR          * return hit?
          GOTO      KTIM9000 IF EQUAL
.
          BRANCH    OVRCD,KTIM0000
          PACK      SESTIMFR,CHOUR,COLON,CMIN
.
KTIM5000  UNPACK    SP4,CHOUR,CMIN
          MOVE      "54",CCOL
          MOVE      "9",CVERT
.
          KEYIN     *P49:9,*EF:
                    *P49:9,"To : "
.
          CALL      KEYTIME
          MATCH     SP2,CHOUR          * return hit?
          GOTO      KTIM0000 IF EQUAL
.
          BRANCH    OVRCD,KTIM5000
          PACK      SESTIMTO,CHOUR,COLON,CMIN
.
          MOVE      ZERO,EXIT          * exit=0 valid time
          GOTO      KTIM9999
.
KTIM9000  MOVE      ONE,EXIT
.
KTIM9999  RETURN
.
.*********************************************************************
.         Subroutine to open site dependant files
.*********************************************************************
OSDF0000  CLOSE     OUTHEDA2
          PACK      CFNAME,OSTFILE,FILHEDA2
          OPEN      OUTHEDA2,CFNAME
.
          CLOSE     OUTCTYA1
          PACK      CFNAME,OSTFILE,FILCTYA1
          OPEN      OUTCTYA1,CFNAME
.
          CLOSE     OUTCLIA1
          PACK      CFNAME,OSTFILE,FILCLIA1
          OPEN      OUTCLIA1,CFNAME
.
OSDF9999  RETURN
.
.*********************************************************************
. Clear update values
.*********************************************************************
CVAL0000  MOVE      ANSY,RETAIN01
          MOVE      SP70,NEWVL01A
          MOVE      SP70,NEWVL01B
.
          MOVE      ANSY,RETAIN02
          MOVE      SP70,NEWVL002
.
          MOVE      ANSY,RETAIN03
          MOVE      SP70,NEWVL003
.
          MOVE      ANSY,RETAIN04
          MOVE      SP70,NEWVL004
.
          MOVE      ANSY,RETAIN05
          MOVE      SP70,NEWVL005
.
          MOVE      ANSY,RETAIN06
          MOVE      SP70,NEWVL006
.
          MOVE      ANSY,RETAIN07
          MOVE      SP70,NEWVL007
.
          MOVE      ANSY,RETAIN08
          MOVE      SP70,NEWVL008
.
          MOVE      ANSY,RETAIN09
          MOVE      SP70,NEWVL009
.
          MOVE      ANSY,RETAIN10
          MOVE      SP70,NEWVL10A
          MOVE      SP70,NEWVL10B
          MOVE      SP70,NEWVL10C
.
          MOVE      ANSY,RETAIN11
          MOVE      SP70,NEWVL011
.
          MOVE      ANSY,RETAIN12
          MOVE      SP70,NEWVL012
.
          MOVE      ANSY,RETAIN13
          MOVE      SP70,NEWVL013
.
          MOVE      ANSY,RETAIN14
          MOVE      SP70,NEWVL014
.
          MOVE      ANSY,RETAIN15
          MOVE      SP70,NEWVL015
.
          MOVE      ANSY,RETAIN16
          MOVE      SP70,NEWVL016
.
          MOVE      ANSY,RETAIN17
          MOVE      SP70,NEWVL017
.
CVAL9999  RETURN
.
.*********************************************************************
. Keyin new value for comments     
.*********************************************************************
KCOM0000  DISPLAY   *P1:3,*V2LON,"Enter New Values"
.
          KEYIN     *P1:4,*EF:
                    *P1:4,"Clinic Comments. Retain Original Value : ":
                    " (",*V2LON,"Y",*HOFF,"/":
                    *V2LON,"N",*HOFF,") ? ",*V2LON,RETAIN01

          REP       UPPLOW,RETAIN01
          MATCH     ANSY,RETAIN01
          IF        @EQUAL
            GOTO      KCOM1000
          ENDIF
.
          MATCH     ANSN,RETAIN01
          IF        @EQUAL
            GOTO      KCOM1000
          ENDIF
.
          BEEP
          GOTO      KCOM0000
.
KCOM1000  KEYIN     *P1:5,"Comments Line 1: ",*V2LON,NEWVL01A
          KEYIN     *P1:6,"Comments Line 2: ",*V2LON,NEWVL01B
.
KCOM9999  RETURN
.
.*********************************************************************
. Keyin new value for clinic location
.*********************************************************************
KCLC0000  KEYIN     *P1:7,*EF:
                    *P1:7,"Clinic Location. Retain Original Value : ":
                    " (",*V2LON,"Y",*HOFF,"/":
                    *V2LON,"N",*HOFF,") ? ",*V2LON,RETAIN02

          REP       UPPLOW,RETAIN02
          MATCH     ANSY,RETAIN02
          IF        @EQUAL
            GOTO      KCLC1000
          ENDIF
.
          MATCH     ANSN,RETAIN02
          IF        @EQUAL
            GOTO      KCLC1000
          ENDIF
.
          BEEP
          GOTO      KCLC0000
.
KCLC1000  KEYIN     *P1:8,"Clinic Location : ",*V2LON,NEWVL002
.
KCLC9999  RETURN
.
.*********************************************************************
. Keyin new value for clinic phone
.*********************************************************************
KPHN0000  KEYIN     *P1:9,*EF:
                    *P1:9,"Clinic Phone Number. Retain Original Value : ":
                    " (",*V2LON,"Y",*HOFF,"/":
                    *V2LON,"N",*HOFF,") ? ",*V2LON,RETAIN03

          REP       UPPLOW,RETAIN03
          MATCH     ANSY,RETAIN03
          IF        @EQUAL
            GOTO      KPHN1000
          ENDIF
.
          MATCH     ANSN,RETAIN03
          IF        @EQUAL
            GOTO      KPHN1000
          ENDIF
.
          BEEP
          GOTO      KPHN0000
.
KPHN1000  KEYIN     *P1:10,"Clinic Phone : ",*V2LON,NEWVL003
.
KPHN9999  RETURN
.
.*********************************************************************
. Keyin new value for mrt location
.*********************************************************************
KMRT0000  KEYIN     *P1:11,*EF:
                    *P1:11,"MRT Location. Retain Original Value : ":
                    " (",*V2LON,"Y",*HOFF,"/":
                    *V2LON,"N",*HOFF,") ? ",*V2LON,RETAIN04

          REP       UPPLOW,RETAIN04
          MATCH     ANSY,RETAIN04
          IF        @EQUAL
            GOTO      KMRT1000
          ENDIF
.
          MATCH     ANSN,RETAIN04
          IF        @EQUAL
            GOTO      KMRT1000
          ENDIF
.
          BEEP
          GOTO      KMRT0000
.
KMRT1000  KEYIN     *P1:12,"MRT Location : ",*V2LON,NEWVL004
.
KMRT9999  RETURN
.
.*********************************************************************
. Keyin new value for exlude from pulling list
.*********************************************************************
KPUL0000  KEYIN     *P1:13,*EF:
                    *P1:13,"Exclude From Pulling List. ":
                           "Retain Original Value : ":
                    " (",*V2LON,"Y",*HOFF,"/":
                    *V2LON,"N",*HOFF,") ? ",*V2LON,RETAIN05

          REP       UPPLOW,RETAIN05
          MATCH     ANSY,RETAIN05
          IF        @EQUAL
            GOTO      KPUL1000
          ENDIF
.
          MATCH     ANSN,RETAIN05
          IF        @EQUAL
            GOTO      KPUL1000
          ENDIF
.
          BEEP
          GOTO      KPUL0000
.
KPUL1000  KEYIN     *P1:14,"Exclude From Pulling List : ",*V2LON,NEWVL005
.
KPUL9999  RETURN
.
.*********************************************************************
. Keyin new value for AH department
.*********************************************************************
KDEP0000  KEYIN     *P1:15,*EF:
                    *P1:15,"AH Department. ":
                           "Retain Original Value : ":
                    " (",*V2LON,"Y",*HOFF,"/":
                    *V2LON,"N",*HOFF,") ? ",*V2LON,RETAIN06

          REP       UPPLOW,RETAIN06
          MATCH     ANSY,RETAIN06
          IF        @EQUAL
            GOTO      KDEP1000
          ENDIF
.
          MATCH     ANSN,RETAIN06
          IF        @EQUAL
            GOTO      KDEP1000
          ENDIF
.
          BEEP
          GOTO      KDEP0000
.
KDEP1000  KEYIN     *P1:16,"AH Department : ",*V2LON,NEWVL006
.
KDEP9999  RETURN
.
.*********************************************************************
. Keyin new value for high risk     
.*********************************************************************
KHIG0000  KEYIN     *P1:17,*EF:
                    *P1:17,"High Risk. ":
                           "Retain Original Value : ":
                    " (",*V2LON,"Y",*HOFF,"/":
                    *V2LON,"N",*HOFF,") ? ",*V2LON,RETAIN07

          REP       UPPLOW,RETAIN07
          MATCH     ANSY,RETAIN07
          IF        @EQUAL
            GOTO      KHIG1000
          ENDIF
.
          MATCH     ANSN,RETAIN07
          IF        @EQUAL
            GOTO      KHIG1000
          ENDIF
.
          BEEP
          GOTO      KHIG0000
.
KHIG1000  KEYIN     *P1:18,"High Risk : ",*V2LON,NEWVL007
.
KHIG9999  RETURN
.
.*********************************************************************
. Keyin new value for no days prior to send letter
.*********************************************************************
KLDY0000  KEYIN     *P1:19,*EF:
                    *P1:19,"No. Days Prior to Send Letter. ":
                           "Retain Original Value : ":
                    " (",*V2LON,"Y",*HOFF,"/":
                    *V2LON,"N",*HOFF,") ? ",*V2LON,RETAIN08

          REP       UPPLOW,RETAIN08
          MATCH     ANSY,RETAIN08
          IF        @EQUAL
            GOTO      KLDY1000
          ENDIF
.
          MATCH     ANSN,RETAIN08
          IF        @EQUAL
            GOTO      KLDY1000
          ENDIF
.
          BEEP
          GOTO      KLDY0000
.
KLDY1000  KEYIN     *P1:20,"Days : ",*V2LON,NEWVL008
.
KLDY9999  RETURN
.
.*********************************************************************
. Keyin new value for using check in page
.*********************************************************************
KCHK0000  KEYIN     *P1:21,*EF:
                    *P1:21,"Using Check In Page. ":
                           "Retain Original Value : ":
                    " (",*V2LON,"Y",*HOFF,"/":
                    *V2LON,"N",*HOFF,") ? ",*V2LON,RETAIN09

          REP       UPPLOW,RETAIN09
          MATCH     ANSY,RETAIN09
          IF        @EQUAL
            GOTO      KCHK1000
          ENDIF
.
          MATCH     ANSN,RETAIN09
          IF        @EQUAL
            GOTO      KCHK1000
          ENDIF
.
          BEEP
          GOTO      KCHK0000
.
KCHK1000  KEYIN     *P1:22,"Check In Page : ",*V2LON,NEWVL009
.
KCHK9999  RETURN
.
.*********************************************************************
. Keyin new value for instructions
.*********************************************************************
KINS0000  DISPLAY   *P1:3,*V2LON,"Enter New Values"
.
          KEYIN     *P1:4,*EF:
                    *P1:4,"Clinic Instructions. Retain Original Value : ":
                    " (",*V2LON,"Y",*HOFF,"/":
                    *V2LON,"N",*HOFF,") ? ",*V2LON,RETAIN10

          REP       UPPLOW,RETAIN10
          MATCH     ANSY,RETAIN10
          IF        @EQUAL
            GOTO      KINS1000
          ENDIF
.
          MATCH     ANSN,RETAIN10
          IF        @EQUAL
            GOTO      KINS1000
          ENDIF
.
          BEEP
          GOTO      KINS0000
.
KINS1000  KEYIN     *P1:5,"Instructions Line 1 : ",*V2LON,NEWVL10A
          KEYIN     *P1:6,"Instructions Line 2 : ",*V2LON,NEWVL10B
          KEYIN     *P1:7,"Instructions Line 3 : ",*V2LON,NEWVL10C
.
KINS9999  RETURN
.
.*********************************************************************
. Keyin new value for allow group bookings
.*********************************************************************
KGRP0000  KEYIN     *P1:8,*EF:
                    *P1:8,"Allow Group Bookings. Retain Original Value : ":
                    " (",*V2LON,"Y",*HOFF,"/":
                    *V2LON,"N",*HOFF,") ? ",*V2LON,RETAIN11

          REP       UPPLOW,RETAIN11
          MATCH     ANSY,RETAIN11
          IF        @EQUAL
            GOTO      KGRP1000
          ENDIF
.
          MATCH     ANSN,RETAIN11
          IF        @EQUAL
            GOTO      KGRP1000
          ENDIF
.
          BEEP
          GOTO      KGRP0000
.
KGRP1000  KEYIN     *P1:9,"Group Bookings : ",*V2LON,NEWVL011
.
KGRP9999  RETURN
.
.*********************************************************************
. Keyin new value for collect episode details
.*********************************************************************
KEPS0000  KEYIN     *P1:10,*EF:
                    *P1:10,"Collect Episode Details. Retain Original Value : ":
                    " (",*V2LON,"Y",*HOFF,"/":
                    *V2LON,"N",*HOFF,") ? ",*V2LON,RETAIN12

          REP       UPPLOW,RETAIN12
          MATCH     ANSY,RETAIN12
          IF        @EQUAL
            GOTO      KEPS1000
          ENDIF
.
          MATCH     ANSN,RETAIN12
          IF        @EQUAL
            GOTO      KEPS1000
          ENDIF
.
          BEEP
          GOTO      KEPS0000
.
KEPS1000  KEYIN     *P1:11,"Episode Details : ",*V2LON,NEWVL012
.
KEPS9999  RETURN
.
.*********************************************************************
. Keyin new value for default doctor code 
.*********************************************************************
KDFD0000  KEYIN     *P1:12,*EF:
                    *P1:12,"Default Doctor Code. Retain Original Value : ":
                    " (",*V2LON,"Y",*HOFF,"/":
                    *V2LON,"N",*HOFF,") ? ",*V2LON,RETAIN13

          REP       UPPLOW,RETAIN13
          MATCH     ANSY,RETAIN13
          IF        @EQUAL
            GOTO      KDFD1000
          ENDIF
.
          MATCH     ANSN,RETAIN13
          IF        @EQUAL
            GOTO      KDFD1000
          ENDIF
.
          BEEP
          GOTO      KDFD0000
.
KDFD1000  KEYIN     *P1:13,"Default Doctor : ",*V2LON,NEWVL013
.
KDFD9999  RETURN
.
.*********************************************************************
. Keyin new value for enter doctor code
.*********************************************************************
KDOC0000  KEYIN     *P1:14,*EF:
                    *P1:14,"Enter Doctor Code. Retain Original Value : ":
                    " (",*V2LON,"Y",*HOFF,"/":
                    *V2LON,"N",*HOFF,") ? ",*V2LON,RETAIN14

          REP       UPPLOW,RETAIN14
          MATCH     ANSY,RETAIN14
          IF        @EQUAL
            GOTO      KDOC1000
          ENDIF
.
          MATCH     ANSN,RETAIN14
          IF        @EQUAL
            GOTO      KDOC1000
          ENDIF
.
          BEEP
          GOTO      KDOC0000
.
KDOC1000  KEYIN     *P1:15,"Enter Doctor : ",*V2LON,NEWVL014
.
KDOC9999  RETURN
.
.*********************************************************************
. Keyin new value for Multidisciplinary Clinic
.*********************************************************************
KMLT0000  KEYIN     *P1:16,*EF:
                    *P1:16,"Multidisciplinary Clinic. Retain Original Value : ":
                    " (",*V2LON,"Y",*HOFF,"/":
                    *V2LON,"N",*HOFF,") ? ",*V2LON,RETAIN15

          REP       UPPLOW,RETAIN15
          MATCH     ANSY,RETAIN15
          IF        @EQUAL
            GOTO      KMLT1000
          ENDIF
.
          MATCH     ANSN,RETAIN15
          IF        @EQUAL
            GOTO      KMLT1000
          ENDIF
.
          BEEP
          GOTO      KMLT0000
.
KMLT1000  KEYIN     *P1:17,"Multidisciplinary Clinic : ",*V2LON,NEWVL015
.
KMLT9999  RETURN
.
.*********************************************************************
. Keyin new value for confirm pmi
.*********************************************************************
KPMI0000  KEYIN     *P1:18,*EF:
                    *P1:18,"Confirm PMI. Retain Original Value : ":
                    " (",*V2LON,"Y",*HOFF,"/":
                    *V2LON,"N",*HOFF,") ? ",*V2LON,RETAIN16

          REP       UPPLOW,RETAIN16
          MATCH     ANSY,RETAIN16
          IF        @EQUAL
            GOTO      KPMI1000
          ENDIF
.
          MATCH     ANSN,RETAIN16
          IF        @EQUAL
            GOTO      KPMI1000
          ENDIF
.
          BEEP
          GOTO      KPMI0000
.
KPMI1000  KEYIN     *P1:19,"Confirm PMI : ",*V2LON,NEWVL016
.
KPMI9999  RETURN
.
.*********************************************************************
. Keyin new value for referral mandatory
.*********************************************************************
KREF0000  KEYIN     *P1:20,*EF:
                    *P1:20,"Referral Mandatory. Retain Original Value : ":
                    " (",*V2LON,"Y",*HOFF,"/":
                    *V2LON,"N",*HOFF,") ? ",*V2LON,RETAIN17

          REP       UPPLOW,RETAIN17
          MATCH     ANSY,RETAIN17
          IF        @EQUAL
            GOTO      KREF1000
          ENDIF
.
          MATCH     ANSN,RETAIN17
          IF        @EQUAL
            GOTO      KREF1000
          ENDIF
.
          BEEP
          GOTO      KREF0000
.
KREF1000  KEYIN     *P1:21,"Referral Mandatory : ",*V2LON,NEWVL017
.
KREF9999  RETURN
.
.******************************************************************************
.*                                  PROC0000                                  *
.* Process                                                                    *
.******************************************************************************
PROC0000  PACK      KEY31,SITECODE,HOSPCODE,SP70
          CALL      RSOTHED2
PROC1000  CALL      RKOTHED2
          BRANCH    OVRCD,PROC9999
.
          MATCH     SITECODE,OTHESITE             * Filter site
          GOTO      PROC9999 IF NOT EQUAL
.
          MATCH     HOSPCODE,OTHEHOSP             * Filter hospital
          GOTO      PROC9999 IF NOT EQUAL
.
          MATCH     CLINTYFR,OTHECTYP             * Filter clinic type from
          GOTO      PROC1000 IF LESS
.
          MATCH     OTHECTYP,CLINTYTO             * Filter clinic type to
          GOTO      PROC1000 IF LESS
.
          MATCH     CLINIDFR,OTHECLIN             * Filter clinic id from
          GOTO      PROC1000 IF LESS
.
          MATCH     OTHECLIN,CLINIDTO             * Filter clinic id to
          GOTO      PROC1000 IF LESS
.
          MOVE      WEEKDYFR,D1
          MATCH     D1,OTHEWDAY                   * Filter week day from
          GOTO      PROC1000 IF LESS
.
          MOVE      WEEKDYTO,D1
          MATCH     OTHEWDAY,D1                   * Filter week day to
          GOTO      PROC1000 IF LESS  
.
          MATCH     SESTIMFR,OTHESTRT             * Filter start time from
          GOTO      PROC1000 IF LESS
.
          MATCH     OTHESTRT,SESTIMTO             * Filter start time to
          GOTO      PROC1000 IF LESS
.
          MATCH     SP70,OTHEDTCC                 * Skip closed
          GOTO      PROC1000 IF NOT EQUAL    
.
          MATCH     "N",RETAIN01
          IF        @EQUAL
            MOVE      NEWVL01A,OTHECOM1
            MOVE      NEWVL01B,OTHECOM2
          ENDIF
.
          MATCH     "N",RETAIN02
          IF        @EQUAL
            MOVE      NEWVL002,OTHELTYP
          ENDIF
.
          MATCH     "N",RETAIN03
          IF        @EQUAL
            MOVE      NEWVL003,OTHECTEL
          ENDIF
.
          MATCH     "N",RETAIN04
          IF        @EQUAL
            MOVE      NEWVL004,OTHELOCN
          ENDIF
.
          MATCH     "N",RETAIN05
          IF        @EQUAL
            MOVE      NEWVL005,OTHEXPUL
          ENDIF
.
          MATCH     "N",RETAIN06
          IF        @EQUAL
            MOVE      NEWVL006,OTHEADEP
          ENDIF
.
          MATCH     "N",RETAIN07
          IF        @EQUAL
            MOVE      NEWVL007,OTHECLHR
          ENDIF
.
          MATCH     "N",RETAIN08
          IF        @EQUAL
            MOVE      NEWVL008,OTHENDPS
          ENDIF
.
          MATCH     "N",RETAIN09
          IF        @EQUAL
            MOVE      NEWVL009,OTHECPAG
          ENDIF
.
          MATCH     "N",RETAIN10
          IF        @EQUAL
            MOVE      NEWVL10A,OTHEINS1
            MOVE      NEWVL10B,OTHEINS2
            MOVE      NEWVL10C,OTHEINS3
          ENDIF
.
          MATCH     "N",RETAIN11
          IF        @EQUAL
            MOVE      NEWVL011,OTHEGBOK
          ENDIF
.
          MATCH     "N",RETAIN12
          IF        @EQUAL
            MOVE      NEWVL012,OTHECENC
          ENDIF
.
          MATCH     "N",RETAIN13
          IF        @EQUAL
            MOVE      NEWVL013,OTHEDEFD
          ENDIF
.
          MATCH     "N",RETAIN14
          IF        @EQUAL
            MOVE      NEWVL014,OTHEDEFD
          ENDIF
.
          MATCH     "N",RETAIN15
          IF        @EQUAL
            MOVE      NEWVL015,OTHEMLTD
          ENDIF .
          MATCH     "N",RETAIN16
          IF        @EQUAL
            MOVE      NEWVL016,OTHECPMI
          ENDIF
.
          MATCH     "N",RETAIN17 
          IF        @EQUAL
            MOVE      NEWVL017,OTHEMREF
          ENDIF
.
          CALL      UPOTHED2
          GOTO      PROC1000
.
PROC9999  RETURN
.
          INC       STD001IO
.
          INC       OUTCLIIO/INC
          INC       OUTCTYIO/INC
          INC       OUTHEDIO/INC            * Clinic master header file
          INC       OUTSITIO/INC
          INC       PATHSPIO/INC
