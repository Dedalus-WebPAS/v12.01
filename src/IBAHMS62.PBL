.******************************************************************************
.*                                                                            *
.*                        P R O G R A M   S U M M A R Y                       *
.*                        -------------   -------------                       *
.*                                                                            *
.*      PROGRAM NAME:     IBAHMS62                                            *
.*                                                                            *
.*      FUNCTION:         INVOICE PENDING REPORT (for St Vincents)            *
.*                                                                            *
.*      DATE WRITTEN:     11/08/92                                            *
.*                                                                            *
.*      MODIFICATIONS:                                                        *
.*                                                                            *
.*----------------------------------------------------------------------------*
.* V11.05.02 04/02/2025 J.Tan           TSK 0952533                           *
.*           Recompiled for PATCATBI - changes for MV using Ventilation file  *
.*           14/02/2025 J.Tan           TSK 0946490                           *
.*           Recompiled for PATCATBI - Changes for MV CWO Payment Model       *
.*           14/02/2025 J.Tan           TSK 0955356                           *
.*           Recompiled for PATCALF - writting to Financial Summary details   *
.* V11.05.01 29/11/2024  Bella Turco    TSK 0947710                           *
.*           Fixed All Theatre Charges column displays causing weird bugs in  *
.*           report (PELN1000)                                                *
.* V11.04.08 23/10/2024 J.Tan             TSK 0951578                         *
.*           Recompiled for ABFPTINV-Added Minutes to round up ICU Hours (ABF)*
.* V11.04.07 18/10/2024  Bella Turco    TSK 0947710                           *
.*           All Theatre Charges column displays N/A when patient not been to *
.*           theatre (PELN0000)                                               *
.* V11.04.06 23/09/2024  J.Tan          TSK 0949848                           *
.*           Recompiled for ABFPTINV - DRG List used in for COVID Adjustor    *
.* V11.04.05 23/09/2024 J.Tan           TSK 0950577                           *
.*           Recompiled for PATIPERH - Fixed Hold Invoice audit issue         *
.* V11.04.04 11/09/2024  J.Tan          TSK 0947315                           *
.*           Recompiled for ABFPTINV - fixed Total Unqualified                *
.* V11.04.03 01/08/2024  J.Tan          TSK 0947804                           *
.*           Recompiled for ABFMHINV - Changes for Discharges after 1/7/2023  *
.* V11.04.02 17/07/2024  J.Tan          TSK 0947315                           *
.*           Recompiled for ABFPTINV (LOS ICU adjusted & Newborn)             *
.* V11.04.01 15/03/2024  J.Tan          TSK 0910994                           *
.*           Recompiled for CMXMATRX                                          *
.* V11.03.07 17/11/2023  J.Tan          TSK 0940089                           *
.*           Recompiled for ABFPTINV - checking for blank Disc.DRG            *
.* V11.03.06 13/11/2023  J.Tan          TSK 0939019                           *
.*           Recompiled for ABFPTINV - HAC ICD10 Edition 12                   *
.* V11.03.05 04/10/2023  J.Tan          TASK 0938230                          *
.*           Recompiled for ABFAECCL - Emergency ABF                          *
.* V11.03.04 29/08/2023  J.Tan          TSK 0916870                           *
.*           Recompiled for ABFPTINV - Claim code Cat CL Multiple NEP value   *
.* V11.03.03 15/06/2023  J.Tan          TSK 0923703                           *
.*           Recompiled for ABF new calculations                              *
.* V11.03.02 30/05/2023  Davin          TSK 0933052                           *
.*           Added check for CodeFocus InvoiceOnHold reason (CHLD0000)        *
.* V11.03.01 05/04/2023 Bella Turco     TSK 0911166                           *
.*           Recompiled for PATIPERH - Hold Invoice Audit                     *
.* V11.02.04 20/07/2022 J.Tan           TSK 0922228                           *
.*           Mod checking for Patient Hold invoice                            *
.* V11.02.03 15/07/2022 J.Tan           TSK 0922228                           *
.*           Mod to update/check status of Hold invoice                       *
.* V11.02.02 29/06/2022 J.Tan           TSK 0920712                           *
.*           Recompiled for ABFAECCL - I*D on emrvcdaf file                   *
.* V11.02.01 03/03/2022  J.Tan           TSK 0902652                          *
.*           Recompiled for OUTCATBI/AAECATBI - Pat.Invoice new functionality *
.* V11.01.09 17/11/2021  J.Tan          TSK 0913621                           *
.*           Recompiled for ABFPTINV - Mod for Multiple NEP Values            *
.* V11.01.08 28/10/2021 J.Tan           TSK 0913056                           *
.*           Recompiled for ABFAECCL-ADMFLAG and CCAR0000(Clinical Care)      *
.* V11.01.07 13/10/2021 J.Tan           TSK 0905305                           *
.*           Recompiled for ABFAECCL - Adjustment type 068 & 069              *
.* V11.01.06 29/09/2021  J.Tan          TSK 0901515                           *
.*           Recompiled for CMXMATRX - Added Primary Proc.to Matrix           *
.* V11.01.05 14/09/2021  J.Tan          TSK 0906222                           *
.*           Recompiled for ABFPTINV - Mod for Multiple NEP Values            *
.* V11.01.04 09/08/2021  J.Tan           TSK 0905305                          *
.*           Recompiled for AAECATBI - AE Care class (ABFAECCL)               *
.* V11.01.03 07/07/2021  J.Tan           TSK 0908588                          *
.*           Recompiled for PATCATBI -Exclude Unqualified days for Casepayment*
.* V11.01.02 28/04/2021  Thanh T         TSK 0895165                          *
.*           Recompiled for OPRARDFD changes                                  *
.*           07/04/2021  Tracey Nguyen   TSK 0901515                          *
.*           Recompiled for PMSCMTFD - Added new fields                       *
.*           a) 1 File type for ICD procedure (PMCCIPF)                       *
.*           b) 3 new CMBS Field Type (PMCCFTS4/PMCCFT5C/PMCCFT6C)            *
.*           c) 3 new CMBS Codes From (PMCCPC4F,PMCCSC5F,PMCCTC6F)            *
.*           d) 3 new CMBS Codes To   (PMCCPC4T/PMCCSC5T,PMCCTC6T)            *
.*           27/04/2021  J.Tan           TSK 0863287                          *
.*           Mod for Patient Invoice new functionality                        *
.* V11.01.01 10/03/2021  Tracey Nguyen   TSK 0901515                          *
.*           Recompiled for PMSCMTFD - Added Primary ICD Procedure 1-5        *
.*           (PMCCICP1-5)                                                     *
.*----------------------------------------------------------------------------*
.*        V11.00.10 10/11/2020  J.Tan           TSK 0899562                   *
.*                  Recompiled for CMXMATRX - setup date for reading MBS item *
.*        V11.00.09 29/09/2020  J.Tan          TSK 0896829                    *
.*                  Recompiled for CMXMATRX - use National(PTPGNDRG)DRG       *
.*        V11.00.08 22/09/2020  J.Tan           TSK 0895330                   *
.*                  Recompiled for CMXMATRX - reposition read of Matrix table *
.*        V11.00.07 20/07/2020  J.Tan           TSK 0892319                   *
.*                  Recompiled for ABFPTINV - Additional NEP and Psych.Adjus. *
.*        V11.00.06 14/07/2020  J.Tan          TSK 0892902                    *
.*                  Recompiled for PATCATBI - Mod to initialise CASMXKEY      *
.*        V11.00.05 01/07/2020  J.Tan           TSK 0892765                   *
.*                  Recompiled for PATCATBI-Low outlier exc. unqualified days *
.*                  05/07/2020  J.Tan           TSK 0892746                   *
.*                  Recompiled for ABFPTINV - CALCAGE as at Admission date    *
.*        V11.00.04 29/06/2020  J.Tan           TSK 0893767                   *
.*                  Recompiled for ABFPTINV - Changed CALCFLAG to 01/01/2021  *
.*        V11.00.03 20/04/2020 J.Tan           TSK 0890733                    *
.*                  Recompiled for ABFPTINV - ABF new 2020 calculation        *
.*        V11.00.02 07/05/2020  J.Tan            TSK 0891341                  *
.*                  Recompiled for ABFOTINV - added TRAP to write pmsabfaf    *
.*        V11.00.01 20/03/2020  J.Tan          TSK 0838262                    *
.*                  Added Effective from and to date to MBS Item file         *
.*        V10.15.02 11/10/2019  Peter Vela       TSK 0882906                  *
.*                  Recompiled for OUTCATBI - Fixed I*C for OUTBB1 ABF        *
.*        V10.15.01 07/09/2019  J.Tan            TSK 0882545                  *
.*                  Mod to clear Disc.record                                  *
.*        V10.14.03 09/09/2019  J.Tan           TSK 0857392                   *
.*                  Recompiled for ABF invoice                                *
.*        V10.14.02 21/05/2019  J.Tan           TSK 0857392                   *
.*                  Recompiled for ABF Invoices                               *
.*        V10.14.01 22/03/2019  J.Tan            TSK 0857392                  *
.*                  Changed RCP Transaction count from DIM3 to DIM5           *
.*        V10.13.03 11/01/2019  Peter Vela     TSK 0867807                    *
.*                  Recompiled for OUTCATBI                                   *
.*        V10.13.02 26/10/2018  Thanh T        TSK 0859743                    *
.*                  Added BULKBILL field and removed OUTHEDFD/OUTHEDIO,       *
.*                  OUTSESFD/OUTSESIO for OUTCATBI changes                    *
.*        V10.13.01 25/10/2018  Thanh T        TSK 0859743                    *
.*                  Added OUTHEDFD/OUTHEDIO, OUTSESFD/OUTSESIO for OUTCATBI   *
.*                  changes                                                   *
.*----------------------------------------------------------------------------*
.*        V10.12.01 18/07/2018  J.Tan          TSK 0859911                    *
.*                  Recompiled for PATCATBI - Fixed No Payday Add on charge   *
.*        V10.11.01 07/09/2017  J.Tan         TSK 0837479                     *
.*                  Recompiled for CMXMATRX - Consumption type items          *
.*        V10.10.02 13/06/2017  J.Tan          TSK 0839991                    *
.*                  Recompiled for PATDBTYP (PATCMSTP)                        *
.*        V10.10.01 25/01/2017  J.Tan          TSK 0832407                    *
.*                  Recompiled for PATCATBI- multi bed trans on sameday for MV*
.*                  04/04/2017  J.Tan         TSK 0297904                     *
.*                  Recompiled for PATCMSTP - Non-Accumulative inlier ICU/CCU *
.*        V10.08.08 06/10/2016  J.Tan         TSK 0826824                     *
.*                  Recompiled for CALCMVHR - MV Hours                        *
.*        V10.08.07 21/09/2016  J.Tan         TSK 0826370                     *
.*                  Recompiled for CMXMATRX - Chgd MCHGARR MCHGAMT array to F3*
.*        V10.08.06 26/08/2016  Don Nguyen    TSK 0312570                     *
.*                  Recompiled for CMXMATRX - Added check for PTCNDGED=1      *
.*                  Added PMSEDGFD/IO and GETEFDRG                            *
.*        V10.08.05 17/08/2016  J.Tan         TSK 0808745                     *
.*                  Recompiled for PATCATBI - for NPDAYFLG=1                  *
.*        V10.08.04 20/07/2016  J.Tan         TSK 0819914                     *
.*                  Recompiled for PATCATBI - Non ICU MV Hours                *
.*        V10.08.03 15/07/2016  J.Tan         TSK 0819914                     *
.*                  Recompiled for PATCATBI - Calculating non ICU MV hours    *
.*        V10.08.02 20/06/2016  J.Tan         TSK 0820816                     *
.*                  Recompiled for PATCATBI - Fixed No payday for Daycase     *
.*        V10.08.01 02/06/2016  J.Tan         TSK 0816651                     *
.*                  Recompiled for PATCATBI-Continuous Bill.to chk for Matrix *
.*        V10.07.03 04/03/2016  J.Tan         CAR 290448                      *
.*                  Recompiled for PATCATBI - Mods for Addon with No Pay DAy  *
.*        V10.07.02 18/11/2015  J.Tan         CAR 303942                      *
.*                  Added new payment types                                   *
.*        V10.07.01 15/10/2015  J.Tan          CAR 322442                     *
.*                  Recompiled for PATCATBI -Fixed TOTDAYS for Casepay.daycase*
.*        V10.06.02 15/07/2015  J.Tan          CAR 319342                     *
.*                  Recompiled for CMXMATRX - Chg 'Disc.UDF' to 'Care Class'  *
.*        V10.06.01 14/07/2015  Peter Vela     CAR 318700                     *
.*                  Recompiled for PRBILCMN - Validate for deleted VISMDT     *
.*                  record                                                    *
.*        V10.05.01 04/08/2014 J.Tan           CAR 304397                     *
.*                  Mods to check Suggested classification for charging       *
.*        V10.04.05  03/07/2014 J.Tan           CAR 268860                    *
.*                   Recompiled for PATCATBI - ICD10 Suggested Classification *
.*        V10.04.04 19/06/2014 J.Tan           CAR 302452                     *
.*                  Recompiled for PATDINVS - Changed MCHGARR/MCHGAMT         *
.*        V10.04.03 12/06/2014 Steve Armstrong  CAR 301639                    *
.*                  Moved call to TFILENAM for TMPFNAME to start of program   *
.*                  and added call to KILL0000 on exit of program.            *
.*        V10.04.02 11/06/2014 Sandra Barcham  CAR 301639                     *
.*                  Moved call to TFILENAM to INIT0000                        *
.*        V10.04.01 27/05/2014  J.Tan          CAR 300784                     *
.*                  Recompiled for STEPDOWN - force stepdown prior inv.fromdat*
.******************************************************************************
.*        V10.03.12 13/12/2013  J.Tan          CAR 294609                     *
.*                  Recompiled for CMXMATRX - mods for Default Grouper Version*
.*        V10.03.11 14/11/2013  J.Tan          CAR 285294                     *
.*                  Added option to create Export file                        *
.*        V10.03.10 07/11/2013  J.Tan          CAR 283618                     *
.*                  Recompiled for PATCATBI - mods for Ind.Services Billing   *
.*        V10.03.09 02/10/2013  J.Tan          CAR 291588                     *
.*                  Recompiled for PATCATBI - fixed stepdown return from leave*
.*        V10.03.08 14/08/2013  J.Tan          CAR 288416                     *
.*                  Recompiled for PATCATBI - fixed Days of Hosps.            *
.*        V10.03.07 05/08/2013  J.Tan          CAR 288060                     *
.*                  Recompiled for CMXMATRX - fixed Primary/Secondary/Tertiary*
.*        V10.03.06 06/05/2013  J.Tan          CAR 284902                     *
.*                  Recompiled for STEPDOWN - force stepdown prior Inv.Fromdat*
.*        V10.03.05 10/04/2013  J.Tan    CAR 283743                           *
.*                  Recompiled for PATCATBI -  reset PTTRESPD for New Stepdown*
.*        V10.03.04 05/03/2013  Patrick Adair CAR 281898                      *
.*                  Recompiled for PATCATBI PATCATAI                          *
.*        V10.03.03 24/12/2012 Patrick Adair                       CAR 261630 *
.*                  Removed port number from temp file name                   *
.*                  Also fixed existing undocumented restriction              *
.*                  PTCNPEFR was being read from sector 105, which is         *
.*                  strange as it exist in sector 80! Corrected sector        *
.*                  read to be sector 80 - 10.03 only                         *
.*        V10.03.02 07/12/2012  J.Tan          CAR 277777                     *
.*                  Fixed I*C on patfn1af file                                *
.*        V10.03.01 21/09/2012  J.Tan          CAR 271474                     *
.*                  Recompiled for CMXMATRX - using index 5 of pmscmtaf       *
.*                  04/12/2012  J.Tan          CAR 262673                     *
.*                  Recompiled for PATCATBI - Casepayment perdiem rate        *
.*        V10.01.02 23/02/2011  Peter Vela    CAR 233034                      *
.*                  Removed PATBF2FD and PATBF2IO                             *
.*        V10.01.01 20/12/2010  Mike Laming   CAR 233046                      *
.*                  Recompiled for PABXBILL - Mods to Misc.Charges PATMCHFD   *
.*        V10.00.08 27/09/2010 J.Tan      CAR 230664                          *
.*                  Recompiled for AAECATBI - HEC Invoice layout              *
.*        V10.00.07 11/08/2010 J.Tan         CAR 227873                       *
.*                  Recompiled for CMXMATRX- getting the grouper version      *
.*        V10.00.06 11/08/2010 J.Tan         CAR 227873                       *
.*                  Recompiled for CMXMATRX-searching for next rules of matrix*
.*        V10.00.05 03/08/2010  J.Tan         CAR 227319                      *
.*                  Recompiled for PATCATBI - Mechanical Ventilation          *
.*        V10.00.04 14/07/2010  J.Tan         CAR 226158                      *
.*                  Recompiled for STEPDOWN - bed fees update                 *
.*        V10.00.03 16/07/2010 J.Tan         CAR 226322                       *
.*                  Recompiled for CMXMATRX - search for next rule if Contract*
.*                  is not valid                                              *
.*        V10.00.02 12/07/2010  J.Tan         CAR 225932                      *
.*                  Recompiled for PATCATBI - set TDATE to IDATET for per-diem*
.*        V10.00.01 07/06/2010  Mike Laming   CAR 212864                      *
.*                  Recompiled for PATCATBI - mods at GCDE6500                *
.*        V9.12.13  11/03/2010  J.Tan         CAR 216044                      *
.*                  Mods to include Leave days in stepdown count for TAC      *
.*        V9.12.12  16/02/2010  Peter Vela    CAR 215485                      *
.*                  Recompiled for PATCATBI - Ignore Leave if less than 1 day *
.*        V9.12.11  05/02/2010  Peter Vela    CAR 215485                      *
.*                  Recompiled for PATCATBI - Ignore Leave if less than 1 day *
.*        V9.12.10  02/02/2010  Davin         CAR 215234                      *
.*                  Recompiled for CMXMATRX                                   *
.*        V9.12.09  27/01/2010  J.Tan         CAR 214548                      *
.*                  Recompiled for PATCATBI - Stepdown after bed fees update  *
.*                  27/01/2010  J.Tan         CAR 214877                      *
.*                  Recompiled for CMXMATRX - Checking for range of MBS items *
.*        V9.12.08  19/01/2010  J.Tan         CAR 166439                      *
.*                  Recompiled for PATCMSTP - C/P additional charge stepdown  *
.*        V9.12.07  24/11/2009  Davin         CAR 210721                      *
.*                  Recompiled for CHKCMXPT - I*C on patcmxaf file            *
.*        V9.12.06  09/10/2009  J.Tan         CAR 203934                      *
.*                  Recompiled for PATCATBI - display ICD10 Sugg.Class on Inv.*
.*        V9.12.05  21/09/2009  J.Tan         CAR 204390                      *
.*                  Recompiled for STEPDOWN - mods to old bed fees file       *
.*        V9.12.04  24/07/2009  J.Tan         CAR 201132 & 202168             *
.*                  Recompiled for CMXMATRX - checking for zero MBS amount    *
.*        V9.12.03  03/07/2009  Peter Vela    CAR 199927                      *
.*                  Recompiled for EMROPOCK - Check if PMMIAMTT = 0 GPRC4000  *
.*        V9.12.02  05/06/2009  J.Tan         CAR 196010                      *
.*                  Recompiled for CMXMATRX - ICD10 Secondary/Tertiary        *
.*        V9.12.01  11/05/2009  J.Tan         CAR 125842                      *
.*                  Recompiled for PATCATBI - Recalculate zero amt of Misc.Itm*
.*        V9.11.03  16/03/2009  J.Tan         CAR 188205                      *
.*                  Recompiled for PATCATBI - Mods to Non-banked Deposits     *
.*        V9.11.02  20/11/2008  Steve Armstrong   CAR 181373                  *
.*                  Recompiled for changes to PATCATBI.                       *
.*        V9.11.01  30/10/2008 J.Tan      CAR 181263                          *
.*                  Recompiled for PATCATAI - printing Disch.Billing Statement*
.******************************************************************************
.*        V9.10.05  25/09/2008  J.Tan         CAR 178209                      *
.*                  Recompiled for PATCATBI - Fixed checking for Doct.chg rec.*
.*                  25/09/2008  J.Tan         CAR 179009                      *
.*                  Recompiled for STEPDOWN - Check 'Exclude Days of Hosp."   *
.*        V9.10.04  05/09/2008  J.Tan         CAR 177126                      *
.*                  Recompiled for PATCATBI - Checking matrix parameter       *
.*        V9.10.03  06/08/2008 J.Tan      CAR 175246                          *
.*                  Recompiled for AAECATBI                                   *
.*        V9.10.02  08/07/2008 Sandra Barcham CAR 173135                      *
.*                  Recompiled for PATCATBI - Remove close of PATDGWA1        *
.*        V9.10.01  12/05/2008  J.Tan         CAR 162313                      *
.*                  Added Deposit Status to compdeaf file                     *
.******************************************************************************
.*        V9.09.13  04/03/2008 J.Tan          CAR 157583                      *
.*                  Recompiled for AAECATBI-Invoice total with 'Out of Pocket"*
.*        V9.09.12  29/02/2008  J.Tan         CAR 162893 & 162609             *
.*                  Recompiled for PATCATBI - Inv.breakdown and Lumpsum amt   *
.*        V9.09.11  20/02/2008  Peter Vela    CAR 161535                      *
.*                  Recompiled for PATCATBI                                   *
.*        V9.09.10  23/01/2008  J.Tan         CAR 159701                      *
.*                  Added option to print zero invoice                        *
.*        V9.09.09  03/01/2008  J.Tan         CAR 136785                      *
.*                  Recompiled for STEPDOWN                                   *
.*        V9.09.08  12/11/2007 J.Tan       CAR 151803                         *
.*                  Recompiled for AAECATBI - ED Billing                      *
.*        V9.09.07  24/08/2007  Peter Vela CAR 146143                         *
.*                  Recompiled for PATCATBI                                   *
.*        V9.09.06  20/08/2007 J.Tan          CAR 144656                      *
.*                  Recompiled for PATCATBI - for Multiple Procedures Billing *
.*        V9.09.05  10/08/2007  Peter Vela CAR 146143                         *
.*                  Recompiled for PATCATAI                                   *
.*        V9.09.04  17/07/2007  J.Tan     CAR 140282                          *
.*                  Recompiled for NZPCATBI - Revenue breakdown               *
.*        V9.09.03  03/07/2007  Peter Vela CAR 142173                         *
.*                  Recompiled for PATCATAI                                   *
.*        V9.09.02  29/06/2007  Peter Vela CAR 142173                         *
.*                  Recompiled for PATCATAI                                   *
.*        V9.09.01  07/06/2007 J.Tan             CAR 142173                   *
.*                  Mods for Emergency event                                  *
.******************************************************************************
.*        V9.08.08  16/04/2007  J.Tan            CAR 138026                   *
.*                  Recomp.for PATCATBI - JH Charging for discharged day      *
.*        V9.08.07  19/02/2007 Peter Vela     CAR 135241                      *
.*                  Recompiled for PATCATBI - St. John of God invoice layout  *
.*        V9.08.06  26/02/2007  J.Tan         CAR 120014                      *
.*                  Recompiled for NZPCATBI - NZ exploding misc.item          *
.*        V9.08.05  02/02/2007  Ebon Clements CAR 120001                      *
.*                  Added nz private billing files                            *
.*        V9.08.04  31/01/2007  Peter Vela    CAR 127930                      * 
.*                  Recompiled for EMRSITFD                                   *
.*        V9.08.03  18/12/2006 J.Tan          CAR 128578                      *
.*                  Recompiled for OUTCATBI - GST amount for O/P Next invoice *
.*        V9.08.02  17/11/2006  Peter Vela    CAR 124538                      *
.*                  Recompiled for PATCATBI                                   *
.*                  Added display of PATITMFD.PTITTCER                        *
.*                  Type of Certificate Type B Type C                         *
.*        V9.08.01  18/10/2006  J.Tan         CAR 120502                      *
.*                  Recompiled for PATCATBI - Ignore Doctor Change record     *
.******************************************************************************
.*        V9.07.02  25/09/2006  Peter Vela    CAR 118940                      *
.*                  Recompiled for PATCATBI                                   *
.*        V9.07.01  01/08/2006  J.Tan         CAR 103365                      *
.*                  Recompiled for PATCATBI - John Hopkins                    *
.******************************************************************************
.*        V9.06.01  16/05/2006  Peter Vela    CAR 104103                      *
.*                  Recompiled for PATCATBI - PTCNINVL=12                     *
.******************************************************************************
.*        V9.04.B01 20/12/2005  J.Tan         CAR 89226                       *
.*                  Recompiled for PATCATBI - recalculate theatre fees        *
.*        V9.04.08  02/11/2005  Peter Vela        CAR 81394                   *
.*                  Recompiled for PATCATBI                                   *
.*        V9.04.07  31/08/2005  J.Tan         CAR 74153                       *
.*                  Recompiled for CMXMATRX - checking for exclusive          *
.*        V9.04.06  16/06/2005  Mike Laming   CAR 61746                       *
.*                  Recompiled for CLPATDTR - add clear PTDTTIME & PTDTCRST   *
.*        V9.04.05  29/11/2004  Mike Laming   CAR 54534                       *
.*                  Re-comple for PATCMSTP - fix Addit.Charge Description     *
.*        V9.04.04  22/10/2004  J.Tan  CAR 54506                              *
.*                  Fixed I*C on pmsmtiaf file                                *
.*        V9.04.03  22/09/2004  Lina Vo CAR 53660                             *
.*                  Recompile for PATINVS                                     *
.*        V9.04.02  31/08/2004  J.Tan  CAR 53073                              *
.*                  Fixed Multi hospital id variable                          *
.*        V9.04.01  23/08/2004  J.Tan  CAR 52835                              *
.*                  Recompiled for AAEINVS - Multi hospital                   *
.******************************************************************************
.*        V9.03.15  09/06/2004  J.Tan    CAR 50035                            *
.*                  Re-compile for PATCATBI - Mechanical ventilation          *
.*        V9.03.14  22/04/2004  Mike Laming   CAR 46224                       *
.*                  Re-compile for PATCATBI - Theatre DTR sequences           *
.*        V9.03.13  25/02/2004  Mike Laming   CAR 47055                       *
.*                  Re-add "Grand Total" and re-hash all Totals               *
.*        V9.03.12  12/02/2004  Henry Son        CAR 47385                    *
.*                  Added PTCNMBSF for checking if we allow more than         *
.*                  Six MBS Items.                                            *
.*        V9.03.11  23/02/2004  Mike Laming   CAR 47440                       *
.*                  Re-compile for PATCATBI - initialise TPATAMTP             *
.*        V9.03.10  14/01/2004  CAR 43738   Mike Laming                       *
.*                  General fix to correct Report (and match BIL60)           *
.*        V9.03.09  18/12/2003  J.Tan  CAR 44093                              *
.*                  Recompiled for new receipting files                       *
.*        V9.03.08  18/11/2003  Henry Son   CAR 39291                         *
.*                  Allow more than 7 Theatre stepdown fees.                  *
.*                  Recompile PATCATBI.                                       *
.*        V9.03.07  03/11/2003  Mike Laming  CAR 43911                        *
.*                  Recompile for PATCATBI - correct GROSSTOT & ACCMTOT       *
.*        V9.03.06  17/10/2003  J.Tan  CAR 44176                              *
.*                  Recompiled for PATCATBI.                                  *
.*        V9.03.05  17/09/2003 Lina Vo CAR 40497                              *
.*                  Recompile for AAECATBI, OUTCATBI & PATCATBI.              *
.*        V9.03.04  17/09/2003 J.Tan  CAR 36504                               *
.*                  Recompile for PATGNCMX - Web billing changes              *
.*        V9.03.03  13/08/2003  CAR 41196   Lina Vo                           *
.*                  Recompile for big changes in PATSELFN.                    *
.*                  11/08/2003  CAR 41072   Mike Laming                       *
.*                  Recompile for PATCATBI to correct Lump Sums in BIL19      *
.*        V9.03.02  04/08/2003  CAR 34330/41952   Mike Laming                 *
.*                  Recompiled for PATCATBI & PATDINVS - Add second temp      *
.*                  file for Misc.Items to change sequence to Date/DTR seq.   *
.*        V9.03.01  02/06/2003  Dean Cramer CAR 38200                         *
.*                  Fixed Outpatients - All  heading print                    *
.******************************************************************************
.*        V9.02.01  18/03/2003  Dean Cramer  CAR 36515                        *
.*                  Ported from 6.10. Altered for 9.02.                       *
.******************************************************************************
.*        V6.10.20  12/02/2003  Mike Laming  CAR 22840                        *
.*                  Recompiled for PATCATBI - Update TRAN Lumpsums when       *
.*                  printing Invoice                                          *
.*        V6.10.19  03/01/2003  Henry Son SRF 35029                           *
.*                              Re-compile for SAR G/L Accruals               *
.*                              Include SAPARINT, PATDINVS                    *
.*        V6.10.18  11/12/2002  Tonii  SRF 22920                              *
.*                  Mods to only remove zero records if CREMINV = 1           *
.*        V6.10.17  27/11/2002  Madhuri  SRF 33707                            *
.*                  Recompiled for CMXMATRX                                   *
.*        V6.10.16  30/10/2002 Tonii SRF 20135 EDI Extracts- HosClaims Phase I*
.*                  Recompiled for PATINVS                                    *
.*        V6.10.15  23/10/2002  Sunil Kumar  SRF 23084                        *
.*                  Recompiled for CMXMATRX & PATCATBI - Fixed I*C error      *
.*        V6.10.14  16/10/2002  Tonii  EDI Extracts- HosClaims Phase I        *
.*                  Recompiled for PATINVS                                    *
.*                  16/10/2002  Steve Downing  SRF 23300                      *
.*                  Recompiled for PATCATBI                                   *
.*        V6.10.13  03/10/2002  J.Tan                                         *
.*                  Recompiled for PATCATBI - FED                             *
.*        V6.10.12  20/09/2002  J.Tan                                         *
.*                  Recompiled for PATCATBI - recalculate mbs/misc.           *
.*        V6.10.11  20/09/2002  J.Tan                                         *
.*                  Recompiled for PATCMSTP - casemix funding                 *
.*        V6.10.10  30/08/2002  J.Tan                                         *
.*                  Recompiled for PATCATBI - casemix funding                 *
.*        V6.10.09  27/08/2002  J.Tan                                         *
.*                  Recompiled for PATCATBI - revenue breakdown               *
.*        V6.10.08  19/08/2002  Guomin Fu     SRF 17469                       *
.*                  Recompiled for PATDINVS,PATCATBI - Order of printing      *
.*                  invoices                                                  *
.*        V6.10.07  09/08/2002  J.Tan                                         *
.*                  - Recompiled for STEPDOWN - Changes for Specialty bed     *
.*        V6.10.06  19/07/2002  Mike Laming      SRF 19503 Rebound            *
.*                   Recompiled for PATCATBI - change Theatre calcs           *
.*        V6.10.05  16/07/2002  Greg Horvat      SRF 17570 Rebound            *
.*                  - Recompiled for STEPDOWN - Changed to use the highest day*
.*                    in period rate (TRBEND) from the transfer file if a     *
.*                    manual stepdown                                         *
.*                  - Recompiled for STEPDOWN - Changed to set the manual     *
.*                    stepdown flag (PTTREPSD) to yes when writing automatic  *
.*                    stepdowns & the flag write manual stepdown (WRMNSTDN) is*
.*                    yes                                                     *
.*        V6.10.04  15/07/2002  Mike Laming      SRF 17570 Rebound            *
.*                  Recompiled for PATCMSTP - Changes to PTTREPSD & ADIP0000  *
.*        V6.10.03  14/07/2002  Greg Horvat      SRF 17570 Rebound            *
.*                  Recompiled for PATCMSTP - Recorrected the test of PTTREPSD*
.*                  in the previous version change & removed the record       *
.*                  repositioning on pattranf that was put in in the previous *
.*                  version change                                            *
.*        V6.10.02  11/07/2002  Mike Laming  SRF 19094 et al                  *
.*                  Recompiled for PATCATBI, STEPDOWN & CMXMATRX              *
.*        V6.10.01  05/07/2002  Tonii  SRF 18517                              *
.*                  Recompiled for AAECATBI                                   *
.*                  Recompiled for CMXMATRX, added open call to PATPGRA1      *
.******************************************************************************
.*        V6.09.21  06/06/2002  Steve Downing  SRF 16988                      *
.*                  Recompiled for PATCATBI - Initialise FRDATE               *
.*        V6.09.20  09/05/2002  Tonii            SRF 17531                    *
.*                  Recompiled for CMGETTHR - Mods to use overnight charge if *
.*                  DC not setup                                              *
.*        V6.09.19  04/04/2002  J.Tan  SRF 16323                              *
.*                  Recompiled for PATCATBI - Mods to update dtr after sorting*
.*                  for printing invoices, fixed casemix lumpsum amounts      *
.*                  rebate & patient portion were wrong way around            *
.*        V6.09.18  28/03/2002 J.Tan  SRF 16281                               *
.*                  Recompiled for PATCATBI                                   *
.*        V6.09.17  19/02/2002 J.Tan  SRF 16281                               *
.*                  Changed THCFLAG to FORM 2                                 *
.*        V6.09.16  22/02/2002 J.Tan                                          *
.*                  Recompiled for Stepdown & PATCATBI                        *
.*        V6.09.15  21/02/2002 J.Tan                                          *
.*                  Recompiled for billing problems                           *
.*        V6.09.14  08/02/2002  Greg Horvat                                   *
.*                  Recompiled for STEPDOWN - Commented out changes to        *
.*                  recalculate rate for admission record of trans            *
.*        V6.09.13  08/02/2002  Greg Horvat                                   *
.*                  Recompiled for PATCATBI & CMXMATRX - Changed to not use   *
.*                  the discharge DRG for casemix billing                     *
.*        V6.09.12  25/01/2002  Greg Horvat                                   *
.*                  Recompiled for PATCATBI - Pretty much rewrote how the     *
.*                  matrix/casemix/perdiem billing was initially calculated   *
.*                  cause invoices couldnt be printed & stuff was all wrong   *
.*                  18/01/2002  Steve Downing  SRF 13320                      *
.*                  Recompiled for PATCATBI - Fixed calculation of critical   *
.*                  care days for CC cutoff                                   *
.*        V6.09.11  16/01/2002  Greg Horvat      SRF 14570                    *
.*                  Recompiled for PATCATBI - Fixed a bug where casemix lump  *
.*                  sum amounts werent being written to patfinsf when         *
.*                  invoicing casemix patients                                *
.*                  14.01.2002  Glenn Saunders - Mayne AR Data Extraction proj*
.*                  Recompiled for PATCATBI, PABXBILL & OUTCATBI (new DTR fld)*
.*                  09/01/2001  Greg Horvat      SRF 14730                    *
.*                  Recompiled for PATCATBI - Fixed a bug where admitted non  *
.*                  casemix patients weren't having there accom calculated    *
.*                  correctly in non invoicing programs                       *
.*        V6.09.10  30/11/2001  J.Tan                                         *
.*                  Recompiled for PATCATBI - printing invoices               *
.*        V6.09.09  28/11/2001  Tonii  SRF 13489                              *
.*                  Recompiled for PATINVS                                    *
.*        V6.09.08  12/11/2001  J.Tan                                         *
.*                  Recompiled for CMXMATRX - Discharge UDF                   *
.*        V6.09.07  12/10/2001  Greg Horvat      SRF 13579                    *
.*                  Recompiled for PATCATBI - Temporary fix of I*A at update  *
.*                  of pattranf (DLNE7500) when updating charges for casemix  *
.*                  daycase patient                                           *
.*        V6.09.06  06/10/2001  J.Tan                                         *
.*                  Recompiled for CMXMATRX                                   *
.*        V6.09.05  27/09/2001  Tonii  SRF  9220                              *
.*                  Recompiled for PATCATBI - Fixed I*U                       *
.*        V6.09.04  21/08/2001  Tonii  SRF 12075                              *
.*                  Recompiled for PATCATBI - Fixed I*D                       *
.*        V6.09.03  17/08/2001  Steve Downing    SRF 11796                    *
.*                  recompiled for PATCATBI - Fixed I*C                       *
.*        V6.09.02  30/07/2001  Greg Horvat      SRF 11330 11332              *
.*                  Recompiled for PATCATBI - Initialise DCFLAG (casemix      *
.*                  daycase flag) to zero at the start of the routine         *
.*        V6.09.01  25/06/2001  Jill Habasque SRF 10921                       *
.*                  Recompiled for PATCATBI                                   *
.*        V6.09.B04 29/05/2001  Glenn Saunders - srf 10215                    *
.*                  Recompile for PATCATBI (casemix - matrix changes)         *
.*                  Include PATTFEFD, new variable ZERO8, dummy label GETTHR  *
.*        V6.09.B03 04/04/2001  Caleb Sharman                                 *
.*                  Added 'Casemix Only' to menu, and altered the temp key    *
.*                  to include the health fund                                *
.*        V6.09.B02 26/03/2001  Caleb Sharman                                 *
.*                  Mods to print layout                                      *
.*        V6.09.B01 18/12/2000  Jill Habasque                                 *
.*                  Casemix mods - recompiled for PATCATBI                    *
.*        V6.07.08  25/09/2000  Steve Downing                                 *
.*                  Fixed headers for printing of unknown GST                 *
.*        V6.07.07  19/09/2000  Steve Downing                                 *
.*                  Fixed report to print Unknown GST for discharged patients *
.*        V6.07.06  18/08/2000  J.Tan SRF 5160                                *
.*                  Recompiled for PATCMSTP(PTCNIDES-cross reference acc.desc)*
.*                  Fixed invoicing discharged casemix patients (SRF 3690)    *
.*        V6.07.05  14/08/2000  Steve Downing                                 *
.*                  Recompiled for PATINVS - fixed display alignment error    *
.*        V6.07.04  12/07/2000  Jill Habasque SRF 3814                        *
.*                  Recompiled for PATCATBI                                   *
.*        V6.07.03  15/05/2000 J.Tan                                          *
.*                  Recompiled for PATCATBI - landscape invoice               *
.*                  Mods no GST for pending                                   *
.*        V6.07.02  10/05/2000 J.Tan                                          *
.*                  Recompiled for PATMCHFD                                   *
.*        V6.07.01  02/05/2000 J.Tan                                          *
.*                  Recompiled for PATCATBI - backdated invoiced              *
.*        V6.07.B05 18/04/2000  Jill Habasque                                 *
.*                  Mods to printing of GST total                             *
.*        V6.07.B04 11/04/2000  Greg Horvat                                   *
.*                  Removed MATADAFD MATADBFD & MATADBIO                      *
.*        V6.07.B03 27/03/2000  Steve Downing                                 *
.*                  More mods for GST                                         *
.*        V6.07.B02 15/04/2000  J.Tan                                         *
.*                  Mods for GST                                              *
.*        V6.06.10  10/01/2000  Steve Downing  SRF 636710                     *
.*                  Recompiled for AAECATBI                                   *
.*        V6.06.09  22/11/1999  J Habasque SRF 635701                         *
.*                  Recompiled for PATCATBI                                   *
.*        V6.06.08  29/09/1999  Caleb Sharman  SRF 634825                     *
.*                  Recompiled for PATCATBI                                   *
.*        V6.06.07  24/06/1999  J.Tan  SRF 63227                              *
.*                  Recompiled for OUTCATBI - HSH laser printer layout        *
.*        V6.06.06  10/06/1999  J.Tan                                         *
.*                  Recompiled for PABXBILL                                   *
.*        V6.06.05  24/05/1999  J.Tan                                         *
.*                  Recompiled for PATCMSTP - description for additional chg  *
.*        V6.06.04  19/05/1999  J Habasque SRF 631315                         *
.*                  Recompiled for changes to PATIVMES                        *
.*        V6.06.03  07/05/1999  J.Tan                                         *
.*                  Recompiled for PATCATBI - daycase casemix funding         *
.*        V6.06.02  03/05/1999  Katie Nelson                                  *
.*                  Recompiled for PATDINVS                                   *
.*        V6.06.01  20/04/1999  Katie Nelson                                  *
.*                  Added web variables for AAECATBI                          *
.*        V6.06.B01 12/01/1999  J.Tan    SRF 628446                           *
.*                  Recompiled for PATCATBI - split invoices for casemix      *
.*        V6.05.08  18/12/1998  J.Tan    SRF 629586                           *
.*                  Recompiled for PATIVMES - fixed displaying pat/reb portion*
.*        V6.05.07  23/11/1998  J.Tan   SRF 629110                            *
.*                  Recompiled for PATDINVS - amount to be FORM7.2            *
.*        V6.05.06  30/10/1998  Nicole Harrington                             *
.*                  Changed to print century on dates and use standard header *
.*        V6.05.05  13/10/98 J.Tan                                            *
.*                  Recompiled for PATCMSTP - desc.for zero additional charge *
.*        V6.05.04  29/09/1998  Steve Armstrong  SRF 627503                   *
.*                  Recompiled for AAEDEAFD changes                           *
.*        V6.05.03  31/08/1998  J.Tan    SRF 627680                           *
.*                  Fixed billing date                                        *
.*        V6.05.02  27/08/1998  Katie Nelson                                  *
.*                  Recompiled for PATBFEDS - web flag added                  *
.*        V6.05.01  29/07/98 Katie Nelson                                     *
.*                  Recompiled for PATCATBI - to include web flag             *
.*        V6.05.B02 01/07/98 J.Tan                                            *
.*                  Recompiled for PATCMSTP - reposition on pattranf          *
.*        V6.05.B01 22/06/98 J.Tan                                            *
.*                  Recompiled for PATCATBI - to include century in DIM31     *
.*        V6.04.13  09/04/98 J.Tan  SRF 625661                                *
.*                  Recompiled for PATCATBI - Fixed Health fund lumpsum       *
.*        V6.04.12  09/03/98 J.Tan  SRF 619732                                *
.*                  Mods invoice layout 6 to write to a textfile              *
.*        V6.04.11  29/01/98 J.Tan  SRF 623233                                *
.*                  Recompiled for PATCATBI - daycase casemix                 *
.*        V6.04.10  24/10/97 J.Tan                                            *
.*                  Recompiled for PATCATBI - setup the hf type for lumpsum   *
.*        V6.04.09  13/11/97 J.Tan                                            *
.*                  Recompiled for PATCATBI - daycase casemix                 *
.*        V6.04.08  24/10/97 J.Tan                                            *
.*                  Recompiled for PATCATBI - daycase casemix                 *
.*        V6.04.07  17/10/97 J.Tan     SRF 622342                             *
.*                  Recompiled for PATCATBI - daycase casemix                 *
.*        V6.04.06  22/07/97 J.Tan      SRF 620965                            *
.*                  Recomp.for PATCATBI-additional charges for sameday casemix*
.*        V6.04.05  17/06/1997  Greg Horvat      SRF 620238                   *
.*                  Recompiled for PATCATBI - Changed to call CHKCMXPT to     *
.*                  check if a casemix patient & to get the episode type      *
.*        V6.04.04  09/05/97 J.Tan                                            *
.*                  Recompiled for PATCMSTP - Casemix stepdown                *
.*        V6.04.03  22/01/1996  Greg Horvat                                   *
.*                  Recompiled for PATCATBI - Changed to call CLPATDTR to     *
.*                  clear the DTR file variables before writing               *
.*        V6.04.02  13/01/97 J.Tan    SRF 618497                              *
.*                  Recompiled for changes on DTR files                       *
.*        V6.04.01  12/12/1996  Greg Horvat      Holy Spirit Mods             *
.*                  Recompiled for PATDINVS                                   *
.*                                                                            *
.*        V6.03.09  29/05/1996  Greg Horvat      Quote 8623                   *
.*                  Recompiled for PATCATBI - Added new invoice layout for    *
.*                  Adelaide Clinic - layout 19                               *
.*        V6.03.08  23/05/96 J.Tan     SRF 615301                             *
.*                  Recompiled for STEPDOWN -problem with new date in the past*
.*        V6.03.07  27/10/1995  Greg Horvat      SRF 612064 612205 612206     *
.*                  Recompiled for changes to STEPDOWN                        *
.*        V6.03.06  13/10/1995  Greg Horvat      SRF 611811 (Rebound)         *
.*                  Recompiled for PATDINVS                                   *
.*        V6.03.05  11/10/1995  Greg Horvat      SRF 611811                   *
.*                  Changed to use CALCDAYS instead of CALC when calculating  *
.*                  the difference between two dates                          *
.*        V6.03.04  04/09/1995  Greg Horvat      SRF 611419                   *
.*                  Recompiled for PATDINVS                                   *
.*        V6.03.03  26/05/1995  Greg Horvat                                   *
.*                  Recompiled for PATCATBI - Change to exact read on 3rd     *
.*                  index of PATIODTR (Only used in PATCATBI)                 *
.*        V6.03.02  10/05/1995  Greg Horvat      SRF 136155                   *
.*                  Recompiled for PATCATBI                                   *
.*        V6.03.01  22/03/1995  Greg Horvat      SRF 134569                   *
.*                  Recompiled for PATCATBI                                   *
.*        V6.03.B02 30/12/1994  Greg Horvat      New Release 6.03             *
.*                  Recompiled for AAECATBI                                   *
.*        V6.03.B01 18/01/1995  Graeme Williams  New Release 6.03             *
.*                  Recompiled for PATCATBI-  Post bed type to patdtraf when  *
.*                  writing accom dtra recs.                                  *
.*        V6.03.B00 30/12/1994  Greg Horvat      New Release 6.03             *
.*                  Recompiled for PATCATBI - Print miscellaneous items       *
.*        V6.02.02  13/10/1994  Jeni Tan         SRF 132145                   *
.*                  Recompiled for STEPDOWN                                   *
.*        V6.02.01  29/09/1994  Greg Horvat      SRF 132488                   *
.*                  Recomplied for PATINV** & PATCATBI                        *
.*                                                                            *
.*******************************************************************************
.
          INC       STD001FD
          INC       IBATMHFD/INC
          INC       IBAPASFD/INC
          INC       PATCOMM/INC
          INC       IBACONFD/INC
          INC       IBAGSTFD/INC
          INC       PATGTUFD/INC
          INC       IBAGEDFD/INC
          INC       MLTCFNFD/INC
.
          INC       NZPEXTFD/INC
          INC       NZPRDTFD/INC
          INC       NZPBFEFD/INC
          INC       NZPCFNFD/INC
          INC       NZPCMTFD/INC
          INC       NZPFIGFD/INC
          INC       NZPFINFD/INC
          INC       NZPIBRFD/INC
          INC       NZPMCHFD/INC
          INC       NZPMXCFD/INC
          INC       NZPPFEFD/INC
          INC       NZPRBRFD/INC
          INC       NZPRFNFD/INC
          INC       NZPPICFD/INC
          INC       NZPSPRFD/INC
          INC       NZPTFEFD/INC
          INC       NZPIVBFD/INC
          INC       NZPRVBFD/INC
          INC       OPRDEAFD/INC
          INC       OPRARDFD/INC
          INC       OPRSESFD/INC
.
          INC       PATELGFD/INC
          INC       PATAFEFD/INC
          INC       PATASDFD/INC
          INC       PATCMXFD/INC
          INC       PATCTFFD/INC
          INC       PMSCIDFD/INC
          INC       PMSCCDFD/INC
          INC       PATCFAFD/INC
          INC       PATHDFFD/INC
          INC       PATHLFFD/INC
          INC       PATHTRFD/INC
          INC       EMRHTRFD/INC
          INC       OUTHTRFD/INC
          INC       PATICUFD/INC
          INC       PATLDFFD/INC
          INC       PATLSDFD/INC
          INC       PATFX1FD/INC
          INC       PATFN1FD/INC
          INC       PATFN2FD/INC
          INC       PATFHIFD/INC
          INC       PATRFNFD/INC
          INC       PATRE1FD/INC
          INC       PABXVARS/INC
.
          INC       PATDDHFD/INC
          INC       PATDO1FD/INC
          INC       PATDGWFD/INC
          INC       PATDRGFD/INC
          INC       PATMI1FD/INC
          INC       PATMA1FD/INC
          INC       PATDSCFD/INC
          INC       PATECOFD/INC
          INC       PATECDFD/INC                *Pat Episode Disease Coding
          INC       PATTRNFD/INC
          INC       PATDTRFD/INC
          INC       PATHSPFD/INC
          INC       PATIBLFD/INC
          INC       PATINMFD/INC
          INC       PATIOVFD/INC
          INC       PATIPEFD/INC
          INC       PATCONFD/INC
          INC       PATINVFD/INC
          INC       PATONHFD/INC
          INC       PATFINFD/INC
          INC       PATFMOFD/INC
          INC       PATIN1FD/INC
          INC       PATOVBFD/INC
          INC       PATVISFD/INC
          INC       PATVENFD/INC
          INC       PMSHATFD/INC
          INC       PMSVX1FD/INC
          INC       PATWC1FD/INC
          INC       PATWMAFD/INC
          INC       PATWVEFD/INC
          INC       PMSEVTFD/INC
          INC       PATWR1FD/INC
          INC       PATBFEFD/INC
          INC       PATRATFD/INC
          INC       PATRBLFD/INC
          INC       PATSRBFD/INC
          INC       PATITMFD/INC
          INC       PATMCHFD/INC
          INC       PATCODFD/INC
          INC       PATPGRFD/INC
          INC       PATRCAUD/INC
          INC       PATSELDT/INC
          INC       PATTFEFD/INC
          INC       PATCMTFD/INC
          INC       PMSCMTFD/INC
          INC       PMSSINFD/INC
          INC       PMSSGAFD/INC
          INC       PMSMTIFD/INC
          INC       PMSCNOFD/INC
          INC       PMSMPRFD/INC
          INC       PMSHCPFD/INC
          INC       PRIITMFD/INC
.
          INC       IBASECFD/INC
.
          INC       AAEDE1FD/INC
          INC       AAEDEBFD/INC
          INC       AAEDTRFD/INC
          INC       EMRSITFD/INC
          INC       EMRHISFD/INC
          INC       EMRVISFD/INC
.
          INC       OUTBOAFD/INC
          INC       OUTBB1FD/INC
          INC       OUTDTRFD/INC
          INC       OUTSITFD/INC
.
          INC       COMDEPFD/INC
          INC       RCPBNKFD/INC
          INC       RCPBDTFD/INC
          INC       RCPDTEFD/INC
.
          INC       PATDINVS/INC
          INC       IBASEQFD/INC                 * Sequential Numbers File
          INC       TFILEVAR/INC                 * Generate Temp File Name
          INC       WEBERRFD/INC                 * Web Server Error Logging
.
          INC       PMSPBRFD/INC
          INC       PMSIDEFD/INC
          INC       PATSTAFD/INC
          INC       PATAA1FD/INC
          INC       PMSEDGFD/INC       * Effective DRG Dates
+
.
.         Web Variables (only the include files use these variables)
.
DAYFORMT  DIM       4
NJAN      INIT      "January"
NFEB      INIT      "February"
NMAR      INIT      "March"
NAPR      INIT      "April"
NMAY      INIT      "May"
NJUN      INIT      "June"
NJUL      INIT      "July"
NAUG      INIT      "August"
NSEP      INIT      "September"
NOCT      INIT      "October"
NNOV      INIT      "November"
NDEC      INIT      "December"
.
HOSPID    DIM       3
HOSPNAME  DIM       50
HTMLFILE  FIFO      ASCII, FIXED=250
MTHNAM3   DIM       3
MTHNAM3A  DIM       3
.
.         end web variables
.  
.               WORK AREA
.
.
ADMISSNO  DIM       8
ADAY      DIM       2
AMON      DIM       2
AYER      DIM       2
ACEN      DIM       2
ACCDTE    DIM       8     * accommodation date used in AAECATBI
AECNCHRS  FORM      1
AECNFTYP  FORM      1
ACTION    DIM       1                       * Action for PATAA1FD
ADD       DIM       2                       * Day for PATAA1FD
AMM       DIM       2                       * Month for PATAA1FD
AYY       DIM       2                       * Year for PATAA1FD
ACC       DIM       2                       * Century for PATAA1FD
OPERCODE  DIM       4                       * Operator code for PATAA1FD
.
CSTRTYR   DIM       8
CDYSDAYS  FORM      6
CDYSFDTE  DIM       8
CDYSTDTE  DIM       8
CDYSYEAR  FORM      2
CURRDATE  DIM       8
BULKBILL  DIM       1
CODE      DIM       2
CUTDAY    DIM       2
CUTMON    DIM       2
CUTYER    DIM       2
CALDAYS   FORM      4
CATCR     INIT      "cr"
CODECL    INIT      "CL"
CODEBT    INIT      "BT"
CODEPY    INIT      "Py"
CMDLINE   DIM       80
CLAIMDES  DIM       20
CURSESS   DIM       18
CERTINDC  FORM      1
.
CODEA     INIT      "A "
DB        INIT      "DB"
DDDAY     DIM       2
DDMON     DIM       2
DDYER     DIM       2
DDCEN     DIM       2
DIM1A     DIM       1
DIM3T     DIM       3
DIM4      DIM       4
DIM5A     DIM       5
DIM9      DIM       9
DIM13     DIM       13
DIM14     DIM       14
DIM18     DIM       18
DIM18A    DIM       18
DIM24A    DIM       24
DIM30     DIM       30
DOCTCODE  DIM       6
DOCFNAME  DIM       50

DIM130    DIM       120
.
EXPORTFL  FORM      1         * Create Export File
EMCNGINV  DIM       1
EMCNDPOC  DIM       1
EMCNOPOC  DIM       15
EFTDATE   DIM       8         * Effective date (ccyymmdd)
.
FILBOKB2  INIT      "bokbf"
FIVE9     FORM      "59"
FORM3A    FORM      3
FORM5     FORM      5
FORM6P2A  FORM      6.2
.
FINGROSS  FORM      8.2                                                *I-47055
FINNETT   FORM      8.2                                                *I-47055
FINTDAYS  FORM      8                                                  *I-47055
FMTGNAME  DIM       35
FMTTITLE  DIM       10
FMTSNAME  DIM       35
.
GSTFLG    FORM      1
GSTTDAYS  FORM      8  
GSTGROSS  FORM      8.2
GSTNETT   FORM      8.2
.
HESYST    FORM      1
KEYFLAG   FORM      1
KEY13A    DIM       13
.
.IBCNAESN    DIM         3           AAE System Number
.IBCNOPSN    DIM         3           Outpatients System Number
.IBCNBLSN    DIM         3           Patient Billing System Number
.IBCNMASN    DIM         3           Mamography System Number
.IBCNRASN    DIM         3           Radiology System Number
.IBCNINSN    DIM         3           Inpatient System Number
.
JYEAR     FORM      2
.
MBSFLAG   FORM      1 
NAMEDIM   DIM       20
OPCNCONS  DIM       1
OPNFLAG   FORM      "0"        * Used in stepdown
OPRDATE   DIM       8
OTCNCFEE  FORM      1
OTCNFTYP  FORM      1
OPOCFLAG  FORM      1
.
PASS      FORM      1
PASSG     FORM      1
PSAGECON  DIM       3
PSAGETYP  DIM       1
.
RPTGROSS  FORM      8.2                                                *I-47055
RPTNETT   FORM      8.2                                                *I-47055
RPTTDAYS  FORM      8                                                  *I-47055
.
SERVDOCT  DIM       10
SAVAMNT   FORM      12.2
SAVALLW   FORM      6.2
SAVDISC   FORM      6.2
SAVBEND   FORM      3
SP14      INIT      "              "
.
TFEEIND   FORM      1
THCFLG    FORM      2 
THREED    INIT      "3"
TTBILL    FORM      8.2
TTDAYS    FORM      8
TTNETT    FORM      8.2
.
UNKGST    FORM      1
UPADMTYP  DIM       1

WARNINGL  DIM       20
WBSEUID   DIM       10
WDATE1    DIM       8
WDATE2    DIM       8
.
DISCONLY  FORM      1     * discharged only 1=no 0=yes
.
CFPAYCOD  DIM       3        * 3M Codefinder PAY Code
.
.
ZEDS      INIT      "zzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzz"
Z20       INIT      "zzzzzzzzzzzzzzzzzzzz"
Z8        INIT      "zzzzzzzz"
Z3        INIT      "zzz"
ZEROINVC  DIM       1
.
START     INIT      "Start"                                            *I-47055
FINISH    INIT      "Finish"                                           *I-47055
TMPFNAME  DIM       8
.
TMPFILE1  IFILE SQL, FIXED=125, KEY="u1-3,90-95,4-23,24-31"
.
.Name     Type    Size    Phys    pos        
.-------  ----    ----    ----    -----
TMPCLAIM  DIM       3      3       1           * claim code
TMPSNAME  DIM       20     20      4           * surname
TMPADMNO  DIM       8      8       24          * admission number
TMPURNO   DIM       8      8       32          * UR number
TMPGNAME  DIM       25     25      40          * given name
TMPADATE  DIM       8      8       65          * admission date
TMPDDATE  DIM       8      8       73          * discharge date
TMPACLSS  DIM       3      3       81          * admission class
TMPAUSR2  DIM       3      3       84
TMPATYPE  DIM       3      3       87          * admission type
TMPHFCOD  DIM       6      6       90          * health fund
TMPTDAYS  FORM      8      5       96
TMPGROSS  FORM      8.2    6      101
TMPNETT   FORM      8.2    6      107 
TMPUGST   FORM      1      1      113          * unknown GST
TMPASK    DIM       1      1      114          
TMPAFUND  DIM       6      6      115          * Health fund
TMPIHOLD  DIM       3      3      122          * Reason for Hold
.
. End of Record                   125
.
PRGID     INIT      "IBAHMS62"
PRGNAM    INIT      "INVOICE PENDING REPORT"
VERSION   INIT      "V12.01.00"
+
.-------------------------------------------------------------------------------
.         START OF PROGRAM
.-------------------------------------------------------------------------------
.
          CALL      DISPHEAD                   * call display head routine
          CALL      IBACLOCK
          PACK      CURRDATE,CCC,CYY,CMM,CDD
          REP       " 0",CURRDATE
.
.
          DISPLAY   *P56:24,"Opening patmi1af";
          OPEN      PATMI1A1,"patmi1af"
.
          DISPLAY   *P64:24,"patma1af";
          OPEN      PATMA1A1,"patma1af"
.
          DISPLAY   *P64:24,"patmx1af";
          OPEN      PATMX1A1,"patmx1af"
.
          DISPLAY   *P64:24,"patcodes";
          OPEN      PATCODE1,"patcodes"
.
          DISPLAY   *P64:24,"patwr1af";
          OPEN      PATWR1A1,"patwr1af"
.
          DISPLAY   *P64:24,"pmsvx1af";
          OPEN      PMSVX1A1,"pmsvx1af"
.
          DISPLAY   *P64:24,"patdtraf";
          OPEN      PATDTRA1,"patdtraf"
          OPEN      PATDTRA3,"patdtraf"
.
          DISPLAY   *P64:24,"pmsmtiaf";
          OPEN      PMSMTIA1,"pmsmtiaf"
          OPEN      PMSMTIA2,"pmsmtiaf"
.
          DISPLAY   *P64:24,"patdo1af";
          OPEN      PATDO1A1,"patdo1af"
.
          DISPLAY   *P64:24,"patinmaf";
          OPEN      PATINMA1,"patinmaf"
.
          DISPLAY   *P64:24,"pattranf";
          OPEN      PATTRAN2,"pattranf"
.
          DISPLAY   *P64:24,"patdschf";
          OPEN      PATDSCH1,"patdschf"
.
          DISPLAY   *P64:24,"patitemn";
          OPEN      PATITEM1,"patitemn"
.
          DISPLAY   *P64:24,"patmchgf";
          OPEN      PATMCHG1,"patmchgf"
.
          DISPLAY   *P64:24,"aaede1af";
          OPEN      AAEDE1A1,"aaede1af"
.
          DISPLAY   *P64:24,"aaedtref";
          OPEN      AAEDTRE1,"aaedtref"
          OPEN      AAEDTRE3,"aaedtref"
.
          DISPLAY   *P64:24,"outsitaf";
          OPEN      OUTSITA1,"outsitaf"
.
          DISPLAY   *P64:24,"patvisaf";
          OPEN      PATVISA1,"patvisaf"
.
          DISPLAY   *P64:24,"patipenf";
          OPEN      PATIPEN1,"patipenf"
.
          DISPLAY   *P64:24,"patgtuaf";
          OPEN      PATGTUA1,"patgtuaf"
.
          DISPLAY   *P64:24,"patpgraf";
          OPEN      PATPGRA1,"patpgraf"
.
          DISPLAY   *P64:24,"rcpbdtaf";
          OPEN      RCPBDTA1,"rcpbdtaf"
.
          DISPLAY   *P64:24,"oprardaf";
          OPEN      OPRARDA1,"oprardaf"
.
          DISPLAY   *P64:24,"nzpbfeaf";
          OPEN      NZPBFEA1,"nzpbfeaf"
.         
          DISPLAY   *P64:24,"nzpcfnaf"
          OPEN      NZPCFNA1,"nzpcfnaf"
.         
          DISPLAY   *P64:24,"nzpcmtaf"
          OPEN      NZPCMTA1,"nzpcmtaf"
          OPEN      NZPCMTA2,"nzpcmtaf"
          OPEN      NZPCMTA3,"nzpcmtaf"
.         
          DISPLAY   *P64:24,"nzpfigaf"
          OPEN      NZPFIGA1,"nzpfigaf"
          OPEN      NZPFIGA2,"nzpfigaf"
.
          DISPLAY   *P64:24,"nzpfinaf"
          OPEN      NZPFINA1,"nzpfinaf"
          OPEN      NZPFINA2,"nzpfinaf"
.
          DISPLAY   *P64:24,"nzpibraf"
          OPEN      NZPIBRA1,"nzpibraf"
.
          DISPLAY   *P64:24,"nzpmchaf"
          OPEN      NZPMCHA1,"nzpmchaf"
          OPEN      NZPMCHA2,"nzpmchaf"
.
          DISPLAY   *P64:24,"nzppicaf"
          OPEN      NZPPICA1,"nzppicaf"
          OPEN      NZPPICA2,"nzppicaf"
.
          DISPLAY   *P64:24,"nzprbraf"
          OPEN      NZPRBRA1,"nzprbraf"
.
          DISPLAY   *P64:24,"nzprfnaf"
          OPEN      NZPRFNA1,"nzprfnaf"
          OPEN      NZPRFNA2,"nzprfnaf"
.
          DISPLAY   *P64:24,"nzppfeaf"
          OPEN      NZPPFEA1,"nzppfeaf"
.
          DISPLAY   *P64:24,"nzpspraf"
          OPEN      NZPSPRA1,"nzpspraf"
          OPEN      NZPSPRA2,"nzpspraf"
.
          DISPLAY   *P64:24,"nzptfeaf"
          OPEN      NZPTFEA1,"nzptfeaf"
          OPEN      NZPTFEA2,"nzptfeaf"
.
          DISPLAY   *P64:24,"oprdetaf"
          OPEN      OPRDETA1,"oprdetaf"
.
          DISPLAY   *P64:24,"oprdetaf"
          OPEN      OPRDETA2,"oprdetaf"
.
          DISPLAY   *P64:24,"oprsesaf"
          OPEN      OPRSESA1,"oprsesaf"
.
          OPEN      MLTCFNA1,"mltcfnaf"
          OPEN      MLTCFNA2,"mltcfnaf"
          OPEN      PMSEVTA1,"pmsevtaf"
          OPEN      PATFN1A1,"patfn1af"
          OPEN      EMRVISA1,"emrvisaf"
          OPEN      PATFX1A1,"patfx1af"
          OPEN      PATCFAA1,"patcfaaf"
.
          DISPLAY   *P64:24,"controlf";
          OPEN      CONTROLF,"controlf"
          READ      CONTROLF,ZERO;*43,IBCNMHOS,*85,IBCNUGST
.
          READ      CONTROLF,TEN;*104,PTCNMBSF:                        *C-47385
                                 *217,CAUDQ      * added for V5.63 - SRF 105195
          READ      CONTROLF,TEN3;*245,CHOSTYP
          READ      CONTROLF,TEN5;*247,CSTDOWN
          READ      CONTROLF,TEN9;*212,CFEETYP
          READ      CONTROLF,TWENTY;*164,PTRESDAY,*211,PTCNCNDY
          READ      CONTROLF,FIVE9;*1,CDLSTEP,*5,CREMINV,*210,PTMBSINV
          READ      CONTROLF,SEVENTY9;*209,PTCNITXT
          READ      CONTROLF,HUND05;*193,PTCNITXT,*194,PTCNPCOM:
                                    *201,PTCNPFED
          READ      CONTROLF,EIGHTY;*248,PTCNPEFR
.
...  used in ABFAECCL
          CALL      TFILENAM                * Get file name calculating Exponent
          MOVE      TFILNAME,FNAMEN
.
...  used in PATCATBI CRMV0000
          CALL      TFILENAM                * Get temp file name
          MOVE      TFILNAME,FNAMEX
.
...  used in PATCATBI PTMP0000
          CALL      TFILENAM                * Get temp file name
          MOVE      TFILNAME,FNAMEZ
.
...  used in PATCATBI PT2P0000
          CALL      TFILENAM                * Get temp file name
          MOVE      TFILNAME,FNAMEY
.
...  used in PABXBILL
          CALL      TFILENAM                * Get temp file name
          MOVE      TFILNAME,PBXFNAME
          CALL      TFILENAM                * Get temp file name
          MOVE      TFILNAME,PBXFNAM2
.
          CALL      TFILENAM                     * Generate temporary file name
          MOVE      TFILNAME,TMPFNAME
+
.------------------------------------------------------------------------------
.        START OF PROCESSING
.------------------------------------------------------------------------------
.
.        Determine which system this report is for
.
START     MOVE      ZERO,GSTFLG
          KEYIN     *P1:4,*EF:
                    *P1:4,*V2LON,*DV,ZERO,*HOFF," = Exit":
                    *P1:5,*V2LON,*DV,ONE,*HOFF," = Invoice Pending Report":
                    *P1:6,*V2LON,*DV,TWO,*HOFF," = Discharged In-Patients Only":
                    *P1:7,*V2LON,*DV,THREE,*HOFF," = Casemix Patients Only":
                    *P1:9,"Option : ",*V2LON,OPTION
.
          COMPARE   ZERO,OPTION
          GOTO      ENDIT IF EQUAL
. 
          CALL      BULD0000                * Build the tempfile
. 
          MOVE      ZERO,DISCONLY
          BRANCH    OPTION,STARTB,STARTA,STARTA
.
          DISPLAY   *P40:8,*V2LON,*B,*EL,"** Invalid Selection **",*W2;
          GOTO      START
.
STARTA    MOVE      ONE,DISCONLY
          MOVE      THREE,FSTSYS                  * Starting system = Inpatient
          MOVE      THREE,FEDSYS                  * Ending system = Inpatient
          GOTO      STARTC
.
STARTB    CALL      PATSELFN
          BRANCH    EXIT,START
.
STARTC    COMPARE   ONE,CREMINV
          GOTO      STARTD IF NOT EQUAL
.
.        Make sure they want to remove the zero amount of invoice from
.        invoice pending
.
          KEYIN     *P1:20,*EL,"Do you really want to delete zero ":
                    "invoices of Discharged patients (":
                    *V2LON,"Y",*HOFF,*DV,SLASH:
                    *V2LON,"N",*HOFF,")? ",ANS;
.
          REP       UPPLOW,ANS
          MATCH     "Y",ANS
          GOTO      STARTD IF EQUAL
.
          MATCH     "N",ANS
          GOTO      START IF NOT EQUAL
.
          MOVE      ZERO,CREMINV
.
STARTD    COMPARE   ONE,IBCNMHOS
          GOTO      GETINV IF NOT EQUAL
.
          DISPLAY   *P1:22,*EL,"Hospital Id : ";
          MOVE      TEN5,ECOL
          MOVE      "22",EVERT
          MOVE      SP3,CKYIDEF3
          MOVE      ZERO,CKYIMAND           * Not Mandatory
          OPEN      PATHSPA1,"pathspaf"
.
          CALL      PATHSPKY
          BRANCH    EXIT,ALLHOSP,START
          MOVE      PTHSHOSP,HOSPID
          MOVE      PTHSNAME,HOSPNAME
          GOTO      GETINV  
.
ALLHOSP   MOVE      "All Hospitals",PTHSNAME
          MOVE      SP10,HOSPID
.
GETINV    MOVE      SP70,ZEROINVC
          KEYIN     *P1:23,*EL,"Zero Invoice (":
                    *V2LON,"0 ",*HOFF,"for Include, ":
                    *V2LON,"1 ",*HOFF,"for Exclude, ":
                    *V2LON,"2 ",*HOFF,"for Zero Inv.Only) ? ",ZEROINVC
.
          CALL      CRTX0000                 * Create Export File for Excel
.
.        Print the report
.
          CLOCK     TIME,CTIMEIS
          MOVE      ZERO,CPAGENO
.
          IF        EXPORTFL=1
            CALL      EHED0000               * Print the heading
            MOVE      ZERO,CLNO
          ENDIF
.
          BRANCH    FSTSYS OF PS1ONLY,PS1ONLY,PS1BOTH,PS1ONLY
.
.                                           * Discharged Patients Report
PS1BOTH   MOVE      ZERO,PASS
          MOVE      ZERO,PASSG
          CALL      INVPND
          CALL      PRINTL
          CALL      PRTTOT                                * was ENDP   *C-47055
          CALL      BULD0000                * Erase & re-build Temp.   *I-43738
.
.                                           * Discharged Patients - Unknown GST
          IF        IBCNUGST=TWO
            MOVE      ONE,PASSG
            MOVE      ZERO,GSTFLG
            CALL      INVPND
            CALL      PRINTL
            CALL      PRTTOT                              * was ENDP   *C-47055
            CALL      PRTRTOT                                          *I-47055
            CALL      BULD0000              * Erase & re-build Temp.   *I-43738
          ENDIF
          BRANCH    DISCONLY,PS1END
.
.                                           * Current Admissions Report
PS1ONLY   MOVE      ONE,PASS
          MOVE      ZERO,RPTGROSS                                      *I-47055
          MOVE      ZERO,RPTNETT                                       *I-47055
          MOVE      ZERO,RPTTDAYS                                      *I-47055
          MOVE      ZERO,PASSG
          CALL      INVPND
          CALL      PRINTL
          CALL      PRTTOT                                * was ENDP   *C-47055
          CALL      BULD0000                * Erase & re-build Temp.   *I-43738
.
.                                           * Current Admissions - Unknown GST
PS1GST    IF        IBCNUGST=TWO
            MOVE      ONE,PASSG
            MOVE      ZERO,GSTFLG
            CALL      INVPND
            CALL      PRINTL
            CALL      PRTTOT                              * was ENDP   *C-47055
            CALL      PRTRTOT               * print "Report Total"     *I-47055
          ENDIF
.
          CALL      KILL0000                * Erase Temp.              *I-43738
.
PS1END    COMPARE   ZERO,CPAGENO
          GOTO      NODATA IF EQUAL
.
          CALL      PRTFTOT                 * print "Grand Total"      *I-47055
          CALL      PRTENDR                 * print "END OF REPORT"    *I-47055
.
          DISPLAY   *P10:24,*EL,*V2LON:
                    "** Report Generation Completed **",*W2;
.
          GOTO      START
.
NODATA    DISPLAY   *P1:24,*EL,*B:
                    "** No data found for the selected report **",*W2:
                    *P1:24,*EL;
          GOTO      START
+
.****************************************************************************
.*                                CRTX0000             Called by: ML0000    *
.* Create export file for excel                                             *
.****************************************************************************
CRTX0000  MOVE      ZERO,EXIT
          MOVE      ZERO,EXPORTFL                  * No to create export file
          DISPLAY   *P1:24,"Create Export file for Excel : "
          KEYIN     *P32:24,*V2LON,*RV,DIM1:
                    *P32:24,*DV,DIM1
          REP       UPPLOW,DIM1
          DISPLAY   *P32:24,*V2LON,DIM1
          MOVE      ONE,EXPORTFL
          MATCH     "Y",DIM1
          GOTO      CRTX9999 IF EQUAL
          MOVE      ZERO,EXPORTFL
.
CRTX9999  RETURN
+
.****************************************************************************
INVPND    MOVE      "99" TO CLNO
          MOVE      ONE,PROGFLAG
          MOVE      ONE,DISPROG
          MOVE      ZERO,UNKGST             * assume Known GST         *I-43738
          IF        PASSG = 1
            MOVE      ONE,UNKGST            * set Unknown GST          *I-43738
          ENDIF                                                        *I-43738
.
          MOVE      SP8,KEY8
          CALL      RDSIPEN1
.
          DISPLAY   *P1:24,*EL,*P20:24,"Admission Number";
.
URLOOP    CALL      RDKIPEN1
          BRANCH    OVRCD,URLOOP99
.
          IF        IBCNUGST = TWO
            COMPARE   ONE,PASSG
            GOTO      CHKGST2 IF EQUAL
.
CHKGST1     PACK      KEY8,IPADMNO,SP8
            CALL      RAPTGTU1              * Check GST unknown file
            BRANCH    OVRCD,CHKGST3C        * No record found, continue C-43738
.....       MOVE      ZERO,TMPUGST                                      D-43738
.....       MOVE      ZERO,UNKGST                                       D-43738
            GOTO      URLOOP                * Record found, skip
.
CHKGST2     PACK      KEY8,IPADMNO,SP8
            CALL      RAPTGTU1              * Check GST unknown file
            BRANCH    OVRCD,URLOOP          * No record found, skip
.....       MOVE      ONE,TMPUGST                                       D-43738
.....       MOVE      ONE,UNKGST                                        D-43738
            GOTO      CHKGST3C              * Record found, continue   *C-43738
          ENDIF
.
CHKGST3C  MOVE      ONE,OVRCD                           * change label *C-43738
          CALL      ZTMP0000
.
          DISPLAY   *P20:24,"Admission Number",*P37:24,*V2LON,IPADMNO;
.
          COMPARE   FSTSYS,IPSYSTM
          GOTO      URLOOP IF LESS
.
          COMPARE   IPSYSTM,FEDSYS
          GOTO      URLOOP IF LESS
.
          MOVE      SP70,TMPDDATE            
          MOVE      SP70,AFUNDH
          UNPACK    SP70,PMVXATCP,ACODDTE,PMVXMHOS
          PACK      KEY8,IPADMNO,SP8
          CALL      RDPMVX11
.
          IF          IBCNMHOS=1
            MATCH       SP10,HOSPID
            IF          !@EQUAL
              MATCH       PMVXMHOS,HOSPID
              GOTO        URLOOP IF NOT EQUAL
            ENDIF
          ENDIF
.
.       Calculate the amount to be invoiced - different for each system
.
          MOVE      ZERO,TOTDAYS
          BRANCH    IPSYSTM OF AAECALC,OUTCALC,INPCALC,OUTCALC
.
INPCALC   MOVE      IPADMNO,KEY8
          CALL      RDMISS1
          BRANCH    OVRCD OF URLOOP
.
          CALL      CLPATDSC                * Clear discharge record
          BRANCH    PASS,CHKCURR
.
          COMPARE   THREE,ASTAT
          GOTO      URLOOP IF NOT EQUAL      * If not discharged
          GOTO      CONTCHK
.
.       Second pass, check for current admissions, and patients on leave
.
CHKCURR   COMPARE   TWO,ASTAT
          GOTO      CONTCHK IF EQUAL
.
          COMPARE   FOUR,ASTAT
          GOTO      URLOOP IF NOT EQUAL
.
.       Inpatient to be invoiced
.
CONTCHK   UNPACK    ADATE TO TMPADATE       
.
          MOVE      AURNO,KEY8
          CALL      RDMAST1
          BRANCH    OVRCD OF URLOOP
.
          MOVE      ONE,DISFLG
          COMPARE   THREE,ASTAT
          GOTO      INPCTBI IF NOT EQUAL
.
          MOVE      ZERO,DISFLG
          MOVE      AADMNO,KEY8
          CALL      RDDSCH1
.
          UNPACK    DDATE TO TMPDDATE            
.
INPCTBI   IF        IBCNUGST=2
            MOVE      ZERO,IBCNUGST         * set no GST for pending report
            CALL      CALCTBI
            MOVE      TWO,IBCNUGST
          ELSE
            CALL      CALCTBI
          ENDIF
          GOTO      INVLOOP
.
.        Outpatient to be invoiced
.
OUTCALC   BRANCH    PASS,OUTCALC0
          GOTO      URLOOP
.
OUTCALC0  MOVE      IPADMNO,PVIBILL
          MOVE      PVIBILL,KEY8
          CALL      RDVISA1
          BRANCH    OVRCD OF URLOOP
.
          COMPARE   FOUR,IPSYSTM
          GOTO      OUTCALC1 IF NOT EQUAL
.
.         Other financial
.
          MOVE      "out",OSTFILE
          MOVE      PVIURNO,PURNO
.
          MOVE      SP3,OBACOMP
          MOVE      SP3,OBACLASS
          MOVE      SP3,OBASRCR
          MOVE      SP3,OBAINS
          MOVE      SP10,OBADATE
          GOTO      OUTCALC2
.
.         Outpatient
.
OUTCALC1  MATCH     FSTSITE,PVISITE
          GOTO      URLOOP IF LESS
.
          MATCH     PVISITE,FEDSITE
          GOTO      URLOOP IF LESS
.
          MOVE      SP3,OSTSYST
          MOVE      "out",OSTFILE
          MOVE      PVISITE,KEY6
          CALL      RDSITA1
.
          MATCH     FSTDEPT,OSTSYST
          GOTO      URLOOP IF LESS
.
          MATCH     OSTSYST,FEDDEPT
          GOTO      URLOOP IF LESS
.
.        Get the finanical booking details
.
GETBDET   PACK      CFNAME WITH OSTFILE,FILBB1A2
          CLOSE     OUTBB1A2
          OPEN      OUTBB1A2,CFNAME
.
          CLOSE     OUTDTRO1
          PACK      CFNAME,OSTFILE,FILDTRO1
          OPEN      OUTDTRO1,CFNAME
          OPEN      OUTDTRO3,CFNAME
.
          PACK      KEY16,PVIDATE,PVIBILL
          CALL      RDBOKB2
          BRANCH    OVRCD,URLOOP
          MOVE      PVIURNO,OBAURNO
          MOVE      PVISITE,OBASITE
.
          MOVE      OBAURNO,PURNO
OUTCALC2  MOVE      PURNO,KEY8
          CALL      RDMAST1
          BRANCH    OVRCD OF URLOOP
.
          MOVE      OBADATE WITH TMPADATE       
.
          IF        IBCNUGST=2
            MOVE      ZERO,IBCNUGST         * set no GST for pending report
            CALL      OUTTBI
            MOVE      TWO,IBCNUGST
          ELSE
            CALL      OUTTBI
          ENDIF
          MOVE      ZERO,TOTDAYS
.
          MOVE      OBACOMP,ACLAIM
          MOVE      OBACLASS,ATYPE
          MOVE      OBASRCR,ACLSS
          MOVE      OBAINS,AUSR2
          MOVE      OTBBFUND,AFUNDH
          GOTO      INVLOOP
.
.        A + E to be invoiced
.
AAECALC   BRANCH    PASS,AAECALC0
          GOTO      URLOOP
.
AAECALC0  MOVE      IPADMNO,PVIBILL
          MOVE      PVIBILL,KEY8
          CALL      RDVISA1
          BRANCH    OVRCD OF URLOOP
.
          COMPARE   NINE,PVITYPE
          GOTO      AAECAL10 IF NOT EQUAL
.
          MOVE      PVIURNO,ADAURNO
          MOVE      PVIBILL,ADANUMB
          MATCH     " 1",PVISYST
          GOTO      AAECAL10 IF NOT EQUAL
.
          MOVE      PVIBILL,KEY8
          CALL      RDPMEVT1                     * check for event
          BRANCH    OVRCD,AAECAL10
          PACK      KEY5,ANSE,ANSV,PMEVEVNT,SP70
          CALL      RDCODE1
          BRANCH    OVRCD,AAECAL10
          MATCH     ANSE,TCINDC1
          GOTO      AAECAL20 IF EQUAL            * Emergency event
.
AAECAL10  MOVE      PVIBILL,KEY8
          CALL      RDDETA1
          BRANCH    OVRCD OF URLOOP
          CALL      RDEMVIS1
          BRANCH    OVRCD OF URLOOP
          MOVE      AEDAFUND,AFUNDH
          IF        EMVISTAT=2 | EMVISTAT=3
            MOVE      EMVIDDAT,TMPDDATE      * discharged date
          ENDIF

.
AAECAL20  MOVE      ADAURNO,PURNO
          MOVE      PURNO,KEY8
          CALL      RDMAST1
          BRANCH    OVRCD OF URLOOP
.
          IF        IBCNUGST=2
            MOVE      ZERO,IBCNUGST         * set no GST for pending report
            CALL      AAETBI
            MOVE      TWO,IBCNUGST
          ELSE
            CALL      AAETBI
          ENDIF
          MOVE      ZERO,TOTDAYS
.
          MOVE      PVIBILL,KEY8
          CALL      RDPMEVT1                     * Emergency event
          IF        OVRCD=0
            MOVE      PMEVADTE,ADADATE
            MOVE      PMEVCCOD,ADACOMP
            MOVE      PMEVADMT,ADACLASS
            MOVE      SP70,ADASRC
            MOVE      SP70,ADAINSUR
          ENDIF
.           
          MOVE      ADADATE,TMPADATE       
          MOVE      ADACOMP,ACLAIM
          MOVE      ADACLASS,ATYPE
          MOVE      ADASRC,ACLSS
          MOVE      ADAINSUR,AUSR2
.
.       If the invoice is for zero amount, and zero bed days, then ignore it
.
INVLOOP   MOVE      NETTOT,GROSSTOT
.
          CALL      CHLD0000                      * Check Hold invoice status
.
          COMPARE   ZERO,GROSSTOT
          GOTO      GCASH IF NOT EQUAL
.
          COMPARE   ZERO,TOTDAYS
          GOTO      GCASH IF NOT EQUAL
.
.       Invoice for Zero amount, Zero days - if patient is discharged, delete
.       record from the PATIPEFD file
.
          BRANCH    IPSYSTM OF DELIPEN,DELIPEN,CHKSTAT,DELIPEN
.
          COMPARE   THREE,ASTAT
          GOTO      DELIPEN IF EQUAL
          GOTO      URLOOP
.
.       Process any pending cash
.
GCASH     CALL      GETCASH
          SUB       CSAMT,NETTOT
.
.       Check with the indicator to remove the zero amounts of invoice
.
          COMPARE   ONE,CREMINV
          GOTO      OKPRT IF NOT EQUAL
.
          COMPARE   ZERO,GROSSTOT
          GOTO      OKPRT IF NOT EQUAL
.
          BRANCH    IPSYSTM OF DELIPEN,DELIPEN,CHKSTAT,DELIPEN
.
CHKSTAT   COMPARE   THREE,ASTAT
          GOTO      DELIPEN IF EQUAL
          GOTO      URLOOP
.
DELIPEN   IF        CREMINV=1
            MOVE      IPADMNO,KEY8
            CALL      DEIPEN1
            CALL      RDSIPEN1
            GOTO      URLOOP
          ENDIF
.
OKPRT     CALL      CZINV000             * Check for Zero invoice option
          BRANCH    EXIT,URLOOP
.
          PACK      KEY37,ACLAIM,PFUNDH,PSNAME,IPADMNO
          CALL      RDTMP1
          BRANCH    OVRCD,OKP0500
.
          MOVE      UNKGST,TMPUGST                                     *I-43738
          ADD       TOTDAYS,TMPTDAYS
          ADD       GROSSTOT,TMPGROSS
          ADD       NETTOT,TMPNETT
          IF        PASSG = ONE
            IF        TMPUGST = ONE
              ADD       TOTDAYS,GSTTDAYS
              ADD       GROSSTOT,GSTGROSS
              ADD       NETTOT,GSTNETT
            ENDIF
          ENDIF
.
.....     MOVE      UNKGST,TMPUGST                                      D-43738
          CALL      UPTMP1
          GOTO      OKP0800
.
OKP0500   MOVE      SP1,TMPASK                                         *I-43738
.* ****************************************** Start of moved code      *C-43738
          MATCH     "Y",PTMICMXP                 * using casemix ?
          IF        @EQUAL
            MOVE      "*",TMPASK                 * yes
          ELSE
            IF        OPTION = THREE
              GOTO      URLOOP                   * print casemix only patients
            ENDIF
          ENDIF
.* ******************************************   End of moved code      *C-43738
.
          MOVE      IPADMNO,TMPADMNO
          MOVE      PURNO,TMPURNO
          MOVE      PGNAME,TMPGNAME
          MOVE      PSNAME,TMPSNAME
          MOVE      ACLAIM,TMPCLAIM
          MOVE      AFUNDH,TMPAFUND
          MOVE      ACLSS,TMPACLSS
          MOVE      AUSR2,TMPAUSR2
          MOVE      ATYPE,TMPATYPE
          MOVE      TOTDAYS,TMPTDAYS
          MOVE      GROSSTOT,TMPGROSS
          MOVE      NETTOT,TMPNETT
          MOVE      UNKGST,TMPUGST
          MOVE      PFUNDH,TMPHFCOD              * health fund
          MOVE      PTIPRHLD,TMPIHOLD
.
.*                                          * code moved from here      D-43738
.
.* ****************************************** Start of Addition        *I-43738
          IF        PASSG = ONE
            IF        TMPUGST = ONE
              ADD       TOTDAYS,GSTTDAYS
              ADD       GROSSTOT,GSTGROSS
              ADD       NETTOT,GSTNETT
            ENDIF
          ENDIF
.* ******************************************   End of Addition        *I-43738
.
          CALL      WRTMP1
.
.-------- Update/write subtotals --------
.
OKP0800   CALL      ZTMP0000
 
          MOVE      ACLAIM,TMPCLAIM
          MOVE      AFUNDH,TMPAFUND
          MOVE      ZEDS,TMPHFCOD
          UNPACK    ZEDS,TMPSNAME,TMPADMNO
          PACK      KEY37,ACLAIM,TMPHFCOD,TMPSNAME,TMPADMNO
.         PACK      KEY37,ACLAIM,ZEDS
          CALL      RATMP1
          BRANCH    OVRCD,OKP1000
.
          CALL      RDTMP1
.
          IF        PASSG=ONE
            MOVE      ONE,TMPUGST
            CALL      UPTMP1
.
            PACK      KEY37,ACLAIM,ZEDS,ZEDS
            CALL      RDTMP1
            BRANCH    OVRCD,OKP1000
          ENDIF
.
          ADD       TOTDAYS,TMPTDAYS
          ADD       GROSSTOT,TMPGROSS
          ADD       NETTOT,TMPNETT
          MATCH     TMPADMNO,Z8
.
          CALL      UPTMP1
          GOTO      OKP2000
.
OKP1000   MOVE      ACLAIM,TMPCLAIM
          MOVE      AFUNDH,TMPAFUND
          MOVE      ZEDS,TMPHFCOD
          UNPACK    ZEDS,TMPSNAME,TMPADMNO
          MOVE      TOTDAYS,TMPTDAYS
          MOVE      GROSSTOT,TMPGROSS
          MOVE      NETTOT,TMPNETT
          CALL      WRTMP1
.
.-------  Write/update grand totals -------
OKP2000   
          PACK      KEY37,ZEDS
          CALL      RDTMP1
          BRANCH    OVRCD,OKP3000
.
          IF        PASSG = ONE
            MOVE      ONE,TMPUGST
            CALL      UPTMP1
.
.* ****************************************** Start of Deletion         D-43738
.....       IF        TMPUGST = ONE
.....         ADD       TOTDAYS,GSTTDAYS
.....         ADD       GROSSTOT,GSTGROSS
.....         ADD       NETTOT,GSTNETT
.....       ENDIF
.* ******************************************   End of Deletion         D-43738
          ENDIF
          ADD       TOTDAYS,TMPTDAYS
          ADD       GROSSTOT,TMPGROSS
          ADD       NETTOT,TMPNETT

          MOVE      UNKGST,TMPUGST
          CALL      UPTMP1
.
          GOTO      URLOOP
OKP3000
          UNPACK    ZEDS,TMPCLAIM,TMPHFCOD,TMPSNAME,TMPADMNO
          MOVE      TOTDAYS,TMPTDAYS
          MOVE      GROSSTOT,TMPGROSS
          MOVE      NETTOT,TMPNETT
          CALL      WRTMP1
          
          GOTO      URLOOP
.
URLOOP99  RETURN
.
.*******************************************************************************
.           Check Status of Hold invoice
.*******************************************************************************
CHLD0000  MATCH     SP70,PTIPRHLD
          GOTO      CHLD0200 IF EQUAL             * not on hold
.
.         Invoice already on hold, check for Patient hold invoice
.
          MOVE      "rh",KEY2
          PACK      KEY5,KEY2,PTIPRHLD
          CALL      RDCODE1
          BRANCH    OVRCD,CHLD0200
.
          MATCH     "P",TCINDC2
          GOTO      CHLD9999 IF EQUAL             * Patient hold invoice
.
          MATCH     "C",TCINDC4
          GOTO      CHLD9999 IF EQUAL             * CodeFocus hold invoice
.
CHLD0200  UNPACK    SP70,PENDHOSP,PENDDDAT,PENDCLAM,PENDFUND
          IF        IBCNMHOS=1
            MOVE      PMVXMHOS,PENDHOSP            * hospital id
          ENDIF
          MOVE      ZERO,F2
          MOVE      IPSYSTM,F2
          MOVE      F2,PENDSYST                    * system
.
          MOVE      TMPADATE,PENDADAT              * Admission date
          MOVE      TMPADATE,PENDSDAT              * as at date
          MOVE      ACLAIM,PENDCLAM              * claim code
          MOVE      AFUNDH,PENDFUND              * health fund
          MOVE      TMPDDATE,PENDDDAT              * discharge date
.
          CALL      IPRH0000
          CALL      UPIPEN1                        * Update Hold Invoice status
.
CHLD9999  RETURN
+
.*******************************************************************************
.         Check for Zero Invoice option
.         ZEROINV=0 Include 1=Exclude 2=Only Zero invoice
.*******************************************************************************
CZINV000  MOVE      ZERO,EXIT
.
.       If the invoice is for zero amount, and zero bed days, then ignore it
.
          COMPARE   ZERO,GROSSTOT
          GOTO      CZINV200 IF NOT EQUAL
          COMPARE   ZERO,TOTDAYS
          GOTO      CZINV900 IF EQUAL
.
.       Check if zero invoice to be included/excluded or print only zero inv.
.
          CMATCH    "1",ZEROINVC
          GOTO      CZINV900 IF EQUAL      * Exclude zero invoice
          GOTO      CZINV999
.
CZINV200  CMATCH    "2",ZEROINVC           * Print zero invoice only?
          GOTO      CZINV999 IF NOT EQUAL
.
CZINV900  MOVE      ONE,EXIT
CZINV999  RETURN
+
.------------------------------------------------------------------------------
.       OVER CONDITION FOUND..PRINT LAST LINE OF -- AND DISPLAY MESSAGE
.------------------------------------------------------------------------------
.
PRTTOT    BRANCH    EXPORTFL,PRTTOT99
.
          COMPARE   "99",CLNO                             * was ENDP   *C-47055
          RETURN    IF EQUAL
.
.* ****************************************** Start of Changed code     D-47055
.
          ADD       TMPGROSS,RPTGROSS       * add Report Totals
          ADD       TMPNETT,RPTNETT
          ADD       TMPTDAYS,RPTTDAYS
          ADD       TMPGROSS,FINGROSS       * add Grand Totals
          ADD       TMPNETT,FINNETT
          ADD       TMPTDAYS,FINTDAYS
.
PRTTOT20  BRANCH    FSTSYS OF PRTTOT30,PRTTOT30
.
.         Inpatients Reports  (Discharged, Current Inpats., Consolidated)
.
          PRINT     *98,"-------",*108,"-----------",*122,"-----------":
                    *N,*83,"Total ",*97,TMPTDAYS:
                    *108,TMPGROSS,*122,TMPNETT
          GOTO      PRTTOT99
.
.         A & E and Outpatients Reports
.
PRTTOT30  MOVE      ZERO,OVRCD
          PRINT     *108,"-----------",*122,"-----------":
                    *N,*83,"Report Total ",*108,TMPGROSS,*122,TMPNETT
.
PRTTOT99  RETURN
.
.         Print "Report Total"
.
PRTRTOT   BRANCH    EXPORTFL,PRTRTOT9
          BRANCH    FSTSYS OF PRTRTOT9,PRTRTOT9
.
          IF        DISCONLY = ONE & OPTION = THREE
            GOTO      PRTRTOT9
          ENDIF
.
          PRINT     *98,"-------",*108,"-----------",*122,"-----------":
                    *N,*83,"Report Total ",*97,RPTTDAYS:
                    *108,RPTGROSS,*122,RPTNETT
.
          MOVE      ZERO,RPTGROSS
          MOVE      ZERO,RPTNETT
          MOVE      ZERO,RPTTDAYS
.
PRTRTOT9  RETURN
.
.         Print "Grand Total"
.
PRTFTOT   BRANCH    EXPORTFL,PRTFTOT9
.
          BRANCH    FSTSYS OF PRTFTOT9,PRTFTOT9
.
          PRINT     *98,"-------",*108,"-----------",*122,"-----------":
                    *N,*83,"Grand Total ",*97,FINTDAYS:
                    *108,FINGROSS,*122,FINNETT
.
PRTFTOT9  RETURN
.
.         Print "End of Report"
.
PRTENDR   BRANCH    EXPORTFL,PRTENDR9
.
          MOVE      ZERO,OVRCD
.
          PRINT     *N,*N,"  ***  END OF REPORT  ***"
PRTENDR9  RETURN
.* ******************************************   End of Changed code     D-47055
.
.-----------------------------------------------------------------------------
.     PRINT ACTUAL DATA 
._____________________________________________________________________________
.
PRINTL    MOVE      ZERO,OVRCD
.
          PACK      KEY37,SP30,SP10
          CALL      RSTMP1
.
PRIN1000  CALL      RKTMP1
          BRANCH    OVRCD,PRIN9000
.
          MOVE      TWO,PACFRMT
          MOVE      TMPGNAME,PACGNAME
          MOVE      TMPSNAME,PACSNAME
          CALL      PACNAME                     * pack up patient name
          PACK      DIM22,PACFNAME
.
          MATCH     Z3,TMPCLAIM
          GOTO      PRIN9000 IF EQUAL
.
.-----  Get claim code description for heading -------
.
          MOVE      SP20,CLAIMDES
          PACK      TMPCLAIM,TMPCLAIM,SP3
          MATCH     SP3,TMPCLAIM
          GOTO      PRIN1500 IF EQUAL
.
          MOVE      SP20,TDESC
          PACK      KEY5,CODECL,TMPCLAIM
          CALL      RDCODE1
          MOVE      TDESC,CLAIMDES 
.
PRIN1500  MATCH     Z20,TMPSNAME
          GOTO      PRIN3000 IF NOT EQUAL
.
          BRANCH    EXPORTFL,PRIN5000
.
          BRANCH    PASSG,PRIN5000
          BRANCH    PASS,SUBPA
.
.         Discharged Patients Report
          PRINT     *98,"-------",*108,"-----------",*122,"-----------":
                    *N,*83,"Sub-Total ",*97,TMPTDAYS,*108,TMPGROSS,*122,TMPNETT
          GOTO      PRIN5000
.         Current Admissions Report
.
SUBPA     BRANCH    FSTSYS OF SUBNIP,SUBNIP
.
          PRINT     *98,"-------",*108,"-----------",*122,"-----------":
                    *N,*83,"Sub-Total ",*97,TMPTDAYS,*108,TMPGROSS,*122,TMPNETT 
          GOTO      PRIN5000
.
SUBNIP    PRINT     *108,"-----------",*122,"-----------":
                    *N,*83,"Sub-Total ",*108,TMPGROSS,*122,TMPNETT
                  
PRIN5000  MOVE      "55",CLNO
          GOTO      PRIN1000
+
.     PRINT ACTUAL DATA
.
PRIN3000  BRANCH    PASS OF PRINTLA
.
          IF        PASSG = ONE
            COMPARE   ONE,TMPUGST
            GOTO      PRIN1000 IF NOT EQUAL
          ELSE
            COMPARE   "55",CLNO
            CALL      HEAD IF NOT LESS
            COMPARE   "55",CLNO
            GOTO      PRIN1000 IF EQUAL
          ENDIF
.
          MOVE      SP20,DIM13
          MOVE      TMPGNAME,DIM13
          UNPACK    TMPADATE,ACEN,AYER,AMON,ADAY
          UNPACK    TMPDDATE,DDCEN,DDYER,DDMON,DDDAY
          MOVE      TMPTDAYS,FORM4
          MOVE      TMPGROSS,FORM6P2
          MOVE      TMPNETT,FORM6P2A
.
          IF        PASSG=1
            IF        GSTFLG=0
              CALL      HEAD
            ENDIF
          ENDIF
.
          IF        EXPORTFL=1
            CALL      PELN0000                * Print export file line
          ELSE
            PRINT     TMPADMNO,*10,TMPURNO,*19,DIM22,*43,TMPHFCOD:
                      *50,ADAY,SLASH,AMON:
                      SLASH,ACEN,AYER,*61,DDDAY,SLASH,DDMON,SLASH,DDCEN,DDYER:
                      *74,TMPCLAIM,*80,TMPACLSS,*86,TMPAUSR2,*91,TMPASK:
                      *92,TMPATYPE:
                      *101,FORM4,*110,FORM6P2,*124,FORM6P2A
          ENDIF
.
          MOVE      ONE,GSTFLG
          ADD       ONE,CLNO
          GOTO      PRIN1000
.
PRINTLA   IF        PASSG = ONE
            COMPARE   ONE,TMPUGST
            GOTO      PRIN1000 IF NOT EQUAL
          ELSE
            COMPARE   "55",CLNO
            CALL      HEADA IF NOT LESS
            COMPARE   ONE,TMPUGST
            GOTO      PRIN1000 IF EQUAL
          ENDIF
.
          BRANCH    IPSYSTM OF PRINTNP,PRINTNP,PRINTNI,PRINTNP
.
PRINTNI   PACK      NAMEDIM,SP20
          MOVE      TMPGNAME,NAMEDIM
          UNPACK    TMPADATE,ACEN,AYER,AMON,ADAY
          MOVE      TMPTDAYS,FORM4
          MOVE      TMPGROSS,FORM6P2
          MOVE      TMPNETT,FORM6P2A
          MOVE      TMPUGST,UNKGST
.
          IF        PASSG=1
            IF        GSTFLG=0
              CALL      HEADA
            ENDIF
          ENDIF
.
          IF        EXPORTFL=1
            UNPACK    SP70,DDCEN,DDYER,DDMON,DDDAY
            CALL      PELN0000                * Print export file line
          ELSE
            PRINT     TMPADMNO,*10,TMPURNO,*19,DIM22,*43,TMPHFCOD:
                      *59,ADAY,SLASH,AMON,SLASH,ACEN,AYER:
                      *72,TMPCLAIM,*78,TMPACLSS,*85,TMPAUSR2,*90,TMPASK:
                      *91,TMPATYPE:
                      *101,FORM4,*110,FORM6P2,*124,FORM6P2A
          ENDIF
.
          MOVE      ONE,GSTFLG
          ADD       ONE,CLNO
          GOTO      PRIN1000
.
PRINTNP   PACK      NAMEDIM,SP20
          MOVE      TMPGNAME,NAMEDIM
          UNPACK    TMPADATE,ACEN,AYER,AMON,ADAY
          MOVE      TMPGROSS,FORM6P2
          MOVE      TMPNETT,FORM6P2A
.
          IF        PASSG=1
            IF        GSTFLG=0
              CALL      HEADA
            ENDIF
          ENDIF
.
          IF        EXPORTFL=1
            UNPACK    SP70,DDCEN,DDYER,DDMON,DDDAY
            CALL      PELN0000                * Print export file line
          ELSE
            PRINT     TMPADMNO,*10,TMPURNO,*19,DIM22,*43,TMPHFCOD:
                      *59,ADAY,SLASH,AMON,SLASH,ACEN,AYER:
                      *72,TMPCLAIM,*78,TMPACLSS,*85,TMPAUSR2,*90,TMPASK:
                      *91,TMPATYPE:
                      *110,FORM6P2,*124,FORM6P2A
          ENDIF
.
          MOVE      ONE,GSTFLG
          ADD       ONE,CLNO
          GOTO      PRIN1000
.
PRIN9000  COMPARE   ZERO,PASSG
          GOTO      PRIN9900 IF EQUAL                                  *C-43738
.
          BRANCH    EXPORTFL,PRIN9900
.
          IF        GSTNETT=0
            GOTO      PRIN9900                                         *C-43738
          ENDIF
          BRANCH    FSTSYS,PRIN9500
.
          PRINT     *98,"-------",*108,"-----------",*122,"-----------":
                    *N,*83,"GST-Total ",*97,GSTTDAYS,*108,GSTGROSS,*122,GSTNETT
          GOTO      PRIN9900                                           *C-43738
.
PRIN9500  PRINT     *108,"-----------",*122,"-----------":
                    *N,*83,"GST-Total ",*108,GSTGROSS,*122,GSTNETT
.
PRIN9900  MOVE      ZERO,GSTTDAYS                                      *I-43738
          MOVE      ZERO,GSTGROSS                                      *I-43738
          MOVE      ZERO,GSTNETT                                       *I-43738
.
PRIN9999  RETURN
.
.****************************************************************************
.         Print line for Export file
.****************************************************************************
PELN0000    MOVE      "N",KEY1
            PACK      DIM3T,SP70
.
            UNPACK    SP70,PMVXATCP,ACODDTE,PMVXMHOS
            MOVE      TMPADMNO,KEY8
            CALL      RDMISS1
            IF        OVRCD=0
              MATCH     SP70,ACODDTE
              IF        !@EQUAL
                MOVE      "Y",KEY1                * Coding Complete
              ENDIF
            ENDIF
.
            MOVE      TMPADMNO,KEY8
            CALL      RDPMVX11
            IF        OVRCD=0
              MOVE      SP3,DIM3T                 * All theatre charges posted
              MATCH     "1",PMVXATCP
              GOTO      PELN1700 IF EQUAL
.
              PACK      KEY31,KEY8,SP70
              CALL      RSOPDEA2
PELN1000      CALL      RKOPDEA2                 * read oprdetaf Theatre Booking
              BRANCH    OVRCD,PELN1500
.
              MATCH     KEY8,OPDAADMN
              GOTO      PELN1500 IF NOT EQUAL
.
              MATCH     "3",DOPDASTA              * if booking Cancelled
              GOTO      PELN1500 IF EQUAL
.
              MATCH     "2",DOPDASTA              * if booking Admitted
              GOTO      PELN1600 IF EQUAL
.
              MATCH     "4",DOPDASTA              * if booking Discharged
              GOTO      PELN1600 IF EQUAL
.
              GOTO      PELN1000                  * next record
            ENDIF
.
            GOTO      PELN2000
.
PELN1500    MOVE      "N/A",DIM3T
            GOTO      PELN2000
.
PELN1600    MOVE      "N  ",DIM3T
            GOTO      PELN2000
.
PELN1700    MOVE      "Y  ",DIM3T
            GOTO      PELN2000
.
PELN2000    PACK      KEY8,ADAY,SLASH,AMON,SLASH,AYER,SP70
            MOVE      SP70,DIM8
            MATCH     SP70,DDDAY
            IF        !@EQUAL
              PACK      DIM8,DDDAY,SLASH,DDMON,SLASH,DDYER,SP70
            ENDIF
.
            PRINT     "<tr><td>",TMPADMNO,"</td>":
                      "<td>",TMPURNO,"</td>":
                      "<td>",DIM22,"</td>":
                      "<td>",KEY8,"</td>":
                      "<td>&nbsp;",DIM8,"</td>"
.
            PRINT     "<td>",TMPCLAIM,"</td>":
                      "<td>&nbsp;",TMPAFUND,"</td>":
                      "<td>",TMPACLSS,"</td>":
                      "<td>",KEY1,"</td>":
                      "<td>",DIM3T,"</td>":
                      "<td>",TMPATYPE,"</td>":
                      "<td>",TMPTDAYS,"</td>":
                      "<td>",TMPGROSS,"</td>":
                      "<td>",TMPNETT,"</td>":
                      "<td>",TMPIHOLD,"</td>"
.
          IF        IBCNMHOS=1
            PRINT    "<td>&nbsp;",PMVXMHOS,"</td>"
          ENDIF
          PRINT    "</tr>"
.
PELN9999  RETURN
+
.------------------------------------------------------------------------------
.                 HEADINGS FOR OUTPUT
.------------------------------------------------------------------------------
HEAD      BRANCH    EXPORTFL,HEAD9               * Export file
.
          COMPARE   ONE,PASSG
          GOTO      HEADGST IF EQUAL
          MOVE      ONE,CNOUNDLN
.
          MOVE      SP20,CPHDROPT                                      *I-43738
.
          CALL      HEAD132 
.
          IF        IBCNMHOS =1
            PRINT     *40,"Hospital : ",HOSPID,"    ",HOSPNAME
            MOVE      SEVEN,CLNO
          ELSE
            MOVE      SIX,CLNO
          ENDIF
.
          IF        OPTION = ONE
            IF        FSTSYS = ZERO | FSTSYS = THREE
              PRINT     *40,"DISCHARGED INPATIENTS"                    *C-43738
            ENDIF
          ENDIF
          IF        OPTION = TWO
            PRINT     *40,"DISCHARGED INPATIENTS ONLY"
          ENDIF
          IF        OPTION = THREE
            PRINT     *40,"CASEMIX PATIENTS ONLY"
          ENDIF
.
          CALL      PROPT000              * Print Zero Invoice option
.
.....     PRINT     *N,*N,"Claim Code : ",CLAIMDES,*N:                  D-43738
          PRINT     *N,"Claim Code : ",CLAIMDES,*N:                    *I-43738
                    "Adm.",*10,"U/R",*43,"Health",*50,"Billing":
                    *61,"Discharge",*73,"Comp.",*79,"Pat.",*84,"Charge":
                    *91,"Pat.",*98,"Days to",*110,"Amt to be":
                    *122,"Amount Less",*N:
                    "Number",*10,"Number",*19,"Patient Name",*43,"Fund":
                    *50,"Date ",*61,"Date ",*73,"Code",*79,"Cat":
                    *84,"Status",*91,"Class",*98,"Invoice":
                    *111,"Invoiced",*123,"Cash Recvd",*N:
                    *1,"--------",*10,"--------",*19,"----------------------":
                    "  ------ ":
                    *50,"----------",*61,"----------",*73,"-----",*79,"----":
                    *84,"------",*91,"-----",*98,"-------",*108,"-----------":
                    *122,"-----------"
.
          CLOCK     TIME,CTIMEIS
HEAD9     RETURN
.
HEADA     MOVE      ZERO,OVRCD                                         *I-43738
          BRANCH    EXPORTFL,HEADA9               * Export file
.
          COMPARE   ONE,PASSG
          GOTO      HEADGST IF EQUAL
.
          BRANCH    FSTSYS OF HEADNIP,HEADNIP,HEADCUR,HEADNIP
.
          MOVE      ONE,CNOUNDLN
          CALL      HEAD132
.
          IF        IBCNMHOS =1
            PRINT     *40,"Hospital : ",HOSPID,"    ",HOSPNAME
            MOVE      SEVEN,CLNO
          ELSE
            MOVE      SIX,CLNO
          ENDIF
          CALL      PROPT000              * Print Zero Invoice option
.
          PRINT     *40,"CONSOLIDATED REPORT":                         *C-43738
                    *N,*N,"Claim Code : ",CLAIMDES,*N:
                    "Adm.",*10,"U/R",*59,"Admission",*71,"Comp.",*77,"Pat.":
                    *83,"Charge",*90,"Pat.",*98,"Days to",*110,"Amt to be":
                    *122,"Amount Less",*N:
                    "Number",*10,"Number",*19,"Patient Name":
                    *63,"Date",*71,"Code",*77,"Cat",*83,"Status",*90,"Class":
                    *98,"Invoice":
                    *111,"Invoiced",*123,"Cash Recvd",*N:
                    *1,"--------",*10,"--------",*19,"----------------------":
                    "-----------------":
                    *59,"----------",*71,"-----",*77,"-----",*83,"------":
                    *90,"-----",*98,"-------":
                    *108,"-----------",*122,"-----------"
.
          CLOCK     TIME,CTIMEIS
HEADA9    RETURN
.
HEADGST   MOVE      ONE,CNOUNDLN
          CALL      HEAD132
          IF        IBCNMHOS =1
            PRINT     *40,"Hospital : ",HOSPID,"    ",HOSPNAME
            MOVE      SEVEN,CLNO
          ELSE
            MOVE      SIX,CLNO
          ENDIF
          CALL      PROPT000              * Print Zero Invoice option
.
          BRANCH    PASS,HEADGSTC
.
HEADGSTD  PRINT     *40,"GST UNKNOWN FOR DISCHARGED PATIENTS",*N,*N:   *C-43738
                    "Adm.",*10,"U/R",*50,"Billing":
                    *61,"Discharge",*73,"Comp.",*79,"Pat.",*84,"Charge":
                    *91,"Pat.",*98,"Days to",*110,"Amt to be":
                    *122,"Amount Less",*N:
                    "Number",*10,"Number",*19,"Patient Name":
                    *50,"Date ",*61,"Date ",*73,"Code",*79,"Cat":
                    *84,"Status",*91,"Class",*98,"Invoice":
                    *111,"Invoiced",*123,"Cash Recvd",*N:
                    *1,"--------",*10,"--------",*19,"---------------------":
                    "---------":
                    *50,"----------",*61,"----------",*73,"-----",*79,"----":
                    *84,"------",*91,"-----",*98,"-------",*108,"-----------":
                    *122,"-----------"
.
          CLOCK     TIME,CTIMEIS
          RETURN
.
HEADGSTC  PRINT     *40,"GST UNKNOWN FOR CURRENT ADMISSIONS",*N:
                    "Adm.",*10,"U/R",*59,"Admission",*71,"Comp.",*77,"Pat.":
                    *83,"Charge",*90,"Pat.",*98,"Days to",*110,"Amt to be":
                    *122,"Amount Less",*N:
                    "Number",*10,"Number",*19,"Patient Name":
                    *63,"Date",*71,"Code",*77,"Cat",*83,"Status",*90,"Class":
                    *98,"Invoice":
                    *111,"Invoiced",*123,"Cash Recvd",*N:
                    *1,"--------",*10,"--------",*19,"----------------------":
                    "-----------------":
                    *59,"----------",*71,"-----",*77,"-----",*83,"------":
                    *90,"-----",*98,"-------":
                    *108,"-----------",*122,"-----------"
.
          CLOCK     TIME,CTIMEIS
          RETURN
.
HEADCUR   MOVE      ONE,CNOUNDLN
          CALL      HEAD132 
.
          IF        IBCNMHOS =1
            PRINT     *40,"Hospital : ",HOSPID,"    ",HOSPNAME
            MOVE      SEVEN,CLNO
          ELSE
            MOVE      SIX,CLNO
          ENDIF
          CALL      PROPT000              * Print Zero Invoice option
.
          PRINT     *40,"INPATIENTS - CURRENT ADMISSIONS"              *C-43738
          PRINT     *N,"Claim Code : ",CLAIMDES,*N:
                    "Adm.",*10,"U/R",*59,"Admission",*71,"Comp.",*77,"Pat.":
                    *83,"Charge",*90,"Pat.",*98,"Days to",*110,"Amt to be":
                    *122,"Amount Less",*N:
                    "Number",*10,"Number",*19,"Patient Name":
                    *62,"Date",*71,"Code",*77,"Cat",*83,"Status",*90,"Class":
                    *98,"Invoice":
                    *111,"Invoiced",*123,"Cash Recvd",*N:
                    *1,"--------",*10,"--------",*19,"--------------------":
                    "-------------------":
                    *59,"-----------",*71,"-----",*77,"-----",*83,"------":
                    *90,"-----",*98,"-------":
                    *108,"-----------",*122,"-----------"
.
          CLOCK     TIME,CTIMEIS
          RETURN
.
HEADNIP   BRANCH    FSTSYS,HEADNIPA,HEADNIPO,HEADCUR,HEADNIPH
.
HEADNIPA  MOVE      ONE,CNOUNDLN
          CALL      HEAD132
          IF        IBCNMHOS =1
            PRINT     *40,"Hospital : ",HOSPID,"    ",HOSPNAME
          ENDIF
.
          PRINT     *40,"ACCIDENT & EMERGENCY":                        *C-43738
                    *N,*N,"Claim Code : ",CLAIMDES,*N                  *C-43738
          GOTO      HEADNIPC
.
HEADNIPH  MOVE      ONE,CNOUNDLN
          CALL      HEAD132
          IF        IBCNMHOS =1
            PRINT     *40,"Hospital : ",HOSPID,"    ",HOSPNAME
          ENDIF
.
          PRINT     *40,"OTHER FINANCIAL":
                    *N,*N,"Claim Code : ",CLAIMDES,*N
          GOTO      HEADNIPC
.
HEADNIPO  MATCH     SP3,FSTDEPT
          GOTO      HEADNIPD IF NOT EQUAL
.
          MOVE      ONE,CNOUNDLN
          CALL      HEAD132
.
          IF        IBCNMHOS =1
            PRINT     *40,"Hospital : ",HOSPID,"    ",HOSPNAME
          ENDIF
.
          PRINT     *40,"OUTPATIENTS";
.
          PRINT     *N,*40,"SITES ";
.
          MATCH     SP6,FSTSITE
          IF  @EQUAL
            PRINT     *46,"START ";
           ELSE
            PRINT     *46,FSTSITE;
          ENDIF
.
          PRINT     *52," TO ";
.
          MATCH     "ZZZZZZ",FEDSITE
          IF  @EQUAL
            PRINT     *56,"FINISH";
           ELSE
            PRINT     *56,FEDSITE;
          ENDIF
.
          PRINT    *N,*N,"Claim Code : ",CLAIMDES,*N
          GOTO      HEADNIPC
.
HEADNIPD  MOVE      SP20,TDESC
          PACK      KEY5,CODEO,FSTDEPT
          CALL      RDCODE1
.
          MOVE      ONE,CNOUNDLN
          CALL      HEAD132
.
          IF        IBCNMHOS =1
            PRINT     *40,"Hospital : ",HOSPID,"    ",HOSPNAME
          ENDIF
.
          PRINT     *40,"OUTPATIENTS",*N
.
          MATCH     SP6,FSTSITE
          GOTO      OPSITE IF NOT EQUAL
.
          PRINT     *45,"ALL SITES";
          GOTO      OPDEPT
.
OPSITE    PRINT     *40,"SITE ",FSTSITE;
.
OPDEPT    MATCH     SP3,FSTDEPT
          GOTO      HEADNIPC IF EQUAL
.
          PRINT     *55,"DEPARTMENT ",FSTDEPT:
                    *N,*N,"Claim Code : ",CLAIMDES,*N
.
HEADNIPC  IF        IBCNMHOS =1
            MOVE      SEVEN,CLNO
          ELSE
            MOVE      SIX,CLNO
          ENDIF
          CALL      PROPT000              * Print Zero Invoice option
.
          PRINT     "Bill",*10,"U/R",*60,"Service",*71,"Comp.",*77,"Sour.":
                    *83,"Insr.",*90,"Pat.",*98,"Days to",*110,"Amt to be":
                    *122,"Amount Less",*N:
                    "Number",*10,"Number",*19,"Patient Name":
                    *60,"Date",*71,"Code",*77,"Ref",*83,"Status",*90,"Class":
                    *98,"Invoice",*111,"Invoiced",*123,"Cash Recvd",*N:
                    *1,"--------",*10,"--------",*19,"----------------------":
                    "-----------------":
                    *59,"----------",*71,"-----",*77,"-----",*83,"------":
                    *90,"-----",*98,"-------":
                    *108,"-----------",*122,"-----------"
.
          CLOCK     TIME,CTIMEIS
          RETURN
.
.*******************************************************************************
.         Print Zero invoice option on header
.*******************************************************************************
PROPT000  MOVE      "(Include Zero Invoice)",KEY25
          MATCH     "1",ZEROINVC
          IF        @EQUAL
            MOVE      "(Exclude Zero Invoice)",KEY25
          ELSE
            MATCH     "2",ZEROINVC
            IF        @EQUAL
              MOVE      "(Zero Invoice Only)",KEY25
            ENDIF
          ENDIF
          PRINT     *40,KEY25
          ADD       ONE,CLNO
PROPT999  RETURN
+
.*******************************************************************************
.         Routine to print heading for Export File
.*******************************************************************************
EHED0000  PRINT     "<table border=1><tr><td width=10%>Admission No.</td>":
                    "<td>U/R No.</td>":
                    "<td>Patient Name</td>":
                    "<td>Billing Date</td>":
                    "<td>Discharge Date</td>":
                    "<td>Compensation Code</td>":
                    "<td>Health Fund</td>":
                    "<td>Patient Category</td>":
                    "<td>Coding Complete</td>"
.
          PRINT     "<td>All Theatre Charges Posted</td>":
                    "<td>Patient Class</td>":
                    "<td>Days to Invoice</td>":
                    "<td>Amt to be Invoiced</td>":
                    "<td>Amount Less Cash Received</td>":
                    "<td>Reason for Hold</td>"
.
          IF        IBCNMHOS=1
            PRINT    "<td>Hospital Id</td>"
          ENDIF
.
          PRINT    "</tr>"
.
EHED9999   RETURN
+
.*******************************************************************************
GETCASH   OPEN      COMDEPA2,"comdepaf"
          OPEN      RCPDTEA1,"rcpdteaf"
          MOVE      ZERO,CSAMT
          MOVE      IPADMNO,DAADMNO
          MOVE      "0",CMDESTAT
          PACK      KEY26,IPADMNO,CMDESTAT,SP70
          CALL      RSCMDEP2
CASHLP1   CALL      RKCMDEP2
          BRANCH    OVRCD OF ENDCSHLP
.
          MATCH     DAADMNO,CMDEADMN
          GOTO      ENDCSHLP IF NOT EQUAL
.
          MATCH     "0",CMDESTAT                   * Deposit held?
          GOTO      ENDCSHLP IF NOT EQUAL
.
          PACK      KEY17,CMDERECN,CMDETCNT
          CALL      RDRCDTE1
          BRANCH    OVRCD,CASHLP1
.
          ADD       RCDTAMNT,CSAMT
          GOTO      CASHLP1
.
ENDCSHLP  CLOSE     COMDEPA2
          CLOSE     RCPDTEA1
          RETURN
.
.***************************************************************************
.*                            BULD0000                                     *
.*                        Build the tempfile                               *
.*************************************************************************** 
BULD0000  CALL      KILL0000
.
          CLEAR     CMDLINE
          APPEND    "isbuild ",CMDLINE
          APPEND    TMPFNAME,CMDLINE
          APPEND    " 125 u1-3,90-95,4-23,24-31",CMDLINE
          APPEND    SP30,CMDLINE
          RESET     CMDLINE
.
          EXECUTE   CMDLINE,TASKID
          OPEN      TMPFILE1,TMPFNAME
.
BULD9999  RETURN
.
.***************************************************************************
.*                            KILL0000                                     *
.*                    Kill the tempfile before build                       *
.*************************************************************************** 
KILL0000  CLEAR     CMDLINE
          CLOSE     TMPFILE1
          APPEND    "iserase ",CMDLINE
          APPEND    TMPFNAME,CMDLINE
          RESET     CMDLINE
.
          EXECUTE   CMDLINE,TASKID
.
KILL9999  RETURN
.
.**************************************************************************
.*                              ZTMP0000                                  *
.*                     clear the tempfile variables                       *
.**************************************************************************
ZTMP0000
          UNPACK    SP30,TMPCLAIM,TMPSNAME
          UNPACK    SP30,TMPADMNO,TMPURNO,TMPADATE,TMPDDATE
          UNPACK    SP30,TMPCLAIM,TMPACLSS,TMPAUSR2,TMPATYPE
          MOVE      ZERO,TMPTDAYS
          MOVE      ZERO,TMPGROSS
          MOVE      ZERO,TMPNETT 
          MOVE      SP30,TMPGNAME 
          MOVE      SP6,TMPHFCOD
          MOVE      SP70,TMPAFUND
          MOVE      SP70,TMPIHOLD
.
ZTMP9999  RETURN
.
.---------------------------------------------------------------------------
.      I/O fro the tempfile
.---------------------------------------------------------------------------
.
RSTMP1    RESET    KEY37
          READ     TMPFILE1,KEY37;;
          RETURN
.
RATMP1    RESET    KEY37
          MOVE     ZERO,OVRCD
          READ     TMPFILE1,KEY37;ANS
          GOTO      OVERCOND IF OVER
          RETURN
.
RDTMP1    MOVE      ZERO,OVRCD
          RESET     KEY37
          READ      TMPFILE1,KEY37;TMPCLAIM,TMPSNAME,TMPADMNO,TMPURNO,TMPGNAME:
                                   TMPADATE,TMPDDATE,TMPACLSS,TMPAUSR2:
                                   TMPATYPE,TMPHFCOD,TMPTDAYS,TMPGROSS:
                                   TMPNETT,TMPUGST,TMPASK,TMPAFUND,TMPIHOLD
          GOTO      OVERCOND IF OVER
          RETURN
.
RKTMP1    MOVE      ZERO,OVRCD
          READKS    TMPFILE1;TMPCLAIM,TMPSNAME,TMPADMNO,TMPURNO,TMPGNAME:
                             TMPADATE,TMPDDATE,TMPACLSS,TMPAUSR2:
                             TMPATYPE,TMPHFCOD,TMPTDAYS,TMPGROSS:
                             TMPNETT,TMPUGST,TMPASK,TMPAFUND,TMPIHOLD
          GOTO      OVERCOND IF OVER
          RETURN
.
WRTMP1    RESET     KEY37
          WRITE     TMPFILE1,KEY37;TMPCLAIM,TMPSNAME,TMPADMNO,TMPURNO,TMPGNAME:
                                   TMPADATE,TMPDDATE,TMPACLSS,TMPAUSR2:
                                   TMPATYPE,TMPHFCOD,TMPTDAYS,TMPGROSS:
                                   TMPNETT,TMPUGST,TMPASK,TMPAFUND,TMPIHOLD
          RETURN
.
UPTMP1    RESET     KEY37
          UPDATE    TMPFILE1;TMPCLAIM,TMPSNAME,TMPADMNO,TMPURNO,TMPGNAME:
                             TMPADATE,TMPDDATE,TMPACLSS,TMPAUSR2:
                             TMPATYPE,TMPHFCOD,TMPTDAYS,TMPGROSS:
                             TMPNETT,TMPUGST,TMPASK,TMPAFUND,TMPIHOLD
          RETURN
.
DETMP1    RESET     KEY37
          DELETE    TMPFILE1,KEY37
          RETURN
+
******************************************************************************
          INCLUDE   AAECATBI
          INCLUDE   OUTCATBI
          INCLUDE   PATCATBI
          INC       PATIVMES
          INCLUDE   STEPDOWN
.
SBDY0000
PATSTRYR
ADDWRN00
.
WRITETRN
GETTHR
GETMSC
PATCALF
TAIL
INITIVAR
PROCACCM
PROCMISC
PRTCLMS
NXTTRAN1
WEBERR00
PRTINVTL
SINVT000
DOCNM000
PRLN0000
PEOL0000
ENDPRT00
CKTL0000
PROACC00
PRTIPROV
ENDPRT    RETURN
.
          INC       CALCDAYS
          INC       CLNZPPIC
          INC       CHKCMXPT                * Check if casemix & get epis type
          INC       CLPATDTR                * Clear DTR file variables
          INC       CMXMATRX
          INC       CMGETTHR
          INC       PATGNCMX
          INC       PATHSPKY
          INC       PATSELFN
          INC       PATCODDS
          INC       PATCOMN3
          INC       PATCMSTP
          INC       NHOSPDAY
          INC       PABXBILL
          INC       SAPARINT                * SAP AR Acrruals          *I-61019
          INC       PRBILCMN
          INC       PATMCHRD                * Miscellaneous Charges read routine
          INC       GETBFEES
          INC       GETTFEES
          INC       GETCNEFF
          INC       ICDSCLAS
.
          INC       AAEDE1IO/INC     
          INC       AAEDTRIO/INC
          INC       EMRSITIO/INC
          INC       EMRHISIO/INC
          INC       EMRVISIO/INC
.
          INC       MLTCFNIO/INC
          INC       NZPEXTIO/INC
          INC       NZPRDTIO/INC
          INC       NZPBFEIO/INC
          INC       NZPCFNIO/INC
          INC       NZPCMTIO/INC
          INC       NZPFIGIO/INC
          INC       NZPIBRIO/INC
          INC       NZPMCHIO/INC
          INC       NZPMXCIO/INC
          INC       NZPPFEIO/INC
          INC       NZPPICIO/INC
          INC       NZPRBRIO/INC
          INC       NZPRFNIO/INC
          INC       NZPFINIO/INC
          INC       NZPSPRIO/INC
          INC       NZPTFEIO/INC
          INC       NZPIVBIO/INC
          INC       NZPRVBIO/INC
          INC       OPRDEAIO/INC
          INC       OPRSESIO/INC
          INC       OUTBB1IO/INC
          INC       OUTDTRIO/INC
          INC       OUTSITIO/INC
.
          INC       PATAFEIO/INC
          INC       PATASDIO/INC
          INC       PATCMXIO/INC
          INC       PATCTFIO/INC
          INC       PMSCIDIO/INC
          INC       PMSCCDIO/INC
          INC       PATCFAIO/INC
          INC       PATHDFIO/INC
          INC       PATHLFIO/INC
          INC       PATICUIO/INC
          INC       PATLDFIO/INC
          INC       PATLSDIO/INC
          INC       PATFX1IO/INC
          INC       PATFN1IO/INC
          INC       PATFN2IO/INC
          INC       PATRFNIO/INC
          INC       PATRE1IO/INC
          INC       PATAA1IO/INC
          INC       PATSTAIO/INC
.
          INC       PATINMIO/INC
          INC       PATDDHIO/INC
          INC       PATDO1IO/INC
          INC       PATDGWIO/INC
          INC       PATDRGIO/INC
          INC       PATECOIO/INC
          INC       PATELGIO/INC
          INC       PATECDIO/INC                *Pat Episode Disease Coding
          INC       PATRCAIO/INC
          INC       PATWR1IO/INC
          INC       PATBFEIO/INC
          INC       PATRATIO/INC
          INC       PATFINIO/INC
          INC       PATMA1IO/INC
          INC       PATMI1IO/INC
          INC       PATDTRIO/INC
          INC       PATTRNIO/INC
          INC       PATDSCIO/INC
          INC       PATGTUIO/INC
          INC       PATIBLIO/INC
          INC       PATIPEIO/INC
          INC       PATITMIO/INC
          INC       PATFMOIO/INC
          INC       PATFHIIO/INC
          INC       PATMCHIO/INC
          INC       PATOVBIO/INC
          INC       PATCODIO/INC
          INC       PATINVIO/INC
          INC       PATHSPIO/INC
          INC       PATHTRIO/INC
          INC       EMRHTRIO/INC
          INC       OUTHTRIO/INC
          INC       PATIN1IO/INC
          INC       PATIOVIO/INC
          INC       PATTFEIO/INC
          INC       PATVISIO/INC
          INC       PATVENIO/INC
          INC       PMSHATIO/INC
          INC       PMSVX1IO/INC
          INC       PATPGRIO/INC
          INC       PATRBLIO/INC
          INC       PATSRBIO/INC
          INC       PATWC1IO/INC
          INC       PATWMAIO/INC
          INC       PATWVEIO/INC
          INC       PATONHIO/INC
          INC       PMSEVTIO/INC
          INC       PATCMTIO/INC
          INC       PMSCMTIO/INC
          INC       PMSSINIO/INC
          INC       PMSSGAIO/INC
          INC       PMSMTIIO/INC
          INC       PMSCNOIO/INC
          INC       PMSMPRIO/INC
          INC       PMSHCPIO/INC
          INC       PRIITMIO/INC
          INC       RCPBDTIO/INC
          INC       IBASECIO/INC
          INC       IBAPASIO/INC
          INC       IBAGSTIO/INC
          INC       IBAGEDIO/INC
          INC       OPRARDIO/INC
          INC       PMSPBRIO/INC
          INC       PMSIDEIO/INC
          INC       CLPMSIDE
          INC       CLPATDSC
          INC       STD001IO
          INC       VALCMXFN
          INC       TFILENAM                     * Generate Temp File Name
          INC       PATITMRD
          INC       PATIPERH
.
          INC       COMDEPIO/INC
          INC       RCPBNKIO/INC
          INC       RCPDTEIO/INC
          INC       IBASEQIO/INC                 * Sequential Numbers File
          INC       WEBERRIO/INC                 * Web Server Error Logging
          INC       PMSEDGIO/INC       * Effective DRG Dates
          INC       GETEFDRG
.
ENDIT     CALL      KILL0000                     * remove tempfile
          CHAIN     PGM
