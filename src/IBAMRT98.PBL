.******************************************************************************
.* System   : Medical Records Tracking                                        *
.* Program  : IBAMRT98                                                        *
.* Desc     : System Parameter Maintenance                                    *
.******************************************************************************
.* Date     :  26/05/89                                                       *
.* Author   :  DIG                                                            *
.* Comment  :  Copied from IBATRA98 and modified for the new Medical          *
.*          :  Records Tracking system for H.R.H.                             *
.* Mods     :                                                                 *
.*        V10.06.01 24/09/2015  Davin            CAR 316612                   *
.*                  Moved MRCNGRUP from hospital screen 2 to web front end    *
.******************************************************************************
.*        v10.03.01 03/05/2012  Mike Laming   CAR 263795                      *
.*                  Move MRCNHMTY, MRCNHLOC, MRCNRCTY, MRCNVOLM & MRCNSTAT to *
.*                  webPAS IT Maintenance (MRT Parameters & MRT Locations)    *
.******************************************************************************
.*        V9.08.02  31/01/2007  Peter Vela    CAR 127930                      *
.*                  Recompled for MRTCONFD                                    *
.*        V9.08.01  24/10/2006  Steve Armstrong  CAR 107236                   *
.*                  Added MRCNLAYT = 12 (Unformatted output)                  *
.******************************************************************************
.*        V9.04.03  15/09/2005  Mike Laming      CAR 68672                    *
.*                  Add Datamax E-Class Barcode Printer (MRCNLAYT = 11)  to   *
.*                  User Screen 1                                             *
.*        V9.04.02  29/04/2005  Peter Vela       CAR 55214                    *
.*                  Recompiled for MRTCONFD                                   *
.*        V9.04.01  30/03/2005  Steve Armstrong    CAR 60350                  *
.*                  Added BHS layout (MRCNLAYT = 10)                          *
.******************************************************************************
.*        V9.03.08  02/06/2004  Jill Habasque  CAR 50379                      *
.*                  Removed "NZ" from description for MRCNWNHL                *
.*        V9.03.07  02/03/2004  Jill Habasque  CAR 47831                      *
.*                  Added MRCNCDOP - Current date/time for OP pulling list    *
.*        V9.03.06  02/03/2004  Jill Habasque  CAR 43132                      *
.*                  Fixed display of MRCNAMTR                                 *
.*        V9.03.05  27/02/2004  Jill Habasque  CAR 43132                      *
.*                  Added MRCNAMTR - Auto move of record at bed transfer      *
.*        V9.03.04  23/01/2004  Ebon Clements  CAR 38490 and 46979            *
.*                  Added MRCNACRR,MRCNACRV & MRCNUSRD - Auto create medical  *
.*                  records and defaults                                      *
.*        V9.03.03  18/12/2003  Peter Vela     CAR 43134                      *
.*                  Added MRCNWNHL - Display Home Location Warning Message NZ *
.*        V9.03.02  13/10/2003  Guomin Fu      CAR 41584                      *
.*                  Added MRCNSOMV - Send hrs of MV to grouper (Y/N)          *
.*        V9.03.01  15/04/2003  Lina Vo        CAR 18262                      *
.*                  Added MRCNTDAD - Use facility address for Treating doctor *
.*                  Address                                                   *
.******************************************************************************
.*        V9.02.07  26/11/2002  Dean Cramer    srf 19735                      *
.*                  Added MRCNRMSCD- microfilmed record status code CAT RS    *
.*        V9.02.06  11/11/2002  Dean Cramer    srf 19735                      *
.*                  Added MRCNUFTY - file format for microfilm address upload *
.*        V9.02.05  13/02/2002  Pat Dirito                                    *
.*                  Added MRCNGRUP and MRCNMECH                               *
.*        V9.02.04  19/02/2002  Steve Armstrong                               *
.*                  Added MRCNDGSI and MRCNDGSO                               *
.*        V9.02.03  06/02/2002  Jill Habasque                                 *
.*                  Added MRCNMOVR,MRCNMOVP and MRCNMOVT                      *
.*        V9.02.02  10/01/2002  Ebon Clements                                 *
.*                  Recompiled for MRTCONFD - new field MRCNPDST              *
.*        V9.02.01  28/09/2001  Mike Laming  2001 RCH                         *
.*                  1) Change 1st Menu to only show 'IBA Controlled Screen' & *
.*                     add a sub-menu for those screens.                      *
.*                  2) Add an 'Interface Engine' Option to the IBA Screens    *
.*                     Menu to allow updating of Datagate Flags on 'controlf' *
.*                  3) Added the standard Yes/No keyin routine KYN0000        *
.*        V5.08.02  19/10/2000  Steve Armstrong                               *
.*                  Added Sato label layout - MRCNLAYT = 9                    *
.*        V5.08.01  21/06/2000  Jill Habasque                                 *
.*                  Added Southern label layout - MRCNLAYT = 8                *
.*        V5.08.B01 16/02/2000  Greg Horvat      SRF 645426 645438            *
.*                  Added MRCNBOAD - Default blank operation & accident dates *
.*        V5.07.01  05/02/1999  Steve Armstrong                               *
.*                  Mods for new ACC label layout (MRCNLAYT = 7)              * .*        V5.07.B01 03/12/1998  Jim Stathopoulos   SRF 629244                 * .*                  Additional 507 Changes                                    *
.******************************************************************************
.*        V5.06.01  26/06/1998  Greg Horvat                                   *
.*                  Added MRCNSDOS - Single disease & operation keyin screen  *
.*                  Added MRCNEPSC - Episode coding in single dis/opr screen  *
.*        V5.05.01  21/04/1998  Steve Armstrong     STH                       *
.*                  Mods to allow 6 hopsital data directories instead of 5    *
.******************************************************************************
.*             V5.00.02  27/11/92  DIG                                        *
.*                       Added MRCNREQB parameter.                            *
.*             V5.00.03  04/03/1993 Darren Jones                              *
.*                       Fix writing of MRCNSLCM.                             *
.*             V5.00.04  05/03/1993 Darren Jones                              *
.*                       Add MRCNAUTO parameter.                              *
.*             V5.00.05  05/03/1993 Darren Jones                              *
.*                       Add MRCNSTFF parameter.                              *
.*             V5.01.06  17/05/1993  Robert Sumsion                           *
.*                       Converted vars and includes to mrt in                *
.*                       standard form.                                       *
.*        V5.01.07  23/06/1993  Graeme Williams            SRF 123186         *
.*                  Allow for stripping of trailing blanks                    *
.*        V5.01.08  06/12/1993    Justin Coates                               *
.*                  added keyin of MRCNNOHS, MRCNHDT1 to MRCNHDT5             *
.*        V5.01.09  12/01/1994    Whirlpool                                   *
.*                  added MRCNUCRG                                            *
.*        V5.01.10  31/01/1994    Justin Coates                               *
.*                  removed keyin of MRCNHDT1 to MRCNHDT5                     *
.*        V5.01.11  21/04/1994  Steve Armstrong                               *
.*                  Added label layout for Taranaki                           *
.*        V5.01.12  26/04/1994  Steve Armstrong                               *
.*                  Added label layout for Hawkes Bay                         *
.*        V5.01.13  08/06/1994  Rob Leonard                                   *
.*                  Recompiled for MRTSTFDS                                   *
.*        V5.02.01  09/12/1994  Graeme Williams                               *
.*                  Added system parameter to determine if a label should be  *
.*                  printed in change mode of IBAMRT11                        *
.*        V5.03.01  22/06/1995  Whirlpool     relaese 5.03                    *
.*                  Added value to MRCNUCRG 2 = Using New Zealand Cancer Reg  *
.*        V5.03.02  01/08/1995  ROD              SRF 640546 & 640471          *
.*                  Make sure default volume is right justified               *
.*        V5.03.03  31/10/1995  Steve Armstrong   SRF 611942                  *
.*                  Added new label layout for CHC                            *
.*        V5.03.04  04/01/1996  Greg Horvat                                   *
.*                  Removed the menu program, security key, IBA screen        *
.*                  password & data directory keyins & changed to use a       *
.*                  standard keyin for the IBA screen security password       *
.*                                                                            *
.******************************************************************************
.
          INC       STD001FD
          INC       IBACONFD/INC
          INC       MRTCONFD/INC
          INC       MRTLOCFD/INC
          INC       MRTMOVFD/INC
          INC       MRTSTFFD/INC
          INC       PATCONFD/INC
          INC       PATCODFD/INC
.
DSTFARRY  DIM       6[36]
DISPARRY  DIM       4[36]
ADESC     DIM       20
AMIN      DIM       2
AHOUR     DIM       2
AFTHOUR1  DIM       4
AMINFORM  FORM      2
AHRFORM   FORM      2
ANDESC    DIM       20
ANSWER    DIM       2
BHOUR     DIM       2
BMIN      DIM       2
BEFHOUR1  DIM       4
BHRFORM   FORM      2
BMINFORM  FORM      2
.
CANCNZ    INIT      "New Zealand"
CANCAUS   INIT      "Australian "
CODE      DIM       2
CODELT    INIT      "LT"
CODETY    INIT      "TY"
CODECP    INIT      "CP"
CODERS    INIT      "RS"
COL       FORM      2
COUNT     FORM      2
COUNTER   FORM      2
.
DANS1     DIM       3
DANS10    DIM       3
DANS15    DIM       3
DANS16    DIM       3
DANS17    DIM       3
DANS18    DIM       3
DANS19    DIM       3
DANS2     DIM       3
DANS20    DIM       3                * I CAR 43134
DANS21    DIM       3
DANS22    DIM       3
DANS23    DIM       3
DANS24    DIM       3
DANS25    DIM       3
DANS3     DIM       3
DANS4     DIM       3
DANS5     DIM       3
DANS6     DIM       3
DANS7     DIM       3
DANS8     DIM       3
DANS9     DIM       3
DANS71    DIM       3                                                  *I-90201
DANSX     DIM       3
DESC      DIM       15
DESCREC   DIM       20
DESCPOST  DIM       20
DESCTLCT  DIM       20
DESCHTYP  DIM       20
DESCHLCT  DIM       30
DESCSTAT  DIM       20
DESCMSTT  DIM       20
DESCTDAD  DIM       30
DHOUR     DIM       2
DHRFORM   FORM      2
DIM3      DIM       3
DIM3A     DIM       3
DIM3B     DIM       3
DIM3C     DIM       3
DIM5      DIM       5
DIM7      DIM       7
DIM11     DIM       11   
DIM20     DIM       20
DIM30     DIM       30
DIM31     DIM       31
DIM55     DIM       55
DISP      DIM       3
DLABLAY   DIM       30
DLABLAY1  INIT      "Standard"
DLABLAY2  INIT      "Wellington Area Health Board"
DLABLAY3  INIT      "H.R.H."
DLABLAY4  INIT      "Tharo Large Bar Code"      * THC
DLABLAY5  INIT      "Tharo Wide Bar Code"       * HWK
DLABLAY6  INIT      "Tharo Narrow Bar Code"     * CHC
DLABLAY7  INIT      "Anne Caudle Centre"        * ACC
DLABLAY8  INIT      "Southern Health"
DLABLAY9  INIT      "Sato CX200"
DLABLY10  INIT      "Zebra"                     * BHS
DLABLY11  INIT      "Datamax E-class"                                  *I-68672
DLABLY12  INIT      "Unformatted output"
DLSIZE    DIM       30
DMIN      DIM       2
DMINFORM  FORM      2
DUMVAR1   DIM       1
DUMVAR2   DIM       1
DUMVAR3   DIM       1
DURHOUR1  DIM       4
.
FIELD     FORM      2
FUTRDATE  DIM       3
HRH       INIT      "H.R.H."
FORM8     FORM      8
HOMEONLY  FORM      "0"
.
IBAOPT    FORM      1                                                  *I-90201
INDEX     FORM      2
.
NOTUSED   INIT      "Not Used   "
.
LINE      DIM       55
LOCATION  DIM       4
LOCATNS   FORM      1
.
MIDESC    DIM       15 
MIDESC1   INIT      "8 Character U/R"
MIDESC2   INIT      "6 Character U/R"
.
PASS      DIM       8
.
REPFLAG   FORM      1
REQNAME   DIM       31
.
SAVVERT   FORM      3
SDESC     DIM       20
SP40      INIT      "                                        "
.
TDOCADD1  INIT      "Facility Address only"
TDOCADD2  INIT      "Treating Doc Addr only"
TDOCADD3  INIT      "Fac Addr if Doc Addr blank"
.
TEMP55    DIM       55
.MRMODESC  DIM       20
.
VERT      FORM      2
.
PRGID     INIT      "IBAMRT98"
PRGNAM    INIT      "Med. Rec. Tracking Parameter Maintenance"
VERSION   INIT      "V12.01.00"
.
.*********************************************************************
.         START OF PROGRAM
.*********************************************************************
.
ML0000    CALL      INIT0000
.
.      START PROCESSING
.
START     MOVE      ZERO,OVRCD
          MOVE      ZERO,REPFLAG
          MOVE      FALSE,EXIT
.
          HLINE     *G37,2,60,80
          DISPLAY   *P1:3,*EF:
                    *P1:4,*V2LON,ZERO,*HOFF," = Exit":
                    *P1:5,*V2LON,ONE,*HOFF," = System Audits":
                    *P1:6,*V2LON,TWO,*HOFF:
                    " = IBA Controlled Screens":                       *C-90201
                    *P1:7,*V2LON,THREE,*HOFF:
                    " = User   Controlled Screen 1":
                    *P1:8,*V2LON,FOUR,*HOFF:
                    " = User   Controlled Screen 2";
.
.-------- user defined fields not currently used -----
.-------- however code still exists for later use -----
.
.                   *P1:8,*V2LON,FOUR,*HOFF:
.                   " = User   Controlled Screen 3 - User Defined Fields";
.
REKEY1    KEYIN     *P1:10,*EL,"Select Option : ",*V2LON,OPTION
.
          COMPARE   ZERO,OPTION
          GOTO      ENDIT IF EQUAL
.
REPEAT    BRANCH    OPTION OF DOAUD1,DOIBA0,DOUSR1,DOUSR2              *C-90201
.
          BEEP
          GOTO      REKEY1
.
.     Do THE Audit Flags Screen
.
DOAUD1    CALL      DISPAUD
          MOVE      ONE,OVRCD
          CALL      UPAUD
          BRANCH    OVRCD OF START
          CALL      WRAUD
          GOTO      START
.
.     Do THE User Controlled Screen 1
.
DOUSR1    CALL      DISPUSR1
          MOVE      ONE,OVRCD
          CALL      UPUSR1
          BRANCH    OVRCD OF START
          CALL      WRUSR1
          GOTO      START
.
.     Do THE User Controlled Screen 2
.
DOUSR2    CALL      DISPUCS2
          CALL      UPUCS2
          BRANCH    OVRCD OF START
          CALL      WRUCS2
          GOTO      START
.
.     Do THE User Controlled Screen 3
.
.------ user defined fields not currently ------
.------ however code still exists for future use -----
.
DOUSR3    CALL      DISP0000                            * display screen format
                                                        *   for User defined
                                                        *   fields
          CALL      READ0000                            * read control file for
                                                        *   User defined's
.
DOUSR20   CALL      SEL0000                             * select field post or 
          BRANCH    EXIT,START                          *   cancel 
          CALL      BRAN0000                            * branch to item to
                                                        *   modify
          COMPARE   ZERO,CCITEM
          GOTO      DOUSR20 IF NOT EQUAL
.
          CALL      UPDT0000                            * update control file
                                                        *   for User defined's
          GOTO      START
.
.     Do THE IBA  Controlled Screens
.
DOIBA0    CALL      IBASECUR                * Keyin IBA screen security passwd
          BRANCH    EXIT,START
.
. ----------------------------------------- Start of additional code    I-90201
DOIBA0M   CALL      SUBM0000           * sub menu for Which IBA screen?
          BRANCH    EXIT,DOIBA1,DOIBA2,DOIBA9
          GOTO      START
. ----------------------------------------- End of additional code      I-90201
.
.     Do THE IBA  Controlled Screen 1
.
DOIBA1    CALL      DISPIBA1                                           *C-90201
          MOVE      ONE,OVRCD
          CALL      UPIBA1
          BRANCH    OVRCD OF DOIBA0M                                   *C-90201
          CALL      WRIBA1
          GOTO      DOIBA0M                                            *I-90201
. --      GOTO      START                                               D-90201
.
. ----------------------------------------- Start of additional code    I-90201
.     Do THE IBA  Controlled Screen 2
.
DOIBA2   
          GOTO      DOIBA0M   
.
.         Interface Engine set up 
.
DOIBA9    CALL      IDGP0000           * display screen & data
          CALL      UDGP0000           * update parameters
          BRANCH    EXIT,DOIBA0M
          CALL      WDGP0000           * write parameters
          GOTO      DOIBA0M
. ----------------------------------------- End of additional code      I-90201
.
.
DISPAUD   READ      CONTROLF,SIXTY;*51,MRCNAUDA,MRCNAUDB,MRCNAUDC,MRCNAUDD:
                                       MRCNAUDE,MRCNAUDF,MRCNAUDG,MRCNAUDH:
                                       MRCNAUDI,MRCNAUDJ,MRCNAUDK,MRCNAUDL:
                                       MRCNAUDM,MRCNAUDN,MRCNAUDO,MRCNAUDP:
                                       MRCNAUDQ,MRCNAUDR,MRCNAUDS,MRCNAUDT:
                                       MRCNAUDU,MRCNAUDV,MRCNAUDW,MRCNAUDX:
                                       MRCNAUDY,MRCNAUDZ
.
          DISPLAY   *P1:3,*EF:
                    *P1:4,*V2LON," 1",*HOFF,". Audit A (Not Used) :":
                    *P1:5,*V2LON," 2",*HOFF,". Audit B (Not Used) :":
                    *P1:6,*V2LON," 3",*HOFF,". Audit C (Not Used) :":
                    *P1:7,*V2LON," 4",*HOFF,". Audit D (Not used) :":
                    *P1:8,*V2LON," 5",*HOFF,". Audit E (Not used) :":
                    *P1:9,*V2LON," 6",*HOFF,". Audit F (Not used) :":
                    *P1:10,*V2LON," 7",*HOFF,". Audit G (Not used) :":
                    *P1:11,*V2LON," 8",*HOFF,". Audit H (Not used) :":
                    *P1:12,*V2LON," 9",*HOFF,". Audit I (Not Used) :":
                    *P1:13,*V2LON,"10",*HOFF,". Audit J (Not used) :":
                    *P1:14,*V2LON,"11",*HOFF,". Audit K (Not used) :":
                    *P1:15,*V2LON,"12",*HOFF,". Audit L (Not used) :":
                    *P1:16,*V2LON,"13",*HOFF,". Audit M (Not Used) :":
                    *P41:4,*V2LON,"14",*HOFF,". Audit N (Not Used) :":
                    *P41:5,*V2LON,"15",*HOFF,". Audit O (Not Used) :":
                    *P41:6,*V2LON,"16",*HOFF,". Audit P (Not Used) :":
                    *P41:7,*V2LON,"17",*HOFF,". Audit Q (Not used) :":
                    *P41:8,*V2LON,"18",*HOFF,". Audit R (Not used) :":
                    *P41:9,*V2LON,"19",*HOFF,". Audit S (Not used) :":
                    *P41:10,*V2LON,"20",*HOFF,". Audit T (Not Used) :":
                    *P41:11,*V2LON,"21",*HOFF,". Audit U (Not used) :":
                    *P41:12,*V2LON,"22",*HOFF,". Audit V (Not used) :":
                    *P41:13,*V2LON,"23",*HOFF,". Audit W (Not used) :":
                    *P41:14,*V2LON,"24",*HOFF,". Audit X (Not used) :":
                    *P41:15,*V2LON,"25",*HOFF,". Audit Y (Not used) :":
                    *P41:16,*V2LON,"26",*HOFF,". Audit Z (Not used) :"
.
          MOVE      ZERO,FORM2
          MOVE      THREE,CVERT
          MOVE      "26",CCOL
.
AUDLOOP1  ADD       ONE,FORM2
          ADD       ONE,CVERT
          COMPARE   "27",FORM2
          RETURN    IF EQUAL
.
          COMPARE   "17",CVERT
          GOTO      AUDPRNT1 IF LESS
.
          MOVE      FOUR,CVERT
          MOVE      "66",CCOL
.
AUDPRNT1  LOAD      FIELD USING FORM2 OF MRCNAUDA,MRCNAUDB,MRCNAUDC,MRCNAUDD,MRCNAUDE:
                    MRCNAUDF,MRCNAUDG,MRCNAUDH,MRCNAUDI,MRCNAUDJ:
                    MRCNAUDK,MRCNAUDL,MRCNAUDM,MRCNAUDN,MRCNAUDO:
                    MRCNAUDP,MRCNAUDQ,MRCNAUDR,MRCNAUDS,MRCNAUDT:
                    MRCNAUDU,MRCNAUDV,MRCNAUDW,MRCNAUDX,MRCNAUDY:
                    MRCNAUDZ
          MOVE      DYES,DANSX
          LOAD      DANSX USING FIELD OF DNO
          DISPLAY   *PCCOL:CVERT,*V2LON,DANSX;
          GOTO      AUDLOOP1
.
UPAUD     MOVE      ZERO,OVRCD
          CALL      MAINQST
          MOVE      CCITEM,FIELD
.
          COMPARE   ZERO,FIELD
          GOTO      POST IF EQUAL
          COMPARE   "-1",FIELD
          GOTO      POST2 IF EQUAL
          GOTO      EKAUD IF LESS
          COMPARE   "27",FIELD
          GOTO      EKAUD IF NOT LESS
.
          MOVE      THREE,CVERT
          MOVE      "26",CCOL
          ADD       FIELD,CVERT
          COMPARE   "17",CVERT
          GOTO      KAUDUP IF LESS
.
          MOVE      "66",CCOL
          SUB       "13",CVERT
.
KAUDUP    KEYIN     *PCCOL:CVERT,*DV,UNDLN3,*PCCOL:CVERT,*V2LON,ANS;
          CMATCH    ANSY,ANS
          GOTO      KAUDYES IF EQUAL
.
          GOTO      KAUDNO
.
EKAUD     BEEP
          GOTO      UPAUD
.
KAUDYES   MOVE      DYES,DANSX
          MOVE      ZERO,FORM1
          GOTO      KCHGAUD
.
KAUDNO    MOVE      DNO,DANSX
          MOVE      ONE,FORM1
.
KCHGAUD   STORE     FORM1 USING FIELD OF MRCNAUDA,MRCNAUDB,MRCNAUDC,MRCNAUDD:
                    MRCNAUDE,MRCNAUDF,MRCNAUDG,MRCNAUDH,MRCNAUDI,MRCNAUDJ:
                    MRCNAUDK,MRCNAUDL,MRCNAUDM,MRCNAUDN,MRCNAUDO,MRCNAUDP:
                    MRCNAUDQ,MRCNAUDR,MRCNAUDS,MRCNAUDT,MRCNAUDU,MRCNAUDV:
                    MRCNAUDW,MRCNAUDX,MRCNAUDY,MRCNAUDZ
          DISPLAY   *PCCOL:CVERT,*V2LON,DANSX
          MOVE      ZERO,OVRCD
          GOTO      UPAUD
+
. ----------------------------------------- Start of additional code    I-90201
.**********************************************************************
.*                           SUBM0000                                 *
.*             sub menu for IBA controlled screens                    *
.**********************************************************************
SUBM0000  HLINE     *G37,2,60,80
          DISPLAY   *P60:2,*V2LON,"- IBA Screens ",*P1:4,*EF:
                    *P1:4,*V2LON,ZERO,*HOFF," = Exit":
                    *P1:5,*V2LON,"1",*HOFF," = IBA screen 1":
                    *P1:6,*V2LON,"2",*HOFF," = IBA screen 2  (not in use)":
                    *P1:7,*V2LON,"3",*HOFF," = Interface Engine Set Up":
                    *P1:9,"Option :"
.
SUBM1000  KEYIN     *P10:9,*EL,*V2LON,IBAOPT
.
          COMPARE   ZERO,IBAOPT
          GOTO      SUBM8000 IF EQUAL
          GOTO      SUBM1000 IF LESS
.
          BRANCH    IBAOPT,SUBM4000,SUBM0000,SUBM7000
          BEEP
          GOTO      SUBM1000
.
SUBM4000  DISPLAY   *P60:2,*V2LON,"- IBA Screen 1 "
          MOVE      ONE,EXIT
          GOTO      SUBM9999
.
SUBM7000  DISPLAY   *P60:2,*V2LON,"- Interface Engine "
          MOVE      THREE,EXIT
          GOTO      SUBM9999
.
SUBM8000  MOVE      ZERO,EXIT
.
SUBM9999  RETURN
. ----------------------------------------- End of additional code      I-90201
+
.*********************************************************************
.         display IBA screen 1
.*********************************************************************
DISPIBA1  READ      CONTROLF,SIXTY;*118,MRCNSLCM,*127,MRCNAUTO,*129,MRCNNOHS:
                                   *133,MRCNEPSC
          READ      CONTROLF,SIXTY1;*219,MRCNUCRG
          READ      CONTROLF,NINTY7;*147,MRCNUFTY
.
          MOVE      DNO,DANS3
          LOAD      DANS3,MRCNAUTO,DYES
.
          MOVE      NOTUSED,DIM11
          LOAD      DIM11,MRCNUCRG,CANCAUS,CANCNZ
.
          MOVE      DNO,DANS9
          LOAD      DANS9,MRCNEPSC,DYES
.
          COMPARE   ZERO,MRCNUFTY
          GOTO      DISPIBAX IF EQUAL
.
          LOAD      MIDESC,MRCNUFTY,MIDESC1,MIDESC2
.
DISPIBAX  DISPLAY   *P60:2,*V2LON,"- I.B.A Screen 1 ",*P1:3,*EF,*HOFF:
                    *P1:4,*V2LON," 1",*HOFF:
                           ". (No longer used)                            :":
                    *P1:5,*V2LON," 2",*HOFF:
                           ". (No longer used)                            :":
                    *P1:6,*V2LON," 3",*HOFF:
                           ". (No longer used)                            :":
                    *P1:7,*V2LON," 4",*HOFF:
                           ". (No longer used)                            :":
                    *P1:8,*V2LON," 5",*HOFF:
                           ". Security Level for Create Medical Record    :":
                    *P1:9,*V2LON," 6",*HOFF:
                           ". Numeric Volume / Auto Generate (Y/N)        :":
                    *P1:10,*V2LON," 7",*HOFF:
                           ". Number of Hospitals for Data Directories    :":
                    *P1:11,*V2LON," 8",*HOFF:
                           ". Type of Cancer Register                     :":
                    *P1:12,*V2LON," 9",*HOFF:
                           ". Episode Coding in IBAMRT06 (Y/N)            :":
                    *P1:13,*V2LON,"10",*HOFF:
                           ". Microfilm Upload File Format (1 or 2)       :":
                    *P51:8,*V2LON,MRCNSLCM,*P51:9,DANS3,*P51:10,MRCNNOHS:
                    *P51:11,DIM11,*P51:12,DANS9,*P51:13,MRCNUFTY,*P54:13,MIDESC
          RETURN
.
.*********************************************************************
.         IBA Screen 1 change
.*********************************************************************
UPIBA1    MOVE      ZERO,OVRCD
          CALL      MAINQST
          MOVE      CCITEM,FIELD
.
          COMPARE   ZERO,FIELD
          GOTO      POST IF EQUAL
          COMPARE   "-1",FIELD
          GOTO      POST2 IF EQUAL
.
          BRANCH    FIELD,KIBA11,KIBA12,KIBA13,KIBA14,KIBA15,KIBA16:
                          KIBA17,KIBA18,KIBA19,KIBA20
.
KEYI1BP   BEEP
          GOTO      UPIBA1
.
KIBA11    MOVE      ZERO,OVRCD
          GOTO      UPIBA1
.
KIBA12    MOVE      ZERO,OVRCD
          GOTO      UPIBA1
.
KIBA13    MOVE      ZERO,OVRCD
          GOTO      UPIBA1
.
KIBA14    MOVE      ZERO,OVRCD
          GOTO      UPIBA1
.         
.------------------------------------------------------------------------------
.         Security level for create medical record
.------------------------------------------------------------------------------
.
KIBA15    KEYIN     *P51:8,*EL,*DV,UNDLN1:
                    *P51:8,*V2LON,MRCNSLCM;
          GOTO      UPIBA1
.
.------------------------------------------------------------------------------
.         Numeric Volumes / Automatic Genration of Next Volume Y/N
.------------------------------------------------------------------------------
KIBA16    KEYIN     *P51:9,*EL,*DV,UNDLN1:
                    *P51:9,*V2LON,ANS;
          REP       UPPLOW,ANS
          MATCH     ANSY,ANS
          GOTO      KIBA16A IF EQUAL
          MATCH     ANSN,ANS
          GOTO      KIBA16B IF EQUAL
          BEEP
          GOTO      KIBA16
KIBA16A   DISPLAY   *P51:9,*V2LON,"Yes"
          MOVE      ONE,MRCNAUTO
          GOTO      UPIBA1
KIBA16B   DISPLAY   *P51:9,*V2LON,"No "
          MOVE      ZERO,MRCNAUTO
          GOTO      UPIBA1
.
.------------------------------------------------------------------------------
.         Number of Hospitals for the multiple data directories
.------------------------------------------------------------------------------
KIBA17    KEYIN     *P51:10,*V2LON,MRCNNOHS:
                    *P51:10,*DV,MRCNNOHS
          COMPARE   ZERO,MRCNNOHS
          GOTO      UPIBA1 IF EQUAL
          GOTO      KIBA17 IF LESS
.
          COMPARE   MRCNNOHS,SIX
          GOTO      UPIBA1 IF NOT LESS      * allowed 1-6 hospitals
          BEEP
          GOTO      KIBA17
.
.------------------------------------------------------------------------------
.         Using Cancer Registration (Y/N)                          
.------------------------------------------------------------------------------
KIBA18    DISPLAY   *P1:24,*EL,*V2LON,ZERO,*HOFF," = ",NOTUSED:
                    ", ",*V2LON,ONE,*HOFF," = ",CANCAUS,", ":
                    *V2LON,TWO,*HOFF," = ",CANCNZ
          KEYIN     *P51:11,*EL,*V2LON,FORM1;
.
          COMPARE   THREE,FORM1
          GOTO      KIBA18A IF LESS
          BEEP
          GOTO      KIBA18
.
KIBA18A   MOVE      FORM1,MRCNUCRG
          MOVE      NOTUSED,DIM11
          LOAD      DIM11,MRCNUCRG,CANCAUS,CANCNZ
          DISPLAY   *P51:11,*V2LON,DIM11
          GOTO      UPIBA1
.
.------------------------------------------------------------------------------
.         Episode Coding in IBAMRT06 (Y/N)
.------------------------------------------------------------------------------
KIBA19    KEYIN     *P51:12,*EL,*DV,UNDLN1:
                    *P51:12,*V2LON,ANS;
.
          REP       UPPLOW,ANS
          MATCH     ANSY,ANS
          GOTO      KIBA19A IF EQUAL
.
          MATCH     ANSN,ANS
          GOTO      KIBA19B IF EQUAL
.
          BEEP
          GOTO      KIBA19
.
KIBA19A   DISPLAY   *P51:12,*V2LON,"Yes";
          MOVE      ONE,MRCNEPSC
          GOTO      UPIBA1
.
KIBA19B   DISPLAY   *P51:12,*V2LON,"No ";
          MOVE      ZERO,MRCNEPSC
          GOTO      UPIBA1
.
.------------------------------------------------------------------------------
.         Microfilm Address Upload File Format 
.------------------------------------------------------------------------------
KIBA20    DISPLAY   *P1:24,*EL,*V2LON,ZERO,*HOFF," = ",NOTUSED:
                    ", ",*V2LON,ONE,*HOFF," = 8 Character U/R, ":
                    *V2LON,TWO,*HOFF," = 6 Character U/R ";
          KEYIN     *P51:13,*EL,*V2LON,FORM1;
.
          COMPARE   THREE,FORM1
          GOTO      KIBA20A IF LESS
          BEEP
          GOTO      KIBA20
.
KIBA20A   MOVE      FORM1,MRCNUFTY
          MOVE      NOTUSED,MIDESC
          LOAD      MIDESC,MRCNUFTY,MIDESC1,MIDESC2
          DISPLAY   *P51:13,*V2LON,MRCNUFTY,"  ",MIDESC
          GOTO      UPIBA1
.
.------------------------------------------------------------------------------
.          USER SCREEN1
.------------------------------------------------------------------------------
DISPUSR1  MOVE      SP30,DESCREC
          MOVE      SP30,DESCHLCT
          MOVE      SP30,DESCHTYP
          MOVE      SP30,DESCSTAT
          MOVE      SP30,DLABLAY
          MOVE      SP30,DESCPOST
.
          PACK      REQNAME,SP30,SP20
          READ      CONTROLF,SIXTY;*77,MRCNLPAG,MRCNLSIZ,MRCNLAYT,MRCNTLOC:
                             MRCNHLOC,MRCNRCTY,MRCNVOLM,MRCNSPAC,*105,MRCNHMTY:
                             MRCNSTAT,HTLNUM,MRCNFUTD,HTNUMDAY,*119,MRCNOIDM:
                             MRCNMRES,MRCNREQB,*128,MRCNSTFF,*131,MRCNCHGL:
                             MRCNSDOS,*134,MRCNBOAD,*147,MRCNSOMV
.
          READ      CONTROLF,NINTY7;*102,MRCNPDST
.
          MOVE      DNO,DANS1
          LOAD      DANS1,MRCNOIDM,DYES
.
          MOVE      DNO,DANS2
          LOAD      DANS2,MRCNMRES,DYES
.
          MOVE      DNO,DANS3
          LOAD      DANS3,MRCNSTFF,DYES
.
          MOVE      DNO,DANS4
          LOAD      DANS4,MRCNCHGL,DYES
.
          PACK      KEY5 WITH CODETY,MRCNRCTY
          CALL      RDCODE1
          MOVE      TDESC,DESCREC
.
          PACK      KEY5,CODELT,MRCNHMTY
          CALL      RDCODE1
          BRANCH    OVRCD,DISPUSR2
          MOVE      TDESC,DESCHTYP
.
DISPUSR2  PACK      KEY5,CODELT,MRCNTLOC
          CALL      RDCODE1
          BRANCH    OVRCD,DISPUSR3
          MOVE      TDESC,DESCTLCT
.
DISPUSR3  MOVE      MRCNHLOC,KEY4
          CALL      RDMRLOC1
          BRANCH    OVRCD,DISPUSR4
          MOVE      MRLODESC,DESCHLCT
.
DISPUSR4  PACK      KEY5,CODERS,MRCNSTAT
          CALL      RDCODE1
          BRANCH    OVRCD,DISPUSR5
          MOVE      TDESC,DESCSTAT
.
DISPUSR5  LOAD      DLABLAY,MRCNLAYT,DLABLAY1,DLABLAY2,DLABLAY3,DLABLAY4:
                                     DLABLAY5,DLABLAY6,DLABLAY7,DLABLAY8:
                                     DLABLAY9,DLABLY10,DLABLY11,DLABLY12
.
.-------- get future date parameters -----
.
          BRANCH    MRCNFUTD,DISPUSR6
          MOVE      DNO,FUTRDATE                  * 0 = No
          GOTO      DISPUSR7
.
DISPUSR6  MOVE      DYES,FUTRDATE                 * 1 = Yes
.
          MOVE      MRCNREQB,KEY6
          CALL      RDMRSTF1
          BRANCH    OVRCD,DISPUSR7
.
          CALL      FORM0000                      * format the staff name
.
DISPUSR7  MOVE      DNO,DANS15
          LOAD      DANS15,MRCNSDOS,DYES
.
          MOVE      DNO,DANS16
          LOAD      DANS16,MRCNBOAD,DYES
.
          PACK      KEY5 WITH CODECP,MRCNPDST,SP70
          CALL      RDCODE1
          BRANCH    OVRCD,DISPUSRX
.
          MOVE      TDESC,DESCPOST
.
          MOVE      DYES,DANS17
          LOAD      DANS17,MRCNSOMV,DNO
.------------------------------------------------------------------------------
.         Display user screen 1
.------------------------------------------------------------------------------
.
DISPUSRX  DISPLAY   *P60:2,*V2LON,"- User Screen 1 ",*P1:3,*EF:
                    *P1:4,*V2LON," 1",*HOFF,". Labels - Layout of ":
                                 "               :":
                    *P1:5,*V2LON," 2",*HOFF,". Type Code for Home ":
                                 " Location      :",*P60:5,"moved to webPAS":
                    *P1:6,*V2LON," 3",*HOFF,". Type Code for Temporary":
                                 " Location  :":
                    *P1:7,*V2LON," 4",*HOFF,". Default Home Location  ":
                                 "           :",*P60:7,"moved to webPAS":
                    *P1:8,*V2LON," 5",*HOFF,". Default Record Type ":
                                 "              :",*P60:8,"moved to webPAS":
                    *P1:9,*V2LON," 6",*HOFF,". Default Volume      ":
                                 "              :",*P60:9,"moved to webPAS":
                    *P1:10,*V2LON," 7",*HOFF,". Default Record Status ":
                                 "            :",*P60:10,"moved to webPAS":
                    *P1:11,*V2LON," 8",*HOFF,". Default No. Of Labels To Print":
                                 "    : ":
                    *P1:12,*V2LON," 9",*HOFF,". Rec. Movement - Future Dates (":
                                 "Y/N): ":
                    *P5:13,"Rec. Movement - How Many Days     : ":
                    *P1:14,*V2LON,"10",*HOFF,". Operator Id. Ma":
                                 "ndatory (Y/N)?     :":
                    *P1:15,*V2LON,"11",*HOFF,". One reason for ":
                                 "ALL volumes MRT14? :":
                    *P1:16,*V2LON,"12",*HOFF,". Default for Requested By Field":
                                 "    : ":
                    *P1:17,*V2LON,"13",*HOFF,". By-pass staff parameters in ? ":
                                 "    : ":
                    *P1:18,*V2LON,"14",*HOFF,". Print label in change opt of ":
                                 "MRT11: ":
                    *P1:19,*V2LON,"15",*HOFF,". Separate Dis & Opr Keyin Scr ":
                                 "(Y/N): ":
                    *P1:20,*V2LON,"16",*HOFF,". Default blank opr & acc dates":
                                 "(Y/N): ":
                    *P1:21,*V2LON,"17",*HOFF,". Default post discharge status":
                                 "     : ":
                    *P1:22,*V2LON,"18",*HOFF,". Send hours of MV to grouper ":
                                  "(Y/N): ":
                    *P41:4,*V2LON,MRCNLAYT,*P49:4,DLABLAY:
...                 *P41:5,MRCNHMTY,*P49:5,DESCHTYP:
                    *P41:6,MRCNTLOC,*P49:6,DESCTLCT:
...                 *P41:7,MRCNHLOC,*P49:7,DESCHLCT:
...                 *P41:8,MRCNRCTY,*P49:8,DESCREC:
...                 *P41:9,MRCNVOLM,*P41:10,MRCNSTAT,*P49:10,DESCSTAT:
                    *P41:11,HTLNUM,*P41:12,FUTRDATE,*P41:13,HTNUMDAY:
                    *P41:14,DANS1,*P41:15,DANS2,*P41:16,MRCNREQB:
                    *P49:16,REQNAME,*P41:17,DANS3,*P41:18,DANS4:
                    *P41:19,DANS15:
                    *P41:20,DANS16:
                    *P41:21,MRCNPDST,*P49:21,DESCPOST:
                    *P41:22,DANS17;
          RETURN
.
.------------------------------------------------------------------------------
.         Select Field
.------------------------------------------------------------------------------
.
UPUSR1    CALL      MAINQST
.
          COMPARE   ZERO,CCITEM
          GOTO      POST IF EQUAL
          COMPARE   "-1",CCITEM
          GOTO      POST2 IF EQUAL
.
          BRANCH    CCITEM,KUSR11,UPUSR1,KUSR13,UPUSR1,UPUSR1,UPUSR1,UPUSR1:
                           KUSR18,KUSR19,KUSR20,KUSR21,KUSR22,KUSR23,KUSR24:
                           KUSR25,KUSR26,KUSR27,KUSR28
....      BRANCH    CCITEM,KUSR11,KUSR12,KUSR13,KUSR14,KUSR15,KUSR16,KUSR17:
....                       KUSR18,KUSR19,KUSR20,KUSR21,KUSR22,KUSR23,KUSR24:
....                       KUSR25,KUSR26,KUSR27,KUSR28
          BEEP
          GOTO      UPUSR1
.
.------------------------------------------------------------------------------
.         Labels - Layout
.------------------------------------------------------------------------------
.
KUSR11    MOVE      ZERO,EXIT
          CALL      GETSCR00
.
KUSR11B   DISPLAY   *P1:4,*EF,*V2LON," 1",*HOFF," = ",DLABLAY1:
                    *P1:5,*V2LON," 2",*HOFF," = ",DLABLAY2:
                    *P1:6,*V2LON," 3",*HOFF," = ",DLABLAY3:
                    *P1:7,*V2LON," 4",*HOFF," = ",DLABLAY4:
                    *P1:8,*V2LON," 5",*HOFF," = ",DLABLAY5:
                    *P1:9,*V2LON," 6",*HOFF," = ",DLABLAY6:
                    *P1:10,*V2LON," 7",*HOFF," = ",DLABLAY7:
                    *P1:11,*V2LON," 8",*HOFF," = ",DLABLAY8:
                    *P1:12,*V2LON," 9",*HOFF," = ",DLABLAY9:
                    *P1:13,*V2LON,"10",*HOFF," = ",DLABLY10:
                    *P1:14,*V2LON,"11",*HOFF," = ",DLABLY11:
                    *P1:15,*V2LON,"12",*HOFF," = ",DLABLY12:
                    *P1:24,"Select Printer : ";
          KEYIN     *P18:24,*EL,*V2LON,MRCNLAYT
          COMPARE   TEN3,MRCNLAYT
          GOTO      KUSR11B IF NOT LESS
          COMPARE   ZERO,MRCNLAYT
          GOTO      KUSR11B IF EQUAL
          LOAD      DLABLAY,MRCNLAYT,DLABLAY1,DLABLAY2,DLABLAY3,DLABLAY4:
                                     DLABLAY5,DLABLAY6,DLABLAY7,DLABLAY8:
                                     DLABLAY9,DLABLY10,DLABLY11,DLABLY12
          CALL      PUTSCR00
.
          DISPLAY   *P1:24,*EF,*P41:4,*V2LON,MRCNLAYT,*P49:4,*V2LON,DLABLAY;
          GOTO      UPUSR1
.
.------------------------------------------------------------------------------
.         Type code for Home Location
.------------------------------------------------------------------------------
.
KUSR12    MOVE      SP3,MRCNHMTY  
          MOVE      SP30,DESCHTYP
          KEYIN     *P41:5,*EL,*V2LON,*RV,MRCNHMTY;
          PACK      MRCNHMTY,MRCNHMTY,SP3
          MATCH     SP3,MRCNHMTY
          GOTO      UPUSR1 IF EQUAL
          CMATCH    QUEST,MRCNHMTY
          GOTO      KUSR12C IF NOT EQUAL
          MOVE      CVERT,SAVVERT
          MOVE      CODELT,CODE
          CALL      PATCODDS                         * Display all codes
          MOVE      SAVVERT,CVERT
          CALL      DISPUSRX                         * Re-display screen
          GOTO      KUSR12
.
KUSR12C   PACK      KEY5,CODELT,MRCNHMTY
          CALL      RDCODE1
          BRANCH    OVRCD,KUSR12N     
          MOVE      TDESC,DESCHTYP
          DISPLAY   *P49:5,*V2LON,DESCHTYP;
          GOTO      UPUSR1
.
KUSR12N   DISPLAY   *P1:24,*EL,*B,"Location not on file - Tap <",*V2LON:
                                "ENTER",*HOFF,">";
          KEYIN     ANS;
          DISPLAY   *P1:24,*EL;
          GOTO      KUSR12
.
.------------------------------------------------------------------------------
.                       Type Code For Temporary Location 
.------------------------------------------------------------------------------
.
KUSR13    MOVE      SP3,MRCNTLOC  
          MOVE      SP30,DESCTLCT
          KEYIN     *P41:6,*EL,*V2LON,*RV,MRCNTLOC;
          PACK      MRCNTLOC,MRCNTLOC,SP3
          MATCH     SP3,MRCNTLOC
          GOTO      UPUSR1 IF EQUAL
          CMATCH    QUEST,MRCNTLOC
          GOTO      KUSR13C IF NOT EQUAL
          MOVE      CVERT,SAVVERT
          MOVE      CODELT,CODE
          CALL      PATCODDS                         * Display all codes
          MOVE      SAVVERT,CVERT
          CALL      DISPUSRX                         * Re-display screen
          GOTO      KUSR13
.
KUSR13C   PACK      KEY5,CODELT,MRCNTLOC
          CALL      RDCODE1
          BRANCH    OVRCD,KUSR13N     
          MOVE      TDESC,DESCTLCT
          DISPLAY   *P49:6,*V2LON,DESCTLCT;
          GOTO      UPUSR1
.
KUSR13N   DISPLAY   *P1:24,*EL,*B,"Location not on file - Tap <",*V2LON:
                                "ENTER",*HOFF,">";
          KEYIN     ANS;
          DISPLAY   *P1:24,*EL;
          GOTO      KUSR13
.
.------------------------------------------------------------------------------
.               Default for home location
.------------------------------------------------------------------------------
.
KUSR14    MOVE      SP4,MRCNHLOC  
          MOVE      SP30,DESCHLCT
          KEYIN     *P41:7,*EL,*V2LON,*RV,MRCNHLOC;
          PACK      MRCNHLOC,MRCNHLOC,SP4
          MATCH     SP4,MRCNHLOC
          GOTO      UPUSR1 IF EQUAL
          CMATCH    QUEST,MRCNHLOC
          GOTO      KUSR14C IF NOT EQUAL
          MOVE      ZERO,LOCATNS
          CALL      MRTLOCDS                         * Display all locations
          CALL      DISPUSRX                         * Re-display screen
          BRANCH    EXIT,KUSR14
          MOVE      LOCATION,MRCNHLOC
          DISPLAY   *P41:7,*V2LON,LOCATION
.
KUSR14C   MOVE      MRCNHLOC,KEY4 
          CALL      RDMRLOC1
          BRANCH    OVRCD,KUSR14N     
          MOVE      MRLODESC,DESCHLCT
          DISPLAY   *P49:7,*V2LON,DESCHLCT;
          GOTO      UPUSR1                          * update home location
.
KUSR14N   DISPLAY   *P1:24,*EL,*B,"Location not on file - Tap <",*V2LON:
                                "ENTER",*HOFF,">";
          KEYIN     ANS;
          DISPLAY   *P1:24,*EL;
          GOTO      KUSR14
.
.------------------------------------------------------------------------------
.         Default record type
.------------------------------------------------------------------------------
.
KUSR15    MOVE      SP3,MRCNRCTY
          MOVE      SP30,DESCREC 
          KEYIN     *P41:8,*V2LON,*RV,*EL,MRCNRCTY;
          PACK      MRCNRCTY,MRCNRCTY,SP3
          MATCH     SP3,MRCNRCTY
          GOTO      UPUSR1 IF EQUAL
          CMATCH    QUEST,MRCNRCTY
          GOTO      KUSR15C IF NOT EQUAL
          MOVE      CVERT,SAVVERT
          MOVE      CODETY,CODE
          CALL      PATCODDS                             * Display all codes
          MOVE      SAVVERT,CVERT
          CALL      DISPUSRX                             * Re-display screen
          GOTO      KUSR15
.
KUSR15C   PACK      KEY5,CODETY,MRCNRCTY
          CALL      RDCODE1
          BRANCH    OVRCD,KUSR15N
          MOVE      TDESC,DESCREC
          DISPLAY   *P49:8,*V2LON,DESCREC;
          GOTO      UPUSR1
.
KUSR15N   DISPLAY   *P1:24,*EL,*B,"Record Type not on file - Tap <",*V2LON:
                                "ENTER",*HOFF,">";
          KEYIN     ANS;
          DISPLAY   *P1:24,*EL;
          GOTO      KUSR15
.
.------------------------------------------------------------------------------
.         Default Volume
.------------------------------------------------------------------------------
.
KUSR16    MOVE      SP2,MRCNVOLM
          KEYIN     *P41:9,*V2LON,*EL,*JR,MRCNVOLM;
.
          MATCH     SP2,MRCNVOLM
          IF        !@EQUAL
            SQUEEZE   MRCNVOLM                * dont allow " 1"  (ie. space 1st)
            MOVE      MRCNVOLM,FORM2
            MOVE      FORM2,MRCNVOLM
          ENDIF
.
          DISPLAY   *P41:9,*V2LON,MRCNVOLM;
          GOTO      UPUSR1
.
.------------------------------------------------------------------------------
.         Default Record Status
.------------------------------------------------------------------------------
.
KUSR17    MOVE      SP3,MRCNSTAT 
          MOVE      SP30,DESCSTAT
          KEYIN     *P41:10,*V2LON,*RV,*EL,MRCNSTAT;
          PACK      MRCNSTAT,MRCNSTAT,SP3
          MATCH     SP3,MRCNSTAT 
          GOTO      UPUSR1 IF EQUAL
          CMATCH    QUEST,MRCNSTAT 
          GOTO      KUSR17C IF NOT EQUAL
          MOVE      CVERT,SAVVERT
          MOVE      CODERS,CODE
          CALL      PATCODDS                             * Display all codes
          MOVE      SAVVERT,CVERT
          CALL      DISPUSRX                             * Re-display screen
          GOTO      KUSR17
.
KUSR17C   PACK      KEY5,CODERS,MRCNSTAT 
          CALL      RDCODE1
          BRANCH    OVRCD,KUSR17N
          MOVE      TDESC,DESCSTAT
          DISPLAY   *P49:10,*V2LON,DESCSTAT;
          GOTO      UPUSR1
.
KUSR17N   DISPLAY   *P1:24,*EL,*B,"Record Status Not On File - Tap <",*V2LON:
                                "ENTER",*HOFF,">";
          KEYIN     ANS;
          DISPLAY   *P1:24,*EL;
          GOTO      KUSR17
.
.------------------------------------------------------------------------------
.         Default No. Of Labels To Print
.------------------------------------------------------------------------------
.
KUSR18    KEYIN     *P41:11,*EL,*V2LON,HTLNUM;
          DISPLAY   *P41:11,*EL,*V2LON,HTLNUM;
          MOVE      ZERO,OVRCD
          GOTO      UPUSR1
.
.
.------------------------------------------------------------------------------
.         Record Movement - Future Dates (Y/N)
.------------------------------------------------------------------------------
.
KUSR19    KEYIN     *P41:12,*EL,*V2LON,ANS;
          DISPLAY   *P41:12,*EL,*V2LON,ANS;
          CMATCH    ANSY,ANS                            * 1 = Yes
          GOTO      KUSR19A IF EQUAL
          CMATCH    ANSN,ANS                            * 2 = No
          GOTO      KUSR19 IF NOT EQUAL
          MOVE      ZERO,MRCNFUTD
          MOVE      DNO,FUTRDATE                      * No futures dates system
          MOVE      ZERO,HTNUMDAY
          DISPLAY   *P41:12,*EL,*V2LON,FUTRDATE,*HOFF;
          GOTO      KUSR19C
.
.-----------------------------------------------------------
.         Record Movement - No. Of Days 
.----------------------------------------------------------- 
.
KUSR19A   MOVE      ONE,MRCNFUTD                      * future dates system
          MOVE      DYES,FUTRDATE
          DISPLAY   *P41:12,*EL,*V2LON,FUTRDATE,*HOFF;
.
KUSR19B   KEYIN     *P41:13,*EL,*V2LON,HTNUMDAY,*HOFF;
KUSR19C   DISPLAY   *P41:13,*EL,*V2LON,HTNUMDAY,*HOFF;
          GOTO      UPUSR1
.
.------------------------------------------------------------------------------
.         Operator Id Mandatory                     
.------------------------------------------------------------------------------
.
KUSR20    KEYIN     *P41:14,*EL,*DV,UNDLN1:
                    *P41:14,*V2LON,ANS;
          REP       UPPLOW,ANS
          MATCH     ANSY,ANS
          GOTO      KUSR20A IF EQUAL
          MATCH     ANSN,ANS
          GOTO      KUSR20B IF EQUAL
          BEEP
          GOTO      KUSR20
KUSR20A   DISPLAY   *P41:14,*V2LON,"Yes"
          MOVE      ONE,MRCNOIDM
          GOTO      UPUSR1
KUSR20B   DISPLAY   *P41:14,*V2LON,"No "
          MOVE      ZERO,MRCNOIDM
          GOTO      UPUSR1
.
.------------------------------------------------------------------------------
.         Input only 1 reason for each volume in Bulk Movements (MRT14)?
.------------------------------------------------------------------------------
.
KUSR21    KEYIN     *P41:15,*EL,*DV,UNDLN1:
                    *P41:15,*V2LON,ANS;
          REP       UPPLOW,ANS
          MATCH     ANSY,ANS
          GOTO      KUSR21A IF EQUAL
          MATCH     ANSN,ANS
          GOTO      KUSR21B IF EQUAL
          BEEP
          GOTO      KUSR21
KUSR21A   DISPLAY   *P41:15,*V2LON,"Yes"
          MOVE      ONE,MRCNMRES
          GOTO      UPUSR1
KUSR21B   DISPLAY   *P41:15,*V2LON,"No "
          MOVE      ZERO,MRCNMRES
          GOTO      UPUSR1
.
.------------------------------------------------------------------------------
.               Default for requested by field
.------------------------------------------------------------------------------
.
KUSR22    MOVE      SP6,MRCNREQB  
          PACK      REQNAME,SP30,SP20
          KEYIN     *P41:16,*EL,*V2LON,*RV,MRCNREQB;
.
          ENDSET    MRCNREQB
          APPEND    SP6,MRCNREQB
          RESET     MRCNREQB
.
          MATCH     SP6,MRCNREQB                 * Test For a Null String
          GOTO      UPUSR1 IF EQUAL
.
          CMATCH    QUEST,MRCNREQB               * Test for a "?"
          GOTO      KUSR22C IF NOT EQUAL
.
          MOVE      SP6,MRCNREQB
          CALL      GETSCR00
          CALL      MRTSTFDS                    * display all staff members
          CALL      PUTSCR00
          BRANCH    EXIT,KUSR22                 * Exit
          MOVE      KEY6,MRCNREQB
.
KUSR22C   DISPLAY   *P41:16,*V2LON,MRCNREQB;     
          MOVE      MRCNREQB,KEY6
          CALL      RDMRSTF1
          BRANCH    OVRCD,KUSR22N               * Validate Staff Member on File
.
.------- check if operator is active -----
.
          COMPARE   "0",MRSTSTAT                  * "0" = Active
          GOTO      KUSR22NA IF NOT EQUAL
.
          CALL      FORM0000                     * format staff members name
          DISPLAY   *P49:16,*V2LON,REQNAME;
          GOTO      UPUSR1
.
.------- Staff code is Non Active -----
.
KUSR22NA  DISPLAY   *P1:24,*EL,*B,*V2LON:
                    "** Invalid entry.  Staff Code is non-active **    ";
          CALL      HITENTER
          GOTO      KUSR22
.
.------- operator code not on file -----
.
KUSR22N   DISPLAY   *P1:24,*EL,*B,*V2LON,"** Staff member not on file **    ";
          CALL      HITENTER
          GOTO      KUSR22
.
.         By-pass serach parameter in "?" option    
.------------------------------------------------------------------------------
.
KUSR23    KEYIN     *P41:17,*EL,*DV,UNDLN1:
                    *P41:17,*V2LON,ANS;
          REP       UPPLOW,ANS
          MATCH     ANSY,ANS
          GOTO      KUSR23A IF EQUAL
          MATCH     ANSN,ANS
          GOTO      KUSR23B IF EQUAL
          BEEP
          GOTO      KUSR23
KUSR23A   DISPLAY   *P41:17,*V2LON,"Yes"
          MOVE      ONE,MRCNSTFF
          GOTO      UPUSR1
KUSR23B   DISPLAY   *P41:17,*V2LON,"No "
          MOVE      ZERO,MRCNSTFF
          GOTO      UPUSR1
.
.         Print label in change mode of IBAMRT11 ?
.------------------------------------------------------------------------------
.
KUSR24    KEYIN     *P41:18,*EL,*DV,UNDLN1:
                    *P41:18,*V2LON,ANS;
          REP       UPPLOW,ANS
          MATCH     ANSY,ANS
          GOTO      KUSR24A IF EQUAL
          MATCH     ANSN,ANS
          GOTO      KUSR24B IF EQUAL
          BEEP
          GOTO      KUSR24
KUSR24A   DISPLAY   *P41:18,*V2LON,"Yes"
          MOVE      ONE,MRCNCHGL
          GOTO      UPUSR1
KUSR24B   DISPLAY   *P41:18,*V2LON,"No "
          MOVE      ZERO,MRCNCHGL
          GOTO      UPUSR1
+
.------------------------------------------------------------------------------
.         Single Disease & Operation Keyin Screens (Y/N)
.------------------------------------------------------------------------------
KUSR25    MOVE      ANSN,ANS
          LOAD      ANS,MRCNSDOS,ANSY
          KEYIN     *P41:19,*EL,*RV,*V2LON,ANS;
.
          REP       UPPLOW,ANS
          MATCH     ANSY,ANS
          GOTO      KUSR25A IF EQUAL
.
          MATCH     ANSN,ANS
          GOTO      KUSR25B IF EQUAL
.
          BEEP
          GOTO      KUSR25
.
KUSR25A   DISPLAY   *P41:19,*V2LON,"Yes";
          MOVE      ONE,MRCNSDOS
          GOTO      UPUSR1
.
KUSR25B   DISPLAY   *P41:19,*V2LON,"No ";
          MOVE      ZERO,MRCNSDOS
          GOTO      UPUSR1
+
.------------------------------------------------------------------------------
.         Default blank opr & acc dates(Y/N)
.------------------------------------------------------------------------------
KUSR26    MOVE      ANSN,ANS
          LOAD      ANS,MRCNBOAD,ANSY
          KEYIN     *P41:20,*EL,*RV,*V2LON,ANS;
.
          REP       UPPLOW,ANS
          MATCH     ANSY,ANS
          GOTO      KUSR26A IF EQUAL
.
          MATCH     ANSN,ANS
          GOTO      KUSR26B IF EQUAL
.
          BEEP
          GOTO      KUSR26
.
KUSR26A   DISPLAY   *P41:20,*V2LON,"Yes";
          MOVE      ONE,MRCNBOAD
          GOTO      UPUSR1
.
KUSR26B   DISPLAY   *P41:20,*V2LON,"No ";
          MOVE      ZERO,MRCNBOAD
          GOTO      UPUSR1
.
.------------------------------------------------------------------------------
.         Default record type
.------------------------------------------------------------------------------
.
KUSR27    MOVE      SP3,MRCNPDST
          MOVE      SP30,DESCPOST
          KEYIN     *P41:21,*V2LON,*RV,*EL,MRCNPDST;
          PACK      MRCNPDST,MRCNPDST,SP3
          MATCH     SP3,MRCNPDST
          GOTO      UPUSR1 IF EQUAL
          CMATCH    QUEST,MRCNPDST
          GOTO      KUSR27C IF NOT EQUAL
          MOVE      CVERT,SAVVERT
          MOVE      CODECP,CODE
          CALL      PATCODDS                             * Display all codes
          MOVE      SAVVERT,CVERT
          CALL      DISPUSRX                             * Re-display screen
          GOTO      KUSR27
.
KUSR27C   PACK      KEY5,CODECP,MRCNPDST
          CALL      RDCODE1
          BRANCH    OVRCD,KUSR27N
          MOVE      TDESC,DESCPOST
          DISPLAY   *P49:21,*V2LON,DESCPOST;
          GOTO      UPUSR1
.
KUSR27N   DISPLAY   *P1:24,*EL,*B,"Record Type not on file - Tap <",*V2LON:
                                "ENTER",*HOFF,">";
          KEYIN     ANS;
          DISPLAY   *P1:24,*EL;
          GOTO      KUSR27
.
.------------------------------------------------------------------------------
.         Send hrs of MV to grouper(Y/N)     
.------------------------------------------------------------------------------
KUSR28    MOVE      ANSY,ANS
          LOAD      ANS,MRCNSOMV,ANSN
          KEYIN     *P41:22,*EL,*RV,*V2LON,ANS;
.
          REP       UPPLOW,ANS
          MATCH     ANSN,ANS
          GOTO      KUSR28A IF EQUAL
.
          MATCH     ANSY,ANS
          GOTO      KUSR28B IF EQUAL
.
          BEEP
          GOTO      KUSR28
.
KUSR28A   DISPLAY   *P41:22,*V2LON,"No";
          MOVE      ONE,MRCNSOMV
          GOTO      UPUSR1
.
KUSR28B   DISPLAY   *P41:22,*V2LON,"Yes";
          MOVE      ZERO,MRCNSOMV
          GOTO      UPUSR1
+
+
.**********************************************************************
.*                           FORM0000                                 *
.*                 Routine to format patients name                    *
.**********************************************************************
FORM0000    CLEAR      REQNAME
            RESET      MRSTTITL
            MATCH      SP4,MRSTTITL             * test title for spaces
            GOTO       FORM3000 IF EQUAL
.
FORM1000    CMATCH     SP1,MRSTTITL
            GOTO       FORM2000 IF EQUAL
            MOVE       MRSTTITL,ANS
            APPEND     ANS,REQNAME            * append title to temp name
            BUMP       MRSTTITL
            GOTO       FORM2000 IF EOS
            GOTO       FORM1000
.
FORM2000    APPEND     DOT,REQNAME
            APPEND     SP1,REQNAME
.
FORM3000    APPEND     MRSTSNAM,REQNAME        * append surname to temp name
            RESET      REQNAME
            MOVE       REQNAME,LINE
            CALL       COMP0000                * compress blanks
            MOVE       LINE,REQNAME
.
            MATCH      SP20,MRSTGNAM            * test given name for spaces
            GOTO       FORM9999 IF EQUAL
.
            ENDSET     REQNAME
            APPEND     ", ",REQNAME
            APPEND     MRSTGNAM,REQNAME        * append given name to temp name
            RESET      REQNAME
.
FORM9999    RETURN
+
.**********************************************************************
.*                              COMP0000                              *
.*       Routine to compress excessive blanks in LINE                 *
.**********************************************************************
COMP0000    MOVE       LINE,DIM55
            PACK       TEMP55,SP20,SP20,SP10,SP5
            MATCH      TEMP55,DIM55                 * test line for spaces
            GOTO       COMP9999 IF EQUAL
            CLEAR      LINE
.
COMP1000    CMATCH     SP1,DIM55
            GOTO       COMP5000 IF NOT EQUAL        * compress leading blanks
            BUMP       DIM55 
            GOTO       COMP1000 IF NOT EOS
            GOTO       COMP8000
.
COMP5000    MOVE       DIM55,TEMP55
            MOVE       TEMP55,DIM55
            ENDSET     DIM55
.
COMP5100    CMATCH     SP1,DIM55
            GOTO       COMP7000 IF NOT EQUAL        * compress trailing blanks
            BUMP       DIM55,-1
            GOTO       COMP5100
.
COMP7000    LENSET     DIM55
            RESET      DIM55
.
COMP7100    MOVE       DIM55,ANS
            APPEND     ANS,LINE
            BUMP       DIM55                        * compress multiple blanks
            GOTO       COMP8000 IF EOS              *   from in-between words
            CMATCH     SP1,DIM55                   
            GOTO       COMP7100 IF NOT EQUAL
            MOVE       DIM55,ANS
            APPEND     ANS,LINE
.     
COMP7200    BUMP       DIM55
            CMATCH     SP1,DIM55
            GOTO       COMP7100 IF NOT EQUAL
            GOTO       COMP7200
.
COMP8000    RESET      LINE
.
COMP9999    RETURN
.
.--------- post ------
.
POST      MOVE      ZERO,OVRCD
          RETURN
.
POST2     GOTO      OVERCOND
.
NOPOST    NORETURN
          MOVE      ONE TO REPFLAG
          GOTO      REPEAT
.
WRAUD     WRITAB    CONTROLF,SIXTY;*51,MRCNAUDA,MRCNAUDB,MRCNAUDC,MRCNAUDD,MRCNAUDE:
                    MRCNAUDF,MRCNAUDG,MRCNAUDH,MRCNAUDI,MRCNAUDJ:
                    MRCNAUDK,MRCNAUDL,MRCNAUDM,MRCNAUDN,MRCNAUDO:
                    MRCNAUDP,MRCNAUDQ,MRCNAUDR,MRCNAUDS,MRCNAUDT:
                    MRCNAUDU,MRCNAUDV,MRCNAUDW,MRCNAUDX,MRCNAUDY:
                    MRCNAUDZ
          DISPLAY   *P60:24,*EL,*V2LON,"*** Posted *** ",*W2;
          RETURN
.
.        IBA SCREEN
.
WRIBA1    WRITAB    CONTROLF,SIXTY;*118,MRCNSLCM,*127,MRCNAUTO,*129,MRCNNOHS:
                                   *133,MRCNEPSC
          WRITAB    CONTROLF,SIXTY1;*219,MRCNUCRG
          WRITAB    CONTROLF,NINTY7;*147,MRCNUFTY
          DISPLAY   *P60:24,*EL,*V2LON,"*** Posted *** ",*W2;
          RETURN
.
WRIBA2    DISPLAY   *P60:24,*EL,*V2LON,"*** Posted *** ",*W2;
          RETURN
.
.        USER SCREEN
.
WRUSR1    WRITAB    CONTROLF,SIXTY;*77,MRCNLPAG,MRCNLSIZ,MRCNLAYT,MRCNTLOC:
                          MRCNHLOC,MRCNRCTY,MRCNVOLM,MRCNSPAC,*105,MRCNHMTY:
                          MRCNSTAT,HTLNUM,MRCNFUTD,HTNUMDAY:
                          *119,MRCNOIDM,MRCNMRES,MRCNREQB,*128,MRCNSTFF:
                          *131,MRCNCHGL,MRCNSDOS,*134,MRCNBOAD,*147,MRCNSOMV
.
          WRITAB    CONTROLF,NINTY7;*102,MRCNPDST;
          DISPLAY   *P60:24,*EL,*V2LON,"*** Posted ***",*W2;
          RETURN
.
.        USER SCREEN 2
.
WRUCS2    WRITAB    CONTROLF,NINTY7;*1,MRCNIN1A,*21,MRCNIN1B,*41,MRCNIN1C:
                                    *61,MRCNIN1D,*81,MRCNIN1E:
                                    MRCNMECH  
          WRITAB    CONTROLF,SIXTY;*135,MRCNMOVR,MRCNMOVP,MRCNMOVT,*148,MRCNWNHL
          WRITAB    CONTROLF,NINTY7;*148,MRCNMSCD,*151,MRCNTDAD,*152,MRCNACRR:
                                    *153,MRCNACRV,*154,MRCNUSRD,*155,MRCNAMTR:
                                    *156,MRCNCDOP
          DISPLAY   *P60:24,*EL,*V2LON,"*** Posted ***",*W2;
          RETURN
.
.
+
.********************************************************************
.*                               DISPUCS2                           *
.*              Display screen for User Controlled Screen 2         *
.********************************************************************
DISPUCS2  READ      CONTROLF,NINTY7;*1,MRCNIN1A,*21,MRCNIN1B,*41,MRCNIN1C:
                                    *61,MRCNIN1D,*81,MRCNIN1E:
                                    MRCNMECH
          READ      CONTROLF,SIXTY;*135,MRCNMOVR,*139,MRCNMOVP,*143,MRCNMOVT:
                                   *148,MRCNWNHL
          READ      CONTROLF,NINTY7;*148,MRCNMSCD,*151,MRCNTDAD,*152,MRCNACRR:
                                    *153,MRCNACRV,*154,MRCNUSRD,*155,MRCNAMTR:
                                    *156,MRCNCDOP
.
          MOVE      DNO,DANS10
          LOAD      DANS10,MRCNMECH,DYES
.
          MOVE      DNO,DANS20                    * I CAR 43134
          LOAD      DANS20,MRCNWNHL,DYES
.
          MOVE      DNO,DANS21
          LOAD      DANS21,MRCNACRR,DYES
.
          MOVE      DNO,DANS22
          LOAD      DANS22,MRCNACRV,DYES
.
          MOVE      DNO,DANS23
          LOAD      DANS23,MRCNUSRD,DYES
.
          MOVE      DNO,DANS24
          LOAD      DANS24,MRCNAMTR,DYES
.
          MOVE      DNO,DANS25
          LOAD      DANS25,MRCNCDOP,DYES
.
          PACK      DESCTDAD,SP30
          LOAD      DESCTDAD,MRCNTDAD,TDOCADD1,TDOCADD2,TDOCADD3          
.
          PACK      DESCMSTT,SP30
          PACK      KEY5 WITH CODERS,MRCNMSCD
          CALL      RDCODE1
          MOVE      TDESC,DESCMSTT
.
          DISPLAY   *P1:3,*EF:
                    *P1:4,*V2LON," 1",*HOFF,". Category RS Indicator":
                                 " 1 Description A =  : ":
                    *P52:4,*V2LON,MRCNIN1A:
                    *P1:5,*V2LON," 2",*HOFF,". Category RS Indicator":
                                 " 1 Description B =  : ":
                    *P52:5,*V2LON,MRCNIN1B:
                    *P1:6,*V2LON," 3",*HOFF,". Category RS Indicator":
                                 " 1 Description C =  : ":
                    *P52:6,*V2LON,MRCNIN1C:
                    *P1:7,*V2LON," 4",*HOFF,". Category RS Indicator":
                                 " 1 Description D =  : ":
                    *P52:7,*V2LON,MRCNIN1D:
                    *P1:8,*V2LON," 5",*HOFF,". Category RS Indicator":
                                 " 1 Description E =  : ":
                    *P52:8,*V2LON,MRCNIN1E:
                    *P1:9,*V2LON," 6",*HOFF,". Movement reason for ":
                                 " Outpatient =        : ":
                    *P52:9,*V2LON,MRCNMOVR:
                    *P1:10,*V2LON," 7",*HOFF,". Movement reason for ":
                                 " Preadmission =      :":
                    *P52:10,*V2LON,MRCNMOVP:
                    *P1:11,*V2LON," 8",*HOFF,". Movement reason for ":
                                 " Transfers =         :":
                    *P52:11,*V2LON,MRCNMOVT:
                    *P1:12,*V2LON," 9",*HOFF:
                    ". (No longer used)                       :":
                    *P52:12,*V2LON,*HOFF:
                    *P1:13,*V2LON,"10",*HOFF:
                    ". Mech Vent Check? Y=Fatal Error N=Warning :":
                    *P52:13,*V2LON,DANS10,*HOFF:
                    *P1:14,*V2LON,"11",*HOFF:
                    ". Microfilmed Record Status                :":
                    *P52:14,MRCNMSCD,*P57:14,DESCMSTT:
                    *P1:15,*V2LON,"12",*HOFF:
                    ". Use Facility addr for Treating Doct addr :":
                    *P52:15,MRCNTDAD,*P54:15,DESCTDAD:
                    *P1:16,*V2LON,"13",*HOFF:
                    ". Display Home Location Warning message :":
                    *P52:16,*V2LON,DANS20,*HOFF:           * I CAR 43134
                    *P1:17,*V2LON,"14",*HOFF:
                    ". Auto create MR on registration Add/Update :":
                    *P52:17,*V2LON,DANS21,*HOFF:
                    *P1:18,*V2LON,"15",*HOFF:
                    ". Auto create MR for all visit creations    :":
                    *P52:18,*V2LON,DANS22,*HOFF:
                    *P1:19,*V2LON,"16",*HOFF:
                    ". Using websecaf defaults in auto MR creation :":
                    *P52:19,*V2LON,DANS23,*HOFF:
                    *P1:20,*V2LON,"17",*HOFF:
                    ". Automatically move record on bed transfer :":
                    *P52:20,*V2LON,DANS24,*HOFF:
                    *P1:21,*V2LON,"18",*HOFF:
                   ". Use current date/time for OP pulling list  :":
                    *P52:21,*V2LON,DANS25,*HOFF;
.
          RETURN
.********************************************************************
.*                            UPUCS2                                *
.*              Select Field for User Controlled Screen 2           *
.********************************************************************
UPUCS2    CALL      MAINQST
.
          COMPARE   ZERO,CCITEM
          GOTO      POST IF EQUAL
          COMPARE   "-1",CCITEM
          GOTO      POST2 IF EQUAL
.
          BRANCH    CCITEM,KUCS01,KUCS02,KUCS03,KUCS04,KUCS05,KUCS06:
                           KUCS07,KUCS08,KUCS09,KUCS10,KUCS11,KUCS12:
                           KUCS13,KUCS14,KUCS15,KUCS16,KUCS17,KUCS18

          BEEP
          GOTO      UPUCS2
.
.********************************************************************
.*              Type Medical Record Status Desc Ind 1A              *
.********************************************************************
KUCS01    KEYIN     *P52:4,*V2LON,*EL,*RV,MRCNIN1A;
          PACK      MRCNIN1A,MRCNIN1A,SP20
.
          GOTO      UPUCS2
.
.********************************************************************
.*              Type Medical Record Status Desc Ind 1B              *
.********************************************************************
KUCS02    KEYIN     *P52:5,*V2LON,*EL,*RV,MRCNIN1B
          PACK      MRCNIN1B,MRCNIN1B,SP20
.         
          GOTO      UPUCS2
.
.********************************************************************
.*              Type Medical Record Status Desc Ind 1C              *
.********************************************************************
KUCS03    KEYIN     *P52:6,*V2LON,*EL,*RV,MRCNIN1C
          PACK      MRCNIN1C,MRCNIN1C,SP20
.         
          GOTO      UPUCS2
.
.********************************************************************
.*              Type Medical Record Status Desc Ind 1D              *
.********************************************************************
KUCS04    KEYIN     *P52:7,*V2LON,*EL,*RV,MRCNIN1D
          PACK      MRCNIN1D,MRCNIN1D,SP20
.         
          GOTO      UPUCS2
.
.********************************************************************
.*              Type Medical Record Status Desc Ind 1E              *
.********************************************************************
KUCS05    KEYIN     *P52:8,*V2LON,*EL,*RV,MRCNIN1E
          PACK      MRCNIN1E,MRCNIN1E,SP20
.         
          GOTO      UPUCS2
.
.
.********************************************************************
.*              Movement Type for outpatients                       *
.********************************************************************
.
KUCS06    KEYIN     *P52:9,*V2LON,*EL,*RV,MRCNMOVR;
          PACK      MRCNMOVR,MRCNMOVR,SP20
          PACK      KEY4,MRCNMOVR
          CALL      RDMRMOV1
          BRANCH    OVRCD,KUCS065
.
          GOTO      UPUCS2
.
KUCS065   DISPLAY   *P1:24,"Invalid movement reason.";
          CALL      HITENTER
          GOTO      KUCS06 
.
.********************************************************************
.*              Movement Type for preadmission                      *
.********************************************************************
KUCS07    KEYIN     *P52:10,*V2LON,*EL,*RV,MRCNMOVP;
          PACK      MRCNMOVP,MRCNMOVP,SP20
          PACK      KEY4,MRCNMOVP
          CALL      RDMRMOV1
          BRANCH    OVRCD,KUCS075
.
          GOTO      UPUCS2
.
KUCS075   DISPLAY   *P1:24,"Invalid movement reason.";
          CALL      HITENTER
          GOTO      KUCS07
.
.********************************************************************
.*              Movement Type for transfers                         *
.********************************************************************
KUCS08    KEYIN     *P52:11,*V2LON,*EL,*RV,MRCNMOVT;
          PACK      MRCNMOVT,MRCNMOVT,SP20
          PACK      KEY4,MRCNMOVT
          CALL      RDMRMOV1
          BRANCH    OVRCD,KUCS085
.
          GOTO      UPUCS2
.
KUCS085   DISPLAY   *P1:24,"Invalid movement reason.";
          CALL      HITENTER
          GOTO      KUCS08
.
.********************************************************************
.   Type of Grouper used?  1 = PC Grouper 0 = Unix Grouper          *
.********************************************************************
KUCS09    GOTO      UPUCS2
.
.********************************************************************
. Mechanical Ventilation Warning/Fatal Error?                       *
. 1 = Fatal Error (Proc code found and no hrs)                      *
. 0 = Warning (Proc code found and no hrs).                         *
.********************************************************************
KUCS10    MOVE      ANSN,ANS
          LOAD      ANS,MRCNMECH,ANSY
          KEYIN     *P52:13,*EL,*RV,*V2LON,ANS;
.
          REP       UPPLOW,ANS
          MATCH     ANSY,ANS
          GOTO      KUCS10A IF EQUAL
.
          MATCH     ANSN,ANS
          GOTO      KUCS10B IF EQUAL
.
          BEEP
          GOTO      KUCS10
.
KUCS10A   DISPLAY   *P52:13,*V2LON,"Yes";
          MOVE      ONE,MRCNMECH
          GOTO      UPUCS2
.
KUCS10B   DISPLAY   *P52:13,*V2LON,"No ";
          MOVE      ZERO,MRCNMECH
          GOTO      UPUCS2
.
.***********************************************************************       
.                       Record Status for Microfilmed Records          *
.***********************************************************************       
KUCS11    MOVE      SP3,MRCNMSCD
          MOVE      SP30,DESCMSTT
          KEYIN     *P52:14,*EL,*V2LON,*RV,MRCNMSCD;
          PACK      MRCNMSCD,MRCNMSCD,SP3
          MATCH     SP3,MRCNMSCD
          GOTO      UPUCS2 IF EQUAL
          CMATCH    QUEST,MRCNMSCD
          GOTO      KUCS11A IF NOT EQUAL
          MOVE      CVERT,SAVVERT
          MOVE      CODERS,CODE
          CALL      PATCODDS                         * Display all codes
          MOVE      SAVVERT,CVERT
          CALL      DISPUCS2                         * Re-display screen
          GOTO      KUCS11
.
KUCS11A   PACK      KEY5,CODERS,MRCNMSCD
          CALL      RDCODE1
          BRANCH    OVRCD,KUCS11B
          MOVE      TDESC,DESCMSTT
          DISPLAY   *P57:14,*V2LON,DESCMSTT;
          GOTO      UPUCS2
.
KUCS11B   DISPLAY   *P1:24,*EL,*B,"Invalid Record Status <",*V2LON:
                                "ENTER",*HOFF,">";
          KEYIN     ANS;
          DISPLAY   *P1:24,*EL;
          GOTO      KUCS11
.
KUCS12    DISPLAY   *P1:22,*EF,*V2LON,"1",*HOFF," = ",TDOCADD1,",":
                        *P1:23,*V2LON,"2",*HOFF," = ",TDOCADD2,",":
                        *P1:24,*V2LON,"3",*HOFF," = ",TDOCADD3;
          KEYIN     *P52:15,*EL,*V2LON,MRCNTDAD
          COMPARE   FOUR,MRCNTDAD
          GOTO      KUCS12 IF NOT LESS
          COMPARE   ZERO,MRCNTDAD
          GOTO      KUCS12 IF EQUAL
          LOAD      DESCTDAD,MRCNTDAD,TDOCADD1,TDOCADD2,TDOCADD3          
.
          DISPLAY   *P1:22,*EF,*P52:15,MRCNTDAD,*P54:15,DESCTDAD;
          GOTO      UPUCS2 
.*****************************************************************************
.*              Display Home Location Warning message for NZ   * I CAR 43134 *
.*****************************************************************************
KUCS13    MOVE      ANSN,ANS
          LOAD      ANS,MRCNWNHL,ANSY
          KEYIN     *P52:16,*EL,*RV,*V2LON,ANS;
.
          REP       UPPLOW,ANS
          MATCH     ANSY,ANS
          GOTO      KUCS13A IF EQUAL
.
          MATCH     ANSN,ANS
          GOTO      KUCS13B IF EQUAL
.
          BEEP
          GOTO      KUCS13
.
KUCS13A   DISPLAY   *P52:16,*V2LON,"Yes";
          MOVE      ONE,MRCNWNHL
          GOTO      UPUCS2
.
KUCS13B   DISPLAY   *P52:16,*V2LON,"No ";
          MOVE      ZERO,MRCNWNHL
          GOTO      UPUCS2
.
.*****************************************************************************
.*              Auto create MR on registration Add/Update                    *
.*****************************************************************************
KUCS14    MOVE      ANSN,ANS
          LOAD      ANS,MRCNACRR,ANSY
          KEYIN     *P52:17,*EL,*RV,*V2LON,ANS;
.
          REP       UPPLOW,ANS
          MATCH     ANSY,ANS
          GOTO      KUCS14A IF EQUAL
.
          MATCH     ANSN,ANS
          GOTO      KUCS14B IF EQUAL
.
          BEEP
          GOTO      KUCS14
.
KUCS14A   DISPLAY   *P52:17,*V2LON,"Yes";
          MOVE      ONE,MRCNACRR
          GOTO      UPUCS2
.
KUCS14B   DISPLAY   *P52:17,*V2LON,"No ";
          MOVE      ZERO,MRCNACRR
          GOTO      UPUCS2
.
.
.*****************************************************************************
.*              Auto Create MR for all visit creations                       *
.*****************************************************************************
KUCS15    MOVE      ANSN,ANS
          LOAD      ANS,MRCNACRV,ANSY
          KEYIN     *P52:18,*EL,*RV,*V2LON,ANS;
.
          REP       UPPLOW,ANS
          MATCH     ANSY,ANS
          GOTO      KUCS15A IF EQUAL
.
          MATCH     ANSN,ANS
          GOTO      KUCS15B IF EQUAL
.
          BEEP
          GOTO      KUCS15
.
KUCS15A   DISPLAY   *P52:18,*V2LON,"Yes";
          MOVE      ONE,MRCNACRV
          GOTO      UPUCS2
.
KUCS15B   DISPLAY   *P52:18,*V2LON,"No ";
          MOVE      ZERO,MRCNACRV
          GOTO      UPUCS2
.
.
.*****************************************************************************
.*              Use user id defaults when auto creating medical records      *
.*****************************************************************************
KUCS16    MOVE      ANSN,ANS
          LOAD      ANS,MRCNUSRD,ANSY
          KEYIN     *P52:19,*EL,*RV,*V2LON,ANS;
.
          REP       UPPLOW,ANS
          MATCH     ANSY,ANS
          GOTO      KUCS16A IF EQUAL
.
          MATCH     ANSN,ANS
          GOTO      KUCS16B IF EQUAL
.
          BEEP
          GOTO      KUCS16
.
KUCS16A   DISPLAY   *P52:19,*V2LON,"Yes";
          MOVE      ONE,MRCNUSRD
          GOTO      UPUCS2
.
KUCS16B   DISPLAY   *P52:19,*V2LON,"No ";
          MOVE      ZERO,MRCNUSRD
          GOTO      UPUCS2
.
.*****************************************************************************
.*              Automatically move record on bed transfer                    *
.*****************************************************************************
KUCS17    MOVE      ANSN,ANS
          LOAD      ANS,MRCNAMTR,ANSY
          KEYIN     *P52:20,*EL,*RV,*V2LON,ANS;
.
          REP       UPPLOW,ANS
          MATCH     ANSY,ANS
          GOTO      KUCS17A IF EQUAL
.
          MATCH     ANSN,ANS
          GOTO      KUCS17B IF EQUAL
.
          BEEP
          GOTO      KUCS17
.
KUCS17A   DISPLAY   *P52:20,*V2LON,"Yes";
          MOVE      ONE,MRCNAMTR
          GOTO      UPUCS2
.
KUCS17B   DISPLAY   *P52:20,*V2LON,"No ";
          MOVE      ZERO,MRCNAMTR
          GOTO      UPUCS2
.
.*****************************************************************************
.*        Use current date/time for movement from OP pulling list            *
.*****************************************************************************
KUCS18    MOVE      ANSN,ANS
          LOAD      ANS,MRCNCDOP,ANSY
          KEYIN     *P52:21,*EL,*RV,*V2LON,ANS;
.
          REP       UPPLOW,ANS
          MATCH     ANSY,ANS
          GOTO      KUCS18A IF EQUAL
.
          MATCH     ANSN,ANS
          GOTO      KUCS18B IF EQUAL
.
          BEEP
          GOTO      KUCS18
.
KUCS18A   DISPLAY   *P52:21,*V2LON,"Yes";
          MOVE      ONE,MRCNCDOP
          GOTO      UPUCS2
.
KUCS18B   DISPLAY   *P52:21,*V2LON,"No ";
          MOVE      ZERO,MRCNCDOP
          GOTO      UPUCS2
.
.********************************************************************
.*                               DISP0000                           *
.*              Display screen for User Defined fields              *
.********************************************************************
DISP0000  MOVE      ONE,COUNTER
          MOVE      FOUR,INDEX
          MOVE      ONE,COUNT
          DISPLAY   *P60:2,"- User Screen 2 ",*P1:3,*EF;
.
DISP1000  DISPLAY   *P1:INDEX,*V2LON,COUNTER,*HOFF,".":
                      "  Using User Defined Field ",COUNT,"      (Y/N): ";
          ADD       ONE,INDEX
          ADD       ONE,COUNTER
          DISPLAY   *P1:INDEX,*V2LON,COUNTER,*HOFF,".":
                      "                 Description            :";
          ADD       ONE,INDEX
          ADD       ONE,COUNTER
          DISPLAY   *P1:INDEX,*V2LON,COUNTER,*HOFF,".":
                      "                 Mandatory         (Y/N):";          
          ADD       ONE,INDEX
          ADD       ONE,COUNTER
          ADD       ONE,COUNT
          COMPARE   "13",COUNTER
          GOTO      DISP1000 IF LESS
.
DISP9999  RETURN
+
.********************************************************************
.*                             BRAN0000                             *
.*                 Branch to item to modify                         *
.********************************************************************
BRAN0000  BRANCH    CCITEM,MOD0000,MOD1000,MOD2000,MOD3000,MOD4000:
                           MOD5000,MOD6000,MOD7000,MOD8000,MOD9000:
                           MOD9500,MOD9700
.
BRAN9999  RETURN
+
.********************************************************************
.*                             READ0000                             *
.*               Read control file for User defined's and           *
.*               display variables                                  *
.********************************************************************
READ0000  READ      CONTROLF,SIXTY1;*1,MRCNUSR1,MRCNDES1,MRCNMAN1,MRCNUSR2,MRCNDES2:
                                       MRCNMAN2,MRCNUSR3,MRCNDES3,MRCNMAN3,MRCNUSR4:
                                       MRCNDES4,MRCNMAN4
          MOVE      FOUR,COUNTER
          MOVE      ONE,COUNT
          MOVE      ONE,INDEX
.  
READ1000  LOAD      FORM1,COUNT,MRCNUSR1,MRCNMAN1,MRCNUSR2,MRCNMAN2,MRCNUSR3,MRCNMAN3:
                              MRCNUSR4,MRCNMAN4
          MOVE      FORM1,ANS
          REPLACE   "0N1Y",ANS
          MATCH     "N",ANS
          GOTO      READ1100 IF EQUAL
          MOVE      "Yes",DISP
          GOTO      READ1200
.
READ1100  MOVE      "No",DISP
.
READ1200  DISPLAY   *P46:COUNTER,*V2LON,DISP;
          ADD       TWO,COUNTER
          ADD       ONE,COUNT
          LOAD      FORM1,COUNT,MRCNUSR1,MRCNMAN1,MRCNUSR2,MRCNMAN2,MRCNUSR3,MRCNMAN3:
                              MRCNUSR4,MRCNMAN4
          MOVE      FORM1,ANS
          REPLACE   "0N1Y",ANS
          MATCH     "N",ANS
          GOTO      READ1300 IF EQUAL
          MOVE      "Yes",DISP
          GOTO      READ1400
.
READ1300  MOVE      "No",DISP
.
READ1400  DISPLAY   *P46:COUNTER,*V2LON,DISP;
          COMPARE   "15",COUNTER
          GOTO      READ2000 IF EQUAL
          ADD       ONE,COUNTER
          ADD       ONE,COUNT
          GOTO      READ1000
.
READ2000  MOVE      ONE,COUNT
          MOVE      FIVE,COUNTER
.
READ2100  LOAD      DESC,COUNT,MRCNDES1,MRCNDES2,MRCNDES3,MRCNDES4
          DISPLAY   *P46:COUNTER,*V2LON,DESC;
          COMPARE   FOUR,COUNT
          GOTO      READ9999 IF EQUAL
          ADD       THREE,COUNTER
          ADD       ONE,COUNT
          GOTO      READ2100
.
READ9999  RETURN
+
.********************************************************************
.*                             SEL0000                              *
.*                Select field to change or Post                    *
.********************************************************************
.
SEL0000   MOVE      ZERO,EXIT
          CALL      MAINQST
          COMPARE   "-1",CCITEM
          GOTO      SEL9000 IF EQUAL
          COMPARE   "0",CCITEM
          GOTO      SEL9999 IF EQUAL
          COMPARE   "13",CCITEM
          GOTO      SEL0000 IF NOT LESS
          GOTO      SEL9999
.
SEL9000   MOVE      TRUE,EXIT
.
SEL9999   RETURN
+
.********************************************************************
.*                             MOD0000                              *
.*               Modify line 1 of user defined screen               *
.********************************************************************
MOD0000   DISPLAY   *P46:4,*EL,UNDLN1;
          KEYIN     *P46:4,*V2LON,ANS;
          TYPE      ANS 
          GOTO      MOD0000 IF EQUAL
          REPLACE   "Y1N0",ANS
          TYPE      ANS
          GOTO      MOD0000 IF NOT EQUAL
          MOVE      ANS,MRCNUSR1
          MOVE      ANS,FORM1
          BRANCH    FORM1,MOD0100
          DISPLAY   *P46:4,*V2LON,"No";
          GOTO      MOD9999
.
MOD0100   DISPLAY   *P46:4,*V2LON,"Yes";
.
MOD9999   RETURN
+
.********************************************************************
.*                             MOD1000                              *
.*               Modify line 2 of user defined screen               *
.********************************************************************
MOD1000   DISPLAY   *P46:5,*EL,UNDLN15;
          KEYIN     *P46:5,*V2LON,MRCNDES1;
          DISPLAY   *P46:5,*V2LON,MRCNDES1;
.
MOD1999   RETURN
+
.********************************************************************
.*                             MOD2000                              *
.*               Modify line 3 of user defined screen               *
.********************************************************************
MOD2000   DISPLAY   *P46:6,*EL,UNDLN1;
          KEYIN     *P46:6,*V2LON,ANS;
          TYPE      ANS
          GOTO      MOD2000 IF EQUAL
          REPLACE   "Y1N0",ANS
          TYPE      ANS
          GOTO      MOD2000 IF NOT EQUAL
          MOVE      ANS,MRCNMAN1
          MOVE      ANS,FORM1
          BRANCH    FORM1,MOD2100
          DISPLAY   *P46:6,*V2LON,"No";
          GOTO      MOD2999
.
MOD2100   DISPLAY   *P46:6,*V2LON,"Yes";
.
.
MOD2999   RETURN
+
.********************************************************************
.*                             MOD3000                              *
.*               Modify line 4 of user defined screen               *
.********************************************************************
MOD3000   DISPLAY   *P46:7,*EL,UNDLN1;
          KEYIN     *P46:7,*V2LON,ANS;
          TYPE      ANS
          GOTO      MOD3000 IF EQUAL
          REPLACE   "Y1N0",ANS
          TYPE      ANS
          GOTO      MOD3000 IF NOT EQUAL
          MOVE      ANS,MRCNUSR2
          MOVE      ANS,FORM1
          BRANCH    FORM1,MOD3100
          DISPLAY   *P46:7,*V2LON,"No";
          GOTO      MOD3999
.
MOD3100   DISPLAY   *P46:7,*V2LON,"Yes";
.
.
MOD3999   RETURN
+
.********************************************************************
.*                             MOD4000                              *
.*               Modify line 5 of user defined screen               *
.********************************************************************
MOD4000   DISPLAY   *P46:8,*EL,UNDLN15;
          KEYIN     *P46:8,*V2LON,MRCNDES2;
          DISPLAY   *P46:8,*V2LON,MRCNDES2;
.
MOD4999   RETURN
+
.********************************************************************
.*                             MOD5000                              *
.*               Modify line 6 of user defined screen               *
.********************************************************************
MOD5000   DISPLAY   *P46:9,*EL,UNDLN1;
          KEYIN     *P46:9,*V2LON,ANS;
          TYPE      ANS
          GOTO      MOD5000 IF EQUAL
          REPLACE   "Y1N0",ANS
          TYPE      ANS
          GOTO      MOD5000 IF NOT EQUAL
          MOVE      ANS,MRCNMAN2
          MOVE      ANS,FORM1
          BRANCH    FORM1,MOD5100
          DISPLAY   *P46:9,*V2LON,"No";
          GOTO      MOD5999
.
MOD5100   DISPLAY   *P46:9,*V2LON,"Yes";
.
.
MOD5999   RETURN
+
.********************************************************************
.*                             MOD6000                              *
.*               Modify line 7 of user defined screen               *
.********************************************************************
MOD6000   DISPLAY   *P46:10,*EL,UNDLN1;
          KEYIN     *P46:10,*V2LON,ANS;
          TYPE      ANS
          GOTO      MOD6000 IF EQUAL
          REPLACE   "Y1N0",ANS
          TYPE      ANS
          GOTO      MOD6000 IF NOT EQUAL
          MOVE      ANS,MRCNUSR3
          MOVE      ANS,FORM1
          BRANCH    FORM1,MOD6100
          DISPLAY   *P46:10,*V2LON,"No";
          GOTO      MOD6999
.
MOD6100   DISPLAY   *P46:10,*V2LON,"Yes";
.
.
MOD6999   RETURN
+
.********************************************************************
.*                             MOD7000                              *
.*               Modify line 8 of user defined screen               *
.********************************************************************
MOD7000   DISPLAY   *P46:11,*EL,UNDLN15;
          KEYIN     *P46:11,*V2LON,MRCNDES3;
          DISPLAY   *P46:11,*V2LON,MRCNDES3;
.
MOD7999   RETURN
+
.********************************************************************
.*                             MOD8000                              *
.*               Modify line 9 of user defined screen               *
.********************************************************************
MOD8000   DISPLAY   *P46:12,*EL,UNDLN1;
          KEYIN     *P46:12,*V2LON,ANS;
          TYPE      ANS
          GOTO      MOD8000 IF EQUAL
          REPLACE   "Y1N0",ANS
          TYPE      ANS
          GOTO      MOD8000 IF NOT EQUAL
          MOVE      ANS,MRCNMAN3
          MOVE      ANS,FORM1
          BRANCH    FORM1,MOD8100
          DISPLAY   *P46:12,*V2LON,"No";
          GOTO      MOD8999
.
MOD8100   DISPLAY   *P46:12,*V2LON,"Yes";
.
MOD8999   RETURN
+
.********************************************************************
.*                             MOD9000                              *
.*               Modify line 10 of user defined screen              *
.********************************************************************
MOD9000   DISPLAY   *P46:13,*EL,UNDLN1;
          KEYIN     *P46:13,*V2LON,ANS;
          TYPE      ANS
          GOTO      MOD9000 IF EQUAL
          REPLACE   "Y1N0",ANS
          TYPE      ANS
          GOTO      MOD9000 IF NOT EQUAL
          MOVE      ANS,MRCNUSR4
          MOVE      ANS,FORM1
          BRANCH    FORM1,MOD9100
          DISPLAY   *P46:13,*V2LON,"No";
          GOTO      MOD999
.
MOD9100   DISPLAY   *P46:13,*V2LON,"Yes";
.
.
MOD999    RETURN
+
.********************************************************************
.*                             MOD9500                              *
.*               Modify line 11 of user defined screen              *
.********************************************************************
MOD9500   DISPLAY   *P46:14,*EL,UNDLN15;
          KEYIN     *P46:14,*V2LON,MRCNDES4
          DISPLAY   *P46:14,*V2LON,MRCNDES4;
.
MOD9599   RETURN
+
.********************************************************************
.*                             MOD9700                              *
.*               Modify line 12 of user defined screen              *
.********************************************************************
MOD9700   DISPLAY   *P46:15,*EL,UNDLN1;
          KEYIN     *P46:15,*V2LON,ANS;
          TYPE      ANS
          GOTO      MOD9700 IF EQUAL
          REPLACE   "Y1N0",ANS
          TYPE      ANS
          GOTO      MOD9700 IF NOT EQUAL
          MOVE      ANS,MRCNMAN4
          MOVE      ANS,FORM1
          BRANCH    FORM1,MOD9750
          DISPLAY   *P46:15,*V2LON,"No";
          GOTO      MOD9799
.
MOD9750   DISPLAY   *P46:15,*V2LON,"Yes";
.
.
MOD9799   RETURN
+
.********************************************************************
.*                             UPDT0000                             *
.*              Update control file for attendees                   *
.********************************************************************
UPDT0000  WRITAB    CONTROLF,SIXTY1;*1,MRCNUSR1,MRCNDES1,MRCNMAN1,MRCNUSR2:
                                       MRCNDES2,MRCNMAN2,MRCNUSR3,MRCNDES3:
                                       MRCNMAN3,MRCNUSR4,MRCNDES4,MRCNMAN4
          DISPLAY   *P60:24,*EL,*V2LON,"*** Posted ***",*W2;
UPDT9999  RETURN
+
          INCLUDE   STD001IO
          INC       IBASECUR                * Keyin IBA screen security passwd
          INC       MRTLOCDS
          INC       MRTSTFDS
          INC       PATCODKY
          INC       PATCODIO/INC
          INC       MRTLOCIO/INC
          INC       MRTMOVIO/INC
          INC       MRTSTFIO/INC
.
ENDIT     CHAIN     PGM
          STOP
+
.*********************************************************************
.         initilisation
.*********************************************************************
INIT0000  CALL      DISPHEAD
          DISPLAY   *P56:24,"Opening controlf";
          OPEN      CONTROLF,"controlf"
.
          DISPLAY   *P64:24,"patcodes";
          OPEN      PATCODE1,"patcodes"
.
          DISPLAY   *P64:24,"mrtlocaf";
          OPEN      MRTLOCA1,"mrtlocaf"
.
          DISPLAY   *P64:24,"mrtlocaf";
          OPEN      MRTLOCA2,"mrtlocaf"
.
          DISPLAY   *P64:24,"mrtmovaf";
          OPEN      MRTMOVA1,"mrtmovaf"
.
          DISPLAY   *P64:24,"mrtstfaf";
          OPEN      MRTSTFA1,"mrtstfaf"
          OPEN      MRTSTFA3,"mrtstfaf"
.
INIT9999  RETURN
+
. ----------------------------------------- Start of additional code    I-90201
.**********************************************************************
.*                            IDGP0000                                *
.*                     Display Interface Engine screen                *
.**********************************************************************
.
IDGP0000  READ      CONTROLF,NINTY7;*101,MRCNDGRM,*105,MRCNDGSI,*125,MRCNDGSO
.
          MOVE      DNO,DANS71
          LOAD      DANS71,MRCNDGRM,DYES,DNO
.
          DISPLAY   *P60:2,*V2LON,"- Interface Engine ",*P1:3,*EF:
                    *P1:04,*V2LON," 1",*HOFF,". ":
                    "Send message CRM after a Medical Rec.Movement ?":
                    *P1:05,*V2LON," 2",*HOFF,". ":
                    "MRT Interface Solicited Service Name (inbound)":
                    *P1:06,*V2LON," 3",*HOFF,". ":
                    "MRT Interface Solicited Service Name (outbound)":
                    *P57:04,": ",*V2LON,DANS71,*HOFF:
                    *P57:05,": ",*V2LON,MRCNDGSI,*HOFF:
                    *P57:06,": ",*V2LON,MRCNDGSO,*HOFF
.
IDGP9999  RETURN
+
.***********************************************************************
.*  UDGP0000  :  Update Interface Engine Fields
.******************************************************5****************
UDGP0000  MOVE      FALSE,EXIT
          CALL      MAINQST
.
          COMPARE   ZERO,CCITEM
          GOTO      UDGP9999 IF EQUAL
          GOTO      UDGP9000 IF LESS
.
          MOVE      "59",CCOL
          BRANCH    CCITEM,UDGP0100:
                           UDGP0200:
                           UDGP0300
.
          BEEP
          GOTO      UDGP0000
.
. Write subsidary system after Medical Records Movement?
.
UDGP0100  MOVE      "4",CVERT
          MOVE      MRCNDGRM,ANS
          CALL      KYN0000
          MOVE      EXIT,MRCNDGRM
          GOTO      UDGP0000
.
.         Inbound MRT Solicited Service Name
.
UDGP0200  KEYIN     *P59:5,*V2LON,*RV,MRCNDGSI:
                    *P59:5,*DV,MRCNDGSI
          GOTO      UDGP0000
.
.         Outbound MRT Solicited Service Name
.
UDGP0300  KEYIN     *P59:6,*V2LON,*RV,MRCNDGSO:
                    *P59:6,*DV,MRCNDGSO
          GOTO      UDGP0000
.
UDGP9000  MOVE      TRUE,EXIT
.
UDGP9999  RETURN
+
.**********************************************************************
.*                            WDGP0000                                *
.*                      Write Interface Engine set uP                 *
.**********************************************************************
.
WDGP0000  WRITAB    CONTROLF,NINTY7;*101,MRCNDGRM,*105,MRCNDGSI,*125,MRCNDGSO
.
.
          DISPLAY   *P60:24,*EL,*V2LON,"*** Posted ***",*W2;
          RETURN
+
.*********************************************************************
.                   KYN0000
.         Yes/No standard keyin
.*********************************************************************
KYN0000  KEYIN      *PCCOL:CVERT,*DV,SP3:    * clear previous display
                    *PCCOL:CVERT,*DV,UNDLN1:
                    *PCCOL:CVERT,*V2LON,ANS:
                    *PCCOL:CVERT,*DV,ANS;
.
          TYPE      ANS                      * check if a number was input
          GOTO      KYN9000 IF EQUAL         * yes, invalid
.
          REP       "Y1y1N0n0",ANS           * convert valid answers to numerics
.
          TYPE      ANS                      * check if now a number
          GOTO      KYN9000 IF NOT EQUAL     * no, invalid
.
          MOVE      ANS,EXIT                 * set exit to Y/N value
.
          MOVE      DNO,DANS1                * assume answer was "No "
          LOAD      DANS1,EXIT,DYES,DNO      * unless otherwise stated
.
          DISPLAY   *PCCOL:CVERT,*V2LON,DANS1
          GOTO      KYN9999
.
KYN9000   BEEP
          GOTO      KYN0000
.
KYN9999   RETURN
. ----------------------------------------- End of additional code      I-90201
+
