.******************************************************************************
.*                                                                            *
.*                        P R O G R A M   S U M M A R Y                       *
.*                        -------------   -------------                       *
.*                                                                            *
.*      PROGRAM NAME:    NZPBIL60                                             *
.*                                                                            *
.*      FUNCTION:        INVOICE PENDING REPORT for NZ Private Billing        *
.*                                                                            *
.*      DATE WRITTEN:    09/02/2007                                           *
.*                                                                            *
.*      MODIFICATIONS:                                                        *
.*                                                                            *
.*----------------------------------------------------------------------------*
.* V11.05.01 14/02/2025 J.Tan           TSK 0946490                           *
.*           Recompiled for PATCATBI - Changes for MV CWO Payment Model       *
.* V11.04.05 08/07/2024  J.Tan          TSK 0948131                           *
.*           Fixed I*C on index3 oprdetaf                                     *
.* V11.04.04 15/03/2024  J.Tan          TSK 0910994                           *
.*           Recompiled for CMXMATRX                                          *
.* V11.04.03 29/01/2024  Jacob Jackson  TSK 0919335                           *
.*           Add HF History includes                                          *
.* V11.04.02 29/01/2024  Jacob Jackson  TSK 0919335                           *
.*           Add new local variable and recompile for GETTFEES                *
.* V11.04.01 30/11/2023  J.Tan           TSK 0940649                          *
.*           Mod to set FNAMEQ for NZPCATBI                                   *
.* V11.02.01 16/03/2022  J.Tan           TSK 0902652                          *
.*           Recompiled for AAECATBI/OUTCATBI - New Patient Invoice           *
.* V11.01.03 31/08/2021  J.Tan           TSK 0905305                          *
.*           Recompiled for AAECATBI - AE Care class (ABFAECCL)               *
.* V11.01.02 28/04/2021  Thanh T         TSK 0895165                          *
.*           Recompiled for OPRARDFD changes                                  *
.*           07/04/2021  Tracey Nguyen   TSK 0901515                          *
.*           Recompiled for PMSCMTFD - Added new fields                       *
.*           a) 1 File type for ICD procedure (PMCCIPF)                       *
.*           b) 3 new CMBS Field Type (PMCCFTS4/PMCCFT5C/PMCCFT6C)            *
.*           c) 3 new CMBS Codes From (PMCCPC4F,PMCCSC5F,PMCCTC6F)            *
.*           d) 3 new CMBS Codes To   (PMCCPC4T/PMCCSC5T,PMCCTC6T)            *
.*           24/04/2021  J.Tan           TSK 0863287                          *
.*           Recompiled for PATCATBI - Patient Inv. new functionality         *
.* V11.01.01 10/03/2021  Tracey Nguyen   TSK 0901515                          *
.*           Recompiled for PMSCMTFD - Added Primary ICD Procedure 1-5        *
.*           (PMCCICP1-5)                                                     *
.*----------------------------------------------------------------------------*
.*        V11.00.03 25/08/2020  J.Tan          TSK 0895840                    *
.*                  Recompiled for NZPCATBI - Fixed Keyin amount Inc.to Contr.*
.*        V11.00.02 25/08/2020  J.Tan          TSK 0896164                    *
.*                  Recompiled for NZPCATBI - multiple Contract proc.issue    *
.*        V11.00.01 20/03/2020  J.Tan          TSK 0838262                    *
.*                  Added Effective from and to date to MBS Item file         *
.*        V10.15.01 11/10/2019  Peter Vela       TSK 0882906                  *
.*                  Recompiled for OUTCATBI - Fixed I*C for OUTBB1 ABF        *
.*        V10.14.01 22/03/2019  J.Tan            TSK 0857392                  *
.*                  Changed RCP Transaction count from DIM3 to DIM5           *
.*        V10.13.03 11/01/2019  Peter Vela     TSK 0867807                    *
.*                  Recompiled for OUTCATBI                                   *
.*        V10.13.02 26/10/2018  Thanh T        TSK 0859743                    *
.*                  Added BULKBILL field and removed OUTHEDFD/OUTHEDIO,       *
.*                  OUTSESFD/OUTSESIO for OUTCATBI changes                    *
.*        V10.13.01 25/10/2018  Thanh T        TSK 0859743                    *
.*                  Added OUTHEDFD/OUTHEDIO, OUTSESFD/OUTSESIO for OUTCATBI   *
.*                  changes                                                   *
.*----------------------------------------------------------------------------*
.*        V10.11.01 07/09/2017  J.Tan         TSK 0837479                     *
.*                  Recompiled for CMXMATRX - OPCNCONS(Consumption type items)*
.*        V10.10.01 26/04/2017  J.Tan         TSK 0829726                     *
.*                  Fixed TOTDAYS for admission with multiple funders         *
.*        V10.08.01 26/08/2016  Don Nguyen    TSK 0312570                     *
.*                  Recompiled for CMXMATRX - Added check for PTCNDGED=1      *
.*                  Added PMSEDGFD/IO and GETEFDRG                            *
.*        V10.07.02 15/02/2016 J.Tan  CAR 0812936                             *
.*                  Recompiled for NZPCATBI - initialised TOTDAYS             *
.*        V10.07.01 18/11/2015  J.Tan         CAR 303942                      *
.*                  Added new payment types                                   *
.*        V10.06.01 14/07/2015  Peter Vela     CAR 318700                     *
.*                  Recompiled for PRBILCMN - Validate for deleted VISMDT     *
.*                  record                                                    *
.*        V10.04.03 16/06/2014 Sandra Barcham CAR 301639                      *
.*                  Moved call to TFILENAM for TEMPFILE to start of program   *
.*                  and added call to KILL0000 on exit of program.
.*        V10.04.02 11/06/2014 Sandra Barcham CAR 301639                      *
.*                  Moved call to TFILENAM to INIT0000                        *
.*        V10.04.01 08/04/2013 J.Tan          CAR 261630                      *
.*                  Removed port number from temp file name                   *
.*        V10.03.02 05/03/2013  Patrick Adair CAR 281898                      *
.*                  Recompiled for PATCATBI                                   *
.*        V10.03.01 21/09/2012  J.Tan          CAR 271474                     *
.*                  Recompiled for CMXMATRX - using index 5 of pmscmtaf       *
.*                  04/12/2012  J.Tan          CAR 262673                     *
.*                  Recompiled for PATCATBI - Casepayment perdiem rate        *
.*        V10.01.02 24/02/2011  Peter Vela    CAR 233034                      *
.*                  Removed PATBF2FD and PATBF2IO                             *
.*        V10.01.01 21/12/2010  Mike Laming   CAR 233046                      *
.*                  Recompiled for PABXBILL - Mods to Misc.Charges PATMCHFD   *
.*        V10.00.02 24/06/2010  J.Tan         CAR 221284                      *
.*                  Added options of a Claim Type,Contract and Admission Type *
.*        V10.00.01 07/06/2010  Mike Laming   CAR 212864                      *
.*                  Recompiled for PATCATBI - mods at GCDE6500                *
.*        V9.12.06  16/02/2010  Peter Vela    CAR 215485                      *
.*                  Recompiled for PATCATBI - Ignore Leave if less than 1 day *
.*        V9.12.05  05/02/2010  Peter Vela    CAR 215485                      *
.*                  Recompiled for PATCATBI - Ignore Leave if less than 1 day *
.*        V9.12.04  24/11/2009  Davin         CAR 210721                      *
.*                  Recompiled for CHKCMXPT - I*C on patcmxaf file            *
.*        V9.12.03  09/10/2009  J.Tan         CAR 203934                      *
.*                  Recompiled for PATCATBI - display ICD10 Sugg.Class on Inv.*
.*        V9.12.02  21/09/2009  J.Tan         CAR 204390                      *
.*                  Recompiled for STEPDOWN - mods to old bed fees file       *
.*        V9.12.01  03/07/2009  Peter Vela    CAR 199927                      *
.*                  Recompiled for EMROPOCK - Check if PMMIAMTT = 0 GPRC4000  *
.*        V9.11.02  16/03/2009  J.Tan         CAR 188205                      *
.*                  Recompiled for PATCATBI - Mods to Non-banked Deposits     *
.*        V9.11.01  20/11/2008  Steve Armstrong   CAR 181373                  *
.*                  Recompiled for changes to PATCATBI.                       *
.******************************************************************************
.*        V9.10.02  13/05/2008 J.Tan      CAR 162313                          *
.*                  Added Deposit status to comdepaf                          *
.******************************************************************************
.*        V9.09.08  20/02/2008 Peter Vela     CAR 161535                      *
.*                  Recompiled for PATCATBI                                   *
.*        V9.08.10  23/01/2008  J.Tan         CAR 159848                      *
.*                  Recompiled for NZPCATBI - updating nzpspraf               *
.*        V9.09.07  12/11/2007 J.Tan          CAR 151803                      *
.*                  Recompiled for AAECATBI - Cabrini ED Billing              *
.*        V9.08.09  11/09/2007  J.Tan         CAR 147032                      *
.*                  Recompiled for NZPCATBI - Funder contribution % stepdown  *
.*        V9.08.08  24/08/2007  Peter Vela CAR 146143                         *
.*                  Recompiled for PATCATBI                                   *
.*        V9.08.07  20/08/2007 J.Tan          CAR 144656                      *
.*                  Recompiled for PATCATBI - for Multiple Procedures Billing *
.*                  04/09/2007  J.Tan         CAR 148353                      *
.*                  Recompiled for PATCMSTP                                   *
.*        V9.08.06  10/08/2007 Peter Vela     CAR 146143                      *
.*                  Recompiled for PATCATBI                                   *
.*        V9.08.05  17/07/2007  J.Tan     CAR 140282                          *
.*                  Recompiled for NZPCATBI - Revenue breakdown               *
.*         V9.08.04 03/07/2007  Peter Vela    CAR 142173                      *
.*                  Recompiled for AAECATBI                                   *
.*        V9.08.03  19/06/2007  Mike Laming   CAR 119158                      *
.*                  Recompiled for PATCATBI - read Misc.Chrages by Effec.Date *
.*         V9.08.02 15/06/2007 J.Tan          CAR 142173                      *
.*                  Mods for Emergency events                                 *
.*         V9.08.01 19/02/2007 Peter Vela     CAR sjog-vic                    *
.*                  Recompiled for PATCATBI - St. John of God invoice layout  *
.******************************************************************************
.
          INC       STD001FD
          INC       PATCOMM/INC
          INC       PABXVARS/INC
          INC       IBASEQFD/INC                 * Sequential Numbers File
          INC       TFILEVAR/INC                 * Generate Temp File Name
          INC       WEBERRFD/INC                 * Web Server Error Logging
.
          INC       AAEDE1FD/INC
          INC       AAEDEBFD/INC
          INC       AAEDTRFD/INC
          INC       IBASECFD/INC
          INC       IBAPASFD/INC
          INC       IBAGEDFD/INC
          INC       IBAGSTFD/INC
          INC       IBACONFD/INC
          INC       IBATMDFD/INC
          INC       IBATMHFD/INC
          INC       NHIMASFD/INC
.
          INC       MLTCFNFD/INC
          INC       NZPBFEFD/INC
          INC       NZPEXTFD/INC
          INC       NZPCFNFD/INC
          INC       NZPCMTFD/INC
          INC       NZPFIGFD/INC
          INC       NZPFINFD/INC
          INC       NZPIBRFD/INC
          INC       NZPMCHFD/INC
          INC       NZPMXCFD/INC
          INC       NZPPFEFD/INC
          INC       NZPRBRFD/INC
          INC       NZPRFNFD/INC
          INC       NZPPICFD/INC
          INC       NZPSPRFD/INC
          INC       NZPTFEFD/INC
          INC       NZPIVBFD/INC
          INC       NZPRVBFD/INC
          INC       NZPRDTFD/INC
          INC       OPRARDFD/INC
          INC       OPRDEAFD/INC
          INC       OPRSESFD/INC
          INC       VISPAYFD/INC
.
          INC       OUTBOAFD/INC
          INC       OUTBB1FD/INC
          INC       OUTDTRFD/INC
          INC       OUTSITFD/INC
          INC       PATELGFD/INC
          INC       PATBFEFD/INC
          INC       PATCALAG/INC
          INC       PATCODFD/INC
          INC       PATCONFD/INC
          INC       PATCTFFD/INC
          INC       PATCFAFD/INC
          INC       PMSCIDFD/INC
          INC       PMSCCDFD/INC
          INC       PATDHEAD/INC
          INC       PATDINVS/INC
          INC       PATDGWFD/INC
          INC       PATDO1FD/INC
          INC       PATDRGFD/INC
          INC       PATDSCFD/INC
          INC       PATDTRFD/INC
          INC       PATECDFD/INC
          INC       PATECOFD/INC
          INC       PATFINFD/INC
          INC       PATFMOFD/INC
          INC       PATFX1FD/INC
          INC       PATFN1FD/INC
          INC       PATFN2FD/INC
          INC       PATGTUFD/INC
          INC       PATHSPFD/INC
          INC       PATHTRFD/INC
          INC       EMRHTRFD/INC
          INC       OUTHTRFD/INC
          INC       PATIBLFD/INC
          INC       PATICUFD/INC
          INC       PATIN1FD/INC
          INC       PATINMFD/INC
          INC       PATINVFD/INC
          INC       PATIOVFD/INC
          INC       PATIPEFD/INC
          INC       PATITMFD/INC
          INC       PATMA1FD/INC
          INC       PATMCHFD/INC
          INC       PATMI1FD/INC
          INC       PATOVBFD/INC
          INC       PATPGRFD/INC
          INC       PATRE1FD/INC
          INC       PATRBLFD/INC
          INC       PATRATFD/INC
          INC       PATRCAUD/INC
          INC       PATRFNFD/INC
          INC       PATSELDT/INC
          INC       PATSRBFD/INC
          INC       PATTFEFD/INC
          INC       PATTRNFD/INC
          INC       PATVENFD/INC
          INC       PATVISFD/INC
          INC       PATWC1FD/INC
          INC       PATWMAFD/INC
          INC       PATWR1FD/INC
          INC       PATWVEFD/INC
          INC       PMSSINFD/INC
          INC       PATCMTFD/INC
          INC       PMSCMTFD/INC
          INC       PMSCNOFD/INC
          INC       PMSEVTFD/INC
          INC       PMSHATFD/INC
          INC       PMSHCPFD/INC
          INC       PMSIDEFD/INC
          INC       PMSSGAFD/INC
          INC       PMSMTIFD/INC
          INC       PMSMPRFD/INC
          INC       PMSPBRFD/INC
          INC       PMSVX1FD/INC
.
          INC       PATCMXFD/INC
          INC       PATAFEFD/INC
          INC       PATASDFD/INC
          INC       PATHDFFD/INC
          INC       PATHLFFD/INC
          INC       PATLDFFD/INC
          INC       PATLSDFD/INC
          INC       PRIITMFD/INC
.
          INC       EMRHISFD/INC
          INC       EMRSITFD/INC
          INC       EMRVISFD/INC
          INC       COMDEPFD/INC
          INC       RCPBNKFD/INC
          INC       RCPBDTFD/INC
          INC       RCPDTEFD/INC
          INC       RCPCONFD/INC
          INC       PMSEDGFD/INC       * Effective DRG Dates
          INC       PATDDHFD/INC
.
.         Temporary File Definition
.         -------------------------
.
.         Filename : BIL60Axx.dat          (xx = port id)
.
PENTEMP1  IFILE SQL, FIXED=49, KEY="U1-20,21-40,41-48"
.
.NAME     TYPE    LENGTH     PHYSICAL     START     DESCRIPTION
.----     ----    ------     --------     -----     -----------
TEMPSUR   DIM       20          20          1       Patient Surname
TEMPGIV   DIM       20          20          21      Patient Given Name 
TEMPADM   DIM       8           8           41      Admission Number
.
.End of Record                              49
.
.
.               WORK AREA
.
ERASEIT   INIT      "iserase "
ISBIT     INIT      "isbuild "
PIPE      INIT      "|"
UKEYIT    INIT      " 49 U1-20,21-40,41-48"
.
ADAY      DIM       2
AMON      DIM       2
AYER      DIM       2
ACEN      DIM       2
ACCDTE    DIM       8     * accommodation date used in AAECATBI
AECNFTYP  FORM      1
AECNCHRS  FORM      1
ADMNTYPE  DIM       3
ADMNDESC  DIM       20
.
CLAIMTYP  DIM       3
CLAIMDES  DIM       20
CDYSDAYS  FORM      6                       * CALCDAYS number of days
CDYSFDTE  DIM       8                       * CALCDAYS from date
CDYSTDTE  DIM       8                       * CALCDAYS to date
CDYSYEAR  FORM      2                       * CALCDAYS year
CURRDATE  DIM       8
BULKBILL  DIM       1
CODE      DIM       2
CMDLINE   DIM       80
CMDLIN1   DIM       70
CMDLIN2   DIM       16
CURSESS   DIM       18
CUTDAY    DIM       2
CUTMON    DIM       2
CUTYER    DIM       2
CUTCEN    DIM       2
CALDAYS   FORM      3
CATCR     INIT      "cr"
CERTINDC  FORM      1
CODECL    INIT      "CL"
CODEDP    INIT      "DP"
CODEPY    INIT      "Py"
.
DB        INIT      "DB"
DDDAY     DIM       2
DDMON     DIM       2
DDYER     DIM       2
DDCEN     DIM       2
DIM1A     DIM       1
*DIM3      DIM       3
DIM4      DIM       4
DIM9      DIM       9
DIM11     DIM       11
DIM13     DIM       13
DIM14     DIM       14
DIM18     DIM       18
DIM18A    DIM       18
DIM24A    DIM       24
DIM30     DIM       30
DIM5A     DIM     5
DOCFNAME  DIM       50
EMCNGINV  DIM       1
EMCNDPOC  DIM       1
EMCNOPOC  DIM       15
EFTDATE   DIM       8         * Effective date (ccyymmdd)
.
HEALTHFN  DIM       6
HEALTDES  DIM       40
FMTSNAME  DIM       35
FMTGNAME  DIM       35
FMTTITLE  DIM       10
FORM3A    FORM      3
FIVE9     FORM      "59"
.
HOSPID    DIM       3
HOSPNAME  DIM       50
HINVDES   DIM       30
HESYST    FORM      1
HFHIFUND  FORM      2
.
KEY13A    DIM       13
KEYFLAG   FORM      1
JYEAR     FORM      2
INVTOTL   FORM      12.2
.
MBSFLAG   FORM      1
PASS      FORM      1
OPNFLAG   FORM      "0"      * Used in stepdown
OPRDATE   DIM       8
OTCNCFEE  FORM      1
OTCNFTYP  FORM      1
OPOCFLAG  FORM      1
OPCNCONS  DIM       1
.
SERVDOCT  DIM       10
SAVAMNT   FORM      12.2
SAVALLW   FORM      12.2
SAVBEND   FORM      3
SAVDISC   FORM      12.2
SAVEXTRA  FORM      12.2
SP12      INIT      "            "
SP14      INIT      "              "
SUROPT    FORM      1
.
TEMPFILE  DIM       8
TFEEIND   FORM      1
THCFLG    FORM      2
THREED    INIT      "3"
TTBILL    FORM      12.2
TTDAYS    FORM      8
TTNETT    FORM      12.2
UNKGST    FORM      1
WDATE1    DIM       8
WDATE2    DIM       8
WBSEUID   DIM       10
ZERO4     INIT      "0000"
TOTBDAYS  FORM      4
.
DISCONLY  FORM      1     * discharged only 1=no 0=yes
.
.         Web Variables (only the include files use these variables)
.
DAYFORMT  DIM       4
NJAN      INIT      "January"
NFEB      INIT      "February"
NMAR      INIT      "March"
NAPR      INIT      "April"
NMAY      INIT      "May"
NJUN      INIT      "June"
NJUL      INIT      "July"
NAUG      INIT      "August"
NSEP      INIT      "September"
NOCT      INIT      "October"
NNOV      INIT      "November"
NDEC      INIT      "December"
.
HTMLFILE  FIFO      ASCII, FIXED=250
MTHNAM3   DIM       3
MTHNAM3A  DIM       3
.
CFPAYCOD  DIM       3        * 3M Codefinder PAY Code
.
.
.         end web variables
.
PRGID     INIT      "NZPBIL60"
PRGNAM    INIT      "Invoice Pending Report"
VERSION   INIT      "V12.01.00"
+
.         START OF PROGRAM
.
          CALL      DISPHEAD                   * call display head routine
          CALL      IBACLOCK
          PACK      CURRDATE,CCC,CYY,CMM,CDD
          REP       " 0",CURRDATE
.
          DISPLAY   *P56:24,"Opening controlf";
          OPEN      CONTROLF,"controlf"
.
          READ      CONTROLF,ZERO;*43,IBCNMHOS,*85,IBCNUGST
          READ      CONTROLF,TEN;*104,PTCNMBSF:                        *C-47385
                                 *217,CAUDQ    * added for V5.01.14 - SRF 105195
          READ      CONTROLF,TEN3;*245,CHOSTYP
          READ      CONTROLF,TEN5;*247,CSTDOWN
          READ      CONTROLF,TEN9;*212,CFEETYP
          READ      CONTROLF,TWENTY;*164,PTRESDAY,*193,PTCNDCLM:
                                    *199,PTCNBCUT,*211,PTCNCNDY
          READ      CONTROLF,TWENTY1;*120,PTCNADDC
          READ      CONTROLF,THIRTY;*200,AECNFTYP
          READ      CONTROLF,THIRTY1;*163,OTCNFTYP,OTCNCFEE
          READ      CONTROLF,FIVE9;*1,CDLSTEP,*5,CREMINV:
                                   *66,CGSTPERC,CGSTITEM
          READ      CONTROLF,SEVENTY7;*214,PTCNBTNM
          READ      CONTROLF,SEVENTY9;*68,PTCNMFEE,PTCNJFEE
          READ      CONTROLF,SEVENTY9;*248,PTCNIPEN
          READ      CONTROLF,EIGHTY8;*162,PTCFEEOF
          READ      CONTROLF,HUND05;*99,PTCNNWCM
.
...  used in ABFAECCL
          CALL      TFILENAM                * Get file name calculating Exponent
          MOVE      TFILNAME,FNAMEN
.
...  used in PATCATBI CRMV0000
          CALL      TFILENAM                * Get temp file name
          MOVE      TFILNAME,FNAMEX
.
...  used in PATCATBI PTMP0000
          CALL      TFILENAM                * Get temp file name
          MOVE      TFILNAME,FNAMEZ
.
...  used in PATCATBI PT2P0000
          CALL      TFILENAM                * Get temp file name
          MOVE      TFILNAME,FNAMEY
.
...  used in NZPCATBI CRWL0000
          CALL      TFILENAM                * Get temp file name
          MOVE      TFILNAME,FNAMEQ
.
...  used in PABXBILL
          CALL      TFILENAM                * Get temp file name
          MOVE      TFILNAME,PBXFNAME
          CALL      TFILENAM                * Get temp file name
          MOVE      TFILNAME,PBXFNAM2
.
          CALL      TFILENAM                     * Generate temporary file name
          MOVE      TFILNAME,TEMPFILE
.
          DISPLAY   *P64:24,"patmi1af";
          OPEN      PATMI1A1,"patmi1af"
.
          DISPLAY   *P64:24,"patma1af";
          OPEN      PATMA1A1,"patma1af"
.
          DISPLAY   *P64:24,"patmx1af";
          OPEN      PATMX1A1,"patmx1af"
.
          DISPLAY   *P64:24,"patcodes";
          OPEN      PATCODE1,"patcodes"
.
          DISPLAY   *P64:24,"patfn1af";
          OPEN      PATFN1A1,"patfn1af"
.
          DISPLAY   *P64:24,"patdo1af";
          OPEN      PATDO1A1,"patdo1af"
.
          DISPLAY   *P64:24,"patwr1af";
          OPEN      PATWR1A1,"patwr1af"
.
          DISPLAY   *P64:24,"patdtraf";
          OPEN      PATDTRA1,"patdtraf"
.
          DISPLAY   *P64:24,"pmsmtiaf";
          OPEN      PMSMTIA1,"pmsmtiaf"
          OPEN      PMSMTIA2,"pmsmtiaf"
          OPEN      PMSMTIA4,"pmsmtiaf"
.
          DISPLAY   *P64:24,"pattranf";
          OPEN      PATTRAN2,"pattranf"
.
          DISPLAY   *P64:24,"patdschf";
          OPEN      PATDSCH1,"patdschf"
.
          DISPLAY   *P64:24,"patitemn";
          OPEN      PATITEM1,"patitemn"
.
          DISPLAY   *P64:24,"aaede1af";
          OPEN      AAEDE1A1,"aaede1af"
.
          DISPLAY   *P64:24,"aaedtref";
          OPEN      AAEDTRE1,"aaedtref"
.
          DISPLAY   *P64:24,"outsitaf";
          OPEN      OUTSITA1,"outsitaf"
.
          DISPLAY   *P64:24,"patvisaf";
          OPEN      PATVISA1,"patvisaf"
.
          DISPLAY   *P64:24,"pmsvx1af";
          OPEN      PMSVX1A1,"pmsvx1af"
.
          DISPLAY   *P64:24,"nzpbfeaf";
          OPEN      NZPBFEA1,"nzpbfeaf"
.
          DISPLAY   *P64:24,"nzpcfnaf"
          OPEN      NZPCFNA1,"nzpcfnaf"
.
          DISPLAY   *P64:24,"nzpcmtaf"
          OPEN      NZPCMTA1,"nzpcmtaf"
          OPEN      NZPCMTA2,"nzpcmtaf"
          OPEN      NZPCMTA3,"nzpcmtaf"
.
          DISPLAY   *P64:24,"nzpfigaf"
          OPEN      NZPFIGA1,"nzpfigaf"
          OPEN      NZPFIGA2,"nzpfigaf"
.
          DISPLAY   *P64:24,"nzpfinaf"
          OPEN      NZPFINA1,"nzpfinaf"
          OPEN      NZPFINA2,"nzpfinaf"
.
          DISPLAY   *P64:24,"nzpibraf"
          OPEN      NZPIBRA1,"nzpibraf"
.
          DISPLAY   *P64:24,"nzpmchaf"
          OPEN      NZPMCHA1,"nzpmchaf"
          OPEN      NZPMCHA2,"nzpmchaf"
          OPEN      PATMCHG1,"patmchgf"
.
          DISPLAY   *P64:24,"nzppicaf"
          OPEN      NZPPICA1,"nzppicaf"
          OPEN      NZPPICA2,"nzppicaf"
.
          DISPLAY   *P64:24,"nzprbraf"
          OPEN      NZPRBRA1,"nzprbraf"
.
          DISPLAY   *P64:24,"nzprfnaf"
          OPEN      NZPRFNA1,"nzprfnaf"
          OPEN      NZPRFNA2,"nzprfnaf"
.
          DISPLAY   *P64:24,"nzppfeaf"
          OPEN      NZPPFEA1,"nzppfeaf"
.
          DISPLAY   *P64:24,"nzpspraf"
          OPEN      NZPSPRA1,"nzpspraf"
          OPEN      NZPSPRA2,"nzpspraf"
.
          DISPLAY   *P64:24,"nzptfeaf"
          OPEN      NZPTFEA1,"nzptfeaf"
          OPEN      NZPTFEA2,"nzptfeaf"
.
          DISPLAY   *P64:24,"oprdetaf"
          OPEN      OPRDETA1,"oprdetaf"
.
          DISPLAY   *P64:24,"oprdetaf"
          OPEN      OPRDETA2,"oprdetaf"
          OPEN      OPRDETA3,"oprdetaf"
.
          DISPLAY   *P64:24,"oprsesaf"
          OPEN      OPRSESA1,"oprsesaf"
.
         DISPLAY   *P64:24,"rcpbdtaf";
         OPEN      RCPBDTA1,"rcpbdtaf"
.
         DISPLAY   *P64:24,"oprardaf";
         OPEN      OPRARDA1,"oprardaf"
.
         OPEN      PMSEVTA1,"pmsevtaf"
.
. If using GST
.
          IF        IBCNUGST = TWO
            DISPLAY   *P64:24,"patgtuaf";
            OPEN      PATGTUA1,"patgtuaf"
          ENDIF
.
. If Using the Invoice Pending File
.
          IF        PTCNIPEN = 0
            DISPLAY   *P64:24,"patipenf";
            OPEN      PATIPEN1,"patipenf"
          ENDIF
.
+
.        START OF PROGRAM
.
.        Determine which system this report is for
.
START     KEYIN     *P1:4,*EF:
                    *P1:4,*V2LON,*DV,ZERO,*HOFF," = Exit":
                    *P1:5,*V2LON,*DV,ONE,*HOFF," = Invoice Pending Report":
                    *P1:6,*V2LON,*DV,TWO,*HOFF," = Discharged In-Patients Only":
                    *P1:8,"Option : ",*V2LON,OPTION
.
          COMPARE   ZERO,OPTION
          GOTO      ENDIT IF EQUAL
.
          MOVE      ZERO,DISCONLY
          BRANCH    OPTION,STARTB,STARTA
.
          BEEP
          GOTO      START
.
STARTA    MOVE      ONE,DISCONLY
          MOVE      THREE,FSTSYS                  * Starting system = Inpatient
          MOVE      THREE,FEDSYS                  * Ending system = Inpatient
          GOTO      STARTC
.
STARTB    CALL      PATSELFN
          BRANCH    EXIT,START
.
STARTC    CALL      KEYD0000                 * Keyin details
.
.         COMPARE   ONE,CREMINV
.         GOTO      GETINV IF NOT EQUAL
.
          DISPLAY   *P1:13,*EF,*P1:14,*V2LON,ZERO,*HOFF," = Exit":
                    *P1:15,*V2LON,ONE,*HOFF," = Patient Surname Sequence":
                    *P1:16,*V2LON,TWO,*HOFF," = Admission Number Sequence"
.
STARTD    KEYIN     *P1:18,*EL,"Select option : ",*DV,UNDLN1:
                    *P17:18,*V2LON,SUROPT 
.
          COMPARE   ZERO,SUROPT   
          GOTO      START IF EQUAL
.
          BRANCH    SUROPT,STARTE,STARTE
          BEEP
          GOTO      STARTD
.
STARTE    
.        Make sure they want to remove the zero amount of invoice from
.        invoice pending
.
          KEYIN     *P1:22,*EL,"Do you really want to delete zero ":
                    "invoices of Discharged patients (":
                    *V2LON,"Y",*HOFF,*DV,SLASH:
                    *V2LON,"N",*HOFF,")? ",ANS;
          REP       UPPLOW,ANS
.
          MATCH     "Y",ANS
          GOTO      GETINV IF EQUAL
.
          MATCH     "N",ANS
          GOTO      START IF NOT EQUAL
.
          MOVE      ZERO,CREMINV
.
GETINV    MOVE       SP10,HOSPID
          IF         IBCNMHOS = 1
            DISPLAY    *P1:23,*EL,"Hospital Id : ";
            MOVE       TEN5,ECOL
            MOVE       "23",EVERT
            MOVE       SP3,CKYIDEF3
            MOVE       ZERO,CKYIMAND           * Not Mandatory
            OPEN       PATHSPA1,"pathspaf"
.
            CALL       PATHSPKY
            BRANCH     EXIT,KYHOSP20,START
            MOVE       PTHSHOSP,HOSPID
            MOVE       PTHSNAME,HOSPNAME
            GOTO       KYHOSP30
.
KYHOSP20    MOVE       "All Hospitals",HOSPNAME
            MOVE       SP10,HOSPID
.
KYHOSP30    CLOSE      PATHSPA1
.
            DISPLAY    *P23:23,*V2LON,PTHSNAME;
          ENDIF
.
.        Print the report
.
          COMPARE   TWO,SUROPT  
          GOTO      GETINV1 IF EQUAL
.
          CALL      CREA0000                * Create temporary file
          CALL      LOAD0000                * Load in debtors
.
GETINV1   MOVE      ZERO,CPAGENO
          MOVE      ONE,CNOUNDLN
          MOVE      ZERO,CLNO
          CALL      IBACLOCK
          BRANCH    FSTSYS OF PS1ONLY,PS1ONLY,PS1BOTH,PS1ONLY
.
PS1BOTH   MOVE      ZERO,PASS
          CALL      INVPND
          BRANCH    DISCONLY,PS1END
.
PS1ONLY   MOVE      ONE,PASS
          CALL      INVPND
.
          IF        IBCNUGST = TWO
            MOVE      TWO,PASS
            MOVE      ZERO,UNKGST
            CALL      INVPND
          ENDIF
.
          BRANCH    EXIT,START
.
PS1END    DISPLAY   *P1:24,*EL,*V2LON:
                    "** Report Generation Completed **",*W2;
.
          GOTO      START
+
.**************************************************************************
.*                            KEYD0000                                    *
.*  Keyin Claim Code, Health Fund, Admission type etc.                    *
.**************************************************************************
.         Keyin Claim Code
.
KEYD0000  MOVE      ZERO,EXIT
          DISPLAY   *P1:4,*EF:
                    *P1:5,"    Financial Class       :";
          MOVE      ONE,CNEWDS
          MOVE      TWENTY9,ECOL
          MOVE      FIVE,EVERT
          MOVE      SP3,CKYIDEF3
          MOVE      ZERO,CKYIMAND
          MOVE      SP10,ACODE
          PACK      CODE,ANSC,ANSL,SP70
          KEYIN     *PECOL:EVERT,*V2LON,ACODE
          PACK      ACODE,ACODE,SP10
          MOVE      ACODE,CLAIMTYP
          MOVE      SP70,CLAIMDES
          MATCH     SP10,CLAIMTYP
          IF        @EQUAL
            DISPLAY   *P29:5,*V2LON,"ALL";
          ELSE
            PACK      KEY5,CODE,ACODE
            CALL      RDCODE1
            IF        OVRCD=0
              DISPLAY   *P35:5,TDESC;
              MOVE      TDESC,CLAIMDES
            ENDIF
          ENDIF
.
.         Keyin Health Fund
.
KEYD2000  MOVE      SP8,HEALTHFN
          DISPLAY   *P1:6,"    Contract              :";
          MOVE      TWENTY9,ECOL
          MOVE      SIX,EVERT
          MOVE      SP10,HCODE
          MOVE      SP70,HEALTDES
          MOVE      ZERO,CKYIMODE
          KEYIN     *PECOL:EVERT,*V2LON,HCODE;
          PACK      HCODE,HCODE,SP70
.
          MOVE      HCODE,HEALTHFN
          MATCH     SP10,HEALTHFN
          IF        @EQUAL
            DISPLAY   *P29:6,*EL,*V2LON,"ALL"
          ELSE
            PACK      KEY14,HCODE,ZERO,ZERO,ZERO,ZERO,SP10
            CALL      RDFUND1
            IF        OVRCD=0
              DISPLAY   *P35:6,HFNAME;
              MOVE      HFNAME,HEALTDES
            ENDIF
          ENDIF
.
.         Keyin Admission Type/CMBS Class
.
KEYD3000  DISPLAY   *P1:7,"    CMBS Class            :";
.
          MOVE      ONE,CNEWDS
          MOVE      TWENTY9,ECOL
          MOVE      SEVEN,EVERT
          MOVE      SP3,CKYIDEF3
          MOVE      SP10,ACODE
          MOVE      SP70,ADMNDESC
          MOVE      ZERO,CKYIMAND
          MOVE      ANSA,CODE
          KEYIN     *PECOL:EVERT,*V2LON,ACODE
          PACK      ACODE,ACODE,SP10
.
          MOVE      ACODE,ADMNTYPE
          MATCH     SP10,ADMNTYPE
          IF        @EQUAL
            DISPLAY   *P29:7,*V2LON,"ALL";
          ELSE
            PACK      KEY5,CODE,ACODE
            CALL      RDCODE1
            IF        OVRCD=0
              DISPLAY   *P35:7,TDESC;
              MOVE      TDESC,ADMNDESC
            ENDIF
          ENDIF
KEYD9999  RETURN
.
.
.**************************************************************************
INVPND    MOVE      "99" TO CLNO
          MOVE      ZERO,EXIT                  * Assume a successful finish
          MOVE      ZERO TO TTBILL
          MOVE      ZERO TO TTNETT
          MOVE      ZERO TO TTDAYS
          MOVE      ONE,PROGFLAG
.
          COMPARE   TWO,SUROPT 
          GOTO      INVPND2 IF EQUAL
.
          PACK      KEY48,SP30
          CALL      RSTMP1          
.
INVPND1   CALL      RKTMP1
          BRANCH    OVRCD,ENDP
.
          PACK      KEY8,TEMPADM,SP10
          CALL      RDIPEN1
          BRANCH    OVRCD,INVPND1 
.
          GOTO      INVPND3
.
INVPND2   MOVE      SP8,KEY8
          CALL      RDSIPEN1
.
URLOOP    CALL      RDKIPEN1
          BRANCH    OVRCD,ENDP
.
INVPND3   DISPLAY   *P1:24,*EL,*P20:24,"Admission Number";
.
          MOVE      ZERO,TOTBDAYS
          MOVE      ZERO,DCFLAG
          IF        IBCNUGST = TWO
            BRANCH    PASS,CHKGST1,CHKGST2
.
CHKGST1     PACK      KEY8,IPADMNO,SP8
            CALL      RAPTGTU1
            BRANCH    OVRCD,UNKGST
            GOTO      INVPND4
.
CHKGST2     PACK      KEY8,IPADMNO,SP8
            CALL      RAPTGTU1
            BRANCH    OVRCD,INVPND4
            GOTO      UNKGST
          ENDIF
.
UNKGST    DISPLAY   *P39:24,*V2LON,IPADMNO;
.
          COMPARE   FSTSYS,IPSYSTM
          GOTO      INVPND4 IF LESS
.
          COMPARE   IPSYSTM,FEDSYS
          GOTO      INVPND4 IF LESS
.
          IF        PASS = TWO
            MOVE      ONE,UNKGST
          ENDIF
.
          IF        IBCNMHOS =1
            MATCH     SP10,HOSPID
            IF        !@EQUAL
              PACK      KEY8,IPADMNO,SP8
              CALL      RDPMVX11
              IF        OVRCD=0
                MATCH     PMVXMHOS,HOSPID
                GOTO      INVPND4 IF NOT EQUAL
              ENDIF
            ENDIF
          ENDIF
.
.       Calculate the amount to be invoiced - different for each system
.
          MOVE      ZERO,TOTDAYS
          BRANCH    IPSYSTM OF AAECALC,OUTCALC,INPCALC,OUTCALC,INVPND4
.
INPCALC   MOVE      IPADMNO,KEY8
          CALL      RDMISS1
          BRANCH    OVRCD OF INVPND4
.
          CALL      VREC0000             * Validate record
          BRANCH    EXIT,INVPND4
.
          MOVE      IPADMNO,KEY8
          CALL      RDVISA1
          BRANCH    OVRCD OF INVPND4
.
          BRANCH    PASS,CHKCURR,CONTCHK
.
          COMPARE   THREE TO ASTAT
          GOTO      INVPND4 IF NOT EQUAL
          GOTO      CONTCHK
.
.       Second pass, check for current admissions, and patients on leave
.
CHKCURR   COMPARE   TWO,ASTAT
          GOTO      CONTCHK IF EQUAL
.
          COMPARE   FOUR,ASTAT
          GOTO      INVPND4 IF NOT EQUAL
.
.       Inpatient to be invoiced
.
CONTCHK   UNPACK    ADATE TO ACEN,AYER,AMON,ADAY
.
          MOVE      AURNO,KEY8
          CALL      RDMAST1
          BRANCH    OVRCD OF INVPND4
.
.         Initialise variables
.
          MOVE      SP8,DDATE
          MOVE      ONE,DISFLG
          COMPARE   THREE,ASTAT
          GOTO      INPCTBI IF NOT EQUAL
.
          MOVE      ZERO,DISFLG
          MOVE      AADMNO,KEY8
          CALL      RDDSCH1
.
          UNPACK    DDATE TO DDCEN,DDYER,DDMON,DDDAY
.
INPCTBI   MOVE      ZERO,DISPROG
          MOVE      CPAGENO,FORM3A
          MOVE      ZERO,IBCNUGST         * set no GST for pending report
          MOVE      ZERO,INVTOTL
          MOVE      "PRFA  ",EXPPAYER       * check for patient invoice
          MOVE      ONE,PRPATINV            * flag for printing patient invoice
          CALL      CALCTBI
          ADD       GROSSTOT,INVTOTL
          ADD       TOTDAYS,TOTBDAYS
.
.         Get all the funder
.
          OPEN      VISPAYA1,"vispayaf"
          MOVE      AADMNO,DTADMNO
          PACK      KEY14,AADMNO,SP70          * get the first funder
          CALL      RSVSPAY1
INPCT10   CALL      RKVSPAY1                     * get next expected payer
          BRANCH    OVRCD,INPCT20  
          MATCH     DTADMNO,VSPAVISN             * Same visit?
          GOTO      INPCT20 IF NOT EQUAL
.
          MOVE      ZERO,PRPATINV                * Set to print funder invoice
          MATCH     SP70,VSPAPAYC
          GOTO      INPCT10 IF EQUAL             * try next funder
.
          MOVE      VSPAPAYC,EXPPAYER            * Set the next funder
          MOVE      ZERO,PRPATINV           * flag for printing funder invoice
          CALL      CALCTBI                 * Calculate the amt to invoice
          ADD       GROSSTOT,INVTOTL
          ADD       TOTDAYS,TOTBDAYS
          GOTO      INPCT10
.
INPCT20   MOVE      FORM3A,CPAGENO
          MOVE      INVTOTL,NETTOT
          MOVE      TOTBDAYS,TOTDAYS
          GOTO      INVLOOP
.
.        Outpatient to be invoiced
.
OUTCALC   BRANCH    PASS,OUTCALC0,OUTCALC0
          GOTO      INVPND4
.
OUTCALC0  MOVE      IPADMNO,PVIBILL
          MOVE      PVIBILL,KEY8
          CALL      RDVISA1
          BRANCH    OVRCD OF INVPND4
.
          MOVE      PVIURNO,PURNO
          MOVE      PURNO,KEY8
          CALL      RDMAST1
          BRANCH    OVRCD OF INVPND4
          UNPACK    SP70,AFUNDH,ACLAIM,ATYPE
          MOVE      PFUNDH,AFUNDH
.
          COMPARE   FOUR,IPSYSTM
          GOTO      OUTCALC1 IF NOT EQUAL
.
.         Other financial
.
          MOVE      "out",OSTFILE
.
          MOVE      SP3,OBACOMP
          MOVE      SP3,OBACLASS
          MOVE      SP3,OBASRCR
          MOVE      SP3,OBAINS
          MOVE      SP10,OBADATE
          GOTO      OUTCALC2
.
.         Outpatient
.
OUTCALC1  MATCH     FSTSITE,PVISITE
          GOTO      INVPND4 IF LESS
.
          MATCH     PVISITE,FEDSITE
          GOTO      INVPND4 IF LESS
.
          MOVE      SP3,OSTSYST
          MOVE      "out",OSTFILE
          MOVE      PVISITE,KEY6
          CALL      RDSITA1
.
          MATCH     FSTDEPT,OSTSYST
          GOTO      INVPND4 IF LESS
.
          MATCH     OSTSYST,FEDDEPT
          GOTO      INVPND4 IF LESS
.
.        Get the finanical booking details
.
GETBDET   PACK      CFNAME WITH OSTFILE,FILBB1A2
          CLOSE     OUTBB1A2
          CALL       OPOTBB12
.
          CLOSE     OUTDTRO1
          PACK      CFNAME,OSTFILE,FILDTRO1
          OPEN      OUTDTRO1,CFNAME
.
          PACK      KEY16,PVIDATE,PVIBILL
          CALL      RDBOKB2
          BRANCH    OVRCD,INVPND4
.
          MOVE      PVIURNO,OBAURNO
          MOVE      PVISITE,OBASITE
          MOVE      OBACOMP,ACLAIM
          MOVE      OTBBFUND,AFUNDH
          MOVE      OBACLASS,ATYPE
.
OUTCALC2  CALL      VREC0000             * Validate record
          BRANCH    EXIT,INVPND4
.
          UNPACK    OBADATE WITH ACEN,AYER,AMON,ADAY
.
          IF        IBCNUGST=2
            MOVE      ZERO,IBCNUGST         * set no GST for pending report
            CALL      OUTTBI
            MOVE      TWO,IBCNUGST
          ELSE
            CALL      OUTTBI
          ENDIF
          MOVE      ZERO,TOTDAYS
.
          MOVE      OBACOMP,ACLAIM
          MOVE      OBACLASS,ATYPE
          MOVE      OBASRCR,ACLSS
          MOVE      OBAINS,AUSR2
          GOTO      INVLOOP
.
.        A + E to be invoiced
.
AAECALC   BRANCH    PASS,AAECALC0,AAECALC0
          GOTO      INVPND4
.
AAECALC0  MOVE      IPADMNO,PVIBILL
          MOVE      PVIBILL,KEY8
          CALL      RDVISA1
          BRANCH    OVRCD OF INVPND4
.
          MOVE      PVIURNO,PURNO
          MOVE      PURNO,KEY8
          CALL      RDMAST1
          BRANCH    OVRCD OF INVPND4
          UNPACK    SP70,AFUNDH,ACLAIM,ATYPE
          MOVE      PFUNDH,AFUNDH
.
          COMPARE   NINE,PVITYPE
          GOTO      AAECAL10 IF NOT EQUAL
.
          MOVE      PVIURNO,ADAURNO
          MOVE      PVIBILL,ADANUMB
          MATCH     " 1",PVISYST
          GOTO      AAECAL20 IF EQUAL            * Emergency event
.
AAECAL10  MOVE      PVIBILL,KEY8
          CALL      RDDETA1
          BRANCH    OVRCD OF INVPND4
          MOVE      AEDAFUND,AFUNDH
          MOVE      ADACOMP,ACLAIM
          MOVE      ADACLASS,ATYPE
.
AAECAL20  CALL      VREC0000             * Validate record
          BRANCH    EXIT,INVPND4
.
          IF        IBCNUGST=2
            MOVE      ZERO,IBCNUGST         * set no GST for pending report
            CALL      AAETBI
            MOVE      TWO,IBCNUGST
          ELSE
            CALL      AAETBI
          ENDIF
          MOVE      ZERO,TOTDAYS
.
          MOVE      PVIBILL,KEY8
          CALL      RDPMEVT1                     * Emergency event
          IF        OVRCD=0
            MOVE      PMEVADTE,ADADATE
            MOVE      PMEVCCOD,ADACOMP
            MOVE      PMEVADMT,ADACLASS
            MOVE      SP70,ADASRC
            MOVE      SP70,ADAINSUR
          ENDIF
.
          UNPACK    ADADATE WITH ACEN,AYER,AMON,ADAY
          MOVE      ADACOMP,ACLAIM
          MOVE      ADACLASS,ATYPE
          MOVE      ADASRC,ACLSS
          MOVE      ADAINSUR,AUSR2
.
.       If the invoice is for zero amount, and zero bed days, then ignore it
.
INVLOOP   MOVE      NETTOT,GROSSTOT
.
          COMPARE   ZERO,GROSSTOT
          GOTO      GCASH IF NOT EQUAL
.
          COMPARE   ZERO,TOTDAYS
          GOTO      GCASH IF NOT EQUAL
.
.       Invoice for Zero amount, Zero days - if patient is discharged, delete
.       record from the PATIPEFD file
.
          BRANCH    IPSYSTM OF DELIPEN,DELIPEN,CHKSTAT,DELIPEN,INVPND4
.
          COMPARE   THREE,ASTAT
          GOTO      DELIPEN IF EQUAL
          GOTO      INVPND4
.
.       Process any pending cash
.
GCASH     CALL      GETCASH
          SUB       CSAMT,NETTOT
.
.       Check with the indicator to remove the zero amounts of invoice
.
          COMPARE   ONE,CREMINV
          GOTO      OKPRT IF NOT EQUAL
.
          COMPARE   ZERO,GROSSTOT
          GOTO      OKPRT IF NOT EQUAL
.
          BRANCH    IPSYSTM OF DELIPEN,DELIPEN,CHKSTAT,DELIPEN,INVPND4
.
CHKSTAT   COMPARE   THREE,ASTAT
          GOTO      DELIPEN IF EQUAL
          GOTO      INVPND4
.
DELIPEN   IF        CREMINV=1
            MOVE      IPADMNO,KEY8
            CALL      DEIPEN1
            CALL      RDSIPEN1
            GOTO      INVPND4
          ENDIF
.
OKPRT     ADD       GROSSTOT,TTBILL
          ADD       NETTOT,TTNETT
          ADD       TOTDAYS,TTDAYS
          CALL      PRINTL
          GOTO      INVPND4
.
INVPND4   COMPARE   TWO,SUROPT  
          GOTO      URLOOP IF EQUAL
.
          GOTO      INVPND1
.
.           OVER CONDITION FOUND..PRINT LAST LINE OF -- AND DISPLAY MESSAGE
.
ENDP      COMPARE   THREE,FSTSYS
          GOTO      ENDP1 IF EQUAL
.
          COMPARE   ZERO,CPAGENO
          GOTO      NODATA IF EQUAL
.
ENDP1     BRANCH    PASS,ENDPA,ENDPA
.
.        Discharged Patients Report
.
          PRINT     *96,"-------",*107,"-----------",*122,"-----------":
                    *N,*95,TTDAYS,*103,TTBILL,*118,TTNETT:
                    *N,*96,"-------",*107,"-----------",*122,"-----------":
                    *N,*N,"*** END OF REPORT ***"
          RETURN
.
.        Current Admissions Report
.
ENDPA 
.    IF        PASS = TWO
.           COMPARE   ZERO,UNKGST        * Were admiss. w/ unknown GST found?
.           GOTO      ENDP1 IF NOT EQUAL
.           RETURN                       * No
.         ENDIF
.
          IF        FSTSYS = 3
            COMPARE   ZERO,CPAGENO
            GOTO      NODATA IF EQUAL
            PRINT     *93,"-------",*107,"-----------",*122,"-----------":
                      *N,*92,TTDAYS,*103,TTBILL,*118,TTNETT:
                      *N,*93,"-------",*107,"-----------",*122,"-----------":
                      *N,*N,"*** END OF REPORT ***"
          ELSE
            PRINT     *107,"-----------",*122,"-----------":
                      *N,*103,TTBILL,*118,TTNETT:
                      *N,*107,"-----------",*122,"-----------":
                      *N,*N,"*** END OF REPORT ***"
          ENDIF
          RETURN
.
NODATA    DISPLAY   *P1:24,*EL,*B:
                    "No Data Found for the Selected Report.  ";
          CALL      HITENTER
          MOVE      ONE,EXIT                     * No data found
          RETURN
+
.------------------------------------------------------------
.         Validate record
.------------------------------------------------------------
VREC0000  MOVE      ZERO,EXIT
          MATCH     SP70,CLAIMTYP
          GOTO      VREC1000 IF EQUAL      * all claim code
          MATCH     "All",CLAIMTYP
          GOTO      VREC1000 IF EQUAL      * all claim code
          MATCH     ACLAIM,CLAIMTYP
          GOTO      VREC9000 IF NOT EQUAL
.
VREC1000  MATCH     SP70,HEALTHFN
          GOTO      VREC2000 IF EQUAL      * all health fund
          MATCH     "All",HEALTHFN
          GOTO      VREC2000 IF EQUAL      * all health fund
          MATCH     AFUNDH,HEALTHFN
          GOTO      VREC9000 IF NOT EQUAL
.
VREC2000  MATCH     SP70,ADMNTYPE
          GOTO      VREC9999 IF EQUAL
          MATCH     "All",ADMNTYPE
          GOTO      VREC9999 IF EQUAL
          MATCH     ATYPE,ADMNTYPE
          GOTO      VREC9000 IF NOT EQUAL
          GOTO      VREC9999
.
VREC9000  MOVE      ONE,EXIT
VREC9999  RETURN
+
.
.     PRINT ACTUAL DATA
.
PRINTL    BRANCH    PASS,PRINTLA,PRINTLA
.
          COMPARE   "55",CLNO
          CALL      HEAD IF NOT LESS
.
          MOVE      SP20,DIM13
.
          UNPACK    PSNAME,KEY13
          MOVE      PGNAME,DIM13
          OPEN      CONTROLF,"controlf"
          READ      CONTROLF,HUND10;*249,PTCNDAUR
          PACK      DIM9,PURNO,SP70
          MATCH     "1",PTCNDAUR
          IF        @EQUAL
            PACK      KEY20,SP70
            PROC      GETALIDS
            MATCH     SP70,KEY20
            IF        !@EQUAL
              UNPACK    KEY20,DIM11,DIM9
            ENDIF
          ENDIF
.
          PRINT     IPADMNO,*10,DIM9,*19,KEY13," ",DIM13:
                    *51,ADAY,SLASH,AMON:
                    SLASH,AYER,*60,DDDAY,SLASH,DDMON,SLASH,DDYER:
                    *71,ACLAIM,*77,ACLSS,*83,AUSR2,*90,ATYPE:
                    *99,TOTDAYS,*103,GROSSTOT,*118,NETTOT
          ADD       ONE,CLNO
          RETURN
.
PRINTLA   COMPARE   "55",CLNO
          CALL      HEADA IF NOT LESS
.
          BRANCH    IPSYSTM OF PRINTNP,PRINTNP,PRINTNI,PRINTNP,PRINT9
.
PRINTNI   UNPACK    PGNAME,DIM13
          UNPACK    PSNAME,KEY13
          OPEN      CONTROLF,"controlf"
          READ      CONTROLF,HUND10;*249,PTCNDAUR
          PACK      DIM9,PURNO,SP70
          MATCH     "1",PTCNDAUR
          IF        @EQUAL
            PACK      KEY20,SP70
            PROC      GETALIDS
            MATCH     SP70,KEY20
            IF        !@EQUAL
              UNPACK    KEY20,DIM11,DIM9
            ENDIF
          ENDIF
.
          PRINT     IPADMNO,*10,DIM9,*19,PSNAME," ",DIM13:
                    *57,ADAY,SLASH,AMON,SLASH,AYER:
                    *66,ACLAIM,*72,ACLSS,*78,AUSR2,*85,ATYPE:
                    *97,TOTDAYS,*103,GROSSTOT,*118,NETTOT
          ADD       ONE,CLNO
          RETURN
.
PRINTNP   UNPACK    PGNAME,KEY20
          OPEN      CONTROLF,"controlf"
          READ      CONTROLF,HUND10;*249,PTCNDAUR
          PACK      DIM9,PURNO,SP70
          MATCH     "1",PTCNDAUR
          IF        @EQUAL
            PACK      KEY20,SP70
            PROC      GETALIDS
            MATCH     SP70,KEY20
            IF        !@EQUAL
              UNPACK    KEY20,DIM11,DIM9
            ENDIF
          ENDIF
.
          PRINT     IPADMNO,*10,DIM9,*19,PSNAME," ",KEY20:
                    *61,ADAY,SLASH,AMON,SLASH,AYER:
                    *72,ACLAIM,*78,ACLSS,*85,AUSR2,*91,ATYPE:
                    *103,GROSSTOT,*118,NETTOT
.
          ADD       ONE,CLNO
PRINT9    RETURN
+
.                 HEADINGS FOR OUTPUT
.
HEAD      IF        PASS = ONE | PASS = THREE
           MOVE      "- GST Unknown Report",CPHDROPT
          ELSE
           MOVE      "- Discharged Patients",CPHDROPT
          ENDIF
          CALL      HEAD132
          IF        IBCNMHOS =1
            PRINT     *40,"Hospital : ",HOSPID,"    ",HOSPNAME
          ENDIF
.
          CALL      PSHED000
.
          PRINT     *N,"Adm.",*10,"U/R",*51,"Billing":
                    *60,"Discharge",*71,"Comp.",*77,"Pat.",*83,"Charge":
                    *90,"Pat.",*96,"Days to",*107,"  Amt to be":
                    *122,"Amount Less",*N:
                    "Number",*10,"Number",*19,"Patient Name":
                    *51,"Date ",*60,"Date ",*71,"Code",*77,"Cat":
                    *83,"Status",*90,"Class",*96,"Invoice":
                    *107,"  Invoiced",*122,"Cash Recvd",*N:
                    *1,"--------",*10,"--------",*19,"-----------------":
                    "----------":
                    *51,"--------",*60,"---------",*71,"-----",*77,"----":
                    *83,"------",*90,"-----",*96,"-------",*107,"-----------":
                    *122,"-----------"
.
          MOVE      SEVEN,CLNO
          IF        IBCNMHOS=1
            ADD       ONE,CLNO
          ENDIF
          RETURN
.
HEADA     BRANCH    FSTSYS OF HEADNIP,HEADNIP,HEADCUR,HEADNIP
.
          IF        PASS = TWO
            MOVE      "-GST Unknown Report",CPHDROPT
          ELSE
            MOVE      "-Consolidated Report",CPHDROPT
          ENDIF
          CALL      HEAD132
          IF        IBCNMHOS =1
            PRINT     *40,"Hospital : ",HOSPID,"    ",HOSPNAME
          ENDIF
.
          CALL      PSHED000
.
          PRINT     *N,"Adm.",*10,"U/R",*56,"Admission",*66,"Comp.",*72,"Pat.":
                    *78,"Charge",*85,"Pat.",*94,"Days to",*107,"  Amt to be":
                    *122,"Amount Less",*N:
                    "Number",*10,"Number",*19,"Patient Name":
                    *60,"Date",*66,"Code",*72,"Cat",*78,"Status",*85,"Class":
                    *94,"Invoice":
                    *107,"  Invoiced",*122,"Cash Recvd",*N:
                    *1,"--------",*10,"--------",*19,"----------------------":
                    "-------------":
                    *56,"---------",*66,"-----",*72,"-----",*78,"------":
                    *85,"-----",*94,"-------":
                    *107,"-----------",*122,"-----------"
.
          MOVE      SEVEN,CLNO
          IF        IBCNMHOS=1
            ADD       ONE,CLNO
          ENDIF
          RETURN
.
HEADCUR   IF        PASS = TWO
            MOVE      "-GST Unknown Report",CPHDROPT
          ELSE
            MOVE      "- Current Admissions",CPHDROPT
          ENDIF
          CALL      HEAD132
          IF        IBCNMHOS =1
            PRINT     *40,"Hospital : ",HOSPID,"    ",HOSPNAME
          ENDIF
.
          PRINT     *N,"Adm.",*10,"U/R",*56,"Admission",*66,"Comp.",*72,"Pat.":
                    *78,"Charge",*85,"Pat.",*93,"Days to",*107,"  Amt to be":
                    *122,"Amount Less",*N:
                    "Number",*10,"Number",*19,"Patient Name":
                    *59,"Date",*66,"Code",*72,"Cat",*78,"Status",*85,"Class":
                    *93,"Invoice":
                    *107,"  Invoiced",*122,"Cash Recvd",*N:
                    *1,"--------",*10,"--------",*19,"----------------------":
                    "----":
                    *56,"---------",*66,"-----",*72,"-----",*78,"------":
                    *85,"-----",*93,"-------":
                    *107,"-----------",*122,"-----------"
.
          MOVE      SEVEN,CLNO
          IF        IBCNMHOS=1
            ADD       ONE,CLNO
          ENDIF
          RETURN
.
HEADNIP   BRANCH    PASS,HEADNIP2,HEADNIPG
.
HEADNIP2  BRANCH    FSTSYS,HEADNIPA,HEADNIPO,HEADCUR,HEADNIPH
          GOTO      HEADNIPA
.
HEADNIPG  MOVE      "-GST Unknown Report",CPHDROPT
          CALL      HEAD132
          IF        IBCNMHOS =1
            PRINT     *40,"Hospital : ",HOSPID,"    ",HOSPNAME
          ENDIF
.
          IF        FSTSYS = TWO
            MATCH     SP3,FSTDEPT
            GOTO      HEADNIPD IF NOT EQUAL
            PRINT     *40,"SITES ",FSTSITE," TO ",FEDSITE
          ENDIF
.
          GOTO      HEADNIPC
.
HEADNIPA  MOVE      "- Acc. & Emergency",CPHDROPT
          CALL      HEAD132
          IF        IBCNMHOS =1
            PRINT     *40,"Hospital : ",HOSPID,"    ",HOSPNAME
          ENDIF
.
          GOTO      HEADNIPC
.
HEADNIPH  MOVE      "- Other Financial",CPHDROPT
          CALL      HEAD132
          IF        IBCNMHOS =1
            PRINT     *40,"Hospital : ",HOSPID,"    ",HOSPNAME
          ENDIF
.
          GOTO      HEADNIPC
.
HEADNIPO  MATCH     SP3,FSTDEPT
          GOTO      HEADNIPD IF NOT EQUAL
.
          MOVE      "- Outpatients",CPHDROPT
          CALL      HEAD132
          IF        IBCNMHOS =1
            PRINT     *40,"Hospital : ",HOSPID,"    ",HOSPNAME
          ENDIF
.
          PRINT     *40,"SITES ";
.
          MATCH     SP6,FSTSITE
          IF  @EQUAL
            PRINT     *46,"START ";
           ELSE
            PRINT     *46,FSTSITE;
          ENDIF
.
          PRINT     *52," TO ";
.
          MATCH     "ZZZZZZ",FEDSITE
          IF  @EQUAL
            PRINT     *56,"FINISH";
           ELSE
            PRINT     *56,FEDSITE;
          ENDIF
.
          GOTO      HEADNIPC
.
HEADNIPD  MOVE      SP20,TDESC
          PACK      KEY5,CODEO,FSTDEPT
          CALL      RDCODE1
.
          MOVE      "- Outpatients",CPHDROPT
          CALL      HEAD132
          IF        IBCNMHOS =1
            PRINT     *40,"Hospital : ",HOSPID,"    ",HOSPNAME
          ENDIF
.
          MATCH     SP6,FSTSITE
          GOTO      OPSITE IF NOT EQUAL
.
          PRINT     *45,"ALL SITES";
          GOTO      OPDEPT
.
OPSITE    PRINT     *40,"SITE ",FSTSITE;
.
OPDEPT    MATCH     SP3,FSTDEPT
          GOTO      HEADNIPC IF EQUAL
.
          PRINT     *55,"DEPARTMENT ",FSTDEPT
.
HEADNIPC  PRINT     *N,"Bill",*10,"U/R",*61,"Service",*71,"Comp.",*77,"Sour.":
                    *83,"Insr.",*90,"Pat.",*107,"  Amt to be":
                    *122,"Amount Less",*N:
                    "Number",*10,"Number",*19,"Patient Name":
                    *62,"Date",*71,"Code",*77,"Ref",*83,"Status",*90,"Class":
                    *107,"  Invoiced",*122,"Cash Recvd",*N:
                    *1,"--------",*10,"--------",*19,"----------------------":
                    "-----------------":
                    *61,"--------",*71,"-----",*77,"-----",*83,"------":
                    *90,"-----":
                    *107,"-----------",*122,"-----------"
.
          IF        FSTSYS = 2
            MOVE      EIGHT,CLNO
          ELSE
            MOVE      SEVEN,CLNO
          ENDIF
          IF        IBCNMHOS=1
            ADD       ONE,CLNO
          ENDIF
          RETURN
.
GETCASH   OPEN      COMDEPA2,"comdepaf"
          OPEN      RCPDTEA1,"rcpdteaf"
          IF        CFEETYP = 6
            OPEN      CONTROLF,"controlf"
            READ      CONTROLF,THIRTY6;*180,RCCNDPID,RCCNDPFU
          ENDIF
.
          MOVE      ZERO,CSAMT
          MOVE      ZERO,CASHFLAG
          MOVE      IPADMNO,DAADMNO
          MOVE      "0",CMDESTAT
          PACK      KEY26,IPADMNO,CMDESTAT,SP70
          CALL      RSCMDEP2
CASHLP1   CALL      RKCMDEP2
          BRANCH    OVRCD OF ENDCSHLP
.
          MATCH     DAADMNO,CMDEADMN
          GOTO      ENDCSHLP IF NOT EQUAL
.
          MATCH     "0",CMDESTAT              * Deposit held?
          GOTO      ENDCSHLP IF NOT EQUAL
.
          PACK      KEY17,CMDERECN,CMDETCNT
          CALL      RDRCDTE1
          BRANCH    OVRCD,CASHLP1
.
.         If Mt. Alvernia billing, then only deposits belonging to registers
.         for Initial and Further deposits will be included here
.
          IF        CFEETYP = 6
            MATCH     CMDEDTYP,RCCNDPID          * initial deposit register ?
            IF        !@EQUAL
              MATCH     CMDEDTYP,RCCNDPFU        * further deposit register ?
              GOTO      CASHLP1 IF NOT EQUAL     * no - ignore
            ENDIF
          ENDIF
.
          ADD       RCDTAMNT,CSAMT
          GOTO      CASHLP1
.
ENDCSHLP  RETURN
+
.**************************************************************************
PSHED000  MATCH     SP70,CLAIMTYP
          IF        @EQUAL
            PRINT     *40,"Financial Class : All"
          ELSE
            PRINT     *40,"Financial Class : ",CLAIMDES
          ENDIF
.
          MATCH     SP70,HEALTHFN
          IF        @EQUAL
            PRINT     *40,"Contract        : All"
          ELSE
            PRINT     *40,"Contract        : ",HEALTDES
          ENDIF
.
          MATCH     SP70,ADMNTYPE
          IF        @EQUAL
            PRINT     *40,"CMBS Class      : All"
          ELSE
            PRINT     *40,"CMBS Class      : ",ADMNDESC
          ENDIF
PSHED999  RETURN
+
.**************************************************************************
.*                              CREA0000                                  *
.*             create a new temporary file                                *
.**************************************************************************
.
CREA0000  CALL      KILL0000                     * remove existing file
.
          PACK      CMDLIN1,ISBIT,TEMPFILE,UKEYIT
          EXECUTE   CMDLIN1,TASKID               * create temporary index file
.
          OPEN      PENTEMP1,TEMPFILE            * open temp index file
.
CREA9999  RETURN
.****************************************************************************
.*                              KILL0000                                    *
.*               close and erase the temporary file                         *
.****************************************************************************
.
KILL0000  CLOSE     PENTEMP1                     * close file
.
          PACK      CMDLIN2,ERASEIT,TEMPFILE     * set file erase command
          EXECUTE   CMDLIN2,TASKID               * erase temp file
.
KILL9999  RETURN
.****************************************************************************
.*                               LOAD0000              Called by: PROC0000  *
.*       Load the temp file with the relevant unique identifiers            *
.*       for the debtors that have pending invoices                         *
.****************************************************************************
.
LOAD0000  DISPLAY   *P1:24,*EL,"Sorting by Patient Surname....";
          PACK      KEY8,SP10
          CALL      RDSIPEN1                 
LOAD0100  CALL      RDKIPEN1                      * read next record
          BRANCH    OVRCD,LOAD9999               * end of file
.
          DISPLAY   *P32:24,*V2LON,IPADMNO;
.
          COMPARE   FSTSYS,IPSYSTM
          GOTO      LOAD0100 IF LESS
.
          COMPARE   IPSYSTM,FEDSYS
          GOTO      LOAD0100 IF LESS
.
.         set up the variables for the temp file
.
          MOVE      DIPADMNO,TEMPADM
.
          PACK      TEMPSUR,SP30  
          MOVE      "Unknown Patient",TEMPSUR 
          PACK      TEMPGIV,SP30  
.
          MOVE      IPADMNO,KEY8
          CALL      RDMISS1
          BRANCH    OVRCD OF LOAD0500
.
          MOVE      AURNO,KEY8
          CALL      RDMAST1
          BRANCH    OVRCD OF LOAD0500
.
          MOVE      PSNAME,TEMPSUR
          MOVE      PGNAME,TEMPGIV
.
LOAD0500  PACK      KEY48,TEMPSUR,TEMPGIV,TEMPADM
          CALL      RATMP1                       * position on the temp file
          BRANCH    OVRCD,LOAD0900               * not on file
.
          GOTO      LOAD0100                     * get next record
.
.         write to the temp file
.
LOAD0900  CALL      WRTMP1
.
          GOTO      LOAD0100                     * get next record
.
LOAD9999  RETURN
.****************************************************************************
.*        IO ROUTINES FOR TEMPORARY FILE                                    *
.****************************************************************************
RATMP1    MOVE      ZERO,OVRCD
          RESET     KEY48
          READ      PENTEMP1,KEY48;ANS
          GOTO      OVERCOND IF OVER
          RETURN
.
WRTMP1    WRITE     PENTEMP1,KEY48;TEMPSUR,TEMPGIV,TEMPADM
          RETURN
.
RSTMP1    READ      PENTEMP1,KEY48;;
          RETURN
.
RKTMP1    MOVE      ZERO,OVRCD
          READKS    PENTEMP1;TEMPSUR,TEMPGIV,TEMPADM
          GOTO      OVERCOND IF OVER
          RETURN
+
.*****************************************************************************
.*  GETALTID
.*  Procedure to get an alternate ID
.*  Exit=0  No alternate ID
.*       1  Alternate ID's exist
.*****************************************************************************
          DEFPROC   GETALIDS
.
          INC       PMSAIDFD/INC
.
          MOVE      ZERO,EXIT
          PACK      KEY20,SP70
          OPEN      PMSAIDA1,"pmsaidaf"
.
          PACK      KEY31,PURNO,SP70
          CALL      RSPMAID1           * Read alternate id Table
GETALI10  CALL      RKPMAID1
          BRANCH    OVRCD,GETALI99
.
          MATCH     PURNO,PMAIURNO     * Check same UR
          GOTO      GETALI99 IF NOT EQUAL
.
          MATCH     "1",PMAIDISU
          GOTO      GETALI10 IF NOT EQUAL
.
          PACK      KEY20,PMAIALID,SP70
          MOVE      ONE,EXIT
          GOTO      GETALI99
.
          INC       PMSAIDIO/INC
          INC       IBAOVRIO/INC
.
GETALI99  CLOSE     PMSAIDA1
.
          ENDPROC
.
.
.         IO includes
.
          INC       STD001IO
          INC       AAECATBI
          INC       AAEDE1IO/INC     
          INC       AAEDTRIO/INC
          INC       CALCAGE     
          INC       CLNZPPIC
          INC       CLPMSIDE
          INC       IBAGEDIO/INC
          INC       IBAGSTIO/INC
          INC       IBAPASIO/INC
          INC       IBASECIO/INC
          INC       IBATMDIO/INC
          INC       NHIMASIO/INC
          INC       MLTCFNIO/INC

          INC       NZPBFEIO/INC
          INC       NZPEXTIO/INC
          INC       NZPCFNIO/INC
          INC       NZPCMTIO/INC
          INC       NZPFIGIO/INC
          INC       NZPIBRIO/INC
          INC       NZPMCHIO/INC
          INC       NZPMXCIO/INC
          INC       NZPPFEIO/INC
          INC       NZPPICIO/INC
          INC       NZPRBRIO/INC
          INC       NZPRFNIO/INC
          INC       NZPFINIO/INC
          INC       NZPSPRIO/INC
          INC       NZPTFEIO/INC
          INC       NZPIVBIO/INC
          INC       NZPRVBIO/INC
          INC       NZPRDTIO/INC

          INC       OPRDEAIO/INC
          INC       OPRARDIO/INC
          INC       OPRSESIO/INC
          INC       OUTCATBI
          INC       OUTBOAIO/INC
          INC       OUTBB1IO/INC
          INC       OUTDTRIO/INC
          INC       OUTSITIO/INC
          INC       PATCATBI
          INC       PATCODDS
          INC       CHKCMXPT                * Check if casemix & get epis type
          INC       PATCMSTP
          INC       PATGNCMX
          INC       CMGETTHR
          INC       CMXMATRX
          INC       NHOSPDAY
          INC       CALCDAYS
          INC       PABXBILL
          INC       PATCOMN3
          INC       PATIVMES
          INC       CLPATDTR                * Clear DTR file variables
          INC       PATHSPKY
          INC       GETBFEES
          INC       GETTFEES
          INC       GETCNEFF
.
          INC       PATAFEIO/INC       * for casemix
          INC       PATASDIO/INC
          INC       PATCMXIO/INC
          INC       PATHDFIO/INC
          INC       PATHLFIO/INC
          INC       PATLDFIO/INC
          INC       PATLSDIO/INC
          INC       VISPAYIO/INC
.
          INC       PATELGIO/INC
          INC       PATBFEIO/INC
          INC       PATTFEIO/INC       *theatre fee
          INC       PATCODIO/INC
          INC       PATCTFIO/INC
          INC       PATCFAIO/INC
          INC       PMSCIDIO/INC
          INC       PMSCCDIO/INC
          INC       PATDGWIO/INC
          INC       PATDO1IO/INC
          INC       PATDSCIO/INC
          INC       PATDTRIO/INC
          INC       PATDRGIO/INC
          INC       PATECDIO/INC
          INC       PATECOIO/INC
          INC       PATGTUIO/INC
          INC       PATHSPIO/INC
          INC       PATHTRIO/INC
          INC       EMRHTRIO/INC
          INC       OUTHTRIO/INC
          INC       PATFINIO/INC
          INC       PATFMOIO/INC
          INC       PATFN1IO/INC
          INC       PATFX1IO/INC
          INC       PATFN2IO/INC
          INC       PATIBLIO/INC
          INC       PATICUIO/INC
          INC       PATIN1IO/INC
          INC       PATINMIO/INC
          INC       PATINVIO/INC
          INC       PATIOVIO/INC
          INC       PATIPEIO/INC
          INC       PATITMIO/INC
          INC       PATMA1IO/INC
          INC       PATMCHIO/INC
          INC       PATMI1IO/INC
          INC       PATOVBIO/INC
          INC       PATPGRIO/INC
          INC       PATRBLIO/INC
          INC       PATRCAIO/INC
          INC       PATRATIO/INC
          INC       PATSRBIO/INC
          INC       PATTRNIO/INC
          INC       PATVENIO/INC
          INC       PATVISIO/INC
          INC       PATWC1IO/INC
          INC       PATWMAIO/INC
          INC       PATWR1IO/INC
          INC       PATWVEIO/INC
          INC       PMSSINIO/INC
          INC       PATCMTIO/INC
          INC       PMSCMTIO/INC
          INC       PMSCNOIO/INC
          INC       PMSEVTIO/INC
          INC       PMSIDEIO/INC
          INC       PMSSGAIO/INC
          INC       PMSMTIIO/INC
          INC       PMSMPRIO/INC
          INC       PMSHATIO/INC
          INC       PMSHCPIO/INC
          INC       PMSVX1IO/INC
          INC       PRIITMIO/INC
          INC       PATSELFN
          INC       PRBILCMN
          INC       TFILENAM                     * Generate Temp File Name
          INC       STEPDOWN
          INC       PATMCHRD                * Miscellaneous Charges read routine
          INC       VALCMXFN
          INC       GETEFDRG
          INC       PATITMRD
.
          INC       IBASEQIO/INC                 * Sequential Numbers File
          INC       WEBERRIO/INC                 * Web Server Error Logging
          INC       EMRHISIO/INC
          INC       EMRSITIO/INC
          INC       EMRVISIO/INC
          INC       COMDEPIO/INC
          INC       RCPBNKIO/INC
          INC       RCPDTEIO/INC
          INC       RCPBDTIO/INC
          INC       PMSEDGIO/INC       * Effective DRG Dates
          INC       PATDDHIO/INC
.
WRITETRN
GETTHR
PATCALF
TAIL
INITIVAR
PROCMISC
PRTCLMS
NXTTRAN1
WEBERR00
PRTINVTL
SINVT000
DOCNM000
ISUG0000
PRLN0000
ENDPRT00
PEOL0000
CKTL0000
PROACC00
IPRH0000
PRTIPROV
ENDPRT    RETURN
.
ENDIT     CALL     KILL0000
          CHAIN     PGM
          STOP
